[{"tags": ["rust", "iterator"], "answers": [{"comments": [{"owner": {"reputation": 703, "user_id": 8458083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e6ca7ced7bd1272973fe4fa22f90971?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre-olivier Gendraud", "link": "https://stackoverflow.com/users/8458083/pierre-olivier-gendraud"}, "edited": false, "score": 0, "creation_date": 1554973816, "post_id": 55622330, "comment_id": 97949036, "body": "I have token into account your last paragraph by modifying &quot;satisfy condition 1 but not 2&quot; by &quot;has satisfied condition 1 but not 2 yet&quot;"}], "tags": [], "owner": {"reputation": 7716, "user_id": 4639273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae38603d40c633012992337a32330fa0?s=128&d=identicon&r=PG", "display_name": "SCappella", "link": "https://stackoverflow.com/users/4639273/scappella"}, "is_accepted": true, "score": 19, "last_activity_date": 1554936535, "creation_date": 1554936535, "answer_id": 55622330, "question_id": 55622121, "link": "https://stackoverflow.com/questions/55622121/is-it-possible-to-concatenate-iterators/55622330#55622330", "title": "Is it possible to concatenate iterators?", "body": "<p>It seems like <a href=\"https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.chain\" rel=\"noreferrer\"><code>std::iter::chain</code></a> is what you're looking for.</p>\n\n<pre><code>use std::iter;\n\nfn main() {\n    let mut c = 0;\n    let mut d = 5;\n    let z: Vec&lt;_&gt; = iter::repeat(\"don't satisfy condition 1\")\n        .take_while(|_| {\n            c = c + 1;\n            let rep = if c &lt; 5 { true } else { false };\n            rep\n            // this block can be simplified to\n            // c += 1;\n            // c &lt; 5\n            // Clippy warns about this\n        })\n        .chain(\n            iter::repeat(\"satisfy condition 1 but not 2\").take_while(|_| {\n                d -= 1;\n                d &gt; 2\n            }),\n        )\n        .collect();\n    println!(\"------{:?}\", z);\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=745e9477441a8ec0d40d87a5e6d92c6d\" rel=\"noreferrer\">(playground link)</a></p>\n\n<p>I can't comment on the semantics of your code, though. If you're trying to see which elements of an iterator \"satisfy condition 1 but not 2\", this wouldn't be how you do it. You would use <a href=\"https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.filter\" rel=\"noreferrer\"><code>std::iter::filter</code></a> twice (once with condition 1 and once with not condition 2) to achieve that.</p>\n"}], "owner": {"reputation": 703, "user_id": 8458083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e6ca7ced7bd1272973fe4fa22f90971?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre-olivier Gendraud", "link": "https://stackoverflow.com/users/8458083/pierre-olivier-gendraud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4163, "favorite_count": 0, "accepted_answer_id": 55622330, "answer_count": 1, "score": 11, "last_activity_date": 1554973575, "creation_date": 1554935064, "last_edit_date": 1554973575, "question_id": 55622121, "link": "https://stackoverflow.com/questions/55622121/is-it-possible-to-concatenate-iterators", "title": "Is it possible to concatenate iterators?", "body": "<pre><code>let vec = iter::repeat(\"don't satisfy condition 1\") // iterator such as next() always \"don't \" satisfy condition 1\"\n    .take_while(|_| {\n        satisfycondition1.satisfy() // true is condition 1 is satisfied else false\n    })\n    .collect();\n</code></pre>\n\n<p>This code creates a vector of <code>n</code> elements with <code>n</code> equal to the number of times condition 1 is not respected.</p>\n\n<p>I would like now to create a vector of <code>n + m</code> elements with <code>n</code> equal to the number of times that condition 1 is not respected and <code>m</code> the number of times that condition 2 is not respected.</p>\n\n<p>The code should resemble something like this:</p>\n\n<pre><code>let vec = iter::repeat(\"dont't satisfy condition 1\")\n    .take_while(|_| {\n        satisfycondition1.satisfy() \n    })\n    .union(\n        iter::repeat(\"has satisfed condition 1 but not 2 yet\")\n        .take_while(|_| {\n            satisfycondition2.satisfy() \n        })\n    )\n    .collect();\n</code></pre>\n\n<p>I know I could create two vectors and then concatenate them but it's less efficient.</p>\n\n<p>You can use this code to understand what does repeat:</p>\n\n<pre><code>use  std::iter;\n\nfn main() {\n    let mut c = 0;\n    let z: Vec&lt;_&gt; = iter::repeat(\"dont't satisfy condition 1\")\n        .take_while(|_| {\n            c = c + 1;\n            let rep = if c &lt; 5 { true } else { false };\n            rep\n        })\n        .collect();\n    println!(\"------{:?}\", z);\n}\n</code></pre>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 3, "creation_date": 1554926957, "post_id": 55616115, "comment_id": 97934125, "body": "Even <code>let foo: Foo&lt;_&gt; = Foo::new();</code> works fine, since <code>T</code> can be inferred. This looks like it does not provide any additional information, but in fact it does \u2013 explicitly omitting the second parameter to the type constructor tells the compiler to use the default value. The code without any type annotation behaves like <code>let foo: Foo&lt;_, _&gt; = Foo::new();</code>, which fails with the same error."}], "answers": [{"comments": [{"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 2, "creation_date": 1554926679, "post_id": 55616388, "comment_id": 97933989, "body": "So in short: The <code>F</code> that can&#39;t be inferred is the parameter <code>F</code> to the impl, not the parameter <code>F</code> to the struct. If you rename the parameter to the impl to something else, this becomes clear from the error message."}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1554962388, "post_id": 55616388, "comment_id": 97943379, "body": "But this means, that you can&#39;t call <code>new</code> or <code>foo</code> for <code>F = i32</code>, correct? Is that possible to achieve?"}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1554965471, "post_id": 55616388, "comment_id": 97944586, "body": "@hellow Correct, if <code>new()</code> is only defined for <code>F = ()</code> you can&#39;t call it for other types <code>F</code>. If you want to allow that as well you need to add another more flexible method with a different name, or use <code>Default::default()</code> as <code>HashMap</code> does."}], "tags": [], "owner": {"reputation": 5700, "user_id": 3131852, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/26365707ecfa02e221f5192aaaa29a43?s=128&d=identicon&r=PG", "display_name": "Tim Diekmann", "link": "https://stackoverflow.com/users/3131852/tim-diekmann"}, "is_accepted": true, "score": 9, "last_activity_date": 1554910457, "last_edit_date": 1554910457, "creation_date": 1554910367, "answer_id": 55616388, "question_id": 55616115, "link": "https://stackoverflow.com/questions/55616115/why-does-type-inference-behave-differently-for-hashmap-and-my-own-struct-in-th/55616388#55616388", "title": "Why does type inference behave differently for `HashMap` and my own struct in the presence of a type parameter default?", "body": "<p><code>HashMap::new</code> is defined this way:</p>\n\n<pre><code>impl&lt;K: Hash + Eq, V&gt; HashMap&lt;K, V, RandomState&gt; {\n    pub fn new() -&gt; HashMap&lt;K, V, RandomState&gt; {\n        Default::default()\n    }\n}\n</code></pre>\n\n<p><code>RandomState</code> is provided for <code>S</code> for <code>new</code>. Your code would look like this for the same behavior:</p>\n\n<pre><code>impl&lt;T&gt; Foo&lt;T, ()&gt; {\n    fn new() -&gt; Self { Self(PhantomData) }\n    fn foo(&amp;self, _: T) {}\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=2c479fd1e0ab8a3c8dbdecceddac5ba5\" rel=\"noreferrer\">Playground</a></p>\n\n<p>Note: <code>Default</code> can be used for a custom <code>BuildHasher</code>:</p>\n\n<pre><code>impl&lt;K, V, S&gt; Default for HashMap&lt;K, V, S&gt;\n</code></pre>\n"}], "owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 575, "favorite_count": 0, "accepted_answer_id": 55616388, "answer_count": 1, "score": 7, "last_activity_date": 1554926763, "creation_date": 1554909483, "last_edit_date": 1554926763, "question_id": 55616115, "link": "https://stackoverflow.com/questions/55616115/why-does-type-inference-behave-differently-for-hashmap-and-my-own-struct-in-th", "title": "Why does type inference behave differently for `HashMap` and my own struct in the presence of a type parameter default?", "body": "<p>I have a struct with two type parameters, one of which has a default type:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::marker::PhantomData;\n\nstruct Foo&lt;T, F = ()&gt;(PhantomData&lt;(T, F)&gt;);\n\nimpl&lt;T, F&gt; Foo&lt;T, F&gt; {\n    fn new() -&gt; Self { Self(PhantomData) }\n    fn foo(&amp;self, _: T) {}\n}\n\n\nlet foo = Foo::new();\nfoo.foo(0u32);\n</code></pre>\n\n<p>The code above leads to:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0282]: type annotations needed\n  --&gt; src/main.rs:17:15\n   |\n17 |     let foo = Foo::new();\n   |         ---   ^^^^^^^^ cannot infer type for `F`\n   |         |\n   |         consider giving `foo` a type\n</code></pre>\n\n<p>I don't understand why the default type is not used here. Note that saying <code>let foo: Foo&lt;u32&gt; = Foo::new();</code> already works -- so there is no need to specify the parameter <code>F</code>. But why specify <code>T</code>? So I was already confused.</p>\n\n<p>But then I remembered that all of this works with <code>HashMap</code>! It is defined as <code>struct HashMap&lt;K, V, S = RandomState&gt;</code>. And I never needed to specify anything. For example, this works:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::collections::HashMap;\n\nlet mut map = HashMap::new();\nmap.insert(0u32, 'x');\n</code></pre>\n\n<p>(<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=6e3678793832fe846a2f9d189881b857\" rel=\"nofollow noreferrer\">Everything on Playground</a>)</p>\n\n<p><strong>Why is the default type/inference behavior different between <code>Foo</code> and <code>HashMap</code>?</strong> Does the hashmap use some compiler magic?</p>\n"}, {"tags": ["rust", "borrow-checker", "rust-tokio"], "comments": [{"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 6, "creation_date": 1554894069, "post_id": 55610608, "comment_id": 97916101, "body": "Why don&#39;t you just use <code>into_bytes</code>,  instead of wrapping with arc and passing the borrowed bytes array ? <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=1d06af32637054e2fbe5ca9f16d60612\" rel=\"nofollow noreferrer\">Playground</a>"}, {"owner": {"reputation": 29, "user_id": 8751557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62ae7ec998fd91af21cbb8a37e8392a8?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/8751557/david"}, "reply_to_user": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 0, "creation_date": 1554988890, "post_id": 55610608, "comment_id": 97958202, "body": "It worked. Thanks. But I don&#39;t understand why wrapping with arc didn&#39;t."}], "answers": [{"comments": [{"owner": {"reputation": 29, "user_id": 8751557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62ae7ec998fd91af21cbb8a37e8392a8?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/8751557/david"}, "edited": false, "score": 0, "creation_date": 1555064874, "post_id": 55634280, "comment_id": 97987965, "body": "I&#39;m sorry but I still don&#39;t understand the difference between Arc and into_bytes(). If I understand correctly, Arc is dropped when going out of scope because it haven&#39;t been executed yet. Even if declaring a response2=response.clone(). But using into_bytes() shouldn&#39;t work either. It creates a response that is a vector that goes out of scope before the future gets executed. Where is the difference?"}, {"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "reply_to_user": {"reputation": 29, "user_id": 8751557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62ae7ec998fd91af21cbb8a37e8392a8?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/8751557/david"}, "edited": false, "score": 0, "creation_date": 1555065301, "post_id": 55634280, "comment_id": 97988184, "body": "@David Simply with as_bytes <code>Future</code>(<code>WriteAll</code>) borrows bytes, with <code>into_bytes</code> the <code>Future</code> takes ownership of bytes. bytes will not be dropped in the scope due to <code>Future</code> has ownership, so it guarantees that it will be dropped in <code>Future</code> or after it&#39;s execution."}, {"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "reply_to_user": {"reputation": 29, "user_id": 8751557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62ae7ec998fd91af21cbb8a37e8392a8?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/8751557/david"}, "edited": false, "score": 0, "creation_date": 1555065700, "post_id": 55634280, "comment_id": 97988358, "body": "@David also <code>write_all</code> expects a generic parameter which can be converted to a slice, so you can use borrowed or moved argument to call <code>write_all</code>"}, {"owner": {"reputation": 29, "user_id": 8751557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62ae7ec998fd91af21cbb8a37e8392a8?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/8751557/david"}, "edited": false, "score": 0, "creation_date": 1555106272, "post_id": 55634280, "comment_id": 98008254, "body": "Yes, now it\u2019s clear the difference. Thank you &#214;mer."}], "tags": [], "owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "is_accepted": false, "score": 1, "last_activity_date": 1555066820, "last_edit_date": 1555066820, "creation_date": 1554991047, "answer_id": 55634280, "question_id": 55610608, "link": "https://stackoverflow.com/questions/55610608/borrowed-value-does-not-live-long-enough-with-a-tokio-future/55634280#55634280", "title": "Borrowed value does not live long enough with a Tokio future", "body": "<h2>How can you make it work ?</h2>\n\n<p>As i pointed in my comment: use <code>into_bytes</code>, instead of wrapping with <code>Arc</code> and passing the borrowed bytes array.</p>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=1d06af32637054e2fbe5ca9f16d60612\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<hr>\n\n<p>@David:</p>\n\n<blockquote>\n  <p>But I don't understand why wrapping with arc didn't.</p>\n</blockquote>\n\n<p><code>Arc</code> counts reference of inner object:</p>\n\n<ul>\n<li>it increases the reference when you <code>clone()</code></li>\n<li>it decreases the reference when the <strong>owner</strong> of <code>Arc</code> gets dropped.</li>\n<li>it gets dropped from the memory when reference count decreases to <strong>0</strong></li>\n</ul>\n\n<p>In your case owner of the <code>Arc</code>, which is named as <code>response</code>. <code>response</code> is created in scope and dropped at the end of the same scope. It's ref count was 1 when it was created, it became 0 after dropped. But you've passed a reference of <code>Arc</code> inside a <code>Future</code> right before it has removed from memory.</p>\n\n<p>Please note that <code>write_all()</code> creates a <code>Future</code> and that <code>Future</code> carries a reference of your <code>Arc</code>, which is removed from memory before the <code>Future</code>'s execution.</p>\n\n<p><strong>Note</strong>: <code>WriteAll</code> can have ownership of <strong>borrowed</strong> or <strong>moved</strong> value it expects a generic parameter which can be converted to a <code>slice</code>.</p>\n"}], "owner": {"reputation": 29, "user_id": 8751557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62ae7ec998fd91af21cbb8a37e8392a8?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/8751557/david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 748, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1555066820, "creation_date": 1554893090, "last_edit_date": 1554991225, "question_id": 55610608, "link": "https://stackoverflow.com/questions/55610608/borrowed-value-does-not-live-long-enough-with-a-tokio-future", "title": "Borrowed value does not live long enough with a Tokio future", "body": "<p>I'm trying to write a simple HTTP server using Rust and tokio.</p>\n\n<p>Everything works fine until I want to send the response. </p>\n\n<p>The code is the following:</p>\n\n<pre><code>use std::fs;\nuse std::sync::Arc;\nuse tokio::net::TcpListener; // 0.1.15\nuse tokio::prelude::*;\n\nfn main() {\n    let addr = \"0.0.0.0:8080\".parse().unwrap();\n    let listener = TcpListener::bind(&amp;addr).expect(\"unable to bind TCP listener\");\n\n    let incoming = listener.incoming();\n\n    let server = incoming\n        .map_err(|e| eprintln!(\"accept failed = {:?}\", e))\n        .for_each(|socket| {\n            println!(\n                \"Connection established: from {:?} to {:?}\",\n                socket.peer_addr(),\n                socket.local_addr()\n            );\n            let bytes = vec![0; 512];\n            let processor = tokio::io::read(socket, bytes)\n                .and_then(|(socket, bytes, _size)| {\n                    println!(\"Request: {}\", String::from_utf8_lossy(&amp;bytes[..]));\n                    let contents = fs::read_to_string(\"hello.html\").unwrap();\n                    let response = Arc::new(format!(\"HTTP/1.1 200 OK\\r\\n\\r\\n{}\", contents));\n                    let response = response.clone();\n                    tokio::io::write_all(socket, response.as_bytes()).and_then(|_| Ok(()))\n                })\n                .map_err(|_| ());\n            tokio::spawn(processor);\n            Ok(())\n        });\n\n    tokio::run(server);\n}\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0597]: `response` does not live long enough\n  --&gt; src/main.rs:27:50\n   |\n27 |                     tokio::io::write_all(socket, response.as_bytes()).and_then(|_| Ok(()))\n   |                                                  ^^^^^^^^ borrowed value does not live long enough\n28 |                 })\n   |                 - `response` dropped here while still borrowed\n</code></pre>\n\n<p>How do I have to declare the response to live enough?</p>\n"}, {"tags": ["rust", "rust-tokio"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1554889164, "post_id": 55609225, "comment_id": 97913159, "body": "Please use <code>rustfmt</code> to format the code according to the guidelines of the Rust community. You can find it in the upper right corner of the playground under tools. Also please try to write clear and simple english sentences. It&#39;s hard to read your text if there are words missing. I know that english is not everybodys first language (mine neither) and it&#39;s hard sometimes. Keep on going!"}], "answers": [{"tags": [], "owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "is_accepted": true, "score": 5, "last_activity_date": 1554897356, "last_edit_date": 1554897356, "creation_date": 1554892888, "answer_id": 55610525, "question_id": 55609225, "link": "https://stackoverflow.com/questions/55609225/why-does-this-delay-future-inside-poll-not-work-in-my-custom-stream-type/55610525#55610525", "title": "Why does this Delay future inside poll() not work in my custom Stream type?", "body": "<p>The main issue here is that state management is missing. You are creating a new <code>Delay</code> future every time the stream is polled, rather than holding on to it until it's resolved.\nThis would lead to never seeing any items coming out of the stream, since these futures are only being polled once, likely yielding <code>NotReady</code> each time.</p>\n\n<p>You need to keep track of the delay future in your type <code>SomeStream</code>. In this case, one can use an option, so as to also identify whether we need to create a new delay.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[derive(Debug, Default)]\nstruct SomeStream {\n    delay: Option&lt;Delay&gt;,\n}\n</code></pre>\n\n<p>The subsequent code for <code>SomeStream::poll</code>, with better error handling and more idiomatic constructs, would become something like this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>impl Stream for SomeStream {\n    type Item = String;\n    type Error = Box&lt;dyn std::error::Error + Send + Sync&gt;; // generic error\n\n    fn poll(&amp;mut self) -&gt; Result&lt;Async&lt;Option&lt;Self::Item&gt;&gt;, Self::Error&gt; {\n        let delay = self.delay.get_or_insert_with(|| {\n            let when = Instant::now() + Duration::from_millis(1000);\n            Delay::new(when)\n        });\n\n        match delay.poll() {\n            Ok(Async::Ready(value)) =&gt; {\n                self.delay = None;\n                Ok(Async::Ready(Some(\"Hello\".to_string())))\n            },\n            Ok(Async::NotReady) =&gt; Ok(Async::NotReady),\n            Err(err) =&gt; Err(err.into()),\n        }\n    }\n}\n</code></pre>\n\n<p>Or, even better, using the <code>try_ready!</code> macro, which makes the return of errors and <code>NotReady</code> signals with less boilerplate.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn poll(&amp;mut self) -&gt; Result&lt;Async&lt;Option&lt;Self::Item&gt;&gt;, Self::Error&gt; {\n    let delay = self.delay.get_or_insert_with(|| {\n        let when = Instant::now() + Duration::from_millis(1000);\n        Delay::new(when)\n    });\n\n    try_ready!(delay.poll());\n\n    // tick!\n    self.delay = None;\n    Ok(Async::Ready(Some(\"Hello\".to_string())))\n}\n</code></pre>\n\n<p>(<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=799db9aeb7dca75a4cc92fc7026c89bf\" rel=\"nofollow noreferrer\">Playground</a>)</p>\n"}], "owner": {"reputation": 23, "user_id": 11339355, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb6a20ae7034b370b8703a61fd3d19ad?s=128&d=identicon&r=PG&f=1", "display_name": "Ouim", "link": "https://stackoverflow.com/users/11339355/ouim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 291, "favorite_count": 2, "accepted_answer_id": 55610525, "answer_count": 1, "score": 2, "last_activity_date": 1554900185, "creation_date": 1554888664, "last_edit_date": 1554900185, "question_id": 55609225, "link": "https://stackoverflow.com/questions/55609225/why-does-this-delay-future-inside-poll-not-work-in-my-custom-stream-type", "title": "Why does this Delay future inside poll() not work in my custom Stream type?", "body": "<p>I want to print \"Hello\" once a second.</p>\n\n<p>Quoting the doc:</p>\n\n<blockquote>\n  <p>Futures use a poll based model. The consumer of a future repeatedly calls the poll function. The future then attempts to complete. If the future is able to complete, it returns Async::Ready(value). If the future is unable to complete due to being blocked on an internal resource (such as a TCP socket), it returns Async::NotReady.</p>\n</blockquote>\n\n<p>My <code>poll</code> function returns <code>NotReady</code> if <code>Delay</code>s return is <code>NotReady</code>, but nothing is printed to stdout.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use futures::{Async, Future, Stream}; // 0.1.25\nuse std::time::{Duration, Instant};\nuse tokio::timer::Delay; // 0.1.15\n\nstruct SomeStream;\n\nimpl Stream for SomeStream {\n    type Item = String;\n    type Error = ();\n\n    fn poll(&amp;mut self) -&gt; Result&lt;Async&lt;Option&lt;Self::Item&gt;&gt;, Self::Error&gt; {\n        let when = Instant::now() + Duration::from_millis(1000);\n        let mut task = Delay::new(when).map_err(|e| eprintln!(\"{:?}\", e));\n        match task.poll() {\n            Ok(Async::Ready(value)) =&gt; {}\n            Ok(Async::NotReady) =&gt; return Ok(Async::NotReady),\n            Err(err) =&gt; return Err(()),\n        }\n        Ok(Async::Ready(Some(\"Hello\".to_string())))\n    }\n}\n\nfn main() {\n    let s = SomeStream;\n    let future = s\n        .for_each(|item| {\n            println!(\"{:?}\", item);\n            Ok(())\n        })\n        .map_err(|e| {});\n    tokio::run(future);\n}\n</code></pre>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1554882034, "post_id": 55607123, "comment_id": 97909061, "body": "Your second code example does not work, because <code>split_text</code> does not return <code>Self</code> as in the first example. Also please fix your post. Link to the playground instead to the gist <code>https:&#47;&#47;play.rust-lang.org&#47;edition=2018&amp;gist=&lt;gist_id&gt;</code>. Also please use <code>rustfmt</code> (in the upper right corner in the playground under tools) to format your code according to the community guidelines."}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1554889275, "post_id": 55607123, "comment_id": 97913231, "body": "Please also address the other issues I listed above in your code. We can&#39;t help you if you give us non-working code."}, {"owner": {"reputation": 13, "user_id": 1376486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28e1204754440a5114edff705d675217?s=128&d=identicon&r=PG", "display_name": "Gregory Simonov", "link": "https://stackoverflow.com/users/1376486/gregory-simonov"}, "edited": false, "score": 0, "creation_date": 1554889841, "post_id": 55607123, "comment_id": 97913656, "body": "As I said in my question, I can&#39;t make second code example to work without removing borrowing and it is not clear from your comment what I&#39;m supposed to fix. <a href=\"https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=63d7073bb5791327831de3c6dcf66556\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1554890320, "post_id": 55607123, "comment_id": 97913954, "body": "Please look at my edit and see what I mean.  Also your signature changed between your two code examples, which results in an error I had (the on with that <code>split_text</code> does not return <code>Self</code> anymore). Second I asked you to format the code properly. Also don&#39;t put code and error in the same code block. Please keep that in mind for the next time."}], "answers": [{"tags": [], "owner": {"reputation": 35470, "user_id": 6348498, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/0zu4m.jpg?s=128&g=1", "display_name": "Gurwinder Singh", "link": "https://stackoverflow.com/users/6348498/gurwinder-singh"}, "is_accepted": true, "score": 1, "last_activity_date": 1554965359, "last_edit_date": 1554965359, "creation_date": 1554890113, "answer_id": 55609684, "question_id": 55607123, "link": "https://stackoverflow.com/questions/55607123/code-works-without-borrowing-but-i-cant-make-it-work-with-borrowing/55609684#55609684", "title": "Code works without borrowing but I can&#39;t make it work with borrowing", "body": "<p>The issue is that you are borrowing the object <code>obj1</code> mutable in function <code>split_text</code> for <code>'a</code> lifetime which is up to the end of the <code>main</code> function.</p>\n\n<pre><code>fn main() {\n    println!(\"Hello, world!\");\n    let mut test = String::from(\"12345\");\n    let mut obj1 = Object {                             // 'a start\n        text: test.as_mut_str(),\n        next: None,\n    };\n    for i in 0..5 {\n        obj1 = obj1.split_text(4 - i);                  // borrow for 'a lifetime,\n                                                        // Won't work in next iteration\n        if let Some(obj) = obj1.next.as_ref() {         // Won't work\n            println!(\"{}\", obj.text);\n        }\n    }\n}                                                       // 'a end\n</code></pre>\n\n<p>You want to borrow it mutably only for <code>split_text</code> function i.e. for a different (smaller) lifetime - which you can either elide or specify a different one - say <code>'b</code>.</p>\n\n<pre><code>struct Object&lt;'a&gt; {\n    text: &amp;'a str, // no need of mutable slice here\n    next: Option&lt;Box&lt;Object&lt;'a&gt;&gt;&gt;,\n}\n\nimpl&lt;'a&gt; Object&lt;'a&gt; {\n    fn split_text(&amp;mut self, count: usize) { // No lifetime required here\n        let (part1, part2) = self.text.split_at(count); // no need of temp var and mutable split here\n        self.text = part1;\n        let obj2 = Object {\n            text: part2,\n            next: None,\n        };\n        self.next = Some(Box::new(obj2));\n    }\n}\n</code></pre>\n\n<p>Explicit different lifetime version (just for completeness):</p>\n\n<pre><code>impl&lt;'a&gt; Object&lt;'a&gt; {\n    fn split_text&lt;'b&gt;(&amp;'b mut self, count: usize) {\n        let tmp = &amp;mut self.text;\n        let (part1, part2) = tmp.split_at(count);\n        self.text = part1;\n        let obj2 = Object {\n            text: part2,\n            next: None,\n        };\n        self.next = Some(Box::new(obj2));\n    }\n}\n</code></pre>\n\n<p>Also, make something mutable only when required. I changed the mutable slice and split to normal.</p>\n"}], "owner": {"reputation": 13, "user_id": 1376486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28e1204754440a5114edff705d675217?s=128&d=identicon&r=PG", "display_name": "Gregory Simonov", "link": "https://stackoverflow.com/users/1376486/gregory-simonov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 55609684, "answer_count": 1, "score": 1, "last_activity_date": 1554965359, "creation_date": 1554881742, "last_edit_date": 1554890243, "question_id": 55607123, "link": "https://stackoverflow.com/questions/55607123/code-works-without-borrowing-but-i-cant-make-it-work-with-borrowing", "title": "Code works without borrowing but I can&#39;t make it work with borrowing", "body": "<p>I have some code and it works but AFAIK borrowing is made specifically to avoid passing same object in and out of method manually like I did in <code>split_text</code> method.</p>\n\n<pre><code>fn main() {\n    println!(\"Hello, world!\");\n    let mut test = String::from(\"12345\");\n    let mut obj1 = Object {\n        text: test.as_mut_str(),\n        next: None,\n    };\n    for i in 0..5 {\n        obj1 = obj1.split_text(4 - i);\n        if let Some(obj) = obj1.next.as_ref() {\n            println!(\"{}\", obj.text);\n        }\n    }\n}\n\nstruct Object&lt;'a&gt; {\n    text: &amp;'a mut str,\n    next: Option&lt;Box&lt;Object&lt;'a&gt;&gt;&gt;,\n}\n\nimpl&lt;'a&gt; Object&lt;'a&gt; {\n    fn split_text(mut self, count: usize) -&gt; Self {\n        let tmp = self.text;\n        let (part1, part2) = tmp.split_at_mut(count);\n        self.text = part1;\n        let obj2 = Object {\n            text: part2,\n            next: None,\n        };\n        self.next = Some(Box::new(obj2));\n        self\n    }\n}\n</code></pre>\n\n<p>(<a href=\"https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=697dc6a26ac47d7f7028aa0ccf20fa07\" rel=\"nofollow noreferrer\">Playground</a>)</p>\n\n<p>But I can't figure out how to pass borrow checker</p>\n\n<pre><code>impl&lt;'a&gt; Object&lt;'a&gt; {\n    fn split_text(&amp;'a mut self, count: usize) {\n        let tmp = &amp;mut self.text;\n        let (part1, part2) = tmp.split_at_mut(count);\n        self.text = part1;\n        let obj2 = Object {\n            text: part2,\n            next: None,\n        };\n        self.next = Some(Box::new(obj2));\n    }\n}\n</code></pre>\n\n<p>result in the error</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0499]: cannot borrow `obj1` as mutable more than once at a time\n  --&gt; src/main.rs:11:9\n   |\n11 |         obj1.split_text(4 - i);\n   |         ^^^^ mutable borrow starts here in previous iteration of loop\n\nerror[E0502]: cannot borrow `obj1.next` as immutable because it is also borrowed as mutable\n  --&gt; src/main.rs:12:28\n   |\n11 |         obj1.split_text(4 - i);\n   |         ---- mutable borrow occurs here\n12 |         if let Some(obj) = obj1.next.as_ref() {\n   |                            ^^^^^^^^^\n   |                            |\n   |                            immutable borrow occurs here\n   |                            mutable borrow later used here\n\nerror[E0506]: cannot assign to `self.text` because it is borrowed\n  --&gt; src/main.rs:27:9\n   |\n23 | impl &lt;'a&gt; Object&lt;'a&gt; {\n   |       -- lifetime `'a` defined here\n24 |     fn split_text(&amp;'a mut self, count:usize) {\n25 |         let tmp = &amp;mut self.text;\n   |                   -------------- borrow of `self.text` occurs here\n26 |         let (part1, part2) = tmp.split_at_mut(count);\n   |                              ----------------------- argument requires that `self.text` is borrowed for `'a`\n27 |         self.text = part1;\n   |         ^^^^^^^^^^^^^^^^^ assignment to borrowed `self.text` occurs here\n</code></pre>\n\n<p>(<a href=\"https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=a77f8a9d990e0b2ec4b3747828e97090\" rel=\"nofollow noreferrer\">Playground</a>)</p>\n\n<p>Is there a way to make this code to work?</p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1554881443, "post_id": 55607009, "comment_id": 97908760, "body": "How does your answer differ from the suggested duplicate? <a href=\"https://stackoverflow.com/questions/45116984/the-trait-cannot-be-made-into-an-object\" title=\"the trait cannot be made into an object\">stackoverflow.com/questions/45116984/&hellip;</a>"}, {"owner": {"reputation": 9010, "user_id": 2588800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/847da843d41921363502159c8b7e5549?s=128&d=identicon&r=PG", "display_name": "Svetlin Zarev", "link": "https://stackoverflow.com/users/2588800/svetlin-zarev"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1554881546, "post_id": 55607009, "comment_id": 97908801, "body": "I didn&#39;t see the link when I started writing it; I&#39;m also going to provide more details  from rfc0255"}, {"owner": {"reputation": 9010, "user_id": 2588800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/847da843d41921363502159c8b7e5549?s=128&d=identicon&r=PG", "display_name": "Svetlin Zarev", "link": "https://stackoverflow.com/users/2588800/svetlin-zarev"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1554882725, "post_id": 55607009, "comment_id": 97909431, "body": "The first duplicate link addresses only the first part of the question and the second duplicate link discusses another problem. So this question is not a duplicate. Also none of the answers address the object-safety issue."}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 2, "creation_date": 1554883644, "post_id": 55607009, "comment_id": 97909935, "body": "Yes, it&#39;s a combination of both. The first dup addresses the general problem of <code>impl Trait</code> as return type, and the second dup addresses the <i>&quot;the trait <code>MyTrait</code> cannot be made into an object&quot;</i> thing."}], "tags": [], "owner": {"reputation": 9010, "user_id": 2588800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/847da843d41921363502159c8b7e5549?s=128&d=identicon&r=PG", "display_name": "Svetlin Zarev", "link": "https://stackoverflow.com/users/2588800/svetlin-zarev"}, "is_accepted": true, "score": 1, "last_activity_date": 1554990206, "last_edit_date": 1554990206, "creation_date": 1554881305, "answer_id": 55607009, "question_id": 55606750, "link": "https://stackoverflow.com/questions/55606750/specify-common-implementation-in-box-to-work-with-a-match/55607009#55607009", "title": "Specify common implementation in Box to work with a match", "body": "<p>As the compiler message says, you need to add a receiver to the <code>my_func</code> method: <code>fn my_func()</code> -> <code>fn my_func(&amp;self)</code></p>\n\n<p>The reason this is necessary is because it needs to be <code>object-safe</code>. The requirements are detailed in <a href=\"https://github.com/rust-lang/rfcs/blob/master/text/0255-object-safety.md\" rel=\"nofollow noreferrer\">RFC-0255</a>  </p>\n\n<p>The specific requirement to your case is </p>\n\n<blockquote>\n  <p>must have a receiver that has type <code>Self</code> or which dereferences to the\n  <code>Self</code> type;</p>\n  \n  <p>for now, this means <code>self</code>, <code>&amp;self</code>, <code>&amp;mut self</code>, or <code>self: Box&lt;Self&gt;</code>, but eventually this should be extended to custom types like <code>self: Rc&lt;Self&gt;</code> and so forth.</p>\n</blockquote>\n\n<pre><code>use std::fmt::Debug;\n\nfn main() {\n    println!(\"Foo =&gt; {:?}\", get_a_struct(MyEnum::MyEnumFoo));\n    println!(\"Bar =&gt; {:?}\", get_a_struct(MyEnum::MyEnumBar));\n}\n\ntrait MyTrait :Debug{\n    fn my_func(&amp;self) {}\n}\n\nenum MyEnum {\n    MyEnumFoo,\n    MyEnumBar,\n}\n\n#[derive(Debug)]\nstruct MyStruct1 {}\n\n#[derive(Debug)]\nstruct MyStruct2 {}\n\nimpl MyTrait for MyStruct1 {\n    fn my_func(&amp;self) {\n        println!(\"Hello world from MyStruct1\")\n    }\n}\n\nimpl MyTrait for MyStruct2 {\n    fn my_func(&amp;self) {\n        println!(\"Hello world from MyStruct2\")\n    }\n}\n\nfn get_a_struct(an_enum: MyEnum) -&gt; Box&lt;dyn MyTrait&gt; {\n    match an_enum {\n        MyEnum::MyEnumFoo =&gt; Box::new(MyStruct1 {}),\n        MyEnum::MyEnumBar =&gt; Box::new(MyStruct2 {}),\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 5433, "user_id": 801924, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e7897859ed577821631f36eceba0603d?s=128&d=identicon&r=PG", "display_name": "bux", "link": "https://stackoverflow.com/users/801924/bux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "closed_date": 1554990074, "accepted_answer_id": 55607009, "answer_count": 1, "score": 1, "last_activity_date": 1554990206, "creation_date": 1554880424, "last_edit_date": 1554990155, "question_id": 55606750, "link": "https://stackoverflow.com/questions/55606750/specify-common-implementation-in-box-to-work-with-a-match", "closed_reason": "Duplicate", "title": "Specify common implementation in Box to work with a match", "body": "<p>I would like to write a function which returns structs which are implementing a common trait.</p>\n\n<p>If my function specifies the return type <code>-&gt; impl MyTrait</code>, I fail to be compliant when using a match because the match must return the same type. Example:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn get_a_struct(an_enum: MyEnum) -&gt; impl MyTrait {\n    match an_enum {\n        MyEnum::MyEnumFoo =&gt; MyStruct1 {},\n        MyEnum::MyEnumBar =&gt; MyStruct2 {},\n    }\n}\n</code></pre>\n\n<p>Which produces:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0308]: match arms have incompatible types\n  --&gt; src/main.rs:22:5\n   |\n22 | /     match an_enum {\n23 | |         MyEnum::MyEnumFoo =&gt; MyStruct1{},\n24 | |         MyEnum::MyEnumBar =&gt; MyStruct2{},\n   | |                              ------------- match arm with an incompatible type\n25 | |     }\n   | |_____^ expected struct `MyStruct1`, found struct `MyStruct2`\n   |\n   = note: expected type `MyStruct1`\n              found type `MyStruct2`\n</code></pre>\n\n<p>If I try it with a <code>Box</code>, like this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>trait MyTrait {\n    fn my_func() {}\n}\n\nenum MyEnum {\n    MyEnumFoo,\n    MyEnumBar,\n}\n\nstruct MyStruct1 {}\nstruct MyStruct2 {}\n\nimpl MyTrait for MyStruct1 {\n    fn my_func() {\n        println!(\"Hello world from MyStruct1\")\n    }\n}\n\nimpl MyTrait for MyStruct2 {\n    fn my_func() {\n        println!(\"Hello world from MyStruct2\")\n    }\n}\n\nfn get_a_struct(an_enum: MyEnum) -&gt; Box&lt;MyTrait&gt; {\n    match an_enum {\n        MyEnum::MyEnumFoo =&gt; Box::new(MyStruct1 {}),\n        MyEnum::MyEnumBar =&gt; Box::new(MyStruct2 {}),\n    }\n}\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0038]: the trait `MyTrait` cannot be made into an object\n  --&gt; src/main.rs:21:1\n   |\n21 | fn get_a_struct(an_enum: MyEnum) -&gt; Box&lt;MyTrait&gt; {\n   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `MyTrait` cannot be made into an object\n   |\n   = note: method `my_func` has no receiver\n</code></pre>\n\n<p>I don't know how to use a trait in this case. </p>\n\n<p>How can I write a function which returns structs which are implementing the same trait?</p>\n\n<p>A partial response can be found in <a href=\"https://stackoverflow.com/questions/52001592\">Why can impl trait not be used to return multiple / conditional types?</a>, but none of the answers address the object-safety issue. </p>\n\n<p>Similar behaviour in OOP can specify a return type by an interface.</p>\n"}, {"tags": ["rust", "hyper"], "answers": [{"tags": [], "owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "is_accepted": true, "score": 5, "last_activity_date": 1554908445, "creation_date": 1554908445, "answer_id": 55615769, "question_id": 55606450, "link": "https://stackoverflow.com/questions/55606450/how-to-share-immutable-configuration-data-with-hyper-request-handlers/55615769#55615769", "title": "How to share immutable configuration data with hyper request handlers?", "body": "<p>The two levels of closures in <code>serve</code> are to be observed with care.\nThe closure at the second level (which is passed to <code>service_fn_ok</code>), defined with <code>move</code>, will attempt to move the only instance <code>cfg</code> into it, even before any call to <code>clone()</code> is made.\nThis move cannot be done multiple times without cloning, and therefore the closure will only implement <code>FnOnce</code>. This is a case of <em>double move</em>: the second closure wants to receive a resource in an environment that only allows it to do that once.</p>\n\n<p>To solve this problem, we want the first closure to receive <code>cfg</code>, and clone it each time there.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn main() {\n    let cfg = read_ini(\"demo.ini\");\n    let addr = \"127.0.0.1:3000\".parse().unwrap();\n\n    let server = Server::bind(&amp;addr)\n        .serve(move || {\n            let cfg = cfg.clone();\n            service_fn_ok(move |req| request_handler(req, &amp;cfg))\n        })\n        .map_err(|e| println!(\"server error: {}\", e));\n\n    rt::run(server);\n}\n</code></pre>\n"}], "owner": {"reputation": 215, "user_id": 920950, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e61beb2e9d96561e29adc76f37b9d6cd?s=128&d=identicon&r=PG", "display_name": "Hellagot", "link": "https://stackoverflow.com/users/920950/hellagot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 333, "favorite_count": 0, "accepted_answer_id": 55615769, "answer_count": 1, "score": 2, "last_activity_date": 1554908858, "creation_date": 1554879314, "last_edit_date": 1554908858, "question_id": 55606450, "link": "https://stackoverflow.com/questions/55606450/how-to-share-immutable-configuration-data-with-hyper-request-handlers", "title": "How to share immutable configuration data with hyper request handlers?", "body": "<p>I am trying to develop a hyper based server application in Rust. There is an INI file holding configuration like binding IP, database and so on. </p>\n\n<p>I don't want to parse the INI file on each request and it is OK to keep the configuration data until server restart. How can I give a struct of already parsed data to the request handler?</p>\n\n<p>I have tried several approaches like using <code>std::sync::Arc</code>, but the only thing working so far is to use a <code>static</code>, but I want to avoid <code>unsafe</code> blocks.</p>\n\n<p>Here is a complete (non working) example:</p>\n\n<p><strong>Cargo.toml</strong></p>\n\n<pre><code>[package]\nname = \"demo\"\nversion = \"0.1.0\"\nedition = \"2018\"\n\n[dependencies]\nhyper = \"0.12\"\nrust-ini = \"0.13\"\n</code></pre>\n\n<p><strong>demo.ini</strong></p>\n\n<pre><code>[Demo]\nvalue=\"some value\"\n</code></pre>\n\n<p><strong>src/main.rs</strong></p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern crate hyper;\nextern crate ini;\n\nuse hyper::rt::{self, Future};\nuse hyper::service::service_fn_ok;\nuse hyper::{Body, Request, Response, Server};\nuse ini::Ini;\nuse std::sync::Arc;\n\npub struct Config {\n    pub value: String,\n}\n\nfn request_handler(req: Request&lt;Body&gt;, config: &amp;Config) -&gt; Response&lt;Body&gt; {\n    let user_agent = req.headers()[\"user-agent\"].to_str().unwrap();\n    println!(\"user agent: {:?}\", &amp;user_agent);\n    println!(\"config value: {:?}\", &amp;config.value);\n    Response::new(Body::from(\"\"))\n}\n\nfn read_ini(config_file: &amp;str) -&gt; Arc&lt;Config&gt; {\n    match Ini::load_from_file(config_file) {\n        Ok(c) =&gt; {\n            let demo_section = c.section(Some(\"Demo\".to_owned())).unwrap();\n            let value = match demo_section.get(\"value\") {\n                Some(v) =&gt; v,\n                None =&gt; {\n                    println!(\"Error reading ini\");\n                    std::process::exit(-1)\n                }\n            };\n\n            Arc::&lt;Config&gt;::new(Config {\n                value: value.to_string(),\n            })\n        }\n        _ =&gt; {\n            eprintln!(\"CRITICAL: Could not open config file: {:?}\", &amp;config_file);\n            std::process::exit(-1)\n        }\n    }\n}\n\nfn main() {\n    let cfg = read_ini(\"demo.ini\");\n    let addr = \"127.0.0.1:3000\".parse().unwrap();\n\n    let server = Server::bind(&amp;addr)\n        .serve(|| service_fn_ok(move |req: Request&lt;Body&gt;| request_handler(req, &amp;cfg.clone())))\n        .map_err(|e| println!(\"server error: {}\", e));\n\n    rt::run(server);\n}\n</code></pre>\n\n<p><strong>Error</strong></p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0525]: expected a closure that implements the `Fn` trait, but this closure only implements `FnOnce`\n  --&gt; src/main.rs:49:16\n   |\n49 |         .serve(|| service_fn_ok(move |req: Request&lt;Body&gt;| request_handler(req, &amp;cfg.clone())))\n   |                ^^^^^^^^^^^^^^^^^-------------------------^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n   |                |                |\n   |                |                closure is `FnOnce` because it moves the variable `cfg` out of its environment\n   |                this closure implements `FnOnce`, not `Fn`\n</code></pre>\n"}, {"tags": ["compiler-errors", "installation", "rust", "linker-errors", "build-tools"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 3, "creation_date": 1554884696, "post_id": 55603111, "comment_id": 97910494, "body": "The error message says exactly what to do: <i>&quot;note: please ensure that VS 2013, VS 2015 or VS 2017 was installed with the Visual C++ option&quot;</i>"}, {"owner": {"reputation": 2361, "user_id": 10736243, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iYzRZ.jpg?s=128&g=1", "display_name": "Zobia Kanwal", "link": "https://stackoverflow.com/users/10736243/zobia-kanwal"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 5, "creation_date": 1554902111, "post_id": 55603111, "comment_id": 97920933, "body": "Yes, thought it could be useful to others, hence shared the question with its answer."}], "answers": [{"comments": [{"owner": {"reputation": 1970, "user_id": 495673, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e3f66c16ebe27cb83f495d4998f162d1?s=128&d=identicon&r=PG&f=1", "display_name": "argenkiwi", "link": "https://stackoverflow.com/users/495673/argenkiwi"}, "edited": false, "score": 5, "creation_date": 1589572080, "post_id": 55603112, "comment_id": 109357682, "body": "Do we need to leave all of the default check-boxes checked? Otherwise, what would be the minimum set of dependencies we could install to get Rust to work?"}, {"owner": {"reputation": 1396, "user_id": 6405655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BXqIm.jpg?s=128&g=1", "display_name": "Al Fahad", "link": "https://stackoverflow.com/users/6405655/al-fahad"}, "edited": false, "score": 1, "creation_date": 1593056381, "post_id": 55603112, "comment_id": 110647317, "body": "Thank you very much."}, {"owner": {"reputation": 1809, "user_id": 881180, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/vmrL9.jpg?s=128&g=1", "display_name": "Fasani", "link": "https://stackoverflow.com/users/881180/fasani"}, "reply_to_user": {"reputation": 1970, "user_id": 495673, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e3f66c16ebe27cb83f495d4998f162d1?s=128&d=identicon&r=PG&f=1", "display_name": "argenkiwi", "link": "https://stackoverflow.com/users/495673/argenkiwi"}, "edited": false, "score": 5, "creation_date": 1593561359, "post_id": 55603112, "comment_id": 110823477, "body": "@argenkiwi I was able to make it work with just &quot;MSVC v142 - VS 2019 C++ x64/x86 build tools&quot; and &quot;Windows 10 SDK&quot;."}, {"owner": {"reputation": 167, "user_id": 8237236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a93622bf74d5c503ef17cd06839f576?s=128&d=identicon&r=PG&f=1", "display_name": "lousycoder", "link": "https://stackoverflow.com/users/8237236/lousycoder"}, "edited": false, "score": 0, "creation_date": 1595612911, "post_id": 55603112, "comment_id": 111545720, "body": "Isn&#39;t there any other alternative?"}, {"owner": {"reputation": 3250, "user_id": 1259779, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6d554eab34f0b9d148747d9913b9244d?s=128&d=identicon&r=PG", "display_name": "derekdreery", "link": "https://stackoverflow.com/users/1259779/derekdreery"}, "edited": false, "score": 0, "creation_date": 1605458017, "post_id": 55603112, "comment_id": 114649996, "body": "I experimented with just the C++ build tools and it didn&#39;t work - you need the Windows 10 SDK as well."}], "tags": [], "owner": {"reputation": 2361, "user_id": 10736243, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iYzRZ.jpg?s=128&g=1", "display_name": "Zobia Kanwal", "link": "https://stackoverflow.com/users/10736243/zobia-kanwal"}, "is_accepted": true, "score": 74, "last_activity_date": 1555407222, "last_edit_date": 1555407222, "creation_date": 1554856485, "answer_id": 55603112, "question_id": 55603111, "link": "https://stackoverflow.com/questions/55603111/unable-to-compile-rust-hello-world-on-windows-linker-link-exe-not-found/55603112#55603112", "title": "Unable to compile Rust hello world on Windows: linker link.exe not found", "body": "<p>I downloaded and installed the <a href=\"https://visualstudio.microsoft.com/thank-you-downloading-visual-studio/?sku=BuildTools&amp;rel=16\" rel=\"noreferrer\">Build Tools for Visual Studio 2019</a>. During installation I selected the <strong>C++ tools</strong>. It downloaded almost 5GB of data. I restarted the machine after installation and compiling the code worked fine:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>&gt; cargo run\nCompiling helloworld v0.1.0 (C:\\Users\\DELL\\helloworld)\nFinished dev [unoptimized + debuginfo] target(s) in 12.05s\n  Running `target\\debug\\helloworld.exe`\nHello, world!\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 683, "user_id": 12816539, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-LGJD0-r-tz8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reGKI-Oxhlq0oSaL2w3ZQJQs2PI5w/photo.jpg?sz=128", "display_name": "passing_through", "link": "https://stackoverflow.com/users/12816539/passing-through"}, "edited": false, "score": 0, "creation_date": 1591949474, "post_id": 58870127, "comment_id": 110253981, "body": "Thanks a lot! <code>cargo run</code> from the command line (instead of Command Prompt for VS) helped in my case."}], "tags": [], "owner": {"reputation": 41, "user_id": 12376353, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mCbYT4co2JxFY0jUs1LeLjcaW66LOh9uoJD3aaaTQ=k-s128", "display_name": "Late Nighter", "link": "https://stackoverflow.com/users/12376353/late-nighter"}, "is_accepted": false, "score": 2, "last_activity_date": 1573790281, "creation_date": 1573790281, "answer_id": 58870127, "question_id": 55603111, "link": "https://stackoverflow.com/questions/55603111/unable-to-compile-rust-hello-world-on-windows-linker-link-exe-not-found/58870127#58870127", "title": "Unable to compile Rust hello world on Windows: linker link.exe not found", "body": "<p>I had the same issue and found it to be present even after installing the Build Tools. What I realized almost by accident that I was running all my cargo commands in \"Developer Command Prompt for Visual Studio \". Running the same commands in a simple cmd shell ran without any issues.</p>\n\n<p><strong>What worked for me</strong>: Running the command prompt directly and not use the shortcuts created by Visual Studio.</p>\n\n<p><strong>Possible Cause</strong>: Visual Studio Command Prompt runs bat files e.g. VsDevCmd.bat before it starts the shell (to load VS related environment variables, etc.) and possibly one of the commands in that file screws up the path cargo uses to get to linker.</p>\n\n<p>Someone could dig further to find the exact line that causes the issue if they really want to know.</p>\n"}, {"tags": [], "owner": {"reputation": 34, "user_id": 10244405, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ogWBU.jpg?s=128&g=1", "display_name": "Fausto Carias", "link": "https://stackoverflow.com/users/10244405/fausto-carias"}, "is_accepted": false, "score": 0, "last_activity_date": 1589773262, "creation_date": 1589773262, "answer_id": 61862088, "question_id": 55603111, "link": "https://stackoverflow.com/questions/55603111/unable-to-compile-rust-hello-world-on-windows-linker-link-exe-not-found/61862088#61862088", "title": "Unable to compile Rust hello world on Windows: linker link.exe not found", "body": "<p>Try using Powershell outside Visual Studio, instead.</p>\n\n<p>Then cargo run in src's parent folder. </p>\n\n<p>You can try also: rustc  </p>\n\n<p>Good luck. </p>\n"}, {"comments": [{"owner": {"reputation": 165, "user_id": 10629172, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-JDsRXv21CnY/AAAAAAAAAAI/AAAAAAAAACQ/56X_PVUDnQA/photo.jpg?sz=128", "display_name": "Anurag Hazra", "link": "https://stackoverflow.com/users/10629172/anurag-hazra"}, "edited": false, "score": 0, "creation_date": 1596267917, "post_id": 62817909, "comment_id": 111762705, "body": "This worked for me Thank you very much, i did not had to download 1.2GB of stuff."}, {"owner": {"reputation": 131, "user_id": 13899461, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8CO78.jpg?s=128&g=1", "display_name": "ocanis", "link": "https://stackoverflow.com/users/13899461/ocanis"}, "reply_to_user": {"reputation": 165, "user_id": 10629172, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-JDsRXv21CnY/AAAAAAAAAAI/AAAAAAAAACQ/56X_PVUDnQA/photo.jpg?sz=128", "display_name": "Anurag Hazra", "link": "https://stackoverflow.com/users/10629172/anurag-hazra"}, "edited": false, "score": 0, "creation_date": 1596362531, "post_id": 62817909, "comment_id": 111782398, "body": "Sure! I am happy to help."}, {"owner": {"reputation": 5171, "user_id": 1892607, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QrFP5.jpg?s=128&g=1", "display_name": "dkellner", "link": "https://stackoverflow.com/users/1892607/dkellner"}, "edited": false, "score": 1, "creation_date": 1609186500, "post_id": 62817909, "comment_id": 115772273, "body": "Why the huge font, tho?"}, {"owner": {"reputation": 131, "user_id": 13899461, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8CO78.jpg?s=128&g=1", "display_name": "ocanis", "link": "https://stackoverflow.com/users/13899461/ocanis"}, "reply_to_user": {"reputation": 5171, "user_id": 1892607, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QrFP5.jpg?s=128&g=1", "display_name": "dkellner", "link": "https://stackoverflow.com/users/1892607/dkellner"}, "edited": false, "score": 2, "creation_date": 1609249119, "post_id": 62817909, "comment_id": 115788821, "body": "@dkellner Maybe I didn&#39;t have my glasses when I wrote it, bro!"}], "tags": [], "owner": {"reputation": 131, "user_id": 13899461, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8CO78.jpg?s=128&g=1", "display_name": "ocanis", "link": "https://stackoverflow.com/users/13899461/ocanis"}, "is_accepted": false, "score": 13, "last_activity_date": 1594307045, "creation_date": 1594307045, "answer_id": 62817909, "question_id": 55603111, "link": "https://stackoverflow.com/questions/55603111/unable-to-compile-rust-hello-world-on-windows-linker-link-exe-not-found/62817909#62817909", "title": "Unable to compile Rust hello world on Windows: linker link.exe not found", "body": "<h1>Case 1: Using C++ win compiler, to fix it you need to reinstall VS build tool C++</h1>\n<p>Download the Visual Studio 2019 Build tools from the Microsoft website:\n<a href=\"https://visualstudio.microsoft.com/thank-you-downloading-visual-studio/?sku=BuildTools&amp;rel=16\" rel=\"noreferrer\">https://visualstudio.microsoft.com/thank-you-downloading-visual-studio/?sku=BuildTools&amp;rel=16</a></p>\n<h3>After the download, while installing the Build tools, make sure that you install the required components:</h3>\n<ol>\n<li>C++ build tools</li>\n</ol>\n<h3>This will download required files. Once everything is successfully installed, reboot and re-run your rust program and it will compile successfully.</h3>\n<h1>Case2: This error can come from the fact that you use GCC to compile, to fix it (assume that you already have MinGW):</h1>\n<h3>Tape in cmd:</h3>\n<blockquote>\n<ol>\n<li><code>rustup uninstall toolchain stable-x86_64-pc-windows-msvc</code></li>\n<li><code>rustup toolchain install stable-x86_64-pc-windows-gnu</code>\n(or download rustup-init for the platform of your choice at <a href=\"https://forge.rust-lang.org/infra/other-installation-methods.html\" rel=\"noreferrer\">https://forge.rust-lang.org/infra/other-installation-methods.html</a>)</li>\n<li><code>rustup default stable-x86_64-pc-windows-gnu</code></li>\n</ol>\n</blockquote>\n<h1>Case 3: You don't want to download Visual studio with build tools, simply  install MinGw with g++ gcc development packages, then run CASE 2</h1>\n"}, {"comments": [{"owner": {"reputation": 1580, "user_id": 3029205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1437a0d109f14bddbf54ed1d57277fb0?s=128&d=identicon&r=PG", "display_name": "Luis Ayuso", "link": "https://stackoverflow.com/users/3029205/luis-ayuso"}, "edited": false, "score": 0, "creation_date": 1605287016, "post_id": 64121601, "comment_id": 114613211, "body": "This is not a solution but a work-around, It is important to consider that you change the toolchain when you do this and there are side effects."}], "tags": [], "owner": {"reputation": 201, "user_id": 8612106, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-TC5cSwWrGyU/AAAAAAAAAAI/AAAAAAAAATQ/Pj4ij0JTElE/photo.jpg?sz=128", "display_name": "the artist", "link": "https://stackoverflow.com/users/8612106/the-artist"}, "is_accepted": false, "score": 14, "last_activity_date": 1601428290, "last_edit_date": 1601428290, "creation_date": 1601389402, "answer_id": 64121601, "question_id": 55603111, "link": "https://stackoverflow.com/questions/55603111/unable-to-compile-rust-hello-world-on-windows-linker-link-exe-not-found/64121601#64121601", "title": "Unable to compile Rust hello world on Windows: linker link.exe not found", "body": "<p>I had a similar issue &quot;<code>error: linking with link.exe failed: exit code: 1</code>&quot;</p>\n<p>To solve it, I did</p>\n<pre class=\"lang-none prettyprint-override\"><code>rustup toolchain install stable-x86_64-pc-windows-gnu\n</code></pre>\n<p>then</p>\n<pre class=\"lang-none prettyprint-override\"><code>rustup default stable-x86_64-pc-windows-gnu\n</code></pre>\n<p>and</p>\n<pre class=\"lang-none prettyprint-override\"><code>cargo build\n  Compiling hello v0.1.0 (C:\\Users\\leke\\dev\\rust\\hello)\n    Finished dev [unoptimized + debuginfo] target(s) in 1.66s\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 14053, "user_id": 2189130, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/trlri.png?s=128&g=1", "display_name": "kmdreko", "link": "https://stackoverflow.com/users/2189130/kmdreko"}, "edited": false, "score": 0, "creation_date": 1616270423, "post_id": 66724310, "comment_id": 117951448, "body": "How is this answer different from the <a href=\"https://stackoverflow.com/a/55603112/2189130\">currently accepted answer</a>? The link is the same and the comments provide the minimal installation options required."}, {"owner": {"reputation": 31, "user_id": 15440362, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec9ebaed2948f996943c01777284f801?s=128&d=identicon&r=PG&f=1", "display_name": "filiphagan", "link": "https://stackoverflow.com/users/15440362/filiphagan"}, "reply_to_user": {"reputation": 14053, "user_id": 2189130, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/trlri.png?s=128&g=1", "display_name": "kmdreko", "link": "https://stackoverflow.com/users/2189130/kmdreko"}, "edited": false, "score": 0, "creation_date": 1616340410, "post_id": 66724310, "comment_id": 117965574, "body": "@kmdreko the answer is not solving the issue since other requirements like MSVC and Windows 10 SDK are not mentioned there"}], "tags": [], "owner": {"reputation": 31, "user_id": 15440362, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec9ebaed2948f996943c01777284f801?s=128&d=identicon&r=PG&f=1", "display_name": "filiphagan", "link": "https://stackoverflow.com/users/15440362/filiphagan"}, "is_accepted": false, "score": 3, "last_activity_date": 1616260039, "creation_date": 1616260039, "answer_id": 66724310, "question_id": 55603111, "link": "https://stackoverflow.com/questions/55603111/unable-to-compile-rust-hello-world-on-windows-linker-link-exe-not-found/66724310#66724310", "title": "Unable to compile Rust hello world on Windows: linker link.exe not found", "body": "<p>The error message is very unclear because there is no need to have Vistual Studio installed to run rust code. And what does &quot;Visual C++ option&quot; mean exactly?\n&quot;VS 2013, VS 2015 or VS 2017&quot; is also wrong - there's no need to install the full Visual Studio of these particular versions.</p>\n<p>To execute 'cargo run' you need to install <strong>C++ build tools</strong> from <strong>Build Tools for Visual Studio</strong>. Version 2019 is just fine. Download link:\n<a href=\"https://visualstudio.microsoft.com/thank-you-downloading-visual-studio/?sku=BuildTools&amp;rel=16#\" rel=\"nofollow noreferrer\">https://visualstudio.microsoft.com/thank-you-downloading-visual-studio/?sku=BuildTools&amp;rel=16#</a></p>\n<p>It's important to select not only the default 'included' C++ tools during the installation but also three <a href=\"https://i.stack.imgur.com/6ALCf.png\" rel=\"nofollow noreferrer\">'optional' C++ building tools</a>: MSVC(...), Windows 10 SDK, C++ CMake tools for Windows.</p>\n"}], "owner": {"reputation": 2361, "user_id": 10736243, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iYzRZ.jpg?s=128&g=1", "display_name": "Zobia Kanwal", "link": "https://stackoverflow.com/users/10736243/zobia-kanwal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36225, "favorite_count": 14, "accepted_answer_id": 55603112, "answer_count": 6, "score": 55, "last_activity_date": 1616260039, "creation_date": 1554856485, "last_edit_date": 1555206935, "question_id": 55603111, "link": "https://stackoverflow.com/questions/55603111/unable-to-compile-rust-hello-world-on-windows-linker-link-exe-not-found", "title": "Unable to compile Rust hello world on Windows: linker link.exe not found", "body": "<p>I have installed Rust on windows from <a href=\"https://www.rust-lang.org/tools/install\" rel=\"noreferrer\">Rust installation page</a>. After installation I tried running the \"hello world\" program but got the following error.</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>&gt;cargo run\n</code></pre>\n\n<p><strong>Error</strong></p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Compiling helloworld v0.1.0 (C:\\Users\\DELL\\helloworld)\n\nerror: linker `link.exe` not found\nnote: The system cannot find the file specified. (os error 2)\nnote: the msvc targets depend on the msvc linker but `link.exe` was not found\nnote: please ensure that VS 2013, VS 2015 or VS 2017 was installed with the Visual C++ option\nerror: aborting due to previous error\nerror: Could not compile `helloworld`.\n\nTo learn more, run the command again with --verbose.\n</code></pre>\n\n<p><strong>Code</strong>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn main() {\n    println!(\"Hello, world!\");\n}\n</code></pre>\n"}, {"tags": ["asynchronous", "rust", "core", "context-switching"], "comments": [{"owner": {"reputation": 1118, "user_id": 5385625, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/CKfR0.jpg?s=128&g=1", "display_name": "Sam Orozco", "link": "https://stackoverflow.com/users/5385625/sam-orozco"}, "edited": false, "score": 1, "creation_date": 1554853657, "post_id": 55602475, "comment_id": 97901200, "body": "Some simple ways to detect overload might be recording how long items have been in the queue, meaning they aren&#39;t being processed, or, you could put a limit on the number items that are allowed in a queue(which I don&#39;t like as much). It seems by the architecture you describe above you are going to need more &quot;Workers&quot; when core B becomes overloaded.  So it would ideal to be able to spin up more workers similar to B when you&#39;ve detected an overload and bring them down when you are under less load. I don&#39;t know the Rust specifics but that is how I would generally approach that problem. Cheers."}, {"owner": {"reputation": 375, "user_id": 11134001, "user_type": "registered", "profile_image": "https://graph.facebook.com/2130930103663266/picture?type=large", "display_name": "Thomas Braun", "link": "https://stackoverflow.com/users/11134001/thomas-braun"}, "reply_to_user": {"reputation": 1118, "user_id": 5385625, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/CKfR0.jpg?s=128&g=1", "display_name": "Sam Orozco", "link": "https://stackoverflow.com/users/5385625/sam-orozco"}, "edited": false, "score": 1, "creation_date": 1554857988, "post_id": 55602475, "comment_id": 97902096, "body": "Nice, yeah I could just wrap the packets with a timestamp, and for each packet that gets processed, check the delta-t values. If delta-t is increasing, then the number of cores can increase. Thanks Sam"}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 2, "creation_date": 1554904396, "post_id": 55602475, "comment_id": 97922427, "body": "I think this question is too broad. There may be many ways to detect overload/lag, not all of which apply in any given situation, and the second question is essentially unanswerable -- whether adding another core makes your program faster or slower depends not just on the workload but on how the program is designed to parallelize it, and even things like cache line size and threading model. If you&#39;re trying to optimize a real program, the best way to know is to measure it; if you&#39;re just looking for general tips/rules of thumb, I&#39;d suggest asking on users.rust-lang.org instead."}, {"owner": {"reputation": 375, "user_id": 11134001, "user_type": "registered", "profile_image": "https://graph.facebook.com/2130930103663266/picture?type=large", "display_name": "Thomas Braun", "link": "https://stackoverflow.com/users/11134001/thomas-braun"}, "reply_to_user": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1554984717, "post_id": 55602475, "comment_id": 97955446, "body": "@trentcl indeed. I knew it was, but my confusion of the subject at the time of posting was enveloped by the entire text. Sometimes the underlying concept implied by the entire idea is more important when asking a question than a very specific question."}], "owner": {"reputation": 375, "user_id": 11134001, "user_type": "registered", "profile_image": "https://graph.facebook.com/2130930103663266/picture?type=large", "display_name": "Thomas Braun", "link": "https://stackoverflow.com/users/11134001/thomas-braun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 121, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1554906166, "creation_date": 1554851017, "last_edit_date": 1554906166, "question_id": 55602475, "link": "https://stackoverflow.com/questions/55602475/how-many-asynchronous-cores-should-i-use", "title": "How many asynchronous cores should I use?", "body": "<p>In an ideal async program, every event loop is always occupied with zero downtime between receiving data and polling->action-execution. </p>\n\n<p>My program listens on an array of ports, and the polling and movement of data into a queue occurs on a single async-core (A). I then have another async-core (B) which takes the data from that queue and processes it. I then have another async core which runs background subroutines (C). All A, B, and C take place on different threads. </p>\n\n<p>Let's suppose there is a massive load of data streaming, and core B becomes overloaded with pending work (this would effectively mean \"lag\" for the end-user). What are the common ways to detect this overload, and should an overload be detected, should I use another async-core(D) joined with B?   </p>\n"}, {"tags": ["rust"], "answers": [{"tags": [], "owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "is_accepted": false, "score": 1, "last_activity_date": 1554849614, "creation_date": 1554849614, "answer_id": 55602296, "question_id": 55602134, "link": "https://stackoverflow.com/questions/55602134/in-rust-how-do-i-pass-a-diverging-function-as-parameter-to-another-function/55602296#55602296", "title": "In Rust how do I pass a diverging function as parameter to another function", "body": "<p>To use unstable feature you need to use nightly toolchain and active the desired unstable feature.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#![feature(never_type)]\n\nfn test_diverging(f: &amp;Fn() -&gt; !) {}\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/27454761/7076153\">What is a crate attribute and where do I add it?</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "is_accepted": true, "score": 9, "last_activity_date": 1554903508, "last_edit_date": 1554903508, "creation_date": 1554849685, "answer_id": 55602308, "question_id": 55602134, "link": "https://stackoverflow.com/questions/55602134/in-rust-how-do-i-pass-a-diverging-function-as-parameter-to-another-function/55602308#55602308", "title": "In Rust how do I pass a diverging function as parameter to another function", "body": "<p><code>!</code> in some contexts is still experimental, which means it's not available on the stable compiler (1.33 as of today). You can use it on the nightly compiler, but you have to opt-in explicitly to <code>feature(never_type)</code>:</p>\n\n<pre><code>#![feature(never_type)]\nfn test_diverging(f: &amp;Fn() -&gt; !) {}\n</code></pre>\n\n<p>(<a href=\"https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=d289b15ec9df84f54e0a3c065bfd7aca\" rel=\"noreferrer\">playground</a>)</p>\n\n<p>Be aware this means the feature may yet change before stabilization, so you're accepting the risk that a future compiler version will break your code.</p>\n\n<h2>See also</h2>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/27454761/what-is-a-crate-attribute-and-where-do-i-add-it\">What is a crate attribute and where do I add it?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/49673121/what-is-the-stabilization-process/49673122#49673122\">What is the stabilization process?</a></li>\n<li>How to use nightly: <a href=\"https://stackoverflow.com/questions/22758779/is-it-possible-to-have-multiple-coexisting-rust-installations\">Is it possible to have multiple coexisting Rust installations?</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 838, "user_id": 3613212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NfaGR.png?s=128&g=1", "display_name": "Gr&#233;gory OBANOS", "link": "https://stackoverflow.com/users/3613212/gr%c3%a9gory-obanos"}, "is_accepted": false, "score": 2, "last_activity_date": 1554876077, "creation_date": 1554876077, "answer_id": 55605673, "question_id": 55602134, "link": "https://stackoverflow.com/questions/55602134/in-rust-how-do-i-pass-a-diverging-function-as-parameter-to-another-function/55605673#55605673", "title": "In Rust how do I pass a diverging function as parameter to another function", "body": "<p>If you want to stay on stable, you can use <a href=\"https://crates.io/crates/void\" rel=\"nofollow noreferrer\">Void</a> (basically an enum with no variants, which can't be constructed without unsafe) as a workaround.</p>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=99d4f315ecf7a7722bb4ff6b6c40da4d\" rel=\"nofollow noreferrer\">Playground link</a></p>\n"}, {"tags": [], "owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "is_accepted": false, "score": 6, "last_activity_date": 1554881731, "creation_date": 1554881731, "answer_id": 55607119, "question_id": 55602134, "link": "https://stackoverflow.com/questions/55602134/in-rust-how-do-i-pass-a-diverging-function-as-parameter-to-another-function/55607119#55607119", "title": "In Rust how do I pass a diverging function as parameter to another function", "body": "<p>Using the never type in functions and function pointer types is already stable. So if you don't need to use the <code>Fn</code> trait, you can just use this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn test_diverging(f: fn() -&gt; !) {}\n//                   ^ note the lowercase f\n\ntest_diverging(|| panic!(\"ouch\"));\n</code></pre>\n\n<p>That way you can't pass closures that reference their environment, but non-capturing closures and standard functions work fine.</p>\n"}], "owner": {"reputation": 714, "user_id": 39431, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9017f8af999ec51ae7fe6d7b5b5fc213?s=128&d=identicon&r=PG", "display_name": "joegtp", "link": "https://stackoverflow.com/users/39431/joegtp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 55602308, "answer_count": 4, "score": 2, "last_activity_date": 1554903508, "creation_date": 1554848481, "last_edit_date": 1554874096, "question_id": 55602134, "link": "https://stackoverflow.com/questions/55602134/in-rust-how-do-i-pass-a-diverging-function-as-parameter-to-another-function", "title": "In Rust how do I pass a diverging function as parameter to another function", "body": "<p>Non-diverging functions work fine</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn test(f: &amp;Fn() -&gt; u8) {}\n</code></pre>\n\n<p>But I can't accept a diverging function like this</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn test_diverging(f: &amp;Fn() -&gt; !) {}\n</code></pre>\n\n<p>I get the following error</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0658]: The `!` type is experimental (see issue #35121)\n  --&gt; examples/two_tasks.rs:44:31\n   |\n44 | fn test_diverging(f: &amp;Fn() -&gt; !) {}\n   |                               ^\n\n</code></pre>\n\n<p>Looking at <a href=\"https://github.com/rust-lang/rust/issues/35121\" rel=\"nofollow noreferrer\">issue #35121</a> I could see how that might fix it but in the mean time is there a work around?</p>\n"}, {"tags": ["csv", "rust", "serde"], "comments": [{"owner": {"reputation": 7992, "user_id": 2694444, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lQntl.jpg?s=128&g=1", "display_name": "galop1n", "link": "https://stackoverflow.com/users/2694444/galop1n"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554849503, "post_id": 55602087, "comment_id": 97900319, "body": "@Stargateur I added a rust playground to demonstrate the problem i have. This is exactly what you understood. the csv content is the same, but the &quot;field3&quot; column header is missing."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554849676, "post_id": 55602087, "comment_id": 97900366, "body": "Is this really valid csv so ?"}, {"owner": {"reputation": 7992, "user_id": 2694444, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lQntl.jpg?s=128&g=1", "display_name": "galop1n", "link": "https://stackoverflow.com/users/2694444/galop1n"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554850017, "post_id": 55602087, "comment_id": 97900452, "body": "@Stargateur That&#39;s not the question, i have to support the case, it is not possible to go patch older revisions of the files in the source control. Thanks for inlining the code snippet tho."}], "answers": [{"comments": [{"owner": {"reputation": 7992, "user_id": 2694444, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lQntl.jpg?s=128&g=1", "display_name": "galop1n", "link": "https://stackoverflow.com/users/2694444/galop1n"}, "edited": false, "score": 0, "creation_date": 1554851874, "post_id": 55602530, "comment_id": 97900799, "body": "Works for me, i found i could also just <code>has_headers(false)</code> and skip the header row before passing it to the reader."}, {"owner": {"reputation": 10100, "user_id": 619216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c07104de771c3b6f6c30be8f592ef8f7?s=128&d=identicon&r=PG", "display_name": "BurntSushi5", "link": "https://stackoverflow.com/users/619216/burntsushi5"}, "reply_to_user": {"reputation": 7992, "user_id": 2694444, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lQntl.jpg?s=128&g=1", "display_name": "galop1n", "link": "https://stackoverflow.com/users/2694444/galop1n"}, "edited": false, "score": 3, "creation_date": 1554855465, "post_id": 55602530, "comment_id": 97901591, "body": "@galop1n That works too, but note that your struct will then be deserialized based purely on the order of the fields, and not by the names in the header. (Which might be okay for your use case!)"}], "tags": [], "owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "is_accepted": true, "score": 3, "last_activity_date": 1554851412, "creation_date": 1554851412, "answer_id": 55602530, "question_id": 55602087, "link": "https://stackoverflow.com/questions/55602087/deserializing-a-csv-with-serde-when-the-header-row-may-not-have-the-last-column/55602530#55602530", "title": "Deserializing a CSV with Serde when the header row may not have the last column name in it", "body": "<p>Add the field header by the hand before read rows should do it, using <a href=\"https://docs.rs/csv/1.0.6/csv/struct.Reader.html#method.headers\" rel=\"nofollow noreferrer\"><code>headers()</code></a> and <a href=\"https://docs.rs/csv/1.0.6/csv/struct.Reader.html#method.set_headers\" rel=\"nofollow noreferrer\"><code>set_headers()</code></a>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let rdr = reader.headers().unwrap();\nif let None = rdr.get(2) {\n    let mut rdr = rdr.clone();\n    rdr.push_field(\"field3\");\n    reader.set_headers(rdr);\n}\n</code></pre>\n\n<p>However, that quick and dirty.</p>\n"}], "owner": {"reputation": 7992, "user_id": 2694444, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lQntl.jpg?s=128&g=1", "display_name": "galop1n", "link": "https://stackoverflow.com/users/2694444/galop1n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 803, "favorite_count": 0, "accepted_answer_id": 55602530, "answer_count": 1, "score": 4, "last_activity_date": 1554851412, "creation_date": 1554848143, "last_edit_date": 1554849754, "question_id": 55602087, "link": "https://stackoverflow.com/questions/55602087/deserializing-a-csv-with-serde-when-the-header-row-may-not-have-the-last-column", "title": "Deserializing a CSV with Serde when the header row may not have the last column name in it", "body": "<p>I am using the <code>csv</code> and <code>serde</code> crates to deserialize csv files. The thing is that the last field is actually a comma separated list.</p>\n\n<pre><code>field1,field2,field3\nxx, xx, str1, ..., strN\nxx, xx,\nxx, xx, str1, ..., strM\n</code></pre>\n\n<p>And this is how it maps in Rust, reading it with <code>.flexible(true)</code> on the reader:</p>\n\n<pre><code>#[derive(Debug, Deserialize)]\nstruct Row {\n  field1: isize,\n  field2: isize,\n  field3: Vec&lt;String&gt;,\n}\n</code></pre>\n\n<p>Everything works fine if the CSV has the <code>,field3</code> the header row. But some of the files does not have it, and i can't find a solution to have serde still fill the <code>Vec</code>. All I was able to do is <code>#[serde(default)]</code> that just let <code>field3</code> empty.</p>\n\n<p>Here a rust <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=8e6fa29c5762bcc807f5a4ab9b22a189\" rel=\"nofollow noreferrer\">playground</a> showing the problem: </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern crate csv;\n#[macro_use]\nextern crate serde_derive;\n\n#[derive(Debug, Deserialize)]\nstruct Row {\n    field1: String,\n    field2: String,\n    #[serde(default)]\n    field3: Vec&lt;String&gt;,\n}\n\nfn test(str: String) {\n    let mut reader = csv::ReaderBuilder::new()\n        .flexible(true)\n        .from_reader(str.as_bytes());\n\n    for row in reader.deserialize() {\n        if let Ok(row) = row {\n            let row: Row = row;\n            println!(\"{:?}\", row);\n        }\n    }\n}\n\nfn main() {\n    let csv_data = \"\nfield1,field2,field3\nxx,yy,one,two,three\nzz,ww,\naa,bb\ncc,dd,foo,bar,ban\n\";\n    println!(\"With full header\");\n    test(csv_data.to_string());\n\n    let csv_alt_data = \"\nfield1,field2\nxx,yy,one,two,three\nzz,ww,\naa,bb\ncc,dd,foo,bar,ban\n\";\n    println!(\"With incomplet header\");\n    test(csv_alt_data.to_string());\n}\n</code></pre>\n"}, {"tags": ["error-handling", "rust"], "comments": [{"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "edited": false, "score": 0, "creation_date": 1554843796, "post_id": 55601159, "comment_id": 97898446, "body": "Not really familiar with the library, but you may need to downcast the contained error, <a href=\"https://docs.rs/failure/0.1.5/failure/struct.Error.html#method.downcast\" rel=\"nofollow noreferrer\">this</a> seems to be the method for that."}, {"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "edited": false, "score": 1, "creation_date": 1554845026, "post_id": 55601159, "comment_id": 97898934, "body": "Unfortunately, there seems to be no <code>failure</code> on the playground, but <a href=\"https://play.integer32.com/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=27b1c1d144efd4dfed5b6c72c0a9a8d2\" rel=\"nofollow noreferrer\">this</a> compiles locally. (not the best way to do this, though)"}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 2, "creation_date": 1554907202, "post_id": 55602524, "comment_id": 97924143, "body": "<i>Don&#39;t put your errors into <code>failure::Error</code>, put them in a custom enum as variants.</i> \u2014 This is actually a big point of my <a href=\"https://crates.io/crates/snafu\" rel=\"nofollow noreferrer\">SNAFU crate</a>, which enhances standard Rust enums for error handling."}], "tags": [], "owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "is_accepted": true, "score": 2, "last_activity_date": 1554926842, "last_edit_date": 1554926842, "creation_date": 1554851358, "answer_id": 55602524, "question_id": 55601159, "link": "https://stackoverflow.com/questions/55601159/how-to-match-custom-fails-with-the-failure-crate/55602524#55602524", "title": "How to match custom Fails with the failure crate", "body": "<h1>You need to downcast the <code>Error</code></h1>\n\n<p>When you create a <code>failure::Error</code> from some type that implements the <code>Fail</code> trait (via <code>from</code> or <code>into</code>, as you do), you temporarily hide the information about the type you're wrapping from the compiler. It doesn't know that <code>Error</code> is a <code>Badness</code> - because it can also be any other <code>Fail</code> type, that's the point. You need to remind the compiler of this, the action is called downcasting. The <code>failure::Error</code> has three methods for this: <code>downcast</code>, <code>downcast_ref</code> and <code>downcast_mut</code>. After you've downcast it, you can pattern match on the result as normal - but you need to take into account the possibility that downcasting itself may fail (if you try to downcast to a wrong type).</p>\n\n<p>Here's how it'd look with <code>downcast</code>:</p>\n\n<pre><code>pub fn get_badness() {\n    if let Err(wrapped_error) = do_badly() {\n        if let Ok(bad) = wrapped_error.downcast::&lt;Badness&gt;() {\n            panic!(\"{:?} badness!\", bad);\n        }\n    }\n}\n</code></pre>\n\n<p>(two <code>if let</code>s can be combined in this case).</p>\n\n<p>This quickly gets very unpleasant if more than one error type needs to be tested, since <code>downcast</code> consumes the <code>failure::Error</code> it was called on (so you can't try another <code>downcast</code> on the same variable if the first one fails). I sadly couldn't figure out an elegant way to do this. Here's a variant one shouldn't really use (<code>panic!</code> in <code>map</code> is questionable, and doing anything else there would be plenty awkward, and I don't even want to think about more cases than two):</p>\n\n<pre><code>#[derive(Debug, Fail)]\npub enum JustSoSo {\n    #[fail(display = \"meh\")]\n    Average,\n}\n\npub fn get_badness() {\n    if let Err(wrapped_error) = do_badly() {\n        let e = wrapped_error.downcast::&lt;Badness&gt;()\n            .map(|bad| panic!(\"{:?} badness!\", bad))\n            .or_else(|original| original.downcast::&lt;JustSoSo&gt;());\n        if let Ok(so) = e {\n            println!(\"{}\", so);\n        }\n    }\n}\n</code></pre>\n\n<p><code>or_else</code> chain should work OK if you actually want to produce some value of the same type from all of the possible\\relevant errors. Consider also using non-consuming methods if a reference to the original error is fine for you, as this would allow you to just make a series of <code>if let</code> blocks , one for each <code>downcast</code> attempt.</p>\n\n<h1>An alternative</h1>\n\n<p>Don't put your errors into <code>failure::Error</code>, put them in a custom enum as variants. It's more boilerplate, but you get painless pattern matching, which the compiler also will be able to check for sanity. If you choose to do this, I'd recommend <code>derive_more</code> crate which is capable of deriving <code>From</code> for such enums; <code>snafu</code> looks very interesting as well, but I have yet to try it. In its most basic form this approach looks like this:</p>\n\n<pre><code>pub enum SomeError {\n    Bad(Badness),\n    NotTooBad(JustSoSo),\n}\n\npub fn do_badly_alt() -&gt; Result&lt;(), SomeError&gt; {\n    Err(SomeError::Bad(Badness::Level(\"much\".to_owned())))\n}\n\npub fn get_badness_alt() {\n    if let Err(wrapper) = do_badly_alt() {\n        match wrapper {\n            SomeError::Bad(bad) =&gt; panic!(\"{:?} badness!\", bad),\n            SomeError::NotTooBad(so) =&gt; println!(\"{}\", so),\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 2012, "user_id": 205674, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/32a2b57f8035456fd763cbb2610c8f58?s=128&d=identicon&r=PG", "display_name": "Bittrance", "link": "https://stackoverflow.com/users/205674/bittrance"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 301, "favorite_count": 0, "accepted_answer_id": 55602524, "answer_count": 1, "score": 0, "last_activity_date": 1554926842, "creation_date": 1554843074, "question_id": 55601159, "link": "https://stackoverflow.com/questions/55601159/how-to-match-custom-fails-with-the-failure-crate", "title": "How to match custom Fails with the failure crate", "body": "<p>I'm trying to understand how to use the <a href=\"https://docs.rs/crate/failure/0.1.5\" rel=\"nofollow noreferrer\">failure</a> crate. It works splendidly as a unification of different types of standard errors, but when creating custom errors (<code>Fails</code>), I do not understand how to match for custom errors. For example:</p>\n\n<pre><code>use failure::{Fail, Error};\n\n#[derive(Debug, Fail)]\npub enum Badness {\n  #[fail(display = \"Ze badness\")]\n  Level(String)\n}\n\npub fn do_badly() -&gt; Result&lt;(), Error&gt; {\n  Err(Badness::Level(\"much\".to_owned()).into())\n}\n\n#[test]\npub fn get_badness() {\n  match do_badly() {\n    Err(Badness::Level(level)) =&gt; panic!(\"{:?} badness!\", level),\n    _ =&gt; (),\n  };\n}\n</code></pre>\n\n<p>fails with</p>\n\n<pre><code>error[E0308]: mismatched types\n  --&gt; barsa-nagios-forwarder/src/main.rs:74:9\n   |\n73 |   match do_badly() {\n   |         ---------- this match expression has type `failure::Error`\n74 |     Err(Badness::Level(level)) =&gt; panic!(\"{:?} badness!\", level),\n   |         ^^^^^^^^^^^^^^^^^^^^^ expected struct `failure::Error`, found enum `Badness`\n   |\n   = note: expected type `failure::Error`\n              found type `Badness`\n</code></pre>\n\n<p>How can I formulate a pattern which matches a specific custom error?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1554820843, "post_id": 55595257, "comment_id": 97887398, "body": "iter over keys, then use the duplicate"}], "answers": [{"tags": [], "owner": {"reputation": 1540, "user_id": 2606171, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F4ncy.png?s=128&g=1", "display_name": "belst", "link": "https://stackoverflow.com/users/2606171/belst"}, "is_accepted": true, "score": 3, "last_activity_date": 1554906898, "last_edit_date": 1554906898, "creation_date": 1554821076, "answer_id": 55595508, "question_id": 55595257, "link": "https://stackoverflow.com/questions/55595257/creating-a-string-joining-the-keys-of-a-hashmap-in-rust/55595508#55595508", "title": "creating a string joining the keys of a hashmap in rust", "body": "<p>In Rust, <code>HashMap</code>s are not ordered, so the actual order of the keys in the <code>String</code> will be undefined.</p>\n\n<p>If that is not a problem, you could do it like this:</p>\n\n<pre><code>use std::collections::HashMap;\n\nlet mut hm = HashMap::new();\n\nhm.insert(\"a\", ());\nhm.insert(\"b\", ());\nhm.insert(\"c\", ());\nhm.insert(\"d\", ());\nhm.insert(\"e\", ());\n\nlet s = hm.keys().map(|s| &amp;**s).collect::&lt;Vec&lt;_&gt;&gt;().join(\", \");\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=609816993c20b5e9b9c1dcb352fe3de1\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}], "owner": {"reputation": 23, "user_id": 3764766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81228ec8db8a53be47c935e7dd845390?s=128&d=identicon&r=PG&f=1", "display_name": "kabikaj", "link": "https://stackoverflow.com/users/3764766/kabikaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 553, "favorite_count": 0, "closed_date": 1554906873, "accepted_answer_id": 55595508, "answer_count": 1, "score": 1, "last_activity_date": 1554906898, "creation_date": 1554820258, "question_id": 55595257, "link": "https://stackoverflow.com/questions/55595257/creating-a-string-joining-the-keys-of-a-hashmap-in-rust", "closed_reason": "Duplicate", "title": "creating a string joining the keys of a hashmap in rust", "body": "<p>How can a create a string joining all keys of a hashmap in rust and adding a separator among each of them? I am very new to rust.</p>\n\n<p>In python it would be something like this:</p>\n\n<p><code>&gt;&gt;&gt; ', '.join({'a':'x', 'b':'y'}.keys())\n'a, b'</code></p>\n"}, {"tags": ["pointers", "rust", "pointer-arithmetic"], "comments": [{"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 1, "creation_date": 1554813063, "post_id": 55592789, "comment_id": 97882299, "body": "The question is rather vague. If you just want to iterate over an array, then you should use <code>for reference_to_u32 in buf.iter()</code>, and you should only use unsafe code if you have a reason to do so. There is an infinite number of reasons <i>why</i> you might want to use pointer arithmetic, and in some cases using <code>pointer.offset()</code> is the right tool, but without any more specific information we can&#39;t really answer this question."}, {"owner": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "edited": false, "score": 1, "creation_date": 1554813398, "post_id": 55592789, "comment_id": 97882485, "body": "If you do not have a good and specific reason to work with pointer arithmetics, I suggest writing more idiomatic code instead of an OP. <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=5558825229e16e7c046261ca60631c53\" rel=\"nofollow noreferrer\">Playground</a> . If you wish to work with pointer arithmetics, Then it is only guaranteed by developer itself, this is considered as unsafe and that is why you need to write it in unsafe block"}, {"owner": {"reputation": 2959, "user_id": 5903309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/665cdb14fb46d20c11a176c92e6ed663?s=128&d=identicon&r=PG", "display_name": "Jan Nils Ferner", "link": "https://stackoverflow.com/users/5903309/jan-nils-ferner"}, "edited": false, "score": 2, "creation_date": 1554820680, "post_id": 55592789, "comment_id": 97887294, "body": "TL;DR: Just don&#39;t."}], "answers": [{"tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": false, "score": 7, "last_activity_date": 1554813403, "creation_date": 1554813403, "answer_id": 55593056, "question_id": 55592789, "link": "https://stackoverflow.com/questions/55592789/if-i-want-to-code-in-rust-securely-should-i-code-without-using-pointer-arithmet/55593056#55593056", "title": "If I want to code in Rust securely, should I code without using pointer arithmetic?", "body": "<p>Using raw pointers like that is very unlikely<sup>[1]</sup> to be faster than an idiomatic <code>for</code> loop over an iterator:</p>\n\n<pre><code>fn main() {\n    let buf: [u32; 5] = [1, 2, 3, 4, 5];\n    for val in buf.iter() {\n        println!(\"Address {:?} | Value {}\", val as *const u32, val);\n    }\n}\n</code></pre>\n\n<p>This is also <em>much</em> easier to read and doesn't introduce memory unsafety risks.</p>\n\n<hr>\n\n<p><sup>1</sup> In fact, your code compares two pointer values each iteration, so is likely to be much slower than the idiomatic <code>for</code> loop, which can often omit all bounds checks.</p>\n"}, {"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554907099, "post_id": 55593087, "comment_id": 97924085, "body": "<i>Then you should not use <code>unsafe</code></i> \u2014 while I agree with the general theme of this answer, saying to <b>never</b> use <code>unsafe</code> isn&#39;t the best. There are times where unsafe code is required (beyond the examples you gave). Writing <code>unsafe</code> code correctly is very hard and should be avoided as much as possible, certainly."}], "tags": [], "owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "is_accepted": true, "score": 9, "last_activity_date": 1554813489, "creation_date": 1554813489, "answer_id": 55593087, "question_id": 55592789, "link": "https://stackoverflow.com/questions/55592789/if-i-want-to-code-in-rust-securely-should-i-code-without-using-pointer-arithmet/55593087#55593087", "title": "If I want to code in Rust securely, should I code without using pointer arithmetic?", "body": "<blockquote>\n  <p>If I want to code in Rust securely</p>\n</blockquote>\n\n<p>Then you should not use <code>unsafe</code>. There are a few legit reasons for <code>unsafe</code> (e.g. accessing memory locations that are known and safe to use, e.g. on microcontrollers several registers), but generally you should not use it.</p>\n\n<blockquote>\n  <p>should I code without using pointer arithmetic and just using the corresponding index of an array for example</p>\n</blockquote>\n\n<p>Yes. There is no reason (in this specific case) to use <code>unsafe</code> at all. Just use</p>\n\n<pre><code>for i in 0..buf.len() {\n    println!(\"Value {}\", buf[i]);\n}\n</code></pre>\n\n<p>This code however is not considered as \"rusty\", instead use a for-loop</p>\n\n<pre><code>for i in &amp;buf {\n    println!(\"Value {}\", i);\n}\n</code></pre>\n"}], "owner": {"reputation": 533, "user_id": 7839759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b65e869f62a18de42a40546eb4806f2?s=128&d=identicon&r=PG&f=1", "display_name": "Habebit", "link": "https://stackoverflow.com/users/7839759/habebit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 294, "favorite_count": 0, "accepted_answer_id": 55593087, "answer_count": 2, "score": 0, "last_activity_date": 1554906969, "creation_date": 1554812601, "last_edit_date": 1554906969, "question_id": 55592789, "link": "https://stackoverflow.com/questions/55592789/if-i-want-to-code-in-rust-securely-should-i-code-without-using-pointer-arithmet", "title": "If I want to code in Rust securely, should I code without using pointer arithmetic?", "body": "<p>I've read that pointer arithmetic in Rust can be done through the <code>pointer.offset()</code> function, but it always has to be implemented in <code>unsafe code</code>:</p>\n\n<pre><code>fn main() {\n    let buf: [u32; 5] = [1, 2, 3, 4, 5];\n    let mut ptr1: *const u32 = buf.as_ptr();\n    unsafe {\n        let ptr2: *const u32 = buf.as_ptr().offset(buf.len() as isize);\n        while ptr1 &lt; ptr2 {\n            println!(\"Address {:?} | Value {}\", ptr1, *ptr1);\n            ptr1 = ptr1.offset(1);\n        }\n    }\n}\n</code></pre>\n\n<p>If I want to code in Rust securely, should I code without using pointer arithmetic and just using the corresponding index of an array for example? Or is there any other way?</p>\n"}, {"tags": ["string", "vector", "rust", "slice"], "comments": [{"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 1, "creation_date": 1554807438, "post_id": 55589426, "comment_id": 97878950, "body": "The <code>b</code> inside the <code>map</code> function is neither a <code>char</code> or a <code>&amp;char</code> - it&#39;s a <code>&amp;[char]</code>, which doesn&#39;t have a <code>to_digit</code> method. With a long chain of methods like this, it&#39;s worth breaking down into parts, or adding explicit type annotations everywhere, to check that the types are what you expect."}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1554807795, "post_id": 55589426, "comment_id": 97879145, "body": "Your sentences are very hard to understand. Make them short and avoid jumping around &quot;in your brain&quot;. It&#39;s very hard for me to know what you actually want. Maybe you can rephase them?"}, {"owner": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "edited": false, "score": 0, "creation_date": 1554808207, "post_id": 55589426, "comment_id": 97879420, "body": "I did not understand what is your need from your sentences unfortunately. But you seem to get confused about windows and iterating over these slices. Maybe this code may help a little <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=da422a51f223ac64604a1ad2666a41f9\" rel=\"nofollow noreferrer\">Playground</a>"}, {"owner": {"reputation": 11, "user_id": 11236228, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/453beae87e46026e6aedc6c29d49f02f?s=128&d=identicon&r=PG&f=1", "display_name": "Deciak", "link": "https://stackoverflow.com/users/11236228/deciak"}, "edited": false, "score": 0, "creation_date": 1554809334, "post_id": 55589426, "comment_id": 97880103, "body": "Peter, specifically where should I put a type annotation to convert ``` &amp;[char]``` into <code>char</code> or ``` &amp;char```?"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1554809357, "post_id": 55589426, "comment_id": 97880117, "body": "But it doesn&#39;t make much sense. <code>b</code> is a <code>&amp;[char]</code>, e.g. <code>[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</code>. You can&#39;t call <code>to_digit</code> on that. You need a char for it. So you have to iterate over your window again. But then I ask myself why do you use <code>windows</code>?"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1554809801, "post_id": 55589426, "comment_id": 97880366, "body": "Something like <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=d8ac10eccca481c37390b7e0447102de\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a> ?"}], "answers": [{"tags": [], "owner": {"reputation": 4945, "user_id": 341510, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9162e8bca37c48433207c1fccfb3bba1?s=128&d=identicon&r=PG", "display_name": "chucksmash", "link": "https://stackoverflow.com/users/341510/chucksmash"}, "is_accepted": false, "score": 0, "last_activity_date": 1554829182, "creation_date": 1554829182, "answer_id": 55597818, "question_id": 55589426, "link": "https://stackoverflow.com/questions/55589426/is-there-a-way-to-dereference-a-slice-inside-mapping-an-iterator-over-a-bigger-s/55597818#55597818", "title": "Is there a way to dereference a slice inside mapping an iterator over a bigger slice?", "body": "<p>I think this is along the lines of what you're looking for. I've modified your example slightly by splitting the chained operation out into multiple statements and also by printing both the <code>window</code> and the product of the three integers in that window.</p>\n\n<pre><code>fn main() {\n    let a = \"12345678910111213141516171819\";\n    // create a vector of u32 from the str\n    // in \"real\" code you should handle the Result\n    // returned by `c.to_digit(10)` rather than\n    // just unwrapping\n    let nums = a\n        .chars()\n        .map(|c| c.to_digit(10).unwrap())\n        .collect::&lt;Vec&lt;u32&gt;&gt;();\n    // iterate over windows of size three\n    for window in nums.windows(3) {\n        // take the product of the current window\n        let product: u32 = window.iter().product();\n        println!(\"{:?}: {}\", window, product);\n    }\n}\n</code></pre>\n\n<p>And output:</p>\n\n<pre><code>$ cargo run\n[1, 2, 3]: 6\n[2, 3, 4]: 24\n[3, 4, 5]: 60\n[4, 5, 6]: 120\n[5, 6, 7]: 210\n[6, 7, 8]: 336\n[7, 8, 9]: 504\n[8, 9, 1]: 72\n[9, 1, 0]: 0\n[1, 0, 1]: 0\n[0, 1, 1]: 0\n[1, 1, 1]: 1\n[1, 1, 2]: 2\n[1, 2, 1]: 2\n[2, 1, 3]: 6\n[1, 3, 1]: 3\n[3, 1, 4]: 12\n[1, 4, 1]: 4\n[4, 1, 5]: 20\n[1, 5, 1]: 5\n[5, 1, 6]: 30\n[1, 6, 1]: 6\n[6, 1, 7]: 42\n[1, 7, 1]: 7\n[7, 1, 8]: 56\n[1, 8, 1]: 8\n[8, 1, 9]: 72\n</code></pre>\n\n<p>As the comments on the question mention, one of the issues you're dealing with here is you are not working with the types you think you are. When this happens to me, I'll usually introduce an intentional type error just to check the error message:</p>\n\n<pre><code>let nums: () = a\n    .chars()\n    .map(|c| c.to_digit(10).unwrap())\n    .collect::&lt;Vec&lt;u32&gt;&gt;();\n</code></pre>\n\n<p>which yields the error:</p>\n\n<pre><code>error[E0308]: mismatched types\n --&gt; src/main.rs:3:20\n  |\n3 |       let nums: () = a\n  |  ____________________^\n4 | |         .chars()\n5 | |         .map(|c| c.to_digit(10).unwrap())\n6 | |         .collect::&lt;Vec&lt;u32&gt;&gt;();\n  | |______________________________^ expected (), found struct `std::vec::Vec`\n  |\n  = note: expected type `()`\n             found type `std::vec::Vec&lt;u32&gt;`\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 11236228, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/453beae87e46026e6aedc6c29d49f02f?s=128&d=identicon&r=PG&f=1", "display_name": "Deciak", "link": "https://stackoverflow.com/users/11236228/deciak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 220, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1554829182, "creation_date": 1554802026, "last_edit_date": 1554807722, "question_id": 55589426, "link": "https://stackoverflow.com/questions/55589426/is-there-a-way-to-dereference-a-slice-inside-mapping-an-iterator-over-a-bigger-s", "title": "Is there a way to dereference a slice inside mapping an iterator over a bigger slice?", "body": "<p>I'm trying to use <code>windows()</code> to iterate over slices of a slice <code>Vec</code> (<code>windows</code> only works on slices), but I need to then take the <code>char</code> slice (<code>&amp;[char]</code>) and use a regular <code>char</code>. The problem is since the <code>char</code> slice points to a <code>Vec</code> slice, dereferencing doesn't work. How do I solve this?</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let a = \"12345678910111213141516171819\";\nlet vec1: &amp;str = &amp;a;\nprintln!(\n    \"{:?}\",\n    vec1.chars()\n        .collect::&lt;Vec&lt;char&gt;&gt;()\n        .windows(3)\n        .map(|b| b.to_digit(10).product())\n);\n</code></pre>\n\n<p>gives me the error</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0599]: no method named `to_digit` found for type `&amp;[char]` in the current scope\n --&gt; src/main.rs:9:24\n  |\n9 |             .map(|b| b.to_digit(10).product())\n  |                        ^^^^^^^^\n\nerror: aborting due to previous error\n</code></pre>\n\n<p>I'm trying to get <code>b</code> to convert to a regular char so <code>to_digit</code> can work with it, and then use <code>product</code> to find the whole windows product. I haven't experimented with <code>product</code> much, but that is for later. I've encountered a problem I don't know how to fix and it's more important to me how to convert slices of slices to values, then to know how to fix this line of code specifically.</p>\n"}, {"tags": ["time", "rust"], "comments": [{"owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "edited": false, "score": 5, "creation_date": 1554791859, "post_id": 55583503, "comment_id": 97870181, "body": "At least on Linux, <a href=\"https://github.com/rust-lang-deprecated/time/blob/324d2eb89354c412f520dbb29ef2c812085010a9/src/sys.rs#L172\" rel=\"nofollow noreferrer\">they</a> <a href=\"https://github.com/rust-lang/rust/blob/53f2165c544cceeafb308b80ace656ed328c1dc2/src/libstd/sys/unix/time.rs#L369\" rel=\"nofollow noreferrer\">both</a> use <code>clock_gettime (CLOCK_MONOTONIC)</code> so they should give the same results."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 4, "creation_date": 1554794621, "post_id": 55583503, "comment_id": 97871529, "body": "The implementation is platform-specific, so you will probably need to compare the code for the relevant platforms yourself. The general code quality of the Rust standard library is high, so my base assumption would be that the implementation in <code>std::time</code> is as accurate as the target platform allows."}, {"owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "edited": false, "score": 4, "creation_date": 1554795640, "post_id": 55583503, "comment_id": 97872070, "body": "Looks like the documentation could be improved. It should either state a guaranteed precision or explicitly explain that no guarantees are given. There is <a href=\"https://github.com/rust-lang/rust/issues/32626\" rel=\"nofollow noreferrer\">this very relevant issue</a>."}], "answers": [{"tags": [], "owner": {"reputation": 2282, "user_id": 123642, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/73aa7ad0c97ecb6a1d766fa8810aba29?s=128&d=identicon&r=PG", "display_name": "kolen", "link": "https://stackoverflow.com/users/123642/kolen"}, "is_accepted": true, "score": 4, "last_activity_date": 1554923438, "creation_date": 1554923438, "answer_id": 55619763, "question_id": 55583503, "link": "https://stackoverflow.com/questions/55583503/is-stdtimeduration-as-precise-as-timeprecise-time-ns-from-time-crate/55619763#55619763", "title": "Is std::time::Duration as precise as time::precise_time_ns from &quot;time&quot; crate?", "body": "<p>Yes, with high certainty, <code>std::time::Instant</code> is a correct replacement for <code>time::precise_time_ns</code>, having the same, or better, precision.</p>\n\n<p>As of Rust 1.33.0, <code>time</code> 0.1.41, implementations for most OSes of <code>time::precise_time_ns()</code> and <code>std::time::Instant::now()</code> are the same, with few exceptions.</p>\n\n<ul>\n<li><strong>Unix</strong>: <em>same</em>, <code>clock_gettime(CLOCK_MONOTONIC, ...)</code></li>\n<li><strong>MacOS</strong>: <em>same</em>, <code>mach_absolute_time</code></li>\n<li><strong>Windows</strong>: <em>same</em>, <code>QueryPerformanceCounter</code></li>\n<li><strong>Wasm32</strong>: <code>time</code> has no implementation, <code>std</code> uses <code>TimeSysCall::perform(TimeClock::Monotonic)</code></li>\n<li><strong>Redox</strong>: <em>same</em>, the same as unix</li>\n<li><strong>SGX</strong>: <em>implementations differ</em>, probably <code>std</code> has more correct implementation</li>\n</ul>\n\n<p>It's unlikely that in future versions <code>std::time::Instant::now</code> implementations will worsen.</p>\n\n<h1>Details of implementations</h1>\n\n<p><a href=\"https://github.com/rust-lang-deprecated/time/blob/0.1.41/src/sys.rs\" rel=\"nofollow noreferrer\"><code>time</code> crate has all implementations in single file</a>, with cfg flags, standard library has directory per system, with <a href=\"https://github.com/rust-lang/rust/blob/1.33.0/src/libstd/sys/mod.rs\" rel=\"nofollow noreferrer\">mod.rs where implementation is chosen at compile time</a> (unix also has conditional compilation for mac os inside <code>time.rs</code>).</p>\n\n<h2>Unix, \"regular\", <em>not</em> MacOS or iOS</h2>\n\n<p>Both implementations use <code>clock_gettime (3)</code> with <code>CLOCK_MONOTONIC</code> <code>clock_id</code>.</p>\n\n<h3>time</h3>\n\n<p><code>#[cfg(all(not(target_os = \"macos\"), not(target_os = \"ios\")))]</code></p>\n\n<pre><code>let mut ts = libc::timespec { tv_sec: 0, tv_nsec: 0 };\nunsafe {\n    libc::clock_gettime(libc::CLOCK_MONOTONIC, &amp;mut ts);\n}\n(ts.tv_sec as u64) * 1000000000 + (ts.tv_nsec as u64)\n</code></pre>\n\n<h3>std</h3>\n\n<p><code>#[cfg(unix)]</code> + <code>#[cfg(not(any(target_os = \"macos\", target_os = \"ios\")))]</code> </p>\n\n<pre><code>Instant { t: now(libc::CLOCK_MONOTONIC) }\n</code></pre>\n\n<h2>Unix, MacOS or iOS</h2>\n\n<p>Both implementations use <code>mach_absolute_time</code>.</p>\n\n<p>BTW, standard <code>clock_gettime(CLOCK_MONOTONIC, ...)</code> works on my system too, Mac OS 10.13.6, but I'm not sure if it's really monotonic.</p>\n\n<h3>time</h3>\n\n<p><code>#[cfg(any(target_os = \"macos\", target_os = \"ios\"))]</code></p>\n\n<pre><code>unsafe {\n    let time = libc::mach_absolute_time();\n    let info = info();\n    time * info.numer as u64 / info.denom as u64\n}\n</code></pre>\n\n<h3>std</h3>\n\n<p><code>#[cfg(unix)]</code> + <code>#[cfg(any(target_os = \"macos\", target_os = \"ios\"))]</code></p>\n\n<pre><code>Instant { t: unsafe { libc::mach_absolute_time() } }\n</code></pre>\n\n<h2>Windows</h2>\n\n<p>Both implementations use <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms644904(v=vs.85).aspx\" rel=\"nofollow noreferrer\"><code>QueryPerformanceCounter</code></a></p>\n\n<h3>time</h3>\n\n<p><code>#[cfg(windows)]</code></p>\n\n<pre><code>let mut ticks = i64_to_large_integer(0);\nunsafe {\n    assert!(QueryPerformanceCounter(&amp;mut ticks) == 1);\n}\nmul_div_i64(large_integer_to_i64(ticks), 1000000000, frequency()) as u64\n</code></pre>\n\n<h3>std</h3>\n\n<p><code>#[cfg(windows)]</code></p>\n\n<pre><code>let mut t = Instant { t: 0 };\ncvt(unsafe {\n    c::QueryPerformanceCounter(&amp;mut t.t)\n}).unwrap();\nt\n</code></pre>\n\n<h2>Wasm32</h2>\n\n<p>It's probably for non-web use, and unrelated to <a href=\"https://crates.io/crates/web-sys\" rel=\"nofollow noreferrer\">web-sys</a>. It <code>time</code> crate it's unimplemented.</p>\n\n<h3>time</h3>\n\n<p><code>#[cfg(all(target_arch = \"wasm32\", not(target_os = \"emscripten\")))]</code></p>\n\n<pre><code>unimplemented!()\n</code></pre>\n\n<h3>std</h3>\n\n<p><code>#[cfg(target_arch = \"wasm32\")]</code></p>\n\n<pre><code>Instant(TimeSysCall::perform(TimeClock::Monotonic))\n</code></pre>\n\n<h2>Redox</h2>\n\n<p>Both implementations use <code>clock_gettime(CLOCK_MONOTONIC, ...)</code>, the same as for unux.</p>\n\n<h3>time</h3>\n\n<p><code>#[cfg(target_os = \"redox\")]</code></p>\n\n<pre><code>let mut ts = syscall::TimeSpec { tv_sec: 0, tv_nsec: 0 };\nsyscall::clock_gettime(syscall::CLOCK_MONOTONIC, &amp;mut ts).unwrap();\n(ts.tv_sec as u64) * 1000000000 + (ts.tv_nsec as u64)\n</code></pre>\n\n<h3>std</h3>\n\n<p><code>#[cfg(target_os = \"redox\")]</code></p>\n\n<pre><code>Instant { t: now(syscall::CLOCK_MONOTONIC) }\n</code></pre>\n\n<h2>SGX</h2>\n\n<p>Here implementations differ. <code>time</code> crate falls back to std, and uses non-monotonic time (there was no monotonic time in std at the time, probably). Probably migrating from time to std improves accuracy because it uses SGX-specific call.</p>\n\n<h3>time</h3>\n\n<p><code>#[cfg(target_env = \"sgx\")]</code></p>\n\n<pre><code>// This unwrap is safe because current time is well ahead of UNIX_EPOCH, unless system clock is adjusted backward.\nlet std_duration = SystemTime::now().duration_since(SystemTime::UNIX_EPOCH).unwrap();\nstd_duration.as_secs() * NANOS_PER_SEC + std_duration.subsec_nanos() as u64\n</code></pre>\n\n<h3>std</h3>\n\n<p><code>#[cfg(all(target_vendor = \"fortanix\", target_env = \"sgx\"))]</code></p>\n\n<pre><code>Instant(usercalls::insecure_time())\n</code></pre>\n"}], "owner": {"reputation": 2282, "user_id": 123642, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/73aa7ad0c97ecb6a1d766fa8810aba29?s=128&d=identicon&r=PG", "display_name": "kolen", "link": "https://stackoverflow.com/users/123642/kolen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 514, "favorite_count": 0, "accepted_answer_id": 55619763, "answer_count": 1, "score": 5, "last_activity_date": 1554923438, "creation_date": 1554769522, "last_edit_date": 1554771070, "question_id": 55583503, "link": "https://stackoverflow.com/questions/55583503/is-stdtimeduration-as-precise-as-timeprecise-time-ns-from-time-crate", "title": "Is std::time::Duration as precise as time::precise_time_ns from &quot;time&quot; crate?", "body": "<p>For a long time, standard way to precisely measure time in Rust was <code>time</code> crate and its <a href=\"https://docs.rs/time/0.1.42/time/fn.precise_time_ns.html\" rel=\"noreferrer\"><code>time::precise_time_ns</code></a> function. However, <code>time</code> crate is deprecated now, and <code>std</code> library has <a href=\"https://doc.rust-lang.org/std/time/struct.Instant.html\" rel=\"noreferrer\"><code>std::time::Instant</code></a> intended for measuring elapsed time.</p>\n\n<p>I'm not sure it has the same precision, at least by design. I know it might be a vague question because there are different implementation of both things for different OSes, and implementations may change in different versions, but at least do they have the same purpose? Is <code>std::time::Duration</code> a correct replacement for <code>time::precise_time_ns</code> at least from the viewpoint of their design?</p>\n\n<p>Running this script on my system (Mac OS) outputs quite small durations, so it's probably quite precise:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::time::Instant;\n\nfn main() {\n    let mut t = Instant::now();\n    loop {\n        println!(\"{:?}\", t.elapsed());\n        t = Instant::now();\n    }\n}\n</code></pre>\n\n<pre><code>40ns\n42ns\n41ns\n45ns\n40ns\n41ns\n40ns\n40ns\n41ns\n41ns\n41ns\n40ns\n40ns\n40ns\n</code></pre>\n"}, {"tags": ["rust", "rust-macros"], "answers": [{"comments": [{"owner": {"reputation": 36, "user_id": 9519747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b0bba1a7b0fc49d1a345b7c5ae04725?s=128&d=identicon&r=PG&f=1", "display_name": "mciantyre", "link": "https://stackoverflow.com/users/9519747/mciantyre"}, "edited": false, "score": 0, "creation_date": 1554770600, "post_id": 55583596, "comment_id": 97865199, "body": "<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=334f70b9630e33fa31d7ab9039d1fbcd\" rel=\"nofollow noreferrer\">Playground for little, isolated example.</a>"}], "tags": [], "owner": {"reputation": 36, "user_id": 9519747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b0bba1a7b0fc49d1a345b7c5ae04725?s=128&d=identicon&r=PG&f=1", "display_name": "mciantyre", "link": "https://stackoverflow.com/users/9519747/mciantyre"}, "is_accepted": false, "score": 2, "last_activity_date": 1554771492, "last_edit_date": 1554771492, "creation_date": 1554770529, "answer_id": 55583596, "question_id": 55582838, "link": "https://stackoverflow.com/questions/55582838/call-stringify-inside-macro/55583596#55583596", "title": "Call `stringify!` inside macro", "body": "<p>Could the macro of two arguments forward to the macro of three arguments, expanding the <code>def</code> identifier? </p>\n\n<pre><code>macro_rules! remote_optional {\n    // The one that doesn't work (two arguments)\n    // forwards to the one that *does* work, expanding the\n    // string.\n    ($remote:ident with=$def:ident) =&gt; {\n        remote_optional!($remote, with=$def, stringify!($def));\n    };\n\n    // The macro that *does* work\n    ($remote:ident with=$def:ident $def_str:expr) =&gt; {\n        impl $def {\n            fn deserialize_option&lt;'de, D&gt;(deserializer: D) -&gt; Result&lt;Option&lt;$remote&gt;, D::Error&gt;\n            where\n                D: Deserializer&lt;'de&gt;,\n            {\n                #[derive(Deserialize)]\n                struct Wrapper(#[serde(with = $def_str)] $remote);\n\n                let v: Option&lt;Wrapper&gt; = Option::deserialize(deserializer)?;\n                Ok(v.map(|Wrapper(a)| a))\n            }\n        }\n    };\n}\n</code></pre>\n\n<p>We could also consider making the macro of three arguments an implementation detail.</p>\n\n<p>Little, isolated proof-of-concept:</p>\n\n<pre><code>macro_rules! my_macro {\n    ($x:expr, $y:expr) =&gt; {\n        my_macro!($x, $y, stringify!($x + $y));\n    };\n\n    ($x:expr, $y:expr, $msg:expr) =&gt; {\n        println!(\"{} + {} = {}\", $x, $y, $msg);\n    };\n}\n\n\nfn main() {\n    my_macro!(3, 2); // 3 + 2 = 3 + 2\n}\n</code></pre>\n"}], "owner": {"reputation": 21653, "user_id": 100335, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/e470fa78a9b8022d24b2780c5ffc33fe?s=128&d=identicon&r=PG", "display_name": "kpozin", "link": "https://stackoverflow.com/users/100335/kpozin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 285, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1554771492, "creation_date": 1554763913, "question_id": 55582838, "link": "https://stackoverflow.com/questions/55582838/call-stringify-inside-macro", "title": "Call `stringify!` inside macro", "body": "<p>This macro compiles when invoked:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>macro_rules! remote_optional {\n    ($remote:ident with=$def:ident $def_str:expr) =&gt; {\n        impl $def {\n            fn deserialize_option&lt;'de, D&gt;(deserializer: D) -&gt; Result&lt;Option&lt;$remote&gt;, D::Error&gt;\n            where\n                D: Deserializer&lt;'de&gt;,\n            {\n                #[derive(Deserialize)]\n                struct Wrapper(#[serde(with = $def_str)] $remote);\n\n                let v: Option&lt;Wrapper&gt; = Option::deserialize(deserializer)?;\n                Ok(v.map(|Wrapper(a)| a))\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>This one doesn't:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>macro_rules! remote_optional {\n    ($remote:ident with=$def:ident) =&gt; {\n        impl $def {\n            fn deserialize_option&lt;'de, D&gt;(deserializer: D) -&gt; Result&lt;Option&lt;$remote&gt;, D::Error&gt;\n            where\n                D: Deserializer&lt;'de&gt;,\n            {\n                #[derive(Deserialize)]\n                struct Wrapper(#[serde(with = stringify!($def))] $remote);\n\n                let v: Option&lt;Wrapper&gt; = Option::deserialize(deserializer)?;\n                Ok(v.map(|Wrapper(a)| a))\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>This is because <code>stringify!($def)</code> is passed into the <code>#[serde(...)]</code> attribute unevaluated.</p>\n\n<p>Is there any practical workaround?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1554764841, "post_id": 55582807, "comment_id": 97863987, "body": "<a href=\"https://doc.rust-lang.org/book/ch09-02-recoverable-errors-with-result.html#propagating-errors\" rel=\"nofollow noreferrer\">doc.rust-lang.org/book/&hellip;</a>, <a href=\"https://doc.rust-lang.org/book/ch09-02-recoverable-errors-with-result.html#the--operator-can-only-be-used-in-functions-that-return-result\" rel=\"nofollow noreferrer\">doc.rust-lang.org/book/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 29810, "user_id": 423170, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/H9kNQ.png?s=128&g=1", "display_name": "Frxstrem", "link": "https://stackoverflow.com/users/423170/frxstrem"}, "is_accepted": true, "score": 2, "last_activity_date": 1554764847, "creation_date": 1554764847, "answer_id": 55582965, "question_id": 55582807, "link": "https://stackoverflow.com/questions/55582807/how-to-enable-feature-to-substitute-unwrap-in-rust/55582965#55582965", "title": "How to enable ? feature to substitute unwrap in rust?", "body": "<p>The <code>?</code> operator only works inside functions that return <code>Result&lt;T, E&gt;</code>, since <code>expr?</code> is essentially the same as:</p>\n\n<pre><code>match expr {\n  Ok(value) =&gt; value,\n  Err(err) =&gt; return Err(err),\n}\n</code></pre>\n\n<p>You can modify your <code>main()</code> function to return a result though. Using <code>Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt;</code> will allow you to use <code>?</code> on any standard error type that implements the <code>Error</code> trait:</p>\n\n<pre><code>use std::error::Error;\nuse std::fs::File;\nuse std::io::{BufRead, BufReader};\n\nfn main() -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {\n    let file = File::open(\"myfile.txt\")?; // this will now work\n    for line in BufReader::new(file).lines() {\n        println!(\"{}\", line?);\n    }\n\n    // finally, we need to end with Ok(()) since we no longer have\n    // the default return type ()\n    Ok(())\n}\n</code></pre>\n"}], "owner": {"reputation": 1674, "user_id": 5420686, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/2c318e16c4b5f17dd1375df8cb1425e5?s=128&d=identicon&r=PG&f=1", "display_name": "Jal", "link": "https://stackoverflow.com/users/5420686/jal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "closed_date": 1554908528, "accepted_answer_id": 55582965, "answer_count": 1, "score": -4, "last_activity_date": 1554764847, "creation_date": 1554763731, "last_edit_date": 1554764466, "question_id": 55582807, "link": "https://stackoverflow.com/questions/55582807/how-to-enable-feature-to-substitute-unwrap-in-rust", "closed_reason": "Duplicate", "title": "How to enable ? feature to substitute unwrap in rust?", "body": "<p>Consider the following example</p>\n\n<pre><code>use std::fs::File;\nuse std::io::{BufRead, BufReader, Result};\n\nfn main() {\n\n    let file = File::open(\"myfile.txt\")?; // This doesn't work\n    let file = File::open(\"myfile.txt\").unwrap();  // this works\n    for line in BufReader::new(file).lines() {\n        println!(\"{}\", line.unwrap());\n    }\n}\n</code></pre>\n\n<p>using <code>rustc 1.33.0 (2aa4c46cf 2019-02-28)</code></p>\n\n<p>I am trying to use <code>?</code> to substitute unwrap, but it seems like I always get <code>^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ cannot use the</code>?<code>operator in a function that returns</code>()<code>\n</code> , can someone point me a direction?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["rust", "destructuring"], "answers": [{"comments": [{"owner": {"reputation": 5700, "user_id": 3131852, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/26365707ecfa02e221f5192aaaa29a43?s=128&d=identicon&r=PG", "display_name": "Tim Diekmann", "link": "https://stackoverflow.com/users/3131852/tim-diekmann"}, "reply_to_user": {"reputation": 5913, "user_id": 1244932, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d2c608e688b798896e8b516855fc1ab1?s=128&d=identicon&r=PG", "display_name": "user1244932", "link": "https://stackoverflow.com/users/1244932/user1244932"}, "edited": false, "score": 0, "creation_date": 1554762388, "post_id": 55582483, "comment_id": 97863373, "body": "Btw. you cannot move out of <code>Foo</code> (<code>f1().map(|x| Moo(x.0))</code>) as <code>Foo</code> implements <code>Drop</code>"}], "tags": [], "owner": {"reputation": 5700, "user_id": 3131852, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/26365707ecfa02e221f5192aaaa29a43?s=128&d=identicon&r=PG", "display_name": "Tim Diekmann", "link": "https://stackoverflow.com/users/3131852/tim-diekmann"}, "is_accepted": true, "score": 5, "last_activity_date": 1554908491, "last_edit_date": 1554908491, "creation_date": 1554761491, "answer_id": 55582483, "question_id": 55582127, "link": "https://stackoverflow.com/questions/55582127/why-is-there-a-drop-call-after-structure-destructuring/55582483#55582483", "title": "Why is there a drop call after structure destructuring?", "body": "<p>If you replace <code>NonNull</code> with a struct which does not implement <a href=\"https://doc.rust-lang.org/std/marker/trait.Copy.html\" rel=\"nofollow noreferrer\"><code>Copy</code></a>, the behavior is more clear:</p>\n\n<pre><code>#[derive(Debug)]\nstruct NoCopy;\n\nstruct Foo(NoCopy);\n\nimpl Drop for Foo {\n    fn drop(&amp;mut self) {\n        println!(\"Foo::drop: {:?}\", self.0);\n    }\n}\n\nstruct Moo(NoCopy);\n//impl Drop for Moo exists, but not important for question\n\nfn f1() -&gt; Result&lt;Foo, String&gt; {\n    Ok(Foo(NoCopy))\n}\n\nfn f2() -&gt; Result&lt;Moo, String&gt; {\n    f1().map(|Foo(x)| Moo(x))//1\n}\n\nfn main() {\n    f2();\n}\n</code></pre>\n\n<p>This results in this error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0509]: cannot move out of type `Foo`, which implements the `Drop` trait\n  --&gt; src/main.rs:20:15\n   |\n20 |     f1().map(|Foo(x)| Moo(x))//1\n   |               ^^^^-^\n   |               |   |\n   |               |   data moved here\n   |               cannot move out of here\n   |\nnote: move occurs because `x` has type `NoCopy`, which does not implement the `Copy` trait\n  --&gt; src/main.rs:20:19\n   |\n20 |     f1().map(|Foo(x)| Moo(x))//1\n   |            \n</code></pre>\n\n<p>Therefore, in (1) you copy the <code>NonNull</code> out of <code>Foo</code> and <code>Foo</code> gets dropped.</p>\n"}], "owner": {"reputation": 5913, "user_id": 1244932, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d2c608e688b798896e8b516855fc1ab1?s=128&d=identicon&r=PG", "display_name": "user1244932", "link": "https://stackoverflow.com/users/1244932/user1244932"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 55582483, "answer_count": 1, "score": 2, "last_activity_date": 1554908491, "creation_date": 1554759492, "last_edit_date": 1554908474, "question_id": 55582127, "link": "https://stackoverflow.com/questions/55582127/why-is-there-a-drop-call-after-structure-destructuring", "title": "Why is there a drop call after structure destructuring?", "body": "<p>I am wrapping a C API. To simplify for this question, I'm using <code>NonNull::dangling</code> instead.</p>\n\n<pre><code>use std::ptr::NonNull;\n\nstruct Foo(NonNull&lt;i32&gt;);\n\nimpl Drop for Foo {\n    fn drop(&amp;mut self) {\n        println!(\"Foo::drop: {:?}\", self.0);\n    }\n}\n\nstruct Moo(NonNull&lt;i32&gt;);\n//impl Drop for Moo exists, but not important for question\n\nfn f1() -&gt; Result&lt;Foo, String&gt; {\n    Ok(Foo(unsafe { NonNull::dangling() }))\n}\n\nfn f2() -&gt; Result&lt;Moo, String&gt; {\n    f1().map(|Foo(x)| Moo(x))//1\n}\n\nfn main() {\n    f2();\n}\n</code></pre>\n\n<p>At point (1), I unpack/destructure <code>Foo</code>. I expect that after that, <code>Foo::drop</code> should not be called, but for some reason <code>Foo::drop</code> is printed.</p>\n\n<p>Am I wrong that destructuring (<code>let Struct1 { field1, field2, .. } = struct1;</code>) should prevent the call of <code>Struct1::drop</code>?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1554744285, "post_id": 55578644, "comment_id": 97855912, "body": "If <code>F</code> is abstract, then you probably wouldn&#39;t write <code>fn</code>."}, {"owner": {"reputation": 620, "user_id": 1479022, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1e84c20c3eda070f244e406bdbc3d286?s=128&d=identicon&r=PG", "display_name": "exprosic", "link": "https://stackoverflow.com/users/1479022/exprosic"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1554745960, "post_id": 55578644, "comment_id": 97856722, "body": "@melpomene is it possible to define recursive parser with anything but fn?"}], "answers": [{"tags": [], "owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "is_accepted": true, "score": 1, "last_activity_date": 1554793823, "creation_date": 1554793823, "answer_id": 55586998, "question_id": 55578644, "link": "https://stackoverflow.com/questions/55578644/is-it-possible-to-define-recursive-functions-in-a-style-of-normal-binding/55586998#55586998", "title": "Is it possible to define (recursive) functions in a style of normal binding?", "body": "<p>I don't see how <code>add_by</code>, <code>mult_by</code> or <code>composite</code> can return anything <em>other</em> than a closure, given that the returned \"thing\" must remember (eg. \"capture\") the parameters\u2026</p>\n\n<p>That being said, you can make it work if you make <code>add_by</code> and co. into macros instead of functions:</p>\n\n<pre><code>macro_rules! add_by {\n   ($y:expr) =&gt; { { fn f (x: i32) -&gt; i32 { x + $y } f } }\n}\n\nmacro_rules! less_than {\n   ($y:expr) =&gt; { { fn f (x: i32) -&gt; bool { x &lt; $y } f } }\n}\n\nmacro_rules! compose {\n   ($f:expr, $g:expr) =&gt; { { fn c (x: i32) -&gt; i32 { $f ($g (x)) } c } }\n}\n\nmacro_rules! branch {\n   ($rec:ident, $test:expr, $if_true:expr, $if_false:expr) =&gt; { \n      {\n         fn $rec (x: i32) -&gt; i32 {\n            if $test (x) { $if_true (x) } else { $if_false (x) }\n         }\n         $rec\n      }\n   }\n}\n\nfn main() {\n    let g = branch!(g, less_than!(10), add_by!(1), compose!(add_by!(1), g));\n    println!(\"Test: {}\", g(4));\n}\n</code></pre>\n\n<p><a href=\"https://play.integer32.com/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=bfcc4c4fe065a5bd20b4cf7cbbab7ca4\" rel=\"nofollow noreferrer\">playground</a></p>\n\n<p>The salient point here is that you need to give the name of the recursive function as a parameter to the <code>branch</code> macro (parameter <code>$rec</code>), at which point you can access it from the sub-expressions.</p>\n"}], "owner": {"reputation": 620, "user_id": 1479022, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1e84c20c3eda070f244e406bdbc3d286?s=128&d=identicon&r=PG", "display_name": "exprosic", "link": "https://stackoverflow.com/users/1479022/exprosic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "closed_date": 1554796440, "accepted_answer_id": 55586998, "answer_count": 1, "score": 0, "last_activity_date": 1554793823, "creation_date": 1554744158, "last_edit_date": 1554750274, "question_id": 55578644, "link": "https://stackoverflow.com/questions/55578644/is-it-possible-to-define-recursive-functions-in-a-style-of-normal-binding", "closed_reason": "Duplicate", "title": "Is it possible to define (recursive) functions in a style of normal binding?", "body": "<p>Is there any way of binding (instead of defining) <strong>possibly recursive</strong> functions? For example:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>type F = fn(i32) -&gt; i32;\n\n// equivalent to |x| (x+1)*2\nfn f: F = composite(add_by(1), mult_by(2));\n\n// equivalent to |x| if x &gt; 100 then {x} else {g(x*2)}\n// note the recursion\nfn g: F = branch(greater_than(100), identity, composite(mult_by(2), g));\n</code></pre>\n\n<p>The recursion I am trying to achieve is NOT of closure in general (asked <a href=\"https://stackoverflow.com/q/16946888/1479022\">here</a>), which is impossible without hacks, but simply of a normal function with nicer syntax (both type signature and definition).</p>\n\n<p>This could be helpful when <code>type F</code> is complicated and supposed to be used abstractly, e.g.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>type Parser&lt;T&gt; = fn(&amp;str) -&gt; Option&lt;(T, &amp;str)&gt;\n</code></pre>\n"}, {"tags": ["rust", "traits"], "comments": [{"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1554752987, "post_id": 55578125, "comment_id": 97860009, "body": "Rust is a statically typed language. Each expression has a type known at compile time. Let&#39;s assume the compiler allowed trait objects of type <code>Box&lt;dyn ReadEcs&gt;</code>, and you have such a trait object in the variable <code>x</code>. Now what is the type of the expression <code>x.read()</code>? Trying to answer this question should make clear why this does not work, and also gives hints how to work around the problem. (See also the <a href=\"https://doc.rust-lang.org/reference/items/traits.html#object-safety\" rel=\"nofollow noreferrer\">definition of object safety in the language reference</a>.)"}, {"owner": {"reputation": 2439, "user_id": 2294472, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/231b9fba4257295e39e1484a410d246d?s=128&d=identicon&r=PG", "display_name": "Delta_Fore", "link": "https://stackoverflow.com/users/2294472/delta-fore"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1554753346, "post_id": 55578125, "comment_id": 97860166, "body": "@sven I understand that. But the above example is saying as long as all structs have a <code>read()</code> method we can indeed put them in a collection. The test code works fine and returns 0,123 respectively as you&#39;d expect."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1554753867, "post_id": 55578125, "comment_id": 97860393, "body": "I&#39;m a little confused. It doesn&#39;t make much sense to say that &quot;all structs have a <code>read()</code> method&quot;. The <code>read()</code> methods of the two different traits are completely unrelated to each other. The important question to ask is whether the structs implement a particular trait. You can have a collection of trait objects for an object-safe trait, but you can&#39;t have such a collection for a trait that is not object-safe. If your <code>read()</code> method returns an associated type, you need to specify that type to be able to create a trait object \u2013 <code>Box&lt;dyn ReadEcs&lt;T = f32&gt;&gt;</code> should be valid."}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1554810393, "post_id": 55578125, "comment_id": 97880719, "body": "Your constraints directly contradict each other (which you acknowledge). To find a solution, you need to explain which parts of the constraints can be flexible, or take a step back to the underlying requirements to reevaluate from there."}], "answers": [{"tags": [], "owner": {"reputation": 2439, "user_id": 2294472, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/231b9fba4257295e39e1484a410d246d?s=128&d=identicon&r=PG", "display_name": "Delta_Fore", "link": "https://stackoverflow.com/users/2294472/delta-fore"}, "is_accepted": false, "score": 0, "last_activity_date": 1555059000, "last_edit_date": 1555059000, "creation_date": 1555058397, "answer_id": 55647658, "question_id": 55578125, "link": "https://stackoverflow.com/questions/55578125/collection-with-traits-that-return-self/55647658#55647658", "title": "Collection with Traits that return Self", "body": "<p>I thought about this a little more and I think it's possible to solve this while retaining all the advantages of type safety and contiguous storage.</p>\n\n<p>Defining a entity manager with pointers to storage</p>\n\n<pre><code>struct Entities {\n    entities: Vec&lt;usize&gt;,\n    containers: Vec&lt;Box&lt;Storage&gt;&gt;,\n}\n</code></pre>\n\n<p>The components themselves that store data related to behaviour</p>\n\n<pre><code>struct Position {\n    entity_id: usize,\n    position: f32,\n}\n\nstruct Velocity {\n    entity_id: usize,\n    velocity: f32,\n}\n</code></pre>\n\n<p>We will have many instances of components, so we need a contiguous memory store, accessed by an index.</p>\n\n<pre><code>struct PositionStore {\n    storage: Vec&lt;Position&gt;,\n}\n\nstruct VelocityStore {\n    storage: Vec&lt;Velocity&gt;,\n}\n\n\n\ntrait Storage {\n    // Create and delete instances of the component\n    fn allocate(&amp;mut self, entity_id: usize) -&gt; usize;\n\n    // Interface methods that would correspond to a base class in C++\n    fn do_this(&amp;self);\n    // fn do_that(&amp;self);\n}\n</code></pre>\n\n<p>The trait for the store implements an <code>arena</code> style storage plus the methods it would pass to to the components. This would likely be in the \"System\" part of an ECS but is left as an exercise for later.</p>\n\n<p>I would like a hint as to how to pass a Fn() that constructs a custom object to the <code>allocate()</code> method. I've not figured that out yet.</p>\n\n<pre><code>impl Storage for PositionStore {\n    fn allocate(&amp;mut self, entity_id: usize) -&gt; usize {\n        self.storage.push(Position {\n            entity_id,\n            position: 0.0,\n        });\n        self.storage.len() - 1\n    }\n\n    fn run(&amp;self) {\n        self.storage.iter().for_each(|item| { println!(\"{}\",item.position); });\n    }\n}\n\nimpl Storage for VelocityStore {\n    fn allocate(&amp;mut self, entity_id: usize) -&gt; usize {\n        self.storage.push(Velocity {\n            entity_id,\n            velocity: 0.0,\n        });\n        self.storage.len() - 1\n    }\n\n    fn do_this(&amp;self) {\n        self.storage.iter().for_each(|item| { println!(\"{}\",item.velocity); });\n    }\n}\n</code></pre>\n\n<p>Some boiler plate.</p>\n\n<pre><code>impl Default for PositionStore {\n    fn default() -&gt; PositionStore {\n        PositionStore {\n            storage: Vec::new(),\n        }\n    }\n}\n\nimpl Default for VelocityStore {\n    fn default() -&gt; VelocityStore {\n        VelocityStore {\n            storage: Vec::new(),\n        }\n    }\n}\n</code></pre>\n\n<p>I think this could be thought about a little more. It stores the relationship between the storage of the components and their position</p>\n\n<p>Instead of <code>T::default()</code>, you may want to pass a lambda function that has a specific initialisation for each of your components</p>\n\n<pre><code>impl Entities {\n    fn register&lt;T&gt;(&amp;mut self) -&gt; usize\n    where\n        T: Storage + Default + 'static,\n    {\n        self.containers.push(Box::new(T::default()));\n        self.containers.len() - 1\n    }\n\n    fn create&lt;T&gt;(&amp;mut self, entity_id: usize, id: usize) -&gt; usize {\n        self.containers[id].allocate(entity_id)\n    }\n\n    fn run_loop(&amp;self) {\n        self.containers.iter().for_each(|x| x.do_this());\n    }\n}\n</code></pre>\n\n<p>A test case to see if this works</p>\n\n<pre><code>#[cfg(test)]\nmod tests {\n    use super::*;\n    #[test]\n    fn arbitary() {\n        let mut entities = Entities {\n            entities: Vec::new(),\n            containers: Vec::new(),\n        };\n        let velocity_store_id = entities.register::&lt;VelocityStore&gt;();\n        let position_store_id = entities.register::&lt;PositionStore&gt;();\n\n        let _ = entities.create::&lt;Velocity&gt;(123, velocity_store_id);\n        let _ = entities.create::&lt;Velocity&gt;(234, velocity_store_id);\n        let _ = entities.create::&lt;Position&gt;(234, position_store_id);\n        let _ = entities.create::&lt;Position&gt;(567, position_store_id);\n\n        entities.run_loop();\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 2439, "user_id": 2294472, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/231b9fba4257295e39e1484a410d246d?s=128&d=identicon&r=PG", "display_name": "Delta_Fore", "link": "https://stackoverflow.com/users/2294472/delta-fore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 435, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1555059000, "creation_date": 1554742074, "last_edit_date": 1554748536, "question_id": 55578125, "link": "https://stackoverflow.com/questions/55578125/collection-with-traits-that-return-self", "title": "Collection with Traits that return Self", "body": "<p>I'm trying to have a collection of objects that implement a particular trait. </p>\n\n<p>If I use a trait that returns a value, this works</p>\n\n<pre><code>use std::collections::BTreeMap;\n\nstruct World {\n    entities: Vec&lt;usize&gt;,\n    database: BTreeMap&lt;usize, Box&lt;ReadValue&gt;&gt;,\n    //database : BTreeMap&lt;usize,Box&lt;ReadEcs&gt;&gt;, // Doesn't work\n}\n\nstruct SourceInputGateway {\n    entity_id: usize,\n}\n\ntrait ReadValue {\n    fn read(&amp;self) -&gt; f32;\n}\n\nimpl ReadValue for SourceInputGateway {\n    fn read(&amp;self) -&gt; f32 {\n        0.0\n    }\n}\n</code></pre>\n\n<p>But if I want to return <code>Self</code> as a value then this doesn't work, either as a method template param or associated type</p>\n\n<pre><code>trait ReadEcs {\n    type T;\n    fn read(&amp;self) -&gt; &amp;Self::T;\n}\n\nimpl ReadEcs for SourceInputGateway {\n    type T = SourceInputGateway;\n    fn read(&amp;self) -&gt; &amp;Self::T {\n        self\n    }\n}\n</code></pre>\n\n<p>What I would like to do is have a map of types that implement <code>ReadEcs</code>, the concrete type of which is not important.</p>\n\n<p><strong>Further clarification edit</strong></p>\n\n<p>If I expand the example by adding</p>\n\n<pre><code>// Different sized type\nstruct ComputeCalculator {\n    entity_id : usize,\n    name : String,\n}\n\nimpl ReadValue for ComputeCalculator {\n    fn read(&amp;self) -&gt; f32 {\n        1230.0\n    }\n}\n</code></pre>\n\n<p>then I can do this</p>\n\n<pre><code>#[cfg(test)]\nmod tests {\n    use super::*;\n    #[test]\n    fn read_write() {\n        let mut world = World::new();\n        world.database.insert(0,Box::new(SourceInputGateway{ entity_id : 1}));\n        world.database.insert(2,Box::new(ComputeCalculator{ entity_id : 2 , name : \"foo\".into() }));\n\n        for (k,ref v) in world.database {\n            let item : &amp;Box&lt;ReadValue&gt; = v;\n            item.read();\n        }\n\n    }\n}\n</code></pre>\n\n<p>but if I change or add a trait method that returns Self, I can't do this.\nI'd like to understand a way to get around it without unsafe pointers.</p>\n"}, {"tags": ["rust", "algebraic-data-types", "static-typing"], "comments": [{"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 3, "creation_date": 1554743998, "post_id": 55577666, "comment_id": 97855786, "body": "Tim gave you the answer. As for algebraic types: In Rust, product types are <code>struct</code>s and tuples, sum types are <code>enum</code>s."}], "answers": [{"tags": [], "owner": {"reputation": 5700, "user_id": 3131852, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/26365707ecfa02e221f5192aaaa29a43?s=128&d=identicon&r=PG", "display_name": "Tim Diekmann", "link": "https://stackoverflow.com/users/3131852/tim-diekmann"}, "is_accepted": true, "score": 5, "last_activity_date": 1554760931, "last_edit_date": 1554760931, "creation_date": 1554741134, "answer_id": 55577881, "question_id": 55577666, "link": "https://stackoverflow.com/questions/55577666/what-does-the-operand-between-types-mean/55577881#55577881", "title": "What does the + operand between types mean?", "body": "<p><code>T: <a href=\"https://doc.rust-lang.org/std/any/trait.Any.html\" rel=\"nofollow noreferrer\">Any</a> + <a href=\"https://doc.rust-lang.org/std/fmt/trait.Debug.html\" rel=\"nofollow noreferrer\">Debug</a></code> is a <a href=\"https://doc.rust-lang.org/book/ch10-02-traits.html#trait-bounds\" rel=\"nofollow noreferrer\">trait bound</a>. The type <code>T</code> must satisfy <a href=\"https://doc.rust-lang.org/std/any/trait.Any.html\" rel=\"nofollow noreferrer\"><code>Any</code></a> <strong>and</strong> <a href=\"https://doc.rust-lang.org/std/fmt/trait.Debug.html\" rel=\"nofollow noreferrer\"><code>Debug</code></a>, therefore the <code>+</code> sign is used here and it is not related to algebraic types. You can read more on traits at the <a href=\"https://doc.rust-lang.org/book/ch10-02-traits.html\" rel=\"nofollow noreferrer\">corresponding section in the book</a>.</p>\n\n<p><a href=\"https://doc.rust-lang.org/book/ch10-02-traits.html#specify-multiple-traits-with-\" rel=\"nofollow noreferrer\">This section</a> mentions the <code>+</code> sign.</p>\n"}], "owner": {"reputation": 15015, "user_id": 1191635, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/I8bEt.jpg?s=128&g=1", "display_name": "Armeen Harwood", "link": "https://stackoverflow.com/users/1191635/armeen-harwood"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 55577881, "answer_count": 1, "score": 1, "last_activity_date": 1554908186, "creation_date": 1554740258, "last_edit_date": 1554908186, "question_id": 55577666, "link": "https://stackoverflow.com/questions/55577666/what-does-the-operand-between-types-mean", "title": "What does the + operand between types mean?", "body": "<p>With this example from <a href=\"https://doc.rust-lang.org/core/any/index.html\" rel=\"nofollow noreferrer\">core::any</a></p>\n\n<pre><code>use std::fmt::Debug;\nuse std::any::Any;\n\n// Logger function for any type that implements Debug.\nfn log&lt;T: Any + Debug&gt;(value: &amp;T) {\n    let value_any = value as &amp;dyn Any;\n\n    // try to convert our value to a String.  If successful, we want to\n    // output the String's length as well as its value.  If not, it's a\n    // different type: just print it out unadorned.\n    match value_any.downcast_ref::&lt;String&gt;() {\n        Some(as_string) =&gt; {\n            println!(\"String ({}): {}\", as_string.len(), as_string);\n        }\n        None =&gt; {\n            println!(\"{:?}\", value);\n        }\n    }\n}\n\n// This function wants to log its parameter out prior to doing work with it.\nfn do_work&lt;T: Any + Debug&gt;(value: &amp;T) {\n    log(value);\n    // ...do some other work\n}\n\nfn main() {\n    let my_string = \"Hello World\".to_string();\n    do_work(&amp;my_string);\n\n    let my_i8: i8 = 100;\n    do_work(&amp;my_i8);\n}\n</code></pre>\n\n<p>This is the first time I\u2019ve seen a <strong><code>+</code></strong>  operand between types <code>Any + Debug</code>. I\u2019m assuming its like <a href=\"https://en.m.wikipedia.org/wiki/Algebraic_data_type\" rel=\"nofollow noreferrer\">algebraic types</a> and therefore would be an <code>Any</code> type with <code>Debug</code> type; however, I cannot find any docs under algebraic types in Rust.</p>\n\n<p>What is the <code>+</code> actually doing here, what is it called? Where can I find the docs on this?</p>\n"}, {"tags": ["rust", "clean-architecture", "clippy"], "answers": [{"comments": [{"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 3, "creation_date": 1554736955, "post_id": 55576708, "comment_id": 97852281, "body": "Great answer. FWIW, <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=d21aecae3dbfd7827c8c11f52a13d91a\" rel=\"nofollow noreferrer\">here&#39;s my version of the <code>&amp;Mutex&lt;MyStruct&gt;</code> solution.</a> (Of course, this makes <code>arc_taker</code> a bad name since it doesn&#39;t take an <code>Arc</code>.)"}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 5, "creation_date": 1554737872, "post_id": 55576708, "comment_id": 97852830, "body": "It may be worth nothing that there is a general underlying principle here: a function should make only as many assumptions as are required for it to work properly, which should be reflected in the type of arguments it takes. This is the same principle which leads to recommending taking <code>&amp;str</code> vs <code>&amp;String</code>."}, {"owner": {"reputation": 815, "user_id": 1150292, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VQ2aZ.jpg?s=128&g=1", "display_name": "Mara Bos", "link": "https://stackoverflow.com/users/1150292/mara-bos"}, "reply_to_user": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 0, "creation_date": 1554738002, "post_id": 55576708, "comment_id": 97852905, "body": "@MatthieuM. Yes, that&#39;s a good addition. In this specific case that also means it shouldn&#39;t even take a <code>&amp;Mutex</code>, since the function always locks it anyway. It should just take a <code>&amp;MyStruct</code>, and leave the locking up to the caller. Then callers that already locked the mutex for something else can also call the function, without having to unlock the mutex first. (But I assume the original code where this question came from does more than just <code>.lock().something()</code>.)"}, {"owner": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "reply_to_user": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 0, "creation_date": 1554738121, "post_id": 55576708, "comment_id": 97852978, "body": "@MatthieuM. I understand the main principle and why I should send the reference by looking the principal. What I am really wondering, breaking that principle does not seem harmful to me apart from it&#39;s cost to bump the reference count up and down?"}, {"owner": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "edited": false, "score": 0, "creation_date": 1554738146, "post_id": 55576708, "comment_id": 97852997, "body": "@M-ou-se my MCVE is not reflecting the need of Arc very well. Let&#39;s consider that we are checking the weak_count as well. That does not make much difference untill Arc is consumed by the call. <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=c6922698906c0fca3754bf277ac25932\" rel=\"nofollow noreferrer\">Playground</a>"}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "reply_to_user": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "edited": false, "score": 2, "creation_date": 1554739221, "post_id": 55576708, "comment_id": 97853579, "body": "@AkinerAlkan I guess I don&#39;t know why you would consider this a <i>false positive</i> for the clippy lint. The body of <code>arc_taker</code> doesn&#39;t need to consume the <code>Arc</code>, so it can be rewritten to accept a <code>&amp;Arc</code>. That&#39;s all the lint is saying. You may choose to ignore it for any reason, but that doesn&#39;t make it <i>false</i>."}, {"owner": {"reputation": 815, "user_id": 1150292, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VQ2aZ.jpg?s=128&g=1", "display_name": "Mara Bos", "link": "https://stackoverflow.com/users/1150292/mara-bos"}, "reply_to_user": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "edited": false, "score": 4, "creation_date": 1554739494, "post_id": 55576708, "comment_id": 97853726, "body": "@AkinerAlkan Breaking that principle means restricting the ways your function can be used. If some other part of your code has an <code>Rc&lt;Mutex&gt;</code> or just a <code>Box&lt;Mutex&gt;</code>, it&#39;s a shame if it can&#39;t use your function, because it needlessly requires an <code>Arc&lt;Mutex&gt;</code>. If you do need an <code>Arc</code>, taking it by value when a reference would suffice means not only a performance hit (writing to an atomic twice), but also makes the interface less ergonomic: <code>arc_taker(a)</code> would consume a, so users of the function will need to call <code>.clone()</code> instead of just writing <code>&amp;a</code>."}], "tags": [], "owner": {"reputation": 815, "user_id": 1150292, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VQ2aZ.jpg?s=128&g=1", "display_name": "Mara Bos", "link": "https://stackoverflow.com/users/1150292/mara-bos"}, "is_accepted": true, "score": 7, "last_activity_date": 1554736713, "creation_date": 1554736713, "answer_id": 55576708, "question_id": 55576425, "link": "https://stackoverflow.com/questions/55576425/why-does-clippy-suggests-passing-an-arc-as-a-reference/55576708#55576708", "title": "Why does Clippy suggests passing an Arc as a reference?", "body": "<p>Calling <code>arc_taker(arc.clone())</code> increments the reference count, and returning from <code>arc_taker</code> decrements it again. This is useless in this case, since the <code>arc</code> variable of <code>main</code> already keeps the <code>Arc</code> alive during the entire call. A reference to it would already suffice. No need to bump the reference count up and down.</p>\n\n<p>In your specific example, <code>arc_taker</code> doesn't even care that it is managed by an <code>Arc</code>. All it cares about is that there is a <code>Mutex</code> to <code>lock</code>, so to make your function less restrictive, just take a <code>&amp;Mutex&lt;MyStruct&gt;</code> instead.</p>\n\n<p>If you wanted to do any <code>Arc</code>-specific things to it, like getting the <code>weak_count</code> or something, taking a <code>&amp;Arc&lt;..&gt;</code> would make sense. If your function would keep a clone of the Arc around, only then it would make sense to take an <code>Arc</code> by value, because then the caller can decide to give you an additional reference to it by calling <code>.clone()</code> (thus bumping the reference count), or to give you ownership of its own <code>Arc</code> (and thus not bumping the reference count).</p>\n"}], "owner": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 303, "favorite_count": 0, "accepted_answer_id": 55576708, "answer_count": 1, "score": 7, "last_activity_date": 1554907638, "creation_date": 1554735873, "last_edit_date": 1554907638, "question_id": 55576425, "link": "https://stackoverflow.com/questions/55576425/why-does-clippy-suggests-passing-an-arc-as-a-reference", "title": "Why does Clippy suggests passing an Arc as a reference?", "body": "<p>I am checking Clippy findings in my code and found that <a href=\"https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value\" rel=\"nofollow noreferrer\">the pedantic rule <code>needless_pass_by_value</code></a> might be a false positive.</p>\n\n<p>It says that: </p>\n\n<blockquote>\n  <p>warning: this argument is passed by value, but not consumed in the function body</p>\n  \n  <p>help: consider taking a reference instead: <code>&amp;Arc&lt;Mutex&lt;MyStruct&gt;&gt;</code></p>\n</blockquote>\n\n<p>Since cloning the <code>Arc</code> is only reference counting, moving the <code>Arc</code> should not be bad idea. Does it really make any difference in terms of quality and performance to send a reference instead of a value for the <code>Arc</code> ?</p>\n\n<pre><code>#![warn(clippy::pedantic)]\n\nuse std::sync::{Arc, Mutex};\n\nfn main() {\n    let my_struct = MyStruct { value: 3 };\n    let arc = Arc::new(Mutex::new(my_struct));\n\n    arc_taker(arc.clone());\n}\n\nfn arc_taker(prm: Arc&lt;Mutex&lt;MyStruct&gt;&gt;) {\n    prm.lock().unwrap().do_something();\n}\n\nstruct MyStruct {\n    value: i32,\n}\n\nimpl MyStruct {\n    fn do_something(&amp;self) {\n        println!(\"self.value: {}\", self.value);\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=c4bd55e5105b1e84bb2aaeeddf859a41\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}, {"tags": ["rust", "generator", "resume"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1554740116, "post_id": 55576401, "comment_id": 97854045, "body": "your own link show you the answer"}, {"owner": {"reputation": 6932, "user_id": 774236, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/7e46879a230ff1e28cd975e3b0a0873b?s=128&d=identicon&r=PG", "display_name": "Matteo Monti", "link": "https://stackoverflow.com/users/774236/matteo-monti"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554740189, "post_id": 55576401, "comment_id": 97854073, "body": "Well I must have gone blind! Sorry for the waste of time!"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1554740311, "post_id": 55576401, "comment_id": 97854130, "body": "not really, this could be useful for future reader but it&#39;s just strange"}], "answers": [{"comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554739999, "post_id": 55576555, "comment_id": 97853984, "body": "new API doesn&#39;t look very user friendly."}, {"owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "edited": false, "score": 1, "creation_date": 1554794584, "post_id": 55576555, "comment_id": 97871494, "body": "To be closer to the original code, you can omit the state check: <code>Pin::new(&amp;mut generator).resume();</code>"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554794924, "post_id": 55576555, "comment_id": 97871709, "body": "@Stargateur better?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1554909055, "post_id": 55576555, "comment_id": 97925299, "body": "@Stargateur that&#39;s because generators are pretty low level. However, like futures (which are built on generators), most people won&#39;t use this syntax. There&#39;s a closure-like syntax that will be used instead."}], "tags": [], "owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "is_accepted": true, "score": 3, "last_activity_date": 1554794768, "last_edit_date": 1554794768, "creation_date": 1554736244, "answer_id": 55576555, "question_id": 55576401, "link": "https://stackoverflow.com/questions/55576401/generator-does-not-seem-to-expose-resume-method/55576555#55576555", "title": "Generator does not seem to expose `resume()` method", "body": "<blockquote>\n  <p>Yes, I am aware that this is an unstable feature</p>\n</blockquote>\n\n<p>Unstable features tend to change over time and this is the case. With the recent stabilization of <code>Pin</code> the signature of <a href=\"https://doc.rust-lang.org/nightly/std/ops/trait.Generator.html#tymethod.resume\" rel=\"nofollow noreferrer\"><code>resume</code></a> has been changed (<a href=\"https://github.com/rust-lang/rust/pull/55704\" rel=\"nofollow noreferrer\">PR #55704</a>)</p>\n\n<pre><code>fn resume(self: Pin&lt;&amp;mut Self&gt;) -&gt; GeneratorState&lt;Self::Yield, Self::Return&gt;;\n</code></pre>\n\n<p>But fortunately the examples has also <a href=\"https://doc.rust-lang.org/nightly/std/ops/trait.Generator.html\" rel=\"nofollow noreferrer\">been adopted</a>.</p>\n\n<p>So your code needs to look like this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#![feature(generators, generator_trait)]\n\nuse std::ops::Generator;\nuse std::pin::Pin;\n\nfn main() {\n    let mut generator = || {\n        println!(\"2\");\n        yield;\n        println!(\"4\");\n    };\n\n    let mut pin = Pin::new(&amp;mut generator);\n    println!(\"1\");\n    pin.as_mut().resume();\n    println!(\"3\");\n    pin.as_mut().resume();\n    println!(\"5\");\n}\n</code></pre>\n\n<p>The upside of this is, that this approach does not need <code>unsafe</code> anymore (which your code is missing and therefore should not compile on an older nightly) and that's why the <code>Pin</code> API has been choosen for the generator.</p>\n\n<p>Lessons learned: If you are using the nightly compiler, also use the <a href=\"https://doc.rust-lang.org/nightly/std/\" rel=\"nofollow noreferrer\">nightly doc</a>.</p>\n"}], "owner": {"reputation": 6932, "user_id": 774236, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/7e46879a230ff1e28cd975e3b0a0873b?s=128&d=identicon&r=PG", "display_name": "Matteo Monti", "link": "https://stackoverflow.com/users/774236/matteo-monti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 55576555, "answer_count": 1, "score": 0, "last_activity_date": 1554794768, "creation_date": 1554735808, "question_id": 55576401, "link": "https://stackoverflow.com/questions/55576401/generator-does-not-seem-to-expose-resume-method", "title": "Generator does not seem to expose `resume()` method", "body": "<p>I was having a look at <a href=\"https://doc.rust-lang.org/nightly/unstable-book/language-features/generators.html\" rel=\"nofollow noreferrer\">generators in Rust</a>, and decided to give it a try. I implemented the most basic example I could come find:</p>\n\n<pre><code>#![feature(generators, generator_trait)]\n\nuse std::ops::Generator;\n\nfn main() {\n    let mut generator = || {\n        println!(\"2\");\n        yield;\n        println!(\"4\");\n    };\n\n    println!(\"1\");\n    generator.resume();\n    println!(\"3\");\n    generator.resume();\n    println!(\"5\");\n}\n</code></pre>\n\n<p>However, when I try to compile I get this error:</p>\n\n<pre><code>error[E0599]: no method named `resume` found for type `[generator@src/main.rs:6:25: 10:6 _]` in the current scope\n  --&gt; src/main.rs:13:15\n   |\n13 |     generator.resume();\n   |               ^^^^^^\n</code></pre>\n\n<p>Am I doing something wrong or the <code>resume()</code> method actually does not exist on generators? If so, how can I wake up a generator? The documentation I could find all points to the <code>resume()</code> method, so I am confused now.</p>\n\n<p><strong>Note</strong>: Yes, I am aware that this is an unstable feature of the language, but on the doc it does encourage users to try and use it, so I am assuming it should be at least partially implemented?</p>\n\n<p><strong>My current environment</strong>: <code>rustc 1.35.0-nightly (acd8dd6a5 2019-04-05)</code></p>\n"}, {"tags": ["rust", "lifetime"], "comments": [{"owner": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "edited": false, "score": 0, "creation_date": 1554727862, "post_id": 55573859, "comment_id": 97846431, "body": "Please provide <a href=\"https://stackoverflow.com/help/mcve\">MCVE</a> so we can help you better to identify and solve your problem :)"}, {"owner": {"reputation": 319, "user_id": 7698902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504b47ca61e2dea92102495da1750314?s=128&d=identicon&r=PG&f=1", "display_name": "vandenheuvel", "link": "https://stackoverflow.com/users/7698902/vandenheuvel"}, "reply_to_user": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "edited": false, "score": 0, "creation_date": 1554728081, "post_id": 55573859, "comment_id": 97846592, "body": "I fear that if I cut down more, I&#39;ll remove complexity that necessitates the solution direction I&#39;m currently working towards. I don&#39;t think the problem will make sense with less information. I tried to simplify as much as possible already. Do you have any further reduction tips?"}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1554728288, "post_id": 55573859, "comment_id": 97846735, "body": "One should always seek to make an example so that other people can reproduce the problem themselves. The <a href=\"https://stackoverflow.com/tags/rust/info\">Rust tag info</a> contains a bit more guidance towards making an MCVE. You may also consider sharing a link to the <a href=\"//play.rust-lang.org\" rel=\"nofollow noreferrer\">Playground</a>."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1554731275, "post_id": 55573859, "comment_id": 97848735, "body": "What is the definition of <code>ReturnType</code>? For this question we at least need to know whether it has a lifetime parameter. As stated by other commenters before, it would be best to provide a playground example that reproduces the problem."}, {"owner": {"reputation": 319, "user_id": 7698902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504b47ca61e2dea92102495da1750314?s=128&d=identicon&r=PG&f=1", "display_name": "vandenheuvel", "link": "https://stackoverflow.com/users/7698902/vandenheuvel"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1554731442, "post_id": 55573859, "comment_id": 97848843, "body": "@SvenMarnach <code>ReturnType</code> doesn&#39;t have any type parameters, I added it to the list. I am trying to create an even more minimal problem in the Playground, but I&#39;m having a hard time reproducing my problem."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1554731858, "post_id": 55573859, "comment_id": 97849120, "body": "@vandenheuvel Thanks for the info \u2013 in that case I don&#39;t know why you get this error, and I would need to see a full example reproducing the problem. You can start with your full code and remove bits that aren&#39;t relevant."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1554735606, "post_id": 55573859, "comment_id": 97851502, "body": "I tried to replicate the error by filling in the gaps with whatever seemed most appropriate, but <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=2151db32ed80a70e12f957b13cc13cb6\" rel=\"nofollow noreferrer\">this compiles</a>, which makes it almost certain that the actual error is somewhere in the code you haven&#39;t shown us."}, {"owner": {"reputation": 319, "user_id": 7698902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504b47ca61e2dea92102495da1750314?s=128&d=identicon&r=PG&f=1", "display_name": "vandenheuvel", "link": "https://stackoverflow.com/users/7698902/vandenheuvel"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1554801262, "post_id": 55573859, "comment_id": 97875231, "body": "@SvenMarnach I tried that, it made no difference. Here is a link to the playground, where I have a working version of what I&#39;m trying to achieve in the real code base. I&#39;m not successful in reproducing my issue there, it compiles: <a href=\"https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=722d5f244774213ad0fec4f41c51c943\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>"}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1554801987, "post_id": 55573859, "comment_id": 97875683, "body": "@vandenheuvel OK, it was just a guess, since I can&#39;t see any problem with the code you showed. If we can&#39;t reproduce the problem, we can&#39;t help fixing it. As I suggested before, you should start with a copy of your actual code and remove irrelevant bits, and verify that the error is still occurring after each step. This will help you to either understand the error yourself, or to create an example reproducing the problem that you can share."}, {"owner": {"reputation": 319, "user_id": 7698902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504b47ca61e2dea92102495da1750314?s=128&d=identicon&r=PG&f=1", "display_name": "vandenheuvel", "link": "https://stackoverflow.com/users/7698902/vandenheuvel"}, "reply_to_user": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1554802216, "post_id": 55573859, "comment_id": 97875838, "body": "@trentcl Thank you for the effort; I also made a compiling version (see two comments back). Could you explain why you decided to make <code>AdaptedMatrixProvider</code> a trait with a type argument, instead of a generic struct? In my specific case, I need only one version, but are there other benefits?"}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1554805158, "post_id": 55573859, "comment_id": 97877661, "body": "That was just a guess at your real code, based on the fact that <code>Tableau::from_artificial_with_provider</code> accepts an argument of type <code>&amp;Wrapper</code>, but <code>new_simple</code> looks like it should be a constructor. You provided a definition of <code>Wrapper</code> but not <code>AdaptedMatrixProvider</code>, so I figured it could be a trait. There is no design principle or justification behind it; the example is too incomplete and abstract for that."}], "answers": [{"tags": [], "owner": {"reputation": 319, "user_id": 7698902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504b47ca61e2dea92102495da1750314?s=128&d=identicon&r=PG&f=1", "display_name": "vandenheuvel", "link": "https://stackoverflow.com/users/7698902/vandenheuvel"}, "is_accepted": true, "score": 1, "last_activity_date": 1554807015, "last_edit_date": 1554807015, "creation_date": 1554806347, "answer_id": 55590883, "question_id": 55573859, "link": "https://stackoverflow.com/questions/55573859/how-do-i-specify-lifetimes-such-that-a-local-referenced-value-is-distinct-from-a/55590883#55590883", "title": "How do I specify lifetimes such that a local referenced value is distinct from a passed in reference?", "body": "<p>Changing the definition of <code>move_away</code> to the following solves the compilation error:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn move_away&lt;'a, 'b, A: Abc, S: Strategy&lt;KindTwo, WrappingAbc&lt;'b, A&gt;&gt;&gt;(\n    _argument: AnotherWrapper&lt;'a, KindTwo, WrappingAbc&lt;'b, A&gt;, S&gt;\n) {}\n</code></pre>\n\n<p>Introducing the lifetime <code>'b</code> removes the requirement that the lifetime of the inner <code>WrappingAbc</code> is just as long as <code>'a</code> as specified by the parent function.</p>\n"}], "owner": {"reputation": 319, "user_id": 7698902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504b47ca61e2dea92102495da1750314?s=128&d=identicon&r=PG&f=1", "display_name": "vandenheuvel", "link": "https://stackoverflow.com/users/7698902/vandenheuvel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 55590883, "answer_count": 1, "score": 1, "last_activity_date": 1554908727, "creation_date": 1554727632, "last_edit_date": 1554908727, "question_id": 55573859, "link": "https://stackoverflow.com/questions/55573859/how-do-i-specify-lifetimes-such-that-a-local-referenced-value-is-distinct-from-a", "title": "How do I specify lifetimes such that a local referenced value is distinct from a passed in reference?", "body": "<p>I'm creating a local struct (<code>second</code>) which contains a reference to a local variable (<code>wrapper</code>). This local variable, in turn, references a larger lifetime (<code>'a</code>). How do I show the compiler, that the lifetime of the local variable doesn't need to be as large as that larger lifetime?</p>\n\n<p>This problem is reproduced by the following code (<a href=\"https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=82bb5009248dd39d52c2d61d4d088fa4\" rel=\"nofollow noreferrer\">playground</a>):</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#![allow(dead_code)]\nuse std::marker::PhantomData;\n\ntrait Abc {}\n\nstruct ImplAbc;\nimpl Abc for ImplAbc {}\n\nstruct WrappingAbc&lt;'a, A&gt; {\n    value: &amp;'a A,\n}\nimpl&lt;'a, A: Abc&gt; Abc for WrappingAbc&lt;'a, A&gt; {}\nimpl&lt;'a, A: Abc&gt; WrappingAbc&lt;'a, A&gt; {\n    fn new(value: &amp;'a A) -&gt; Self {\n        WrappingAbc { value }\n    }\n}\n\nstruct AnotherWrapper&lt;'a, K, A, S&gt; {\n    value: &amp;'a A,\n    other: usize,\n    phantom_data: PhantomData&lt;(K, S)&gt;,\n}\nimpl&lt;'a, A: Abc, S: Strategy&lt;KindOne, A&gt;&gt; AnotherWrapper&lt;'a, KindOne, A, S&gt; {\n    fn new(value: &amp;'a A) -&gt; Self {\n        AnotherWrapper {\n            value,\n            other: 0,\n            phantom_data: PhantomData,\n        }\n    }\n}\nimpl&lt;'a, 'b, A: Abc, S: Strategy&lt;KindTwo, WrappingAbc&lt;'b, A&gt;&gt;&gt;\n    AnotherWrapper&lt;'a, KindTwo, WrappingAbc&lt;'b, A&gt;, S&gt;\n{\n    fn replace_value&lt;SOther: Strategy&lt;KindOne, A&gt;&gt;(\n        old: AnotherWrapper&lt;KindOne, A, SOther&gt;,\n        newvalue: &amp;'a WrappingAbc&lt;'b, A&gt;,\n    ) -&gt; Self {\n        AnotherWrapper {\n            value: newvalue,\n            other: old.other,\n            phantom_data: PhantomData,\n        }\n    }\n}\ntrait Kind {}\nstruct KindOne;\nimpl Kind for KindOne {}\nstruct KindTwo;\nimpl Kind for KindTwo {}\n\ntrait Strategy&lt;K: Kind, A: Abc&gt;: Sized {}\nstruct StrategyImpl;\nimpl&lt;K: Kind, A: Abc&gt; Strategy&lt;K, A&gt; for StrategyImpl {}\n\nfn f&lt;'a, A: Abc, SOne: Strategy&lt;KindOne, A&gt;, STwo: Strategy&lt;KindTwo, WrappingAbc&lt;'a, A&gt;&gt;&gt;(\n    x: &amp;'a A,\n) {\n    let first = AnotherWrapper::&lt;KindOne, A, SOne&gt;::new(x);\n    let wrapper = WrappingAbc::new(x);\n    let second = AnotherWrapper::&lt;KindTwo, WrappingAbc&lt;A&gt;, STwo&gt;::replace_value(first, &amp;wrapper);\n    move_away(second);\n}\n\nfn move_away&lt;'a, A: Abc, S: Strategy&lt;KindTwo, WrappingAbc&lt;'a, A&gt;&gt;&gt;(\n    _argument: AnotherWrapper&lt;'a, KindTwo, WrappingAbc&lt;'a, A&gt;, S&gt;,\n) {\n}\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0597]: `wrapper` does not live long enough\n  --&gt; src/lib.rs:62:88\n   |\n57 | fn f&lt;'a, A: Abc, SOne: Strategy&lt;KindOne, A&gt;, STwo: Strategy&lt;KindTwo, WrappingAbc&lt;'a, A&gt;&gt;&gt;(\n   |      -- lifetime `'a` defined here\n...\n62 |     let second = AnotherWrapper::&lt;KindTwo, WrappingAbc&lt;A&gt;, STwo&gt;::replace_value(first, &amp;wrapper);\n   |                  ----------------------------------------------------------------------^^^^^^^^-\n   |                  |                                                                     |\n   |                  |                                                                     borrowed value does not live long enough\n   |                  argument requires that `wrapper` is borrowed for `'a`\n63 |     move_away(second);\n64 | }\n   | - `wrapper` dropped here while still borrowed\n</code></pre>\n\n<p>How can I change the lifetime definitions such that <code>wrapper</code> is not required to live as long as <code>'a</code>, given that <code>second</code> is moved right after anyways? I suspect that this is related to the definition of <code>move_away</code>, because when I modify that line to this (<a href=\"https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=5001efa11e9f30989d49e57cfb4a1755\" rel=\"nofollow noreferrer\">playground</a>):</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn move_away&lt;'a, A: Abc, S: Strategy&lt;KindTwo, A&gt;&gt;(_argument: AnotherWrapper&lt;'a, KindTwo, A, S&gt;) {}\n</code></pre>\n\n<p>the code compiles.</p>\n"}, {"tags": ["rust", "borrow-checker"], "comments": [{"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1554727481, "post_id": 55573639, "comment_id": 97846184, "body": "<code>.iter()</code> returns an iterator to references of each element in the vector. You seem to want <code>into_iter()</code>."}, {"owner": {"reputation": 815, "user_id": 1150292, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VQ2aZ.jpg?s=128&g=1", "display_name": "Mara Bos", "link": "https://stackoverflow.com/users/1150292/mara-bos"}, "edited": false, "score": 0, "creation_date": 1554727790, "post_id": 55573639, "comment_id": 97846387, "body": "What&#39;s the point of <code>res</code>? Why not just return <code>neg</code> directly?"}, {"owner": {"reputation": 815, "user_id": 1150292, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VQ2aZ.jpg?s=128&g=1", "display_name": "Mara Bos", "link": "https://stackoverflow.com/users/1150292/mara-bos"}, "reply_to_user": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1554728019, "post_id": 55573639, "comment_id": 97846539, "body": "@E_net4 I wouldn&#39;t call that question a duplicate. That question you link you would only ask if you already know that you should use <code>into_iter</code> here. The answer to the question is quite relevant though. (Also, the best solution here is actually not to use <code>into_iter</code> at all, but just modify the original vector and return it.)"}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "reply_to_user": {"reputation": 815, "user_id": 1150292, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VQ2aZ.jpg?s=128&g=1", "display_name": "Mara Bos", "link": "https://stackoverflow.com/users/1150292/mara-bos"}, "edited": false, "score": 1, "creation_date": 1554728122, "post_id": 55573639, "comment_id": 97846623, "body": "@M-ou-se It&#39;s the answer that really matters when choosing a duplicate target. A question being a duplicate does not mean that the target question is exactly the same, but that its answers also address that problem. As for whether it&#39;s a good duplicate target or not, I&#39;ll leave the decision to the remaining voters."}, {"owner": {"reputation": 711, "user_id": 4914568, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-sPuWYwZq4T8/AAAAAAAAAAI/AAAAAAAAAAA/g7OO9YxrOxg/photo.jpg?sz=128", "display_name": "pd176", "link": "https://stackoverflow.com/users/4914568/pd176"}, "edited": false, "score": 0, "creation_date": 1554728737, "post_id": 55573639, "comment_id": 97847057, "body": "thanks a lot. i agree with the comments. it was a matter of knowing that into_iter was to be used in this context."}], "answers": [{"comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1554728012, "post_id": 55573815, "comment_id": 97846530, "body": "How does your answer differ from the suggested duplicate <a href=\"https://stackoverflow.com/questions/34733811/what-is-the-difference-between-iter-and-into-iter\">What is the difference between iter and into_iter?</a>?"}, {"owner": {"reputation": 815, "user_id": 1150292, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VQ2aZ.jpg?s=128&g=1", "display_name": "Mara Bos", "link": "https://stackoverflow.com/users/1150292/mara-bos"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1554728472, "post_id": 55573815, "comment_id": 97846879, "body": "@hellow That question only handles the first part. Showing that <code>into_iter()</code> and <code>collect()</code> is not the best option in this case is quite a relevant part that is not handled in that question/answer."}], "tags": [], "owner": {"reputation": 815, "user_id": 1150292, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VQ2aZ.jpg?s=128&g=1", "display_name": "Mara Bos", "link": "https://stackoverflow.com/users/1150292/mara-bos"}, "is_accepted": true, "score": 1, "last_activity_date": 1554727480, "creation_date": 1554727480, "answer_id": 55573815, "question_id": 55573639, "link": "https://stackoverflow.com/questions/55573639/cannot-move-out-borrowed-content-inside-closure/55573815#55573815", "title": "Cannot move out borrowed content inside closure", "body": "<p><code>t.0</code> tries to <em>move</em> the <code>String</code> out of the tuple that <code>t</code> refers to, but <code>t</code> only borrows it. That's because <code>.iter()</code> gives you an iterator that gives you references to the values. If you use <code>into_iter()</code> instead of <code>iter()</code> you get to <em>consume</em> all the values of <code>other</code>, instead of only getting to <em>borrow</em> them, because <code>other.into_iter()</code> consumes <code>other</code>.</p>\n\n<p>In your specific example, it would be more efficient to completely re-use <code>other</code> instead of creating a new <code>Vec</code> with the contents (partially) taken from <code>other</code>, and then dropping <code>other</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn try2(mut other: Vec&lt;(String, String)&gt;) -&gt; Vec&lt;(String, String)&gt; {\n    for x in &amp;mut other {\n        x.1 = String::from(\"abc\");\n    }\n    other\n}\n</code></pre>\n\n<p>It could be even more efficient to re-use the <code>String</code>s as well, instead of creating new ones with <code>String::from</code>.</p>\n"}], "owner": {"reputation": 711, "user_id": 4914568, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-sPuWYwZq4T8/AAAAAAAAAAI/AAAAAAAAAAA/g7OO9YxrOxg/photo.jpg?sz=128", "display_name": "pd176", "link": "https://stackoverflow.com/users/4914568/pd176"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "closed_date": 1554765979, "accepted_answer_id": 55573815, "answer_count": 1, "score": 0, "last_activity_date": 1554727576, "creation_date": 1554726877, "question_id": 55573639, "link": "https://stackoverflow.com/questions/55573639/cannot-move-out-borrowed-content-inside-closure", "closed_reason": "Duplicate", "title": "Cannot move out borrowed content inside closure", "body": "<p>Rust newbie here. I'm trying to write a function which consumes the passed vector, modifies it, appends it to another vector and returns it. </p>\n\n<p>Here is my code:</p>\n\n<pre><code>fn try(other: Vec&lt;(String, String)&gt;) -&gt; Vec&lt;(String, String)&gt; {\n    let mut res = Vec::new();\n    let mut neg: Vec&lt;(String,String)&gt; = other\n                                        .iter()\n                                        .map(|t| (t.0, String::from(\"abc\")))\n                                        .collect();\n    res.append(&amp;mut neg);\n    res\n}\n</code></pre>\n\n<p>However, I'm getting a <code>cannot move out borrowed content</code> at <code>t.0</code>. What is it that I'm doing wrong? What's getting passed into the closure?</p>\n"}, {"tags": ["error-handling", "rust", "code-reuse"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1554722103, "post_id": 55572098, "comment_id": 97842932, "body": "If you want do you own parsing, why don&#39;t you want your own error type ? <code>ParseIntError</code> doesn&#39;t impl public constructor and its field are private. So you can&#39;t"}, {"owner": {"reputation": 497, "user_id": 189911, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/297315539d718f4bcd9efe78e08c5225?s=128&d=identicon&r=PG", "display_name": "Michael Ilyin", "link": "https://stackoverflow.com/users/189911/michael-ilyin"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554722339, "post_id": 55572098, "comment_id": 97843052, "body": "I see. But as far as I see it&#39;s usual practice to reuse this error value if std parsing is used. I don&#39;t see why should I switch to my own type just because I changed my internal implementation from calling library function to own parsing"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554722617, "post_id": 55572098, "comment_id": 97843213, "body": "without <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>, I can&#39;t answer, you claim &quot;I&#39;m implementing parsing of input string myself&quot;, you never said &quot;I changed my internal implementation from calling library function to own parsing&quot; in your question, so please <a href=\"https://stackoverflow.com/posts/55572098/edit\">edit</a> your question to include an <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>, and be more accurate about what you want and what you do"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1554722633, "post_id": 55572098, "comment_id": 97843224, "body": "You could provoke the same error and then return that, e.g. <code>&quot;a&quot;.parse::&lt;i32&gt;()?</code> (dont&#39; take this serious)"}, {"owner": {"reputation": 497, "user_id": 189911, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/297315539d718f4bcd9efe78e08c5225?s=128&d=identicon&r=PG", "display_name": "Michael Ilyin", "link": "https://stackoverflow.com/users/189911/michael-ilyin"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554723934, "post_id": 55572098, "comment_id": 97844025, "body": "@Stargateur here is request to fix this issue: <a href=\"https://github.com/rust-lang/rfcs/issues/1143\" rel=\"nofollow noreferrer\">github.com/rust-lang/rfcs/issues/1143</a>. Unfortunately it&#39;s open since 2015 and seems no one cares about it :-("}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1554724412, "post_id": 55572098, "comment_id": 97844301, "body": "I don&#39;t think it&#39;s would be a good thing to do, maybe you could use nightly feature, <a href=\"https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=43c2a9bce39c5ccd1120a36edceefbad\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>. Still waiting my <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>"}, {"owner": {"reputation": 497, "user_id": 189911, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/297315539d718f4bcd9efe78e08c5225?s=128&d=identicon&r=PG", "display_name": "Michael Ilyin", "link": "https://stackoverflow.com/users/189911/michael-ilyin"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554726066, "post_id": 55572098, "comment_id": 97845306, "body": "@Stargateur Thank you for this &#39;int_error_matching&#39; feature. It&#39;s not a solution but at least some approach to it. Example - I don&#39;t think it&#39;s necessary here. The situation is already clear enough: I can&#39;t create ParseIntError myself but can reuse nightly IntErrorKind for my own error type."}], "answers": [{"comments": [{"owner": {"reputation": 462, "user_id": 4175046, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WfAgw.jpg?s=128&g=1", "display_name": "William Hammond", "link": "https://stackoverflow.com/users/4175046/william-hammond"}, "edited": false, "score": 0, "creation_date": 1618881785, "post_id": 55616075, "comment_id": 118731594, "body": "Isn&#39;t there value in making it constructable for testing purposes?"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "reply_to_user": {"reputation": 462, "user_id": 4175046, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WfAgw.jpg?s=128&g=1", "display_name": "William Hammond", "link": "https://stackoverflow.com/users/4175046/william-hammond"}, "edited": false, "score": 0, "creation_date": 1618891252, "post_id": 55616075, "comment_id": 118733253, "body": "@WilliamHammond can <code>kind()</code> and match with <code>IntErrorKind</code> if you realty need to. Or just <code>is_err()</code>."}], "tags": [], "owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "is_accepted": true, "score": 4, "last_activity_date": 1554909380, "creation_date": 1554909380, "answer_id": 55616075, "question_id": 55572098, "link": "https://stackoverflow.com/questions/55572098/how-to-construct-a-parseinterror-in-my-own-code/55616075#55616075", "title": "How to construct a ParseIntError in my own code?", "body": "<p>There is currently no way to construct a <a href=\"https://doc.rust-lang.org/std/num/struct.ParseIntError.html\" rel=\"nofollow noreferrer\"><code>ParseIntError</code></a> yourself. As you find it, there is a open <a href=\"https://github.com/rust-lang/rfcs/issues/1143\" rel=\"nofollow noreferrer\"><code>issue</code></a> that ask to make it public. However, I don't think it's a good thing.</p>\n\n<p><code>ParseIntError</code> is the error of <code>num</code> module. It isn't made to be use by everyone that would implement a parsing crate because you <strong>should</strong> have your own potential error. You could use <a href=\"https://doc.rust-lang.org/core/num/enum.IntErrorKind.html\" rel=\"nofollow noreferrer\"><code>IntErrorKind</code></a> but I still don't think is a good thing cause you could end by not having the same error.</p>\n\n<p>So, I think you should have your own error type, and maybe use the same design, have an <code>enum</code> with <code>#[non_exhaustive]</code> attribute. There is a lot of <a href=\"https://crates.io/keywords/error\" rel=\"nofollow noreferrer\">crates</a> that make error more easy to create. You should not hesitate to use your own error in your own code.</p>\n"}], "owner": {"reputation": 497, "user_id": 189911, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/297315539d718f4bcd9efe78e08c5225?s=128&d=identicon&r=PG", "display_name": "Michael Ilyin", "link": "https://stackoverflow.com/users/189911/michael-ilyin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 954, "favorite_count": 0, "accepted_answer_id": 55616075, "answer_count": 1, "score": 2, "last_activity_date": 1554909380, "creation_date": 1554721827, "last_edit_date": 1554907474, "question_id": 55572098, "link": "https://stackoverflow.com/questions/55572098/how-to-construct-a-parseinterror-in-my-own-code", "title": "How to construct a ParseIntError in my own code?", "body": "<p>I want to reuse the standard library's <a href=\"https://doc.rust-lang.org/std/num/struct.ParseIntError.html\" rel=\"nofollow noreferrer\"><code>ParseIntError</code></a> in my function. However, I'm implementing parsing of the input string myself, so I don't need to return an error value returned by the standard library.</p>\n\n<p>I didn't find a way to construct <code>ParseIntError</code> value. The only solution I found looks like this:</p>\n\n<pre><code>use std::num::ParseIntError;\n\nfn from_str_radix(s: &amp;str, radix: u32) -&gt; Result&lt;(), ParseIntError&gt; {\n    let error_empty = \"\".parse::&lt;i32&gt;().expect_err(\"get empty input error\");\n    let error_invalid_digit = \"Z\".parse::&lt;i32&gt;().expect_err(\"get invalid digit error\");\n\n    if s.is_empty() {\n        return Err(error_empty);\n    }\n\n    for c in s.chars().rev() {\n        match c.to_digit(radix) {\n            None =&gt; return Err(error_invalid_digit),\n            _ =&gt; unimplemented!(),\n        }\n    }\n\n    Ok(())\n}\n</code></pre>\n\n<p>Is there more elegant way to return <code>ParseIntError</code> from my own code?</p>\n"}, {"tags": ["generics", "rust", "constraints", "traits"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1554710811, "post_id": 55568655, "comment_id": 97836626, "body": "You mean something similar to this? <a href=\"https://stackoverflow.com/questions/55553281/is-it-possible-to-automatically-implement-a-trait-for-any-tuple-that-is-made-up\" title=\"is it possible to automatically implement a trait for any tuple that is made up\">stackoverflow.com/questions/55553281/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 51497, "user_id": 49246, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c421b43470bb8d3c099c5a847e588549?s=128&d=identicon&r=PG", "display_name": "starblue", "link": "https://stackoverflow.com/users/49246/starblue"}, "is_accepted": true, "score": 22, "last_activity_date": 1554711626, "creation_date": 1554711626, "answer_id": 55569002, "question_id": 55568655, "link": "https://stackoverflow.com/questions/55568655/how-to-avoid-repetitive-long-generic-constraints-in-rust/55569002#55569002", "title": "How to avoid repetitive long generic constraints in Rust", "body": "<p>You can add a <em>blanket implementation</em>:</p>\n\n<pre><code>impl&lt;T&gt; LongNumValue for T \nwhere\n    T: Integer + MulAssign + CheckedMul + CheckedAdd + Copy + From&lt;u8&gt; {}\n</code></pre>\n"}], "owner": {"reputation": 497, "user_id": 189911, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/297315539d718f4bcd9efe78e08c5225?s=128&d=identicon&r=PG", "display_name": "Michael Ilyin", "link": "https://stackoverflow.com/users/189911/michael-ilyin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 975, "favorite_count": 0, "accepted_answer_id": 55569002, "answer_count": 1, "score": 16, "last_activity_date": 1554711626, "creation_date": 1554710197, "question_id": 55568655, "link": "https://stackoverflow.com/questions/55568655/how-to-avoid-repetitive-long-generic-constraints-in-rust", "title": "How to avoid repetitive long generic constraints in Rust", "body": "<p>I'm trying to make my own implementation of big integers (just for education). The implementation is generic by data type:</p>\n\n<pre><code>struct LongNum&lt;T&gt;\nwhere T: Integer + MulAssign + CheckedMul + CheckedAdd + Copy + From&lt;u8&gt;\n{\n    values: Vec&lt;T&gt;,\n    powers: Vec&lt;u8&gt;,\n    radix: u8,\n}\n</code></pre>\n\n<p>The problem is that I need to repeat this verbose constraint for T in all impls. It's too cumbersome.</p>\n\n<p>I can make my own trait combining these constraints, like this:</p>\n\n<pre><code>trait LongNumValue: Integer + MulAssign + CheckedMul + CheckedAdd + Copy + From&lt;u8&gt; {}\n\nstruct LongNum&lt;T: LongNumValue&gt;\n{\n    values: Vec&lt;T&gt;,\n    powers: Vec&lt;u8&gt;,\n    radix: u8,\n}\n</code></pre>\n\n<p>But in this case I have to add impls for this LongNumValue trait to all types which can be used in LongNum:</p>\n\n<pre><code>impl LongNumValue for u8 {}\nimpl LongNumValue for u16 {}\nimpl LongNumValue for u32 {}\n...\n</code></pre>\n\n<p>This means that if I don't add some type to this list of impls, the user of my crate will be unable to use this type for LongNum, even if this type is passes all constraints.</p>\n\n<p>Is there any way to avoid writing long repetitive costraints without adding unnecessary restrictions to user?</p>\n"}, {"tags": ["string", "rust"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1554703627, "post_id": 55566452, "comment_id": 97833291, "body": "I recomend you to read <a href=\"https://doc.rust-lang.org/stable/book/\" rel=\"nofollow noreferrer\">the book</a> as well as using a search engine of your trust, e.g. duckduckgo <a href=\"https://duckduckgo.com/?q=rust+collect+doc\" rel=\"nofollow noreferrer\">duckduckgo.com/?q=rust+collect+doc</a> ."}, {"owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "edited": false, "score": 6, "creation_date": 1554705418, "post_id": 55566452, "comment_id": 97833973, "body": "The rust docs include a search engine: <a href=\"https://doc.rust-lang.org/stable/std/index.html?search=collect\" rel=\"nofollow noreferrer\">collect</a>"}, {"owner": {"reputation": 1476, "user_id": 9383219, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97fabe5d903589acb1dfdf17fe4e405e?s=128&d=identicon&r=PG&f=1", "display_name": "cyclaminist", "link": "https://stackoverflow.com/users/9383219/cyclaminist"}, "edited": false, "score": 6, "creation_date": 1554706339, "post_id": 55566452, "comment_id": 97834395, "body": "Can also search the documentation of the Rust standard library directly from DuckDuckGo: <a href=\"https://duckduckgo.com/?q=!rust+collect\" rel=\"nofollow noreferrer\">duckduckgo.com/?q=!rust+collect</a>"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "reply_to_user": {"reputation": 1476, "user_id": 9383219, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97fabe5d903589acb1dfdf17fe4e405e?s=128&d=identicon&r=PG&f=1", "display_name": "cyclaminist", "link": "https://stackoverflow.com/users/9383219/cyclaminist"}, "edited": false, "score": 1, "creation_date": 1554706534, "post_id": 55566452, "comment_id": 97834484, "body": "@cyclaminist amazing! My mind is blown away today \ud83e\udd2f"}, {"owner": {"reputation": 5700, "user_id": 3131852, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/26365707ecfa02e221f5192aaaa29a43?s=128&d=identicon&r=PG", "display_name": "Tim Diekmann", "link": "https://stackoverflow.com/users/3131852/tim-diekmann"}, "reply_to_user": {"reputation": 1476, "user_id": 9383219, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97fabe5d903589acb1dfdf17fe4e405e?s=128&d=identicon&r=PG&f=1", "display_name": "cyclaminist", "link": "https://stackoverflow.com/users/9383219/cyclaminist"}, "edited": false, "score": 0, "creation_date": 1554761951, "post_id": 55566452, "comment_id": 97863243, "body": "@cyclaminist Wow, this will safe me some time in the future..."}], "answers": [{"comments": [{"owner": {"reputation": 17135, "user_id": 581190, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a503f14866aaa083332c81264860ac8e?s=128&d=identicon&r=PG", "display_name": "zrzka", "link": "https://stackoverflow.com/users/581190/zrzka"}, "edited": false, "score": 3, "creation_date": 1554706894, "post_id": 55566493, "comment_id": 97834647, "body": "To be more precise - <a href=\"https://doc.rust-lang.org/std/primitive.str.html#method.split\" rel=\"nofollow noreferrer\">split</a> returns <a href=\"https://doc.rust-lang.org/std/str/struct.Split.html\" rel=\"nofollow noreferrer\">Split</a> structure. <code>Split</code> implements <a href=\"https://doc.rust-lang.org/std/str/struct.Split.html#impl-Iterator\" rel=\"nofollow noreferrer\">Iterator</a> trait. <code>Iterator</code> trait has <a href=\"https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.collect\" rel=\"nofollow noreferrer\">collect</a> method."}], "tags": [], "owner": {"reputation": 2553, "user_id": 2899162, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e232dd2eb7990524453d85d7a89d7388?s=128&d=identicon&r=PG&f=1", "display_name": "druckermanly", "link": "https://stackoverflow.com/users/2899162/druckermanly"}, "is_accepted": true, "score": 2, "last_activity_date": 1554762087, "last_edit_date": 1554762087, "creation_date": 1554699353, "answer_id": 55566493, "question_id": 55566452, "link": "https://stackoverflow.com/questions/55566452/where-do-you-find-the-rust-docs-for-collect-after-you-split-a-string/55566493#55566493", "title": "Where do you find the Rust docs for collect() after you split a string?", "body": "<p><a href=\"https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.collect\" rel=\"nofollow noreferrer\">https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.collect</a></p>\n\n<p><a href=\"https://doc.rust-lang.org/std/primitive.str.html#method.split\" rel=\"nofollow noreferrer\"><code>split()</code></a> returns an iterator, so you're looking for the <a href=\"https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.collect\" rel=\"nofollow noreferrer\"><code>collect</code></a> function of the <a href=\"https://doc.rust-lang.org/std/iter/trait.Iterator.html\" rel=\"nofollow noreferrer\"><code>Iterator</code></a> trait.</p>\n"}], "owner": {"reputation": 15015, "user_id": 1191635, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/I8bEt.jpg?s=128&g=1", "display_name": "Armeen Harwood", "link": "https://stackoverflow.com/users/1191635/armeen-harwood"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 55566493, "answer_count": 1, "score": -2, "last_activity_date": 1554908239, "creation_date": 1554699166, "last_edit_date": 1554908239, "question_id": 55566452, "link": "https://stackoverflow.com/questions/55566452/where-do-you-find-the-rust-docs-for-collect-after-you-split-a-string", "title": "Where do you find the Rust docs for collect() after you split a string?", "body": "<p>Where can I find the docs on <code>.collect()</code>?</p>\n\n<pre><code>fn main() {\n    let split = \"some string 123 ffd\".split(\"123\");\n    let vec: Vec&lt;&amp;str&gt; = split.collect();\n    println!(\"{:#?}\",vec);\n}\n</code></pre>\n"}, {"tags": ["oauth-2.0", "rust", "google-speech-api"], "comments": [{"owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "edited": false, "score": 0, "creation_date": 1554705891, "post_id": 55565561, "comment_id": 97834191, "body": "Have you tried doing what it says in the comments? Namely filling the fields of <a href=\"https://docs.rs/google-speech1/1.0.8+20181005/google_speech1/struct.RecognizeRequest.html\" rel=\"nofollow noreferrer\">RecognizeRequest</a> with the relevant information?"}, {"owner": {"reputation": 342, "user_id": 7510208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42ec19c66695281b80383961c1fd1da0?s=128&d=identicon&r=PG&f=1", "display_name": "roboris", "link": "https://stackoverflow.com/users/7510208/roboris"}, "reply_to_user": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "edited": false, "score": 0, "creation_date": 1554719753, "post_id": 55565561, "comment_id": 97841614, "body": "@Jmb tried just now, but was hoping if someone has used this before, could provide some basic base working code. Will try again later. Thank you."}, {"owner": {"reputation": 342, "user_id": 7510208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42ec19c66695281b80383961c1fd1da0?s=128&d=identicon&r=PG&f=1", "display_name": "roboris", "link": "https://stackoverflow.com/users/7510208/roboris"}, "reply_to_user": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "edited": false, "score": 0, "creation_date": 1554779074, "post_id": 55565561, "comment_id": 97866619, "body": "@Jmb this is really giving me a hard time. I made some code for speech to text request, but can&#39;t even test it because I&#39;m stuck at the following error:   &quot;<b>Token retrieval failed with error: Invalid Scope: &#39;no description provided&#39;</b>&quot;."}, {"owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "edited": false, "score": 0, "creation_date": 1554791048, "post_id": 55565561, "comment_id": 97869802, "body": "Can you add the code you tried to the question along with the full error message?"}, {"owner": {"reputation": 342, "user_id": 7510208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42ec19c66695281b80383961c1fd1da0?s=128&d=identicon&r=PG&f=1", "display_name": "roboris", "link": "https://stackoverflow.com/users/7510208/roboris"}, "reply_to_user": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "edited": false, "score": 0, "creation_date": 1554852787, "post_id": 55565561, "comment_id": 97900985, "body": "@Jmb I have updated the question with the requested information."}], "answers": [{"comments": [{"owner": {"reputation": 342, "user_id": 7510208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42ec19c66695281b80383961c1fd1da0?s=128&d=identicon&r=PG&f=1", "display_name": "roboris", "link": "https://stackoverflow.com/users/7510208/roboris"}, "edited": false, "score": 0, "creation_date": 1554890590, "post_id": 55606283, "comment_id": 97914139, "body": "I&#39;ve looked at the source code of the library, and it injects that url in each request (or is that code broken?), I even tried injecting it myself, but in any case it is something that should be in request (as far as I understand it). Have you tried making that code work on your end or can you specifically give me the steps I am missing, if any? I appreciate your efforts, but this remains a question about a Rust library that allows to use Google Api and I&#39;m looking for proof that it works (and what to fix to make it work), as there is so little information about it online."}, {"owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "reply_to_user": {"reputation": 342, "user_id": 7510208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42ec19c66695281b80383961c1fd1da0?s=128&d=identicon&r=PG&f=1", "display_name": "roboris", "link": "https://stackoverflow.com/users/7510208/roboris"}, "edited": false, "score": 0, "creation_date": 1554898513, "post_id": 55606283, "comment_id": 97918666, "body": "The library is right to inject that URL. The step you are missing is <i>before</i> you get to the rust part, when you are generating the json file containing the OAuth access tokens. How exactly have you generated that json file? With what code or what tool and what parameters?"}, {"owner": {"reputation": 342, "user_id": 7510208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42ec19c66695281b80383961c1fd1da0?s=128&d=identicon&r=PG&f=1", "display_name": "roboris", "link": "https://stackoverflow.com/users/7510208/roboris"}, "edited": false, "score": 0, "creation_date": 1554930208, "post_id": 55606283, "comment_id": 97935537, "body": "I logged into Google API console, created a project, enabled google speech to text api for it, then created a oauth2 client with type other and then once it was created I was able to download the JSON file, then am loading that from app with the code i posted."}, {"owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "reply_to_user": {"reputation": 342, "user_id": 7510208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42ec19c66695281b80383961c1fd1da0?s=128&d=identicon&r=PG&f=1", "display_name": "roboris", "link": "https://stackoverflow.com/users/7510208/roboris"}, "edited": false, "score": 0, "creation_date": 1554963913, "post_id": 55606283, "comment_id": 97943928, "body": "I&#39;m not sure what you call a &quot;<i>oauth2 client with type other</i>&quot;. According to the OAuth2 RFC sections <a href=\"https://tools.ietf.org/html/rfc6749#section-4.1.1\" rel=\"nofollow noreferrer\">4.1.1</a> and <a href=\"https://tools.ietf.org/html/rfc6749#section-3.3\" rel=\"nofollow noreferrer\">3.3</a>, when the client requests an authorization it should specify the <code>scope</code> of that authorization. So did you give the <code>https:&#47;&#47;www.googleapis.com&#47;auth&#47;cloud-platform</code> URL anywhere in your &quot;<i>oauth2 client with type other</i>&quot;?"}, {"owner": {"reputation": 342, "user_id": 7510208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42ec19c66695281b80383961c1fd1da0?s=128&d=identicon&r=PG&f=1", "display_name": "roboris", "link": "https://stackoverflow.com/users/7510208/roboris"}, "edited": false, "score": 0, "creation_date": 1555038749, "post_id": 55606283, "comment_id": 97977565, "body": "As stated since the beginning I was hoping to get confirmation from someone that this library is actually working, but I can&#39;t argue with the fact that there indeed seems to be something wrong with my Oauth2 client, trying to figure it out. Now I got to adding scope to it, but next step requires validation but asks for validation url and I have no idea what to put, it&#39;s becoming clear that I don&#39;t know much about using those Google Api... will report here if I get it to work, in the meantime if you have steps for creating a oauth2 client compatible with this library, that would be nice :)."}, {"owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "reply_to_user": {"reputation": 342, "user_id": 7510208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42ec19c66695281b80383961c1fd1da0?s=128&d=identicon&r=PG&f=1", "display_name": "roboris", "link": "https://stackoverflow.com/users/7510208/roboris"}, "edited": false, "score": 0, "creation_date": 1555050259, "post_id": 55606283, "comment_id": 97980692, "body": "Well I&#39;ve never written an oauth2 client, but I have performed the oauth2 client operations by hand in  a web browser (for the Amazon API, not Google). <a href=\"https://developers.google.com/identity/protocols/OAuth2UserAgent\" rel=\"nofollow noreferrer\">This page</a> should show you what requests to make (choose &quot;OAUTH 2.0 ENDPOINT&quot; instead of &quot;JS CLIENT LIBRARY&quot; to see the http requests you need to make)."}], "tags": [], "owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "is_accepted": false, "score": 2, "last_activity_date": 1554878689, "creation_date": 1554878689, "answer_id": 55606283, "question_id": 55565561, "link": "https://stackoverflow.com/questions/55565561/how-to-send-a-speech-to-text-request-using-google-speech1-in-rust/55606283#55606283", "title": "How to send a speech to text request using google_speech1 in Rust?", "body": "<p>The error you get originates from <a href=\"https://github.com/dermesser/yup-oauth2/blob/7e26db39ca4a17f0057c2b106bcd6fd654eb986c/src/types.rs#L40\" rel=\"nofollow noreferrer\">here</a> and means that the OAuth <a href=\"https://www.oauth.com/oauth2-servers/scope/\" rel=\"nofollow noreferrer\">scope</a> you used <em>when generating your credentials file</em> doesn't allow you to access the Google speech API. So the problem is not in your Rust code, but instead in the script you used to generate your OAuth access tokens.</p>\n\n<p>Basically, this means that when you generated your OAuth json file, you requested access to the Google API in a general way, but you didn't say which specific APIs you meant to use. According to <a href=\"https://developers.google.com/identity/protocols/googlescopes\" rel=\"nofollow noreferrer\">this document</a>, you need to request access to the <code>https://www.googleapis.com/auth/cloud-platform</code> scope.</p>\n"}, {"tags": [], "owner": {"reputation": 216, "user_id": 7318742, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/iK7sB.jpg?s=128&g=1", "display_name": "hisairnessag3", "link": "https://stackoverflow.com/users/7318742/hisairnessag3"}, "is_accepted": false, "score": 0, "last_activity_date": 1576757282, "creation_date": 1576757282, "answer_id": 59409490, "question_id": 55565561, "link": "https://stackoverflow.com/questions/55565561/how-to-send-a-speech-to-text-request-using-google-speech1-in-rust/59409490#59409490", "title": "How to send a speech to text request using google_speech1 in Rust?", "body": "<p>You are missing the flow param to Authenticator. This is how you get the access token. You create an Enum using FlowType.</p>\n\n<p>example:</p>\n\n<pre><code>    use oauth2::{ApplicationSecret, Authenticator, DefaultAuthenticatorDelegate, MemoryStorage,FlowType};\n\n\n\nlet Flo = FlowType::InstalledInteractive;\nlet auth = Authenticator::new(\n                &amp;secret,\n                DefaultAuthenticatorDelegate,\n                hyper::Client::with_connector(hyper::net::HttpsConnector::new(\n                    hyper_rustls::TlsClient::new(),\n                )),\n                &lt;MemoryStorage as Default&gt;::default(),\n                None,)\n</code></pre>\n\n<p>See here: <a href=\"https://docs.rs/yup-oauth2/1.0.3/yup_oauth2/enum.FlowType.html\" rel=\"nofollow noreferrer\">https://docs.rs/yup-oauth2/1.0.3/yup_oauth2/enum.FlowType.html</a></p>\n\n<p>Not exactly easy to figure out.</p>\n"}], "owner": {"reputation": 342, "user_id": 7510208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42ec19c66695281b80383961c1fd1da0?s=128&d=identicon&r=PG&f=1", "display_name": "roboris", "link": "https://stackoverflow.com/users/7510208/roboris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 385, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1576757282, "creation_date": 1554691178, "last_edit_date": 1554878710, "question_id": 55565561, "link": "https://stackoverflow.com/questions/55565561/how-to-send-a-speech-to-text-request-using-google-speech1-in-rust", "title": "How to send a speech to text request using google_speech1 in Rust?", "body": "<p>I am trying to use google_speech1 for Rust, but the documentation provides incomplete examples, which makes it very hard for me, being both new at Rust and at using Google Speech Api, to figure out how to do send a speech to text request.</p>\n\n<p>More specifically, I would like to be able to send a local audio file, indicate the source language and retrieve the transcription.</p>\n\n<p>Here is the closest I could find in the official documentation(<a href=\"https://docs.rs/google-speech1/1.0.8+20181005/google_speech1/struct.SpeechRecognizeCall.html\" rel=\"nofollow noreferrer\">https://docs.rs/google-speech1/1.0.8+20181005/google_speech1/struct.SpeechRecognizeCall.html</a>):</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use speech1::RecognizeRequest;\n\n// As the method needs a request, you would usually fill it with the desired information\n// into the respective structure. Some of the parts shown here might not be applicable !\n// Values shown here are possibly random and not representative !\nlet mut req = RecognizeRequest::default();\n\n// You can configure optional parameters by calling the respective setters at will, and\n// execute the final call using `doit()`.\n// Values shown here are possibly random and not representative !\nlet result = hub.speech().recognize(req)\n             .doit();\n</code></pre>\n\n<p><strong>UPDATE</strong>\nTaking a step back, even simple examples provided on the website don't seem to run properly. Here is some sample very basic code:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub mod speech_api_demo {\n    extern crate google_speech1 as speech1;\n    extern crate hyper;\n    extern crate hyper_rustls;\n    extern crate yup_oauth2 as oauth2;\n    use oauth2::{ApplicationSecret, Authenticator, DefaultAuthenticatorDelegate, MemoryStorage};\n    use speech1::Speech;\n    use speech1::{Error, Result};\n    use std::fs::File;\n    use std::io::Read;\n\n    #[derive(Deserialize, Serialize, Default)]\n    pub struct ConsoleApplicationSecret {\n        pub web: Option&lt;ApplicationSecret&gt;,\n        pub installed: Option&lt;ApplicationSecret&gt;,\n    }\n\n    pub fn speech_sample_demo() {\n        /*\n           Custom code to generate application secret\n        */\n\n        let mut file =\n            File::open(\"C:\\\\Users\\\\YOURNAME\\\\.google-service-cli\\\\speech1-secret.json\").unwrap();\n        let mut data = String::new();\n        file.read_to_string(&amp;mut data).unwrap();\n\n        use serde_json as json;\n        let my_console_secret = json::from_str::&lt;ConsoleApplicationSecret&gt;(&amp;data);\n\n        assert!(my_console_secret.is_ok());\n        let unwrappedConsoleSecret = my_console_secret.unwrap();\n        assert!(unwrappedConsoleSecret.installed.is_some() &amp;&amp; unwrappedConsoleSecret.web.is_none());\n\n        let secret: ApplicationSecret = unwrappedConsoleSecret.installed.unwrap();\n\n        /*\n           Custom code to generate application secret - END\n        */\n\n        // Instantiate the authenticator. It will choose a suitable authentication flow for you,\n        // unless you replace  `None` with the desired Flow.\n        // Provide your own `AuthenticatorDelegate` to adjust the way it operates and get feedback about\n        // what's going on. You probably want to bring in your own `TokenStorage` to persist tokens and\n        // retrieve them from storage.\n        let auth = Authenticator::new(\n            &amp;secret,\n            DefaultAuthenticatorDelegate,\n            hyper::Client::with_connector(hyper::net::HttpsConnector::new(\n                hyper_rustls::TlsClient::new(),\n            )),\n            &lt;MemoryStorage as Default&gt;::default(),\n            None,\n        );\n        let mut hub = Speech::new(\n            hyper::Client::with_connector(hyper::net::HttpsConnector::new(\n                hyper_rustls::TlsClient::new(),\n            )),\n            auth,\n        );\n\n        let result = hub.operations().get(\"name\").doit();\n\n        match result {\n            Err(e) =&gt; match e {\n                // The Error enum provides details about what exactly happened.\n                // You can also just use its `Debug`, `Display` or `Error` traits\n                Error::HttpError(_)\n                | Error::MissingAPIKey\n                | Error::MissingToken(_)\n                | Error::Cancelled\n                | Error::UploadSizeLimitExceeded(_, _)\n                | Error::Failure(_)\n                | Error::BadRequest(_)\n                | Error::FieldClash(_)\n                | Error::JsonDecodeError(_, _) =&gt; (println!(\"{}\", e)),\n            },\n            Ok(res) =&gt; println!(\"Success: {:?}\", res),\n        }\n    }\n}\n\n</code></pre>\n\n<p>Running this code (calling speech_sample_demo) gives the following error: </p>\n\n<blockquote>\n  <p>Token retrieval failed with error: Invalid Scope: 'no description\n  provided'</p>\n</blockquote>\n\n<p>I also tried some very ugly code to force the scope into the request, but it did not make any difference. I am having a hard time understanding what this error means. Am I missing something in my request or is it something else getting in the way at the other end? Or maybe that api code library is just broken? </p>\n\n<p>Please also note that client id and client secret provided by default don't work anymore, when I was using those it would say that account is deleted.</p>\n\n<p>I then set up an OAuth 2.0 client and generated the json file which I copied over to default location and then started getting the error above. Maybe it is just me not setting Google Api account properly, but in any case would be great if someone else could try it out to see if I am the only one having those issues.</p>\n\n<p>Once I get over running such a simple request, I have some more code ready to be tested that sends over an audio file, but for now it fails very early on in the process.</p>\n"}, {"tags": ["rust", "traits"], "comments": [{"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1554686605, "post_id": 55564804, "comment_id": 97829826, "body": "It looks like this is not available right now in Rust. There is <a href=\"https://github.com/rust-lang/rfcs/issues/1053\" rel=\"nofollow noreferrer\">active discussion</a> on the repo about it, but no commitment so far. The term you&#39;re looking for is &quot;negative trait bounds&quot;."}, {"owner": {"reputation": 126353, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1554687020, "post_id": 55564804, "comment_id": 97829888, "body": "Instead of a Shortcut trait, have a compilation interface which implements <code>preprocess</code> and the rest of the compilation process. Those which do not need preprocessing can implement an empty function. This is an OO approach rather than a procedural approach, you&#39;re asking the thing to do its own preprocessing."}], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 5, "last_activity_date": 1554688234, "creation_date": 1554688234, "answer_id": 55565283, "question_id": 55564804, "link": "https://stackoverflow.com/questions/55564804/can-i-have-a-generic-function-that-accepts-all-types-that-do-not-implement-a-tra/55565283#55565283", "title": "Can I have a generic function that accepts all types that do not implement a trait?", "body": "<p>No, you cannot. </p>\n\n<p>Instead, you can use the <em>unstable</em> specialization feature the other way, to opt-in to more efficient processing:</p>\n\n<pre><code>#![feature(specialization)]\n\ntrait Process {\n    fn process(self);\n}\n\ntrait Short {}\n\nimpl Short for i32 {}\n\nimpl&lt;T&gt; Process for T\nwhere\n    T: std::fmt::Debug,\n{\n    default fn process(self) {\n        println!(\"Processing {:?}\", self)\n    }\n}\n\nimpl&lt;T&gt; Process for T\nwhere\n    T: std::fmt::Debug + Short,\n{\n    fn process(self) {\n        println!(\"Shortcut {:?}\", self)\n    }\n}\n\nfn main() {\n    42i32.process();\n    vec![1, 2, 3].process();\n}\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>Shortcut 42\nProcessing [1, 2, 3]\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/46779310/155423\">What are the possible operators for traits in a where clause in Rust?</a></li>\n<li><a href=\"https://stackoverflow.com/q/50492087/155423\">Can I define a trait whose implementations must be `!Send`?</a></li>\n<li><a href=\"https://stackoverflow.com/q/30291217/155423\">What does the exclamation point mean in a trait implementation?</a></li>\n</ul>\n"}], "owner": {"reputation": 6932, "user_id": 774236, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/7e46879a230ff1e28cd975e3b0a0873b?s=128&d=identicon&r=PG", "display_name": "Matteo Monti", "link": "https://stackoverflow.com/users/774236/matteo-monti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1554688234, "creation_date": 1554682464, "last_edit_date": 1554687876, "question_id": 55564804, "link": "https://stackoverflow.com/questions/55564804/can-i-have-a-generic-function-that-accepts-all-types-that-do-not-implement-a-tra", "title": "Can I have a generic function that accepts all types that do not implement a trait?", "body": "<p>I know that I can have functions accept only types that implement a given trait. For example, I can</p>\n\n<pre><code>fn f&lt;T&gt;()\nwhere\n    T: MyTrait,\n{\n    // Super useful stuff\n}\n</code></pre>\n\n<p>What if I  wanted to implement a function that accepts anything that does <strong>not</strong> implement a given trait? For example, say that I have some computation that either:</p>\n\n<ul>\n<li>Requires some known, lengthy preprocessing, or</li>\n<li>Has a specific way of short-cutting through that preprocessing.</li>\n</ul>\n\n<p>What I would like to do is something like:</p>\n\n<pre><code>fn preprocess&lt;T&gt;(computation: &amp;mut T)\nwhere\n    T: !Shortcut,\n{\n    // Carry out the expensive precomputation.\n}\n</code></pre>\n\n<p>I tried figuring out how to work around this problem, but I don't seem to be able to figure out any solution.</p>\n"}, {"tags": ["string", "rust"], "comments": [{"owner": {"reputation": 5700, "user_id": 3131852, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/26365707ecfa02e221f5192aaaa29a43?s=128&d=identicon&r=PG", "display_name": "Tim Diekmann", "link": "https://stackoverflow.com/users/3131852/tim-diekmann"}, "edited": false, "score": 4, "creation_date": 1554681197, "post_id": 55564384, "comment_id": 97828960, "body": "You may also take a look at <a href=\"https://doc.rust-lang.org/std/collections/struct.HashSet.html\" rel=\"nofollow noreferrer\"><code>HashSet</code></a>. For small sets, a slice may be more efficient, but if it grows in size, a set should be used."}, {"owner": {"reputation": 107, "user_id": 10474463, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-N3OhE_gdVLk/AAAAAAAAAAI/AAAAAAAAAgQ/lA1l0vYVtDU/photo.jpg?sz=128", "display_name": "Ricardo Prieto", "link": "https://stackoverflow.com/users/10474463/ricardo-prieto"}, "reply_to_user": {"reputation": 5700, "user_id": 3131852, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/26365707ecfa02e221f5192aaaa29a43?s=128&d=identicon&r=PG", "display_name": "Tim Diekmann", "link": "https://stackoverflow.com/users/3131852/tim-diekmann"}, "edited": false, "score": 0, "creation_date": 1554688468, "post_id": 55564384, "comment_id": 97830124, "body": "Thank you for your comment. I&#39;m going to read the Hashset documentation."}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 4, "creation_date": 1554687542, "post_id": 55564582, "comment_id": 97829980, "body": "Note that this is the same algorithm as using a <code>for</code> loop; it is not more efficient."}], "tags": [], "owner": {"reputation": 29810, "user_id": 423170, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/H9kNQ.png?s=128&g=1", "display_name": "Frxstrem", "link": "https://stackoverflow.com/users/423170/frxstrem"}, "is_accepted": true, "score": 3, "last_activity_date": 1554679991, "creation_date": 1554679991, "answer_id": 55564582, "question_id": 55564384, "link": "https://stackoverflow.com/questions/55564384/how-do-i-test-if-a-letter-is-in-a-list/55564582#55564582", "title": "How do I test if a letter is in a list?", "body": "<p>You can use <code>vocales.<a href=\"https://doc.rust-lang.org/std/primitive.slice.html#method.contains\" rel=\"nofollow noreferrer\">contains</a>(&amp;letra)</code>, which will be true if the array <code>vocales</code> contains the element <code>letra</code>:</p>\n\n<pre><code>fn main() {\n    let letra = 'a';\n    let vocales = ['a', 'e', 'i', 'o', 'u'];\n\n    if vocales.contains(&amp;letra) {\n      // ...\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 107, "user_id": 10474463, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-N3OhE_gdVLk/AAAAAAAAAAI/AAAAAAAAAgQ/lA1l0vYVtDU/photo.jpg?sz=128", "display_name": "Ricardo Prieto", "link": "https://stackoverflow.com/users/10474463/ricardo-prieto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 55564582, "answer_count": 1, "score": 0, "last_activity_date": 1554687516, "creation_date": 1554677617, "last_edit_date": 1554687516, "question_id": 55564384, "link": "https://stackoverflow.com/questions/55564384/how-do-i-test-if-a-letter-is-in-a-list", "title": "How do I test if a letter is in a list?", "body": "<p>I need to test if a character is in a list of character in the most efficient way. I understand that it can be done through a <code>for</code> loop, but I want to know if there is a better way to do it.</p>\n\n<pre><code>fn main() {\n    let letra = 'a';\n    let vocales = ['a', 'e', 'i', 'o', 'u'];\n    // compare: if letra is in vocales {}\n}\n</code></pre>\n"}, {"tags": ["rust", "control-flow"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554652803, "post_id": 55560885, "comment_id": 97821709, "body": "<i>we want to print the value the moment we receive it</i> \u2014 but you still want to call <code>some_other_function</code>? If so, what&#39;s wrong with what you have?"}, {"owner": {"reputation": 8363, "user_id": 1531806, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/FkpTG.jpg?s=128&g=1", "display_name": "Pascal Precht", "link": "https://stackoverflow.com/users/1531806/pascal-precht"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554653754, "post_id": 55560885, "comment_id": 97822006, "body": "That&#39;s exactly what I&#39;m referring to.  Nothing&#39;s wrong with what I have. I&#39;m just keeping eyes and ears open for more elegant solutions (if possible). Your answer makes perfect sense, as always - Thank you!"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554655235, "post_id": 55560885, "comment_id": 97822453, "body": "side effect are never elegant"}], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 2, "last_activity_date": 1554653511, "last_edit_date": 1554653511, "creation_date": 1554653154, "answer_id": 55560999, "question_id": 55560885, "link": "https://stackoverflow.com/questions/55560885/whats-the-recommended-way-to-produce-side-effects-in-control-flow-using-result/55560999#55560999", "title": "What&#39;s the recommended way to produce side effects in control flow using Result?", "body": "<p><code>map</code> and <code>and_then</code> are appropriate for when you want to transform the value. Using <code>match</code> or <code>if let</code> is appropriate for side effects:</p>\n\n<pre><code>let r = some_fn();\n\nif let Ok(v) = &amp;r {\n    println!(\"{}\", v);\n}\n\nr.and_then(|_| some_other_fn())\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/27534364/155423\">Why does Rust need the `if let` syntax?</a></li>\n</ul>\n\n<p><em>Assuming</em> that you only care about side effects when the <code>Result</code> is <code>Ok</code>...</p>\n\n<p>You could also create an <em>extension trait</em> to add the desired method to <code>Result</code>. I'd advocate for calling it <code>inspect</code> as that's the name of <a href=\"https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.inspect\" rel=\"nofollow noreferrer\">the parallel method on <code>Iterator</code></a>.</p>\n\n<pre><code>trait InspectExt&lt;T&gt; {\n    fn inspect&lt;F&gt;(self, f: F) -&gt; Self\n    where\n        F: FnOnce(&amp;T);\n}\n\nimpl&lt;T, E&gt; InspectExt&lt;T&gt; for Result&lt;T, E&gt; {\n    fn inspect&lt;F&gt;(self, f: F) -&gt; Self\n    where\n        F: FnOnce(&amp;T),\n    {\n        if let Ok(v) = &amp;self {\n            f(v)\n        }\n        self\n    }\n}\n</code></pre>\n\n<pre><code>some_fn()\n    .inspect(|v| println!(\"{}\", v))\n    .and_then(|_| some_fn())\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/33376486/155423\">Is there a way other than traits to add methods to a type I don&#39;t own?</a></li>\n</ul>\n"}], "owner": {"reputation": 8363, "user_id": 1531806, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/FkpTG.jpg?s=128&g=1", "display_name": "Pascal Precht", "link": "https://stackoverflow.com/users/1531806/pascal-precht"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 1, "accepted_answer_id": 55560999, "answer_count": 1, "score": 1, "last_activity_date": 1554653511, "creation_date": 1554652431, "last_edit_date": 1554652659, "question_id": 55560885, "link": "https://stackoverflow.com/questions/55560885/whats-the-recommended-way-to-produce-side-effects-in-control-flow-using-result", "title": "What&#39;s the recommended way to produce side effects in control flow using Result?", "body": "<p><a href=\"https://doc.rust-lang.org/std/result/enum.Result.html#method.and_then\" rel=\"nofollow noreferrer\"><code>Result::and_then()</code></a> works great for composing control flow. </p>\n\n<pre><code>fn some_fn() -&gt; Result&lt;String, Error&gt; {\n    Ok(\"Yay\".to_string())\n}\n</code></pre>\n\n<pre><code>some_fn()\n    .and_then(|value| some_other_fn())\n    .and_then(|some_other_value| /* ... */)\n</code></pre>\n\n<p>Sometimes we want to create a side effect and still propagate the emitted value. Let's say we want to print the value the moment we receive it:</p>\n\n<pre><code>some_fn()\n    .and_then(|value| {\n        println!(\"{}\", &amp;value);\n        some_other_fn()\n    })\n    .and_then(|some_other_value| /* ... */)\n</code></pre>\n\n<p>Is there a better way to do this? Something like <a href=\"http://reactivex.io/documentation/operators/do.html\" rel=\"nofollow noreferrer\">Reactive Extensions' <code>tap()</code> operator</a> would be great.</p>\n"}, {"tags": ["rust", "ownership"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554651515, "post_id": 55560524, "comment_id": 97821331, "body": "Please take some time to read <a href=\"https://doc.rust-lang.org/book/\" rel=\"nofollow noreferrer\"><i>The Rust Programming Language</i></a>, which has <a href=\"https://doc.rust-lang.org/book/ch04-00-understanding-ownership.html\" rel=\"nofollow noreferrer\">multiple chapters about ownership</a>. Ownership is a fundamental concept in Rust and not taking the time to properly learn it will cause great heartache."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 5, "creation_date": 1554651602, "post_id": 55560524, "comment_id": 97821353, "body": "TL;DR \u2014 <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=ac1630aee7194d3e02afeea229c78465\" rel=\"nofollow noreferrer\">use <code>&amp;self</code> instead of <code>self</code> in your methods</a>. Note that an explicit <code>return</code> is not idiomatic Rust."}, {"owner": {"reputation": 54, "user_id": 6095930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a37894a5d76288227216d6cb7285e69?s=128&d=identicon&r=PG&f=1", "display_name": "tarantel", "link": "https://stackoverflow.com/users/6095930/tarantel"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554651736, "post_id": 55560524, "comment_id": 97821394, "body": "Thank you very much! Then I will dive again into the chapters about ownershipt. It&#39;s a habit from other programming languages to write <code>return</code>. It&#39;s hard to omit it at the moment."}], "owner": {"reputation": 54, "user_id": 6095930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a37894a5d76288227216d6cb7285e69?s=128&d=identicon&r=PG&f=1", "display_name": "tarantel", "link": "https://stackoverflow.com/users/6095930/tarantel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 420, "favorite_count": 0, "closed_date": 1554651395, "answer_count": 0, "score": 2, "last_activity_date": 1554651528, "creation_date": 1554650298, "last_edit_date": 1554651528, "question_id": 55560524, "link": "https://stackoverflow.com/questions/55560524/what-is-the-correct-way-to-get-values-via-a-method-without-moving-it", "closed_reason": "Duplicate", "title": "What is the correct way to get values via a method without moving it?", "body": "<p>I don't understand why Rust moves the value. Do I oversee a major point in the ownership?</p>\n\n<p>The struct <code>MyData</code> is a smaller version. I store some values in this struct, and want to access the stored values, but the compiler tells me after the second access, that the value was moved.</p>\n\n<p>I want to make some getters for my structs. I already derived <code>Clone</code>, but that does not help.</p>\n\n<p>The problem occurs on Windows 10 with the GNU-Compiler and on Kubuntu 18.04 LTS.</p>\n\n<p>My current workaround is to clone the data beforehand, but this can't be the correct way.</p>\n\n<pre><code>#[derive(Debug, Clone)]\nstruct MyData {\n    val1: i32,\n    val2: String,\n}\n\nimpl MyData {\n    pub fn get_val1(self) -&gt; i32 {\n        return self.val1.clone();\n    }\n\n    pub fn get_val2(self) -&gt; String {\n        return self.val2.clone();\n    }\n\n    pub fn get_both(self) -&gt; (i32, String) {\n        return (self.val1, self.val2);\n    }\n}\n\nfn main() {\n    let d = MyData {\n        val1: 35,\n        val2: String::from(\"Hello World\"),\n    };\n\n    let both = d.get_both();\n    let x = d.get_val1();\n    let y = d.get_val2();\n}\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0382]: use of moved value: `d`\n  --&gt; src/main.rs:28:13\n   |\n27 |     let both = d.get_both();\n   |                - value moved here\n28 |     let x = d.get_val1();\n   |             ^ value used here after move\n   |\n   = note: move occurs because `d` has type `MyData`, which does not implement the `Copy` trait\n\nerror[E0382]: use of moved value: `d`\n  --&gt; src/main.rs:29:13\n   |\n28 |     let x = d.get_val1();\n   |             - value moved here\n29 |     let y = d.get_val2();\n   |             ^ value used here after move\n   |\n   = note: move occurs because `d` has type `MyData`, which does not implement the `Copy` trait\n</code></pre>\n\n<p>I expect that <code>let x = d.get_val1();</code> won't cause an error. In my understanding of ownership in Rust, I did not move the value, since I'm calling a method of <code>MyData</code> and want to work with the value.</p>\n\n<p>Why does Rust move the value and to whom?</p>\n"}, {"tags": ["rust", "rust-actix", "actix-web"], "answers": [{"tags": [], "owner": {"reputation": 470, "user_id": 1419458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40be82026a81f18a2bbbaad209694e0?s=128&d=identicon&r=PG", "display_name": "Stanko Krtali\u0107 Rusendi\u0107", "link": "https://stackoverflow.com/users/1419458/stanko-krtali%c4%87-rusendi%c4%87"}, "is_accepted": true, "score": 1, "last_activity_date": 1554919006, "creation_date": 1554919006, "answer_id": 55618666, "question_id": 55559540, "link": "https://stackoverflow.com/questions/55559540/actix-syncarbiter-registry/55618666#55618666", "title": "Actix SyncArbiter registry", "body": "<p>I found the answer myself.</p>\n\n<p>Out-of-the box there is no way for an <code>Actor</code> with a <code>SyncContext</code> to be retrieved from the registry.</p>\n\n<p>Given my above example. For the actor <code>Bob</code> to send any kind of message to the <code>Redis</code> actor it needs to know the address of the <code>Redis</code> actor. <code>Bob</code> can get the address of <code>Redis</code> explicitly - contained in a message sent to it or read from some kind of shared state.</p>\n\n<p>I wanted a system similar to Erlang's so I decided against passing the addresses of actors through messages as it seemed too laborious, error prone and in my mind it defeats the purpose of having an actor based concurrency model (since no one actor can message any other actor).</p>\n\n<p>Therefore I investigated the idea of a shared state, and decided to implement my own <code>SyncRegistry</code> that would be an analog to the Actix standard <code>Registry</code> - whic does exactly what I want but not for Actors with a <code>SyncContext</code>.</p>\n\n<p>Here is the naive solution i coded up: <a href=\"https://gist.github.com/monorkin/c463f34764ab23af2fd0fb0c19716177\" rel=\"nofollow noreferrer\">https://gist.github.com/monorkin/c463f34764ab23af2fd0fb0c19716177</a></p>\n\n<p>With the following setup:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn main() {\n    let system = actix::System::new(\"theatre\");\n\n    let addr = SyncArbiter::start(10, || Redis::new(\"redis://redis\").unwrap());\n    SyncRegistry::set(addr);\n    let addr = SyncArbiter::start(10, || Bob::new());\n    SyncRegistry::set(addr);\n\n\n    server::new(move || {\n        let state = AppState {};\n\n        App::with_state(state).resource(\"/foo\", |r| {\n            r.method(http::Method::POST)\n                .with_async(controllers::foo::create)\n        })\n    })\n    .bind(\"0.0.0.0:8080\")\n    .unwrap()\n    .start();\n\n    println!(\"Server started.\");\n\n    system.run();\n}\n</code></pre>\n\n<p>The actor <code>Bob</code> can get the address of <code>Redis</code> in the following manner, from any point in the program:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>impl Handler&lt;Eat&gt; for Bob {\n    type Result = Result&lt;(), ()&gt;;\n\n    fn handle(&amp;mut self, msg: Eat, _context: &amp;mut Self::Context) -&gt; Self::Result {\n        let redis = match SyncRegistry::&lt;Redis&gt;::get() {\n            Some(redis) =&gt; redis,\n            _ =&gt; return Err(())\n        };\n\n        let cmd = redis::cmd(\"XADD\")\n            .arg(\"things_to_eat\")\n            .arg(\"*\")\n            .arg(\"data\")\n            .arg(&amp;msg.0)\n            .to_owned();\n\n        redis.clone().lock().unwrap().send(RunCommand::new(cmd)).wait().unwrap();\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 470, "user_id": 1419458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40be82026a81f18a2bbbaad209694e0?s=128&d=identicon&r=PG", "display_name": "Stanko Krtali\u0107 Rusendi\u0107", "link": "https://stackoverflow.com/users/1419458/stanko-krtali%c4%87-rusendi%c4%87"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 560, "favorite_count": 1, "accepted_answer_id": 55618666, "answer_count": 1, "score": 1, "last_activity_date": 1554919006, "creation_date": 1554643900, "last_edit_date": 1554647030, "question_id": 55559540, "link": "https://stackoverflow.com/questions/55559540/actix-syncarbiter-registry", "title": "Actix SyncArbiter registry", "body": "<p>I'm trying to implement a pool of 10 Redis of conections using a <code>SyncArbiter</code> for different actors to use. Say that we have an actor named Bob that has to use a Redis actor to accomplish it's task.</p>\n\n<p>While this is achievable in the following manner:</p>\n\n<pre><code>// crate, use and mod statements have been omitted to lessen clutter\n\n/// FILE main.rs\npub struct AppState {\n    pub redis: Addr&lt;Redis&gt;,\n    pub bob: Addr&lt;Bob&gt;\n}\n\nfn main() {\n    let system = actix::System::new(\"theatre\");\n\n    server::new(move || {\n        let redis_addr = SyncArbiter::start(10, || Redis::new(\"redis://127.0.0.1\").unwrap());\n        let bob_addr = SyncArbiter::start(10, || Bob::new());\n\n        let state = AppState {\n            redis: redis_addr,\n            bob: bob_addr\n        };\n\n        App::with_state(state).resource(\"/bob/eat\", |r| {\n            r.method(http::Method::POST)\n                .with_async(controllers::bob::eat)\n        })\n    })\n    .bind(\"0.0.0.0:8080\")\n    .unwrap()\n    .start();\n\n    println!(\"Server started.\");\n\n    system.run();\n}\n\n/// FILE controllers/bob.rs\npub struct Food {\n  name: String,\n  kcal: u64\n}\n\npub fn eat(\n    (req, state): (Json&lt;Food&gt;, State&lt;AppState&gt;),\n) -&gt; impl Future&lt;Item = HttpResponse, Error = Error&gt; {\n    state\n        .bob\n        .send(Eat::new(req.into_inner()))\n        .from_err()\n        .and_then(|res| match res {\n            Ok(val) =&gt; {\n                println!(\"==== BODY ==== {:?}\", val);\n                Ok(HttpResponse::Ok().into())\n            }\n            Err(_) =&gt; Ok(HttpResponse::InternalServerError().into()),\n        })\n}\n\n/// FILE actors/redis.rs\n#[derive(Debug)]\npub struct Redis {\n    pub client: Client\n}\n\npub struct RunCommand(Cmd);\n\nimpl RunCommand {\n    pub fn new(cmd: Cmd) -&gt; Self {\n        RunCommand(cmd)\n    }\n}\n\nimpl Message for RunCommand {\n    type Result = Result&lt;RedisResult&lt;String&gt;, ()&gt;;\n}\n\nimpl Actor for Redis {\n    type Context = SyncContext&lt;Self&gt;;\n}\n\nimpl Handler&lt;RunCommand&gt; for Redis {\n    type Result = Result&lt;RedisResult&lt;String&gt;, ()&gt;;\n\n    fn handle(&amp;mut self, msg: RunCommand, _context: &amp;mut Self::Context) -&gt; Self::Result {\n        println!(\"Redis received command!\");\n        Ok(Ok(\"OK\".to_string()))\n    }\n}\n\nimpl Redis {\n    pub fn new(url: &amp;str) -&gt; Result&lt;Self, RedisError&gt; {\n        let client = match Client::open(url) {\n            Ok(client) =&gt; client,\n            Err(error) =&gt; return Err(error)\n        };\n\n        let redis = Redis {\n            client: client,\n        };\n\n        Ok(redis)\n    }\n}\n\n/// FILE actors/bob.rs\npub struct Bob;\n\npub struct Eat(Food);\n\nimpl Message for Eat {\n    type Result = Result&lt;Bob, ()&gt;;\n}\n\nimpl Actor for Eat {\n    type Context = SyncContext&lt;Self&gt;;\n}\n\nimpl Handler&lt;Eat&gt; for Bob {\n    type Result = Result&lt;(), ()&gt;;\n\n    fn handle(&amp;mut self, msg: Eat, _context: &amp;mut Self::Context) -&gt; Self::Result {\n        println!(\"Bob received {:?}\", &amp;msg);\n\n        // How to get a Redis actor and pass data to it here?\n\n        Ok(msg.datapoint)\n    }\n}\n\nimpl Bob {\n    pub fn new() -&gt; () {\n        Bob {}\n    }\n}\n</code></pre>\n\n<p>From the above handle implementation in Bob, it's unclear how Bob could get the address of an Redis actor. Or send any message to any <code>Actor</code> running in a <code>SyncArbiter</code>. </p>\n\n<p>The same could be achieved using a regular <code>Arbiter</code> and a <code>Registry</code> but, as far as I am aware of, Actix doesn't allow multiple same actors (e.g. we can't start 10 Redis actors using a regular <code>Arbiter</code>).</p>\n\n<p>To formalize my questions:</p>\n\n<ul>\n<li>Is there a <code>Registry</code> for <code>SyncArbiter</code> actors</li>\n<li>Can I start multiple same type actors in a regular <code>Arbiter</code></li>\n<li>Is there a better / more canonical way to implement a connection pool</li>\n</ul>\n\n<hr>\n\n<p>EDIT</p>\n\n<p>Versions:</p>\n\n<ul>\n<li>actix 0.7.9</li>\n<li>actix_web 0.7.19</li>\n<li>futures = \"0.1.26\"</li>\n<li>rust 1.33.0</li>\n</ul>\n"}, {"tags": ["azure", "rust", "azure-active-directory"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1554625271, "post_id": 55556112, "comment_id": 97814704, "body": "Please note that <i>&quot;asking us to recommend or find a book, tool, software library, tutorial or other off-site resource are off-topic for Stack Overflow as they tend to attract opinionated answers and spam. Instead, describe the problem and what has been done so far to solve it.&quot;</i> (<a href=\"https://stackoverflow.com/help/on-topic\">SO/help/on-topic</a>). You could ask your question in the <a href=\"https://users.rust-lang.org\" rel=\"nofollow noreferrer\">user-forum</a> instead."}, {"owner": {"reputation": 40761, "user_id": 1658906, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4e4748ed2fb97e8a8d4dd6d439625135?s=128&d=identicon&r=PG", "display_name": "juunas", "link": "https://stackoverflow.com/users/1658906/juunas"}, "edited": false, "score": 1, "creation_date": 1554628458, "post_id": 55556112, "comment_id": 97815309, "body": "I think there is no official library at least. But AAD supports OpenID Connect, it&#39;s used in most new apps. There might be a library for OpenID Connect authentication for Rust? You can find general protocol documentation here: <a href=\"https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-protocols-oidc\" rel=\"nofollow noreferrer\">docs.microsoft.com/en-us/azure/active-directory/develop/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 20467, "user_id": 4989676, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jP8H6.jpg?s=128&g=1", "display_name": "Peter Pan", "link": "https://stackoverflow.com/users/4989676/peter-pan"}, "is_accepted": true, "score": 1, "last_activity_date": 1554794611, "creation_date": 1554794611, "answer_id": 55587202, "question_id": 55556112, "link": "https://stackoverflow.com/questions/55556112/azure-active-directory-authentication-in-rust/55587202#55587202", "title": "Azure Active Directory authentication in Rust", "body": "<p>Actually sure, you can refer to the offical document <a href=\"https://docs.microsoft.com/en-us/rest/api/azure/\" rel=\"nofollow noreferrer\"><code>Azure REST API Reference</code></a> to know how to register a client application with Azure AD and to authenticate for calling a REST API in Rust with <code>request</code> or <code>hyper</code>. I think it's your real want.</p>\n\n<p>Otherwise, Python is a good embedded scripting language for Rust. Uf you can use ADAL for Python to get access token via authentication, I think a good workaround is to use some cargo modules like <a href=\"https://github.com/PyO3/pyo3\" rel=\"nofollow noreferrer\"><code>PyO3/pyo3</code></a> or <a href=\"https://github.com/dgrunwald/rust-cpython\" rel=\"nofollow noreferrer\"><code>dgrunwald/rust-cpython</code></a> to call a Python script for authenticating with AAD from Rust code.</p>\n"}], "owner": {"reputation": 2422, "user_id": 1610273, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ecb15180b9f6e0a36d96da1e0b860572?s=128&d=identicon&r=PG", "display_name": "nevi_me", "link": "https://stackoverflow.com/users/1610273/nevi-me"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 408, "favorite_count": 1, "accepted_answer_id": 55587202, "answer_count": 1, "score": 2, "last_activity_date": 1554794611, "creation_date": 1554617260, "last_edit_date": 1554735236, "question_id": 55556112, "link": "https://stackoverflow.com/questions/55556112/azure-active-directory-authentication-in-rust", "title": "Azure Active Directory authentication in Rust", "body": "<p>Does anyone have experience with Microsoft's Azure Active Directory authentication in Rust?\nI've built a service at work that has LDAP authentication support, but we now need to deploy said application at a client that doesn't use LDAP. They've advised us to look at Active Directory Federated Services and Azure Active Directory.</p>\n\n<p>I've been researching, and it seems like Microsoft mainly provides an <a href=\"https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-authentication-libraries\" rel=\"nofollow noreferrer\">Active Directory Authentication Library</a> (ADAL) for popular languages/frameworks, with no barebones documentation that I can find.</p>\n\n<p>Does anyone know a resource/online documentation that I could follow? I'm looking for some generic REST API that I could implement with <code>request</code> or <code>hyper</code>.</p>\n"}, {"tags": ["file", "rust", "binary"], "comments": [{"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1554634119, "post_id": 55555538, "comment_id": 97816566, "body": "Do you need all chunks in memory at the same time? If not, you could allocate a single buffer and reuse it in each iteration."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554656475, "post_id": 55555538, "comment_id": 97822816, "body": "Why do you believe that having a <code>Vec&lt;Vec&lt;u8&gt;&gt;</code> will be better than a single <code>Vec&lt;u8&gt;</code>?"}, {"owner": {"reputation": 290, "user_id": 9156640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2cc37ec575a46246de4a809e7533e912?s=128&d=identicon&r=PG&f=1", "display_name": "dospro", "link": "https://stackoverflow.com/users/9156640/dospro"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554677585, "post_id": 55555538, "comment_id": 97828433, "body": "@Shepmaster I know it&#39;s not. I just want to be able to do something like <code>list_of_chunks[chunk_number][offset]</code> instead of calling a function which does the math: <code>buffer[chunk_number*size_of_chunks+offset]</code>. In the first approach once everything is loaded, I don&#39;t even need to use <code>size_of_chunks</code>"}], "answers": [{"comments": [{"owner": {"reputation": 290, "user_id": 9156640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2cc37ec575a46246de4a809e7533e912?s=128&d=identicon&r=PG&f=1", "display_name": "dospro", "link": "https://stackoverflow.com/users/9156640/dospro"}, "edited": false, "score": 0, "creation_date": 1554678129, "post_id": 55558173, "comment_id": 97828535, "body": "I was not aware of <code>Read::take</code>. Even if I&#39;d seen it in the docs it would be hard to realize it&#39;s for limiting read_to_end. Anyway, that was just what I needed. Thanks!"}, {"owner": {"reputation": 815, "user_id": 1150292, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VQ2aZ.jpg?s=128&g=1", "display_name": "Mara Bos", "link": "https://stackoverflow.com/users/1150292/mara-bos"}, "reply_to_user": {"reputation": 290, "user_id": 9156640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2cc37ec575a46246de4a809e7533e912?s=128&d=identicon&r=PG&f=1", "display_name": "dospro", "link": "https://stackoverflow.com/users/9156640/dospro"}, "edited": false, "score": 0, "creation_date": 1554729734, "post_id": 55558173, "comment_id": 97847693, "body": "@dospro Yeah, it wouldn&#39;t hurt if there was a <code>Read::read_n(&amp;mut self, v: &amp;mut Vec&lt;u8&gt;, n: usize)</code> that would call <code>.take(n).read_to_end(v)</code> for you. Right now this usage of <code>read_to_end</code> with <code>take</code> is hard to discover."}], "tags": [], "owner": {"reputation": 815, "user_id": 1150292, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VQ2aZ.jpg?s=128&g=1", "display_name": "Mara Bos", "link": "https://stackoverflow.com/users/1150292/mara-bos"}, "is_accepted": false, "score": 13, "last_activity_date": 1554729603, "last_edit_date": 1554729603, "creation_date": 1554634406, "answer_id": 55558173, "question_id": 55555538, "link": "https://stackoverflow.com/questions/55555538/what-is-the-correct-way-to-read-a-binary-file-in-chunks-of-a-fixed-size-and-stor/55558173#55558173", "title": "What is the correct way to read a binary file in chunks of a fixed size and store all of those chunks into a Vec?", "body": "<p><a href=\"https://doc.rust-lang.org/std/io/trait.Read.html#method.read_to_end\" rel=\"noreferrer\"><code>Read::read_to_end</code></a> reads efficiently directly into a <code>Vec</code>. If you want it in chunks, combine it with <a href=\"https://doc.rust-lang.org/std/io/trait.Read.html#method.take\" rel=\"noreferrer\"><code>Read::take</code></a> to limit the amount of bytes that <code>read_to_end</code> will read.</p>\n\n<p>Example:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let mut file = std::fs::File::open(\"your_file\")?;\n\nlet mut list_of_chunks = Vec::new();\n\nlet chunk_size = 0x4000;\n\nloop {\n    let mut chunk = Vec::with_capacity(chunk_size);\n    let n = file.by_ref().take(chunk_size as u64).read_to_end(&amp;mut chunk)?;\n    if n == 0 { break; }\n    list_of_chunks.push(chunk);\n    if n &lt; chunk_size { break; }\n}\n</code></pre>\n\n<p>The last <code>if</code> is not necessary, but it prevents an extra <code>read</code> call: If less than the requested amount of bytes was read by <code>read_to_end</code>, we can expect the next <code>read</code> to read nothing, since we hit the end of the file.</p>\n"}, {"tags": [], "owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "is_accepted": true, "score": 3, "last_activity_date": 1554670428, "last_edit_date": 1554670428, "creation_date": 1554667554, "answer_id": 55563191, "question_id": 55555538, "link": "https://stackoverflow.com/questions/55555538/what-is-the-correct-way-to-read-a-binary-file-in-chunks-of-a-fixed-size-and-stor/55563191#55563191", "title": "What is the correct way to read a binary file in chunks of a fixed size and store all of those chunks into a Vec?", "body": "<p>I think the most idiomatic way would be to use an iterator. The code below (freely inspired by <a href=\"https://stackoverflow.com/a/55558173/155423\">M-ou-se's answer</a>):</p>\n\n<ul>\n<li>Handles many use cases by using generic types</li>\n<li>Will use a pre-allocated vector</li>\n<li>Hides side effect</li>\n<li>Avoid copying data twice</li>\n</ul>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::io::{self, Read, Seek, SeekFrom};\n\nstruct Chunks&lt;R&gt; {\n    read: R,\n    size: usize,\n    hint: (usize, Option&lt;usize&gt;),\n}\n\nimpl&lt;R&gt; Chunks&lt;R&gt; {\n    pub fn new(read: R, size: usize) -&gt; Self {\n        Self {\n            read,\n            size,\n            hint: (0, None),\n        }\n    }\n\n    pub fn from_seek(mut read: R, size: usize) -&gt; io::Result&lt;Self&gt;\n    where\n        R: Seek,\n    {\n        let old_pos = read.seek(SeekFrom::Current(0))?;\n        let len = read.seek(SeekFrom::End(0))?;\n\n        let rest = (len - old_pos) as usize; // len is always &gt;= old_pos but they are u64\n        if rest != 0 {\n            read.seek(SeekFrom::Start(old_pos))?;\n        }\n\n        let min = rest / size + if rest % size != 0 { 1 } else { 0 };\n        Ok(Self {\n            read,\n            size,\n            hint: (min, None), // this could be wrong I'm unsure\n        })\n    }\n\n    // This could be useful if you want to try to recover from an error\n    pub fn into_inner(self) -&gt; R {\n        self.read\n    }\n}\n\nimpl&lt;R&gt; Iterator for Chunks&lt;R&gt;\nwhere\n    R: Read,\n{\n    type Item = io::Result&lt;Vec&lt;u8&gt;&gt;;\n\n    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt; {\n        let mut chunk = Vec::with_capacity(self.size);\n        match self\n            .read\n            .by_ref()\n            .take(chunk.capacity() as u64)\n            .read_to_end(&amp;mut chunk)\n        {\n            Ok(n) =&gt; {\n                if n != 0 {\n                    Some(Ok(chunk))\n                } else {\n                    None\n                }\n            }\n            Err(e) =&gt; Some(Err(e)),\n        }\n    }\n\n    fn size_hint(&amp;self) -&gt; (usize, Option&lt;usize&gt;) {\n        self.hint\n    }\n}\n\ntrait ReadPlus: Read {\n    fn chunks(self, size: usize) -&gt; Chunks&lt;Self&gt;\n    where\n        Self: Sized,\n    {\n        Chunks::new(self, size)\n    }\n}\n\nimpl&lt;T: ?Sized&gt; ReadPlus for T where T: Read {}\n\nfn main() -&gt; io::Result&lt;()&gt; {\n    let file = std::fs::File::open(\"src/main.rs\")?;\n    let iter = Chunks::from_seek(file, 0xFF)?; // replace with anything 0xFF was to test\n\n    println!(\"{:?}\", iter.size_hint());\n    // This iterator could return Err forever be careful collect it into an Result\n    let chunks = iter.collect::&lt;Result&lt;Vec&lt;_&gt;, _&gt;&gt;()?;\n    println!(\"{:?}, {:?}\", chunks.len(), chunks.capacity());\n\n    Ok(())\n}\n</code></pre>\n"}], "owner": {"reputation": 290, "user_id": 9156640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2cc37ec575a46246de4a809e7533e912?s=128&d=identicon&r=PG&f=1", "display_name": "dospro", "link": "https://stackoverflow.com/users/9156640/dospro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3006, "favorite_count": 2, "accepted_answer_id": 55563191, "answer_count": 2, "score": 12, "last_activity_date": 1554729603, "creation_date": 1554610090, "last_edit_date": 1554663004, "question_id": 55555538, "link": "https://stackoverflow.com/questions/55555538/what-is-the-correct-way-to-read-a-binary-file-in-chunks-of-a-fixed-size-and-stor", "title": "What is the correct way to read a binary file in chunks of a fixed size and store all of those chunks into a Vec?", "body": "<p>I'm having trouble with opening a file. Most examples read files into a <code>String</code> or read the entire file into a <code>Vec</code>. What I need is to read a file into chunks of a fixed size and store those chunks into an array (<code>Vec</code>) of chunks.</p>\n\n<p>For example, I have a file called <code>my_file</code> of exactly 64 KB size and I want to read it in chunks of 16KB so I would end up with an <code>Vec</code> of size 4 where each element is another <code>Vec</code> with size 16Kb (0x4000 bytes).</p>\n\n<p>After reading the docs and checking other Stack Overflow answers, I was able to come with something like this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let mut file = std::fs::File::open(\"my_file\")?;\n// ...calculate num_of_chunks 4 in this case\nlet list_of_chunks = Vec::new();\n\nfor chunk in 0..num_of_chunks {\n    let mut data: [u8; 0x4000] = [0; 0x4000];\n    file.read(&amp;mut data[..])?;\n    list_of_chunks.push(data.to_vec());\n}\n</code></pre>\n\n<p>Although this seems to work fine, it looks a bit convoluted. I read:</p>\n\n<ul>\n<li>For each iteration, create a new array on stack</li>\n<li>Read the chunk into the array</li>\n<li>Copy the contents of the array into a new <code>Vec</code> and then <strong>move</strong> the <code>Vec</code> into the <code>list_of_chunks</code> <code>Vec</code>.</li>\n</ul>\n\n<p>I'm not sure if it's idiomatic or even possible, but I'd rather have something like this:</p>\n\n<ul>\n<li>Create a <code>Vec</code> with <code>num_of_chunk</code> elements where each element is another <code>Vec</code> of size 16KB.</li>\n<li>Read file chunk directly into the correct <code>Vec</code></li>\n</ul>\n\n<p>No copying and we make sure memory is allocated before reading the file.</p>\n\n<p>Is that approach possible? or is there a better conventional/idiomatic/correct way to do this?\nI'm wondering if <code>Vec</code> is the correct type for solving this. I mean, I won't need the array to grow after reading the file.</p>\n"}, {"tags": ["rust", "tuples", "traits", "variadic"], "comments": [{"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 1, "creation_date": 1554583693, "post_id": 55553281, "comment_id": 97807879, "body": "Macros. That&#39;s how it is done currently."}, {"owner": {"reputation": 36141, "user_id": 4354477, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/SuxtS.gif?s=128&g=1", "display_name": "ForceBru", "link": "https://stackoverflow.com/users/4354477/forcebru"}, "edited": false, "score": 1, "creation_date": 1554583770, "post_id": 55553281, "comment_id": 97807895, "body": "I&#39;m not sure if it&#39;s possible. Even the standard library has to <a href=\"https://doc.rust-lang.org/std/primitive.tuple.html#trait-implementations\" rel=\"nofollow noreferrer\">provide implementations for every possible length of a tuple, up to 12</a>."}], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 7, "last_activity_date": 1554584775, "creation_date": 1554584775, "answer_id": 55553480, "question_id": 55553281, "link": "https://stackoverflow.com/questions/55553281/is-it-possible-to-automatically-implement-a-trait-for-any-tuple-that-is-made-up/55553480#55553480", "title": "Is it possible to automatically implement a trait for any tuple that is made up of types that all implement the trait?", "body": "<blockquote>\n  <p>we don't have variadic generics in Rust.</p>\n</blockquote>\n\n<p>Correct.</p>\n\n<blockquote>\n  <p>Is there a workaround?</p>\n</blockquote>\n\n<p>You use a macro:</p>\n\n<pre><code>trait Happy {}\n\nmacro_rules! tuple_impls {\n    ( $head:ident, $( $tail:ident, )* ) =&gt; {\n        impl&lt;$head, $( $tail ),*&gt; Happy for ($head, $( $tail ),*)\n        where\n            $head: Happy,\n            $( $tail: Happy ),*\n        {\n            // interesting delegation here, as needed\n        }\n\n        tuple_impls!($( $tail, )*);\n    };\n\n    () =&gt; {};\n}\n\ntuple_impls!(A, B, C, D, E, F, G, H, I, J,);\n</code></pre>\n\n<p>This now compiles:</p>\n\n<pre><code>fn example&lt;T: Happy&gt;() {}\n\nfn call&lt;A: Happy, B: Happy&gt;() {\n    example::&lt;(A, B)&gt;();\n} \n</code></pre>\n\n<p>This isn't generally seen as a big problem because long tuples are basically unreadable and you can always nest tuples if really needed.</p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/24831573/155423\">Automatically implement traits of enclosed type for Rust newtypes (tuple structs with one field)</a></li>\n<li><a href=\"https://stackoverflow.com/q/29148544/155423\">How to iterate or map over tuples?</a></li>\n</ul>\n"}], "owner": {"reputation": 6932, "user_id": 774236, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/7e46879a230ff1e28cd975e3b0a0873b?s=128&d=identicon&r=PG", "display_name": "Matteo Monti", "link": "https://stackoverflow.com/users/774236/matteo-monti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1251, "favorite_count": 1, "accepted_answer_id": 55553480, "answer_count": 1, "score": 1, "last_activity_date": 1554584775, "creation_date": 1554583110, "last_edit_date": 1554584259, "question_id": 55553281, "link": "https://stackoverflow.com/questions/55553281/is-it-possible-to-automatically-implement-a-trait-for-any-tuple-that-is-made-up", "title": "Is it possible to automatically implement a trait for any tuple that is made up of types that all implement the trait?", "body": "<p>Suppose that I have a</p>\n\n<pre><code>trait Happy {}\n</code></pre>\n\n<p>I can implement <code>Happy</code> for whatever struct I might want, for example:</p>\n\n<pre><code>struct Dog;\nstruct Cat;\nstruct Alligator;\n\nimpl Happy for Dog {}\nimpl Happy for Cat {}\nimpl Happy for Alligator {}\n</code></pre>\n\n<p>Now, I would like to automatically <code>impl</code> my <code>Happy</code> trait for whatever tuple is made up of types that all implement the <code>Happy</code> trait. Intuitively, a tuple of all happy is happy as well.</p>\n\n<p>Is it possible to do such a thing? For example, I can trivially extend the implementation of <code>Happy</code> to whatever tuple of two <code>Happy</code> types:</p>\n\n<pre><code>impl &lt;T, Q&gt; Happy for (T, Q) where T: Happy, Q: Happy {}\n</code></pre>\n\n<p>As a result, this compiles perfectly:</p>\n\n<pre><code>fn f(_: impl Happy) {\n}\n\nfn main() {\n    f((Dog{}, Alligator{}));\n}\n</code></pre>\n\n<p>But how could I generalize that to any tuple, of any length? As far as my understanding goes, we don't have variadic generics in Rust. Is there a workaround?</p>\n"}, {"tags": ["reference", "rust", "immutability", "ownership", "borrowing"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554585204, "post_id": 55553260, "comment_id": 97808207, "body": "Please do not <i>interleave</i> your code and the error messages. Paste the <i>entire</i> error message separately with proper formatting. Additionally, please review how to create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> \u2014 your code did not have the proper imports."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554585563, "post_id": 55553260, "comment_id": 97808276, "body": "Part 1: <code>read_line(&amp;mut commands_raw)</code> will mutate the <code>String, invalidating the reference to the </code>String` that has been stored in the <code>Vec</code>. Part 2: The <code>String</code> goes out of scope at the end of the loop, invalidating the reference stored in the <code>HashMap</code>."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554585590, "post_id": 55553260, "comment_id": 97808285, "body": "See also <a href=\"https://stackoverflow.com/q/53368852/155423\">How do I add an element to the value of a hash map that pairs strings with vectors of strings?</a>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554585663, "post_id": 55553260, "comment_id": 97808304, "body": "Use an owned <code>String</code> as your key, <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=ccdb4a115cb9777735e8b6b70d0a5aad\" rel=\"nofollow noreferrer\">something like this</a>."}], "owner": {"reputation": 50, "user_id": 10854888, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PVJ16.png?s=128&g=1", "display_name": "koral", "link": "https://stackoverflow.com/users/10854888/koral"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 388, "favorite_count": 0, "closed_date": 1554585412, "answer_count": 0, "score": 0, "last_activity_date": 1554585786, "creation_date": 1554582998, "last_edit_date": 1554585162, "question_id": 55553260, "link": "https://stackoverflow.com/questions/55553260/cant-read-input-in-a-loop-and-convert-to-vector-in-rust", "closed_reason": "Duplicate", "title": "Can&#39;t read input in a loop and convert to Vector in Rust", "body": "<p>I'm trying to do this simple assignment from <a href=\"https://doc.rust-lang.org/book/ch08-03-hash-maps.html#summary\" rel=\"nofollow noreferrer\"><em>The Rust Programming Language</em></a>:</p>\n\n<blockquote>\n  <p>Using a hash map and vectors, create a text interface to  allow a user\n  to add employee names to a department in a  company. For example, \u201cAdd\n  Sally to Engineering\u201d or \u201cAdd Amir to Sales.\u201d</p>\n</blockquote>\n\n<p>When I define both the raw user input as well as the parsed empty commands separated by whitespaces outside the loop I get mutable and immutable reference errors:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::io;\n\nfn main() {\n    let mut commands_raw = String::new();\n    let mut commands: Vec&lt;&amp;str&gt; = Vec::new();\n    loop {\n        io::stdin()\n            .read_line(&amp;mut commands_raw)\n            .expect(\"Failed to read line\");\n        commands = commands_raw.split_whitespace().collect();\n\n        println!(\"Commands: {:?}\", commands);\n    }\n}\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0502]: cannot borrow `commands_raw` as mutable because it is also borrowed as immutable\n  --&gt; src/main.rs:8:24\n   |\n8  |             .read_line(&amp;mut commands_raw)\n   |                        ^^^^^^^^^^^^^^^^^ mutable borrow occurs here\n9  |             .expect(\"Failed to read line\");\n10 |         commands = commands_raw.split_whitespace().collect();\n   |         --------   ------------ immutable borrow occurs here\n   |         |\n   |         immutable borrow might be used here, when `commands` is dropped and runs the `Drop` code for type `std::vec::Vec`\n</code></pre>\n\n<p>When I move them both inside the loop I get:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::collections::HashMap;\nuse std::io;\n\nfn main() {\n    let mut registrar: HashMap&lt;&amp;str, Vec&lt;String&gt;&gt; = HashMap::new();\n    loop {\n        let mut commands_raw = String::new();\n        io::stdin()\n            .read_line(&amp;mut commands_raw)\n            .expect(\"Failed to read line\");\n        let commands: Vec&lt;&amp;str&gt; = commands_raw.split_whitespace().collect();\n\n        // Everything is fine until I use the commands in the registrar\n        if commands[0].to_lowercase() == \"add\" {\n            let department = registrar.entry(commands[4]).or_insert(Vec::new());\n            department.push(String::from(commands[1]));\n        } else if commands[0].to_lowercase() == \"get\" {\n            let employees = registrar.entry(commands[2]);\n            println!(\"All in {}: {:?}\", commands[3], employees);\n        }\n\n        println!(\"Commands: {:?}\", commands);\n    }\n}\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0597]: `commands_raw` does not live long enough\n  --&gt; src/main.rs:11:35\n   |\n11 |         let commands: Vec&lt;&amp;str&gt; = commands_raw.split_whitespace().collect();\n   |                                   ^^^^^^^^^^^^ borrowed value does not live long enough\n...\n15 |             let department = registrar.entry(commands[4]).or_insert(Vec::new());\n   |                              --------- borrow used here, in later iteration of loop\n...\n23 |     }\n   |     - `commands_raw` dropped here while still borrowed\n</code></pre>\n\n<p>I don't know what I'm missing, but this is taking me a few hours now.</p>\n"}, {"tags": ["memory", "memory-leaks", "rust"], "comments": [{"owner": {"reputation": 1606, "user_id": 1461154, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/82d0e33bd5d4989410c7e67cefdf056c?s=128&d=identicon&r=PG", "display_name": "James M. Lay", "link": "https://stackoverflow.com/users/1461154/james-m-lay"}, "edited": false, "score": 2, "creation_date": 1569558739, "post_id": 55553048, "comment_id": 102643178, "body": "I created an event listener leak just now in rust, and found this thread when searching for approaches to &quot;prevent memory leak in rust&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 2659, "user_id": 8050514, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6CRdl.jpg?s=128&g=1", "display_name": "Optimistic Peach", "link": "https://stackoverflow.com/users/8050514/optimistic-peach"}, "edited": false, "score": 1, "creation_date": 1554650807, "post_id": 55553200, "comment_id": 97821150, "body": "You might&#39;ve forgotten about <a href=\"https://doc.rust-lang.org/std/boxed/struct.Box.html#method.leak\" rel=\"nofollow noreferrer\"><code>Box::leak</code></a> and <a href=\"https://doc.rust-lang.org/std/boxed/struct.Box.html#method.into_raw\" rel=\"nofollow noreferrer\"><code>Box::into_raw</code></a> which are pretty common in ffi situations for passing around states."}, {"owner": {"reputation": 10968, "user_id": 232220, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/7123839b35e3f4235aab013e7ac75106?s=128&d=identicon&r=PG&f=1", "display_name": "Teekin", "link": "https://stackoverflow.com/users/232220/teekin"}, "edited": false, "score": 3, "creation_date": 1593272342, "post_id": 55553200, "comment_id": 110724012, "body": "For the curious, a bit of online searching reveals that &quot;FFI&quot; stands for &quot;Foreign Function Interface&quot;. :) (Not obvious to Rust beginners.)"}, {"owner": {"reputation": 4496, "user_id": 2876370, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/e6f40b83e480344956f34b57bd7b702c?s=128&d=identicon&r=PG", "display_name": "Pavel \u0160imerda", "link": "https://stackoverflow.com/users/2876370/pavel-%c5%a0imerda"}, "edited": false, "score": 0, "creation_date": 1608018632, "post_id": 55553200, "comment_id": 115446540, "body": "I wouldn&#39;t say that circular references and stuff like that are \u201cquite exotic\u201d. Unless you&#39;re working on simple examples, you will probably run into something equaly exotic pretty soon."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "reply_to_user": {"reputation": 4496, "user_id": 2876370, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/e6f40b83e480344956f34b57bd7b702c?s=128&d=identicon&r=PG", "display_name": "Pavel \u0160imerda", "link": "https://stackoverflow.com/users/2876370/pavel-%c5%a0imerda"}, "edited": false, "score": 0, "creation_date": 1608310572, "post_id": 55553200, "comment_id": 115553044, "body": "@Pavel\u0160imerda I personally don&#39;t like reference cycles. If I can avoid them, I use something else (an arena, for example), that&#39;s why I consider it as &quot;exotic&quot;. However, you&#39;re right, I&#39;ve edited this term as it is unsuitable."}, {"owner": {"reputation": 6122, "user_id": 200224, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/krcuc.jpg?s=128&g=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/200224/andy"}, "edited": false, "score": 0, "creation_date": 1611116024, "post_id": 55553200, "comment_id": 116343973, "body": "Are there memory leaks in Rust equivalent to accidentally leaving a reference in some static array or list in Java?"}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "reply_to_user": {"reputation": 6122, "user_id": 200224, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/krcuc.jpg?s=128&g=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/200224/andy"}, "edited": false, "score": 0, "creation_date": 1611738295, "post_id": 55553200, "comment_id": 116544258, "body": "@Andy Not a strict equivalent, but suppose that you make live a vector in a thread and fill it by sending messages without removing the items: the vector will grow up and grow up: it&#39;s a kind of memory leak, but not at a language level, more at a logical level."}, {"owner": {"reputation": 6122, "user_id": 200224, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/krcuc.jpg?s=128&g=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/200224/andy"}, "edited": false, "score": 1, "creation_date": 1611786233, "post_id": 55553200, "comment_id": 116566287, "body": "I guess I think of it as a memory leak since in the garbage-collected languages I mostly work with, it&#39;s the only way you can accidentally use up available memory with unused data, and since it&#39;s basically the same as accidentally keeping around a reference to a smart pointer"}, {"owner": {"reputation": 6122, "user_id": 200224, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/krcuc.jpg?s=128&g=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/200224/andy"}, "edited": false, "score": 2, "creation_date": 1611786345, "post_id": 55553200, "comment_id": 116566320, "body": "Maybe the term memory leak originally meant forgetting to call <code>free</code>, but that&#39;s really only one part of the larger picture of how programs accidentally run out of memory.  Forgetting to call <code>free</code> directly and forgetting to do something that would indirectly trigger a call to <code>free</code> have the same consequences"}, {"owner": {"reputation": 6122, "user_id": 200224, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/krcuc.jpg?s=128&g=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/200224/andy"}, "edited": false, "score": 0, "creation_date": 1612422561, "post_id": 55553200, "comment_id": 116762952, "body": "Garbage-collected languages were sorely missing from discussion of memory leaks in my CS classes..."}], "tags": [], "owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "is_accepted": true, "score": 34, "last_activity_date": 1612778078, "last_edit_date": 1612778078, "creation_date": 1554582546, "answer_id": 55553200, "question_id": 55553048, "link": "https://stackoverflow.com/questions/55553048/is-it-possible-to-cause-a-memory-leak-in-rust/55553200#55553200", "title": "Is it possible to cause a memory leak in Rust?", "body": "<p>Yes, leaking memory in Rust is as easy as calling the <a href=\"https://doc.rust-lang.org/std/mem/fn.forget.html\" rel=\"noreferrer\"><code>std::mem::forget</code></a> function.</p>\n<p>You can also leak memory if you create a cycle of <a href=\"https://doc.rust-lang.org/std/rc/index.html\" rel=\"noreferrer\">shared references</a>:</p>\n<blockquote>\n<p>A cycle between <code>Rc</code> pointers will never be deallocated. For this reason, <code>Weak</code> is used to break cycles. For example, a tree could have strong <code>Rc</code> pointers from parent nodes to children, and <code>Weak</code> pointers from children back to their parents.</p>\n</blockquote>\n<p>You can also use <a href=\"https://doc.rust-lang.org/std/boxed/struct.Box.html#method.leak\" rel=\"noreferrer\"><code>Box::leak</code></a> to create a static reference, or <a href=\"https://doc.rust-lang.org/std/boxed/struct.Box.html#method.into_raw\" rel=\"noreferrer\"><code>Box::into_raw</code></a> in an <a href=\"https://en.wikipedia.org/wiki/Foreign_function_interface\" rel=\"noreferrer\">FFI</a> situation.</p>\n<hr />\n<p>Actually, in a system programming language, you <em>need</em> to be able to create a memory leak, otherwise, for example in an FFI case, your resource would be freed after being sent for use in another language.</p>\n<hr />\n<p>All those examples show that a memory leak does not offend the memory safety guaranteed by Rust. However, it is safe to assume that in Rust, you do not have any memory leak, unless you do a very specific thing.</p>\n<p>Also, note that if you adopt a loose definition of the memory leak, there are infinite ways to create one, for example, by adding some data in a container without releasing the unused one.</p>\n"}, {"tags": [], "owner": {"reputation": 2314, "user_id": 4675927, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/285ad1cf46c6c64e7a204b8a9d14cb98?s=128&d=identicon&r=PG", "display_name": "theJian", "link": "https://stackoverflow.com/users/4675927/thejian"}, "is_accepted": false, "score": 10, "last_activity_date": 1554688923, "creation_date": 1554688923, "answer_id": 55565349, "question_id": 55553048, "link": "https://stackoverflow.com/questions/55553048/is-it-possible-to-cause-a-memory-leak-in-rust/55565349#55565349", "title": "Is it possible to cause a memory leak in Rust?", "body": "<p>From the <a href=\"https://doc.rust-lang.org/book/ch15-06-reference-cycles.html#reference-cycles-can-leak-memory\" rel=\"noreferrer\">book</a></p>\n\n<blockquote>\n  <p>Rust\u2019s memory safety guarantees make it difficult, but not impossible, to accidentally create memory that is never cleaned up (known as a memory leak). Preventing memory leaks entirely is not one of Rust\u2019s guarantees in the same way that disallowing data races at compile time is, meaning memory leaks are memory safe in Rust.</p>\n</blockquote>\n\n<p>So the answer is yes. You can have memory leaks in your code and rust compiler won't complain about it.</p>\n"}], "owner": {"reputation": 1093, "user_id": 9315690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/747b19bfb99db8f9f3411c19da6c9c50?s=128&d=identicon&r=PG&f=1", "display_name": "Newbyte", "link": "https://stackoverflow.com/users/9315690/newbyte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6739, "favorite_count": 0, "accepted_answer_id": 55553200, "answer_count": 2, "score": 21, "last_activity_date": 1612778078, "creation_date": 1554581420, "last_edit_date": 1554586057, "question_id": 55553048, "link": "https://stackoverflow.com/questions/55553048/is-it-possible-to-cause-a-memory-leak-in-rust", "title": "Is it possible to cause a memory leak in Rust?", "body": "<p>Is there any way of causing a memory leak in Rust? I know that even in garbage-collected languages like JavaScript there are edge-cases where memory will be leaked, are there any such cases in Rust?</p>\n"}, {"tags": ["rust", "future"], "answers": [{"comments": [{"owner": {"reputation": 312, "user_id": 1613104, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dAUTC.jpg?s=128&g=1", "display_name": "LittleTiger", "link": "https://stackoverflow.com/users/1613104/littletiger"}, "edited": false, "score": 2, "creation_date": 1573003276, "post_id": 55552509, "comment_id": 103736124, "body": "Thanks for pointing to the docs and teaching how to use them to be able to find answers by ourselves!"}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 15, "last_activity_date": 1573828577, "last_edit_date": 1573828577, "creation_date": 1554577516, "answer_id": 55552509, "question_id": 55552413, "link": "https://stackoverflow.com/questions/55552413/what-is-the-difference-between-then-and-then-and-or-else-in-rust-futures/55552509#55552509", "title": "What is the difference between `then`, `and_then` and `or_else` in Rust futures?", "body": "<p>TL;DR: <code>then</code> is used when you want to do something regardless of if the future was successful or not, <code>and_then</code> runs the closure only when the future succeeded, and <code>or_else</code> runs the closure only when the future failed.</p>\n\n<p><code>and_then</code> and <code>or_else</code> are direct analogs to the methods of the same name on <code>Result</code> .</p>\n\n<hr>\n\n<p>Your first step should be to read the docs. The documentation contains the exact method signatures (which explain what types it expects and what the return types are), prose describing each method, and example usage as well.</p>\n\n<p>I've extracted small snippets of the docs and emphasized the relevant parts.</p>\n\n<p><a href=\"https://docs.rs/futures/0.1.26/futures/future/trait.Future.html#method.then\" rel=\"noreferrer\"><code>Future::then</code></a>:</p>\n\n<blockquote>\n  <p>This function can be used to ensure <strong>a computation runs regardless of\n  the conclusion of the future</strong>. The closure provided will be yielded a\n  <code>Result</code> once the future is complete.</p>\n  \n  <p>The returned value of the closure must implement the <code>IntoFuture</code> trait\n  and can represent some more work to be done before the composed future\n  is finished.</p>\n</blockquote>\n\n<p><a href=\"https://docs.rs/futures/0.1.26/futures/future/trait.Future.html#method.and_then\" rel=\"noreferrer\"><code>Future::and_then</code></a>:</p>\n\n<blockquote>\n  <p>This function can be used to chain two futures together and ensure\n  that the final future isn't resolved until both have finished. The\n  closure provided is yielded <strong>the successful result of this future</strong> and\n  returns another value which can be converted into a future.</p>\n</blockquote>\n\n<p><a href=\"https://docs.rs/futures/0.1.26/futures/future/trait.Future.html#method.or_else\" rel=\"noreferrer\"><code>Future::or_else</code></a></p>\n\n<blockquote>\n  <p>Return a future that passes along this future's value if it succeeds, and otherwise <strong>passes the error to the closure <code>f</code></strong> and waits for the future it returns.</p>\n</blockquote>\n\n<p>The return type for all three methods is any type that can be converted into another future.</p>\n\n<ul>\n<li><code>then</code>: no additional restrictions on the return type.</li>\n<li><code>and_then</code> requires that the error type of the returned future match the starting future's error type.</li>\n<li><code>or_else</code> requires that the success type of the returned future match the starting future's success type.</li>\n</ul>\n\n<hr>\n\n<pre><code>use futures::{future, Future}; // 0.1.25\n\nstruct Error;\n\nfn download_from_server(server: u8) -&gt; impl Future&lt;Item = Vec&lt;u8&gt;, Error = Error&gt; {\n    /* ... */\n}\n\nfn upload_to_server(data: Vec&lt;u8&gt;) -&gt; impl Future&lt;Item = usize, Error = Error&gt; {\n    /* ... */\n}\n\n// Uses `or_else` to do work on failure\nfn download() -&gt; impl Future&lt;Item = Vec&lt;u8&gt;, Error = Error&gt; {\n    download_from_server(0)\n        .or_else(|_| download_from_server(1))\n        .or_else(|_| download_from_server(2))\n}\n\n// Uses `and_then` to do work on success\nfn reupload() -&gt; impl Future&lt;Item = usize, Error = Error&gt; {\n    download().and_then(|data| upload_to_server(data))\n}\n\n// Uses `then` to always do work\nfn do_things() -&gt; impl Future&lt;Item = (), Error = ()&gt; {\n    reupload().then(|r| {\n        match r {\n            Ok(size) =&gt; println!(\"Uploaded {} bytes\", size),\n            Err(_) =&gt; println!(\"Got an error\"),\n        };\n        Ok(())\n    })\n}\n</code></pre>\n\n<p>Some cases are simplified by the <code>async</code> / <code>await</code> syntax stabilized in Rust 1.39:</p>\n\n<pre><code>// Equivalent to `or_else`\nasync fn download() -&gt; Result&lt;Vec&lt;u8&gt;, Error&gt; {\n    match download_from_server(0).await {\n        Ok(v) =&gt; Ok(v),\n        Err(_) =&gt; match download_from_server(1).await {\n            Ok(v) =&gt; Ok(v),\n            Err(_) =&gt; download_from_server(2).await,\n        },\n    }\n}\n\n// Equivalent to `and_then`\nasync fn reupload() -&gt; Result&lt;usize, Error&gt; {\n    let data = download().await?;\n    upload_to_server(data).await\n}\n\n// Equivalent to `then`\nasync fn do_things() -&gt; Result&lt;(), ()&gt; {\n    match reupload().await {\n        Ok(size) =&gt; println!(\"Uploaded {} bytes\", size),\n        Err(_) =&gt; println!(\"Got an error\"),\n    }\n    Ok(())\n}\n</code></pre>\n"}], "owner": {"reputation": 680, "user_id": 4802698, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/536dc8f5fe69d0dabe70024eba7fb1a7?s=128&d=identicon&r=PG&f=1", "display_name": "Enayet Hussain", "link": "https://stackoverflow.com/users/4802698/enayet-hussain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5777, "favorite_count": 1, "accepted_answer_id": 55552509, "answer_count": 1, "score": 6, "last_activity_date": 1573828577, "creation_date": 1554576826, "last_edit_date": 1554577343, "question_id": 55552413, "link": "https://stackoverflow.com/questions/55552413/what-is-the-difference-between-then-and-then-and-or-else-in-rust-futures", "title": "What is the difference between `then`, `and_then` and `or_else` in Rust futures?", "body": "<p>I am learning to use Rust futures and I am finding it extremely confusing. I feel like I am being stupid but when would <code>then</code>, <code>and_then</code> and <code>or_else</code> be used? What return types are expected? </p>\n\n<p>Please provide some examples of the different situations you would expect to see them.</p>\n"}, {"tags": ["rust", "webassembly"], "answers": [{"comments": [{"owner": {"reputation": 3347, "user_id": 1741027, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/N1hWk.jpg?s=128&g=1", "display_name": "slorenzo", "link": "https://stackoverflow.com/users/1741027/slorenzo"}, "edited": false, "score": 0, "creation_date": 1587783963, "post_id": 55552654, "comment_id": 108652693, "body": "Do you know if there is a difference in terms of performance?"}, {"owner": {"reputation": 2655, "user_id": 184700, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/ffsUU.jpg?s=128&g=1", "display_name": "Jess Bowers", "link": "https://stackoverflow.com/users/184700/jess-bowers"}, "reply_to_user": {"reputation": 3347, "user_id": 1741027, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/N1hWk.jpg?s=128&g=1", "display_name": "slorenzo", "link": "https://stackoverflow.com/users/1741027/slorenzo"}, "edited": false, "score": 0, "creation_date": 1612114793, "post_id": 55552654, "comment_id": 116659851, "body": "@slorenzo that would depend on your use-case, but i would expect native to be somewhat faster than wasm, but both to be many times faster than JS"}, {"owner": {"reputation": 2655, "user_id": 184700, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/ffsUU.jpg?s=128&g=1", "display_name": "Jess Bowers", "link": "https://stackoverflow.com/users/184700/jess-bowers"}, "edited": false, "score": 0, "creation_date": 1612115521, "post_id": 55552654, "comment_id": 116660078, "body": "There is some research that SSVM can outperform native in some cases: <a href=\"https://www.infoq.com/articles/arm-vs-x86-cloud-performance\" rel=\"nofollow noreferrer\">infoq.com/articles/arm-vs-x86-cloud-performance</a>"}], "tags": [], "owner": {"reputation": 64343, "user_id": 249933, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/458f2e0d08d4114f8b323798cfea141d?s=128&d=identicon&r=PG", "display_name": "ColinE", "link": "https://stackoverflow.com/users/249933/coline"}, "is_accepted": true, "score": 9, "last_activity_date": 1554578507, "creation_date": 1554578507, "answer_id": 55552654, "question_id": 55552111, "link": "https://stackoverflow.com/questions/55552111/what-are-the-technical-differences-between-writing-a-node-js-module-using-neon-v/55552654#55552654", "title": "What are the technical differences between writing a Node.js module using Neon vs Wasm?", "body": "<p>Neon provides bindings, making it easy to write native node modules in Rust. Native node modules, as the name implies, are compiled to native code (typically on installation).</p>\n\n<p>Wasm (WebAssembly) is a new runtime for the browser, and node, that is designed to be a fast and efficient compilation target for a wider range of languages. It is executed alongside the JavaScript runtime, sharing threads / memory. Rust has very good WebAssembly support and bindings.</p>\n\n<p>So the main difference is Neon compiles to native, while with wasm you are compiling to a new runtime (that has near native performance).</p>\n\n<p>WebAssembly potentially reduces some of the friction involved in using native node modules.</p>\n"}], "owner": {"reputation": 6209, "user_id": 1935318, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/ftlsb.jpg?s=128&g=1", "display_name": "amaurym", "link": "https://stackoverflow.com/users/1935318/amaurym"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 555, "favorite_count": 0, "accepted_answer_id": 55552654, "answer_count": 1, "score": 3, "last_activity_date": 1554606927, "creation_date": 1554574763, "last_edit_date": 1554606927, "question_id": 55552111, "link": "https://stackoverflow.com/questions/55552111/what-are-the-technical-differences-between-writing-a-node-js-module-using-neon-v", "title": "What are the technical differences between writing a Node.js module using Neon vs Wasm?", "body": "<p>I wish to write a npm module for node.js, using Rust. After some quick research, I found two ways to do it:</p>\n\n<ul>\n<li><a href=\"https://github.com/neon-bindings/neon\" rel=\"nofollow noreferrer\">Neon</a>: \"Rust bindings for writing safe and fast native Node.js modules\"</li>\n<li><a href=\"https://www.rust-lang.org/what/wasm\" rel=\"nofollow noreferrer\">Wasm</a>: \"Binary instruction format for a stack-based virtual machine.\"</li>\n</ul>\n\n<p>What are the technical differences of using one or the other?</p>\n"}, {"tags": ["unix", "rust", "future", "codec", "rust-tokio"], "comments": [{"owner": {"reputation": 149, "user_id": 333952, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oUPYk.jpg?s=128&g=1", "display_name": "Brett", "link": "https://stackoverflow.com/users/333952/brett"}, "edited": false, "score": 1, "creation_date": 1554590659, "post_id": 55552090, "comment_id": 97809345, "body": "In my experience, I&#39;ve had to clear the decoder buffer once I pass back some piece of data. Otherwise Decoder thinks it didn&#39;t receive all of the data needed to decode. Have you tried doing like a src.clear() before returning Ok(Some(evt))?"}, {"owner": {"reputation": 1238, "user_id": 759901, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/56175c4faa3db6d594ed7a0688b0c296?s=128&d=identicon&r=PG", "display_name": "leshow", "link": "https://stackoverflow.com/users/759901/leshow"}, "reply_to_user": {"reputation": 149, "user_id": 333952, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oUPYk.jpg?s=128&g=1", "display_name": "Brett", "link": "https://stackoverflow.com/users/333952/brett"}, "edited": false, "score": 0, "creation_date": 1554590903, "post_id": 55552090, "comment_id": 97809387, "body": "Wow! that appeared to fix the first part of the issue, where I would get the same frame over and over again. Any ideas why the receiving end of my channel isn&#39;t getting any data? (rx.for_each....)  edit: if you have any ideas for that and you want to write it as an answer along with the <code>src.clear()</code> tip, i&#39;ll be happy to accept that as an answer"}, {"owner": {"reputation": 1238, "user_id": 759901, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/56175c4faa3db6d594ed7a0688b0c296?s=128&d=identicon&r=PG", "display_name": "leshow", "link": "https://stackoverflow.com/users/759901/leshow"}, "reply_to_user": {"reputation": 149, "user_id": 333952, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oUPYk.jpg?s=128&g=1", "display_name": "Brett", "link": "https://stackoverflow.com/users/333952/brett"}, "edited": false, "score": 0, "creation_date": 1554600389, "post_id": 55552090, "comment_id": 97810803, "body": "I got the receiving end working, it had something to do with the way futures were being spawned. My suspicion is that the Receiver and Sender are running in different instances of tokio in my test harness. I was able to rectify that by passing a handle to <code>subscribe</code>  If you&#39;d like to submit your first bit about src.clear() as a solution I&#39;ll select it as an answer, I think it could be helpful to others"}], "answers": [{"comments": [{"owner": {"reputation": 1238, "user_id": 759901, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/56175c4faa3db6d594ed7a0688b0c296?s=128&d=identicon&r=PG", "display_name": "leshow", "link": "https://stackoverflow.com/users/759901/leshow"}, "edited": false, "score": 0, "creation_date": 1554679539, "post_id": 55563159, "comment_id": 97828746, "body": "I fixed the other issue by using tokio::current_thread::Runtime to get a runtime reference, then passed that Handle to my subscribe function and used it to spawn() the for_each future that was processing the frames. And also used the same handle to spawn() the rx.for_each that was the receiving end of the mpsc::channel. If that makes any sense. I think the issue was it was running in a different tokio context. Thanks again for your help."}], "tags": [], "owner": {"reputation": 149, "user_id": 333952, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oUPYk.jpg?s=128&g=1", "display_name": "Brett", "link": "https://stackoverflow.com/users/333952/brett"}, "is_accepted": true, "score": 1, "last_activity_date": 1554838280, "last_edit_date": 1554838280, "creation_date": 1554667370, "answer_id": 55563159, "question_id": 55552090, "link": "https://stackoverflow.com/questions/55552090/tokio-framedread-for-each-called-indefinitely-for-single-response/55563159#55563159", "title": "Tokio FramedRead.for_each called indefinitely for single response", "body": "<p>I saw that you resolved your other issue, and I'd be really interested to see how you solved this problem. Here's how I fixed it on my TCP Tokio side project:</p>\n\n<pre><code>use byteorder::{ByteOrder, LittleEndian};\nuse bytes::{Buf, BufMut, Bytes, BytesMut, IntoBuf};\nuse futures::prelude::*;\nuse futures::sync::mpsc::{self, Receiver, Sender};\nuse futures::Stream;\nuse tokio::prelude::*;\nuse tokio_codec::{Decoder, Encoder, FramedRead};\nuse tokio_uds::UnixStream;\n\nfn subscribe(tx: Sender&lt;event::Evt&gt;, rx: Receiver&lt;event::Evt&gt;, events: Vec&lt;Event&gt;) -&gt; io::Result&lt;()&gt; {\n    let fut = UnixStream::connect(socket_path()?)\n        .and_then(move |stream| {\n            // some setup\n            tokio::io::write_all(stream, buf)\n        })\n        .and_then(|(stream, _buf)| {\n            let buf = [0_u8; 30]; // &lt;i3-ipc (6 bytes)&gt;&lt;len (4 bytes)&gt;&lt;type (4 bytes)&gt;&lt;{success:true} 16 bytes&gt;\n            tokio::io::read_exact(stream, buf)\n        })\n        .and_then(|(stream, initial)| {\n            if &amp;initial[0..6] != MAGIC.as_bytes() {\n                panic!(\"Magic str not received\");\n            }\n            // decoding initial response and returning stream\n            future::ok(stream)\n        })\n        .and_then(move |stream| {\n            let framed = FramedRead::new(stream, EvtCodec);\n            let (writer, reader) = framed.split();\n\n            // Connect your framed reader to the channel\n            let sink = rx.forward(writer.sink_map_err(|_| ()));\n            tokio::spawn(sink.map(|_| ()));\n\n            let sender = reader\n                .for_each(move |evt| {\n                    let tx = tx.clone();\n                    tx.send(evt).wait(); // this line is called continuously until buffer fills\n                    Ok(())\n                })\n                .map_err(|err| println!(\"{}\", err));\n            tokio::spawn(sender);\n            Ok(())\n        })\n        .map(|_| ())\n        .map_err(|e| eprintln!(\"{:?}\", e));\n\n    tokio::run(fut);\n    Ok(())\n}\n\n    fn test_sub() -&gt; io::Result&lt;()&gt; {\n        let (tx, rx) = mpsc::channel(5);\n        subscribe(tx, rx, vec![Event::Window])?;\n        let fut = rx.for_each(|e: event::Evt| {\n            println!(\"received\"); // never reaches\n            future::ok(())\n        });\n        tokio::spawn(fut);\n        Ok(())\n    }\n</code></pre>\n\n<p>And the Decoder with the buffer clear:</p>\n\n<pre><code>pub struct EvtCodec;\n\n/// decoding: \"&lt;i3-ipc&gt;&lt;payload len: u32&gt;&lt;msg type: u32&gt;&lt;payload&gt;\"\nimpl Decoder for EvtCodec {\n    type Item = event::Evt;\n    type Error = io::Error;\n    fn decode(&amp;mut self, src: &amp;mut BytesMut) -&gt; Result&lt;Option&lt;Self::Item&gt;, io::Error&gt; {\n        if src.len() &gt; 14 {\n            if &amp;src[0..6] != MAGIC.as_bytes() {\n                return Err(io::Error::new(\n                    io::ErrorKind::Other,\n                    format!(\"Expected 'i3-ipc' but received: {:?}\", &amp;src[0..6]),\n                ));\n            }\n            let payload_len = LittleEndian::read_u32(&amp;src[6..10]) as usize;\n            let evt_type = LittleEndian::read_u32(&amp;src[10..14]);\n            dbg!(&amp;src.len()); // 878\n            dbg!(payload_len); // 864\n            if src.len() &lt; 14 + payload_len {\n                Ok(None)\n            } else {\n                let evt = decode_evt(evt_type, src[14..].as_mut().to_vec())?;\n                dbg!(&amp;evt); // correctly prints out a well-formed event\n                src.clear(); // Clears the buffer, so you don't have to keep decoding the same packet over and over.\n                Ok(Some(evt))\n            }\n        } else {\n            Ok(None)\n        }\n    }\n}\n</code></pre>\n\n<p>Hope this helps!</p>\n\n<p>EDIT:</p>\n\n<p>According to a user on the rust subreddit that commented after I included this solution in a blog post, <code>src.clear()</code> is probably the wrong answer for me. I should instead be using `src.advance(14+payload_len)</p>\n\n<p>linking the reddit comment <a href=\"https://www.reddit.com/r/rust/comments/bb7m1u/protocols_in_tokio_i3_ipc/ekh9rnq/\" rel=\"nofollow noreferrer\">here</a></p>\n"}], "owner": {"reputation": 1238, "user_id": 759901, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/56175c4faa3db6d594ed7a0688b0c296?s=128&d=identicon&r=PG", "display_name": "leshow", "link": "https://stackoverflow.com/users/759901/leshow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 0, "accepted_answer_id": 55563159, "answer_count": 1, "score": 0, "last_activity_date": 1554838280, "creation_date": 1554574672, "question_id": 55552090, "link": "https://stackoverflow.com/questions/55552090/tokio-framedread-for-each-called-indefinitely-for-single-response", "title": "Tokio FramedRead.for_each called indefinitely for single response", "body": "<p>I've been mucking with tokio for a few weeks in the pursuit of writing a protocol using tokio_uds. There are several issues with the following code:</p>\n\n<p><code>framed.for_each</code> is called over and over from a single response. </p>\n\n<p>The socket only sends 1 real message, but the <code>Decoder</code> decodes the exact same event as many times as it can until it fills up the bounded channel.</p>\n\n<p>Nothing is ever received over the channel (<code>rx.for_each</code> never prints anything), though it appears to be written until it fills up.</p>\n\n<p>I need to use a UnixStream and not a UnixListener because there's some data I must put over the socket first to 'subscribe' to the service and let it know what to send. </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use byteorder::{ByteOrder, LittleEndian};\nuse bytes::{Buf, BufMut, Bytes, BytesMut, IntoBuf};\nuse futures::prelude::*;\nuse futures::sync::mpsc::{self, Receiver, Sender};\nuse futures::Stream;\nuse tokio::prelude::*;\nuse tokio_codec::{Decoder, Encoder, FramedRead};\nuse tokio_uds::UnixStream;\n\nfn subscribe(tx: Sender&lt;event::Evt&gt;, events: Vec&lt;Event&gt;) -&gt; io::Result&lt;()&gt; {\n    let fut = UnixStream::connect(socket_path()?)\n        .and_then(move |stream| {\n            // some setup\n            tokio::io::write_all(stream, buf)\n        })\n        .and_then(|(stream, _buf)| {\n            let buf = [0_u8; 30]; // &lt;i3-ipc (6 bytes)&gt;&lt;len (4 bytes)&gt;&lt;type (4 bytes)&gt;&lt;{success:true} 16 bytes&gt;\n            tokio::io::read_exact(stream, buf)\n        })\n        .and_then(|(stream, initial)| {\n            if &amp;initial[0..6] != MAGIC.as_bytes() {\n                panic!(\"Magic str not received\");\n            }\n            // decoding initial response and returning stream\n            future::ok(stream)\n        })\n        .and_then(move |stream| {\n            let framed = FramedRead::new(stream, EvtCodec);\n            let sender = framed\n                .for_each(move |evt| {\n                    let tx = tx.clone();\n                    tx.send(evt).wait(); // this line is called continuously until buffer fills\n                    Ok(())\n                })\n                .map_err(|err| println!(\"{}\", err));\n            tokio::spawn(sender);\n            Ok(())\n        })\n        .map(|_| ())\n        .map_err(|e| eprintln!(\"{:?}\", e));\n\n    tokio::run(fut);\n    Ok(())\n}\n\n    fn test_sub() -&gt; io::Result&lt;()&gt; {\n        let (tx, rx) = mpsc::channel(5);\n        subscribe(tx, vec![Event::Window])?;\n        let fut = rx.for_each(|e: event::Evt| {\n            println!(\"received\"); // never reaches\n            future::ok(())\n        });\n        tokio::spawn(fut);\n        Ok(())\n    }\n</code></pre>\n\n<p>My <code>Decoder</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct EvtCodec;\n\n/// decoding: \"&lt;i3-ipc&gt;&lt;payload len: u32&gt;&lt;msg type: u32&gt;&lt;payload&gt;\"\nimpl Decoder for EvtCodec {\n    type Item = event::Evt;\n    type Error = io::Error;\n    fn decode(&amp;mut self, src: &amp;mut BytesMut) -&gt; Result&lt;Option&lt;Self::Item&gt;, io::Error&gt; {\n        if src.len() &gt; 14 {\n            if &amp;src[0..6] != MAGIC.as_bytes() {\n                return Err(io::Error::new(\n                    io::ErrorKind::Other,\n                    format!(\"Expected 'i3-ipc' but received: {:?}\", &amp;src[0..6]),\n                ));\n            }\n            let payload_len = LittleEndian::read_u32(&amp;src[6..10]) as usize;\n            let evt_type = LittleEndian::read_u32(&amp;src[10..14]);\n            dbg!(&amp;src.len()); // 878\n            dbg!(payload_len); // 864\n            if src.len() &lt; 14 + payload_len {\n                Ok(None)\n            } else {\n                let evt = decode_evt(evt_type, src[14..].as_mut().to_vec())?;\n                dbg!(&amp;evt); // correctly prints out a well-formed event\n                Ok(Some(evt))\n            }\n        } else {\n            Ok(None)\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["rust", "rust-cargo"], "comments": [{"owner": {"reputation": 623, "user_id": 10962821, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-2LR2CPhrhu0/AAAAAAAAAAI/AAAAAAAAAAc/OGsF9pFiFOU/photo.jpg?sz=128", "display_name": "sn99", "link": "https://stackoverflow.com/users/10962821/sn99"}, "edited": false, "score": 1, "creation_date": 1554693754, "post_id": 55551534, "comment_id": 97830944, "body": "The <a href=\"https://os.phil-opp.com/minimal-rust-kernel/#target-specification\" rel=\"nofollow noreferrer\">Target Specification</a> in phil-opp might help"}], "answers": [{"comments": [{"owner": {"reputation": 346, "user_id": 2287549, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tqVx3.png?s=128&g=1", "display_name": "Geoxion", "link": "https://stackoverflow.com/users/2287549/geoxion"}, "edited": false, "score": 0, "creation_date": 1557900978, "post_id": 56137876, "comment_id": 98915549, "body": "Thanks, that will help. The main problem I&#39;m concerned with is the ease of switching. This does not help with that, but will help to ensure that a switch was made correctly."}], "tags": [], "owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "is_accepted": false, "score": 1, "last_activity_date": 1557864426, "creation_date": 1557864426, "answer_id": 56137876, "question_id": 55551534, "link": "https://stackoverflow.com/questions/55551534/how-to-set-the-target-triplet-from-a-crate-in-rust-for-the-entire-program/56137876#56137876", "title": "How to set the target triplet from a crate in Rust for the entire program?", "body": "<p>If your worry is that the config switch is something \"that at some point will be forgotten about\", you can use some conditional compilation to create an error if the target triple is wrong.</p>\n\n<p>e.g. start the crate <code>.lib</code> file with</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[cfg(not(all(target_arch=\"...\",...)))]\ncompile_error!(\"rustc is not correctly configured for this crate - the correct triple is ...\");\n</code></pre>\n\n<p>Then switching crates without updating the cargo config will raise an error.</p>\n"}], "owner": {"reputation": 346, "user_id": 2287549, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tqVx3.png?s=128&g=1", "display_name": "Geoxion", "link": "https://stackoverflow.com/users/2287549/geoxion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1557864426, "creation_date": 1554570832, "question_id": 55551534, "link": "https://stackoverflow.com/questions/55551534/how-to-set-the-target-triplet-from-a-crate-in-rust-for-the-entire-program", "title": "How to set the target triplet from a crate in Rust for the entire program?", "body": "<p>I am exploring ideas for using Rust in a multi-target embedded project.</p>\n\n<p>The current idea I have is to have a crate for every MCU I have. An MCU crate will contain the implementations for things like GPIO, SPI and UART for that specific device.</p>\n\n<p>The system should be designed as such that the MCU crate could be swapped out to the crate of another MCU to target that new MCU. It should also be as easy as possible.</p>\n\n<p>To make that switch right now, you need to also change the .cargo/config file in the executable project from which the build is started yourself. This makes switching a two-step process that at some point will be forgotten about.</p>\n\n<p>Basically, I want the target of the crate to apply to the entire build.</p>\n\n<hr>\n\n<p>I've done some searching around the web to see if it has been before, but either it's not there or my search skills are coming short.</p>\n\n<p>My idea is that a buildscript in the MCU crate could copy its settings to the .cargo/config file of the build instantiator.</p>\n\n<hr>\n\n<p>What I image the buildscript could look like (pseudo):</p>\n\n<pre><code>// Open the config file of the directory from which the build is done\ndir = build_dir\nconfig_file = open_or_create(dir + .cargo/config)\n\n// Read the target of our own crate\nmy_target = open(.cargo/config).get_option(option: target)\n\n// Set the target in the config file of the source\nconfig_file.add_or_replace_option(option: target, value: my_target)\n</code></pre>\n\n<p>With something like this, the switch to a different MCU would be very easy. It'd only take changing the dependency in the toml file.</p>\n\n<p>Alternatively, it could be reversed. The executable could have a buildscript that looked for an MCU crate and copied the settings.</p>\n\n<hr>\n\n<p>My questions:</p>\n\n<ul>\n<li>Is this possible?</li>\n<li>Is this sensible?</li>\n<li>Is there a better way to do it?</li>\n</ul>\n"}, {"tags": ["string", "struct", "rust"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554550479, "post_id": 55548553, "comment_id": 97799033, "body": "&quot;How to build a Struct instance using s2 ?&quot; =&gt; <code>s2.to_string()</code>. &quot;Is it a conception error of World struct ?&quot; =&gt; why not put use a <code>String</code> in <code>World</code> ?"}, {"owner": {"reputation": 5433, "user_id": 801924, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e7897859ed577821631f36eceba0603d?s=128&d=identicon&r=PG", "display_name": "bux", "link": "https://stackoverflow.com/users/801924/bux"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554551346, "post_id": 55548553, "comment_id": 97799220, "body": "@Stargateur a String is a possibility yes. I am a beginner so i have no arguments ^^"}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 1, "creation_date": 1554552345, "post_id": 55548553, "comment_id": 97799445, "body": "Also see <a href=\"https://stackoverflow.com/q/29428227/3650362\">Return local String as a slice (&amp;str)</a>, <a href=\"https://stackoverflow.com/q/29781331/3650362\">Why can&#39;t I return an &amp;str value generated from a String?</a>, <a href=\"https://stackoverflow.com/q/32682876/3650362\">Is there any way to return a reference to a variable created in a function?</a>... Honestly, if you just search [rust] for <a href=\"https://stackoverflow.com/search?q=%5Brust%5D+cannot+return+value+referencing+local+variable\">cannot return value referencing local variable</a> you will find a lot of related questions with answers."}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554579411, "post_id": 55551523, "comment_id": 97806748, "body": "Please refrain from answering <a href=\"https://stackoverflow.com/questions/55548553/struct-str-attribute-must-be-reference#comment97799445_55548553\">questions that are duplicates of existing questions</a>. Doing so spreads little bits of knowledge around to many places as opposed to consolidating them in a few well-maintained locations. It also makes it less likely for previous answers to get deserved upvotes and critical eyes. In the worst cases, it encourages question askers to not search for duplicates themselves."}], "tags": [], "owner": {"reputation": 815, "user_id": 1150292, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VQ2aZ.jpg?s=128&g=1", "display_name": "Mara Bos", "link": "https://stackoverflow.com/users/1150292/mara-bos"}, "is_accepted": false, "score": 1, "last_activity_date": 1554579247, "last_edit_date": 1554579247, "creation_date": 1554570790, "answer_id": 55551523, "question_id": 55548553, "link": "https://stackoverflow.com/questions/55548553/struct-str-attribute-must-be-reference/55551523#55551523", "title": "Struct str attribute must be reference?", "body": "<p><code>World</code> refers to a <code>str</code> slice which must be owned by something else. Your function <code>work</code> allocates a new <code>String</code> (through <code>get_lines</code>), and makes a reference into it (through <code>get_first_line</code>). When it returns, the <code>String</code> goes out of scope and will be dropped, so you cannot keep a reference to it, since the thing it refers to is no longer there.</p>\n\n<p>If you want a <code>World</code> object that does not depend on a <code>String</code> owned by something else, it will need to own the data itself: Contain a <code>String</code> instead of a <code>&amp;'a str</code>.</p>\n\n<p>See also <a href=\"https://doc.rust-lang.org/book/ch04-02-references-and-borrowing.html#dangling-references\" rel=\"nofollow noreferrer\">'dangling references' in the Rust Book</a>.</p>\n"}], "owner": {"reputation": 5433, "user_id": 801924, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e7897859ed577821631f36eceba0603d?s=128&d=identicon&r=PG", "display_name": "bux", "link": "https://stackoverflow.com/users/801924/bux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "closed_date": 1554579173, "answer_count": 1, "score": 1, "last_activity_date": 1554579474, "creation_date": 1554549546, "last_edit_date": 1554579474, "question_id": 55548553, "link": "https://stackoverflow.com/questions/55548553/struct-str-attribute-must-be-reference", "closed_reason": "Duplicate", "title": "Struct str attribute must be reference?", "body": "<p>For the following code:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn get_lines() -&gt; String {\n    String::from(\"Hello\\nWorld\")\n}\n\nfn get_first_line(s: &amp;String) -&gt; &amp;str {\n    s.lines().next().unwrap()\n}\n\nstruct World&lt;'a&gt; {\n    a_str: &amp;'a str,\n}\n\nfn work&lt;'a&gt;() -&gt; World&lt;'a&gt; {\n    let s1 = get_lines();\n    let s2 = get_first_line(&amp;s1);\n\n    World { a_str: s2 }\n}\n\nfn main() {\n    let w = work();\n}\n</code></pre>\n\n<p>I got the following error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0515]: cannot return value referencing local variable `s1`\n  --&gt; src/main.rs:17:5\n   |\n15 |     let s2 = get_first_line(&amp;s1);\n   |                             --- `s1` is borrowed here\n16 | \n17 |     World { a_str: s2 }\n   |     ^^^^^^^^^^^^^^^^^^^ returns a value referencing data owned by the current function\n</code></pre>\n\n<p>How to build a struct instance using <code>s2</code>? Is it a conceptual error of the <code>World</code> struct?</p>\n"}, {"tags": ["windows", "rust", "clipboard"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 10889302, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-67ZhEOGzp8A/AAAAAAAAAAI/AAAAAAAAAA4/J86lLuOFWDE/photo.jpg?sz=128", "display_name": "tantalum", "link": "https://stackoverflow.com/users/10889302/tantalum"}, "edited": false, "score": 0, "creation_date": 1554601148, "post_id": 55554741, "comment_id": 97810879, "body": "Thank you for pointing out my question. Is there a problem with <a href=\"https://docs.microsoft.com/en-us/windows/desktop/dataxchg/standard-clipboard-formats\" rel=\"nofollow noreferrer\">clipboard-formats</a>?"}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 1, "last_activity_date": 1554647479, "last_edit_date": 1592644375, "creation_date": 1554598395, "answer_id": 55554741, "question_id": 55545157, "link": "https://stackoverflow.com/questions/55545157/how-to-write-an-image-to-the-windows-clipboard-in-rust/55554741#55554741", "title": "How to write an image to the Windows clipboard in Rust", "body": "<p>You have multiple problems.</p>\n<h1>Format</h1>\n<p>A <a href=\"https://en.wikipedia.org/wiki/Portable_Network_Graphics\" rel=\"nofollow noreferrer\">PNG format image</a> is not a <a href=\"https://en.wikipedia.org/wiki/BMP_file_format\" rel=\"nofollow noreferrer\">bitmap format image</a>, even though it is <em>a</em> <a href=\"https://en.wikipedia.org/wiki/Digital_image\" rel=\"nofollow noreferrer\">bitmap</a>.</p>\n<p>A <a href=\"https://social.msdn.microsoft.com/Forums/office/en-US/d39f3fb9-4a61-4157-bfdb-f68f91d5cf7f/how-to-send-a-png-image-to-clipboard-using-setclipboarddata-?forum=windowssdk\" rel=\"nofollow noreferrer\">thread on MSDN</a> states:</p>\n<blockquote>\n<p>There isn't a standardized clipboard format for PNG.</p>\n<p>You can register your own format, but then only you can recognize the clipboard. If you use the standard bitmap or file format then more applications can accept your data.</p>\n</blockquote>\n<h1>Error handling</h1>\n<p><a href=\"https://docs.rs/clipboard-win/2.1.2/clipboard_win/struct.Clipboard.html#method.set\" rel=\"nofollow noreferrer\"><code>Clipboard::set</code></a> can fail and it returns a <code>Result</code>. <em>You need to handle this case</em>. The compiler even told you about this:</p>\n<pre class=\"lang-none prettyprint-override\"><code>warning: unused `std::result::Result` that must be used\n  --&gt; src\\main.rs:11:5\n   |\n11 | /     Clipboard::new()\n12 | |         .unwrap()\n13 | |         .set(formats::CF_BITMAP, &amp;data);\n   | |________________________________________^\n   |\n   = note: #[warn(unused_must_use)] on by default\n   = note: this `Result` may be an `Err` variant, which should be handled\n</code></pre>\n<p><strong>Don't ignore warnings, <em>especially</em> when trying to debug a problem.</strong></p>\n<hr />\n<p>Unfortunately, this is as far as I got:</p>\n<pre><code>use clipboard_win::{formats, Clipboard}; // 2.1.2\nuse image::ImageOutputFormat; // 0.21.0\n\nfn main() {\n    let img = image::open(&quot;unicorn.png&quot;).unwrap();\n\n    let mut data = Vec::new();\n    img.write_to(&amp;mut data, ImageOutputFormat::BMP)\n        .expect(&quot;Unable to transform&quot;);\n\n    Clipboard::new()\n        .unwrap()\n        .set(formats::CF_BITMAP, &amp;data)\n        .expect(&quot;Unable to set clipboard&quot;);\n}\n</code></pre>\n<p>Writing <code>data</code> to a file produces a BMP that Paint can read, but the clipboard data is still invalid. While attempting to debug the differences, I ran into <a href=\"https://github.com/DoumanAsh/clipboard-win/issues/10\" rel=\"nofollow noreferrer\">low-level crashes in the library</a>, which suggests it may not be ready for general use, despite the 2.x version number.</p>\n<p>I believe that the root problem is that</p>\n<p>Windows expects</p>\n<blockquote>\n<p>A handle to a bitmap (<code>HBITMAP</code>).</p>\n</blockquote>\n<p>A <a href=\"https://docs.microsoft.com/en-us/windows/desktop/api/wingdi/ns-wingdi-bitmap\" rel=\"nofollow noreferrer\"><code>BITMAP</code></a> is a struct with a set of information about the bitmap, such as width and height. This is likely different from the on-disk format of the bitmap.</p>\n<p>It seems plausible that fitting the bitmap data into this expected format would go a long way to solving the problem.</p>\n<p>Another avenue is to look into using <code>CF_DIB</code> instead of <code>CF_BITMAP</code>. Contrary to the linked forum post above, <code>CF_DIB</code> expects a pointer to a <a href=\"https://docs.microsoft.com/en-us/windows/desktop/api/wingdi/ns-wingdi-tagbitmapinfo\" rel=\"nofollow noreferrer\"><code>BITMAPINFO</code></a> which has a <a href=\"https://docs.microsoft.com/en-us/windows/desktop/api/wingdi/ns-wingdi-bitmapinfoheader\" rel=\"nofollow noreferrer\"><code>BITMAPINFOHEADER</code></a> field. This makes a reference to a <code>BI_PNG</code> compression, which might allow you to submit a PNG without performing transformations.</p>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://stackoverflow.com/q/50731636/155423\">How do I encode a Rust Piston image and get the result in memory?</a></li>\n</ul>\n"}], "owner": {"reputation": 13, "user_id": 10889302, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-67ZhEOGzp8A/AAAAAAAAAAI/AAAAAAAAAA4/J86lLuOFWDE/photo.jpg?sz=128", "display_name": "tantalum", "link": "https://stackoverflow.com/users/10889302/tantalum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 340, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1554647479, "creation_date": 1554515184, "last_edit_date": 1554598411, "question_id": 55545157, "link": "https://stackoverflow.com/questions/55545157/how-to-write-an-image-to-the-windows-clipboard-in-rust", "title": "How to write an image to the Windows clipboard in Rust", "body": "<p>I want to put a local image into the clipboard using Rust. I used the <a href=\"https://crates.io/crates/clipboard-win\" rel=\"nofollow noreferrer\">clipboard-win</a> and <a href=\"https://crates.io/crates/image\" rel=\"nofollow noreferrer\">image</a> crates. My code is as follows, but it doesn't work.</p>\n\n<pre><code>extern crate clipboard_win;\nextern crate image;\n\nuse clipboard_win::{formats, Clipboard};\nuse image::GenericImageView;\n\nfn main() {\n    let img = image::open(\"C:\\\\Users\\\\Crash\\\\Desktop\\\\20190405221505.png\").unwrap();\n    Clipboard::new()\n        .unwrap()\n        .set(formats::CF_BITMAP, &amp;img.raw_pixels());\n}\n</code></pre>\n\n<p>After execution, there seems to be content in the pasteboard, but there is nothing displayed after <kbd>Ctrl</kbd>+<kbd>V</kbd>. How can I correct this code?</p>\n"}, {"tags": ["rust", "rust-macros"], "comments": [{"owner": {"reputation": 1540, "user_id": 2606171, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F4ncy.png?s=128&g=1", "display_name": "belst", "link": "https://stackoverflow.com/users/2606171/belst"}, "edited": false, "score": 1, "creation_date": 1554497522, "post_id": 55543094, "comment_id": 97789546, "body": "What is wrong with writing a function? <code>fn scalar_product(x: &amp;[i64], y: &amp;[i64]) -&gt; i64 {     return x.iter().zip(y.iter()).map(|(l, r)| l * r).sum() }</code>"}, {"owner": {"reputation": 73, "user_id": 9604623, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/157858bb143f86bf3f8391f104cec504?s=128&d=identicon&r=PG&f=1", "display_name": "Jean-Paul Dax", "link": "https://stackoverflow.com/users/9604623/jean-paul-dax"}, "reply_to_user": {"reputation": 1540, "user_id": 2606171, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F4ncy.png?s=128&g=1", "display_name": "belst", "link": "https://stackoverflow.com/users/2606171/belst"}, "edited": false, "score": 0, "creation_date": 1554498465, "post_id": 55543094, "comment_id": 97789876, "body": "Well the idea is to make it run faster. You can spare at least half the computations since <code>l</code> will be 0, 1 and -1."}, {"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "edited": false, "score": 0, "creation_date": 1554504685, "post_id": 55543094, "comment_id": 97791628, "body": "I would start with assuming the compiler is smart, compiling the thing with optimizations, and checking if the loop is unrolled in the desired fashion. It may be, the macro isn&#39;t even needed."}, {"owner": {"reputation": 73, "user_id": 9604623, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/157858bb143f86bf3f8391f104cec504?s=128&d=identicon&r=PG&f=1", "display_name": "Jean-Paul Dax", "link": "https://stackoverflow.com/users/9604623/jean-paul-dax"}, "edited": false, "score": 0, "creation_date": 1554541202, "post_id": 55543094, "comment_id": 97796944, "body": "Thank you for your answers. As pointed out in my <i>edited</i> post the compiler is unfortunately not smart enough to save me since I&#39;m using also floats in my computations."}], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 9604623, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/157858bb143f86bf3f8391f104cec504?s=128&d=identicon&r=PG&f=1", "display_name": "Jean-Paul Dax", "link": "https://stackoverflow.com/users/9604623/jean-paul-dax"}, "edited": false, "score": 0, "creation_date": 1554541127, "post_id": 55545179, "comment_id": 97796932, "body": "Thank you very much for your answer. Since it&#39;s not optimizing the 0/1 away it&#39;s not exactly what I was after. Nevertheless is interesting in itself!"}], "tags": [], "owner": {"reputation": 920, "user_id": 6677437, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdfe2432cdce6e35079355784c05993c?s=128&d=identicon&r=PG&f=1", "display_name": "asky", "link": "https://stackoverflow.com/users/6677437/asky"}, "is_accepted": false, "score": 3, "last_activity_date": 1554515474, "creation_date": 1554515474, "answer_id": 55545179, "question_id": 55543094, "link": "https://stackoverflow.com/questions/55543094/how-to-simplify-mathematical-formulas-with-rust-macros/55545179#55545179", "title": "How to simplify mathematical formulas with rust macros?", "body": "<p>You may be able to achieve your goal with a macro that returns a function.</p>\n\n<p>First, write this function without a macro. This one takes a fixed number of parameters.</p>\n\n<pre><code>fn main() {\n    println!(\"Hello, world!\");\n    let func = gen_sum([1,2,3]);\n    println!(\"{}\", func([4,5,6])) // 1*4 + 2*5 + 3*6 = 4 + 10 + 18 = 32\n}\n\nfn gen_sum(xs: [i32; 3]) -&gt; impl Fn([i32;3]) -&gt; i32 {\n    move |ys| ys[0]*xs[0] + ys[1]*xs[1] + ys[2]*xs[2]\n}\n</code></pre>\n\n<p>Now, completely rewrite it because the prior design doesn't work well as a macro. We had to give up on fixed sized arrays, as <a href=\"https://old.reddit.com/r/rust/comments/29ymbx/a_macro_to_fill_a_fixed_length_array/\" rel=\"nofollow noreferrer\">macros appear unable to allocate fixed-sized arrays</a>.</p>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=b4f1fbc4ad5f0c0467df4562883f1eb1\" rel=\"nofollow noreferrer\">Rust Playground</a></p>\n\n<pre><code>fn main() {\n    let func = gen_sum!(1,2,3);\n    println!(\"{}\", func(vec![4,5,6])) // 1*4 + 2*5 + 3*6 = 4 + 10 + 18 = 32\n}\n\n#[macro_export]\nmacro_rules! gen_sum {\n    ( $( $x:expr ),* ) =&gt; {\n        {\n            let mut xs = Vec::new();\n            $(\n                xs.push($x);\n            )*\n            move |ys:Vec&lt;i32&gt;| {\n                if xs.len() != ys.len() {\n                    panic!(\"lengths don't match\")\n                }\n                let mut total = 0;\n                for i in 0 as usize .. xs.len() {\n                    total += xs[i] * ys[i];\n                }\n                total\n            } \n        }\n    };\n}\n</code></pre>\n\n<h1>What does this do/What should it do</h1>\n\n<p>At compile time, it generates a lambda. This lambda accepts a list of numbers and multiplies it by a vec that was generated at compile time. I don't think this was exactly what you were after, as it does not optimize away zeroes at compile time. You could optimize away zeroes at compile time, but you would necessarily incur some cost at run-time by having to check where the zeroes were in x to determine which elements to multiply by in y. You could even make this lookup process in constant time using a hashset. It's still probably not worth it in general (where I presume 0 is not all that common). Computers are better at doing one thing that's \"inefficient\" than they are at detecting that the thing they're about to do is \"inefficient\" then skipping that thing. This abstraction breaks down when a significant portion of the operations they do are \"inefficient\"</p>\n\n<h1>Follow-up</h1>\n\n<p>Was that worth it? Does it improve run times? I didn't measure, but it seems like understanding and maintaining the macro I wrote isn't worth it compared to just using a function. Writing a macro that does the zero optimization you talked about would probably be even less pleasant.</p>\n"}, {"comments": [{"owner": {"reputation": 73, "user_id": 9604623, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/157858bb143f86bf3f8391f104cec504?s=128&d=identicon&r=PG&f=1", "display_name": "Jean-Paul Dax", "link": "https://stackoverflow.com/users/9604623/jean-paul-dax"}, "edited": false, "score": 0, "creation_date": 1554540463, "post_id": 55546357, "comment_id": 97796803, "body": "Thanks a lot for your answer. As explained in my <i>edited</i> question, y is made of floats in general. The compiler is therefore not smart enough to optimize the loop."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 73, "user_id": 9604623, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/157858bb143f86bf3f8391f104cec504?s=128&d=identicon&r=PG&f=1", "display_name": "Jean-Paul Dax", "link": "https://stackoverflow.com/users/9604623/jean-paul-dax"}, "edited": false, "score": 0, "creation_date": 1554542170, "post_id": 55546357, "comment_id": 97797158, "body": "@Jean-PaulDax Do you have any indication that this loop causes a performance bottleneck for your code as a whole?"}, {"owner": {"reputation": 73, "user_id": 9604623, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/157858bb143f86bf3f8391f104cec504?s=128&d=identicon&r=PG&f=1", "display_name": "Jean-Paul Dax", "link": "https://stackoverflow.com/users/9604623/jean-paul-dax"}, "edited": false, "score": 0, "creation_date": 1554543963, "post_id": 55546357, "comment_id": 97797560, "body": "Yes. This kind of function is called potentially billions of times in fluid dynamics simulations. At the moment I am explicitly simplifying the loop by hand but it severely lacks genericity when the model is modified. The gain depending on the model is of at least an order of magnitude (this kind of computations are done all the time)."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 73, "user_id": 9604623, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/157858bb143f86bf3f8391f104cec504?s=128&d=identicon&r=PG&f=1", "display_name": "Jean-Paul Dax", "link": "https://stackoverflow.com/users/9604623/jean-paul-dax"}, "edited": false, "score": 0, "creation_date": 1554624038, "post_id": 55546357, "comment_id": 97814397, "body": "@Jean-PaulDax I see \u2013 this makes sense, and is indeed one of the situations where turning to micro-optimisations is warranted. The reason the compiler cannot optimise this for floating point numbers is already explained in the accepted answer, but I will add another simple solution here."}, {"owner": {"reputation": 73, "user_id": 9604623, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/157858bb143f86bf3f8391f104cec504?s=128&d=identicon&r=PG&f=1", "display_name": "Jean-Paul Dax", "link": "https://stackoverflow.com/users/9604623/jean-paul-dax"}, "edited": false, "score": 0, "creation_date": 1554635775, "post_id": 55546357, "comment_id": 97817005, "body": "Thanks a lot for the alternative solution. Can we have two accepted answers?"}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 73, "user_id": 9604623, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/157858bb143f86bf3f8391f104cec504?s=128&d=identicon&r=PG&f=1", "display_name": "Jean-Paul Dax", "link": "https://stackoverflow.com/users/9604623/jean-paul-dax"}, "edited": false, "score": 0, "creation_date": 1554635937, "post_id": 55546357, "comment_id": 97817055, "body": "@Jean-PaulDax No, you need to pick one. This solution may be more general, since it gives a general way of allowing the compiler to perform certain floating-point optimisations it would otherwise not be allowed to do, but this comes at the cost of using unstable features and unsafe code."}], "tags": [], "owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "is_accepted": false, "score": 3, "last_activity_date": 1554633996, "last_edit_date": 1554633996, "creation_date": 1554530674, "answer_id": 55546357, "question_id": 55543094, "link": "https://stackoverflow.com/questions/55543094/how-to-simplify-mathematical-formulas-with-rust-macros/55546357#55546357", "title": "How to simplify mathematical formulas with rust macros?", "body": "<p>In many cases, the optimisation stage of the compiler will take care of this for you. To give an example, this function definition</p>\n\n<pre><code>const X: [i32; 8] = [0, 1, -1, 0, 0, 1, 0, -1];\n\npub fn dot_x(y: [i32; 8]) -&gt; i32 {\n    X.iter().zip(y.iter()).map(|(i, j)| i * j).sum()\n}\n</code></pre>\n\n<p>results in this assembly output on x86_64:</p>\n\n<pre><code>playground::dot_x:\n    mov eax, dword ptr [rdi + 4]\n    sub eax, dword ptr [rdi + 8]\n    add eax, dword ptr [rdi + 20]\n    sub eax, dword ptr [rdi + 28]\n    ret\n</code></pre>\n\n<p>You won't be able to get any more optimised version than this, so simply writing the code in a na\u00efve way is the best solution.  Whether the compiler will unroll the loop for longer vectors is unclear, and it may change with compiler versions.</p>\n\n<p>For floating-point numbers, the compiler is not normally able to perform all the optimisations above, since the numbers in <code>y</code> are not guaranteed to be finite \u2013 they could also be <code>NaN</code>, <code>inf</code> or <code>-inf</code>. For this reason, multiplying with <code>0.0</code> is not guaranteed to result in <code>0.0</code> again, so the compiler needs to keep the multiplication instructions in the code. You can explicitly allow it to assume all numbers are finite, though, by using the <code>fmul_fast()</code> instrinsic function:</p>\n\n<pre><code>#![feature(core_intrinsics)]\nuse std::intrinsics::fmul_fast;\n\nconst X: [i32; 8] = [0, 1, -1, 0, 0, 1, 0, -1];\n\npub fn dot_x(y: [f64; 8]) -&gt; f64 {\n    X.iter().zip(y.iter()).map(|(i, j)| unsafe { fmul_fast(*i as f64, *j) }).sum()\n}\n</code></pre>\n\n<p>This results in the following assembly code:</p>\n\n<pre><code>playground::dot_x: # @playground::dot_x\n# %bb.0:\n    xorpd   xmm1, xmm1\n    movsd   xmm0, qword ptr [rdi + 8] # xmm0 = mem[0],zero\n    addsd   xmm0, xmm1\n    subsd   xmm0, qword ptr [rdi + 16]\n    addsd   xmm0, xmm1\n    addsd   xmm0, qword ptr [rdi + 40]\n    addsd   xmm0, xmm1\n    subsd   xmm0, qword ptr [rdi + 56]\n    ret\n</code></pre>\n\n<p>This still redundantly adds zeros between the steps, but I would not expect this to result in any measurable overhead for realistic CFD simulations, since such simulations tend to be limited by memory bandwidth rather than CPU. If you want to avoid these additions as well, you need to use <code>fadd_fast()</code> for the additions to allow the compiler to optimise further:</p>\n\n<pre><code>#![feature(core_intrinsics)]\nuse std::intrinsics::{fadd_fast, fmul_fast};\n\nconst X: [i32; 8] = [0, 1, -1, 0, 0, 1, 0, -1];\n\npub fn dot_x(y: [f64; 8]) -&gt; f64 {\n    let mut result = 0.0;\n    for (&amp;i, &amp;j) in X.iter().zip(y.iter()) {\n        unsafe { result = fadd_fast(result, fmul_fast(i as f64, j)); }\n    }\n    result\n}\n</code></pre>\n\n<p>This results in the following assembly code:</p>\n\n<pre><code>playground::dot_x: # @playground::dot_x\n# %bb.0:\n    movsd   xmm0, qword ptr [rdi + 8] # xmm0 = mem[0],zero\n    subsd   xmm0, qword ptr [rdi + 16]\n    addsd   xmm0, qword ptr [rdi + 40]\n    subsd   xmm0, qword ptr [rdi + 56]\n    ret\n</code></pre>\n\n<p>As with all optmisations, you should start with the most readable and maintainable version of the code. If performance becomes an issue, you should profile your code and find the bottlenecks. As the next step, try to improve the fundamental approach, e.g. by using an algorithm with a better asymptotical complexity. Only then should you turn to micro-optimisations like the one you suggested in the question.</p>\n"}, {"comments": [{"owner": {"reputation": 73, "user_id": 9604623, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/157858bb143f86bf3f8391f104cec504?s=128&d=identicon&r=PG&f=1", "display_name": "Jean-Paul Dax", "link": "https://stackoverflow.com/users/9604623/jean-paul-dax"}, "edited": false, "score": 1, "creation_date": 1554560161, "post_id": 55549740, "comment_id": 97801291, "body": "Wow! It really looks like it&#39;s <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=release&amp;edition=2018&amp;gist=b7d2d1886730c46daf66edf187cb9e6a\" rel=\"nofollow noreferrer\">working</a>! Will test it in my actual code and post an update. Never thought the compiler to be so smart..."}], "tags": [], "owner": {"reputation": 912, "user_id": 1570826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/568ad11ab0e853c0e4e8f8ade8bd5278?s=128&d=identicon&r=PG", "display_name": "lu_zero", "link": "https://stackoverflow.com/users/1570826/lu-zero"}, "is_accepted": false, "score": 3, "last_activity_date": 1555344626, "last_edit_date": 1555344626, "creation_date": 1554558778, "answer_id": 55549740, "question_id": 55543094, "link": "https://stackoverflow.com/questions/55543094/how-to-simplify-mathematical-formulas-with-rust-macros/55549740#55549740", "title": "How to simplify mathematical formulas with rust macros?", "body": "<p>If you can spare an <code>#[inline(always)]</code> probably using an explicit <a href=\"https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.filter_map\" rel=\"nofollow noreferrer\">filter_map()</a> should be enough to have the compiler do what you want.</p>\n"}, {"comments": [{"owner": {"reputation": 73, "user_id": 9604623, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/157858bb143f86bf3f8391f104cec504?s=128&d=identicon&r=PG&f=1", "display_name": "Jean-Paul Dax", "link": "https://stackoverflow.com/users/9604623/jean-paul-dax"}, "edited": false, "score": 0, "creation_date": 1554561644, "post_id": 55549963, "comment_id": 97801713, "body": "Thanks a lot. As pointed out by @lu-zero it can be made even shorter with a filter_map(). I am currently putting this in my code and see if the performances are as good as with &quot;by hand analytical optimization&quot; but I guess it will be!"}, {"owner": {"reputation": 815, "user_id": 1150292, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VQ2aZ.jpg?s=128&g=1", "display_name": "Mara Bos", "link": "https://stackoverflow.com/users/1150292/mara-bos"}, "reply_to_user": {"reputation": 73, "user_id": 9604623, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/157858bb143f86bf3f8391f104cec504?s=128&d=identicon&r=PG&f=1", "display_name": "Jean-Paul Dax", "link": "https://stackoverflow.com/users/9604623/jean-paul-dax"}, "edited": false, "score": 0, "creation_date": 1554562144, "post_id": 55549963, "comment_id": 97801861, "body": "Using the <code>filter_map().sum()</code> approach will still result in the <code>0.0 + ...</code> calculation. Writing it out a bit more like my last example will save you one more instruction. (Which, admittedly, might not be significant.)"}, {"owner": {"reputation": 73, "user_id": 9604623, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/157858bb143f86bf3f8391f104cec504?s=128&d=identicon&r=PG&f=1", "display_name": "Jean-Paul Dax", "link": "https://stackoverflow.com/users/9604623/jean-paul-dax"}, "edited": false, "score": 0, "creation_date": 1554563533, "post_id": 55549963, "comment_id": 97802228, "body": "Correct. Thanks."}, {"owner": {"reputation": 348, "user_id": 8496913, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/B5NSF.png?s=128&g=1", "display_name": "jens1o", "link": "https://stackoverflow.com/users/8496913/jens1o"}, "edited": false, "score": 0, "creation_date": 1554573652, "post_id": 55549963, "comment_id": 97805168, "body": "How can I look into the Assembly code without using play.rust-lang.org, but on crates I compiled on my computer directly?"}, {"owner": {"reputation": 815, "user_id": 1150292, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VQ2aZ.jpg?s=128&g=1", "display_name": "Mara Bos", "link": "https://stackoverflow.com/users/1150292/mara-bos"}, "reply_to_user": {"reputation": 348, "user_id": 8496913, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/B5NSF.png?s=128&g=1", "display_name": "jens1o", "link": "https://stackoverflow.com/users/8496913/jens1o"}, "edited": false, "score": 1, "creation_date": 1554575846, "post_id": 55549963, "comment_id": 97805758, "body": "@jens1o I use <code>objdump -xdC</code>, but that&#39;s probably not the easiest way. This seems useful: <a href=\"https://github.com/gnzlbg/cargo-asm\" rel=\"nofollow noreferrer\">github.com/gnzlbg/cargo-asm</a>"}], "tags": [], "owner": {"reputation": 815, "user_id": 1150292, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VQ2aZ.jpg?s=128&g=1", "display_name": "Mara Bos", "link": "https://stackoverflow.com/users/1150292/mara-bos"}, "is_accepted": true, "score": 8, "last_activity_date": 1554579787, "last_edit_date": 1554579787, "creation_date": 1554560245, "answer_id": 55549963, "question_id": 55543094, "link": "https://stackoverflow.com/questions/55543094/how-to-simplify-mathematical-formulas-with-rust-macros/55549963#55549963", "title": "How to simplify mathematical formulas with rust macros?", "body": "<p>First of all, a (proc) macro can simply not look inside your array <code>x</code>. All it gets are the tokens you pass it, without any context. If you want it to know about the values (0, 1, -1), you need to pass those directly to your macro:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let result = your_macro!(y, -1, 0, 1, -1);\n</code></pre>\n\n<p>But you don't really need a macro for this. The compiler optimizes a lot, as also shown in the other answers. However, it will not, as you already mention in your edit, optimize away <code>0.0 * x[i]</code>, as the result of that is not always <code>0.0</code>. (It could be <code>-0.0</code> or <code>NaN</code> for example.) What we can do here, is simply help the optimizer a bit by using a <code>match</code> or <code>if</code>, to make sure it does nothing for the <code>0.0 * y</code> case:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>const X: [i32; 8] = [0, -1, 0, 0, 0, 0, 1, 0];\n\nfn foobar(y: [f64; 8]) -&gt; f64 {\n    let mut sum = 0.0;\n    for (&amp;x, &amp;y) in X.iter().zip(&amp;y) {\n        if x != 0 {\n            sum += x as f64 * y;\n        }\n    }\n    sum\n}\n</code></pre>\n\n<p>In release mode, the loop is unrolled and the values of <code>X</code> inlined, resulting in most iterations being thrown away as they don't do anything. The only thing left in the resulting binary (on x86_64), is:</p>\n\n<pre><code>foobar:\n xorpd   xmm0, xmm0\n subsd   xmm0, qword, ptr, [rdi, +, 8]\n addsd   xmm0, qword, ptr, [rdi, +, 48]\n ret\n</code></pre>\n\n<blockquote>\n  <p>(As suggested by @lu-zero, this can also be done using <code>filter_map</code>. That will look like this: <code>X.iter().zip(&amp;y).filter_map(|(&amp;x, &amp;y)| match x { 0 =&gt; None, _ =&gt; Some(x as f64 * y) }).sum()</code>, and gives the exact same generated assembly. Or even without a <code>match</code>, by using <code>filter</code> and <code>map</code> separately: <code>.filter(|(&amp;x, _)| x != 0).map(|(&amp;x, &amp;y)| x as f64 * y).sum()</code>.)</p>\n</blockquote>\n\n<p>Pretty good! However, this function calculates <code>0.0 - y[1] + y[6]</code>, since <code>sum</code> started at <code>0.0</code> and we only subtract and add things to it. The optimizer is again not willing to optimize away a <code>0.0</code>. We can help it a bit more by not starting at <code>0.0</code>, but starting with <code>None</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn foobar(y: [f64; 8]) -&gt; f64 {\n    let mut sum = None;\n    for (&amp;x, &amp;y) in X.iter().zip(&amp;y) {\n        if x != 0 {\n            let p = x as f64 * y;\n            sum = Some(sum.map_or(p, |s| s + p));\n        }\n    }\n    sum.unwrap_or(0.0)\n}\n</code></pre>\n\n<p>This results in:</p>\n\n<pre><code>foobar:\n movsd   xmm0, qword, ptr, [rdi, +, 48]\n subsd   xmm0, qword, ptr, [rdi, +, 8]\n ret\n</code></pre>\n\n<p>Which simply does <code>y[6] - y[1]</code>. Bingo!</p>\n"}], "owner": {"reputation": 73, "user_id": 9604623, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/157858bb143f86bf3f8391f104cec504?s=128&d=identicon&r=PG&f=1", "display_name": "Jean-Paul Dax", "link": "https://stackoverflow.com/users/9604623/jean-paul-dax"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 777, "favorite_count": 0, "accepted_answer_id": 55549963, "answer_count": 4, "score": 7, "last_activity_date": 1555344626, "creation_date": 1554496999, "last_edit_date": 1554540376, "question_id": 55543094, "link": "https://stackoverflow.com/questions/55543094/how-to-simplify-mathematical-formulas-with-rust-macros", "title": "How to simplify mathematical formulas with rust macros?", "body": "<p>I must admit I'm a bit lost with macros.\nI want to build a macro that does the following task and\nI'm not sure how to do it. I want to perform a scalar product\nof two arrays, say x and y, which have the same length N.\nThe result I want to compute is of the form:</p>\n\n<pre><code>z = sum_{i=0}^{N-1} x[i] * y[i].\n</code></pre>\n\n<p><code>x</code> is <code>const</code> which elements are <code>0, 1, or -1</code> which are known at compile time,\nwhile <code>y</code>'s elements are determined at runtime. Because of the\nstructure of <code>x</code>, many computations are useless (terms multiplied by 0\ncan be removed from the sum, and multiplications of the form <code>1 * y[i], -1 * y[i]</code> can be transformed into <code>y[i], -y[i]</code> respectively).</p>\n\n<p>As an example if <code>x = [-1, 1, 0]</code>, the scalar product above would be</p>\n\n<pre><code>z=-1 * y[0] + 1 * y[1] + 0 * y[2]\n</code></pre>\n\n<p>To speed up my computation I can unroll the loop by hand and rewrite\nthe whole thing without <code>x[i]</code>, and I could hard code the above formula as</p>\n\n<pre><code>z = -y[0] + y[1]\n</code></pre>\n\n<p>But this procedure is not elegant, error prone\nand very tedious when N becomes large.</p>\n\n<p>I'm pretty sure I can do that with a macro, but I don't know where to\nstart (the different books I read are not going too deep into macros and \nI'm stuck)...</p>\n\n<p>Would anyone of you have any idea how to (if it is possible) this problem using macros?</p>\n\n<p>Thank you in advance for your help!</p>\n\n<p><strong>Edit:</strong> As pointed out in many of the answers, the compiler is smart enough to remove optimize the loop in the case of integers. I am not only using integers but also floats (the <code>x</code> array is i32s, but in general <code>y</code> is <code>f64</code>s), so the compiler is not smart enough (and rightfully so) to optimize the loop. The following piece of code gives the following asm.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>const X: [i32; 8] = [0, 1, -1, 0, 0, 1, 0, -1];\n\npub fn dot_x(y: [f64; 8]) -&gt; f64 {\n    X.iter().zip(y.iter()).map(|(i, j)| (*i as f64) * j).sum()\n}\n</code></pre>\n\n<pre><code>playground::dot_x:\n    xorpd   %xmm0, %xmm0\n    movsd   (%rdi), %xmm1\n    mulsd   %xmm0, %xmm1\n    addsd   %xmm0, %xmm1\n    addsd   8(%rdi), %xmm1\n    subsd   16(%rdi), %xmm1\n    movupd  24(%rdi), %xmm2\n    xorpd   %xmm3, %xmm3\n    mulpd   %xmm2, %xmm3\n    addsd   %xmm3, %xmm1\n    unpckhpd    %xmm3, %xmm3\n    addsd   %xmm1, %xmm3\n    addsd   40(%rdi), %xmm3\n    mulsd   48(%rdi), %xmm0\n    addsd   %xmm3, %xmm0\n    subsd   56(%rdi), %xmm0\n    retq\n</code></pre>\n"}, {"tags": ["rust", "operating-system", "kernel", "bootloader", "rust-cargo"], "comments": [{"owner": {"reputation": 41564, "user_id": 3857942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hXLnN.jpg?s=128&g=1", "display_name": "Michael Petch", "link": "https://stackoverflow.com/users/3857942/michael-petch"}, "edited": false, "score": 0, "creation_date": 1554494461, "post_id": 55542407, "comment_id": 97788397, "body": "Don&#39;t link them together. Have the linking of rust objects output to a binary file (I don&#39;t use rust, but you can use <code>objcopy</code> to convert an elf executable (generated by rust) to binary. Place the binary file on the disk where your bootloader will be reading the sectors from.You can do that with <code>dd</code>."}, {"owner": {"reputation": 41564, "user_id": 3857942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hXLnN.jpg?s=128&g=1", "display_name": "Michael Petch", "link": "https://stackoverflow.com/users/3857942/michael-petch"}, "edited": false, "score": 0, "creation_date": 1554494777, "post_id": 55542407, "comment_id": 97788538, "body": "It appears there is a <code>bootimage</code> Rust project to create a bootable disk image that includes the Rust ELF executable."}, {"owner": {"reputation": 41564, "user_id": 3857942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hXLnN.jpg?s=128&g=1", "display_name": "Michael Petch", "link": "https://stackoverflow.com/users/3857942/michael-petch"}, "edited": false, "score": 0, "creation_date": 1554495234, "post_id": 55542407, "comment_id": 97788696, "body": "Oops the link to the bootimage project is here: <a href=\"https://github.com/rust-osdev/bootimage\" rel=\"nofollow noreferrer\">github.com/rust-osdev/bootimage</a>"}, {"owner": {"reputation": 53, "user_id": 9075747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/894965edd9e633ce1532895d398cb006?s=128&d=identicon&r=PG&f=1", "display_name": "Tal K", "link": "https://stackoverflow.com/users/9075747/tal-k"}, "reply_to_user": {"reputation": 41564, "user_id": 3857942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hXLnN.jpg?s=128&g=1", "display_name": "Michael Petch", "link": "https://stackoverflow.com/users/3857942/michael-petch"}, "edited": false, "score": 0, "creation_date": 1554495658, "post_id": 55542407, "comment_id": 97788851, "body": "as far as I can tell the bootimage Rust project is just for compiling a kernel with a pre existing bootloader.  I have my own bootloader, so I don&#39;t think that it&#39;s the solution."}, {"owner": {"reputation": 41564, "user_id": 3857942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hXLnN.jpg?s=128&g=1", "display_name": "Michael Petch", "link": "https://stackoverflow.com/users/3857942/michael-petch"}, "edited": false, "score": 0, "creation_date": 1554496408, "post_id": 55542407, "comment_id": 97789124, "body": "Then you will have to use something as I suggested in my first post. Likely your project is generating an ELF executable. Use <code>objcopy</code> to convert the ELF executable to binary. Convert it with something like <code>objcopy -O binary myos.elf myos.bin</code> then you can use <code>dd</code> to place the your bootloader in the first sector and <code>myos.bin</code> (or whatever name you wish) in the sectors after.You could just use <code>cat boot.bin myos.bin &gt;disk.img</code> (or something similar if the OS is expected to be loaded from disk from right after the bootloader and assuming the boot.bin is exactly 512 bytes)"}, {"owner": {"reputation": 41564, "user_id": 3857942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hXLnN.jpg?s=128&g=1", "display_name": "Michael Petch", "link": "https://stackoverflow.com/users/3857942/michael-petch"}, "edited": false, "score": 0, "creation_date": 1554496639, "post_id": 55542407, "comment_id": 97789218, "body": "If you had another stage in there you&#39;d have to add it in there as well. I generally use  DD to build disk images. It is easy to place things in the image where you need them. The primary thing is converting the rust ELF executable you generate to binary form (unless you coded an ELF loader into one of the earlier stages. Likely you didn&#39;t so it is easier to use binary images when loading."}, {"owner": {"reputation": 41564, "user_id": 3857942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hXLnN.jpg?s=128&g=1", "display_name": "Michael Petch", "link": "https://stackoverflow.com/users/3857942/michael-petch"}, "edited": false, "score": 0, "creation_date": 1554497156, "post_id": 55542407, "comment_id": 97789406, "body": "The trick in Rust will be to ensure the entry point to your kernel is at the beginning of the binary (then you just have your second stage jump t the first address where the kernel was loaded in memory). I don&#39;t know how to do that in the Rust environment but it usually entails creating a linker script to place the start code before all other code and data in the kernel."}, {"owner": {"reputation": 53, "user_id": 9075747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/894965edd9e633ce1532895d398cb006?s=128&d=identicon&r=PG&f=1", "display_name": "Tal K", "link": "https://stackoverflow.com/users/9075747/tal-k"}, "reply_to_user": {"reputation": 41564, "user_id": 3857942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hXLnN.jpg?s=128&g=1", "display_name": "Michael Petch", "link": "https://stackoverflow.com/users/3857942/michael-petch"}, "edited": false, "score": 0, "creation_date": 1554497446, "post_id": 55542407, "comment_id": 97789518, "body": "I already looked up how to &quot;bootimage&quot; project compiles bootloaders with Rust and it was similar to what you suggested. I looked up how to compile Rust to an ELF executable, but I didn&#39;t find an answer. Could you write the command to compile Rust into an ELF executable?"}, {"owner": {"reputation": 41564, "user_id": 3857942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hXLnN.jpg?s=128&g=1", "display_name": "Michael Petch", "link": "https://stackoverflow.com/users/3857942/michael-petch"}, "edited": false, "score": 0, "creation_date": 1554497592, "post_id": 55542407, "comment_id": 97789569, "body": "Have you already generated a kernel executable from your current project?"}, {"owner": {"reputation": 53, "user_id": 9075747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/894965edd9e633ce1532895d398cb006?s=128&d=identicon&r=PG&f=1", "display_name": "Tal K", "link": "https://stackoverflow.com/users/9075747/tal-k"}, "reply_to_user": {"reputation": 41564, "user_id": 3857942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hXLnN.jpg?s=128&g=1", "display_name": "Michael Petch", "link": "https://stackoverflow.com/users/3857942/michael-petch"}, "edited": false, "score": 0, "creation_date": 1554499095, "post_id": 55542407, "comment_id": 97790076, "body": "I have created a .o file and a normal Linux executable. I did not find the right flags to compile the kernel so I can boot to it."}, {"owner": {"reputation": 41564, "user_id": 3857942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hXLnN.jpg?s=128&g=1", "display_name": "Michael Petch", "link": "https://stackoverflow.com/users/3857942/michael-petch"}, "edited": false, "score": 0, "creation_date": 1554499256, "post_id": 55542407, "comment_id": 97790140, "body": "You may find someone who uses Rust over on OSDev.org that may know <a href=\"https://forum.osdev.org/\" rel=\"nofollow noreferrer\">forum.osdev.org</a> . Or you can wait around here until someone with Rust experience sees this on SO. Probably doesn&#39;t hurt to ask in both places. OSDev is generally <i>C/C++</i> OS developers but I have seen some discuss Rust at times as well. You could also ask on <a href=\"https://www.reddit.com/r/osdev/\" rel=\"nofollow noreferrer\">reddit.com/r/osdev</a>"}], "answers": [{"tags": [], "owner": {"reputation": 53, "user_id": 9075747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/894965edd9e633ce1532895d398cb006?s=128&d=identicon&r=PG&f=1", "display_name": "Tal K", "link": "https://stackoverflow.com/users/9075747/tal-k"}, "is_accepted": true, "score": 2, "last_activity_date": 1554536803, "creation_date": 1554536803, "answer_id": 55546948, "question_id": 55542407, "link": "https://stackoverflow.com/questions/55542407/how-to-compile-a-rust-kernel-with-an-assembly-nasm-bootloader/55546948#55546948", "title": "How to compile a Rust kernel with an Assembly (NASM) bootloader", "body": "<p>After a couple of hours I compiled the code.</p>\n\n<p>The solution was (like Michael Petch suggested), to compile the assembly code into static <code>.o</code> files, then compile the rust code using <code>xargo</code> and a custom target. I compiled the Rust code as a static library, not a binary, so the output was a <code>.a</code> object file, and not an executable.</p>\n\n<p>Then I used <code>gcc</code> with a linker script to link together the object files and output the result as an ELF file. After that I used <code>objcopy</code> to with the <code>-O binary</code> flag to copy the ELF file to a .bin file. And finally I used <code>dd</code> to create an image file, that I could boot from.</p>\n"}], "owner": {"reputation": 53, "user_id": 9075747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/894965edd9e633ce1532895d398cb006?s=128&d=identicon&r=PG&f=1", "display_name": "Tal K", "link": "https://stackoverflow.com/users/9075747/tal-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 663, "favorite_count": 1, "accepted_answer_id": 55546948, "answer_count": 1, "score": 0, "last_activity_date": 1554536803, "creation_date": 1554493514, "question_id": 55542407, "link": "https://stackoverflow.com/questions/55542407/how-to-compile-a-rust-kernel-with-an-assembly-nasm-bootloader", "title": "How to compile a Rust kernel with an Assembly (NASM) bootloader", "body": "<p>I have a simple 2-stage bootloader written in NASM, and I want to continue the OS kernel using Rust.</p>\n\n<p>So I created a nightly Rust project with Cargo, and disabled std in the src/main.rs file. Now I am trying to link the Assembly files with the Cargo project, but without any success.</p>\n\n<p>How should I compile and link the NASM bootloader with the Rust kernel?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 2, "creation_date": 1554490387, "post_id": 55541407, "comment_id": 97786676, "body": "that not possible with your current code <code>newstr</code> get out of the scope. Maybe you want to use <code>Cow</code> instead of <code>&amp;&#39;a str</code> or more simple just use <code>String</code>"}, {"owner": {"reputation": 6834, "user_id": 455449, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/35cb7eab417eb790be0d3623686297d2?s=128&d=identicon&r=PG", "display_name": "Petr Kozelka", "link": "https://stackoverflow.com/users/455449/petr-kozelka"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554509000, "post_id": 55541407, "comment_id": 97792406, "body": "@Stargateur can you elaborate it? I used <code>Cow</code> for <code>newstr</code> without success; and right now, it is a <code>String</code>"}], "answers": [{"tags": [], "owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "is_accepted": true, "score": 5, "last_activity_date": 1554533115, "creation_date": 1554533115, "answer_id": 55546572, "question_id": 55541407, "link": "https://stackoverflow.com/questions/55541407/how-can-i-replace-one-element-in-a-vec-of-string-slices-with-a-newly-formatted-s/55546572#55546572", "title": "How can I replace one element in a Vec of string slices with a newly formatted String?", "body": "<p>Your data structure</p>\n\n<pre><code>pub struct SomeDataType&lt;'a&gt; {\n    lines: Vec&lt;&amp;'a str&gt;,\n}\n</code></pre>\n\n<p>stores <em>references</em> to string slices. Since in Rust references must always be valid, these string slices need to live longer than the instance of <code>SomeDataType</code>, and the lifetime of each string slice must be at least <code>'a</code>.</p>\n\n<p>Your function <code>replace_placeholder()</code> creates a new local <code>String</code> instance in this line:</p>\n\n<pre><code>let newstr = format!(\"## {}\", real_value);\n</code></pre>\n\n<p>This <code>String</code> instance only lives for the runtime of the function, since it is a local variable. To be able to store a reference to this string in <code>self.lines</code>, it would at least have to live for the lifetime <code>'a</code> of <code>SomeDataType</code>, which is doesn't. This is why the compiler complains.</p>\n\n<p>With your current data structure, you can't really make this work. Any string you create in <code>replace_placeholder()</code> will only live for the runtime of the function, unless you can pass ownership of the string to a longer-lived data structure. <code>SomeDataType</code> cannot take ownership, though \u2013 it only stores references.</p>\n\n<p>The easiest solution is to change your data type definition to</p>\n\n<pre><code>pub struct SomeDataType {\n    lines: Vec&lt;String&gt;,\n}\n</code></pre>\n\n<p>so it owns all strings. This will require you to create new <code>String</code> objects from the lines you parse, so you will copy all lines. This is unlikely to be a problem, but if for some reason you need to avoid this overhead, you can also use a vector of <code>Cow&lt;'a, str&gt;</code>. This data structure is able to store either a reference or an owned string.</p>\n"}, {"tags": [], "owner": {"reputation": 6834, "user_id": 455449, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/35cb7eab417eb790be0d3623686297d2?s=128&d=identicon&r=PG", "display_name": "Petr Kozelka", "link": "https://stackoverflow.com/users/455449/petr-kozelka"}, "is_accepted": false, "score": 2, "last_activity_date": 1554733611, "creation_date": 1554733611, "answer_id": 55575699, "question_id": 55541407, "link": "https://stackoverflow.com/questions/55541407/how-can-i-replace-one-element-in-a-vec-of-string-slices-with-a-newly-formatted-s/55575699#55575699", "title": "How can I replace one element in a Vec of string slices with a newly formatted String?", "body": "<p>Here is how I made the code work by updating it to use <code>Cow</code> as Sven Marnach and Stargateur recommended:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::borrow::Cow;\n\npub struct SomeDataType&lt;'a&gt; {\n    pub lines: Vec&lt;Cow&lt;'a, str&gt;&gt;,\n    // other fields omitted\n}\n\nimpl&lt;'a&gt; SomeDataType&lt;'a&gt; {\n    pub fn parse(text: &amp;str) -&gt; Result&lt;SomeDataType, String&gt; {\n        let lines = text.lines().map(Cow::Borrowed).collect();\n        Ok(SomeDataType { lines })\n    }\n\n    // replace first occurrence, and return original\n    pub fn replace_placeholder(&amp;mut self, real_value: &amp;str) -&gt; Option&lt;String&gt; {\n        let newstr = Cow::Owned(format!(\"## {}\", real_value));\n        for line in self.lines.iter_mut() {\n            if line.starts_with(\"## PLACEHOLDER\") {\n                let original: String = String::from(line.clone());\n                *line = newstr;\n                return Some(original);\n            }\n        }\n        None\n    }\n}\n</code></pre>\n\n<p>Alternatively, using <code>String</code> seems even simpler, and is probably also more elegant:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct SomeDataType {\n    pub lines: Vec&lt;String&gt;,\n    // other fields omitted\n}\n\nimpl SomeDataType {\n    pub fn parse(text: &amp;str) -&gt; Result&lt;SomeDataType, String&gt; {\n        let lines = text.lines().map(String::from).collect();\n        Ok(SomeDataType { lines })\n    }\n\n    // replace first occurrence, and return original\n    pub fn replace_placeholder(&amp;mut self, real_value: &amp;str) -&gt; Option&lt;String&gt; {\n        let newstr = format!(\"## {}\", real_value);\n        for line in self.lines.iter_mut() {\n            if line.starts_with(\"## PLACEHOLDER\") {\n                let original = line.clone();\n                *line = newstr;\n                return Some(original);\n            }\n        }\n        None\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 6834, "user_id": 455449, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/35cb7eab417eb790be0d3623686297d2?s=128&d=identicon&r=PG", "display_name": "Petr Kozelka", "link": "https://stackoverflow.com/users/455449/petr-kozelka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 0, "accepted_answer_id": 55546572, "answer_count": 2, "score": 2, "last_activity_date": 1554733666, "creation_date": 1554488911, "last_edit_date": 1554733666, "question_id": 55541407, "link": "https://stackoverflow.com/questions/55541407/how-can-i-replace-one-element-in-a-vec-of-string-slices-with-a-newly-formatted-s", "title": "How can I replace one element in a Vec of string slices with a newly formatted String?", "body": "<p>I am trying to replace one line in a list of string slices, and fail to make it correctly with lifetimes.</p>\n\n<p>Here is my code:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct SomeDataType&lt;'a&gt; {\n    pub lines: Vec&lt;&amp;'a str&gt;,\n    // other fields omitted\n}\n\nimpl&lt;'a&gt; SomeDataType&lt;'a&gt; {\n    pub fn parse(text: &amp;str) -&gt; Result&lt;SomeDataType, String&gt; {\n        let lines: Vec&lt;&amp;str&gt; = text.lines().collect();\n        Ok(SomeDataType { lines })\n    }\n\n    // replace first occurrence, and return original value\n    pub fn replace_placeholder(&amp;mut self, real_value: &amp;str) -&gt; Option&lt;String&gt; {\n        let newstr = format!(\"## {}\", real_value);\n        for line in self.lines.iter_mut() {\n            if line.starts_with(\"## PLACEHOLDER\") {\n                let original: String = String::from(*line);\n                *line = newstr.as_str();\n                return Some(original);\n            }\n        }\n        None\n    }\n}\n\nfn main() {\n    let text = r##\"\nLorem ipsum\n## PLACEHOLDER 1\ndolor sit amet,\n## PLACEHOLDER 2\nconsectetur adipiscing elit,\n\"##;\n\n    let mut x = SomeDataType::parse(text).unwrap();\n    let original = x.replace_placeholder(\"The Real Value\");\n    println!(\"ORIGINAL VALUE: {:?}\", original); //prints: ORIGINAL VALUE: Some(\"## PLACEHOLDER 1\")\n    println!(\"{}\", x.lines.join(\"\\n\")) //prints the text with first occurrence replaced\n}\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0597]: `newstr` does not live long enough\n  --&gt; src/main.rs:18:25\n   |\n6  | impl&lt;'a&gt; SomeDataType&lt;'a&gt; {\n   |      -- lifetime `'a` defined here\n...\n18 |                 *line = newstr.as_str();\n   |                 --------^^^^^^---------\n   |                 |       |\n   |                 |       borrowed value does not live long enough\n   |                 assignment requires that `newstr` is borrowed for `'a`\n...\n23 |     }\n   |     - `newstr` dropped here while still borrowed\n\n</code></pre>\n\n<p>This must be something with borrowing and lifetimes, but I could not figure out what it is.</p>\n"}, {"tags": ["ruby", "sockets", "rust", "unix-socket"], "answers": [{"tags": [], "owner": {"reputation": 74087, "user_id": 214790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f878c8230342730990acd21f889301d4?s=128&d=identicon&r=PG", "display_name": "matt", "link": "https://stackoverflow.com/users/214790/matt"}, "is_accepted": true, "score": 2, "last_activity_date": 1554505265, "creation_date": 1554505265, "answer_id": 55544324, "question_id": 55540577, "link": "https://stackoverflow.com/questions/55540577/how-to-communicate-a-rust-and-a-ruby-process-using-a-unix-socket-pair/55544324#55544324", "title": "How to communicate a Rust and a Ruby process using a Unix socket pair", "body": "<p>The problem seems to be that <a href=\"https://fraserblog.codewise.org/rust-and-file-descriptors/\" rel=\"nofollow noreferrer\">Rust sets all file descriptors to be closed when a child is created by setting the <code>FD_CLOEXEC</code> flag</a>. The only way to get around this seems to be using libc to call <code>fcntl</code>.</p>\n\n<p>Here\u2019s some code that seems to work, but I don\u2019t know Rust, so use at your own risk. Another issue you will have is you need to close the parent side of <code>rust_socket</code> after spawing the child, otherwise <code>read_to_string</code> will block forever waiting for the stream to be closed. You can do this with <code>drop</code>, but you will also need to use <code>AsRawFd</code> rather than <code>IntoRawFd</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::process::Command;\nuse std::os::unix::net::UnixStream;\nuse std::os::unix::io::AsRawFd;\nuse std::io::Read;\n\nextern crate libc;\n\nfn main() {\n    // Create the socket pair.\n    let (rust_socket, mut ruby_socket) = UnixStream::pair().unwrap();\n\n    // Unset FD_CLOEXEC on the socket to be passed to the child.\n    let fd = rust_socket.as_raw_fd();\n    unsafe {\n        let flags = libc::fcntl(fd, libc::F_GETFD);\n        libc::fcntl(fd, libc::F_SETFD, flags &amp; !libc::FD_CLOEXEC);\n    }\n\n    // Spawn the child\n    let _output = Command::new(\"ruby\")\n        .args(&amp;[\"client.rb\", &amp;fd.to_string()])\n        .spawn();\n\n    // After spawning, close the parents side of rust_socket.\n    // If we use IntoRawFd, rust_socket would have been moved by this point\n    // so we need AsRawFD instead.\n    drop(rust_socket);\n\n    let mut response = String::new();\n    ruby_socket.read_to_string(&amp;mut response).unwrap();\n\n    println!(\"Ruby said '{}'\", response);\n}\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 8612026, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wHkNLZPvR0U/AAAAAAAAAAI/AAAAAAAAALQ/6AuigHwGFZU/photo.jpg?sz=128", "display_name": "Vin&#237;cius Stock", "link": "https://stackoverflow.com/users/8612026/vin%c3%adcius-stock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 360, "favorite_count": 0, "accepted_answer_id": 55544324, "answer_count": 1, "score": 2, "last_activity_date": 1554505265, "creation_date": 1554485023, "question_id": 55540577, "link": "https://stackoverflow.com/questions/55540577/how-to-communicate-a-rust-and-a-ruby-process-using-a-unix-socket-pair", "title": "How to communicate a Rust and a Ruby process using a Unix socket pair", "body": "<p>I am trying to communicate a Rust process with a child Ruby process using a Unix socket pair. I have tried the same using only Ruby and it works, but I can't seem to get it to work with Rust.</p>\n\n<p>I have tried passing the \"rust_socket\" file descriptor to the Ruby script, passing the \"ruby_socket\" file descriptor to Ruby and different combinations of reading / writing to the socket. I feel like I should be passing the \"ruby_socket\" file descriptor, but when I do that I get a bad file descriptor error.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>// The rust side of things\nuse std::process::Command;\nuse std::os::unix::net::UnixStream;\nuse std::os::unix::io::IntoRawFd;\nuse std::io::{Read, Write};\n\nfn main() {\n    let (rust_socket, mut ruby_socket) = match UnixStream::pair() {\n        Ok((rust_socket, ruby_socket)) =&gt; (rust_socket, ruby_socket),\n        Err(e) =&gt; {\n            println!(\"Failed to open socket pair: {:?}\", e);\n            return;\n        }\n    };\n\n    let _output = Command::new(\"ruby\")\n        .args(&amp;[\"/home/station/workspace/rust_server/src/client.rb\", &amp;rust_socket.into_raw_fd().to_string()])\n        .spawn()\n        .expect(\"Failed to start ruby process\");\n\n    let mut response = String::new();\n    ruby_socket.read_to_string(&amp;mut response).unwrap();\n}\n</code></pre>\n\n<pre class=\"lang-rb prettyprint-override\"><code># The ruby side of things\nrequire \"socket\"\n\nbegin\n  socket = UNIXSocket.for_fd(ARGV.shift.to_i)\n  socket.send(\"Hello world!\\n\", 0)\nensure\n  socket&amp;.close\nend\n</code></pre>\n\n<p>I expected to be able to read the \"Hello world!\" string from Rust, but it does not work.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 2966, "user_id": 3022310, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7f10ec2b45320ee843e539d705c31d08?s=128&d=identicon&r=PG", "display_name": "turbulencetoo", "link": "https://stackoverflow.com/users/3022310/turbulencetoo"}, "edited": false, "score": 0, "creation_date": 1554484906, "post_id": 55540512, "comment_id": 97784282, "body": "I think if you declared your empty (unit) structs as <code>struct Kind;</code> then you can instantiate them with no braces: <code>Kind</code>. But if you declare with braces like <code>struct Kind { }</code> then you need to have braces when you make an instance: <code>Kind{}</code>."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1554485044, "post_id": 55540512, "comment_id": 97784357, "body": "You have a simple typo error then you have a big problem see duplicate <a href=\"https://stackoverflow.com/q/51543177/7076153\">stackoverflow.com/q/51543177/7076153</a>."}, {"owner": {"reputation": 2184, "user_id": 3536548, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qEPjr.png?s=128&g=1", "display_name": "Thermatix", "link": "https://stackoverflow.com/users/3536548/thermatix"}, "edited": false, "score": 0, "creation_date": 1554485089, "post_id": 55540512, "comment_id": 97784379, "body": "So there&#39;s no way to return just the type if you are using a type with fields/braces?"}, {"owner": {"reputation": 2966, "user_id": 3022310, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7f10ec2b45320ee843e539d705c31d08?s=128&d=identicon&r=PG", "display_name": "turbulencetoo", "link": "https://stackoverflow.com/users/3022310/turbulencetoo"}, "edited": false, "score": 1, "creation_date": 1554485234, "post_id": 55540512, "comment_id": 97784467, "body": "I&#39;m not sure what you mean &quot;return the type&quot;?"}, {"owner": {"reputation": 2966, "user_id": 3022310, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7f10ec2b45320ee843e539d705c31d08?s=128&d=identicon&r=PG", "display_name": "turbulencetoo", "link": "https://stackoverflow.com/users/3022310/turbulencetoo"}, "edited": false, "score": 0, "creation_date": 1554485558, "post_id": 55540512, "comment_id": 97784603, "body": "The phrase &quot;return an instance of a Trait&quot; (which comes from the author of a different question) is also very misleading."}, {"owner": {"reputation": 2184, "user_id": 3536548, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qEPjr.png?s=128&g=1", "display_name": "Thermatix", "link": "https://stackoverflow.com/users/3536548/thermatix"}, "reply_to_user": {"reputation": 2966, "user_id": 3022310, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7f10ec2b45320ee843e539d705c31d08?s=128&d=identicon&r=PG", "display_name": "turbulencetoo", "link": "https://stackoverflow.com/users/3022310/turbulencetoo"}, "edited": false, "score": 0, "creation_date": 1554486183, "post_id": 55540512, "comment_id": 97784885, "body": "@turbulencetoo I disagree, It means I want to return the type that implements the specified trait, if I were speaking about rails, the trait would be the class <code>ActiveRecord</code> and the instances would be the models that implement the class. And &quot;return the type&quot; would return the type object, the struct, the thing that implements the trait, using rails again, it would be the model class itself."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 4, "creation_date": 1554489184, "post_id": 55540512, "comment_id": 97786150, "body": "I&#39;m confused now. Do you want to return an <i>instance of a type</i> implementing<code>Component</code>, or do you want to return <i>the type itself</i> that implements <code>Component</code>? Types are a static analysis feature in Rust; they don&#39;t exist at runtime, so you can&#39;t do the latter, period. The former question is answered by the question Stargateur linked, once you fix the syntax errors."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1554529500, "post_id": 55540512, "comment_id": 97794799, "body": "@Thermatix My understanding is that you are trying to return runtime representations of the types themsevles, which do not exist in Rust, in contrast to other statically typed languages such as Java, C# or Go. Assuming that Rust <i>did</i> have runtime type representations, what would you want to do with them? If you can explain your use case, I am sure we can come up with a solution."}], "answers": [{"comments": [{"owner": {"reputation": 2184, "user_id": 3536548, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qEPjr.png?s=128&g=1", "display_name": "Thermatix", "link": "https://stackoverflow.com/users/3536548/thermatix"}, "edited": false, "score": 0, "creation_date": 1554486026, "post_id": 55540679, "comment_id": 97784830, "body": "I see. how do I deal with the fact that types I want to return posses a type field when I won&#39;t know beforehand what type the field may possess, only that it will possess a type of one of  a list of n types"}, {"owner": {"reputation": 4945, "user_id": 341510, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9162e8bca37c48433207c1fccfb3bba1?s=128&d=identicon&r=PG", "display_name": "chucksmash", "link": "https://stackoverflow.com/users/341510/chucksmash"}, "reply_to_user": {"reputation": 2184, "user_id": 3536548, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qEPjr.png?s=128&g=1", "display_name": "Thermatix", "link": "https://stackoverflow.com/users/3536548/thermatix"}, "edited": false, "score": 0, "creation_date": 1554486402, "post_id": 55540679, "comment_id": 97784987, "body": "There are different ways you might handle it. Whenever I find myself considering adding a <code>&quot;type&quot;</code> field to a struct in Rust, I stop and think really hard about whether the thing I&#39;m working with should be an <code>enum</code> instead. Not a hard and fast rule, but consider that avenue as well."}, {"owner": {"reputation": 2184, "user_id": 3536548, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qEPjr.png?s=128&g=1", "display_name": "Thermatix", "link": "https://stackoverflow.com/users/3536548/thermatix"}, "edited": false, "score": 0, "creation_date": 1554487139, "post_id": 55540679, "comment_id": 97785326, "body": "The type field is used to store the type of the data that will be stored in the component, <code>Bool</code>, <code>String</code>, <code>Integer</code>, etc"}], "tags": [], "owner": {"reputation": 4945, "user_id": 341510, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9162e8bca37c48433207c1fccfb3bba1?s=128&d=identicon&r=PG", "display_name": "chucksmash", "link": "https://stackoverflow.com/users/341510/chucksmash"}, "is_accepted": false, "score": 0, "last_activity_date": 1554485645, "creation_date": 1554485645, "answer_id": 55540679, "question_id": 55540512, "link": "https://stackoverflow.com/questions/55540512/rust-wont-let-me-return-an-instance-of-a-type-from-a-match-keeps-thinking-im/55540679#55540679", "title": "Rust won&#39;t let me return an instance of a type from a match, keeps thinking I&#39;m trying to return a value", "body": "<p>The compiler has to know how much room to reserve on the stack at compile time. As the linked answer mentions, if the concrete return type is conditional, the amount of space that would be needed cannot be known until runtime. That's what this bit of the answer is referring to:</p>\n\n<blockquote>\n  <p>It does have limitations, such as [...] it cannot be used when the concrete return type is\n  conditional. In those cases, you need to use the trait object answer\n  below.</p>\n</blockquote>\n\n<p>You should use the second form of the function shown in that answer if you want to conditionally return either a <code>Kind</code> or a <code>Location</code>. In that case, the <code>Kind</code> or the <code>Location</code> will be created on the heap instead of the stack; the stack will contain a <code>Box</code> that owns that heap reference, and <code>Box</code> is a type whose size is known at compile time.</p>\n"}, {"tags": [], "owner": {"reputation": 815, "user_id": 1150292, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VQ2aZ.jpg?s=128&g=1", "display_name": "Mara Bos", "link": "https://stackoverflow.com/users/1150292/mara-bos"}, "is_accepted": true, "score": 2, "last_activity_date": 1554579420, "last_edit_date": 1554579420, "creation_date": 1554570014, "answer_id": 55551411, "question_id": 55540512, "link": "https://stackoverflow.com/questions/55540512/rust-wont-let-me-return-an-instance-of-a-type-from-a-match-keeps-thinking-im/55551411#55551411", "title": "Rust won&#39;t let me return an instance of a type from a match, keeps thinking I&#39;m trying to return a value", "body": "<p>That <code>impl Component</code> as the return type is basically a <code>T where T: Component</code>, where the <code>T</code> is chosen by the function itself rather than by the caller.</p>\n\n<p><code>T</code> can be <code>Kind</code>, <code>T</code> can be <code>Location</code>, but <code>T</code> can't be both at once.</p>\n\n<p>Two solutions:</p>\n\n<ol>\n<li><p>Dynamically: Return a <code>Box&lt;dyn Component&gt;</code> and return <code>Box::new(Kind{})</code> or <code>Box::new(Location{})</code>. The disadvantage is that it causes an heap allocation.</p></li>\n<li><p>Statically, by returning an <code>enum</code>:</p></li>\n</ol>\n\n<pre class=\"lang-rust prettyprint-override\"><code>enum KindOrLocation {\n    Kind(Kind),\n    Location(Location),\n}\n</code></pre>\n\n<p>To make this usable as a <code>Component</code>, you can implement <code>Deref&lt;Target = dyn Component&gt;</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>impl Deref for KindOrLocation {\n    type Target = dyn Component + 'static;\n    fn deref(&amp;self) -&gt; &amp;Self::Target {\n        match self {\n            KindOrLocation::Kind(x) =&gt; x,\n            KindOrLocation::Location(x) =&gt; x,\n        }\n    }\n}\n</code></pre>\n\n<p>The disadvantage here is that you have to write this boilerplate code.</p>\n\n<hr>\n\n<p>By the way:</p>\n\n<ul>\n<li>If you define a struct with <code>{}</code> like <code>struct Kind {}</code>, you create an object of it by writing <code>Kind{}</code>, not just <code>Kind</code>.</li>\n<li>You need to handle the <code>_</code> case in your match: <code>_ =&gt; panic!()</code> or something.</li>\n<li>Don't take a <code>&amp;String</code>, but take a <code>&amp;str</code> instead. Then it works for <em>both</em> <code>&amp;String</code> and <code>&amp;str</code>.</li>\n</ul>\n"}], "owner": {"reputation": 2184, "user_id": 3536548, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qEPjr.png?s=128&g=1", "display_name": "Thermatix", "link": "https://stackoverflow.com/users/3536548/thermatix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 55551411, "answer_count": 2, "score": 0, "last_activity_date": 1554579420, "creation_date": 1554484718, "last_edit_date": 1554484998, "question_id": 55540512, "link": "https://stackoverflow.com/questions/55540512/rust-wont-let-me-return-an-instance-of-a-type-from-a-match-keeps-thinking-im", "title": "Rust won&#39;t let me return an instance of a type from a match, keeps thinking I&#39;m trying to return a value", "body": "<p>According to <a href=\"https://stackoverflow.com/a/30661354/3536548\">this answer</a> to <a href=\"https://stackoverflow.com/q/30661046/3536548\">this questions</a> I need to do the following to return an instance of a <code>Trait</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>trait Shader {}\n\nstruct MyShader;\nimpl Shader for MyShader {}\n\nstruct GraphicsContext;\n\nimpl GraphicsContext {\n    fn create_shader(&amp;self) -&gt; impl Shader {\n        let shader = MyShader;\n        shader\n    }\n}\n</code></pre>\n\n<p>but when I try to do it: </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub trait Component { }\n\nstruct Kind {}\n\nstruct Location {}\n\nimpl Component for Kind {}\n\nimpl Component for Location {}\n\npub fn get(comp_name: &amp;String) -&gt; impl Component {\n    match comp_name.as_ref() {\n        \"kind\"      =&gt; Kind,\n        \"location\"  =&gt; Location\n    }\n}\n</code></pre>\n\n<p>I just get errors:</p>\n\n<blockquote>\n  <p>error[E0423]: expected value, found struct <code>Kind</code>\n   --> src/main.rs:17:24</p>\n  \n  <pre class=\"lang-rust prettyprint-override\"><code>   |\n17 |         \"kind\"      =&gt; Kind,\n   |                        ^^^^ did you mean `Kind { /* fields */ }`?\n</code></pre>\n  \n  <p>error[E0423]: expected value, found struct <code>Location</code>\n   --> src/main.rs:18:24</p>\n  \n  <pre class=\"lang-rust prettyprint-override\"><code>   |\n18 |         \"location\"  =&gt; Location\n   |                        ^^^^^^^^ did you mean `Location { /* fields */ &gt;}`?\n</code></pre>\n</blockquote>\n"}, {"tags": ["rust", "borrow-checker"], "answers": [{"comments": [{"owner": {"reputation": 3472, "user_id": 4072509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/16VK8.jpg?s=128&g=1", "display_name": "apetranzilla", "link": "https://stackoverflow.com/users/4072509/apetranzilla"}, "edited": false, "score": 1, "creation_date": 1554484510, "post_id": 55540438, "comment_id": 97784114, "body": "I&#39;d also add a note about using the <code>Clone</code> or <code>Copy</code> trait for small types."}, {"owner": {"reputation": 357, "user_id": 7158113, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d4c730174f40b2631cddb8a67384afd1?s=128&d=identicon&r=PG&f=1", "display_name": "flooblebit", "link": "https://stackoverflow.com/users/7158113/flooblebit"}, "edited": false, "score": 0, "creation_date": 1554485039, "post_id": 55540438, "comment_id": 97784351, "body": "This is perfect, thank you. What is preferred: making a clone of something, or having an immutable borrow of it. Note that in the context the item wont be modified."}, {"owner": {"reputation": 4945, "user_id": 341510, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9162e8bca37c48433207c1fccfb3bba1?s=128&d=identicon&r=PG", "display_name": "chucksmash", "link": "https://stackoverflow.com/users/341510/chucksmash"}, "reply_to_user": {"reputation": 357, "user_id": 7158113, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d4c730174f40b2631cddb8a67384afd1?s=128&d=identicon&r=PG&f=1", "display_name": "flooblebit", "link": "https://stackoverflow.com/users/7158113/flooblebit"}, "edited": false, "score": 1, "creation_date": 1554485236, "post_id": 55540438, "comment_id": 97784468, "body": "@flooblebit Cloning is potentially expensive. You should be cloning if your intention is &quot;I want a separate copy this thing which I can modify without changing the original&quot;. If you aren&#39;t changing the original, prefer immutable refs; if you are changing the original, prefer a mutable ref."}], "tags": [], "owner": {"reputation": 4945, "user_id": 341510, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9162e8bca37c48433207c1fccfb3bba1?s=128&d=identicon&r=PG", "display_name": "chucksmash", "link": "https://stackoverflow.com/users/341510/chucksmash"}, "is_accepted": true, "score": 2, "last_activity_date": 1554484543, "last_edit_date": 1554484543, "creation_date": 1554484377, "answer_id": 55540438, "question_id": 55540192, "link": "https://stackoverflow.com/questions/55540192/how-do-i-retrieve-an-item-from-a-vec-that-is-moved-into-a-structure/55540438#55540438", "title": "How do I retrieve an item from a Vec that is moved into a structure?", "body": "<p>The problem here is that the <code>Vec</code> has ownership of the <code>Item</code>s it contains, but <code>Context.get</code> is trying to return the <code>Item</code> directly (and take ownership of it).</p>\n\n<p>If <code>Context.get</code> just needs to let callers peek at the contents of the vector, it should return a reference to an Item instead of an Item:</p>\n\n<pre><code>impl Context {\n    fn get(&amp;mut self, at: usize) -&gt; &amp;Item {\n        &amp;self.x[at]\n    }\n}\n</code></pre>\n\n<p>In the above case, <code>Context.get</code> can take an immutable reference to <code>self</code> since it is not changing anything. Further, if you want to allow callers of <code>Context.get</code> to modify the referenced Item, you would return <code>&amp;mut Item</code> instead of <code>&amp;Item</code>:</p>\n\n<pre><code>impl Context {\n    fn get(&amp;mut self, at: usize) -&gt; &amp;mut Item {\n        &amp;mut self.x[at]\n    }\n}\n</code></pre>\n\n<p>Edit: As @apemanzilla helpfully notes in the comments, you could also have Item implement the <code>Clone</code> trait if you want Context.get to return a separate copy of the Item at <code>at</code>:</p>\n\n<pre><code>#[derive(Clone)]\nstruct Item {\n    value: String,\n}\n\nimpl Context {\n    fn get(&amp;mut self, at: usize) -&gt; Item {\n        self.x[at].clone()\n    }\n</code></pre>\n\n<p>Changing the returned Item will not modify the one contained in self.x though; this may or may not be what you intended.</p>\n"}], "owner": {"reputation": 357, "user_id": 7158113, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d4c730174f40b2631cddb8a67384afd1?s=128&d=identicon&r=PG&f=1", "display_name": "flooblebit", "link": "https://stackoverflow.com/users/7158113/flooblebit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 55540438, "answer_count": 1, "score": 1, "last_activity_date": 1554484543, "creation_date": 1554483335, "last_edit_date": 1554483820, "question_id": 55540192, "link": "https://stackoverflow.com/questions/55540192/how-do-i-retrieve-an-item-from-a-vec-that-is-moved-into-a-structure", "title": "How do I retrieve an item from a Vec that is moved into a structure?", "body": "<p>I have a structure which contains a Vector of structs, e.g.</p>\n\n<pre><code>fn main() {\n    let x: Vec&lt;Item&gt; = Vec::new(); \n    // assume x is filled with stuff\n    do_things_with(x);\n}\n\nstruct Item {\n    value: String,\n}\n\nstruct Context {\n    x: Vec&lt;Item&gt;,\n}\n\nimpl Context {\n    fn get(&amp;mut self, at: usize) -&gt; Item {\n        self.x[at]\n    }\n}\n\nfn do_things_with(x: Vec&lt;Item&gt;) {\n    let mut ctx = Context{\n        x: x,\n    };\n    ctx.get(5);\n}\n</code></pre>\n\n<p>I have a Vec of stuff, and I pass this to some function which creates a context and stores the passed value in that structure. I then want to look at the items in this Vec so I have some helper functions, e.g. 'get' which will get the item at the index specified.</p>\n\n<p>This seems all good, and in C or whatever language it would be fine, however Rust complains:</p>\n\n<pre><code>'cannot move out of borrowed content'\n</code></pre>\n\n<p>For the function 'get' where we try to access the item in the vector.</p>\n\n<p>What am I doing wrong here?</p>\n"}, {"tags": ["rust", "rust-cargo"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554481773, "post_id": 55539602, "comment_id": 97782858, "body": "<a href=\"https://stackoverflow.com/questions/55537573/how-to-link-a-dynamic-rust-library-using-only-rustc-and-not-cargo#comment97778955_55537573\" title=\"how to link a dynamic rust library using only rustc and not cargo%23comment97778955_55537573\">stackoverflow.com/questions/55537573/&hellip;</a>"}, {"owner": {"reputation": 5913, "user_id": 1244932, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d2c608e688b798896e8b516855fc1ab1?s=128&d=identicon&r=PG", "display_name": "user1244932", "link": "https://stackoverflow.com/users/1244932/user1244932"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554482041, "post_id": 55539602, "comment_id": 97782985, "body": "@Stargateur If I do <code>cargo clean</code> and <code>cargo build -v -v</code> other teammates send me to the hell. Clean build takes ~30 minutes."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554482166, "post_id": 55539602, "comment_id": 97783038, "body": "try <a href=\"https://stackoverflow.com/questions/49077147/how-can-i-force-build-rs-to-run-again-without-cleaning-my-whole-project/55536259#55536259\"><code>touch build.rs &amp;&amp; cargo build -vv</code></a>, you all works on the same machine ?"}, {"owner": {"reputation": 5913, "user_id": 1244932, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d2c608e688b798896e8b516855fc1ab1?s=128&d=identicon&r=PG", "display_name": "user1244932", "link": "https://stackoverflow.com/users/1244932/user1244932"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554483242, "post_id": 55539602, "comment_id": 97783571, "body": "@Stargateur We use this script a lot during development, so everyone become unhappy if build of package start takes 30 mins on their local machine."}, {"owner": {"reputation": 5913, "user_id": 1244932, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d2c608e688b798896e8b516855fc1ab1?s=128&d=identicon&r=PG", "display_name": "user1244932", "link": "https://stackoverflow.com/users/1244932/user1244932"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554483312, "post_id": 55539602, "comment_id": 97783600, "body": "@Stargateur But this cause rebuild of <code>level2</code> and <code>level3</code> packages, this is of course not 30 minutes, but 2 minutes also not good. Is any way to avoid rebuild just to find out path?"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554483482, "post_id": 55539602, "comment_id": 97783665, "body": "do that <code>build.rs</code> don&#39;t rebuild level2 and level3 packages if they are up to date ? I have no idea how. but at some point this is just a trick to see what cargo do... as you said &quot;If I run this level3 crates via cargo run all works fine, but if I run it by hands it reports:&quot;"}], "owner": {"reputation": 5913, "user_id": 1244932, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d2c608e688b798896e8b516855fc1ab1?s=128&d=identicon&r=PG", "display_name": "user1244932", "link": "https://stackoverflow.com/users/1244932/user1244932"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 31, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1554481575, "creation_date": 1554480969, "last_edit_date": 1554481575, "question_id": 55539602, "link": "https://stackoverflow.com/questions/55539602/export-shared-library-path-via-several-level-of-crates-denedicies", "title": "export shared library path via several level of crates denedicies", "body": "<p>In <code>build.rs</code> of <code>level1-sys</code> crate I have:</p>\n\n<pre><code>    let dst = cmake::Config::new(Path::new(\"somelib\"))\n        .build()\n        .join(\"build\");\n    println!(\"cargo:rustc-link-search=native={}\", dst.display());\n    println!(\"cargo:rustc-link-lib=dylib=somelib\");\n</code></pre>\n\n<p>then there is <code>level2</code> create that deped on <code>level1-sys</code>,\nand then there is <code>level3</code>binary crate. </p>\n\n<p>If I run this <code>level3</code> crates via <code>cargo run</code> all works fine,\nbut if I run it by hands it reports:</p>\n\n<pre><code> error while loading shared libraries: libsomelib.so: cannot open shared object file: No such file or directory\n</code></pre>\n\n<p>Is there way to find path to <code>libsomelib.so</code> from <code>cargo</code>?\nI need this info for external script that should pack binary.</p>\n\n<p>Obviously I can search in <code>target</code> subdirectory,\nbut I use debug/release/cross compilation and so on thing.\nPlus even for concrete variant like <code>target/release</code> after several rebuild of <code>level1-sys</code> there are several <code>libsomelib.so</code> libraries, like:</p>\n\n<pre><code>target/release/build/level1-sys-46422ddc8585ba79/libsomelib.so\ntarget/release/build/level1-sys-9daa760ee41fe7b8/libsomelib.so\n</code></pre>\n"}, {"tags": ["rust", "linker", "dynamic-linking", "ffi"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1554474810, "post_id": 55537573, "comment_id": 97778914, "body": "Apart from the reason that there is no reason that you should avoid cargo, you have to use <code>cdylib</code> instead (<a href=\"https://doc.rust-lang.org/reference/linkage.html\" rel=\"nofollow noreferrer\">rust reference chp 12</a>)"}, {"owner": {"reputation": 17135, "user_id": 581190, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a503f14866aaa083332c81264860ac8e?s=128&d=identicon&r=PG", "display_name": "zrzka", "link": "https://stackoverflow.com/users/581190/zrzka"}, "edited": false, "score": 3, "creation_date": 1554474873, "post_id": 55537573, "comment_id": 97778955, "body": "<code>cargo clean</code> &amp;&amp; <code>cargo build -vv</code> to see with what arguments is <code>rustc</code> executed."}], "answers": [{"comments": [{"owner": {"reputation": 623, "user_id": 10962821, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-2LR2CPhrhu0/AAAAAAAAAAI/AAAAAAAAAAc/OGsF9pFiFOU/photo.jpg?sz=128", "display_name": "sn99", "link": "https://stackoverflow.com/users/10962821/sn99"}, "edited": false, "score": 0, "creation_date": 1554480603, "post_id": 55539037, "comment_id": 97782318, "body": "When I execute <code>.&#47;main</code> after <code>rustc main.rs -L . -l lib</code>, I get the error <code>error while loading shared libraries: liblib.so: cannot open shared object file</code>, and <code>lld main</code> shows <code>liblib.so =&gt; not found</code>, is there a workaround rather then moving it to <code>&#47;lib&#47;x86_64-linux-gnu</code>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 623, "user_id": 10962821, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-2LR2CPhrhu0/AAAAAAAAAAI/AAAAAAAAAAc/OGsF9pFiFOU/photo.jpg?sz=128", "display_name": "sn99", "link": "https://stackoverflow.com/users/10962821/sn99"}, "edited": false, "score": 0, "creation_date": 1554480678, "post_id": 55539037, "comment_id": 97782361, "body": "@sn99 <a href=\"https://stackoverflow.com/q/40602708/155423\">Linking Rust application with a dynamic library not in the runtime linker search path</a> and <a href=\"https://stackoverflow.com/q/13428910/155423\">How to set the environmental variable LD_LIBRARY_PATH in linux</a>"}, {"owner": {"reputation": 623, "user_id": 10962821, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-2LR2CPhrhu0/AAAAAAAAAAI/AAAAAAAAAAc/OGsF9pFiFOU/photo.jpg?sz=128", "display_name": "sn99", "link": "https://stackoverflow.com/users/10962821/sn99"}, "edited": false, "score": 1, "creation_date": 1554481534, "post_id": 55539037, "comment_id": 97782739, "body": "to be clear I added <code>#![feature(link_args)] #![link_args=&quot;-Wl,-rpath LOCATION_OF_LIB&quot;]</code> in <code>main.rs</code> and it worked"}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 5, "last_activity_date": 1554480776, "last_edit_date": 1554480776, "creation_date": 1554478810, "answer_id": 55539037, "question_id": 55537573, "link": "https://stackoverflow.com/questions/55537573/how-to-link-a-dynamic-rust-library-using-only-rustc-and-not-cargo/55539037#55539037", "title": "How to link a dynamic Rust library using only rustc and not cargo?", "body": "<p>You need to match ABIs. When you use an <code>extern \"C\"</code> block, you need to declare your functions using the same ABI.</p>\n\n<p>Name your dynamic library using the platform's conventions. Use <code>.dylib</code> on macOS, <code>.lib</code> on Windows, and <code>.so</code> on Linux. <code>rustc</code> will do this for you automatically if you don't provide a <code>-o</code> option.</p>\n\n<p>Once you have built your dynamic library, you need to add it to the compiler's linker options. <code>rustc --help</code> has a list of the various compiler options. <code>-L</code> adds a directory to the search path and <code>-l</code> links to a specific library.</p>\n\n<p><strong>lib.rs</strong></p>\n\n<pre><code>#[no_mangle]\npub extern \"C\" fn hello() {\n    println!(\"Hello, World!\");\n}\n</code></pre>\n\n<p><strong>main.rs</strong></p>\n\n<pre><code>extern \"C\" {\n    fn hello();\n}\n\nfn main() {\n    unsafe {\n        hello();\n    }\n}\n</code></pre>\n\n<p>Compiled and executed with:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ rustc --crate-type=cdylib lib.rs\n$ rustc main.rs -L . -l lib\n$ ./main\nHello, World!\n</code></pre>\n\n<p>As I'm on macOS, I used <code>otool</code> to show that it's indeed dynamically linked:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ otool -L main\nmain:\n    liblib.dylib (compatibility version 0.0.0, current version 0.0.0)\n    /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1252.250.1)\n    /usr/lib/libresolv.9.dylib (compatibility version 1.0.0, current version 1.0.0)\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/40602708/155423\">Linking Rust application with a dynamic library not in the runtime linker search path</a></li>\n<li><a href=\"https://stackoverflow.com/q/40833078/155423\">How do I specify the linker path in Rust?</a></li>\n</ul>\n\n<hr>\n\n<p>For completeness, here's \"normal\" linking of crates:</p>\n\n<p><strong>lib.rs</strong></p>\n\n<pre><code>pub fn hello() {\n    println!(\"Hello, World!\");\n}\n</code></pre>\n\n<p><strong>main.rs</strong></p>\n\n<pre><code>fn main() {\n    lib::hello();\n}\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ rustc --crate-type=rlib lib.rs\n$ rustc main.rs --extern lib=liblib.rlib\n$ ./main\nHello, World!\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ otool -L main\nmain:\n    /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1252.250.1)\n    /usr/lib/libresolv.9.dylib (compatibility version 1.0.0, current version 1.0.0)\n</code></pre>\n"}], "owner": {"reputation": 623, "user_id": 10962821, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-2LR2CPhrhu0/AAAAAAAAAAI/AAAAAAAAAAc/OGsF9pFiFOU/photo.jpg?sz=128", "display_name": "sn99", "link": "https://stackoverflow.com/users/10962821/sn99"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2089, "favorite_count": 1, "accepted_answer_id": 55539037, "answer_count": 1, "score": 3, "last_activity_date": 1554480776, "creation_date": 1554474271, "last_edit_date": 1554479499, "question_id": 55537573, "link": "https://stackoverflow.com/questions/55537573/how-to-link-a-dynamic-rust-library-using-only-rustc-and-not-cargo", "title": "How to link a dynamic Rust library using only rustc and not cargo?", "body": "<p>My <code>main.rs</code> looks like</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>// #[link(name = \"lib\")]\nextern \"C\" {\n    fn hello();\n}\n\nfn main() {\n    unsafe {\n        hello();\n    }\n}\n</code></pre>\n\n<p>And <code>lib.rs</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[no_mangle]\npub fn hello() {\n    println!(\"Hello, World!\");\n}\n</code></pre>\n\n<p>I have compiled <code>lib.rs</code> using <code>rustc --crate-type=cdylib lib.rs -o lib.so</code></p>\n\n<p>How do I link <code>lib.so</code> to <code>rustc main.rs</code> command ?</p>\n"}, {"tags": ["rust", "deserialization", "serde"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1554472619, "post_id": 55536740, "comment_id": 97777565, "body": "That&#39;s an interesting topic! Please show us what you have done so far. Serde is pretty easy to use. For easy things you just have to annotate your struct with <code>#[derive(Serialize, Deserialize)]</code> to get things working. What exactly is your problem?"}, {"owner": {"reputation": 17135, "user_id": 581190, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a503f14866aaa083332c81264860ac8e?s=128&d=identicon&r=PG", "display_name": "zrzka", "link": "https://stackoverflow.com/users/581190/zrzka"}, "edited": false, "score": 1, "creation_date": 1554474244, "post_id": 55536740, "comment_id": 97778576, "body": "You should share <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> in Rust - the language you have problem with, not Ruby. Please, share your code and show us what problem you have. Hard to guess, but you probably want to use one of the <a href=\"https://serde.rs/enum-representations.html\" rel=\"nofollow noreferrer\">Enum representations</a>. Also please check <a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a> (<a href=\"https://stackoverflow.com/questions/tagged/rust\">rust</a> tag info)."}, {"owner": {"reputation": 2184, "user_id": 3536548, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qEPjr.png?s=128&g=1", "display_name": "Thermatix", "link": "https://stackoverflow.com/users/3536548/thermatix"}, "edited": false, "score": 0, "creation_date": 1554474563, "post_id": 55536740, "comment_id": 97778758, "body": "I&#39;m not trying to load in the mobs themselves, only templates which are used to construct more of them, loading the data in isn&#39;t the problem, constructing the entities (mobs) is the problem, I don&#39;t know how to select the components from the loaded data like in the example. This would be easy in ruby as I can just dynamically map the component name to it&#39;s corresponding class, but you can&#39;t do that in rust as far as I know."}], "answers": [{"comments": [{"owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "edited": false, "score": 0, "creation_date": 1554483011, "post_id": 55539998, "comment_id": 97783451, "body": "The question appears to include how to build this enum type from all the structs that implement Component. That&#39;s macro magic I don&#39;t know."}, {"owner": {"reputation": 2184, "user_id": 3536548, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qEPjr.png?s=128&g=1", "display_name": "Thermatix", "link": "https://stackoverflow.com/users/3536548/thermatix"}, "edited": false, "score": 0, "creation_date": 1554487010, "post_id": 55539998, "comment_id": 97785270, "body": "I&#39;m grateful that you&#39;re trying to help I am, I&#39;ve been stuck with this issue for months; but I need to stress, the data has already been loaded, it&#39;s already in the program, I&#39;m trying to use already loaded data to generate new mobs using the loaded data, as <b>templates</b> not, load the data from the file each time I need to generate a mob"}, {"owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "reply_to_user": {"reputation": 2184, "user_id": 3536548, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qEPjr.png?s=128&g=1", "display_name": "Thermatix", "link": "https://stackoverflow.com/users/3536548/thermatix"}, "edited": false, "score": 0, "creation_date": 1554502187, "post_id": 55539998, "comment_id": 97791040, "body": "Why should your templates not be prototypes that you simply clone?"}, {"owner": {"reputation": 2184, "user_id": 3536548, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qEPjr.png?s=128&g=1", "display_name": "Thermatix", "link": "https://stackoverflow.com/users/3536548/thermatix"}, "edited": false, "score": 0, "creation_date": 1554538989, "post_id": 55539998, "comment_id": 97796476, "body": "Because I wante to keep loading the data, the templates and in-game data separate from one another. I don&#39;t deny my approach might be wrong, I&#39;m still new at this, If Trying to do it the way I am is wrong then It&#39;s wrong, and point me in the proper direction, I&#39;ve asked how to do this properly many times but no one has pointed me in the right direction, offered me incorrect advice or just not been helpful at at all."}, {"owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "reply_to_user": {"reputation": 2184, "user_id": 3536548, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qEPjr.png?s=128&g=1", "display_name": "Thermatix", "link": "https://stackoverflow.com/users/3536548/thermatix"}, "edited": false, "score": 0, "creation_date": 1554647122, "post_id": 55539998, "comment_id": 97820136, "body": "It might not be wrong, but it sure seems trickier. Essentially the field-naming introspection is done by things like the serde deriving macros, and you&#39;d be doing it another time to create a distinct layer of runtime introspection for those fields. I apologize, but I don&#39;t have the energy to map this out now."}, {"owner": {"reputation": 2184, "user_id": 3536548, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qEPjr.png?s=128&g=1", "display_name": "Thermatix", "link": "https://stackoverflow.com/users/3536548/thermatix"}, "edited": false, "score": 0, "creation_date": 1554713423, "post_id": 55539998, "comment_id": 97838002, "body": "That&#39;s fine, thank you for attempting to help, and more importantly, actually try to understand the problem, I&#39;ve decided to try a different path, so this route is sadly no longer useable, still the information is useful none-the-less."}], "tags": [], "owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "is_accepted": true, "score": 1, "last_activity_date": 1554482531, "creation_date": 1554482531, "answer_id": 55539998, "question_id": 55536740, "link": "https://stackoverflow.com/questions/55536740/using-serde-is-it-possible-to-deserialize-to-a-struct-that-implements-a-type/55539998#55539998", "title": "Using serde, is it possible to deserialize to a struct that implements a type?", "body": "<p>Sounds like you want a tagged union, or sum type; Rust knows these as <a href=\"https://doc.rust-lang.org/reference/items/enumerations.html\" rel=\"nofollow noreferrer\"><code>enum</code>erations</a>. Serde even supports using <a href=\"https://serde.rs/container-attrs.html#tag\" rel=\"nofollow noreferrer\">container internal tags</a>. So here's my little experiment:</p>\n\n<pre><code>#[macro_use] extern crate serde_derive;\nextern crate serde_yaml;\n\n#[derive(Debug, Serialize, Deserialize)]\n#[serde(tag=\"component\")]\nenum Feature {\n    Char { initial_value : char },\n    Weight { kgs : u32 }\n}\n\nfn main() {\n    let v = vec![\n        Feature::Char{initial_value:'x'},\n        Feature::Weight{kgs:12}\n    ];\n    println!(\"{}\", serde_yaml::to_string(&amp;v).unwrap());\n}\n</code></pre>\n\n<p>This outputs:</p>\n\n<pre><code>---\n- component: Char\n  initial_value: x\n- component: Weight\n  kgs: 12\n</code></pre>\n\n<p>Probably the next step is to make dedicated structs for the variants. </p>\n"}], "owner": {"reputation": 2184, "user_id": 3536548, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qEPjr.png?s=128&g=1", "display_name": "Thermatix", "link": "https://stackoverflow.com/users/3536548/thermatix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 542, "favorite_count": 0, "accepted_answer_id": 55539998, "answer_count": 1, "score": 1, "last_activity_date": 1554489432, "creation_date": 1554471642, "last_edit_date": 1554489432, "question_id": 55536740, "link": "https://stackoverflow.com/questions/55536740/using-serde-is-it-possible-to-deserialize-to-a-struct-that-implements-a-type", "title": "Using serde, is it possible to deserialize to a struct that implements a type?", "body": "<p>I'm building a rogue-like, I've already gotten a data loader working and part of the ECS working (building from scratch). The data is stored in <code>.yml</code> files and is used to describe things in the game (in this instance mobs) and what features those things have, for example:</p>\n\n<pre><code>---\norc:\n  feature_packs:\n    - physical\n    - basic_identifiers_mob\n  features:\n    - component: char\n      initial_value: T\ngoblin:\n  feature_packs:\n    - physical\n    - basic_identifiers_mob\n  features:\n    - component: char\n      initial_value: t\n</code></pre>\n\n<p>As you can see, there are two mobs described, a goblin and an orc, they both possess two feature packs (groups of features) and also posses a <code>char</code> feature that's used to describe what they look like to the player.</p>\n\n<p>The <code>initial_value</code> field can be a string, an integer, a floating point, a bool, a range, etc depending on what the component requires, this will indicate the value or possible values the component may have when the component is generated during entity building/creation.</p>\n\n<p>The problem is that I don't know how to, when iterating over the features,  select the struct based on the component's name, for example, select the <code>Char</code> struct for the <code>\"char\"</code> feature.</p>\n\n<p>To better describe what I mean, I've written an example in a language I better understand, Ruby:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>data_manager = function_that_loads_data('folder_path')\n\nEntity_Manager.build(:mob, :orc, data_manager)\n\nclass Entity_Manager\n  class &lt;&lt; self\n    attr_accessor :entities, :components\n  end\n\n  def self.build(entity_type, template_name, data_manager)\n    template = data_manager[entity_type][template_name]\n    entity_id = generate_unique_id\n    entities[entity_id] = Entity.new(entity_id, components: template.components.keys)\n    template.components.each do |component|\n      components[component.name][entity_id] =\n        Components.get(component.name).new(component.initial_value) # &lt;= This part, how do I do the equivalent in rust, a function that will return or allow me to get or create a struct based on the value of a string variable \n    end\n  end\nend\n</code></pre>\n\n<p>Now serde is the only thing I know that seems to be able to read text data and transform it into data, so to that end</p>\n\n<p>How can I use serde (or a more appropriate non-serde using solution) to take the names of the feature and retrieve the correct struct, all implementing a type?</p>\n\n<p>Incidentally, the one solution I'm trying not to use is a giant match statement.</p>\n\n<p>The repo of my work as it stands is <a href=\"https://github.com/thermatix/cyber_rogue\" rel=\"nofollow noreferrer\">here</a></p>\n\n<ul>\n<li><a href=\"https://github.com/Thermatix/cyber_rogue/blob/entity/components/src/sys/data_manager/manager.rs\" rel=\"nofollow noreferrer\">Data manager</a> - Loads and manages data loaded into the game</li>\n<li><a href=\"https://github.com/Thermatix/cyber_rogue/blob/entity/components/src/sys/entity_manager/manager.rs\" rel=\"nofollow noreferrer\">Entity manager</a> - Manages entities and there components (doesn't support bit keys atm)</li>\n<li><a href=\"https://github.com/Thermatix/cyber_rogue/blob/entity/components/src/sys/entity_builder/builder.rs\" rel=\"nofollow noreferrer\">Entity Builder</a> - Where Entity's will be built using data from the data manager (this is where I'm currently stuck)</li>\n<li><a href=\"https://github.com/Thermatix/cyber_rogue/blob/entity/components/src/game/entity/components/simple.rs\" rel=\"nofollow noreferrer\">Components</a> - a list of simple components</li>\n</ul>\n\n<p>What I'm trying to avoid is doing somthing like this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub fn get(comp_name: &amp;String) -&gt; impl Component {\n    match comp_name.as_ref() {\n        \"kind\"      =&gt; Kind,\n        \"location\"  =&gt; Location,\n        \"name\"      =&gt; Name,\n        \"position\"  =&gt; Position,\n        \"char\"      =&gt; Char,\n    }\n}\n</code></pre>\n\n<p>because it's not really maintainable, though a macro would help a lot, I'm not very good at those atm and it doesn't even work, rust keeps thinking I'm trying to initialize the types when I just want to return one of several possible types that all will implement <code>Component</code></p>\n\n<p>EDIT: Becuase it looks like I'm not clear enough:</p>\n\n<ul>\n<li>I'm not trying to load gameplay objects into the game, I'm loading <strong>templates</strong></li>\n<li>I'm using those <strong>templates</strong> to then generate the entities that will be exist during gameplay</li>\n<li>I can already load the data I want into the game in the following structure:</li>\n</ul>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub enum InitialValue {\n    Char(char),\n    String(String),\n    Int(i32),\n    Float(f32),\n    Bool(bool),\n    Range(Range&lt;i32&gt;),\n    Point((i32,i32))\n}\n\n\nimpl InitialValue {\n\n    pub fn unwrap_char(&amp;self) -&gt; &amp;char {\n        match &amp;self {\n            InitialValue::Char(val) =&gt; val,\n            _ =&gt; panic!(\"Stored value does not match unwrap type\")\n        }\n    }\n\n    pub fn unwrap_string(&amp;self) -&gt; &amp;String {\n        match &amp;self {\n            InitialValue::String(val) =&gt; val,\n            _ =&gt; panic!(\"Stored value does not match unwrap type\")\n        }\n    }\n\n    pub fn unwrap_int(&amp;self) -&gt; &amp;i32 {\n        match &amp;self {\n            InitialValue::Int(val) =&gt; val,\n            _ =&gt; panic!(\"Stored value does not match unwrap type\")\n        }\n    }\n\n    pub fn unwrap_float(&amp;self) -&gt; &amp;f32 {\n        match &amp;self {\n            InitialValue::Float(val) =&gt; val,\n            _ =&gt; panic!(\"Stored value does not match unwrap type\")\n        }\n    }\n\n    pub fn unwrap_bool(&amp;self) -&gt; &amp;bool {\n        match &amp;self {\n            InitialValue::Bool(val) =&gt; val,\n            _ =&gt; panic!(\"Stored value does not match unwrap type\")\n        }\n    }\n\n    pub fn unwrap_range(&amp;self) -&gt; &amp;Range&lt;i32&gt; {\n        match &amp;self {\n            InitialValue::Range(val) =&gt; val,\n            _ =&gt; panic!(\"Stored value does not match unwrap type\")\n        }\n    }\n\n    pub fn unwrap_point(&amp;self) -&gt; &amp;(i32, i32) {\n        match &amp;self {\n            InitialValue::Point(val) =&gt; val,\n            _ =&gt; panic!(\"Stored value does not match unwrap type\")\n        }\n    }\n}\n\n#[derive(Debug, Deserialize)]\npub struct Component {\n    #[serde(rename=\"component\")]\n    name: String,\n    #[serde(default)]\n    initial_value: Option&lt;InitialValue&gt;,\n}\n\n#[derive(Debug, Deserialize)]\npub struct Template {\n    pub feature_packs: Vec&lt;String&gt;,\n    pub features: Vec&lt;Component&gt;,\n}\n</code></pre>\n\n<ul>\n<li><p>How do I transform the templates into instances of entities?</p></li>\n<li><p>Specifcally, How do I for a given <code>Component.name</code> find the component\nand then initialize it? OR is my aproach wrong and there's a better\nway.</p></li>\n<li>And if I am doing it wrong, How do other games load data in and then use it to generate in\ngame entities?</li>\n</ul>\n"}, {"tags": ["variables", "types", "rust", "constants"], "answers": [{"comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554454850, "post_id": 55531693, "comment_id": 97766801, "body": "why not close as dup ? because the other question is about local scope (will let for future reader)"}, {"owner": {"reputation": 3548, "user_id": 10415695, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ex5vb.jpg?s=128&g=1", "display_name": "LogicalBranch", "link": "https://stackoverflow.com/users/10415695/logicalbranch"}, "edited": false, "score": 0, "creation_date": 1554456176, "post_id": 55531693, "comment_id": 97767564, "body": "@Stargateur Thanks for taking the time and putting in the effort to answer this question, I appreciate it."}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 4, "creation_date": 1554457594, "post_id": 55531693, "comment_id": 97768397, "body": "Nice summary. It may be worth mentioning that one of the guiding principle of type inference in Rust is that type inference should be <b>local</b>. This is the reason why, unlike in Haskell, function signatures always need to be fully specified. There are multiple reasons for this, notably it means easier reasoning for human readers and better error messages. This puts module level <code>const</code> in a tough spot, inference-wise."}, {"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 1, "creation_date": 1554514538, "post_id": 55531693, "comment_id": 97793045, "body": "<code>const</code>s inside a function are not variables at all. They are <i>items</i>. Unlike <code>let</code> bindings they do not exist inside the scope of a function other than syntactically. <code>const</code>s inside a function can for example not use the generic parameters of the enclosing function. In this they share behavior with nested <code>fn</code>s.  As for locality of inference, please do note that Rust employs global-ish type inference for <code>impl Trait</code> which are really &quot;forgetful&quot; inference variables."}, {"owner": {"reputation": 6798, "user_id": 4174897, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/gS0gI.jpg?s=128&g=1", "display_name": "Kyll", "link": "https://stackoverflow.com/users/4174897/kyll"}, "edited": false, "score": 1, "creation_date": 1554545055, "post_id": 55531693, "comment_id": 97797786, "body": "Thanks for taking the time to write this summary up, I deleted my previous comment as it was no longer relevant =) - Enjoy your day!"}], "tags": [], "owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "is_accepted": true, "score": 17, "last_activity_date": 1554463504, "last_edit_date": 1554463504, "creation_date": 1554454600, "answer_id": 55531693, "question_id": 55531587, "link": "https://stackoverflow.com/questions/55531587/why-do-i-have-to-specify-the-type-for-const-variables-but-not-for-let-variab/55531693#55531693", "title": "Why do I have to specify the type for &quot;const&quot; variables but not for &quot;let&quot; variables?", "body": "<p>Currently, there is a <a href=\"https://doc.rust-lang.org/1.23.0/reference/items/constant-items.html#constant-items\" rel=\"noreferrer\">rule</a> \"Constants must be explicitly typed.\" (for <code>static</code>: \"A static item is similar to a constant\").</p>\n\n<p>But, you are right: the compiler could infer it. There is an open discussion about that: <a href=\"https://github.com/rust-lang/rfcs/issues/1349\" rel=\"noreferrer\">#1349</a>, TL;DR:</p>\n\n<ul>\n<li>We could technically infer the type of <code>const</code> and <code>static</code> variable</li>\n<li>We do not use them very often so it's not very annoying to annotate the types</li>\n<li>We should maybe limit type inference for constants/statics to only literal value</li>\n<li>This could make error messages less accurate</li>\n<li>Maybe limit type inference for constants/statics to local scopes like function bodies</li>\n<li>For integers, <code>const FOO = 22</code> would infer to <code>i32</code> so probably not the type one would expect. So we'd end up writing <code>const FOO = 22usize</code>.</li>\n<li>When the variable is initialized with a <code>const-fn</code>, the type should be inferred</li>\n<li>When the variable is initialized with another variable typed explicitly</li>\n<li>For arrays, the explicit type is very redundant </li>\n<li>For variables which are only exported, we can end up not being able to infer their types (so it would be a compile-time error \"type needs to be specified\")</li>\n</ul>\n\n<blockquote>\n  <p>It may be worth mentioning that one of the guiding principle of type inference in Rust is that type inference should be local. This is the reason why, unlike in Haskell, function signatures always need to be fully specified. There are multiple reasons for this, notably it means easier reasoning for human readers and better error messages. This puts module level <code>const</code> in a tough spot, inference-wise. <a href=\"https://stackoverflow.com/users/147192/matthieu-m\">Matthieu M.</a></p>\n</blockquote>\n\n<p>So far, there is still not a proposed RFC, so this issue stays open.</p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/41909785/why-does-rust-not-permit-type-inference-for-local-constants#41909829\">Why does Rust not permit type inference for local constants?</a></li>\n</ul>\n"}], "owner": {"reputation": 3548, "user_id": 10415695, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ex5vb.jpg?s=128&g=1", "display_name": "LogicalBranch", "link": "https://stackoverflow.com/users/10415695/logicalbranch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 763, "favorite_count": 2, "accepted_answer_id": 55531693, "answer_count": 1, "score": 15, "last_activity_date": 1561727802, "creation_date": 1554454236, "last_edit_date": 1561727802, "question_id": 55531587, "link": "https://stackoverflow.com/questions/55531587/why-do-i-have-to-specify-the-type-for-const-variables-but-not-for-let-variab", "title": "Why do I have to specify the type for &quot;const&quot; variables but not for &quot;let&quot; variables?", "body": "<p>To create a variable in Rust you'd use:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let var_name = 10;\n</code></pre>\n\n<p>This would also be valid:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let var_name: i32 = 10;\n</code></pre>\n\n<p>Constant variables are created like this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>const VAR_NAME: i32 = 10;\n</code></pre>\n\n<p>But if you tried to create a constant variable like this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>const VAR_NAME = 10;\n</code></pre>\n\n<p>You'd get an error that looks like this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>error: expected `:`, found `=`\n --&gt; src/main.rs:5:11\n  |\n4 |   const VAR_NAME = 10;\n  |                 ^ expected `:`\n</code></pre>\n\n<p>Having come from languages like JavaScript, Python &amp; PHP this is kind of confusing to me.</p>\n\n<p>Why is it that I have to specify a type definition when using <code>const</code> but not when I use <code>let</code>?</p>\n"}, {"tags": ["rust", "borrow-checker", "ownership"], "comments": [{"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 1, "creation_date": 1554450558, "post_id": 55530317, "comment_id": 97764628, "body": "What the error says is you&#39;re trying to store a reference to a local structure, which will disappear as soon as the block is finished. Depending on parts we don&#39;t see, a solution might be to store the value itself (in necessary into a Box)."}, {"owner": {"reputation": 11, "user_id": 8769628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88d850a37ba8a9bb44afcf50f43a357d?s=128&d=identicon&r=PG&f=1", "display_name": "horacio tellez", "link": "https://stackoverflow.com/users/8769628/horacio-tellez"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554453031, "post_id": 55530317, "comment_id": 97765881, "body": "@Stargateur, code edited, should give the wanted error."}, {"owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "edited": false, "score": 0, "creation_date": 1554457805, "post_id": 55530317, "comment_id": 97768503, "body": "Hi @horaciotellez! As others already pointed out, the problem is that you are trying to return a reference to a local variable (<code>nc</code>). This just won&#39;t work and the linked answer explains why. The &quot;solution&quot; depends on your program structure. As Denys pointed out, one possibility might be to store the recursive <code>Concept</code> as <code>Box&lt;Concept&gt;</code> instead of <code>&amp;Concept</code>. In any case: your <code>Concept</code>s have to be stored <i>somewhere</i>. If you are unsure how to proceed, I would advise you to ask on the Rust subreddit, the <a href=\"https://users.rust-lang.org/\" rel=\"nofollow noreferrer\">users forum</a> for general advice. Good luck!"}], "owner": {"reputation": 11, "user_id": 8769628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88d850a37ba8a9bb44afcf50f43a357d?s=128&d=identicon&r=PG&f=1", "display_name": "horacio tellez", "link": "https://stackoverflow.com/users/8769628/horacio-tellez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 69, "favorite_count": 0, "closed_date": 1554457560, "answer_count": 0, "score": 1, "last_activity_date": 1554453527, "creation_date": 1554449362, "last_edit_date": 1554453527, "question_id": 55530317, "link": "https://stackoverflow.com/questions/55530317/i-cant-get-ownership-of-a-value-out-of-a-function", "closed_reason": "Duplicate", "title": "I can&#39;t get ownership of a value out of a function", "body": "<p>I defined a recursive function that creates a tree-like structure from another. The value created inside the function can't get out.</p>\n\n<p>I've tried different ways of getting ownership out of the function, returning the value itself, passing a vector as argument to store the value.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[derive(Clone, Copy)]\npub enum Concept&lt;'a&gt; {\n    Variable,\n    Base(&amp;'a str),\n    ForAll(&amp;'a str, &amp;'a Concept&lt;'a&gt;),\n}\n\npub fn normal_form_reduction&lt;'a&gt;(\n    con: &amp;Concept&lt;'a&gt;,\n    container: &amp;mut Vec&lt;Concept&lt;'a&gt;&gt;,\n) -&gt; Concept&lt;'a&gt; {\n    match *con {\n        // bases cases without recurrence\n        Concept::Variable =&gt; Concept::Variable,\n        Concept::Base(s) =&gt; Concept::Base(&amp;*s),\n        //...\n\n        //first recursive call\n        Concept::ForAll(s, c) =&gt; {\n            let nc = normal_form_reduction(c, container);\n            (*container).push(nc);\n            Concept::ForAll(s, &amp;nc)\n        }\n    }\n}\n</code></pre>\n\n<p>Expected to compile.\nGet:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0515]: cannot return value referencing local variable `nc`\n  --&gt; src/lib.rs:22:13\n   |\n22 |             Concept::ForAll(s, &amp;nc)\n   |             ^^^^^^^^^^^^^^^^^^^---^\n   |             |                  |\n   |             |                  `nc` is borrowed here\n   |             returns a value referencing data owned by the current function\n</code></pre>\n\n<p>The error 'E0515' don't explain my error.</p>\n"}, {"tags": ["rust", "traits"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554422863, "post_id": 55521669, "comment_id": 97757173, "body": "I think this kind of feature would break the V-table"}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554436602, "post_id": 55521669, "comment_id": 97759711, "body": "@Stargateur Or just another condition for a trait not being object safe."}, {"owner": {"reputation": 5700, "user_id": 3131852, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/26365707ecfa02e221f5192aaaa29a43?s=128&d=identicon&r=PG", "display_name": "Tim Diekmann", "link": "https://stackoverflow.com/users/3131852/tim-diekmann"}, "edited": false, "score": 1, "creation_date": 1554458564, "post_id": 55521669, "comment_id": 97768989, "body": "You may find <a href=\"https://github.com/rust-lang/rust/issues/20021\" rel=\"nofollow noreferrer\">this issue</a> interesting."}], "answers": [{"tags": [], "owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "is_accepted": true, "score": 12, "last_activity_date": 1554732266, "last_edit_date": 1554732266, "creation_date": 1554407241, "answer_id": 55523840, "question_id": 55521669, "link": "https://stackoverflow.com/questions/55521669/compiler-forces-me-to-implement-trait-method-but-the-self-trait-bound-on-metho/55523840#55523840", "title": "Compiler forces me to implement trait method but the `Self` trait bound on method is never satisfied for my type", "body": "<p>All implementors of a trait need to implement all methods that don't have a default implementation. It's the point of a trait that it has a defined interface.  Adding trait bounds to a method does not change anything about this rule.</p>\n\n<p>This is what the <a href=\"https://doc.rust-lang.org/reference/items/implementations.html#trait-implementations\" rel=\"nofollow noreferrer\">language reference</a> says on the topic:</p>\n\n<blockquote>\n  <p>A trait implementation must define all non-default associated items declared by the implemented trait, may redefine default associated items defined by the implemented trait, and cannot define any other items.</p>\n</blockquote>\n\n<p>This also means that a trait bound on <code>Self</code> in a method declaration on a trait is functionally equivalent to declaring a supertrait, except that the trait can only be used in the method that declares the bound.</p>\n\n<p>The obvious work-around is to define a separate trait for the methods that have additional requirements on <code>Self</code>:</p>\n\n<pre><code>trait FooExt: Foo + Clone {\n    fn foo(&amp;self);\n}\n</code></pre>\n\n<p>You can now implement <code>Foo</code> for all types, and <code>FooExt</code> in addition for the types that are <code>Clone</code>.</p>\n\n<p><em>Updated as requested in the comments</em>: There is a <a href=\"https://github.com/rust-lang/rust/issues/20021\" rel=\"nofollow noreferrer\">GitHub issue discussing whether it should be allowed to implement methods with unsatisfiable trait bounds without the method body</a>, so at least the <code>{ unimplemted()! }</code> part could be dropped. As of April 2019, this discussion has not come to any conclusion yet, and not even the exact syntax for implementing the uncallable methods has been settled.</p>\n"}], "owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 616, "favorite_count": 2, "accepted_answer_id": 55523840, "answer_count": 1, "score": 10, "last_activity_date": 1554732266, "creation_date": 1554398315, "question_id": 55521669, "link": "https://stackoverflow.com/questions/55521669/compiler-forces-me-to-implement-trait-method-but-the-self-trait-bound-on-metho", "title": "Compiler forces me to implement trait method but the `Self` trait bound on method is never satisfied for my type", "body": "<p>I have a trait <code>Foo</code>. I want to force implementors to define a method, <em>if</em> those implementors implement another trait (<code>Clone</code> in this example). My idea (<a href=\"https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=99ec9089e9c43287149292e22bce0647\" rel=\"noreferrer\">Playground</a>):</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>trait Foo {\n    // Note: in my real application, the trait has other methods as well,\n    // so I can't simply add `Clone` as super trait\n    fn foo(&amp;self) \n    where \n        Self: Clone;\n}\n\nstruct NoClone;\nimpl Foo for NoClone {}\n</code></pre>\n\n<p>Sadly, this leads to:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0046]: not all trait items implemented, missing: `foo`\n --&gt; src/lib.rs:8:1\n  |\n2 | /     fn foo(&amp;self) \n3 | |     where \n4 | |         Self: Clone;\n  | |____________________- `foo` from trait\n...\n8 |   impl Foo for NoClone {}\n  |   ^^^^^^^^^^^^^^^^^^^^ missing `foo` in implementation\n</code></pre>\n\n<p>I don't understand this error: the compiler clearly knows that <code>NoClone</code> does not implement <code>Clone</code>, so why am I required to provide a definitoin for <code>foo</code>? In particular, if I attempt to provide a definition (<a href=\"https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=471330ebd72db60fec0cb25ad3337310\" rel=\"noreferrer\">Playground</a>):</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>impl Foo for NoClone {\n    fn foo(&amp;self) \n    where \n        Self: Clone\n    {\n        unreachable!()\n    }\n}\n</code></pre>\n\n<p>I get the error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: the trait bound `NoClone: std::clone::Clone` is not satisfied\n  --&gt; src/lib.rs:9:5\n   |\n9  | /     fn foo(&amp;self) \n10 | |     where \n11 | |         Self: Clone\n12 | |     {\n13 | |         unreachable!()\n14 | |     }\n   | |_____^ the trait `std::clone::Clone` is not implemented for `NoClone`\n   |\n   = help: see issue #48214\n   = help: add #![feature(trivial_bounds)] to the crate attributes to enable\n</code></pre>\n\n<p>So the compiler knows for sure. (FYI: with <code>#![feature(trivial_bounds)]</code> it compiles, but I don't want to define a bunch of methods with <code>unreachable!()</code> as body.)</p>\n\n<p><strong>Why does the compiler force me to provide the method definition? Can I work around this problem somehow?</strong></p>\n"}, {"tags": ["rust", "embedded", "rust-cargo"], "answers": [{"tags": [], "owner": {"reputation": 51497, "user_id": 49246, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c421b43470bb8d3c099c5a847e588549?s=128&d=identicon&r=PG", "display_name": "starblue", "link": "https://stackoverflow.com/users/49246/starblue"}, "is_accepted": false, "score": 2, "last_activity_date": 1554449513, "creation_date": 1554449513, "answer_id": 55530355, "question_id": 55521365, "link": "https://stackoverflow.com/questions/55521365/creating-a-static-library-with-rust-to-link-it-to-an-arm-none-eabi-c-code-firmwa/55530355#55530355", "title": "Creating a static library with Rust to link it to an arm-none-eabi C code firmware", "body": "<p>It looks like an incompatibility between GCC and LLVM when computing stack sizes.</p>\n\n<p>The <code>.stack_sizes</code> section contains LLVM stack metadata: <a href=\"https://llvm.org/docs/CommandGuide/llc.html#cmdoption-stack-size-section\" rel=\"nofollow noreferrer\"><code>llc -stack-size-section</code> option</a>.  These seem to be pairs of function pointers and sizes in the same order as the <code>.text</code> sections (hence the <code>ordered</code> in the error message).</p>\n\n<p>In a GCC linker script I find (<code>/usr/share/doc/gcc-arm-none-eabi/examples/ldscripts/gcc.ld</code> on Debian stretch, yours may or may not look different):</p>\n\n<pre><code>    /* .stack_dummy section doesn't contains any symbols. It is only\n     * used for linker to calculate size of stack sections, and assign\n     * values to stack symbols later */\n    .stack_dummy (COPY):\n    {\n            *(.stack*)\n    } &gt; RAM\n\n    /* Set stack top to end of RAM, and stack limit move down by\n     * size of stack_dummy section */\n    __StackTop = ORIGIN(RAM) + LENGTH(RAM);\n    __StackLimit = __StackTop - SIZEOF(.stack_dummy);\n    PROVIDE(__stack = __StackTop);\n\n    /* Check if data + heap + stack exceeds RAM limit */\n    ASSERT(__StackLimit &gt;= __HeapLimit, \"region RAM overflowed with stack\")\n</code></pre>\n\n<p>So GCC uses dummy sections with the required stack sizes, and putting them together in <code>.stack_dummy</code> in any order should result in the total stack size needed.  Because <code>.stack_sizes</code> matches <code>*(.stack*)</code>, the GCC linker tries to put the LLVM sections in <code>.stack_dummy</code>, but that fails.</p>\n\n<p>So you can either try to disable <code>-stack-size-section</code> in Rust, or modify the linker file.</p>\n"}], "owner": {"reputation": 3207, "user_id": 4453678, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b1f2ad378f4eccf0df09d80d2f305e96?s=128&d=identicon&r=PG", "display_name": "Matthias Wimmer", "link": "https://stackoverflow.com/users/4453678/matthias-wimmer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1554449513, "creation_date": 1554397112, "question_id": 55521365, "link": "https://stackoverflow.com/questions/55521365/creating-a-static-library-with-rust-to-link-it-to-an-arm-none-eabi-c-code-firmwa", "title": "Creating a static library with Rust to link it to an arm-none-eabi C code firmware", "body": "<p>I have an existing C firmware for a Nordic nRF52832 BLE microcontroller. I'd like to link some new code to it, that I wrote in Rust.</p>\n\n<p>When I try to do so, the linker complains that I have two different definitions of the stack:</p>\n\n<pre><code>/nix/store/m7gf0nzixwgqk21an0fxc047qa0mvbng-gcc-arm-embedded-7-2018-q2-update/bin/../lib/gcc/arm-none-eabi/7.3.1/../../../../arm-none-eabi/bin/ld: .stack_dummy has both ordered [`.stack_sizes' in /home/matthias/source/tbconnect/modem/target/thumbv7em-none-eabihf/release/libtbmodem.a(alloc-314aba8dbd2706e9.alloc.deuukmti-cgu.0.rcgu.o)] and unordered [`.stack' in .sdk/modules/nrfx/mdk/gcc_startup_nrf52.o] sections\n</code></pre>\n\n<p>I guess the important part here is that the linker tells me that there is a <code>.stack_dummy</code> in the SDK Nordic provides for the BLE microcontroller, and the Rust library provides its own definition of a stack.</p>\n\n<p>Actually I would expect, that code compiled as a library, does not provide a definition of a stack. How would I link several libraries into a project if all of them define a stack? Am I completely wrong with that assumption?</p>\n\n<p>So I'm wondering whether I'm completely wrong in my definition of the Rust library.</p>\n\n<p>Cargo.toml:</p>\n\n<pre><code>[package]                                                                        \nname = \"tbmodem\"                                                                 \nversion = \"0.1.0\"                                                                                          \nedition = \"2018\"                                                                 \npublish = false                                                                  \n\n[lib]                                                                            \ncrate-type = [\"staticlib\"]                                                       \n\n[profile.dev]                                                                    \npanic = \"abort\"                                                                  \n\n[profile.release]                                                                \npanic = \"abort\"                                                                  \n\n[dev-dependencies]                                                               \ntimebomb = \"0.1.2\"\n</code></pre>\n\n<p>The code then gets compiled with <code>cargo build --release --target thumbv7em-none-eabihf</code></p>\n"}, {"tags": ["rust", "tuples"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 3, "creation_date": 1554395165, "post_id": 55520818, "comment_id": 97746035, "body": "Please read <a href=\"https://doc.rust-lang.org/book/ch03-02-data-types.html#the-tuple-type\" rel=\"nofollow noreferrer\">the book chapter 3</a> for a detailed guide about tuples and other data types. You probably want an array or vec, not a tuple."}, {"owner": {"reputation": 179, "user_id": 8197537, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3AnuAsHPASQ/AAAAAAAAAAI/AAAAAAAAAKg/qOCe5RLzzwE/photo.jpg?sz=128", "display_name": "Arian Saputra", "link": "https://stackoverflow.com/users/8197537/arian-saputra"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1554395458, "post_id": 55520818, "comment_id": 97746201, "body": "@hellow thank&#39;s for references,"}, {"owner": {"reputation": 17135, "user_id": 581190, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a503f14866aaa083332c81264860ac8e?s=128&d=identicon&r=PG", "display_name": "zrzka", "link": "https://stackoverflow.com/users/581190/zrzka"}, "edited": false, "score": 3, "creation_date": 1554458202, "post_id": 55520818, "comment_id": 97768755, "body": "I know that this is simple example, but please, next time, don&#39;t use <i>it only gives me some error</i>. You should copy &amp; paste the error message as well."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554462702, "post_id": 55520818, "comment_id": 97771216, "body": "because python value are dynamic this is &quot;easily&quot; but in Rust you have to use a collection then use dyn trait or enum."}], "answers": [{"comments": [{"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 1, "creation_date": 1554469429, "post_id": 55532884, "comment_id": 97775397, "body": "I would note that it would be possible to implement the <code>Index</code> and <code>IndexMut</code> traits on homogeneous tuples. The only question is &quot;why would you use an homogeneous tuple, when you could use an array instead?&quot;"}, {"owner": {"reputation": 179, "user_id": 8197537, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3AnuAsHPASQ/AAAAAAAAAAI/AAAAAAAAAKg/qOCe5RLzzwE/photo.jpg?sz=128", "display_name": "Arian Saputra", "link": "https://stackoverflow.com/users/8197537/arian-saputra"}, "edited": false, "score": 0, "creation_date": 1554477346, "post_id": 55532884, "comment_id": 97780414, "body": "thank&#39;s :) you make me understand now, your answer great, thanks \ud83e\udd17"}, {"owner": {"reputation": 71, "user_id": 11945841, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-HG03xehxpbQ/AAAAAAAAAAI/AAAAAAAABVQ/5ujgJ-FVacg/photo.jpg?sz=128", "display_name": "\u039eXPROPACE", "link": "https://stackoverflow.com/users/11945841/%ce%9expropace"}, "edited": false, "score": 0, "creation_date": 1614349711, "post_id": 55532884, "comment_id": 117366175, "body": "Thanks :D finally got it"}], "tags": [], "owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "is_accepted": true, "score": 5, "last_activity_date": 1554458471, "creation_date": 1554458471, "answer_id": 55532884, "question_id": 55520818, "link": "https://stackoverflow.com/questions/55520818/how-do-i-make-a-dynamic-index-to-get-the-value-of-a-tuple/55532884#55532884", "title": "How do I make a dynamic index to get the value of a tuple?", "body": "<p>As others pointed out, <strong>you probably want to use an array or <code>Vec&lt;T&gt;</code> instead.</strong> </p>\n\n<p>As <a href=\"https://doc.rust-lang.org/book/ch03-02-data-types.html#the-tuple-type\" rel=\"noreferrer\">the book explains</a>, tuples are heterogeneous data types: each tuple element can have a different type. If you could iterate over all tuple values, strange things could happen:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let data = (12, true);\nfor a in 0..data.len() {\n    // Oops: `+ 1` makes sense for the integer, but not for the bool\n    println!(\"{}\", data.a + 1); \n}\n</code></pre>\n\n<p>On the other hand, arrays are homogeneous types: all elements have the same type! So the problem in the snippet above can't occur. The same is true for <code>Vec&lt;T&gt;</code>: only elements of type <code>T</code> can be stored. The difference between <code>Vec&lt;T&gt;</code> and an array: a vector can grow, i.e. is dynamically sized while an array has a fixed size at compile time.</p>\n\n<p>Here is your code snippet with an array (<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=9924db84caafcabf6eb489019fe4d273\" rel=\"noreferrer\">Playground</a>):</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let data = [12, 3, 4, 5];\nfor a in 0..data.len() {\n    println!(\"{}\", data[a]);\n}\n</code></pre>\n\n<p>But of course, you can iterate over collections like arrays without iterating over indices, if you want (e.g. <code>for elem in &amp;data</code>).</p>\n\n<p>As a last note: of course, it's technically possible to create a dynamic tuple index by doing <code>unsafe</code> pointer magic \u2013 assuming you only store the same types in your tuple. But this is hardly ever necessary and should be avoided. That's why I won't even show code how to do it.</p>\n"}], "owner": {"reputation": 179, "user_id": 8197537, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3AnuAsHPASQ/AAAAAAAAAAI/AAAAAAAAAKg/qOCe5RLzzwE/photo.jpg?sz=128", "display_name": "Arian Saputra", "link": "https://stackoverflow.com/users/8197537/arian-saputra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1010, "favorite_count": 1, "accepted_answer_id": 55532884, "answer_count": 1, "score": 2, "last_activity_date": 1554458493, "creation_date": 1554394994, "last_edit_date": 1554458493, "question_id": 55520818, "link": "https://stackoverflow.com/questions/55520818/how-do-i-make-a-dynamic-index-to-get-the-value-of-a-tuple", "title": "How do I make a dynamic index to get the value of a tuple?", "body": "<p>In Python, I learned that I can retrieve a tuple value by a dynamic index:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>data = (1,2,3,4)\ndata[0]\n\nfor a in range(len(data)):\n   print(data[a])\n</code></pre>\n\n<p>The output:</p>\n\n<pre><code>1\n2\n3\n4\n</code></pre>\n\n<p>how to do this in Rust? </p>\n\n<p>I tried something like this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn main() {\n    let data = (12, 3, 4, 5);\n    for a in 0..100 {\n        println!(\"{}\", data.a);\n    }\n}\n</code></pre>\n\n<p>But it's not working, it only gives me some error.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 660, "user_id": 2064646, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/448cafc28b959f69d045688deadf58c0?s=128&d=identicon&r=PG", "display_name": "so61pi", "link": "https://stackoverflow.com/users/2064646/so61pi"}, "edited": false, "score": 0, "creation_date": 1554392078, "post_id": 55519710, "comment_id": 97744279, "body": "Could you also put the error message in the question?"}, {"owner": {"reputation": 660, "user_id": 2064646, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/448cafc28b959f69d045688deadf58c0?s=128&d=identicon&r=PG", "display_name": "so61pi", "link": "https://stackoverflow.com/users/2064646/so61pi"}, "edited": false, "score": 0, "creation_date": 1554392405, "post_id": 55519710, "comment_id": 97744468, "body": "Is <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=95454216b6d196d20da4af17499c6961\" rel=\"nofollow noreferrer\">this code</a> what you are after?"}, {"owner": {"reputation": 703, "user_id": 8458083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e6ca7ced7bd1272973fe4fa22f90971?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre-olivier Gendraud", "link": "https://stackoverflow.com/users/8458083/pierre-olivier-gendraud"}, "reply_to_user": {"reputation": 660, "user_id": 2064646, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/448cafc28b959f69d045688deadf58c0?s=128&d=identicon&r=PG", "display_name": "so61pi", "link": "https://stackoverflow.com/users/2064646/so61pi"}, "edited": false, "score": 0, "creation_date": 1554392756, "post_id": 55519710, "comment_id": 97744659, "body": "@so61pi Your solution  (triangle&lt;T&gt; {point : vector&lt;T&gt;}) works here but  triangle implements shape&lt;T,V:vector&lt;T&gt;&gt; and therefore it must have 2 generic parameters"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1554395285, "post_id": 55519710, "comment_id": 97746106, "body": "Please <b>always</b> paste the <b><i>complete</i></b> error, not just a snippet of it."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1554398752, "post_id": 55519710, "comment_id": 97747879, "body": "Consider putting the bounds only on the method that needs them, as suggested by the answers to <a href=\"https://stackoverflow.com/questions/50671177/specify-fn-trait-bound-on-struct-definition-without-fixing-one-of-the-fn-par\">Specify <code>Fn</code> trait bound on struct definition without fixing one of the <code>Fn</code> parameters</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2959, "user_id": 5903309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/665cdb14fb46d20c11a176c92e6ed663?s=128&d=identicon&r=PG", "display_name": "Jan Nils Ferner", "link": "https://stackoverflow.com/users/5903309/jan-nils-ferner"}, "is_accepted": true, "score": 4, "last_activity_date": 1554393231, "last_edit_date": 1554393231, "creation_date": 1554392510, "answer_id": 55520019, "question_id": 55519710, "link": "https://stackoverflow.com/questions/55519710/how-to-make-a-generic-of-generic-with-trait/55520019#55520019", "title": "How to make a generic of generic with trait?", "body": "<p>I assume your type <code>Vector</code> looks more or less like this.</p>\n\n<pre><code>pub trait Vector&lt;T&gt; {\n    // Some functions\n}\n</code></pre>\n\n<hr>\n\n<p>The solution is to declare multiple generic types and to list their type constraints individually: Type <code>V</code> must implement <code>Vector&lt;T&gt;</code> and type <code>T</code> in turn must implement <code>Float</code> and <code>Clone</code>.</p>\n\n<pre><code>pub struct Triangle&lt;V, T&gt;\nwhere\n    V: vector::Vector&lt;T&gt;,\n    T: Float + Clone,\n{\n    point1: V,\n    point2: V,\n    point3: V,\n    phantom: PhantomData&lt;T&gt;,\n}\n</code></pre>\n\n<p>I'm using <a href=\"https://doc.rust-lang.org/std/marker/struct.PhantomData.html\" rel=\"nofollow noreferrer\">std::marker::PhantomData</a> to save the otherwise unused type information.</p>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=3f1fe422bb12e52c95358a28d888fcbb\" rel=\"nofollow noreferrer\">Link to full working code</a>.</p>\n"}], "owner": {"reputation": 703, "user_id": 8458083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e6ca7ced7bd1272973fe4fa22f90971?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre-olivier Gendraud", "link": "https://stackoverflow.com/users/8458083/pierre-olivier-gendraud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 55520019, "answer_count": 1, "score": 2, "last_activity_date": 1593117918, "creation_date": 1554391592, "last_edit_date": 1593117918, "question_id": 55519710, "link": "https://stackoverflow.com/questions/55519710/how-to-make-a-generic-of-generic-with-trait", "title": "How to make a generic of generic with trait?", "body": "<pre><code>pub struct Triangle&lt;T: Float + std::clone::Clone, V: vector::Vector&lt;T&gt;&gt; {\n    point1: V,\n    point2: V,\n    point3: V,\n}\n</code></pre>\n<p>This chunck of code doesn't compile because T isn't used (Nevertheless, T is used later in a method)</p>\n<p>I have tried this syntax</p>\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct Triangle&lt;V: vector::Vector&lt;T: Float + std::clone::Clone&gt;&gt; {\n    point1: V,\n    point2: V,\n    point3: V,\n}\n</code></pre>\n<p>Error:</p>\n<pre class=\"lang-none prettyprint-override\"><code>expected one of `!`, `(`, `+`, `,`, `::`, `&lt;`, or `&gt;`, found `:`\n\nexpected one of 7 possible tokens here\n</code></pre>\n<p>and this syntax</p>\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct Triangle2&lt;V&gt; where V: vector::Vector&lt;T&gt; where T: Float {\n    point1: V,\n    point2: V,\n    point3: V,\n}\n</code></pre>\n<p>Error:</p>\n<pre class=\"lang-none prettyprint-override\"><code>expected `where`, or `{` after struct name, found keyword `where`\n\nexpected `where`, or `{` after struct name\n</code></pre>\n<p>that doesn't work.</p>\n<p>Is there a way to fix this problem?</p>\n"}, {"tags": ["assembly", "rust"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1554389154, "post_id": 55518419, "comment_id": 97742318, "body": "Add <code>pub</code> to your function and update your question please."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 4, "creation_date": 1554390619, "post_id": 55518419, "comment_id": 97743336, "body": "Please do not put <i>answers</i> in your <i>question</i>. You are welcome to answer your own question below and even accept that answer. This is better because it allows additional answers and those answers to be voted on by the community."}], "answers": [{"tags": [], "owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "is_accepted": true, "score": 3, "last_activity_date": 1554389201, "creation_date": 1554389201, "answer_id": 55518890, "question_id": 55518419, "link": "https://stackoverflow.com/questions/55518419/why-does-rust-produce-completely-different-assembly-with-and-without-pub-and-n/55518890#55518890", "title": "Why does rust produce completely different assembly with and without pub and #[no_mangle]?", "body": "<p>Without <code>#[no_mangle]</code> there is no code emitted at all (what you see are just assembler directives, there is no actual code). I'm guessing that the compiler decides that the function will always be inlined, so there is no need to really emit code for it (especially since you're optimizing for size and adding the two values inline will never be bigger than calling the function).</p>\n\n<p>The only reason why you would want <code>#[no_mangle]</code> is if you are planning to call the function from outside Rust. Such a call can't be inlined for obvious reason, so I assume the compiler does emit the code to make these external calls possible.</p>\n"}], "owner": {"reputation": 623, "user_id": 10962821, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-2LR2CPhrhu0/AAAAAAAAAAI/AAAAAAAAAAc/OGsF9pFiFOU/photo.jpg?sz=128", "display_name": "sn99", "link": "https://stackoverflow.com/users/10962821/sn99"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 0, "accepted_answer_id": 55518890, "answer_count": 1, "score": 0, "last_activity_date": 1559831213, "creation_date": 1554387895, "last_edit_date": 1559831213, "question_id": 55518419, "link": "https://stackoverflow.com/questions/55518419/why-does-rust-produce-completely-different-assembly-with-and-without-pub-and-n", "title": "Why does rust produce completely different assembly with and without pub and #[no_mangle]?", "body": "<p>The rust code in question is:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[no_mangle]\nfn add(a: isize, b: isize) -&gt; isize {\n    a + b\n}\n</code></pre>\n\n<p>It produces the following assembly code when used with rustc command <code>rustc add.rs --crate-type=lib --emit=asm -C opt-level=z</code>:</p>\n\n<pre><code>    .text\n    .file   \"add.3a1fbbbh-cgu.0\"\n    .section    .text.add,\"ax\",@progbits\n    .globl  add\n    .type   add,@function\nadd:\n    .cfi_startproc\n    leaq    (%rdi,%rsi), %rax\n    retq\n.Lfunc_end0:\n    .size   add, .Lfunc_end0-add\n    .cfi_endproc\n\n    .section    \".note.GNU-stack\",\"\",@progbits\n</code></pre>\n\n<p>And the following without <code>#[no_mangle]</code>:</p>\n\n<pre><code>    .text\n    .file   \"add.3a1fbbbh-cgu.0\"\n\n    .section    \".note.GNU-stack\",\"\",@progbits\n</code></pre>\n\n<p>Why is this so ? Shouldn't it just change <code>add</code> to something like <code>_Zaddm</code> without no-mangle ?</p>\n"}, {"tags": ["rust", "rust-tokio"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554383628, "post_id": 55516235, "comment_id": 97738405, "body": "Cross github <a href=\"https://github.com/tokio-rs/tokio/issues/1035\" rel=\"nofollow noreferrer\">issue</a>"}, {"owner": {"reputation": 73, "user_id": 5665256, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b72fa7ef91df13fc682d72b4e31fc172?s=128&d=identicon&r=PG&f=1", "display_name": "vuk", "link": "https://stackoverflow.com/users/5665256/vuk"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554383990, "post_id": 55516235, "comment_id": 97738651, "body": "@Stargateur yeah that&#39;s me"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554384756, "post_id": 55516235, "comment_id": 97739204, "body": "Cross question/issue are completely ok, I just make them linked, to avoid waste time if any side have the answer first."}, {"owner": {"reputation": 660, "user_id": 2064646, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/448cafc28b959f69d045688deadf58c0?s=128&d=identicon&r=PG", "display_name": "so61pi", "link": "https://stackoverflow.com/users/2064646/so61pi"}, "edited": false, "score": 0, "creation_date": 1554390602, "post_id": 55516235, "comment_id": 97743321, "body": "What you have is a timer future that wraps an infinite loop. Tokio then calls and waits for <a href=\"https://github.com/tokio-rs/tokio/blob/tokio-timer-0.2.10/tokio-timer/src/timeout.rs#L201\" rel=\"nofollow noreferrer\">timer&#39;s poll function</a> which in turn <a href=\"https://github.com/tokio-rs/tokio/blob/tokio-timer-0.2.10/tokio-timer/src/timeout.rs#L203\" rel=\"nofollow noreferrer\">calls and waits</a> for your infinite loop."}], "owner": {"reputation": 73, "user_id": 5665256, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b72fa7ef91df13fc682d72b4e31fc172?s=128&d=identicon&r=PG&f=1", "display_name": "vuk", "link": "https://stackoverflow.com/users/5665256/vuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 133, "favorite_count": 1, "closed_date": 1554394135, "answer_count": 0, "score": 3, "last_activity_date": 1554383044, "creation_date": 1554381643, "last_edit_date": 1554383044, "question_id": 55516235, "link": "https://stackoverflow.com/questions/55516235/how-can-i-make-a-piece-of-running-code-timeout", "closed_reason": "Duplicate", "title": "How can i make a piece of running code timeout?", "body": "<p>I'm trying to get some piece of code to run for <strong>at most</strong> <code>timeout</code> duration. In other words I want a piece of code to either complete in the given time constraint or be interrupted.</p>\n\n<p>The concrete code that would be running would be a multi-part http request which i want to terminate if the request is not completed in a time-frame. I have tried the <code>Timeou</code> from the <code>tokio-timer</code> crate but i am having some issues.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use futures::future;\n\nuse std::time::Duration;\n\nuse tokio::io::Error;\nuse tokio::prelude::*;\nuse tokio::runtime::current_thread::Runtime;\n\nfn main() {\n    let timeout: u64 = 1000;\n\n    let mut runtime = Runtime::new().unwrap();\n    let req_timeout = future::lazy(|| -&gt; Result&lt;String, Error&gt; {\n        println!(\"Start expensive\");\n        loop {\n            //some expensive task\n        }\n        Ok(\"finished task\".to_string())\n    })\n    .timeout(Duration::from_millis(timeout));\n\n    let result = runtime.block_on(req_timeout);\n\n    match result {\n        Ok(_str) =&gt; println!(\"Task finished\"),\n        Err(_) =&gt; println!(\"Task interupted\"),\n    }\n}\n</code></pre>\n\n<p>Currently the timeout never triggers leaving the <code>loop</code> to execute forever instead of being interrupted and resuming the execution from the <code>block_on</code> call. I'm sure, I am missing something, but I can't really figure it out.</p>\n"}, {"tags": ["rust", "rust-cargo"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554380244, "post_id": 55515686, "comment_id": 97736200, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/54515989/how-to-mark-use-statements-for-conditional-compilation\">How to mark use statements for conditional compilation?</a>"}, {"owner": {"reputation": 363, "user_id": 1018826, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/cabce843c56109c549bbc2f30de7e9d7?s=128&d=identicon&r=PG", "display_name": "draklor40", "link": "https://stackoverflow.com/users/1018826/draklor40"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554380556, "post_id": 55515686, "comment_id": 97736398, "body": "@Stargateur No particular reason. I based my tiny projects on an old template and it seemed to have main public. Fixed it. Thanks for pointing it out."}, {"owner": {"reputation": 363, "user_id": 1018826, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/cabce843c56109c549bbc2f30de7e9d7?s=128&d=identicon&r=PG", "display_name": "draklor40", "link": "https://stackoverflow.com/users/1018826/draklor40"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554380725, "post_id": 55515686, "comment_id": 97736496, "body": "@Stargateur Not quite, although I see where I might have made the mistake. The   ` if cfg!(feature = &quot;debug&quot;) {` would be replaced with something like <code>if false</code> during compilation if <code>debug</code> is not enabled, but the next 2 lines would still be compiled. However, <code>mod k</code> is not compiled as it is compiled only when <code>feature =debug</code>  is enabled. So the compiler complains about the missing module. I could replace the <code>if else</code> with a <code>#[cfg(feature = &quot;debug&quot;)]</code> followed by a block where I create the structs I need."}, {"owner": {"reputation": 623, "user_id": 10962821, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-2LR2CPhrhu0/AAAAAAAAAAI/AAAAAAAAAAc/OGsF9pFiFOU/photo.jpg?sz=128", "display_name": "sn99", "link": "https://stackoverflow.com/users/10962821/sn99"}, "edited": false, "score": 0, "creation_date": 1554383594, "post_id": 55515686, "comment_id": 97738385, "body": "@draklor40 you are right, &#39;cfg!&#39; evaluates into an expression like and not an attribute"}], "owner": {"reputation": 363, "user_id": 1018826, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/cabce843c56109c549bbc2f30de7e9d7?s=128&d=identicon&r=PG", "display_name": "draklor40", "link": "https://stackoverflow.com/users/1018826/draklor40"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 700, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1554380624, "creation_date": 1554379756, "last_edit_date": 1554380624, "question_id": 55515686, "link": "https://stackoverflow.com/questions/55515686/how-do-i-check-for-features-set-in-rust-during-compilation", "title": "How do I check for features set in Rust during compilation?", "body": "<p>I am trying to use Rusts feature to conditionally compile a module in my crate and also use it only when a feature is enabled. The conditional compilation works fine when the feature is set, but refuses to compile when the feature is not set.</p>\n\n<p>I use the same feature flag to conditionally import the module in my main so my assumption is that the module shouldn't be imported when the feature isn't used. </p>\n\n<pre><code>#[cfg(feature = \"debug\")]\npub mod k {\n    pub struct S { pub x: i32, pub y: i32}\n}\n</code></pre>\n\n<p>And how I use it in main </p>\n\n<pre><code>pub fn main() {\n    if cfg!(feature = \"debug\") {\n        use self::k;\n        let _s = k::S {x: 4, y: 5};\n    }\n\n    let g = vec![1, 2, 4];\n    println!(\"{:?}\", g);\n}\n</code></pre>\n\n<p>If I enable the feature via the <code>--features</code> flag then it compiles as expected:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>cargo build --features \"debug\" \n    Finished dev [unoptimized + debuginfo] target(s) in 0.08s\n</code></pre>\n\n<p>But when I do not pass the <code>--features</code> it fails and my expectation is that it should skip the block with the <code>cfg!</code> set.</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0432]: unresolved import `self::k`\n  --&gt; src/main.rs:32:13\n   |\n32 |         use self::k;\n   |             ^^^^^^^ no `k` in the root\n\nerror: aborting due to previous error\n\nFor more information about this error, try `rustc --explain E0432`.\n</code></pre>\n\n<p>This is how my <code>Cargo.toml</code> looks like</p>\n\n<pre><code>[features]\ndefault = []\ndebug = []\n</code></pre>\n\n<p>Can someone explain why this happens and a better way to conditionally compile such blocks of code ?</p>\n"}, {"tags": ["windows", "rust", "installation"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1554379422, "post_id": 55514868, "comment_id": 97735652, "body": "You may find an answer in the <a href=\"https://users.rust-lang.org\" rel=\"nofollow noreferrer\">user forum</a>. I remember reading a similar question once."}, {"owner": {"reputation": 17135, "user_id": 581190, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a503f14866aaa083332c81264860ac8e?s=128&d=identicon&r=PG", "display_name": "zrzka", "link": "https://stackoverflow.com/users/581190/zrzka"}, "edited": false, "score": 0, "creation_date": 1554458904, "post_id": 55514868, "comment_id": 97769205, "body": "There&#39;s <a href=\"https://github.com/rust-lang/rustup.rs/issues/1436#issuecomment-430436195\" rel=\"nofollow noreferrer\">similar issue</a> with some tips. Not sure if it will solve your problem, but worth to try it."}, {"owner": {"reputation": 589, "user_id": 8430120, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-4YvXHqtVwNg/AAAAAAAAAAI/AAAAAAAAAAw/V3tbvGKpkUc/photo.jpg?sz=128", "display_name": "Rahul Raut", "link": "https://stackoverflow.com/users/8430120/rahul-raut"}, "reply_to_user": {"reputation": 17135, "user_id": 581190, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a503f14866aaa083332c81264860ac8e?s=128&d=identicon&r=PG", "display_name": "zrzka", "link": "https://stackoverflow.com/users/581190/zrzka"}, "edited": false, "score": 0, "creation_date": 1554480584, "post_id": 55514868, "comment_id": 97782313, "body": "@zrzka Unfortunately I don\u2019t have access to those settings, need to go to infra team to change those settings."}], "answers": [{"comments": [{"owner": {"reputation": 589, "user_id": 8430120, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-4YvXHqtVwNg/AAAAAAAAAAI/AAAAAAAAAAw/V3tbvGKpkUc/photo.jpg?sz=128", "display_name": "Rahul Raut", "link": "https://stackoverflow.com/users/8430120/rahul-raut"}, "edited": false, "score": 2, "creation_date": 1555657067, "post_id": 55757119, "comment_id": 98191150, "body": "Thanks Man! It worked for me. The only problem is I have to manually set the environment variable to run rustc."}], "tags": [], "owner": {"reputation": 7289, "user_id": 1057052, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/qGN8h.jpg?s=128&g=1", "display_name": "Jose A", "link": "https://stackoverflow.com/users/1057052/jose-a"}, "is_accepted": true, "score": 7, "last_activity_date": 1555652364, "creation_date": 1555652364, "answer_id": 55757119, "question_id": 55514868, "link": "https://stackoverflow.com/questions/55514868/not-able-to-install-rust-successfully-on-windows-10/55757119#55757119", "title": "Not able to install rust successfully on Windows 10", "body": "<p>I was running into the same issue.  The way I solved it was by manually reinstalling the <code>stable-x86_64-pc-windows-msvc</code> toolchain which apparently got corrupted while installing.</p>\n\n<p>I did:</p>\n\n<pre><code>rustup toolchain remove stable-x86_64-pc-windows-msvc\n</code></pre>\n\n<p>Then:</p>\n\n<pre><code>rustup install stable-x86_64-pc-windows-msvc\n</code></pre>\n\n<p><strong>Some notes</strong>:</p>\n\n<ul>\n<li>You can get the toolchain name (they're divided by their release channel: stable, nightly, beta) by navigating to your user folder and finding the <code>.rustup</code> folder (E.g: <code>C:Users\\MyWindowsUser\\.rustup\\toolchains</code>)</li>\n<li>This should also fix the RLS extension for VSCode.</li>\n</ul>\n"}], "owner": {"reputation": 589, "user_id": 8430120, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-4YvXHqtVwNg/AAAAAAAAAAI/AAAAAAAAAAw/V3tbvGKpkUc/photo.jpg?sz=128", "display_name": "Rahul Raut", "link": "https://stackoverflow.com/users/8430120/rahul-raut"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1407, "favorite_count": 0, "accepted_answer_id": 55757119, "answer_count": 1, "score": 3, "last_activity_date": 1555652364, "creation_date": 1554377374, "last_edit_date": 1554458714, "question_id": 55514868, "link": "https://stackoverflow.com/questions/55514868/not-able-to-install-rust-successfully-on-windows-10", "title": "Not able to install rust successfully on Windows 10", "body": "<p>I am trying to install rust which is failing with following error:\nAny one has faced same issue before on windows 10? Any help appreciated!  </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>info: syncing channel updates for 'stable-x86_64-pc-windows-msvc'\ninfo: latest update on 2019-02-28, rust version 1.33.0 (2aa4c46cf 2019-02-28)\ninfo: downloading component 'rustc'\ninfo: downloading component 'rust-std'\ninfo: downloading component 'cargo'\ninfo: downloading component 'rust-docs'\ninfo: installing component 'rustc'\n57.7 MiB /  57.7 MiB (100 %)   2.6 MiB/s ETA:   0 s\ninfo: installing component 'rust-std'\n51.4 MiB /  51.4 MiB (100 %)   4.9 MiB/s ETA:   0 s\ninfo: installing component 'cargo'\n  2.8 MiB /   2.8 MiB (100 %) 152.0 KiB/s ETA:   0 s\ninfo: installing component 'rust-docs'\n  8.5 MiB /   8.5 MiB (100 %) 281.6 KiB/s ETA:   0 s\ninfo: rolling back changes\nerror: could not rename component file from 'C:\\Users\\rraut\\.rustup\\tmp\\8va7fsfks8zkeb5b_dir\\bk' to 'C:\\Users\\rraut\\.rustup\\toolchains\\stable-x86_64-pc-windows-msvc\\share/man'\nerror: could not rename component file from 'C:\\Users\\rraut\\.rustup\\tmp\\mybj8dkhr27yqlzf_dir\\bk' to 'C:\\Users\\rraut\\.rustup\\toolchains\\stable-x86_64-pc-windows-msvc\\share/man/man1'\nerror: could not rename component file from 'C:\\Users\\rraut\\.rustup\\tmp\\5l3hc8i6tp_6rqsa_dir\\bk' to 'C:\\Users\\rraut\\.rustup\\toolchains\\stable-x86_64-pc-windows-msvc\\bin'\nerror: could not rename component file from 'C:\\Users\\rraut\\.rustup\\tmp\\ejk4eeibyz0dkgjt_dir\\bk' to 'C:\\Users\\rraut\\.rustup\\toolchains\\stable-x86_64-pc-windows-msvc\\lib/rustlib/etc'\nerror: could not rename component file from 'C:\\Users\\rraut\\.rustup\\tmp\\1758r_0hyzkhtohi_dir\\bk' to 'C:\\Users\\rraut\\.rustup\\toolchains\\stable-x86_64-pc-windows-msvc\\lib/rustlib/x86_64-pc-windows-msvc/bin'\nerror: could not rename component file from 'C:\\Users\\rraut\\.rustup\\tmp\\5_0tdsg3gat5u6yy_dir\\bk' to 'C:\\Users\\rraut\\.rustup\\toolchains\\stable-x86_64-pc-windows-msvc\\lib/rustlib/x86_64-pc-windows-msvc/codegen-backends'\nerror: failed to install component: 'rust-docs-x86_64-pc-windows-msvc', detected conflict: '\"share/doc/rust/html\"'\n</code></pre>\n"}, {"tags": ["rust", "format"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 5, "creation_date": 1554372613, "post_id": 55513198, "comment_id": 97731338, "body": "you don&#39;t need <code>[..]</code>"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1554372766, "post_id": 55513198, "comment_id": 97731421, "body": "<code>expect()</code> is a &quot;quick and dirty&quot; way to discard option, you are not really expected to use it to create accurate error. so generally just <code>&quot;that should not happen&quot;</code> is enough"}, {"owner": {"reputation": 5433, "user_id": 801924, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e7897859ed577821631f36eceba0603d?s=128&d=identicon&r=PG", "display_name": "bux", "link": "https://stackoverflow.com/users/801924/bux"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554372986, "post_id": 55513198, "comment_id": 97731564, "body": "@Stargateur about &quot;that should not happen&quot;: What am i supposed to use when i whant to panic if result is an error ?"}, {"owner": {"reputation": 660, "user_id": 2064646, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/448cafc28b959f69d045688deadf58c0?s=128&d=identicon&r=PG", "display_name": "so61pi", "link": "https://stackoverflow.com/users/2064646/so61pi"}, "edited": false, "score": 0, "creation_date": 1554391378, "post_id": 55513198, "comment_id": 97743854, "body": "<code>Option::expect</code> is basically <a href=\"https://github.com/rust-lang/rust/blob/1.33.0/src/libcore/option.rs#L1037\" rel=\"nofollow noreferrer\">panic</a> when x is <code>None</code>."}], "answers": [{"tags": [], "owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "is_accepted": true, "score": 5, "last_activity_date": 1569517311, "last_edit_date": 1569517311, "creation_date": 1554374155, "answer_id": 55513794, "question_id": 55513198, "link": "https://stackoverflow.com/questions/55513198/is-there-a-more-concise-way-to-format-expect-message/55513794#55513794", "title": "Is there a more concise way to format .expect() message?", "body": "<p>First you don't need to write <code>[..]</code></p>\n\n<hr>\n\n<p>If you really want to panic but also want to format the error message, I think I would use <a href=\"https://doc.rust-lang.org/std/macro.assert.html\" rel=\"nofollow noreferrer\"><code>assert!()</code></a>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn main() {\n    let x: Option&lt;&amp;str&gt; = None;\n    assert!(x.is_some(), \"the world is ending: {}\", \"foo\");\n    let _x = x.unwrap();\n}\n</code></pre>\n\n<hr>\n\n<p>If you want you could also use the <a href=\"https://crates.io/crates/unwrap\" rel=\"nofollow noreferrer\"><code>unwrap</code></a> crate:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use unwrap::unwrap;\n\nfn main() {\n    let x: Option&lt;&amp;str&gt; = None;\n    let _x = unwrap!(x, \"the world is ending: {}\", \"foo\");\n}\n</code></pre>\n\n<hr>\n\n<p>Also, both these methods avoid the construction of the error <code>String</code> every time, unlike calling <code>expect()</code> with <code>format!()</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 1683, "user_id": 2926992, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/2w3LT.jpg?s=128&g=1", "display_name": "Erdin Eray", "link": "https://stackoverflow.com/users/2926992/erdin-eray"}, "edited": false, "score": 0, "creation_date": 1583150008, "post_id": 58121716, "comment_id": 107007156, "body": "What about <code>Result</code>?"}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "reply_to_user": {"reputation": 1683, "user_id": 2926992, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/2w3LT.jpg?s=128&g=1", "display_name": "Erdin Eray", "link": "https://stackoverflow.com/users/2926992/erdin-eray"}, "edited": false, "score": 0, "creation_date": 1583159578, "post_id": 58121716, "comment_id": 107012071, "body": "@ErdinEray I don&#39;t understand your question - <code>ok_or_else</code> returns a <code>Result</code>."}, {"owner": {"reputation": 1683, "user_id": 2926992, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/2w3LT.jpg?s=128&g=1", "display_name": "Erdin Eray", "link": "https://stackoverflow.com/users/2926992/erdin-eray"}, "edited": false, "score": 0, "creation_date": 1583233266, "post_id": 58121716, "comment_id": 107039254, "body": "Sorry, I couldn&#39;t make myself clear. <code>x</code> is an <code>Option&lt;&amp;str&gt;</code> and <code>Option</code> has <code>ok_or_else</code> method, yet I cannot seem to find a similar method for <code>Result</code> (like, &quot;run this closure in case of an <code>Error</code>&quot;). I know this can be done with <code>match</code>, but I&#39;d like to panic with a detailed (formatted) error message in a closure I provide to <code>Result</code>. <code>expect</code> for <code>Result</code> does not take a <code>closure</code>, it takes a <code>&amp;str</code>."}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "reply_to_user": {"reputation": 1683, "user_id": 2926992, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/2w3LT.jpg?s=128&g=1", "display_name": "Erdin Eray", "link": "https://stackoverflow.com/users/2926992/erdin-eray"}, "edited": false, "score": 0, "creation_date": 1583248101, "post_id": 58121716, "comment_id": 107047525, "body": "@ErdinEray What about <code>result.map_err()</code>? Or <code>result.ok().ok_or_else()</code>"}, {"owner": {"reputation": 4690, "user_id": 2019549, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/900a3735d55a0473c975ba9266bf0c68?s=128&d=identicon&r=PG", "display_name": "cambunctious", "link": "https://stackoverflow.com/users/2019549/cambunctious"}, "edited": false, "score": 0, "creation_date": 1607962712, "post_id": 58121716, "comment_id": 115430148, "body": "Don&#39;t bother creating a <code>Result</code> if you&#39;re just going to immediately <code>unwrap</code> it."}], "tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": false, "score": 6, "last_activity_date": 1569517948, "creation_date": 1569517948, "answer_id": 58121716, "question_id": 55513198, "link": "https://stackoverflow.com/questions/55513198/is-there-a-more-concise-way-to-format-expect-message/58121716#58121716", "title": "Is there a more concise way to format .expect() message?", "body": "<p>To avoid the unnecessary overhead of formatting and allocating a <code>String</code> in the case of an <code>Ok</code>, you can convert the <code>Option</code> to a <code>Result</code> and then unwrap it:</p>\n\n<pre><code>fn main() {\n    let x: Option&lt;&amp;str&gt; = None;\n    x.ok_or_else(|| format!(\"the world is ending: {}\", \"foo\"))\n        .unwrap();\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4690, "user_id": 2019549, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/900a3735d55a0473c975ba9266bf0c68?s=128&d=identicon&r=PG", "display_name": "cambunctious", "link": "https://stackoverflow.com/users/2019549/cambunctious"}, "is_accepted": false, "score": 8, "last_activity_date": 1609731369, "last_edit_date": 1609731369, "creation_date": 1596747506, "answer_id": 63291643, "question_id": 55513198, "link": "https://stackoverflow.com/questions/55513198/is-there-a-more-concise-way-to-format-expect-message/63291643#63291643", "title": "Is there a more concise way to format .expect() message?", "body": "<p>I would do:</p>\n<pre class=\"lang-rust prettyprint-override\"><code>option.unwrap_or_else(|_| panic!(&quot;ah: {}&quot;, &quot;nuts&quot;))\n</code></pre>\n<p>Formatting a string is somewhat costly. This will avoid formatting the string unless it is really needed.</p>\n"}], "owner": {"reputation": 5433, "user_id": 801924, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e7897859ed577821631f36eceba0603d?s=128&d=identicon&r=PG", "display_name": "bux", "link": "https://stackoverflow.com/users/801924/bux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3158, "favorite_count": 0, "accepted_answer_id": 55513794, "answer_count": 3, "score": 11, "last_activity_date": 1609731369, "creation_date": 1554372277, "last_edit_date": 1569547199, "question_id": 55513198, "link": "https://stackoverflow.com/questions/55513198/is-there-a-more-concise-way-to-format-expect-message", "title": "Is there a more concise way to format .expect() message?", "body": "<p>I currently have to use this to format a <code>.expect()</code> message:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn main() {\n    let x: Option&lt;&amp;str&gt; = None;\n    x.expect(&amp;format!(\"the world is ending: {}\", \"foo\")[..]);\n}\n</code></pre>\n\n<p>Is there a less verbose way?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 7, "creation_date": 1554342076, "post_id": 55506647, "comment_id": 97718964, "body": "One is signed and the other is unsigned... that... probably answers your question?"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554342662, "post_id": 55506647, "comment_id": 97719091, "body": "One doesn&#39;t make sense, the other is nice... ;)"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554343630, "post_id": 55506647, "comment_id": 97719280, "body": "What do you mean by <i>different</i>? They are two different types, so... yes?"}, {"owner": {"reputation": 3649, "user_id": 294569, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05c97ccc8981952c53fa09dadfafb132?s=128&d=identicon&r=PG", "display_name": "Damian", "link": "https://stackoverflow.com/users/294569/damian"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554343754, "post_id": 55506647, "comment_id": 97719307, "body": "@Shepmaster I am trying to understand why there are two type when we could just have one."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554344238, "post_id": 55506647, "comment_id": 97719413, "body": "Do you understand why Rust has both <code>u32</code> and <code>i32</code>?"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554344294, "post_id": 55506647, "comment_id": 97719427, "body": "@Damian You mean only one because they have the same size ?!? well because they doesn&#39;t represent the same thing. look like you know some C++, well they are the same then <a href=\"https://en.cppreference.com/w/cpp/types/ptrdiff_t\" rel=\"nofollow noreferrer\"><code>ptrdiff_t</code></a> (that I also don&#39;t like) and <a href=\"https://en.cppreference.com/w/cpp/types/size_t\" rel=\"nofollow noreferrer\"><code>size_t</code></a>"}, {"owner": {"reputation": 3649, "user_id": 294569, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05c97ccc8981952c53fa09dadfafb132?s=128&d=identicon&r=PG", "display_name": "Damian", "link": "https://stackoverflow.com/users/294569/damian"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554344526, "post_id": 55506647, "comment_id": 97719487, "body": "@Stargateur I started reading the Rust Programming Language book and are amazed about the quality of the design! When reading this came though by head. Now I understand better.Thank you all!!"}, {"owner": {"reputation": 3649, "user_id": 294569, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05c97ccc8981952c53fa09dadfafb132?s=128&d=identicon&r=PG", "display_name": "Damian", "link": "https://stackoverflow.com/users/294569/damian"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554344656, "post_id": 55506647, "comment_id": 97719516, "body": "@Shepmaster I think you are trying tell me I am missing the point. I am mixing types and size of them.. but then again the size is the same for signed and unsigned types?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554344841, "post_id": 55506647, "comment_id": 97719558, "body": "@Damian not trying to tell you anything yet; still figuring out where you are coming from. Do you understand why Rust has both signed and unsigned integer types to start with? Do you understand why Rust has a native-sized integer type?"}, {"owner": {"reputation": 3649, "user_id": 294569, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05c97ccc8981952c53fa09dadfafb132?s=128&d=identicon&r=PG", "display_name": "Damian", "link": "https://stackoverflow.com/users/294569/damian"}, "edited": false, "score": 0, "creation_date": 1554350810, "post_id": 55506647, "comment_id": 97720782, "body": "Here is my current understanding. Rust uses <a href=\"https://www.cs.cornell.edu/~tomf/notes/cps104/twoscomp.html\" rel=\"nofollow noreferrer\">two\u2019s complement representation</a> for signed and unsigned integers which is used by most modern computers. 32 and 64 bit native platforms stores integers differently. I believe both it items lines up with the OS and CPU so it is efficient in time and space."}, {"owner": {"reputation": 3649, "user_id": 294569, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05c97ccc8981952c53fa09dadfafb132?s=128&d=identicon&r=PG", "display_name": "Damian", "link": "https://stackoverflow.com/users/294569/damian"}, "edited": false, "score": 0, "creation_date": 1554360429, "post_id": 55506647, "comment_id": 97724152, "body": "This is also known as <a href=\"https://blog.rust-lang.org/2015/05/11/traits.html\" rel=\"nofollow noreferrer\">zero-cost abstractions</a> ... as I said in my post I am new to Rust."}], "answers": [{"tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": false, "score": 8, "last_activity_date": 1554342770, "creation_date": 1554342770, "answer_id": 55506728, "question_id": 55506647, "link": "https://stackoverflow.com/questions/55506647/can-isize-and-usize-be-different-in-rust/55506728#55506728", "title": "can isize and usize be different in rust?", "body": "<p>On a 32 bit system, <code>isize</code> is the same as <code>i32</code> and <code>usize</code> is the same as <code>u32</code>. On a 64 bit system, <code>isize</code> is the same as <code>i64</code> and <code>usize</code> is the same as <code>u64</code>.</p>\n\n<ul>\n<li><code>usize</code> cannot be negative and is generally used for memory addresses, positions, indices, lengths (or sizes!). </li>\n<li><code>isize</code> <em>can</em> be negative, and is generally used for <em>offsets to</em> addresses, positions, indices, or lengths.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 2230, "user_id": 1681772, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/p3n0A.png?s=128&g=1", "display_name": "yellowB", "link": "https://stackoverflow.com/users/1681772/yellowb"}, "is_accepted": false, "score": 5, "last_activity_date": 1554342985, "last_edit_date": 1554342985, "creation_date": 1554342877, "answer_id": 55506740, "question_id": 55506647, "link": "https://stackoverflow.com/questions/55506647/can-isize-and-usize-be-different-in-rust/55506740#55506740", "title": "can isize and usize be different in rust?", "body": "<p><strong>isize</strong> is architecture-based(e.g. 32bit/64bit) <strong>signed</strong>(negative/0/positive) integer type.</p>\n\n<p>See <a href=\"https://doc.rust-lang.org/std/primitive.isize.html\" rel=\"noreferrer\">here</a>:</p>\n\n<blockquote>\n  <p>Primitive Type isize</p>\n  \n  <p>The pointer-sized signed integer type.</p>\n  \n  <p>See also the std::isize module.</p>\n  \n  <p>The size of this primitive is how many bytes it takes to reference any\n  location in memory. For example, on a 32 bit target, this is 4 bytes\n  and on a 64 bit target, this is 8 bytes.</p>\n</blockquote>\n\n<p><strong>usize</strong> is architecture-based(e.g. 32bit/64bit) <strong>unsigned</strong>(0/positive) integer type.</p>\n\n<p>See <a href=\"https://doc.rust-lang.org/std/primitive.usize.html\" rel=\"noreferrer\">here</a>:</p>\n\n<blockquote>\n  <p>Primitive Type usize</p>\n  \n  <p>The pointer-sized unsigned integer type.</p>\n  \n  <p>See also the std::usize module.</p>\n  \n  <p>The size of this primitive is how many bytes it takes to reference any\n  location in memory. For example, on a 32 bit target, this is 4 bytes\n  and on a 64 bit target, this is 8 bytes.</p>\n</blockquote>\n"}], "owner": {"reputation": 3649, "user_id": 294569, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05c97ccc8981952c53fa09dadfafb132?s=128&d=identicon&r=PG", "display_name": "Damian", "link": "https://stackoverflow.com/users/294569/damian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1689, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1554343654, "creation_date": 1554341955, "last_edit_date": 1554343654, "question_id": 55506647, "link": "https://stackoverflow.com/questions/55506647/can-isize-and-usize-be-different-in-rust", "title": "can isize and usize be different in rust?", "body": "<p>Can <strong>isize and usize</strong> be different?\nBoth of them can be used for memory size, index, offset.</p>\n\n<p>Since <strong>usize</strong> is used for arrays why don't we just have usize </p>\n\n<p>I am new to Rust so this might be a basic question.</p>\n\n<p>Update: On a 32 bit system they are both 32 bit long and on a 64 bit system they are both 64 bit long. Irrespective of the sign.</p>\n"}]