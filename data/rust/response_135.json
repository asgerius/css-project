[{"tags": ["c", "arrays", "rust", "ffi"], "comments": [{"owner": {"reputation": 6509, "user_id": 356011, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/d17ff41be1044be6fb5ef186b83efb20?s=128&d=identicon&r=PG", "display_name": "marathon", "link": "https://stackoverflow.com/users/356011/marathon"}, "edited": false, "score": 0, "creation_date": 1502318824, "post_id": 45601652, "comment_id": 78162978, "body": "while the answer was similar, the question was not anywhere close to being the same."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1502319704, "post_id": 45601652, "comment_id": 78163264, "body": "Does that mean that you read the linked duplicates and solved your problem? That you cannot return a <code>CString</code> across the FFI boundary?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1502319909, "post_id": 45601652, "comment_id": 78163332, "body": "For beginner FFI questions, I highly recommend reading my <a href=\"http://jakegoulding.com/rust-ffi-omnibus/string_return/\" rel=\"nofollow noreferrer\">Rust FFI Omnibus</a>."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1502320623, "post_id": 45601652, "comment_id": 78163534, "body": "Your general method of returning the array is just fine, therefore any answer to the question you <i>asked</i> would be &quot;do exactly what you are doing&quot;. You didn&#39;t reduce your question enough to the core of the problem \u2014 returning <code>CString</code> instead of <code>* const c_char</code>. And yes, you always have to free Rust allocations back in Rust land. You will need to reconstitute the <code>Vec</code> and then let it drop."}], "owner": {"reputation": 6509, "user_id": 356011, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/d17ff41be1044be6fb5ef186b83efb20?s=128&d=identicon&r=PG", "display_name": "marathon", "link": "https://stackoverflow.com/users/356011/marathon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 766, "favorite_count": 0, "closed_date": 1502318613, "answer_count": 0, "score": 2, "last_activity_date": 1502321452, "creation_date": 1502318192, "last_edit_date": 1502321452, "question_id": 45601652, "link": "https://stackoverflow.com/questions/45601652/how-to-set-an-array-of-c-strings-on-an-out-parameter-of-a-rust-ffi-function", "closed_reason": "Duplicate", "title": "How to set an array of C strings on an out-parameter of a Rust FFI function?", "body": "<p>I would like create a Rust FFI function that takes an out-parameter for arrays, analogous to this C function:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>size_t arr_out_c(char ***out) {\n    char *msg = \"the quick brown fox\";\n    size_t STR_LEN = strlen(msg) +1;\n    size_t count = 3;\n    char** arr = calloc( count,  sizeof(char*));\n    for (int i = 0; i &lt; count; i++) {\n        arr[i] = calloc(STR_LEN,  sizeof(char));\n        strncpy(arr[i], msg, STR_LEN * sizeof(char));\n    }\n    *out = arr;\n    return count;\n}\n</code></pre>\n\n<p>Usage:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>char** test;\nsize_t count = arr_out_c(&amp;test);\nfor (int i = 0; i &lt; count; i++) {\n    printf(\"item: %s\", test[i]);\n}\n</code></pre>\n\n<p>I've gotten close with this:</p>\n\n<pre><code>#[no_mangle]\npub extern fn arr_out_rust(strings_out: *mut *mut *mut ::std::os::raw::c_char) -&gt; usize {\n    unsafe {\n        let s1 = ::std::ffi::CString::new(\"the quick brown fox\").unwrap();\n        let s2 = ::std::ffi::CString::new(\"the quick brown fox\").unwrap();\n        let mut strs = vec![s1, s2];\n        let len = strs.len();\n\n        let mut boxed_slice = strs.into_boxed_slice();\n        *strings_out = boxed_slice.as_mut_ptr() as *mut *mut ::std::os::raw::c_char;\n        mem::forget(boxed_slice);\n        len\n    }\n}\n</code></pre>\n\n<p>It works for the first item in the array, attempting to access the 2nd item results in a SEGV.   Perhaps the <code>CString</code>s are not getting packed in a contiguous block of memory... or maybe the <code>len</code> data in <code>slice</code> is part of that memory?   </p>\n\n<p>Also, to free this memory, can I just call the C <code>free</code> function on it in C space, or do I need to send it back into Rust space and call <code>drop</code>?</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>char** test;\nsize_t count = arr_out_rust(&amp;test);\nfor (int i = 0; i &lt; count; i++) {\n    printf(\"item: %s\", test[i]);\n}\n</code></pre>\n\n<p>will print a single <code>the quick brown fox</code>, then crash.</p>\n\n<hr>\n\n<p>While this question has some similarities to questions asking about <strong>returning</strong> strings to C, it's pretty unique in that it is asking about out-bound pointers in FFI.  Marking it as a duplicate and closing it would go against the spirit of Stack Overflow as a repository of unique answers.</p>\n"}, {"tags": ["rust", "stm32", "spi"], "comments": [{"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 0, "creation_date": 1502303236, "post_id": 45597871, "comment_id": 78155743, "body": "oscilloscope..."}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "reply_to_user": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 0, "creation_date": 1502314737, "post_id": 45597871, "comment_id": 78161448, "body": "@old_timer even better $10 logic analyser from aliexpress or ebay :)"}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1502314859, "post_id": 45597871, "comment_id": 78161501, "body": "@KolesnichenkoDS <code>I&#39;m trying to code in Rust for STM32, that&#39;s why I have to write rather low-level code and initialization is a bit harder than in C with high-level STM32 libraries.</code> Very interesting theory. I for example only do the bare register programming with no libraries. Do you know more low level programming?"}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 0, "creation_date": 1502320770, "post_id": 45597871, "comment_id": 78163580, "body": "I think the OP is combining the two focusing on C and libraries as a set. I recommend learning to program the part directly in C a language well used for such a thing (with no libraries).  THEN once you know how to control the part, try to build a backend infrastructure (C and asm) to get a lesser used language for a target like this working."}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1502320889, "post_id": 45597871, "comment_id": 78163610, "body": "@PeterJ yep, generally that works  99.99999999 percent of the time but every so often you need the scope, i2c in particular more than SPI.  The logic analyzer cant show you who is driving the bus and when they took over (with a wired-or bus like i2c) where the scope can.  I was going to wait and see what the response was (I dont have a scope) then suggest a logic analyzer but you beat me to it...with out one or the other (or a chip simulator which who here has access to the  source code for this chip) you cant check if it is correctly initialized."}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "reply_to_user": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 0, "creation_date": 1502321728, "post_id": 45597871, "comment_id": 78163796, "body": "@old_timer yes but actually I2C probably every designed has used and programmed so many times and got enough experience so even multimeter is sufficient for debugging :). But seriously as I did not any analog designs for years (and to design analog parts of my devices I  hire someone as I newer used to be good in it) - I have turned on my scope last time maybe a year ago. But I use very often LA as I can record and decode longer transmissions - it helps me a lot especially for difficult to diagnose problems (like it works 10 minutes and dies and similar)"}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 0, "creation_date": 1502324490, "post_id": 45597871, "comment_id": 78164424, "body": "its more of a case of figuring out the peripheral&#39;s protocol or whatever that isnt working, you can see on the scope the small step in the ground when one device takes over from the other, subtle differences that a logic analyzer cannot see.  Most of the time sure you dont need this, usually when the docs are garbage and you are hacking your way through, or a board was built with the wrong value pull up or missing one or whatever and the scope tells you instantly (but an analyzer wouldnt).  for figuring out the peripheral in the mcu, analyzer is fine."}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "reply_to_user": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 0, "creation_date": 1502350824, "post_id": 45597871, "comment_id": 78173431, "body": "@old_timer my one takes those subtle changes as well into consideration :).  Discussion is pointless as the both are extremely useful devices and they should be in the designer drawer. If someone asks me &quot;how good oscilloscope should I buy (or LA) I always answer as good you can afford :)"}, {"owner": {"reputation": 500, "user_id": 4977168, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ab582c6c0a0524f7dfc3197f1e2c45b2?s=128&d=identicon&r=PG&f=1", "display_name": "KolesnichenkoDS", "link": "https://stackoverflow.com/users/4977168/kolesnichenkods"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1502479540, "post_id": 45597871, "comment_id": 78244474, "body": "@PeterJ I just meant that I cannot use higher-level abstractions, that C libraries provide :)"}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1502479692, "post_id": 45597871, "comment_id": 78244533, "body": "@KolesnichenkoDS  I do not know what you mean. EOD for me"}, {"owner": {"reputation": 500, "user_id": 4977168, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ab582c6c0a0524f7dfc3197f1e2c45b2?s=128&d=identicon&r=PG&f=1", "display_name": "KolesnichenkoDS", "link": "https://stackoverflow.com/users/4977168/kolesnichenkods"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1502479704, "post_id": 45597871, "comment_id": 78244537, "body": "@PeterJ and thanks for the advice, I&#39;ve decided to buy a logic analyzer. Maybe you&#39;ll move your comment to the answer?"}], "answers": [{"tags": [], "owner": {"reputation": 105, "user_id": 5400835, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-zKTVcHeDNCI/AAAAAAAAAAI/AAAAAAAAABE/aeNKd_LkDik/photo.jpg?sz=128", "display_name": "Bohdan Pakhaliuk", "link": "https://stackoverflow.com/users/5400835/bohdan-pakhaliuk"}, "is_accepted": false, "score": 0, "last_activity_date": 1502762958, "creation_date": 1502762958, "answer_id": 45685543, "question_id": 45597871, "link": "https://stackoverflow.com/questions/45597871/what-is-the-easiest-way-to-check-if-spi-is-correctly-initialized-on-stm32/45685543#45685543", "title": "What is the easiest way to check if SPI is correctly initialized on STM32?", "body": "<ul>\n<li>Use logic analyzer to see what is going on when you send your data.</li>\n<li>Test with simple 74hc595  serial-in parallel-out shift register. It has SPI input. You can put leds on outputs or just measure voltages to make sure that data is right.</li>\n</ul>\n"}], "owner": {"reputation": 500, "user_id": 4977168, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ab582c6c0a0524f7dfc3197f1e2c45b2?s=128&d=identicon&r=PG&f=1", "display_name": "KolesnichenkoDS", "link": "https://stackoverflow.com/users/4977168/kolesnichenkods"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 669, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1502762958, "creation_date": 1502302330, "question_id": 45597871, "link": "https://stackoverflow.com/questions/45597871/what-is-the-easiest-way-to-check-if-spi-is-correctly-initialized-on-stm32", "title": "What is the easiest way to check if SPI is correctly initialized on STM32?", "body": "<p>I have STM32F103C8 chip and a LED display that is connected via SPI1 (PA7-PA4) interface. I want to ensure that my initialization code is correct before starting to write the rest of the code. Is there a way to check if my initialization code is correct?</p>\n\n<p>P. S. I'm trying to code in Rust for STM32, that's why I have to write rather low-level code and initialization is a bit harder than in C with high-level STM32 libraries.</p>\n"}, {"tags": ["asynchronous", "rust", "rust-tokio"], "comments": [{"owner": {"reputation": 3212, "user_id": 2731452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xA89V.jpg?s=128&g=1", "display_name": "red75prime", "link": "https://stackoverflow.com/users/2731452/red75prime"}, "edited": false, "score": 1, "creation_date": 1502296653, "post_id": 45594885, "comment_id": 78151957, "body": "Try <code>.forward(ws_to_main.sink_map_err(|_| WebSocketError::NoDataAvailable))</code>  Does it work?"}, {"owner": {"reputation": 73, "user_id": 2418456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f914855558ee15a52fc11b1e322a0eb?s=128&d=identicon&r=PG", "display_name": "Tridius", "link": "https://stackoverflow.com/users/2418456/tridius"}, "reply_to_user": {"reputation": 3212, "user_id": 2731452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xA89V.jpg?s=128&g=1", "display_name": "red75prime", "link": "https://stackoverflow.com/users/2731452/red75prime"}, "edited": false, "score": 0, "creation_date": 1502299110, "post_id": 45594885, "comment_id": 78153317, "body": "That solved it! Thanks. I&#39;ll have to look more in to the sink methods"}], "answers": [{"tags": [], "owner": {"reputation": 821, "user_id": 667158, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17bca47a4961a24f82ef972aa9e1c986?s=128&d=identicon&r=PG", "display_name": "Ian Yang", "link": "https://stackoverflow.com/users/667158/ian-yang"}, "is_accepted": false, "score": 1, "last_activity_date": 1561862842, "creation_date": 1561862842, "answer_id": 56822082, "question_id": 45594885, "link": "https://stackoverflow.com/questions/45594885/forwarding-data-to-a-tokio-mpsc-channel-from-a-stream/56822082#56822082", "title": "Forwarding data to a Tokio mpsc channel from a stream", "body": "<p>A quick solution is converting the error type of the steam and sink to the same one:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>stream\n  .map_err(|err| eprintln!(\"stream error: {}\", err))\n  .forward(sink.sink_map_err(|err| eprintln!(\"sink error: {}\", err)))\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 2418456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f914855558ee15a52fc11b1e322a0eb?s=128&d=identicon&r=PG", "display_name": "Tridius", "link": "https://stackoverflow.com/users/2418456/tridius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1156, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1561862842, "creation_date": 1502292510, "last_edit_date": 1502316608, "question_id": 45594885, "link": "https://stackoverflow.com/questions/45594885/forwarding-data-to-a-tokio-mpsc-channel-from-a-stream", "title": "Forwarding data to a Tokio mpsc channel from a stream", "body": "<p>I am trying to create an async Rust client that connects to a WebSocket server on one end and a Bluetooth dongle on the other end. In between there will be some logic to filter messages.</p>\n\n<p>I am using <a href=\"https://github.com/cyderize/rust-websocket\" rel=\"nofollow noreferrer\">rust-websocket</a>'s async module for the WebSocket side.</p>\n\n<p>I would like to isolate the three components (websocket send/receive, bluetooth send/receive, message processing). In order to do this, I want to use a <code>futures::sync::mpsc</code> channel as a <code>Sink</code> in order to pass messages from the WebSocket receiver to the message processing portion of the loop. Below is a simplified portion of my code:</p>\n\n<pre><code>const CONNECTION: &amp;'static str = \"ws://127.0.0.1:4000/socket/websocket\";\n\nfn main() {\n    let mut core = Core::new().unwrap();\n\n    let (ws_send, ws_recv) = mpsc::channel(100);\n    let (ws_to_main, main_from_ws) = mpsc::channel(100);\n\n    let ws_future = ClientBuilder::new(CONNECTION)\n        .unwrap()\n        .add_protocol(\"rust-websocket\")\n        .async_connect_insecure(&amp;core.handle())\n        .and_then(|(duplex, _)| {\n            let (mut sink, stream) = duplex.split();\n\n            stream\n                .filter_map(|message| {\n                    println!(\"Received Message: {:?}\", message);\n                    match message {\n                        OwnedMessage::Close(e) =&gt; Some(OwnedMessage::Close(e)),\n                        OwnedMessage::Ping(d) =&gt; Some(OwnedMessage::Pong(d)),\n                        OwnedMessage::Text(msg) =&gt; Some(OwnedMessage::Text(msg)),\n                        _ =&gt; None,\n                    }\n                })\n                .forward(ws_to_main)\n        });\n    let result = core.run(ws_future).unwrap();\n}\n</code></pre>\n\n<p>When I run this code, however, I get several error messages which look like this:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: the trait bound `websocket::WebSocketError: std::convert::From&lt;futures::sync::mpsc::SendError&lt;websocket::OwnedMessage&gt;&gt;` is not satisfied\n   --&gt; src/main.rs:103:22\n    |\n103 |                     .forward(ws_to_main)\n    |                      ^^^^^^^ the trait `std::convert::From&lt;futures::sync::mpsc::SendError&lt;websocket::OwnedMessage&gt;&gt;` is not implemented for `websocket::WebSocketError`\n    |\n    = help: the following implementations were found:\n              &lt;websocket::WebSocketError as std::convert::From&lt;std::io::Error&gt;&gt;\n              &lt;websocket::WebSocketError as std::convert::From&lt;hyper::error::Error&gt;&gt;\n              &lt;websocket::WebSocketError as std::convert::From&lt;websocket::client::ParseError&gt;&gt;\n              &lt;websocket::WebSocketError as std::convert::From&lt;native_tls::Error&gt;&gt;\n            and 5 others\n</code></pre>\n\n<p>I've tried to hack it a bit with a <code>.map_err</code> which transforms the errors into a <code>SendError</code>, but the <code>SendError</code> struct is private.</p>\n"}, {"tags": ["winapi", "rust"], "comments": [{"owner": {"reputation": 3212, "user_id": 2731452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xA89V.jpg?s=128&g=1", "display_name": "red75prime", "link": "https://stackoverflow.com/users/2731452/red75prime"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1502290506, "post_id": 45594014, "comment_id": 78147715, "body": "@Boiethios, winapi-rs is a thin wrapper over windows API. It doesn&#39;t provide function for converting zero-terminated UTF-16 strings into Rust&#39;s <code>String</code>"}, {"owner": {"reputation": 69, "user_id": 7823040, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1305b7903c791700b152f7f20d02c60b?s=128&d=identicon&r=PG&f=1", "display_name": "Bor", "link": "https://stackoverflow.com/users/7823040/bor"}, "edited": false, "score": 0, "creation_date": 1502291089, "post_id": 45594014, "comment_id": 78148221, "body": "Problematic are 16-bit C-style strings"}, {"owner": {"reputation": 3212, "user_id": 2731452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xA89V.jpg?s=128&g=1", "display_name": "red75prime", "link": "https://stackoverflow.com/users/2731452/red75prime"}, "edited": false, "score": 0, "creation_date": 1502291352, "post_id": 45594014, "comment_id": 78148439, "body": "<code>#[cfg(windows)]     fn from_wide_string(s: &amp;[u16]) -&gt; String {         use std::ffi::OsString;         use std::os::windows::ffi::OsStringExt;         let slice = s.split(|&amp;v| v == 0).next().unwrap();         OsString::from_wide(slice).to_string_lossy().into()     }</code>"}, {"owner": {"reputation": 69, "user_id": 7823040, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1305b7903c791700b152f7f20d02c60b?s=128&d=identicon&r=PG&f=1", "display_name": "Bor", "link": "https://stackoverflow.com/users/7823040/bor"}, "reply_to_user": {"reputation": 3212, "user_id": 2731452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xA89V.jpg?s=128&g=1", "display_name": "red75prime", "link": "https://stackoverflow.com/users/2731452/red75prime"}, "edited": false, "score": 0, "creation_date": 1502291550, "post_id": 45594014, "comment_id": 78148567, "body": "let str = String::from_utf16_lossy(font_struct.lfFaceName) - is near ok, but expected type <code>&amp;[u16]</code>  found type <code>[u16; 32]</code>- problem is that it is not pointer but 32 word array"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1502291703, "post_id": 45594014, "comment_id": 78148663, "body": "Then you don&#39;t have a <code>WCHAR*</code>, you have a <code>[WCHAR; 32]</code>. Either way, just get a slice <code>let str = String::from_utf16_lossy(font_struct.lfFaceName.as_slice())</code>."}, {"owner": {"reputation": 69, "user_id": 7823040, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1305b7903c791700b152f7f20d02c60b?s=128&d=identicon&r=PG&f=1", "display_name": "Bor", "link": "https://stackoverflow.com/users/7823040/bor"}, "edited": false, "score": 0, "creation_date": 1502291762, "post_id": 45594014, "comment_id": 78148706, "body": "I add: let face_name_ptr = &amp;mut font_struct.lfFaceName as &amp;[u16];"}, {"owner": {"reputation": 3212, "user_id": 2731452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xA89V.jpg?s=128&g=1", "display_name": "red75prime", "link": "https://stackoverflow.com/users/2731452/red75prime"}, "edited": false, "score": 0, "creation_date": 1502291942, "post_id": 45594014, "comment_id": 78148868, "body": "<code>String::from_utf16_lossy</code> <a href=\"https://play.rust-lang.org/?gist=b9d606a23ad4ec9d6fda562ff5b30d4f&amp;version=stable\" rel=\"nofollow noreferrer\">doesn&#39;t work as expected for zero-terminated strings</a>"}, {"owner": {"reputation": 69, "user_id": 7823040, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1305b7903c791700b152f7f20d02c60b?s=128&d=identicon&r=PG&f=1", "display_name": "Bor", "link": "https://stackoverflow.com/users/7823040/bor"}, "edited": false, "score": 0, "creation_date": 1502291951, "post_id": 45594014, "comment_id": 78148879, "body": "Problem solved: two stages: 1)let face_name_ptr = &amp;mut font_struct.lfFaceName as &amp;[u16]; 2)red75prime&#39;s method"}, {"owner": {"reputation": 3212, "user_id": 2731452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xA89V.jpg?s=128&g=1", "display_name": "red75prime", "link": "https://stackoverflow.com/users/2731452/red75prime"}, "edited": false, "score": 0, "creation_date": 1502292109, "post_id": 45594014, "comment_id": 78149012, "body": "@Bor, <code>String::from_utf16_lossy(&amp;font_struct.lfFaceName)</code> will work, except for including all symbols past first 0."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 3212, "user_id": 2731452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xA89V.jpg?s=128&g=1", "display_name": "red75prime", "link": "https://stackoverflow.com/users/2731452/red75prime"}, "edited": false, "score": 0, "creation_date": 1502292211, "post_id": 45594014, "comment_id": 78149096, "body": "@red75prime I always hesitate when to introduce people to that. It&#39;s not obvious to newcomers how <code>Deref</code> coercions work and often makes things more confusing. However, <code>&amp;font_struct.lfFaceName</code> is far more idiomatic."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 3212, "user_id": 2731452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xA89V.jpg?s=128&g=1", "display_name": "red75prime", "link": "https://stackoverflow.com/users/2731452/red75prime"}, "edited": false, "score": 0, "creation_date": 1502292334, "post_id": 45594014, "comment_id": 78149193, "body": "@red75prime It depends on what you &quot;expect&quot; for UTF-16 ^_^. UTF-16 is allowed to have embedded NUL characters, therefore <b>I</b> expect that behavior."}, {"owner": {"reputation": 3212, "user_id": 2731452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xA89V.jpg?s=128&g=1", "display_name": "red75prime", "link": "https://stackoverflow.com/users/2731452/red75prime"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1502292589, "post_id": 45594014, "comment_id": 78149367, "body": "@Shepmaster, in the context of this question the string is zero-terminated UTF-16 as per <a href=\"https://msdn.microsoft.com/en-us/library/aa741231(v=vs.85).aspx\" rel=\"nofollow noreferrer\">LOGFONTW documentation</a>. Garbage after font name will be unexpected, I think."}], "owner": {"reputation": 69, "user_id": 7823040, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1305b7903c791700b152f7f20d02c60b?s=128&d=identicon&r=PG&f=1", "display_name": "Bor", "link": "https://stackoverflow.com/users/7823040/bor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 733, "favorite_count": 0, "closed_date": 1502291166, "answer_count": 0, "score": 2, "last_activity_date": 1502291379, "creation_date": 1502290125, "last_edit_date": 1502291379, "question_id": 45594014, "link": "https://stackoverflow.com/questions/45594014/how-can-i-convert-from-a-c-style-wchar-to-a-rust-string", "closed_reason": "Duplicate", "title": "How can I convert from a C-style WCHAR* to a Rust string?", "body": "<p>I want to print the <code>lfFaceName</code> field of the <code>LOGFONTW</code> struct using <code>println!</code>.</p>\n\n<p>How can I convert this C-style <code>WCHAR*</code> to a <code>Vec&lt;u16&gt;</code> and to a Rust string. There are answers for simpler questions using <code>*const u8</code>, but I have a <code>*const u16</code>.</p>\n"}, {"tags": ["rust"], "answers": [{"tags": [], "owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "is_accepted": true, "score": 15, "last_activity_date": 1572264125, "last_edit_date": 1572264125, "creation_date": 1502287576, "answer_id": 45593027, "question_id": 45593026, "link": "https://stackoverflow.com/questions/45593026/unrecognized-option-release-when-compiling-with-rustc-in-release-mode/45593027#45593027", "title": "&quot;Unrecognized option &#39;release&#39;&quot; when compiling with rustc in release mode", "body": "<p>You made a simple mistake: <strong>The <code>--release</code> flag is a flag for <code>cargo</code>. The easiest way you can turn on optimizations with <code>rustc</code> is using the <code>-O</code> flag.</strong> </p>\n\n<p>Examples:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>rustc -O foo.rs\nrustc -C opt-level=3 foo.rs\ncargo build --release\n</code></pre>\n\n<hr>\n\n<h3>A bit more detail:</h3>\n\n<p>You can compile your Rust program with various levels of optimization. <code>rustc -C help</code> says:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>-C opt-level=val     -- optimize with possible levels 0-3, s, or z\n</code></pre>\n\n<p>To have the most control, you should compile with <strong><code>rustc -C opt-level=3 foo.rs</code></strong> (or any other level). However, this isn't always necessary. Often, you can use <code>-O</code>; <code>rustc --help</code> says:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>-O                      Equivalent to -C opt-level=2\n</code></pre>\n\n<p>Most of the time <strong><code>rustc -O foo.rs</code></strong> is the right choice.</p>\n\n<p>Cargo, on the other hand, works a bit different; or at least the <code>--release</code> flag does. Cargo has different <em>profiles</em> which dictate how <code>cargo</code> invokes <code>rustc</code>. The most important ones are <code>dev</code> (<em>development</em>- or <em>debug</em>-mode) and <code>release</code>. The <code>--release</code> flag switches the default profile from <code>dev</code> to <code>release</code> (duh!). This potentially changes many flags of the <code>rustc</code> invocation. Most importantly, it changes the values for <code>opt-level</code> and <code>debuginfo</code>:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ rustc -C debuginfo=2 -C opt-level=0    # in `dev` profile/debug mode\n$ rustc -C debuginfo=0 -C opt-level=3    # in `release` profile\n</code></pre>\n\n<p>You can even change the settings for each profile in your <code>Cargo.toml</code>. You can find more information on profiles and on the default values used in <a href=\"http://doc.crates.io/manifest.html#the-profile-sections\" rel=\"noreferrer\">this Cargo documentation</a>.</p>\n"}], "owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3594, "favorite_count": 0, "accepted_answer_id": 45593027, "answer_count": 1, "score": 8, "last_activity_date": 1572264125, "creation_date": 1502287576, "last_edit_date": 1502287664, "question_id": 45593026, "link": "https://stackoverflow.com/questions/45593026/unrecognized-option-release-when-compiling-with-rustc-in-release-mode", "title": "&quot;Unrecognized option &#39;release&#39;&quot; when compiling with rustc in release mode", "body": "<p>I have a simple <code>.rs</code> file and want to compile it using <code>rustc</code>. I always heard about how important it is to compile in release mode, because otherwise my Rust program will be slow.</p>\n\n<p>However, if I use the often quoted <code>--release</code> flag, it doesn't work. What is everyone talking about if the flag doesn't even exist?</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ rustc --release foo.rs\nerror: Unrecognized option: 'release'.\n</code></pre>\n"}, {"tags": ["assembly", "rust", "x86-64", "llvm-codegen"], "comments": [{"owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "edited": false, "score": 1, "creation_date": 1502269597, "post_id": 45586159, "comment_id": 78131260, "body": "A question asking something similar was <a href=\"https://stackoverflow.com/questions/45562164/why-does-this-code-generate-much-more-assembly-than-equivalent-c-clang/45562380\">recently asked</a>, but it was closed for good reasons. So this question attempts to be focused and serve as a canonical question for that topic; as suggested by others."}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 1, "creation_date": 1502271506, "post_id": 45586159, "comment_id": 78132625, "body": "Try compiling with <code>-fomit-frame-pointer</code>"}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1502279917, "post_id": 45586159, "comment_id": 78138754, "body": "Too bad LLVM is silly here.  <code>mov eax, edi</code> / <code>add al,al</code> would avoid a partial-register stall on Intel Core2/Nehalem (and it emits that even with <code>-C ar=core2</code>, which apparently is the rust equivalent of <a href=\"https://mail.mozilla.org/pipermail/rust-dev/2014-March/009148.html\" rel=\"nofollow noreferrer\"><code>clang -march=core2</code></a>.  And if Rust uses the same x86-64 System V ABI as C, narrow return values are allowed to leave garbage in the upper bytes, so <code>lea eax, [rdi+rdi]</code> would work."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1502280360, "post_id": 45586159, "comment_id": 78139095, "body": "Just tried the C++ equivalent, and gcc does what I was suggesting, but clang is still being silly: <a href=\"https://godbolt.org/g/jdGSBp\" rel=\"nofollow noreferrer\">godbolt.org/g/jdGSBp</a>.  (clang+llvm unsurprisingly makes the exact same asm as rust+llvm)"}], "answers": [{"comments": [{"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1502280115, "post_id": 45586160, "comment_id": 78138914, "body": "Does rust have its own debug-info format or something?  <code>clang</code> and <code>clang++</code> enable <code>-fomit-frame-pointer</code> by default, and can do so even with <code>-g</code> (debugging) enabled.  You can still back-trace in the debugger because the ABI requires stack-unwind info in a separate section of the ELF executable.  (Exceptions use it too, so even stripped binaries have unwind info in the <code>.eh_frame</code> section)"}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "reply_to_user": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1502280259, "post_id": 45586160, "comment_id": 78139022, "body": "@PeterCordes: Rust uses the platform&#39;s debug format, DWARF on unices, PDB on Windows, etc..."}, {"owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "reply_to_user": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1502282603, "post_id": 45586160, "comment_id": 78140994, "body": "@PeterCordes Yes, it shouldn&#39;t be necessary to keep frame pointers. <a href=\"https://github.com/rust-lang/rust/issues/11906\" rel=\"nofollow noreferrer\">This</a> is the most up-to-date tracking issue regarding this. But I guess the priority is fairly low, as it is a performance-problem and it only occurs in debug mode (which is already super slow most of the time)."}, {"owner": {"reputation": 240669, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 2, "creation_date": 1502282774, "post_id": 45586160, "comment_id": 78141129, "body": "Ok, that makes sense.  Just a not-yet-implemented compiler feature, not a design limitation."}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 0, "creation_date": 1502286732, "post_id": 45586160, "comment_id": 78144554, "body": "@LukasKalbertodt: It may be interesting to link the PR in the answer, just in case comments get cleaned-up."}, {"owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "reply_to_user": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 0, "creation_date": 1502287883, "post_id": 45586160, "comment_id": 78145508, "body": "@MatthieuM. Good idea. I added it!"}], "tags": [], "owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "is_accepted": true, "score": 21, "last_activity_date": 1502288330, "last_edit_date": 1502288330, "creation_date": 1502269444, "answer_id": 45586160, "question_id": 45586159, "link": "https://stackoverflow.com/questions/45586159/why-doesnt-the-rust-optimizer-remove-those-useless-instructions-tested-on-godb/45586160#45586160", "title": "Why doesn&#39;t the Rust optimizer remove those useless instructions (tested on Godbolt Compiler Explorer)?", "body": "<p>The short answer: <strong>Godbolt adds a <code>-C debuginfo=1</code> flag which forces the optimizer to keep all instructions managing the frame pointer</strong>. Rust removes those instructions too when compiling with optimization and without debug information.</p>\n\n<hr>\n\n<h3>What are those instructions doing?</h3>\n\n<p>These three instructions are part of the <a href=\"https://en.wikipedia.org/wiki/Function_prologue\" rel=\"noreferrer\">function prologue and epilogue</a>. In particular, here they manage the so called <a href=\"https://en.wikipedia.org/wiki/Call_stack#Stack_and_frame_pointers\" rel=\"noreferrer\"><em>frame pointer</em> or <em>base pointer</em> (<code>rbp</code> on x86_64)</a>. Note: don't confuse the <em>base pointer</em> with the <em>stack pointer</em> (<code>rsp</code> on x86_64)! The <em>base pointer</em> always points inside the current stack frame:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>                          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                         \n                          \u2502  function arguments  \u2502                      \n                          \u2502         ...          \u2502   \n                          \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524   \n                          \u2502    return address    \u2502   \n                          \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524   \n              [rbp] \u2500\u2500&gt;   \u2502       last rbp       \u2502   \n                          \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524   \n                          \u2502   local variables    \u2502   \n                          \u2502         ...          \u2502   \n                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \n</code></pre>\n\n<p>The interesting thing about the base pointer is that it points to a piece of memory in the stack which stores the last value of the <code>rbp</code>. This means that we can easily find out the base pointer of the previous stack frame (the one from the function that called \"us\"). </p>\n\n<p>Even better: all base pointers form something similar to a linked list! We can easily follow all <code>last rbp</code>s to walk up the stack. This means that at each point during program execution, we know exactly what functions called what other functions such that we end up \"here\".</p>\n\n<p>Let's review the instructions again:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>; We store the \"old\" rbp on the stack\npush    rbp\n\n; We update rbp to hold the new value\nmov     rbp, rsp\n\n; We undo what we've done: we remove the old rbp\n; from the stack and store it in the rbp register\npop     rbp\n</code></pre>\n\n<h3>What are those instructions good for?</h3>\n\n<p>The base pointer and its \"linked list\" property are hugely important for debugging and analyzing program behavior in general (e.g. profiling). Without the base pointer, it's way more difficult to generate a stack trace and to locate the function that is currently executed.</p>\n\n<p>Additionally, managing the frame pointer usually doesn't slow things down by a lot. </p>\n\n<h3>Why aren't they removed by the optimizer and how can I enforce it?</h3>\n\n<p>They usually would be, if <a href=\"https://github.com/mattgodbolt/compiler-explorer/blob/b6e9a4658bff8f4e0046ce7c004350015a8260d4/lib/compilers/rust.js#L31\" rel=\"noreferrer\">Godbolt didn't pass <code>-C debuginfo=1</code> to the compiler</a>. This instructs the compiler to keep all things related to frame pointer handling, because we need it for debugging. Note that frame pointers are not inherently required for debugging -- other kinds of debug info usually suffice. Frame pointers are kept when storing any kind of debug info because there are still a few minor issues related to removing frame pointers in Rust programs. This is being discussed in <a href=\"https://github.com/rust-lang/rust/issues/11906\" rel=\"noreferrer\">this GitHub tracking issue</a>.   </p>\n\n<p>You can \"undo\" it by just <a href=\"https://godbolt.org/g/XtuR4W\" rel=\"noreferrer\"><strong>adding the flag <code>-C debuginfo=0</code></strong> yourself</a>. This results in exactly the same output as the C++ version:</p>\n\n<pre><code>example::double:\n    add     dil, dil\n    mov     eax, edi\n    ret\n</code></pre>\n\n<p>You can also test it locally by executing:</p>\n\n<pre><code>$ rustc -O --crate-type=lib --emit asm -C \"llvm-args=-x86-asm-syntax=intel\" example.rs\n</code></pre>\n\n<p>Compiling with optimizations (<code>-O</code>) automatically removes the <code>rbp</code> handling if you don't explicitly turn on debug information.</p>\n"}], "owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1005, "favorite_count": 0, "accepted_answer_id": 45586160, "answer_count": 1, "score": 12, "last_activity_date": 1564857418, "creation_date": 1502269444, "last_edit_date": 1564857418, "question_id": 45586159, "link": "https://stackoverflow.com/questions/45586159/why-doesnt-the-rust-optimizer-remove-those-useless-instructions-tested-on-godb", "title": "Why doesn&#39;t the Rust optimizer remove those useless instructions (tested on Godbolt Compiler Explorer)?", "body": "<p>I wanted to take a look at the assembly output for a tiny Rust function:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub fn double(n: u8) -&gt; u8 {\n    n + n\n}\n</code></pre>\n\n<p>I used the <a href=\"https://godbolt.org/g/XJhjcB\" rel=\"noreferrer\">Godbolt Compiler Explorer</a> to generate and view the assembly (with the <code>-O</code> flag, of course). It shows this output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>example::double:\n    push    rbp\n    mov     rbp, rsp\n    add     dil, dil\n    mov     eax, edi\n    pop     rbp\n    ret\n</code></pre>\n\n<p>Now I'm a bit confused, as there are a few instructions that doesn't seem to do anything useful: <code>push rbp</code>, <code>mov rbp, rsp</code> and <code>pop rbp</code>. From what I understand, I would think that executing these three instructions alone doesn't have any side effects. <strong>So why doesn't the Rust optimizer remove those useless instructions?</strong></p>\n\n<hr>\n\n<p>For comparisons, I also tested <a href=\"https://godbolt.org/g/dk9PSL\" rel=\"noreferrer\">a C++ version</a>:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>unsigned char doubleN(unsigned char n) {\n    return n + n;\n}\n</code></pre>\n\n<p>Assembly output (with <code>-O</code> flag):</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>doubleN(unsigned char): # @doubleN(unsigned char)\n    add dil, dil\n    mov eax, edi\n    ret\n</code></pre>\n\n<p>And in fact, here those \"useless\" instructions from above are missing, as I would expect from an optimized output.</p>\n"}, {"tags": ["rust", "rust-result"], "comments": [{"owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 4, "creation_date": 1502261602, "post_id": 45583246, "comment_id": 78125945, "body": "You&#39;ll need to clarify this question. Nothing in here involves printing. A Result is just a normal datatype. Is the question how make Rust print an error based on the return type of <code>get_result</code>, or is it more about how to fix the type error? Currently you just have mismatched types and it isn&#39;t clear why you want to use <code>std::io::Error</code> to begin with if you have a string error."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 3, "creation_date": 1502264078, "post_id": 45583246, "comment_id": 78127574, "body": "The compiler and the code are clear. You must put a <code>std::io::Error</code> and you put a <code>String</code>. What is your question?"}], "answers": [{"tags": [], "owner": {"reputation": 1339, "user_id": 682485, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ea1e106f2d083f0624c0c4f48ae1c18b?s=128&d=identicon&r=PG", "display_name": "Malice", "link": "https://stackoverflow.com/users/682485/malice"}, "is_accepted": false, "score": 5, "last_activity_date": 1502266317, "creation_date": 1502266317, "answer_id": 45585113, "question_id": 45583246, "link": "https://stackoverflow.com/questions/45583246/rust-returns-a-result-error-from-fn-mismatched-types/45585113#45585113", "title": "Rust returns a result error from fn: mismatched types", "body": "<p>You might want to do something like this, if I get it right...</p>\n\n<pre><code>fn get_result() -&gt; Result&lt;String, String&gt; {\n   // Ok(String::from(\"foo\")) &lt;- works fine\n   Result::Err(String::from(\"Error\"))\n}\n\nfn main(){\n    match get_result(){\n        Ok(s) =&gt; println!(\"{}\",s),\n        Err(s) =&gt; println!(\"{}\",s)\n    };\n}\n</code></pre>\n\n<p>I wouldn't recommend doing this though.</p>\n"}, {"tags": [], "owner": {"reputation": 211, "user_id": 3324584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/513bd5a12e7f8383e8af652dd3a3114d?s=128&d=identicon&r=PG&f=1", "display_name": "Ki Chjang", "link": "https://stackoverflow.com/users/3324584/ki-chjang"}, "is_accepted": true, "score": 10, "last_activity_date": 1502787123, "last_edit_date": 1502787123, "creation_date": 1502786781, "answer_id": 45689488, "question_id": 45583246, "link": "https://stackoverflow.com/questions/45583246/rust-returns-a-result-error-from-fn-mismatched-types/45689488#45689488", "title": "Rust returns a result error from fn: mismatched types", "body": "<p>The error message is quite clear. Your return type for <code>get_result</code> is <code>Result&lt;String, std::io::Error&gt;</code>, meaning that in the <code>Result::Ok</code> case, the inner value of the <code>Ok</code> variant is of type <code>String</code>, whereas in the <code>Result::Err</code> case, the inner value of the <code>Err</code> variant is of type <code>std::io::Error</code>.</p>\n\n<p>Your code attempted to create an <code>Err</code> variant with an inner value of type <code>String</code>, and the compiler rightfully complains about a type mismatch. To create a new <code>std::io::Error</code>, you can use the <a href=\"https://doc.rust-lang.org/std/io/struct.Error.html#method.new\" rel=\"noreferrer\"><code>new</code> method on <code>std::io::Error</code></a>. Here's an example of your code using the correct types:</p>\n\n<pre><code>fn get_result() -&gt; Result&lt;String, std::io::Error&gt; {\n    Err(std::io::Error::new(std::io::ErrorKind::Other, \"foo\"))\n}\n</code></pre>\n"}], "owner": {"reputation": 329, "user_id": 6557347, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/bf5777750fd1ea3661085e7764c9d582?s=128&d=identicon&r=PG&f=1", "display_name": "abdoe", "link": "https://stackoverflow.com/users/6557347/abdoe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6554, "favorite_count": 3, "accepted_answer_id": 45689488, "answer_count": 2, "score": 4, "last_activity_date": 1556786979, "creation_date": 1502260599, "last_edit_date": 1556786979, "question_id": 45583246, "link": "https://stackoverflow.com/questions/45583246/rust-returns-a-result-error-from-fn-mismatched-types", "title": "Rust returns a result error from fn: mismatched types", "body": "<p>I want this function to return an error result: </p>\n\n<pre><code>fn get_result() -&gt; Result&lt;String, std::io::Error&gt; {\n     // Ok(String::from(\"foo\")) &lt;- works fine\n     Result::Err(String::from(\"foo\"))\n}\n</code></pre>\n\n<p>Error Message</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0308]: mismatched types\n --&gt; src/main.rs:3:17\n  |\n3 |     Result::Err(String::from(\"foo\"))\n  |                 ^^^^^^^^^^^^^^^^^^^ expected struct `std::io::Error`, found struct `std::string::String`\n  |\n  = note: expected type `std::io::Error`\n             found type `std::string::String`\n</code></pre>\n\n<p>I'm confused how I can print out an error message when using the expected struct.</p>\n"}, {"tags": ["rust", "traits", "borrow-checker"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1502282607, "post_id": 45581398, "comment_id": 78140997, "body": "&quot;after accessing property&quot; \u2014 not just <i>accessing</i>, but keeping a reference to it. If <code>do_a</code> / <code>do_b</code> / <code>do_c</code> were to change <code>self.b</code>, that would violate Rust&#39;s memory safety rules because an immutable reference  would have changed."}], "answers": [{"tags": [], "owner": {"reputation": 1339, "user_id": 682485, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ea1e106f2d083f0624c0c4f48ae1c18b?s=128&d=identicon&r=PG", "display_name": "Malice", "link": "https://stackoverflow.com/users/682485/malice"}, "is_accepted": false, "score": 2, "last_activity_date": 1502282366, "last_edit_date": 1502282366, "creation_date": 1502252488, "answer_id": 45581645, "question_id": 45581398, "link": "https://stackoverflow.com/questions/45581398/calling-method-on-mut-self-after-accessing-property-in-rust/45581645#45581645", "title": "Calling method on &amp;mut self after accessing property in Rust", "body": "<ol>\n<li>You can unwrap the <code>Option(Baz)</code> within the match instead of using <code>if\nlet</code>.. </li>\n<li>Declare foo as mutable</li>\n</ol>\n\n<p>Here is the code ...</p>\n\n<pre><code>enum Baz {\n    A,\n    B,\n    C,\n}\nstruct Foo {\n    bar: Option&lt;Baz&gt;,\n}\n\nimpl Foo {\n    pub fn dostuff(&amp;mut self, fizz: i32) {\n        match self.bar {\n            Some(Baz::A) =&gt; self.do_a(fizz),\n            Some(Baz::B) =&gt; self.do_b(fizz + 2),\n            Some(Baz::C) =&gt; self.do_c(fizz + 1),\n            None =&gt; {},\n        }\n    }\n\n    pub fn do_a(&amp;mut self, f: i32) {\n        println!(\"A, with fizz {}\", f);\n    }\n    pub fn do_b(&amp;mut self, f: i32) {\n        println!(\"B, with fizz {}\", f);\n    }\n    pub fn do_c(&amp;mut self, f: i32) {\n        println!(\"C, with fizz {}\", f);\n    }\n}\n\nfn main() {\n    let mut foo = Foo { bar: Some(Baz::B) };\n    foo.dostuff(3);\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1220, "user_id": 2124732, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/cf9d2998c0d9cb26334028f72185fe38?s=128&d=identicon&r=PG", "display_name": "Christopher Dumas", "link": "https://stackoverflow.com/users/2124732/christopher-dumas"}, "edited": false, "score": 1, "creation_date": 1502286966, "post_id": 45585269, "comment_id": 78144744, "body": "I think I&#39;ll go with the third option! I tried cloning the option but for some reason it didn&#39;t help, and I also tried matching the option like you said and it didn&#39;t work, but based on what I know of the borrow checkers rules I think the last one will work. Thanks!"}, {"owner": {"reputation": 12555, "user_id": 1750757, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Zmc7D.jpg?s=128&g=1", "display_name": "Victor Polevoy", "link": "https://stackoverflow.com/users/1750757/victor-polevoy"}, "reply_to_user": {"reputation": 1220, "user_id": 2124732, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/cf9d2998c0d9cb26334028f72185fe38?s=128&d=identicon&r=PG", "display_name": "Christopher Dumas", "link": "https://stackoverflow.com/users/2124732/christopher-dumas"}, "edited": false, "score": 0, "creation_date": 1503323024, "post_id": 45585269, "comment_id": 78555208, "body": "@ChristopherDumas I have edited the code so that it does not use <code>Box</code> anymore but raw function pointers."}], "tags": [], "owner": {"reputation": 12555, "user_id": 1750757, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Zmc7D.jpg?s=128&g=1", "display_name": "Victor Polevoy", "link": "https://stackoverflow.com/users/1750757/victor-polevoy"}, "is_accepted": true, "score": 1, "last_activity_date": 1503323007, "last_edit_date": 1503323007, "creation_date": 1502266782, "answer_id": 45585269, "question_id": 45581398, "link": "https://stackoverflow.com/questions/45581398/calling-method-on-mut-self-after-accessing-property-in-rust/45585269#45585269", "title": "Calling method on &amp;mut self after accessing property in Rust", "body": "<p>If you care about the references, as far as I know, Rust's rules forbid you from having such code. You have to either:</p>\n\n<ol>\n<li><code>Copy</code> or <code>Clone</code> your <code>bar</code> object and unwrap as how as you want.</li>\n<li><p>Add some flag and make the code not have multiple references to the object. For example, add two variables which will tell you to what to do. You match your enum, set these variables and then you match these variables. This is less-useful than the first item here but this is a solution also.</p></li>\n<li><p>Be more <strong>functional</strong>-like:</p>\n\n<pre><code>enum Baz {\n    A,\n    B,\n    C,\n}\nstruct Foo {\n    bar: Option&lt;Baz&gt;,\n}\n\nimpl Foo {\n    pub fn dostuff(&amp;mut self, fizz: i32) {\n        let (method, arg) = match self.bar {\n            Some(ref b) =&gt; {\n                match b {\n                    &amp;Baz::A =&gt; (Self::do_a as fn(&amp;mut Self, i32)&gt;, fizz),\n                    &amp;Baz::B =&gt; (Self::do_b as fn(&amp;mut Self, i32)&gt;, fizz + 2),\n                    &amp;Baz::C =&gt; (Self::do_c as fn(&amp;mut Self, i32)&gt;, fizz + 1),\n                }\n            },\n            None =&gt; return,\n        };\n        method(self, arg);\n    }\n\n    pub fn do_a(&amp;mut self, f: i32) {\n        println!(\"A, with fizz {}\", f);\n    }\n    pub fn do_b(&amp;mut self, f: i32) {\n        println!(\"B, with fizz {}\", f);\n    }\n    pub fn do_c(&amp;mut self, f: i32) {\n        println!(\"C, with fizz {}\", f);\n    }\n}\n\nfn main() {\n    let mut foo = Foo { bar: Some(Baz::A) };\n    foo.dostuff(3);\n}\n</code></pre>\n\n<p>By doing so you return a method which you wanna call with it's argument, so you just call what you need to. I am pretty sure this solution can be rewritten without using <code>Box</code> but just references to a method but I don't know how.</p></li>\n</ol>\n"}], "owner": {"reputation": 1220, "user_id": 2124732, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/cf9d2998c0d9cb26334028f72185fe38?s=128&d=identicon&r=PG", "display_name": "Christopher Dumas", "link": "https://stackoverflow.com/users/2124732/christopher-dumas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1341, "favorite_count": 0, "closed_date": 1502282320, "accepted_answer_id": 45585269, "answer_count": 2, "score": 1, "last_activity_date": 1503323007, "creation_date": 1502250651, "last_edit_date": 1502282213, "question_id": 45581398, "link": "https://stackoverflow.com/questions/45581398/calling-method-on-mut-self-after-accessing-property-in-rust", "closed_reason": "Duplicate", "title": "Calling method on &amp;mut self after accessing property in Rust", "body": "<p>I need to match on an optional value that is on <code>self</code>, from a method, and based on that match, call a method on <code>self</code> that takes <code>self</code> mutably. I'm trying to do a pretty high-performance game, so as much as I'd like to dispense with mutability, I can't in this situation: the methods really do need to access the struct mutably, and they really do need to be dispatched based on the structs properties. Here is an MVCE:</p>\n\n<pre><code>enum Baz {\n    A,\n    B,\n    C,\n}\nstruct Foo {\n    bar: Option&lt;Baz&gt;,\n}\n\nimpl Foo {\n    pub fn dostuff(&amp;mut self, fizz: i32) {\n        if let Some(ref b) = self.bar {\n            match b {\n                &amp;Baz::A =&gt; self.do_a(fizz),\n                &amp;Baz::B =&gt; self.do_b(fizz + 2),\n                &amp;Baz::C =&gt; self.do_c(fizz + 1),\n            }\n        }\n    }\n\n    pub fn do_a(&amp;mut self, f: i32) {\n        println!(\"A, with fizz {}\", f);\n    }\n    pub fn do_b(&amp;mut self, f: i32) {\n        println!(\"B, with fizz {}\", f);\n    }\n    pub fn do_c(&amp;mut self, f: i32) {\n        println!(\"C, with fizz {}\", f);\n    }\n}\n\nfn main() {\n    let foo = Foo { bar: Some(Baz::A) };\n    foo.dostuff(3);\n}\n</code></pre>\n\n<p>And here is <a href=\"https://play.rust-lang.org/?gist=16c6a2bec0cee3a1a92c6df0ea840c8d&amp;version=undefined\" rel=\"nofollow noreferrer\">the playground</a>.</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0502]: cannot borrow `*self` as mutable because `self.bar.0` is also borrowed as immutable\n  --&gt; src/main.rs:14:28\n   |\n12 |         if let Some(ref b) = self.bar {\n   |                     ----- immutable borrow occurs here\n13 |             match b {\n14 |                 &amp;Baz::A =&gt; self.do_a(fizz),\n   |                            ^^^^ mutable borrow occurs here\n...\n18 |         }\n   |         - immutable borrow ends here\n</code></pre>\n\n<p>I thought I'd made my peace with the borrow checker, but apparently not: I have no idea how to fix this, although I do know why this is happening. I would appreciate it if somebody explained how to avoid this in the future.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 1339, "user_id": 682485, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ea1e106f2d083f0624c0c4f48ae1c18b?s=128&d=identicon&r=PG", "display_name": "Malice", "link": "https://stackoverflow.com/users/682485/malice"}, "edited": false, "score": 0, "creation_date": 1502253041, "post_id": 45581356, "comment_id": 78122626, "body": "You will probably want to initiate it as <code>let scene_manager = SceneManager::new(Sample{running:false});</code>. Here Scene is the <code>name</code> for a trait, But new function accepts a value that is of type <code>Scena</code>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1502282864, "post_id": 45581356, "comment_id": 78141205, "body": "What did you expect <code>SceneManager::new(Scene)</code> to <b>do</b> in the first place?"}], "answers": [{"tags": [], "owner": {"reputation": 1339, "user_id": 682485, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ea1e106f2d083f0624c0c4f48ae1c18b?s=128&d=identicon&r=PG", "display_name": "Malice", "link": "https://stackoverflow.com/users/682485/malice"}, "is_accepted": true, "score": 3, "last_activity_date": 1502282056, "last_edit_date": 1502282056, "creation_date": 1502253699, "answer_id": 45581814, "question_id": 45581356, "link": "https://stackoverflow.com/questions/45581356/what-does-expected-value-found-trait-mean/45581814#45581814", "title": "What does &quot;expected value, found trait&quot; mean?", "body": "<p>Here <code>Scene</code> is the name for a trait, but <code>SceneManager::new</code> accepts a value of type <code>Scene</code>. You will probably want to do this </p>\n\n<pre><code>let scene_manager = SceneManager::new(Sample { running: false }); \n</code></pre>\n"}], "owner": {"reputation": 9945, "user_id": 1270259, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f8493a9385dae9f438379050d76ac2bf?s=128&d=identicon&r=PG", "display_name": "TheWebs", "link": "https://stackoverflow.com/users/1270259/thewebs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1385, "favorite_count": 0, "accepted_answer_id": 45581814, "answer_count": 1, "score": 0, "last_activity_date": 1502282056, "creation_date": 1502250289, "last_edit_date": 1502281977, "question_id": 45581356, "link": "https://stackoverflow.com/questions/45581356/what-does-expected-value-found-trait-mean", "title": "What does &quot;expected value, found trait&quot; mean?", "body": "<p>I am trying to build a scene manager that lets you push scenes onto a stack. When each scene is popped off the stack, it is run until stopped and then we repeat. </p>\n\n<p>An example is a menu in a game; which is one scene. When you close it, the game map behind it is another scene.</p>\n\n<pre><code>pub trait Scene {\n    fn start(&amp;mut self) {}\n    fn update(&amp;mut self) {}\n    fn stop(&amp;mut self) {}\n    fn is_active(&amp;self) -&gt; bool {\n        return false;\n    }\n}\n\npub struct SceneManager {\n    scenes: Vec&lt;Box&lt;Scene&gt;&gt;,\n}\n\nimpl SceneManager {\n    fn new&lt;T&gt;(scene: T) -&gt; SceneManager\n    where\n        T: Scene + 'static,\n    {\n        SceneManager { scenes: vec![Box::new(scene)] }\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    struct Sample {\n        running: bool,\n    }\n\n    impl Scene for Sample {\n        fn start(&amp;mut self) {\n            self.running = true;\n        }\n\n        fn update(&amp;mut self) {\n            if self.running {\n                self.stop()\n            }\n        }\n\n        fn stop(&amp;mut self) {\n            self.running = false;\n        }\n\n        fn is_active(&amp;self) -&gt; bool {\n            self.running\n        }\n    }\n\n    #[test]\n    fn test_is_running() {\n        let scene_manager = SceneManager::new(Scene);\n    }\n}\n</code></pre>\n\n<p>The <code>Scene</code> trait is implemented for some structure that contains some way to tell if that scene is running or not. In this case, a structure called <code>Sample</code>.</p>\n\n<p>You implement the <code>Scene</code> for <code>Sample</code> and then push that scene to the scene manager).</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0423]: expected value, found trait `Scene`\n  --&gt; src/engine/scene.rs:48:47\n   |\n48 |         let scene_manager = SceneManager::new(Scene);\n   |                                               ^^^^^ not a value\n</code></pre>\n\n<p>Not exactly sure what to do at this point. How do I get my scene on to the \"stack\" of scenes? I implemented the <code>new</code> function of <code>SceneManager</code> to take a type where the type matches a <code>Scene</code> definition (if I understood that correctly). This alleviates me of having to specify a specific size and thus allowing me to push it to the heap instead of the stack.</p>\n\n<p>What am I doing wrong and how do I alleviate the problem at hand and what does this even mean?</p>\n"}, {"tags": ["rust"], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 5, "last_activity_date": 1563291098, "last_edit_date": 1563291098, "creation_date": 1502245521, "answer_id": 45580710, "question_id": 45580658, "link": "https://stackoverflow.com/questions/45580658/how-do-i-explicitly-call-a-method-on-a-slice-without-using-a-typedef/45580710#45580710", "title": "How do I explicitly call a method on a slice without using a typedef?", "body": "<p>Use the <a href=\"https://doc.rust-lang.org/stable/book/ch19-03-advanced-traits.html#fully-qualified-syntax-for-disambiguation-calling-methods-with-the-same-name\" rel=\"nofollow noreferrer\">Fully Qualified Syntax</a>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>&lt;&amp;[i32]&gt;::say_hi(1);\n</code></pre>\n\n<hr>\n\n<p>This is <strong>not</strong> a method, by the way. A method takes <code>self</code> in some form. This is just an <em>associated function</em>. If it <em>was</em> a method, you could just call it like any other method:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>trait Foo&lt;T&gt; {\n    fn say_hi(&amp;self, x: T);\n}\n\nimpl Foo&lt;i32&gt; for [i32] {\n    fn say_hi(&amp;self, x: i32) {}\n}\n\nfn main() {\n    let arr = [1, 2, 3];\n    &lt;[i32]&gt;::say_hi(&amp;arr, 1);\n    arr.say_hi(1);\n}\n</code></pre>\n"}], "owner": {"reputation": 5913, "user_id": 1244932, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d2c608e688b798896e8b516855fc1ab1?s=128&d=identicon&r=PG", "display_name": "user1244932", "link": "https://stackoverflow.com/users/1244932/user1244932"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 45580710, "answer_count": 1, "score": 1, "last_activity_date": 1563291098, "creation_date": 1502245027, "last_edit_date": 1502245643, "question_id": 45580658, "link": "https://stackoverflow.com/questions/45580658/how-do-i-explicitly-call-a-method-on-a-slice-without-using-a-typedef", "title": "How do I explicitly call a method on a slice without using a typedef?", "body": "<p>I want to call a method that is implemented for the type <code>&amp;[i32]</code>. I can do it via type alias as shown on line marked <strong>1</strong>, but is it possible without introducing a type alias every time?</p>\n\n<pre><code>trait Foo&lt;T&gt; {\n    fn say_hi(x: T);\n}\n\nimpl&lt;'a&gt; Foo&lt;i32&gt; for &amp;'a [i32] {\n    fn say_hi(x: i32) {}\n}\n\ntype Array&lt;'a&gt; = &amp;'a [i32];\n\nfn main() {\n    let arr = [1, 2, 3];\n    Array::say_hi(1);//line 1\n    &amp;[i32]::say_hi(1);//line 2\n}\n</code></pre>\n\n<p>The line marked <strong>2</strong> produces an error message:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error: expected one of `.`, `;`, `?`, `}`, or an operator, found `::`\n  --&gt; /home/xxx/.emacs.d/rust-playground/at-2017-08-09-051114/snippet.rs:21:11\n   |\n21 |     &amp;[i32]::say_hi(1);\n   |           ^^ expected one of `.`, `;`, `?`, `}`, or an operator here\n\nerror[E0423]: expected value, found builtin type `i32`\n  --&gt; /home/xxx/.emacs.d/rust-playground/at-2017-08-09-051114/snippet.rs:21:7\n   |\n21 |     &amp;[i32]::say_hi(1);\n   |       ^^^ not a value\n</code></pre>\n\n<p>Is it possible to modify the line marked <strong>2</strong> to not have a compilation error?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 22795, "user_id": 486057, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a9fd749502d6cb012df9425b028cea32?s=128&d=identicon&r=PG", "display_name": "Rogach", "link": "https://stackoverflow.com/users/486057/rogach"}, "edited": false, "score": 1, "creation_date": 1502226566, "post_id": 45577809, "comment_id": 78115555, "body": "Inserting <code>cities_perm.sort();</code> right after <code>let mut cities_perm</code> fixes the problem, so maybe there is some issue with <code>permutohedron</code> crate?"}, {"owner": {"reputation": 3152, "user_id": 1525759, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/LHtNL.jpg?s=128&g=1", "display_name": "Addison", "link": "https://stackoverflow.com/users/1525759/addison"}, "reply_to_user": {"reputation": 22795, "user_id": 486057, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a9fd749502d6cb012df9425b028cea32?s=128&d=identicon&r=PG", "display_name": "Rogach", "link": "https://stackoverflow.com/users/486057/rogach"}, "edited": false, "score": 0, "creation_date": 1502227227, "post_id": 45577809, "comment_id": 78115886, "body": "Thank you! After looking at the <code>permutohedron</code> docs, it suggests that the order of the slice passed matters, although it&#39;s not explicitly stated. And since <code>HashMap::values</code> returns values in a random order, it makes since that it&#39;d work sometimes and not others."}, {"owner": {"reputation": 22795, "user_id": 486057, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a9fd749502d6cb012df9425b028cea32?s=128&d=identicon&r=PG", "display_name": "Rogach", "link": "https://stackoverflow.com/users/486057/rogach"}, "edited": false, "score": 0, "creation_date": 1502227285, "post_id": 45577809, "comment_id": 78115914, "body": "Great that you solved the issue!"}, {"owner": {"reputation": 22795, "user_id": 486057, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a9fd749502d6cb012df9425b028cea32?s=128&d=identicon&r=PG", "display_name": "Rogach", "link": "https://stackoverflow.com/users/486057/rogach"}, "edited": false, "score": 1, "creation_date": 1502227427, "post_id": 45577809, "comment_id": 78115977, "body": "Some offtopic nitpicking, if I may - don&#39;t overuse abstractions, they make stuff harder to read. For example, <code>if dist &lt; min_path { min_path = dist; }</code> is much easier to read than <code>min_path = Some(min_path.map_or(dist, |v| *[v, dist].iter().min().unwrap()));</code>."}, {"owner": {"reputation": 22795, "user_id": 486057, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a9fd749502d6cb012df9425b028cea32?s=128&d=identicon&r=PG", "display_name": "Rogach", "link": "https://stackoverflow.com/users/486057/rogach"}, "edited": false, "score": 0, "creation_date": 1502227905, "post_id": 45577809, "comment_id": 78116180, "body": "I used <code>std::i64::MAX</code>. I agree that in some situations Option approach may be nicer - for example, it may automatically handle the case with empty array - but in some other situations it may be more readable to use simpler solution. And I&#39;m not sure that Rust compiler (as great as it is) will be able to optimize such code with iterators and options and stuff into simple comparison."}, {"owner": {"reputation": 3152, "user_id": 1525759, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/LHtNL.jpg?s=128&g=1", "display_name": "Addison", "link": "https://stackoverflow.com/users/1525759/addison"}, "reply_to_user": {"reputation": 22795, "user_id": 486057, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a9fd749502d6cb012df9425b028cea32?s=128&d=identicon&r=PG", "display_name": "Rogach", "link": "https://stackoverflow.com/users/486057/rogach"}, "edited": false, "score": 0, "creation_date": 1502228032, "post_id": 45577809, "comment_id": 78116237, "body": "Yeah, <code>std::i64::MAX</code> doesn&#39;t look nearly as bad. Thank you"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1502228536, "post_id": 45577809, "comment_id": 78116484, "body": "At that point <code>min_path = std::cmp::min(min_path, dist)</code> is clearer. <code>min_path = Some(min_path.map_or(dist, |v| min(v, dist)))</code> isn&#39;t bad either."}, {"owner": {"reputation": 22795, "user_id": 486057, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a9fd749502d6cb012df9425b028cea32?s=128&d=identicon&r=PG", "display_name": "Rogach", "link": "https://stackoverflow.com/users/486057/rogach"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1502229101, "post_id": 45577809, "comment_id": 78116743, "body": "Yes, <code>std::cmp::min</code> makes everything much better. My main gripe here was <code>[].iter().min().unwrap()</code>. @Shepmaster, you are obviously an expert, can you tell - will rust compiler be able replace that <code>[].iter().min()</code> with simple comparison without all those wrappers?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 22795, "user_id": 486057, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a9fd749502d6cb012df9425b028cea32?s=128&d=identicon&r=PG", "display_name": "Rogach", "link": "https://stackoverflow.com/users/486057/rogach"}, "edited": false, "score": 1, "creation_date": 1502233395, "post_id": 45577809, "comment_id": 78118108, "body": "@Rogach not that <i>exact</i> one, but <a href=\"https://play.integer32.com/?gist=5f2b89ea14262c5615ba9a4b13cd5da9&amp;version=stable\" rel=\"nofollow noreferrer\">one that does the same thing is the same number of instructions</a>"}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 3, "creation_date": 1502228746, "post_id": 45578214, "comment_id": 78116586, "body": "A <code>BTreeMap</code> is implicitly ordered and an easier change."}], "tags": [], "owner": {"reputation": 22795, "user_id": 486057, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a9fd749502d6cb012df9425b028cea32?s=128&d=identicon&r=PG", "display_name": "Rogach", "link": "https://stackoverflow.com/users/486057/rogach"}, "is_accepted": true, "score": 4, "last_activity_date": 1502228721, "last_edit_date": 1502228721, "creation_date": 1502227215, "answer_id": 45578214, "question_id": 45577809, "link": "https://stackoverflow.com/questions/45577809/rust-program-occasionally-gives-inconsistent-results/45578214#45578214", "title": "Rust program occasionally gives inconsistent results", "body": "<p>The problem is due to the fact that calling <code>next_permutation</code> gives you the next \"ordered permutation\" (<a href=\"https://docs.rs/permutohedron/0.2.2/permutohedron/trait.LexicalPermutation.html#tymethod.next_permutation\" rel=\"nofollow noreferrer\">link to the docs</a>).</p>\n\n<p>The caveat here is that you are not iterating permutations that are lexicaly ordered before the input slice - for example, if you started with this path:</p>\n\n<pre><code>[\"Norrath\", \"Faerun\", \"Tristram\", \"Tambi\", \"Straylight\", \"Snowdin\", \"Arbre\", \"AlphaCentauri\"]\n</code></pre>\n\n<p>You will never arrive to this path:</p>\n\n<pre><code>[\"Arbre\", \"Snowdin\", \"Norrath\", \"Faerun\", \"Tambi\", \"Tristram\", \"AlphaCentauri\", \"Straylight\"]\n</code></pre>\n\n<p>And since <code>HashMap</code> does not guarantee keys or values ordering, <code>cities_perm</code> ordering is different on each run, thus you iterate different subsets of all possible permutations and get different results.</p>\n\n<p>One solution may be to sort the cities before starting permutations:</p>\n\n<pre><code>cities_perm.sort();\n</code></pre>\n"}], "owner": {"reputation": 3152, "user_id": 1525759, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/LHtNL.jpg?s=128&g=1", "display_name": "Addison", "link": "https://stackoverflow.com/users/1525759/addison"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 45578214, "answer_count": 1, "score": 3, "last_activity_date": 1502228721, "creation_date": 1502225432, "last_edit_date": 1502226319, "question_id": 45577809, "link": "https://stackoverflow.com/questions/45577809/rust-program-occasionally-gives-inconsistent-results", "title": "Rust program occasionally gives inconsistent results", "body": "<p>I am working on part 1 of day 9 of the <a href=\"http://adventofcode.com/2015/day/9\" rel=\"nofollow noreferrer\">Advent of Code</a> in Rust and ran into a strange problem. I wrote the following code, which works usually, but about 10% of the time it gives the wrong answer.</p>\n\n<pre><code>extern crate permutohedron;\n\nuse std::fs::File;\nuse std::io::{BufRead, BufReader};\nuse std::collections::HashMap;\nuse std::rc::Rc;\n\nuse permutohedron::LexicalPermutation;\n\nfn get_distance(cities: &amp;[Rc&lt;String&gt;], paths: &amp;HashMap&lt;(Rc&lt;String&gt;, Rc&lt;String&gt;), i64&gt;) -&gt; i64 {\n    cities.iter().fold((0, None), |(sum, last_city), city| {\n        (last_city.map_or(0, |last_city| {\n            sum + *paths.get(&amp;(last_city, city.clone())).unwrap()\n        }), Some(city.clone()) )\n    }).0\n}\n\nfn main() {\n\n    let file = File::open(\"input_9.txt\").unwrap();\n    let file = BufReader::new(file);\n\n    let mut paths = HashMap::new();\n    let mut cities = HashMap::new();\n\n    for line in file.lines() {\n        let line = line.unwrap();\n        let mut words = line.split(' ');\n        let from = words.nth(0).unwrap();\n        let to = words.nth(1).unwrap();\n\n        if !cities.contains_key(from) {\n            cities.insert(from.to_owned(), Rc::new(from.to_owned()));\n        }\n        if !cities.contains_key(to) {\n            cities.insert(to.to_owned(), Rc::new(to.to_owned()));\n        }\n\n        let from = cities.get(from).unwrap();\n        let to = cities.get(to).unwrap();\n\n        let dist = words.nth(1).unwrap().parse::&lt;i64&gt;().unwrap();\n        paths.insert((from.clone(), to.clone()), dist);\n        paths.insert((to.clone(), from.clone()), dist);\n    }\n\n    let mut cities_perm: Vec&lt;_&gt; = cities.values().map(|k| k.clone()).collect();\n\n    let mut min_path = None;\n    loop {\n        let dist = get_distance(&amp;cities_perm, &amp;paths);\n\n        min_path = Some(min_path.map_or(dist, |v|\n            *[v, dist].iter().min().unwrap()\n        ));\n\n        if !cities_perm.next_permutation() { break }\n    }\n\n    println!(\"{}\", min_path.unwrap());\n\n}\n</code></pre>\n\n<p>I am running it with <code>cargo run</code>, and never changing the file <code>input_9.txt</code>, so I see no reason this should ever give different answers. I also tried building it, then running the executable that it built directly, like <code>./target/debug/day_9</code>, and the same thing happens. I noticed it tends to give wrong results most often soon after building it, rather than later.</p>\n\n<p>Usually, I am getting <code>141</code>, which is correct. However it will sometimes print something like <code>210</code>, <code>204</code>, or <code>155</code>. Why would this be happening?</p>\n\n<p>Here's the input to the program in case it helps you: <a href=\"https://pastebin.com/XJzsMy5A\" rel=\"nofollow noreferrer\">https://pastebin.com/XJzsMy5A</a></p>\n"}, {"tags": ["logging", "rust", "rocksdb"], "comments": [{"owner": {"reputation": 22795, "user_id": 486057, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a9fd749502d6cb012df9425b028cea32?s=128&d=identicon&r=PG", "display_name": "Rogach", "link": "https://stackoverflow.com/users/486057/rogach"}, "edited": false, "score": 0, "creation_date": 1502228571, "post_id": 45572264, "comment_id": 78116504, "body": "Have you tried <code>info_log_level=FATAL_LEVEL</code>?"}], "owner": {"reputation": 8871, "user_id": 1260906, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/aPM5A.png?s=128&g=1", "display_name": "Afr", "link": "https://stackoverflow.com/users/1260906/afr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 983, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1504537706, "creation_date": 1502205772, "last_edit_date": 1592644375, "question_id": 45572264, "link": "https://stackoverflow.com/questions/45572264/how-to-disable-rocksdb-database-debug-logging", "title": "How to disable RocksDB database debug logging?", "body": "<p>RocksDB <a href=\"https://github.com/facebook/rocksdb/wiki/rocksdb-basics#database-debug-logs\" rel=\"nofollow noreferrer\">writes detailed database debug logs</a>:</p>\n<blockquote>\n<p><strong>Database Debug Logs</strong></p>\n<p>RocksDB writes detailed logs to a file named LOG*. These are mostly used for debugging and analyzing a running system. This LOG may be configured to roll at a specified periodicity.</p>\n</blockquote>\n<p>In my Rust application, which interfaces with RocksDB via the <code>rust-rocksdb</code> crate, I tried to set <a href=\"https://github.com/facebook/rocksdb/blob/bdc056f8aa21b3bdae5f91821b273d80627f8392/include/rocksdb/options.h#L530-L532\" rel=\"nofollow noreferrer\">keep_log_file_num</a> to <code>0</code>, via:</p>\n<pre><code>let mut opts = Options::new();\nopts.set_parsed_options(&quot;keep_log_file_num=0&quot;)?;\n</code></pre>\n<p>But this causes my application to abort with an out of range error.</p>\n<pre class=\"lang-none prettyprint-override\"><code>terminate called after throwing an instance of 'std::out_of_range'\n  what():  vector::_M_range_check: __n (which is 1) &gt;= this-&gt;size() (which is 1)\n\nThread 1 &quot;client&quot; received signal SIGABRT, Aborted.\n__GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:58\n58  ../sysdeps/unix/sysv/linux/raise.c: No such file or directory.\n(gdb) bt\n#0  __GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:58\n#1  0x00007ffff7a4737a in __GI_abort () at abort.c:89\n#2  0x00007ffff771956d in __gnu_cxx::__verbose_terminate_handler() () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#3  0x00007ffff7717316 in ?? () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#4  0x00007ffff7717361 in std::terminate() () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#5  0x00007ffff7717579 in __cxa_throw () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#6  0x00007ffff7741317 in std::__throw_out_of_range_fmt(char const*, ...) () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#7  0x0000555558a1ce9a in std::vector&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::allocator&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt; &gt;::_M_range_check (this=0x7ffffffe2420, __n=1)\n    at /usr/include/c++/6/bits/stl_vector.h:804\n#8  0x0000555558a11aef in std::vector&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, std::allocator&lt;std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt; &gt;::at (this=0x7ffffffe2420, __n=1)\n    at /usr/include/c++/6/bits/stl_vector.h:825\n#9  0x00005555589f1a2f in rocksdb::DBImpl::PurgeObsoleteFiles (this=0x7ffff5fabe00, state=..., schedule_only=false) at rocksdb/db/db_impl.cc:1094\n#10 0x00005555589f201a in rocksdb::DBImpl::DeleteObsoleteFiles (this=0x7ffff5fabe00) at rocksdb/db/db_impl.cc:1128\n#11 0x0000555558a0aad3 in rocksdb::DB::Open (db_options=..., dbname=&quot;/tmp/client-0002/chains/main/db/906a34e69aec8c0d/overlayrecent/db&quot;, column_families=std::vector of length 1, capacity 1 = {...}, handles=0x7ffffffe2e60, dbptr=0x7ffffffe3490)\n    at rocksdb/db/db_impl.cc:5771\n#12 0x0000555558a09e45 in rocksdb::DB::Open (options=..., dbname=&quot;/tmp/client-0002/chains/main/db/906a34e69aec8c0d/overlayrecent/db&quot;, dbptr=0x7ffffffe3490) at rocksdb/db/db_impl.cc:5662\n#13 0x00005555589d48ad in rocksdb_open (options=0x7ffff57ff800, name=0x7ffff5f086e0 &quot;/tmp/client-0002/chains/main/db/906a34e69aec8c0d/overlayrecent/db&quot;, errptr=0x7ffffffe38d8) at rocksdb/db/c.cc:408\n#14 0x00005555589ca4de in rocksdb::rocksdb::DB::open_cf (opts=0x7ffffffe3ea0, path=..., cfs=..., cf_opts=...) at /home/user/.cargo/git/checkouts/rust-rocksdb-9e499ea8a4c2fa74/4364cae/src/rocksdb.rs:317\n#15 0x000055555889b42c in ethcore_util::kvdb::Database::open (config=0x7ffffffe5700, path=...) at util/src/kvdb.rs:537\n#16 0x0000555557b8e288 in ethcore::service::ClientService::start (config=..., spec=0x7ffffffeb548, client_path=0x7ffff5e5bfc0, snapshot_path=0x7ffff5e5c6e0, ipc_path=0x7ffff5a307a0, miner=...) at ethcore/src/service.rs:91\n#17 0x000055555646d742 in client::run::execute (cmd=..., can_restart=false, logger=...) at client/run.rs:547\n#18 0x0000555556484ea6 in client::execute (command=..., can_restart=false) at client/main.rs:159\n#19 0x0000555556486720 in client::start (can_restart=false) at client/main.rs:185\n#20 0x0000555556487518 in client::main_direct (can_restart=false) at client/main.rs:286\n#21 0x0000555556488a71 in client::main () at client/main.rs:367\n</code></pre>\n<p>Setting it to <code>1</code> works fine, but I want to get rid of it completely.</p>\n<p>I <em>assume</em> setting the maximum log file number to <code>0</code> is not the way to go, but I'm running out of ideas. How do I disable RocksDB database debug logging? I want to gain control of that behavior.</p>\n"}, {"tags": ["rust"], "answers": [{"tags": [], "owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "is_accepted": true, "score": 19, "last_activity_date": 1502180817, "creation_date": 1502180817, "answer_id": 45563134, "question_id": 45563133, "link": "https://stackoverflow.com/questions/45563133/why-doesnt-the-godbolt-compiler-explorer-show-any-output-for-my-function-when-c/45563134#45563134", "title": "Why doesn&#39;t the Godbolt compiler explorer show any output for my function when compiled in release mode?", "body": "<p>Godbolt compiles your Rust code as a library crate by passing <code>--crate-type=lib</code> to the compiler. And code from a library is only useful if it's public. So in your case, your <code>add()</code> function is private and is removed from the compiler completely. The solution is rather simple:</p>\n\n<p><strong>Make your function public by adding <code>pub</code> to it.</strong> Now the compiler won't remove the function, since it is part of the public interface of your library. </p>\n"}], "owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4132, "favorite_count": 0, "accepted_answer_id": 45563134, "answer_count": 1, "score": 12, "last_activity_date": 1502197080, "creation_date": 1502180817, "last_edit_date": 1502197080, "question_id": 45563133, "link": "https://stackoverflow.com/questions/45563133/why-doesnt-the-godbolt-compiler-explorer-show-any-output-for-my-function-when-c", "title": "Why doesn&#39;t the Godbolt compiler explorer show any output for my function when compiled in release mode?", "body": "<p>I want to use <a href=\"https://rust.godbolt.org\" rel=\"noreferrer\">https://rust.godbolt.org</a> to see the assembly output of this function:</p>\n\n<pre><code>fn add(a: u8, b: u8) -&gt; u8 {\n    a + b\n}\n</code></pre>\n\n<p>Pasting this on the website works fine, but shows a lot of assembly. This is not unsurprising, given that <code>rustc</code> compiles my code in debug mode by default. When I compile in release mode <a href=\"https://godbolt.org/g/KMgj1y\" rel=\"noreferrer\">by passing <code>-O</code> to the compiler</a>, there is no output at all!</p>\n\n<p>What am I doing wrong? Why does the Rust compiler remove everything in release mode?</p>\n"}, {"tags": ["macros", "rust"], "comments": [{"owner": {"reputation": 12555, "user_id": 1750757, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Zmc7D.jpg?s=128&g=1", "display_name": "Victor Polevoy", "link": "https://stackoverflow.com/users/1750757/victor-polevoy"}, "edited": false, "score": 0, "creation_date": 1502190110, "post_id": 45562599, "comment_id": 78091821, "body": "Have you tried looking at my <a href=\"https://stackoverflow.com/questions/42484062/how-do-i-process-enum-struct-field-attributes-in-a-procedural-macro/42526546#42526546\">example</a>?"}, {"owner": {"reputation": 696, "user_id": 8159982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vhr5o.jpg?s=128&g=1", "display_name": "lncr", "link": "https://stackoverflow.com/users/8159982/lncr"}, "reply_to_user": {"reputation": 12555, "user_id": 1750757, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Zmc7D.jpg?s=128&g=1", "display_name": "Victor Polevoy", "link": "https://stackoverflow.com/users/1750757/victor-polevoy"}, "edited": false, "score": 0, "creation_date": 1502196274, "post_id": 45562599, "comment_id": 78096589, "body": "While I believe that a question formulated like this is easier to find and more concise and might prevent future duplicates of the same question, both questions most certainly require the same answer. I would love to  write a somewhat generic answer explaining what you can currently do with attributes and current limitations."}], "owner": {"reputation": 696, "user_id": 8159982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vhr5o.jpg?s=128&g=1", "display_name": "lncr", "link": "https://stackoverflow.com/users/8159982/lncr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 187, "favorite_count": 0, "closed_date": 1502195921, "answer_count": 0, "score": 2, "last_activity_date": 1502195938, "creation_date": 1502179287, "last_edit_date": 1502195938, "question_id": 45562599, "link": "https://stackoverflow.com/questions/45562599/how-to-access-custom-derive-attributes", "closed_reason": "Duplicate", "title": "How to access custom derive attributes?", "body": "<p>I recently started to experiment with procedural macros on stable. While I understood most parts fairly quickly I did not find a way to actually access custom attributes during my macro.\nThe only somewhat useful source I found was <a href=\"https://doc.rust-lang.org/stable/book/first-edition/procedural-macros.html\" rel=\"nofollow noreferrer\">this chapter of the Rust book</a>.</p>\n\n<p>I am currently stuck with:</p>\n\n<pre><code>#[proc_macro_derive(Foo, attributes(Boo, Goo))]\npub fn foo(input: TokenStream) -&gt; TokenStream {\n    // Construct a string representation of the type definition\n    let s = input.to_string();\n\n    // Parse the string representation\n    let ast = syn::parse_derive_input(&amp;s).unwrap();\n\n    // Build the impl\n    let gen = impl_object(&amp;ast);\n\n    // Return the generated impl\n    gen.parse().unwrap()\n}\n</code></pre>\n\n<p>and</p>\n\n<pre><code>#[derive(Foo)]\n#[Boo = true]\npub struct Ruu { /* .. */ }\n</code></pre>\n\n<p>How can I use my custom attributes inside of the macro?</p>\n"}, {"tags": ["optimization", "rust", "llvm-codegen"], "comments": [{"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 10, "creation_date": 1502178099, "post_id": 45562164, "comment_id": 78083412, "body": "Did you compile with <code>-O</code> (in release mode)?"}, {"owner": {"reputation": 3107, "user_id": 4131673, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/100000565112046/picture?type=large", "display_name": "jaskmar", "link": "https://stackoverflow.com/users/4131673/jaskmar"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1502178987, "post_id": 45562164, "comment_id": 78083981, "body": "@Boiethios Yes I did, but it removes the whole code (as unused). Making function <code>pub extern</code> works :)"}], "answers": [{"comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 1, "creation_date": 1502178595, "post_id": 45562321, "comment_id": 78083722, "body": "Oh so <code>-C</code> is how you pass <code>opt-level</code>. I tried <code>-O</code>, but that just removed <code>f1</code> completely."}, {"owner": {"reputation": 103812, "user_id": 320726, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/02041b18199678d1f02e6d5040dbb907?s=128&d=identicon&r=PG", "display_name": "6502", "link": "https://stackoverflow.com/users/320726/6502"}, "edited": false, "score": 1, "creation_date": 1502178670, "post_id": 45562321, "comment_id": 78083768, "body": "Still looks like there&#39;s a pointless stack frame created"}, {"owner": {"reputation": 3107, "user_id": 4131673, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/100000565112046/picture?type=large", "display_name": "jaskmar", "link": "https://stackoverflow.com/users/4131673/jaskmar"}, "edited": false, "score": 1, "creation_date": 1502179104, "post_id": 45562321, "comment_id": 78084060, "body": "Simple <code>-O</code> instead of <code>opt-level</code> also works but only if you make function <code>pub extern</code> :)"}], "tags": [], "owner": {"reputation": 3164, "user_id": 1245027, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6a25f5528a714a4df8d81b177ad2f8f5?s=128&d=identicon&r=PG", "display_name": "Scroog1", "link": "https://stackoverflow.com/users/1245027/scroog1"}, "is_accepted": false, "score": 8, "last_activity_date": 1502178859, "last_edit_date": 1502178859, "creation_date": 1502178473, "answer_id": 45562321, "question_id": 45562164, "link": "https://stackoverflow.com/questions/45562164/why-does-this-code-generate-much-more-assembly-than-equivalent-c-clang/45562321#45562321", "title": "Why does this code generate much more assembly than equivalent C++/Clang?", "body": "<p>Compiling with <code>-C opt-level=3</code> in godbolt gives:</p>\n\n<pre><code>example::f1:\n  push rbp\n  mov rbp, rsp\n  xor dil, 1\n  or dil, sil\n  mov eax, edi\n  pop rbp\n  ret\n</code></pre>\n\n<p>Which looks comparable to the C++ version. See <a href=\"https://stackoverflow.com/a/45562380/1245027\">Lukas Kalbertodt's answer</a> for more explanation.</p>\n\n<p>Note: I had to make the function <code>pub extern</code> to stop the compiler optimising it to nothing, as it is unused.</p>\n"}, {"comments": [{"owner": {"reputation": 3107, "user_id": 4131673, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/100000565112046/picture?type=large", "display_name": "jaskmar", "link": "https://stackoverflow.com/users/4131673/jaskmar"}, "edited": false, "score": 0, "creation_date": 1502352398, "post_id": 45562380, "comment_id": 78174419, "body": "Please stress the fact that you added <code>pub</code> to the function signature. Godbolt produces empty output without this."}, {"owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "reply_to_user": {"reputation": 3107, "user_id": 4131673, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/100000565112046/picture?type=large", "display_name": "jaskmar", "link": "https://stackoverflow.com/users/4131673/jaskmar"}, "edited": false, "score": 1, "creation_date": 1502353572, "post_id": 45562380, "comment_id": 78175166, "body": "@jaskmar There is <a href=\"https://stackoverflow.com/questions/45563133/why-doesnt-the-godbolt-compiler-explorer-show-any-output-for-my-function-when-c\">a dedicated question for this</a>."}, {"owner": {"reputation": 3107, "user_id": 4131673, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/100000565112046/picture?type=large", "display_name": "jaskmar", "link": "https://stackoverflow.com/users/4131673/jaskmar"}, "edited": false, "score": 0, "creation_date": 1502445059, "post_id": 45562380, "comment_id": 78223160, "body": "I mean the info for future readers of this post to prevent confusion. Thanks!"}], "tags": [], "owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "is_accepted": true, "score": 40, "last_activity_date": 1502353635, "last_edit_date": 1502353635, "creation_date": 1502178655, "answer_id": 45562380, "question_id": 45562164, "link": "https://stackoverflow.com/questions/45562164/why-does-this-code-generate-much-more-assembly-than-equivalent-c-clang/45562380#45562380", "title": "Why does this code generate much more assembly than equivalent C++/Clang?", "body": "<p>Compiling with the compiler flag <code>-O</code> (<a href=\"https://stackoverflow.com/questions/45563133/why-doesnt-the-godbolt-compiler-explorer-show-any-output-for-my-function-when-c\">and with an added <code>pub</code></a>), I get this output (<a href=\"https://godbolt.org/g/NriTWc\" rel=\"noreferrer\">Link to Godbolt</a>):</p>\n\n<pre><code>push    rbp\nmov     rbp, rsp\nxor     dil, 1\nor      dil, sil\nmov     eax, edi\npop     rbp\nret\n</code></pre>\n\n<p>A few things:</p>\n\n<ul>\n<li><p><strong>Why is it still longer than the C++ version?</strong></p>\n\n<p>The Rust version is exactly three instructions longer:</p>\n\n<pre><code>push    rbp\nmov     rbp, rsp\n[...]\npop     rbp\n</code></pre>\n\n<p>These are instructions to manage the so called frame pointer or <em>base</em> pointer (<code>rbp</code>). This is mainly required to get nice stack traces. If you disable it for the C++ version via <code>-fno-omit-frame-pointer</code>, <a href=\"https://godbolt.org/g/gsh6Hs\" rel=\"noreferrer\">you get the same result</a>. Note that this uses <code>g++</code> instead of <code>clang++</code> since I <a href=\"https://stackoverflow.com/questions/43864881/fno-omit-frame-pointer-equivalent-compiler-option-for-clang\">haven't found a comparable option for the clang compiler</a>.</p></li>\n<li><p><strong>Why doesn't Rust omit frame pointer?</strong></p>\n\n<p>Actually, it does. But Godbolt adds an option to the compiler to preserve frame pointer. You can read more about why this is done <a href=\"https://github.com/rust-lang/rust/issues/11906\" rel=\"noreferrer\">here</a>. If you compile your code locally with <code>rustc -O --crate-type=lib foo.rs --emit asm -C \"llvm-args=-x86-asm-syntax=intel\"</code>, you get this output:</p>\n\n<pre><code>f1:\n    xor dil, 1\n    or  dil, sil\n    mov eax, edi\n    ret\n</code></pre>\n\n<p>Which is <em>exactly</em> the output of your C++ version.</p>\n\n<p>You can \"undo\" what Godbolt does by <a href=\"https://godbolt.org/g/L7oVpK\" rel=\"noreferrer\">passing <code>-C debuginfo=0</code> to the compiler</a>.</p></li>\n<li><p><strong>Why <code>-O</code> instead of <code>--release</code>?</strong></p>\n\n<p>Godbolt uses <code>rustc</code> directly instead of <code>cargo</code>. The <code>--release</code> flag is a flag for <code>cargo</code>. To enable optimizations on <code>rustc</code>, you need to pass <code>-O</code> or <code>-C opt-level=3</code> (or any other level between 0 and 3).</p></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 136, "user_id": 3617740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/730e8836d2805c32227315db3a81ccfc?s=128&d=identicon&r=PG&f=1", "display_name": "yzz", "link": "https://stackoverflow.com/users/3617740/yzz"}, "is_accepted": false, "score": 4, "last_activity_date": 1502179559, "creation_date": 1502179559, "answer_id": 45562692, "question_id": 45562164, "link": "https://stackoverflow.com/questions/45562164/why-does-this-code-generate-much-more-assembly-than-equivalent-c-clang/45562692#45562692", "title": "Why does this code generate much more assembly than equivalent C++/Clang?", "body": "<p>To get the same asm code, you need to disable debug info - this will remove the frame pointers pushes.</p>\n\n<p><code>-C opt-level=3 -C debuginfo=0</code> (<a href=\"https://godbolt.org/g/vdhB2f\" rel=\"nofollow noreferrer\">https://godbolt.org/g/vdhB2f</a>)</p>\n"}, {"tags": [], "owner": {"reputation": 15864, "user_id": 1870153, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/juCKe.png?s=128&g=1", "display_name": "ljedrz", "link": "https://stackoverflow.com/users/1870153/ljedrz"}, "is_accepted": false, "score": 2, "last_activity_date": 1502188729, "creation_date": 1502188729, "answer_id": 45566099, "question_id": 45562164, "link": "https://stackoverflow.com/questions/45562164/why-does-this-code-generate-much-more-assembly-than-equivalent-c-clang/45566099#45566099", "title": "Why does this code generate much more assembly than equivalent C++/Clang?", "body": "<p><strong>It doesn't</strong> (the actual difference is much smaller than shown in the question). I'm surprised nobody checked the C++ output:</p>\n\n<p><a href=\"https://godbolt.org/g/FcgocA\" rel=\"nofollow noreferrer\">godbolt C++ x64 clang 4.0, no compiler options</a></p>\n\n<p><a href=\"https://godbolt.org/g/sUY2qM\" rel=\"nofollow noreferrer\">godbolt Rust 1.18, no compiler options</a></p>\n"}], "owner": {"reputation": 3107, "user_id": 4131673, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/100000565112046/picture?type=large", "display_name": "jaskmar", "link": "https://stackoverflow.com/users/4131673/jaskmar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2714, "favorite_count": 4, "closed_date": 1502191912, "accepted_answer_id": 45562380, "answer_count": 4, "score": 16, "last_activity_date": 1564857366, "creation_date": 1502178022, "last_edit_date": 1564857366, "question_id": 45562164, "link": "https://stackoverflow.com/questions/45562164/why-does-this-code-generate-much-more-assembly-than-equivalent-c-clang", "closed_reason": "Not suitable for this site", "title": "Why does this code generate much more assembly than equivalent C++/Clang?", "body": "<p>I wrote a simple C++ function in order to check compiler optimization:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>bool f1(bool a, bool b) {\n    return !a || (a &amp;&amp; b);\n}\n</code></pre>\n\n<p>After that I checked the equivalent in Rust:</p>\n\n<pre><code>fn f1(a: bool, b: bool) -&gt; bool {\n    !a || (a &amp;&amp; b)\n}\n</code></pre>\n\n<p>I used <a href=\"https://rust.godbolt.org/\" rel=\"nofollow noreferrer\">godbolt</a> to check the assembler output.</p>\n\n<p>The result of the C++ code (compiled by clang with -O3 flag) is following:</p>\n\n<pre><code>f1(bool, bool):                                # @f1(bool, bool)\n    xor     dil, 1\n    or      dil, sil\n    mov     eax, edi\n    ret\n</code></pre>\n\n<p>And the result of Rust equivalent is much longer:</p>\n\n<pre><code>example::f1:\n  push rbp\n  mov rbp, rsp\n  mov al, sil\n  mov cl, dil\n  mov dl, cl\n  xor dl, -1\n  test dl, 1\n  mov byte ptr [rbp - 3], al\n  mov byte ptr [rbp - 4], cl\n  jne .LBB0_1\n  jmp .LBB0_3\n.LBB0_1:\n  mov byte ptr [rbp - 2], 1\n  jmp .LBB0_4\n.LBB0_2:\n  mov byte ptr [rbp - 2], 0\n  jmp .LBB0_4\n.LBB0_3:\n  mov al, byte ptr [rbp - 4]\n  test al, 1\n  jne .LBB0_7\n  jmp .LBB0_6\n.LBB0_4:\n  mov al, byte ptr [rbp - 2]\n  and al, 1\n  movzx eax, al\n  pop rbp\n  ret\n.LBB0_5:\n  mov byte ptr [rbp - 1], 1\n  jmp .LBB0_8\n.LBB0_6:\n  mov byte ptr [rbp - 1], 0\n  jmp .LBB0_8\n.LBB0_7:\n  mov al, byte ptr [rbp - 3]\n  test al, 1\n  jne .LBB0_5\n  jmp .LBB0_6\n.LBB0_8:\n  test byte ptr [rbp - 1], 1\n  jne .LBB0_1\n  jmp .LBB0_2\n</code></pre>\n\n<p>I also tried with <code>-O</code> option but the output is empty (deleted unused function).</p>\n\n<p>I intentionally am NOT using any library in order to keep output clean. Please notice that both <code>clang</code> and <code>rustc</code> use LLVM as a backend. What explains this huge output difference? And if it is only disabled-optimize-switch problem, how can I see optimized output from <code>rustc</code>?</p>\n"}, {"tags": ["rust", "lifetime"], "answers": [{"comments": [{"owner": {"reputation": 3212, "user_id": 2731452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xA89V.jpg?s=128&g=1", "display_name": "red75prime", "link": "https://stackoverflow.com/users/2731452/red75prime"}, "edited": false, "score": 0, "creation_date": 1502131058, "post_id": 45553560, "comment_id": 78067090, "body": "&quot;Lifetimes are descriptive, not prescriptive.&quot; This should be in the book."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 3212, "user_id": 2731452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xA89V.jpg?s=128&g=1", "display_name": "red75prime", "link": "https://stackoverflow.com/users/2731452/red75prime"}, "edited": false, "score": 0, "creation_date": 1502131080, "post_id": 45553560, "comment_id": 78067107, "body": "@red75prime click the link on &quot;say it with me&quot; to go to the book where it is :-)"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 3212, "user_id": 2731452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xA89V.jpg?s=128&g=1", "display_name": "red75prime", "link": "https://stackoverflow.com/users/2731452/red75prime"}, "edited": false, "score": 0, "creation_date": 1502131354, "post_id": 45553560, "comment_id": 78067265, "body": "@red75prime the second edition isn&#39;t quite as concise, but probably easier to understand. Added. :-)"}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 1, "last_activity_date": 1502139339, "last_edit_date": 1502139339, "creation_date": 1502130763, "answer_id": 45553560, "question_id": 45553304, "link": "https://stackoverflow.com/questions/45553304/what-happens-to-the-no-longer-referenced-chunk-when-i-reassign-half-of-a-linked/45553560#45553560", "title": "What happens to the no-longer-referenced chunk when I reassign half of a linked list?", "body": "<blockquote>\n  <p>Does the fact that each character instance here have a reference to <code>BaseCustom</code>'s lifetime mean that the memory is held on to until the program ends?</p>\n</blockquote>\n\n<p><a href=\"https://doc.rust-lang.org/nightly/book/second-edition/ch10-03-lifetime-syntax.html#lifetime-annotation-syntax\" rel=\"nofollow noreferrer\">Say it with me</a>:</p>\n\n<blockquote>\n  <p>Lifetime annotations don\u2019t change how long any of the references involved live</p>\n</blockquote>\n\n<p><a href=\"https://doc.rust-lang.org/book/first-edition/lifetimes.html\" rel=\"nofollow noreferrer\">Or the jargon version you might see elsewhere</a>:</p>\n\n<blockquote>\n  <p>Lifetimes are <em>descriptive</em>, not <em>prescriptive</em>.</p>\n</blockquote>\n\n<p>The fact that there are lifetimes present does not change the behavior of your code. </p>\n\n<p>When you overwrite <code>left</code> with a new value, nothing knows about the old value so it must be dropped. In this case, that means a value of type <code>Option&lt;Box&lt;Digits&lt;'a&gt;&gt;&gt;</code> is dropped. If it's a <code>Some</code>, this calls the destructor for <code>Box</code> which would in turn call the destructor for <code>Digits</code>, which will call the destructor for <code>mapping</code>, <code>digit</code>, and recursively for its own <code>left</code>.</p>\n\n<p>What does dropping a reference or an integer <em>do</em>? Absolutely nothing.</p>\n\n<blockquote>\n  <p>Is it stating that the items must live as long as <code>BaseCustom</code>? Or is it that they get freed up at some point but <code>BaseCustom</code> must outlive them?</p>\n</blockquote>\n\n<p>The lifetime states that <code>Digits</code> may not outlive <code>BaseCustom</code>. This makes sense because it contains a reference to <code>BaseCustom</code>.</p>\n\n<hr>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/38147453/155423\">Do we need to manually create a destructor for a linked list?</a> </li>\n</ul>\n"}], "owner": {"reputation": 2105, "user_id": 1500195, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/Tc5kv.png?s=128&g=1", "display_name": "6ft Dan", "link": "https://stackoverflow.com/users/1500195/6ft-dan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1502139339, "creation_date": 1502129788, "last_edit_date": 1502131651, "question_id": 45553304, "link": "https://stackoverflow.com/questions/45553304/what-happens-to-the-no-longer-referenced-chunk-when-i-reassign-half-of-a-linked", "title": "What happens to the no-longer-referenced chunk when I reassign half of a linked list?", "body": "<p>I have successfully implemented a custom numeric base system in Rust via linked lists called <a href=\"https://github.com/danielpclark/digits\" rel=\"nofollow noreferrer\">digits</a>. </p>\n\n<pre><code>pub struct Digits&lt;'a&gt; {\n    mapping: &amp;'a BaseCustom&lt;char&gt;,\n    digit: u64,\n    left: Option&lt;Box&lt;Digits&lt;'a&gt;&gt;&gt;,\n}\n</code></pre>\n\n<p>I've declared a lifetime on the linked list struct and linked it directly to an instance of <code>BaseCustom</code>. When I reassign half of the linked list, what happens to the unreferenced chunk which still has its lifetime associated with the <code>BaseCustom</code> mapping?</p>\n\n<p>For example, I have a linked list that looks like \"hello\" (I'll use left to right for this example and not right to left as in my project)</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>h -&gt; e -&gt; l -&gt; l -&gt; o\n</code></pre>\n\n<p>Then I reassign the linked list reference from <strong><code>e</code></strong> to a different set of characters.</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>h -&gt; e    l -&gt; l -&gt; o\n      \\\n       -&gt; d -&gt; g-&gt; e\n</code></pre>\n\n<p>Now that the code is no longer using the \"llo\" of hello, does that memory automatically get freed?  Does the fact that each character instance here have a reference to <code>BaseCustom</code>'s lifetime mean that the memory is held on to until the program ends?</p>\n\n<p>I know Rust doesn't have or use a garbage collector so the lifetime reference to <code>BaseCustom</code> confuses me here.  Is it stating that the items must live as long as <code>BaseCustom</code>?  Or is it that they get freed up at some point but <code>BaseCustom</code> must outlive them?</p>\n"}, {"tags": ["database", "performance", "rust", "raspberry-pi3", "lmdb"], "comments": [{"owner": {"reputation": 10100, "user_id": 619216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c07104de771c3b6f6c30be8f592ef8f7?s=128&d=identicon&r=PG", "display_name": "BurntSushi5", "link": "https://stackoverflow.com/users/619216/burntsushi5"}, "edited": false, "score": 1, "creation_date": 1502128241, "post_id": 45552639, "comment_id": 78065565, "body": "Why did you tag Rust?"}, {"owner": {"reputation": 599, "user_id": 1907778, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/6c218938854094046cff901c6dec7140?s=128&d=identicon&r=PG", "display_name": "5-to-9", "link": "https://stackoverflow.com/users/1907778/5-to-9"}, "reply_to_user": {"reputation": 10100, "user_id": 619216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c07104de771c3b6f6c30be8f592ef8f7?s=128&d=identicon&r=PG", "display_name": "BurntSushi5", "link": "https://stackoverflow.com/users/619216/burntsushi5"}, "edited": false, "score": 0, "creation_date": 1502132887, "post_id": 45552639, "comment_id": 78068014, "body": "It&#39;s implemented in Rust. I was not sure if that was a useful information but I wanted to at least somehow include the information. I edited it now to make it clear."}, {"owner": {"reputation": 10100, "user_id": 619216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c07104de771c3b6f6c30be8f592ef8f7?s=128&d=identicon&r=PG", "display_name": "BurntSushi5", "link": "https://stackoverflow.com/users/619216/burntsushi5"}, "edited": false, "score": 1, "creation_date": 1502148111, "post_id": 45552639, "comment_id": 78074091, "body": "I think it would help if you include some sample code. I feel like the obvious answer to this question is to benchmark it. Have you tried that? I don&#39;t see how anyone could answer this question for you because it at least depends in part on the hardware you&#39;re running it on, no?"}, {"owner": {"reputation": 3481, "user_id": 579026, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5c7809d1535594cbd33bbcf3fed23c7c?s=128&d=identicon&r=PG", "display_name": "ren", "link": "https://stackoverflow.com/users/579026/ren"}, "edited": false, "score": 0, "creation_date": 1502149608, "post_id": 45552639, "comment_id": 78074400, "body": "how did you compute performance budget? Is this 2 ms on average or every time? What if db/os only flushes to disk once in a while? disk writes can be expensive, so my guess is no, not realistic."}], "answers": [{"tags": [], "owner": {"reputation": 179, "user_id": 5374623, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-p6n3TshFbnI/AAAAAAAAAAI/AAAAAAAAATI/dsRP5vTL3Bs/photo.jpg?sz=128", "display_name": "hjk41", "link": "https://stackoverflow.com/users/5374623/hjk41"}, "is_accepted": false, "score": 0, "last_activity_date": 1521081850, "creation_date": 1521081850, "answer_id": 49290746, "question_id": 45552639, "link": "https://stackoverflow.com/questions/45552639/is-2ms-a-realistic-performance-goal-for-small-writes-to-lmdb-on-a-raspberry-pi-3/49290746#49290746", "title": "Is 2ms a realistic performance goal for small writes to LMDB on a Raspberry Pi 3?", "body": "<p>It depends on how much data you have in you LMDB.</p>\n\n<p>2ms is definitely achievable for small DB. I have got over 100K writes per second with SSDs and small DB size (&lt;1GB). But if the DB is larger than your memory, you probably should not use LMDB if you are worried about write performance.</p>\n\n<p>To wrap up, if your DB is smaller than memory, you can go ahead and use LMDB, 2ms is definitely enough for a write operation. If your DB is larger than memory, then you better use LSM-based kv-stores like LevelDB or RocksDB.</p>\n"}], "owner": {"reputation": 599, "user_id": 1907778, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/6c218938854094046cff901c6dec7140?s=128&d=identicon&r=PG", "display_name": "5-to-9", "link": "https://stackoverflow.com/users/1907778/5-to-9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 398, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1521081850, "creation_date": 1502127347, "last_edit_date": 1502131343, "question_id": 45552639, "link": "https://stackoverflow.com/questions/45552639/is-2ms-a-realistic-performance-goal-for-small-writes-to-lmdb-on-a-raspberry-pi-3", "title": "Is 2ms a realistic performance goal for small writes to LMDB on a Raspberry Pi 3?", "body": "<p>I'm about to begin work on a new project on a Raspberry Pi 3. It will be controlled with a complex GUI so interactive performance is important.</p>\n\n<p>I decided to use LMDB for persistence, as - outside performance - its special traits make my system a lot simpler and for me there's no downside.\nThe application will be written in Rust, using the <code>lmdb</code> crate.</p>\n\n<p>The critical path will be a single-threaded part where I will get the current timestamp and write a total of 16 or 20 bytes (not sure yet, is 16 bytes really better?) to the database under a key I already have computed.\nFor doing so (beginning with timestamp and ending after the write transaction has been commited) I have a performance budget of 2 milliseconds.</p>\n\n<p>As far as I heard writes are LMDB's worst criteria, and those are very small random writes, so this is probably the worst possible application. This thought made me ask this question.</p>\n\n<p>Further information:\nas this is a GUI application this path will be called at most 100 times per second, and also never more than 1000 times per hour (this is a rewrite from scratch, and those are 10 times the numbers measured in the current system).</p>\n\n<p>I do not understand much about how LMDB works but AFAIU it is using memory mapped files. I was hoping this means the OS internals will write back the pages aggregated.</p>\n\n<p>Is 2ms a realistic goal for such an application? What would I need to consider to keep myself inside this window? Do I need to cache those writes manually?</p>\n"}, {"tags": ["c", "rust", "ffi"], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 7, "creation_date": 1502121186, "post_id": 45550756, "comment_id": 78061661, "body": "<code>const</code> and <code>static</code> do not mean the same things in Rust and C. Rust&#39;s <code>static</code> defines that the value has an address, <code>const</code> does not. In this context, <code>const</code> is closer to a C <code>#define</code>. Review <a href=\"https://doc.rust-lang.org/stable/book/first-edition/const-and-static.html\" rel=\"nofollow noreferrer\">the <code>const</code> vs <code>static</code> chapter in the first edition of the book</a> to know more."}, {"owner": {"reputation": 2409, "user_id": 2284570, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9bd1d26aad2cfb7ece066d94c128d529?s=128&d=identicon&r=PG", "display_name": "user2284570", "link": "https://stackoverflow.com/users/2284570/user2284570"}, "edited": false, "score": 0, "creation_date": 1607996000, "post_id": 45550756, "comment_id": 115441775, "body": "@Kornel how to do the same if the underlying C type is an int32 instead of a void?"}], "tags": [], "owner": {"reputation": 90851, "user_id": 27009, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f0a29af415477aa8c498a4f41ffe6640?s=128&d=identicon&r=PG", "display_name": "Kornel", "link": "https://stackoverflow.com/users/27009/kornel"}, "is_accepted": true, "score": 8, "last_activity_date": 1601484007, "last_edit_date": 1601484007, "creation_date": 1502120196, "answer_id": 45550756, "question_id": 45550387, "link": "https://stackoverflow.com/questions/45550387/how-can-i-access-a-c-global-variable-constant-in-rust-ffi/45550756#45550756", "title": "How can I access a C global variable/constant in Rust FFI?", "body": "<pre><code>use std::os::raw::c_void;\n\nextern &quot;C&quot; {\n    #[no_mangle]\n    static magic: *const c_void;\n}\n</code></pre>\n<p>Optionally, before the <code>extern</code> there can be <code>#[link(kind=&quot;static&quot;, name=&quot;&lt;c library name&gt;&quot;)]</code> to get the symbol actually linked.</p>\n<p>Externally linkable items, even if constant, need be declared with <code>static</code>, not just <code>const</code> keyword (otherwise you get &quot;extern items cannot be <code>const</code>&quot;).</p>\n"}], "owner": {"reputation": 90851, "user_id": 27009, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f0a29af415477aa8c498a4f41ffe6640?s=128&d=identicon&r=PG", "display_name": "Kornel", "link": "https://stackoverflow.com/users/27009/kornel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1929, "favorite_count": 2, "accepted_answer_id": 45550756, "answer_count": 1, "score": 4, "last_activity_date": 1601484007, "creation_date": 1502119037, "last_edit_date": 1502121327, "question_id": 45550387, "link": "https://stackoverflow.com/questions/45550387/how-can-i-access-a-c-global-variable-constant-in-rust-ffi", "title": "How can I access a C global variable/constant in Rust FFI?", "body": "<p>I need to access a value of a constant exported from C in Rust. </p>\n\n<p>I want to read the value from the actual symbol, and not just copy'n'paste the value to Rust (in my case the value is a pointer, and C checks for pointer equality).</p>\n\n<pre><code>extern void *magic;\n</code></pre>\n\n<p>What's the syntax to get <code>magic: *const c_void</code> readable in Rust?</p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 12555, "user_id": 1750757, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Zmc7D.jpg?s=128&g=1", "display_name": "Victor Polevoy", "link": "https://stackoverflow.com/users/1750757/victor-polevoy"}, "edited": false, "score": 1, "creation_date": 1502110860, "post_id": 45547401, "comment_id": 78054546, "body": "Okay, but could you also tell which cases are appropriate for <code>unwrap_or</code> and for <code>unwrap_or_else</code> and others? I understand that some cases are when you use them with scalars, for example, like <code>unwrap_or(0)</code> but that&#39;s all?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 12555, "user_id": 1750757, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Zmc7D.jpg?s=128&g=1", "display_name": "Victor Polevoy", "link": "https://stackoverflow.com/users/1750757/victor-polevoy"}, "edited": false, "score": 1, "creation_date": 1502112469, "post_id": 45547401, "comment_id": 78055727, "body": "@VictorPolevoy or any case where you&#39;ve <i>already</i> computed the function for whatever reason; it doesn&#39;t have to be a &quot;simple&quot; type like an integer."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 20, "last_activity_date": 1599571879, "last_edit_date": 1599571879, "creation_date": 1502110400, "answer_id": 45547401, "question_id": 45547293, "link": "https://stackoverflow.com/questions/45547293/why-should-i-prefer-optionok-or-else-instead-of-optionok-or/45547401#45547401", "title": "Why should I prefer `Option::ok_or_else` instead of `Option::ok_or`?", "body": "<p>The primary reason to use <code>ok_or_else</code> or <em>any</em> of the <code>..._or_else</code> methods is to avoid executing a function when it's not needed. In the case of <code>Option::ok_or_else</code> or <code>Option::unwrap_or_else</code>, there's no need to run extra code when the <code>Option</code> is <code>Some</code>. This can make code faster, depending on what happens in the error case</p>\n<p>In this example, <code>Error::new</code> likely performs allocation, but it could also write to standard out, make a network request, or anything any piece of Rust code can do; it's hard to tell from the outside. It's generally safer to place such code in a closure so you don't have to worry about extraneous side effects when the success case happens.</p>\n<p>Clippy lints this for you as well:</p>\n<pre><code>fn main() {\n    let foo = None;\n    foo.unwrap_or(&quot;hello&quot;.to_string());\n}\n</code></pre>\n<pre class=\"lang-none prettyprint-override\"><code>warning: use of `unwrap_or` followed by a function call\n --&gt; src/main.rs:3:9\n  |\n3 |     foo.unwrap_or(&quot;hello&quot;.to_string());\n  |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try this: `unwrap_or_else(|| &quot;hello&quot;.to_string())`\n  |\n  = note: `#[warn(clippy::or_fun_call)]` on by default\n  = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#or_fun_call\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1502112609, "post_id": 45547547, "comment_id": 78055830, "body": "Pedantically, it doesn&#39;t <i>require</i> that <code>into</code> is ever actually called, so there&#39;s no guarantee that allocation occurs. It&#39;s possible that there&#39;s some condition where allocation doesn&#39;t occur. However, it&#39;s indeed very likely."}], "tags": [], "owner": {"reputation": 3212, "user_id": 2731452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xA89V.jpg?s=128&g=1", "display_name": "red75prime", "link": "https://stackoverflow.com/users/2731452/red75prime"}, "is_accepted": false, "score": 4, "last_activity_date": 1502112683, "last_edit_date": 1502112683, "creation_date": 1502110827, "answer_id": 45547547, "question_id": 45547293, "link": "https://stackoverflow.com/questions/45547293/why-should-i-prefer-optionok-or-else-instead-of-optionok-or/45547547#45547547", "title": "Why should I prefer `Option::ok_or_else` instead of `Option::ok_or`?", "body": "<p>The signature of <code>std::io::Error::new</code> is </p>\n\n<pre><code>fn new&lt;E&gt;(kind: ErrorKind, error: E) -&gt; Error \nwhere\n    E: Into&lt;Box&lt;Error + Send + Sync&gt;&gt;,\u00a0\n</code></pre>\n\n<p>This means that <code>Error::new(ErrorKind::Other, \"Decode error\")</code> allocates memory on the heap because <code>error</code> needs to be converted into <code>Box&lt;Error + Send + Sync&gt;</code> to be of any use.</p>\n\n<p>Consequently, this pull request removes unneeded memory allocation/deallocation when the <code>Result</code> value is <code>Result::Ok</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1502112741, "post_id": 45547643, "comment_id": 78055917, "body": "How does this differ from my &quot;but it could also write to standard out&quot; line?"}, {"owner": {"reputation": 15864, "user_id": 1870153, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/juCKe.png?s=128&g=1", "display_name": "ljedrz", "link": "https://stackoverflow.com/users/1870153/ljedrz"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1502113149, "post_id": 45547643, "comment_id": 78056195, "body": "@Shepmaster it places focus on a different thing - the initial shape of your answer sounded mostly performance-oriented and possible misleading results may not have been obvious to a skimming reader."}], "tags": [], "owner": {"reputation": 15864, "user_id": 1870153, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/juCKe.png?s=128&g=1", "display_name": "ljedrz", "link": "https://stackoverflow.com/users/1870153/ljedrz"}, "is_accepted": false, "score": 6, "last_activity_date": 1502111099, "creation_date": 1502111099, "answer_id": 45547643, "question_id": 45547293, "link": "https://stackoverflow.com/questions/45547293/why-should-i-prefer-optionok-or-else-instead-of-optionok-or/45547643#45547643", "title": "Why should I prefer `Option::ok_or_else` instead of `Option::ok_or`?", "body": "<p>In addition to performance implications, more complex arguments in <code>ok_or</code> might yield unexpected results if one is not careful enough; consider the following case:</p>\n\n<pre><code>fn main() {\n    let value: Option&lt;usize&gt; = Some(1);\n\n    let result = value.ok_or({ println!(\"value is not Some!\"); 0 }); // actually, it is\n\n    assert_eq!(result, Ok(1)); // this holds, but \"value is not Some!\" was printed\n}\n</code></pre>\n\n<p>This would have been avoided with <code>ok_or_else</code> (and the same goes for other <code>*_or_else</code> functions), because the closure is not evaluated if the variant is <code>Some</code>.</p>\n"}], "owner": {"reputation": 12555, "user_id": 1750757, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Zmc7D.jpg?s=128&g=1", "display_name": "Victor Polevoy", "link": "https://stackoverflow.com/users/1750757/victor-polevoy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4581, "favorite_count": 5, "accepted_answer_id": 45547401, "answer_count": 3, "score": 16, "last_activity_date": 1599571879, "creation_date": 1502110046, "last_edit_date": 1502110173, "question_id": 45547293, "link": "https://stackoverflow.com/questions/45547293/why-should-i-prefer-optionok-or-else-instead-of-optionok-or", "title": "Why should I prefer `Option::ok_or_else` instead of `Option::ok_or`?", "body": "<p>I just saw the following change in a pull request:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>- .ok_or(Error::new(ErrorKind::Other, \"Decode error\"));\n+ .ok_or_else(|| Error::new(ErrorKind::Other, \"Decode error\"));\n</code></pre>\n\n<p>The only differences I know are:</p>\n\n<ol>\n<li>In <code>ok_or</code> we have already created <code>Error</code> by <code>Error::new</code> and passed it into a adaptor.</li>\n<li>In <code>ok_or_else</code> we have passed a closure which will produce such a value but it may not be called if there is <code>Some</code> data in the <code>Option</code>.</li>\n</ol>\n\n<p>Did I miss anything?</p>\n"}, {"tags": ["c++", "rust", "ffi"], "answers": [{"tags": [], "owner": {"reputation": 44438, "user_id": 42353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f05e802879a805c03a55645dfcc0d4ea?s=128&d=identicon&r=PG", "display_name": "DK.", "link": "https://stackoverflow.com/users/42353/dk"}, "is_accepted": true, "score": 7, "last_activity_date": 1502086854, "creation_date": 1502086854, "answer_id": 45540511, "question_id": 45539971, "link": "https://stackoverflow.com/questions/45539971/how-do-i-call-a-c-constructor-via-rust-ffi/45540511#45540511", "title": "How do I call a C++ constructor via Rust FFI?", "body": "<p>Rust doesn't support FFI with C++.  If you want to use this library, you will have to find or write a translation layer that provides a pure C interface to the library, then bind to <em>that</em>.</p>\n"}], "owner": {"reputation": 930, "user_id": 4275911, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/ZIyiU.png?s=128&g=1", "display_name": "kpalatzky", "link": "https://stackoverflow.com/users/4275911/kpalatzky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 332, "favorite_count": 0, "accepted_answer_id": 45540511, "answer_count": 1, "score": 4, "last_activity_date": 1502107410, "creation_date": 1502083999, "last_edit_date": 1502107410, "question_id": 45539971, "link": "https://stackoverflow.com/questions/45539971/how-do-i-call-a-c-constructor-via-rust-ffi", "title": "How do I call a C++ constructor via Rust FFI?", "body": "<p>I am trying to use \"xerces-c\" via FFI in Rust without success. In C++, I would write the following code to use it:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>XMLPlatformUtils::Initialize();\n{\n  XercesDOMParser domParser;\n  ParserErrorHandler parserErrorHandler;\n\n  domParser.setErrorHandler(&amp;parserErrorHandler);\n  domParser.setDoSchema(true);\n  domParser.setValidationSchemaFullChecking(true);\n\n  domParser.parse(xmlFilePath.c_str());\n  if(domParser.getErrorCount() != 0) {     \n     // ...\n  }\n}\nXMLPlatformUtils::Terminate();\n</code></pre>\n\n<p>How can I use these \"complex\" data types within Rust? I found many examples to export/create an FFI to use it in other languages but none to use complex types within Rust.</p>\n\n<pre><code>extern crate libc;\n\n#[link(name = \"xerces-c\")]\nextern {\n    // How do i have to implement the constructor here? \n}\n</code></pre>\n"}, {"tags": ["generics", "rust", "ownership-semantics"], "answers": [{"tags": [], "owner": {"reputation": 26934, "user_id": 8316315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44d833a8a46fea39d7bfca1540ea9c07?s=128&d=identicon&r=PG&f=1", "display_name": "Florian Weimer", "link": "https://stackoverflow.com/users/8316315/florian-weimer"}, "is_accepted": true, "score": 10, "last_activity_date": 1502048314, "creation_date": 1502048314, "answer_id": 45535894, "question_id": 45535820, "link": "https://stackoverflow.com/questions/45535820/generic-function-accepting-str-or-moving-string-without-copying/45535894#45535894", "title": "Generic function accepting &amp;str or moving String without copying", "body": "<p>I think what you are after can be achieved with the <a href=\"https://doc.rust-lang.org/std/convert/trait.Into.html\" rel=\"noreferrer\"><code>Into</code> trait</a>, like this:</p>\n\n<pre><code>fn foo&lt;S: Into&lt;String&gt;&gt;(s: S) -&gt; String {\n    return s.into();\n}\n\nfn main () {\n    foo(\"borrowed\");\n    foo(format!(\"owned\"));\n}\n</code></pre>\n"}], "owner": {"reputation": 90851, "user_id": 27009, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f0a29af415477aa8c498a4f41ffe6640?s=128&d=identicon&r=PG", "display_name": "Kornel", "link": "https://stackoverflow.com/users/27009/kornel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 577, "favorite_count": 1, "accepted_answer_id": 45535894, "answer_count": 1, "score": 8, "last_activity_date": 1502048461, "creation_date": 1502047820, "question_id": 45535820, "link": "https://stackoverflow.com/questions/45535820/generic-function-accepting-str-or-moving-string-without-copying", "title": "Generic function accepting &amp;str or moving String without copying", "body": "<p>I want to write a generic function that accepts any kind of string (<code>&amp;str</code>/<code>String</code>) for convenience of the caller. </p>\n\n<p>The function internally needs a <code>String</code>, so I'd also like to avoid needless re-allocation if the caller calls the function with <code>String</code>.</p>\n\n<pre><code>foo(\"borrowed\");\nfoo(format!(\"owned\"));\n</code></pre>\n\n<p>For accepting references I know I can use <code>foo&lt;S: AsRef&lt;str&gt;&gt;(s: S)</code>, but what about the other way?</p>\n\n<p>I think generic argument based on <code>ToOwned</code> might work (works for <code>&amp;str</code>, and I'm assuming it's a no-op on <code>String</code>), but I can't figure out the exact syntax.</p>\n"}, {"tags": ["rust", "type-inference"], "comments": [{"owner": {"reputation": 97030, "user_id": 189205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60305494593d556e57a3cf8e4a8c163?s=128&d=identicon&r=PG", "display_name": "interjay", "link": "https://stackoverflow.com/users/189205/interjay"}, "edited": false, "score": 0, "creation_date": 1502040749, "post_id": 45534606, "comment_id": 78029448, "body": "The <code>+ 1</code> in <code>left..right + 1</code> seems to be confusing the compiler. It works without it."}], "answers": [{"comments": [{"owner": {"reputation": 97030, "user_id": 189205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60305494593d556e57a3cf8e4a8c163?s=128&d=identicon&r=PG", "display_name": "interjay", "link": "https://stackoverflow.com/users/189205/interjay"}, "edited": false, "score": 1, "creation_date": 1502041400, "post_id": 45534811, "comment_id": 78029656, "body": "I&#39;m not sure if this is a good MCVE. In the original code, the compiler knows the type of <code>j</code> is <code>u64</code> and is able to deduce the type of <code>left</code> from this, but not the type of <code>right</code>. Perhaps this is a better MCVE: <a href=\"https://play.rust-lang.org/?gist=286c89a748791eee13303b352a75efa9&amp;version=stable\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>. Note that it compiles without the <code>+1</code>."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 97030, "user_id": 189205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60305494593d556e57a3cf8e4a8c163?s=128&d=identicon&r=PG", "display_name": "interjay", "link": "https://stackoverflow.com/users/189205/interjay"}, "edited": false, "score": 0, "creation_date": 1502041911, "post_id": 45534811, "comment_id": 78029804, "body": "@interjay good call; and that gives a little bit more of a concrete rationale as well."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 97030, "user_id": 189205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60305494593d556e57a3cf8e4a8c163?s=128&d=identicon&r=PG", "display_name": "interjay", "link": "https://stackoverflow.com/users/189205/interjay"}, "edited": false, "score": 0, "creation_date": 1502042384, "post_id": 45534811, "comment_id": 78029963, "body": "@interjay although I&#39;m surprised that it infers that <code>left</code> should be a <code>u64</code>; I guess if someone else implemented <code>Range</code> such that multiple types yielded <code>u64</code> it wouldn&#39;t anymore."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 2, "last_activity_date": 1502042337, "last_edit_date": 1502042337, "creation_date": 1502041157, "answer_id": 45534811, "question_id": 45534606, "link": "https://stackoverflow.com/questions/45534606/why-do-i-get-a-type-inference-error-for-only-one-side-of-a-range-bound/45534811#45534811", "title": "Why do I get a type inference error for only one side of a range bound?", "body": "<p>When debugging a problem, it's very useful to create a <a href=\"/help/mcve\">MCVE</a>. This is a technique that will greatly aid you as you continue to learn about programming. Here's an example for this case:</p>\n\n<pre><code>fn main() {\n    let left = \"0\".parse().unwrap();\n    let right = \"1\".parse().unwrap();\n\n    for j in left..right + 1 {\n        let j2: u64 = j;\n    }\n}\n</code></pre>\n\n<p>They do take practice, however. See the revision history for a reduction that was a little too minimal.</p>\n\n<blockquote>\n  <p>They appear in almost the same context.</p>\n</blockquote>\n\n<p>Yes, and how they are <em>different</em> should be a clue. What is different about <code>left</code> and <code>right</code> in the above code? There are two things I see:</p>\n\n<ol>\n<li><p><code>right</code> has a value added to it. In Rust, <a href=\"https://doc.rust-lang.org/std/ops/trait.Add.html\" rel=\"nofollow noreferrer\"><code>Add</code></a> can be overloaded on different types for the two things being added. This means that the pair of input types determines the output type. However, you cannot \"work backwards\" from a result type to input types because there can be more than one pair of input types that results in a <code>u64</code>. The four permutations of (<code>u64</code>, <code>&amp;u64</code>) is one example.</p></li>\n<li><p><code>left</code> occurs first. If you reduce all the way to this code, you still only get one error, whichever occurs first:</p>\n\n<pre><code>fn main() {\n    let left = \"0\".parse().unwrap();\n    let right = \"1\".parse().unwrap();\n}\n</code></pre>\n\n<p>As for <strong>why</strong>, I'm not fully sure. However, cascading errors is a common hard thing for compilers to report. In this case, I'd believe that type inference fails once, so any subsequent inference is likely to be wrong, so the compiler stops there and reports the error. </p></li>\n</ol>\n"}], "owner": {"reputation": 355, "user_id": 5955876, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5b29bb86b71b9c789283bd5180355d5c?s=128&d=identicon&r=PG&f=1", "display_name": "Count Zero", "link": "https://stackoverflow.com/users/5955876/count-zero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 1, "accepted_answer_id": 45534811, "answer_count": 1, "score": 1, "last_activity_date": 1502042337, "creation_date": 1502039880, "last_edit_date": 1502040458, "question_id": 45534606, "link": "https://stackoverflow.com/questions/45534606/why-do-i-get-a-type-inference-error-for-only-one-side-of-a-range-bound", "title": "Why do I get a type inference error for only one side of a range bound?", "body": "<p>I am solving the <a href=\"http://www.spoj.com/problems/PRIME1/\" rel=\"nofollow noreferrer\">SPOJ PRIME1 - Prime Generator</a> problem:</p>\n\n<pre><code>use std::io::stdin;\n\nfn is_prime(n: u64) -&gt; bool {\n    let bound = (n as f64).sqrt() as u64;\n    for i in 2..bound + 1 {\n        if n % i == 0 {\n            return false;\n        }\n    }\n    true\n}\n\nfn main() {\n    let mut s = String::new();\n    stdin().read_line(&amp;mut s).expect(\"Error\");\n    let n: u32 = s.trim().parse().unwrap();\n\n    for i in 0..n {\n        let mut s = String::new();\n        stdin().read_line(&amp;mut s).expect(\"Error\");\n        let t: Vec&lt;&amp;str&gt; = s.trim().split(\" \").collect();\n        let mut left = t[0].parse().unwrap();\n        let right = t[1].parse().unwrap();\n        if left == 1 {\n            left += 1;\n        }\n        for j in left..right + 1 {\n            if is_prime(j) {\n                println!(\"{}\", j);\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>The compilation fails due to this error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0282]: type annotations needed\n  --&gt; src/main.rs:23:13\n   |\n23 |         let right = t[1].parse().unwrap();\n   |             ^^^^^\n   |             |\n   |             consider giving `right` a type\n   |             cannot infer type for `_`\n</code></pre>\n\n<p>Why is the error message about the <code>right</code> variable? Why is nothing said about the <code>left</code> variable? They appear in almost the same context. Am I missing something?</p>\n"}, {"tags": ["rust", "mutability", "borrowing"], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 2, "last_activity_date": 1588166838, "last_edit_date": 1588166838, "creation_date": 1502040092, "answer_id": 45534643, "question_id": 45534394, "link": "https://stackoverflow.com/questions/45534394/how-do-i-create-a-struct-of-references-to-traits-when-one-object-might-implement/45534643#45534643", "title": "How do I create a struct of references to traits when one object might implement multiple of the traits?", "body": "<blockquote>\n  <p>In C++ I would store pointers or references</p>\n</blockquote>\n\n<p>Rust isn't that alien. You do the same thing. The main difference is that Rust prevents you from being able to mutate one thing via two different paths or to have a reference that dangles.</p>\n\n<p>Answering your question has <strong>many</strong> potential solutions. For example, you don't describe whether you need to be able to mutate the sensors or describe if the sensors will outlive the manager, if threads will be involved, etc.. All of these things affect how micro-optimized the code can be.</p>\n\n<p>The maximally-flexible solution is to:</p>\n\n<ol>\n<li><p>use <a href=\"https://doc.rust-lang.org/std/rc/index.html\" rel=\"nofollow noreferrer\"><em>shared ownership</em></a>, such as that provided by <a href=\"https://doc.rust-lang.org/std/rc/struct.Rc.html\" rel=\"nofollow noreferrer\"><code>Rc</code></a> or <a href=\"https://doc.rust-lang.org/std/sync/struct.Arc.html\" rel=\"nofollow noreferrer\"><code>Arc</code></a>. This allows multiple things to own the sensor.</p></li>\n<li><p>use <a href=\"https://doc.rust-lang.org/std/cell/index.html\" rel=\"nofollow noreferrer\"><em>interior mutability</em></a>, such as that provided by <a href=\"https://doc.rust-lang.org/std/cell/struct.RefCell.html\" rel=\"nofollow noreferrer\"><code>RefCell</code></a> or <a href=\"https://doc.rust-lang.org/std/sync/struct.Mutex.html\" rel=\"nofollow noreferrer\"><code>Mutex</code></a>. This moves enforcement of a single mutating reference at a time from compile time to run time.</p></li>\n<li><p>use <a href=\"https://doc.rust-lang.org/stable/book/ch17-02-trait-objects.html\" rel=\"nofollow noreferrer\"><em>trait objects</em></a> to model dynamic dispatch since the decision of what concrete objects to use is made at run time.</p></li>\n</ol>\n\n<pre><code>use std::{cell::RefCell, rc::Rc};\n\ntrait Barometer {\n    fn get(&amp;self) -&gt; i32;\n    fn set(&amp;self, value: i32);\n}\n\ntrait Thermometer {\n    fn get(&amp;self) -&gt; i32;\n    fn set(&amp;self, value: i32);\n}\n\ntrait Gyroscope {\n    fn get(&amp;self) -&gt; i32;\n    fn set(&amp;self, value: i32);\n}\n\nstruct Multitudes;\nimpl Barometer for Multitudes {\n    fn get(&amp;self) -&gt; i32 {\n        1\n    }\n    fn set(&amp;self, value: i32) {\n        println!(\"Multitudes barometer set to {}\", value)\n    }\n}\n\nimpl Thermometer for Multitudes {\n    fn get(&amp;self) -&gt; i32 {\n        2\n    }\n    fn set(&amp;self, value: i32) {\n        println!(\"Multitudes thermometer set to {}\", value)\n    }\n}\n\nstruct AutoGyro;\n\nimpl Gyroscope for AutoGyro {\n    fn get(&amp;self) -&gt; i32 {\n        3\n    }\n    fn set(&amp;self, value: i32) {\n        println!(\"AutoGyro gyroscope set to {}\", value)\n    }\n}\n\nstruct SensorManager {\n    barometer: Rc&lt;RefCell&lt;dyn Barometer&gt;&gt;,\n    thermometer: Rc&lt;RefCell&lt;dyn Thermometer&gt;&gt;,\n    gyroscope: Rc&lt;RefCell&lt;dyn Gyroscope&gt;&gt;,\n}\n\nimpl SensorManager {\n    fn new(\n        barometer: Rc&lt;RefCell&lt;dyn Barometer&gt;&gt;,\n        thermometer: Rc&lt;RefCell&lt;dyn Thermometer&gt;&gt;,\n        gyroscope: Rc&lt;RefCell&lt;dyn Gyroscope&gt;&gt;,\n    ) -&gt; Self {\n        Self {\n            barometer,\n            thermometer,\n            gyroscope,\n        }\n    }\n\n    fn dump_info(&amp;self) {\n        let barometer = self.barometer.borrow();\n        let thermometer = self.thermometer.borrow();\n        let gyroscope = self.gyroscope.borrow();\n\n        println!(\n            \"{}, {}, {}\",\n            barometer.get(),\n            thermometer.get(),\n            gyroscope.get()\n        );\n    }\n\n    fn update(&amp;self) {\n        self.barometer.borrow_mut().set(42);\n        self.thermometer.borrow_mut().set(42);\n        self.gyroscope.borrow_mut().set(42);\n    }\n}\n\nfn main() {\n    let multi = Rc::new(RefCell::new(Multitudes));\n    let gyro = Rc::new(RefCell::new(AutoGyro));\n\n    let manager = SensorManager::new(multi.clone(), multi, gyro);\n\n    manager.dump_info();\n    manager.update();\n}\n</code></pre>\n\n<p><a href=\"https://play.integer32.com/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=db1a7f4b3815fa9124306ecfc31590e3\" rel=\"nofollow noreferrer\">Complete example on the Playground</a></p>\n\n<hr>\n\n<blockquote>\n<pre><code>barometer: Barometer + Sized,\n</code></pre>\n</blockquote>\n\n<p>You really don't want to to this. <code>Barometer</code> is both a <strong>trait</strong> and a <strong>type</strong>, but the type doesn't have a size. it always needs to be referenced behind a pointer (<code>&amp;Barometer</code>, <code>Box&lt;Barometer&gt;</code>, <code>RefCell&lt;Barometer&gt;</code>, etc.)</p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/50650070/155423\">What does &quot;dyn&quot; mean in a type?</a></li>\n</ul>\n"}], "owner": {"reputation": 25, "user_id": 3994033, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0a567484265b8af128757b497b51eac?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Deegan", "link": "https://stackoverflow.com/users/3994033/martin-deegan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 569, "favorite_count": 0, "accepted_answer_id": 45534643, "answer_count": 1, "score": 1, "last_activity_date": 1588166838, "creation_date": 1502038592, "last_edit_date": 1502038955, "question_id": 45534394, "link": "https://stackoverflow.com/questions/45534394/how-do-i-create-a-struct-of-references-to-traits-when-one-object-might-implement", "title": "How do I create a struct of references to traits when one object might implement multiple of the traits?", "body": "<p>I have a struct which manages several sensors. I have a gyroscope, accelerometer, magnetometer, barometer, and thermometer. All of which are traits.</p>\n\n<pre><code>pub struct SensorManager {\n    barometer: Barometer + Sized,\n    thermometer: Thermometer + Sized,\n    gyroscope: Gyroscope + Sized,\n    accelerometer: Accelerometer + Sized,\n    magnetometer: Magnetometer + Sized\n}\n</code></pre>\n\n<p>I need to make it modular so in the configuration file you can specify which sensors you are using.</p>\n\n<p>The problem is that some of the sensors overlap. For example: one person can have an LSM9DS0 which contains gyroscope, accelerometer, and magnetometer while another person can have an L3GD20 gyroscope and an LSM303D accelerometer, magnetometer.</p>\n\n<p>In C++ I would store pointers or references, but I am not sure how to properly implement this safely in Rust.</p>\n\n<p>Short version: Need to have references to each sensor as members of this struct. Some of these references are of the same object.</p>\n"}, {"tags": ["static", "rust", "field"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 2, "creation_date": 1502037352, "post_id": 45534149, "comment_id": 78028395, "body": "<a href=\"https://play.integer32.com/?gist=dbdbe5be6a533ea6fa5c9e8dca1d9b10&amp;version=stable\" rel=\"nofollow noreferrer\">play.integer32.com/&hellip;</a>"}, {"owner": {"reputation": 2107, "user_id": 1968354, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5bf273b96c177d846813c35f7d1d214d?s=128&d=identicon&r=PG", "display_name": "NeatNerd", "link": "https://stackoverflow.com/users/1968354/neatnerd"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1502039268, "post_id": 45534149, "comment_id": 78029023, "body": "awesome, thanks a lot!"}], "owner": {"reputation": 2107, "user_id": 1968354, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5bf273b96c177d846813c35f7d1d214d?s=128&d=identicon&r=PG", "display_name": "NeatNerd", "link": "https://stackoverflow.com/users/1968354/neatnerd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 617, "favorite_count": 0, "closed_date": 1502037151, "answer_count": 0, "score": 1, "last_activity_date": 1502037164, "creation_date": 1502037016, "last_edit_date": 1502037102, "question_id": 45534149, "link": "https://stackoverflow.com/questions/45534149/how-can-i-initialize-fields-of-a-struct-in-static-context", "closed_reason": "Duplicate", "title": "How can I initialize fields of a struct in static context?", "body": "<p>I need a \"default\", de facto an empty struct that I will be returning as a default value. Since it is read only, I don't want to pollute the memory by creating it N times, but rather return it only once</p>\n\n<pre><code>#[derive(Debug,PartialEq)]\npub struct Vocabulary {\n    literal_names:  Vec&lt;String&gt;,\n    symbolic_names: Vec&lt;String&gt;,\n    display_names:  Vec&lt;String&gt;,\n    max_toke_type:  usize,\n}\n\nstatic EMPTY_VOCABULARY:Vocabulary = Vocabulary{\n    literal_names:  Vec::new(),\n    symbolic_names: Vec::new(),\n    display_names:  Vec::new(),\n    max_toke_type:  0 ,\n};\n</code></pre>\n\n<p>This fails, considering function calls are not allowed in static context. How can I initialized these fields then?</p>\n"}, {"tags": ["macros", "rust"], "answers": [{"comments": [{"owner": {"reputation": 18645, "user_id": 50385, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/2faf0c72f6a7f65431e7df489878be24?s=128&d=identicon&r=PG", "display_name": "Joseph Garvin", "link": "https://stackoverflow.com/users/50385/joseph-garvin"}, "edited": false, "score": 0, "creation_date": 1594442034, "post_id": 52694425, "comment_id": 111134359, "body": "Why do you have to make multiple copies when it appears multiple times in the generated code? I don&#39;t see why <code>quote!</code> shouldn&#39;t just borrow containers."}], "tags": [], "owner": {"reputation": 6357, "user_id": 6086311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb99289473f6393b89474785f2d294d1?s=128&d=identicon&r=PG", "display_name": "dtolnay", "link": "https://stackoverflow.com/users/6086311/dtolnay"}, "is_accepted": true, "score": 5, "last_activity_date": 1594445345, "last_edit_date": 1594445345, "creation_date": 1538963108, "answer_id": 52694425, "question_id": 45533702, "link": "https://stackoverflow.com/questions/45533702/is-it-possible-to-modify-the-case-of-a-token-inside-of-a-macro/52694425#52694425", "title": "Is it possible to modify the case of a token inside of a macro?", "body": "<p>Macro_rules macros cannot do this. You would need to implement it as a procedural macro, which is allowed to perform arbitrary Rust code to generate the expanded code. In particular, procedural macros are able to call <a href=\"https://doc.rust-lang.org/std/primitive.str.html#method.to_uppercase\" rel=\"nofollow noreferrer\"><code>str::to_uppercase</code></a> and <a href=\"https://doc.rust-lang.org/std/primitive.str.html#method.to_lowercase\" rel=\"nofollow noreferrer\"><code>str::to_lowercase</code></a>.</p>\n<pre><code>// [dependencies]\n// quote = &quot;1.0&quot;\n// syn = &quot;1.0&quot;\n\nuse proc_macro::TokenStream;\nuse quote::quote;\nuse syn::parse::{Parse, ParseStream, Result};\nuse syn::{parse_macro_input, Expr, Ident, Token};\n\nstruct Input {\n    flags: Vec&lt;Ident&gt;,\n    values: Vec&lt;Expr&gt;,\n}\n\n// $( $flag:ident = $value:expr; )*\nimpl Parse for Input {\n    fn parse(input: ParseStream) -&gt; Result&lt;Self&gt; {\n        let mut flags = Vec::new();\n        let mut values = Vec::new();\n        while !input.is_empty() {\n            flags.push(input.parse()?);\n            input.parse::&lt;Token![=]&gt;()?;\n            values.push(input.parse()?);\n            input.parse::&lt;Token![;]&gt;()?;\n        }\n        Ok(Input { flags, values })\n    }\n}\n\n#[proc_macro]\npub fn sleeping_panda(input: TokenStream) -&gt; TokenStream {\n    let input = parse_macro_input!(input as Input);\n\n    let camelcase_flags = &amp;input.flags; // assume CamelCase in the input\n    let bitflag_values = &amp;input.values;\n\n    let uppercase_flags = input\n        .flags\n        .iter()\n        .map(|ident| Ident::new(&amp;ident.to_string().to_uppercase(), ident.span()));\n    // Some copies because these need to appear multiple times in the generated code.\n    let uppercase_flags2 = uppercase_flags.clone();\n    let uppercase_flags3 = uppercase_flags.clone();\n\n    let lowercase_flags = input\n        .flags\n        .iter()\n        .map(|ident| Ident::new(&amp;ident.to_string().to_lowercase(), ident.span()));\n\n    TokenStream::from(quote! {\n        bitflags::bitflags! (\n            struct KeyType: u64 {\n                #(\n                    const #uppercase_flags = #bitflag_values;\n                )*\n            }\n        );\n\n        pub struct SleepingPanda {\n            flags: KeyType,\n        }\n\n        impl SleepingPanda {\n            pub fn receive_event(&amp;mut self, event: sdl2::event::Event) {\n                match event {\n                    #(\n                        sdl2::event::Event::KeyDown {\n                            keycode: Some(sdl2::keyboard::Keycode::#camelcase_flags),\n                            ..\n                        } =&gt; {\n                            self.flags.insert(KeyType::#uppercase_flags2);\n                        }\n                    )*\n                    _ =&gt; {}\n                }\n            }\n\n            #(\n                pub fn #lowercase_flags(&amp;self) -&gt; bool {\n                    self.flags.contains(KeyType::#uppercase_flags3)\n                }\n            )*\n        }\n    })\n}\n</code></pre>\n<p>Using the macro:</p>\n<pre><code>use sleeping_panda::sleeping_panda;\n\nsleeping_panda! {\n    Backspace = 8;\n    Tab = 9;\n}\n\nfn main() {}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6357, "user_id": 6086311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb99289473f6393b89474785f2d294d1?s=128&d=identicon&r=PG", "display_name": "dtolnay", "link": "https://stackoverflow.com/users/6086311/dtolnay"}, "is_accepted": false, "score": 3, "last_activity_date": 1594445525, "creation_date": 1594445525, "answer_id": 62845577, "question_id": 45533702, "link": "https://stackoverflow.com/questions/45533702/is-it-possible-to-modify-the-case-of-a-token-inside-of-a-macro/62845577#62845577", "title": "Is it possible to modify the case of a token inside of a macro?", "body": "<p>The <a href=\"https://github.com/dtolnay/paste\" rel=\"nofollow noreferrer\"><code>paste</code></a> crate helps do identifier case conversions in a macro_rules macro, using <code>[&lt;$ident:lower&gt;]</code> for lowercase and <code>[&lt;$ident:upper&gt;]</code> for uppercase.</p>\n<p>Something like this:</p>\n<pre><code>// [dependencies]\n// paste = &quot;0.1&quot;\n\nmacro_rules! sleeping_panda {\n    ($($flag:ident = $value:expr;)+) =&gt; {\n        paste::item! {\n            bitflags::bitflags! (\n                struct KeyType: u64 {\n                    $(\n                        const [&lt;$flag:upper&gt;] = $value;\n                    )*\n                }\n            );\n\n            pub struct SleepingPanda {\n                flags: KeyType,\n            }\n\n            impl SleepingPanda {\n                pub fn receive_event(&amp;mut self, event: sdl2::event::Event) {\n                    match event {\n                        $(\n                            sdl2::event::Event::KeyDown {\n                                keycode: Some(sdl2::keyboard::Keycode::$flag),\n                                ..\n                            } =&gt; {\n                                self.flags.insert(KeyType::[&lt;$flag:upper&gt;]);\n                            }\n                        )*\n                        _ =&gt; {}\n                    }\n                }\n\n                $(\n                    pub fn [&lt;$flag:lower&gt;](&amp;self) -&gt; bool {\n                        self.flags.contains(KeyType::[&lt;$flag:upper&gt;])\n                    }\n                )*\n            }\n        }\n    };\n}\n\nsleeping_panda! {\n    Backspace = 8;\n    Tab = 9;\n}\n</code></pre>\n"}], "owner": {"reputation": 696, "user_id": 8159982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vhr5o.jpg?s=128&g=1", "display_name": "lncr", "link": "https://stackoverflow.com/users/8159982/lncr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 721, "favorite_count": 0, "accepted_answer_id": 52694425, "answer_count": 2, "score": 6, "last_activity_date": 1594445525, "creation_date": 1502034193, "last_edit_date": 1538964048, "question_id": 45533702, "link": "https://stackoverflow.com/questions/45533702/is-it-possible-to-modify-the-case-of-a-token-inside-of-a-macro", "title": "Is it possible to modify the case of a token inside of a macro?", "body": "<p>I am writing a macro which creates a struct managing user input. I am using the crates <a href=\"https://crates.io/crates/bitflags\" rel=\"nofollow noreferrer\">bitflags</a> and <a href=\"https://crates.io/crates/sdl2\" rel=\"nofollow noreferrer\">sdl2</a>. <strong>Return</strong> is an example for the key <kbd>Return</kbd>.</p>\n\n<p>This macro takes a list of all possible inputs and then</p>\n\n<pre><code>($($flag:ident = $value:expr;)+)  =&gt; { ... }\n</code></pre>\n\n<ol>\n<li><p>Creates a new bitflag with the name of the input</p>\n\n<pre><code>bitflags!(\n    struct KeyType: u64 {\n    $(\n        const $flag = $value;// UPPER_CASE is the norm for globals: 'RETURN'\n    )+\n    }\n);\n</code></pre></li>\n<li><p>Checks if the key is pressed, using the <a href=\"https://docs.rs/sdl2/0.30.0/sdl2/keyboard/enum.Keycode.html\" rel=\"nofollow noreferrer\"><code>Keycode</code></a> enum.</p>\n\n<pre><code>match event {\n    $(Event::KeyDown { keycode: Some(Keycode::$flag), .. } =&gt; { \n        self.flags.insert($flag); \n    },)+\n     _ =&gt; ()\n}// All enum fields start with a capital letter: 'Return'\n</code></pre></li>\n<li><p>Creates a getter function:</p>\n\n<pre><code>$(\n    pub fn $flag(&amp;self) -&gt; bool { // lower_case is the norm for functions: 'return'\n        self.flags.contains($flag)\n    }\n)+\n</code></pre></li>\n</ol>\n\n<p>Can I adapt <code>$flag</code> to fit all three requirements (<code>flag</code>, <code>Flag</code>, <code>FLAG</code>)?</p>\n"}, {"tags": ["arrays", "rust", "slice"], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 18, "last_activity_date": 1541355564, "last_edit_date": 1541355564, "creation_date": 1502034968, "answer_id": 45533840, "question_id": 45533699, "link": "https://stackoverflow.com/questions/45533699/is-there-a-way-to-initialize-an-empty-slice/45533840#45533840", "title": "Is there a way to initialize an empty slice?", "body": "<p>This creates an empty array:</p>\n\n<pre><code>let thing: [String; 0] = [];\n</code></pre>\n\n<p>You can also get a slice from the array:</p>\n\n<pre><code>let thing: &amp;[String] = &amp;[];\n</code></pre>\n\n<p>You can also use <code>as</code>:</p>\n\n<pre><code>some_function([] as [String; 0]);\nsome_function(&amp;[] as &amp;[String]);\n</code></pre>\n"}], "owner": {"reputation": 2107, "user_id": 1968354, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5bf273b96c177d846813c35f7d1d214d?s=128&d=identicon&r=PG", "display_name": "NeatNerd", "link": "https://stackoverflow.com/users/1968354/neatnerd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5652, "favorite_count": 1, "accepted_answer_id": 45533840, "answer_count": 1, "score": 8, "last_activity_date": 1541355564, "creation_date": 1502034169, "last_edit_date": 1502036122, "question_id": 45533699, "link": "https://stackoverflow.com/questions/45533699/is-there-a-way-to-initialize-an-empty-slice", "title": "Is there a way to initialize an empty slice?", "body": "<p>Something like this?</p>\n\n<pre><code>[String, 0]\n</code></pre>\n\n<p><code>Vec::new()</code> is not an option.</p>\n"}, {"tags": ["rust", "reference-counting", "ownership-semantics"], "comments": [{"owner": {"reputation": 3212, "user_id": 2731452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xA89V.jpg?s=128&g=1", "display_name": "red75prime", "link": "https://stackoverflow.com/users/2731452/red75prime"}, "edited": false, "score": 5, "creation_date": 1502012119, "post_id": 45530536, "comment_id": 78021312, "body": "<a href=\"https://doc.rust-lang.org/std/rc/struct.Rc.html#method.try_unwrap\" rel=\"nofollow noreferrer\">doc.rust-lang.org/std/rc/struct.Rc.html#method.try_unwrap</a>"}, {"owner": {"reputation": 766, "user_id": 1660116, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/023e6e2fb13bd8e3d1128eb0d704b613?s=128&d=identicon&r=PG", "display_name": "Victor Savu", "link": "https://stackoverflow.com/users/1660116/victor-savu"}, "reply_to_user": {"reputation": 3212, "user_id": 2731452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xA89V.jpg?s=128&g=1", "display_name": "red75prime", "link": "https://stackoverflow.com/users/2731452/red75prime"}, "edited": false, "score": 0, "creation_date": 1502012307, "post_id": 45530536, "comment_id": 78021355, "body": "Thanks! Ok, this is embarrassing. When I initially search the documentation I looked for an Optional&lt;T&gt; return and that is why I missed this function. Then I realized Result would be more useful, but I was already convinced the answer was not in the docs due to the previous search. Logical fail :("}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "reply_to_user": {"reputation": 3212, "user_id": 2731452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xA89V.jpg?s=128&g=1", "display_name": "red75prime", "link": "https://stackoverflow.com/users/2731452/red75prime"}, "edited": false, "score": 1, "creation_date": 1502017983, "post_id": 45530536, "comment_id": 78022803, "body": "@red75prime: Might as well post this as an answer so it can be accepted and we can all move on :)"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1502025211, "post_id": 45530536, "comment_id": 78024687, "body": "See also <a href=\"https://stackoverflow.com/q/29177449/155423\">How to take ownership of T from Arc&lt;Mutex&lt;T&gt;&gt;?</a>."}], "answers": [{"tags": [], "owner": {"reputation": 3212, "user_id": 2731452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xA89V.jpg?s=128&g=1", "display_name": "red75prime", "link": "https://stackoverflow.com/users/2731452/red75prime"}, "is_accepted": true, "score": 2, "last_activity_date": 1502107166, "last_edit_date": 1502107166, "creation_date": 1502082436, "answer_id": 45539748, "question_id": 45530536, "link": "https://stackoverflow.com/questions/45530536/conditionally-move-t-out-from-rct-when-the-count-is-1/45539748#45539748", "title": "Conditionally move T out from Rc&lt;T&gt; when the count is 1", "body": "<p>The standard library provides the <a href=\"https://doc.rust-lang.org/std/rc/struct.Rc.html#method.try_unwrap\" rel=\"nofollow noreferrer\"><code>Rc::try_unwrap</code></a> function:</p>\n\n<blockquote>\n<pre><code>fn try_unwrap(this: Rc&lt;T&gt;) -&gt; Result&lt;T, Rc&lt;T&gt;&gt;\n</code></pre>\n  \n  <p>Returns the contained value, if the <code>Rc</code> has exactly one strong\n  reference.</p>\n  \n  <p>Otherwise, an <code>Err</code> is returned with the same <code>Rc</code> that was passed in.</p>\n  \n  <p>This will succeed even if there are outstanding weak references.</p>\n  \n  <p>Examples</p>\n\n<pre><code>use std::rc::Rc;\n\nlet x = Rc::new(3);\nassert_eq!(Rc::try_unwrap(x), Ok(3));\n\nlet x = Rc::new(4);\nlet _y = Rc::clone(&amp;x);\nassert_eq!(*Rc::try_unwrap(x).unwrap_err(), 4);\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 766, "user_id": 1660116, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/023e6e2fb13bd8e3d1128eb0d704b613?s=128&d=identicon&r=PG", "display_name": "Victor Savu", "link": "https://stackoverflow.com/users/1660116/victor-savu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 1, "accepted_answer_id": 45539748, "answer_count": 1, "score": 2, "last_activity_date": 1502107166, "creation_date": 1502011268, "question_id": 45530536, "link": "https://stackoverflow.com/questions/45530536/conditionally-move-t-out-from-rct-when-the-count-is-1", "title": "Conditionally move T out from Rc&lt;T&gt; when the count is 1", "body": "<p>Is there a way to move an object from an <code>Rc&lt;T&gt;</code> when the count is <code>1</code>? I am thinking about how one would implement:</p>\n\n<pre><code>fn take_ownership&lt;T&gt;(shared: Rc&lt;T&gt;) -&gt; Result&lt;T, Rc&lt;T&gt;&gt; { ... }\n</code></pre>\n\n<p>The semantics would be that you get <code>T</code> if the count is <code>1</code> and you get back <code>shared</code> otherwise so you can try again later.</p>\n"}, {"tags": ["rust", "queue", "ownership", "borrow-checker"], "answers": [{"tags": [], "owner": {"reputation": 766, "user_id": 1660116, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/023e6e2fb13bd8e3d1128eb0d704b613?s=128&d=identicon&r=PG", "display_name": "Victor Savu", "link": "https://stackoverflow.com/users/1660116/victor-savu"}, "is_accepted": true, "score": 2, "last_activity_date": 1502017566, "creation_date": 1502017566, "answer_id": 45531368, "question_id": 45530445, "link": "https://stackoverflow.com/questions/45530445/what-am-i-doing-wrong-in-this-code-to-implement-a-dequeue-function-for-a-queue/45531368#45531368", "title": "What am I doing wrong in this code to implement a `dequeue` function for a queue?", "body": "<p>Here is an implementation of the <code>dequeue</code>:</p>\n\n<pre><code>pub fn dequeue(&amp;mut self) -&gt; Result&lt;T, String&gt; {\n    // First, disconnect `self.last` from the element it is pointing,\n    // since it will have to be updated anyway. If there is no elemen in the\n    // queue, we're done.\n    let first = try!(self.first.take().ok_or(\"Queue is empty\".to_owned()));\n    // if there are two Rc's pointing to this node, then this must be the\n    // only node, so `self.last` has to go\n    if Rc::strong_count(&amp;first) == 2 {\n        self.last = None;\n    }\n    let first_node = Rc::try_unwrap(first).ok().expect(\n        \"This should be the only owner of the node\"\n    ).into_inner();\n    self.first = first_node.next;\n    self.length -= 1;\n    Ok(first_node.item)\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?gist=394574f3e4a20e9c6aa61f16fdb93497&amp;version=stable\" rel=\"nofollow noreferrer\">Here is the complete code</a>. I also added a <code>dequeue_back</code> for making this almost a double ended queue and some tests.</p>\n"}], "owner": {"reputation": 173, "user_id": 7150660, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6ea5e2d7c1503778eea177bc2ab56b3b?s=128&d=identicon&r=PG&f=1", "display_name": "codeNoob", "link": "https://stackoverflow.com/users/7150660/codenoob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 378, "favorite_count": 0, "accepted_answer_id": 45531368, "answer_count": 1, "score": 0, "last_activity_date": 1502025542, "creation_date": 1502010598, "last_edit_date": 1502025542, "question_id": 45530445, "link": "https://stackoverflow.com/questions/45530445/what-am-i-doing-wrong-in-this-code-to-implement-a-dequeue-function-for-a-queue", "title": "What am I doing wrong in this code to implement a `dequeue` function for a queue?", "body": "<p>I'm trying to implement a <code>dequeue</code> function for a queue but I am confused how the borrow checker works. What am I doing wrong in this code?</p>\n\n<pre><code>use std::cell::RefCell;\nuse std::rc::Rc;\nuse std::mem::replace;\n\ntype Link&lt;T&gt; = Option&lt;Rc&lt;RefCell&lt;Node&lt;T&gt;&gt;&gt;&gt;;\n\nstruct Node&lt;T&gt;{\n    item: T,\n    next: Link&lt;T&gt;\n}\npub struct Queue&lt;T&gt;{\n    first: Link&lt;T&gt;,\n    last: Link&lt;T&gt;,\n    length: usize\n}\n\nimpl&lt;T&gt; Queue&lt;T&gt;{\n    pub fn new() -&gt; Queue&lt;T&gt; {\n        Queue {\n            first: None,\n            last: None,\n            length: 0\n        }\n    }\n    pub fn is_empty(&amp;self) -&gt; bool {\n        self.length == 0\n    }\n    pub fn size(&amp;self) -&gt; usize {\n        self.length\n    }\n    pub fn enqueue(&amp;mut self, item: T) {\n        let temp = self.last.take();\n        self.last = Some(Rc::new(RefCell::new(Node{\n            item,\n            next: None\n        })));\n        if self.is_empty() {\n            self.first = self.last.clone();\n        } else {\n            let temp = temp.unwrap();\n            temp.borrow_mut().next = self.last.clone();\n        }\n        self.length += 1;\n    }\n    pub fn dequeue(&amp;mut self) -&gt; Result&lt;T, String&gt;{\n        if let Some(ref mut value) = self.first.take() {\n            let mut temp = *(value.borrow_mut());\n            let next = *(temp.next.unwrap().borrow_mut());\n            let old_value = replace(&amp;mut temp, next);\n            return Ok(old_value.item);\n        }\n        Err(\"Queue is empty\".to_owned())\n    }\n}\n</code></pre>\n\n<p>Having obtained a mutable reference to the value inside <code>Some</code>, I want to replace with the node that is being referenced by the <code>next</code> field of the node. Do I need to take ownership of the value inside <code>Some</code>? Can I even do that? </p>\n"}, {"tags": ["rust", "x11"], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 6214999, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-H2f--pgw6WE/AAAAAAAAAAI/AAAAAAAABzs/xvwHqJQ3114/photo.jpg?sz=128", "display_name": "Ash Levy", "link": "https://stackoverflow.com/users/6214999/ash-levy"}, "is_accepted": true, "score": 1, "last_activity_date": 1501986566, "creation_date": 1501986566, "answer_id": 45528046, "question_id": 45527720, "link": "https://stackoverflow.com/questions/45527720/how-can-i-make-a-window-override-redirect-with-glutin/45528046#45528046", "title": "How can I make a window override-redirect with glutin?", "body": "<p>I figured it out. The override-redirect only takes place when the window is mapped, so if I unmap it and map it again then it works!</p>\n\n<p>Here is the code now:</p>\n\n<pre><code>unsafe {\n    use glutin::os::unix::WindowExt;\n    use glutin::os::unix::x11::XConnection;\n    use glutin::os::unix::x11::ffi::{Display, XID, CWOverrideRedirect, XSetWindowAttributes};\n    let x_connection = std::sync::Arc::&lt;XConnection&gt;::into_raw(display.gl_window().get_xlib_xconnection().unwrap());\n    let x_display = display.gl_window().get_xlib_display().unwrap() as *mut Display;\n    let x_window = display.gl_window().get_xlib_window().unwrap() as XID;\n    ((*x_connection).xlib.XChangeWindowAttributes)(\n        x_display,\n        x_window,\n        CWOverrideRedirect,\n        &amp;mut XSetWindowAttributes {\n            background_pixmap: 0,\n            background_pixel: 0,\n            border_pixmap: 0,\n            border_pixel: 0,\n            bit_gravity: 0,\n            win_gravity: 0,\n            backing_store: 0,\n            backing_planes: 0,\n            backing_pixel: 0,\n            save_under: 0,\n            event_mask: 0,\n            do_not_propagate_mask: 0,\n            override_redirect: 1,\n            colormap: 0,\n            cursor: 0,\n        }\n    );\n    ((*x_connection).xlib.XUnmapWindow)(x_display, x_window);\n    ((*x_connection).xlib.XMapWindow)(x_display, x_window);\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 6214999, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-H2f--pgw6WE/AAAAAAAAAAI/AAAAAAAABzs/xvwHqJQ3114/photo.jpg?sz=128", "display_name": "Ash Levy", "link": "https://stackoverflow.com/users/6214999/ash-levy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 485, "favorite_count": 0, "accepted_answer_id": 45528046, "answer_count": 1, "score": 0, "last_activity_date": 1520686999, "creation_date": 1501981600, "last_edit_date": 1501981968, "question_id": 45527720, "link": "https://stackoverflow.com/questions/45527720/how-can-i-make-a-window-override-redirect-with-glutin", "title": "How can I make a window override-redirect with glutin?", "body": "<p>I'm creating a program that uses glutin, and I want to provide a command-line flag to make the window override-redirect so it can be used as a desktop wallpaper for certain window managers that don't support the desktop window type.</p>\n\n<p>I've done a lot of research and managed to cobble together a block of code that I thought would work, using the provided xlib display and window from glutin. Here is my existing code:</p>\n\n<pre><code>unsafe {\n    use glutin::os::unix::WindowExt;\n    let x_connection = std::sync::Arc::&lt;glutin::os::unix::x11::XConnection&gt;::into_raw(display.gl_window().get_xlib_xconnection().unwrap());\n    ((*x_connection).xlib.XChangeWindowAttributes)(\n        display.gl_window().get_xlib_display().unwrap() as *mut glutin::os::unix::x11::ffi::Display,\n        display.gl_window().get_xlib_window().unwrap() as glutin::os::unix::x11::ffi::XID,\n        glutin::os::unix::x11::ffi::CWOverrideRedirect,\n        &amp;mut glutin::os::unix::x11::ffi::XSetWindowAttributes {\n            background_pixmap: 0,\n            background_pixel: 0,\n            border_pixmap: 0,\n            border_pixel: 0,\n            bit_gravity: 0,\n            win_gravity: 0,\n            backing_store: 0,\n            backing_planes: 0,\n            backing_pixel: 0,\n            save_under: 0,\n            event_mask: 0,\n            do_not_propagate_mask: 0,\n            override_redirect: 1,\n            colormap: 0,\n            cursor: 0,\n        }\n    );\n}\n</code></pre>\n\n<p>It doesn't give me any errors, and compiles and runs fine with the rest of the code, but it doesn't make the window override-redirect like I want to.</p>\n"}, {"tags": ["reference", "rust"], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 7, "last_activity_date": 1501962370, "last_edit_date": 1501962370, "creation_date": 1501961962, "answer_id": 45525755, "question_id": 45525533, "link": "https://stackoverflow.com/questions/45525533/does-iterating-over-an-iterator-and-mutating-a-value-change-the-value-in-the-col/45525755#45525755", "title": "Does iterating over an iterator and mutating a value change the value in the collection?", "body": "<blockquote>\n  <p>does it actually change the value in the map </p>\n</blockquote>\n\n<p><strong>No</strong>. In fact; the <em>map no longer exists</em>:</p>\n\n<pre><code>for (key, mut value) in map { /* ... */ }    \nprintln!(\"{:?}\", map);\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0382]: use of moved value: `map`\n  --&gt; src/main.rs:14:22\n   |\n7  |     for (key, mut value) in map {\n   |                             --- value moved here\n...\n14 |     println!(\"{:?}\", map);\n   |                      ^^^ value used here after move\n   |\n   = note: move occurs because `map` has type `std::collections::HashMap&lt;u32, u32&gt;`, which does not implement the `Copy` trait\n</code></pre>\n\n<p>You've <em>transferred ownership</em> of the map and all of the keys and values to the iterator. It's gone. Note that the map isn't even declared as mutable, so there's no way you could make changes to it.</p>\n\n<p>If you <em>wanted</em> to modify all the values, you could:</p>\n\n<pre><code>let mut map: HashMap&lt;u32, u32&gt; = HashMap::new();\n\nfor (_key, value) in &amp;mut map {\n    if *value == 0u32 {\n        *value = 1u32;\n    }\n    println!(\"{}\", value);\n}\n</code></pre>\n\n<p>Note how now we have a <em>reference</em> to the keys and values, not the value itself.</p>\n\n<blockquote>\n  <p>with Rust iterators in general</p>\n</blockquote>\n\n<p>It depends on what iterators the item exposes. If there's an iterator of mutable references of some kind, then yes.</p>\n"}], "owner": {"reputation": 599, "user_id": 1907778, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/6c218938854094046cff901c6dec7140?s=128&d=identicon&r=PG", "display_name": "5-to-9", "link": "https://stackoverflow.com/users/1907778/5-to-9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "accepted_answer_id": 45525755, "answer_count": 1, "score": 1, "last_activity_date": 1501966259, "creation_date": 1501960412, "last_edit_date": 1501966259, "question_id": 45525533, "link": "https://stackoverflow.com/questions/45525533/does-iterating-over-an-iterator-and-mutating-a-value-change-the-value-in-the-col", "title": "Does iterating over an iterator and mutating a value change the value in the collection?", "body": "<p>I have a <code>HashMap&lt;u32, u32&gt;</code> and I use it as an iterator:</p>\n\n<pre><code>for (key, mut value) in map {\n    if value == 0u32 {\n        value = 1u32;\n    }\n    println!(\"{}\", value);\n} \n</code></pre>\n\n<p>This compiles and prints out the expected values, but does it actually change the value in the map while I'm iterating it, or am I just shadowing the actual value and the value is written over after the iterator finishes?</p>\n\n<p>Am I correct in assuming that mutating while iterating works with Rust iterators in general?</p>\n"}, {"tags": ["c", "string", "char", "rust", "ffi"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1501962178, "post_id": 45523680, "comment_id": 78011645, "body": "<i>must have exactly one entry point that is responsible for creating all necessary structures</i> \u2014 that&#39;s known as a &quot;singleton&quot;."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1501962513, "post_id": 45523680, "comment_id": 78011732, "body": "Note that your current code is <b>not</b> thread safe, and is likely to have issues. That&#39;s why a <code>static mut</code> requires <code>unsafe</code>."}], "owner": {"reputation": 2503, "user_id": 4737924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06ff2f73692374431f3ddba82498dd9b?s=128&d=identicon&r=PG", "display_name": "Aleksander Wons", "link": "https://stackoverflow.com/users/4737924/aleksander-wons"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 56, "favorite_count": 0, "closed_date": 1501962136, "answer_count": 0, "score": 0, "last_activity_date": 1501962148, "creation_date": 1501947657, "last_edit_date": 1501961653, "question_id": 45523680, "link": "https://stackoverflow.com/questions/45523680/is-there-a-different-way-to-return-strings-allocated-in-rust-to-c-than-to-use-st", "closed_reason": "Duplicate", "title": "Is there a different way to return strings allocated in Rust to C than to use static mut", "body": "<p>I am writing a POC for a binding to PHP's Zend Engine.</p>\n\n<p>The library must have exactly one entry point that is responsible for creating all necessary structures.</p>\n\n<p>Parts of those structures are <code>*const ::std::os::raw::c_char</code> fields.</p>\n\n<p>Right now to allocate each string I am using the following construct:</p>\n\n<pre><code>static mut BUILD_ID: Option&lt;CString&gt; = None;\n\n// then in my function:\nunsafe {\n    BUILD_ID = Some(CString::new(self.build_id).unwrap());\n\n    Box::new(zend_module_entry {\n        build_id: match BUILD_ID {\n            Some(ref x) =&gt; x.as_ptr(),\n            None =&gt; panic!(),\n        },\n    })\n}\n</code></pre>\n\n<p>To deallocate the memory I need:</p>\n\n<pre><code>unsafe {\n    let _ = BUILD_ID.take().unwrap();\n}\n</code></pre>\n\n<p>Is there a way to do this without <code>static mut</code>?</p>\n"}, {"tags": ["rust", "borrow-checker", "borrowing"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1501941975, "post_id": 45522745, "comment_id": 78005737, "body": "Please only post <a href=\"https://meta.stackexchange.com/q/39223/281829\">one question per question</a>, please."}, {"owner": {"reputation": 19030, "user_id": 69746, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8bb00903daaba6a14c238611b21ab677?s=128&d=identicon&r=PG", "display_name": "Xolve", "link": "https://stackoverflow.com/users/69746/xolve"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1502347133, "post_id": 45522745, "comment_id": 78171091, "body": "These are related questions related to same concept, so posting three separate questions wouldn&#39;t be fruitful."}], "answers": [{"tags": [], "owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "is_accepted": false, "score": 2, "last_activity_date": 1501942243, "creation_date": 1501942243, "answer_id": 45522843, "question_id": 45522745, "link": "https://stackoverflow.com/questions/45522745/how-to-know-when-a-borrow-ends/45522843#45522843", "title": "How to know when a borrow ends", "body": "<p>The problem in your code is that you bind the result of <code>line.split_whitespace()</code> to a name (<code>parts</code>). If you write this instead:</p>\n\n<pre><code>io::stdin().read_line(&amp;mut line)\n    .expect(\"Cannot read line.\");\n\nfor p in line.split_whitespace() {   // &lt;-- pass directly into loop\n    println!(\"{}\", p);\n}\n\nline.clear();\nio::stdin().read_line(&amp;mut line)\n    .expect(\"Cannot read line.\");\n</code></pre>\n\n<p>That way it just works. Another possibility is to artificially restrict the lifetimes of <code>parts</code>, like so:</p>\n\n<pre><code>io::stdin().read_line(&amp;mut line)\n    .expect(\"Cannot read line.\");\n\n{\n    let parts = line.split_whitespace();\n\n    for p in parts {\n        println!(\"{}\", p);\n    }\n}\n\nline.clear();\nio::stdin().read_line(&amp;mut line)\n    .expect(\"Cannot read line.\");\n</code></pre>\n\n<p>This also works.</p>\n\n<hr>\n\n<p><strong>So why is that?</strong> This is due to how the compiler currently works, often called \"lexical borrows\". The problem here is that each non-temporary value which contains a borrow will be \"alive\" until the end of its scope.</p>\n\n<p>In your case: since you assign the result of <code>split_whitespace()</code> (which borrows the string) to <code>parts</code>, the borrow is \"alive\" until the end of scope of <code>parts</code>. <strong>Not</strong> until the end of life of <code>parts</code>. </p>\n\n<p>In the first version in this answer, we don't bind a name to the value, thus the result of <code>split_whitespace()</code> is only a temporary and the borrow doesn't extend out the the whole scope. That's also why your <code>collect()</code> example works: not because of <code>collect()</code>, but because there is never a name bound to something borrowing the string. In my second version, we just restrict the scope.</p>\n\n<p>Note, that this is a known shortcoming of the compiler. You are right, the compiler just doesn't see it.</p>\n"}], "owner": {"reputation": 19030, "user_id": 69746, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8bb00903daaba6a14c238611b21ab677?s=128&d=identicon&r=PG", "display_name": "Xolve", "link": "https://stackoverflow.com/users/69746/xolve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1501942243, "creation_date": 1501941655, "last_edit_date": 1501941943, "question_id": 45522745, "link": "https://stackoverflow.com/questions/45522745/how-to-know-when-a-borrow-ends", "title": "How to know when a borrow ends", "body": "<p>I wrote this for simple input parsing:</p>\n\n<pre><code>use std::io;\n\nfn main() {\n    let mut line = String::new();\n\n    io::stdin().read_line(&amp;mut line)\n        .expect(\"Cannot read line.\");\n\n    let parts = line.split_whitespace();\n\n    for p in parts {\n        println!(\"{}\", p);\n    }\n\n    line.clear();\n    io::stdin().read_line(&amp;mut line)\n        .expect(\"Cannot read line.\");\n\n}\n</code></pre>\n\n<p>The above code creates a <code>String</code> object, reads a line into it, splits it by whitespace and prints he output. Then it tries to do the same using the same <code>String</code> object. On compilation I get error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>  --&gt; src/main.rs:15:5\n   |\n9  |     let parts = line.split_whitespace();\n   |                 ---- immutable borrow occurs here\n...\n15 |     line.clear();\n   |     ^^^^ mutable borrow occurs here\n...\n19 | }\n   | - immutable borrow ends here\n</code></pre>\n\n<p>As <code>String</code> is <a href=\"https://users.rust-lang.org/t/the-best-practice-to-solve-error-e0502/9856\" rel=\"nofollow noreferrer\">owned by an iterator</a>. The solution is described as:</p>\n\n<pre><code>let parts: Vec&lt;String&gt; = line.split_whitespace()\n    .map(|s| String::from(s))\n    .collect();\n</code></pre>\n\n<p>I have few questions here:</p>\n\n<ol>\n<li>I have already consumed the iterator by calling for each on it. Its borrow should have ended.</li>\n<li>How do I know lifetimes of borrow from function definitions?</li>\n<li>If a function is borrowing an object how do I know its releasing it? e.g. in solution using <code>collect()</code> releases the borrow.</li>\n</ol>\n\n<p>I think I am missing an important concept here.</p>\n"}, {"tags": ["rust", "node.js-addon"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1501944860, "post_id": 45521530, "comment_id": 78006622, "body": "I see that you <a href=\"https://github.com/neon-bindings/neon/issues/218\" rel=\"nofollow noreferrer\">opened an issue in the neon repository</a> \u2014 did you also read the <a href=\"https://github.com/neon-bindings/neon/issues/57\" rel=\"nofollow noreferrer\">existing issue about <code>JsArray</code></a>?"}, {"owner": {"reputation": 4834, "user_id": 3142367, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/0hqcO.jpg?s=128&g=1", "display_name": "pietrovismara", "link": "https://stackoverflow.com/users/3142367/pietrovismara"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1501945478, "post_id": 45521530, "comment_id": 78006806, "body": "@Shepmaster Found the way, sorry if i&#39;ve been rude, thanks for helping."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1501945721, "post_id": 45521530, "comment_id": 78006878, "body": "No worries; I totally understand how trying struggling to pick up a new language or library can be frustrating! The good news is that it looks like a bunch of other people have had the same underlying problem."}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1501941492, "post_id": 45522590, "comment_id": 78005573, "body": "<i>something like this may work</i> \u2014 why not try it out instead of guessing?"}, {"owner": {"reputation": 13280, "user_id": 435253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80df0d0f2a1945a7bed366ff25f8ea5d?s=128&d=identicon&r=PG", "display_name": "ssokolow", "link": "https://stackoverflow.com/users/435253/ssokolow"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 2, "creation_date": 1501942176, "post_id": 45522590, "comment_id": 78005786, "body": "@Shepmaster Neon isn&#39;t part of the Rust Playground and I don&#39;t have time to muddle my way through setting up a test environment on my own machine right now. (I&#39;ve never used Node.js beyond <code>npm install -g</code>. If it were a <code>rust-cpython</code> question, I could just slap a line into one of my existing projects for a quick test.)"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1501942425, "post_id": 45522590, "comment_id": 78005876, "body": "You don&#39;t have to set anything up. It&#39;s dynamically linked, so you can get the Rust code to compile and then it will just fail to link later."}, {"owner": {"reputation": 4834, "user_id": 3142367, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/0hqcO.jpg?s=128&g=1", "display_name": "pietrovismara", "link": "https://stackoverflow.com/users/3142367/pietrovismara"}, "edited": false, "score": 0, "creation_date": 1501943700, "post_id": 45522590, "comment_id": 78006247, "body": "I tested your solutions and found the last one working, but i still have a problem. Could you look at my edit?"}, {"owner": {"reputation": 4834, "user_id": 3142367, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/0hqcO.jpg?s=128&g=1", "display_name": "pietrovismara", "link": "https://stackoverflow.com/users/3142367/pietrovismara"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1501944063, "post_id": 45522590, "comment_id": 78006351, "body": "@Shepmaster at least ssokolow is trying to help. Can&#39;t tell the same for you."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1501944138, "post_id": 45522590, "comment_id": 78006380, "body": "Note that <a href=\"https://api.neon-bindings.com/neon/js/trait.object#method.set\" rel=\"nofollow noreferrer\"><code>set</code></a> takes self by value."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 4834, "user_id": 3142367, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/0hqcO.jpg?s=128&g=1", "display_name": "pietrovismara", "link": "https://stackoverflow.com/users/3142367/pietrovismara"}, "edited": false, "score": 3, "creation_date": 1501944466, "post_id": 45522590, "comment_id": 78006488, "body": "@pietrovismara I&#39;m sorry that that&#39;s the impression I&#39;ve left. My primary goal is not to help any <i>one</i> person, but to push questions and answers to be the best they can be for <b>everyone</b> who comes later. That&#39;s the point of Stack Overflow - to be a repository of information so we never need to answer the same question twice. An &quot;answer&quot; that says &quot;this may work&quot; doesn&#39;t help those who come afterwards. A question with content that doesn&#39;t match the title will never be found by those who need it."}], "tags": [], "owner": {"reputation": 13280, "user_id": 435253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80df0d0f2a1945a7bed366ff25f8ea5d?s=128&d=identicon&r=PG", "display_name": "ssokolow", "link": "https://stackoverflow.com/users/435253/ssokolow"}, "is_accepted": false, "score": 1, "last_activity_date": 1502025711, "last_edit_date": 1502025711, "creation_date": 1501940582, "answer_id": 45522590, "question_id": 45521530, "link": "https://stackoverflow.com/questions/45521530/cant-use-a-neon-jsarray-this-function-takes-3-parameters-but-2-were-supplied/45522590#45522590", "title": "Can&#39;t use a neon JsArray: This function takes 3 parameters but 2 were supplied", "body": "<p><code>let js_arr: Handle&lt;JsArray&gt;</code> makes it clear that <code>js_arr</code> is a <code>Handle&lt;JsArray&gt;</code> and <a href=\"https://api.neon-bindings.com/neon/mem/struct.handle\" rel=\"nofollow noreferrer\"><code>Handle&lt;T&gt;</code></a> has this method:</p>\n\n<pre><code>unsafe fn set(self, out: &amp;mut bool, obj: Local, val: Local) -&gt; bool\n</code></pre>\n\n<p>I'd guess that you're accidentally trying to call <a href=\"https://api.neon-bindings.com/neon/mem/struct.handle#set.v\" rel=\"nofollow noreferrer\"><code>Handle::set</code></a> (which is <code>unsafe</code> and takes three non-<code>self</code> arguments) rather than <a href=\"https://api.neon-bindings.com/neon/js/struct.jsarray#set.v\" rel=\"nofollow noreferrer\"><code>JsArray::set</code></a> (which is safe and takes two non-<code>self</code> arguments).</p>\n\n<p>If that's the case, you need to force a <a href=\"https://api.neon-bindings.com/neon/mem/struct.handle#deref_mut.v\" rel=\"nofollow noreferrer\"><code>deref_mut</code></a> to occur. (<code>_mut</code> because <code>JsArray::set</code> takes <code>&amp;mut self</code>.)</p>\n\n<p>I haven't run into this sort of naming collision before, so I can't be certain whether the <a href=\"https://doc.rust-lang.org/book/first-edition/deref-coercions.html\" rel=\"nofollow noreferrer\">auto-deref</a> is smart enough, but something like this may work:</p>\n\n<pre><code>(&amp;mut js_arr).set(0, JsNumber::new(scope, 1000));\n</code></pre>\n\n<p>Failing that, two other things to try are:</p>\n\n<ol>\n<li><p><code>JsArray::set(&amp;mut js_arr, 0, JsNumber::new(scope, 1000));</code></p>\n\n<p>(If the former example fails because it's too much like C++-style method overloading. This is known as <a href=\"https://doc.rust-lang.org/stable/book/second-edition/ch19-03-advanced-traits.html#fully-qualified-syntax-for-disambiguation\" rel=\"nofollow noreferrer\">Fully Qualified Syntax</a> and is normally used to disambiguate when an object implements two traits which provide methods of the same name.)</p></li>\n<li><p>Call <a href=\"https://api.neon-bindings.com/neon/mem/struct.handle#deref_mut.v\" rel=\"nofollow noreferrer\"><code>js_arr.deref_mut()</code></a> directly to get a mutable reference to the underlying <code>JsArray</code>, then call <code>set</code> on that.</p></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1501945583, "post_id": 45523274, "comment_id": 78006829, "body": "@pietrovismara <i>I already imported <code>JsObject</code></i> \u2014 not the <b>type</b> <code>JsObject</code>, the <b>trait</b> <code>Object</code>. There&#39;s a difference, which would explain why it didn&#39;t work."}, {"owner": {"reputation": 4834, "user_id": 3142367, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/0hqcO.jpg?s=128&g=1", "display_name": "pietrovismara", "link": "https://stackoverflow.com/users/3142367/pietrovismara"}, "edited": false, "score": 0, "creation_date": 1501945679, "post_id": 45523274, "comment_id": 78006862, "body": "That&#39;s true (typo), but if you look at my question, you can see that i also imported <code>Object</code>. I guess maybe the order of the import or something else made the difference?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 4834, "user_id": 3142367, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/0hqcO.jpg?s=128&g=1", "display_name": "pietrovismara", "link": "https://stackoverflow.com/users/3142367/pietrovismara"}, "edited": false, "score": 1, "creation_date": 1501963866, "post_id": 45523274, "comment_id": 78012103, "body": "@pietrovismara ah, figured it out; it&#39;s about <code>Key</code> \u2014 that adds another method called <code>set</code> that causes the problem."}, {"owner": {"reputation": 4834, "user_id": 3142367, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/0hqcO.jpg?s=128&g=1", "display_name": "pietrovismara", "link": "https://stackoverflow.com/users/3142367/pietrovismara"}, "edited": false, "score": 0, "creation_date": 1501965203, "post_id": 45523274, "comment_id": 78012491, "body": "really interesting, i didn&#39;t know that methods could be overridden like this. So much to learn about Rust yet!"}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 2, "last_activity_date": 1501963840, "last_edit_date": 1501963840, "creation_date": 1501945013, "answer_id": 45523274, "question_id": 45521530, "link": "https://stackoverflow.com/questions/45521530/cant-use-a-neon-jsarray-this-function-takes-3-parameters-but-2-were-supplied/45523274#45523274", "title": "Can&#39;t use a neon JsArray: This function takes 3 parameters but 2 were supplied", "body": "<p>As <a href=\"https://github.com/neon-bindings/neon/issues/57#issuecomment-310842980\" rel=\"nofollow noreferrer\">paulsevere says on a GitHub issue for Neon</a>, import <code>neon::js::Object</code>. In addition, do <strong>not</strong> import <code>Key</code>, which also provides a <code>set</code> method:</p>\n\n<pre><code>#[macro_use]\nextern crate neon;\n\nuse neon::vm::{Call, JsResult};\nuse neon::js::{Object, JsArray, JsInteger, JsObject, JsNumber};\n\nfn make_an_array(call: Call) -&gt; JsResult&lt;JsArray&gt; {\n    let scope = call.scope; // the current scope for rooting handles\n    let array = JsArray::new(scope, 3);\n    array.set(0, JsInteger::new(scope, 9000))?;\n    array.set(1, JsObject::new(scope))?;\n    array.set(2, JsNumber::new(scope, 3.14159))?;\n    Ok(array)\n}\n\nregister_module!(m, {\n    m.export(\"main\", make_an_array)\n});\n</code></pre>\n\n<p>This creates a brand new array. If you'd like to accept an array as the first argument to your function and then modify it, this works:</p>\n\n<pre><code>#[macro_use]\nextern crate neon;\n\nuse neon::vm::{Call, JsResult};\nuse neon::js::{Object, JsArray, JsInteger, JsUndefined};\nuse neon::mem::Handle;\n\nfn hello(call: Call) -&gt; JsResult&lt;JsUndefined&gt; {\n    let scope = call.scope;\n    let js_arr: Handle&lt;JsArray&gt; = call.arguments.require(scope, 0)?.check::&lt;JsArray&gt;()?;\n\n    js_arr.set(0, JsInteger::new(scope, 1000))?;\n\n    Ok(JsUndefined::new())\n}\n\nregister_module!(m, {\n    m.export(\"hello\", hello)\n});\n</code></pre>\n"}], "owner": {"reputation": 4834, "user_id": 3142367, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/0hqcO.jpg?s=128&g=1", "display_name": "pietrovismara", "link": "https://stackoverflow.com/users/3142367/pietrovismara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 759, "favorite_count": 0, "accepted_answer_id": 45523274, "answer_count": 2, "score": 1, "last_activity_date": 1502025711, "creation_date": 1501933672, "last_edit_date": 1501945422, "question_id": 45521530, "link": "https://stackoverflow.com/questions/45521530/cant-use-a-neon-jsarray-this-function-takes-3-parameters-but-2-were-supplied", "title": "Can&#39;t use a neon JsArray: This function takes 3 parameters but 2 were supplied", "body": "<p>I'm learning how to use neon, but I don't understand a thing. If I try to execute this code:</p>\n\n<pre><code>#[macro_use]\nextern crate neon;\nuse neon::vm::{Call, JsResult};\nuse neon::mem::Handle;\nuse neon::js::{JsInteger, JsNumber, JsString, JsObject, JsArray, JsValue, Object, Key};\nuse neon::js::error::{JsError, Kind};\n\nfn test(call: Call) -&gt; JsResult&lt;JsArray&gt; {\n    let scope = call.scope;\n    let js_arr: Handle&lt;JsArray&gt; = try!(try!(call.arguments.require(scope, 1)).check::&lt;JsArray&gt;());\n\n    js_arr.set(0, JsNumber::new(scope, 1000));\n\n    Ok(js_arr)\n}\n\nregister_module!(m, {\n    m.export(\"test\", test)\n});\n</code></pre>\n\n<p>I get this error when I call <code>js_arr.set</code>: <code>This function takes 3 parameters but 2 were supplied.</code></p>\n\n<p>I don't understand why since it's a <code>JsArray</code>. Even Racer tells me that the set method takes 2 parameters. No matter what, <code>js_arr.set</code> takes 3 parameters in this order: <code>&amp;mut bool</code>, <code>neon::macro_internal::runtime::raw::Local</code> and <code>neon::macro_internal::runtime::raw::Local</code>.</p>\n\n<p>What's happening? I can't understand how <code>JsArray</code> works.</p>\n"}, {"tags": ["stream", "rust"], "comments": [{"owner": {"reputation": 34798, "user_id": 1362755, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97aa8c37ffa60c4262955aefae56e605?s=128&d=identicon&r=PG", "display_name": "the8472", "link": "https://stackoverflow.com/users/1362755/the8472"}, "edited": false, "score": 0, "creation_date": 1501934766, "post_id": 45520954, "comment_id": 78003650, "body": "Is <code>stream</code> limited to a <code>Read</code> trait or can you choose a more concrete type?"}, {"owner": {"reputation": 435, "user_id": 6517909, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/542422dbe372e54be780ad815e253206?s=128&d=identicon&r=PG&f=1", "display_name": "Doe", "link": "https://stackoverflow.com/users/6517909/doe"}, "reply_to_user": {"reputation": 34798, "user_id": 1362755, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97aa8c37ffa60c4262955aefae56e605?s=128&d=identicon&r=PG", "display_name": "the8472", "link": "https://stackoverflow.com/users/1362755/the8472"}, "edited": false, "score": 0, "creation_date": 1501939880, "post_id": 45520954, "comment_id": 78005113, "body": "Any type is acceptable as long as the underlying source of bytes can be any object that implements <code>Read</code>."}], "answers": [{"tags": [], "owner": {"reputation": 26934, "user_id": 8316315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44d833a8a46fea39d7bfca1540ea9c07?s=128&d=identicon&r=PG&f=1", "display_name": "Florian Weimer", "link": "https://stackoverflow.com/users/8316315/florian-weimer"}, "is_accepted": false, "score": 4, "last_activity_date": 1501930743, "creation_date": 1501930743, "answer_id": 45521127, "question_id": 45520954, "link": "https://stackoverflow.com/questions/45520954/how-can-bytes-be-shoved-back-into-a-read-implementing-type-in-rust/45521127#45521127", "title": "How can bytes be shoved back into a Read implementing type in Rust?", "body": "<p>Have a look at the <a href=\"https://doc.rust-lang.org/std/io/trait.Read.html#method.chain\" rel=\"nofollow noreferrer\"><code>chain</code> method of <code>std::io::read</code></a> and its example (slightly modified here):</p>\n\n<pre><code>fn main() {\n    use std::io::prelude::*;\n    use std::fs::File;\n\n    let f1 = File::open(\"foo.txt\").unwrap();\n    let f2 = File::open(\"bar.txt\").unwrap();\n\n    let mut handle = f1.chain(f2);\n\n    let mut buffer = String::new();\n    handle.read_to_string(&amp;mut buffer).unwrap();\n    println!(\"{:?}\", buffer);\n}\n</code></pre>\n\n<p>There is no way to do this with the original <code>Read</code> object because the trait simply does not provide this facility.  If you need some form of lookahead, you need to look at the <a href=\"https://doc.rust-lang.org/std/io/trait.BufRead.html\" rel=\"nofollow noreferrer\"><code>BufRead</code> trait</a> or the <a href=\"https://doc.rust-lang.org/std/io/struct.BufReader.html\" rel=\"nofollow noreferrer\"><code>BufReader</code> struct</a>, although its lookahead support is quite limited.</p>\n"}, {"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 2, "last_activity_date": 1502196281, "last_edit_date": 1502196281, "creation_date": 1501942955, "answer_id": 45522965, "question_id": 45520954, "link": "https://stackoverflow.com/questions/45520954/how-can-bytes-be-shoved-back-into-a-read-implementing-type-in-rust/45522965#45522965", "title": "How can bytes be shoved back into a Read implementing type in Rust?", "body": "<p>Think of the problem the other way around: how can I only read some bytes in certain cases. Then you can use the <a href=\"https://doc.rust-lang.org/std/io/trait.BufRead.html\" rel=\"nofollow noreferrer\"><code>BufRead</code></a> trait:</p>\n\n<pre><code>use std::fs::File;\nuse std::io::{BufRead, BufReader};\n\nfn main() {\n    let f = File::open(\"/etc/hosts\").expect(\"unable to open\");\n    let mut f = BufReader::new(f);\n\n    {\n        let bytes = f.fill_buf().expect(\"cannot read\");\n        println!(\"{:?}\", bytes[0]);\n    }\n\n    if some_condition() {\n        f.consume(2);\n    }\n\n    {\n        let bytes = f.fill_buf().expect(\"cannot read\");\n        println!(\"{:?}\", bytes[0]);\n    }\n}\n</code></pre>\n\n<hr>\n\n<p>In rare cases where you need to add data that <em>wasn't</em> part of the original source, then using <code>chain</code>, as <a href=\"https://stackoverflow.com/a/45521127/155423\">Florian Weimer shows</a>, is likely more appropriate. In the rarer cases where that doesn't work, you can write what you need:</p>\n\n<pre><code>use std::fs::File;\nuse std::io::{self, Read};\nuse std::cmp::min;\n\n/// Warning: lightly tested; never shrinks\nstruct PushableRead&lt;R&gt; {\n    extra: Vec&lt;u8&gt;,\n    offset: usize,\n    inner: R,\n}\n\nimpl&lt;R&gt; PushableRead&lt;R&gt;\nwhere\n    R: Read,\n{\n    fn new(inner: R) -&gt; Self {\n        Self {\n            extra: Vec::new(),\n            offset: 0,\n            inner,\n        }\n    }\n\n    fn push(&amp;mut self, bytes: &amp;[u8]) {\n        self.extra.extend(bytes)\n    }\n}\n\nimpl&lt;R&gt; Read for PushableRead&lt;R&gt;\nwhere\n    R: Read,\n{\n    fn read(&amp;mut self, buf: &amp;mut [u8]) -&gt; io::Result&lt;usize&gt; {\n        let extra_bytes = self.extra.len() - self.offset;\n\n        if extra_bytes &gt; 0 {\n            let to_copy = min(extra_bytes, buf.len());\n\n            let dst = &amp;mut buf[0..to_copy];\n            let src = &amp;self.extra[self.offset..self.offset + to_copy];\n\n            dst.copy_from_slice(src);\n            self.offset += to_copy;\n            Ok(to_copy)\n        } else {\n            self.inner.read(buf)\n        }\n    }\n}\n\nfn main() {\n    let f = File::open(\"/etc/hosts\").expect(\"unable to open\");\n    let mut f = PushableRead::new(f);\n\n    f.push(b\"This is extra junk\");\n\n    let mut data = Vec::new();\n    f.read_to_end(&amp;mut data).expect(\"Unable to read\");\n\n    println!(\"{:?}\", std::str::from_utf8(&amp;data));\n}\n</code></pre>\n"}], "owner": {"reputation": 435, "user_id": 6517909, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/542422dbe372e54be780ad815e253206?s=128&d=identicon&r=PG&f=1", "display_name": "Doe", "link": "https://stackoverflow.com/users/6517909/doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 1, "accepted_answer_id": 45522965, "answer_count": 2, "score": 2, "last_activity_date": 1502196281, "creation_date": 1501929626, "last_edit_date": 1501940926, "question_id": 45520954, "link": "https://stackoverflow.com/questions/45520954/how-can-bytes-be-shoved-back-into-a-read-implementing-type-in-rust", "title": "How can bytes be shoved back into a Read implementing type in Rust?", "body": "<p>Is there a <code>Read</code> stream type in the standard library that supports \"shoving\" bytes back into the stream, such that a subsequent read would return said bytes first, before other bytes in the stream?</p>\n\n<pre><code>n = stream.read(&amp;mut buf).unwrap();\nif ... {\n    stream.???PUT_BACK???(&amp;buf[..n])\n}\n</code></pre>\n"}, {"tags": ["rust", "visual-studio-2017"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1501942218, "post_id": 45520701, "comment_id": 78005801, "body": "Generally, Windows error codes are referred to by their hex representation. Chances are good that you have installed a 64-bit version of the software when you have a 32-bit OS or vice-versa."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1501942506, "post_id": 45520701, "comment_id": 78005912, "body": "If none of the numerous existing Stack Overflow questions about the error solve your problem, please update your question showing all of them that you tried and what you did and we can reopen."}], "owner": {"reputation": 355, "user_id": 5955876, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5b29bb86b71b9c789283bd5180355d5c?s=128&d=identicon&r=PG&f=1", "display_name": "Count Zero", "link": "https://stackoverflow.com/users/5955876/count-zero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1063, "favorite_count": 0, "closed_date": 1501942109, "answer_count": 0, "score": 0, "last_activity_date": 1501942168, "creation_date": 1501927817, "last_edit_date": 1501940999, "question_id": 45520701, "link": "https://stackoverflow.com/questions/45520701/how-do-i-fix-link-exe-failed-exit-code-3221225595-when-compiling-a-rust-progra", "closed_reason": "Duplicate", "title": "How do I fix link.exe failed: exit code: 3221225595 when compiling a Rust program?", "body": "<p>I have installed Rust 1.19 and Visual Studio 2017 Community, but rustc prints this message when I try to compile a file with it:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>linking with `link.exe` failed: exit code: 3221225595\n</code></pre>\n"}, {"tags": ["import", "rust"], "comments": [{"owner": {"reputation": 4515, "user_id": 4808079, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/hXTld.jpg?s=128&g=1", "display_name": "Seph Reed", "link": "https://stackoverflow.com/users/4808079/seph-reed"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1502000610, "post_id": 45519176, "comment_id": 78018717, "body": "No, I linked that above.  It&#39;s only clear to you because it&#39;s familiar.  Nowhere in there is an include that implies file system navigation, ie <code>&#47;path&#47;to&#47;include.rs</code>.  Python does a similar thing of getting rid of the extension on imports, and I personally find it non-idiomatic.  It makes imports not look like they relate to a path."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1502025341, "post_id": 45519176, "comment_id": 78024726, "body": "Not, you did not link to the section I linked to. The one I linked to has this text: <i>Next, let\u2019s extract the network module into its own file using the same pattern [...] Then create a <b>new src/network.rs file</b> and enter the following</i>. I&#39;m unclear which part of that section is hard to understand."}, {"owner": {"reputation": 4515, "user_id": 4808079, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/hXTld.jpg?s=128&g=1", "display_name": "Seph Reed", "link": "https://stackoverflow.com/users/4808079/seph-reed"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1502061080, "post_id": 45519176, "comment_id": 78034915, "body": "It&#39;s within a few chapters.  I read the whole book up to that point, and either of these two chapters seemed like where I would find my answer, but did not."}], "answers": [{"comments": [{"owner": {"reputation": 4515, "user_id": 4808079, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/hXTld.jpg?s=128&g=1", "display_name": "Seph Reed", "link": "https://stackoverflow.com/users/4808079/seph-reed"}, "edited": false, "score": 4, "creation_date": 1502001238, "post_id": 45520092, "comment_id": 78018863, "body": "Thank you very much, I really appreciate it, and I think others may as well.  As basic as this is, it is a necessary step for people learning alone.  It may seem obvious that mod can be used to include things with or without the &#39;.rs&#39; extension, but to a new comer it appears to only be used for pulling files from some unknown dictionary (similar to io, or Math).  Yours is the first example I have seen of a <code>mod</code> referencing a <code>*.rs</code> file anywhere, and I really appreciate you sharing this syntax."}, {"owner": {"reputation": 111538, "user_id": 63756, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e159cb326f8d203488d3d9d0e5e98a46?s=128&d=identicon&r=PG", "display_name": "womp", "link": "https://stackoverflow.com/users/63756/womp"}, "edited": false, "score": 2, "creation_date": 1559095102, "post_id": 45520092, "comment_id": 99308958, "body": "Thanks for the time you put into this answer.  Very useful."}], "tags": [], "owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "is_accepted": true, "score": 71, "last_activity_date": 1612689146, "last_edit_date": 1612689146, "creation_date": 1501923428, "answer_id": 45520092, "question_id": 45519176, "link": "https://stackoverflow.com/questions/45519176/how-do-i-use-or-import-a-local-rust-file/45520092#45520092", "title": "How do I &quot;use&quot; or import a local Rust file?", "body": "<p>There are basically two (main) ways in Rust to include code from somewhere else:</p>\n<h3>1. &quot;Including&quot; <em>internal</em> code</h3>\n<p>If your <code>include_me.rs</code> belongs to your project, you should move it to the same folder <code>main.rs</code> lies in:</p>\n<pre class=\"lang-none prettyprint-override\"><code>\u2514\u2500\u2500 src\n    \u251c\u2500\u2500 include_me.rs\n    \u2514\u2500\u2500 main.rs\n</code></pre>\n<p>Then you can write this in your <code>main.rs</code>:</p>\n<pre class=\"lang-rust prettyprint-override\"><code>mod include_me;\n\nfn main() {\n    // Call a function defined in the other file (module)\n    include_me::some_function();\n}\n</code></pre>\n<p>A <code>mod</code> declaration makes the Rust compiler look for the corresponding <code>.rs</code> files automatically!</p>\n<p>So everything that belongs to your project, belongs in the same folder (or a subfolder thereof) as the folder where <code>main.rs</code> (or <code>lib.rs</code>) is lying. The files are then &quot;included&quot; via the module system. To read a good introduction into modules, please read <a href=\"https://doc.rust-lang.org/book/ch07-00-managing-growing-projects-with-packages-crates-and-modules.html\" rel=\"noreferrer\">the chapter on modules in the Rust book</a>. You could also check out <a href=\"https://doc.rust-lang.org/rust-by-example/mod.html\" rel=\"noreferrer\">Rust by Example</a> on that topic. The module system is pretty central and thus important to learning Rust.</p>\n<h3>2. &quot;Including&quot; <em>external</em> code</h3>\n<p>If your <code>include_me.rs</code> is something that doesn't belong to your actual project, but is rather a collection of useful things you are using in multiple projects, it should be seen as a <em>library</em>. To include code of such external libraries, you have to include it as an extern crate. And to make your life easier, you really want to use Cargo!</p>\n<p>So let's prepare your <code>include_me.rs</code> as Cargo library project. You need the following file structure (which is automatically generated by <code>cargo new my_library --lib</code>):</p>\n<pre class=\"lang-none prettyprint-override\"><code>. my_library\n\u00a0 \u251c\u2500\u2500 Cargo.toml\n\u00a0 \u2514\u2500\u2500 src\n\u00a0     \u2514\u2500\u2500 lib.rs\n</code></pre>\n<p>Now copy all the contents from <code>include_me.rs</code> into <code>lib.rs</code> (it is just convention to call the root file of a library project <code>lib.rs</code>). Let's say that the <code>my_library</code> folder's full path is <code>~/code/my_library</code>.</p>\n<p>Now let's prepare your main project's Cargo project. It has a similar file\nstructure (but a <code>main.rs</code> instead of <code>lib.rs</code>, because it's a executable-project, not a library-project):</p>\n<pre class=\"lang-none prettyprint-override\"><code>. my_project\n\u251c\u2500\u2500 Cargo.toml\n\u2514\u2500\u2500 src\n    \u2514\u2500\u2500 main.rs\n</code></pre>\n<p>To declare your dependency on <code>my_library</code>, you have to put this into your <code>Cargo.toml</code>:</p>\n<pre><code>[package]\nname = &quot;my_project&quot;\nversion = &quot;0.1.0&quot;\nauthors = [&quot;you&quot;]\nedition = &quot;2018&quot;\n\n[dependencies]\nmy_library = { path = &quot;~/code/my_library&quot; }\n</code></pre>\n<p>You can also use relative paths (<code>&quot;../my_library&quot;</code>), but it only makes sense if you know that the two projects always stay where they are, relative to one another (like if they are both managed in the same repository).</p>\n<p>Now you can, in your <code>main.rs</code>, write:</p>\n<pre class=\"lang-rust prettyprint-override\"><code>use my_library::some_function();\n\nfn main() {\n    // Call a function defined in the other file (extern crate)\n    some_function();\n}\n</code></pre>\n<p>If you want to upload any of those two projects, you have to interact with <code>crates.io</code> (or another crates registry, if your company has one), but this is another topic.</p>\n<p>(<em>Note</em>: some time ago, it was necessary to write <code>extern crate my_library;</code> inside <code>main.rs</code>. This is not necessary anymore, but you might find old code with <code>extern crate</code> declarations.)</p>\n<h3>Any other ways?</h3>\n<p>Yes, but you shouldn't use those. There is <a href=\"https://doc.rust-lang.org/stable/std/macro.include.html\" rel=\"noreferrer\">the <code>include!()</code> macro</a> which allows you to verbatim include other files, just like the <code>#include</code> from C-land. <strong>However</strong>, it is strongly discouraged to use this in situations where the module system would be able to solve your problem. <code>include!()</code> is only useful in very special situations, often linked to a more complex build system which generates code.</p>\n"}], "owner": {"reputation": 4515, "user_id": 4808079, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/hXTld.jpg?s=128&g=1", "display_name": "Seph Reed", "link": "https://stackoverflow.com/users/4808079/seph-reed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 26051, "favorite_count": 12, "closed_date": 1502025394, "accepted_answer_id": 45520092, "answer_count": 1, "score": 35, "last_activity_date": 1612689146, "creation_date": 1501916054, "last_edit_date": 1502061043, "question_id": 45519176, "link": "https://stackoverflow.com/questions/45519176/how-do-i-use-or-import-a-local-rust-file", "closed_reason": "Duplicate", "title": "How do I &quot;use&quot; or import a local Rust file?", "body": "<p>How do I include a file with the full path <code>my_project/src/include_me.rs</code> in <code>main.rs</code>?</p>\n\n<p>I've checked the <a href=\"http://doc.crates.io/specifying-dependencies.html\" rel=\"noreferrer\">dependencies guide</a>, and all of them appear to be including a binary.  I've also checked <a href=\"https://doc.rust-lang.org/book/second-edition/ch07-03-importing-names-with-use.html\" rel=\"noreferrer\">\"The Book\"</a>, but none of the examples there end in \".rs\" either.</p>\n\n<p>How do I make <code>include_me.rs</code> compile with the rest of the project?</p>\n\n<p>EDIT: while the \"possible duplicate\" would be a great place to include the answer to this question, it is not inclusive of it.  The syntax in the top answer for this question is significantly more relevant, and glossed over in the question it \"duplicates\"</p>\n"}, {"tags": ["rust"], "answers": [{"tags": [], "owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "is_accepted": true, "score": 8, "last_activity_date": 1501899507, "creation_date": 1501899507, "answer_id": 45517603, "question_id": 45517514, "link": "https://stackoverflow.com/questions/45517514/getting-error-the-trait-stdopsfnmutchar-is-not-implemented-for-std/45517603#45517603", "title": "Getting error &quot;the trait `std::ops::FnMut&lt;(char,)&gt;` is not implemented for `std::string::String`&quot; for a simple type mismatch", "body": "<p>There's more to that error:</p>\n\n<pre><code>| assert!(mystring.ends_with(mystring));\n|                  ^^^^^^^^^ the trait `std::ops::FnMut&lt;(char,)&gt;` is not implemented for `std::string::String`\n|\n= note: required because of the requirements on the impl of `std::str::pattern::Pattern&lt;'_&gt;` for `std::string::String`\n</code></pre>\n\n<p>critically</p>\n\n<blockquote>\n  <p>note: required because of the requirements on the impl of <code>std::str::pattern::Pattern&lt;'_&gt;</code> for <code>std::string::String</code></p>\n</blockquote>\n\n<p><a href=\"https://doc.rust-lang.org/std/string/struct.String.html#method.ends_with\" rel=\"noreferrer\"><code>String</code>'s <code>.ends_with</code></a> accepts any value that implements the <code>Pattern</code> trait as its search pattern, and <code>String</code> does not implement that trait.</p>\n\n<p>If you look at <a href=\"https://doc.rust-lang.org/std/str/pattern/trait.Pattern.html\" rel=\"noreferrer\">the documentation for <code>Pattern</code></a>, it includes</p>\n\n<pre><code>impl&lt;'a, 'b&gt; Pattern&lt;'a&gt; for &amp;'b String\n</code></pre>\n\n<p>so your snippet works fine if you change</p>\n\n<pre><code>assert!(mystring.ends_with(mystring));\n</code></pre>\n\n<p>to</p>\n\n<pre><code>assert!(mystring.ends_with(&amp;mystring));\n</code></pre>\n\n<p>It also makes sense because otherwise you'd be trying to pass <em>ownership</em> of <code>mystring</code> to the <code>ends_with</code> function, which doesn't seem right.</p>\n\n<p>As for the specific error you were seeing, <code>Pattern</code>'s trait definition also includes</p>\n\n<pre><code>impl&lt;'a, F&gt; Pattern&lt;'a&gt; for F \nwhere\n    F: FnMut(char) -&gt; bool, \n</code></pre>\n\n<p>which generically says functions accepting a char and returning a boolean count as patterns, leading to the message saying <code>String</code> does not match that trait implementation.</p>\n"}], "owner": {"reputation": 6509, "user_id": 356011, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/d17ff41be1044be6fb5ef186b83efb20?s=128&d=identicon&r=PG", "display_name": "marathon", "link": "https://stackoverflow.com/users/356011/marathon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2123, "favorite_count": 1, "closed_date": 1501903468, "accepted_answer_id": 45517603, "answer_count": 1, "score": 2, "last_activity_date": 1501899507, "creation_date": 1501898194, "question_id": 45517514, "link": "https://stackoverflow.com/questions/45517514/getting-error-the-trait-stdopsfnmutchar-is-not-implemented-for-std", "closed_reason": "Duplicate", "title": "Getting error &quot;the trait `std::ops::FnMut&lt;(char,)&gt;` is not implemented for `std::string::String`&quot; for a simple type mismatch", "body": "<pre><code>    let mystring = format!(\"the quick brown {}\", \"fox...\");\n    assert!(mystring.ends_with(mystring));\n</code></pre>\n\n<p>Error:</p>\n\n<pre><code>the trait `std::ops::FnMut&lt;(char,)&gt;` is not implemented for `std::string::String`\n</code></pre>\n\n<p>Changing <code>mystring.ends_with(mystring)</code> to <code>mystring.ends_with(mystring.as_str())</code> fixes it.   </p>\n\n<p>Why is this error so cryptic?</p>\n\n<p>If I create the string without using format, say:</p>\n\n<pre><code>let mystring = String::from_str(\"The quick brown fox...\");\nassert!(mystring.ends_with(mystring));\n</code></pre>\n\n<p>The error is much more understandable:</p>\n\n<pre><code>error[E0599]: no method named `ends_with` found for type\n`std::result::Result&lt;std::string::String, std::string::ParseError&gt;`\nin the current scope\n</code></pre>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 0, "creation_date": 1501895481, "post_id": 45517265, "comment_id": 77995870, "body": "You&#39;ve made <code>appender</code> take ownership and return the new builder, so you need to put the return value somewhere. Did you choose this design on purpose? If you want the first example loop to work instead, you&#39;d need to pass it a mutable self reference instead."}, {"owner": {"reputation": 6509, "user_id": 356011, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/d17ff41be1044be6fb5ef186b83efb20?s=128&d=identicon&r=PG", "display_name": "marathon", "link": "https://stackoverflow.com/users/356011/marathon"}, "reply_to_user": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 0, "creation_date": 1501897309, "post_id": 45517265, "comment_id": 77996158, "body": "@loganfsmyth - sorry if I wasn&#39;t clear, that example is from the log4rs package.  <a href=\"https://crates.io/crates/log4rs\" rel=\"nofollow noreferrer\">crates.io/crates/log4rs</a>.  Not my design."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1501903608, "post_id": 45517265, "comment_id": 77996879, "body": "See also <a href=\"https://stackoverflow.com/q/34362094/155423\">stackoverflow.com/q/34362094/155423</a>"}, {"owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "edited": false, "score": 0, "creation_date": 1501923591, "post_id": 45517265, "comment_id": 78000854, "body": "Could you post the exact and full error message? It would help a lot."}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1501964835, "post_id": 45517265, "comment_id": 78012390, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/44904677/passing-a-variable-to-a-function-which-alters-said-variable-repeatedly\">Passing a variable to a function (which alters said variable) repeatedly</a>"}], "answers": [{"tags": [], "owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "is_accepted": true, "score": 6, "last_activity_date": 1501902463, "last_edit_date": 1501902463, "creation_date": 1501898446, "answer_id": 45517531, "question_id": 45517265, "link": "https://stackoverflow.com/questions/45517265/how-to-use-the-chained-builder-pattern-in-a-loop-without-creating-a-compiler-err/45517531#45517531", "title": "How to use the chained builder pattern in a loop without creating a compiler error?", "body": "<blockquote>\n  <p>Is this the only way to do it?</p>\n</blockquote>\n\n<p>Semantically it is the critical way, though there are other ways to write it. The <code>appender</code> function takes <code>mut self</code> so it will take ownership of the <code>cb</code> variable's value and make the variable unusable after that point. It could have been designed to borrow a reference, but chaining is nice. Since you're in a loop, the builder needs to be available on the next iteration, so you need to assign the value to something new. This means that</p>\n\n<pre><code>let mut cb = ConfigBuilder::new();\nfor x in ys {\n    cb = cb.appender(x);\n}\n</code></pre>\n\n<p>is indeed one way to do that. Another way would be to use <a href=\"https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.fold\" rel=\"noreferrer\"><code>Iterator</code>'s <code>.fold</code></a> to do</p>\n\n<pre><code>let cb = ys.into_iter()\n  .fold(ConfigBuilder::new(), |cb, x| cb.appender(x));\n</code></pre>\n\n<p>which keeps everything in one assignment, but is otherwise pretty much the same.</p>\n"}], "owner": {"reputation": 6509, "user_id": 356011, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/d17ff41be1044be6fb5ef186b83efb20?s=128&d=identicon&r=PG", "display_name": "marathon", "link": "https://stackoverflow.com/users/356011/marathon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 296, "favorite_count": 0, "accepted_answer_id": 45517531, "answer_count": 1, "score": 2, "last_activity_date": 1501902463, "creation_date": 1501895165, "last_edit_date": 1501897265, "question_id": 45517265, "link": "https://stackoverflow.com/questions/45517265/how-to-use-the-chained-builder-pattern-in-a-loop-without-creating-a-compiler-err", "title": "How to use the chained builder pattern in a loop without creating a compiler error?", "body": "<p>How do you properly use a builder pattern that expects <a href=\"https://en.wikipedia.org/wiki/Method_chaining\" rel=\"nofollow noreferrer\">method chaining</a> in a loop?  Using an example from <a href=\"https://crates.io/crates/log4rs\" rel=\"nofollow noreferrer\">log4rs</a>.  Notice <code>self</code> isn't a reference in <code>appender</code>. </p>\n\n<pre><code>//builder pattern from log4rs\n\npub struct ConfigBuilder {\n    appenders: Vec&lt;Appender&gt;,\n    loggers: Vec&lt;Logger&gt;,\n}\n\nimpl ConfigBuilder {\n    pub fn appender(mut self, appender: Appender) -&gt; ConfigBuilder {\n        self.appenders.push(appender);\n        self\n    }\n}\n</code></pre>\n\n<p>Doing this below results in an error because (I think) <code>cb</code> is getting moved to the memory being returned by <code>.appender()</code>.</p>\n\n<pre><code>let cb = ConfigBuilder::new();\nfor x in ys {\n    cb.appender(x);\n}\n</code></pre>\n\n<p>This below appears to work.  Is this the only way to do it?</p>\n\n<pre><code>let mut cb = ConfigBuilder::new();\nfor x in ys {\n    cb = cb.appender(x);\n}\n</code></pre>\n"}, {"tags": ["algorithm", "rust"], "comments": [{"owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 3, "creation_date": 1501895893, "post_id": 45517170, "comment_id": 77995943, "body": "Is doing this in-place by mutating <code>vec</code> an explicit goal? This seems like it would be dramatically easier to implement by making a new <code>Vec</code> and adding items to that instead of trying to change the original <code>vec</code>."}, {"owner": {"reputation": 2107, "user_id": 1968354, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5bf273b96c177d846813c35f7d1d214d?s=128&d=identicon&r=PG", "display_name": "NeatNerd", "link": "https://stackoverflow.com/users/1968354/neatnerd"}, "reply_to_user": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 0, "creation_date": 1501919536, "post_id": 45517170, "comment_id": 77999888, "body": "@loganfsmyth could be an option for a small vector, small data structure"}], "answers": [{"comments": [{"owner": {"reputation": 2107, "user_id": 1968354, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5bf273b96c177d846813c35f7d1d214d?s=128&d=identicon&r=PG", "display_name": "NeatNerd", "link": "https://stackoverflow.com/users/1968354/neatnerd"}, "edited": false, "score": 0, "creation_date": 1501919624, "post_id": 45517924, "comment_id": 77999907, "body": "great answer, thanks! i think i will go with copy for now, considering the size of interval structure - thats really a non-issue, im just wondering in general what I would have to do if Interval would be a decent sized structure"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 2107, "user_id": 1968354, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5bf273b96c177d846813c35f7d1d214d?s=128&d=identicon&r=PG", "display_name": "NeatNerd", "link": "https://stackoverflow.com/users/1968354/neatnerd"}, "edited": false, "score": 0, "creation_date": 1501945454, "post_id": 45517924, "comment_id": 78006799, "body": "@Windys <i>what I would have to do if <code>Interval</code> would be a decent sized structure</i> \u2014 if you had to use your original code, you can always use <code>unsafe</code> to force the compiler to allow you to type the code. It&#39;s then <b>up to you</b> to ensure that all the requirements are met. It&#39;s not valid to mutate an immutable reference or have multiple mutable references, even in <code>unsafe</code> code."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 7, "last_activity_date": 1501905386, "last_edit_date": 1501905386, "creation_date": 1501904253, "answer_id": 45517924, "question_id": 45517170, "link": "https://stackoverflow.com/questions/45517170/how-can-i-iterate-a-vector-once-and-insert-remove-modify-multiple-elements-along/45517924#45517924", "title": "How can I iterate a vector once and insert/remove/modify multiple elements along the way?", "body": "<p>In general, you <strong>can't</strong> because this is <em>exactly a class of bug that Rust prevents</em>. Examine this sequence of events where I've replaced <code>i</code> with unique variables since the compiler doesn't know what values will be used anyway.</p>\n\n<pre><code>let r = &amp;mut vec[i1];\nlet next = &amp;vec[i2];\nvec.remove(i3);\nvec[i4] = bigger.union(next);         \nvec.insert(i5, addition);\n</code></pre>\n\n<ul>\n<li>If you remove any value <em>before</em> <code>i1</code> or <code>i2</code> when you called <code>vec.remove(i3)</code>, then the references in <code>next</code> and <code>r</code> would be invalidated as all the values would move over.</li>\n<li>If <code>i5</code> is before <code>i1</code> or <code>i2</code>, then the same thing would happen, just in the other direction.</li>\n<li>If <code>i4</code> were equal to <code>i2</code>, then the <strong>immutable</strong> value of <code>next</code> would be changed. </li>\n<li>If <code>i4</code> were equal to <code>i1</code>, then modifications to <code>r</code> would happen through another path than the single owner of the mutable reference. </li>\n</ul>\n\n<p>Note how each of these correspond to the points the compiler told you about.</p>\n\n<p>It's <em>possible</em> that <em>some</em> of these cases might be fixed via non-lexical lifetimes, if the compiler becomes sufficiently smart to understand that you no longer need to have a reference around. It will not help with the cases of changing the vector through an array index; the compiler is not smart enough to track your math and prove that you never touch the \"wrong\" index, nor will it be smart enough to realize that two references into an array are disjoint if the indices are.</p>\n\n<hr>\n\n<p>In <strong>this specific case</strong>, since your type implements <code>Copy</code>, make use of that to get a value out. Write directly back to the vector when you need to. You can't have borrowing errors <em>if you never borrow</em>.</p>\n\n<pre><code>fn main() {\n    let mut vec = vec![\n        Interval::new(1, 1),\n        Interval::new(2, 3),\n        Interval::new(6, 7),\n    ];\n    let addition = Interval::new(2, 5);\n    let (mut i, len) = (0, vec.len());\n    while i &lt; len {\n        let r = vec[i];\n        if r == addition {\n            return;\n        }\n        if addition.adjacent(&amp;r) || !addition.disjoint(&amp;r) {\n            let mut bigger = addition.union(&amp;r);\n            vec[i] = bigger;\n            while i &lt; len - 1 {\n                i += 1;\n                let next = vec[i + 1];\n                if !bigger.adjacent(&amp;next) &amp;&amp; bigger.disjoint(&amp;next) {\n                    break;\n                }\n                vec.remove(i); \n                i -= 1;\n                vec[i] = bigger.union(&amp;next);\n            }\n            return;\n        }\n        if addition.starts_before_disjoint(&amp;r) {\n            vec.insert(i - 1, addition);\n        }\n        i += 1;\n    }\n}\n</code></pre>\n\n<p>Realistically, I'd do as <a href=\"https://stackoverflow.com/questions/45517170/how-can-i-iterate-a-vector-once-and-insert-remove-modify-multiple-elements-along/45517924#comment77995943_45517170\">loganfsmyth suggests</a> and change the algorithm to take a slice of intervals and return a new <code>Vec</code>. If you were doing this a lot, you could flip writing back and forth between two pre-allocated <code>Vec</code>s, but at that point there's probably a far better data structure than a vector; perhaps an <a href=\"https://en.wikipedia.org/wiki/Interval_tree\" rel=\"noreferrer\">interval tree</a>.</p>\n"}], "owner": {"reputation": 2107, "user_id": 1968354, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5bf273b96c177d846813c35f7d1d214d?s=128&d=identicon&r=PG", "display_name": "NeatNerd", "link": "https://stackoverflow.com/users/1968354/neatnerd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 750, "favorite_count": 0, "accepted_answer_id": 45517924, "answer_count": 1, "score": 3, "last_activity_date": 1501905386, "creation_date": 1501893708, "last_edit_date": 1501903806, "question_id": 45517170, "link": "https://stackoverflow.com/questions/45517170/how-can-i-iterate-a-vector-once-and-insert-remove-modify-multiple-elements-along", "title": "How can I iterate a vector once and insert/remove/modify multiple elements along the way?", "body": "<p>I want to iterate an array/vector once and modify multiple elements on the way as this is the most optimal solution. I don't want to scan it again and again just because Rust is unhappy about borrows.</p>\n\n<p>I store a list of intervals represented as <code>[start;stop]</code> in a sorted vector and I want to add a new interval. It might be overlapping, so I want to remove all elements that are not needed anymore. I want to do it all in one go. Algorithm can look something like this (I cut some parts):</p>\n\n<pre><code>use std::cmp::{min, max};\n\n#[derive(Debug, PartialEq, Clone, Copy)]\nstruct Interval {\n    start: usize,\n    stop: usize,\n}\n\nimpl Interval {\n    fn new(start: usize, stop: usize) -&gt; Interval {\n        Interval {\n            start: start,\n            stop: stop,\n        }\n    }\n    pub fn starts_before_disjoint(&amp;self, other: &amp;Interval) -&gt; bool {\n        self.start &lt; other.start &amp;&amp; self.stop &lt; other.start\n    }\n    pub fn starts_before_non_disjoint(&amp;self, other: &amp;Interval) -&gt; bool {\n        self.start &lt;= other.start &amp;&amp; self.stop &gt;= other.start\n    }\n    pub fn starts_after(&amp;self, other: &amp;Interval) -&gt; bool {\n        self.start &gt; other.start\n    }\n    pub fn starts_after_disjoint(&amp;self, other: &amp;Interval) -&gt; bool {\n        self.start &gt; other.stop\n    }\n    pub fn starts_after_nondisjoint(&amp;self, other: &amp;Interval) -&gt; bool {\n        self.start &gt; other.start &amp;&amp; self.start &lt;= other.stop\n    }\n    pub fn disjoint(&amp;self, other: &amp;Interval) -&gt; bool {\n        self.starts_before_disjoint(other)\n    }\n    pub fn adjacent(&amp;self, other: &amp;Interval) -&gt; bool {\n        self.start == other.stop + 1 || self.stop == other.start - 1\n    }\n    pub fn union(&amp;self, other: &amp;Interval) -&gt; Interval {\n        Interval::new(min(self.start, other.start), max(self.stop, other.stop))\n    }\n    pub fn intersection(&amp;self, other: &amp;Interval) -&gt; Interval {\n        Interval::new(max(self.start, other.start), min(self.stop, other.stop))\n    }\n}\n\nfn main() {\n    //making vectors\n    let mut vec = vec![\n        Interval::new(1, 1),\n        Interval::new(2, 3),\n        Interval::new(6, 7),\n    ];\n    let addition = Interval::new(2, 5); // &lt;- this will take over interval @ 2 and will be adjacent to 3, so we have to merge\n    let (mut i, len) = (0, vec.len());\n    while i &lt; len {\n        let r = &amp;mut vec[i];\n        if *r == addition {\n            return; //nothing to do, just a duplicate\n        }\n        if addition.adjacent(r) || !addition.disjoint(r) {\n            //if they are next to each other or overlapping\n            //lets merge\n            let mut bigger = addition.union(r);\n            *r = bigger;\n            //now lets check what else we can merge\n            while i &lt; len - 1 {\n                i += 1;\n                let next = &amp;vec[i + 1];\n                if !bigger.adjacent(next) &amp;&amp; bigger.disjoint(next) {\n                    //nothing to merge\n                    break;\n                }\n                vec.remove(i); //&lt;- FAIL another mutable borrow\n                i -= 1; //lets go back\n                vec[i] = bigger.union(next); //&lt;- FAIL and yet another borrow\n            }\n            return;\n        }\n        if addition.starts_before_disjoint(r) {\n            vec.insert(i - 1, addition); // &lt;- FAIL since another refence already borrowed @ let r = &amp;mut vec[i]\n        }\n        i += 1;\n    }\n}\n</code></pre>\n\n<p>It fails in a couple of places because of the borrowing rules. Is there a way to either</p>\n\n<ol>\n<li>do it with iterators in one go</li>\n<li>work around the borrowing</li>\n</ol>\n\n<p>There is <a href=\"https://doc.rust-lang.org/nomicon/borrow-splitting.html\" rel=\"nofollow noreferrer\">borrow splitting</a> available, but I don't see how I can apply it here.</p>\n"}, {"tags": ["rust", "rust-cargo"], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 0, "last_activity_date": 1501882307, "last_edit_date": 1501882307, "creation_date": 1501881911, "answer_id": 45515714, "question_id": 45515579, "link": "https://stackoverflow.com/questions/45515579/why-does-using-an-external-crates-function-require-bringing-the-dependent-trait/45515714#45515714", "title": "Why does using an external crate&#39;s function require bringing the dependent trait into scope?", "body": "<blockquote>\n  <p>Why does using an external crate's function require bringing the dependent trait into scope?</p>\n</blockquote>\n\n<p><strong>It doesn't</strong>. This compiles just fine:</p>\n\n<pre><code>extern crate rand;\n\nfn main() {\n    let secret_number = rand::thread_rng();\n}\n</code></pre>\n\n<p>You are then trying to call a method from a trait on the return value of that function call. <strong>That</strong> requires the trait to be in scope, as described in <a href=\"https://stackoverflow.com/q/25273816/155423\">Why do I need to import a trait to use the methods it defines for a type?</a></p>\n"}], "owner": {"reputation": 1674, "user_id": 5420686, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/2c318e16c4b5f17dd1375df8cb1425e5?s=128&d=identicon&r=PG&f=1", "display_name": "Jal", "link": "https://stackoverflow.com/users/5420686/jal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1501882307, "creation_date": 1501881132, "last_edit_date": 1501881757, "question_id": 45515579, "link": "https://stackoverflow.com/questions/45515579/why-does-using-an-external-crates-function-require-bringing-the-dependent-trait", "title": "Why does using an external crate&#39;s function require bringing the dependent trait into scope?", "body": "<p>Consider the following code in the <a href=\"https://doc.rust-lang.org/book/second-edition/ch02-00-guessing-game-tutorial.html\" rel=\"nofollow noreferrer\">official tutorial</a></p>\n\n<pre><code>extern crate rand;\n\nuse rand::Rng;\n\nfn main() {\n    let secret_number = rand::thread_rng().gen_range(1, 101);\n}\n</code></pre>\n\n<p>The line <code>rand::thread_rng().gen_range(1, 101)</code> is a bit confusing for me since I expect calling <code>rand::thread_rng()</code> to automatically resolve the dependency for the trait it is using.</p>\n\n<p>However I need <code>use rand::Rng;</code> for it to work. </p>\n\n<p>So does this mean that I have to resolve the dependency manually when I want to use some function in 3rd party crate?</p>\n"}, {"tags": ["rust", "ffi"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 2369, "user_id": 4614680, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c9b36fb2c1d356a919916f77e74f1c3c?s=128&d=identicon&r=PG&f=1", "display_name": "Philipp Ludwig", "link": "https://stackoverflow.com/users/4614680/philipp-ludwig"}, "edited": false, "score": 0, "creation_date": 1501879999, "post_id": 45514870, "comment_id": 77992044, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/151106/discussion-between-shepmaster-and-philipp-ludwig\">continue this discussion in chat</a>."}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 2369, "user_id": 4614680, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c9b36fb2c1d356a919916f77e74f1c3c?s=128&d=identicon&r=PG&f=1", "display_name": "Philipp Ludwig", "link": "https://stackoverflow.com/users/4614680/philipp-ludwig"}, "edited": false, "score": 1, "creation_date": 1501881685, "post_id": 45515645, "comment_id": 77992683, "body": "@PhilippLudwig no worries \u2014 I do hope that someone shows us both how to address this in a cleaner way than to use <code>transmute</code> though!"}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 1, "last_activity_date": 1501881654, "last_edit_date": 1501881654, "creation_date": 1501881477, "answer_id": 45515645, "question_id": 45514870, "link": "https://stackoverflow.com/questions/45514870/how-do-i-call-a-c-function-which-returns-many-types-of-different-function-pointe/45515645#45515645", "title": "How do I call a C function which returns many types of different function pointers?", "body": "<p>Here's a slightly smaller reproduction:</p>\n\n<pre><code>extern crate libc;\n\nextern \"C\" {\n    fn getProcAddress(procname: libc::c_int) -&gt; extern \"C\" fn();\n}\n\ntype CreateVertexArrays = extern \"C\" fn(n: libc::c_int, arrays: *mut libc::c_uint);\n\nfn main() {\n    let create_vertex_arrays: CreateVertexArrays = unsafe {\n        getProcAddress(42)\n    };\n\n    let mut vao = 0;\n    (create_vertex_arrays)(1, &amp;mut vao);\n}\n</code></pre>\n\n<p>One solution is <strong>The Big Hammer</strong> of \"make this type into that type\": <a href=\"https://doc.rust-lang.org/std/mem/fn.transmute.html\" rel=\"nofollow noreferrer\"><code>mem::transmute</code></a>:</p>\n\n<pre><code>fn main() {\n    let create_vertex_arrays: CreateVertexArrays = unsafe {\n        ::std::mem::transmute(getProcAddress(42))\n    };\n\n    let mut vao = 0;\n    (create_vertex_arrays)(1, &amp;mut vao);\n}\n</code></pre>\n\n<p>But <code>mem::transmute</code> really is supposed to be used as the last resort. None of the other conversion techniques I'm aware of seem to apply here...</p>\n\n<hr>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/26117197/create-interface-to-c-function-pointers-in-rust\">Create interface to C function pointers in Rust</a></li>\n</ul>\n"}], "owner": {"reputation": 2369, "user_id": 4614680, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c9b36fb2c1d356a919916f77e74f1c3c?s=128&d=identicon&r=PG&f=1", "display_name": "Philipp Ludwig", "link": "https://stackoverflow.com/users/4614680/philipp-ludwig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 1, "accepted_answer_id": 45515645, "answer_count": 1, "score": 1, "last_activity_date": 1501881721, "creation_date": 1501877871, "last_edit_date": 1501881721, "question_id": 45514870, "link": "https://stackoverflow.com/questions/45514870/how-do-i-call-a-c-function-which-returns-many-types-of-different-function-pointe", "title": "How do I call a C function which returns many types of different function pointers?", "body": "<p>I'm trying to access the OpenGL function <code>glCreateVertexArrays</code>. Consider the following small C++ program:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>#include &lt;GL/glx.h&gt;\n#include &lt;GLFW/glfw3.h&gt;\n\nint main() {\n    // Init GLFW\n    glfwInit();\n\n    // Set OpenGL Version\n    glfwWindowHint(GLFW_CONTEXT_VERSION_MAJOR, 4);\n    glfwWindowHint(GLFW_CONTEXT_VERSION_MINOR, 3);\n\n    // Select core profile\n    glfwWindowHint(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE);\n    glfwWindowHint(GLFW_OPENGL_FORWARD_COMPAT, true);\n\n    // Create Window\n    auto window = glfwCreateWindow(400, 400, \"Test\", nullptr, nullptr);\n    glfwMakeContextCurrent(window);\n\n    void (*glCreateVertexArrays)(unsigned int, unsigned int*) = nullptr;\n    glCreateVertexArrays = (decltype(glCreateVertexArrays))glXGetProcAddress((const       GLubyte*)\"glCreateVertexArrays\");\n\n    unsigned int vao;\n    glCreateVertexArrays(1, &amp;vao); // &lt;-- This is the important part\n\n    return 0;\n}\n</code></pre>\n\n<p>This application doesn't segfault; now I want to recreate the same in Rust:</p>\n\n<pre><code>extern crate libc;\n\nuse std::ffi::CString;\nuse std::os;\nuse std::ptr;\n\nenum GLFWwindow {}\nenum GLFWmonitor {}\n#[link(name = \"glfw\")]\nextern \"C\" {\n    fn glfwInit() -&gt; bool;\n    fn glfwWindowHint(target: libc::uint32_t, hint: libc::int32_t);\n    fn glfwCreateWindow(\n        width: libc::c_int,\n        height: libc::c_int,\n        title: *const os::raw::c_char,\n        monitor: *mut GLFWmonitor,\n        window: *mut GLFWwindow,\n    ) -&gt; *mut GLFWwindow;\n    fn glfwMakeContextCurrent(window: *mut GLFWwindow);\n}\n\n#[link(name = \"GL\")]\nextern \"C\" {\n    fn glXGetProcAddress(procname: *const os::raw::c_char) -&gt; extern \"C\" fn();\n}\n\nstatic GLFW_CONTEXT_VERSION_MAJOR: u32 = 0x22002;\nstatic GLFW_CONTEXT_VERSION_MINOR: u32 = 0x22003;\nstatic GLFW_OPENGL_FORWARD_COMPAT: u32 = 0x22006;\nstatic GLFW_OPENGL_PROFILE: u32 = 0x22008;\nstatic GLFW_OPENGL_CORE_PROFILE: i32 = 0x00032001;\n\ntype FnCreateVertexArrays = extern \"C\" fn(n: libc::c_int, arrays: *mut libc::c_uint);\n\nfn main() {\n    let w_name = CString::new(\"Test\").unwrap();\n    let fn_name = CString::new(\"glCreateVertexArrays\").unwrap();\n\n    unsafe {\n        glfwInit();\n\n        // Set OpenGL Version\n        glfwWindowHint(GLFW_CONTEXT_VERSION_MAJOR, 4);\n        glfwWindowHint(GLFW_CONTEXT_VERSION_MINOR, 3);\n\n        // Select core profile\n        glfwWindowHint(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE);\n        glfwWindowHint(GLFW_OPENGL_FORWARD_COMPAT, 1);\n\n        // Create Window\n        let window = glfwCreateWindow(\n            400,\n            400,\n            w_name.as_ptr(),\n            ptr::null_mut(),\n            ptr::null_mut(),\n        );\n        glfwMakeContextCurrent(window);\n    }\n\n    let create_vertex_arrays: FnCreateVertexArrays = unsafe {\n        glXGetProcAddress(fn_name.as_ptr())\n    };\n\n    let mut vao: libc::c_uint = 0;\n    unsafe {\n        (create_vertex_arrays)(1, &amp;mut vao);\n    }\n\n    println!(\"Hello, world!\");\n}\n</code></pre>\n\n<p>However, the cast is not correct:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0308]: mismatched types\n  --&gt; src/main.rs:63:9\n   |\n63 |         glXGetProcAddress(fn_name.as_ptr())\n   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ incorrect number of function parameters\n   |\n   = note: expected type `extern \"C\" fn(i32, *mut u32)`\n              found type `extern \"C\" fn()`\n</code></pre>\n\n<p>The main problem here is that the OpenGL function <code>glXGetProcAddress</code> returns a <code>void*()</code> pointer, which has to be cast to the appropriate function pointer type. How could that be done?</p>\n\n<p>I know that there are already wrappers and engines for OpenGL/GLFW, but I want to do it for the sake of learning.</p>\n"}, {"tags": ["rust", "matching", "borrow-checker"], "answers": [{"comments": [{"owner": {"reputation": 854, "user_id": 3989982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6941e7388870864da83acedf9e9c7693?s=128&d=identicon&r=PG&f=1", "display_name": "Tibor Benke", "link": "https://stackoverflow.com/users/3989982/tibor-benke"}, "edited": false, "score": 0, "creation_date": 1501849004, "post_id": 45506457, "comment_id": 77973827, "body": "This is the idiomatic solution."}], "tags": [], "owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "is_accepted": false, "score": 2, "last_activity_date": 1501848502, "creation_date": 1501848502, "answer_id": 45506457, "question_id": 45505607, "link": "https://stackoverflow.com/questions/45505607/rust-matching-and-borrow-checker/45506457#45506457", "title": "Rust matching and borrow checker", "body": "<p>Use directly the field <code>those</code>, for example with custom type:</p>\n\n<pre><code>use std::sync::{Arc,RwLock};\n\npub struct Those(i32);\n\nimpl Those {\n    fn get(&amp;self) -&gt; i32 {\n        self.0\n    }\n\n    fn add(&amp;mut self, n: i32) {\n        self.0 += n;\n    }\n}\n\npub struct Test {\n    thing: Those,\n}\n\npub struct Test2 {\n    pub test: Arc&lt;RwLock&lt;Test&gt;&gt;,\n    pub those: Those,\n}\n\nimpl Test {\n    pub fn foo(&amp;self) -&gt; Option&lt;Those&gt; {\n        Some(Those(3))\n    }\n}\n\nimpl Test2 {\n    pub fn bar(&amp;mut self) {\n        let mut test_writer = self.test.write().unwrap();\n\n        match test_writer.foo() {\n            Some(thing) =&gt; {\n                // call a method add directly on your type to get around the borrow checker\n                self.those.add(thing.get());\n            },\n            None =&gt; {}\n        }\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 83, "user_id": 1132904, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/e274901b2689a233d7e74bbbddf3514c?s=128&d=identicon&r=PG", "display_name": "Vincent", "link": "https://stackoverflow.com/users/1132904/vincent"}, "edited": false, "score": 0, "creation_date": 1501850995, "post_id": 45506545, "comment_id": 77975285, "body": "thanks red75prime. I&#39;m going to accept Boiethios&#39; answer as the correct one because it seems to me that he answered the &quot;idiomatic&quot; part. But in my code I will be using a variant of your first suggestion =)"}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "reply_to_user": {"reputation": 83, "user_id": 1132904, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/e274901b2689a233d7e74bbbddf3514c?s=128&d=identicon&r=PG", "display_name": "Vincent", "link": "https://stackoverflow.com/users/1132904/vincent"}, "edited": false, "score": 0, "creation_date": 1501861734, "post_id": 45506545, "comment_id": 77982866, "body": "@Vincent The solution you must use depends on the complexity of your code. If it is really complex, make everything to minimize the number of borrows that are not needed; otherwise you will fight the borrow checker sooner or later."}], "tags": [], "owner": {"reputation": 3212, "user_id": 2731452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xA89V.jpg?s=128&g=1", "display_name": "red75prime", "link": "https://stackoverflow.com/users/2731452/red75prime"}, "is_accepted": false, "score": 1, "last_activity_date": 1501848773, "creation_date": 1501848773, "answer_id": 45506545, "question_id": 45505607, "link": "https://stackoverflow.com/questions/45505607/rust-matching-and-borrow-checker/45506545#45506545", "title": "Rust matching and borrow checker", "body": "<p>You either need to end borrow of a part of <code>self</code>, before mutating <code>self</code></p>\n\n<pre><code>pub fn bar1(&amp;mut self) {\n    let foo = self.test.write().unwrap().foo();\n    match foo {\n        Some(thing) =&gt; {\n            self.add(thing);\n        },\n        None =&gt; {}\n    }\n}\n</code></pre>\n\n<p>or directly mutate non borrowed part of <code>self</code></p>\n\n<pre><code>pub fn bar2(&amp;mut self) {\n    let test_writer = self.test.write().unwrap();\n\n    match test_writer.foo() {\n        Some(thing) =&gt; {\n            self.those += thing;\n        },\n        None =&gt; {}\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 83, "user_id": 1132904, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/e274901b2689a233d7e74bbbddf3514c?s=128&d=identicon&r=PG", "display_name": "Vincent", "link": "https://stackoverflow.com/users/1132904/vincent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 290, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1501852202, "creation_date": 1501845932, "last_edit_date": 1501852202, "question_id": 45505607, "link": "https://stackoverflow.com/questions/45505607/rust-matching-and-borrow-checker", "title": "Rust matching and borrow checker", "body": "<p>I keep stumbling on a pattern in my Rust programs that always puts me at odds with the borrow-checker. Consider the following toy example:</p>\n\n<pre><code>use std::sync::{Arc,RwLock};\n\npub struct Test {\n    thing: i32,\n}\n\npub struct Test2 {\n    pub test: Arc&lt;RwLock&lt;Test&gt;&gt;,\n    pub those: i32,\n}\n\nimpl Test {\n    pub fn foo(&amp;self) -&gt; Option&lt;i32&gt; {\n        Some(3)\n    }\n}\n\nimpl Test2 {\n    pub fn bar(&amp;mut self) {\n        let mut test_writer = self.test.write().unwrap();\n\n        match test_writer.foo() {\n            Some(thing) =&gt; {\n                self.add(thing);\n            },\n            None =&gt; {}\n        }\n    }\n\n    pub fn add(&amp;mut self, addme: i32) {\n        self.those += addme;\n    }\n}\n</code></pre>\n\n<p>This doesn't compile because the <code>add</code> function in the <code>Some</code> arm tries to borrow self mutably, which was already borrowed immutably just above the match statement in order to open the read-write lock.</p>\n\n<p>I've encountered this pattern a few times in Rust, mainly when using <code>RwLock</code>. I've also found a workaround, namely by introducing a boolean before the <code>match</code> statement and then changing the value of the boolean in the <code>Some</code> arm and then finally introducing a test on this boolean after the match statement to do whatever it is I wanted to do in the <code>Some</code> arm.</p>\n\n<p>It just seems to me that that's not the way to go about it, I assume there's a more idiomatic way to do this in Rust - or solve the problem in an entirely different way - but I can't find it. If I'm not mistaken the problem has to do with lexical borrowing so <code>self</code> cannot be mutably borrowed within the arms of the match statement.</p>\n\n<p>Is there an idiomatic Rust way to solve this sort of problem?</p>\n"}, {"tags": ["generics", "rust", "traits", "boilerplate", "trait-objects"], "comments": [{"owner": {"reputation": 3212, "user_id": 2731452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xA89V.jpg?s=128&g=1", "display_name": "red75prime", "link": "https://stackoverflow.com/users/2731452/red75prime"}, "edited": false, "score": 1, "creation_date": 1501836933, "post_id": 45501780, "comment_id": 77965385, "body": "As far as I know procedural macros don&#39;t have access to type information, so you will not be able to decide whether the type needs to override default method."}], "answers": [{"comments": [{"owner": {"reputation": 696, "user_id": 8159982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vhr5o.jpg?s=128&g=1", "display_name": "lncr", "link": "https://stackoverflow.com/users/8159982/lncr"}, "edited": false, "score": 0, "creation_date": 1502095297, "post_id": 45536174, "comment_id": 78045116, "body": "While this works great in cases where <code>Boo</code> and <code>Gee</code> are <i>close to</i> always implemented, it still requires manual implementation when this is not the case. Considering the fact that <code>as_gee</code> should return <code>None</code> in about 80% of all calls in my program this is a rather unfortunate."}], "tags": [], "owner": {"reputation": 46065, "user_id": 234590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/463c0219a51a5d1fd08e1fa280811b57?s=128&d=identicon&r=PG", "display_name": "Francis Gagn&#233;", "link": "https://stackoverflow.com/users/234590/francis-gagn%c3%a9"}, "is_accepted": true, "score": 2, "last_activity_date": 1502236053, "last_edit_date": 1502236053, "creation_date": 1502050276, "answer_id": 45536174, "question_id": 45501780, "link": "https://stackoverflow.com/questions/45501780/is-it-possible-to-auto-implement-a-trait-which-casts-a-trait-object-to-another-t/45536174#45536174", "title": "Is it possible to auto implement a trait which casts a trait object to another trait object?", "body": "<p>This problem can be solved by <a href=\"https://en.wikipedia.org/wiki/Fundamental_theorem_of_software_engineering\" rel=\"nofollow noreferrer\">introducing an extra level of indirection</a>:</p>\n\n<pre><code>trait Boo {}\ntrait Gee {}\n\ntrait FooAsBoo {\n    fn as_boo(&amp;mut self) -&gt; Option&lt;&amp;mut Boo&gt; {\n        None\n    }\n}\n\ntrait FooAsGee {\n    fn as_gee(&amp;mut self) -&gt; Option&lt;&amp;mut Gee&gt; {\n        None\n    }\n}\n\ntrait Foo: FooAsBoo + FooAsGee {}\n\nimpl&lt;T: Boo&gt; FooAsBoo for T {\n    fn as_boo(&amp;mut self) -&gt; Option&lt;&amp;mut Boo&gt; {\n        Some(self)\n    }\n}\n\nimpl&lt;T: Gee&gt; FooAsGee for T {\n    fn as_gee(&amp;mut self) -&gt; Option&lt;&amp;mut Gee&gt; {\n        Some(self)\n    }\n}\n\nimpl&lt;T: FooAsBoo + FooAsGee&gt; Foo for T {} // if there's nothing else in Foo\n\nstruct W;\nimpl Boo for W {}\nimpl Gee for W {}\n\nfn main() {\n    let mut w = W;\n    let foo = &amp;mut w as &amp;mut Foo;\n    let boo = foo.as_boo();\n}\n</code></pre>\n\n<p>By moving <code>as_boo</code> and <code>as_gee</code> each to their own trait, we avoid the overlapping implementations. Methods from supertraits are available in trait objects, so <code>Foo</code> doesn't have to redeclare <code>as_boo</code> and <code>as_gee</code>.</p>\n\n<hr>\n\n<blockquote>\n  <p>While this works great in cases where <code>Boo</code> and <code>Gee</code> are <em>close</em> to always implemented, it still requires manual implementation when this is not the case. Considering the fact that as_gee should return <code>None</code> in about 80% of all calls in my program this is rather unfortunate.</p>\n</blockquote>\n\n<p>We can solve this by using <a href=\"https://github.com/rust-lang/rust/issues/31844\" rel=\"nofollow noreferrer\">specialization</a> (which is not stable as of Rust 1.19, so you'll need to use the nightly compiler). We need to move the implementations of <code>as_boo</code> and <code>as_gee</code> from the trait definition to an <code>impl</code> that applies to all types, so that all types implement <code>FooAsBoo</code> and <code>FooAsGee</code>.</p>\n\n<pre><code>#![feature(specialization)]\n\ntrait FooAsBoo {\n    fn as_boo(&amp;mut self) -&gt; Option&lt;&amp;mut Boo&gt;;\n}\n\ntrait FooAsGee {\n    fn as_gee(&amp;mut self) -&gt; Option&lt;&amp;mut Gee&gt;;\n}\n\nimpl&lt;T&gt; FooAsBoo for T {\n    default fn as_boo(&amp;mut self) -&gt; Option&lt;&amp;mut Boo&gt; {\n        None\n    }\n}\n\nimpl&lt;T&gt; FooAsGee for T {\n    default fn as_gee(&amp;mut self) -&gt; Option&lt;&amp;mut Gee&gt; {\n        None\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 696, "user_id": 8159982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vhr5o.jpg?s=128&g=1", "display_name": "lncr", "link": "https://stackoverflow.com/users/8159982/lncr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 319, "favorite_count": 0, "accepted_answer_id": 45536174, "answer_count": 1, "score": 2, "last_activity_date": 1502236053, "creation_date": 1501835137, "last_edit_date": 1501838924, "question_id": 45501780, "link": "https://stackoverflow.com/questions/45501780/is-it-possible-to-auto-implement-a-trait-which-casts-a-trait-object-to-another-t", "title": "Is it possible to auto implement a trait which casts a trait object to another trait object?", "body": "<p>I have a trait which manages conversions to different trait objects.\nThe trait looks like this: (<code>Boo</code> and <code>Gee</code> are both different Traits)</p>\n\n<pre><code>trait Foo {\n    fn as_boo(&amp;mut self) -&gt; Option&lt;&amp;mut Boo&gt; {\n        None\n    }\n\n    fn as_gee(&amp;mut self) -&gt; Option&lt;&amp;mut Gee&gt; {\n        None\n    }\n}\n</code></pre>\n\n<p>To reduce the amount of boilerplate code I now want to automatically change this implementation to this in case the struct implements <code>Boo</code>/<code>Gee</code>:</p>\n\n<pre><code>#[derive(Boo)]\nstruct W {}\n\nimpl Foo for W {\n    fn as_boo(&amp;mut self) -&gt; Option&lt;&amp;mut Boo&gt; {\n        Some(self)\n    }\n}\n</code></pre>\n\n<p>I could do this if there is only one other trait I have to convert to by using generics:</p>\n\n<pre><code>impl&lt;T: Boo&gt; Foo for T {\n    fn as_boo(&amp;mut self) -&gt; Option&lt;&amp;mut Boo&gt; {\n        Some(self)\n    }\n}\n</code></pre>\n\n<p>But in case I also want to automatically implement <code>Foo</code> for <code>Gee</code> it doesn't work this way due to the fact that I could not implement <code>Foo</code> twice, which is not supported by rust as far as I know.</p>\n\n<pre><code>// This does not compile because Foo might get implemented twice.\nimpl&lt;T: Boo&gt; Foo for T {\n    fn as_boo(&amp;mut self) -&gt; Option&lt;&amp;mut Boo&gt; {\n        Some(self)\n    }\n}\n\nimpl&lt;T: Gee&gt; Foo for T {\n    fn as_gee(&amp;mut self) -&gt; Option&lt;&amp;mut Gee&gt; {\n        Some(self)\n    }\n}\n</code></pre>\n\n<p>It might be possible to achieve this using <a href=\"https://doc.rust-lang.org/beta/reference/procedural-macros.html\" rel=\"nofollow noreferrer\"><code>Procedural Macros</code></a> but I could not find any in depth explanation of them so I am kind of stuck now.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 854, "user_id": 3989982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6941e7388870864da83acedf9e9c7693?s=128&d=identicon&r=PG&f=1", "display_name": "Tibor Benke", "link": "https://stackoverflow.com/users/3989982/tibor-benke"}, "edited": false, "score": 0, "creation_date": 1501833702, "post_id": 45500412, "comment_id": 77963295, "body": "Try this: <code>struct MyHandler&lt;&#39;a&gt; {     sqsclient: &amp;&#39;a SqsClient&lt;ProvideAwsCredentials, DispatchSignedRequest&gt;, }</code>"}, {"owner": {"reputation": 90923, "user_id": 383609, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/64555e5f0e0ee1ecbf3eaaf0dc137328?s=128&d=identicon&r=PG", "display_name": "Bojangles", "link": "https://stackoverflow.com/users/383609/bojangles"}, "reply_to_user": {"reputation": 854, "user_id": 3989982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6941e7388870864da83acedf9e9c7693?s=128&d=identicon&r=PG&f=1", "display_name": "Tibor Benke", "link": "https://stackoverflow.com/users/3989982/tibor-benke"}, "edited": false, "score": 0, "creation_date": 1501833939, "post_id": 45500412, "comment_id": 77963464, "body": "@TiborBenke Same error unfortunately. I&#39;ve tried <code>&#39;static</code> too to no avail."}], "answers": [{"tags": [], "owner": {"reputation": 90923, "user_id": 383609, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/64555e5f0e0ee1ecbf3eaaf0dc137328?s=128&d=identicon&r=PG", "display_name": "Bojangles", "link": "https://stackoverflow.com/users/383609/bojangles"}, "is_accepted": false, "score": 2, "last_activity_date": 1501835519, "creation_date": 1501835519, "answer_id": 45501918, "question_id": 45500412, "link": "https://stackoverflow.com/questions/45500412/type-constructor-in-trait-declaration/45501918#45501918", "title": "Type constructor in trait declaration", "body": "<p>Solved it! <code>DispatchSignedRequest</code> and <code>ProvideAwsCredentials</code> (from Rusoto) are <em>traits</em>. I needed to use <code>impl</code>s <em>of those traits</em>, i.e. structs, so now the code looks like this:</p>\n\n<pre><code>extern crate rusoto_core;\nextern crate hyper;\n\nuse hyper::Client;\nuse rusoto_sqs::{ Sqs, SqsClient };\nuse rusoto_core::{ DefaultCredentialsProvider };\n\nstruct MyHandler&lt;'a&gt; {\n    sqsclient: &amp;'a SqsClient&lt;DefaultCredentialsProvider, Client&gt;,\n}\n\nimpl&lt;'a&gt; Handler for MyHandler&lt;'a&gt; {\n    // ...\n}\n</code></pre>\n\n<p><code>DefaultCredentialsProvider</code> and <code>Client</code> (from Hyper) are both structs, so now this code compiles fine.</p>\n\n<p>I'm using Hyper 0.10 here. Hyper 0.11 requires a different type signature for <code>Client</code>.</p>\n"}], "owner": {"reputation": 90923, "user_id": 383609, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/64555e5f0e0ee1ecbf3eaaf0dc137328?s=128&d=identicon&r=PG", "display_name": "Bojangles", "link": "https://stackoverflow.com/users/383609/bojangles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 226, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1501852041, "creation_date": 1501830867, "last_edit_date": 1501852041, "question_id": 45500412, "link": "https://stackoverflow.com/questions/45500412/type-constructor-in-trait-declaration", "title": "Type constructor in trait declaration", "body": "<p>I want to pass a reference to a Rusoto SQS client to a WebSocket server struct to push messages onto an SQS queue.</p>\n\n<p>To that end, I have a (naive) struct as follows:</p>\n\n<pre><code>struct MyHandler {\n    sqsclient: &amp;SqsClient&lt;ProvideAwsCredentials, DispatchSignedRequest&gt;,\n}\n</code></pre>\n\n<p>This produces the error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0106]: missing lifetime specifier\n  --&gt; src/main.rs:29:13\n   |\n29 |    sqsclient: &amp;SqsClient&lt;ProvideAwsCredentials, DispatchSignedRequest&gt;,\n   |               ^ expected lifetime parameter\n</code></pre>\n\n<p>I've attempted all sorts of type signatures and lifetime trickery which all fail to varying levels, but I keep coming up against the same error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: the trait bound `rusoto_core::ProvideAwsCredentials + 'static: std::marker::Sized` is not satisfied\n  --&gt; src/main.rs:29:2\n   |\n29 |    sqsclient: &amp;'static SqsClient&lt;ProvideAwsCredentials, DispatchSignedRequest&gt;,\n   |    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ `rusoto_core::ProvideAwsCredentials + 'static` does not have a constant size known at compile-time\n   |\n   = help: the trait `std::marker::Sized` is not implemented for `rusoto_core::ProvideAwsCredentials + 'static`\n   = note: required by `rusoto_sqs::SqsClient`\n\nerror[E0277]: the trait bound `rusoto_core::DispatchSignedRequest + 'static: std::marker::Sized` is not satisfied\n  --&gt; src/main.rs:29:2\n   |\n29 |    sqsclient: &amp;'static SqsClient&lt;ProvideAwsCredentials, DispatchSignedRequest&gt;,\n   |    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ `rusoto_core::DispatchSignedRequest + 'static` does not have a constant size known at compile-time\n   |\n   = help: the trait `std::marker::Sized` is not implemented for `rusoto_core::DispatchSignedRequest + 'static`\n   = note: required by `rusoto_sqs::SqsClient`\n</code></pre>\n\n<p>I've also tried wrapping it in <code>Rc</code> and <code>Box</code> to no avail. I feel like I'm looking in the wrong place with these though.</p>\n\n<p>This happens when giving <code>MyHandler</code> an <code>&lt;'a&gt;</code> lifetime too. What am I misunderstanding about the Rust type system here, and what can I do to be able to pass a reference to an <code>SqsClient&lt;...&gt;</code> (and eventually other stuff from Rusoto) into my own structs? It would be useful to know if what I'm trying to do above is idiomatic Rust. If it's not, what pattern should I use instead?</p>\n\n<p>This is a follow up from <a href=\"https://stackoverflow.com/questions/42064853/how-do-i-pass-a-struct-with-type-parameters-as-a-function-argument\">How do I pass a struct with type parameters as a function argument?</a>.</p>\n"}, {"tags": ["windows", "audio", "rust"], "comments": [{"owner": {"reputation": 1540, "user_id": 2606171, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F4ncy.png?s=128&g=1", "display_name": "belst", "link": "https://stackoverflow.com/users/2606171/belst"}, "edited": false, "score": 3, "creation_date": 1501778132, "post_id": 45488927, "comment_id": 77941153, "body": "your soundcard needs a loopback channel for that (often called stereomix on windows). Your audio input should then behave like any other microphone."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1501788940, "post_id": 45488927, "comment_id": 77947640, "body": "Or you could go old-school and get a <a href=\"http://www.lunashops.com/images/upload/Image/4-poles-3_5mm-cable-mm-1.jpg\" rel=\"nofollow noreferrer\">male-to-male 3.5mm audio cable</a> and directly hook up the output to the input ^_^."}], "owner": {"reputation": 144, "user_id": 2627144, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7adac78ebda9eaef2377fccfaaa5b746?s=128&d=identicon&r=PG", "display_name": "Prmejc", "link": "https://stackoverflow.com/users/2627144/prmejc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 319, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1501778878, "creation_date": 1501775035, "last_edit_date": 1501778878, "question_id": 45488927, "link": "https://stackoverflow.com/questions/45488927/how-do-you-read-sound-from-the-speakers-using-rust-on-windows", "title": "How do you read sound from the speakers using Rust on Windows?", "body": "<p>I want to read the sound that comes from YouTube or Winamp or any other player using Rust on Windows 10. I can't find an example how to read sound from the sound card. </p>\n\n<p>I want to do something like <a href=\"http://royvanrijn.com/blog/2010/06/creating-shazam-in-java/\" rel=\"nofollow noreferrer\">Creating Shazam in Java</a> but in Rust and that listens to the speakers and not to the microphone.</p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2282732"}, "edited": false, "score": 0, "creation_date": 1501773598, "post_id": 45485505, "comment_id": 77937848, "body": "I did try this already but I wasn&#39;t able to call <code>register_component</code> then see <a href=\"https://play.rust-lang.org/?gist=301547098400e05e9c00f6a8fc883316&amp;version=undefined\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 854, "user_id": 3989982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6941e7388870864da83acedf9e9c7693?s=128&d=identicon&r=PG&f=1", "display_name": "Tibor Benke", "link": "https://stackoverflow.com/users/3989982/tibor-benke"}, "edited": false, "score": 1, "creation_date": 1501833568, "post_id": 45485505, "comment_id": 77963202, "body": "@xomz I updated the solution to cope with the new error."}], "tags": [], "owner": {"reputation": 854, "user_id": 3989982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6941e7388870864da83acedf9e9c7693?s=128&d=identicon&r=PG&f=1", "display_name": "Tibor Benke", "link": "https://stackoverflow.com/users/3989982/tibor-benke"}, "is_accepted": true, "score": 2, "last_activity_date": 1501833489, "last_edit_date": 1501833489, "creation_date": 1501766591, "answer_id": 45485505, "question_id": 45482957, "link": "https://stackoverflow.com/questions/45482957/storing-a-closure-with-lifetimes-in-a-struct/45485505#45485505", "title": "Storing a closure with lifetimes in a struct", "body": "<p>If you use a higher ranked lifetime when you define your <code>component_registrations</code> struct field, you should use a higher ranked lifetime for <code>F</code> as well.</p>\n\n<p>Also, if you say <code>Box&lt;Component&lt;'b&gt;&gt;</code>, it really means <code>Box&lt;Component&lt;'b&gt; + 'static&gt;</code> (so the trait object can contain only owned data). What you really need is <code>Box&lt;Component&lt;'b&gt; + 'b&gt;</code>, which means it is a trait object that implements <code>Component&lt;'b&gt;</code> and it can also contain borrowed data which live at least as long as <code>'b</code>.</p>\n\n<p>The relevant part is</p>\n\n<pre><code>pub struct Application {\n    component_registrations: Vec&lt;Box&lt;for&lt;'b&gt; Fn(&amp;'b ComponentRegistry&lt;'b&gt;, &amp;'b gl::Gl) -&gt; Box&lt;Component&lt;'b&gt; + 'b&gt; + Send + 'static&gt;&gt;\n}\n\nimpl Application {\n    pub fn register_component&lt;F&gt;(&amp;mut self, register: F) where F: for&lt;'b&gt; Fn(&amp;'b ComponentRegistry&lt;'b&gt;, &amp;'b gl::Gl) -&gt; Box&lt;Component&lt;'b&gt; + 'b&gt; + Send + 'static {\n        self.component_registrations.push(Box::new(register));\n    }\n}\n</code></pre>\n\n<p>You can see the <a href=\"https://play.rust-lang.org/?gist=cf64e0139293a0eeb927aff9238b0395&amp;version=stable\" rel=\"nofollow noreferrer\">full example</a>. Note, that I removed the <code>Arc</code> and <code>Mutex</code> types from your example since they were not relevant.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2282732"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 0, "accepted_answer_id": 45485505, "answer_count": 1, "score": 2, "last_activity_date": 1501833489, "creation_date": 1501759884, "last_edit_date": 1501766979, "question_id": 45482957, "link": "https://stackoverflow.com/questions/45482957/storing-a-closure-with-lifetimes-in-a-struct", "title": "Storing a closure with lifetimes in a struct", "body": "<p>I'm trying to store closures in a <code>Vec</code> that is part of a struct. The closure is a factory function which receives 2 references as arguments and produces a trait object which stores the references the closure receives as arguments.</p>\n\n<p>Because of that, the produced trait object has a lifetime that must not exceed the lifetime of the references. Also <code>component_registrations</code> will be accessed from multiple threads and is therefore wrapped in an <code>Arc&lt;Mutex&gt;</code>.</p>\n\n<p>I tried implementing it but the compiler says that the generic parameter <code>F</code> of the <code>register_component</code> function doesn't satisfy the trait bound used in <code>component_registrations</code>.</p>\n\n<p>This is the relevant part of the code:</p>\n\n<pre><code>use std::sync::Mutex;\nuse std::sync::Arc;\n\npub mod gl {\n    pub struct Gl();\n}\n\npub struct ComponentRegistry&lt;'a&gt; {\n    gl: &amp;'a gl::Gl\n}\n\npub trait Component&lt;'a&gt; {\n}\n\npub struct Application {\n    component_registrations: Arc&lt;Mutex&lt;Vec&lt;Box&lt;for&lt;'b&gt; Fn(&amp;'b ComponentRegistry&lt;'b&gt;, &amp;'b gl::Gl) -&gt; Box&lt;Component&lt;'b&gt;&gt; + Send + 'static&gt;&gt;&gt;&gt;\n}\n\nimpl Application {\n    pub fn new() -&gt; Application {\n        Application {\n            component_registrations: Arc::new(Mutex::new(vec![]))\n        }\n    }\n\n    pub fn register_component&lt;'a, F&gt;(&amp;mut self, register: F) where F: Fn(&amp;'a ComponentRegistry&lt;'a&gt;, &amp;'a gl::Gl) -&gt; Box&lt;Component&lt;'a&gt;&gt; + Send + 'static {\n        self.component_registrations.lock().unwrap().push(Box::new(register));\n    }\n}\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: the trait bound `for&lt;'b&gt; F: std::ops::Fn&lt;(&amp;'b ComponentRegistry&lt;'b&gt;, &amp;'b gl::Gl)&gt;` is not satisfied\n  --&gt; src/main.rs:27:59\n   |\n27 |         self.component_registrations.lock().unwrap().push(Box::new(register));\n   |                                                           ^^^^^^^^^^^^^^^^^^ the trait `for&lt;'b&gt; std::ops::Fn&lt;(&amp;'b ComponentRegistry&lt;'b&gt;, &amp;'b gl::Gl)&gt;` is not implemented for `F`\n   |\n   = help: consider adding a `where for&lt;'b&gt; F: std::ops::Fn&lt;(&amp;'b ComponentRegistry&lt;'b&gt;, &amp;'b gl::Gl)&gt;` bound\n   = note: required for the cast to the object type `for&lt;'b&gt; std::ops::Fn(&amp;'b ComponentRegistry&lt;'b&gt;, &amp;'b gl::Gl) -&gt; std::boxed::Box&lt;Component&lt;'b&gt;&gt; + std::marker::Send`\n\nerror[E0271]: type mismatch resolving `for&lt;'b&gt; &lt;F as std::ops::FnOnce&lt;(&amp;'b ComponentRegistry&lt;'b&gt;, &amp;'b gl::Gl)&gt;&gt;::Output == std::boxed::Box&lt;Component&lt;'b&gt;&gt;`\n  --&gt; src/main.rs:27:59\n   |\n27 |         self.component_registrations.lock().unwrap().push(Box::new(register));\n   |                                                           ^^^^^^^^^^^^^^^^^^ expected bound lifetime parameter 'b, found concrete lifetime\n   |\nnote: concrete lifetime that was found is the lifetime 'a as defined on the method body at 26:5\n  --&gt; src/main.rs:26:5\n   |\n26 | /     pub fn register_component&lt;'a, F&gt;(&amp;mut self, register: F) where F: Fn(&amp;'a ComponentRegistry&lt;'a&gt;, &amp;'a gl::Gl) -&gt; Box&lt;Component&lt;'a&gt;&gt; + Send + 'static {\n27 | |         self.component_registrations.lock().unwrap().push(Box::new(register));\n28 | |     }\n   | |_____^\n   = note: required for the cast to the object type `for&lt;'b&gt; std::ops::Fn(&amp;'b ComponentRegistry&lt;'b&gt;, &amp;'b gl::Gl) -&gt; std::boxed::Box&lt;Component&lt;'b&gt;&gt; + std::marker::Send`\n</code></pre>\n"}, {"tags": ["json", "rust", "serde"], "comments": [{"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 2, "creation_date": 1501756433, "post_id": 45481524, "comment_id": 77923714, "body": "What did you try? What was the result?"}], "answers": [{"tags": [], "owner": {"reputation": 2051, "user_id": 997768, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8ef9c79e41a6a0b2e1e14a29c9ec55e9?s=128&d=identicon&r=PG", "display_name": "matthias", "link": "https://stackoverflow.com/users/997768/matthias"}, "is_accepted": false, "score": 4, "last_activity_date": 1501767136, "last_edit_date": 1501767136, "creation_date": 1501767050, "answer_id": 45485724, "question_id": 45481524, "link": "https://stackoverflow.com/questions/45481524/deserializing-json-root-array-with-serde-json/45485724#45485724", "title": "Deserializing JSON root array with serde_json", "body": "<p>We just have to declare the result to be a vector of that type:</p>\n\n<pre><code>let p: Vec&lt;Person&gt; = serde_json::from_str(s).unwrap();\nprintln!(\"Name: {} {}\", p[0].first_name, p[0].last_name);\n</code></pre>\n"}], "owner": {"reputation": 2051, "user_id": 997768, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8ef9c79e41a6a0b2e1e14a29c9ec55e9?s=128&d=identicon&r=PG", "display_name": "matthias", "link": "https://stackoverflow.com/users/997768/matthias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1499, "favorite_count": 1, "closed_date": 1531939893, "answer_count": 1, "score": 2, "last_activity_date": 1538856580, "creation_date": 1501755925, "last_edit_date": 1538856580, "question_id": 45481524, "link": "https://stackoverflow.com/questions/45481524/deserializing-json-root-array-with-serde-json", "closed_reason": "Duplicate", "title": "Deserializing JSON root array with serde_json", "body": "<p>According to the JSON specification, the root of a JSON document can be either an object or an array. The first case is easily deserialized by <code>serde_json</code> using a <code>struct</code></p>\n\n<pre><code>#[derive(Deserialize)]\nstruct Person {\n    first_name: String,\n    last_name: String,\n}\n\nfn main() {\n    let s = r#\"[{\"first_name\": \"John\", \"last_name\": \"Doe\"}]\"#;\n\n    // this will break because we have a top-level array\n    let p: Person = serde_json::from_str(s).unwrap();\n    println!(\"Name: {} {}\", p.first_name, p.last_name);\n}\n</code></pre>\n\n<p>However I cannot find any documentation on how to deserialize an (unnamed) array of <code>struct</code>s.</p>\n"}, {"tags": ["rust", "rust-cargo"], "comments": [{"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 1, "creation_date": 1501752353, "post_id": 45479799, "comment_id": 77920670, "body": "It is nice that you show us your <code>Cargo.toml</code>, however it&#39;s not the one cargo is complaining about. Could you show us the <code>Cargo.toml</code> that cargo is failing to parse? Maybe it&#39;s been corrupted or something."}, {"owner": {"reputation": 433, "user_id": 5241494, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d37ed6bbd8ad0b3c44cbf97b7f3558a1?s=128&d=identicon&r=PG&f=1", "display_name": "Joe Lu", "link": "https://stackoverflow.com/users/5241494/joe-lu"}, "reply_to_user": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 0, "creation_date": 1501756197, "post_id": 45479799, "comment_id": 77923538, "body": "@MatthieuM. thanks for replying and I just updated my question."}], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 2, "last_activity_date": 1501767922, "creation_date": 1501767922, "answer_id": 45486085, "question_id": 45479799, "link": "https://stackoverflow.com/questions/45479799/cargo-cant-parse-the-cargo-toml-for-url-version-0-5-7/45486085#45486085", "title": "Cargo can&#39;t parse the Cargo.toml for url version 0.5.7", "body": "<p>As listed in the <a href=\"https://github.com/servo/rust-url/issues/195\" rel=\"nofollow noreferrer\">url crate's GitHub issue</a>, it previously used a form of TOML that was actually invalid. Newer versions of Cargo no longer parse that invalid form.</p>\n\n<p>Nothing in your shown dependency list requires url version 0.5.7. url version 0.5.10 has been released, so perform a <code>cargo update</code> to switch to it. Note that 0.5.10 was published on Aug 21, 2016, so it's almost a year old at this point.</p>\n"}], "owner": {"reputation": 433, "user_id": 5241494, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d37ed6bbd8ad0b3c44cbf97b7f3558a1?s=128&d=identicon&r=PG&f=1", "display_name": "Joe Lu", "link": "https://stackoverflow.com/users/5241494/joe-lu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 822, "favorite_count": 0, "accepted_answer_id": 45486085, "answer_count": 1, "score": 3, "last_activity_date": 1507862703, "creation_date": 1501751565, "last_edit_date": 1507862703, "question_id": 45479799, "link": "https://stackoverflow.com/questions/45479799/cargo-cant-parse-the-cargo-toml-for-url-version-0-5-7", "title": "Cargo can&#39;t parse the Cargo.toml for url version 0.5.7", "body": "<p>I encountered a problem when running <code>cargo build</code>:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>/usr/local/bin/cargo build --color=always\nerror: unable to get packages from source\n\nCaused by:\nfailed to parse manifest at `/home/lzc/.multirust/toolchains/stable/cargo/registry/src/github.com-1ecc6299db9ec823/url-0.5.7/Cargo.toml`\n\nCaused by:\ncould not parse input as TOML\n\nCaused by:\nexpected newline, found an identifier at line 14\n</code></pre>\n\n<p>I found this <a href=\"https://github.com/servo/rust-url/issues/195\" rel=\"nofollow noreferrer\">issue</a> on GitHub, but it didn't solve my problem.</p>\n\n<p>This is my project <code>Cargo.toml</code>:</p>\n\n<pre><code>[dependencies]\nhyper = \"0.7.2\"\nrustc-serialize = \"0.3\"\nwebsocket = \"0.15.1\"\n</code></pre>\n\n<p>And my <code>rustc</code> and <code>cargo</code> version:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>\u279c  ~ cargo -V\ncargo 0.18.0 (fe7b0cdcf 2017-04-24)\n\u279c  ~ rustc -V\nrustc 1.17.0 (56124baa9 2017-04-24)\n</code></pre>\n\n<p>And here is the file Cargo complains about(<code>/home/lzc/.multirust/toolchains/stable/cargo/registry/src/github.com-1ecc6299db9ec823/url-0.5.7/Cargo.toml</code>):</p>\n\n<pre><code>[package]\n\nname = \"url\"\nversion = \"0.5.7\"\nauthors = [ \"Simon Sapin &lt;simon.sapin@exyr.org&gt;\" ]\n\ndescription = \"URL library for Rust, based on the WHATWG URL Standard\"\ndocumentation = \"http://servo.github.io/rust-url/url/index.html\"\nrepository = \"https://github.com/servo/rust-url\"\nreadme = \"README.md\"\nkeywords = [\"url\", \"parser\"]\nlicense = \"MIT/Apache-2.0\"\n\n[[test]] name = \"format\"                #&lt;- line 14\n[[test]] name = \"form_urlencoded\"\n[[test]] name = \"idna\"\n[[test]] name = \"punycode\"\n[[test]] name = \"tests\"\n[[test]]\nname = \"wpt\"\nharness = false\n\n[dev-dependencies]\nrustc-test = \"0.1\"\n\n[features]\nquery_encoding = [\"encoding\"]\nserde_serialization = [\"serde\"]\nheap_size = [\"heapsize\", \"heapsize_plugin\"]\n\n[dependencies.heapsize]\nversion = \"&gt;=0.1.1, &lt;0.4\"\noptional = true\n\n[dependencies.heapsize_plugin]\nversion = \"0.1.0\"\noptional = true\n\n[dependencies.encoding]\nversion = \"0.2\"\noptional = true\n\n[dependencies.serde]\nversion = \"&gt;=0.6.1, &lt;0.8\"\noptional = true\n\n[dependencies]\nuuid = \"0.1.17\"\nrustc-serialize = \"0.3\"\nunicode-bidi = \"0.2.3\"\nunicode-normalization = \"0.1.2\"\nmatches = \"0.1\"\n</code></pre>\n"}, {"tags": ["rust"], "answers": [{"tags": [], "owner": {"reputation": 44438, "user_id": 42353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f05e802879a805c03a55645dfcc0d4ea?s=128&d=identicon&r=PG", "display_name": "DK.", "link": "https://stackoverflow.com/users/42353/dk"}, "is_accepted": true, "score": 1, "last_activity_date": 1501748819, "creation_date": 1501748819, "answer_id": 45478772, "question_id": 45478505, "link": "https://stackoverflow.com/questions/45478505/cannot-import-libcfuncs/45478772#45478772", "title": "Cannot import libc::funcs", "body": "<p>First of all, it says that it's unstable, meaning you should avoid using it if at all possible.  Unstable things can disappear or change at any time without warning.  In particular, that's for the compiler-internal <code>libc</code> which you're not supposed to touch.</p>\n\n<p>Secondly, that's from Rust 1.4, where the current version is 1.18.  With the error you're getting, I assume you're using a different version of Rust to 1.4.</p>\n\n<p>If you want to use <code>libc</code>, you should use <a href=\"https://crates.io/crates/libc\" rel=\"nofollow noreferrer\">the <code>libc</code> from the Cargo ecosystem</a>.  You can then find <a href=\"https://doc.rust-lang.org/libc/x86_64-unknown-linux-gnu/libc/fn.setuid.html\" rel=\"nofollow noreferrer\"><code>setuid</code> in its API reference</a>.</p>\n"}], "owner": {"reputation": 696, "user_id": 2129644, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/8feb0a34801725042b245cd1158fda48?s=128&d=identicon&r=PG", "display_name": "Olof", "link": "https://stackoverflow.com/users/2129644/olof"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 45478772, "answer_count": 1, "score": 0, "last_activity_date": 1501766473, "creation_date": 1501748023, "last_edit_date": 1501766473, "question_id": 45478505, "link": "https://stackoverflow.com/questions/45478505/cannot-import-libcfuncs", "title": "Cannot import libc::funcs", "body": "<p>I'm trying to change the UID of the running user. The <a href=\"https://doc.rust-lang.org/1.4.0/libc/funcs/posix88/unistd/fn.setuid.html\" rel=\"nofollow noreferrer\">documentation says that you should use <code>libc::funcs::posix88::unistd::setuid</code></a>.</p>\n\n<p>When I try to compile, it prints an error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Could not find `funcs` in `libc`\n</code></pre>\n"}, {"tags": ["enums", "rust", "discriminated-union"], "comments": [{"owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "edited": false, "score": 1, "creation_date": 1501744410, "post_id": 45473656, "comment_id": 77914906, "body": "Related/possible duplicate: <a href=\"https://stackoverflow.com/questions/34953711/unwrap-inner-type-when-enum-variant-is-known\" title=\"unwrap inner type when enum variant is known\">stackoverflow.com/questions/34953711/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 46065, "user_id": 234590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/463c0219a51a5d1fd08e1fa280811b57?s=128&d=identicon&r=PG", "display_name": "Francis Gagn&#233;", "link": "https://stackoverflow.com/users/234590/francis-gagn%c3%a9"}, "is_accepted": true, "score": 16, "last_activity_date": 1579525885, "last_edit_date": 1579525885, "creation_date": 1501727203, "answer_id": 45473824, "question_id": 45473656, "link": "https://stackoverflow.com/questions/45473656/read-from-an-enum-without-pattern-matching/45473824#45473824", "title": "Read from an enum without pattern matching", "body": "<p>At the lowest level, no, you can't read enum fields without a <code>match</code><sup>1</sup>.</p>\n\n<p>Methods on an enum can provide more convenient access to data within the enum (e.g. <a href=\"https://doc.rust-lang.org/stable/std/result/enum.Result.html#method.unwrap\" rel=\"noreferrer\"><code>Result::unwrap</code></a>), but under the hood, they're always implemented with a <code>match</code>.</p>\n\n<p>If you know that a particular case in a <code>match</code> is unreachable, a common practice is to write <a href=\"https://doc.rust-lang.org/stable/std/macro.unreachable.html\" rel=\"noreferrer\"><code>unreachable!()</code></a> on that branch (<code>unreachable!()</code> simply expands to a <code>panic!()</code> with a specific message).</p>\n\n<hr>\n\n<p><sup>1</sup> If you have an enum with only one variant, you could also write a simple <code>let</code> statement to deconstruct the enum. Patterns in <code>let</code> and <code>match</code> statements must be exhaustive, and pattern matching the single variant from an enum is exhaustive. But enums with only one variant are pretty much never used; a struct would do the job just fine. And if you intend to add variants later, you're better off writing a <code>match</code> right away.</p>\n\n<pre><code>enum Single {\n    S(i32),\n}\n\nfn main() {\n    let a = Single::S(1);\n    let Single::S(b) = a;\n    println!(\"{}\", b);\n}\n</code></pre>\n\n<p>On the other hand, if you have an enum with more than one variant, you can also use <code>if let</code> and <code>while let</code> if you're interested in the data from a single variant only. While <code>let</code> and <code>match</code> require exhaustive patterns, <code>if let</code> and <code>while let</code> accept non-exhaustive patterns. You'll often see them used with <code>Option</code>:</p>\n\n<pre><code>fn main() {\n    if let Some(x) = std::env::args().len().checked_add(1) {\n        println!(\"{}\", x);\n    } else {\n        println!(\"too many args :(\");\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 17508, "user_id": 1128289, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/9gnmI.jpg?s=128&g=1", "display_name": "Praxeolitic", "link": "https://stackoverflow.com/users/1128289/praxeolitic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5407, "favorite_count": 0, "accepted_answer_id": 45473824, "answer_count": 1, "score": 6, "last_activity_date": 1579525885, "creation_date": 1501726024, "last_edit_date": 1501726349, "question_id": 45473656, "link": "https://stackoverflow.com/questions/45473656/read-from-an-enum-without-pattern-matching", "title": "Read from an enum without pattern matching", "body": "<p>The Rust <a href=\"https://doc.rust-lang.org/1.6.0/book/patterns.html\" rel=\"noreferrer\">documentation gives this example</a> where we have an instance of <code>Result&lt;T, E&gt;</code> named <code>some_value</code>:</p>\n\n<pre><code>match some_value {\n    Ok(value) =&gt; println!(\"got a value: {}\", value),\n    Err(_) =&gt; println!(\"an error occurred\"),\n}\n</code></pre>\n\n<p>Is there any way to read from <code>some_value</code> without pattern matching? What about without even checking the type of the contents at runtime? Perhaps we somehow know with absolute certainty what type is contained or perhaps we're just being a bad programmer. In either case, I'm just curious to know if it's at all possible, not if it's a good idea.</p>\n\n<p>It strikes me as a really interesting language feature that this branch is so difficult (or impossible?) to avoid.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 1197, "user_id": 6423456, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c12df3cae9bced6777b223671ce538fd?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/6423456/john"}, "edited": false, "score": 0, "creation_date": 1617556390, "post_id": 45473626, "comment_id": 118332163, "body": "For anyone else wondering the same thing, check out my article <a href=\"https://dev.to/talzvon/rust-generic-types-in-method-definitions-4iah\" rel=\"nofollow noreferrer\">here</a> where I try to explain why this is required with simple examples."}], "answers": [{"comments": [{"owner": {"reputation": 567, "user_id": 5809347, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-mxny7d7IsKY/AAAAAAAAAAI/AAAAAAAAABE/rj8e1vBY-3Q/photo.jpg?sz=128", "display_name": "yeshengm", "link": "https://stackoverflow.com/users/5809347/yeshengm"}, "edited": false, "score": 1, "creation_date": 1547329035, "post_id": 45473717, "comment_id": 95157974, "body": "However it seems that the compiler can infer from the type parameters of <code>GenericVal</code> instead of <code>impl</code>. Could you explain why the <code>impl&lt;V&gt;</code> syntax is a <i>must</i>?"}, {"owner": {"reputation": 46065, "user_id": 234590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/463c0219a51a5d1fd08e1fa280811b57?s=128&d=identicon&r=PG", "display_name": "Francis Gagn&#233;", "link": "https://stackoverflow.com/users/234590/francis-gagn%c3%a9"}, "reply_to_user": {"reputation": 567, "user_id": 5809347, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-mxny7d7IsKY/AAAAAAAAAAI/AAAAAAAAABE/rj8e1vBY-3Q/photo.jpg?sz=128", "display_name": "yeshengm", "link": "https://stackoverflow.com/users/5809347/yeshengm"}, "edited": false, "score": 0, "creation_date": 1547425739, "post_id": 45473717, "comment_id": 95177872, "body": "I don&#39;t think it&#39;s strictly necessary, but if helps prevent ambiguities. What if someone introduced a type named <code>V</code> in the scope of that module? Is the use of <code>V</code> in the <code>impl</code> referring to the concrete type <code>V</code> (like the first example in my answer) or to an implicit generic parameter <code>V</code>?"}, {"owner": {"reputation": 541, "user_id": 8407160, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ATLGJ.png?s=128&g=1", "display_name": "Akshay Naik", "link": "https://stackoverflow.com/users/8407160/akshay-naik"}, "reply_to_user": {"reputation": 567, "user_id": 5809347, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-mxny7d7IsKY/AAAAAAAAAAI/AAAAAAAAABE/rj8e1vBY-3Q/photo.jpg?sz=128", "display_name": "yeshengm", "link": "https://stackoverflow.com/users/5809347/yeshengm"}, "edited": false, "score": 0, "creation_date": 1590861342, "post_id": 45473717, "comment_id": 109843991, "body": "@yeshengm as Francis said impl can be used to implement for specific types, you can think signature impl&lt;T&gt; GenericVal&lt;T&gt; {} like impl&lt;T&gt; is a declaration and GenericVal&lt;T&gt; is the usage for that declared type."}], "tags": [], "owner": {"reputation": 46065, "user_id": 234590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/463c0219a51a5d1fd08e1fa280811b57?s=128&d=identicon&r=PG", "display_name": "Francis Gagn&#233;", "link": "https://stackoverflow.com/users/234590/francis-gagn%c3%a9"}, "is_accepted": true, "score": 21, "last_activity_date": 1518390071, "last_edit_date": 1518390071, "creation_date": 1501726521, "answer_id": 45473717, "question_id": 45473626, "link": "https://stackoverflow.com/questions/45473626/why-does-rust-require-generic-type-declarations-after-the-impl-keyword/45473717#45473717", "title": "Why does Rust require generic type declarations after the &quot;impl&quot; keyword?", "body": "<p>Rust allows you to write <code>impl</code> blocks that apply only to some specific combination of type parameters. For example:</p>\n\n<pre><code>struct GenericVal&lt;T&gt;(T);\n\nimpl GenericVal&lt;u32&gt; {\n    fn foo(&amp;self) {\n        // method foo() is only defined when T = u32\n    }\n}\n</code></pre>\n\n<p>Here, the type <code>GenericVal</code> is generic, but the <code>impl</code> itself is not.</p>\n\n<p>Thus, if you want to write an <code>impl</code> block that applies for all <code>GenericVal&lt;T&gt;</code> types, you must first <em>declare</em> a type parameter on the <code>impl</code> itself (otherwise, <code>T</code> would try to look up a type named <code>T</code>).</p>\n\n<pre><code>struct GenericVal&lt;T&gt;(T);\n\nimpl&lt;T&gt; GenericVal&lt;T&gt; {\n    fn foo(&amp;self) {\n        // method foo() is always present\n    }\n}\n</code></pre>\n\n<p>This declaration also lets you have a single type parameter that can be used multiple times, forcing the types to be the same.</p>\n\n<pre><code>struct GenericVal&lt;T, U&gt;(T, U);\n\nimpl&lt;V&gt; GenericVal&lt;V, V&gt; {\n    fn foo(&amp;self) {\n        // method foo() is only defined when T = U\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 14308, "user_id": 2106207, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/960430ab7aba908bb9aa62d530618a75?s=128&d=identicon&r=PG", "display_name": "Nan Xiao", "link": "https://stackoverflow.com/users/2106207/nan-xiao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1338, "favorite_count": 4, "accepted_answer_id": 45473717, "answer_count": 1, "score": 13, "last_activity_date": 1549240600, "creation_date": 1501725759, "last_edit_date": 1501767558, "question_id": 45473626, "link": "https://stackoverflow.com/questions/45473626/why-does-rust-require-generic-type-declarations-after-the-impl-keyword", "title": "Why does Rust require generic type declarations after the &quot;impl&quot; keyword?", "body": "<p>Defining the methods of generic type requires adding generic types after <code>impl</code>:  </p>\n\n<pre><code>struct GenericVal&lt;T&gt;(T,);\nimpl &lt;T&gt; GenericVal&lt;T&gt; {}\n</code></pre>\n\n<p>I feel that removing <code>&lt;T&gt;</code> seems OK:  </p>\n\n<pre><code>struct GenericVal&lt;T&gt;(T,);\nimpl GenericVal&lt;T&gt; {}\n</code></pre>\n\n<p>Is it any special consideration? </p>\n"}, {"tags": ["rust", "package", "syntax-error", "atom-editor", "rust-cargo"], "answers": [{"comments": [{"owner": {"reputation": 65, "user_id": 4752318, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/f3yYm.jpg?s=128&g=1", "display_name": "lolgab123", "link": "https://stackoverflow.com/users/4752318/lolgab123"}, "edited": false, "score": 0, "creation_date": 1501726964, "post_id": 45473655, "comment_id": 77908310, "body": "Weird... I downloaded the newest version yesterday and installed it to replace the older version I had... But now I see that I&#39;m still on version 1.14 for some reasons... How to correctly reinstall it?"}, {"owner": {"reputation": 65, "user_id": 4752318, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/f3yYm.jpg?s=128&g=1", "display_name": "lolgab123", "link": "https://stackoverflow.com/users/4752318/lolgab123"}, "edited": false, "score": 0, "creation_date": 1501727402, "post_id": 45473655, "comment_id": 77908395, "body": "I used the given rustup-init.exe program to install it, but no options to uninstall here..."}, {"owner": {"reputation": 46065, "user_id": 234590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/463c0219a51a5d1fd08e1fa280811b57?s=128&d=identicon&r=PG", "display_name": "Francis Gagn&#233;", "link": "https://stackoverflow.com/users/234590/francis-gagn%c3%a9"}, "reply_to_user": {"reputation": 65, "user_id": 4752318, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/f3yYm.jpg?s=128&g=1", "display_name": "lolgab123", "link": "https://stackoverflow.com/users/4752318/lolgab123"}, "edited": false, "score": 0, "creation_date": 1501727725, "post_id": 45473655, "comment_id": 77908460, "body": "You probably installed 1.14 with the Windows installer, not with rustup. The Windows installer installs Rust system-wide, while rustup installs Rust for the current user only, and on Windows, the system PATH takes precedence over the user&#39;s PATH at logon. Check in Programs and Features if Rust is there and uninstall it from there. You may also have to log out and log in again to refresh the PATH environment variable (if you didn&#39;t already do so since running rustup)."}, {"owner": {"reputation": 65, "user_id": 4752318, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/f3yYm.jpg?s=128&g=1", "display_name": "lolgab123", "link": "https://stackoverflow.com/users/4752318/lolgab123"}, "edited": false, "score": 0, "creation_date": 1501727925, "post_id": 45473655, "comment_id": 77908505, "body": "Ok thanks! Finally I used the <code>rustup update</code> command and it seemed to work, thanks!"}, {"owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "reply_to_user": {"reputation": 65, "user_id": 4752318, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/f3yYm.jpg?s=128&g=1", "display_name": "lolgab123", "link": "https://stackoverflow.com/users/4752318/lolgab123"}, "edited": false, "score": 0, "creation_date": 1501744548, "post_id": 45473655, "comment_id": 77914998, "body": "@lolgab123 It&#39;s a good practice on StackOverflow to also vote up the answer you accepted. Not doing that always makes the one providing the answer go: &quot;what did I do wrooong for not deserving the upvote :&#39;(?!&quot; ;-)"}, {"owner": {"reputation": 65, "user_id": 4752318, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/f3yYm.jpg?s=128&g=1", "display_name": "lolgab123", "link": "https://stackoverflow.com/users/4752318/lolgab123"}, "edited": false, "score": 0, "creation_date": 1501785191, "post_id": 45473655, "comment_id": 77945406, "body": "Noted! Not enough rep for the vote to display, but it says it was registered so should be fine :)"}], "tags": [], "owner": {"reputation": 46065, "user_id": 234590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/463c0219a51a5d1fd08e1fa280811b57?s=128&d=identicon&r=PG", "display_name": "Francis Gagn&#233;", "link": "https://stackoverflow.com/users/234590/francis-gagn%c3%a9"}, "is_accepted": true, "score": 4, "last_activity_date": 1501727405, "last_edit_date": 1501727405, "creation_date": 1501726016, "answer_id": 45473655, "question_id": 45473612, "link": "https://stackoverflow.com/questions/45473612/cant-install-racer-pubrestricted-syntax-is-experimental-see-issue-32409/45473655#45473655", "title": "Can&#39;t install Racer : &quot;pub(restricted) syntax is experimental (see issue #32409)&quot;", "body": "<p>The <code>pub(restricted)</code> syntax has been stabilized in <a href=\"https://github.com/rust-lang/rust/blob/master/RELEASES.md#version-1180-2017-06-08\" rel=\"nofollow noreferrer\">Rust 1.18</a>, so you must be using an older version of Rust. Updating to Rust 1.18 or later should fix the problem.</p>\n\n<p>Remember that new Rust versions are released every six weeks, so remember to check regularly if you're up to date.</p>\n"}], "owner": {"reputation": 65, "user_id": 4752318, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/f3yYm.jpg?s=128&g=1", "display_name": "lolgab123", "link": "https://stackoverflow.com/users/4752318/lolgab123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 249, "favorite_count": 0, "accepted_answer_id": 45473655, "answer_count": 1, "score": 2, "last_activity_date": 1507862692, "creation_date": 1501725648, "last_edit_date": 1507862692, "question_id": 45473612, "link": "https://stackoverflow.com/questions/45473612/cant-install-racer-pubrestricted-syntax-is-experimental-see-issue-32409", "title": "Can&#39;t install Racer : &quot;pub(restricted) syntax is experimental (see issue #32409)&quot;", "body": "<p>It seems that the source code for Racer itself has some errors preventing it from installing. I've tried to install via both <code>cargo install racer</code> and by trying to compile it myself from Racer's source code. </p>\n\n<p><a href=\"https://i.stack.imgur.com/a2mjC.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/a2mjC.png\" alt=\"enter image description here\"></a></p>\n\n<p>How am I suppose to successfully install it? I need at least the <code>bin</code> file to use the Racer Atom package. </p>\n"}, {"tags": ["multithreading", "lambda", "rust", "borrow-checker", "borrowing"], "answers": [{"comments": [{"owner": {"reputation": 2415, "user_id": 7156008, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/QzIXM.jpg?s=128&g=1", "display_name": "George", "link": "https://stackoverflow.com/users/7156008/george"}, "edited": false, "score": 0, "creation_date": 1501747950, "post_id": 45474609, "comment_id": 77917307, "body": "I didn&#39;t say there&#39;s not chance of threads still running when main exit, I said it was ub and as such shouldn&#39;t really be relevant to any compiler if it happens, but I get the logic applies by the checker here."}, {"owner": {"reputation": 2415, "user_id": 7156008, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/QzIXM.jpg?s=128&g=1", "display_name": "George", "link": "https://stackoverflow.com/users/7156008/george"}, "edited": false, "score": 1, "creation_date": 1501748023, "post_id": 45474609, "comment_id": 77917353, "body": "However for the sake of my sanity I do enjoy sharing state such as container and ro variables between threads. I will try using crossbeam once I get to a normal computer."}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "reply_to_user": {"reputation": 2415, "user_id": 7156008, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/QzIXM.jpg?s=128&g=1", "display_name": "George", "link": "https://stackoverflow.com/users/7156008/george"}, "edited": false, "score": 3, "creation_date": 1501771347, "post_id": 45474609, "comment_id": 77936011, "body": "@George: Note that Rust&#39;s very reason to exist is to have the compiler eliminate UB. This is what Graydon Hoare was striving for and why Mozilla decided to fund a full-time team to work on it. So, yes, rustc will do its best to prevent UB; it&#39;s what it was created for ;)"}, {"owner": {"reputation": 2415, "user_id": 7156008, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/QzIXM.jpg?s=128&g=1", "display_name": "George", "link": "https://stackoverflow.com/users/7156008/george"}, "reply_to_user": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 0, "creation_date": 1501832937, "post_id": 45474609, "comment_id": 77962862, "body": "@Matthieu MI don&#39;t think you understand what I mean here. Let me put it otherwise: If my computer catches fire that&#39;s UB, but I as a programmer shouldn&#39;t care about it."}, {"owner": {"reputation": 2415, "user_id": 7156008, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/QzIXM.jpg?s=128&g=1", "display_name": "George", "link": "https://stackoverflow.com/users/7156008/george"}, "edited": false, "score": 0, "creation_date": 1501832976, "post_id": 45474609, "comment_id": 77962886, "body": "Same with threads lingering after the execution of main, it can happen theoretically, but at that point it&#39;s no longer the responsebillity of your program (and even in a program written in Rust, this is still considered UB)"}, {"owner": {"reputation": 2415, "user_id": 7156008, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/QzIXM.jpg?s=128&g=1", "display_name": "George", "link": "https://stackoverflow.com/users/7156008/george"}, "edited": false, "score": 1, "creation_date": 1501833094, "post_id": 45474609, "comment_id": 77962946, "body": "Also, there&#39;s something to say about obfuscation not being a fix to a problem and Rust being horrible when it comes to handling conversions between s/us and 2/4/8bit types (which will result in a lot of UB because there&#39;s basically no helper mechanisms in the language for it... especially if you compile cross platform, god help you)"}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "reply_to_user": {"reputation": 2415, "user_id": 7156008, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/QzIXM.jpg?s=128&g=1", "display_name": "George", "link": "https://stackoverflow.com/users/7156008/george"}, "edited": false, "score": 0, "creation_date": 1501835482, "post_id": 45474609, "comment_id": 77964370, "body": "@George: There is a vast difference between a faulty hardware (the most scary source of &quot;bugs&quot;, really) and faulty software. The former needs to be dealt with at hardware level (ECC memory is commonly used in servers, CPU/motherboards monitor temperate/voltage to avoid meltdowns, etc...) and the latter needs to be dealt with at software level (because the hardware blindly executes what you tell it to). I will argue, always, that it is the programmer&#39;s responsibility to deal with <b>all</b> software issues, and this includes threads running after main ends."}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "reply_to_user": {"reputation": 2415, "user_id": 7156008, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/QzIXM.jpg?s=128&g=1", "display_name": "George", "link": "https://stackoverflow.com/users/7156008/george"}, "edited": false, "score": 0, "creation_date": 1501835646, "post_id": 45474609, "comment_id": 77964482, "body": "@George: As for conversions between signed/unsigned and bitwidths; there is no Undefined Behavior here. Actually, since signedness and bitwidths are explicit, there is not even platform specific behavior (unlike C&#39;s <code>int</code> whose bitwidth is never really known). The only platform specific behavior you&#39;ll get is that <code>isize</code>/<code>usize</code> may have different bitwidths, though both have the same on a given platform, but once again that&#39;s not UB. It&#39;s perfectly defined, for the current platform."}, {"owner": {"reputation": 2415, "user_id": 7156008, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/QzIXM.jpg?s=128&g=1", "display_name": "George", "link": "https://stackoverflow.com/users/7156008/george"}, "edited": false, "score": 0, "creation_date": 1501836218, "post_id": 45474609, "comment_id": 77964868, "body": "programmer&#39;s responsibility to deal with all software issues ... There&#39;s a difference to be made between user space and kernel space and a difference to be made between your program and another one. You are responsible for preventing bugs in your program, extending to anything past that is an exercise in futility"}, {"owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 0, "creation_date": 1501866745, "post_id": 45474609, "comment_id": 77985561, "body": "SO really isn&#39;t the place to debate about language philosophy. Rust tries to prevent undefined behavior where possible, and this is a case where it is absolutely possible. Whether you agree with that design is unrelated to the question of how the language behaves."}], "tags": [], "owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "is_accepted": false, "score": 5, "last_activity_date": 1538930058, "last_edit_date": 1538930058, "creation_date": 1501733132, "answer_id": 45474609, "question_id": 45473260, "link": "https://stackoverflow.com/questions/45473260/how-can-rust-be-told-that-a-thread-does-not-live-longer-than-its-caller/45474609#45474609", "title": "How can Rust be told that a thread does not live longer than its caller?", "body": "<blockquote>\n  <p>Is the previous code 'unsafe' in any way ? If so, why ?</p>\n</blockquote>\n\n<p>The goal of Rust's type-checking and borrow-checking system is to disallow unsafe programs, but that does not mean that all programs that fail to compile are unsafe. In this specific case, your code is not unsafe, but it does not satisfy the type constraints of the functions you are using.</p>\n\n<blockquote>\n  <ol start=\"2\">\n  <li>The function it's referring to clearly invokes .join() on said thread.</li>\n  </ol>\n</blockquote>\n\n<p>But there is nothing from a type-checker standpoint that <em>requires</em> the call the <code>.join</code>. A type-checking system (on its own) can't enforce that a function has or has not been called on a given object. You could just as easily imagine an example like </p>\n\n<pre><code>let message = \"Can't shoot yourself in the foot if you ain't got no gun\";\nlet mut handles = vec![];\nfor i in 0..3 {\n    let t1 = std::thread::spawn(|| {\n        println!(\"{} {}\", message, i);\n    });\n    handles.push(t1);\n}\nfor t1 in handles {\n    t1.join();\n}\n</code></pre>\n\n<p>where a human can tell that each thread is joined before <code>main</code> exits. But a typechecker has no way to know that.</p>\n\n<blockquote>\n  <ol>\n  <li>The function it's referring to here is (I believe) main. So presumably those threads will be killed when main exists anyway (and them running after main exists is ub).</li>\n  </ol>\n</blockquote>\n\n<p>From the standpoint of the checkers, <code>main</code> is just another function. There is no special knowledge that this specific function can have extra behavior. If this were any other function, the thread would not be auto-killed. Expanding on that, even for <code>main</code> there is no guarantee that the child threads will be killed <em>instantly</em>. If it takes 5ms for the child threads to be killed, that is still 5ms where the child threads could be accessing the content of a variable that has gone out of scope.</p>\n\n<p>To gain the behavior that you are looking for with this specific snippet (as-is), the lifetime of the closure would have to be tied to the lifetime of the <code>t1</code> object, such that the closure was guaranteed to never be used after the handles have been cleaned up. While that is certainly <em>an</em> option, it is significantly less flexible in the general case. Because it would be enforced at the type level, there would be no way to opt out of this behavior.</p>\n\n<p>You could consider using <a href=\"https://crates.io/crates/crossbeam\" rel=\"nofollow noreferrer\"><code>crossbeam</code></a>, specifically <a href=\"https://docs.rs/crossbeam/0.3.0/crossbeam/struct.Scope.html#method.spawn\" rel=\"nofollow noreferrer\"><code>crossbeam::scope</code>'s <code>.spawn</code></a>, which enforces this lifetime requirement where the standard library does not, meaning a thread <em>must</em> stop execution before the <code>scope</code> is finished.</p>\n\n<p>In your specific case, your code works fine as long as you transfer ownership of <code>message</code> to the child thread instead of borrowing it from the <code>main</code> function, because there is no risk of unsafe code with or without your call to <code>.join</code>. Your code works fine if you change</p>\n\n<pre><code>let t1 = std::thread::spawn(|| {\n</code></pre>\n\n<p>to</p>\n\n<pre><code>let t1 = std::thread::spawn(move || {\n</code></pre>\n"}], "owner": {"reputation": 2415, "user_id": 7156008, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/QzIXM.jpg?s=128&g=1", "display_name": "George", "link": "https://stackoverflow.com/users/7156008/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 680, "favorite_count": 0, "closed_date": 1501766702, "answer_count": 1, "score": 1, "last_activity_date": 1538930058, "creation_date": 1501722870, "last_edit_date": 1501768365, "question_id": 45473260, "link": "https://stackoverflow.com/questions/45473260/how-can-rust-be-told-that-a-thread-does-not-live-longer-than-its-caller", "closed_reason": "Duplicate", "title": "How can Rust be told that a thread does not live longer than its caller?", "body": "<p>I have the following code:</p>\n\n<pre><code>fn main() {\n    let message = \"Can't shoot yourself in the foot if you ain't got no gun\";\n    let t1 = std::thread::spawn(|| {\n        println!(\"{}\", message);\n    });\n    t1.join();\n}\n</code></pre>\n\n<p><code>rustc</code> gives me the compilation error:</p>\n\n<blockquote>\n  <p>closure may outlive the current function, but it borrows <code>message</code>, which is owned by the current function</p>\n</blockquote>\n\n<p>This is wrong since:</p>\n\n<ol>\n<li><p>The function it's referring to here is (I believe) main. The threads will be killed or enter in UB once main is finished executing.</p></li>\n<li><p>The function it's referring to clearly invokes .join() on said thread.</p></li>\n</ol>\n\n<p>Is the previous code unsafe in any way? If so, why? If not, how can I get the compiler to understand that?</p>\n\n<p>Edit: Yes I am aware I can just move the message in this case, my question is specifically asking how can I pass a reference to it (preferably without having to heap allocate it, similarly to how this code would do it:</p>\n\n<pre><code>std::thread([&amp;message]() -&gt; void {/* etc */});\n</code></pre>\n\n<p>(Just to clarify, what I'm actually trying to do is access a thread safe data structure from two threads... other solutions to the problem that don't involve making the copy work would also help).</p>\n\n<p>Edit2: The question this has been marked as a duplicate of is 5 pages long and as such I'd consider it and invalid question in it's own right.</p>\n"}]