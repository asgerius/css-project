[{"tags": ["c++", "winapi", "rust"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1560383906, "post_id": 56571553, "comment_id": 99722140, "body": "<code>_variant_t</code> is a c++ class so I suppose you must bind something to one of its constructor. Bindgen should be able to do it for you. How do you bind all this API so far ? Your question lack of detail."}, {"owner": {"reputation": 449289, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 2, "creation_date": 1560384479, "post_id": 56571553, "comment_id": 99722236, "body": "<code>_variant_t</code> is just a C++ helper class that wraps a COM <code>VARIANT</code>, it automates memory management and reference counting for <code>VARIANT</code> values.  <code>_variant_t</code> doesn&#39;t exist in other languages, like Rust, so you will have to construct a <code>VARIANT</code> manually and populate it as needed."}, {"owner": {"reputation": 449289, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 2, "creation_date": 1560384496, "post_id": 56571553, "comment_id": 99722240, "body": "A COM <a href=\"https://docs.microsoft.com/en-us/windows/desktop/api/oaidl/ns-oaidl-tagvariant\" rel=\"nofollow noreferrer\"><code>VARIANT</code></a> is a tagged union, have a look at <a href=\"http://patshaughnessy.net/2018/3/15/how-rust-implements-tagged-unions\" rel=\"nofollow noreferrer\">How Rust Implements Tagged Unions</a> and <a href=\"https://tonyarcieri.com/a-quick-tour-of-rusts-type-system-part-1-sum-types-a-k-a-tagged-unions\" rel=\"nofollow noreferrer\">A quick tour of Rust\u2019s Type System Part 1: Sum Types (a.k.a. Tagged Unions)</a>"}, {"owner": {"reputation": 6319, "user_id": 647380, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/07709965ee03bbc0a25288dc62102114?s=128&d=identicon&r=PG&f=1", "display_name": "pocesar", "link": "https://stackoverflow.com/users/647380/pocesar"}, "edited": false, "score": 0, "creation_date": 1560462905, "post_id": 56571553, "comment_id": 99755685, "body": "to be completely clear: I&#39;m stuck and have not made any progress, there&#39;s no reproducible example because of this, and winapi::um must have <code>winuser</code> enabled in Cargo features.  <code>VARIANT_n1</code> is private and can&#39;t be used when using <code>VARIANT { n1: &#47;*...*&#47; }</code>."}, {"owner": {"reputation": 71, "user_id": 15413699, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5694f9238be45aaa10774fb73b4eaa7c?s=128&d=identicon&r=PG&f=1", "display_name": "scrubjay55", "link": "https://stackoverflow.com/users/15413699/scrubjay55"}, "edited": false, "score": 0, "creation_date": 1617900778, "post_id": 56571553, "comment_id": 118445486, "body": "@pocesar did you ever find a solution? Im trying to create a scheduled task in windows with rust as well but no luck so far. Can you help?"}, {"owner": {"reputation": 1147, "user_id": 910227, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a4b3c15ceb1d27a05bd82954d1fb54c9?s=128&d=identicon&r=PG", "display_name": "Jannis Froese", "link": "https://stackoverflow.com/users/910227/jannis-froese"}, "reply_to_user": {"reputation": 71, "user_id": 15413699, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5694f9238be45aaa10774fb73b4eaa7c?s=128&d=identicon&r=PG&f=1", "display_name": "scrubjay55", "link": "https://stackoverflow.com/users/15413699/scrubjay55"}, "edited": false, "score": 0, "creation_date": 1618944140, "post_id": 56571553, "comment_id": 118754734, "body": "@scrubjay55 if you&#39;re still stuck check out my new reply"}], "answers": [{"comments": [{"owner": {"reputation": 6319, "user_id": 647380, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/07709965ee03bbc0a25288dc62102114?s=128&d=identicon&r=PG&f=1", "display_name": "pocesar", "link": "https://stackoverflow.com/users/647380/pocesar"}, "edited": false, "score": 0, "creation_date": 1560488784, "post_id": 56591363, "comment_id": 99760452, "body": "<code>the trait &#39;std::default::Default&#39; is not implemented for &#39;*mut winapi::um::taskschd::ITaskService&#39;</code> and <code>the trait &#39;std::default::Default&#39; is not implemented for &#39;winapi::um::oaidl::VARIANT_n1&#39;</code>. while searching for those methods, it seems that they are defined in another external crate, called <code>oaidl</code> (that makes working with those variants less painful)"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1560523574, "post_id": 56591363, "comment_id": 99776835, "body": "But <code>_variant_t</code> is not an union. It&#39;s class or I miss something"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "reply_to_user": {"reputation": 6319, "user_id": 647380, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/07709965ee03bbc0a25288dc62102114?s=128&d=identicon&r=PG&f=1", "display_name": "pocesar", "link": "https://stackoverflow.com/users/647380/pocesar"}, "edited": false, "score": 0, "creation_date": 1560524030, "post_id": 56591363, "comment_id": 99777105, "body": "@pocesar <a href=\"https://docs.rs/winapi/0.3.7/winapi/um/oaidl/struct.VARIANT_n1.html#impl-Default\" rel=\"nofollow noreferrer\">Default</a> is implemented for VARIANT_N1."}, {"owner": {"reputation": 46065, "user_id": 234590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/463c0219a51a5d1fd08e1fa280811b57?s=128&d=identicon&r=PG", "display_name": "Francis Gagn&#233;", "link": "https://stackoverflow.com/users/234590/francis-gagn%c3%a9"}, "reply_to_user": {"reputation": 6319, "user_id": 647380, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/07709965ee03bbc0a25288dc62102114?s=128&d=identicon&r=PG&f=1", "display_name": "pocesar", "link": "https://stackoverflow.com/users/647380/pocesar"}, "edited": false, "score": 0, "creation_date": 1560567718, "post_id": 56591363, "comment_id": 99789837, "body": "@pocesar Make sure you&#39;re using winapi 0.3.7 or later. The <code>Default</code> implementations were added in 0.3.7. Use <code>cargo update</code> to update your dependencies."}], "tags": [], "owner": {"reputation": 46065, "user_id": 234590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/463c0219a51a5d1fd08e1fa280811b57?s=128&d=identicon&r=PG", "display_name": "Francis Gagn&#233;", "link": "https://stackoverflow.com/users/234590/francis-gagn%c3%a9"}, "is_accepted": true, "score": 2, "last_activity_date": 1582595947, "last_edit_date": 1582595947, "creation_date": 1560486356, "answer_id": 56591363, "question_id": 56571553, "link": "https://stackoverflow.com/questions/56571553/how-to-use-a-com-variant-in-rust-winapi-programming/56591363#56591363", "title": "How to use a COM VARIANT in Rust winapi programming?", "body": "<p>Initializing unions is explained in <a href=\"https://github.com/retep998/winapi-rs/blob/46aa861d606b21ded202a606b1351214ea899fa3/README.md#how-do-i-create-an-instance-of-a-union\" rel=\"nofollow noreferrer\"><code>winapi</code>'s README</a>:</p>\n\n<blockquote>\n  <h2>How do I create an instance of a union?</h2>\n  \n  <p>Use <code>std::mem::zeroed()</code> to create an instance of the union, and then\n  assign the value you want using one of the variant methods.</p>\n</blockquote>\n\n<p>For instance, for <a href=\"https://docs.rs/winapi/0.3.7/winapi/um/oaidl/struct.VARIANT_n1.html\" rel=\"nofollow noreferrer\"><code>VARIANT_n1</code></a>, the methods are <code>n2</code>, <code>n2_mut</code>, <code>decVal</code> and <code>decVal_mut</code>. You will naturally need to use a <code>_mut</code> method to assign a value.</p>\n\n<p>Note that, starting with winapi 0.3.7, you can also use <code>Default::default()</code> to obtain a zeroed union instead of using the unsafe <code>std::mem::zeroed()</code>. You need to enable the <code>impl-default</code> feature on the <code>winapi</code> crate for the <code>Default</code> trait to be implemented.</p>\n"}, {"tags": [], "owner": {"reputation": 1147, "user_id": 910227, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a4b3c15ceb1d27a05bd82954d1fb54c9?s=128&d=identicon&r=PG", "display_name": "Jannis Froese", "link": "https://stackoverflow.com/users/910227/jannis-froese"}, "is_accepted": false, "score": 0, "last_activity_date": 1618944077, "creation_date": 1618944077, "answer_id": 67184576, "question_id": 56571553, "link": "https://stackoverflow.com/questions/56571553/how-to-use-a-com-variant-in-rust-winapi-programming/67184576#67184576", "title": "How to use a COM VARIANT in Rust winapi programming?", "body": "<p>You can construct a variant with</p>\n<pre class=\"lang-rust prettyprint-override\"><code>use winapi::um::oaidl::VARIANT;\n\nfn doStuff() {\n  unsafe {\n    let mut variant: VARIANT = std::mem::zeroed();\n    // set values here\n  }\n}\n</code></pre>\n<p><code>variant.n1.n2().vt</code> contains the type (e.g. winapi::shared::wtypes::VT_BOOL or winapi::shared::wtypes::VT_EMPTY, <a href=\"https://docs.microsoft.com/en-us/windows/win32/api/wtypes/ne-wtypes-varenum\" rel=\"nofollow noreferrer\">msdn describes the possible values here</a>), the <code>variant.n1.n2().n3</code> union contains the value.</p>\n"}], "owner": {"reputation": 6319, "user_id": 647380, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/07709965ee03bbc0a25288dc62102114?s=128&d=identicon&r=PG&f=1", "display_name": "pocesar", "link": "https://stackoverflow.com/users/647380/pocesar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 579, "favorite_count": 0, "accepted_answer_id": 56591363, "answer_count": 2, "score": 3, "last_activity_date": 1618944077, "creation_date": 1560381991, "last_edit_date": 1560464106, "question_id": 56571553, "link": "https://stackoverflow.com/questions/56571553/how-to-use-a-com-variant-in-rust-winapi-programming", "title": "How to use a COM VARIANT in Rust winapi programming?", "body": "<p>I'm trying to convert the <a href=\"https://technet.microsoft.com/pt-br/aa382113(v=vs.71)\" rel=\"nofollow noreferrer\">C++ COM code</a> for <code>TaskScheduler</code> to Rust and am stuck with the <code>VARIANT</code> argument of <code>ITaskService::Connect</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern crate winapi;\nuse winapi::{\n    ctypes::c_void,\n    shared::{\n        guiddef::{GUID, REFCLSID, REFIID},\n        ntdef::{HRESULT, NULL},\n        rpcdce::{RPC_C_AUTHN_LEVEL_PKT_PRIVACY, RPC_C_IMP_LEVEL_IMPERSONATE},\n        winerror::FAILED,\n        wtypes::VARENUM,\n        wtypesbase::CLSCTX_INPROC_SERVER,\n    },\n    um::{\n        combaseapi::{CoCreateInstance, CoInitializeEx, CoInitializeSecurity, CoUninitialize},\n        oaidl,\n        objbase::COINIT_MULTITHREADED,\n        taskschd::{ITaskService, TaskScheduler},\n    },\n    Class, Interface,\n}; // 0.3.7\n\nfn main() {\n    //  Create an instance of the Task Service.\n    let mut p_service: *mut ITaskService = unsafe { std::mem::zeroed() };\n\n    let hr = unsafe {\n        CoCreateInstance(\n            &amp;TaskScheduler::uuidof(),\n            std::ptr::null_mut(),\n            CLSCTX_INPROC_SERVER,\n            &amp;ITaskService::uuidof(),\n            &amp;mut p_service as *mut *mut ITaskService as *mut *mut c_void,\n        )\n    };\n\n    // [...]\n    // //  Connect to the task service.\n    // let hr = pService-&gt;Connect(_variant_t(), _variant_t(),\n    //     _variant_t(), _variant_t());\n\n    let hr = unsafe {\n        (&amp;mut *p_service).Connect(\n            oaidl::VARIANT { /* VT_EMPTY HERE */ },\n            oaidl::VARIANT { /* VT_EMPTY HERE */ },\n            oaidl::VARIANT { /* VT_EMPTY HERE */ },\n            oaidl::VARIANT { /* VT_EMPTY HERE */ },\n        )\n    };\n}\n</code></pre>\n\n<p><a href=\"https://docs.microsoft.com/en-us/cpp/cpp/variant-t-variant-t?view=vs-2019#remarks\" rel=\"nofollow noreferrer\">The docs</a> say:</p>\n\n<blockquote>\n  <p><strong><code>_variant_t( )</code></strong> Constructs an empty <code>_variant_t</code> object, <code>VT_EMPTY</code>.</p>\n</blockquote>\n\n<p>I found no mention on how to use the variant as stated in the README:</p>\n\n<blockquote>\n  <p>Use <code>std::mem::zeroed()</code> to create an instance of the union, and then assign the value you want using one of the variant methods.</p>\n</blockquote>\n\n<p>When checking the docs for \"variant\", there's no <code>_variant_t</code> fn on the list, so not sure what it is called in Rust</p>\n\n<p>Errors </p>\n\n<pre><code>field `0` of struct `winapi::um::oaidl::VARIANT_n1` is private\n\nfield `0` is private\n</code></pre>\n\n<p>for </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>  oaidl::VARIANT {\n    n1: oaidl::VARIANT_n1 {\n      0: [0, 0, 0]\n    }\n  }\n</code></pre>\n"}, {"tags": ["rust", "file-descriptor"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1560366718, "post_id": 56568186, "comment_id": 99716934, "body": "this unsafe look safe to do in your case"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1560406401, "post_id": 56568186, "comment_id": 99726707, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/55812291/bufreader-from-a-raw-fd\">BufReader from a raw fd</a>"}], "answers": [{"comments": [{"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1560364305, "post_id": 56568316, "comment_id": 99715923, "body": "How to deal with <code>unsafe</code> in these cases? is there a way to &quot;trap/catch&quot; if the file descriptor is not valid, etc?"}, {"owner": {"reputation": 2966, "user_id": 3022310, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7f10ec2b45320ee843e539d705c31d08?s=128&d=identicon&r=PG", "display_name": "turbulencetoo", "link": "https://stackoverflow.com/users/3022310/turbulencetoo"}, "edited": false, "score": 0, "creation_date": 1560364595, "post_id": 56568316, "comment_id": 99716037, "body": "It&#39;s not clear to me where the UB comes from, but I also don&#39;t understand enough about system calls to know what could go wrong when doing IO on a bad FD. How would a &quot;safe&quot; construct like the CPython interpreter handle something like this?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 2966, "user_id": 3022310, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7f10ec2b45320ee843e539d705c31d08?s=128&d=identicon&r=PG", "display_name": "turbulencetoo", "link": "https://stackoverflow.com/users/3022310/turbulencetoo"}, "edited": false, "score": 0, "creation_date": 1560364719, "post_id": 56568316, "comment_id": 99716084, "body": "@turbulencetoo that&#39;s a good point; I have gotten error messages about invalid file descriptors, so there might be some checking at the OS level that prevents that. I&#39;ll see if I can make that text more accurate."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 2966, "user_id": 3022310, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7f10ec2b45320ee843e539d705c31d08?s=128&d=identicon&r=PG", "display_name": "turbulencetoo", "link": "https://stackoverflow.com/users/3022310/turbulencetoo"}, "edited": false, "score": 1, "creation_date": 1560365221, "post_id": 56568316, "comment_id": 99716309, "body": "@turbulencetoo I&#39;ve updated to use the docs exact wording, which uses &quot;memory unsafety&quot; as opposed to &quot;undefined behavior&quot;"}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 2, "last_activity_date": 1560365180, "last_edit_date": 1560365180, "creation_date": 1560363971, "answer_id": 56568316, "question_id": 56568186, "link": "https://stackoverflow.com/questions/56568186/how-to-read-from-custom-file-descriptors-without-using-unsafe/56568316#56568316", "title": "How to read from custom file descriptors without using unsafe?", "body": "<p>You cannot do this. Your only avenue is to use <code>unsafe</code>.</p>\n\n<p>As stated in <a href=\"https://doc.rust-lang.org/std/os/unix/io/trait.FromRawFd.html#tymethod.from_raw_fd\" rel=\"nofollow noreferrer\">the documentation for <code>FromRawFd</code></a>:</p>\n\n<blockquote>\n  <p>This function is also unsafe as the primitives currently returned have the contract that they are the sole owner of the file descriptor they are wrapping. Usage of this function could accidentally allow violating this contract which can cause memory unsafety in code that relies on it being true.</p>\n</blockquote>\n\n<p>You <em>may</em> be able to make use of the <a href=\"http://man7.org/linux/man-pages/man2/fcntl.2.html\" rel=\"nofollow noreferrer\"><code>fcntl</code> function</a> to test if a given descriptor is valid, but I don't know the details about how these work in the presence of threading \u2014 it's possible that one thread checks for validity of the file descriptor and it's valid, another thread closes it, then the first attempts to use it. This is a straight-forward <a href=\"https://en.wikipedia.org/wiki/Time-of-check_to_time-of-use\" rel=\"nofollow noreferrer\">Time-of-check to time-of-use issue</a>.</p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/12340695/155423\">How to check if a given file descriptor stored in a variable is still valid?</a></li>\n</ul>\n"}], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 0, "accepted_answer_id": 56568316, "answer_count": 1, "score": 1, "last_activity_date": 1560365180, "creation_date": 1560363492, "last_edit_date": 1560363905, "question_id": 56568186, "link": "https://stackoverflow.com/questions/56568186/how-to-read-from-custom-file-descriptors-without-using-unsafe", "title": "How to read from custom file descriptors without using unsafe?", "body": "<p>From <a href=\"https://stackoverflow.com/a/54858184/1135424\">this answer</a>, I learned that a file descriptor can be read using <code>unsafe</code>: </p>\n\n<pre><code>use std::{\n    fs::File,\n    io::{self, Read},\n    os::unix::io::FromRawFd,\n};\n\nfn main() -&gt; io::Result&lt;()&gt; {\n    let mut f = unsafe { File::from_raw_fd(3) };\n    let mut input = String::new();\n    f.read_to_string(&amp;mut input)?;\n\n    println!(\"I read: {}\", input);\n\n    Ok(())\n}\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ cat /tmp/output\nHello, world!\n$ target/debug/example 3&lt; /tmp/output\nI read: Hello, world!\n</code></pre>\n\n<p>How can I achieve the same result without using <code>unsafe</code>?</p>\n\n<p>I am currently creating a file descriptor like this (<code>zsh</code> shell):</p>\n\n<pre><code>function test_fd {\n   if ! read -r line &lt;&amp;$1; then\n       line=\"[Read on fd $1 failed]\"\n   fi\n\n   echo $line\n\n   # Remove the handler and close the fd\n   zle -F $1\n   exec {1}&lt;&amp;-\n}\n\nexec {FD}&lt; &lt;(/path/to/my/app)\nzle -F $FD test_fd\n</code></pre>\n\n<p>I would like to replace the <code>test_fd</code> with something that could <code>read</code> or better if it could <code>read &amp; close</code> the provided file descriptor so that I could end with something like:</p>\n\n<pre><code>function test_fd {\n   /something/in/rust \"$@\"\n}\n\nexec {FD}&lt; &lt;(/path/to/my/app)\nzle -F $FD test_fd\n</code></pre>\n"}, {"tags": ["windows", "rust", "static-libraries", "libusb"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560350981, "post_id": 56564751, "comment_id": 99709338, "body": "I don&#39;t think it will affect your problem, but I would not have the <code>link</code> attribute in your code. Otherwise the build script and the code can diverge and then be conflicting."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560351080, "post_id": 56564751, "comment_id": 99709398, "body": "You also can just type <code>version.major</code> etc. when printing."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 2, "creation_date": 1560351176, "post_id": 56564751, "comment_id": 99709463, "body": "My wild guess is that you are statically linking to a libusb shim that itself is dynamically linked to the DLL. You can probably run depwalker on the .lib you are linking to and see that it requires the DLL. Perhaps searching for libusb-specific information might help."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1560351241, "post_id": 56564751, "comment_id": 99709510, "body": "<i><a href=\"https://stackoverflow.com/a/21050046/155423\">If you are linking to the static LIB file you&#39;re done, it will build the code in to your executable. If you&#39;re linking to the LIB file for the DLL make sure the DLL is available in your execution path</a></i>. So, check to see if there&#39;s a different <code>.lib</code> file that you can link against. It&#39;s also possible that vcpkg doesn&#39;t provide the fully static library."}, {"owner": {"reputation": 1463, "user_id": 3703503, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1ca51bdb8bc5906975c4133f0bf4873c?s=128&d=identicon&r=PG&f=1", "display_name": "SlySherZ", "link": "https://stackoverflow.com/users/3703503/slysherz"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560352415, "post_id": 56564751, "comment_id": 99710208, "body": "Dependency Walker says &quot;No DOS or PE signature found. This file is not a valid [...] Windows module&quot;."}, {"owner": {"reputation": 46065, "user_id": 234590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/463c0219a51a5d1fd08e1fa280811b57?s=128&d=identicon&r=PG", "display_name": "Francis Gagn&#233;", "link": "https://stackoverflow.com/users/234590/francis-gagn%c3%a9"}, "edited": false, "score": 2, "creation_date": 1560487043, "post_id": 56564751, "comment_id": 99760034, "body": "Did you build libusb as a static library? vcpkg builds dynamic libraries by default. You must build with a <a href=\"https://vcpkg.readthedocs.io/en/latest/users/triplets/\" rel=\"nofollow noreferrer\">triplet</a> that requests static libraries."}, {"owner": {"reputation": 1463, "user_id": 3703503, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1ca51bdb8bc5906975c4133f0bf4873c?s=128&d=identicon&r=PG&f=1", "display_name": "SlySherZ", "link": "https://stackoverflow.com/users/3703503/slysherz"}, "edited": false, "score": 0, "creation_date": 1560517331, "post_id": 56564751, "comment_id": 99773441, "body": "Using a different triplet worked: <code>vcpkg.exe install libusb:x64-windows-static</code>."}], "answers": [{"tags": [], "owner": {"reputation": 1463, "user_id": 3703503, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1ca51bdb8bc5906975c4133f0bf4873c?s=128&d=identicon&r=PG&f=1", "display_name": "SlySherZ", "link": "https://stackoverflow.com/users/3703503/slysherz"}, "is_accepted": false, "score": 2, "last_activity_date": 1563893667, "creation_date": 1563893667, "answer_id": 57166922, "question_id": 56564751, "link": "https://stackoverflow.com/questions/56564751/rust-program-requires-the-libusb-dll-to-be-present-even-though-it-was-statically/57166922#57166922", "title": "Rust program requires the libusb DLL to be present even though it was statically linked", "body": "<p>@Shepmaster was right, the libusb:x64-windows triplet for vcpkg only contains definitions that try to call the real functions from the DLL. </p>\n\n<p>I tried to load this library from a simple C program and I got the exact same error:</p>\n\n<p><strong>test.c</strong></p>\n\n<pre><code>#include \"C:\\vcpkg\\installed\\x64-windows\\include\\libusb-1.0\\libusb.h\"\n\nint main()\n{\n    const struct libusb_version *version = libusb_get_version();\n    printf(\"Version %d.%d.%d\", version-&gt;major, version-&gt;minor, version-&gt;micro);\n}\n</code></pre>\n\n<p>compiled with:</p>\n\n<pre><code>cl test.c /link C:\\vcpkg\\installed\\x64-windows\\lib\\libusb-1.0.lib\n</code></pre>\n\n<p>results in the same missing DLL error. But if I do with with the different libusb:x64-windows-static triplet:</p>\n\n<p><strong>test.c</strong></p>\n\n<pre><code>#pragma comment(lib, \"Advapi32.lib\")\n#include \"C:\\vcpkg\\installed\\x64-windows-static\\include\\libusb-1.0\\libusb.h\"\n\nint main()\n{\n    const struct libusb_version *version = libusb_get_version();\n    printf(\"Version %d.%d.%d\", version-&gt;major, version-&gt;minor, version-&gt;micro);\n}\n</code></pre>\n\n<p>compiled with:</p>\n\n<pre><code>cl test.c /link C:\\vcpkg\\installed\\x64-windows-static\\lib\\libusb-1.0.lib\n</code></pre>\n\n<p>works just fine:</p>\n\n<pre><code>&gt;test.exe\nVersion 1.0.22\n</code></pre>\n\n<p>To sum it up, if you want to statically link a Rust program against libusb, download <a href=\"https://github.com/microsoft/vcpkg\" rel=\"nofollow noreferrer\">vspkg</a> and install \n<code>vcpkg.exe install libusb:x64-windows-static</code>.\nSet an environment variable <code>LIBUSB_DIR</code> that points to <code>C:\\vcpkg\\installed\\x64-windows-static</code> and use the patched version of libusb-sys by putting this in your </p>\n\n<p><strong>Cargo.toml</strong>:</p>\n\n<pre><code>[dependencies]\nlibusb = \"0.3\"\nlibusb-sys = \"0.2.3\"\n\n[patch.crates-io]\n\"libusb-sys\" = { git = \"https://github.com/cmsd2/libusb-sys\" }\n</code></pre>\n"}], "owner": {"reputation": 1463, "user_id": 3703503, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1ca51bdb8bc5906975c4133f0bf4873c?s=128&d=identicon&r=PG&f=1", "display_name": "SlySherZ", "link": "https://stackoverflow.com/users/3703503/slysherz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1050, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1563893667, "creation_date": 1560350265, "last_edit_date": 1560434916, "question_id": 56564751, "link": "https://stackoverflow.com/questions/56564751/rust-program-requires-the-libusb-dll-to-be-present-even-though-it-was-statically", "title": "Rust program requires the libusb DLL to be present even though it was statically linked", "body": "<p>I'm trying to make a Rust program that statically links against libusb, using the MSVC toolchain, but it blows up at run-time from a missing DLL:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error: process didn't exit successfully: `target\\debug\\test_libusb.exe` (exit code: 0xc0000135, STATUS_DLL_NOT_FOUND)\n</code></pre>\n\n<p>I used <a href=\"http://www.dependencywalker.com/\" rel=\"nofollow noreferrer\">Dependency Walker</a> to find that the missing DLL is LIBUSB-1.0.DLL. Adding it to the project solves the problem and so does dynamically linking everything, but I would like to avoid this solution.</p>\n\n<p>My starting point was this <a href=\"https://github.com/cmsd2/libusb-sys\" rel=\"nofollow noreferrer\">libusb-sys crate</a>, but since it didn't work I made a simpler similar crate. I got libusb from vcpkg.</p>\n\n<p><strong>libusb-sys/src/lib.rs</strong></p>\n\n<pre><code>extern crate libc;\n\nuse libc::c_char;\n\n#[repr(C)]\npub struct libusb_version {\n    pub major: u16,\n    pub minor: u16,\n    pub micro: u16,\n    pub nano: u16,\n    pub rc: *const c_char,\n    pub describe: *const c_char,\n}\n\n#[link(name = \"libusb-1.0\", kind = \"static\")]\nextern \"C\" {\n    pub fn libusb_get_version() -&gt; *const libusb_version;\n}\n</code></pre>\n\n<p><strong>libusb-sys/Cargo.toml</strong></p>\n\n<pre><code>[package]\nname = \"libusb-sys\"\nversion = \"0.1.0\"\n\nbuild = \"build.rs\"\nlink = \"libusb-1.0\"\n\n[dependencies]\nlibc = \"0.2\"\n</code></pre>\n\n<p><strong>libusb-sys/build.rs</strong></p>\n\n<pre><code>fn main() {\n    println!(\"\ncargo:rustc-link-lib=static=libusb-1.0\ncargo:rustc-link-search=native=C:/vcpkg/packages/libusb_x64-windows/lib\")\n}\n</code></pre>\n\n<p>Then I used this on my program's crate:</p>\n\n<p><strong>test_libusb/src/main.rs</strong></p>\n\n<pre><code>extern crate libusb_sys as ffi;\n\nfn main() {\n    unsafe {\n        let version = ffi::libusb_get_version();\n\n        println!(\n            \"libusb v{}.{}.{}.{}\",\n            (*version).major,\n            (*version).minor,\n            (*version).micro,\n            (*version).nano\n        );\n    }\n}\n</code></pre>\n\n<p><strong>test_libusb/Cargo.toml</strong></p>\n\n<pre><code>[package]\nname = \"test_libusb\"\nversion = \"0.1.0\"\n\n[dependencies]\n\"libusb-sys\" = { path = \"../libusb-sys\" }\n</code></pre>\n\n<p>Here's the entire compiler output, in case it's helpful:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>G:\\programming\\rust\\test_libusb&gt; cargo run --verbose\n   Compiling libc v0.2.58\n   Compiling libusb-sys v0.1.0 (G:\\programming\\rust\\libusb-sys)\n     Running `rustc --crate-name build_script_build C:\\Users\\slysherz\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\libc-0.2.58\\build.rs --color always --crate-type bin --emit=dep-info,link -C debuginfo=2 --cfg \"feature=\\\"default\\\"\" --cfg \"feature=\\\"std\\\"\" -C metadata=f83941a94611be11 -C extra-filename=-f83941a94611be11 --out-dir G:\\programming\\rust\\test_libusb\\target\\debug\\build\\libc-f83941a94611be11 -L dependency=G:\\programming\\rust\\test_libusb\\target\\debug\\deps --cap-lints allow`     \n     Running `rustc --crate-name build_script_build G:\\programming\\rust\\libusb-sys\\build.rs --color always --crate-type bin --emit=dep-info,link -C debuginfo=2 -C metadata=71e53c2aee584c72 -C extra-filename=-71e53c2aee584c72 --out-dir G:\\programming\\rust\\test_libusb\\target\\debug\\build\\libusb-sys-71e53c2aee584c72 -C incremental=G:\\programming\\rust\\test_libusb\\target\\debug\\incremental -L dependency=G:\\programming\\rust\\test_libusb\\target\\debug\\deps`     \n     Running `G:\\programming\\rust\\test_libusb\\target\\debug\\build\\libusb-sys-71e53c2aee584c72\\build-script-build`\n     Running `G:\\programming\\rust\\test_libusb\\target\\debug\\build\\libc-f83941a94611be11\\build-script-build`\n     Running `rustc --crate-name libc C:\\Users\\slysherz\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\libc-0.2.58\\src\\lib.rs --color always --crate-type lib --emit=dep-info,link -C debuginfo=2 --cfg \"feature=\\\"default\\\"\" --cfg \"feature=\\\"std\\\"\" -C metadata=b67580e06366e753 -C extra-filename=-b67580e06366e753 --out-dir G:\\programming\\rust\\test_libusb\\target\\debug\\deps -L dependency=G:\\programming\\rust\\test_libusb\\target\\debug\\deps --cap-lints allow --cfg libc_priv_mod_use --cfg libc_union --cfg libc_const_size_of --cfg libc_align --cfg libc_core_cvoid --cfg libc_packedN`     \n     Running `rustc --crate-name libusb_sys G:\\programming\\rust\\libusb-sys\\src\\lib.rs --color always --crate-type lib --emit=dep-info,link -C debuginfo=2 -C metadata=94e8ef72b03c18f5 -C extra-filename=-94e8ef72b03c18f5 --out-dir G:\\programming\\rust\\test_libusb\\target\\debug\\deps -C incremental=G:\\programming\\rust\\test_libusb\\target\\debug\\incremental -L dependency=G:\\programming\\rust\\test_libusb\\target\\debug\\deps --extern libc=G:\\programming\\rust\\test_libusb\\target\\debug\\deps\\liblibc-b67580e06366e753.rlib -L native=C:/vcpkg/packages/libusb_x64-windows/lib -l static=libusb-1.0`   \n    Compiling test_libusb v0.1.0 (G:\\programming\\rust\\test_libusb)\n     Running `rustc --crate-name test_libusb src\\main.rs --color always --crate-type bin --emit=dep-info,link -C debuginfo=2 -C metadata=8f2bb1a8f56e2223 -C extra-filename=-8f2bb1a8f56e2223 --out-dir G:\\programming\\rust\\test_libusb\\target\\debug\\deps -C incremental=G:\\programming\\rust\\test_libusb\\target\\debug\\incremental -L dependency=G:\\programming\\rust\\test_libusb\\target\\debug\\deps --extern libusb_sys=G:\\programming\\rust\\test_libusb\\target\\debug\\deps\\liblibusb_sys-94e8ef72b03c18f5.rlib -L native=C:/vcpkg/packages/libusb_x64-windows/lib`    \n     Finished dev [unoptimized + debuginfo] target(s) in 1.20s\n     Running `target\\debug\\test_libusb.exe`\nerror: process didn't exit successfully: `target\\debug\\test_libusb.exe` (exit code: 0xc0000135, STATUS_DLL_NOT_FOUND)\n</code></pre>\n\n<p>Even after compiling libusb from scratch with VS 2017 I still get a link error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>= note: test_libusb-528eb6acc7e5c681.3w5rrhap2r2yw5if.rcgu.o : error LNK2019: unresolved external symbol libusb_get_version referenced in function _ZN11test_libusb4main17hcb0c36db62706c3bE\n          G:\\programming\\rust\\test_libusb\\target\\debug\\deps\\test_libusb-528eb6acc7e5c681.exe : fatal error LNK1120: 1 unresolved externals\n</code></pre>\n\n<p>When I call this function directly from the first crate it works though.</p>\n\n<p>I've started to learn Rust recently, so I'm not sure about how any of this works. Why does Rust try to load a DLL in this situation?</p>\n"}, {"tags": ["rust", "bluetooth-lowenergy"], "comments": [{"owner": {"reputation": 2561, "user_id": 11476836, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c679da3a7b9adc6f980fb698e3f46b0b?s=128&d=identicon&r=PG&f=1", "display_name": "Marcos G.", "link": "https://stackoverflow.com/users/11476836/marcos-g"}, "edited": false, "score": 0, "creation_date": 1560355391, "post_id": 56564737, "comment_id": 99711911, "body": "Can you please add more details to your question? if you can share exactly what dev board, what stream of numbers you would expect and what you are actually getting it would be easier to see what might be wrong."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8725011"}, "reply_to_user": {"reputation": 2561, "user_id": 11476836, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c679da3a7b9adc6f980fb698e3f46b0b?s=128&d=identicon&r=PG&f=1", "display_name": "Marcos G.", "link": "https://stackoverflow.com/users/11476836/marcos-g"}, "edited": false, "score": 0, "creation_date": 1560411444, "post_id": 56564737, "comment_id": 99729112, "body": "yes, sure. I just did."}, {"owner": {"reputation": 2561, "user_id": 11476836, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c679da3a7b9adc6f980fb698e3f46b0b?s=128&d=identicon&r=PG&f=1", "display_name": "Marcos G.", "link": "https://stackoverflow.com/users/11476836/marcos-g"}, "edited": false, "score": 0, "creation_date": 1560416016, "post_id": 56564737, "comment_id": 99731538, "body": "OK, what hardware are you using on your computer&#39;s side? Have you tried to set up a virtual serial port on Linux to see if you receive the sequence you expect? Maybe something like <a href=\"http://www.userk.co.uk/arduino-bluetooth-linux/\" rel=\"nofollow noreferrer\">this</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8725011"}, "reply_to_user": {"reputation": 2561, "user_id": 11476836, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c679da3a7b9adc6f980fb698e3f46b0b?s=128&d=identicon&r=PG&f=1", "display_name": "Marcos G.", "link": "https://stackoverflow.com/users/11476836/marcos-g"}, "edited": false, "score": 0, "creation_date": 1560417794, "post_id": 56564737, "comment_id": 99732501, "body": "I am currently using the on-board hci device  hci0:\tType: Primary  Bus: USB \tBD Address: XX:XX:XX:XX:XX:XX  ACL MTU: 1021:4  SCO MTU: 96:6 \tHCI Version: 4.2 (0x8)  Revision: 0x100 \tLMP Version: 4.2 (0x8)  Subversion: 0x100 \tManufacturer: Intel Corp. (2)  Thank you for the example. This implies the support of rfcomm, which is not part of bluetooth LE, but i am surely wrong here. Nevertheless I tried to bind the device to a virtual port (if rfcomm is what you mean by that), and the channel closes immediately."}, {"owner": {"reputation": 2561, "user_id": 11476836, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c679da3a7b9adc6f980fb698e3f46b0b?s=128&d=identicon&r=PG&f=1", "display_name": "Marcos G.", "link": "https://stackoverflow.com/users/11476836/marcos-g"}, "edited": false, "score": 0, "creation_date": 1560419474, "post_id": 56564737, "comment_id": 99733463, "body": "What I mean is you should find  way to verify that your dev board is working and sending data correctly. RFCOMM should work with LE, you can use <code>hcitool lescan </code> .  Are you able to bind? There are some useful <a href=\"https://askubuntu.com/questions/248817/how-to-i-connect-a-raw-serial-terminal-to-a-bluetooth-connection\">questions</a> on askubuntu, maybe you can take a look and see if they help?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8725011"}, "reply_to_user": {"reputation": 2561, "user_id": 11476836, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c679da3a7b9adc6f980fb698e3f46b0b?s=128&d=identicon&r=PG&f=1", "display_name": "Marcos G.", "link": "https://stackoverflow.com/users/11476836/marcos-g"}, "edited": false, "score": 0, "creation_date": 1560487795, "post_id": 56564737, "comment_id": 99760196, "body": "Thank you for the hints. The device can be found via lescan, but not be bound. I tried to bind to a an rfcomm channel, but without success. The firmware has been tested, but on a different OS (osx, while currently working on linux). This might be a hint, on whats missing."}, {"owner": {"reputation": 2561, "user_id": 11476836, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c679da3a7b9adc6f980fb698e3f46b0b?s=128&d=identicon&r=PG&f=1", "display_name": "Marcos G.", "link": "https://stackoverflow.com/users/11476836/marcos-g"}, "edited": false, "score": 0, "creation_date": 1560488685, "post_id": 56564737, "comment_id": 99760420, "body": "I think you&#39;re on the right track there, maybe try with other LE devices to see if you have a driver problem?"}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user8725011"}, "is_accepted": true, "score": 0, "last_activity_date": 1560925547, "creation_date": 1560925547, "answer_id": 56661298, "question_id": 56564737, "link": "https://stackoverflow.com/questions/56564737/reading-serial-data-stream-from-bluetooth-5-le-devboard-via-rumble/56661298#56661298", "title": "Reading Serial Data Stream from Bluetooth 5 LE DevBoard via Rumble", "body": "<p>Solved it. </p>\n\n<p>The main problem was, that I didn't fully understand the GATT profile and thus the Bluetooth LE protocol. This <a href=\"https://learn.adafruit.com/introduction-to-bluetooth-low-energy/gatt\" rel=\"nofollow noreferrer\">resource</a> gives a good introduction into this topic. </p>\n\n<p>The solution is to subscribe to data (event) updates, after the device has been connected and register an event handler, that reacts to incoming data. It was that simple. </p>\n\n\n\n<pre><code>// ... same code as before, but only the relevant pieces are shown.\nmdevice.connect().expect(\"Could not connect to device\");\nstd::thread::sleep(std::time::Duration::from_secs(1));\n\nlet chars = mdevice.discover_characteristics()\n.expect(\"Discovering characteristics failed\");\n\nstd::thread::sleep(std::time::Duration::from_secs(1));\n\nlet receive_characteristic = chars.clone().into_iter()\n.find(|c| \n{\n                // The constant is just a fixed array\n                RECEIVE_CHARACTERISTIC == c.uuid\n}).expect(\"Could not find given characteristic\");\n\n// subscribe to the event\nmdevice.subscribe(&amp;receive_characteristic)\n\nmdevice.on_notification(Box::from(move |v : rumble::api::ValueNotification| \n{\n// do something with the received data\n}));\n\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8725011"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 56661298, "answer_count": 1, "score": 0, "last_activity_date": 1560925547, "creation_date": 1560350183, "last_edit_date": 1560411430, "question_id": 56564737, "link": "https://stackoverflow.com/questions/56564737/reading-serial-data-stream-from-bluetooth-5-le-devboard-via-rumble", "title": "Reading Serial Data Stream from Bluetooth 5 LE DevBoard via Rumble", "body": "<p>I am trying to read a serial data stream coming from a bluetooth low energy devboard. The firmware registers as UART emulation service ( custom UUID ), and sends data via Receive_Characteristic ( custom UUID ). The serial data being send is just an incrementing numbers.</p>\n\n<p>Using <a href=\"https://github.com/mwylde/rumble/\" rel=\"nofollow noreferrer\">rumble</a>, I am able to form a connection to the device, and read something, but not the stream. What follows is a minimal working code example:</p>\n\n\n\n<pre><code>    let manager = Manager::new().unwrap();\n\n    let mut adapter = manager\n        .adapters()\n        .expect(\"could not list adapters\")\n        .into_iter()\n        .find(|a| a.name == self.adapter_name)\n        .expect(\"could not find adapter by name\");\n\n    println!(\"power cycle adapter\");\n    adapter = manager.down(&amp;adapter).unwrap();\n    adapter = manager.up(&amp;adapter).unwrap();\n    println!(\"connect adapter\");\n\n    let central = adapter.connect().unwrap();\n    central.start_scan().unwrap();\n    println!(\n        \"find desired {:?} peripheral...\",\n        &amp;self.device_name\n    );\n\n    // keep scanning for 10 s\n    std::thread::sleep(std::time::Duration::from_secs(1));\n    central.stop_scan().unwrap();\n\n    let peripherals = central.peripherals();\n\n\n\n    let mdevice = central\n        .peripherals()\n        .into_iter()\n        .find(|perf| {\n            perf.properties()\n                .local_name\n                .iter()\n                .any(|name| name.contains(&amp;self.device_name))\n        })\n        .expect(\"could not find peripheral by name\");\n\n    std::thread::sleep(std::time::Duration::from_secs(1));\n\n    match mdevice.connect() {\n        Ok(d) =&gt; {\n            println!(\"mdevice connected\");\n            d\n        }\n        Err(err) =&gt; {\n            eprintln!(\"error connecting to mdevice: {:?}\", err);\n            panic!()\n        }\n    };\n    std::thread::sleep(std::time::Duration::from_secs(1));\n    println!(\"discovering characteristics\");\n\n    for ch in mdevice.discover_characteristics().unwrap().into_iter() {\n        println!(\"found characteristic: {:?}\", ch);\n    }\n    std::thread::sleep(std::time::Duration::from_secs(1));\n    println!(\"get desired characteristic\");\n    let receive_characteristic = mdevice\n        .discover_characteristics()\n        .unwrap()\n        .into_iter()\n        .find(|c| {\n            RECEIVE_CHARACTERISTIC == c.uuid\n        })\n        .expect(\"could not find given characteristic\");\n\n\n    // this is some testing code to print out received data\n    let (tx, rx) = std::sync::mpsc::channel();\n\n    std::thread::spawn(move || loop {\n        let data = match mdevice.read(&amp;receive_characteristic) {\n            Ok(d) =&gt; d,\n            Err(err) =&gt; { println!(\"received an error {:?}\", err); \n                          Vec::new()}\n        };\n        println!(\"send : {:02?}\", data);\n        match tx.send(data) {\n            Ok(d) =&gt; d,\n            Err(e) =&gt; println!(\"error {:?}\", e)\n        };\n    });    \n\n    loop {\n        let dd = rx.recv();\n        println!(\"received : {:02?}\", dd.unwrap());\n    }\n\n    Ok(())\n</code></pre>\n\n<p>Using rumble, I am able to connect to the device, but getting a stream is weird. I keep getting the same number in a vec, but get sometimes a number being in range of the increment. Is reading the serial stream being done correctly?</p>\n\n<p><em>EDIT</em>: I am currently using the nRF52840-DK development board. The firmware sends out incrementing numbers from 0 to 255, and then repeats the sequence. </p>\n"}, {"tags": ["rust", "backtrace"], "answers": [{"tags": [], "owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "is_accepted": true, "score": 25, "last_activity_date": 1560330854, "creation_date": 1560330854, "answer_id": 56558595, "question_id": 56558321, "link": "https://stackoverflow.com/questions/56558321/is-it-possible-to-print-a-backtrace-in-rust-without-panicking/56558595#56558595", "title": "Is it possible to print a backtrace in Rust without panicking?", "body": "<p>Rust uses the <a href=\"https://crates.io/crates/backtrace\" rel=\"noreferrer\">backtrace crate</a> to print the backtrace in case of panics (has been merged in <a href=\"https://github.com/rust-lang/rust/pull/60852\" rel=\"noreferrer\">PR #60852</a>).</p>\n\n<p>A simple example can be found in the crate documentation</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use backtrace::Backtrace;\n\nfn main() {\n    let bt = Backtrace::new();\n\n    // do_some_work();\n\n    println!(\"{:?}\", bt);\n}\n</code></pre>\n\n<p>which gives for example</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>stack backtrace:\n   0: playground::main::h6849180917e9510b (0x55baf1676201)\n             at src/main.rs:4\n   1: std::rt::lang_start::{{closure}}::hb3ceb20351fe39ee (0x55baf1675faf)\n             at /rustc/3c235d5600393dfe6c36eeed34042efad8d4f26e/src/libstd/rt.rs:64\n   2: {{closure}} (0x55baf16be492)\n             at src/libstd/rt.rs:49\n      do_call&lt;closure,i32&gt;\n             at src/libstd/panicking.rs:293\n   3: __rust_maybe_catch_panic (0x55baf16c00b9)\n             at src/libpanic_unwind/lib.rs:87\n   4: try&lt;i32,closure&gt; (0x55baf16bef9c)\n             at src/libstd/panicking.rs:272\n      catch_unwind&lt;closure,i32&gt;\n             at src/libstd/panic.rs:388\n      lang_start_internal\n             at src/libstd/rt.rs:48\n   5: std::rt::lang_start::h2c4217f9057b6ddb (0x55baf1675f88)\n             at /rustc/3c235d5600393dfe6c36eeed34042efad8d4f26e/src/libstd/rt.rs:64\n   6: main (0x55baf16762f9)\n   7: __libc_start_main (0x7fab051b9b96)\n   8: _start (0x55baf1675e59)\n   9: &lt;unknown&gt; (0x0)\n</code></pre>\n"}], "owner": {"reputation": 3492, "user_id": 118958, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/NwFFJ.jpg?s=128&g=1", "display_name": "ynimous", "link": "https://stackoverflow.com/users/118958/ynimous"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3565, "favorite_count": 3, "accepted_answer_id": 56558595, "answer_count": 1, "score": 13, "last_activity_date": 1560362127, "creation_date": 1560329992, "last_edit_date": 1560362127, "question_id": 56558321, "link": "https://stackoverflow.com/questions/56558321/is-it-possible-to-print-a-backtrace-in-rust-without-panicking", "title": "Is it possible to print a backtrace in Rust without panicking?", "body": "<p>Is it possible to print a backtrace (assuming RUST_BACKTRACE is enabled) without panicking? It seems that the only way of doing that is calling via <code>panic!</code>. If not, is there a reason for it?</p>\n"}, {"tags": ["rust", "traits"], "comments": [{"owner": {"reputation": 1901, "user_id": 225630, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/edb8bd2d383e517e23e87ad10da214f3?s=128&d=identicon&r=PG", "display_name": "davyzhang", "link": "https://stackoverflow.com/users/225630/davyzhang"}, "edited": false, "score": 0, "creation_date": 1560322162, "post_id": 56555910, "comment_id": 99692779, "body": "code link <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=1da24704be6ac37bf02c527e7cb4095a\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "is_accepted": true, "score": 9, "last_activity_date": 1560321493, "creation_date": 1560321493, "answer_id": 56556003, "question_id": 56555910, "link": "https://stackoverflow.com/questions/56555910/do-i-have-to-implement-a-trait-twice-when-implementing-it-for-both-reference-and/56556003#56556003", "title": "Do I have to implement a trait twice when implementing it for both reference and non-reference types?", "body": "<p>This is a good example for the <a href=\"https://doc.rust-lang.org/std/borrow/trait.Borrow.html\" rel=\"noreferrer\"><code>Borrow</code></a> trait.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::borrow::Borrow;\n\nstruct Bar;\n\ntrait Foo {\n    fn hi(&amp;self);\n}\n\nimpl&lt;B: Borrow&lt;Bar&gt;&gt; Foo for B {\n    fn hi(&amp;self) {\n        print!(\"hi\")\n    }\n}\n\nfn main() {\n    let bar = Bar;\n    (&amp;bar).hi();\n    &amp;bar.hi();\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 3, "last_activity_date": 1560361453, "creation_date": 1560361453, "answer_id": 56567737, "question_id": 56555910, "link": "https://stackoverflow.com/questions/56555910/do-i-have-to-implement-a-trait-twice-when-implementing-it-for-both-reference-and/56567737#56567737", "title": "Do I have to implement a trait twice when implementing it for both reference and non-reference types?", "body": "<p>No, you do not have to duplicate code. Instead, you can delegate:</p>\n\n<pre><code>impl Foo for &amp;'_ Bar {\n    fn hi(&amp;self) {\n        (**self).hi()\n    }\n}\n</code></pre>\n\n<p>I would go one step further and implement the trait for all references to types that implement the trait:</p>\n\n<pre><code>impl&lt;T: Foo&gt; Foo for &amp;'_ T {\n    fn hi(&amp;self) {\n        (**self).hi()\n    }\n}\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/28799372/155423\">When should I not implement a trait for references to implementors of that trait?</a></li>\n<li><a href=\"https://stackoverflow.com/q/48432842/155423\">Implementing a trait for reference and non reference types causes conflicting implementations</a></li>\n</ul>\n\n<hr>\n\n<blockquote>\n<pre><code>&amp;bar.hi();\n</code></pre>\n</blockquote>\n\n<p>This code is equivalent to <code>&amp;(bar.hi())</code> and probably not what you intended. </p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/47662253/155423\">Why is it legal to borrow a temporary?</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "is_accepted": false, "score": 3, "last_activity_date": 1560598281, "creation_date": 1560598281, "answer_id": 56609965, "question_id": 56555910, "link": "https://stackoverflow.com/questions/56555910/do-i-have-to-implement-a-trait-twice-when-implementing-it-for-both-reference-and/56609965#56609965", "title": "Do I have to implement a trait twice when implementing it for both reference and non-reference types?", "body": "<p>You can use <a href=\"https://doc.rust-lang.org/std/borrow/enum.Cow.html\" rel=\"nofollow noreferrer\"><code>Cow</code></a>:</p>\n\n<pre><code>use std::borrow::Cow;\n\n#[derive(Clone)]\nstruct Bar;\n\ntrait Foo {\n    fn hi(self) -&gt; &amp;'static str;\n}\n\nimpl&lt;'a, B&gt; Foo for B where B: Into&lt;Cow&lt;'a, Bar&gt;&gt; {\n    fn hi(self) -&gt; &amp;'static str {\n        let bar = self.into();\n\n        // bar is either owned or borrowed:\n        match bar {\n            Cow::Owned(_) =&gt; \"Owned\",\n            Cow::Borrowed(_) =&gt; \"Borrowed\",\n        }\n    }\n}\n\n/* Into&lt;Cow&gt; implementation */\n\nimpl&lt;'a&gt; From&lt;Bar&gt; for Cow&lt;'a, Bar&gt; {\n    fn from(f: Bar) -&gt; Cow&lt;'a, Bar&gt; {\n        Cow::Owned(f)\n    }\n}\n\nimpl&lt;'a&gt; From&lt;&amp;'a Bar&gt; for Cow&lt;'a, Bar&gt; {\n    fn from(f: &amp;'a Bar) -&gt; Cow&lt;'a, Bar&gt; {\n        Cow::Borrowed(f)\n    }\n}\n\n/* Proof it works: */\n\nfn main() {\n    let bar = &amp;Bar;\n    assert_eq!(bar.hi(), \"Borrowed\");\n\n    let bar = Bar;\n    assert_eq!(bar.hi(), \"Owned\");\n}\n</code></pre>\n\n<p>The one advantage over <code>Borrow</code> is that you know if the data was passed by value or reference, if that matters to you.</p>\n"}], "owner": {"reputation": 1901, "user_id": 225630, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/edb8bd2d383e517e23e87ad10da214f3?s=128&d=identicon&r=PG", "display_name": "davyzhang", "link": "https://stackoverflow.com/users/225630/davyzhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 720, "favorite_count": 0, "accepted_answer_id": 56556003, "answer_count": 3, "score": 5, "last_activity_date": 1560598281, "creation_date": 1560321111, "last_edit_date": 1560361064, "question_id": 56555910, "link": "https://stackoverflow.com/questions/56555910/do-i-have-to-implement-a-trait-twice-when-implementing-it-for-both-reference-and", "title": "Do I have to implement a trait twice when implementing it for both reference and non-reference types?", "body": "<p>I want to implement a trait for both a for reference and non-reference type. Do I have to implement the functions twice, or this is not idiomatic to do so?</p>\n\n<p>Here's the demo code:</p>\n\n<pre><code>struct Bar {}\n\ntrait Foo {\n    fn hi(&amp;self);\n}\n\nimpl&lt;'a&gt; Foo for &amp;'a Bar {\n    fn hi(&amp;self) {\n        print!(\"hi\")\n    }\n}\n\nimpl Foo for Bar {\n    fn hi(&amp;self) {\n        print!(\"hi\")\n    }\n}\n\nfn main() {\n    let bar = Bar {};\n    (&amp;bar).hi();\n    &amp;bar.hi();\n}\n</code></pre>\n"}, {"tags": ["rust", "rust-tokio"], "answers": [{"tags": [], "owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "is_accepted": false, "score": 1, "last_activity_date": 1560365826, "last_edit_date": 1560365826, "creation_date": 1560343443, "answer_id": 56562541, "question_id": 56555513, "link": "https://stackoverflow.com/questions/56555513/how-can-i-stop-reading-from-a-tokioiolines-stream/56562541#56562541", "title": "How can I stop reading from a tokio::io::lines stream?", "body": "<p>There's nothing wrong with your strategy, but it will only work with futures that don't execute a blocking operation via Tokio's <code>blocking</code> (the traditional kind of blocking <a href=\"https://stackoverflow.com/questions/48735952/why-does-futureselect-choose-the-future-with-a-longer-sleep-period-first\">should never be done inside a future</a>). </p>\n\n<p>You can test this by replacing the <code>tokio::io::lines(..)</code> future with a simple interval future:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let lines = Interval::new(Instant::now(), Duration::from_secs(1));\n</code></pre>\n\n<hr>\n\n<p>The problem is that <code>tokio::io::Stdin</code> internally uses <code>tokio_threadpool::blocking</code> .</p>\n\n<p>When you use <a href=\"https://docs.rs/tokio-threadpool/0.1.14/tokio_threadpool/fn.blocking.html\" rel=\"nofollow noreferrer\">Tokio thread pool blocking</a> (emphasis mine):</p>\n\n<blockquote>\n  <p>NB: The entire task that called blocking is blocked whenever the\n  supplied closure blocks, even if you have used future combinators <strong>such\n  as <code>select</code></strong> - the other futures in this task will not make progress\n  until the closure returns. If this is not desired, ensure that\n  <code>blocking runs in its</code> own task (e.g. using\n  <code>futures::sync::oneshot::spawn</code>).</p>\n</blockquote>\n\n<p>Since this will block every other future in the combinator, your <code>Receiver</code> will not be able to get a signal from the <code>Sender</code>until the blocking ends.</p>\n\n<p>Please see <a href=\"https://stackoverflow.com/questions/30012995/how-can-i-read-non-blocking-from-stdin\">How can I read non-blocking from stdin?</a> or you can use <a href=\"https://github.com/vi/tokio-stdin-stdout\" rel=\"nofollow noreferrer\">tokio-stdin-stdout</a>, which creates a channel to consume data from <code>stdin</code> thread. It also has a <strong>line-by-line</strong> example.</p>\n"}, {"comments": [{"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 0, "creation_date": 1560435676, "post_id": 56571590, "comment_id": 99743176, "body": "Actually the idea is Inside a <code>Future</code> wrap the blocking behavior with  Tokio&#39;s  <code>Blocking</code> otherwise don&#39;t use it inside Future. Only thing to know that closure that you wrap with Tokio&#39;s  <code>Blocking </code>  is <b>permitted to block indefinitely</b>, in your case thats what <code>Stdin</code> does."}, {"owner": {"reputation": 51, "user_id": 11633913, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J_EnkUNvDOo/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rclZBCbt8MKMHwztWX1HEcRqYsPKQ/mo/photo.jpg?sz=128", "display_name": "nkkr", "link": "https://stackoverflow.com/users/11633913/nkkr"}, "reply_to_user": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 0, "creation_date": 1560464935, "post_id": 56571590, "comment_id": 99756197, "body": "Thanks a lot!. Now that I understand my way of thinking, I will study more."}], "tags": [], "owner": {"reputation": 51, "user_id": 11633913, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J_EnkUNvDOo/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rclZBCbt8MKMHwztWX1HEcRqYsPKQ/mo/photo.jpg?sz=128", "display_name": "nkkr", "link": "https://stackoverflow.com/users/11633913/nkkr"}, "is_accepted": false, "score": 0, "last_activity_date": 1560382317, "creation_date": 1560382317, "answer_id": 56571590, "question_id": 56555513, "link": "https://stackoverflow.com/questions/56555513/how-can-i-stop-reading-from-a-tokioiolines-stream/56571590#56571590", "title": "How can I stop reading from a tokio::io::lines stream?", "body": "<p>Thank you for your comment and correcting my sentences.</p>\n\n<p>I tried to stop this non-blocking <code>Future</code> and succeeded.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let lines = Interval::new(Instant::now(), Duration::from_secs(1));\n</code></pre>\n\n<p>My understating is that it would work for this case to wrap the blocking <code>Future</code> with <code>tokio threadpool::blocking</code>.\nI'll try it later.</p>\n\n<p>Thank you very much.</p>\n"}], "owner": {"reputation": 51, "user_id": 11633913, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J_EnkUNvDOo/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rclZBCbt8MKMHwztWX1HEcRqYsPKQ/mo/photo.jpg?sz=128", "display_name": "nkkr", "link": "https://stackoverflow.com/users/11633913/nkkr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 954, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1560382317, "creation_date": 1560319056, "last_edit_date": 1560366308, "question_id": 56555513, "link": "https://stackoverflow.com/questions/56555513/how-can-i-stop-reading-from-a-tokioiolines-stream", "title": "How can I stop reading from a tokio::io::lines stream?", "body": "<p>I want to terminate reading from a <code>tokio::io::lines</code> stream. I merged it with a <code>oneshot</code> future and terminated it, but <code>tokio::run</code> was still working. </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use futures::{sync::oneshot, *}; // 0.1.27\nuse std::{io::BufReader, time::Duration};\nuse tokio::prelude::*; // 0.1.21\n\nfn main() {\n    let (tx, rx) = oneshot::channel::&lt;()&gt;();\n    let lines = tokio::io::lines(BufReader::new(tokio::io::stdin()));\n    let lines = lines.for_each(|item| {\n        println!(\"&gt; {:?}\", item);\n        Ok(())\n    });\n\n    std::thread::spawn(move || {\n        std::thread::sleep(Duration::from_millis(5000));\n        println!(\"system shutting down\");\n        let _ = tx.send(());\n    });\n\n    let lines = lines.select2(rx);\n\n    tokio::run(lines.map(|_| ()).map_err(|_| ()));\n}\n</code></pre>\n\n<p>How can I stop reading from this?</p>\n"}, {"tags": ["rust", "hyper"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1560298077, "post_id": 56552871, "comment_id": 99687588, "body": "It&#39;s hard to answer your question because it doesn&#39;t include a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. We can&#39;t tell what crates (and their versions), types, traits, fields, etc. are present in the code. It would make it easier for us to help you if you try to reproduce your error on the <a href=\"https://play.rust-lang.org\" rel=\"nofollow noreferrer\">Rust Playground</a> if possible, otherwise in a brand new Cargo project, then <a href=\"https://stackoverflow.com/posts/56552871/edit\">edit</a> your question to include the additional info. There are <a href=\"//stackoverflow.com/tags/rust/info\">Rust-specific MCVE tips</a> you can use to reduce your original code for posting here. Thanks!"}, {"owner": {"reputation": 3531, "user_id": 58237, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/9da797433f3c0761ec2f785627a2309c?s=128&d=identicon&r=PG", "display_name": "Fredrik Jansson", "link": "https://stackoverflow.com/users/58237/fredrik-jansson"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560313760, "post_id": 56552871, "comment_id": 99690282, "body": "Lesson learned, thank you!"}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560360843, "post_id": 56554685, "comment_id": 99714393, "body": "Answers without any prose to describe what the changes were and why they were needed are only minimally helpful to those who attempt to use them afterward."}], "tags": [], "owner": {"reputation": 3531, "user_id": 58237, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/9da797433f3c0761ec2f785627a2309c?s=128&d=identicon&r=PG", "display_name": "Fredrik Jansson", "link": "https://stackoverflow.com/users/58237/fredrik-jansson"}, "is_accepted": false, "score": -1, "last_activity_date": 1560360793, "last_edit_date": 1560360793, "creation_date": 1560313699, "answer_id": 56554685, "question_id": 56552871, "link": "https://stackoverflow.com/questions/56552871/how-can-i-use-a-hyper-client-from-a-grpc-function/56554685#56554685", "title": "How can I use a Hyper client from a gRPC function?", "body": "<p>I figured it out:</p>\n\n<pre><code>let fut = client\n    .get(Uri::from_static(AlphaFunction::base_url()))\n    .and_then(|res| res.into_body().concat2())\n    .and_then(move |body| {\n        info!(\"body {:?}\", body);\n        let mut r = quote::CurrentResponse::new();\n        r.set_symbol(symbol.to_string());\n        Ok(r)\n    })\n    .map_err(|e| grpc::Error::Panic(format!(\"{}\", e)));\n</code></pre>\n"}], "owner": {"reputation": 3531, "user_id": 58237, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/9da797433f3c0761ec2f785627a2309c?s=128&d=identicon&r=PG", "display_name": "Fredrik Jansson", "link": "https://stackoverflow.com/users/58237/fredrik-jansson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 386, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1560360793, "creation_date": 1560296006, "last_edit_date": 1560298072, "question_id": 56552871, "link": "https://stackoverflow.com/questions/56552871/how-can-i-use-a-hyper-client-from-a-grpc-function", "title": "How can I use a Hyper client from a gRPC function?", "body": "<p>I have a gRPC server and need to make a HTTP GET. I'm struggling getting the futures right in the calls.</p>\n\n<p>I'm trying this</p>\n\n<pre><code>fn current(\n    &amp;self,\n    _: ::grpc::RequestOptions,\n    p: quote::CurrentRequest,\n) -&gt; ::grpc::SingleResponse&lt;quote::CurrentResponse&gt; {\n    let symbol = p.get_symbol();\n\n    let client = Client::new();\n    let fut: grpc::GrpcFuture&lt;quote::CurrentResponse&gt; = Box::new(\n        client\n            .get(Uri::from_static(AlphaFunction::base_url()))\n            .and_then(|res| res.into_body().concat2())\n            .and_then(|body| {\n                info!(\"body {:?}\", body);\n                let mut r = quote::CurrentResponse::new();\n                // TODO: Parse body\n                r.set_symbol(symbol.to_string());\n                Ok(r)\n            })\n            .map_err(|e| e),\n    );\n\n    grpc::SingleResponse::new(fut)\n}\n</code></pre>\n\n<p>But I get a bunch of errors:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>expected struct `hyper::error::Error`, found enum `grpc::error::Error`\n</code></pre>\n\n<p>and</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>    77 |         grpc::SingleResponse::new(fut)\n       |         ^^^^^^^^^^^^^^^^^^^^^^^^^ expected struct `protos::quote::CurrentResponse`, found tuple\n</code></pre>\n"}, {"tags": ["unit-testing", "rust", "stub", "borrow-checker"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560297806, "post_id": 56552125, "comment_id": 99687544, "body": "See also <a href=\"https://stackoverflow.com/q/49093092/155423\">How to give a mocked value to a function which needs a reference with the &#39;static lifetime and implements Sync?</a>; <a href=\"https://stackoverflow.com/q/28370126/155423\">How can I test stdin and stdout?</a>"}, {"owner": {"reputation": 81, "user_id": 647994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bbfa985ee7b3d983a7f1fc58716e1c0?s=128&d=identicon&r=PG", "display_name": "Tropid", "link": "https://stackoverflow.com/users/647994/tropid"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560354224, "post_id": 56552125, "comment_id": 99711254, "body": "@Shepmaster Thank you, especially the second links is very interesting. This would&#39;ve been my solution 2. I just did not want to make the <code>TimeService</code> trait public in this case."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1560357984, "post_id": 56552125, "comment_id": 99713115, "body": "<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=6b07367b6ed35d6843526b3a4f716b26\" rel=\"nofollow noreferrer\">You don&#39;t have to make it public for unit tests</a>."}, {"owner": {"reputation": 81, "user_id": 647994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bbfa985ee7b3d983a7f1fc58716e1c0?s=128&d=identicon&r=PG", "display_name": "Tropid", "link": "https://stackoverflow.com/users/647994/tropid"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560360799, "post_id": 56552125, "comment_id": 99714370, "body": "I was thinking about the stdin/stdout testing example. In that case I&#39;d have a <code>Tracker&lt;T: TimeService&gt;</code> and would need to make the <code>TimeService</code> trait public. Your example is very instructive, though, thank you."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1560360928, "post_id": 56552125, "comment_id": 99714428, "body": "Right, but your code uses a trait object, so you don&#39;t need the generic. See also <a href=\"https://stackoverflow.com/q/44912349/155423\">How can I avoid a ripple effect from changing a concrete struct to generic?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 647994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bbfa985ee7b3d983a7f1fc58716e1c0?s=128&d=identicon&r=PG", "display_name": "Tropid", "link": "https://stackoverflow.com/users/647994/tropid"}, "edited": false, "score": 0, "creation_date": 1560354531, "post_id": 56552979, "comment_id": 99711435, "body": "Thank you very much! This answers my question perfectly and I really like this solution."}], "tags": [], "owner": {"reputation": 96489, "user_id": 788207, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/KQmlY.jpg?s=128&g=1", "display_name": "Vladimir Matveev", "link": "https://stackoverflow.com/users/788207/vladimir-matveev"}, "is_accepted": true, "score": 3, "last_activity_date": 1560297567, "last_edit_date": 1560297567, "creation_date": 1560296942, "answer_id": 56552979, "question_id": 56552125, "link": "https://stackoverflow.com/questions/56552125/how-to-inject-a-stub-for-a-trait-object-into-a-type-in-rust-and-keep-a-reference/56552979#56552979", "title": "How to inject a stub for a trait object into a type in Rust and keep a reference to it?", "body": "<p>You can make the <code>FakeTimeService</code> type cloneable, making its state shared across multiple cloned instances:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::rc::Rc;\n\n#[derive(Clone)]\nstruct FakeTimeService {\n    state: Rc&lt;FakeTimeServiceState&gt;,\n}\n\nimpl TimeService for FakeTimeService { ... }\n\nimpl FakeTimeService {\n    fn state(&amp;self) -&gt; &amp;FakeTimeServiceState {\n        *self.state\n    }\n}\n\nfn init_tracker() -&gt; (Tracker, FakeTimeService) {\n    let time_service = FakeTimeService::new();\n    let tracker = Tracker::with_time_service(Box::new(time_service.clone()));\n    (tracker, time_service)\n}\n</code></pre>\n\n<p>Now you'll be able to independently modify the fake time service state, while keeping the interface and implementation of the <code>Tracker</code> the same as before.</p>\n\n<p>Most likely you'll want to have some mutable state inside <code>FakeTimeService</code> in order to set up your test preconditions. Therefore, you will probably need to use some kind of internal mutability for the <code>FakeTimeService</code> state:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::rc::Rc;\nuse std::cell::{RefCell, RefMut};\n\n#[derive(Clone)]\nstruct FakeTimeService {\n    state: Rc&lt;RefCell&lt;FakeTimeServiceState&gt;&gt;,\n}\n\nimpl FakeTimeService {\n    fn state_mut(&amp;self) -&gt; RefMut&lt;FakeTimeServiceState&gt; {\n        self.state.borrow_mut()\n    }\n}\n\nstruct FakeTimeServiceState {\n    init_value: i32,\n}\n\nimpl FakeTimeServiceState {\n    fn set_initial_value(&amp;mut self, x: i32) {\n        self.init_value = x;\n    }\n}\n\nlet (tracker, time_service) = init_tracker();\ntime_service.state_mut().set_initial_value(123);\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 647994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bbfa985ee7b3d983a7f1fc58716e1c0?s=128&d=identicon&r=PG", "display_name": "Tropid", "link": "https://stackoverflow.com/users/647994/tropid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 56552979, "answer_count": 1, "score": 0, "last_activity_date": 1560297567, "creation_date": 1560289844, "question_id": 56552125, "link": "https://stackoverflow.com/questions/56552125/how-to-inject-a-stub-for-a-trait-object-into-a-type-in-rust-and-keep-a-reference", "title": "How to inject a stub for a trait object into a type in Rust and keep a reference to it?", "body": "<p>I'm trying to develop some kind of time tracking CLI tool in Rust. I try to cover most of the code with unit tests and got stuck about how to use stub objects with Rusts ownership restrictions.</p>\n\n<p>I have a type <code>Tracker</code> which has functions to start/stop tracking time. These functions query the current system time.</p>\n\n<p>To make this design testable I introduced the trait <code>TimeService</code> which provides the current timestamp. I have the \"real\" implementation <code>SystemTimeService</code> which returns the current system time and a fake implementation <code>FakeTimeService</code> for tests where the time can be set from the outside.</p>\n\n<p>This is the current implementation:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct Tracker {\n    // ...\n    time_service: Box&lt;TimeService&gt;,\n}\n\ntrait TimeService {\n    fn time(&amp;self) -&gt; u64;\n}\n</code></pre>\n\n<p>Here is the test I'd like to implement:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[test]\nfn tracker_end_when_called_tracks_total_time() {\n    let (tracker, time_service) = init_tracker();\n\n    time_service.set_seconds(0);\n    tracker.start(\"feature1\");\n    time_service.set_seconds(10);\n    tracker.end();\n\n    assert_eq!(tracker.total_time, 10);\n}\n\nfn init_tracker() -&gt; (Tracker, &amp;FakeTimeService) {\n    let time_service = Box::new(FakeTimeService::new());\n    let tracker = Tracker::with_time_service(time_service);\n\n    // does not compile, as time service's ownership has been\n    // moved to the tracker.\n    (tracker, &amp;*time_service)\n}\n</code></pre>\n\n<p>The problem is that I don't know how to access the fake time service from inside the unit test as it's ownership is taken by the tracker.</p>\n\n<p>I can imagine multiple solutions:</p>\n\n<ol>\n<li>Use <code>Rc</code> instead of <code>Box</code> inside the tracker for shared ownership of the time service</li>\n<li>Make the <code>Tracker</code> generic and add a type argument for the used <code>TimeTracker</code> implementation</li>\n<li>Add lifetimes to the <code>init_tracker</code> function</li>\n</ol>\n\n<p>I do not like using solution 1 as this would not express the idea that the service is part of the tracker (seems to violate encapsulation).</p>\n\n<p>Solution 2 is probably viable but in that case I'd need to make the <code>TimeService</code> trait and the used implementations public which I'd also like to avoid.</p>\n\n<p>So the most promising solution without changing the design seems to be lifetimes.\nIs it possible to add lifetimes to the variables in such a way that the <code>init_tracker</code> function can return the tracker and the fake time service?</p>\n\n<p>Are there any other solutions/best practices?</p>\n"}, {"tags": ["rust", "llvm", "llvm-ir"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1560324404, "post_id": 56549645, "comment_id": 99693780, "body": "Never used Rust, but I suspect you need to compile your sources with <code>rustc --emit=llvm-ir</code> and then use <code>llvm-link</code> to link resulting bitcode files into a single one."}, {"owner": {"reputation": 305, "user_id": 2378484, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/cb2904a2cd257d7fb1e2d08be3fcd742?s=128&d=identicon&r=PG", "display_name": "zsf222", "link": "https://stackoverflow.com/users/2378484/zsf222"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1560394667, "post_id": 56549645, "comment_id": 99723953, "body": "@arrowd I have tried the method on a hello world code, but there is a segmentation fault when running it with <code>lli</code> ."}], "owner": {"reputation": 305, "user_id": 2378484, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/cb2904a2cd257d7fb1e2d08be3fcd742?s=128&d=identicon&r=PG", "display_name": "zsf222", "link": "https://stackoverflow.com/users/2378484/zsf222"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 204, "favorite_count": 1, "answer_count": 0, "score": 4, "last_activity_date": 1560277425, "creation_date": 1560277244, "last_edit_date": 1560277425, "question_id": 56549645, "link": "https://stackoverflow.com/questions/56549645/how-do-i-generate-a-fully-linked-executable-llvm-bitcode-file-from-rust", "title": "How do I generate a fully linked, executable LLVM bitcode file from Rust?", "body": "<p>I would like to generate a fully linked LLVM bitcode file from Rust source code which could be executed by LLVM IR interpreters such as <code>lli</code>. I found solutions such as <a href=\"https://www.reddit.com/r/rust/comments/9rnmfs/any_way_to_get_rustc_to_emit_fully_linked_llvm_ir/\" rel=\"nofollow noreferrer\">one from Reddit</a> and <a href=\"https://stackoverflow.com/questions/39004513/how-to-emit-llvm-ir-from-cargo\">another one from Stack Overflow</a>, but they didn't provide enough guidance or could not make fully linked ones. </p>\n\n<p>I hope there could be some detailed guidance here.</p>\n"}, {"tags": ["rust", "rust-macros", "rust-decl-macros"], "answers": [{"tags": [], "owner": {"reputation": 3647, "user_id": 371191, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e1caa49eebfe37ffe3ef64e19364b0b3?s=128&d=identicon&r=PG", "display_name": "Silly Freak", "link": "https://stackoverflow.com/users/371191/silly-freak"}, "is_accepted": true, "score": 1, "last_activity_date": 1560429570, "last_edit_date": 1560429570, "creation_date": 1560429023, "answer_id": 56580544, "question_id": 56545552, "link": "https://stackoverflow.com/questions/56545552/is-there-a-way-to-do-macro-stuff-in-an-attribute-without-a-procedural-macro/56580544#56580544", "title": "Is there a way to &quot;do macro stuff&quot; in an attribute without a procedural macro?", "body": "<p>The answer seems to be no.</p>\n\n<p>Looking at the <a href=\"https://doc.rust-lang.org/grammar.html#attributes\" rel=\"nofollow noreferrer\">grammar for attributes</a>, apart from parentheses, commas and equals signs, attributes can ultimately only contain literals. So on this level, there is no way Rust allows more here.</p>\n\n<hr>\n\n<p>However, inverting the structure enables something like this, and the <a href=\"https://docs.rs/doc-comment/0.3.1/doc_comment/\" rel=\"nofollow noreferrer\"><code>doc-comment</code></a> crate does this for doc comments. Instead of calling a macro from inside an attribute, use a macro to create an attribute; that macro is then not constrained to only taking literals*. The downside is, the item that the attribute should apply to must be part of the macro call. So this</p>\n\n<pre><code>#[doc=my_content!()]\nstruct Foo;\n</code></pre>\n\n<p>becomes this:</p>\n\n<pre><code>doc_comment!(\n    my_content!(),\n    struct Foo;\n);\n</code></pre>\n\n<p>The definition of the macro is straight-forward:</p>\n\n<pre><code>#[macro_export]\nmacro_rules! doc_comment {\n    ($x:expr, $($tt:tt)*) =&gt; {\n        #[doc = $x]\n        $($tt)*\n    };\n}\n</code></pre>\n\n<p>(omitted a branch of <a href=\"https://github.com/GuillaumeGomez/doc-comment/blob/master/src/lib.rs#L147\" rel=\"nofollow noreferrer\">the original macro</a> that is not part of the core pattern)</p>\n\n<p>(thanks to jonas-schlevink for <a href=\"https://github.com/rust-lang/rust/issues/61795#issuecomment-501657700\" rel=\"nofollow noreferrer\">pointing</a> me to this)</p>\n\n<hr>\n\n<p>*except for that last part (getting macro content into the attribute), the <a href=\"https://stackoverflow.com/a/41945753/371191\">linked question's answer</a> already does exactly that.</p>\n"}], "owner": {"reputation": 3647, "user_id": 371191, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e1caa49eebfe37ffe3ef64e19364b0b3?s=128&d=identicon&r=PG", "display_name": "Silly Freak", "link": "https://stackoverflow.com/users/371191/silly-freak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "accepted_answer_id": 56580544, "answer_count": 1, "score": 1, "last_activity_date": 1560429570, "creation_date": 1560261785, "last_edit_date": 1560262064, "question_id": 56545552, "link": "https://stackoverflow.com/questions/56545552/is-there-a-way-to-do-macro-stuff-in-an-attribute-without-a-procedural-macro", "title": "Is there a way to &quot;do macro stuff&quot; in an attribute without a procedural macro?", "body": "<p>Specifically, I'm trying to put macro output into a doc comment. I was excited that this does exactly what I want:</p>\n\n<pre><code>/// foo\n///\n#[doc=\"bar\\n\\nbaz\"]\n///\n/// quux\nstruct Dummy;\n</code></pre>\n\n<p>The next step would be to replace that string with my content. According to <a href=\"https://stackoverflow.com/questions/41945628/is-it-possible-to-emit-rust-attributes-from-within-macros\">this</a>, I can't write <code>#[doc=my_content!()]</code>, and attribute macros are procedural, so I need another crate for that, plus (I think) my content could be generated without the need for any procedural macro features.</p>\n\n<p>Is there a way to do this with \"conventional macros\" in some way, or am I out of luck?</p>\n"}, {"tags": ["rust", "future", "rust-tokio"], "answers": [{"comments": [{"owner": {"reputation": 1326, "user_id": 1836144, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e250d748ff6c2ff23bc4550e0f0971f5?s=128&d=identicon&r=PG", "display_name": "little-dude", "link": "https://stackoverflow.com/users/1836144/little-dude"}, "edited": false, "score": 0, "creation_date": 1560259470, "post_id": 56544629, "comment_id": 99671180, "body": "Thanks, I think <a href=\"https://stackoverflow.com/questions/54503625/why-does-calling-tokiospawn-result-in-the-panic-spawnerror-is-shutdown-tru\" title=\"why does calling tokiospawn result in the panic spawnerror is shutdown tru\">stackoverflow.com/questions/54503625/&hellip;</a> answered my question. I should have mentioned that I&#39;ve read the doc for <code>lazy</code> but haven&#39;t really understood it (what does &quot;having a callback scheduled on it&quot; mean? and what are we supposed to see from the &quot;example&quot; snippet?)."}, {"owner": {"reputation": 1326, "user_id": 1836144, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e250d748ff6c2ff23bc4550e0f0971f5?s=128&d=identicon&r=PG", "display_name": "little-dude", "link": "https://stackoverflow.com/users/1836144/little-dude"}, "edited": false, "score": 0, "creation_date": 1560266806, "post_id": 56544629, "comment_id": 99675839, "body": "Thanks for the updated answer, it&#39;s much clearer now!"}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 6, "last_activity_date": 1560266927, "last_edit_date": 1592644375, "creation_date": 1560258970, "answer_id": 56544629, "question_id": 56544469, "link": "https://stackoverflow.com/questions/56544469/what-is-futuresfuturelazy-for/56544629#56544629", "title": "What is futures::future::lazy for?", "body": "<p>The <em>purpose</em> of lazy is covered by the <a href=\"https://docs.rs/futures/0.1.27/futures/future/fn.lazy.html\" rel=\"nofollow noreferrer\">documentation for <code>lazy</code></a>:</p>\n<blockquote>\n<p>Creates a new future which will eventually be the same as the one created by the closure provided.</p>\n<p>The provided closure is only run once the future has a callback scheduled on it, otherwise the callback never runs. Once run, however, this future is the same as the one the closure creates.</p>\n</blockquote>\n<p>Like a plain closure, it's used to prevent code from being eagerly evaluated. In synchronous terms, it's the difference between calling a function and calling the closure that the function returned:</p>\n<pre><code>fn sync() -&gt; impl FnOnce() {\n    println!(&quot;This is run when the function is called&quot;);\n    \n    || println!(&quot;This is run when the return value is called&quot;)\n}\n\nfn main() {\n    let a = sync();\n    println!(&quot;Called the function&quot;);\n    a();\n}\n</code></pre>\n<p>And the parallel for futures 0.1:</p>\n<pre><code>use futures::{future, Future}; // 0.1.27\n\nfn not_sync() -&gt; impl Future&lt;Item = (), Error = ()&gt; {\n    println!(&quot;This is run when the function is called&quot;);\n\n    future::lazy(|| {\n        println!(&quot;This is run when the return value is called&quot;);\n        Ok(())\n    })\n}\n\nfn main() {\n    let a = not_sync();\n    println!(&quot;Called the function&quot;);\n    a.wait().unwrap();\n}\n</code></pre>\n<p>With <code>async</code>/<code>await</code> syntax, this function should not be needed anymore:</p>\n<pre><code>#![feature(async_await)] // 1.37.0-nightly (2019-06-05)\n\nuse futures::executor; // 0.3.0-alpha.16\nuse std::future::Future;\n\nfn not_sync() -&gt; impl Future&lt;Output = ()&gt; {\n    println!(&quot;This is run when the function is called&quot;);\n\n    async {\n        println!(&quot;This is run when the return value is called&quot;);\n    }\n}\n\nfn main() {\n    let a = not_sync();\n    println!(&quot;Called the function&quot;);\n    executor::block_on(a);\n}\n</code></pre>\n<p>As you've identified, Tokio's examples use <code>lazy</code> to:</p>\n<ul>\n<li>ensure that the code in the closure is only run from inside the executor.</li>\n<li>ensure that a closure is run as a future</li>\n</ul>\n<p>I view these two aspects of <code>lazy</code> as effectively the same.</p>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://stackoverflow.com/q/54503625/155423\">Why does calling tokio::spawn result in the panic &quot;SpawnError { is_shutdown: true }&quot;?</a></li>\n<li><a href=\"https://stackoverflow.com/q/52835725/155423\">What is the purpose of async/await in Rust?</a></li>\n</ul>\n"}], "owner": {"reputation": 1326, "user_id": 1836144, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e250d748ff6c2ff23bc4550e0f0971f5?s=128&d=identicon&r=PG", "display_name": "little-dude", "link": "https://stackoverflow.com/users/1836144/little-dude"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 987, "favorite_count": 0, "accepted_answer_id": 56544629, "answer_count": 1, "score": 1, "last_activity_date": 1560266927, "creation_date": 1560258417, "last_edit_date": 1560258758, "question_id": 56544469, "link": "https://stackoverflow.com/questions/56544469/what-is-futuresfuturelazy-for", "title": "What is futures::future::lazy for?", "body": "<p>In the <a href=\"https://tokio.rs/docs/futures/spawning/\" rel=\"nofollow noreferrer\">Tokio documentation</a> we have this snippet:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern crate tokio;\nextern crate futures;\n\nuse futures::future::lazy;\n\ntokio::run(lazy(|| {\n    for i in 0..4 {\n        tokio::spawn(lazy(move || {\n            println!(\"Hello from task {}\", i);\n            Ok(())\n        }));\n    }\n\n    Ok(())\n}));\n</code></pre>\n\n<p>The explanation for this is:</p>\n\n<blockquote>\n  <p>The <code>lazy</code> function runs the closure the first time the future is polled. It is used here to ensure that <code>tokio::spawn</code> is called from a task. Without <code>lazy</code>, <code>tokio::spawn</code> would be called from outside the context of a task, which results in an error.</p>\n</blockquote>\n\n<p>I'm not sure I understand this precisely, despite having some familiarity with Tokio. It seems that these two <code>lazy</code> have slightly different roles, and that this explanation only applies to the <em>first</em> one. Isn't the second call to <code>lazy</code> (inside the <code>for</code> loop) just here to convert the closure into a future?</p>\n"}, {"tags": ["inheritance", "rust", "traits"], "comments": [{"owner": {"reputation": 993, "user_id": 10103607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4490e1a73036fbc05ff6f08289679442?s=128&d=identicon&r=PG", "display_name": "akg179", "link": "https://stackoverflow.com/users/10103607/akg179"}, "edited": false, "score": 0, "creation_date": 1560258467, "post_id": 56544395, "comment_id": 99670467, "body": "the method name you have used in <code>FunctionA</code> is <code>print_username</code> whereas u are trying to invoke <code>print_user_name</code> in <code>main()</code>."}, {"owner": {"reputation": 9010, "user_id": 2588800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/847da843d41921363502159c8b7e5549?s=128&d=identicon&r=PG", "display_name": "Svetlin Zarev", "link": "https://stackoverflow.com/users/2588800/svetlin-zarev"}, "edited": false, "score": 0, "creation_date": 1560258534, "post_id": 56544395, "comment_id": 99670506, "body": "You should do <code>trait FunctionB: FunctionA</code> instead of <code>impl FunctionA for FunctionB</code>"}], "owner": {"reputation": 1, "user_id": 11416949, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-W5WroCk4zoQ/AAAAAAAAAAI/AAAAAAAAAAc/6izSeNUN6Fo/photo.jpg?sz=128", "display_name": "hallblazzar", "link": "https://stackoverflow.com/users/11416949/hallblazzar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 21, "favorite_count": 0, "closed_date": 1560261546, "answer_count": 0, "score": 0, "last_activity_date": 1560261526, "creation_date": 1560258185, "last_edit_date": 1560261526, "question_id": 56544395, "link": "https://stackoverflow.com/questions/56544395/extending-trait-and-cannot-invoke-methods-associate-functions-from-super-trait", "closed_reason": "Duplicate", "title": "Extending trait and cannot invoke methods/associate functions from super-trait", "body": "<p>While learning how to extend a trait, I encountered a problem. I tried to implement a super-trait for a sub-trait and the sub-trait for a structure. I expected the structure could invoke methods/associated functions from both the super-trait and the sub-trait, just like OOP inheritance:</p>\n\n<pre><code>trait FunctionA {\n    fn print_username(&amp;self) {\n        println!(\"username\");\n    }\n}\n\ntrait FunctionB {\n    fn print_number(&amp;self) {\n        println!(\"number\");\n    }\n}\n\nimpl FunctionA for FunctionB {}\n\nstruct Demo {}\n\nimpl FunctionB for Demo {}\n\nfn main() {\n    let demo = Demo {};\n    demo.print_user_name();\n    demo.print_number();\n}\n</code></pre>\n\n<p>The compiler showed an error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0599]: no method named `print_user_name` found for type `Demo` in the current scope\n  --&gt; src/main.rs:21:10\n   |\n15 | struct Demo {}\n   | ----------- method `print_user_name` not found for this\n...\n21 |     demo.print_user_name();\n   |          ^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>Do I misunderstand anything about extending traits? Is what I tried to do not allowed? If it is allowed, how can I implement it correctly?</p>\n"}, {"tags": ["generics", "rust", "traits"], "answers": [{"tags": [], "owner": {"reputation": 600, "user_id": 3754495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65fff37f6d10b64ca1676adcc33f5ffb?s=128&d=identicon&r=PG", "display_name": "notriddle", "link": "https://stackoverflow.com/users/3754495/notriddle"}, "is_accepted": false, "score": 1, "last_activity_date": 1560360746, "last_edit_date": 1560360746, "creation_date": 1560300884, "answer_id": 56553344, "question_id": 56537015, "link": "https://stackoverflow.com/questions/56537015/is-there-a-way-to-generically-implement-a-trait-for-objects-in-smart-pointers/56553344#56553344", "title": "Is there a way to generically implement a trait for objects in smart pointers?", "body": "<pre class=\"lang-none prettyprint-override\"><code>      /-- everything here\nimpl&lt;Types...&gt;     Trait              for         Self\n                     \\-- has to appear here         \\-- or here\n</code></pre>\n\n<p>As the <a href=\"https://doc.rust-lang.org/error-index.html#E0207\" rel=\"nofollow noreferrer\">error message</a> puts it, <code>Types...</code> have to be constrained by <code>Trait</code>, <code>Self</code>, or predicates of <code>Trait</code> or <code>Self</code>.</p>\n\n<p>If you're okay with copy-pasting for every LHS container, you could move the <code>Borrow</code> handling down to the function itself, like this:</p>\n\n<pre><code>use std::borrow::Borrow;\n\ntrait KindaEqual&lt;Rhs = Self&gt; {\n    fn kinda_equal&lt;R: Borrow&lt;Rhs&gt;&gt;(&amp;self, other: &amp;R) -&gt; bool;\n}\n\nimpl KindaEqual&lt;u32&gt; for u32 {\n    fn kinda_equal&lt;R: Borrow&lt;u32&gt;&gt;(&amp;self, other: &amp;R) -&gt; bool {\n        self == other.borrow()\n    }\n}\n\n// repeat for all supported containers\nimpl&lt;T&gt; KindaEqual&lt;T&gt; for Box&lt;T&gt;\nwhere\n    T: KindaEqual&lt;T&gt;,\n{\n    fn kinda_equal&lt;R: Borrow&lt;T&gt;&gt;(&amp;self, other: &amp;R) -&gt; bool {\n        (&amp;**self).kinda_equal(other.borrow())\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 444, "user_id": 3422156, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/29af89a0e8be5cf63546304d02c8e2fb?s=128&d=identicon&r=PG&f=1", "display_name": "spease", "link": "https://stackoverflow.com/users/3422156/spease"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1560360746, "creation_date": 1560230767, "last_edit_date": 1560257386, "question_id": 56537015, "link": "https://stackoverflow.com/questions/56537015/is-there-a-way-to-generically-implement-a-trait-for-objects-in-smart-pointers", "title": "Is there a way to generically implement a trait for objects in smart pointers?", "body": "<p>Is there a way to generically provide an implementation for a trait for objects in smart pointers (e.g. <code>Box</code>, <code>Rc</code>, etc)?</p>\n\n<p>Example:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::borrow::Borrow;\nuse std::rc::Rc;\n\ntrait KindaEqual&lt;Rhs = Self&gt; {\n    fn kinda_equal(&amp;self, other: &amp;Rhs) -&gt; bool;\n}\n\n// Nice to have (still need to copy-paste for each LHS container)\nimpl&lt;T, Rhs, WrappedRhs&gt; KindaEqual&lt;WrappedRhs&gt; for T\nwhere\n    WrappedRhs: Borrow&lt;Rhs&gt;,\n    T: KindaEqual&lt;Rhs&gt;,\n{\n    fn kinda_equal(&amp;self, other: &amp;WrappedRhs) -&gt; bool {\n        self.kinda_equal(other.borrow())\n    }\n}\n\n// Best to have (handles both LHS and RHS containers)\nimpl&lt;WrappedT, T, Rhs, WrappedRhs&gt; KindaEqual&lt;WrappedRhs&gt; for WrappedT\nwhere\n    WrappedRhs: Borrow&lt;Rhs&gt;,\n    WrappedT: Borrow&lt;T&gt;,\n    T: KindaEqual&lt;Rhs&gt;,\n{\n    fn kinda_equal(&amp;self, other: &amp;WrappedRhs) -&gt; bool {\n        self.borrow().kinda_equal(other.borrow())\n    }\n}\n\nimpl KindaEqual for f64 {\n    fn kinda_equal(&amp;self, other: &amp;Self) -&gt; bool {\n        num::abs(self - other) &lt; 0.01f64\n    }\n}\n\nimpl KindaEqual&lt;u64&gt; for f64 {\n    fn kinda_equal(&amp;self, other: &amp;u64) -&gt; bool {\n        num::abs(self - *other as f64) &lt; 1f64\n    }\n}\n\nfn main() {\n    assert!(3.141592654.kinda_equal(&amp;3.14));\n    assert!(3.141592654.kinda_equal(&amp;3));\n    assert!(3.141592654.kinda_equal(&amp;Rc::new(3.14)));\n}\n</code></pre>\n\n<p>The above gives me the errors:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0207]: the type parameter `Rhs` is not constrained by the impl trait, self type, or predicates\n --&gt; src/main.rs:9:9\n  |\n9 | impl&lt;T, Rhs, WrappedRhs&gt; KindaEqual&lt;WrappedRhs&gt; for T\n  |         ^^^ unconstrained type parameter\n\nerror[E0207]: the type parameter `T` is not constrained by the impl trait, self type, or predicates\n  --&gt; src/main.rs:20:16\n   |\n20 | impl&lt;WrappedT, T, Rhs, WrappedRhs&gt; KindaEqual&lt;WrappedRhs&gt; for WrappedT\n   |                ^ unconstrained type parameter\n\nerror[E0207]: the type parameter `Rhs` is not constrained by the impl trait, self type, or predicates\n  --&gt; src/main.rs:20:19\n   |\n20 | impl&lt;WrappedT, T, Rhs, WrappedRhs&gt; KindaEqual&lt;WrappedRhs&gt; for WrappedT\n   |                   ^^^ unconstrained type parameter\n</code></pre>\n\n<p>I've read that adding an associated type might fix it, but this is undesirable as it would force usages of the trait to implement it as well.</p>\n\n<ol>\n<li>Can this be solved without an associated type? (preferable)</li>\n<li>Can this be solved with an associated type?</li>\n</ol>\n"}, {"tags": ["arrays", "rust", "traits"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560254563, "post_id": 56536618, "comment_id": 99668128, "body": "By the way, idiomatic Rust uses <code>snake_case</code> for variables, methods, macros, fields and modules; <code>UpperCamelCase</code> for types and enum variants; and <code>SCREAMING_SNAKE_CASE</code> for statics and constants."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560255839, "post_id": 56536618, "comment_id": 99668849, "body": "Your code appears to indicate that inherent methods &quot;magically&quot; flow into traits. This is not the case."}], "answers": [{"comments": [{"owner": {"reputation": 393, "user_id": 4607066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b780e369b4fea45427deffd7f622e457?s=128&d=identicon&r=PG", "display_name": "ChosunOne", "link": "https://stackoverflow.com/users/4607066/chosunone"}, "edited": false, "score": 0, "creation_date": 1560275116, "post_id": 56543462, "comment_id": 99680114, "body": "Thank you for the very concise and timely answer.  I didn&#39;t know you could specify an <code>impl</code> bound like that."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 393, "user_id": 4607066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b780e369b4fea45427deffd7f622e457?s=128&d=identicon&r=PG", "display_name": "ChosunOne", "link": "https://stackoverflow.com/users/4607066/chosunone"}, "edited": false, "score": 2, "creation_date": 1560275232, "post_id": 56543462, "comment_id": 99680167, "body": "@ChosunOne that syntax is available <a href=\"https://github.com/rust-lang/rust/blob/master/RELEASES.md#version-1260-2018-05-10\" rel=\"nofollow noreferrer\">starting in Rust 1.26</a>"}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 8, "last_activity_date": 1604720160, "last_edit_date": 1604720160, "creation_date": 1560255172, "answer_id": 56543462, "question_id": 56536618, "link": "https://stackoverflow.com/questions/56536618/how-do-i-make-a-trait-bound-that-requires-a-fixed-size-array/56543462#56543462", "title": "How do I make a trait bound that requires a fixed size array?", "body": "<h3>Const generics (Nightly)</h3>\n<p>In the future, you can use const generics to express this directly:</p>\n<pre><code>#![feature(min_const_generics)]\n\nfn process_array&lt;T, const N: usize&gt;(array: [T; N])\nwhere\n    T: Sized + Eq + Copy + Clone,\n{\n    let a = array[0];\n    for i in array.iter() {\n        let size = array.len();\n        /* do something with the array */\n    }\n}\n\nfn main() {\n    let array = [0u8; 32];\n\n    process_array(array);\n}\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://stackoverflow.com/q/28136739/155423\">Is it possible to control the size of an array using the type parameter of a generic?</a></li>\n</ul>\n<h3>AsRef (stable)</h3>\n<p>I'd probably just use <code>AsRef&lt;[T]&gt;</code> in stable Rust; For all the functions you call (<code>iter</code>, <code>len</code>, <code>index</code>) you are already delegating to a slice anyway:</p>\n<pre><code>fn process_array&lt;T&gt;(array: impl AsRef&lt;[T]&gt;)\nwhere\n    T: Sized + Eq + Copy + Clone,\n{\n    let array = array.as_ref();\n    let _a = array[0];\n    for _i in array.iter() {\n        let _size = array.len();\n        /* do something with the array */\n    }\n}\n\nfn main() {\n    let array = [0u8; 32];\n\n    process_array(array);\n}\n</code></pre>\n"}], "owner": {"reputation": 393, "user_id": 4607066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b780e369b4fea45427deffd7f622e457?s=128&d=identicon&r=PG", "display_name": "ChosunOne", "link": "https://stackoverflow.com/users/4607066/chosunone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 764, "favorite_count": 1, "accepted_answer_id": 56543462, "answer_count": 1, "score": 3, "last_activity_date": 1604720160, "creation_date": 1560228341, "last_edit_date": 1560254546, "question_id": 56536618, "link": "https://stackoverflow.com/questions/56536618/how-do-i-make-a-trait-bound-that-requires-a-fixed-size-array", "title": "How do I make a trait bound that requires a fixed size array?", "body": "<p>I'm trying to create a trait that is only a composition of other traits with the end goal of creating a trait that proves the type is a sized array.  </p>\n\n<p>Additionally, I would like to be able to do this in stable Rust with no extra libraries.  </p>\n\n<p>I've tried adding a bunch of trait bounds to mimic the limitations of a fixed size array, like the following:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>trait SizedArray&lt;T&gt;\nwhere\n    T: Sized + Eq + Copy + Clone,\n{\n}\n\nimpl&lt;T&gt; SizedArray&lt;T&gt; for [T; 32] where T: Sized + Eq + Copy + Clone {}\n\nfn processArray&lt;T, U&gt;(array: T)\nwhere\n    T: SizedArray&lt;U&gt;,\n    U: Sized + Eq + Copy + Clone,\n{\n    let a = array[0];\n    for i in array.iter() {\n        let size = array.len();\n        /* do something with the array */\n    }\n}\n\nfn main() {\n    let array = [0u8; 32];\n\n    processArray(array);\n}\n</code></pre>\n\n<p>But when I do so and try to use a fixed sized array, such as <code>[u8; 32]</code>:</p>\n\n<p>I get:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Compiling playground v0.0.1 (/playground)\nerror[E0608]: cannot index into a value of type `T`\n  --&gt; src/main.rs:12:13\n   |\n12 |     let a = array[0];\n   |             ^^^^^^^^\n\nerror[E0599]: no method named `iter` found for type `T` in the current scope\n  --&gt; src/main.rs:13:20\n   |\n13 |     for i in array.iter() {\n   |                    ^^^^\n\nerror[E0599]: no method named `len` found for type `T` in the current scope\n  --&gt; src/main.rs:14:26\n   |\n14 |         let size = array.len();\n   |                          ^^^\n   |\n   = help: items from traits can only be used if the trait is implemented and in scope\n   = note: the following trait defines an item `len`, perhaps you need to implement it:\n           candidate #1: `std::iter::ExactSizeIterator`\n</code></pre>\n\n<p>The type <code>[u8; 32]</code> clearly has all of those methods, but I don't know how to tell Rust to look for them.</p>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=0ea9fdfeeb678a6287c71ce918fba7b6\" rel=\"nofollow noreferrer\">Playground</a>  </p>\n"}, {"tags": ["arrays", "rust"], "comments": [{"owner": {"reputation": 3849, "user_id": 5198595, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2e45c7ec5cb67cf3cdf2186d8037e29?s=128&d=identicon&r=PG&f=1", "display_name": "Sunreef", "link": "https://stackoverflow.com/users/5198595/sunreef"}, "edited": false, "score": 3, "creation_date": 1560237356, "post_id": 56536546, "comment_id": 99658777, "body": "This seems like a situation where <code>Vec</code> would help. Is there a reason why you can&#39;t return a <code>Vec&lt;Vec&lt;T&gt;&gt;</code> ?"}, {"owner": {"reputation": 65310, "user_id": 201725, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/616f7a1cbb20fe949d883393657c039a?s=128&d=identicon&r=PG", "display_name": "Jan Hudec", "link": "https://stackoverflow.com/users/201725/jan-hudec"}, "reply_to_user": {"reputation": 3849, "user_id": 5198595, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2e45c7ec5cb67cf3cdf2186d8037e29?s=128&d=identicon&r=PG&f=1", "display_name": "Sunreef", "link": "https://stackoverflow.com/users/5198595/sunreef"}, "edited": false, "score": 0, "creation_date": 1560245212, "post_id": 56536546, "comment_id": 99662762, "body": "@Sunreef, what makes vector so much better that it&#39;s worth for a 4x4 matrix?"}, {"owner": {"reputation": 3849, "user_id": 5198595, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2e45c7ec5cb67cf3cdf2186d8037e29?s=128&d=identicon&r=PG&f=1", "display_name": "Sunreef", "link": "https://stackoverflow.com/users/5198595/sunreef"}, "reply_to_user": {"reputation": 65310, "user_id": 201725, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/616f7a1cbb20fe949d883393657c039a?s=128&d=identicon&r=PG", "display_name": "Jan Hudec", "link": "https://stackoverflow.com/users/201725/jan-hudec"}, "edited": false, "score": 2, "creation_date": 1560245325, "post_id": 56536546, "comment_id": 99662824, "body": "@JanHudec If it&#39;s always a 4x4 matrix, then you can use <code>[[T;4];4]</code>. But he said he wants unknown sizes. That&#39;s what <code>Vec</code> does."}, {"owner": {"reputation": 65310, "user_id": 201725, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/616f7a1cbb20fe949d883393657c039a?s=128&d=identicon&r=PG", "display_name": "Jan Hudec", "link": "https://stackoverflow.com/users/201725/jan-hudec"}, "reply_to_user": {"reputation": 3849, "user_id": 5198595, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2e45c7ec5cb67cf3cdf2186d8037e29?s=128&d=identicon&r=PG&f=1", "display_name": "Sunreef", "link": "https://stackoverflow.com/users/5198595/sunreef"}, "edited": false, "score": 0, "creation_date": 1560245987, "post_id": 56536546, "comment_id": 99663205, "body": "@Sunreef, you can do unknown sizes with plain references just fine. The thing that <code>Vec</code> adds is ownership. If it&#39;s not needed, it shouldn&#39;t be there."}, {"owner": {"reputation": 3389, "user_id": 3121975, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/27507c7b9958f8863c6640543baec276?s=128&d=identicon&r=PG&f=1", "display_name": "Woody1193", "link": "https://stackoverflow.com/users/3121975/woody1193"}, "reply_to_user": {"reputation": 3849, "user_id": 5198595, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2e45c7ec5cb67cf3cdf2186d8037e29?s=128&d=identicon&r=PG&f=1", "display_name": "Sunreef", "link": "https://stackoverflow.com/users/5198595/sunreef"}, "edited": false, "score": 0, "creation_date": 1560300343, "post_id": 56536546, "comment_id": 99687948, "body": "@Sunreef The actual size of the matrix doesn&#39;t change when the trait is implemented, I just don&#39;t know what the size is with respect to the trait definition. I could have a second struct called <code>StructB</code> that implements a <code>[[T;8];8]</code> for example. I do not want the matrix size to change when implemented but I can&#39;t determine what the size is in the trait definition"}], "answers": [{"comments": [{"owner": {"reputation": 3389, "user_id": 3121975, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/27507c7b9958f8863c6640543baec276?s=128&d=identicon&r=PG&f=1", "display_name": "Woody1193", "link": "https://stackoverflow.com/users/3121975/woody1193"}, "edited": false, "score": 0, "creation_date": 1560300625, "post_id": 56538559, "comment_id": 99687992, "body": "I tried this as well and this might be the route I end up going in"}], "tags": [], "owner": {"reputation": 11, "user_id": 11629618, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/2f0662277ab82ad6bbbce49e42ca4c3d?s=128&d=identicon&r=PG", "display_name": "anonymous123", "link": "https://stackoverflow.com/users/11629618/anonymous123"}, "is_accepted": false, "score": 1, "last_activity_date": 1560237960, "creation_date": 1560237960, "answer_id": 56538559, "question_id": 56536546, "link": "https://stackoverflow.com/questions/56536546/returning-an-multidimensional-array-of-unknown-size-from-a-function-in-rust/56538559#56538559", "title": "Returning an multidimensional array of unknown size from a function in Rust", "body": "<p>If it's ok to declare <code>matrix_desc</code> as slice this should work:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct MyStruct;\n\nimpl MyStruct {\n    const matrix_desc: &amp;'static [&amp;'static [u32]] = &amp;[\n        &amp;[1, 0, 0, 0],\n        &amp;[0, 1, 0, 0],\n        &amp;[0, 0, 1, 0],\n        &amp;[0, 0, 0, 1]\n    ];\n}\n\ntrait MyTrait&lt;T&gt; {\n    fn my_func() -&gt; &amp;'static [&amp;'static [T]];\n}\n\nimpl MyTrait&lt;u32&gt; for MyStruct {\n    fn my_func() -&gt; &amp;'static [&amp;'static [u32]] {\n        &amp;Self::matrix_desc\n    }\n}\n</code></pre>\n\n<p>It seems that fixed &amp; generic sized arrays are not very well supported at the moment. For example, this doesn't work:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>trait MyTrait&lt;T&gt; {\n    const SIZE: usize;\n    fn my_func() -&gt; [[T; SIZE]; SIZE];\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3849, "user_id": 5198595, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2e45c7ec5cb67cf3cdf2186d8037e29?s=128&d=identicon&r=PG&f=1", "display_name": "Sunreef", "link": "https://stackoverflow.com/users/5198595/sunreef"}, "edited": false, "score": 2, "creation_date": 1560256908, "post_id": 56540752, "comment_id": 99669516, "body": "For small matrices like 4x4, 3x3 and small vectors, <code>nalgebra</code> is a very nice crate."}], "tags": [], "owner": {"reputation": 65310, "user_id": 201725, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/616f7a1cbb20fe949d883393657c039a?s=128&d=identicon&r=PG", "display_name": "Jan Hudec", "link": "https://stackoverflow.com/users/201725/jan-hudec"}, "is_accepted": true, "score": 2, "last_activity_date": 1560245901, "creation_date": 1560245901, "answer_id": 56540752, "question_id": 56536546, "link": "https://stackoverflow.com/questions/56536546/returning-an-multidimensional-array-of-unknown-size-from-a-function-in-rust/56540752#56540752", "title": "Returning an multidimensional array of unknown size from a function in Rust", "body": "<p>A known-length array is a value that is included directly in the containing object. So a <code>[[u32; 4]; 4]</code> is a block of memory with 16 <code>u32</code>s. You can convert it to a <code>&amp;[[u32;4]]</code>, which is a pointer and number of rows, but <code>&amp;[&amp;[u32]]</code> wants to point to an array of pointer-size pairs and that does not exist in the original value.</p>\n\n<p>Like in C, nested arrays are not particularly nice to work with. I would probably go the route of flattening it to <code>[u32; 4 * 4]</code> and <code>&amp;[u32]</code> and possibly wrap it with something defining <code>std::ops::Index&lt;(usize, usize)&gt;</code>. That immediately forces the matrix to be rectangular (a <code>&amp;[&amp;[u32]]</code> can have each row of different length) and you could further check that it is actually square in the index method (and any other methods you define for the algebra).</p>\n\n<p>Or just try to find an already written matrix library on crates.io\u2014I'm quite sure there will be some.</p>\n"}], "owner": {"reputation": 3389, "user_id": 3121975, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/27507c7b9958f8863c6640543baec276?s=128&d=identicon&r=PG&f=1", "display_name": "Woody1193", "link": "https://stackoverflow.com/users/3121975/woody1193"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1588, "favorite_count": 0, "accepted_answer_id": 56540752, "answer_count": 2, "score": 0, "last_activity_date": 1560245901, "creation_date": 1560227673, "question_id": 56536546, "link": "https://stackoverflow.com/questions/56536546/returning-an-multidimensional-array-of-unknown-size-from-a-function-in-rust", "title": "Returning an multidimensional array of unknown size from a function in Rust", "body": "<p>I have a trait, <code>MyTrait</code>, that defines a method called <code>my_func</code> that returns an array of unknown size. The reason for this is that the size of the array returned from this method will depend on the struct that implements the trait. So, the method definition looks like this:</p>\n\n<pre><code>MyTrait&lt;T: Clone + Float&gt; {\n    fn my_func() -&gt; &amp;[&amp;[T]];\n}\n</code></pre>\n\n<p>Now, I'm trying to implement this trait with the following method:</p>\n\n<pre><code>impl MyStruct {\n    const matrix_desc: [[u32; 4]; 4] = [\n        [1, 0, 0, 0],\n        [0, 1, 0, 0],\n        [0, 0, 1, 0],\n        [0, 0, 0, 1]\n    ];\n}\n\nimpl MyTrait&lt;u32&gt; for MyStruct {\n    fn my_func() -&gt; &amp;[&amp;[u32]] {\n        &amp;matrix_desc\n    }\n}\n</code></pre>\n\n<p>However, I keep getting errors saying there's a type-mismatch and that Rust expected a <code>&amp;[&amp;[u32]]</code> but got a <code>&amp;[[u32; 4]; 4]</code>. This is very clear to me but I'm not sure how to fix it. I've also tried using the <code>Sized</code> trait but I can't seem to get that to work. Does anyone know how I can return arrays of an unknown size at compile time?</p>\n\n<p>Also, for bonus points, does anyone know how I can force this 2d-array to be square?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 0, "creation_date": 1560233556, "post_id": 56535883, "comment_id": 99657025, "body": "Do you want restriction for accepting all primitives or a specific one ?"}, {"owner": {"reputation": 845, "user_id": 4077574, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/orn50.png?s=128&g=1", "display_name": "Galaxy", "link": "https://stackoverflow.com/users/4077574/galaxy"}, "reply_to_user": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 0, "creation_date": 1560236905, "post_id": 56535883, "comment_id": 99658564, "body": "@&#214;merErden It would be good if it can be done like that for traits. Or Is there any trait only bounds to primitive numbers we can use?"}, {"owner": {"reputation": 845, "user_id": 4077574, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/orn50.png?s=128&g=1", "display_name": "Galaxy", "link": "https://stackoverflow.com/users/4077574/galaxy"}, "reply_to_user": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 0, "creation_date": 1560253139, "post_id": 56535883, "comment_id": 99667287, "body": "BTW. I found <a href=\"https://github.com/rust-num/num-traits\" rel=\"nofollow noreferrer\">num_traits</a> is very useful."}, {"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 0, "creation_date": 1560254434, "post_id": 56535883, "comment_id": 99668029, "body": "Yes it is, your question is a bit broad so i wrote the superficial solutions."}], "answers": [{"tags": [], "owner": {"reputation": 9958, "user_id": 2188562, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/DMWEc.png?s=128&g=1", "display_name": "Peter Varo", "link": "https://stackoverflow.com/users/2188562/peter-varo"}, "is_accepted": true, "score": 1, "last_activity_date": 1560240369, "last_edit_date": 1560240369, "creation_date": 1560239892, "answer_id": 56539019, "question_id": 56535883, "link": "https://stackoverflow.com/questions/56535883/restrict-a-generic-type-to-primative-number-types/56539019#56539019", "title": "Restrict a generic Type to primative number types", "body": "<p>If you think about traits as <em>compile time duck typing</em>, then a better question would be: what are the exact traits you are looking for in a <em>number</em>?  Most of the operations on them could be defined as trait constraints on your types, see: <a href=\"https://doc.rust-lang.org/std/ops/index.html\" rel=\"nofollow noreferrer\">the standard operator traits</a>.</p>\n\n<p>Even if you would define a trait in an external crate and implement the behaviour for specific types only in that external crate, thinking that the trait implementation rules will help you there (i.e. a trait can only be implemented to a type if either the trait or the type or both are in your current crate) would still not limit anyone to implement your trait for their own types.</p>\n\n<p>Therefore, I see no other option but to implement the behaviours without generics for each primitive number type.  To avoid code duplication, I would probably use macros for this -- after all, if you think about it in some ways you would manually do what the compiler does while it monomorphises your generic code.</p>\n\n<p>That being said I see no reason to limit behaviours to numbers but to certain traits and I would rely on them as I described it in the first paragraph.</p>\n"}, {"tags": [], "owner": {"reputation": 65310, "user_id": 201725, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/616f7a1cbb20fe949d883393657c039a?s=128&d=identicon&r=PG", "display_name": "Jan Hudec", "link": "https://stackoverflow.com/users/201725/jan-hudec"}, "is_accepted": false, "score": 2, "last_activity_date": 1560239951, "creation_date": 1560239951, "answer_id": 56539030, "question_id": 56535883, "link": "https://stackoverflow.com/questions/56535883/restrict-a-generic-type-to-primative-number-types/56539030#56539030", "title": "Restrict a generic Type to primative number types", "body": "<p>No.</p>\n\n<p>To use a parametric type, you need the trait to define the valid operations you want to call on it. So you need a trait (or more) with all the operations you want to call.</p>\n\n<p>The \u201cprimitive\u201d types in Rust are not special in any way. They define their operators via the traits from <code>std::ops</code> (though obviously using compiler intrinsics) just like any \u201cnon-primitive\u201d numberic types.</p>\n\n<p>In fact, the boundary between \u201cprimitive\u201d and \u201cnon-primitive\u201d numeric types is even somewhat blurred, since for targets that lack an FPU, the standard library may be implementing floating point types in code, and in Rust it can do it transparently to the user.</p>\n\n<p>So really, there is no such thing as primitive number types. Number types are defined by providing whatever operators you need to call. So just restrict your type by the <code>std::ops</code> traits.</p>\n"}, {"tags": [], "owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "is_accepted": false, "score": 1, "last_activity_date": 1560241792, "last_edit_date": 1560241792, "creation_date": 1560240469, "answer_id": 56539171, "question_id": 56535883, "link": "https://stackoverflow.com/questions/56535883/restrict-a-generic-type-to-primative-number-types/56539171#56539171", "title": "Restrict a generic Type to primative number types", "body": "<p>Since primitives are not <strong>trait</strong> types you cannot use as boundary to restrict a generic type. But you can directly implement for a specific type:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct Struct&lt;T&gt;(T);\n\ntrait Printer {\n    fn print(&amp;self);\n}\n\nimpl Printer for Struct&lt;i32&gt; {\n    fn print(&amp;self) {\n        println!(\"Printing for i32 value: {}\", self.0);\n    }\n}\n\nfn main() {\n    let x = Struct(15_i32);\n    let _z = Struct(14.2_f64);\n\n    x.print();\n    //_z.print();//compile error\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=56b1d07252434d6afbbfd7045c023220\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<p>Alternatively you can use <code>Borrow&lt;S&gt;</code> trait as trick, you can restrict your generic parameter as like below : ( <code>T: Borrow&lt;S&gt;</code> means <code>T</code> can be borrowed as <code>S</code> ) . </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>impl&lt;T&gt; Printer for Struct&lt;T&gt;\nwhere\n    T: Borrow&lt;f64&gt; + Debug,\n{\n    fn print(&amp;self) {\n        println!(\"Printing for f64 value: {:?}\", self.0);\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=1cb8feb74a178e0909c3ac5664abecb0\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<p>But since you can implement <code>Borrow&lt;f64&gt;</code> for any type, this kind of restriction may not be considered as strict. </p>\n\n<p>Also just for the numeric primitives you can use traits from <a href=\"https://docs.rs/num-traits/0.2.8/num_traits/\" rel=\"nofollow noreferrer\">num-traits</a> crate like <code>ToPrimitive</code> <code>AsPrimitive</code></p>\n"}], "owner": {"reputation": 845, "user_id": 4077574, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/orn50.png?s=128&g=1", "display_name": "Galaxy", "link": "https://stackoverflow.com/users/4077574/galaxy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1239, "favorite_count": 0, "closed_date": 1560256005, "accepted_answer_id": 56539019, "answer_count": 3, "score": 2, "last_activity_date": 1560241792, "creation_date": 1560221905, "question_id": 56535883, "link": "https://stackoverflow.com/questions/56535883/restrict-a-generic-type-to-primative-number-types", "closed_reason": "Duplicate", "title": "Restrict a generic Type to primative number types", "body": "<p>We can restrict a type to one or more traits by <a href=\"https://doc.rust-lang.org/rust-by-example/generics/where.html\" rel=\"nofollow noreferrer\">where clause</a>.</p>\n\n<p>My questions are:</p>\n\n<ul>\n<li><p>Is it possible to restrict a type to just primitive number types?</p></li>\n<li><p>How?</p></li>\n</ul>\n"}, {"tags": ["multithreading", "error-handling", "rust"], "comments": [{"owner": {"reputation": 65310, "user_id": 201725, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/616f7a1cbb20fe949d883393657c039a?s=128&d=identicon&r=PG", "display_name": "Jan Hudec", "link": "https://stackoverflow.com/users/201725/jan-hudec"}, "edited": false, "score": 0, "creation_date": 1560238815, "post_id": 56535634, "comment_id": 99659437, "body": "When asking for why some code does not compile, you should include code that can be actually given to the compiler to show the error. Preferably with a link to a copy in <a href=\"https://play.rust-lang.org/\" rel=\"nofollow noreferrer\">play.rust-lang.org</a>. In this case the detail that hides the devil is in those <code>...</code> after <code>run_server(args)?</code>. That is, you didn&#39;t post enough details to answer why the closure returns <code>()</code>."}], "answers": [{"tags": [], "owner": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "is_accepted": true, "score": 5, "last_activity_date": 1560242366, "last_edit_date": 1560242366, "creation_date": 1560241868, "answer_id": 56539546, "question_id": 56535634, "link": "https://stackoverflow.com/questions/56535634/propagating-errors-from-within-a-closure-in-a-thread-in-rust/56539546#56539546", "title": "Propagating errors from within a closure in a thread in Rust", "body": "<blockquote>\n  <p>I want to propagate an error from a function called inside a closure inside a call to thread::spawn</p>\n</blockquote>\n\n<p>Since threads are running in parallel, throwing the error up from the thread scope is not making sense. Better approach will be error handling in the thread itself. </p>\n\n<p><em>So generally you should not propagate the error to the upper level above the thread.</em></p>\n\n<p>However you can throw your <code>error</code> that you get in your parallel <code>threads</code> after you <code>joined</code> them to your <code>main thread</code>. This way it will be pretty much like error propagation in synchronous.</p>\n\n<p>Here is how you can manage it:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn start_server() -&gt; Result&lt;(), Box&lt;std::error::Error&gt;&gt; {\n    let x = std::thread::spawn(move || -&gt; Result&lt;(), std::io::Error&gt; {\n        run_server()?;\n        Ok(())\n    });\n\n    x.join().unwrap()?; // Now you can throw your error up because you joined your thread.\n                        // ...\n    Ok(())\n}\n\nfn run_server() -&gt; Result&lt;(), std::io::Error&gt; {\n    Err(std::io::Error::new(std::io::ErrorKind::Other, \"hello\"))\n}\n\nfn main() {\n    let x = start_server();\n    println!(\"{:?}\", x);\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=1331c9cd9b30e9d5e705468cef9ebea5\" rel=\"noreferrer\">Playground</a></p>\n"}], "owner": {"reputation": 707, "user_id": 7868376, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/4d92cc168903249d34560da543ef621f?s=128&d=identicon&r=PG&f=1", "display_name": "picotard", "link": "https://stackoverflow.com/users/7868376/picotard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1797, "favorite_count": 0, "closed_date": 1560256683, "accepted_answer_id": 56539546, "answer_count": 1, "score": 7, "last_activity_date": 1560256660, "creation_date": 1560219702, "last_edit_date": 1560256660, "question_id": 56535634, "link": "https://stackoverflow.com/questions/56535634/propagating-errors-from-within-a-closure-in-a-thread-in-rust", "closed_reason": "Duplicate", "title": "Propagating errors from within a closure in a thread in Rust", "body": "<p>I want to propagate an error from a function called inside a closure inside a call to <code>thread::spawn</code>. </p>\n\n<p>I've tried using a <code>JoinHandle</code> to capture the result of <code>thread::spawn</code>, but I get various errors doing that. </p>\n\n<pre><code>fn start_server(args) -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {\n    ...\n    thread::spawn(move || {\n        // I want to do this (put a ? after run_server)\n        run_server(args)?;\n        ...\n    }\n    ...        \n});\n</code></pre>\n\n<pre><code>fn run_server(args) -&gt; Result&lt;(), std::io::Error&gt; {\n    ...\n}\n</code></pre>\n\n<p>I get this message </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>|             run_server(args)?;\n|             ^^^^^^^^^^^^^^^^^ cannot use the `?` operator in a function that returns `()`\n|\n= help: the trait `std::ops::Try` is not implemented for `()`\n= note: required by `std::ops::Try::from_error`\n</code></pre>\n"}, {"tags": ["rust", "substrate"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user3956566"}, "edited": false, "score": 1, "creation_date": 1560621705, "post_id": 56535235, "comment_id": 99800389, "body": "Please disclose any <a href=\"https://stackoverflow.com/help/promotion\">affiliations</a> and do not use the site as a way to promote your site through posting. See <a href=\"https://stackoverflow.com/help/how-to-answer\">How do I write a good answer?</a>."}], "tags": [], "owner": {"reputation": 42460, "user_id": 642626, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/fedc5e6b7fef29a8b539e20da8c85971?s=128&d=identicon&r=PG", "display_name": "Bryan Chen", "link": "https://stackoverflow.com/users/642626/bryan-chen"}, "is_accepted": false, "score": 3, "last_activity_date": 1560654331, "last_edit_date": 1560654331, "creation_date": 1560215778, "answer_id": 56535235, "question_id": 56535234, "link": "https://stackoverflow.com/questions/56535234/how-to-create-a-new-blockchain-project-based-on-cennznet/56535235#56535235", "title": "How to create a new blockchain project based on CENNZnet?", "body": "<p>(Disclosure: I am one of the core developer of CENNZnet) </p>\n\n<hr>\n\n<p>Unfortunately we have to fork Substrate project to add few features that are necessary for CENNZnet and all the CENNZnet modules are directly or indirectly depends on those features. This means in order to integrate with CENNZnet modules, people needs to depends on our <a href=\"https://github.com/cennznet/plug-blockchain\" rel=\"nofollow noreferrer\">Substrate fork</a> instead of Parity Substrate.</p>\n\n<p>We are in the process of contribute those changes and modules back to upstream so eventually this step will not be needed anymore.</p>\n\n<hr>\n\n<h3>Create and run a new CENNZnet runtime project</h3>\n\n<ul>\n<li>Use this link to generate a new Github project based on cennznet-runtime-template: <a href=\"https://github.com/cennznet/cennznet-runtime-template/generate\" rel=\"nofollow noreferrer\">https://github.com/cennznet/cennznet-runtime-template/generate</a>\n\n<ul>\n<li>Enter repository name and optionally enter project description</li>\n<li>Click create repository from template</li>\n</ul></li>\n<li>Clone the newly created project\n\n<ul>\n<li><code>git clone git@github.com:[user-name]/[project-name].git</code></li>\n</ul></li>\n<li>Add executable permission to build scripts\n\n<ul>\n<li>Due to a Github bug the executable permission of build scripts are not preserved so we need to manually add it</li>\n<li><code>chmod +x ./scripts/init.sh ./scripts/build.sh ./runtime/wasm/build.sh</code></li>\n</ul></li>\n<li>Ensure required tools are installed\n\n<ul>\n<li><code>./scripts/init.sh</code></li>\n</ul></li>\n<li>Build the project\n\n<ul>\n<li><code>./scripts/build.sh</code></li>\n<li>This builds Runtime Wasm files</li>\n<li><code>cargo build</code></li>\n<li>This builds native executable</li>\n</ul></li>\n<li>Run a local testnet\n\n<ul>\n<li><code>cargo run -- --dev</code></li>\n</ul></li>\n<li>Now your testnet is up and running</li>\n</ul>\n\n<h3>Use CENNZnet web UI to connect to your node</h3>\n\n<ul>\n<li>Note: Currently Chrome browser is required to allow you connect to locally running node</li>\n<li>Open <a href=\"https://cennznet.js.org/cennznet-ui/#/settings\" rel=\"nofollow noreferrer\">https://cennznet.js.org/cennznet-ui/#/settings</a></li>\n<li>Change endpoint to Local Node</li>\n<li>Click Save &amp; Reload</li>\n<li>Now you should be able to interact with the node</li>\n</ul>\n"}], "owner": {"reputation": 42460, "user_id": 642626, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/fedc5e6b7fef29a8b539e20da8c85971?s=128&d=identicon&r=PG", "display_name": "Bryan Chen", "link": "https://stackoverflow.com/users/642626/bryan-chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 1, "closed_date": 1560661846, "answer_count": 1, "score": 1, "last_activity_date": 1560654331, "creation_date": 1560215778, "question_id": 56535234, "link": "https://stackoverflow.com/questions/56535234/how-to-create-a-new-blockchain-project-based-on-cennznet", "closed_reason": "Needs more focus", "title": "How to create a new blockchain project based on CENNZnet?", "body": "<p>I would like to create a new blockchain project based on Substrate and integrate it with modules provided by CENNZnet such as GenericAsset and CENNZX-Spot module.</p>\n\n<p>The project generated by <code>substrate-up/substrate-node-new</code> script cannot integrate with CENNZnet module directly due to mismatch dependencies and cause compile errors.</p>\n\n<p>What is the best way to create a new Substrate project that can be integrated with CENNZnet modules?</p>\n"}, {"tags": ["string", "loops", "rust"], "comments": [{"owner": {"reputation": 129, "user_id": 9579613, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AmLR6.jpg?s=128&g=1", "display_name": "Jo&#227;o Bravo", "link": "https://stackoverflow.com/users/9579613/jo%c3%a3o-bravo"}, "edited": false, "score": 0, "creation_date": 1560203910, "post_id": 56533943, "comment_id": 99651151, "body": "Are you doing this in <code>java</code>?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 2, "creation_date": 1560207854, "post_id": 56533943, "comment_id": 99651983, "body": "Please take the time to look at the formatting of your post. It&#39;s very difficult to tell which parts are output from the compiler or the program, which parts are input by you, and which parts are text from your question."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1560207856, "post_id": 56533943, "comment_id": 99651985, "body": "Please take the time to look at the formatting of your post. It&#39;s very difficult to tell which parts are output from the compiler or the program, which parts are input by you, and which parts are text from your question."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1560207869, "post_id": 56533943, "comment_id": 99651986, "body": "It&#39;s hard to answer your question because it doesn&#39;t include a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. We can&#39;t tell what crates (and their versions), types, traits, fields, etc. are present in the code. It would make it easier for us to help you if you try to reproduce your error on the <a href=\"https://play.rust-lang.org\" rel=\"nofollow noreferrer\">Rust Playground</a> if possible, otherwise in a brand new Cargo project, then <a href=\"https://stackoverflow.com/posts/56533943/edit\">edit</a> your question to include the additional info. There are <a href=\"//stackoverflow.com/tags/rust/info\">Rust-specific MCVE tips</a> you can use to reduce your original code for posting here. Thanks!"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560207968, "post_id": 56533943, "comment_id": 99652006, "body": "It <i>appears</i> that you are stating that the output of the program is <code>HI</code> when the input was <code>Hi</code>. It&#39;s <b>very improbable</b> that the compiler magically changed the case of your string (see also <a href=\"https://stackoverflow.com/q/38406793/155423\">Why is capitalizing the first letter of a string so convoluted in Rust?</a>), which seems to indicate that you didn&#39;t exactly copy the input and output. If you don&#39;t copy the exact code, input, and output, then you are asking us to diagnose a problem based on false premises."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 129, "user_id": 9579613, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AmLR6.jpg?s=128&g=1", "display_name": "Jo&#227;o Bravo", "link": "https://stackoverflow.com/users/9579613/jo%c3%a3o-bravo"}, "edited": false, "score": 0, "creation_date": 1560256309, "post_id": 56533943, "comment_id": 99669139, "body": "@Jo&#227;oBravo your edit was incorrect (and the reviewers should not have approved it). You added characters (the backticks) and changed the output provided by the OP (capital <code>I</code> to lowercase <code>i</code>). This fundamentally changes the question. I&#39;ve rolled back the changes."}, {"owner": {"reputation": 129, "user_id": 9579613, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AmLR6.jpg?s=128&g=1", "display_name": "Jo&#227;o Bravo", "link": "https://stackoverflow.com/users/9579613/jo%c3%a3o-bravo"}, "edited": false, "score": 0, "creation_date": 1560278060, "post_id": 56533943, "comment_id": 99681421, "body": "I don&#39;t think it does. The question is primarily about output with/without newlines. I assumed the capital I and the lowercase i have nothing to do with it"}], "answers": [{"tags": [], "owner": {"reputation": 129, "user_id": 9579613, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AmLR6.jpg?s=128&g=1", "display_name": "Jo&#227;o Bravo", "link": "https://stackoverflow.com/users/9579613/jo%c3%a3o-bravo"}, "is_accepted": false, "score": 2, "last_activity_date": 1560207695, "last_edit_date": 1560207695, "creation_date": 1560203921, "answer_id": 56534039, "question_id": 56533943, "link": "https://stackoverflow.com/questions/56533943/i-want-to-run-a-loop-in-println/56534039#56534039", "title": "I want to run a loop in println", "body": "<p><code>println</code> adds a <em>newline</em> by default (that is what the <code>ln</code> stands for, <em>line</em>).</p>\n\n<p>Try to use the <code>print</code> macro instead.</p>\n"}], "owner": {"reputation": 51, "user_id": 8995981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2f2e56fa4bc20dd5130347243a0e33e?s=128&d=identicon&r=PG", "display_name": "Arsalan Ahmed", "link": "https://stackoverflow.com/users/8995981/arsalan-ahmed"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "closed_date": 1560207626, "answer_count": 1, "score": -6, "last_activity_date": 1560375828, "creation_date": 1560203222, "last_edit_date": 1560375828, "question_id": 56533943, "link": "https://stackoverflow.com/questions/56533943/i-want-to-run-a-loop-in-println", "closed_reason": "Duplicate", "title": "I want to run a loop in println", "body": "<p>I'm making a program in rust has an output like this but I'm failed.</p>\n\n<p>Enter String: Hi</p>\n\n<p>How many copies of String you need: 3</p>\n\n<p>3 Copies of Hi are HiHiHi</p>\n\n<p>but my code gives me this</p>\n\n<p>HI</p>\n\n<p>HI</p>\n\n<p>HI</p>\n\n<pre><code>while i &lt; index {\n\n    println!(\"{}\", text);\n    i += 1;\n\n}\n</code></pre>\n"}, {"tags": ["rust", "range"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1560200454, "post_id": 56533418, "comment_id": 99650120, "body": "<i>Rust match uses <code>...</code> for inclusive range</i> \u2014 it doesn&#39;t have to and that syntax is effectively deprecated."}, {"owner": {"reputation": 1542, "user_id": 773522, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/33fea37e789ecc06ea29c5b2dc4546d9?s=128&d=identicon&r=PG", "display_name": "fbas", "link": "https://stackoverflow.com/users/773522/fbas"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560211651, "post_id": 56533418, "comment_id": 99652644, "body": "thanks. I&#39;ve read the linked messages above."}], "owner": {"reputation": 1542, "user_id": 773522, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/33fea37e789ecc06ea29c5b2dc4546d9?s=128&d=identicon&r=PG", "display_name": "fbas", "link": "https://stackoverflow.com/users/773522/fbas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "closed_date": 1560200341, "answer_count": 0, "score": 0, "last_activity_date": 1560200530, "creation_date": 1560200171, "last_edit_date": 1560200530, "question_id": 56533418, "link": "https://stackoverflow.com/questions/56533418/why-does-creating-an-inclusive-range-use-while-matching-on-an-inclusive-rang", "closed_reason": "Duplicate", "title": "Why does creating an inclusive range use ..= while matching on an inclusive range uses ...?", "body": "<p><a href=\"https://doc.rust-lang.org/rust-by-example/flow_control/for.html\" rel=\"nofollow noreferrer\">Ranges use <code>..=</code> for inclusive range</a>:</p>\n\n<pre><code>for n in 1..=100 {\n    if n % 15 == 0 {\n        println!(\"fizzbuzz\");\n    } else if n % 3 == 0 {\n        println!(\"fizz\");\n    } else if n % 5 == 0 {\n        println!(\"buzz\");\n    } else {\n        println!(\"{}\", n);\n    }\n}\n</code></pre>\n\n<p>While <a href=\"https://doc.rust-lang.org/rust-by-example/flow_control/match.html\" rel=\"nofollow noreferrer\">match uses <code>...</code> for inclusive range</a>:</p>\n\n<pre><code>match number {\n    // Match a single value\n    1 =&gt; println!(\"One!\"),\n    // Match several values\n    2 | 3 | 5 | 7 | 11 =&gt; println!(\"This is a prime\"),\n    // Match an inclusive range\n    13...19 =&gt; println!(\"A teen\"),\n    // Handle the rest of cases\n    _ =&gt; println!(\"Ain't special\"),\n}\n</code></pre>\n"}, {"tags": ["reference", "rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1560191630, "post_id": 56528652, "comment_id": 99646769, "body": "It&#39;s highly likely that you are experiencing an <a href=\"https://meta.stackexchange.com/questions/66377/what-is-the-xy-problem\">XY problem</a>. There&#39;s almost certainly a better way to solve the root problem that caused you to ask this question."}], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 10, "last_activity_date": 1560191873, "last_edit_date": 1592644375, "creation_date": 1560180057, "answer_id": 56529158, "question_id": 56528652, "link": "https://stackoverflow.com/questions/56528652/how-to-convert-a-tuple-of-references-to-a-reference-of-a-tuple/56529158#56529158", "title": "How to convert a tuple of references to a reference of a tuple?", "body": "<p>This is impossible.</p>\n<p>A reference <em>refers</em> to a value. You wish to have a <code>&amp;(Bar, Bar)</code> but there is nowhere in memory that has a 2-tuple of <code>(Bar, Bar)</code>. You cannot refer to something that does not exist.</p>\n<p>The memory layouts of <code>&amp;(A, B)</code> and <code>(&amp;A, &amp;B)</code> are fundamentally incompatible, so you cannot use unsafe Rust techniques either.</p>\n<hr />\n<p>In <em>this particular case</em>, you <strong>might</strong> be able to use unsafe Rust to convert your <code>&amp;Foo</code> directly to a <code>&amp;(Bar, Bar)</code>, but...</p>\n<ul>\n<li>it requires that the layout of a tuple struct and a tuple be the same; I don't know that's guaranteed<sup>1</sup></li>\n<li>it requires that the layout of a tuple struct be tightly packed such that you can offset by the member size to get to the next one; I don't know that's guaranteed<sup>1</sup></li>\n<li>it requires that the layout of the tuple struct places the members in the same order they are defined; I don't know that's guaranteed<sup>1</sup></li>\n<li>you can only do it for sequential pieces; no getting the first and third item</li>\n</ul>\n<pre><code>// I copied this unsafe block from Stack Overflow\n// without properly documenting why I think this code is safe.\nlet b: &amp;(Bar, Bar) = unsafe { &amp;*(a as *const Foo as *const (Bar, Bar)) };\nprintln!(&quot;{:?}&quot;, b);\n</code></pre>\n<pre><code>// I copied this unsafe block from Stack Overflow\n// without properly documenting why I think this code is safe.\nlet c: &amp;(Bar, Bar) = unsafe {\n    let p = a as *const Foo as *const Bar;\n    let p = p.offset(1);\n    &amp;*(p as *const (Bar, Bar))\n};\nprintln!(&quot;{:?}&quot;, c);\n</code></pre>\n<hr />\n<p><strong>1</strong> \u2014 In fact, the <a href=\"https://doc.rust-lang.org/stable/reference/type-layout.html#tuple-layout\" rel=\"noreferrer\">reference explicitly states</a>:</p>\n<blockquote>\n<p>Tuples do not have any guarantees about their layout.</p>\n<p>The exception to this is the unit tuple (<code>()</code>) which is guaranteed as a zero-sized type to have a size of 0 and an alignment of 1.</p>\n</blockquote>\n<p>This means that while this code may print out what you expect and Miri does not complain, it's undefined behavior.</p>\n"}], "owner": {"reputation": 133, "user_id": 10876199, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3XPj9.png?s=128&g=1", "display_name": "Jonas", "link": "https://stackoverflow.com/users/10876199/jonas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 941, "favorite_count": 0, "accepted_answer_id": 56529158, "answer_count": 1, "score": 2, "last_activity_date": 1560191873, "creation_date": 1560178071, "last_edit_date": 1560180196, "question_id": 56528652, "link": "https://stackoverflow.com/questions/56528652/how-to-convert-a-tuple-of-references-to-a-reference-of-a-tuple", "title": "How to convert a tuple of references to a reference of a tuple?", "body": "<p>I'd like to convert a tuple of references (which are all references to members of the same struct) to a reference of a tuple.</p>\n\n<p>I've tried to coerce them in various ways, however I wasn't able to do it without cloning.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct Bar();\n\nstruct Foo(Bar, Bar, Bar);\n\nfn main() {\n    let a: &amp;Foo = &amp;Foo(Bar(), Bar(), Bar());\n    let b: &amp;(Bar, Bar) = &amp;(a.0, a.1);\n}\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0507]: cannot move out of borrowed content\n --&gt; src/main.rs:7:28\n  |\n7 |     let b: &amp;(Bar, Bar) = &amp;(a.0, a.1);\n  |                            ^^^ cannot move out of borrowed content\n\nerror[E0507]: cannot move out of borrowed content\n --&gt; src/main.rs:7:33\n  |\n7 |     let b: &amp;(Bar, Bar) = &amp;(a.0, a.1);\n  |                                 ^^^ cannot move out of borrowed content\n</code></pre>\n\n<p>I expect <code>b</code> to be of type <code>&amp;(Bar, Bar)</code> given <code>a</code> is of type <code>&amp;Foo</code>.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560171570, "post_id": 56526677, "comment_id": 99637319, "body": "What do you expect the result to be when <code>T</code> is a <code>String</code>?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560172172, "post_id": 56526677, "comment_id": 99637620, "body": "By the way, idiomatic Rust uses <code>snake_case</code> for variables, methods, macros, fields and modules; <code>UpperCamelCase</code> for types and enum variants; and <code>SCREAMING_SNAKE_CASE</code> for statics and constants."}], "answers": [{"tags": [], "owner": {"reputation": 9010, "user_id": 2588800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/847da843d41921363502159c8b7e5549?s=128&d=identicon&r=PG", "display_name": "Svetlin Zarev", "link": "https://stackoverflow.com/users/2588800/svetlin-zarev"}, "is_accepted": false, "score": 7, "last_activity_date": 1560172178, "last_edit_date": 1560172178, "creation_date": 1560171161, "answer_id": 56526808, "question_id": 56526677, "link": "https://stackoverflow.com/questions/56526677/how-can-i-add-1-to-a-generic-t/56526808#56526808", "title": "How can I add 1 to a generic T?", "body": "<p>You can do it with the help of the <code>num</code> crate:</p>\n\n<pre><code>use num::One; // 0.2.0\nuse std::ops::Add;\n\nstruct Foo&lt;T: Add&lt;T&gt;&gt; {\n    n: T,\n}\n\nimpl&lt;T&gt; Foo&lt;T&gt;\nwhere\n    T: Add&lt;Output = T&gt; + One,\n{\n    fn addOne(self) -&gt; T {\n        self.n + One::one()\n    }\n}\n\nfn main() {\n    let a = Foo { n: 5 };\n    println!(\"{}\", a.addOne());\n}\n</code></pre>\n\n<p>You can do the same by implementing your own <code>One</code> as an exercise, but it requires a lot of boilerplate code:</p>\n\n<pre><code>trait One {\n    fn one() -&gt; Self;\n}\n\n// Now do the same for the rest of the numeric types such as u8, i8, u16, i16, etc\nimpl One for i32 {\n    fn one() -&gt; Self {\n       1\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 2193, "user_id": 2856202, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/AHuOz.png?s=128&g=1", "display_name": "eigenfield", "link": "https://stackoverflow.com/users/2856202/eigenfield"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 0, "closed_date": 1560171633, "answer_count": 1, "score": 2, "last_activity_date": 1560172178, "creation_date": 1560170588, "last_edit_date": 1560171559, "question_id": 56526677, "link": "https://stackoverflow.com/questions/56526677/how-can-i-add-1-to-a-generic-t", "closed_reason": "Duplicate", "title": "How can I add 1 to a generic T?", "body": "<p>Below is a generic type <code>Foo</code>. How can I correctly implement the <code>addOne</code> method:</p>\n\n<pre><code>struct Foo&lt;T&gt; {\n    n: T,\n}\n\nimpl&lt;T&gt; Foo&lt;T&gt; {\n    fn addOne(self) -&gt; T {\n        self.n + 1\n    }\n}\n\nfn main() {\n    let a = Foo { n: 5 };\n    println!(\"{}\", a.addOne());\n}\n</code></pre>\n\n<p>I expect the output of 6, but this code does not compile:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0369]: binary operation `+` cannot be applied to type `T`\n --&gt; src/main.rs:7:16\n  |\n7 |         self.n + 1\n  |         ------ ^ - {integer}\n  |         |\n  |         T\n  |\n  = note: `T` might need a bound for `std::ops::Add`\n</code></pre>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 1, "creation_date": 1560154879, "post_id": 56522510, "comment_id": 99629764, "body": "Please write the edit reason, you&#39;ve changed an important part of your code."}, {"owner": {"reputation": 845, "user_id": 4077574, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/orn50.png?s=128&g=1", "display_name": "Galaxy", "link": "https://stackoverflow.com/users/4077574/galaxy"}, "reply_to_user": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 0, "creation_date": 1560155160, "post_id": 56522510, "comment_id": 99629859, "body": "@&#214;merErden Yeah, I was doing."}, {"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 1, "creation_date": 1560155621, "post_id": 56522510, "comment_id": 99630037, "body": "It was called as shadowing, please read this post <a href=\"https://stackoverflow.com/questions/48227347/does-rust-free-up-the-memory-of-overwritten-variables\" title=\"does rust free up the memory of overwritten variables\">stackoverflow.com/questions/48227347/&hellip;</a>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560171329, "post_id": 56522510, "comment_id": 99637195, "body": "Why didn&#39;t you just put a <code>println</code> in your <code>drop</code> implementation and find out for yourself?"}, {"owner": {"reputation": 845, "user_id": 4077574, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/orn50.png?s=128&g=1", "display_name": "Galaxy", "link": "https://stackoverflow.com/users/4077574/galaxy"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560221180, "post_id": 56522510, "comment_id": 99654212, "body": "@Shepmaster I should :(. But anyway I learned a lot through this question."}], "answers": [{"tags": [], "owner": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "is_accepted": false, "score": 2, "last_activity_date": 1560154086, "creation_date": 1560154086, "answer_id": 56522714, "question_id": 56522510, "link": "https://stackoverflow.com/questions/56522510/does-setting-an-option-instance-from-some-to-none-trigger-dropping-of-the-inner/56522714#56522714", "title": "Does setting an Option instance from Some to None trigger dropping of the inner value?", "body": "<p>Unless you explicitly notate your variable name as <code>_</code> it is dropped when the scope has finished. </p>\n\n<p>In your case, variables will be released when the <strong><em>relevant scope</em></strong> is ended.</p>\n\n<p>Since you implement <code>Drop</code> trait for <code>Foo</code> explicitly. It will override the <code>drop</code> behavior and call your <code>drop</code> function:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn main() {\n    let _: Option&lt;Foo&gt; = Some(Foo::default()); // Since variable name is '_' it will be dropped automatically.\n\n    {\n        let foo: Option&lt;Foo&gt; = Some(Foo::default());\n        let foo: Option&lt;Foo&gt; = None;\n        println!(\"Inner Scope Finishing. Going to drop inner scope variables.\");\n    } // Inner scope is finished dropping the inner scope variables.\n\n    let main_foo: Option&lt;Foo&gt; = Some(Foo::default());\n    let main_foo: Option&lt;Foo&gt; = None;\n    println!(\"Main Scope Finishing. Going to drop main scope variables.\");\n} // Main is finished dropping the main scope variables\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=7bae25b25fac55260422afadf274d978\" rel=\"nofollow noreferrer\">Playground</a> to show the behavior.</p>\n"}, {"comments": [{"owner": {"reputation": 852, "user_id": 6563468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4c2119cfc1ee9a6c5deeec2ead9a261?s=128&d=identicon&r=PG&f=1", "display_name": "Logan Reed", "link": "https://stackoverflow.com/users/6563468/logan-reed"}, "edited": false, "score": 0, "creation_date": 1560178084, "post_id": 56522765, "comment_id": 99640625, "body": "In a hypothetical scenario, if you keep shadowing a variable like that in a loop (and loop is very long) does that have potential to &quot;leak&quot; quite a bit of memory until that end of block is reached?"}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "reply_to_user": {"reputation": 852, "user_id": 6563468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4c2119cfc1ee9a6c5deeec2ead9a261?s=128&d=identicon&r=PG&f=1", "display_name": "Logan Reed", "link": "https://stackoverflow.com/users/6563468/logan-reed"}, "edited": false, "score": 0, "creation_date": 1560178754, "post_id": 56522765, "comment_id": 99640961, "body": "@LoganReed You can&#39;t shadow a variable created in a loop in the loop itself -- you end up only shadowing the outer variable each iteration; see <a href=\"https://stackoverflow.com/a/40323730/3650362\">this answer</a> for example."}, {"owner": {"reputation": 65310, "user_id": 201725, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/616f7a1cbb20fe949d883393657c039a?s=128&d=identicon&r=PG", "display_name": "Jan Hudec", "link": "https://stackoverflow.com/users/201725/jan-hudec"}, "reply_to_user": {"reputation": 852, "user_id": 6563468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4c2119cfc1ee9a6c5deeec2ead9a261?s=128&d=identicon&r=PG&f=1", "display_name": "Logan Reed", "link": "https://stackoverflow.com/users/6563468/logan-reed"}, "edited": false, "score": 0, "creation_date": 1560181840, "post_id": 56522765, "comment_id": 99642596, "body": "@LoganReed, the body of the loop is a block, so scope of any variable introduced in the loop ends at the end of iteration."}, {"owner": {"reputation": 65310, "user_id": 201725, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/616f7a1cbb20fe949d883393657c039a?s=128&d=identicon&r=PG", "display_name": "Jan Hudec", "link": "https://stackoverflow.com/users/201725/jan-hudec"}, "reply_to_user": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 1, "creation_date": 1560181948, "post_id": 56522765, "comment_id": 99642647, "body": "@trentcl, well you can have two <code>let foo</code>s in the body shadowing each other within one iteration\u2014the point is their scope ends at the end of the iteration, so they don&#39;t accumulate."}, {"owner": {"reputation": 852, "user_id": 6563468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4c2119cfc1ee9a6c5deeec2ead9a261?s=128&d=identicon&r=PG&f=1", "display_name": "Logan Reed", "link": "https://stackoverflow.com/users/6563468/logan-reed"}, "edited": false, "score": 0, "creation_date": 1560778332, "post_id": 56522765, "comment_id": 99836667, "body": "@JanHudec - you are correct. To refine the question - is it dropped (and memory freed) at the end of each loop then, or do those shadowed variables stay on stack till the function ends (i.e. closing brace of the function, not the loop(!))? Rust docs say that stack gets freed only when function exits... If that is true - one can accumulate a lot of shadowed and no longer accessible variables on the stack."}, {"owner": {"reputation": 65310, "user_id": 201725, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/616f7a1cbb20fe949d883393657c039a?s=128&d=identicon&r=PG", "display_name": "Jan Hudec", "link": "https://stackoverflow.com/users/201725/jan-hudec"}, "reply_to_user": {"reputation": 852, "user_id": 6563468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4c2119cfc1ee9a6c5deeec2ead9a261?s=128&d=identicon&r=PG&f=1", "display_name": "Logan Reed", "link": "https://stackoverflow.com/users/6563468/logan-reed"}, "edited": false, "score": 0, "creation_date": 1560796885, "post_id": 56522765, "comment_id": 99845216, "body": "@LoganReed, at the end of the loop body in each iteration. The only way things can accumulate on the stack is recursive function calls."}], "tags": [], "owner": {"reputation": 65310, "user_id": 201725, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/616f7a1cbb20fe949d883393657c039a?s=128&d=identicon&r=PG", "display_name": "Jan Hudec", "link": "https://stackoverflow.com/users/201725/jan-hudec"}, "is_accepted": true, "score": 2, "last_activity_date": 1560173153, "last_edit_date": 1560173153, "creation_date": 1560154406, "answer_id": 56522765, "question_id": 56522510, "link": "https://stackoverflow.com/questions/56522510/does-setting-an-option-instance-from-some-to-none-trigger-dropping-of-the-inner/56522765#56522765", "title": "Does setting an Option instance from Some to None trigger dropping of the inner value?", "body": "<blockquote>\n<pre><code>let foo = Some(Foo::default());\nlet foo = None; // Would this line trigger `Foo::drop`?\n</code></pre>\n</blockquote>\n\n<p>No, the end of the block will.</p>\n\n<p>Remember that <code>let</code> is a variable <em>declaration</em>, so the second line is not modifying the first <code>foo</code>, it is creating a new <code>foo</code> that shadows the former. But it still exists (and could be accessed if you created a reference to it before the second <code>let</code>) until the end of the block, so it will be dropped at end of the block.</p>\n\n<p>If you want to actually change the variable, you have to do</p>\n\n<pre><code>let mut foo = Some(Foo::default());\nfoo = None;\n</code></pre>\n\n<p>Now it will trigger the drop immediately, because the old value is being overwritten, so it has to drop it.</p>\n"}], "owner": {"reputation": 845, "user_id": 4077574, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/orn50.png?s=128&g=1", "display_name": "Galaxy", "link": "https://stackoverflow.com/users/4077574/galaxy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 56522765, "answer_count": 2, "score": 1, "last_activity_date": 1560173153, "creation_date": 1560153023, "last_edit_date": 1560171290, "question_id": 56522510, "link": "https://stackoverflow.com/questions/56522510/does-setting-an-option-instance-from-some-to-none-trigger-dropping-of-the-inner", "title": "Does setting an Option instance from Some to None trigger dropping of the inner value?", "body": "<p>I have the code:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct Foo {}\n\nimpl Default for Foo {\n    fn default() -&gt; Self {\n        Self {}\n    }\n}\n\nimpl Drop for Foo {\n    fn drop(&amp;mut self) {\n        // Do something\n    }\n}\n\nfn main() {\n    {\n        let foo = Some(Foo::default());\n        let foo = None; // Would this line trigger `Foo::drop`?\n    };\n    {\n        let mut foo = Some(Foo::default());\n        foo = None; // Would this line trigger `Foo::drop`?\n    };\n}\n</code></pre>\n\n<p>Are the resources occupied by <code>foo</code>s released properly?</p>\n\n<p>The first situation (variable overwritten) will not trigger <code>drop</code>, so I added the second situation, in which I'm also confused.</p>\n"}, {"tags": ["debugging", "visual-studio-code", "rust"], "comments": [{"owner": {"reputation": 29810, "user_id": 423170, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/H9kNQ.png?s=128&g=1", "display_name": "Frxstrem", "link": "https://stackoverflow.com/users/423170/frxstrem"}, "edited": false, "score": 0, "creation_date": 1560120833, "post_id": 56518902, "comment_id": 99622918, "body": "Not sure if it would work but potentially redeclaring <code>let c = c;</code> might make that variable available to the debugger?"}, {"owner": {"reputation": 1668, "user_id": 2898801, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ce277153b915b6d5e6151e6365acad20?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Ronning", "link": "https://stackoverflow.com/users/2898801/christopher-ronning"}, "reply_to_user": {"reputation": 29810, "user_id": 423170, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/H9kNQ.png?s=128&g=1", "display_name": "Frxstrem", "link": "https://stackoverflow.com/users/423170/frxstrem"}, "edited": false, "score": 0, "creation_date": 1560121003, "post_id": 56518902, "comment_id": 99622953, "body": "@Frxstrem Thanks for the suggestion! I tried that, and it did not seem to make a difference. Either way, I would love to find a solution that does not require extra boilerplate."}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 4, "creation_date": 1560163171, "post_id": 56518902, "comment_id": 99633475, "body": "LLDB doesn&#39;t yet support a number of Rust concepts. It can&#39;t understand enums, and apparently can&#39;t understand <code>char</code> either."}, {"owner": {"reputation": 1668, "user_id": 2898801, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ce277153b915b6d5e6151e6365acad20?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Ronning", "link": "https://stackoverflow.com/users/2898801/christopher-ronning"}, "reply_to_user": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1560192579, "post_id": 56518902, "comment_id": 99647171, "body": "@PeterHall That is unfortunate. Are you aware of another GNU toolchain that supports these features? Or barring that, any clue if there&#39;s a roadmap for this type of support?"}, {"owner": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "edited": false, "score": 2, "creation_date": 1560194378, "post_id": 56518902, "comment_id": 99647978, "body": "<code>rust-gdb</code> is able to print the value: <code>$ rust-gdb target&#47;debug&#47;pr</code>, then <code>(gdb) br main.rs:6</code>, <code>(gdb) run</code>, and when it stops <code>(gdb) print c</code> shows: <code>$1 = 116 &#39;t&#39;</code>."}, {"owner": {"reputation": 1, "user_id": 1114, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/FFE8V.gif?s=128&g=1", "display_name": "Jeremy", "link": "https://stackoverflow.com/users/1114/jeremy"}, "edited": false, "score": 1, "creation_date": 1560194417, "post_id": 56518902, "comment_id": 99647994, "body": "Possibly related: <a href=\"https://github.com/rust-lang/rls-vscode/issues/509\" rel=\"nofollow noreferrer\">rls-vscode#509 <code>Option</code> variables show &quot;&lt;not available&gt;&quot; even when clearly set</a>"}, {"owner": {"reputation": 1668, "user_id": 2898801, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ce277153b915b6d5e6151e6365acad20?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Ronning", "link": "https://stackoverflow.com/users/2898801/christopher-ronning"}, "edited": false, "score": 1, "creation_date": 1560197714, "post_id": 56518902, "comment_id": 99649222, "body": "I&#39;m not necessarily able to dig deep into this right now, but this is possibly related too: <a href=\"https://stackoverflow.com/questions/36621130/how-can-i-inspect-variable-values-while-debugging-msvc-abi-rust-programs?rq=1\" title=\"how can i inspect variable values while debugging msvc abi rust programs\">stackoverflow.com/questions/36621130/&hellip;</a>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 2, "creation_date": 1560363688, "post_id": 56518902, "comment_id": 99715683, "body": "Orthogonal to your direct question, but an <code>if let</code> would be more idiomatic than a <code>match</code> in this code."}, {"owner": {"reputation": 1478, "user_id": 10176717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b0303515be69a1ae26d7c8f0b85687a?s=128&d=identicon&r=PG&f=1", "display_name": "amirali", "link": "https://stackoverflow.com/users/10176717/amirali"}, "edited": false, "score": 0, "creation_date": 1560367488, "post_id": 56518902, "comment_id": 99717260, "body": "Have you ever run any rust code on vscode before or it&#39;s the first time? I mean, if it&#39;s the first time, there may be some problem setting up the extension."}, {"owner": {"reputation": 5800, "user_id": 6163736, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/TKHBG.jpg?s=128&g=1", "display_name": "stacksonstacks", "link": "https://stackoverflow.com/users/6163736/stacksonstacks"}, "edited": false, "score": 1, "creation_date": 1560734749, "post_id": 56518902, "comment_id": 99820237, "body": "Same experience as OP on mac"}], "owner": {"reputation": 1668, "user_id": 2898801, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ce277153b915b6d5e6151e6365acad20?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Ronning", "link": "https://stackoverflow.com/users/2898801/christopher-ronning"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 901, "favorite_count": 1, "answer_count": 0, "score": 23, "last_activity_date": 1560363629, "creation_date": 1560120302, "last_edit_date": 1560363629, "question_id": 56518902, "link": "https://stackoverflow.com/questions/56518902/why-do-i-get-identifier-is-undefined-or-not-available-when-inspecting-a-rust", "title": "Why do I get &quot;identifier is undefined&quot; or &quot;not available&quot; when inspecting a Rust variable in the Visual Studio debugger?", "body": "<p>I've set up the Visual Studio Code debugger and run the following program.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub fn main() {\n    let mut chars = \"test\".chars();\n    match chars.next() {\n        Some(c) =&gt; {\n            println!(\"What is the value of c, here?\");\n            if c == 'c' {\n                println!(\"c\");\n            }\n        }\n        None =&gt; {}\n    }\n}\n</code></pre>\n\n<p>If I set a breakpoint at line 6, and look in the Variables and Watch panes, c does not evaluate, but rather passes the following message: <code>identifier 'c' is undefined</code> using cppvsdbg on Windows, or <code>&lt;not available&gt;</code> using lldb on Linux. I've confirmed that this happens both on Linux and Windows builds, for the current stable compiler version.</p>\n\n<p>I've also added the following to Cargo.toml to no avail:</p>\n\n<pre><code>[profile.dev]\nopt-level = 0\ndebug = true\n</code></pre>\n\n<p>For reference, here is my launch.json file, needed for the VS Code compiler:</p>\n\n<pre><code>{\n    \"version\": \"0.2.0\",\n    \"configurations\": [\n        {\n            \"name\": \"(Windows) Launch\",\n            \"type\": \"cppvsdbg\",\n            \"request\": \"launch\",\n            \"program\": \"${workspaceFolder}/target/debug/test.exe\",\n            \"args\": [],\n            \"stopAtEntry\": false,\n            \"cwd\": \"${workspaceFolder}\",\n            \"environment\": [],\n            \"externalConsole\": true\n        }\n    ]\n}\n</code></pre>\n\n<p>Replace \"(Windows) Launch\" with your OS of choice.</p>\n\n<p>Why is this the result? Is there a fix, or are there some compiler options that should be added?</p>\n"}, {"tags": ["typescript", "rust", "wasm-bindgen"], "comments": [{"owner": {"reputation": 101, "user_id": 4672929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffc496022ae7445c8a3791616de4d6e8?s=128&d=identicon&r=PG&f=1", "display_name": "kuukuu", "link": "https://stackoverflow.com/users/4672929/kuukuu"}, "edited": false, "score": 3, "creation_date": 1560462941, "post_id": 56518770, "comment_id": 99755697, "body": "This is not possible atm. Coincidentally, it has been brought up recently: <a href=\"https://github.com/rustwasm/wasm-bindgen/issues/1591\" rel=\"nofollow noreferrer\">github.com/rustwasm/wasm-bindgen/issues/1591</a>"}, {"owner": {"reputation": 883, "user_id": 2926289, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xfk9Y.png?s=128&g=1", "display_name": "GiantCowFilms", "link": "https://stackoverflow.com/users/2926289/giantcowfilms"}, "reply_to_user": {"reputation": 101, "user_id": 4672929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffc496022ae7445c8a3791616de4d6e8?s=128&d=identicon&r=PG&f=1", "display_name": "kuukuu", "link": "https://stackoverflow.com/users/4672929/kuukuu"}, "edited": false, "score": 0, "creation_date": 1560527790, "post_id": 56518770, "comment_id": 99779152, "body": "@kuukuu Thanks for the information."}], "owner": {"reputation": 883, "user_id": 2926289, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xfk9Y.png?s=128&g=1", "display_name": "GiantCowFilms", "link": "https://stackoverflow.com/users/2926289/giantcowfilms"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 332, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1560127151, "creation_date": 1560118505, "last_edit_date": 1560127151, "question_id": 56518770, "link": "https://stackoverflow.com/questions/56518770/is-there-any-way-to-annotate-the-typescript-type-of-wasm-bindgens-jsvalue-to-so", "title": "Is there any way to annotate the TypeScript type of wasm-bindgen&#39;s JsValue to something more meaningful?", "body": "<p>I have a Rust / Wasm function that I am generating TypeScript bindings for using wasm_bindgen. The output type for <code>JsValue</code> is <code>any</code>. Is there any way to manually annotate the type to something more meaningful without editing the auto-generated <code>*.d.ts</code>?</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[wasm_bindgen]\nimpl GameClient {\n    pub fn game_list(&amp;self) -&gt; JsValue {\n        JsValue::from_serde(&amp;self.game_list).unwrap()\n    }\n}\n</code></pre>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 1321, "user_id": 1291664, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/95854ef7aaf132a9f9ed8fd61366f7df?s=128&d=identicon&r=PG", "display_name": "\u0110or\u0111e Zelji\u0107", "link": "https://stackoverflow.com/users/1291664/%c4%90or%c4%91e-zelji%c4%87"}, "reply_to_user": {"reputation": 21, "user_id": 11622566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5939ffd63676ba8a831fcad8948fa15f?s=128&d=identicon&r=PG&f=1", "display_name": "usummon", "link": "https://stackoverflow.com/users/11622566/usummon"}, "edited": false, "score": 0, "creation_date": 1560109548, "post_id": 56517804, "comment_id": 99621050, "body": "@usummon BTW. you have to be careful here <code>thread &#39;main&#39; panicked at &#39;index out of bounds: the len is 3 but the index is 4&#39;</code>"}], "tags": [], "owner": {"reputation": 56, "user_id": 11045471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bf188cac85177721f3f1ddaded4694f?s=128&d=identicon&r=PG&f=1", "display_name": "tfachmann", "link": "https://stackoverflow.com/users/11045471/tfachmann"}, "is_accepted": true, "score": 1, "last_activity_date": 1560110403, "last_edit_date": 1560110403, "creation_date": 1560108877, "answer_id": 56517804, "question_id": 56517606, "link": "https://stackoverflow.com/questions/56517606/how-do-i-use-a-paremeter-to-index-an-array-in-rust/56517804#56517804", "title": "How do I use a paremeter to index an array in rust?", "body": "<p>The Problem seems to be in your function, as foo is of type <code>foo: u32</code> \nYou can see <a href=\"https://stackoverflow.com/questions/46102811/why-i-can-not-use-u8-as-an-index-value-of-a-rust-array\">here</a> and in your compiler result, that array indices have to be of type <code>usize</code> so you could cast it to <code>usize</code> as</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>array[foo as usize] = 9\n</code></pre>\n\n<p>or change your function header as</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn example(foo: usize) {\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 11622566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5939ffd63676ba8a831fcad8948fa15f?s=128&d=identicon&r=PG&f=1", "display_name": "usummon", "link": "https://stackoverflow.com/users/11622566/usummon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 649, "favorite_count": 0, "closed_date": 1560127008, "accepted_answer_id": 56517804, "answer_count": 1, "score": -3, "last_activity_date": 1560127062, "creation_date": 1560107248, "question_id": 56517606, "link": "https://stackoverflow.com/questions/56517606/how-do-i-use-a-paremeter-to-index-an-array-in-rust", "closed_reason": "Duplicate", "title": "How do I use a paremeter to index an array in rust?", "body": "<p>I'm trying to create a function that will take a parameter and use it as an index for an array rust will not let me do this and because of this I'm hoping to find an alternative method to achieve the same results.</p>\n\n<p>although I'm not a 100% I believe that rust is not letting me run the code because it believes that the parameter I'm using might go beyond the lens of the array and for this I tried using the <code>get()</code> function:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>array.get(foo).unwrap();\n</code></pre>\n\n<p>however this still doesn't fix my current error.</p>\n\n<p>Sample code to reproduce error:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn example(foo: u32) {\n    let mut array: [u32; 3] = [0,0,0];    \n    array[foo] = 9;\n}\nfn main() {\n    example(1);\n}\n</code></pre>\n\n<p>The program fails to run with the complier giving me the error</p>\n\n<pre><code>array[foo] = 9\n^^^^^^^^^^^^^^ slice indices are of type `usize` or ranges of `usize`\n</code></pre>\n\n<p>This is my first time writing a problem on stack overflow so if i messed the formatting somewhere, sorry.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560088511, "post_id": 56515047, "comment_id": 99616089, "body": "Your immediate problem is that you&#39;ve put <code>From</code> twice, once as a trait and once as a type (see also <a href=\"https://stackoverflow.com/q/50650070/155423\">What does \u201cdyn\u201d mean in a type?</a>). You want just <code>impl&lt;Err&gt; From&lt;Err&gt; for CalendarError where Err: Error</code>. However, <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=b0a6a9e4e42adcd42b0ece979dac0362\" rel=\"nofollow noreferrer\">once you do that</a>, you&#39;ll run into the linked duplicate"}, {"owner": {"reputation": 564, "user_id": 612829, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/wB0H0.jpg?s=128&g=1", "display_name": "Martin Ellison", "link": "https://stackoverflow.com/users/612829/martin-ellison"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560133965, "post_id": 56515047, "comment_id": 99624734, "body": "@Shepmaster Thanks, I followed the linked answers and I have updated the question with my changes to my program."}], "owner": {"reputation": 564, "user_id": 612829, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/wB0H0.jpg?s=128&g=1", "display_name": "Martin Ellison", "link": "https://stackoverflow.com/users/612829/martin-ellison"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 22, "favorite_count": 0, "closed_date": 1560088043, "answer_count": 0, "score": 0, "last_activity_date": 1560135426, "creation_date": 1560087501, "last_edit_date": 1560135426, "question_id": 56515047, "link": "https://stackoverflow.com/questions/56515047/how-to-define-a-generic-type-conversion-for-converting-any-error-to-a-standard-e", "closed_reason": "Duplicate", "title": "How to define a generic type conversion for converting any error to a standard error type?", "body": "<p>I want to convert any error returned from another crate to my own error type so that I can return any error in a <code>Result&lt;X, CalendarError&gt;</code>.</p>\n\n<p>I am trying something like the following</p>\n\n<pre><code>use std::error::Error;\n\nstruct CalendarError {\n    msg: String,\n}\n\nimpl&lt;Err&gt; From&lt;std::convert::From&lt;Err&gt;&gt; for CalendarError\nwhere\n    Err: Error,\n{\n    fn from(err: Err) -&gt; Self {\n        CalendarError {\n            msg: format!(\"error: {}\", err),\n        }\n    }\n}\n</code></pre>\n\n<p>I get compile errors:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: the size for values of type `(dyn std::convert::From&lt;Err&gt; + 'static)` cannot be known at compilation time\n --&gt; src/lib.rs:7:11\n  |\n7 | impl&lt;Err&gt; From&lt;std::convert::From&lt;Err&gt;&gt; for CalendarError\n  |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ doesn't have a size known at compile-time\n  |\n  = help: the trait `std::marker::Sized` is not implemented for `(dyn std::convert::From&lt;Err&gt; + 'static)`\n  = note: to learn more, visit &lt;https://doc.rust-lang.org/book/ch19-04-advanced-types.html#dynamically-sized-types-and-the-sized-trait&gt;\n\nerror[E0038]: the trait `std::convert::From` cannot be made into an object\n --&gt; src/lib.rs:7:11\n  |\n7 | impl&lt;Err&gt; From&lt;std::convert::From&lt;Err&gt;&gt; for CalendarError\n  |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `std::convert::From` cannot be made into an object\n  |\n  = note: the trait cannot require that `Self : Sized`\n</code></pre>\n\n<p>How do I fix this?</p>\n\n<p><em>Edit: I have got it to compile (as advised in the referenced post) by removing the <code>From</code> definition, adding the following:</em></p>\n\n<pre><code>impl CalendarError {\n    fn from_error&lt;Err&gt;(err: Err) -&gt; Self\n    where\n        Err: Error,\n    {\n        CalendarError {\n            msg: format!(\"error: {}\", err),\n        }\n    }\n} \n</code></pre>\n\n<p><em>and then adding the call to <code>map_err</code> to do the conversion explicitly:</em></p>\n\n<pre><code>let u = from_reader(reader).map_err(CalendarError::from_error)?;\n</code></pre>\n"}, {"tags": ["rust", "iterator", "immutability", "lifetime", "ownership"], "comments": [{"owner": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "edited": false, "score": 0, "creation_date": 1560075609, "post_id": 56512951, "comment_id": 99613658, "body": "While the duplicate addresses this issue in the general case, you could just store the current index in <code>current</code> as a <code>usize</code>."}, {"owner": {"reputation": 9958, "user_id": 2188562, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/DMWEc.png?s=128&g=1", "display_name": "Peter Varo", "link": "https://stackoverflow.com/users/2188562/peter-varo"}, "reply_to_user": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "edited": false, "score": 0, "creation_date": 1560077918, "post_id": 56512951, "comment_id": 99614081, "body": "@rodrigo sure, and one could use <code>Box&lt;[u32]&gt;</code> over <code>Vec&lt;[u32]&gt;</code> for the fixed size dynamic array -- which would make this question a dup of another thing.."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 2, "creation_date": 1560091984, "post_id": 56512951, "comment_id": 99616903, "body": "<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=097a52e7794c058d247c5a3597e58c21\" rel=\"nofollow noreferrer\">The duplicates applied to your question</a>"}, {"owner": {"reputation": 2509, "user_id": 3719101, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/Z4L8i.jpg?s=128&g=1", "display_name": "iago-lito &#39;considering leaving", "link": "https://stackoverflow.com/users/3719101/iago-lito-considering-leaving"}, "reply_to_user": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "edited": false, "score": 0, "creation_date": 1560098860, "post_id": 56512951, "comment_id": 99618504, "body": "@rodrigo This was my first idea, but I guess rust iterators and borrow checking are here to prevent us from thinking this way X)"}, {"owner": {"reputation": 2509, "user_id": 3719101, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/Z4L8i.jpg?s=128&g=1", "display_name": "iago-lito &#39;considering leaving", "link": "https://stackoverflow.com/users/3719101/iago-lito-considering-leaving"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560098879, "post_id": 56512951, "comment_id": 99618513, "body": "@Shepmaster I appreciate this much. Thank you :)"}], "owner": {"reputation": 2509, "user_id": 3719101, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/Z4L8i.jpg?s=128&g=1", "display_name": "iago-lito &#39;considering leaving", "link": "https://stackoverflow.com/users/3719101/iago-lito-considering-leaving"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "closed_date": 1560086791, "answer_count": 0, "score": 1, "last_activity_date": 1560086916, "creation_date": 1560067601, "last_edit_date": 1560086916, "question_id": 56512951, "link": "https://stackoverflow.com/questions/56512951/how-can-one-struct-own-both-a-sequence-and-an-iterator-on-the-sequence", "closed_reason": "Duplicate", "title": "How can one struct own both a sequence and an iterator on the sequence?", "body": "<p>I am trying to construct a <code>Defiler</code> struct that owns a fixed sequence and an internal state describing current position within this sequence. The idea is that it can be iterated upon, but sometimes be reset to the beginning of the sequence.</p>\n\n<p>I have picked an iterator as the internal state to represent the current value of the sequence. The idea is that it would be dropped and replaced by a fresh iterator when it's time to reset.</p>\n\n<p>Here is my least fancy naive try so far:</p>\n\n<pre><code>use std::slice::IterMut;\n\nstruct Defiler&lt;'a&gt; {\n    // This sequence should not change during the whole\n    // lifetime of the struct, although I have not expressed it yet.\n    seq: Vec&lt;u32&gt;,\n    // Internal state pointing towards the next element to be\n    // yielded. It will be randomly replaced by a fresh one.\n    current: IterMut&lt;'a, u32&gt;,\n    // ...\n}\n\nimpl&lt;'a&gt; Defiler&lt;'a&gt; {\n\n    fn new(mut seq: Vec&lt;u32&gt;) -&gt; Self {\n        Defiler {\n            seq,\n            current: seq.iter_mut(), // move out of borrowed value, of course.\n        }\n    }\n\n    // Restart the iteration from scratch.\n    fn reset(&amp;'a mut self) {\n        self.current = self.seq.iter_mut();\n    }\n\n    // ...\n\n}\n</code></pre>\n\n<p>I understand why the above does not compile, and I am aware that I have not expressed many things I wish the compiler to be reassured about:</p>\n\n<ul>\n<li>even though its inner values are mutable, <code>seq</code> shall not grow or shrink during the whole lifetime of <code>Defiler</code>.</li>\n<li><code>current</code> will only iterate on owned values in <code>seq</code>, ever.</li>\n<li>=> no dangling iteration can be produced, I'm (quite) sure.</li>\n</ul>\n\n<p>How could I write it?</p>\n"}, {"tags": ["rust", "pattern-matching"], "comments": [{"owner": {"reputation": 3358, "user_id": 852385, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/5c0eac51aaa99541fb966854b5dcb131?s=128&d=identicon&r=PG", "display_name": "Helin Wang", "link": "https://stackoverflow.com/users/852385/helin-wang"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1560044463, "post_id": 56511328, "comment_id": 99609482, "body": "@SergioTulentsev thanks for your reply. Actually RefCell  is unrelated to what I am trying to ask. Removed RefCell to avoid confusion."}], "answers": [{"tags": [], "owner": {"reputation": 46065, "user_id": 234590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/463c0219a51a5d1fd08e1fa280811b57?s=128&d=identicon&r=PG", "display_name": "Francis Gagn&#233;", "link": "https://stackoverflow.com/users/234590/francis-gagn%c3%a9"}, "is_accepted": true, "score": 6, "last_activity_date": 1560045730, "creation_date": 1560045730, "answer_id": 56511436, "question_id": 56511328, "link": "https://stackoverflow.com/questions/56511328/how-does-rust-pattern-matching-determine-if-the-bound-variable-will-be-a-referen/56511436#56511436", "title": "How does Rust pattern matching determine if the bound variable will be a reference or a value?", "body": "<p><a href=\"https://github.com/rust-lang/rfcs/blob/master/text/2005-match-ergonomics.md\" rel=\"noreferrer\">RFC 2005 (a.k.a. <em>match ergonomics</em>)</a> introduced the rule.</p>\n\n<p>Before the change was implemented, there were 2 ways to write this <code>match</code>.</p>\n\n<ol>\n<li><p>Match on <code>self</code> and prefix each pattern with <code>&amp;</code> to \"destructure\" the reference.</p>\n\n<pre><code>fn tail(&amp;self) -&gt; Option&lt;&amp;Foo&gt; {\n    match self {\n        &amp;Cons(_, ref item) =&gt; Some(item),\n        &amp;Nil =&gt; None,\n    }\n}\n</code></pre></li>\n<li><p>Match on <code>*self</code> and don't prefix each pattern with <code>&amp;</code> (because <code>*self</code> is not a reference).</p>\n\n<pre><code>fn tail(&amp;self) -&gt; Option&lt;&amp;Foo&gt; {\n    match *self {\n        Cons(_, ref item) =&gt; Some(item),\n        Nil =&gt; None,\n    }\n}\n</code></pre></li>\n</ol>\n\n<p>Yet, in both cases, we need to write <code>ref item</code>, otherwise we'll get <code>error[E0507]: cannot move out of borrowed content</code>.</p>\n\n<p>However, in the <code>match</code> you've written, the expression being matched is a reference (type <code>&amp;List</code>) but the patterns are not reference patterns (as in 1. above). This is where match ergonomics kick in: the rule says that when a reference is matched with a non-reference pattern, the bindings within that pattern bind by reference rather than by value (i.e. as if they were prefixed with <code>ref</code>). </p>\n"}], "owner": {"reputation": 3358, "user_id": 852385, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/5c0eac51aaa99541fb966854b5dcb131?s=128&d=identicon&r=PG", "display_name": "Helin Wang", "link": "https://stackoverflow.com/users/852385/helin-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 305, "favorite_count": 0, "accepted_answer_id": 56511436, "answer_count": 1, "score": 0, "last_activity_date": 1560089646, "creation_date": 1560043736, "last_edit_date": 1560089646, "question_id": 56511328, "link": "https://stackoverflow.com/questions/56511328/how-does-rust-pattern-matching-determine-if-the-bound-variable-will-be-a-referen", "title": "How does Rust pattern matching determine if the bound variable will be a reference or a value?", "body": "<pre><code>use crate::List::{Cons, Nil};\n\n#[derive(Debug)]\nstruct Foo {}\n\n#[derive(Debug)]\nenum List {\n    Cons(i32, Foo),\n    Nil,\n}\n\nimpl List {\n    fn tail(&amp;self) -&gt; Option&lt;&amp;Foo&gt; {\n        match self {\n            Cons(_, item) =&gt; Some(item), // why `item` is of type `&amp;Foo`?\n            Nil =&gt; None,\n        }\n    }\n}\n</code></pre>\n\n<p>As stated in the comment, why is <code>item</code> of type <code>&amp;Foo</code>? What is the rule that says <code>item</code> will be type <code>&amp;Foo</code> rather than <code>Foo</code>?</p>\n\n<p>I understand that it does not make sense for item to be <code>Foo</code>; <code>&amp;self</code> says <code>self</code> is a reference, so it does not make sense to move a value out of a reference, but are there any specifications that define the rules clearly?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1560069787, "post_id": 56510293, "comment_id": 99612592, "body": "And what did you try, this look like a code request."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560088856, "post_id": 56510293, "comment_id": 99616172, "body": "The code you have provided is not syntactically valid Rust code."}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1560089036, "post_id": 56510924, "comment_id": 99616222, "body": "<a href=\"https://stackoverflow.com/q/28512394/155423\">How to lookup from and insert into a HashMap efficiently?</a>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1560089386, "post_id": 56510924, "comment_id": 99616311, "body": "Your <code>ref</code> is unneeded; you should use <code>unwrap_or_else</code>; there&#39;s no apparent reason to do any cloning. <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=2f2f1aa1b0f239ed08f34018f2f544d1\" rel=\"nofollow noreferrer\">How I&#39;d write it</a>"}, {"owner": {"reputation": 118, "user_id": 1821058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4a939cf31941f655a755052baab75ae?s=128&d=identicon&r=PG", "display_name": "MrFirelord", "link": "https://stackoverflow.com/users/1821058/mrfirelord"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560094063, "post_id": 56510924, "comment_id": 99617353, "body": "Perfect! Thanks a lot."}], "tags": [], "owner": {"reputation": 118, "user_id": 1821058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4a939cf31941f655a755052baab75ae?s=128&d=identicon&r=PG", "display_name": "MrFirelord", "link": "https://stackoverflow.com/users/1821058/mrfirelord"}, "is_accepted": false, "score": 2, "last_activity_date": 1560088936, "last_edit_date": 1560088936, "creation_date": 1560037468, "answer_id": 56510924, "question_id": 56510293, "link": "https://stackoverflow.com/questions/56510293/how-to-group-by-vectors-key/56510924#56510924", "title": "How to group by vector&#39;s key?", "body": "<p>I'm a novice at Rust and this was a challenge for me</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::collections::HashMap;\n\nlet result = docs.iter().fold(\n    HashMap::new(),\n    |mut init: HashMap&lt;String, Vec&lt;String&gt;&gt;, ref item| {\n        for category in &amp;item.categories {\n            let item_body = item.body.clone();\n\n            let new_vector: Vec&lt;String&gt; = init\n                .remove(category)\n                .map(|mut val| {\n                    val.push(item_body.clone());\n                    val\n                })\n                .unwrap_or(vec![item_body.clone()])\n                .to_vec();\n            init.insert(category.clone(), new_vector);\n        }\n\n        init\n    },\n);\n</code></pre>\n\n<p>I'm sure this code can be simplified.</p>\n"}], "owner": {"reputation": 1, "user_id": 11601850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d3d9a818abd9f8f1e258cdddaa57079?s=128&d=identicon&r=PG&f=1", "display_name": "Linca", "link": "https://stackoverflow.com/users/11601850/linca"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 199, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1608767375, "creation_date": 1560029482, "last_edit_date": 1608767375, "question_id": 56510293, "link": "https://stackoverflow.com/questions/56510293/how-to-group-by-vectors-key", "title": "How to group by vector&#39;s key?", "body": "<p>I want to group a vector by key when the key is a vector.</p>\n<pre class=\"lang-rust prettyprint-override\"><code>struct Document {\n    categories: Vec&lt;String&gt;,\n    body: String\n}\n</code></pre>\n<pre class=\"lang-rust prettyprint-override\"><code>let docs = vec![\n    Document {categories: [&quot;rust&quot;.to_string(), body: &quot;doc1&quot;.to_string()]},\n    Document {categories: [&quot;clojure&quot;.to_string()], body: &quot;doc2&quot;.to_string()},\n    Document {categories: [&quot;java&quot;.to_string()], body: &quot;doc3&quot;.to_string()},\n    Document {categories: [&quot;rust&quot;.to_string(), &quot;clojure&quot;.to_string], body: &quot;doc4&quot;.to_string()}\n];\n</code></pre>\n<p>I want to return like below <code>(category_key, documents)</code></p>\n<pre class=\"lang-none prettyprint-override\"><code>&quot;rust&quot; =&gt; [doc1, doc4]  \n&quot;clojure&quot; =&gt; [doc2, doc4]  \n&quot;java&quot; =&gt; [doc3]\n</code></pre>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 2, "creation_date": 1560022025, "post_id": 56508697, "comment_id": 99605952, "body": "You never <i>need</i> to define a function with the same name in Java, you <i>choose</i> to."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 0, "creation_date": 1560022821, "post_id": 56508697, "comment_id": 99606111, "body": "@MatthieuM. In C++, you some time <i>need</i> to use the same name, since you want to use the function in a template for a generic type. This argument does not apply to Rust though."}, {"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "edited": false, "score": 0, "creation_date": 1560026744, "post_id": 56508697, "comment_id": 99606954, "body": "You might find <a href=\"https://stackoverflow.com/questions/42236166/is-it-possible-to-overload-a-function-with-different-numbers-of-arguments-using\">this</a> and <a href=\"https://stackoverflow.com/questions/24936872/how-do-i-use-parameter-overloading-or-optional-parameters-in-rust\">this</a> of interest."}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 1, "creation_date": 1560076347, "post_id": 56508697, "comment_id": 99613802, "body": "@SvenMarnach: Yes, which is why I specified Java. C++ use of overloads for templates is covered by Rust use of traits for generics. Since the OP mentioned Java and not C++, though, I didn&#39;t want to muddy the waters."}], "answers": [{"comments": [{"owner": {"reputation": 473, "user_id": 8800839, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50ab71298e09d7df19b9741966f9af09?s=128&d=identicon&r=PG&f=1", "display_name": "JFFIGK", "link": "https://stackoverflow.com/users/8800839/jffigk"}, "edited": false, "score": 0, "creation_date": 1617715044, "post_id": 56509699, "comment_id": 118377080, "body": "what about overloads with varying amount of arguments?"}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 473, "user_id": 8800839, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50ab71298e09d7df19b9741966f9af09?s=128&d=identicon&r=PG&f=1", "display_name": "JFFIGK", "link": "https://stackoverflow.com/users/8800839/jffigk"}, "edited": false, "score": 0, "creation_date": 1617870660, "post_id": 56509699, "comment_id": 118430552, "body": "@JFFIGK That&#39;s not really possible. You can have identically named functions on different traits, but the compiler won&#39;t automatically pick the right one for you \u2013 you need to use fully qualified syntax to pick the function you want. And macros can be variadic, so maybe that&#39;s an option for your use case."}], "tags": [], "owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "is_accepted": false, "score": 5, "last_activity_date": 1560023930, "creation_date": 1560023930, "answer_id": 56509699, "question_id": 56508697, "link": "https://stackoverflow.com/questions/56508697/why-doesnt-rust-support-overloading-function-or-method/56509699#56509699", "title": "Why doesn&#39;t Rust support overloading function or method?", "body": "<p>I would argue that in some way Rust <em>does</em> have function and method overloading.</p>\n\n<p>Let's say you want to implement an <code>abs()</code> function that can either take an integer or a floating-point number. In C++, you could use</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>int abs(int x) { ... }\ndouble abs(double x) { ... }\n</code></pre>\n\n<p>This will allow to call <code>abs()</code> with either an <code>int</code> or a <code>double</code> as an argument, and the compiler will choose the right implementation for you.</p>\n\n<p>In Rust, you use traits instead. Traits can be implemented on foreign types including standarad types, so this is an adequate replacement:</p>\n\n<pre><code>trait Abs {\n    fn abs(self) -&gt; Self;\n}\n\nimpl Abs for i32 {\n    fn abs(self) -&gt; Self { ... }\n}\n\nimpl Abs for f32 {\n    fn abs(self) -&gt; Self { ... }\n}\n</code></pre>\n\n<p>This will allow you to call <code>x.abs()</code>, where <code>x</code> is either an <code>i32</code> or an <code>f32</code>, and the compiler will choose the right implementation for you.</p>\n\n<p>You are not even limited to having the compiler base the decision on the method receiver alone. If you define a trait parametrized by a type, the compiler will choose the method implementation based on the type of additional parameters:</p>\n\n<pre><code>trait Trait&lt;T&gt; {\n    fn foo(&amp;self, x: T);\n}\n\nstruct Bar;\n\nimpl Trait&lt;i32&gt; for Bar {\n    fn foo(&amp;self, _: i32) {\n        println!(\"i32\");\n    }\n}\n\nimpl Trait&lt;u32&gt; for Bar {\n    fn foo(&amp;self, _: u32) {\n        println!(\"u32\");\n    }\n}\n\nfn main() {\n    Bar.foo(1i32);  // prints \"i32\"\n    Bar.foo(1u32);  // prints \"u32\"\n}\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 7171756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/352606d72f605d48404075f6cc6b849f?s=128&d=identicon&r=PG&f=1", "display_name": "geekoff", "link": "https://stackoverflow.com/users/7171756/geekoff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 350, "favorite_count": 0, "closed_date": 1560029104, "answer_count": 1, "score": 0, "last_activity_date": 1560023930, "creation_date": 1560015236, "question_id": 56508697, "link": "https://stackoverflow.com/questions/56508697/why-doesnt-rust-support-overloading-function-or-method", "closed_reason": "Opinion-based", "title": "Why doesn&#39;t Rust support overloading function or method?", "body": "<p>Method overloading in java is very helpful feature .sometime we need define functions with the same name but with different set of arguments I'm wondering why rust not support this feature ?</p>\n"}, {"tags": ["rust", "borrow-checker", "rc", "borrow", "refcell"], "comments": [{"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 1, "creation_date": 1559999248, "post_id": 56505200, "comment_id": 99600775, "body": "You aren&#39;t only iterating over the structure, you are also trying to mutate it during the iteration. This is a completely different proposition."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560001605, "post_id": 56505200, "comment_id": 99601383, "body": "<i>I need to implement the A* pathfinding algorithm</i> \u2014 no, you don&#39;t; just <a href=\"https://docs.rs/petgraph/0.4.13/petgraph/algo/fn.astar.html\" rel=\"nofollow noreferrer\">use one that&#39;s already been written</a>."}, {"owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560001760, "post_id": 56505200, "comment_id": 99601436, "body": "@Shepmaster People are perfectly at liberty to study and learn whatever they want. And sometimes &quot;not invented here&quot; is not a syndrome but a blessing. This just recently crossed my mind in the context of Julia Flux, which uses &quot;LearningStrategies.jl&quot; package, which is basically a glorified for loop :)"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 0, "creation_date": 1560001811, "post_id": 56505200, "comment_id": 99601448, "body": "@BitTickler I&#39;m responding to the <b>need</b> part of the sentence. If OP <i>wants</i> to do it, I don&#39;t care. It&#39;s just not true that they &quot;need&quot; to implement it."}, {"owner": {"reputation": 324, "user_id": 3367983, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/be5c5325ae21e9fe182562cf4801b79e?s=128&d=identicon&r=PG&f=1", "display_name": "Dandry", "link": "https://stackoverflow.com/users/3367983/dandry"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560001874, "post_id": 56505200, "comment_id": 99601468, "body": "@Shepmaster unfortunately, I cannot. This implementation is part my master&#39;s thesis - the code will be used along with <code>wasm-bindgen</code> and ran in browser."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560001887, "post_id": 56505200, "comment_id": 99601473, "body": "The duplicate <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=da7e6cf2ef82e1881e455d5f6c4ab4e2\" rel=\"nofollow noreferrer\">applied to your question</a>. TL;DR: wrap <code>current_cell</code> in curly braces to clearly transfer ownership of it before overwriting it in the loop."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560001975, "post_id": 56505200, "comment_id": 99601493, "body": "@Dandry you are disallowed from using existing code in your thesis? Why are you allowed to use <code>Vec</code>, <code>Rc</code> or <code>RefCell</code> then? I&#39;d be surprised that petgraph wouldn&#39;t work in Wasm."}, {"owner": {"reputation": 324, "user_id": 3367983, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/be5c5325ae21e9fe182562cf4801b79e?s=128&d=identicon&r=PG&f=1", "display_name": "Dandry", "link": "https://stackoverflow.com/users/3367983/dandry"}, "edited": false, "score": 0, "creation_date": 1560002067, "post_id": 56505200, "comment_id": 99601515, "body": "I am implementing some algorithms (including the abovementioned A*) in JS, C/C++, C# and Rust. The goal is to compare the performance."}, {"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 2, "creation_date": 1560002340, "post_id": 56505200, "comment_id": 99601560, "body": "@Dandry don&#39;t get me wrong but using inappropriate tools of the language may affect the performance, if the main purpose is comparing languages for the same algorithm"}, {"owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 0, "creation_date": 1560002490, "post_id": 56505200, "comment_id": 99601590, "body": "@Dandry May I humbly suggest you also add Haskell to your comparison? Given it is &quot;alien&quot; to any of the other languages, it would make an interesting topic."}, {"owner": {"reputation": 324, "user_id": 3367983, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/be5c5325ae21e9fe182562cf4801b79e?s=128&d=identicon&r=PG&f=1", "display_name": "Dandry", "link": "https://stackoverflow.com/users/3367983/dandry"}, "reply_to_user": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 0, "creation_date": 1560002614, "post_id": 56505200, "comment_id": 99601619, "body": "@&#214;mer Erden This is indeed a very good point, coming from C# I find Rust quite difficult when it comes to managing ownership and references. I also have other algorithms which operate on matrices and their implementation in Rust was easy. I will take your point into account."}, {"owner": {"reputation": 324, "user_id": 3367983, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/be5c5325ae21e9fe182562cf4801b79e?s=128&d=identicon&r=PG&f=1", "display_name": "Dandry", "link": "https://stackoverflow.com/users/3367983/dandry"}, "reply_to_user": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 0, "creation_date": 1560002736, "post_id": 56505200, "comment_id": 99601650, "body": "@BitTickler I wish I had time for this. I picked Rust for it&#39;s well advertised powers to run in browser using <code>wasm-bindgen</code>. And now I struggle with handling structs ;)))"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560003051, "post_id": 56505200, "comment_id": 99601734, "body": "@Dandry piling on to the &quot;bonus suggestions&quot; you are getting, it seems invalid to compare the performance of algorithms between languages that you aren&#39;t proficient in (unless somehow that novice nature is part of the thesis, but that seems to conflate too many topics). For example, I wouldn&#39;t use <code>Rc</code> or <code>RefCell</code> to implement this algorithm at all. If I had to implement it myself and couldn&#39;t use petgraph, I&#39;d use an arena."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560003113, "post_id": 56505200, "comment_id": 99601743, "body": "You may wish to look at other resources. More open-ended questions and discussions are welcome on <a href=\"https://www.reddit.com/r/rust/\" rel=\"nofollow noreferrer\">the Rust subreddit</a>, <a href=\"https://users.rust-lang.org/\" rel=\"nofollow noreferrer\">the Rust users forum</a>, or <a href=\"https://www.rust-lang.org/community\" rel=\"nofollow noreferrer\">the Rust Discord server</a>. You might also get useful feedback by requesting a <a href=\"https://codereview.meta.stackexchange.com/questions/5777/a-guide-to-code-review-for-stack-overflow-users\">code review</a>."}, {"owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 0, "creation_date": 1560003257, "post_id": 56505200, "comment_id": 99601773, "body": "@Dandry I feel you. I gave rust a few spins over the past few years and each time I dropped it again, because it was too much of a diva, distracting me from what I wanted to think about. But Rust is not alone. C++ TMP can also be a distraction, so can too many tiny library dependencies in any language, over having 1 compact implementation. Again my recent flux experience. I kept muttering &quot;nice distraction&quot; each time I got aware of yet another library being in play. It took me 3 days to just find all the &quot;players&quot; lol."}], "owner": {"reputation": 324, "user_id": 3367983, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/be5c5325ae21e9fe182562cf4801b79e?s=128&d=identicon&r=PG&f=1", "display_name": "Dandry", "link": "https://stackoverflow.com/users/3367983/dandry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "closed_date": 1560001821, "answer_count": 0, "score": 1, "last_activity_date": 1560001302, "creation_date": 1559986998, "last_edit_date": 1560001302, "question_id": 56505200, "link": "https://stackoverflow.com/questions/56505200/iterate-over-linked-structs-wrapped-in-rct-and-update-them", "closed_reason": "Duplicate", "title": "Iterate over linked structs wrapped in Rc&lt;T&gt; and update them", "body": "<p>I need to implement the A* pathfinding algorithm in Rust. The algorithm processes particular cells and links with one another using a <code>parent_cell</code> field. In the end, when the destination cell is found, the path is the way from the destination cell to the start cell. I need to capture each cell of the path in a <code>Vec</code>. I have created a simplified piece of code to reflect my issue:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::cell::RefCell;\nuse std::rc::Rc;\n\nstruct AstarCell {\n    parent_cell: Option&lt;Rc&lt;RefCell&lt;AstarCell&gt;&gt;&gt;,\n}\n\nfn main() {\n    let start = Rc::new(RefCell::new(AstarCell { parent_cell: None }));\n    let path_cell_1 = Rc::new(RefCell::new(AstarCell {\n        parent_cell: Some(Rc::clone(&amp;start)),\n    }));\n    let path_cell_2 = Rc::new(RefCell::new(AstarCell {\n        parent_cell: Some(Rc::clone(&amp;path_cell_1)),\n    }));\n    let destination = Rc::new(RefCell::new(AstarCell {\n        parent_cell: Some(Rc::clone(&amp;path_cell_2)),\n    }));\n\n    let mut path_list: Vec&lt;Rc&lt;RefCell&lt;AstarCell&gt;&gt;&gt; = Vec::new();\n\n    let mut current_cell = destination.clone();\n\n    while let Some(parent_cell) = current_cell.borrow().parent_cell {\n        path_list.push(Rc::clone(&amp;parent_cell));\n        current_cell = Rc::clone(&amp;parent_cell);\n    }\n}\n</code></pre>\n\n<p>This does not work, as the borrow checker gets in my way:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0507]: cannot move out of borrowed content\n  --&gt; src/main.rs:24:35\n   |\n24 |     while let Some(parent_cell) = current_cell.borrow().parent_cell {\n   |                    -----------    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n   |                    |              |\n   |                    |              cannot move out of borrowed content\n   |                    |              help: consider borrowing here: `&amp;current_cell.borrow().parent_cell`\n   |                    data moved here\n   |\nnote: move occurs because `parent_cell` has type `std::rc::Rc&lt;std::cell::RefCell&lt;AstarCell&gt;&gt;`, which does not implement the `Copy` trait\n  --&gt; src/main.rs:24:20\n   |\n24 |     while let Some(parent_cell) = current_cell.borrow().parent_cell {\n   |                    ^^^^^^^^^^^\n\nerror[E0506]: cannot assign to `current_cell` because it is borrowed\n  --&gt; src/main.rs:26:9\n   |\n24 |     while let Some(parent_cell) = current_cell.borrow().parent_cell {\n   |                                   ---------------------           - ... and the borrow might be used here, when that temporary is dropped and runs the destructor for type `std::cell::Ref&lt;'_, AstarCell&gt;`\n   |                                   |\n   |                                   borrow of `current_cell` occurs here\n   |                                   a temporary with access to the borrow is created here ...\n25 |         path_list.push(Rc::clone(&amp;parent_cell));\n26 |         current_cell = Rc::clone(&amp;parent_cell);\n   |         ^^^^^^^^^^^^ assignment to borrowed `current_cell` occurs here\n   |\n   = note: The temporary is part of an expression at the end of a block. Consider adding semicolon after the expression so its temporaries are dropped sooner, before the local variables declared by the block are dropped.\n</code></pre>\n\n<p>I tried to play with borrowing using <code>&amp;</code> as the compiler suggests but it feels like it's not the right approach.</p>\n"}, {"tags": ["enums", "rust"], "comments": [{"owner": {"reputation": 95188, "user_id": 440119, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5ec9ca2a92a94a5470396073129d79e7?s=128&d=identicon&r=PG", "display_name": "Benjamin Lindley", "link": "https://stackoverflow.com/users/440119/benjamin-lindley"}, "edited": false, "score": 0, "creation_date": 1560045943, "post_id": 56504289, "comment_id": 99609610, "body": "I certainly wouldn&#39;t want to format my number as a string, just so I can parse it and convert it back to a number. That would be extremely inefficient, and ugly code. The original code is a fine example of the use of Option."}], "answers": [{"tags": [], "owner": {"reputation": 1384, "user_id": 10240085, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HBxgL.jpg?s=128&g=1", "display_name": "Muhammad Naufil", "link": "https://stackoverflow.com/users/10240085/muhammad-naufil"}, "is_accepted": false, "score": 1, "last_activity_date": 1560001203, "last_edit_date": 1560001203, "creation_date": 1559978508, "answer_id": 56504367, "question_id": 56504289, "link": "https://stackoverflow.com/questions/56504289/why-do-we-use-the-option-enum/56504367#56504367", "title": "Why do we use the Option enum?", "body": "<p>Maybe the above example is not a very good example of <code>Option</code>, but the following example shows <code>Option</code> at its very best:</p>\n\n<pre><code>fn main() {\n    let name = String::from(\"naufil\");\n    println!(\n        \"Character at index 6: {}\",\n        match name.chars().nth(6) {\n            Some(c) =&gt; c.to_string(),\n            None =&gt; \"No character at index 6!\".to_string(),\n        }\n    )\n}\n</code></pre>\n\n<p>When we are not sure whether there is a character at 6th element and you don't want your program to crash, <code>Option</code> comes to the rescue. Here is another example from <a href=\"https://doc.rust-lang.org/book/ch06-02-match.html#matching-with-optiont\" rel=\"nofollow noreferrer\"><em>The Rust Programming Language</em></a>: </p>\n\n<blockquote>\n  <pre class=\"lang-rust prettyprint-override\"><code>fn plus_one(x: Option&lt;i32&gt;) -&gt; Option&lt;i32&gt; {\n    match x {\n        None =&gt; None,\n        Some(i) =&gt; Some(i + 1),\n    }\n}\n\nlet five = Some(5);\nlet six = plus_one(five);\nlet none = plus_one(None);\n</code></pre>\n  \n  <p>Listing 6-5: A function that uses a <code>match</code> expression on\n  an <code>Option&lt;i32&gt;</code></p>\n  \n  <p>Let\u2019s examine the first execution of <code>plus_one</code> in more detail. When we call\n  <code>plus_one(five)</code>, the variable <code>x</code> in the body of <code>plus_one</code> will have the\n  value <code>Some(5)</code>. We then compare that against each match arm.</p>\n\n<pre><code>None =&gt; None,\n</code></pre>\n  \n  <p>The <code>Some(5)</code> value doesn\u2019t match the pattern <code>None</code>, so we continue to the\n  next arm.</p>\n\n<pre><code>Some(i) =&gt; Some(i + 1),\n</code></pre>\n  \n  <p>Does <code>Some(5)</code> match <code>Some(i)</code>? Why yes it does! We have the same variant. The\n  <code>i</code> binds to the value contained in <code>Some</code>, so <code>i</code> takes the value <code>5</code>. The\n  code in the match arm is then executed, so we add 1 to the value of <code>i</code> and\n  create a new <code>Some</code> value with our total <code>6</code> inside.</p>\n  \n  <p>Now let\u2019s consider the second call of <code>plus_one</code> in Listing 6-5, where <code>x</code> is\n  <code>None</code>. We enter the <code>match</code> and compare to the first arm.</p>\n\n<pre><code>None =&gt; None,\n</code></pre>\n  \n  <p>It matches! There\u2019s no value to add to, so the program stops and returns the\n  <code>None</code> value on the right side of <code>=&gt;</code>. Because the first arm matched, no other\n  arms are compared.</p>\n  \n  <p>Combining <code>match</code> and enums is useful in many situations. You\u2019ll see this\n  pattern a lot in Rust code: <code>match</code> against an enum, bind a variable to the\n  data inside, and then execute code based on it. It\u2019s a bit tricky at first, but\n  once you get used to it, you\u2019ll wish you had it in all languages. It\u2019s\n  consistently a user favorite.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 11262346, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-RU_WB6YC4j4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re0841AYRrk1qS9kuDy7A0ZDaz_gw/mo/photo.jpg?sz=128", "display_name": "Parker Jones", "link": "https://stackoverflow.com/users/11262346/parker-jones"}, "is_accepted": false, "score": 0, "last_activity_date": 1604118048, "creation_date": 1604118048, "answer_id": 64618378, "question_id": 56504289, "link": "https://stackoverflow.com/questions/56504289/why-do-we-use-the-option-enum/64618378#64618378", "title": "Why do we use the Option enum?", "body": "<p>The reason the <code>Option enum</code> is used for the same reason the <code>Result</code> enum is used. It allows the programmer to see the breadth of returning values they might receive, but without having to dig through code you don't remember all the details about, or have never seen.</p>\n<p><code>Option</code> isn't a special value, it's just an enum, like <code>Result</code>. You could also use something like:</p>\n<pre><code>enum Division_Result {\n    Successful(f64),\n    DividedByZero,\n}\n\nfn divide(numerator: f64, denominator: f64) -&gt; Division_Result {\n    if denominator == 0.0 {\n        Division_Result::DividedByZero\n    } else {\n        Division_Result::Successful(numerator / denominator)\n    }\n}\n</code></pre>\n<p>It just so happens that Optional values are some of the most common types of values that you have to deal with in a program. They're baked the Optional enum into standard because otherwise you would have to deal with everyone coming up with their own <code>enum</code> for the simple concept of an Optional value.</p>\n<p>Returning an <code>enum</code> is an improvement over returning unwrapped magic values because it is more explicit to the programmer that the return value might diverge from what they wanted from the function.</p>\n"}], "owner": {"reputation": 1384, "user_id": 10240085, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HBxgL.jpg?s=128&g=1", "display_name": "Muhammad Naufil", "link": "https://stackoverflow.com/users/10240085/muhammad-naufil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 443, "favorite_count": 0, "answer_count": 2, "score": -15, "last_activity_date": 1604118048, "creation_date": 1559977664, "last_edit_date": 1560000871, "question_id": 56504289, "link": "https://stackoverflow.com/questions/56504289/why-do-we-use-the-option-enum", "title": "Why do we use the Option enum?", "body": "<p>I don't get what the <code>Option</code> enum is for. I read that Rust doesn't have null values. The <code>Option</code> enum is defined like this:</p>\n\n<pre><code>enum Option&lt;T&gt; {\n    Some(T),\n    None,\n}\n</code></pre>\n\n<p>I read its implementation and I came across this example:</p>\n\n<pre><code>fn main() {\n    fn divide(numerator: f64, denominator: f64) -&gt; Option&lt;f64&gt; {\n        if denominator == 0.0 {\n            None\n        } else {\n            Some(numerator / denominator)\n        }\n    }\n\n    // The return value of the function is an option\n    let result = divide(2.0, 3.0);\n\n    // Pattern match to retrieve the value\n    match result {\n        // The division was valid\n        Some(x) =&gt; println!(\"Result: {}\", x),\n        // The division was invalid\n        None =&gt; println!(\"Cannot divide by 0\"),\n    }\n}\n</code></pre>\n\n<p>When they could also do it like this:</p>\n\n<pre><code>fn main() {\n    fn divide(numerator: f64, denominator: f64) -&gt; String {\n        if denominator == 0.0 {\n            format!(\"Can't divide\")\n        } else {\n            let x = numerator / denominator;\n            format!(\"{}\", x)\n        }\n    }\n\n    let result = divide(2.0, 3.0);\n    println!(\"{}\", result);\n}\n</code></pre>\n\n<p>Both programs output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>0.6666666666666666\n</code></pre>\n"}, {"tags": ["rust"], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 11601850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d3d9a818abd9f8f1e258cdddaa57079?s=128&d=identicon&r=PG&f=1", "display_name": "Linca", "link": "https://stackoverflow.com/users/11601850/linca"}, "is_accepted": false, "score": 0, "last_activity_date": 1560001493, "last_edit_date": 1560001493, "creation_date": 1559977217, "answer_id": 56504247, "question_id": 56503809, "link": "https://stackoverflow.com/questions/56503809/how-to-convert-datetimefixedoffset-to-datetimetz/56504247#56504247", "title": "How to convert DateTime&lt;FixedOffset&gt; to DateTime&lt;Tz&gt;", "body": "<p>The <code>with_timezone()</code> method returns <code>DateTime&lt;Tz2&gt;</code></p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>// tz is Asia/Tokyo\n// 2004-02-13                    =&gt; 2004-02-13T00:00:00+09:00\n// 2004-02-13T04:00:00           =&gt; 2004-02-13T04:00:00+09:00\n// 2004-02-13T04:00:00           =&gt; 2004-02-13T04:00:00+09:00\n// 2004-02-13T04:00:00+09:00     =&gt; 2004-02-13T04:00:00+09:00\n// 2004-02-13T04:00:00+10:00     =&gt; 2004-02-13T03:00:00+09:00\nfn local_datetime(s: &amp;str, tz: &amp;str) -&gt; Option&lt;DateTime&lt;Tz&gt;&gt; {\n    let tz: Tz = tz.parse().expect(\"Check your config.json Timezone\");\n    match s.len() {\n        10 =&gt; NaiveDate::parse_from_str(s, \"%Y-%m-%d\")\n            .ok()\n            .and_then(|dt| Some(dt.and_hms(0, 0, 0)))\n            .and_then(|dt| Some(tz.from_local_datetime(&amp;dt).unwrap())),\n        19 =&gt; NaiveDateTime::parse_from_str(s, \"%Y-%m-%dT%H:%M:%S\")\n            .ok()\n            .and_then(|dt| Some(tz.from_local_datetime(&amp;dt).unwrap())),\n        25 =&gt; DateTime::parse_from_rfc3339(s)\n            .ok() // ParseResult&lt;DateTime&lt;FixedOffset&gt;&gt;\n            .and_then(|dt| Some(dt.with_timezone(&amp;tz))),\n        _ =&gt; None,\n    }\n}\n</code></pre>\n\n<pre class=\"lang-rust prettyprint-override\"><code>println!(\n    \"{:?}\",\n    local_datetime(\"2004-02-13T04:00:00+09:00\", \"Asia/Tokyo\")\n);\n// =&gt; Some(2004-02-13T04:00:00JST)\nprintln!(\n    \"{:?}\",\n    local_datetime(\"2004-02-13T04:00:00+09:00\", \"Asia/Taipei\")\n);\n// =&gt; Some(2004-02-13T03:00:00CST)\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11601850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d3d9a818abd9f8f1e258cdddaa57079?s=128&d=identicon&r=PG&f=1", "display_name": "Linca", "link": "https://stackoverflow.com/users/11601850/linca"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 398, "favorite_count": 0, "closed_date": 1560001516, "answer_count": 1, "score": -1, "last_activity_date": 1560001493, "creation_date": 1559972529, "last_edit_date": 1560001428, "question_id": 56503809, "link": "https://stackoverflow.com/questions/56503809/how-to-convert-datetimefixedoffset-to-datetimetz", "closed_reason": "Duplicate", "title": "How to convert DateTime&lt;FixedOffset&gt; to DateTime&lt;Tz&gt;", "body": "<p>I want to return the local time at a timezone using <a href=\"https://github.com/chronotope/chrono\" rel=\"nofollow noreferrer\">chrono</a> and <a href=\"https://github.com/chronotope/chrono-tz\" rel=\"nofollow noreferrer\">chrono-tz</a>. <code>NaiveDate</code> and <code>NaiveDateTime</code> can be converted to <code>DateTime&lt;Tz&gt;</code>, but I can't convert <code>DateTime&lt;FixedOffset&gt;</code> to <code>DateTime&lt;Tz&gt;</code>.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>// tz is Asia/Tokyo\n// 2004-02-13                    =&gt; 2004-02-13T00:00:00+09:00\n// 2004-02-13T04:00:00           =&gt; 2004-02-13T04:00:00+09:00\n// 2004-02-13T04:00:00           =&gt; 2004-02-13T04:00:00+09:00\n// 2004-02-13T04:00:00+09:00     =&gt; 2004-02-13T04:00:00+09:00\n// 2004-02-13T04:00:00+10:00     =&gt; 2004-02-13T03:00:00+09:00\nfn local_datetime(s: &amp;str, tz: &amp;str) -&gt; Option&lt;DateTime&lt;Tz&gt;&gt; {\n    let tz: Tz = tz.parse().expect(\"Check your config.json Timezone\");\n    match s.len() {\n        10 =&gt; NaiveDate::parse_from_str(s, \"%Y-%m-%d\")\n            .ok()\n            .and_then(|dt| Some(dt.and_hms(0, 0, 0)))\n            .and_then(|dt| Some(tz.from_local_datetime(&amp;dt).unwrap())),\n        19 =&gt; NaiveDateTime::parse_from_str(s, \"%Y-%m-%dT%H:%M:%S\")\n            .ok()\n            .and_then(|dt| Some(tz.from_local_datetime(&amp;dt).unwrap())),\n        25 =&gt; DateTime::parse_from_rfc3339(s), // ParseResult&lt;DateTime&lt;FixedOffset&gt;&gt;\n\n        _ =&gt; None,\n    }\n}\n</code></pre>\n"}, {"tags": ["rust", "borrow-checker", "borrowing"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559958832, "post_id": 56502730, "comment_id": 99594336, "body": "My recommended solution from the duplicates: <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=2153a80f000de253a91452c2eb2abb56\" rel=\"nofollow noreferrer\">create more structs</a>. Effectively the concept of moving the functions out of <code>World</code> but putting them into new structs instead of being bare."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559959028, "post_id": 56502730, "comment_id": 99594358, "body": "For what it&#39;s worth, all 3 of your solutions are the same: The compiler can know that fields of a struct are disjoint and wont overlap, but only inside of a single function. This is deliberate and not a thing to be &quot;fixed&quot; in the future (as discussed in the duplicates). Inlining code (using a macro or not) moves it into a single function, so the compiler can validate the code. Creating fine-grained functions does the same in the other direction: if you only pass in a part of your struct, there&#39;s no way that other fields could be modified."}, {"owner": {"reputation": 709, "user_id": 2043830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60a17dceb6a0f9fe6e07b83e0b844d44?s=128&d=identicon&r=PG", "display_name": "matias.g.rodriguez", "link": "https://stackoverflow.com/users/2043830/matias-g-rodriguez"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559959669, "post_id": 56502730, "comment_id": 99594424, "body": "Thanks @Shepmaster, I appreciate your time for pointing out the duplicates and suggesting me the solution in create_more_structs. I will need some time to go through all of this."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559960285, "post_id": 56502730, "comment_id": 99594483, "body": "You are quite welcome. I commend you for correctly identifying the core &quot;workaround&quot;. I&#39;m a Rust fanboy, but I honestly think that the smaller structs that I create in these cases helps my code have a better structure."}], "owner": {"reputation": 709, "user_id": 2043830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60a17dceb6a0f9fe6e07b83e0b844d44?s=128&d=identicon&r=PG", "display_name": "matias.g.rodriguez", "link": "https://stackoverflow.com/users/2043830/matias-g-rodriguez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 148, "favorite_count": 0, "closed_date": 1559958215, "answer_count": 0, "score": 1, "last_activity_date": 1559958477, "creation_date": 1559957567, "last_edit_date": 1559958157, "question_id": 56502730, "link": "https://stackoverflow.com/questions/56502730/what-options-are-available-to-manage-the-error-cannot-borrow-self-as-mutable", "closed_reason": "Duplicate", "title": "What options are available to manage the error &quot;cannot borrow `*self` as mutable/immutable&quot;?", "body": "<p>This question is not about why the compiler gives these errors \u2014 I think I understand that. This question is about how to manage the situation on the mutable path while hoping to be able to call other functions.</p>\n\n<p>This is a simplification of what I am trying to do. I have a lot of <code>Foo</code>s inside <code>World</code> and I need to update them based on other data from <code>World</code>. I have several private functions inside <code>World</code> that I would like to be able to call.</p>\n\n<pre><code>pub struct Foo {\n    id: i32,\n    //...\n}\n\npub struct Bar {\n    //...\n}\n\npub struct World {\n    foos: Vec&lt;Foo&gt;,\n    bars: Vec&lt;Bar&gt;,\n    //...\n}\n\nimpl World {\n\n    pub fn create() -&gt; World {\n        World {\n            foos: Vec::new(),\n            bars: Vec::new(),\n        }\n    }\n\n    pub fn update(&amp;mut self) {\n        for foo in self.get_foos_mut() {\n            //error[E0XXX]: cannot borrow `*self` as mutable/imutable ...\n            let _bar = self.get_bar_given_foo(foo);\n            //alter foo based on bar and other world things calling other world functions...\n            //...\n        }\n    }\n\n    //some useful utility functions that should be called several times\n    //from different World places...\n\n    fn get_foos_mut(&amp;mut self) -&gt; &amp;mut [Foo] {\n        //select slice interval based on foos or any other calculation using self data...\n        &amp;mut self.foos[..]\n    }\n\n    fn get_bar_given_foo(&amp;self, foo: &amp;Foo) -&gt; &amp;Bar {\n        //select bar based on foo or any other calculation using self data...\n        &amp;self.bars[foo.id as usize]\n    }\n\n    //other utility functions that abstract e sequence of operations that I would \n    //like to use on the update path...    \n}\n\nfn main() {\n    let mut world = World::create();\n    world.update();\n}\n</code></pre>\n\n<p>You can also <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=142a3f98477f6bb18b86a1a1445c83d2\" rel=\"nofollow noreferrer\">run the code</a>.</p>\n\n<p>It looks a very limiting situation because when on a mutable path like the <code>update</code> function, I am unable to call any of the private methods from <code>self</code>.</p>\n\n<p>Since I don't want to clone all the data, I could think of three solutions. I tried 1 and 2 and both work.</p>\n\n<ol>\n<li><p><strong>Inline everything</strong>. Since this solution works for the example above, it looks like the compilation error is caused by the limitation of the Rust compiler that as I understand: it just looks the function signature and not the implementation of the functions.</p></li>\n<li><p><strong>Create functions that receive references to what they need</strong>. There is no need borrow <code>self</code> again. The function <code>World::get_foos_mut(&amp;mut self) -&gt; &amp;mut [Foo]</code> could be removed and created a new one outside <code>World</code>: <code>fn world_get_foos_mut(foos: &amp;mut Vec&lt;Foo&gt;) -&gt; &amp;mut [Foo]</code> The code on the <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=142a3f98477f6bb18b86a1a1445c83d2\" rel=\"nofollow noreferrer\">playground</a> shows this solution. </p></li>\n<li><p><strong>Create macros instead of regular functions?</strong> Since they are macros I suspect that there won't be any borrow involved. Since I am not familiar with macros I am unable to tell if this works or how to do this yet.</p></li>\n</ol>\n\n<p>I really need other options because Solution 1 is not viable in my opinion and solution 2 looks very cumbersome and fragile (it looks that I might have the same problems but with the references inside <code>World</code>).</p>\n\n<p>I am really frustrated about not being able to find the correct model to handle this.</p>\n\n<p>Will the Rust compiler try to analyze these situations in the future?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560002197, "post_id": 56502350, "comment_id": 99601541, "body": "Please make sure to update the <i>title</i> of your post when updating the content."}], "answers": [{"comments": [{"owner": {"reputation": 49, "user_id": 10922157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e04e1786a93c727df1eb3fe66a5ad755?s=128&d=identicon&r=PG&f=1", "display_name": "Rusty_Wolf", "link": "https://stackoverflow.com/users/10922157/rusty-wolf"}, "edited": false, "score": 0, "creation_date": 1559995612, "post_id": 56505688, "comment_id": 99599891, "body": "You are awesome! Thank you!"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 1, "last_activity_date": 1560002218, "last_edit_date": 1560002218, "creation_date": 1559991290, "answer_id": 56505688, "question_id": 56502350, "link": "https://stackoverflow.com/questions/56502350/using-plotlib-to-create-a-svg-fails-with-invalid-y-range/56505688#56505688", "title": "Using plotlib to create a SVG fails with &quot;invalid y_range&quot;", "body": "<p>Your <em>view</em> is empty. Therefore, there is nothing to plot and the boundaries for the SVG are in their initial invalid state.</p>\n\n<p>You have to add the <code>BarChart</code> to your <code>CategoricalView</code> and <strong>then</strong> use that view on a page, for example:</p>\n\n<pre><code>let mut data = Vec::new();\n\nfor (ch, count) in &amp;count {\n    println!(\"{:?}: {}\", ch, count);\n    let count = *count as f64;\n    data.push(plotlib::barchart::BarChart::new(count).label(ch.to_string()));\n}\n\n// Add data to the view\nlet v = data\n    .iter()\n    .fold(plotlib::view::CategoricalView::new(), |view, datum| {\n        view.add(datum)\n    });\n\nplotlib::page::Page::single(&amp;v)\n    .save(\"barchart.svg\")\n    .expect(\"saving svg\");\n</code></pre>\n"}], "owner": {"reputation": 49, "user_id": 10922157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e04e1786a93c727df1eb3fe66a5ad755?s=128&d=identicon&r=PG&f=1", "display_name": "Rusty_Wolf", "link": "https://stackoverflow.com/users/10922157/rusty-wolf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1560002218, "creation_date": 1559951750, "last_edit_date": 1560002147, "question_id": 56502350, "link": "https://stackoverflow.com/questions/56502350/using-plotlib-to-create-a-svg-fails-with-invalid-y-range", "title": "Using plotlib to create a SVG fails with &quot;invalid y_range&quot;", "body": "<p>I am trying to count the letters in a message and export them to an image.</p>\n\n<p>I've successfully created a <code>BTreeMap</code> with the letters and counted them. What I'm having trouble with is exporting them to an SVG with plotlib. I am open to using other libraries but I feel like my issue is with using the library more than the library itself.</p>\n\n<p>Here's my code for the counter</p>\n\n<p><strong>Cargo.toml</strong></p>\n\n<pre><code>[dependencies]\nplotlib = \"0.4.0\"\n</code></pre>\n\n<p><strong>main.rs</strong></p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::collections::btree_map::BTreeMap;\n\nuse plotlib::style::BarChart;\n\nfn main() {\n    let message: &amp;str = \"This is a long message\";\n    let mut count = BTreeMap::new();\n\n    for c in message.trim().to_lowercase().chars() {\n        if c.is_alphabetic() {\n            *count.entry(c).or_insert(0) += 1\n        }\n    }\n\n    println!(\"Number of occurences per character\");\n    for (ch, count) in &amp;count {\n        println!(\"{:?}: {}\", ch, count);\n        let count = *count as f64;\n        plotlib::barchart::BarChart::new(count).label(ch.to_string());\n    }\n    let v = plotlib::view::CategoricalView::new();   \n    plotlib::page::Page::single(&amp;v)\n        .save(\"barchart.svg\")\n        .expect(\"saving svg\");\n}\n</code></pre>\n\n<p>I expected this program to produce an SVG with the data in it, but thread main panics</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Number of occurences per character\n'a': 2\n'e': 2\n'g': 2\n'h': 1\n'i': 2\n'l': 1\n'm': 1\n'n': 1\n'o': 1\n's': 4\n't': 1\nthread 'main' panicked at 'saving svg: ErrorMessage { msg: \"invalid y_range: Range { lower: inf, upper: -inf }\" }', src/libcore/result.rs:997:5\nnote: Run with `RUST_BACKTRACE=1` environment variable to display a backtrace.\n</code></pre>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1560005229, "post_id": 56501746, "comment_id": 99602227, "body": "If you use <code>Path</code> instead of <code>PathBuf</code>, your code works more or less unchanged. (You just need ot use <code>Path::new</code> instead of <code>PathBuf::from</code>.)"}, {"owner": {"reputation": 577, "user_id": 1075870, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5ee326c803355a02b32c266c5830a167?s=128&d=identicon&r=PG", "display_name": "otm", "link": "https://stackoverflow.com/users/1075870/otm"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1560066120, "post_id": 56501746, "comment_id": 99611993, "body": "Hmm... yes, <code>Path</code> works. But I am wondering why <code>Path</code> doesn&#39;t have the same ownership problem?"}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1560108914, "post_id": 56501746, "comment_id": 99620920, "body": "Because <code>Path</code> doesn&#39;t own the data in the first place \u2013 it borrows it from the original string. <code>Path::new()</code> actually returns a <i>reference</i> to a Path, borrowing the orignal data. As a shared reference, <code>&amp;Path</code> is <code>Copy</code>, so it can be consumed more than once. Creating a new <code>PathBuf</code>, on the other hand, creates a new owned copy of the original string."}], "answers": [{"tags": [], "owner": {"reputation": 29810, "user_id": 423170, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/H9kNQ.png?s=128&g=1", "display_name": "Frxstrem", "link": "https://stackoverflow.com/users/423170/frxstrem"}, "is_accepted": true, "score": 1, "last_activity_date": 1559946439, "last_edit_date": 1559946439, "creation_date": 1559945925, "answer_id": 56501806, "question_id": 56501746, "link": "https://stackoverflow.com/questions/56501746/how-do-i-use-a-value-after-calling-optionmap/56501806#56501806", "title": "How do I use a value after calling Option::map?", "body": "<p>If the closure in <code>.map(...)</code> (or any similar functions on an <code>Option</code>) doesn't need ownership of the value in the option (i.e. it only needs a reference to the value), you can always use <a href=\"https://doc.rust-lang.org/std/option/enum.Option.html#method.as_ref\" rel=\"nofollow noreferrer\"><code>option.as_ref()</code></a> or <a href=\"https://doc.rust-lang.org/std/option/enum.Option.html#method.as_mut\" rel=\"nofollow noreferrer\"><code>option.as_mut()</code></a> to turn an <code>&amp;Option&lt;T&gt;</code> or <code>&amp;mut Option&lt;T&gt;</code> into an <code>Option&lt;&amp;T&gt;</code> or <code>Option&lt;&amp;mut T&gt;</code>. Then calling <code>.map()</code> will not take ownership because references are copyable, so it's just copied into the provided closure.</p>\n\n<p>With this in mind, your code would be modified to be this:</p>\n\n<pre><code>fn it_works() {\n    let path_str = Some(\"/tmp/abc\");\n    let path = path_str.map(|s| PathBuf::from(s));\n    if !path.as_ref().map_or(false, |p| p.is_dir()) {\n        //  ^^^^^^^^^ using .as_ref() here\n        //                          ^^^ now p is a '&amp;PathBuf' instead of 'PathBuf'\n\n        match path {\n        //    ^^^^ we didn't take ownership so compiler doesn't complain here\n\n            Some(p) =&gt; println!(\"The folder {:?} is not a directory!\", p),\n            None =&gt; println!(\"The repository folder is not set!\"),\n        }\n        return;\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1291, "user_id": 6331045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/189f94db303d16b891800f11846bd753?s=128&d=identicon&r=PG&f=1", "display_name": "Laney", "link": "https://stackoverflow.com/users/6331045/laney"}, "is_accepted": false, "score": 1, "last_activity_date": 1559976782, "creation_date": 1559976782, "answer_id": 56504198, "question_id": 56501746, "link": "https://stackoverflow.com/questions/56501746/how-do-i-use-a-value-after-calling-optionmap/56504198#56504198", "title": "How do I use a value after calling Option::map?", "body": "<p><code>PathBuf</code> implements <code>FromStr</code> trait, so you can use it, in combination with powerful pattern matching.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn it_works() {\n    use std::path::*;\n    use std::str::FromStr;\n\n    let path_str: Option&lt;&amp;str&gt; = Some(\"/tmp/abc\");\n    match path_str.map(PathBuf::from_str) {\n        Some(Ok(p)) =&gt; if !p.is_dir() {},\n        Some(Err(e)) =&gt; {}\n        None =&gt; {}\n    };\n}\n</code></pre>\n"}], "owner": {"reputation": 577, "user_id": 1075870, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5ee326c803355a02b32c266c5830a167?s=128&d=identicon&r=PG", "display_name": "otm", "link": "https://stackoverflow.com/users/1075870/otm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 56501806, "answer_count": 2, "score": 0, "last_activity_date": 1559976782, "creation_date": 1559945331, "last_edit_date": 1559954589, "question_id": 56501746, "link": "https://stackoverflow.com/questions/56501746/how-do-i-use-a-value-after-calling-optionmap", "title": "How do I use a value after calling Option::map?", "body": "<p>I am trying to:</p>\n\n<ol>\n<li>Get an <code>Option&lt;&amp;str&gt;</code> from somewhere, and build a <code>PathBuf</code> from it.</li>\n<li>If <code>None</code>, print some message, and return.</li>\n<li>If the path is not a directory, print a message saying the path is not a directory, and return. </li>\n<li>If everything is good, continue the program.</li>\n</ol>\n\n\n\n<pre><code>use std::path::PathBuf;\n\nfn it_works() {\n    let path_str = Some(\"/tmp/abc\");\n    let path = path_str.map(|s| PathBuf::from(s));\n    if !path.map_or(false, |p| p.is_dir()) {\n        match path {\n            Some(p) =&gt; println!(\"The folder {:?} is not a directory!\", p),\n            None =&gt; println!(\"The repository folder is not set!\"),\n        }\n        return;\n    }\n}\n</code></pre>\n\n<p>The pattern matching in the above snippet doesn't work because the value has been moved in the <code>map_or</code> combinator:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0382]: use of moved value\n --&gt; src/lib.rs:8:18\n  |\n5 |     let path = path_str.map(|s| PathBuf::from(s));\n  |         ---- move occurs because `path` has type `std::option::Option&lt;std::path::PathBuf&gt;`, which does not implement the `Copy` trait\n6 |     if !path.map_or(false, |p| p.is_dir()) {\n  |         ---- value moved here\n7 |         match path {\n8 |             Some(p) =&gt; println!(\"The folder {:?} is not a directory!\", p),\n  |                  ^ value used here after move\n</code></pre>\n\n<p>I can do something like this, but it doesn't feel very \"idiomatic\" because of the <code>unwrap</code> and multiple <code>if</code> clauses:</p>\n\n<pre><code>let path_str = Some(\"/tmp/abc\");\nlet path = path_str.map(|s| PathBuf::from(s));\nif path.is_none() {\n    println!(\"The repository folder is not set!\");\n    return;\n}\nlet p = path.unwrap();\nif !p.is_dir() {\n    println!(\"The folder {:?} is not a directory!\", p);\n}\n</code></pre>\n\n<p>Could there be a better to solve this?</p>\n"}, {"tags": ["rust", "rc", "borrow", "refcell"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1559943802, "post_id": 56501086, "comment_id": 99592146, "body": "I finished the rust book only today and I might be talking out of my rear end buuuuut why not do most of this through the mutable borrow? <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=23262d5064ae43e2abd533bc3c38f57f\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 9958, "user_id": 2188562, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/DMWEc.png?s=128&g=1", "display_name": "Peter Varo", "link": "https://stackoverflow.com/users/2188562/peter-varo"}, "is_accepted": true, "score": 2, "last_activity_date": 1559957038, "last_edit_date": 1559957038, "creation_date": 1559951892, "answer_id": 56502362, "question_id": 56501086, "link": "https://stackoverflow.com/questions/56501086/is-there-any-way-to-borrow-a-refcell-immutably-and-mutably-at-the-same-time/56502362#56502362", "title": "Is there any way to borrow a RefCell immutably and mutably at the same time?", "body": "<p>I have no idea what you are actually trying to achieve as you have failed to provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>, but I think you just mixed up the borrows of the <code>list</code> and the <code>item</code> in your data structure and that confused you in the first place.</p>\n\n<p>Nonetheless the following code (which you can run in the <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=360fae1f304e8cd011000485b235e287\" rel=\"nofollow noreferrer\">playground</a>) does what you have described above.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::{cell::RefCell, rc::Rc};\n\npub fn foo() {\n    let list = Rc::new(RefCell::new(Vec::new()));\n    let mut list = list.borrow_mut();\n\n    let item = Rc::new(RefCell::new(String::from(\"ABC\")));\n\n    list.push(item);\n    println!(\"list: {:?}\", list);\n\n    while let Some(item) = list.pop() {\n        println!(\"item: {:?}\", item);\n        item.borrow_mut().push_str(\"DEF\");\n        println!(\"item: {:?}\", item);\n    }\n\n    println!(\"list: {:?}\", list);\n}\n\nfn main() {\n    foo();\n}\n</code></pre>\n\n<p>There are two tricks which I used here.</p>\n\n<ol>\n<li><p>I borrowed the <code>list</code> only once and that borrow was a mutable one, which allowed me to add and remove items from it.</p></li>\n<li><p>Because your description said you want to remove the items from the <code>list</code> anyway, I was able to iterate over the <code>Vec</code> with the <code>pop</code> or the <code>remove</code> methods (depending on the order you wish to get the items from the <code>list</code>).  This means I didn't have to borrow the <code>Vec</code> for the scope of the loop (which you would otherwise do if you would iterate over it).</p></li>\n</ol>\n\n<p>There are other ways to remove an element based on some predicate. For example: <a href=\"https://stackoverflow.com/questions/37792471\">Removing elements from a Vec based on some condition</a>.</p>\n\n<p>To actually answer your original question: there is no way to have an immutable and a mutable borrow at the same time safely.  That is one of the core principles of Rust which makes it memory safe.  Think about it, what kind of guarantee would immutability be if at the same time, under the hood, the data could actually change?</p>\n"}], "owner": {"reputation": 324, "user_id": 3367983, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/be5c5325ae21e9fe182562cf4801b79e?s=128&d=identicon&r=PG&f=1", "display_name": "Dandry", "link": "https://stackoverflow.com/users/3367983/dandry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 293, "favorite_count": 0, "accepted_answer_id": 56502362, "answer_count": 1, "score": 1, "last_activity_date": 1559957038, "creation_date": 1559940703, "last_edit_date": 1559954226, "question_id": 56501086, "link": "https://stackoverflow.com/questions/56501086/is-there-any-way-to-borrow-a-refcell-immutably-and-mutably-at-the-same-time", "title": "Is there any way to borrow a RefCell immutably and mutably at the same time?", "body": "<p>I have a piece of code which needs to operate on a list. This list contains items which come from another source and need to be processed and eventually removed. The list is also passed along to multiple functions which decide whether to add or remove an item. I created an example code which reflects my issue:</p>\n\n<pre><code>use std::{cell::RefCell, rc::Rc};\n\npub fn foo() {\n    let list: Rc&lt;RefCell&lt;Vec&lt;Rc&lt;RefCell&lt;String&gt;&gt;&gt;&gt;&gt; = Rc::new(RefCell::new(Vec::new()));\n\n    list.borrow_mut()\n        .push(Rc::new(RefCell::new(String::from(\"ABC\"))));\n\n    while list.borrow().len() &gt; 0 {\n        let list_ref = list.borrow();\n\n        let first_item = list_ref[0].borrow_mut();\n        //item processing, needed as mutable\n\n        list.borrow_mut().remove(0);\n    }\n}\n</code></pre>\n\n<p>This panics at runtime:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>thread 'main' panicked at 'already borrowed: BorrowMutError', src/libcore/result.rs:997:5\n</code></pre>\n\n<p>I think I understand the problem: I have two immutable borrows and then a third which is mutable. According to the Rust docs, this is not allowed: either many immutable borrows or a single mutable one. Is there any way to get around this issue?</p>\n"}, {"tags": ["rust", "slice", "ownership"], "comments": [{"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1559938241, "post_id": 56500538, "comment_id": 99590549, "body": "This seems like mostly an aesthetic problem. I would probably define a newtype for the <code>vec</code> and provide a method <code>block()</code> on it that returns the first block. Whether you consider this worth the trouble depends on how much you care."}, {"owner": {"reputation": 173, "user_id": 3259459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dd017478375b2a025df02e771397eaf1?s=128&d=identicon&r=PG", "display_name": "Felipe Jacob", "link": "https://stackoverflow.com/users/3259459/felipe-jacob"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1559939378, "post_id": 56500538, "comment_id": 99590915, "body": "But how could I make this method return something that I can edit, and whose edits have effect on the original vector, without &quot;blocking&quot; the original vector with a mutable borrow?"}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 1, "creation_date": 1559939477, "post_id": 56500538, "comment_id": 99590948, "body": "You would simply use <code>v.block()</code> wherever you have <code>block</code> now. This will create a new borrow in each <code>do_stuff()</code> call, which will be dropped by the end of the expression."}], "owner": {"reputation": 173, "user_id": 3259459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dd017478375b2a025df02e771397eaf1?s=128&d=identicon&r=PG", "display_name": "Felipe Jacob", "link": "https://stackoverflow.com/users/3259459/felipe-jacob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1560127836, "creation_date": 1559937321, "last_edit_date": 1560127836, "question_id": 56500538, "link": "https://stackoverflow.com/questions/56500538/how-can-i-give-names-to-rust-slices-without-taking-ownership", "title": "How can I give names to Rust slices without taking ownership?", "body": "<p>In the context of a crypto problem, to decrease verbosity, I'm \"naming\" a slice of <code>v</code> as <code>block</code>, doing some stuff to it, but then trying to verify the result of <code>do_stuff</code> on the <strong>whole</strong> of <code>v</code>: </p>\n\n<pre><code>fn x() {\n    let mut v = vec![0; 32];\n    let block = &amp;mut v[0..16];\n\n    do_stuff(block);\n    check_stuff(&amp;v);\n    do_stuff(block);\n}\n\nfn do_stuff(_: &amp;mut [i32]) {}\nfn check_stuff(_: &amp;[i32]) {}\n</code></pre>\n\n<p>The borrow checker complains:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0502]: cannot borrow `v` as immutable because it is also borrowed as mutable\n --&gt; src/lib.rs:6:17\n  |\n3 |     let block = &amp;mut v[0..16];\n  |                      - mutable borrow occurs here\n...\n6 |     check_stuff(&amp;v);\n  |                 ^^ immutable borrow occurs here\n7 |     do_stuff(block);\n  |              ----- mutable borrow later used here\n</code></pre>\n\n<p>I'm aware of the kind of guarantee this is trying to provide. However, assuming I know what I'm doing, is there an idiomatic way to give a name to the slice without having to use <code>do_stuff(&amp;mut v[0..16])</code> or having to make copies every time?</p>\n"}, {"tags": ["types", "rust", "code-reuse"], "answers": [{"tags": [], "owner": {"reputation": 9958, "user_id": 2188562, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/DMWEc.png?s=128&g=1", "display_name": "Peter Varo", "link": "https://stackoverflow.com/users/2188562/peter-varo"}, "is_accepted": false, "score": 2, "last_activity_date": 1559956540, "last_edit_date": 1559956540, "creation_date": 1559955231, "answer_id": 56502583, "question_id": 56500357, "link": "https://stackoverflow.com/questions/56500357/how-do-i-reuse-code-for-similar-yet-distinct-types-in-rust/56502583#56502583", "title": "How do I reuse code for similar yet distinct types in Rust?", "body": "<p>There are several ways to deal with this kind of problem.  The following solution is using the so-called <em>newtype</em> pattern, a unified trait for the object the newtype contains and a trait implementation for the newtype.</p>\n\n<p>(Explanation is going to be inline, but if you'd like to see the code as a whole and at the same time test it then go to the <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=599370064fb7123b8e22ef5e9d58c96e\" rel=\"nofollow noreferrer\">playground</a>.)</p>\n\n<p>First, we create a trait that describes the minimal behaviour we'd like to see from an identifier.  In Rust you don't have inheritance, you have composition, i.e. an object can implement any number of traits which will describe its behaviour.  If you'd like to have something that is common in all your objects \u2014 which you would achieve via inheritance \u2014 then you have to implement the same trait for them.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::fmt;\n\ntrait Identifier {\n    fn value(&amp;self) -&gt; &amp;str;\n}\n</code></pre>\n\n<p>Then we create a newtype which contains a single value which is a generic type that is constrained to implement our <code>Identifier</code> trait.  The great thing about this pattern is that it will actually be optimised by the compiler at the end.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct Id&lt;T: Identifier&gt;(T);\n</code></pre>\n\n<p>Now that we have a concrete type, we implement the <code>Display</code> trait for it.  Since <code>Id</code>'s internal object is an <code>Identifier</code>, we can call the <code>value</code> method on it so we only have to implement this trait once.</p>\n\n<pre><code>impl&lt;T&gt; fmt::Display for Id&lt;T&gt;\nwhere\n    T: Identifier,\n{\n    fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -&gt; fmt::Result {\n        write!(f, \"{}\", self.0.value())\n    }\n}\n</code></pre>\n\n<p>The followings are definitions of different identifier types and their <code>Identifier</code> trait implementations:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct MyIdentifier(String);\n\nimpl Identifier for MyIdentifier {\n    fn value(&amp;self) -&gt; &amp;str {\n        self.0.as_str()\n    }\n}\n\nstruct MyUserIdentifier {\n    value: String,\n    user: String,\n}\n\nimpl Identifier for MyUserIdentifier {\n    fn value(&amp;self) -&gt; &amp;str {\n        self.value.as_str()\n    }\n}\n</code></pre>\n\n<p>And last but not least, this is how you would use them:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn main() {\n    let mid = Id(MyIdentifier(\"Hello\".to_string()));\n    let uid = Id(MyUserIdentifier {\n        value: \"World\".to_string(),\n        user: \"Cybran\".to_string(),\n    });\n\n    println!(\"{}\", mid);\n    println!(\"{}\", uid);\n}\n</code></pre>\n\n<p>The <code>Display</code> was easy, however I don't think you could unify the <code>FromStr</code>, as my example above demonstrates it is very likely that the different identifiers have different fields not just the <code>value</code> (to be fair, some don't even have the <code>value</code>, after all, the <code>Identifier</code> trait only requires the object to implement a method called <code>value</code>).  And semantically the <code>FromStr</code> supposed to construct a new instance from a string.  Therefore I would implement <code>FromStr</code> for all types separately.</p>\n"}, {"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 4, "last_activity_date": 1559957804, "creation_date": 1559957804, "answer_id": 56502743, "question_id": 56500357, "link": "https://stackoverflow.com/questions/56500357/how-do-i-reuse-code-for-similar-yet-distinct-types-in-rust/56502743#56502743", "title": "How do I reuse code for similar yet distinct types in Rust?", "body": "<p>Use a <a href=\"https://doc.rust-lang.org/std/marker/struct.PhantomData.html\" rel=\"nofollow noreferrer\"><code>PhantomData</code></a> to add a type parameter to your <code>Identifier</code>. This allows you to \"brand\" a given identifier:</p>\n\n<pre><code>use std::{fmt, marker::PhantomData, str::FromStr};\n\npub struct Identifier&lt;K&gt; {\n    value: String,\n    _kind: PhantomData&lt;K&gt;,\n}\n\nimpl&lt;K&gt; fmt::Display for Identifier&lt;K&gt; {\n    fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -&gt; fmt::Result {\n        write!(f, \"{}\", self.value)\n    }\n}\n\nimpl&lt;K&gt; FromStr for Identifier&lt;K&gt; {\n    type Err = ();\n\n    fn from_str(s: &amp;str) -&gt; Result&lt;Self, Self::Err&gt; {\n        Ok(Identifier {\n            value: s.to_string(),\n            _kind: PhantomData,\n        })\n    }\n}\n\nstruct User;\nstruct Group;\n\nfn main() {\n    let u_id: Identifier&lt;User&gt; = \"howdy\".parse().unwrap();\n    let g_id: Identifier&lt;Group&gt; = \"howdy\".parse().unwrap();\n\n    // do_group_thing(&amp;u_id); // Fails\n    do_group_thing(&amp;g_id);\n}\n\nfn do_group_thing(id: &amp;Identifier&lt;Group&gt;) {}\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0308]: mismatched types\n  --&gt; src/main.rs:32:20\n   |\n32 |     do_group_thing(&amp;u_id);\n   |                    ^^^^^ expected struct `Group`, found struct `User`\n   |\n   = note: expected type `&amp;Identifier&lt;Group&gt;`\n              found type `&amp;Identifier&lt;User&gt;`\n</code></pre>\n\n<hr>\n\n<p>The above isn't how I'd actually do it myself, though.</p>\n\n<blockquote>\n  <p>I want to introduce two types which have the same fields and behaviour</p>\n</blockquote>\n\n<p>Two types shouldn't have the same behavior \u2014 those should be the same type.</p>\n\n<blockquote>\n  <p>I don't want to copy the entire code I just wrote, I want to reuse it instead</p>\n</blockquote>\n\n<p>Then just <em>reuse</em> it. We reuse types like <code>String</code> and <code>Vec</code> all the time by composing them as part of our larger types. These types don't act like <code>String</code>s or <code>Vec</code>s, they just use them. </p>\n\n<p>Maybe an identifier is a primitive type in your domain, and it should exist. Create types like <code>User</code> or <code>Group</code> and pass around (references to) users or groups. You certainly can add type safety, but it does come at some programmer expense.</p>\n"}], "owner": {"reputation": 1913, "user_id": 2899885, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/ZJfu0.png?s=128&g=1", "display_name": "Cybran", "link": "https://stackoverflow.com/users/2899885/cybran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 266, "favorite_count": 0, "accepted_answer_id": 56502743, "answer_count": 2, "score": 2, "last_activity_date": 1559957804, "creation_date": 1559936397, "last_edit_date": 1559956177, "question_id": 56500357, "link": "https://stackoverflow.com/questions/56500357/how-do-i-reuse-code-for-similar-yet-distinct-types-in-rust", "title": "How do I reuse code for similar yet distinct types in Rust?", "body": "<p>I have a basic type with some functionality, including trait implementations:</p>\n\n<pre><code>use std::fmt;\nuse std::str::FromStr;\n\npub struct MyIdentifier {\n    value: String,\n}\n\nimpl fmt::Display for MyIdentifier {\n    fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -&gt; fmt::Result {\n        write!(f, \"{}\", self.value)\n    }\n}\n\nimpl FromStr for MyIdentifier {\n    type Err = ();\n\n    fn from_str(s: &amp;str) -&gt; Result&lt;Self, Self::Err&gt; {\n        Ok(MyIdentifier {\n            value: s.to_string(),\n        })\n    }\n}\n</code></pre>\n\n<p>This is a simplified example, real code would be more complex.</p>\n\n<p>I want to introduce two types which have the same fields and behaviour as the basic type I described, for instance <code>MyUserIdentifier</code> and <code>MyGroupIdentifier</code>. To avoid making mistakes when using these, the compiler should treat them as distinct types.</p>\n\n<p>I don't want to copy the entire code I just wrote, I want to reuse it instead. For object-oriented languages I would use inheritance. How would I do this for Rust?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 1, "user_id": 1114, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/FFE8V.gif?s=128&g=1", "display_name": "Jeremy", "link": "https://stackoverflow.com/users/1114/jeremy"}, "edited": false, "score": 0, "creation_date": 1559934824, "post_id": 56499960, "comment_id": 99589262, "body": "See <a href=\"https://github.com/rust-lang/rust/issues/38899\" rel=\"nofollow noreferrer\">rust#38899</a> for some of discussion related to this warning being introduced. Apparently borrowck allowing this was due to a soundness bug that could cause safety issues in some cases, but this is all over my head."}], "answers": [{"comments": [{"owner": {"reputation": 3008, "user_id": 3204951, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/8aca84582c72a22e9cb5245571103d92?s=128&d=identicon&r=PG", "display_name": "Nate Mara", "link": "https://stackoverflow.com/users/3204951/nate-mara"}, "edited": false, "score": 0, "creation_date": 1560174681, "post_id": 56501163, "comment_id": 99638906, "body": "This works for my simple example here, but in my real code, the match is required, as I am matching on an enum."}, {"owner": {"reputation": 3008, "user_id": 3204951, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/8aca84582c72a22e9cb5245571103d92?s=128&d=identicon&r=PG", "display_name": "Nate Mara", "link": "https://stackoverflow.com/users/3204951/nate-mara"}, "edited": false, "score": 0, "creation_date": 1560286895, "post_id": 56501163, "comment_id": 99684894, "body": "I edited the example in my question to be a little closer to the actual code, I can&#39;t figure out how to make it work with if expressions."}], "tags": [], "owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "is_accepted": false, "score": 2, "last_activity_date": 1559941247, "creation_date": 1559941247, "answer_id": 56501163, "question_id": 56499960, "link": "https://stackoverflow.com/questions/56499960/is-this-represents-potential-undefined-behavior-in-your-code-error-when-using/56501163#56501163", "title": "Is &quot;this represents potential undefined behavior in your code&quot; error when using a match arm guard a bug in the compiler?", "body": "<p>This error looks like a limitation of the borrow checker to me, similar to <a href=\"https://stackoverflow.com/q/50519147\">Double mutable borrow error in a loop happens even with NLL on</a>. I can't see how this could lead to a soundness hole, and believe the code is safe.</p>\n\n<p>When using an <code>if</code> statementat instead of <code>match</code>, the warning can be avoided, and the code becomes more readable as well:</p>\n\n<pre><code>fn bar&lt;'a&gt;(\n    map: &amp;'a mut HashMap&lt;String, Vec&lt;i32&gt;&gt;,\n    name: &amp;str,\n    idx: usize,\n) -&gt; Result&lt;&amp;'a mut i32, Vec&lt;i32&gt;&gt; {\n    let value = map.get_mut(name).unwrap();\n    if idx &lt; value.len() {\n        Ok(&amp;mut value[idx])\n    } else {\n        Err(value.clone())\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 3008, "user_id": 3204951, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/8aca84582c72a22e9cb5245571103d92?s=128&d=identicon&r=PG", "display_name": "Nate Mara", "link": "https://stackoverflow.com/users/3204951/nate-mara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1589473009, "creation_date": 1559934225, "last_edit_date": 1589473009, "question_id": 56499960, "link": "https://stackoverflow.com/questions/56499960/is-this-represents-potential-undefined-behavior-in-your-code-error-when-using", "title": "Is &quot;this represents potential undefined behavior in your code&quot; error when using a match arm guard a bug in the compiler?", "body": "<p>I'm having an issue with a match expression in my code raising a warning when a guard is included. I believe that this warning has to do with the non-lexical lifetimes used by the borrow checker. My function either returns a mutable reference to an item from a collection, or a clone of the whole collection.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[derive(Debug, Clone)]\nenum Value {\n    Int(i32),\n    List(Vec&lt;Value&gt;),\n}\n\n#[derive(Debug)]\nstruct Error(&amp;'static str, Value);\n\nfn main() {\n    let mut value = Value::List(vec![\n        Value::Int(1),\n        Value::Int(2),\n        Value::Int(34),\n        Value::Int(12),\n    ]);\n    let y = index_list(&amp;mut value, 2);\n\n    let _ = dbg!(y);\n}\n\nfn index_list&lt;'a&gt;(value: &amp;'a mut Value, idx: usize) -&gt; Result&lt;&amp;'a mut Value, Error&gt; {\n    match *value {\n        Value::List(ref mut list) if idx &lt; list.len() =&gt; Ok(&amp;mut list[idx]),\n        Value::List(_) =&gt; Err(Error(\"index out of range\", value.clone())),\n        _ =&gt; Err(Error(\"tried to index int\", value.clone())),\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=a3790c21879521afd0761c0cbee9157f\" rel=\"nofollow noreferrer\">playground</a></p>\n\n<p>It compiles and runs, but I get a very ominous looking warning:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>warning[E0502]: cannot borrow `*value` as immutable because it is also borrowed as mutable\n  --&gt; src/main.rs:25:59\n   |\n22 | fn index_list&lt;'a&gt;(value: &amp;'a mut Value, idx: usize) -&gt; Result&lt;&amp;'a mut Value, Error&gt; {\n   |               -- lifetime `'a` defined here\n23 |     match *value {\n24 |         Value::List(ref mut list) if idx &lt; list.len() =&gt; Ok(&amp;mut list[idx]),\n   |                     ------------                         ------------------ returning this value requires that `value.0` is borrowed for `'a`\n   |                     |\n   |                     mutable borrow occurs here\n25 |         Value::List(_) =&gt; Err(Error(\"index out of range\", value.clone())),\n   |                                                           ^^^^^ immutable borrow occurs here\n   |\n   = warning: this error has been downgraded to a warning for backwards compatibility with previous releases\n   = warning: this represents potential undefined behavior in your code and this warning will become a hard error in the future\n\nwarning[E0502]: cannot borrow `*value` as immutable because it is also borrowed as mutable\n  --&gt; src/main.rs:26:46\n   |\n22 | fn index_list&lt;'a&gt;(value: &amp;'a mut Value, idx: usize) -&gt; Result&lt;&amp;'a mut Value, Error&gt; {\n   |               -- lifetime `'a` defined here\n23 |     match *value {\n24 |         Value::List(ref mut list) if idx &lt; list.len() =&gt; Ok(&amp;mut list[idx]),\n   |                     ------------                         ------------------ returning this value requires that `value.0` is borrowed for `'a`\n   |                     |\n   |                     mutable borrow occurs here\n25 |         Value::List(_) =&gt; Err(Error(\"index out of range\", value.clone())),\n26 |         _ =&gt; Err(Error(\"tried to index int\", value.clone())),\n   |                                              ^^^^^ immutable borrow occurs here\n   |\n   = warning: this error has been downgraded to a warning for backwards compatibility with previous releases\n   = warning: this represents potential undefined behavior in your code and this warning will become a hard error in the future\n</code></pre>\n\n<p>I don't understand why the <code>Err(value.clone())</code> line requires that the <code>Ok(&amp;mut ...)</code> borrow still be active, because they are mutually exclusive and both result in a function return. This warning goes away if I remove the guard on the first match arm, but I need that guard to be there. Is this a bug in the NLL system? I never had this issue with the old borrowck. How can I make this better?</p>\n"}, {"tags": ["sqlite", "docker", "rust", "symlink"], "answers": [{"tags": [], "owner": {"reputation": 61, "user_id": 11610131, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-n5Ad72r9xrQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfVzm7uvWB5qmCOMZVW_Iw-IQiStA/mo/photo.jpg?sz=128", "display_name": "Tamas", "link": "https://stackoverflow.com/users/11610131/tamas"}, "is_accepted": false, "score": 0, "last_activity_date": 1560287827, "last_edit_date": 1560287827, "creation_date": 1559937020, "answer_id": 56500482, "question_id": 56499945, "link": "https://stackoverflow.com/questions/56499945/symlink-lost-within-docker-image/56500482#56500482", "title": "Symlink lost within Docker image", "body": "<p>After quite a bit of thinking the following ideas come to my mind which could help.</p>\n\n<ul>\n<li>Docker history</li>\n</ul>\n\n<p>Docker command has a build in feature to view the history of a built image. You have the option to identify the problematic command in the DockerFile. </p>\n\n<pre><code>docker history &lt;image id or name&gt;\n</code></pre>\n\n<p>For more visual filtering i do recommend <a href=\"https://github.com/wagoodman/dive\" rel=\"nofollow noreferrer\">dive</a> tool but others are also available on google.</p>\n\n<ul>\n<li>Correct docker version</li>\n</ul>\n\n<p>Since in this scenario the two docker instances are different the question is trivial. Are they on the same version of docker daemon and docker file system driver?</p>\n"}], "owner": {"reputation": 9495, "user_id": 1395740, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/793c4377313587d742fad6f069d92d89?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/1395740/nick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 103, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1560287827, "creation_date": 1559934179, "question_id": 56499945, "link": "https://stackoverflow.com/questions/56499945/symlink-lost-within-docker-image", "title": "Symlink lost within Docker image", "body": "<p>I am defining a Dockerfile where I install <code>sqlite3</code> in a <code>ubuntu</code> based image, something very similar (I also install grpc and rust as well as all the necessary dependencies) to:</p>\n\n<pre><code>FROM ubuntu\n\nRUN apt-get update &amp;&amp; \\\n    apt-get install -y sqlite3 libsqlite3-dev&amp;&amp; \\\n    apt-get clean &amp;&amp; \\\n    apt-get autoremove\n</code></pre>\n\n<p>I use this image to built my Rust project within it. The issue that I am facing is that <code>cargo build</code> fails on my GitLab CI due to a linking issue:</p>\n\n<pre><code>Compiling migrations_macros v1.4.0\nerror: linking with `cc` failed: exit code: 1\n...\n= note: /usr/bin/ld: cannot find -lsqlite3\n</code></pre>\n\n<p>I found out that this is due to this symlink not being present on the Docker image that is running on CI:</p>\n\n<pre><code>libsqlite3.so -&gt; /usr/lib/x86_64-linux-gnu/libsqlite3.so.0.8.6\n</code></pre>\n\n<p>while the file <code>libsqlite3.so.0.8.6</code> exists. So if I create the symlink during the CI jobs I can have a working workaround. The weird thing is that if I pull the same exact image from my registry on my pc and run the container I can build without any issue and any change because the symlink is actually there.</p>\n\n<p>What could be the cause of the problem and how to solve it?</p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 11610674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eff6513da0880379c0d3d391feccb713?s=128&d=identicon&r=PG&f=1", "display_name": "RustyBob", "link": "https://stackoverflow.com/users/11610674/rustybob"}, "edited": false, "score": 0, "creation_date": 1559936594, "post_id": 56499987, "comment_id": 99589929, "body": "Thanks! I am more used to C and keep underestimating how much Rust will do for me. I&#39;ll try these out."}], "tags": [], "owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "is_accepted": true, "score": 5, "last_activity_date": 1559934401, "creation_date": 1559934401, "answer_id": 56499987, "question_id": 56499241, "link": "https://stackoverflow.com/questions/56499241/how-to-determine-the-resulting-type-of-a-rust-iterator/56499987#56499987", "title": "How to determine the resulting type of a Rust iterator?", "body": "<p>The <code>map()</code> method on an <em>iterator adapter</em>; it takes an iterator, and returns another iterator, but it does not consume any items from the original iterator by itself. The return type <code>Map</code> is a wrapper around the original iterator that applies the provided closure to every item when they are consumed.</p>\n\n<p>If you want the <code>Map</code> to actually do something, you need to <em>consume</em> the iterator. The most common ways to do so are <code>for</code> loops and the <code>collect()</code> method (but there are many other methods that consume the iterator, like <code>sum()</code>, <code>count()</code>, <code>fold()</code>, <code>max()</code>, \u2026). In this particular case, calling the <code>collect()</code> method is most appropriate, since you want to collect the results in a vector.</p>\n\n<p>You already figured out that the desired type for <code>x</code> is a <code>Result</code> wrapping a vector of <code>i32</code> or an error, or <code>Result&lt;Vec&lt;i32&gt;, DivisionError&gt;</code> in Rust syntax. Since <code>collect()</code> can produce many different return types, we need to tell the compiler which one we want. One way to do so is to explicitly specify the type of <code>x</code>:</p>\n\n<pre><code>let x: Result&lt;Vec&lt;i32&gt;, DivisionError&gt; = division_results.collect();\n</code></pre>\n\n<p>This uses an <a href=\"https://doc.rust-lang.org/std/iter/trait.FromIterator.html#impl-FromIterator%3CResult%3CA%2C%20E%3E%3E\" rel=\"noreferrer\">implementation of the <code>FromIterator</code> trait that allows to collect an iterable of <code>Result</code>s into a <code>Result</code> wrapping a collection of values</a>.</p>\n\n<p>The other case you mentioned is very similar. This time, the target type is a vector of <code>Result</code> instances, so all you need to do is specify the different type. This will automatically select the right implementation of <code>FromIterator</code> for you:</p>\n\n<pre><code>let x: Vec&lt;Result&lt;i32, DivisionError&gt;&gt; = division_results.collect();\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 11610674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eff6513da0880379c0d3d391feccb713?s=128&d=identicon&r=PG&f=1", "display_name": "RustyBob", "link": "https://stackoverflow.com/users/11610674/rustybob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 273, "favorite_count": 0, "accepted_answer_id": 56499987, "answer_count": 1, "score": 2, "last_activity_date": 1559934401, "creation_date": 1559930467, "last_edit_date": 1559932098, "question_id": 56499241, "link": "https://stackoverflow.com/questions/56499241/how-to-determine-the-resulting-type-of-a-rust-iterator", "title": "How to determine the resulting type of a Rust iterator?", "body": "<p>I am working through the <a href=\"https://github.com/rust-lang/rustlings\" rel=\"nofollow noreferrer\">rustlings</a> exercises to learn Rust. I have reached the <a href=\"https://github.com/rust-lang/rustlings/blob/master/exercises/standard_library_types/iterator3.rs\" rel=\"nofollow noreferrer\">iterator3.rs</a> exercise and am stuck. This exercise asks me to provide a line of code that will map results from one type to another as part of the operation; I need to fill in the line x= with the correct operation. There are two parts - the first reads in part:</p>\n\n<pre><code>let numbers = vec![27, 297, 38502, 81];\nlet division_results = numbers.into_iter().map(|n| divide(n, 27));\nlet x = ???\nassert_eq!(format!(\"{:?}\", x), \"Ok([1, 11, 1426, 3])\");\n</code></pre>\n\n<p>The next is the same with a slightly different format for the assertion of the output:</p>\n\n<pre><code>assert_eq!(format!(\"{:?}\", x), \"[Ok(1), Ok(11), Ok(1426), Ok(3)]\");\n</code></pre>\n\n<p>I believe I understand that the first instance needs to return a Result that contains either a Vector of i32 or some error type. The second needs to return a Vector of Results that each have a i32  or an error type. </p>\n\n<p>I am, however, generally having difficulty understanding how to determine what type is returned by the combinations of into_iter, map, and collect. I could use some help in learning how to reason about it or in getting compiler assistance.</p>\n\n<p>Here is where I am so far: </p>\n\n<p>I don't understand what the resultant type of division_results is. I have tried to use compiler error messages as well as <a href=\"https://stackoverflow.com/questions/21747136/how-do-i-print-the-type-of-a-variable-in-rust/29168659#29168659\">the answer of this question</a> to find out, but the results are opaque to me, perhaps because of lazy evaluation. For example, just replacing x with division_results so that assert will show the types, like this: </p>\n\n<pre><code>assert_eq!(format!(\"{:?}\", division_results), \"Ok([1, 11, 1426, 3])\");\n</code></pre>\n\n<p>Gives me this result:</p>\n\n<pre><code>left: `\"Map { iter: IntoIter([27, 297, 38502, 81]) }\"`,\nright: `\"Ok([1, 11, 1426, 3])\"`', exercises/standard_library_types/iterator3.rs:75:9\n</code></pre>\n\n<p>And it isn't clear what the left side results are as the iteration and map have not happened. The other various things I have tried provide similar results.</p>\n\n<p>Thinking that the problem is lazy evaluation, I have also tried using collect to see if that will force evaluation. For example, calling collect at the end of the division_results line like this:</p>\n\n<pre><code>division_results = numbers.into_iter().map(|n| divide(n, 27)).collect();\n</code></pre>\n\n<p>Provides an error:</p>\n\n<pre><code>cannot infer type consider giving `division_results` a type\n</code></pre>\n\n<p>When I modify collect to say:</p>\n\n<pre><code>let division_results = numbers.into_iter().map(|n| divide(n, 27)).collect::&lt;i32&gt;();\n</code></pre>\n\n<p>I get an error that I thought gave me a hint at the right type:</p>\n\n<pre><code>let division_results = numbers.into_iter().map(|n| divide(n, 27)).collect::&lt;i32&gt;();\n   |                                                                           ^^^^^^^ a collection of type `i32` cannot be built from `std::iter::Iterator&lt;Item=std::result::Result&lt;i32, DivisionError&gt;&gt;`\n</code></pre>\n\n<p>So I tried with the type shown in the error message:</p>\n\n<pre><code>let division_results = numbers.into_iter().map(|n| divide(n, 27)).collect::&lt;Result&lt;i32, DivisionError&gt;&gt;();\n</code></pre>\n\n<p>Only to get this error:</p>\n\n<pre><code>let division_results = numbers.into_iter().map(|n| divide(n, 27)).collect::&lt;Result&lt;i32, DivisionError&gt;&gt;();\n   |                                                                           ^^^^^^^ a collection of type `i32` cannot be built from `std::iter::Iterator&lt;Item=i32&gt;`\n</code></pre>\n\n<p>Clearly I am missing something. Perhaps you can tell me what?</p>\n"}, {"tags": ["split", "rust"], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 2, "last_activity_date": 1559956252, "last_edit_date": 1559956252, "creation_date": 1559955647, "answer_id": 56502617, "question_id": 56499047, "link": "https://stackoverflow.com/questions/56499047/how-can-i-process-data-by-newlines-until-i-find-two-newlines-in-a-row-then-proc/56502617#56502617", "title": "How can I process data by newlines until I find two newlines in a row, then process all of the remaining data?", "body": "<p>You can trivially get the length of each slice, tracking the current offset and do the final slice yourself:</p>\n\n<pre><code>static DATA: &amp;[u8] = br#\"key: value\notherkey: othervalue\n\nThis is the content\nthat is now just a big\nblock. I don't care about\nnewlines here.\n\"#;\n\npub fn main() {\n    let mut offset = 0;\n\n    for line in DATA.split(|&amp;c| c == '\\n' as u8) {\n        offset += line.len() + 1; // Include the newline.\n        if line.len() == 0 {\n            break;\n        } else {\n            // Header\n            println!(\"{:?}\", line);\n        }\n    }\n\n    let body = &amp;DATA[offset..];\n    println!(\"{:?}\", body);\n}\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/38268529/155423\">How to get the byte offset between `&amp;str`</a></li>\n</ul>\n"}], "owner": {"reputation": 67096, "user_id": 265521, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/34a66330977044d70165288c56740d4b?s=128&d=identicon&r=PG", "display_name": "Timmmm", "link": "https://stackoverflow.com/users/265521/timmmm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1559956252, "creation_date": 1559929448, "last_edit_date": 1559955177, "question_id": 56499047, "link": "https://stackoverflow.com/questions/56499047/how-can-i-process-data-by-newlines-until-i-find-two-newlines-in-a-row-then-proc", "title": "How can I process data by newlines until I find two newlines in a row, then process all of the remaining data?", "body": "<p>I have a <code>Vec&lt;u8&gt;</code> which I want to split on <code>\\n</code> and process it line-by-line. At some point there is a blank line and I want to process the entire rest of the vector in one chunk (not line-by-line). This sort of thing is common in HTTP or in Git commit objects.</p>\n\n<p>For example:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>key: value\notherkey: othervalue\n\nThis is the content\nthat is now just a big\nblock. I don't care about\nnewlines here.\n</code></pre>\n\n<p>Is there an elegant way to parse that with Rust? I can split it like this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub fn main() {\n    let data: Vec&lt;u8&gt; = \"key: value\\notherkey: othervalue\\n\\nThis is the content\\nthat is now just a big\\nblock. I don't care about\\nnewlines here.\".as_bytes().to_owned();\n\n    for line in data.split(|&amp;c| c == '\\n' as u8) {\n        println!(\"Line: {:?}\", line);\n        if line.len() == 0 {\n            // Start of message...\n        } else {\n            // Header\n        }\n    }\n}\n</code></pre>\n\n<p>However when I get to the <code>\\n\\n</code> I can't find a way to say \"give me the rest of the <code>Vec</code> from here\". It would be easy if there were a form of <code>split()</code> that returned slices with indices, instead of the actual contents, but I can't seem to find one.</p>\n\n<p>Is there an elegant way to do this that doesn't just split the message and then rejoin it together?</p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 8608, "user_id": 1091116, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/15098b2b940cacd8b4d07026e01e3102?s=128&d=identicon&r=PG", "display_name": "d33tah", "link": "https://stackoverflow.com/users/1091116/d33tah"}, "edited": false, "score": 0, "creation_date": 1559922605, "post_id": 56497536, "comment_id": 99584094, "body": "Thanks, that answers half of the question. Now I need to figure out how to implement the cartesian product in a borrow-friendly manner..."}, {"owner": {"reputation": 8608, "user_id": 1091116, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/15098b2b940cacd8b4d07026e01e3102?s=128&d=identicon&r=PG", "display_name": "d33tah", "link": "https://stackoverflow.com/users/1091116/d33tah"}, "edited": false, "score": 0, "creation_date": 1559922940, "post_id": 56497536, "comment_id": 99584295, "body": "I read up a bit and iterating over the reference solved the problem. Thanks again."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 8608, "user_id": 1091116, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/15098b2b940cacd8b4d07026e01e3102?s=128&d=identicon&r=PG", "display_name": "d33tah", "link": "https://stackoverflow.com/users/1091116/d33tah"}, "edited": false, "score": 0, "creation_date": 1559923743, "post_id": 56497536, "comment_id": 99584659, "body": "@d33tah <a href=\"https://docs.rs/itertools/0.8.0/itertools/trait.Itertools.html#method.cartesian_product\" rel=\"nofollow noreferrer\">docs.rs/itertools/0.8.0/itertools/&hellip;</a>"}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 1, "last_activity_date": 1559922219, "creation_date": 1559922219, "answer_id": 56497536, "question_id": 56497357, "link": "https://stackoverflow.com/questions/56497357/expected-type-string-found-type-str-when-i-explicitly-made-it-string/56497536#56497536", "title": "Expected type String, found type str when I explicitly made it String", "body": "<p>Your case can be reduced to </p>\n\n<pre><code>fn repro(_: String) {}\n\nfn main() {\n    repro(*\"\".to_string());\n}\n</code></pre>\n\n<p>For some reason, you are dereferencing the <code>String</code>. String implements <a href=\"https://doc.rust-lang.org/std/string/struct.String.html#deref-methods\" rel=\"nofollow noreferrer\"><code>Deref&lt;Target = str&gt;</code></a>, so you've explicitly attempted to make a <code>str</code>. This ultimately won't work because a <code>str</code> is unsized, but you are hitting the type mismatch first.</p>\n\n<p>Remove the asterisk:</p>\n\n<pre><code>fn repro(_: String) {}\n\nfn main() {\n    repro(\"\".to_string());\n}\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/28519997/155423\">What are Rust&#39;s exact auto-dereferencing rules?</a></li>\n</ul>\n"}], "owner": {"reputation": 8608, "user_id": 1091116, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/15098b2b940cacd8b4d07026e01e3102?s=128&d=identicon&r=PG", "display_name": "d33tah", "link": "https://stackoverflow.com/users/1091116/d33tah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "accepted_answer_id": 56497536, "answer_count": 1, "score": 0, "last_activity_date": 1559922290, "creation_date": 1559921564, "last_edit_date": 1559922290, "question_id": 56497357, "link": "https://stackoverflow.com/questions/56497357/expected-type-string-found-type-str-when-i-explicitly-made-it-string", "title": "Expected type String, found type str when I explicitly made it String", "body": "<pre><code>use std::collections::{HashMap, HashSet};\n\ntype Snapshot = HashMap&lt;String, HashSet&lt;String&gt;&gt;;\n\nfn compare_snapshots(snapshot1: Snapshot, snapshot2: Snapshot, entry1: String, entry2: String) {}\n\nfn main() {\n    let snapshot1 = HashMap::new();\n    let snapshot2 = HashMap::new();\n\n    let entries1: HashSet&lt;String&gt; = snapshot1.keys().cloned().collect();\n    let entries2: HashSet&lt;String&gt; = snapshot2.keys().cloned().collect();\n    let entries: Vec&lt;String&gt; = entries1.union(&amp;entries2).cloned().collect();\n\n    for e1 in entries {\n        for e2 in entries {\n            if e1 &lt; e2 {\n                compare_snapshots(snapshot1, snapshot2, *e1.to_string(), *e2.to_string());\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>And the following errors:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0308]: mismatched types\n  --&gt; src/main.rs:18:57\n   |\n18 |                 compare_snapshots(snapshot1, snapshot2, *e1.to_string(), *e2.to_string());\n   |                                                         ^^^^^^^^^^^^^^^ expected struct `std::string::String`, found str\n   |\n   = note: expected type `std::string::String`\n              found type `str`\n\nerror[E0308]: mismatched types\n  --&gt; src/main.rs:18:74\n   |\n18 |                 compare_snapshots(snapshot1, snapshot2, *e1.to_string(), *e2.to_string());\n   |                                                                          ^^^^^^^^^^^^^^^ expected struct `std::string::String`, found str\n   |\n   = note: expected type `std::string::String`\n              found type `str`\n</code></pre>\n\n<p>Why did I get them given that I explicitly made gave <code>entries</code> a <code>Vec&lt;String&gt;</code> type?</p>\n"}, {"tags": ["rust", "serde"], "answers": [{"tags": [], "owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "is_accepted": true, "score": 4, "last_activity_date": 1559920814, "last_edit_date": 1559920814, "creation_date": 1559919920, "answer_id": 56496895, "question_id": 56496851, "link": "https://stackoverflow.com/questions/56496851/edition-2018-use-or-not-use-extern-crate-name/56496895#56496895", "title": "edition = &quot;2018&quot; use or not use `extern crate &lt;name&gt;`", "body": "<p>In the 2018 edition, procedural macros are items like anything else, so you must bring them into scope:</p>\n\n<pre><code>use serde::{Serialize, Deserialize};\n</code></pre>\n"}], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 348, "favorite_count": 0, "closed_date": 1559920760, "accepted_answer_id": 56496895, "answer_count": 1, "score": 3, "last_activity_date": 1559920912, "creation_date": 1559919803, "last_edit_date": 1559920912, "question_id": 56496851, "link": "https://stackoverflow.com/questions/56496851/edition-2018-use-or-not-use-extern-crate-name", "closed_reason": "Duplicate", "title": "edition = &quot;2018&quot; use or not use `extern crate &lt;name&gt;`", "body": "<p>I want to serialize a struct, print it to standard output, read it from another program and deserialize. I found that I could use the <a href=\"https://docs.serde.rs/serde/index.html\" rel=\"nofollow noreferrer\">serde</a> crate and <a href=\"https://github.com/servo/bincode\" rel=\"nofollow noreferrer\">Bincode</a> as the data format.</p>\n\n<p>I came up with this example:</p>\n\n<pre><code>#[macro_use]\nextern crate serde;\n\nuse bincode::{deserialize, serialize};\n\n#[derive(Serialize, Deserialize)]\nstruct Entity {\n    x: f32,\n    y: f32,\n}\n\n#[derive(Serialize, Deserialize)]\nstruct World(Vec&lt;Entity&gt;);\n\nfn main() {\n    let world = World(vec![Entity { x: 0.0, y: 4.0 }, Entity { x: 10.0, y: 20.5 }]);\n\n    let encoded: Vec&lt;u8&gt; = serialize(&amp;world).unwrap();\n    println!(\"{:?}\", encoded);\n\n    let decoded: World = deserialize(&amp;encoded[..]).unwrap();\n}\n</code></pre>\n\n<p>In <code>Cargo.toml</code> I have:</p>\n\n<pre><code>[package]\nname = \"test\"\nversion = \"0.1.0\"\nedition = \"2018\"\n\n[dependencies]\nbincode = \"1.1.4\"\nserde = { version = \"1.0\", features = [\"derive\"] }\n</code></pre>\n\n<p>But the thing that confuses me is that even I have declared to use <code>edition = \"2018\"</code> and from my understanding, that means that <code>extern crate serde;</code> could be omitted, If I remove the lines:</p>\n\n<pre><code>#[macro_use]\nextern crate serde;\n</code></pre>\n\n<p>I get multiple errors like:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error: cannot find derive macro `Deserialize` in this scope\n --&gt; src/main.rs:3:21\n  |\n3 | #[derive(Serialize, Deserialize)]\n  |                     ^^^^^^^^^^^\n\nerror: cannot find derive macro `Serialize` in this scope\n --&gt; src/main.rs:3:10\n  |\n3 | #[derive(Serialize, Deserialize)]\n  |          ^^^^^^^^^\n\nerror: cannot find derive macro `Deserialize` in this scope\n --&gt; src/main.rs:9:21\n  |\n9 | #[derive(Serialize, Deserialize)]\n  |                     ^^^^^^^^^^^\n\nerror: cannot find derive macro `Serialize` in this scope\n --&gt; src/main.rs:9:10\n  |\n9 | #[derive(Serialize, Deserialize)]\n  |          ^^^^^^^^^\n</code></pre>\n\n<p>Therefore wondering when or how to use <code>edition = \"2018\"</code></p>\n\n<p>The use of <code>#[macro_use]</code> makes me remember decorators from Python, could it be that same logic applies in Rust or there is work in progress to standardize more the language so that probably in an <code>edition = \"20XX</code> the <code>#[macro_use]</code> will not be required?</p>\n\n<pre><code>#[macro_use]\nextern crate serde;\n</code></pre>\n\n<p>I'm using Rust 1.35.0.</p>\n"}, {"tags": ["reference", "rust", "iterator", "traits"], "answers": [{"comments": [{"owner": {"reputation": 1913, "user_id": 2899885, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/ZJfu0.png?s=128&g=1", "display_name": "Cybran", "link": "https://stackoverflow.com/users/2899885/cybran"}, "edited": false, "score": 0, "creation_date": 1559919011, "post_id": 56496150, "comment_id": 99582124, "body": "Thanks! Can you elaborate or refer to documentation on why <code>+ &#39;a</code> is required for the Iterator return type? Why is it assumed <code>&#39;static</code> by default?"}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "reply_to_user": {"reputation": 1913, "user_id": 2899885, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/ZJfu0.png?s=128&g=1", "display_name": "Cybran", "link": "https://stackoverflow.com/users/2899885/cybran"}, "edited": false, "score": 1, "creation_date": 1559919282, "post_id": 56496150, "comment_id": 99582265, "body": "@Cybran I&#39;ve added the source, but there is no explanation about the &quot;why&quot;"}], "tags": [], "owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "is_accepted": true, "score": 2, "last_activity_date": 1559919258, "last_edit_date": 1559919258, "creation_date": 1559917411, "answer_id": 56496150, "question_id": 56496044, "link": "https://stackoverflow.com/questions/56496044/how-can-i-transform-an-iterator-trait-object-of-concrete-types-into-an-iterator/56496150#56496150", "title": "How can I transform an iterator trait object of concrete types into an iterator trait object of trait objects?", "body": "<p>By default, a trait object is bounded by <code>'static</code>. You must specify the lifetime <code>'a</code> and then you can correctly map the iterator (<a href=\"https://doc.rust-lang.org/book/ch19-02-advanced-lifetimes.html#inference-of-trait-object-lifetimes\" rel=\"nofollow noreferrer\">source</a>):</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub trait ParentInterface {\n    fn children&lt;'a&gt;(&amp;'a self) -&gt; Box&lt;dyn Iterator&lt;Item = &amp;'a dyn ChildInterface&gt; + 'a&gt;;\n}\n\npub trait ChildInterface {\n    fn some_method(&amp;self) -&gt; bool;\n}\n\npub struct ConcreteParent {\n    my_children: Vec&lt;ConcreteChild&gt;,\n}\n\npub struct ConcreteChild {\n    my_value: bool,\n}\n\nimpl ParentInterface for ConcreteParent {\n    fn children&lt;'a&gt;(&amp;'a self) -&gt; Box&lt;dyn Iterator&lt;Item = &amp;'a dyn ChildInterface&gt; + 'a&gt; {\n        Box::new(self.my_children.iter().map(|c| c as &amp;'a dyn ChildInterface))\n    }\n}\n\nimpl ChildInterface for ConcreteChild {\n    fn some_method(&amp;self) -&gt; bool {\n        self.my_value\n    }\n}\n</code></pre>\n\n<p>Note the changes:</p>\n\n<ul>\n<li><p>The reference bounds of the iterator are <code>'a</code>, just like the items:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>dyn Iterator&lt;/*...*/&gt; + 'a\n</code></pre></li>\n<li><p>Each concrete type is mapped to a trait object:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>.map(|c| c as &amp;'a dyn ChildInterface)\n</code></pre>\n\n<p>Note that you can simplify the notation to let the inference work: <code>.map(|c| c as _)</code></p></li>\n</ul>\n\n<p>You can simplify further by using the lifetime <code>'_</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub trait ParentInterface {\n    fn children(&amp;self) -&gt; Box&lt;dyn Iterator&lt;Item = &amp;dyn ChildInterface&gt; + '_&gt;;\n}\n\n// ...\n\nimpl ParentInterface for ConcreteParent {\n    fn children(&amp;self) -&gt; Box&lt;dyn Iterator&lt;Item = &amp;dyn ChildInterface&gt; + '_&gt; {\n        Box::new(self.my_children.iter().map(|c| c as _))\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1913, "user_id": 2899885, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/ZJfu0.png?s=128&g=1", "display_name": "Cybran", "link": "https://stackoverflow.com/users/2899885/cybran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "accepted_answer_id": 56496150, "answer_count": 1, "score": 1, "last_activity_date": 1559919258, "creation_date": 1559917018, "last_edit_date": 1559918131, "question_id": 56496044, "link": "https://stackoverflow.com/questions/56496044/how-can-i-transform-an-iterator-trait-object-of-concrete-types-into-an-iterator", "title": "How can I transform an iterator trait object of concrete types into an iterator trait object of trait objects?", "body": "<p>I have a trait which contains a function to return an iterator over references to another trait, like:</p>\n\n<pre><code>pub trait ParentInterface {\n    fn children&lt;'a&gt;(&amp;'a self) -&gt; Box&lt;dyn Iterator&lt;Item = &amp;'a ChildInterface&gt;&gt;;\n}\n\npub trait ChildInterface {\n    fn some_method(&amp;self) -&gt; bool;\n}\n</code></pre>\n\n<p>How can an iterator of the correct type be returned when implementing this trait for a concrete type which stores a vector of concrete values?</p>\n\n<pre><code>pub struct ConcreteParent {\n    my_children: Vec&lt;ConcreteChild&gt;,\n}\n\npub struct ConcreteChild {\n    my_value: bool,\n}\n\nimpl ParentInterface for ConcreteParent {\n    fn children&lt;'a&gt;(&amp;'a self) -&gt; Box&lt;dyn Iterator&lt;Item = &amp;'a ChildInterface&gt;&gt; {\n        Box::new(self.my_children.iter()) // Compiler error!\n    }\n}\n\nimpl ChildInterface for ConcreteChild {\n    fn some_method(&amp;self) -&gt; bool {\n        self.my_value\n    }\n}\n</code></pre>\n\n<p>The above example yields a compiler error for Rust 2018:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0271]: type mismatch resolving `&lt;std::slice::Iter&lt;'_, ConcreteChild&gt; as std::iter::Iterator&gt;::Item == &amp;dyn ChildInterface`\n  --&gt; src/lib.rs:19:9\n   |\n19 |         Box::new(self.my_children.iter()) // Compiler error!\n   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected struct `ConcreteChild`, found trait ChildInterface\n   |\n   = note: expected type `&amp;ConcreteChild`\n              found type `&amp;dyn ChildInterface`\n   = note: required for the cast to the object type `dyn std::iter::Iterator&lt;Item = &amp;dyn ChildInterface&gt;`\n</code></pre>\n\n<p>I assume that <code>my_children.iter()</code> returns an iterator with the wrong <code>Item</code> type (the concrete type instead of the trait type) - how can this be solved?</p>\n"}, {"tags": ["rust", "rust-diesel"], "answers": [{"comments": [{"owner": {"reputation": 3633, "user_id": 7583919, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DUAnI.jpg?s=128&g=1", "display_name": "ComplicatedPhenomenon", "link": "https://stackoverflow.com/users/7583919/complicatedphenomenon"}, "edited": false, "score": 0, "creation_date": 1580125801, "post_id": 56522882, "comment_id": 105983009, "body": "could you please help to solve <a href=\"https://stackoverflow.com/questions/59877290/how-to-insert-hashmap-into-postgresql-as-json-type\" title=\"how to insert hashmap into postgresql as json type\">stackoverflow.com/questions/59877290/&hellip;</a>"}, {"owner": {"reputation": 1632, "user_id": 2429333, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5eb897104dc190de7ea7da0ac29a59ae?s=128&d=identicon&r=PG", "display_name": "pbn", "link": "https://stackoverflow.com/users/2429333/pbn"}, "reply_to_user": {"reputation": 3633, "user_id": 7583919, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DUAnI.jpg?s=128&g=1", "display_name": "ComplicatedPhenomenon", "link": "https://stackoverflow.com/users/7583919/complicatedphenomenon"}, "edited": false, "score": 0, "creation_date": 1580203359, "post_id": 56522882, "comment_id": 106011191, "body": "OK then I will take a look at it in the evening CET."}, {"owner": {"reputation": 3633, "user_id": 7583919, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DUAnI.jpg?s=128&g=1", "display_name": "ComplicatedPhenomenon", "link": "https://stackoverflow.com/users/7583919/complicatedphenomenon"}, "edited": false, "score": 0, "creation_date": 1580203491, "post_id": 56522882, "comment_id": 106011274, "body": "Thanks, I will track the progress closely."}], "tags": [], "owner": {"reputation": 1632, "user_id": 2429333, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5eb897104dc190de7ea7da0ac29a59ae?s=128&d=identicon&r=PG", "display_name": "pbn", "link": "https://stackoverflow.com/users/2429333/pbn"}, "is_accepted": true, "score": 3, "last_activity_date": 1560155102, "creation_date": 1560155102, "answer_id": 56522882, "question_id": 56495152, "link": "https://stackoverflow.com/questions/56495152/how-to-store-arbitrary-json-object-in-sqlite-using-diesel/56522882#56522882", "title": "How to store arbitrary JSON object in sqlite using Diesel", "body": "<p>In my answer I will keep JSON object in the DB in a string representation (schema: TEXT). </p>\n\n<p>For our unsupported type we need following traits implemented: <code>ToSql</code>, <code>FromSql</code>, <code>AsExpression</code> and <code>FromSqlRow</code>. </p>\n\n<p>Now, since one can not implement a trait for a type coming from an external crate it has to be wrapped into a single element tuple:</p>\n\n<pre><code>struct MyJsonType(serde_json::Value)\n</code></pre>\n\n<p>Now <code>FromSql</code> trait implementation :</p>\n\n<pre><code>impl FromSql&lt;Text, DB&gt; for MyJsonType {\n    fn from_sql(\n        bytes: Option&lt;&amp;&lt;diesel::sqlite::Sqlite as Backend&gt;::RawValue&gt;,\n    ) -&gt; deserialize::Result&lt;Self&gt; {\n        let t = &lt;String as FromSql&lt;Text, DB&gt;&gt;::from_sql(bytes)?;\n        Ok(Self(serde_json::from_str(&amp;t)?))\n    }\n}\n</code></pre>\n\n<p>And <code>ToSql</code> trait implementation:</p>\n\n<pre><code>impl ToSql&lt;Text, DB&gt; for MyJsonType {\n    fn to_sql&lt;W: Write&gt;(&amp;self, out: &amp;mut Output&lt;W, DB&gt;) -&gt; serialize::Result {\n        let s = serde_json::to_string(&amp;self.0)?;\n        &lt;String as ToSql&lt;Text, DB&gt;&gt;::to_sql(&amp;s, out)\n    }\n}\n</code></pre>\n\n<p>Now the remaining traits can be derived using macros:</p>\n\n<pre><code>#[derive(AsExpression, Debug, Deserialize, Serialize, FromSqlRow)]\n#[sql_type = \"Text\"]\nstruct MyJsonType(serde_json::Value);\n</code></pre>\n\n<p>It should be fine to use our new type now:</p>\n\n<pre><code>#[derive(Debug, Deserialize, Serialize, Queryable, Identifiable)]\n#[table_name = \"my_table\"]\nstruct Item {\n    id: i32,\n    arbitrary_json: MyJsonType\n}\n</code></pre>\n"}], "owner": {"reputation": 1632, "user_id": 2429333, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5eb897104dc190de7ea7da0ac29a59ae?s=128&d=identicon&r=PG", "display_name": "pbn", "link": "https://stackoverflow.com/users/2429333/pbn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 785, "favorite_count": 0, "accepted_answer_id": 56522882, "answer_count": 1, "score": 2, "last_activity_date": 1560155102, "creation_date": 1559913554, "last_edit_date": 1559913734, "question_id": 56495152, "link": "https://stackoverflow.com/questions/56495152/how-to-store-arbitrary-json-object-in-sqlite-using-diesel", "title": "How to store arbitrary JSON object in sqlite using Diesel", "body": "<p>I have an input JSON:</p>\n\n<pre><code>{\"key1\": \"val1\", \"key2\": 1}\n</code></pre>\n\n<p>and I want to store it in an sqlite DB to later respond to some API request with the exact same value. </p>\n\n<p>This is my migration:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>CREATE TABLE my_table (\n    id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,\n    arbitrary_json TEXT NOT NULL\n);\n</code></pre>\n\n<p>My <code>Cargo.toml</code>:</p>\n\n<pre><code>[package]\nname = \"diesel_playground\"\nversion = \"0.1.0\"\nauthors = [\"User &lt;user@example.com&gt;\"]\nedition = \"2018\"\n\n[dependencies]\ndiesel = { version = \"1.4\" , features = [\"sqlite\"] }\nserde = { version = \"1.0\", features = [\"derive\"] }\nserde_json = \"1.0\"\n</code></pre>\n\n<p>Using following code:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[macro_use]\nextern crate diesel;\n\nmod schema;\n\nuse schema::my_table;\nuse serde::{Deserialize, Serialize};\n\nuse diesel::prelude::*;\nuse diesel::sqlite::SqliteConnection;\nuse std::env;\n\npub fn establish_connection() -&gt; SqliteConnection {\n    let database_url = env::var(\"DATABASE_URL\").expect(\"DATABASE_URL must be set\");\n    SqliteConnection::establish(&amp;database_url)\n        .expect(&amp;format!(\"Error connecting to {}\", database_url))\n}\n\n#[derive(Debug, Deserialize, Serialize, Queryable, Identifiable)]\n#[table_name = \"my_table\"]\nstruct Item {\n    id: i32,\n    arbitrary_json: serde_json::Value,\n}\n\n#[derive(Debug, Deserialize, Serialize, Insertable, Queryable)]\n#[table_name = \"my_table\"]\nstruct NewItem {\n    arbitrary_json: serde_json::Value,\n}\n\nfn main() {\n    let my_json = serde_json::json!({\n    \"key1\": \"val1\",\n    \"key2\": 1\n    });\n\n    let new_item = NewItem {\n        arbitrary_json: my_json,\n    };\n\n    let conn = establish_connection();\n\n    diesel::insert_into(my_table::table)\n        .values(&amp;new_item)\n        .execute(&amp;conn)\n        .expect(\"Error adding new item\");\n\n    let my_item = my_table::table\n        .find(1)\n        .first::&lt;Item&gt;(&amp;conn)\n        .expect(\"Error selecting id 1\");\n\n    assert!(my_item.arbitrary_json == new_item.arbitrary_json);\n}\n</code></pre>\n\n<p>I get the following error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: the trait bound `serde_json::value::Value: diesel::Expression` is not satisfied\n  --&gt; src/main.rs:27:41\n   |\n27 | #[derive(Debug, Deserialize, Serialize, Insertable, Queryable)]\n   |                                         ^^^^^^^^^^ the trait `diesel::Expression` is not implemented for `serde_json::value::Value`\n</code></pre>\n\n<p>I could create a model with <code>String</code> JSON representation and derive <code>From</code> / <code>Into</code> for API input type, but I don't want to insert <code>.into()</code> everywhere in my code now. A DRY solution would to be to do this as I proposed in the code attached. </p>\n"}, {"tags": ["parallel-processing", "rust", "rayon"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 4, "creation_date": 1559899071, "post_id": 56491377, "comment_id": 99571775, "body": "If you are doing speed comparision, always use <code>--release</code> or the button Release in the upper left corner of the playground (under Debug)!"}], "answers": [{"comments": [{"owner": {"reputation": 555, "user_id": 5572146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c799e0c44a11d16cc175a717d5dca855?s=128&d=identicon&r=PG&f=1", "display_name": "chpio", "link": "https://stackoverflow.com/users/5572146/chpio"}, "edited": false, "score": 1, "creation_date": 1559904532, "post_id": 56491856, "comment_id": 99574474, "body": "those are internal tasks, not real threads, but pretty much the same result here."}, {"owner": {"reputation": 555, "user_id": 5572146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c799e0c44a11d16cc175a717d5dca855?s=128&d=identicon&r=PG&f=1", "display_name": "chpio", "link": "https://stackoverflow.com/users/5572146/chpio"}, "edited": false, "score": 0, "creation_date": 1559904627, "post_id": 56491856, "comment_id": 99574517, "body": "The parallelization overhead is higher than the gains."}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "reply_to_user": {"reputation": 555, "user_id": 5572146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c799e0c44a11d16cc175a717d5dca855?s=128&d=identicon&r=PG&f=1", "display_name": "chpio", "link": "https://stackoverflow.com/users/5572146/chpio"}, "edited": false, "score": 0, "creation_date": 1559904643, "post_id": 56491856, "comment_id": 99574525, "body": "@chpio thanks for the particularization. Please feel free to <a href=\"https://stackoverflow.com/posts/56491856/edit\">edit</a> my answer, I will happily accept it."}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "reply_to_user": {"reputation": 555, "user_id": 5572146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c799e0c44a11d16cc175a717d5dca855?s=128&d=identicon&r=PG&f=1", "display_name": "chpio", "link": "https://stackoverflow.com/users/5572146/chpio"}, "edited": false, "score": 1, "creation_date": 1559921403, "post_id": 56491856, "comment_id": 99583419, "body": "@chpio: Indeed, it&#39;s an overhead issue. Each task that is created needs to be scheduled, sent to a thread, etc... In general, parallelization is only worth it for coarse-grained parallelism."}], "tags": [], "owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "is_accepted": true, "score": 3, "last_activity_date": 1559901983, "last_edit_date": 1559901983, "creation_date": 1559900462, "answer_id": 56491856, "question_id": 56491377, "link": "https://stackoverflow.com/questions/56491377/why-rayon-based-parallel-processing-takes-more-time-than-serial-processing/56491856#56491856", "title": "Why rayon-based parallel processing takes more time than serial processing?", "body": "<p>I think the real reason is, that you create <code>n\u00b2</code> threads which is not good. In every call of <code>fibonacci_parallel</code> you create another pair of threads for rayon and because you call <code>fibonacci_parallel</code> again in the closure you create yet another pair of threads.<br>\nThis is utterly terrible for the OS/rayon. </p>\n\n<p>An approach to solve this problem could be this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn fibonacci_parallel(n: u64) -&gt; u64 {\n    fn inner(n: u64) -&gt; u64 {\n        if n &lt;= 1 { \n            return n;\n        }   \n\n        inner(n - 2) + inner(n - 1)\n    }   \n\n    if n &lt;= 1 {\n        return n;\n    }   \n\n    let (a, b) = rayon::join(|| inner(n - 2), || inner(n - 1));\n    a + b \n}\n</code></pre>\n\n<p>You create two threads which both execute the inner function. With this addition I get</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>op@VBOX /t/t/foo&gt; cargo run --release 40\n    Finished release [optimized] target(s) in 0.03s\n     Running `target/release/foo 40`\n[s] The 40th number in the fibonacci sequence is 102334155, elapsed: 1373741\n[p] The 40th number in the fibonacci sequence is 102334155, elapsed: 847343\n</code></pre>\n\n<p>But as said, for low numbers parallel execution is not worth it:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>op@VBOX /t/t/foo&gt; cargo run --release 20\n    Finished release [optimized] target(s) in 0.02s\n     Running `target/release/foo 20`\n[s] The 10th number in the fibonacci sequence is 6765, elapsed: 82\n[p] The 10th number in the fibonacci sequence is 6765, elapsed: 241\n</code></pre>\n"}], "owner": {"reputation": 3589, "user_id": 337988, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a0929a98013283051149383445c2fad5?s=128&d=identicon&r=PG", "display_name": "philipjkim", "link": "https://stackoverflow.com/users/337988/philipjkim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 0, "accepted_answer_id": 56491856, "answer_count": 1, "score": 1, "last_activity_date": 1559901983, "creation_date": 1559898751, "question_id": 56491377, "link": "https://stackoverflow.com/questions/56491377/why-rayon-based-parallel-processing-takes-more-time-than-serial-processing", "title": "Why rayon-based parallel processing takes more time than serial processing?", "body": "<p>Learning <a href=\"https://github.com/rayon-rs/rayon\" rel=\"nofollow noreferrer\">Rayon</a>, I wanted to compare the performace of parallel calculation and serial calculation of Fibonacci series. Here's my code:</p>\n\n<pre><code>use rayon;\nuse std::time::Instant;\n\nfn main() {\n    let nth = 30;\n    let now = Instant::now();\n    let fib = fibonacci_serial(nth);\n    println!(\n        \"[s] The {}th number in the fibonacci sequence is {}, elapsed: {}\",\n        nth,\n        fib,\n        now.elapsed().as_micros()\n    );\n\n    let now = Instant::now();\n    let fib = fibonacci_parallel(nth);\n    println!(\n        \"[p] The {}th number in the fibonacci sequence is {}, elapsed: {}\",\n        nth,\n        fib,\n        now.elapsed().as_micros()\n    );\n}\n\nfn fibonacci_parallel(n: u64) -&gt; u64 {\n    if n &lt;= 1 {\n        return n;\n    }\n\n    let (a, b) = rayon::join(|| fibonacci_parallel(n - 2), || fibonacci_parallel(n - 1));\n    a + b\n}\n\nfn fibonacci_serial(n: u64) -&gt; u64 {\n    if n &lt;= 1 {\n        return n;\n    }\n\n    fibonacci_serial(n - 2) + fibonacci_serial(n - 1)\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=1b4f374369c4999b9c1c245e410884ef\" rel=\"nofollow noreferrer\">Run in Rust Playground</a></p>\n\n<p>I expected the elapsed time of parallel calculation would be smaller than the elapsed time of serial caculation, but the result was opposite:</p>\n\n<pre><code># `s` stands for serial calculation and `p` for parallel\n[s] The 30th number in the fibonacci sequence is 832040, elapsed: 12127\n[p] The 30th number in the fibonacci sequence is 832040, elapsed: 990379\n</code></pre>\n\n<p>My implementation for serial/parallel calculation would have flaws. But if not, why am I seeing these results?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1559888020, "post_id": 56488824, "comment_id": 99566789, "body": "What prevents you from creating a new <code>Vec</code> (with <code>vec![]</code>) and applying the answer you have linked to that created vec?"}, {"owner": {"reputation": 1694, "user_id": 2120073, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef20c298c7ab54852752660b22d0abc4?s=128&d=identicon&r=PG", "display_name": "Damian Dziaduch", "link": "https://stackoverflow.com/users/2120073/damian-dziaduch"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1559889187, "post_id": 56488824, "comment_id": 99567161, "body": "@hellow I am doing Code Kata - implement a Deadfish. I have a match which returns tuple (i32, Vec&lt;i32&gt;) in each arm, but one of arms is adding the element to the Vector. I&#39;d like to express it as <code>&#39;o&#39; =&gt; (value, result + !vec[value])</code> but it does not work... Here is my code: <a href=\"https://pastebin.com/6NZZCyit\" rel=\"nofollow noreferrer\">pastebin.com/6NZZCyit</a>"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1559889306, "post_id": 56488824, "comment_id": 99567206, "body": "Please answer my question... what prevents you from creating a new vec and doing the very same as in your linked answer to that newly created vec?"}, {"owner": {"reputation": 1694, "user_id": 2120073, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef20c298c7ab54852752660b22d0abc4?s=128&d=identicon&r=PG", "display_name": "Damian Dziaduch", "link": "https://stackoverflow.com/users/2120073/damian-dziaduch"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1559892889, "post_id": 56488824, "comment_id": 99568756, "body": "@hellow I can&#39;t make it in one line. Or maybe I am missing something. Please see my pastebin code, lines 8-11. I&#39;d like to make it in one statement"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1559893398, "post_id": 56488824, "comment_id": 99568996, "body": "What is so wrong in using multiple lines if the code gets cleaner? Sorry, but doing it in one line, is nothing one should enforce."}], "owner": {"reputation": 1694, "user_id": 2120073, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef20c298c7ab54852752660b22d0abc4?s=128&d=identicon&r=PG", "display_name": "Damian Dziaduch", "link": "https://stackoverflow.com/users/2120073/damian-dziaduch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "closed_date": 1559895551, "answer_count": 0, "score": 0, "last_activity_date": 1559888127, "creation_date": 1559887847, "last_edit_date": 1559888127, "question_id": 56488824, "link": "https://stackoverflow.com/questions/56488824/add-two-vectors-without-mutability", "closed_reason": "Duplicate", "title": "Add two vectors without mutability", "body": "<p>I want to add two Vectors which will give me another vector as a result without mutation of the existing ones:</p>\n\n<p>I found a related question, but it does mutate the first one, which I don't want.<br>\n<a href=\"https://stackoverflow.com/questions/40792801/best-way-to-concatenate-vectors-in-rust\">Best way to concatenate vectors in Rust</a></p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let vec1: Vec&lt;i32&gt; = vec![1, 2, 3];\nlet vec2: Vec&lt;i32&gt; = vec![4, 5, 6];\nlet vec3: Vec&lt;i32&gt; = ??; // expected vector equal to vec![1, 2, 3, 4, 5, 6];\n</code></pre>\n"}, {"tags": ["rust", "string-formatting"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559920643, "post_id": 56485167, "comment_id": 99582995, "body": "<i>But other answers do not address why the list above doesn&#39;t work</i> \u2014 sure they do: <a href=\"https://stackoverflow.com/a/44690529/155423\"><i>The 018 pads with zeros to a width of 18. That width includes 0b (length=2) plus a u16 (length=16) so 18 = 2 + 16</i></a>"}, {"owner": {"reputation": 447, "user_id": 2816391, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4a81809defa9e2b3b0b1e0540b699616?s=128&d=identicon&r=PG&f=1", "display_name": "user103185", "link": "https://stackoverflow.com/users/2816391/user103185"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559946022, "post_id": 56485167, "comment_id": 99592637, "body": "1) link 1 doesn&#39;t discuss the 2-character width requirement, and as many others do not discuss values below 16. 2) link 2 explains the mechanisms of the <code>#</code> option well, but doesn&#39;t address the dumb-founding specific case that occurs when rendering bytes (and which the compiler fails to flag). 3) The byte case is most common and yet is ignored even in the LowerHex docs. 4) No answer (anywhere) addresses that <code>#</code> has fundamental problems, so {:#04x} is erroneously recommended as a general solution. 5) No teaching of <code>0x{:02x}</code>, which would avoid the question from arising again."}], "answers": [{"comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 5, "creation_date": 1559859144, "post_id": 56485170, "comment_id": 99561467, "body": "Just <code>println!(&quot;{:#04x}&quot;, 10);</code> - -"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1559887589, "post_id": 56485170, "comment_id": 99566669, "body": "How do you know that it is a long-standing bug? Do you have an issue at the github repo?"}, {"owner": {"reputation": 29810, "user_id": 423170, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/H9kNQ.png?s=128&g=1", "display_name": "Frxstrem", "link": "https://stackoverflow.com/users/423170/frxstrem"}, "edited": false, "score": 0, "creation_date": 1559888037, "post_id": 56485170, "comment_id": 99566794, "body": "The <code>#</code> flag <i>should</i> make a difference, because it&#39;s telling it to use the alternate form (<code>0x</code> prefix for hex numbers). Not a bug. <a href=\"https://doc.rust-lang.org/std/fmt/#sign0\" rel=\"nofollow noreferrer\">doc.rust-lang.org/std/fmt/#sign0</a>"}], "tags": [], "owner": {"reputation": 447, "user_id": 2816391, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4a81809defa9e2b3b0b1e0540b699616?s=128&d=identicon&r=PG&f=1", "display_name": "user103185", "link": "https://stackoverflow.com/users/2816391/user103185"}, "is_accepted": false, "score": 2, "last_activity_date": 1559944707, "last_edit_date": 1559944707, "creation_date": 1559855549, "answer_id": 56485170, "question_id": 56485167, "link": "https://stackoverflow.com/questions/56485167/how-to-format-a-byte-into-a-2-digit-hex-string-in-rust/56485170#56485170", "title": "How to format a byte into a 2 digit hex string, in Rust", "body": "<p>If you use:</p>\n\n<pre><code>println!(\"10 is 0x{:02x} in hex\", 10);       // ==&gt; \"0x0a\"\n</code></pre>\n\n<p>Instead of:</p>\n\n<pre><code>println!(\"10 is {:#02x} in hex\", 10);        //     \"0xa\"\n</code></pre>\n\n<p>It works. </p>\n\n<p>However, as the commenters pointed out this is no bug, but confusion about the meaning of <code>02</code>. It does not mean the minimal number of <em>significant</em> digits, but the minimum total number of characters, which now must include <code>0x</code>. So this works also:</p>\n\n<pre><code>println!(\"10 is {:#04x} in hex\", 10);        //     \"0x0a\"\n</code></pre>\n\n<p>But there are problems with this solution and the culture that promotes this as the \"correct\" solution. </p>\n\n<p>First note that the inclusion of <code>0x</code> through <code>#</code> promotes the concept of total width, which the <code>04</code> now specifies. One needs to mentally subtract 2 to get to the significant digits, which is the significant part. Regardless <code>{:#04x}</code> will format 10000 as <code>0x2710</code>, which occupies 6 characters, not 4. So the concept of total width fails, as a concept, perhaps too trivially so. </p>\n\n<p>In addition <code>{:#03x}</code>, <code>{:#02x}</code> and <code>{:#01x}</code> confusingly all result in the same behaviour as `{:#x}, and are not flagged by the compiler (1.35) though they make no sense and indicate an error. </p>\n\n<p>Secondly, the <code>#</code> formatter is only useful for Rust-specific number representations, inserting for example <code>0x</code> but not <code>$</code> (another common hex representation format). </p>\n\n<p>Thirly, crucially, the concept of total width only becomes explicit when the <code>#</code> formatter is used (and then silently fails in the common byte case). The <code>#</code> formatter means Rust has <em>the option</em> to consider the total width, and one should use it when it applies (that is in the context of fixed-width layouts). </p>\n\n<p>The remainder shows why <code>#</code> is a special case solution, and why it is not recommended in the general case. </p>\n\n<p>A formatter string should be chosen depending on the context, specifically how one thinks about displaying a number in that context, as the chosen format expresses intent. So: </p>\n\n<ul>\n<li><p><code>{:#04x}</code> focuses on the total width, useful when doing a rigid fixed-width table layout. The <code>#</code> formatter clearly is ergonomic in this case. <code>{:#04x}</code> is also obviously useful when generating a custom formatting string (given a fixed-width context), for example when the output needs to be changed from hex to binary on demand (e.g. <code>{:#04x}</code> to <code>{:#04b}</code>), though it is hard to imagine concrete cases. </p></li>\n<li><p><code>0x{02x}</code> expresses the number of significant digits, useful when the main concern is how to represent information on a line, given limited space. A common edit in this case is to remove the <code>0x</code>. With <code>0x{:02x}</code> the <code>0x</code> is simply removed, whereas with the <code>{:#04}</code> formatter one would need to remove both the <code>#</code> and substitute the <code>04</code> for <code>02</code>. The end result is the same in both cases: <code>{:02x}</code>, but <code>#</code> required a concept shift. </p></li>\n</ul>\n\n<p>Depending on the case the <code>#</code> formatter is ergonomic and expressive of intent, or it is not. Use the format that meshes with what you want to achieve. But in the general case it is probably best to regard <code>#</code> as a relatively obscure feature. Its additional smartness is only desirable in well-defined cases. </p>\n\n<p>Unfortunately other answers suggest <code>{:#04x}</code> as the default, \"correct\" or the \"Rust solution\". However, the fact a certain feature (<code>#</code>) is available doesn't mean that:\n- Rust endorses it, or it is otherwise recommended to use it, \n- the underlying concept of total width needs expressing, or\n- the concept of total width should generalize to all of Rust format expressions (which is the root problem most answers demonstrate)</p>\n\n<p>In summary <em>Rust made <code>#</code> available, but <code>0x{:02x}</code> is still often simpler, more to the point and universally recognized. It is <a href=\"https://en.wikipedia.org/wiki/KISS_principle\" rel=\"nofollow noreferrer\">KISS</a> and doesn't have hidden defects</em>. </p>\n"}, {"tags": [], "owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "is_accepted": false, "score": 14, "last_activity_date": 1559917433, "last_edit_date": 1559917433, "creation_date": 1559891231, "answer_id": 56489516, "question_id": 56485167, "link": "https://stackoverflow.com/questions/56485167/how-to-format-a-byte-into-a-2-digit-hex-string-in-rust/56489516#56489516", "title": "How to format a byte into a 2 digit hex string, in Rust", "body": "<p>As documented in the <a href=\"https://doc.rust-lang.org/std/fmt/#sign0\" rel=\"noreferrer\"><code>std::fmt</code></a> module:</p>\n\n<blockquote>\n  <p><code>#</code> - This flag is indicates that the \"alternate\" form of printing should be used. The alternate forms are:</p>\n  \n  <ul>\n  <li><code>#x</code> - precedes the argument with a 0x</li>\n  <li><code>#X</code> - precedes the argument with a 0x</li>\n  </ul>\n</blockquote>\n\n<p>This interacts with the request width, because the width accounts for the <em>whole</em> substitution and thus <code>0x0a</code> is <strong>4</strong> characters, not 2.</p>\n\n<p>If you request a width that is less than the necessary width, the requested width is disregarded and the minimum width is used instead (here 3 characters).</p>\n\n<p>A quick experiment <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=fae66e4c050d1a343aa99881d91d2aad\" rel=\"noreferrer\">on the playground</a>:</p>\n\n<pre><code>fn main() {\n    println!(\"{:#01x}\", 10);\n    println!(\"{:#02x}\", 10);\n    println!(\"{:#03x}\", 10);\n    println!(\"{:#04x}\", 10);\n    println!(\"{:#05x}\", 10);\n    println!(\"{:#06x}\", 10);\n}\n</code></pre>\n\n<p>Prints:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>0xa\n0xa\n0xa\n0x0a\n0x00a\n0x000a\n</code></pre>\n\n<p>All is well.</p>\n"}], "owner": {"reputation": 447, "user_id": 2816391, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4a81809defa9e2b3b0b1e0540b699616?s=128&d=identicon&r=PG&f=1", "display_name": "user103185", "link": "https://stackoverflow.com/users/2816391/user103185"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8738, "favorite_count": 0, "closed_date": 1559917343, "answer_count": 2, "score": 8, "last_activity_date": 1559944707, "creation_date": 1559855529, "last_edit_date": 1559920268, "question_id": 56485167, "link": "https://stackoverflow.com/questions/56485167/how-to-format-a-byte-into-a-2-digit-hex-string-in-rust", "closed_reason": "Duplicate", "title": "How to format a byte into a 2 digit hex string, in Rust", "body": "<p>Commonly one wants to print a byte as 2 hex digits, for example <code>10</code> should give <code>0x0a</code>. In Rust one would use something like <code>println!(\"{:#02x}\", 10)</code>, but it gives <code>0xa</code>. </p>\n\n<p>A list of things I've tried (using info from <a href=\"https://doc.rust-lang.org/std/fmt/index.html\" rel=\"noreferrer\"><code>std::fmt</code></a> and <a href=\"https://doc.rust-lang.org/std/fmt/trait.LowerHex.html\" rel=\"noreferrer\"><code>fmt::LowerHex</code></a> and several StackOverflow questions):</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>println!(\"{:#02x}\", 10);\nprintln!(\"{:#0x}\", 10);\nprintln!(\"{:#x}\", 10);\nprintln!(\"{:#x?}\", 10);\nprintln!(\"{:#0x?}\", 10);\nprintln!(\"{:#02x?}\", 10);\n</code></pre>\n\n<p>All of them output <code>0xa</code>, instead of the desired behavior of <code>0x0A</code>.</p>\n\n<hr>\n\n<p>This question has been edited (removing relevant emotion), and subsequently marked as a duplicate of other questions. But other answers do not address why the list above doesn't work. The <code>#</code> format option results in unexpected output (<code>0xa</code>), and in particular the <code>02</code>, surprisingly, has <em>no effect at all!</em> No other question focusses on this, nor on <code>#</code> in particular. </p>\n"}, {"tags": ["c++", "rust"], "comments": [{"owner": {"reputation": 14316, "user_id": 1012936, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/eXQaP.png?s=128&g=1", "display_name": "milleniumbug", "link": "https://stackoverflow.com/users/1012936/milleniumbug"}, "edited": false, "score": 9, "creation_date": 1559840291, "post_id": 56481970, "comment_id": 99554395, "body": "C++&#39;s <code>std::vector&lt;T&gt;</code> has no guarantees on layout (it&#39;s very likely to be different across standard library implementations). You need to reduce it to something that both languages can understand, possibly something like passing <code>vec.data()</code> and <code>vec.size()</code> separately."}], "answers": [{"comments": [{"owner": {"reputation": 83, "user_id": 10187655, "user_type": "registered", "profile_image": "https://graph.facebook.com/2116278275111701/picture?type=large", "display_name": "Artem Kolokoltsev", "link": "https://stackoverflow.com/users/10187655/artem-kolokoltsev"}, "edited": false, "score": 0, "creation_date": 1559898775, "post_id": 56483580, "comment_id": 99571620, "body": "Thank you! Great answer! Also working with <code>std::vector&lt;struct my_struct&gt;</code> -&gt; <code>Vec&lt;MyStruct&gt;</code>! Very helpful!"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "reply_to_user": {"reputation": 83, "user_id": 10187655, "user_type": "registered", "profile_image": "https://graph.facebook.com/2116278275111701/picture?type=large", "display_name": "Artem Kolokoltsev", "link": "https://stackoverflow.com/users/10187655/artem-kolokoltsev"}, "edited": false, "score": 0, "creation_date": 1559899235, "post_id": 56483580, "comment_id": 99571865, "body": "@ArtemKolokoltsev Be sure to at least use <a href=\"https://doc.rust-lang.org/nomicon/other-reprs.html#reprc\" rel=\"nofollow noreferrer\"><code>#[repr(C)]</code></a> on Rust side, it&#39;s not perfect but better than nothing, be aware that you could run into problem if you are not extra careful with data representation. &quot;We strongly recommend using rust-bindgen and/or cbindgen to manage your FFI boundaries for you.&quot;"}], "tags": [], "owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "is_accepted": true, "score": 9, "last_activity_date": 1559849375, "last_edit_date": 1559849375, "creation_date": 1559847626, "answer_id": 56483580, "question_id": 56481970, "link": "https://stackoverflow.com/questions/56481970/what-is-the-best-way-to-convert-from-a-c-stdvectorfloat-to-a-rust-vecf32/56483580#56483580", "title": "What is the best way to convert from a C++ std::vector&lt;float&gt; to a Rust Vec&lt;f32&gt;?", "body": "<p>One thing to know is that C++ doesn't allow giving away the ownership of the data vector. This is a limitation of the C++ design. There are some <a href=\"https://stackoverflow.com/questions/9123022/preventing-a-destructor-from-running-in-c#9123068\">tricks</a> but I don't advise using them. To stay \"safe\", you can only borrow a C++ vector.</p>\n\n<p>This can be done easily, using <a href=\"https://en.cppreference.com/w/cpp/container/vector/data\" rel=\"noreferrer\"><code>vector::data()</code></a> and <a href=\"https://en.cppreference.com/w/cpp/container/vector/size\" rel=\"noreferrer\"><code>vector::size()</code></a>:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>#include &lt;cstddef&gt;\n#include &lt;vector&gt;\n\nextern \"C\" void show_vector(float const *data, std::size_t size);\n\nint main() {\n    std::vector&lt;float&gt; vec{10, 20};\n    show_vector(vec.data(), vec.size());\n}\n</code></pre>\n\n<p>The Rust side can use <a href=\"https://doc.rust-lang.org/std/slice/fn.from_raw_parts.html\" rel=\"noreferrer\"><code>slice::from_raw_parts()</code></a>, creating a view of our vector without taking ownership.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use libc::{c_float, size_t};\n\nextern \"C\" fn show_vector(data: *const c_float, size: size_t) {\n    let vec = unsafe { std::slice::from_raw_parts(data, size) };\n    for x in vec {\n        println!(\"{}\", x);\n    }\n}\n</code></pre>\n\n<p>Read more:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/24105186/can-i-call-c-or-c-functions-from-rust-code/50230460#50230460\">Can I call C or C++ functions from Rust code?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/27150652/how-can-i-get-an-array-or-a-slice-from-a-raw-pointer\">How can I get an array or a slice from a raw pointer?</a></li>\n</ul>\n"}], "owner": {"reputation": 83, "user_id": 10187655, "user_type": "registered", "profile_image": "https://graph.facebook.com/2116278275111701/picture?type=large", "display_name": "Artem Kolokoltsev", "link": "https://stackoverflow.com/users/10187655/artem-kolokoltsev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 865, "favorite_count": 1, "accepted_answer_id": 56483580, "answer_count": 1, "score": 6, "last_activity_date": 1559849375, "creation_date": 1559839939, "last_edit_date": 1559849148, "question_id": 56481970, "link": "https://stackoverflow.com/questions/56481970/what-is-the-best-way-to-convert-from-a-c-stdvectorfloat-to-a-rust-vecf32", "title": "What is the best way to convert from a C++ std::vector&lt;float&gt; to a Rust Vec&lt;f32&gt;?", "body": "<p>I wrote a test program to check that the data will be read correctly on the Rust.</p>\n\n<p>C++ code:</p>\n\n<pre><code>std::vector&lt;float&gt; vec;\nvec.push_back(10);\nvec.push_back(20);\nstd::cout &lt;&lt; \"len is \" &lt;&lt; get_len(&amp;vec);\n</code></pre>\n\n<p>Rust code:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[no_mangle]\npub extern \"C\" fn get_len(vec: *const Vec&lt;f32&gt;) -&gt; i32 {\n    let vec= unsafe { &amp;*vec};\n    vec.len() as i32\n}\n</code></pre>\n\n<p>My output looks like this and is always different:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>len is 603268424\n</code></pre>\n"}, {"tags": ["rust"], "answers": [{"tags": [], "owner": {"reputation": 9010, "user_id": 2588800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/847da843d41921363502159c8b7e5549?s=128&d=identicon&r=PG", "display_name": "Svetlin Zarev", "link": "https://stackoverflow.com/users/2588800/svetlin-zarev"}, "is_accepted": true, "score": 3, "last_activity_date": 1559831622, "last_edit_date": 1559831622, "creation_date": 1559824645, "answer_id": 56477758, "question_id": 56477618, "link": "https://stackoverflow.com/questions/56477618/what-is-the-difference-between-type-casting-by-setting-the-type-of-a-variable-an/56477758#56477758", "title": "What is the difference between type casting by setting the type of a variable and using `as`?", "body": "<p>The issue lies in the <code>.collect()</code> method. From it's <a href=\"https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.collect\" rel=\"nofollow noreferrer\">documentation</a>:</p>\n\n<blockquote>\n  <p>Because <code>collect()</code> is so general, it can cause problems with type\n  inference. As such, <code>collect()</code> is one of the few times you'll see the\n  syntax affectionately known as the 'turbofish': <code>::&lt;&gt;</code>. This helps the\n  inference algorithm understand specifically which collection you're\n  trying to collect into.</p>\n</blockquote>\n\n<p>The compiler cannot infer the collection type you want to use, hence the need to specify it explicitly.</p>\n\n<p>Some examples:</p>\n\n<pre><code>fn main() {\n    let s = String::from(\"magic\");\n\n    //different ways to specify the target type\n    //1. -&gt; explicitly declaring the variable type\n    //2. -&gt; turbofish syntax (great article about it: https://matematikaadit.github.io/posts/rust-turbofish.html)\n\n    let a1: String = s.chars().skip(0).take(s.len() - 2).collect();\n    let a2 = s.chars().skip(0).take(s.len() - 2).collect::&lt;String&gt;();\n\n    let b1: Vec&lt;char&gt; = s.chars().skip(0).take(s.len() - 2).collect();\n    let b2 = s.chars().skip(0).take(s.len() - 2).collect::&lt;Vec&lt;char&gt;&gt;();\n\n    let c1: HashSet&lt;char&gt; = s.chars().skip(0).take(s.len() - 2).collect();\n    let c2 = s.chars().skip(0).take(s.len() - 2).collect::&lt;HashSet&lt;char&gt;&gt;();\n}\n</code></pre>\n\n<p>As the examples show, many target types are valid and there is no way for the compiler to decide what your intention was.</p>\n"}, {"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 3, "last_activity_date": 1559832076, "creation_date": 1559832076, "answer_id": 56479905, "question_id": 56477618, "link": "https://stackoverflow.com/questions/56477618/what-is-the-difference-between-type-casting-by-setting-the-type-of-a-variable-an/56479905#56479905", "title": "What is the difference between type casting by setting the type of a variable and using `as`?", "body": "<p>Explicitly typing a variable is <strong>not</strong> a type cast.</p>\n\n<p>As thoroughly explained elsewhere, <a href=\"https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.collect\" rel=\"nofollow noreferrer\"><code>Iterator::collect</code></a> requires knowing the concrete type to collect into.</p>\n\n<p>A type cast, such as that performed by <code>as</code>, requires converting from one type to another. You've specified the <em>second</em> type (<code>String</code>), but there's still no way for the compiler to deduce what the <em>first</em> type should be.</p>\n\n<h3>Turbofish</h3>\n\n<p>The syntax you want in today's Rust is the <em>turbofish</em>:</p>\n\n<pre><code>use std::fs;\n\nfn main() {\n    let s = fs::read_to_string(\"tt.txt\").expect(\"Wow\");\n\n    println!(\n        \"{}\",\n        s.chars().skip(0).take(s.len() - 2).collect::&lt;String&gt;()\n    );\n}\n</code></pre>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/27909064/155423\">How to put a type annotation in an iterator&#39;s collect statement?</a></li>\n<li><a href=\"https://stackoverflow.com/q/52360464/155423\">What is the syntax: `instance.method::&lt;SomeThing&gt;()`?</a></li>\n</ul>\n\n<h3>Type Ascription</h3>\n\n<p>As a nightly feature, you could also use the experimental <em>type ascription</em>:</p>\n\n<pre><code>#![feature(type_ascription)]\n\nuse std::fs;\n\nfn main() {\n    let s = fs::read_to_string(\"tt.txt\").expect(\"Wow\");\n\n    println!(\n        \"{}\",\n        s.chars().skip(0).take(s.len() - 2).collect(): String\n    );\n}\n</code></pre>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/36389974/155423\">What is type ascription?</a></li>\n</ul>\n\n<h3>Other</h3>\n\n<p>You don't need to write <code>read_string</code>.</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/31192956/155423\">What&#39;s the de-facto way of reading and writing files in Rust 1.x?</a></li>\n</ul>\n"}], "owner": {"reputation": 65, "user_id": 11321136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/974eb209d0a62f29e3e9e8cd677f6800?s=128&d=identicon&r=PG&f=1", "display_name": "unegare", "link": "https://stackoverflow.com/users/11321136/unegare"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 264, "favorite_count": 0, "accepted_answer_id": 56477758, "answer_count": 2, "score": 0, "last_activity_date": 1559832076, "creation_date": 1559824122, "last_edit_date": 1559831518, "question_id": 56477618, "link": "https://stackoverflow.com/questions/56477618/what-is-the-difference-between-type-casting-by-setting-the-type-of-a-variable-an", "title": "What is the difference between type casting by setting the type of a variable and using `as`?", "body": "<p>What is the difference between these two cases? Why does the commented line compile but the last line in the main is incorrect?</p>\n\n<p>How to cut string (<code>substr</code> in C++ with non-const arguments) without an extra variable?</p>\n\n<pre><code>use std::fs::File;\nuse std::io;\nuse std::io::Read;\n\nfn read_string(filename: &amp;str) -&gt; Result&lt;String, io::Error&gt; {\n    let mut s = String::new();\n    File::open(filename)?.read_to_string(&amp;mut s)?;\n    Ok(s)\n}\n\nfn main() {\n    let s = read_string(\"tt.txt\").expect(\"Wow\");\n\n    // let s2: String = s.chars().skip(0).take(s.len() -2).collect();\n\n    println!(\n        \"{}\",\n        s.chars().skip(0).take(s.len() - 2).collect() as String\n    );\n}\n</code></pre>\n"}, {"tags": ["windows", "rust"], "comments": [{"owner": {"reputation": 69264, "user_id": 256138, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ed9e8c0ff767e38f8fade11f5af00a45?s=128&d=identicon&r=PG", "display_name": "rubenvb", "link": "https://stackoverflow.com/users/256138/rubenvb"}, "edited": false, "score": 1, "creation_date": 1559831553, "post_id": 56473344, "comment_id": 99550030, "body": "Could it be another DLL that&#39;s missing? I&#39;m thinking maybe a GCC runtime lib (<code>libgcc*.dll</code>, <code>ibstdc++*.dll</code>)"}, {"owner": {"reputation": 3134, "user_id": 7607408, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/J7ZMW.jpg?s=128&g=1", "display_name": "Yair Halberstadt", "link": "https://stackoverflow.com/users/7607408/yair-halberstadt"}, "reply_to_user": {"reputation": 69264, "user_id": 256138, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ed9e8c0ff767e38f8fade11f5af00a45?s=128&d=identicon&r=PG", "display_name": "rubenvb", "link": "https://stackoverflow.com/users/256138/rubenvb"}, "edited": false, "score": 0, "creation_date": 1559834667, "post_id": 56473344, "comment_id": 99551761, "body": "@rubenvb how would I find that out?"}, {"owner": {"reputation": 69264, "user_id": 256138, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ed9e8c0ff767e38f8fade11f5af00a45?s=128&d=identicon&r=PG", "display_name": "rubenvb", "link": "https://stackoverflow.com/users/256138/rubenvb"}, "edited": false, "score": 0, "creation_date": 1559845797, "post_id": 56473344, "comment_id": 99556724, "body": "If you have MSYS2 installed, you could run its <code>ldd</code> utility on the executable (or the mentioned dll) and see if it finds all the dependent DLLs (and where it gets them from). Then figure out if the build procedure can logically find them in the same locations (i.e. are the found DLLs in PATH or next to the executables being run?)"}, {"owner": {"reputation": 1714, "user_id": 7404323, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/jYEFn.png?s=128&g=1", "display_name": "sailfish009", "link": "https://stackoverflow.com/users/7404323/sailfish009"}, "edited": false, "score": 1, "creation_date": 1559964605, "post_id": 56473344, "comment_id": 99594927, "body": "i had reported issue to rust github: <a href=\"https://github.com/rust-lang/rust/issues/61561\" rel=\"nofollow noreferrer\">github.com/rust-lang/rust/issues/61561</a> , i regularly build rust with msys64 env, i had found the issue 2019.05, but had no time."}, {"owner": {"reputation": 1714, "user_id": 7404323, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/jYEFn.png?s=128&g=1", "display_name": "sailfish009", "link": "https://stackoverflow.com/users/7404323/sailfish009"}, "reply_to_user": {"reputation": 69264, "user_id": 256138, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ed9e8c0ff767e38f8fade11f5af00a45?s=128&d=identicon&r=PG", "display_name": "rubenvb", "link": "https://stackoverflow.com/users/256138/rubenvb"}, "edited": false, "score": 0, "creation_date": 1560198088, "post_id": 56473344, "comment_id": 99649355, "body": "@rubenvb dumpbin is more useful than ldd in this case. ldd only shows ??? for the missing dependents."}], "answers": [{"tags": [], "owner": {"reputation": 1714, "user_id": 7404323, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/jYEFn.png?s=128&g=1", "display_name": "sailfish009", "link": "https://stackoverflow.com/users/7404323/sailfish009"}, "is_accepted": false, "score": 1, "last_activity_date": 1560696296, "last_edit_date": 1560696296, "creation_date": 1560570976, "answer_id": 56607197, "question_id": 56473344, "link": "https://stackoverflow.com/questions/56473344/couldnt-load-codegen-backend-when-compiling-rust-on-windows-using-mingw-64/56607197#56607197", "title": "Couldn&#39;t load codegen backend when compiling Rust on Windows using mingw_64", "body": "<p>found the reason, latest mingw gcc 9.1.0 cause some missing dll problem. (although, compile rust source was fine).</p>\n\n<p>if you have old version msys2, this will works for you:</p>\n\n<pre><code>pacman -R  mingw-w64-x86_64-gcc mingw-w64-x86_64-cmake\npacman -R  mingw-w64-x86_64-gcc-libs  \n\npacman -U /var/cache/pacman/pkg/mingw-w64-x86_64-gcc-libs-8.3.0-2-any.pkg.tar.xz\npacman -U /var/cache/pacman/pkg/mingw-w64-x86_64-gcc-8.3.0-2-any.pkg.tar.xz\npacman -U /var/cache/pacman/pkg/mingw-w64-x86_64-cmake-3.14.4-1-any.pkg.tar.xz\n\n./x.py install\nrustc -vV\nrustc 1.37.0-dev\nbinary: rustc\ncommit-hash: unknown\ncommit-date: unknown\nhost: x86_64-pc-windows-gnu\nrelease: 1.37.0-dev\nLLVM version: 8.0\n</code></pre>\n"}], "owner": {"reputation": 3134, "user_id": 7607408, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/J7ZMW.jpg?s=128&g=1", "display_name": "Yair Halberstadt", "link": "https://stackoverflow.com/users/7607408/yair-halberstadt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1560696296, "creation_date": 1559808425, "last_edit_date": 1559831228, "question_id": 56473344, "link": "https://stackoverflow.com/questions/56473344/couldnt-load-codegen-backend-when-compiling-rust-on-windows-using-mingw-64", "title": "Couldn&#39;t load codegen backend when compiling Rust on Windows using mingw_64", "body": "<p>I'm compiling Rust on Windows using mingw_64 and GCC. I get the following error:</p>\n\n<blockquote>\n  <p>error: couldn't load codegen backend \"E:\\rust_git\\rust\\build\\x86_64-pc-windows-gnu\\stage1\\lib\\rustlib\\x86_64-pc-windows-gnu\\codegen-backends\\rustc_codegen_llvm-llvm.dll\": \"The specified procedure could not be found. (os error 127)\"</p>\n</blockquote>\n\n<p>Unlike <a href=\"https://stackoverflow.com/questions/53587933/how-do-i-fix-the-error-couldnt-load-codegen-backend-on-macos\">How do I fix the error &quot;couldn&#39;t load codegen backend&quot; on macOS?</a>, the file <code>rustc_codegen_llvm-llvm.dll</code> does live in the correct directory.</p>\n"}, {"tags": ["vector", "collections", "rust", "type-conversion", "newtype"], "comments": [{"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 1, "creation_date": 1559809195, "post_id": 56471878, "comment_id": 99537607, "body": "Note that it is <a href=\"https://stackoverflow.com/q/40006219/1233251\">not idiomatic for functions to accept an immutable reference to <code>Vec</code></a>."}], "answers": [{"comments": [{"owner": {"reputation": 3190, "user_id": 141881, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/7DLiX.png?s=128&g=1", "display_name": "pospi", "link": "https://stackoverflow.com/users/141881/pospi"}, "edited": false, "score": 0, "creation_date": 1560162757, "post_id": 56473555, "comment_id": 99633284, "body": "I see! Thankyou. So, for clarity- the <code>str</code> / <code>String</code> isn&#39;t so much the culprit here as the <code>[T]</code> / <code>Vec&lt;T&gt;</code>, correct?  And I also presume this cannot be alleviated without changing the definition of the called function (in this case, <code>process_array_of_strings</code>), which is why use of the non-generic form is discouraged?"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "reply_to_user": {"reputation": 3190, "user_id": 141881, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/7DLiX.png?s=128&g=1", "display_name": "pospi", "link": "https://stackoverflow.com/users/141881/pospi"}, "edited": false, "score": 0, "creation_date": 1560181110, "post_id": 56473555, "comment_id": 99642223, "body": "@pospi if you want use trait, use a generic is the most simple and zero cost solution."}, {"owner": {"reputation": 3190, "user_id": 141881, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/7DLiX.png?s=128&g=1", "display_name": "pospi", "link": "https://stackoverflow.com/users/141881/pospi"}, "edited": false, "score": 0, "creation_date": 1560323300, "post_id": 56473555, "comment_id": 99693251, "body": "Yeah, I get that. What I&#39;m saying is that in this particular case (which I just confirmed by trying it out), it&#39;s not actually the <code>String</code> that is preventing the conversion into <code>process_array_of_strings</code> from working. It will <i>work</i> with <code>String</code>, just not efficiently. It&#39;s the <code>Vec&lt;T&gt;</code> parameter type that means the argument can&#39;t be coerced, because the wrapper type gets in the way of type inference."}], "tags": [], "owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "is_accepted": true, "score": 1, "last_activity_date": 1559809342, "creation_date": 1559809342, "answer_id": 56473555, "question_id": 56471878, "link": "https://stackoverflow.com/questions/56471878/how-do-i-coerce-types-of-iterator-elements-to-from-a-newtype/56473555#56473555", "title": "How do I coerce types of iterator elements to &amp; from a newtype?", "body": "<p>Simple, just use generic:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct Tag(String);\n\nimpl AsRef&lt;str&gt; for Tag {\n    fn as_ref(&amp;self) -&gt; &amp;str {\n        &amp;self.0\n    }\n}\n\nfn process_item(tags: &amp;[Tag]) {\n    process_array_of_strings(tags);\n}\n\nfn process_array_of_strings&lt;'a, T&gt;(strings: &amp;[T])\nwhere\n    T: AsRef&lt;str&gt;,\n{\n    // ...\n}\n</code></pre>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/40006219/why-is-it-discouraged-to-accept-a-reference-to-a-string-string-vec-vec-o\">Why is it discouraged to accept a reference to a String (&amp;String), Vec (&amp;Vec), or Box (&amp;Box) as a function argument?</a></li>\n<li>Here we simply ask that <code>T</code> implement <code>AsRef&lt;str&gt;</code> (more generic than <code>String</code>) so you can just use <a href=\"https://doc.rust-lang.org/std/convert/trait.AsRef.html#tymethod.as_ref\" rel=\"nofollow noreferrer\"><code>as_ref()</code></a> after on it.</li>\n</ul>\n"}], "owner": {"reputation": 3190, "user_id": 141881, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/7DLiX.png?s=128&g=1", "display_name": "pospi", "link": "https://stackoverflow.com/users/141881/pospi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 261, "favorite_count": 0, "accepted_answer_id": 56473555, "answer_count": 1, "score": 0, "last_activity_date": 1559809342, "creation_date": 1559802088, "last_edit_date": 1559809053, "question_id": 56471878, "link": "https://stackoverflow.com/questions/56471878/how-do-i-coerce-types-of-iterator-elements-to-from-a-newtype", "title": "How do I coerce types of iterator elements to &amp; from a newtype?", "body": "<p>Doing some experiments with newtypes and looking for the most efficient, most ergonomic way of dealing with converting elements in collections. For singular values, pretty standard type conversion traits seem to work just fine:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct Tag(String);\n\nimpl From&lt;Tag&gt; for String {\n    fn from(v: Tag) -&gt; String {\n        v.0\n    }\n}\n\nimpl From&lt;String&gt; for Tag {\n    fn from(v: String) -&gt; Tag {\n        Tag(v)\n    }\n}\n\nimpl AsRef&lt;String&gt; for Tag {\n    fn as_ref(&amp;self) -&gt; &amp;String {\n        &amp;self.0\n    }\n}\n\nimpl&lt;'a&gt; From&lt;&amp;'a Tag&gt; for String {\n    fn from(t: &amp;Tag) -&gt; String {\n        t.0.clone()\n    }\n}\n</code></pre>\n\n<p>But, I start to hit issues when I want to deal with lists of items. Say (for the purposes of illustration) I have a function which processes tags, and some more abstract function which deals with writing strings to a DB:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn process_item(tags: &amp;Vec&lt;Tag&gt;) {\n    process_array_of_strings(tags);\n}\n\nfn process_array_of_strings(strings: &amp;Vec&lt;String&gt;) {\n    // ...\n}\n</code></pre>\n\n<p>This won't compile because Rust can't coerce <code>tags</code> to a <code>Vec&lt;String&gt;</code>, and it feels to me like there should be some way of doing this more easily than:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn process_item(tags: &amp;Vec&lt;Tag&gt;) {\n    let str_tags: Vec&lt;String&gt; = tags.iter().map(|t| t.into()).collect();\n    process_array_of_strings(&amp;str_tags);\n}\n</code></pre>\n\n<p>...which besides being verbose, involves much more intermediary memory than I'd like. The reverse conversion is also an issue, but presumably would be implemented in the same way.</p>\n\n<p>There may be some additional things in play here, for example whether I should be sending <code>Vec</code>s of references rather than values, and whether or not it's a good idea to implement type conversions from reference types.</p>\n"}, {"tags": ["rust", "hyper"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559780043, "post_id": 56469502, "comment_id": 99530275, "body": "It looks like your question might be answered by the answers of <a href=\"https://stackoverflow.com/q/27831944/155423\">How do I store a closure in a struct in Rust?</a>. If not, please <b><a href=\"https://stackoverflow.com/posts/56469502/edit\">edit</a></b> your question to explain the differences. Otherwise, we can mark this question as already answered."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559780168, "post_id": 56469502, "comment_id": 99530295, "body": "TL;DR the duplicate: yes, box the closure, or the thing containing the closure, and create a boxed trait object."}, {"owner": {"reputation": 63, "user_id": 7335437, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5Tq4v.jpg?s=128&g=1", "display_name": "muskox", "link": "https://stackoverflow.com/users/7335437/muskox"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 2, "creation_date": 1559782591, "post_id": 56469502, "comment_id": 99530628, "body": "I understand how boxed trait objects work in general, I&#39;m not sure how to apply them to the problem I have. What type should the boxed closure have? Specifically, what return type?"}, {"owner": {"reputation": 734, "user_id": 158490, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/09f732c9a6b9cb2c405c086e63dc96d4?s=128&d=identicon&r=PG", "display_name": "Erigami", "link": "https://stackoverflow.com/users/158490/erigami"}, "edited": false, "score": 0, "creation_date": 1585320091, "post_id": 56469502, "comment_id": 107725649, "body": "@muskox Did you sort this out? I have the same question."}], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 7335437, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5Tq4v.jpg?s=128&g=1", "display_name": "muskox", "link": "https://stackoverflow.com/users/7335437/muskox"}, "edited": false, "score": 2, "creation_date": 1559920638, "post_id": 56485577, "comment_id": 99582992, "body": "Thanks for the answer! <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=cdd2c8af1e1c442688fc677c7e90ba9f\" rel=\"nofollow noreferrer\">Adding a type parameter doesn&#39;t work</a> because my app is not generic for different types, it uses a specific type. Finding the type of the <code>MakeService</code> is precisely what I&#39;m having trouble with, it&#39;s a closure that returns a type that&#39;s private to <code>hyper</code>."}], "tags": [], "owner": {"reputation": 39, "user_id": 9553436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f158ba6c2a731df13d00df8cb3b347d6?s=128&d=identicon&r=PG&f=1", "display_name": "ZakCodes", "link": "https://stackoverflow.com/users/9553436/zakcodes"}, "is_accepted": false, "score": 2, "last_activity_date": 1559917048, "last_edit_date": 1559917048, "creation_date": 1559858194, "answer_id": 56485577, "question_id": 56469502, "link": "https://stackoverflow.com/questions/56469502/how-to-store-a-hyperserverserver-as-a-field-in-a-struct/56485577#56485577", "title": "How to store a hyper::server::Server as a field in a struct?", "body": "<p>The problem is due to a type mismatch. In Rust, a type parameter is part of the type of a struct, so the type parameters for the server in your struct must match the ones you defined in your struct. In your case they don't. </p>\n\n<p>There are 2 solutions to your problem.</p>\n\n<h1>Add a type parameter for the second server parameter to your struct</h1>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct App&lt;T&gt; {\n    inner: Server&lt;AddrIncoming, T&gt;,\n}\n</code></pre>\n\n<p>Now you'll be able to create apps with different types for the second type parameter of the server</p>\n\n<h1>Find the type of the second argument of the server that you are creating</h1>\n\n<p>In your case, the type of the second argument is ``, so you would declare your struct like this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>type Service = ?; // This is really hard to find in this case.\npub struct App {\n    inner: Server&lt;AddrIncoming, Service&gt;,\n}\n</code></pre>\n\n<h2>Conclusion</h2>\n\n<p>In your case, I would recommend the first one because the type of the second type parameter of <code>Server</code> is hard to find and could very well change during the development of your program, so it's much easier to just have a type parameter on your struct.</p>\n\n<p>However, sometimes you won't be able to use certain method on your server if you don't know that its type parameters don't implement certain traits, so you can add these traits to your type parameter like this: </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct App&lt;T: Service&gt; {\n    inner: Server&lt;AddrIncoming, T&gt;,\n}\n</code></pre>\n\n<p>It is recommended not to put the type parameters on the struct itself and to only put them on the <code>impl</code> blocks:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct App&lt;T&gt; {\n    inner: Server&lt;AddrIncoming, T&gt;,\n}\n\nimpl App&lt;T: Service&gt; {\n   // Here you'll be able to use the method from Server where T has to be a Service.\n}\n</code></pre>\n\n<p>You can also do the same for functions like this: </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct App&lt;T&gt; {\n    inner: Server&lt;AddrIncoming, T&gt;,\n}\n\nfn some_function(app: App&lt;T: Service&gt;) {\n   // Here you'll be able to use the method from Server where T has to be a Service\n}\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 7335437, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5Tq4v.jpg?s=128&g=1", "display_name": "muskox", "link": "https://stackoverflow.com/users/7335437/muskox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1559917048, "creation_date": 1559779585, "last_edit_date": 1559779960, "question_id": 56469502, "link": "https://stackoverflow.com/questions/56469502/how-to-store-a-hyperserverserver-as-a-field-in-a-struct", "title": "How to store a hyper::server::Server as a field in a struct?", "body": "<p>I have a library which uses hyper internally. I want the user to be able to create an <code>App</code>which contains a <code>Server</code> internally that handles HTTP connections.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use hyper::server::conn::AddrIncoming;\nuse hyper::server::Server;\nuse hyper::service::service_fn_ok;\nuse std::net::SocketAddr;\n\npub struct App {\n    inner: Server&lt;AddrIncoming, ()&gt;,\n}\n\nimpl App {\n    pub fn new() -&gt; Self {\n        let addr = SocketAddr::from(([0, 0, 0, 0], 3000));\n        let inner = Server::bind(&amp;addr).serve(|| service_fn_ok(|_req| unimplemented!()));\n\n        App { inner }\n    }\n}\n</code></pre>\n\n<p>(<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=3e38863abe9f31dacf0ae064e9db2085\" rel=\"noreferrer\">Playground link</a>)</p>\n\n<p>The error is, as expected:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0308]: mismatched types\n  --&gt; src/lib.rs:15:15\n   |\n15 |         App { inner }\n   |               ^^^^^ expected (), found closure\n   |\n   = note: expected type `hyper::server::Server&lt;_, ()&gt;`\n              found type `hyper::server::Server&lt;_, [closure@src/lib.rs:13:47: 13:88]&gt;`\n</code></pre>\n\n<p>It's not well documented, but the second type parameter for <code>Server</code> is the kind of <code>MakeService</code> it uses.</p>\n\n<p>I can't figure out how to refer to the closure in the type of <code>inner</code>. Is there some way that I can box the closure to make the code compile? Is there a way to implement <code>MakeService</code> by hand, instead of using a closure?</p>\n\n<p>The hyper docs refer to the function <code>make_service_fn</code>, which returns a <code>MakeServiceFn</code>, but the type isn't public, so I can't use it in the type of <code>inner</code>.</p>\n"}]