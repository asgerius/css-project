[{"tags": ["kotlin"], "answers": [{"comments": [{"owner": {"reputation": 33762, "user_id": 16050, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/7e1282298aec568f8bad5afe46cb40b8?s=128&d=identicon&r=PG", "display_name": "sanity", "link": "https://stackoverflow.com/users/16050/sanity"}, "edited": false, "score": 0, "creation_date": 1436378752, "post_id": 31299114, "comment_id": 50590953, "body": "Thank you.  I do want to use Gradle to build the project, due to continuous integration and automated deployment.  Will the &quot;kotlin&quot; and &quot;kotlin2js&quot; plugins clash if used in the same Gradle build file?"}, {"owner": {"reputation": 3668, "user_id": 239266, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2072a8f90f9fe379ca21c3af39a3757?s=128&d=identicon&r=PG", "display_name": "Hadi Hariri", "link": "https://stackoverflow.com/users/239266/hadi-hariri"}, "reply_to_user": {"reputation": 33762, "user_id": 16050, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/7e1282298aec568f8bad5afe46cb40b8?s=128&d=identicon&r=PG", "display_name": "sanity", "link": "https://stackoverflow.com/users/16050/sanity"}, "edited": false, "score": 0, "creation_date": 1437111912, "post_id": 31299114, "comment_id": 50903900, "body": "I&#39;ve not tried it. I don&#39;t think it will crash, but please let us know if any issues."}], "tags": [], "owner": {"reputation": 3668, "user_id": 239266, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2072a8f90f9fe379ca21c3af39a3757?s=128&d=identicon&r=PG", "display_name": "Hadi Hariri", "link": "https://stackoverflow.com/users/239266/hadi-hariri"}, "is_accepted": false, "score": 2, "last_activity_date": 1436375008, "creation_date": 1436375008, "answer_id": 31299114, "question_id": 31292963, "link": "https://stackoverflow.com/questions/31292963/how-should-i-set-up-a-web-project-using-kotlin-on-the-back-end-and-in-the-browse/31299114#31299114", "title": "How should I set up a web project using Kotlin on the back-end and in the browser?", "body": "<p>The easiest way is to keep the modules separate, and I guess conceptually you'd probably want to do that also. While IntelliJ IDEA for instance doesn't natively support the ability to output to JS and JVM with Kotlin, in principle with Gradle/Maven you could. Here are instructions on targeting JVM and JavaScript for Gradle <a href=\"http://kotlinlang.org/docs/reference/using-gradle.html\" rel=\"nofollow\">http://kotlinlang.org/docs/reference/using-gradle.html</a></p>\n"}], "owner": {"reputation": 33762, "user_id": 16050, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/7e1282298aec568f8bad5afe46cb40b8?s=128&d=identicon&r=PG", "display_name": "sanity", "link": "https://stackoverflow.com/users/16050/sanity"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1436375008, "creation_date": 1436359135, "question_id": 31292963, "link": "https://stackoverflow.com/questions/31292963/how-should-i-set-up-a-web-project-using-kotlin-on-the-back-end-and-in-the-browse", "title": "How should I set up a web project using Kotlin on the back-end and in the browser?", "body": "<p>If I wanted to build a website which used Kotlin both on the back-end, and in the browser - how would I set this up?  Is there a Maven archetype or a Gradle template that captures best-practices for something like this?</p>\n"}, {"tags": ["annotations", "kotlin"], "comments": [{"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "edited": false, "score": 0, "creation_date": 1452033160, "post_id": 31214405, "comment_id": 56990451, "body": "You can search or add an issue to <a href=\"https://youtrack.jetbrains.com\" rel=\"nofollow noreferrer\">YouTrack</a> asking for the feature of KAPT to generate Kotlin.   This way you will be able to track progress for the feature."}], "answers": [{"comments": [{"owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "edited": false, "score": 0, "creation_date": 1436174321, "post_id": 31219084, "comment_id": 50481703, "body": "Thanks, the approach that you suggest looks good for this case. But I&#39;d still like to do the same without redundant and duplicated code at the class usage and, if possible, even without additional code in the class."}], "tags": [], "owner": {"reputation": 35078, "user_id": 615306, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/5a11940d70233031c01ead6c0b62c990?s=128&d=identicon&r=PG", "display_name": "Kirill Rakhman", "link": "https://stackoverflow.com/users/615306/kirill-rakhman"}, "is_accepted": true, "score": 3, "last_activity_date": 1436002210, "creation_date": 1436002210, "answer_id": 31219084, "question_id": 31214405, "link": "https://stackoverflow.com/questions/31214405/kotlin-annotation-processing-is-it-possible-to-generate-an-extension-method/31219084#31219084", "title": "Kotlin Annotation Processing: is it possible to generate an extension method?", "body": "<p>Not sure, if what you want can be done directly, however here's an approach without \"functional classes\". As far as I understand you want to add functionality to a regular lambda function. First, define your <em>functionality</em> as a regular class:</p>\n\n<pre><code>class Memory() {\n    val memory = hashMapOf&lt;String, String&gt;()\n    fun output(message: String) = println(message)\n}\n</code></pre>\n\n<p>Then define a helper function to bind extension functions to a receiver:</p>\n\n<pre><code>fun &lt;T, R, E&gt; T.bind(function: T.(R) -&gt; E): (R) -&gt; E = { this.function(it) }\n</code></pre>\n\n<p>And then use it like this</p>\n\n<pre><code>fun main(args: Array&lt;String&gt;) {\n    val mem = Memory()\n\n    val memoryFunction: Memory.(String) -&gt; String = {\n        output(\"reversing $it\");\n        if (it in memory)\n            output(memory[it])\n        it.reverse()\n    }\n\n    val function: (String) -&gt; String = mem.bind(memoryFunction)\n\n    println(listOf(\"foo\", \"bar\").map(function))\n}\n</code></pre>\n"}], "owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1362, "favorite_count": 0, "accepted_answer_id": 31219084, "answer_count": 1, "score": 1, "last_activity_date": 1436002210, "creation_date": 1435959121, "last_edit_date": 1435963731, "question_id": 31214405, "link": "https://stackoverflow.com/questions/31214405/kotlin-annotation-processing-is-it-possible-to-generate-an-extension-method", "title": "Kotlin Annotation Processing: is it possible to generate an extension method?", "body": "<p>I'm playing around with Kotlin and I think that it would be great to have \"<em>functional classes</em>\", see the example of what I want:</p>\n\n<pre class=\"lang-scala prettyprint-override\"><code>functional class MyStrFunction(val function: MyStrFunction.(String) -&gt; String) {\n    val memory = HashMap&lt;String, String&gt;()\n    fun output(message: String) = println(message)\n}\n</code></pre>\n\n<p>The idea is that I would be able to use it like:</p>\n\n<pre class=\"lang-scala prettyprint-override\"><code>val f = MyStrFunction { \n    output(\"reversing $it\"); \n    if (it in memory)\n        output(memory[it])\n    return it.reverse() \n}\n</code></pre>\n\n<p>If I were to write <code>MyStrFunction</code> which I want by myself, the resulting class would be:</p>\n\n<pre class=\"lang-scala prettyprint-override\"><code>class MyStrFunction(val function: MyStrFunction.(String) -&gt; String) {\n    val memory = HashMap&lt;String, String&gt;()\n    fun output(message: String) = println(message)\n\n    public fun invoke(s: String) = this.function(s)\n}\n</code></pre>\n\n<p>But it's tedious a bit to write this by hands in every \"<em>functional class</em>\".</p>\n\n<p>So here's my question: is it possible to make <code>functional</code> an annotation and then process it adding <code>invoke</code> method with the desired code?</p>\n\n<p>I know that <strong>kapt</strong> can be used for Kotlin annotation processing, but AFAIK for now it cannot generate Kotlin code and there's no way to make an extension function in Java generated code.</p>\n\n<p>Is there any way to generate a new Kotlin method for a class?</p>\n\n<p><em>Node: I understand that the idea of functional classes has few use cases and that it's not that hard to add the mentioned <code>invoke</code> method manually, but for me it's academical interest to the concept of annotation processing in Kotlin.</em></p>\n\n<p>UPD: Just my thought about functional classes: there's language feature of delegating interfaces and it would work good here, but <code>this</code> reference is not visible in that block. Example:</p>\n\n<pre class=\"lang-scala prettyprint-override\"><code>class MyStrFunction(val function: MyStrFunction.(String) -&gt; String)\n: (String) -&gt; String by { this.function(it) } { // &lt;-- won't compile :(\n    val memory = HashMap&lt;String, String&gt;()\n    fun output(message: String) = println(message)\n}\n</code></pre>\n"}, {"tags": ["java", "kotlin"], "comments": [{"owner": {"reputation": 10110, "user_id": 4584675, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jqtdH.png?s=128&g=1", "display_name": "Lamorak", "link": "https://stackoverflow.com/users/4584675/lamorak"}, "edited": false, "score": 0, "creation_date": 1435923421, "post_id": 31202767, "comment_id": 50413671, "body": "I was not able to reproduce the issue <i>(kotlin 0.12.613)</i>"}, {"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "edited": false, "score": 0, "creation_date": 1452033386, "post_id": 31202767, "comment_id": 56990550, "body": "If <code>db</code> is nullable type (i.e. <code>DbConnection?</code>), and the calls cannot be made on a null then in older versions of Kotlin the error message was confusing.  It has been improved in later releases of Kotlin.  Usually you now get a message about nullability and needing to use safe call, or other null friendly operator.  More about null-related operators in: <a href=\"http://stackoverflow.com/questions/34498562/in-kotlin-what-is-the-idiomatic-way-to-deal-with-nullable-values-referencing-o/34498563#34498563\" title=\"in kotlin what is the idiomatic way to deal with nullable values referencing o\">stackoverflow.com/questions/34498562/&hellip;</a>"}, {"owner": {"reputation": 159, "user_id": 5782800, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kajZs.jpg?s=128&g=1", "display_name": "Pinaki Acharya", "link": "https://stackoverflow.com/users/5782800/pinaki-acharya"}, "edited": false, "score": 0, "creation_date": 1533544802, "post_id": 31202767, "comment_id": 90368107, "body": "I&#39;m facing the same issue"}, {"owner": {"reputation": 159, "user_id": 5782800, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kajZs.jpg?s=128&g=1", "display_name": "Pinaki Acharya", "link": "https://stackoverflow.com/users/5782800/pinaki-acharya"}, "edited": false, "score": 0, "creation_date": 1533545310, "post_id": 31202767, "comment_id": 90368394, "body": "I have a method in java that accepts a vararg parameter of <code>int</code> and I&#39;m trying to invoke that method from a kotlin function that a vararg parameter of <code>int</code> but it gives me a compile time error <code>type mismatch: inferred type is inArray but Int was expected</code>"}], "answers": [{"comments": [{"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "edited": false, "score": 0, "creation_date": 1452033349, "post_id": 31209218, "comment_id": 56990526, "body": "Likely it has been improved in later releases of Kotlin.  Usually you now get a message about nullability and needing to use safe call, or other null friendly operator.  More about null-related operators in: <a href=\"http://stackoverflow.com/questions/34498562/in-kotlin-what-is-the-idiomatic-way-to-deal-with-nullable-values-referencing-o/34498563#34498563\" title=\"in kotlin what is the idiomatic way to deal with nullable values referencing o\">stackoverflow.com/questions/34498562/&hellip;</a>"}], "tags": [], "owner": {"reputation": 12295, "user_id": 231417, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/55e0b4a18e369a46aa2798b024b15a2e?s=128&d=identicon&r=PG", "display_name": "tbruyelle", "link": "https://stackoverflow.com/users/231417/tbruyelle"}, "is_accepted": false, "score": 0, "last_activity_date": 1435933907, "creation_date": 1435933907, "answer_id": 31209218, "question_id": 31202767, "link": "https://stackoverflow.com/questions/31202767/invoking-java-function-with-vararg-not-compiling-in-kotlin/31209218#31209218", "title": "Invoking Java function with vararg not compiling in Kotlin", "body": "<p>It was because the object is of type <code>BriteDatabase?</code>, so I have to use it with <code>db!!</code> or <code>db?</code>. </p>\n\n<p>Maybe the error message should be improved! </p>\n"}], "owner": {"reputation": 12295, "user_id": 231417, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/55e0b4a18e369a46aa2798b024b15a2e?s=128&d=identicon&r=PG", "display_name": "tbruyelle", "link": "https://stackoverflow.com/users/231417/tbruyelle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 545, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1435933907, "creation_date": 1435914255, "question_id": 31202767, "link": "https://stackoverflow.com/questions/31202767/invoking-java-function-with-vararg-not-compiling-in-kotlin", "title": "Invoking Java function with vararg not compiling in Kotlin", "body": "<p>I'm trying to call a Java method from Kotlin but the compiler doesn't manage to find the proper signature. </p>\n\n<p>The method has 2 signatures : </p>\n\n<pre><code>Observable&lt;Query&gt; createQuery(@NonNull final String table, @NonNull String sql, @NonNull String... args) \n\nObservable&lt;Query&gt; createQuery(@NonNull final Iterable&lt;String&gt; tables, @NonNull String sql, @NonNull String... args)\n</code></pre>\n\n<p>Then in kotlin I just want to call this, which seems completely valid to me :</p>\n\n<pre><code>db.createQuery(\"users\", \"select * from users\")\n</code></pre>\n\n<p>But the compiler say</p>\n\n<pre><code>None of the following functions can be called with the arguments supplied: \npublic open fun createQuery(android.support.annotation.NonNull tables: kotlin.(Mutable)Iterable&lt;kotlin.String!&gt;!, android.support.annotation.NonNull sql: kotlin.String!, android.support.annotation.NonNull vararg args: kotlin.String!): rx.Observable&lt;com.squareup.sqlbrite.SqlBrite.Query!&gt;! defined in com.squareup.sqlbrite.BriteDatabase\npublic open fun createQuery(android.support.annotation.NonNull table: kotlin.String!, android.support.annotation.NonNull sql: kotlin.String!, android.support.annotation.NonNull vararg args: kotlin.String!): rx.Observable&lt;com.squareup.sqlbrite.SqlBrite.Query!&gt;! defined in com.squareup.sqlbrite.BriteDatabase\n</code></pre>\n\n<p>I read Kotlin and Java method with vararg have some interrop issues, is there a way to fix that without using a java class as a bridge ?</p>\n"}, {"tags": ["reflection", "delegation", "kotlin"], "answers": [{"comments": [{"owner": {"reputation": 35078, "user_id": 615306, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/5a11940d70233031c01ead6c0b62c990?s=128&d=identicon&r=PG", "display_name": "Kirill Rakhman", "link": "https://stackoverflow.com/users/615306/kirill-rakhman"}, "edited": false, "score": 1, "creation_date": 1435941004, "post_id": 31207732, "comment_id": 50423736, "body": "That&#39;s interesting. Is there an issue to follow or a spec to read?"}, {"owner": {"reputation": 10942, "user_id": 18575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/318654a786700455b96049d8ac9beb11?s=128&d=identicon&r=PG", "display_name": "Ilya Ryzhenkov", "link": "https://stackoverflow.com/users/18575/ilya-ryzhenkov"}, "reply_to_user": {"reputation": 35078, "user_id": 615306, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/5a11940d70233031c01ead6c0b62c990?s=128&d=identicon&r=PG", "display_name": "Kirill Rakhman", "link": "https://stackoverflow.com/users/615306/kirill-rakhman"}, "edited": false, "score": 1, "creation_date": 1435949448, "post_id": 31207732, "comment_id": 50426875, "body": "No, not anywhere unfortunately. For now, it&#39;s a couple of discussion logs and that&#39;s it :)"}, {"owner": {"reputation": 2552, "user_id": 269029, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b0b08e61a7674d6fec0bbea4b6e1f685?s=128&d=identicon&r=PG", "display_name": "Michael Pardo", "link": "https://stackoverflow.com/users/269029/michael-pardo"}, "edited": false, "score": 0, "creation_date": 1435970269, "post_id": 31207732, "comment_id": 50432305, "body": "Good to know that you&#39;re working on delegate access and that I&#39;ve done the best I can for now. Thanks."}, {"owner": {"reputation": 2572, "user_id": 812919, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/izI7J.png?s=128&g=1", "display_name": "daka", "link": "https://stackoverflow.com/users/812919/daka"}, "edited": false, "score": 0, "creation_date": 1541862126, "post_id": 31207732, "comment_id": 93366178, "body": "@IlyaRyzhenkov Any progress on this?"}, {"owner": {"reputation": 10942, "user_id": 18575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/318654a786700455b96049d8ac9beb11?s=128&d=identicon&r=PG", "display_name": "Ilya Ryzhenkov", "link": "https://stackoverflow.com/users/18575/ilya-ryzhenkov"}, "reply_to_user": {"reputation": 2572, "user_id": 812919, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/izI7J.png?s=128&g=1", "display_name": "daka", "link": "https://stackoverflow.com/users/812919/daka"}, "edited": false, "score": 2, "creation_date": 1541954859, "post_id": 31207732, "comment_id": 93386671, "body": "@daka reflection was improved to have direct access to a delegate, see <a href=\"https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.reflect/-k-property0/get-delegate.html\" rel=\"nofollow noreferrer\">kotlinlang.org/api/latest/jvm/stdlib/kotlin.reflect/&hellip;</a>"}], "tags": [], "owner": {"reputation": 10942, "user_id": 18575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/318654a786700455b96049d8ac9beb11?s=128&d=identicon&r=PG", "display_name": "Ilya Ryzhenkov", "link": "https://stackoverflow.com/users/18575/ilya-ryzhenkov"}, "is_accepted": true, "score": 3, "last_activity_date": 1435929175, "creation_date": 1435929175, "answer_id": 31207732, "question_id": 31198230, "link": "https://stackoverflow.com/questions/31198230/how-can-i-get-the-name-of-a-kotlin-property/31207732#31207732", "title": "How can I get the name of a Kotlin property?", "body": "<p>Right now reflection is all we can do to get to the delegate object. We are designing a language feature to have direct access to delegate instance, but it's long way to go. </p>\n"}, {"tags": [], "owner": {"reputation": 15009, "user_id": 1313268, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/65NwV.jpg?s=128&g=1", "display_name": "CorayThan", "link": "https://stackoverflow.com/users/1313268/coraythan"}, "is_accepted": false, "score": 3, "last_activity_date": 1507829926, "last_edit_date": 1507829926, "creation_date": 1507829589, "answer_id": 46715657, "question_id": 31198230, "link": "https://stackoverflow.com/questions/31198230/how-can-i-get-the-name-of-a-kotlin-property/46715657#46715657", "title": "How can I get the name of a Kotlin property?", "body": "<p>This is how you get the name of a Kotlin Property (although only with an instance of the class). This part will be useful to anyone arriving at this question purely based off its title.</p>\n\n<pre><code>class Stuff(val thing: String)\n\nval stuff = Stuff(\"cool stuff\")\nval thingFieldName = \"${stuff.thing}\\$delegate\"\n// value of thingFieldName is now \"thing\"\n</code></pre>\n\n<p>In terms of getting the delegate itself easier, they say you can now do this:</p>\n\n<pre><code>class Foo {\n    var bar: String by ReactiveProperty&lt;String&gt;()\n}\n\nval foo = Foo()\nval bar = foo.bar\nval barDelegate = ... // foo.bar$delegate\n</code></pre>\n\n<p><a href=\"https://youtrack.jetbrains.com/issue/KT-8384\" rel=\"nofollow noreferrer\">See ticket.</a></p>\n"}], "owner": {"reputation": 2552, "user_id": 269029, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b0b08e61a7674d6fec0bbea4b6e1f685?s=128&d=identicon&r=PG", "display_name": "Michael Pardo", "link": "https://stackoverflow.com/users/269029/michael-pardo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6293, "favorite_count": 0, "accepted_answer_id": 31207732, "answer_count": 2, "score": 7, "last_activity_date": 1507829926, "creation_date": 1435896098, "last_edit_date": 1435896648, "question_id": 31198230, "link": "https://stackoverflow.com/questions/31198230/how-can-i-get-the-name-of-a-kotlin-property", "title": "How can I get the name of a Kotlin property?", "body": "<p>I have the following function to access a property's delegate. It uses Kotlin reflection to get a property's name and Java reflection to get the field.</p>\n\n<pre><code>fun Any.getDelegate&lt;T&gt;(prop: KProperty&lt;T&gt;): Any {\n    return javaClass.getDeclaredField(\"${prop.name}\\$delegate\").let {\n        it.setAccessible(true)\n        it.get(this)\n    }\n}\n</code></pre>\n\n<p>The method is used like this:</p>\n\n<pre><code>val delegate = a.getDelegate(A::b)\n</code></pre>\n\n<p>However, I would prefer to use it like this:</p>\n\n<pre><code>val delegate = a.b.delegate\n</code></pre>\n\n<p>The problem with the code above is getting the property name of <code>a.b</code> and getting the instance <code>a</code> from <code>a.b</code>. From what I know about Kotlin, this is probably not possible, however I'd like to see if I can clean up my function at all.</p>\n\n<p>To give a bigger picture of what I'm trying do here's my complete code. I want an observable delegate to which I can add and remove observers using the delegate reference and without creating addition variables.</p>\n\n<pre><code>fun Any.addObservable&lt;T&gt;(prop: KProperty&lt;T&gt;, observer: (T) -&gt; Unit) {\n    getObservableProperty(prop).observers.add(observer)\n}\n\nfun Any.getObservableProperty&lt;T&gt;(prop: KProperty&lt;T&gt;): ObservableProperty&lt;T&gt; {\n    return getDelegate(prop) as ObservableProperty&lt;T&gt;\n}\n\nfun Any.getDelegate&lt;T&gt;(prop: KProperty&lt;T&gt;): Any {\n    return javaClass.getDeclaredField(\"${prop.name}\\$delegate\").let {\n        it.setAccessible(true)\n        it.get(this)\n    }\n}\n\nclass ObservableProperty&lt;T&gt;(\n        initialValue: T,\n        initialObservers: Array&lt;(T) -&gt; Unit&gt; = emptyArray()) : ReadWriteProperty&lt;Any?, T&gt; {\n\n    private var value = initialValue\n\n    public val observers: MutableSet&lt;(T) -&gt; Unit&gt; = initialObservers.toHashSet()\n\n    public override fun get(thisRef: Any?, desc: PropertyMetadata): T {\n        return value\n    }\n\n    public override fun set(thisRef: Any?, desc: PropertyMetadata, value: T) {\n        this.value = value\n        observers.forEach { it(value) }\n    }\n}\n\nclass A() {\n    var b by ObservableProperty(0)\n}\n\nfun main(args: Array&lt;String&gt;) {\n    val a = A()\n\n    a.addObservable(A::b) {\n        println(\"b is now $it\")\n    }\n\n    a.b = 1\n    a.b = 2\n    a.b = 3\n}\n</code></pre>\n\n<hr>\n\n<h2><strong><em>Edit</em></strong>:</h2>\n\n<p>I just realized that the function also isn't strict because the property delegate field name is referenced by <code>KProperty</code> name, which doesn't require a strong reference to the enclosing class. Here's an example to demonstrate the problem:</p>\n\n<pre><code>class A() {\n    var foo by ObservableProperty(0)\n}\n\nclass B() {\n    var foo by ObservableProperty(0)\n}\n\nfun main(args: Array&lt;String&gt;) {\n    val a = A()\n\n    a.addObservable(B::foo) {\n        println(\"b is now $it\")\n    }\n\n    a.foo = 1\n    a.foo = 2\n    a.foo = 3\n}\n</code></pre>\n\n<p>This compiles and runs without error because <code>A::foo</code> and <code>B::foo</code> both result in a field string of <code>\"foo$delegate</code>.</p>\n"}, {"tags": ["android", "android-layout", "android-fragments", "kotlin", "kotlin-android-extensions"], "answers": [{"comments": [{"owner": {"reputation": 13958, "user_id": 689723, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/rQNO2.jpg?s=128&g=1", "display_name": "cesards", "link": "https://stackoverflow.com/users/689723/cesards"}, "edited": false, "score": 0, "creation_date": 1460458552, "post_id": 31188604, "comment_id": 60740910, "body": "Do we always have to use clearFindViewByIdCache() if we use import kotlinx.android.synthetic.* in our fragments???"}, {"owner": {"reputation": 10110, "user_id": 4584675, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jqtdH.png?s=128&g=1", "display_name": "Lamorak", "link": "https://stackoverflow.com/users/4584675/lamorak"}, "reply_to_user": {"reputation": 13958, "user_id": 689723, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/rQNO2.jpg?s=128&g=1", "display_name": "cesards", "link": "https://stackoverflow.com/users/689723/cesards"}, "edited": false, "score": 0, "creation_date": 1460462364, "post_id": 31188604, "comment_id": 60743689, "body": "You shouldn&#39;t need <code>clearFindViewByIdCache()</code> anymore according to <a href=\"http://stackoverflow.com/a/33150682/4584675\">another answer</a> to this question."}], "tags": [], "owner": {"reputation": 10110, "user_id": 4584675, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jqtdH.png?s=128&g=1", "display_name": "Lamorak", "link": "https://stackoverflow.com/users/4584675/lamorak"}, "is_accepted": false, "score": 6, "last_activity_date": 1435850465, "creation_date": 1435850465, "answer_id": 31188604, "question_id": 31187531, "link": "https://stackoverflow.com/questions/31187531/kotlin-android-extensions-and-retained-fragment/31188604#31188604", "title": "Kotlin Android extensions and retained fragment", "body": "<p>I have found the answer myself. The <code>Fragment</code> class does not inflate the layout directly \u2013 it has property <code>view: View?</code> which holds it. This should be pretty obvious since it is created with <code>onCreateView</code>. In order to access the properties within the <code>view</code> you have to set the import</p>\n\n<pre><code>import kotlinx.android.synthetic.hello.view.*\n</code></pre>\n\n<p>and then access the properties as follows</p>\n\n<pre><code>view?.text_view?.setText(text)\n</code></pre>\n\n<p>Note that these properties are nullable.</p>\n"}, {"comments": [{"owner": {"reputation": 8020, "user_id": 823282, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/xBNDh.png?s=128&g=1", "display_name": "activedecay", "link": "https://stackoverflow.com/users/823282/activedecay"}, "edited": false, "score": 0, "creation_date": 1453693086, "post_id": 31209938, "comment_id": 57698282, "body": "The issue is fixed now. see @greenspand answer below"}], "tags": [], "owner": {"reputation": 1091, "user_id": 3423539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99231e6fe7118c7409fdbcedd6d3afcc?s=128&d=identicon&r=PG", "display_name": "yanex", "link": "https://stackoverflow.com/users/3423539/yanex"}, "is_accepted": true, "score": 15, "last_activity_date": 1509508355, "last_edit_date": 1509508355, "creation_date": 1435936444, "answer_id": 31209938, "question_id": 31187531, "link": "https://stackoverflow.com/questions/31187531/kotlin-android-extensions-and-retained-fragment/31209938#31209938", "title": "Kotlin Android extensions and retained fragment", "body": "<p><strong>UPD:</strong> The issue is fixed now. You don't have to call <code>clearFindViewByIdCache()</code> manually anymore.</p>\n\n<p><code>View</code> cache is not cleared after calling <code>onDestroyView()</code>. There is an <a href=\"https://youtrack.jetbrains.com/issue/KT-8073\" rel=\"nofollow noreferrer\">open issue</a>.</p>\n\n<p>For now, you can explicitly invoke <code>clearFindViewByIdCache()</code> in <code>onDestroyView()</code> to clear the cache. This method is part of the <code>synthetic</code> package so you have to import it</p>\n\n<pre><code>import kotlinx.android.synthetic.*\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 730, "user_id": 2225418, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/2b7af88b1f2957f61ca03ae3d2f73e63?s=128&d=identicon&r=PG", "display_name": "greenspand", "link": "https://stackoverflow.com/users/2225418/greenspand"}, "is_accepted": false, "score": 7, "last_activity_date": 1444917937, "creation_date": 1444917937, "answer_id": 33150682, "question_id": 31187531, "link": "https://stackoverflow.com/questions/31187531/kotlin-android-extensions-and-retained-fragment/33150682#33150682", "title": "Kotlin Android extensions and retained fragment", "body": "<p>Just to clarify. The issue is fixed now. You don't have to pass clearFindViewByIdCache() anylonger. Please see issue tracker: <a href=\"https://youtrack.jetbrains.com/oauth?state=%2Fissue%2FKT-8073\" rel=\"noreferrer\">https://youtrack.jetbrains.com/oauth?state=%2Fissue%2FKT-8073</a></p>\n"}], "owner": {"reputation": 10110, "user_id": 4584675, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jqtdH.png?s=128&g=1", "display_name": "Lamorak", "link": "https://stackoverflow.com/users/4584675/lamorak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8199, "favorite_count": 3, "accepted_answer_id": 31209938, "answer_count": 3, "score": 10, "last_activity_date": 1509508355, "creation_date": 1435847838, "question_id": 31187531, "link": "https://stackoverflow.com/questions/31187531/kotlin-android-extensions-and-retained-fragment", "title": "Kotlin Android extensions and retained fragment", "body": "<p>I am using <a href=\"http://kotlinlang.org/docs/tutorials/android-plugin.html\">Kotlin Android extensions</a> in my project and I came across some behavior that I am unable to understand. I use this code to retain my fragment in the activity:</p>\n\n<pre><code>val fragment = fragmentManager.findFragmentByTag(\"hello\") ?: HelloFragment()\nfragmentManager.beginTransaction()\n               .replace(R.id.fragment_container, fragment, \"hello\")\n               .commit()\n</code></pre>\n\n<p>This is the retained <code>Fragment</code>:</p>\n\n<pre><code>import kotlinx.android.synthetic.hello.*\n\npublic class HelloFragment : Fragment() {\n    val text = \"Hello world!\"\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super&lt;Fragment&gt;.onCreate(savedInstanceState)\n        setRetainInstance(true)\n    }\n\n    override fun onCreateView(inflater: LayoutInflater?, container: ViewGroup?, savedInstanceState: Bundle?): View? {\n        return inflater?.inflate(R.layout.hello, container, false)\n    }\n\n    override fun onViewCreated(view: View?, savedInstanceState: Bundle?) {\n        super&lt;Fragment&gt;.onViewCreated(view, savedInstanceState)\n\n        text_view.setText(text) // &lt;- does not work when retained\n    }\n}\n</code></pre>\n\n<p>and its XML layout <strong>hello.xml</strong>:</p>\n\n<pre><code>&lt;TextView xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:id=\"@+id/text_view\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:gravity=\"center\" /&gt;\n</code></pre>\n\n<p>Everything works as expected \u2013 the <code>text_view.setText()</code> displays <em>Hello world!</em> on screen on the first launch. But when you rotate the screen the <code>text_view.setText()</code> does not work. This is weird because <code>text_view</code> is not nullable and has to reffer to some view. If you remove <code>setRetainInstance(true)</code> and leave the fragment recreate every time this problem disappears. Any thoughts what might cause this problem?</p>\n"}, {"tags": ["java", "json", "gson", "kotlin"], "comments": [{"owner": {"reputation": 26217, "user_id": 321354, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/af8280741145a2c2d58390fe7ef5c04d?s=128&d=identicon&r=PG&f=1", "display_name": "rciovati", "link": "https://stackoverflow.com/users/321354/rciovati"}, "edited": false, "score": 0, "creation_date": 1435858495, "post_id": 31185746, "comment_id": 50387107, "body": "I suppose creating a custom deserializer is the way to go. Could you post the code you wrote?"}, {"owner": {"reputation": 783, "user_id": 4672864, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/8b39e83fd6dbd1932b93f29f31cd1c60?s=128&d=identicon&r=PG&f=1", "display_name": "user38725", "link": "https://stackoverflow.com/users/4672864/user38725"}, "reply_to_user": {"reputation": 26217, "user_id": 321354, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/af8280741145a2c2d58390fe7ef5c04d?s=128&d=identicon&r=PG&f=1", "display_name": "rciovati", "link": "https://stackoverflow.com/users/321354/rciovati"}, "edited": false, "score": 0, "creation_date": 1435864927, "post_id": 31185746, "comment_id": 50390706, "body": "@RiccardoCiovati Hi, I added some code. No problems whatsovever in serializing the Events.. however, like I said, when I deserialize &#39;em, the information simply isn&#39;t there (I println&#39;ed a deserialized Move-event, and it only had the Point data of &quot;from&quot; and &quot;to&quot;) (I have a custom serializer for Point-class too)"}, {"owner": {"reputation": 783, "user_id": 4672864, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/8b39e83fd6dbd1932b93f29f31cd1c60?s=128&d=identicon&r=PG&f=1", "display_name": "user38725", "link": "https://stackoverflow.com/users/4672864/user38725"}, "reply_to_user": {"reputation": 26217, "user_id": 321354, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/af8280741145a2c2d58390fe7ef5c04d?s=128&d=identicon&r=PG&f=1", "display_name": "rciovati", "link": "https://stackoverflow.com/users/321354/rciovati"}, "edited": false, "score": 0, "creation_date": 1435865837, "post_id": 31185746, "comment_id": 50391195, "body": "Silly me. I wasn&#39;t registering the type adapter for the sub-classes at all, but only for the Event-class, that was the problem. However, now I am having a StackOverflowError on the line: <code>val elem = context!!.serialize(src)</code>. Any ideas what might cause this?"}, {"owner": {"reputation": 783, "user_id": 4672864, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/8b39e83fd6dbd1932b93f29f31cd1c60?s=128&d=identicon&r=PG&f=1", "display_name": "user38725", "link": "https://stackoverflow.com/users/4672864/user38725"}, "reply_to_user": {"reputation": 26217, "user_id": 321354, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/af8280741145a2c2d58390fe7ef5c04d?s=128&d=identicon&r=PG&f=1", "display_name": "rciovati", "link": "https://stackoverflow.com/users/321354/rciovati"}, "edited": false, "score": 0, "creation_date": 1435866387, "post_id": 31185746, "comment_id": 50391473, "body": "I <i>suspect</i> it is due to the <code>(src as Event)</code>. But I&#39;m not sure how to fix it."}, {"owner": {"reputation": 4016, "user_id": 1460833, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bc4821b9c16457694f503b42831198f1?s=128&d=identicon&r=PG", "display_name": "Sergey Mashkov", "link": "https://stackoverflow.com/users/1460833/sergey-mashkov"}, "edited": false, "score": 0, "creation_date": 1435912069, "post_id": 31185746, "comment_id": 50406938, "body": "You have stack overflow because you call \ud83d\udcf1 serialize on src object that is already serializing.. You just call \ud83d\udcf1 your code recursively"}, {"owner": {"reputation": 783, "user_id": 4672864, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/8b39e83fd6dbd1932b93f29f31cd1c60?s=128&d=identicon&r=PG&f=1", "display_name": "user38725", "link": "https://stackoverflow.com/users/4672864/user38725"}, "edited": false, "score": 0, "creation_date": 1435914117, "post_id": 31185746, "comment_id": 50408082, "body": "I am using the code found here: <a href=\"http://stackoverflow.com/a/8683689/4672864\">stackoverflow.com/a/8683689/4672864</a>. The comments in the post also say that if I use an <i>interface</i>, I shouldn&#39;t have the infinite recursion problem. I don&#39;t quite understand why.. and I tried to change the event from abstract class to Interface, but I still get the infinite recursion."}, {"owner": {"reputation": 4016, "user_id": 1460833, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bc4821b9c16457694f503b42831198f1?s=128&d=identicon&r=PG", "display_name": "Sergey Mashkov", "link": "https://stackoverflow.com/users/1460833/sergey-mashkov"}, "edited": false, "score": 0, "creation_date": 1435927509, "post_id": 31185746, "comment_id": 50416094, "body": "@fluxi you get stack overflow because of call context.serialize and registerTypeHierarchy-registration. <code>src as Event</code> is irrelevant,  you even don&#39;t need it"}], "answers": [{"comments": [{"owner": {"reputation": 783, "user_id": 4672864, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/8b39e83fd6dbd1932b93f29f31cd1c60?s=128&d=identicon&r=PG&f=1", "display_name": "user38725", "link": "https://stackoverflow.com/users/4672864/user38725"}, "edited": false, "score": 0, "creation_date": 1436020654, "post_id": 31207219, "comment_id": 50443496, "body": "Thanks for your answer. I solved it by manually serializing the types, and simply having a separate ArrayList for each type."}], "tags": [], "owner": {"reputation": 4016, "user_id": 1460833, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bc4821b9c16457694f503b42831198f1?s=128&d=identicon&r=PG", "display_name": "Sergey Mashkov", "link": "https://stackoverflow.com/users/1460833/sergey-mashkov"}, "is_accepted": true, "score": 1, "last_activity_date": 1435927447, "last_edit_date": 1495540278, "creation_date": 1435927447, "answer_id": 31207219, "question_id": 31185746, "link": "https://stackoverflow.com/questions/31185746/gson-and-serializing-an-arraylist-of-objects-with-inheritance/31207219#31207219", "title": "Gson and Serializing an ArrayList of Objects with Inheritance", "body": "<p>You can't do it this way. </p>\n\n<p>The example you are referring is not targeted to your case. It works in only one case: if you register base type (not type hierarchy) and serialize using <code>gson.toJson(obj, javaClass&lt;Event&gt;())</code>. It will never work for array except you write custom serializer for you events container object too </p>\n\n<p>Generally you need another approach: use TypeAdapterFactory and delegate adapters: <a href=\"https://stackoverflow.com/questions/26592904/gson-serialize-deserialize-object-of-class-that-have-registered-type-hierarchy\">GSON: serialize/deserialize object of class, that have registered type hierarchy adapter, using ReflectiveTypeAdapterFactory.Adapter</a> and <a href=\"https://code.google.com/p/google-gson/issues/detail?id=43#c15\" rel=\"nofollow noreferrer\">https://code.google.com/p/google-gson/issues/detail?id=43#c15</a></p>\n\n<p>I believe this approach is overcomplicated so if you have few types the easiest solution is two serialize these types by hand, field by field via custom serializer and forget about attempts to delegate to default</p>\n"}], "owner": {"reputation": 783, "user_id": 4672864, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/8b39e83fd6dbd1932b93f29f31cd1c60?s=128&d=identicon&r=PG&f=1", "display_name": "user38725", "link": "https://stackoverflow.com/users/4672864/user38725"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1442, "favorite_count": 0, "accepted_answer_id": 31207219, "answer_count": 1, "score": 0, "last_activity_date": 1435927447, "creation_date": 1435843075, "last_edit_date": 1435864569, "question_id": 31185746, "link": "https://stackoverflow.com/questions/31185746/gson-and-serializing-an-arraylist-of-objects-with-inheritance", "title": "Gson and Serializing an ArrayList of Objects with Inheritance", "body": "<p>I am very new to Gson and Json. I have simple Events that I want to serialize through Json with the help of Gson.</p>\n\n<p>Note: Code in Kotlin.</p>\n\n<pre><code>public abstract class Event() {\n}\n\npublic class Move : Event() {\n        var from: Point? = null\n        var to: Point? = null\n    }\n\n    public class Fire : Event() {\n        var damage: Int = 0\n        var area: ArrayList&lt;Point&gt; = ArrayList(0)\n    }\n\n    public class Build : Event() {\n        var to: Point? = null\n        var type: String = \"\"\n        var owner: String = \"\"\n    }\n</code></pre>\n\n<p>I am persisting bunch of these via this way:</p>\n\n<pre><code>val list: ArrayList&lt;Event&gt;() = ArrayList()\nlist.add(move)\nlist.add(fire)\nval str = gson.toJson(events)\n</code></pre>\n\n<p>And unpersisting:</p>\n\n<pre><code>val type = object : TypeToken&lt;ArrayList&lt;Event&gt;&gt;(){}.getType()\nval eventStr = obj.getString(\"events\")\nval events: ArrayList&lt;Event&gt; = gson.fromJson(eventStr, type)\n</code></pre>\n\n<p>I have tried both creating a serializer &amp; deserializer for Event-class, and registering it via registerTypeAdapter, and I have also tried the RuntimeTypeAdapterFactory, but neither will persist the information required to unpersist the correct type.</p>\n\n<p>For example, the RuntimeTypeAdapterFactory says:\n\"cannot deserialize Event because it does not define a field named type\"</p>\n\n<p><strong>EDIT</strong>: Here's the code for the \"Adapter\", which was.. well, adapted from another StackOverflow post:</p>\n\n<pre><code>public class Adapter :\n            JsonSerializer&lt;Event&gt;,\n            JsonDeserializer&lt;Event&gt; {\n\n        final val CLASSNAME = \"CLASSNAME\"\n        final val INSTANCE  = \"INSTANCE\"\n\n        override fun serialize(src: Event?, typeOfSrc: Type?, context: JsonSerializationContext?): JsonElement? {\n            val obj = JsonObject()\n            val className = (src as Event).javaClass.getCanonicalName()\n            obj.addProperty(CLASSNAME, className)\n            val elem = context!!.serialize(src)\n            obj.add(INSTANCE, elem)\n            return obj\n        }\n\n        override fun deserialize(json: JsonElement?, typeOfT: Type?, context: JsonDeserializationContext?): Event? {\n            val jsonObject =  json!!.getAsJsonObject()\n            val prim = jsonObject.get(CLASSNAME)\n            val className = prim.getAsString()\n            val klass = Class.forName(className)\n            return context!!.deserialize(jsonObject.get(INSTANCE), klass)\n        }\n    }\n</code></pre>\n\n<p>This code fails with NullPointerException on line:</p>\n\n<pre><code>val className = prim.getAsString()\n</code></pre>\n"}]