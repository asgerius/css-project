[{"tags": ["java", "android", "kotlin"], "comments": [{"owner": {"reputation": 48475, "user_id": 294248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b5dbf3643399236154fbf7f94c20367?s=128&d=identicon&r=PG&f=1", "display_name": "fadden", "link": "https://stackoverflow.com/users/294248/fadden"}, "edited": false, "score": 2, "creation_date": 1459966042, "post_id": 36458752, "comment_id": 60530124, "body": "Looks like you have a &quot;crashlytics&quot; crash handler that fired when an uncaught exception was thrown, and it&#39;s attempting to generate a 55MB string when printing the stack trace. Attaching a debugger that traps uncaught exceptions will at least let you identify the crash that&#39;s starting things off."}, {"owner": {"reputation": 5526, "user_id": 3834478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/362SL.jpg?s=128&g=1", "display_name": "sisyphus", "link": "https://stackoverflow.com/users/3834478/sisyphus"}, "edited": false, "score": 0, "creation_date": 1459966118, "post_id": 36458752, "comment_id": 60530175, "body": "The <code>synchronized</code> method is probably a red-herring, it&#39;s just what caused a leaking application to get too large. Can you profile yoyr running app and find out what&#39;s using memory?"}, {"owner": {"reputation": 35078, "user_id": 615306, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/5a11940d70233031c01ead6c0b62c990?s=128&d=identicon&r=PG", "display_name": "Kirill Rakhman", "link": "https://stackoverflow.com/users/615306/kirill-rakhman"}, "edited": false, "score": 0, "creation_date": 1460017212, "post_id": 36458752, "comment_id": 60551722, "body": "Why would you need to synchronize a read anyway?"}], "answers": [{"tags": [], "owner": {"reputation": 50303, "user_id": 170842, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/c2ea72b8d001d81fb6ce3f356e45eb3a?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/170842/michael"}, "is_accepted": true, "score": 5, "last_activity_date": 1459969623, "creation_date": 1459969623, "answer_id": 36460232, "question_id": 36458752, "link": "https://stackoverflow.com/questions/36458752/android-outofmemoryerror-failed-to-allocate-a-57993496-byte-allocation-with-167/36460232#36460232", "title": "Android OutOfMemoryError: Failed to allocate a 57993496 byte allocation with 16764448 free bytes", "body": "<p>Actually you've got a <code>StackOverflowError</code> because you're calling <code>getCount()</code> from <code>getCount()</code> unconditionally. I suppose it's just a typo and the code should be:</p>\n\n<pre><code>var count: Int = 0\n    get() = synchronized(this) { field }\n    private set\n</code></pre>\n\n<p>The <code>field</code> identifier here allows you to access a backing field of the property. You can read read more about backing fields <a href=\"https://kotlinlang.org/docs/reference/properties.html#backing-fields\">here</a>.</p>\n"}], "owner": {"reputation": 1108, "user_id": 2386187, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/53bb844fdcd267690bb1e84b904f7a15?s=128&d=identicon&r=PG", "display_name": "Corey Wu", "link": "https://stackoverflow.com/users/2386187/corey-wu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 879, "favorite_count": 0, "accepted_answer_id": 36460232, "answer_count": 1, "score": 2, "last_activity_date": 1459969623, "creation_date": 1459965244, "last_edit_date": 1459965736, "question_id": 36458752, "link": "https://stackoverflow.com/questions/36458752/android-outofmemoryerror-failed-to-allocate-a-57993496-byte-allocation-with-167", "title": "Android OutOfMemoryError: Failed to allocate a 57993496 byte allocation with 16764448 free bytes", "body": "<p>I am trying to make my <code>count</code> variable synchronized for <code>get</code> and a private helper function for setting based on other members. Multiple threads are each calling <code>setCount()</code> as <code>deadlineNoteVisible</code> and <code>referencesAvailable</code> change.</p>\n\n<p>With <code>synchronized</code> for just the <code>setCount()</code> method, things are fine, but when I add <code>synchronized(this)</code> to the <code>get()</code> call, I \nget:</p>\n\n<pre><code>OutOfMemoryError: Failed to allocate a 57993496 byte allocation with 16764448 free bytes and 32MB until OOM\n</code></pre>\n\n<p>Code (written in Kotlin):</p>\n\n<pre><code>var count: Int = 0\n    // Why does adding synchronized here explode?\n    get() = synchronized(this) { count }\n    private set\n\nprivate fun setCount() {\n    synchronized(this) {\n        count = 0\n        if (deadlineNoteVisible) {\n            count += 1\n        }\n        if (referencesAvailable) {\n            count += 1\n        }\n    }\n}\n</code></pre>\n\n<p>Stack trace:</p>\n\n<pre><code>Error reporting crash\njava.lang.OutOfMemoryError: Failed to allocate a 57993496 byte allocation with 16764448 free bytes and 32MB until OOM\n    at java.lang.AbstractStringBuilder.enlargeBuffer(AbstractStringBuilder.java:95)\n    at java.lang.AbstractStringBuilder.append0(AbstractStringBuilder.java:125)\n    at java.lang.StringBuffer.append(StringBuffer.java:278)\n    at java.io.StringWriter.write(StringWriter.java:123)\n    at com.android.internal.util.FastPrintWriter.flushLocked(FastPrintWriter.java:358)\n    at com.android.internal.util.FastPrintWriter.appendLocked(FastPrintWriter.java:303)\n    at com.android.internal.util.FastPrintWriter.write(FastPrintWriter.java:625)\n    at com.android.internal.util.FastPrintWriter.append(FastPrintWriter.java:658)\n    at java.io.PrintWriter.append(PrintWriter.java:691)\n    at java.io.PrintWriter.append(PrintWriter.java:687)\n    at java.io.Writer.append(Writer.java:198)\n    at java.lang.Throwable.printStackTrace(Throwable.java:324)\n    at java.lang.Throwable.printStackTrace(Throwable.java:300)\n    at android.util.Log.getStackTraceString(Log.java:343)\n    at com.android.internal.os.RuntimeInit.Clog_e(RuntimeInit.java:61)\n    at com.android.internal.os.RuntimeInit.-wrap0(RuntimeInit.java)\n    at com.android.internal.os.RuntimeInit$UncaughtHandler.uncaughtException(RuntimeInit.java:86)\n    at com.crashlytics.android.core.CrashlyticsUncaughtExceptionHandler.uncaughtException(CrashlyticsUncaughtExceptionHandler.java:249)\n    at java.lang.ThreadGroup.uncaughtException(ThreadGroup.java:693)\n    at java.lang.ThreadGroup.uncaughtException(ThreadGroup.java:690)\n</code></pre>\n"}, {"tags": ["scala", "interface", "kotlin", "traits"], "answers": [{"tags": [], "owner": {"reputation": 50303, "user_id": 170842, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/c2ea72b8d001d81fb6ce3f356e45eb3a?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/170842/michael"}, "is_accepted": true, "score": 8, "last_activity_date": 1459954757, "creation_date": 1459954757, "answer_id": 36454925, "question_id": 36454780, "link": "https://stackoverflow.com/questions/36454780/kotlin-vs-scala-implement-methods-with-primary-constructor-parameters/36454925#36454925", "title": "Kotlin VS Scala: Implement methods with primary constructor parameters", "body": "<p>You can make <code>head</code> and <code>tail</code> properties:</p>\n\n<pre><code>interface List&lt;T&gt; {\n   val head: T\n   val tail: List&lt;T&gt;\n\n   fun isEmpty(): Boolean\n}\n\nclass Cons&lt;T&gt;(override val head: T, override val tail: List&lt;T&gt;) : List&lt;T&gt; {\n    override fun isEmpty() = false\n}\n</code></pre>\n"}], "owner": {"reputation": 903, "user_id": 4759312, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh4.googleusercontent.com/-a5WVXQSOHCA/AAAAAAAAAAI/AAAAAAAAABM/ZQN9cG0YL1c/photo.jpg?sz=128", "display_name": "Abdelrhman Talat", "link": "https://stackoverflow.com/users/4759312/abdelrhman-talat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 262, "favorite_count": 1, "accepted_answer_id": 36454925, "answer_count": 1, "score": 3, "last_activity_date": 1460017432, "creation_date": 1459954394, "last_edit_date": 1460017432, "question_id": 36454780, "link": "https://stackoverflow.com/questions/36454780/kotlin-vs-scala-implement-methods-with-primary-constructor-parameters", "title": "Kotlin VS Scala: Implement methods with primary constructor parameters", "body": "<p>In Scala you can write code like this.</p>\n\n<pre><code>trait List[T] {\n   def isEmpty() :Boolean\n   def head() : T\n   def tail() : List[T]\n}\n\nclass Cons[T](val head: T, val tail: List[T]) :List[T] {\n   def isEmpty = false\n}\n</code></pre>\n\n<p>you don't need to override tail and head they are already defined, but in Kotlin I had to code this. </p>\n\n<pre><code>interface List&lt;T&gt; {\n   fun isEmpty() :Boolean\n   fun head() : T\n   fun tail() : List&lt;T&gt;\n}\n\nclass Cons&lt;T&gt;(val head: T, val tail: List&lt;T&gt;) :List&lt;T&gt; {\n    override fun isEmpty() = false\n    override fun head() = head\n    override fun tail() = tail\n}\n</code></pre>\n\n<p>My question is \"is their a better way to write my Kotlin code? \"</p>\n"}, {"tags": ["android", "intellij-idea", "kotlin"], "comments": [{"owner": {"reputation": 623, "user_id": 560638, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/345ce4624f1ea771046f6f6a6ce038d6?s=128&d=identicon&r=PG", "display_name": "eVoxmusic", "link": "https://stackoverflow.com/users/560638/evoxmusic"}, "edited": false, "score": 0, "creation_date": 1460023282, "post_id": 36448142, "comment_id": 60555938, "body": "It seems to be a Kotlin compiler bug, I made a report here &gt; <a href=\"https://youtrack.jetbrains.com/issue/KT-11821\" rel=\"nofollow noreferrer\">youtrack.jetbrains.com/issue/KT-11821</a>"}, {"owner": {"reputation": 2277, "user_id": 3306437, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GR4Wx.jpg?s=128&g=1", "display_name": "Lovekush Vishwakarma", "link": "https://stackoverflow.com/users/3306437/lovekush-vishwakarma"}, "edited": false, "score": 0, "creation_date": 1499098299, "post_id": 36448142, "comment_id": 76757998, "body": "<a href=\"https://www.youtube.com/watch?v=6JDqtEMqdyQ\" rel=\"nofollow noreferrer\">youtube.com/watch?v=6JDqtEMqdyQ</a> see here is good tutorial for beginner"}], "owner": {"reputation": 623, "user_id": 560638, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/345ce4624f1ea771046f6f6a6ce038d6?s=128&d=identicon&r=PG", "display_name": "eVoxmusic", "link": "https://stackoverflow.com/users/560638/evoxmusic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 496, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1527059215, "creation_date": 1459937910, "question_id": 36448142, "link": "https://stackoverflow.com/questions/36448142/android-kotlin-project-not-building-anymore", "title": "Android + Kotlin - Project not building anymore", "body": "<p>Hi kotlin users and mainteners,</p>\n\n<p>Since I have updated Intellij IDEA to the latest patch for 2016 version, I am experiencing this issue while trying to compile my android project..</p>\n\n<pre><code>java.lang.IllegalStateException\n    at org.jetbrains.kotlin.types.SubstitutionUtils.fillInDeepSubstitutor(SubstitutionUtils.java:80)\n    at org.jetbrains.kotlin.types.SubstitutionUtils.fillInDeepSubstitutor(SubstitutionUtils.java:96)\n    at org.jetbrains.kotlin.types.SubstitutionUtils.buildDeepSubstitutionMultimap(SubstitutionUtils.java:65)\n    at org.jetbrains.kotlin.resolve.DeclarationsChecker.checkSupertypesForConsistency(DeclarationsChecker.kt:241)\n    at org.jetbrains.kotlin.resolve.DeclarationsChecker.checkTypeParameterConstraints(DeclarationsChecker.kt:394)\n    at org.jetbrains.kotlin.resolve.DeclarationsChecker.checkFunction(DeclarationsChecker.kt:660)\n    at org.jetbrains.kotlin.resolve.DeclarationsChecker.process(DeclarationsChecker.kt:123)\n    at org.jetbrains.kotlin.resolve.BodyResolver.resolveBodies(BodyResolver.java:233)\n    at org.jetbrains.kotlin.resolve.LazyTopDownAnalyzer.analyzeDeclarations(LazyTopDownAnalyzer.kt:192)\n    at org.jetbrains.kotlin.resolve.LazyTopDownAnalyzerForTopLevel.analyzeDeclarations(LazyTopDownAnalyzerForTopLevel.java:74)\n    at org.jetbrains.kotlin.resolve.LazyTopDownAnalyzerForTopLevel.analyzeFiles(LazyTopDownAnalyzerForTopLevel.java:66)\n    at org.jetbrains.kotlin.resolve.jvm.TopDownAnalyzerFacadeForJVM.analyzeFilesWithJavaIntegration(TopDownAnalyzerFacadeForJVM.java:145)\n    at org.jetbrains.kotlin.resolve.jvm.TopDownAnalyzerFacadeForJVM.analyzeFilesWithJavaIntegrationWithCustomContext(TopDownAnalyzerFacadeForJVM.java:78)\n    at org.jetbrains.kotlin.cli.jvm.compiler.KotlinToJVMBytecodeCompiler$analyze$1.analyze(KotlinToJVMBytecodeCompiler.kt:290)\n    at org.jetbrains.kotlin.cli.common.messages.AnalyzerWithCompilerReport.analyzeAndReport(AnalyzerWithCompilerReport.kt:129)\n    at org.jetbrains.kotlin.cli.jvm.compiler.KotlinToJVMBytecodeCompiler.analyze(KotlinToJVMBytecodeCompiler.kt:283)\n    at org.jetbrains.kotlin.cli.jvm.compiler.KotlinToJVMBytecodeCompiler.analyzeAndGenerate(KotlinToJVMBytecodeCompiler.kt:269)\n    at org.jetbrains.kotlin.cli.jvm.compiler.KotlinToJVMBytecodeCompiler.compileBunchOfSources(KotlinToJVMBytecodeCompiler.kt:194)\n    at org.jetbrains.kotlin.cli.jvm.K2JVMCompiler.doExecute(K2JVMCompiler.kt:196)\n    at org.jetbrains.kotlin.cli.jvm.K2JVMCompiler.doExecute(K2JVMCompiler.kt:49)\n    at org.jetbrains.kotlin.cli.common.CLICompiler.exec(CLICompiler.java:181)\n    at org.jetbrains.kotlin.gradle.tasks.AbstractKotlinCompile.callCompiler(Tasks.kt:87)\n    at org.jetbrains.kotlin.gradle.tasks.AbstractKotlinCompile.compile(Tasks.kt:63)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:497)\n    at org.gradle.internal.reflect.JavaMethod.invoke(JavaMethod.java:63)\n    at org.gradle.api.internal.project.taskfactory.AnnotationProcessingTaskFactory$StandardTaskAction.doExecute(AnnotationProcessingTaskFactory.java:218)\n    at org.gradle.api.internal.project.taskfactory.AnnotationProcessingTaskFactory$StandardTaskAction.execute(AnnotationProcessingTaskFactory.java:211)\n    at org.gradle.api.internal.project.taskfactory.AnnotationProcessingTaskFactory$StandardTaskAction.execute(AnnotationProcessingTaskFactory.java:200)\n    at org.gradle.api.internal.AbstractTask$TaskActionWrapper.execute(AbstractTask.java:579)\n    at org.gradle.api.internal.AbstractTask$TaskActionWrapper.execute(AbstractTask.java:562)\n    at org.gradle.api.internal.tasks.execution.ExecuteActionsTaskExecuter.executeAction(ExecuteActionsTaskExecuter.java:80)\n    at org.gradle.api.internal.tasks.execution.ExecuteActionsTaskExecuter.executeActions(ExecuteActionsTaskExecuter.java:61)\n    at org.gradle.api.internal.tasks.execution.ExecuteActionsTaskExecuter.execute(ExecuteActionsTaskExecuter.java:46)\n    at org.gradle.api.internal.tasks.execution.PostExecutionAnalysisTaskExecuter.execute(PostExecutionAnalysisTaskExecuter.java:35)\n    at org.gradle.api.internal.tasks.execution.SkipUpToDateTaskExecuter.execute(SkipUpToDateTaskExecuter.java:64)\n    at org.gradle.api.internal.tasks.execution.ValidatingTaskExecuter.execute(ValidatingTaskExecuter.java:58)\n    at org.gradle.api.internal.tasks.execution.SkipEmptySourceFilesTaskExecuter.execute(SkipEmptySourceFilesTaskExecuter.java:42)\n    at org.gradle.api.internal.tasks.execution.SkipTaskWithNoActionsExecuter.execute(SkipTaskWithNoActionsExecuter.java:52)\n    at org.gradle.api.internal.tasks.execution.SkipOnlyIfTaskExecuter.execute(SkipOnlyIfTaskExecuter.java:53)\n    at org.gradle.api.internal.tasks.execution.ExecuteAtMostOnceTaskExecuter.execute(ExecuteAtMostOnceTaskExecuter.java:43)\n    at org.gradle.api.internal.AbstractTask.executeWithoutThrowingTaskFailure(AbstractTask.java:305)\n    at org.gradle.execution.taskgraph.AbstractTaskPlanExecutor$TaskExecutorWorker.executeTask(AbstractTaskPlanExecutor.java:79)\n    at org.gradle.execution.taskgraph.AbstractTaskPlanExecutor$TaskExecutorWorker.processTask(AbstractTaskPlanExecutor.java:63)\n    at org.gradle.execution.taskgraph.AbstractTaskPlanExecutor$TaskExecutorWorker.run(AbstractTaskPlanExecutor.java:51)\n    at org.gradle.execution.taskgraph.DefaultTaskPlanExecutor.process(DefaultTaskPlanExecutor.java:23)\n    at org.gradle.execution.taskgraph.DefaultTaskGraphExecuter.execute(DefaultTaskGraphExecuter.java:88)\n    at org.gradle.execution.SelectedTaskExecutionAction.execute(SelectedTaskExecutionAction.java:29)\n    at org.gradle.execution.DefaultBuildExecuter.execute(DefaultBuildExecuter.java:62)\n    at org.gradle.execution.DefaultBuildExecuter.access$200(DefaultBuildExecuter.java:23)\n    at org.gradle.execution.DefaultBuildExecuter$2.proceed(DefaultBuildExecuter.java:68)\n    at org.gradle.execution.DryRunBuildExecutionAction.execute(DryRunBuildExecutionAction.java:32)\n    at org.gradle.execution.DefaultBuildExecuter.execute(DefaultBuildExecuter.java:62)\n    at org.gradle.execution.DefaultBuildExecuter.execute(DefaultBuildExecuter.java:55)\n    at org.gradle.initialization.DefaultGradleLauncher.doBuildStages(DefaultGradleLauncher.java:149)\n    at org.gradle.initialization.DefaultGradleLauncher.doBuild(DefaultGradleLauncher.java:106)\n    at org.gradle.initialization.DefaultGradleLauncher.run(DefaultGradleLauncher.java:86)\n    at org.gradle.launcher.exec.InProcessBuildActionExecuter$DefaultBuildController.run(InProcessBuildActionExecuter.java:80)\n    at org.gradle.launcher.cli.ExecuteBuildAction.run(ExecuteBuildAction.java:33)\n    at org.gradle.launcher.cli.ExecuteBuildAction.run(ExecuteBuildAction.java:24)\n    at org.gradle.launcher.exec.InProcessBuildActionExecuter.execute(InProcessBuildActionExecuter.java:36)\n    at org.gradle.launcher.exec.InProcessBuildActionExecuter.execute(InProcessBuildActionExecuter.java:26)\n    at org.gradle.launcher.daemon.server.exec.ExecuteBuild.doBuild(ExecuteBuild.java:47)\n    at org.gradle.launcher.daemon.server.exec.BuildCommandOnly.execute(BuildCommandOnly.java:34)\n    at org.gradle.launcher.daemon.server.exec.DaemonCommandExecution.proceed(DaemonCommandExecution.java:119)\n    at org.gradle.launcher.daemon.server.exec.WatchForDisconnection.execute(WatchForDisconnection.java:35)\n    at org.gradle.launcher.daemon.server.exec.DaemonCommandExecution.proceed(DaemonCommandExecution.java:119)\n    at org.gradle.launcher.daemon.server.exec.ResetDeprecationLogger.execute(ResetDeprecationLogger.java:24)\n    at org.gradle.launcher.daemon.server.exec.DaemonCommandExecution.proceed(DaemonCommandExecution.java:119)\n    at org.gradle.launcher.daemon.server.exec.StartStopIfBuildAndStop.execute(StartStopIfBuildAndStop.java:33)\n    at org.gradle.launcher.daemon.server.exec.DaemonCommandExecution.proceed(DaemonCommandExecution.java:119)\n    at org.gradle.launcher.daemon.server.exec.ForwardClientInput$2.call(ForwardClientInput.java:71)\n    at org.gradle.launcher.daemon.server.exec.ForwardClientInput$2.call(ForwardClientInput.java:69)\n    at org.gradle.util.Swapper.swap(Swapper.java:38)\n    at org.gradle.launcher.daemon.server.exec.ForwardClientInput.execute(ForwardClientInput.java:69)\n    at org.gradle.launcher.daemon.server.exec.DaemonCommandExecution.proceed(DaemonCommandExecution.java:119)\n    at org.gradle.launcher.daemon.server.exec.LogToClient.doBuild(LogToClient.java:60)\n    at org.gradle.launcher.daemon.server.exec.BuildCommandOnly.execute(BuildCommandOnly.java:34)\n    at org.gradle.launcher.daemon.server.exec.DaemonCommandExecution.proceed(DaemonCommandExecution.java:119)\n    at org.gradle.launcher.daemon.server.exec.EstablishBuildEnvironment.doBuild(EstablishBuildEnvironment.java:70)\n    at org.gradle.launcher.daemon.server.exec.BuildCommandOnly.execute(BuildCommandOnly.java:34)\n    at org.gradle.launcher.daemon.server.exec.DaemonCommandExecution.proceed(DaemonCommandExecution.java:119)\n    at org.gradle.launcher.daemon.server.exec.DaemonHygieneAction.execute(DaemonHygieneAction.java:39)\n    at org.gradle.launcher.daemon.server.exec.DaemonCommandExecution.proceed(DaemonCommandExecution.java:119)\n    at org.gradle.launcher.daemon.server.exec.StartBuildOrRespondWithBusy$1.run(StartBuildOrRespondWithBusy.java:46)\n    at org.gradle.launcher.daemon.server.DaemonStateCoordinator$1.run(DaemonStateCoordinator.java:246)\n    at org.gradle.internal.concurrent.DefaultExecutorFactory$StoppableExecutorImpl$1.run(DefaultExecutorFactory.java:64)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\n\n:project:compileDevDebugKotlin FAILED\n\nFAILURE: Build failed with an exception.\n\n* What went wrong:\nExecution failed for task ':project:compileDevDebugKotlin'.\n&gt; Internal compiler error. See log for more details\n\n* Try:\nRun with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output.\n\nBUILD FAILED\n</code></pre>\n\n<p>It's maybe not realted to Intellij IDEA update. Is it a Kotlin compiler bug ? Do you have any idea of how to fix that ? Thank you.</p>\n"}, {"tags": ["kotlin"], "answers": [{"comments": [{"owner": {"reputation": 29751, "user_id": 3286489, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yTcB3.png?s=128&g=1", "display_name": "Elye", "link": "https://stackoverflow.com/users/3286489/elye"}, "edited": false, "score": 2, "creation_date": 1459909649, "post_id": 36440329, "comment_id": 60495208, "body": "Thanks! Found we need <code>compile &quot;org.jetbrains.kotlin:kotlin-reflect:$kotlin_version&quot; testCompile &quot;org.jetbrains.kotlin:kotlin-test:$kotlin_version&quot;</code> as per in <a href=\"https://kotlinlang.org/docs/reference/using-gradle.html\" rel=\"nofollow noreferrer\">kotlinlang.org/docs/reference/using-gradle.html</a>"}, {"owner": {"reputation": 4200, "user_id": 2552290, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/7fT1c.gif?s=128&g=1", "display_name": "Don Hatch", "link": "https://stackoverflow.com/users/2552290/don-hatch"}, "edited": false, "score": 0, "creation_date": 1515016234, "post_id": 36440329, "comment_id": 83146185, "body": "Perhaps not obvious: (1) must be double quotes, not single, otherwise $kotlin_version won&#39;t expand,  (2) according to <a href=\"https://kotlinlang.org/docs/reference/using-gradle.html#configuring-dependencies\" rel=\"nofollow noreferrer\">kotlinlang.org/docs/reference/&hellip;</a> , the :$kotlin_version can be omitted if it&#39;s &gt;= 1.1.2.  But that seems to be broken for me (my $kotlin_version is 1.2.10 currently); the error message shows that it constructs a bogus url such as <code>https:&#47;&#47;jcenter.bintray.com&#47;org&#47;jetbrains&#47;kotlin&#47;kotlin-refl&zwnj;&#8203;ect&#47;&#47;kotlin-reflect-&zwnj;&#8203;.jar</code>.  So, I am still using the recipe in this answer."}, {"owner": {"reputation": 4741, "user_id": 1145905, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/af7748a9885fe3e6ecd05a8bd85706f5?s=128&d=identicon&r=PG", "display_name": "kip2", "link": "https://stackoverflow.com/users/1145905/kip2"}, "edited": false, "score": 4, "creation_date": 1521641226, "post_id": 36440329, "comment_id": 85818289, "body": "Worth mentioning that <code>implementation</code> is now the favored directive over <code>compile</code>:  <code>implementation &quot;org.jetbrains.kotlin:kotlin-reflect:$kotlin_version&quot;</code>"}, {"owner": {"reputation": 796, "user_id": 3183912, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/K0t9E.jpg?s=128&g=1", "display_name": "Trinity", "link": "https://stackoverflow.com/users/3183912/trinity"}, "edited": false, "score": 0, "creation_date": 1581449002, "post_id": 36440329, "comment_id": 106435136, "body": "is there any proguard rule for this dependency?"}], "tags": [], "owner": {"reputation": 13934, "user_id": 4096987, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9b66edfbc16fa01f3f45d764a3fa01bb?s=128&d=identicon&r=PG&f=1", "display_name": "AndroidEx", "link": "https://stackoverflow.com/users/4096987/androidex"}, "is_accepted": true, "score": 161, "last_activity_date": 1537280718, "last_edit_date": 1537280718, "creation_date": 1459909201, "answer_id": 36440329, "question_id": 36440295, "link": "https://stackoverflow.com/questions/36440295/kotlin-jvm-kotlinreflectionnotsupportederror-kotlin-reflection-implementation-i/36440329#36440329", "title": "kotlin.jvm.KotlinReflectionNotSupportedError: Kotlin reflection implementation is not found at runtime. Make sure you have kotlin-reflect.jar", "body": "<p>From the error, I assume:</p>\n\n<pre><code>implementation \"org.jetbrains.kotlin:kotlin-reflect:$kotlin_version\"\n</code></pre>\n\n<p>in your <code>dependencies</code> in addition to the standard library.</p>\n"}, {"tags": [], "owner": {"reputation": 527, "user_id": 4537886, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1bc594d4409a6806c8c43d456ce096e?s=128&d=identicon&r=PG&f=1", "display_name": "Arade", "link": "https://stackoverflow.com/users/4537886/arade"}, "is_accepted": false, "score": 1, "last_activity_date": 1538239905, "creation_date": 1538239905, "answer_id": 52570513, "question_id": 36440295, "link": "https://stackoverflow.com/questions/36440295/kotlin-jvm-kotlinreflectionnotsupportederror-kotlin-reflection-implementation-i/52570513#52570513", "title": "kotlin.jvm.KotlinReflectionNotSupportedError: Kotlin reflection implementation is not found at runtime. Make sure you have kotlin-reflect.jar", "body": "<p>For me the issue was not having the same versions of kotlin I'm my modules and lib\nso I had to force them to use the same version </p>\n\n<pre><code>configurations.all {\n    resolutionStrategy {\n        eachDependency { DependencyResolveDetails details -&gt;\n            if (details.requested.group == 'org.jetbrains.kotlin') {\n                details.useVersion versions.kotlin\n            }\n        }\n    }}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 650, "user_id": 6607435, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uVnaE.jpg?s=128&g=1", "display_name": "Pawan Soni", "link": "https://stackoverflow.com/users/6607435/pawan-soni"}, "is_accepted": false, "score": 1, "last_activity_date": 1578481421, "creation_date": 1578481421, "answer_id": 59644442, "question_id": 36440295, "link": "https://stackoverflow.com/questions/36440295/kotlin-jvm-kotlinreflectionnotsupportederror-kotlin-reflection-implementation-i/59644442#59644442", "title": "kotlin.jvm.KotlinReflectionNotSupportedError: Kotlin reflection implementation is not found at runtime. Make sure you have kotlin-reflect.jar", "body": "<p>I resolved this by adding this in build.gradle</p>\n\n<pre><code>implementation \"org.jetbrains.kotlin:kotlin-reflect:1.3.61\"\n</code></pre>\n"}], "owner": {"reputation": 29751, "user_id": 3286489, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yTcB3.png?s=128&g=1", "display_name": "Elye", "link": "https://stackoverflow.com/users/3286489/elye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 25851, "favorite_count": 6, "accepted_answer_id": 36440329, "answer_count": 3, "score": 86, "last_activity_date": 1578481421, "creation_date": 1459908982, "question_id": 36440295, "link": "https://stackoverflow.com/questions/36440295/kotlin-jvm-kotlinreflectionnotsupportederror-kotlin-reflection-implementation-i", "title": "kotlin.jvm.KotlinReflectionNotSupportedError: Kotlin reflection implementation is not found at runtime. Make sure you have kotlin-reflect.jar", "body": "<p>When I compile I got the above error. My gradle file as below : -</p>\n\n<pre><code>apply plugin: 'com.android.application'\napply plugin: 'kotlin-android'\napply plugin: 'kotlin-android-extensions'\n\nandroid {\n    compileSdkVersion 23\n    buildToolsVersion \"24.0.0 rc2\"\n\n    defaultConfig {\n        applicationId \"package.name\"\n        minSdkVersion 16\n        targetSdkVersion 23\n        versionCode 6\n        versionName \"2.0\"\n    }\n\n    buildTypes {\n        debug {\n            minifyEnabled false\n            signingConfig signingConfigs.debug\n        }\n        release {\n            minifyEnabled true\n            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'\n            signingConfig signingConfigs.release\n        }\n    }\n    sourceSets {\n        main.java.srcDirs += 'src/main/kotlin'\n    }\n}\n\ndependencies {\n    compile fileTree(dir: 'libs', include: ['*.jar'])\n    testCompile 'junit:junit:4.12'\n    compile \"com.android.support:appcompat-v7:$support_version\"\n    compile \"org.jetbrains.kotlin:kotlin-stdlib:$kotlin_version\"\n    compile \"org.jetbrains.anko:anko-sdk15:$anko_version\"\n    compile \"org.jetbrains.anko:anko-support-v4:$anko_version\"\n    compile \"com.android.support:recyclerview-v7:$support_version\"\n}\n\nbuildscript {\n    ext.kotlin_version = '1.0.1-2'\n    repositories {\n        jcenter()\n        mavenCentral()\n    }\n    dependencies {\n        classpath \"org.jetbrains.kotlin:kotlin-android-extensions:$kotlin_version\"\n    }\n}\nrepositories {\n    mavenCentral()\n}\n</code></pre>\n\n<p>And my project gradle as below</p>\n\n<pre><code>buildscript {\n    ext.support_version = '23.2.1'\n    ext.kotlin_version = '1.0.1'\n    ext.anko_version = '0.8.3'\n    repositories {\n        jcenter()\n    }\n    dependencies {\n        classpath 'com.android.tools.build:gradle:2.1.0-alpha3'\n        classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version\"\n\n        // NOTE: Do not place your application dependencies here; they belong\n        // in the individual module build.gradle files\n    }\n}\n\nallprojects {\n    repositories {\n        jcenter()\n    }\n}\n\ntask clean(type: Delete) {\n    delete rootProject.buildDir\n}\n</code></pre>\n\n<p>Did I miss adding anything?</p>\n"}, {"tags": ["kotlin"], "comments": [{"owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "edited": false, "score": 0, "creation_date": 1459956134, "post_id": 36440061, "comment_id": 60523419, "body": "in the second snipped the syntax is wrong. The message could be probably more informative, like &quot;property assignment is conflicts with property delegation&quot;"}, {"owner": {"reputation": 29751, "user_id": 3286489, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yTcB3.png?s=128&g=1", "display_name": "Elye", "link": "https://stackoverflow.com/users/3286489/elye"}, "reply_to_user": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "edited": false, "score": 0, "creation_date": 1459984782, "post_id": 36440061, "comment_id": 60539727, "body": "Agree. The error message is not intuitive. Thanks."}], "answers": [{"comments": [{"owner": {"reputation": 29751, "user_id": 3286489, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yTcB3.png?s=128&g=1", "display_name": "Elye", "link": "https://stackoverflow.com/users/3286489/elye"}, "edited": false, "score": 0, "creation_date": 1459909777, "post_id": 36440369, "comment_id": 60495245, "body": "Thanks! for the first one I just realise I could simplify to <code>val mPagerAdapter by lazy {     PagerAdapter(supportFragmentManager, fragments, mTabsName) }</code>"}], "tags": [], "owner": {"reputation": 13934, "user_id": 4096987, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9b66edfbc16fa01f3f45d764a3fa01bb?s=128&d=identicon&r=PG&f=1", "display_name": "AndroidEx", "link": "https://stackoverflow.com/users/4096987/androidex"}, "is_accepted": true, "score": 4, "last_activity_date": 1459909418, "creation_date": 1459909418, "answer_id": 36440369, "question_id": 36440061, "link": "https://stackoverflow.com/questions/36440061/kotlin-how-to-lazy-initialization-a-vector/36440369#36440369", "title": "Kotlin: How to Lazy Initialization a Vector", "body": "<p>In your second case the syntax is noticeably different from the first snippet (you initialize your variable before <code>by</code>), compare to:</p>\n\n<pre><code>val fragments by lazy { Vector&lt;Fragment&gt;() }\n</code></pre>\n"}], "owner": {"reputation": 29751, "user_id": 3286489, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yTcB3.png?s=128&g=1", "display_name": "Elye", "link": "https://stackoverflow.com/users/3286489/elye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2083, "favorite_count": 0, "accepted_answer_id": 36440369, "answer_count": 1, "score": 0, "last_activity_date": 1542770027, "creation_date": 1459907434, "last_edit_date": 1542770027, "question_id": 36440061, "link": "https://stackoverflow.com/questions/36440061/kotlin-how-to-lazy-initialization-a-vector", "title": "Kotlin: How to Lazy Initialization a Vector", "body": "<p>When I lazy initialise a vector. I could do it for normal Object class as below.</p>\n\n<pre><code>val mPagerAdapter: PagerAdapter by lazy {\n    PagerAdapter(supportFragmentManager, fragments, mTabsName)\n}\n</code></pre>\n\n<p>However, when I lazy initialise a Vector variable as below</p>\n\n<pre><code>val fragments = Vector&lt;Fragment&gt;() by lazy {\n    Vector&lt;Fragment&gt;()\n}\n</code></pre>\n\n<p>It gave me error stating <code>Unresolve Reference: by</code>. How to fix this problem that I could lazy initialise it?</p>\n"}, {"tags": ["kotlin"], "answers": [{"comments": [{"owner": {"reputation": 2108, "user_id": 1377037, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/b5941b2951d33748024848f82e7bf784?s=128&d=identicon&r=PG", "display_name": "Jonathan Beaudoin", "link": "https://stackoverflow.com/users/1377037/jonathan-beaudoin"}, "edited": false, "score": 0, "creation_date": 1459900132, "post_id": 36438984, "comment_id": 60492775, "body": "Ah didn&#39;t catch that. Thanks!"}], "tags": [], "owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "is_accepted": true, "score": 7, "last_activity_date": 1459899766, "creation_date": 1459899766, "answer_id": 36438984, "question_id": 36438810, "link": "https://stackoverflow.com/questions/36438810/kotlin-i-inc-10x-slower-than-i/36438984#36438984", "title": "Kotlin i.inc() 10x slower than i++?", "body": "<p><code>inc()</code> call in your code is completely redundant: it doesn't change the variable:</p>\n\n<pre><code>var x = 0\nx.inc()\nprintln(x) // 0\n</code></pre>\n\n<p>As to the difference in run time, even the semantics of the two implementations is different:</p>\n\n<ul>\n<li><p>First snippet:</p>\n\n<pre><code>while (i &lt; data.size) {\n    for (j in bytes.indices) {\n        bytes[j] = data[i++]\n    }\n    //...\n}\n</code></pre>\n\n<p>Inner loop changes <code>i</code>, so there won't be an iteration of <code>while</code> for each <code>i</code>, some (even most, I suppose) values of <code>i</code> will be skipped.</p></li>\n<li><p>Second snippet:</p>\n\n<pre><code>for (i in data.indices) {\n    for (j in bytes.indices) {\n        bytes[j] = data[i] // removed redundant i.inc()\n    }\n    //...\n}\n</code></pre>\n\n<p>Inner loop is called for each <code>i</code> in outer loop, therefore it will take much longer.</p></li>\n</ul>\n"}], "owner": {"reputation": 2108, "user_id": 1377037, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/b5941b2951d33748024848f82e7bf784?s=128&d=identicon&r=PG", "display_name": "Jonathan Beaudoin", "link": "https://stackoverflow.com/users/1377037/jonathan-beaudoin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 415, "favorite_count": 1, "accepted_answer_id": 36438984, "answer_count": 1, "score": 0, "last_activity_date": 1459899766, "creation_date": 1459898693, "question_id": 36438810, "link": "https://stackoverflow.com/questions/36438810/kotlin-i-inc-10x-slower-than-i", "title": "Kotlin i.inc() 10x slower than i++?", "body": "<p>So today I learned about the num.inc() feature in kotlin and decided to implement it in my code. Needless to say, that added 10x the latency time to my code (went from ~400ms to 4000+ms)</p>\n\n<p>Here is the example with my traditional way (i++, 400ms)</p>\n\n<pre><code>package com.beaudoin\n\nimport java.io.BufferedWriter\nimport java.io.FileInputStream\nimport java.io.FileWriter\nimport java.nio.channels.FileChannel\n\nfun main(args: Array&lt;String&gt;) {\n    val s = System.currentTimeMillis()\n\n    val channel = FileInputStream(\"client.dll\").channel\n    val buffer = channel.map(FileChannel.MapMode.READ_ONLY, 0, channel.size())\n    val data = ByteArray(buffer.capacity())\n    buffer.get(data)\n\n    val writer = BufferedWriter(FileWriter(\"dump.txt\", false))\n    val bytes = ByteArray(16)\n\n    var offset = 0\n    var i = 0\n    while (i &lt; data.size) {\n        for (j in bytes.indices) {\n            bytes[j] = data[i++]\n        }\n        writer.write(HexRow(offset, bytes).toString())\n        writer.newLine()\n        offset += 16\n    }\n\n    writer.close()\n\n    println(System.currentTimeMillis() - s)\n}\n\nprivate val HEX_ARRAY = \"0123456789ABCDEF\".toCharArray()\nprivate val bytes = ByteArray(4);\n\nclass HexRow(val offset: Int, val values: ByteArray) {\n\n    fun bytesToChar(bytes: ByteArray, width: Int): CharArray {\n        val hexChars = CharArray((bytes.size * 2) + (bytes.size / width))\n\n        for (i in bytes.indices) {\n            val v = bytes[i].toInt() and 0xFF\n            val idx = (i * 2) + i / width\n\n            hexChars[idx] = HEX_ARRAY[v.ushr(4)]\n            hexChars[idx + 1] = HEX_ARRAY[v and 0x0F]\n            if (idx + 2 &lt; hexChars.size) {\n                hexChars[idx + 2] = ' '\n            }\n        }\n        return hexChars;\n    }\n\n    fun bytesToHex(value: Int) = String(bytesToChar(toByteArray(value), 6))\n\n    fun bytesToHex(bytes: ByteArray) = String(bytesToChar(bytes, 1))\n\n    fun toByteArray(value: Int): ByteArray {\n        bytes[0] = value.ushr(24).toByte()\n        bytes[1] = value.ushr(16).toByte()\n        bytes[2] = value.ushr(8).toByte()\n        bytes[3] = value.toByte()\n        return bytes\n    }\n\n    override fun toString() = bytesToHex(offset) + \" \" + bytesToHex(values)\n\n}\n</code></pre>\n\n<p>and here is the code using i.inc() (4000ms+)</p>\n\n<pre><code>package com.beaudoin\n\nimport java.io.BufferedWriter\nimport java.io.FileInputStream\nimport java.io.FileWriter\nimport java.nio.channels.FileChannel\n\nfun main(args: Array&lt;String&gt;) {\n    val s = System.currentTimeMillis()\n\n    val channel = FileInputStream(\"client.dll\").channel\n    val buffer = channel.map(FileChannel.MapMode.READ_ONLY, 0, channel.size())\n    val data = ByteArray(buffer.capacity())\n    buffer.get(data)\n\n    val writer = BufferedWriter(FileWriter(\"dump.txt\", false))\n    val bytes = ByteArray(16)\n\n    var offset = 0\n/*  var i = 0\n    while (i &lt; data.size) {\n        for (j in bytes.indices) {\n            bytes[j] = data[i++]\n        }\n        writer.write(HexRow(offset, bytes).toString())\n        writer.newLine()\n        offset += 16\n    }*/\n\n    for (i in data.indices) {\n        for (j in bytes.indices) {\n            bytes[j] = data[i]\n            i.inc()\n        }\n        writer.write(HexRow(offset, bytes).toString())\n        writer.newLine()\n        offset += 16\n    }\n\n    writer.close()\n\n    println(System.currentTimeMillis() - s)\n}\n\nprivate val HEX_ARRAY = \"0123456789ABCDEF\".toCharArray()\nprivate val bytes = ByteArray(4);\n\nclass HexRow(val offset: Int, val values: ByteArray) {\n\n    fun bytesToChar(bytes: ByteArray, width: Int): CharArray {\n        val hexChars = CharArray((bytes.size * 2) + (bytes.size / width))\n\n        for (i in bytes.indices) {\n            val v = bytes[i].toInt() and 0xFF\n            val idx = (i * 2) + i / width\n\n            hexChars[idx] = HEX_ARRAY[v.ushr(4)]\n            hexChars[idx + 1] = HEX_ARRAY[v and 0x0F]\n            if (idx + 2 &lt; hexChars.size) {\n                hexChars[idx + 2] = ' '\n            }\n        }\n        return hexChars;\n    }\n\n    fun bytesToHex(value: Int) = String(bytesToChar(toByteArray(value), 6))\n\n    fun bytesToHex(bytes: ByteArray) = String(bytesToChar(bytes, 1))\n\n    fun toByteArray(value: Int): ByteArray {\n        bytes[0] = value.ushr(24).toByte()\n        bytes[1] = value.ushr(16).toByte()\n        bytes[2] = value.ushr(8).toByte()\n        bytes[3] = value.toByte()\n        return bytes\n    }\n\n    override fun toString() = bytesToHex(offset) + \" \" + bytesToHex(values)\n\n}\n</code></pre>\n\n<p>Can someone please tell me why i.inc() is so much slower than i++?</p>\n\n<p>P.S: Replace client.dll with any file (should be ~12mb to get numbers accurate to mine or simply download my test file here <a href=\"https://dl.dropboxusercontent.com/u/91292881/ShareX/2016/04/2016-04-05_19-24-27.txt\" rel=\"nofollow\" title=\"here\">here</a></p>\n"}, {"tags": ["kotlin"], "comments": [{"owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "edited": false, "score": 5, "creation_date": 1459889965, "post_id": 36436679, "comment_id": 60488598, "body": "This question seems rather opinion-based to me. Probably <a href=\"https://discuss.kotlinlang.org\" rel=\"nofollow noreferrer\">discuss.kotlinlang.org</a> or <a href=\"https://kotlinlang.slack.com\" rel=\"nofollow noreferrer\">kotlinlang.slack.com</a> are better places for discussing language design questions like this one. As for me, I would find this construct confusing, because <code>for (item in items) { ... }</code> has iteration semantics, and your construct with <code>var</code> doesn&#39;t, instead it requires the <code>item</code> to be changed in the body, thus introducing more confusion."}], "answers": [{"tags": [], "owner": {"reputation": 279, "user_id": 5981797, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qhK17uDO3NE/AAAAAAAAAAI/AAAAAAAABWI/H9x213QWPhI/photo.jpg?sz=128", "display_name": "gmariotti", "link": "https://stackoverflow.com/users/5981797/gmariotti"}, "is_accepted": false, "score": 3, "last_activity_date": 1459890479, "creation_date": 1459890479, "answer_id": 36437084, "question_id": 36436679, "link": "https://stackoverflow.com/questions/36436679/why-can-you-not-specify-var-val-loops-in-kotlin/36437084#36437084", "title": "Why can you not specify var/val loops in Kotlin?", "body": "<p>I think that because Kotlin is a language that tries to make easy to respect most of the functional programming concepts, it prefers to prohibit that sort of behaviour. Also, a possible problem that your initial code could encount is an OutOfBoundException in the situation where the bytes array has more elements than the data array.</p>\n"}, {"comments": [{"owner": {"reputation": 2108, "user_id": 1377037, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/b5941b2951d33748024848f82e7bf784?s=128&d=identicon&r=PG", "display_name": "Jonathan Beaudoin", "link": "https://stackoverflow.com/users/1377037/jonathan-beaudoin"}, "edited": false, "score": 0, "creation_date": 1459898773, "post_id": 36438140, "comment_id": 60492370, "body": "Using i.inc() solved my issue. Thanks for explaination!"}], "tags": [], "owner": {"reputation": 91, "user_id": 5365826, "user_type": "registered", "profile_image": "https://graph.facebook.com/530048337146795/picture?type=large", "display_name": "Frod Mann", "link": "https://stackoverflow.com/users/5365826/frod-mann"}, "is_accepted": true, "score": 4, "last_activity_date": 1459895012, "creation_date": 1459895012, "answer_id": 36438140, "question_id": 36436679, "link": "https://stackoverflow.com/questions/36436679/why-can-you-not-specify-var-val-loops-in-kotlin/36438140#36438140", "title": "Why can you not specify var/val loops in Kotlin?", "body": "<p>Your example is slightly different from Java's typical <code>for(int i=0;i&lt;data.size;i++)</code> example. \nIn the Kotlin version 'i' is actually an element of the range in which case i++ doesn't make sense. It just so happens that the range you have is a list of indexes.</p>\n\n<p>The way you are using the Kotlin for loop is much closer to Java's foreach loop <code>for(i : indexes)</code>.</p>\n"}], "owner": {"reputation": 2108, "user_id": 1377037, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/b5941b2951d33748024848f82e7bf784?s=128&d=identicon&r=PG", "display_name": "Jonathan Beaudoin", "link": "https://stackoverflow.com/users/1377037/jonathan-beaudoin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 669, "favorite_count": 2, "closed_date": 1459909988, "accepted_answer_id": 36438140, "answer_count": 2, "score": 4, "last_activity_date": 1459895129, "creation_date": 1459889033, "question_id": 36436679, "link": "https://stackoverflow.com/questions/36436679/why-can-you-not-specify-var-val-loops-in-kotlin", "closed_reason": "Opinion-based", "title": "Why can you not specify var/val loops in Kotlin?", "body": "<p>Why can't you specify a val or var type in for loop's in Kotlin. For example, I would like to be able to do</p>\n\n<pre><code>    for (var i in 0...data.size - 1) {\n        for (j in 0..bytes.size - 1) {\n            bytes[j] = data[i++]//cant do i++ in current kotlin because \"i\" is val\n        }\n        //do stuff\n    }\n</code></pre>\n\n<p>But instead I have to do this</p>\n\n<pre><code>    var i = 0\n    while (i &lt; data.size) {\n        for (j in 0..bytes.size - 1) {\n            bytes[j] = data[i++]\n        }\n        //do stuff\n    }\n</code></pre>\n"}, {"tags": ["iterator", "iteration", "kotlin"], "answers": [{"tags": [], "owner": {"reputation": 32343, "user_id": 155213, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57bc3e08faeb981ddc81abd1d25c3bf1?s=128&d=identicon&r=PG", "display_name": "miensol", "link": "https://stackoverflow.com/users/155213/miensol"}, "is_accepted": false, "score": 3, "last_activity_date": 1459883508, "creation_date": 1459883508, "answer_id": 36435071, "question_id": 36434836, "link": "https://stackoverflow.com/questions/36434836/return-double-index-of-collections-element-while-iterating/36435071#36435071", "title": "Return double index of collection&#39;s element while iterating", "body": "<p>The following method:</p>\n\n<pre><code>data class Matrix2DValue&lt;T&gt;(val x: Int, val y: Int, val value: T)\nfun withIndex(): Iterable&lt;Matrix2DValue&lt;T&gt;&gt; {\n   //build the list of values\n}\n</code></pre>\n\n<p>Would allow you to write <code>for</code> as:</p>\n\n<pre><code>    for ((x, y, value) in matrix2d.withIndex()) {\n        println(\"value: $value, x: $x, y: $y\")\n    }\n</code></pre>\n\n<p>Bear in mind though that the order in which you declare <code>data class</code> properties defines the values of <code>(x, y, value)</code> - as opposed to <code>for</code> variable names. You can find more <a href=\"https://kotlinlang.org/docs/reference/multi-declarations.html\" rel=\"nofollow\">information about destructuring in the Kotlin documentation</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 24586, "user_id": 3255152, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fbd95ef81d0a85310fee8dd46e0f65b0?s=128&d=identicon&r=PG&f=1", "display_name": "mfulton26", "link": "https://stackoverflow.com/users/3255152/mfulton26"}, "edited": false, "score": 1, "creation_date": 1459884739, "post_id": 36435088, "comment_id": 60485369, "body": "In addition to native Kotlin solutions, any Java solution, such as Guava&#39;s <a href=\"http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/collect/Table.html#cellSet()\" rel=\"nofollow noreferrer\">Table.cellSet()</a>, can be used."}], "tags": [], "owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "is_accepted": false, "score": 5, "last_activity_date": 1459897403, "last_edit_date": 1495540238, "creation_date": 1459883570, "answer_id": 36435088, "question_id": 36434836, "link": "https://stackoverflow.com/questions/36434836/return-double-index-of-collections-element-while-iterating/36435088#36435088", "title": "Return double index of collection&#39;s element while iterating", "body": "<p>These two language features are used for implementing the behaviour that you want:</p>\n\n<ul>\n<li><p>For-loops can be used with any class that has a method <a href=\"https://kotlinlang.org/docs/reference/control-flow.html#for-loops\" rel=\"nofollow noreferrer\">that provides an iterator</a>.</p>\n\n<pre><code>for (item in myItems) { ... }\n</code></pre>\n\n<p>This code will compile if <code>myItems</code> has function <code>iterator()</code> returning something with functions <code>hasNext(): Boolean</code> and <code>next()</code>. </p>\n\n<p>Usually it is an <a href=\"https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-iterable/\" rel=\"nofollow noreferrer\"><code>Iterable&lt;SomeType&gt;</code></a> implementation (some collection), but you can add <code>iterator()</code> method to an existing class as an <a href=\"https://kotlinlang.org/docs/reference/extensions.html#extension-functions\" rel=\"nofollow noreferrer\">extension</a>, and you will be able to use that class in for-loops as well.</p></li>\n<li><p>For <a href=\"https://kotlinlang.org/docs/reference/multi-declarations.html\" rel=\"nofollow noreferrer\">destructuring declaration</a>, the item type should have <code>componentN()</code> functions.</p>\n\n<pre><code>val (x, y, z) = item\n</code></pre>\n\n<p>Here the compiler expects <code>item</code> to have <code>component1()</code>, <code>component2()</code> and <code>component3()</code> functions. You can also use <a href=\"https://kotlinlang.org/docs/reference/data-classes.html#data-classes\" rel=\"nofollow noreferrer\"><code>data</code> classes</a>, they have these functions generated.</p>\n\n<p>Destructuring in for-loop works in a similar way: the type that the iterator's <code>next()</code> returns must have <code>componentN()</code> functions.</p></li>\n</ul>\n\n<p><hr>\nExample implementation (not pretending to be best at performance, see below):</p>\n\n<ul>\n<li><p>Class with destructuring support:</p>\n\n<pre><code>class Cell&lt;T&gt;(val i: Int, val j: Int, val item: T) {\n    operator fun component1() = i\n    operator fun component2() = j\n    operator fun component3() = item\n}\n</code></pre>\n\n<p>Or using <code>data</code> class: </p>\n\n<pre><code>data class Cell&lt;T&gt;(val i: Int, val j: Int, val item: T)\n</code></pre></li>\n<li><p>Function that returns <code>List&lt;Cell&lt;T&gt;&gt;</code> (written as an extension, but can also be a member function):</p>\n\n<pre><code>fun &lt;T&gt; Matrix&lt;T&gt;.withIndex() =\n    (0 .. height - 1).flatMap { i -&gt; \n        (0 .. width - 1). map { j -&gt;\n            Cell(i, j, this[i, j])\n        }\n    }\n</code></pre></li>\n<li><p>The usage:</p>\n\n<pre><code>for ((i, j, item) in matrix2d.withIndex()) { ... }\n</code></pre></li>\n</ul>\n\n<hr>\n\n<p><strong>UPD</strong> Solution offered by <a href=\"https://stackoverflow.com/users/170842/michael\">Michael</a> actually performs better (run <a href=\"https://gist.github.com/h0tk3y/b8fe0da736f69e4c0685b525bbaf3577\" rel=\"nofollow noreferrer\">this test</a>, the difference is about 2x to 3x), so it's more suitable for performance critical code.</p>\n"}, {"comments": [{"owner": {"reputation": 2840, "user_id": 966467, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/a467f6a4dcfe3ac934d544193e1d3f02?s=128&d=identicon&r=PG", "display_name": "likern", "link": "https://stackoverflow.com/users/966467/likern"}, "edited": false, "score": 0, "creation_date": 1459891447, "post_id": 36437243, "comment_id": 60489400, "body": "Is there a way to make similar functionality as destructuring in for loop, but without allocating every time Cell object and then destructuring them? I mean rewrite code with components calls?"}, {"owner": {"reputation": 50303, "user_id": 170842, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/c2ea72b8d001d81fb6ce3f356e45eb3a?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/170842/michael"}, "reply_to_user": {"reputation": 2840, "user_id": 966467, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/a467f6a4dcfe3ac934d544193e1d3f02?s=128&d=identicon&r=PG", "display_name": "likern", "link": "https://stackoverflow.com/users/966467/likern"}, "edited": false, "score": 0, "creation_date": 1459891650, "post_id": 36437243, "comment_id": 60489499, "body": "There&#39;s no way I&#39;m aware of to make it with the same efficiency but I have an idea how it can be implemented much more efficient than in other answers. I need some time to try and code it so I&#39;ll add the second solution tomorrow."}, {"owner": {"reputation": 2840, "user_id": 966467, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/a467f6a4dcfe3ac934d544193e1d3f02?s=128&d=identicon&r=PG", "display_name": "likern", "link": "https://stackoverflow.com/users/966467/likern"}, "edited": false, "score": 0, "creation_date": 1459893456, "post_id": 36437243, "comment_id": 60490408, "body": "Thanks! That&#39;s a great answer! I agree, the first solution is better, even despite it&#39;s not as usual as traditional <code>for</code>-loop"}, {"owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "edited": false, "score": 1, "creation_date": 1459897120, "post_id": 36437243, "comment_id": 60491848, "body": "Good point about performance! I&#39;ve run some tests and updated my answer, pointing your solution as more performant. The difference is 2x to 3x, which is actually crucial for performance critical code."}], "tags": [], "owner": {"reputation": 50303, "user_id": 170842, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/c2ea72b8d001d81fb6ce3f356e45eb3a?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/170842/michael"}, "is_accepted": true, "score": 5, "last_activity_date": 1459893076, "last_edit_date": 1495541761, "creation_date": 1459891132, "answer_id": 36437243, "question_id": 36434836, "link": "https://stackoverflow.com/questions/36434836/return-double-index-of-collections-element-while-iterating/36437243#36437243", "title": "Return double index of collection&#39;s element while iterating", "body": "<p>While the solutions proposed by <a href=\"https://stackoverflow.com/users/155213/miensol\">miensol</a> and <a href=\"https://stackoverflow.com/users/2196460/hotkey\">hotkey</a> are correct it would be the least efficient way to iterate a matrix. For instance, the solution of <a href=\"https://stackoverflow.com/users/2196460/hotkey\">hotkey</a> makes <code>M * N</code> allocations of <code>Cell&lt;T&gt;</code> plus <code>M</code> allocations of <code>List&lt;Cell&lt;T&gt;&gt;</code> and <code>IntRange</code> plus one allocation of <code>List&lt;List&lt;Cell&lt;T&gt;&gt;&gt;</code> and <code>IntRange</code>. Moreover lists resize when new cells are added so even more allocations happen. That's too much allocations for just iterating a matrix.</p>\n\n<h2>Iteration using an inline function</h2>\n\n<p>I would recommend you to implement a very similar and very effective at the same time extension function that will be similar to <code>Array&lt;T&gt;.forEachIndexed</code>. This solution doesn't do any allocations at all and as efficient as writing nested <code>for</code> cycles.</p>\n\n<pre><code>inline fun &lt;T&gt; Matrix&lt;T&gt;.forEachIndexed(callback: (Int, Int, T) -&gt; Unit) {\n  for (i in 0..cols - 1) {\n    for (j in 0..rows - 1) {\n      callback(i, j, this[i, j])\n    }\n  }\n}\n</code></pre>\n\n<p>You can call this function in the following way:</p>\n\n<pre><code>matrix.forEachIndexed { i, j, value -&gt;\n  if (otherMatrix[i, j] &gt; value) doSomething()\n}\n</code></pre>\n\n<h2>Iteration using a destructive declaration</h2>\n\n<p>If you want to use a traditional <code>for</code>-loop with destructive declaration for some reason there exist a way more efficient but hacky solution. It uses a sequence instead of allocating multiple lists and creates only a single instance of <code>Cell</code>, but the <code>Cell</code> itself is mutable.</p>\n\n<pre><code>data class Cell&lt;T&gt;(var i: Int, var j: Int, var value: T)\n\nfun &lt;T&gt; Matrix&lt;T&gt;.withIndex(): Sequence&lt;Cell&lt;T&gt;&gt; {\n  val cell = Cell(0, 0, this[0, 0])\n  return generateSequence(cell) { cell -&gt;\n    cell.j += 1\n    if (cell.j &gt;= rows) {\n      cell.j = 0\n      cell.i += 1\n      if (cell.i &gt;= cols) {\n        return@generateSequence null\n      }\n    }\n    cell.value = this[cell.i, cell.j]\n    cell\n  }\n}\n</code></pre>\n\n<p>And you can use this function to iterate a matrix in a <code>for</code>-loop:</p>\n\n<pre><code>for ((i, j, item) in matrix.withIndex()) {\n   if (otherMatrix[i, j] &gt; value) doSomething()\n}\n</code></pre>\n\n<p>This solution is lightly less efficient than the first one and not so robust because of a mutable <code>Cell</code>, so I would really recommend you to use the first one.</p>\n"}], "owner": {"reputation": 2840, "user_id": 966467, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/a467f6a4dcfe3ac934d544193e1d3f02?s=128&d=identicon&r=PG", "display_name": "likern", "link": "https://stackoverflow.com/users/966467/likern"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 1, "accepted_answer_id": 36437243, "answer_count": 3, "score": 4, "last_activity_date": 1459897403, "creation_date": 1459882698, "question_id": 36434836, "link": "https://stackoverflow.com/questions/36434836/return-double-index-of-collections-element-while-iterating", "title": "Return double index of collection&#39;s element while iterating", "body": "<p>In Kotlin documentation I found the following example:</p>\n\n<pre><code>for ((index, value) in array.withIndex()) {\n    println(\"the element at $index is $value\")\n}\n</code></pre>\n\n<p>Is it possible (and how) to do the similar with 2D matrix:</p>\n\n<pre><code>for ((i, j, value) in matrix2D.withIndex()) {\n    // but iterate iver double index: i - row, j - column\n    if (otherMatrix2D[i, j] &gt; value) doSomething()\n}\n</code></pre>\n\n<p>How to make support this functionality in Kotlin class?</p>\n"}, {"tags": ["mockito", "kotlin"], "comments": [{"owner": {"reputation": 24586, "user_id": 3255152, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fbd95ef81d0a85310fee8dd46e0f65b0?s=128&d=identicon&r=PG&f=1", "display_name": "mfulton26", "link": "https://stackoverflow.com/users/3255152/mfulton26"}, "edited": false, "score": 0, "creation_date": 1459873467, "post_id": 36430229, "comment_id": 60478129, "body": "It would help if you could provide an <a href=\"http://stackoverflow.com/help/mcve\">MCVE</a>. As it is right now I cannot copy your code and reproduce the issue you are seeing."}], "answers": [{"comments": [{"owner": {"reputation": 448, "user_id": 1218259, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4e9cc591cf1f05ba1349ef6eaccbbd37?s=128&d=identicon&r=PG", "display_name": "Jumwah", "link": "https://stackoverflow.com/users/1218259/jumwah"}, "edited": false, "score": 0, "creation_date": 1459948801, "post_id": 36434937, "comment_id": 60517510, "body": "Thanks for the suggestion to use constructor injection, I like this as it means I can get rid of my lateinits and use vals instead of vars.  As for the original problem I&#39;ll update my question with a MCVE, weird though as your gist is pretty much exactly it."}, {"owner": {"reputation": 448, "user_id": 1218259, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4e9cc591cf1f05ba1349ef6eaccbbd37?s=128&d=identicon&r=PG", "display_name": "Jumwah", "link": "https://stackoverflow.com/users/1218259/jumwah"}, "edited": false, "score": 0, "creation_date": 1460693838, "post_id": 36434937, "comment_id": 60871037, "body": "OK, I came back to this after a week holiday and tried to reproduce my problem without luck.  Something very weird was happening, but my original code with no changes now works.  Thanks for you efforts!"}, {"owner": {"reputation": 1605, "user_id": 415673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5b6587837176e54e1bf1404d6335530?s=128&d=identicon&r=PG", "display_name": "fangzhzh", "link": "https://stackoverflow.com/users/415673/fangzhzh"}, "edited": false, "score": 0, "creation_date": 1496957705, "post_id": 36434937, "comment_id": 75889498, "body": "I want to mention that the gist mentioned in the answer has already been changed to lateinits annotation style which, in my opinion, is more clear."}], "tags": [], "owner": {"reputation": 32343, "user_id": 155213, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57bc3e08faeb981ddc81abd1d25c3bf1?s=128&d=identicon&r=PG", "display_name": "miensol", "link": "https://stackoverflow.com/users/155213/miensol"}, "is_accepted": true, "score": 3, "last_activity_date": 1459883056, "creation_date": 1459883056, "answer_id": 36434937, "question_id": 36430229, "link": "https://stackoverflow.com/questions/36430229/kotlin-lazy-block-not-executed-when-using-mockito-and-injectmocks/36434937#36434937", "title": "Kotlin lazy block not executed when using Mockito and InjectMocks", "body": "<p>I've tried to reproduce your problem and was not able to do so. This <a href=\"https://gist.github.com/miensol/0e14b9e0bf3caf84223b750f23e84b74\" rel=\"nofollow\">gist</a> provides a working example. </p>\n\n<p>However I would recommend revisiting the way you write tests. Consider following example:</p>\n\n<pre><code>class MyComponentTest {\n\n    val request = mock&lt;HttpServletRequest&gt;()\n    val database = mock&lt;Database&gt;()\n    val sut = MyComponent(request, database)\n\n    @Test\n    fun username() {\n        Mockito.`when`(database.findUser()).thenReturn(User(\"test\"))\n\n        val username = sut.getUsername()\n\n        MatcherAssert.assertThat(username, Matchers.equalTo(\"test\"))\n    }\n}\n</code></pre>\n\n<p>Which in my opinion is easier to understand than the one in mentioned <a href=\"https://gist.github.com/miensol/0e14b9e0bf3caf84223b750f23e84b74\" rel=\"nofollow\">the gist</a>.</p>\n\n<p>In case you're interested the <code>mock</code> helper function is a one liner:</p>\n\n<pre><code>inline fun &lt;reified T : Any&gt; mock() = Mockito.mock(T::class.java)\n</code></pre>\n\n<p>A full updated example can be found in this <a href=\"https://gist.github.com/miensol/123ade8ba6a4af307cf628a88606c753\" rel=\"nofollow\">gist</a>.</p>\n"}], "owner": {"reputation": 448, "user_id": 1218259, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4e9cc591cf1f05ba1349ef6eaccbbd37?s=128&d=identicon&r=PG", "display_name": "Jumwah", "link": "https://stackoverflow.com/users/1218259/jumwah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3531, "favorite_count": 2, "closed_date": 1461150748, "accepted_answer_id": 36434937, "answer_count": 1, "score": 5, "last_activity_date": 1460693909, "creation_date": 1459868923, "last_edit_date": 1460693909, "question_id": 36430229, "link": "https://stackoverflow.com/questions/36430229/kotlin-lazy-block-not-executed-when-using-mockito-and-injectmocks", "closed_reason": "Not suitable for this site", "title": "Kotlin lazy block not executed when using Mockito and InjectMocks", "body": "<p>I'm using Mockito to test my Kotlin code.  It's a web app and I use spring to inject values into some fields.</p>\n\n<p>For example, my class snippet looks something like this:</p>\n\n<pre><code>class MyComponent {\n\n    @Inject private lateinit var request: HttpServletRequest\n    @Inject private lateinit var database: Database\n</code></pre>\n\n<p>To mimic this in my unit test I use the <code>@Mock</code> and <code>@InjectMocks</code> annotations from Mockito.  So my test looks something like this:</p>\n\n<pre><code>class MyComponentTest {\n\n    @Mock private lateinit var request: HttpServletRequest\n    @Mock private lateinit var database: Database\n\n    @InjectMocks private lateinit var sut: MyComponent\n\n    @Before\n    fun setup() {\n       MockitoAnnotations.initMocks(this)\n    }\n</code></pre>\n\n<p>Which all works fine.  However, I also have a lazy initialization block in my component like this:</p>\n\n<pre><code>val user: User by lazy {\n    database.findUser()\n}\n\nfun getUsername(): String {\n    return user.name\n}\n</code></pre>\n\n<p>When my test calls <code>myComponent.getUsername()</code> I would expect <code>database.findUser()</code> to be called as it initializes <code>user</code> but this doesn't happen.</p>\n\n<p>If I put a breakpoint in the lazy block, it's never hit.  Now I am assuming this is something to do with the way Mockito and <code>@InjectMocks</code> must 'touch' <code>user</code> but I don't really know.  If I construct <code>MyComponent</code> manually then the lazy block is executed - but this won't inject my mocks.</p>\n\n<p>How can I ensure the lazy block is called correctly from my test?</p>\n\n<p><strong>UPDATE</strong>:  After a week absence, attempting to reproduce this without any changes and I could not.  Can't explain it.</p>\n"}, {"tags": ["generics", "kotlin"], "answers": [{"tags": [], "owner": {"reputation": 11834, "user_id": 1538877, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/N9qfZ.jpg?s=128&g=1", "display_name": "Ruslan", "link": "https://stackoverflow.com/users/1538877/ruslan"}, "is_accepted": false, "score": 2, "last_activity_date": 1459867709, "creation_date": 1459867709, "answer_id": 36429745, "question_id": 36428819, "link": "https://stackoverflow.com/questions/36428819/how-to-call-constructor-of-generic-type-in-class-constructor/36429745#36429745", "title": "How to call constructor of generic type in class constructor", "body": "<p>It's not possible to call default constructor in default parameters.</p>\n\n<p><a href=\"https://kotlinlang.org/docs/reference/inline-functions.html#reified-type-parameters\" rel=\"nofollow\">Reified generics</a> available only in inline functions.</p>\n"}, {"comments": [{"owner": {"reputation": 2840, "user_id": 966467, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/a467f6a4dcfe3ac934d544193e1d3f02?s=128&d=identicon&r=PG", "display_name": "likern", "link": "https://stackoverflow.com/users/966467/likern"}, "edited": false, "score": 0, "creation_date": 1459869249, "post_id": 36429859, "comment_id": 60475041, "body": "This looks like if we use <code>Any</code> we don&#39;t need second constructor: constructor(rows: Int, columns: Int, test: T) {         when {             rows &lt; 1 -&gt; throw MatrixDimensionException(&quot;Number of rows should &gt;= 1&quot;)             columns &lt; 1 -&gt; throw MatrixDimensionException(&quot;Number of columns should be &gt;= 1&quot;)         }          array = Array(rows) { Array(columns) { test as Any } }     } Isn&#39;t it?"}, {"owner": {"reputation": 50303, "user_id": 170842, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/c2ea72b8d001d81fb6ce3f356e45eb3a?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/170842/michael"}, "reply_to_user": {"reputation": 2840, "user_id": 966467, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/a467f6a4dcfe3ac934d544193e1d3f02?s=128&d=identicon&r=PG", "display_name": "likern", "link": "https://stackoverflow.com/users/966467/likern"}, "edited": false, "score": 0, "creation_date": 1459869456, "post_id": 36429859, "comment_id": 60475179, "body": "That&#39;s just a convenience constructor, which you can remove. It&#39;s not related to <code>Any</code> actually."}], "tags": [], "owner": {"reputation": 50303, "user_id": 170842, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/c2ea72b8d001d81fb6ce3f356e45eb3a?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/170842/michael"}, "is_accepted": true, "score": 5, "last_activity_date": 1459867944, "creation_date": 1459867944, "answer_id": 36429859, "question_id": 36428819, "link": "https://stackoverflow.com/questions/36428819/how-to-call-constructor-of-generic-type-in-class-constructor/36429859#36429859", "title": "How to call constructor of generic type in class constructor", "body": "<p>There's no way to check if a class has a default constructor in compile time. I would solve this problem by passing a factory that creates instances of the given type:</p>\n\n<pre><code>class Matrix2D&lt;T : Any&gt; : Cloneable, Iterable&lt;T&gt; {\n  private val array: Array&lt;Array&lt;Any&gt;&gt;\n\n  constructor(rows: Int, columns: Int, default: T) :\n      this(rows, columns, { default })\n\n  constructor(rows: Int, columns: Int, factory: () -&gt; T) {\n    when {\n      rows &lt; 1 -&gt; throw MatrixDimensionException(\"Number of rows should &gt;= 1\")\n      columns &lt; 1 -&gt; throw MatrixDimensionException(\"Number of columns should be &gt;= 1\")\n    }\n    array = Array(rows) { Array&lt;Any&gt;(columns) { factory() } }\n  }\n}\n</code></pre>\n\n<p>Please notice that you cannot use an array of type <code>T</code> in this case because information about its actual type is erased at runtime. Just use an array of <code>Any</code> and cast instances to <code>T</code> where necessary.</p>\n"}], "owner": {"reputation": 2840, "user_id": 966467, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/a467f6a4dcfe3ac934d544193e1d3f02?s=128&d=identicon&r=PG", "display_name": "likern", "link": "https://stackoverflow.com/users/966467/likern"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5079, "favorite_count": 1, "accepted_answer_id": 36429859, "answer_count": 2, "score": 1, "last_activity_date": 1505829725, "creation_date": 1459865409, "last_edit_date": 1505829725, "question_id": 36428819, "link": "https://stackoverflow.com/questions/36428819/how-to-call-constructor-of-generic-type-in-class-constructor", "title": "How to call constructor of generic type in class constructor", "body": "<p>I want to create class <strong>Matrix2D</strong> with the following properties:</p>\n\n<ol>\n<li>Class should be generic</li>\n<li>Should be able to accept as many types as possible (ideally all)</li>\n<li>\"Default\" constructor should initialize all cells with default type values</li>\n<li>Correctly handle case, when type doesn't have default constructor (probably default parameter solves this)</li>\n</ol>\n\n<p>How I can do this?\nThis is my sketch:</p>\n\n<pre><code>class Matrix2D&lt;T&gt; : Cloneable, Iterable&lt;T&gt; {\n    private val array: Array&lt;Array&lt;T&gt;&gt;\n    // Call default T() constructor if it exists\n    // Have ability to pass another default value of type\n    constructor(rows: Int, columns: Int, default: T = T()) {\n        when {\n            rows &lt; 1 -&gt; throw MatrixDimensionException(\"Number of rows should &gt;= 1\")\n            columns &lt; 1 -&gt; throw MatrixDimensionException(\"Number of columns should be &gt;= 1\")\n        }\n        array = Array(rows, { Array(columns, { default }) })\n    }\n}\n</code></pre>\n"}, {"tags": ["kotlin"], "answers": [{"tags": [], "owner": {"reputation": 3667, "user_id": 190148, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/5338ca3693b8a1aaf94b6f791c5842a7?s=128&d=identicon&r=PG", "display_name": "netimen", "link": "https://stackoverflow.com/users/190148/netimen"}, "is_accepted": true, "score": 3, "last_activity_date": 1459860811, "creation_date": 1459860811, "answer_id": 36426933, "question_id": 36426917, "link": "https://stackoverflow.com/questions/36426917/how-to-reference-constructor-of-a-sealed-in-kotlin/36426933#36426933", "title": "How to reference constructor of a sealed in Kotlin?", "body": "<p>I found a way to do that: <code>f(S::A)</code></p>\n"}], "owner": {"reputation": 3667, "user_id": 190148, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/5338ca3693b8a1aaf94b6f791c5842a7?s=128&d=identicon&r=PG", "display_name": "netimen", "link": "https://stackoverflow.com/users/190148/netimen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 332, "favorite_count": 0, "accepted_answer_id": 36426933, "answer_count": 1, "score": 2, "last_activity_date": 1459860811, "creation_date": 1459860768, "question_id": 36426917, "link": "https://stackoverflow.com/questions/36426917/how-to-reference-constructor-of-a-sealed-in-kotlin", "title": "How to reference constructor of a sealed in Kotlin?", "body": "<p>I have the following code</p>\n\n<pre><code>class A(val i: Int)\nsealed class S {\n    class A(val i: Int)\n}\n\nfun &lt;T&gt; f(g: (Int) -&gt; T) = Unit\n\nfun test() {\n    f(::A)   // OK\n    f(::S.A) // error: Unresolved reference A\n}\n</code></pre>\n\n<p>so how do I reference constructor of a sealed class?</p>\n"}, {"tags": ["java", "algorithm", "stack", "kotlin"], "answers": [{"comments": [{"owner": {"reputation": 5097, "user_id": 673526, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/Gb0VM.png?s=128&g=1", "display_name": "Sebastian", "link": "https://stackoverflow.com/users/673526/sebastian"}, "edited": false, "score": 1, "creation_date": 1459820000, "post_id": 36415614, "comment_id": 60446702, "body": "So the solution is,  in the main method,  set  initialvalue with mutableListOf instead of listOf, right ?"}, {"owner": {"reputation": 35078, "user_id": 615306, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/5a11940d70233031c01ead6c0b62c990?s=128&d=identicon&r=PG", "display_name": "Kirill Rakhman", "link": "https://stackoverflow.com/users/615306/kirill-rakhman"}, "edited": false, "score": 2, "creation_date": 1459868563, "post_id": 36415614, "comment_id": 60474534, "body": "The explanation why the cast is legal goes as follows: <code>List</code> is an interface and <code>MutableList</code> is an interface that extends <code>List</code>. Therefore casting from <code>List</code> to <code>MutableList</code>  is legal but it can and will crash at runtime."}, {"owner": {"reputation": 5097, "user_id": 673526, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/Gb0VM.png?s=128&g=1", "display_name": "Sebastian", "link": "https://stackoverflow.com/users/673526/sebastian"}, "edited": false, "score": 0, "creation_date": 1459869167, "post_id": 36415614, "comment_id": 60474983, "body": "Thanks for the explanation Kirill !"}, {"owner": {"reputation": 4956, "user_id": 4356889, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Le2lz.png?s=128&g=1", "display_name": "szym", "link": "https://stackoverflow.com/users/4356889/szym"}, "reply_to_user": {"reputation": 35078, "user_id": 615306, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/5a11940d70233031c01ead6c0b62c990?s=128&d=identicon&r=PG", "display_name": "Kirill Rakhman", "link": "https://stackoverflow.com/users/615306/kirill-rakhman"}, "edited": false, "score": 1, "creation_date": 1459886199, "post_id": 36415614, "comment_id": 60486369, "body": "@KirillRakhman That&#39;s true that the cast is allowed at compile time, but it is because <code>listOf</code> returns a <code>java.util.List</code> which implements <code>kotlin.collections.MutableList</code> interface. So it does not crash at the cast but rather at the call to <code>add</code>, when the implementation throws an exception."}, {"owner": {"reputation": 35078, "user_id": 615306, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/5a11940d70233031c01ead6c0b62c990?s=128&d=identicon&r=PG", "display_name": "Kirill Rakhman", "link": "https://stackoverflow.com/users/615306/kirill-rakhman"}, "edited": false, "score": 2, "creation_date": 1459935289, "post_id": 36415614, "comment_id": 60507121, "body": "Kotlin&#39;s <code>List</code> and <code>MutableList</code> are both mapped to <code>java.util.List</code> at compile time and don&#39;t exist at runtime at all."}], "tags": [], "owner": {"reputation": 4956, "user_id": 4356889, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Le2lz.png?s=128&g=1", "display_name": "szym", "link": "https://stackoverflow.com/users/4356889/szym"}, "is_accepted": true, "score": 14, "last_activity_date": 1459886340, "last_edit_date": 1459886340, "creation_date": 1459819726, "answer_id": 36415614, "question_id": 36415542, "link": "https://stackoverflow.com/questions/36415542/kotlin-java-lang-unsupportedoperationexception-in-mutablelist-add-element/36415614#36415614", "title": "Kotlin: java.lang.UnsupportedOperationException in MutableList add element", "body": "<p><code>listOf&lt;Int&gt;</code> is not truly mutable. According to <a href=\"https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/list-of.html\" rel=\"noreferrer\">the doc</a>:</p>\n\n<blockquote>\n  <p><code>fun &lt;T&gt; listOf(vararg elements: T): List&lt;T&gt; (source)</code>\n  Returns a new read-only list of given elements. The returned list is\n  serializable (JVM). </p>\n</blockquote>\n\n<p>You should use <a href=\"https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/mutable-list-of.html\" rel=\"noreferrer\"><code>mutableListOf&lt;&gt;</code></a> instead.</p>\n\n<p>The reason why <code>as MutableList</code> is permitted here is because <code>listOf(10)</code> returns <code>Collections.singletonList(10)</code> which returns a <code>java.util.List</code> (which Kotlin assumes implements the <code>kotlin.collections.MutableList</code> interface). So the compiler does not know it's not really mutable until the mutating method is called at runtime and throws the exception.</p>\n"}, {"tags": [], "owner": {"reputation": 160, "user_id": 6417470, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9f2376d6791ab8d8888ac6614b6b398?s=128&d=identicon&r=PG&f=1", "display_name": "Humble Bee", "link": "https://stackoverflow.com/users/6417470/humble-bee"}, "is_accepted": false, "score": 5, "last_activity_date": 1588756564, "creation_date": 1588756564, "answer_id": 61631554, "question_id": 36415542, "link": "https://stackoverflow.com/questions/36415542/kotlin-java-lang-unsupportedoperationexception-in-mutablelist-add-element/61631554#61631554", "title": "Kotlin: java.lang.UnsupportedOperationException in MutableList add element", "body": "<p>You can fix this by calling toMutableList() api rather than using smart cast (as).</p>\n\n<p>Try: var initialValue = listOf&lt; Int >(10).toMutableList()</p>\n\n<p>Below is a working example: </p>\n\n<pre><code>fun main(){\n    val x : List&lt;String&gt; = listOf(\"foo\", \"bar\", \"baz\")\n    //val y: MutableList&lt;String&gt; = x as MutableList&lt;String&gt; throws UnsupportedOperationException\n    val y: MutableList&lt;String&gt; = x.toMutableList()\n    y.add(\"sha\")\n    println(y) // [foo, bar, baz, sha]\n}\n</code></pre>\n"}], "owner": {"reputation": 5097, "user_id": 673526, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/Gb0VM.png?s=128&g=1", "display_name": "Sebastian", "link": "https://stackoverflow.com/users/673526/sebastian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4809, "favorite_count": 0, "accepted_answer_id": 36415614, "answer_count": 2, "score": 5, "last_activity_date": 1588756564, "creation_date": 1459819142, "last_edit_date": 1459819469, "question_id": 36415542, "link": "https://stackoverflow.com/questions/36415542/kotlin-java-lang-unsupportedoperationexception-in-mutablelist-add-element", "title": "Kotlin: java.lang.UnsupportedOperationException in MutableList add element", "body": "<p>I'm implementing a stack algorithm for study purpose in Kotlin </p>\n\n<pre><code>class Stack&lt;T:Comparable&lt;T&gt;&gt;(list:MutableList&lt;T&gt;) {\n\n    var items: MutableList&lt;T&gt; = list\n\n\n    fun isEmpty():Boolean = this.items.isEmpty()\n\n    fun count():Int = this.items.count()\n\n    fun push(element:T) {\n        val position = this.count()\n        this.items.add(position, element)\n    }\n\n    override  fun toString() = this.items.toString()\n\n    fun pop():T? {\n        if (this.isEmpty()) {\n            return null\n        } else {\n            val item =  this.items.count() - 1\n            return this.items.removeAt(item)\n        }\n    }\n\n    fun peek():T? {\n        if (isEmpty()) {\n            return null\n        } else {\n            return this.items[this.items.count() - 1]\n        }\n    }\n\n}\n</code></pre>\n\n<p>And I'm trying to execute using this code:</p>\n\n<pre><code>fun main(args: Array&lt;String&gt;) {\n\n        var initialValue = listOf&lt;Int&gt;(10) as MutableList&lt;Int&gt;\n        var stack = Stack&lt;Int&gt;(initialValue)\n          stack.push(22)\n        println(stack.count())\n        println(stack.isEmpty())\n        println(stack.pop())\n        println(stack.count())\n        println(stack.isEmpty())\n\n    }\n</code></pre>\n\n<p>When I run the code I receive this error:</p>\n\n<pre><code>Exception in thread \"main\" java.lang.UnsupportedOperationException\nat java.util.AbstractList.add(AbstractList.java:148)\nat Stack.push(Stack.kt:17)\nat StackKt.main(Stack.kt:45)\nat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\nat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\nat java.lang.reflect.Method.invoke(Method.java:498)\nat com.intellij.rt.execution.application.AppMain.main(AppMain.java:144)\n</code></pre>\n\n<p>This is related with the follow line that is implemented in   <strong><em>push(element:T)</em></strong> method:</p>\n\n<pre><code> this.items.add(position, element)\n</code></pre>\n\n<p>The most weird thing is that I used a very similar code implementing a <a href=\"https://github.com/gazolla/Kotlin-Algorithm/tree/master/OrderedArray\" rel=\"noreferrer\">orderedArray</a> and it works perfectly.</p>\n\n<p>Do you have any idea of what I'm doing wrong ?</p>\n"}, {"tags": ["kotlin"], "answers": [{"tags": [], "owner": {"reputation": 20461, "user_id": 1452094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a12b28824b215e4886da2e9f376369f?s=128&d=identicon&r=PG", "display_name": "Kiskae", "link": "https://stackoverflow.com/users/1452094/kiskae"}, "is_accepted": true, "score": 4, "last_activity_date": 1459797233, "creation_date": 1459797233, "answer_id": 36410988, "question_id": 36410955, "link": "https://stackoverflow.com/questions/36410955/how-to-convert-classtcast-method-from-java-to-kotlin/36410988#36410988", "title": "How to convert Class&lt;T&gt;#cast method from Java to Kotlin?", "body": "<p>You can access the <code>Class&lt;T&gt;</code> instance with the <code>java</code> property</p>\n\n<p>This should work: <code>toClass.java.cast(from)</code></p>\n"}, {"tags": [], "owner": {"reputation": 394, "user_id": 3460763, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/5YjaT.png?s=128&g=1", "display_name": "chetank", "link": "https://stackoverflow.com/users/3460763/chetank"}, "is_accepted": false, "score": 0, "last_activity_date": 1459800337, "creation_date": 1459800337, "answer_id": 36411906, "question_id": 36410955, "link": "https://stackoverflow.com/questions/36410955/how-to-convert-classtcast-method-from-java-to-kotlin/36411906#36411906", "title": "How to convert Class&lt;T&gt;#cast method from Java to Kotlin?", "body": "<p>for any java to Kotlin converter, use the online converter provided on the site.</p>\n\n<p><a href=\"http://try.kotlinlang.org/#/Examples/Longer%20examples/Maze/Maze.kt\" rel=\"nofollow\">http://try.kotlinlang.org/#/Examples/Longer%20examples/Maze/Maze.kt</a></p>\n"}], "owner": {"reputation": 8946, "user_id": 2398521, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/84bb49c56756a8c7cd54d4876d7a4467?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2398521/maxim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 981, "favorite_count": 1, "accepted_answer_id": 36410988, "answer_count": 2, "score": 2, "last_activity_date": 1459800337, "creation_date": 1459797126, "question_id": 36410955, "link": "https://stackoverflow.com/questions/36410955/how-to-convert-classtcast-method-from-java-to-kotlin", "title": "How to convert Class&lt;T&gt;#cast method from Java to Kotlin?", "body": "<p>I want to convert the following code from Java:</p>\n\n<pre><code>Object from = ...\nClass&lt;T&gt; toClass = ...\n\nT result = toClass.cast(from);\n</code></pre>\n\n<p>to Kotlin:</p>\n\n<pre><code>Any? from = ...\nKClass&lt;T&gt; toClass = ...\n\nT result = // toClass.cast(from) - how to convert this line to Kotlin?\n</code></pre>\n\n<p>How to do it?</p>\n"}, {"tags": ["kotlin", "bimap"], "comments": [{"owner": {"reputation": 24586, "user_id": 3255152, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fbd95ef81d0a85310fee8dd46e0f65b0?s=128&d=identicon&r=PG&f=1", "display_name": "mfulton26", "link": "https://stackoverflow.com/users/3255152/mfulton26"}, "edited": false, "score": 0, "creation_date": 1459687461, "post_id": 36373760, "comment_id": 60387951, "body": "Why do you say that using Guava &quot;feels like shooting with a very big gun&quot;? Lots of libraries use Guava. I don&#39;t see any reason to reimplement what is already readily available. If you are worried about JAR size then you can use ProGuard or copy the necessary classes."}, {"owner": {"reputation": 35330, "user_id": 322642, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0030846647f93ba6bf0938a199688c2e?s=128&d=identicon&r=PG", "display_name": "ligi", "link": "https://stackoverflow.com/users/322642/ligi"}, "reply_to_user": {"reputation": 24586, "user_id": 3255152, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fbd95ef81d0a85310fee8dd46e0f65b0?s=128&d=identicon&r=PG&f=1", "display_name": "mfulton26", "link": "https://stackoverflow.com/users/3255152/mfulton26"}, "edited": false, "score": 0, "creation_date": 1459687866, "post_id": 36373760, "comment_id": 60388102, "body": "Yea but even if I remove with proguard I have the penalty of a big library at build-time"}, {"owner": {"reputation": 24586, "user_id": 3255152, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fbd95ef81d0a85310fee8dd46e0f65b0?s=128&d=identicon&r=PG&f=1", "display_name": "mfulton26", "link": "https://stackoverflow.com/users/3255152/mfulton26"}, "edited": false, "score": 0, "creation_date": 1459717325, "post_id": 36373760, "comment_id": 60399077, "body": "If you find your build with and without Guava I suspect you&#39;ll find the difference marginal."}, {"owner": {"reputation": 35330, "user_id": 322642, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0030846647f93ba6bf0938a199688c2e?s=128&d=identicon&r=PG", "display_name": "ligi", "link": "https://stackoverflow.com/users/322642/ligi"}, "reply_to_user": {"reputation": 24586, "user_id": 3255152, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fbd95ef81d0a85310fee8dd46e0f65b0?s=128&d=identicon&r=PG&f=1", "display_name": "mfulton26", "link": "https://stackoverflow.com/users/3255152/mfulton26"}, "edited": false, "score": 5, "creation_date": 1459719592, "post_id": 36373760, "comment_id": 60399976, "body": "not in an android context"}], "answers": [{"comments": [{"owner": {"reputation": 50303, "user_id": 170842, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/c2ea72b8d001d81fb6ce3f356e45eb3a?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/170842/michael"}, "edited": false, "score": 0, "creation_date": 1459610244, "post_id": 36374559, "comment_id": 60367730, "body": "Unfortunately creating a <code>BiMap</code> is not that simple. Consider <code>entries</code>, <code>keys</code> and <code>values</code>."}, {"owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "reply_to_user": {"reputation": 50303, "user_id": 170842, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/c2ea72b8d001d81fb6ce3f356e45eb3a?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/170842/michael"}, "edited": false, "score": 0, "creation_date": 1459622410, "post_id": 36374559, "comment_id": 60372145, "body": "@Michael that&#39;s what the <code>...</code> are for"}], "tags": [], "owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "is_accepted": false, "score": 1, "last_activity_date": 1459607631, "last_edit_date": 1495542677, "creation_date": 1459607631, "answer_id": 36374559, "question_id": 36373760, "link": "https://stackoverflow.com/questions/36373760/bimap-2-way-hashmap-in-kotlin/36374559#36374559", "title": "BiMap / 2-way hashmap in Kotlin", "body": "<p>Well, you are right - as it stated in a similar question for Java \"<a href=\"https://stackoverflow.com/questions/10699492/bi-directional-map-in-java\">Bi-directional Map in Java?</a>\", Kotlin does not have BiMap out of the box.</p>\n\n<p>The workarounds include using <code>Guava</code> and creating a custom class using two usual maps:</p>\n\n<pre><code>class BiMap&lt;K, V&gt;() {\n    private keyValues = mutableMapOf&lt;K, V&gt;()\n    private valueKeys = mutableMapOf&lt;V, K&gt;()\n\n    operator fun get(key: K) = ...\n    operator fun get(value: V) = ...\n\n    ...\n}\n</code></pre>\n\n<p>This solution should not be slower or take more memory than a more sophisticated one. Although I am not sure what happens when <code>K</code> is the same as <code>V</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 35330, "user_id": 322642, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0030846647f93ba6bf0938a199688c2e?s=128&d=identicon&r=PG", "display_name": "ligi", "link": "https://stackoverflow.com/users/322642/ligi"}, "edited": false, "score": 0, "creation_date": 1459627759, "post_id": 36377454, "comment_id": 60373724, "body": "Thanks so much for the detailed answer and the lib"}, {"owner": {"reputation": 50303, "user_id": 170842, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/c2ea72b8d001d81fb6ce3f356e45eb3a?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/170842/michael"}, "reply_to_user": {"reputation": 35330, "user_id": 322642, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0030846647f93ba6bf0938a199688c2e?s=128&d=identicon&r=PG", "display_name": "ligi", "link": "https://stackoverflow.com/users/322642/ligi"}, "edited": false, "score": 0, "creation_date": 1459627901, "post_id": 36377454, "comment_id": 60373763, "body": "You&#39;re welcome! It&#39;s in the process of linkage with jcenter, which may take a day or so. Tomorrow it should become available on jcenter."}], "tags": [], "owner": {"reputation": 50303, "user_id": 170842, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/c2ea72b8d001d81fb6ce3f356e45eb3a?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/170842/michael"}, "is_accepted": true, "score": 13, "last_activity_date": 1459623162, "creation_date": 1459623162, "answer_id": 36377454, "question_id": 36373760, "link": "https://stackoverflow.com/questions/36373760/bimap-2-way-hashmap-in-kotlin/36377454#36377454", "title": "BiMap / 2-way hashmap in Kotlin", "body": "<p>I need a simple <code>BiMap</code> implementation too so decided to create a little library called <a href=\"https://github.com/MichaelRocks/bimap\"><code>bimap</code></a>.</p>\n\n<p>The implementation of <code>BiMap</code> is quite straightforward but it contains a tricky part, which is a set of entries, keys and values. I'll try to explain some details of the implementation but you can find the full implementation on <a href=\"https://github.com/MichaelRocks/bimap/blob/master/src/main/kotlin/io/michaelrocks/bimap/BiMap.kt\">GitHub</a>.</p>\n\n<p>First, we need to define interfaces for an immutable and a mutable <code>BiMap</code>s.</p>\n\n<pre><code>interface BiMap&lt;K : Any, V : Any&gt; : Map&lt;K, V&gt; {\n  override val values: Set&lt;V&gt;\n  val inverse: BiMap&lt;V, K&gt;\n}\n\ninterface MutableBiMap&lt;K : Any, V : Any&gt; : BiMap&lt;K, V&gt;, MutableMap&lt;K, V&gt; {\n  override val values: MutableSet&lt;V&gt;\n  override val inverse: MutableBiMap&lt;V, K&gt;\n\n  fun forcePut(key: K, value: V): V?\n}\n</code></pre>\n\n<p>Please, notice that <code>BiMap.values</code> returns a <code>Set</code> instead of a <code>Collection</code>. Also <code>BiMap.put(K, V)</code> throws an exception when the <code>BiMap</code> already contains a given value. If you want to replace pairs <code>(K1, V1)</code> and <code>(K2, V2)</code> with <code>(K1, V2)</code> you need to call <code>forcePut(K, V)</code>. And finally you may get an inverse <code>BiMap</code> to access its keys by values.</p>\n\n<p>The <code>BiMap</code> is implemented using two regular maps:</p>\n\n<pre><code>val direct: MutableMap&lt;K, V&gt;\nval reverse: MutableMap&lt;V, K&gt;\n</code></pre>\n\n<p>The inverse <code>BiMap</code> can be created by just swapping the <code>direct</code> and the <code>reverse</code> maps. My implementation provides an invariant <code>bimap.inverse.inverse === bimap</code> but that's not necessary.</p>\n\n<p>As mentioned earlier the <code>forcePut(K, V)</code> method can replace pairs <code>(K1, V1)</code> and <code>(K2, V2)</code> with <code>(K1, V2)</code>. First it checks what the current value for <code>K1</code> is and removes it from the <code>reverse</code> map. Then it finds a key for value <code>V2</code> and removes it from the <code>direct</code> map. And then the method inserts the given pair to both maps. Here's how it looks in code.</p>\n\n<pre><code>override fun forcePut(key: K, value: V): V? {\n  val oldValue = direct.put(key, value)\n  oldValue?.let { reverse.remove(it) }\n  val oldKey = reverse.put(value, key)\n  oldKey?.let { direct.remove(it) }\n  return oldValue\n}\n</code></pre>\n\n<p>Implementations of <code>Map</code> and <code>MutableMap</code> methods are quite simple so I will not provide details for them here. They just perform an operation on both maps.</p>\n\n<p>The most complicated part is <code>entries</code>, <code>keys</code> and <code>values</code>. In my implementation I create a <code>Set</code> that delegates all method invocations to <code>direct.entries</code> and handle modification of entries. Every modification happens in a <code>try</code>/<code>catch</code> block so that the <code>BiMap</code> remains in consistent state when an exception is thrown. Moreover, iterators and mutable entries are wrapped in similar classes. Unfortunately, it makes iteration over entries much less efficient because an additional <code>MutableMap.MutableEntry</code> wrapper is created on every iteration step.</p>\n"}, {"comments": [{"owner": {"reputation": 574, "user_id": 201664, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff7868eb447490b94068f75a68b85692?s=128&d=identicon&r=PG", "display_name": "Anthony Chatellier", "link": "https://stackoverflow.com/users/201664/anthony-chatellier"}, "edited": false, "score": 1, "creation_date": 1560004509, "post_id": 44844822, "comment_id": 99602067, "body": "You end up with a get method which has a O(1) complexity and a getKey method with O(n) complexity, I don&#39;t think it&#39;s a good idea. A more consistent solution would be to create a Bimap which use two maps like the other answer suggest."}], "tags": [], "owner": {"reputation": 3384, "user_id": 1269737, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7f4819805723a0723f6aa14480be00f?s=128&d=identicon&r=PG", "display_name": "user1269737", "link": "https://stackoverflow.com/users/1269737/user1269737"}, "is_accepted": false, "score": 8, "last_activity_date": 1534994485, "last_edit_date": 1534994485, "creation_date": 1498820221, "answer_id": 44844822, "question_id": 36373760, "link": "https://stackoverflow.com/questions/36373760/bimap-2-way-hashmap-in-kotlin/44844822#44844822", "title": "BiMap / 2-way hashmap in Kotlin", "body": "<p>If speed is not a priority you can create an extension function: <code>map.getKey(value)</code></p>\n\n<pre><code>/**\n * Returns the first key corresponding to the given [value], or `null`\n * if such a value is not present in the map.\n */\nfun &lt;K, V&gt; Map&lt;K, V&gt;.getKey(value: V) =\n    entries.firstOrNull { it.value == value }?.key\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 17145, "user_id": 5093961, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3736a281ed5cdc18e41f6d3100d76dcc?s=128&d=identicon&r=PG", "display_name": "Steven Spungin", "link": "https://stackoverflow.com/users/5093961/steven-spungin"}, "is_accepted": false, "score": 0, "last_activity_date": 1505651575, "creation_date": 1505651575, "answer_id": 46264116, "question_id": 36373760, "link": "https://stackoverflow.com/questions/36373760/bimap-2-way-hashmap-in-kotlin/46264116#46264116", "title": "BiMap / 2-way hashmap in Kotlin", "body": "<p>The cleanest solution to to use Guava <strong>and</strong> create an extension function that turns a Map into a BiMap. This follows the semantics of Kotlin's other Map conversions as well.  Although Guava might have a bit of overhead, you gain the flexibility to add more extension functions wrappers in the future.  You can always remove Guava in the future and replace the extension function with another implementation.</p>\n\n<p>First declare your extension function.</p>\n\n<p><code>fun &lt;K, V&gt; Map&lt;K, V&gt;.toBiMap() = HashBiMap.create(this)</code></p>\n\n<p>Then use it like this:</p>\n\n<p><code>mutableMapOf(\"foo\" to \"bar\", \"me\" to \"you\").toBiMap()</code></p>\n"}, {"comments": [{"owner": {"reputation": 1281, "user_id": 3617426, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/K47GU.jpg?s=128&g=1", "display_name": "Lasse Meyer", "link": "https://stackoverflow.com/users/3617426/lasse-meyer"}, "edited": false, "score": 1, "creation_date": 1591903264, "post_id": 60681709, "comment_id": 110239987, "body": "This isn&#39;t a bi-map like OP asked for, i.e. the inverse map will not be in sync with the original map. But if you just need a quick, throwaway inverse map this is a very elegant solution!"}], "tags": [], "owner": {"reputation": 653, "user_id": 2049647, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5XrVZ.png?s=128&g=1", "display_name": "ATutorMe", "link": "https://stackoverflow.com/users/2049647/atutorme"}, "is_accepted": false, "score": 3, "last_activity_date": 1584181138, "creation_date": 1584181138, "answer_id": 60681709, "question_id": 36373760, "link": "https://stackoverflow.com/questions/36373760/bimap-2-way-hashmap-in-kotlin/60681709#60681709", "title": "BiMap / 2-way hashmap in Kotlin", "body": "<p>FWIW, you can get the inverse of the map in Kotlin using an extension function:</p>\n\n<p><code>fun &lt;K, V&gt; Map&lt;K, V&gt;.inverseMap() = map { Pair(it.value, it.key) }.toMap()</code></p>\n\n<p>The <code>map</code> operator can be used to iterate over the <code>List</code> of key-value pairs in the <code>Map</code>, then convert back to a map using <code>.toMap()</code>.</p>\n"}], "owner": {"reputation": 35330, "user_id": 322642, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0030846647f93ba6bf0938a199688c2e?s=128&d=identicon&r=PG", "display_name": "ligi", "link": "https://stackoverflow.com/users/322642/ligi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5474, "favorite_count": 0, "accepted_answer_id": 36377454, "answer_count": 5, "score": 10, "last_activity_date": 1584181138, "creation_date": 1459603041, "last_edit_date": 1551988610, "question_id": 36373760, "link": "https://stackoverflow.com/questions/36373760/bimap-2-way-hashmap-in-kotlin", "title": "BiMap / 2-way hashmap in Kotlin", "body": "<p>is there a bidirectional hashmap for kotlin? \nIf not - what is the best way to express this in kotlin?\nIncluding guava to get the BiMap from there feels like shooting with a very big gun on a very little target - no solution that I can imagine currently feels right - the best thing I have in mind is to write a custom class for it</p>\n"}, {"tags": ["android", "json", "jackson", "kotlin"], "answers": [{"tags": [], "owner": {"reputation": 3910, "user_id": 4103854, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EUnmsdTd6P4/AAAAAAAAAAI/AAAAAAAAAGI/TBEWqWgj0wo/photo.jpg?sz=128", "display_name": "Logain", "link": "https://stackoverflow.com/users/4103854/logain"}, "is_accepted": false, "score": 3, "last_activity_date": 1459659174, "last_edit_date": 1459659174, "creation_date": 1459589373, "answer_id": 36371522, "question_id": 36371274, "link": "https://stackoverflow.com/questions/36371274/jackson-mixins-with-kotlin/36371522#36371522", "title": "Jackson Mixins with Kotlin", "body": "<p>Try putting the annotation on the constructor of your MixIn, like:</p>\n\n<pre><code>abstract class BarMixin (\n    @JsonIgnore val totalValue: Double = 0.0\n)\n</code></pre>\n\n<p>(notice the <code>()</code> instead of <code>{}</code>)</p>\n"}], "owner": {"reputation": 501, "user_id": 4882488, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/468cc55f6c985df33d4990fdf90c7d06?s=128&d=identicon&r=PG&f=1", "display_name": "Tin Man", "link": "https://stackoverflow.com/users/4882488/tin-man"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1299, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1459659174, "creation_date": 1459587623, "question_id": 36371274, "link": "https://stackoverflow.com/questions/36371274/jackson-mixins-with-kotlin", "title": "Jackson Mixins with Kotlin", "body": "<p>I'm trying to use Jackson mixins to ignore a property of an external Kotlin data class, but so far, it's not working for me.</p>\n\n<p>This is my SimpleModule extension:</p>\n\n<pre><code>class BarModule : SimpleModule() {\n    override fun setupModule(context: SetupContext?) {\n        context?.setMixInAnnotations(Bar::class.java, BarMixin::class.java)\n    }\n}\n</code></pre>\n\n<p>And this is my mixin:</p>\n\n<pre><code>abstract class BarMixin {\n    @JsonIgnore val totalValue: Double = 0.0\n}\n</code></pre>\n\n<p>I originally tried @JsonIgnore val totalValue: Double, but it wouldn't accept that.</p>\n\n<p>This is my class:</p>\n\n<pre><code>data class Bar(\n        val a: String,\n        val b: Boolean = false,\n        val c: Boolean = false,\n        val d: Array&lt;Block&gt;\n) {\n    val totalValue: Double by lazy {\n        d.sumByDouble { it.value }\n    }\n}\n</code></pre>\n\n<p>This is how I create my mapper:</p>\n\n<pre><code>private val mapper = jacksonObjectMapper().registerModule(KotlinModule()).registerModule(BarModule())\n</code></pre>\n\n<p>When running, it crashes with the error: Unable to start activity: com.fasterxml.jackson.databind.exc.UnrecognizedPropertyException: Unrecognized field \"totalValue\", not marked as ignorable</p>\n"}, {"tags": ["android", "kotlin"], "comments": [{"owner": {"reputation": 1254, "user_id": 3362350, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e4500858d24434055bd01b57bdc734f?s=128&d=identicon&r=PG", "display_name": "Jacob Zimmerman", "link": "https://stackoverflow.com/users/3362350/jacob-zimmerman"}, "edited": false, "score": 0, "creation_date": 1459554740, "post_id": 36366736, "comment_id": 60354464, "body": "Short answer: yes."}], "answers": [{"tags": [], "owner": {"reputation": 79983, "user_id": 147024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b35432f97606c0a31da17084d2414966?s=128&d=identicon&r=PG", "display_name": "yole", "link": "https://stackoverflow.com/users/147024/yole"}, "is_accepted": false, "score": 6, "last_activity_date": 1459550150, "creation_date": 1459550150, "answer_id": 36366859, "question_id": 36366736, "link": "https://stackoverflow.com/questions/36366736/does-kotlin-custom-get-execute-method-call/36366859#36366859", "title": "Does Kotlin custom get execute method call", "body": "<p>If you implement a property with a custom getter, it will not store any data. The body of the getter will be executed every time you access the property.</p>\n"}, {"tags": [], "owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "is_accepted": true, "score": 3, "last_activity_date": 1459773929, "last_edit_date": 1459773929, "creation_date": 1459550361, "answer_id": 36366900, "question_id": 36366736, "link": "https://stackoverflow.com/questions/36366736/does-kotlin-custom-get-execute-method-call/36366900#36366900", "title": "Does Kotlin custom get execute method call", "body": "<p>The second property declaration suits your needs: it has a <a href=\"https://kotlinlang.org/docs/reference/properties.html#getters-and-setters\" rel=\"nofollow\">custom getter</a>, thus getting the property value will always execute the getter, and the value is not stored (the property has no <a href=\"https://kotlinlang.org/docs/reference/properties.html#backing-fields\" rel=\"nofollow\">backing field</a>).</p>\n\n<p>You are probably confused by equals sign in <code>get() = ...</code>, but it is just a <a href=\"https://kotlinlang.org/docs/reference/functions.html#single-expression-functions\" rel=\"nofollow\">single-expression shorthand</a> for the equivalent form of getter: </p>\n\n<pre><code>val editPreferences: SharedPreferences.Editor \n    get() { \n         return Application\n              .getSharedPreferences(\"preferences\", Context.MODE_PRIVATE)\n              .edit()\n    }\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "edited": false, "score": 2, "creation_date": 1459553853, "post_id": 36367378, "comment_id": 60354193, "body": "Also, using a function with receiver as a parameter for <code>editPreferences</code> would be even more DSL-like here (type <code>SharedPreferences.Editor.() -&gt; Unit</code>)."}, {"owner": {"reputation": 35078, "user_id": 615306, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/5a11940d70233031c01ead6c0b62c990?s=128&d=identicon&r=PG", "display_name": "Kirill Rakhman", "link": "https://stackoverflow.com/users/615306/kirill-rakhman"}, "edited": false, "score": 0, "creation_date": 1459779565, "post_id": 36367378, "comment_id": 60426563, "body": "Please make the function the <code>inline</code> to reduce overhead."}], "tags": [], "owner": {"reputation": 11620, "user_id": 2898715, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LWv1Z.jpg?s=128&g=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/2898715/eric"}, "is_accepted": false, "score": 3, "last_activity_date": 1467664197, "last_edit_date": 1495535321, "creation_date": 1459553266, "answer_id": 36367378, "question_id": 36366736, "link": "https://stackoverflow.com/questions/36366736/does-kotlin-custom-get-execute-method-call/36367378#36367378", "title": "Does Kotlin custom get execute method call", "body": "<p>As <a href=\"https://stackoverflow.com/a/36366900/2898715\">hotkey</a> and <a href=\"https://stackoverflow.com/a/36366859/2898715\">yole</a> mentioned, a custom getter would cause a new editor to be returned each time, which is what you want.</p>\n\n<p>However, please consider this extra-fancy solution that uses:</p>\n\n<ul>\n<li><a href=\"https://kotlinlang.org/docs/reference/inline-functions.html\" rel=\"nofollow noreferrer\">inlining</a> to reduce the overhead of calling the function</li>\n<li><a href=\"https://kotlinlang.org/docs/reference/extensions.html\" rel=\"nofollow noreferrer\">extentions</a> to make it seem like a method of the <code>Context</code> class even though we didn't define it</li>\n<li><a href=\"https://kotlinlang.org/docs/reference/lambdas.html\" rel=\"nofollow noreferrer\">higher-order functions</a> to enable us to rid the to call <code>commit()</code> afterwards when using it</li>\n</ul>\n\n<h1>Declaration</h1>\n\n<pre><code>inline fun Context.editPreferences(preferenceFileName:String = \"preferences\",block:SharedPreferences.Editor.() -&gt; Unit)\n{\n    val editablePreferences = getSharedPreferences(preferenceFileName,Context.MODE_PRIVATE).edit()\n    editablePreferences.block()\n    editablePreferences.commit()\n}\n</code></pre>\n\n<h1>Usage</h1>\n\n<pre><code>Application.editPreferences()\n{\n    putBoolean(\"SOME_BOOLEAN\",true)\n    putFloat(\"SOME_FLOAT\",293232F)\n}\n</code></pre>\n\n<p>or in many cases, when the receiver is already a <code>Context</code> you can do this:</p>\n\n<pre><code>editPreferences()\n{\n    putBoolean(\"SOME_BOOLEAN\",true)\n    putFloat(\"SOME_FLOAT\",293232F)\n}\n</code></pre>\n\n<p>Kotlin \u2764</p>\n"}, {"comments": [{"owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "edited": false, "score": 0, "creation_date": 1459579779, "post_id": 36368529, "comment_id": 60359006, "body": "creating a framework for every problem is not the most practical way go"}, {"owner": {"reputation": 3910, "user_id": 4103854, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EUnmsdTd6P4/AAAAAAAAAAI/AAAAAAAAAGI/TBEWqWgj0wo/photo.jpg?sz=128", "display_name": "Logain", "link": "https://stackoverflow.com/users/4103854/logain"}, "reply_to_user": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "edited": false, "score": 1, "creation_date": 1459580961, "post_id": 36368529, "comment_id": 60359275, "body": "This is hardly a framework, just a solution to a recurrent problem on the platform. And it&#39;s an interesting way to learn about Kotlin and what can we achieve with its features."}, {"owner": {"reputation": 3910, "user_id": 4103854, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EUnmsdTd6P4/AAAAAAAAAAI/AAAAAAAAAGI/TBEWqWgj0wo/photo.jpg?sz=128", "display_name": "Logain", "link": "https://stackoverflow.com/users/4103854/logain"}, "reply_to_user": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "edited": false, "score": 2, "creation_date": 1459581705, "post_id": 36368529, "comment_id": 60359468, "body": "OP stated he/she is still learning Kotlin, it wouldn&#39;t be right to just talk about short term solutions or quick-fixes when we could use the opportunity to learn new things!"}], "tags": [], "owner": {"reputation": 3910, "user_id": 4103854, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EUnmsdTd6P4/AAAAAAAAAAI/AAAAAAAAAGI/TBEWqWgj0wo/photo.jpg?sz=128", "display_name": "Logain", "link": "https://stackoverflow.com/users/4103854/logain"}, "is_accepted": false, "score": 5, "last_activity_date": 1459568106, "last_edit_date": 1459568106, "creation_date": 1459564439, "answer_id": 36368529, "question_id": 36366736, "link": "https://stackoverflow.com/questions/36366736/does-kotlin-custom-get-execute-method-call/36368529#36368529", "title": "Does Kotlin custom get execute method call", "body": "<p>You could go one step further and wrap the property with a delegate, making use of the variable name on the meta data.</p>\n\n<h3>Usage</h3>\n\n<pre><code>class SomeActivity : SomeBaseActivity {\n\n     // Declare property the with key \"myImportantNumber\" \n     // and default value 10\n     var myImportantNumber by preference(10)\n\n     //how to access the property\n     fun isMyImportantNumberReallyHight() = myImportantNumber &gt; 100\n\n     //how to edit the property\n     fun incrementMyImportantNumber(times:Int){\n         myImportantNumber = myImportantNumber + times\n     }\n}\n</code></pre>\n\n<h3>Delegation</h3>\n\n<p>The delegate keeps an instance of some preferences manager and uses the meta data on the property to fetch and save values on the shared preference.</p>\n\n<pre><code>class DelegatedPreference&lt;T&gt;(val default: T, val contextProvider:()-&gt; Context) {\n\n    val manager by lazy { PreferencesManager(contextProvider()) }\n\n    @Suppress(\"UNCHECKED_CAST\")\n    operator fun getValue(thisRef: Any?, prop: KProperty&lt;*&gt;): T {\n        return manager.get(prop.name, default)\n    }\n\n    operator fun setValue(thisRef: Any?, prop: KProperty&lt;*&gt;, value: Any) {\n        manager.save(prop.name, value)\n    }\n\n    class TypeNotImplementedException(val propName:String) : Exception(\"Type of ${propName} is not implemented on DelegatedPreference and thus invalid\")\n}\n</code></pre>\n\n<h3>Some sugar</h3>\n\n<p>A little extension method:</p>\n\n<pre><code>fun &lt;T&gt; Activity.preference(default:T):DelegatedPreference&lt;T&gt;{\n    return DelegatedPreference(default, {this})\n}\n</code></pre>\n\n<p>Which allow us to change this:</p>\n\n<pre><code>var myImportantNumber by DelegatedPreference(10, {this})\n</code></pre>\n\n<p>By something more readable:</p>\n\n<pre><code>var myImportantNumber by preference(10)\n</code></pre>\n\n<h3>The actual getting and saving</h3>\n\n<p>Here what I called <code>PreferencesManager</code> (sorry I didn't come up with a better name) does the heavy lifting, and calls <code>.edit()</code> each time a property needs to be altered. It would look something like:</p>\n\n<pre><code>public class PreferencesManager(context: Context) {\n    private val preferences = getSharedPreferences(context)\n\n    companion object Utils {\n        public val APP_PREFERENCES: String = \"APP_PREFERENCES\"\n\n        fun getSharedPreferences(context: Context): SharedPreferences {\n            return context.getSharedPreferences(APP_PREFERENCES, Context.MODE_PRIVATE)\n        }\n    }\n\n\n    public fun save(label:String, elem:Any){\n        when(elem){\n            is Int     -&gt; preferences.edit().putInt(label, elem).apply()\n            is String  -&gt; preferences.edit().putString(label, elem).apply()\n            is Float   -&gt; preferences.edit().putFloat(label, elem).apply()\n            is Boolean -&gt; preferences.edit().putBoolean(label, elem).apply()\n            else -&gt; throw DelegatedPreference.TypeNotImplementedException(label)\n        }\n    }\n\n    @Suppress(\"UNCHECKED_CAST\", \"IMPLICIT_CAST_TO_ANY\")\n    public fun &lt;T&gt; get(label:String, default:T):T = when(default){\n        is Int     -&gt; preferences.getInt(label, default)\n        is String  -&gt; preferences.getString(label, default)\n        is Float   -&gt; preferences.getFloat(label, default)\n        is Boolean -&gt; preferences.getBoolean(label, default)\n        else -&gt; throw DelegatedPreference.TypeNotImplementedException(label)\n    } as T\n\n}\n</code></pre>\n\n<p>There is a lot of room for improvement here (like parametrizing the preference name instead of hardcoding it, giving an extension point for serializing other types, etc), but the general idea remains.</p>\n"}], "owner": {"reputation": 75, "user_id": 5402104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d1bc8ecc8dd5fcea50fd3f1c706d375?s=128&d=identicon&r=PG&f=1", "display_name": "hlupi", "link": "https://stackoverflow.com/users/5402104/hlupi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 779, "favorite_count": 0, "accepted_answer_id": 36366900, "answer_count": 4, "score": 7, "last_activity_date": 1467664197, "creation_date": 1459549512, "question_id": 36366736, "link": "https://stackoverflow.com/questions/36366736/does-kotlin-custom-get-execute-method-call", "title": "Does Kotlin custom get execute method call", "body": "<p>To increase the readability of calls to SharedPreferences.Editor I want to use a Kotlin variable that will execute 'getSharedPreferences.edit()' each time I need a new SharedPreferences.Editor. Initially I was going to use something like this:</p>\n\n<pre><code>val editPreferences: SharedPreferences.Editor = Application.getSharedPreferences(\"preferences\", Context.MODE_PRIVATE).edit()\n</code></pre>\n\n<p>But then I was informed that 'editPreferences' will hold the reference to the same editor when what I really want it to create a new editor each time the 'editPreferences' is called.</p>\n\n<p>If a custom getter was used would a new editor be returned each time? Something like this:</p>\n\n<pre><code>val editPreferences: SharedPreferences.Editor \n    get() = Application.getSharedPreferences(\"preferences\", Context.MODE_PRIVATE).edit()\n</code></pre>\n\n<p>Still getting up and running with Kotlin and am not sure if the get() method would hold reference to the editor instead of creating a new one. </p>\n"}, {"tags": ["spring", "android-gradle-plugin", "kotlin"], "comments": [{"owner": {"reputation": 11834, "user_id": 1538877, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/N9qfZ.jpg?s=128&g=1", "display_name": "Ruslan", "link": "https://stackoverflow.com/users/1538877/ruslan"}, "edited": false, "score": 0, "creation_date": 1459603604, "post_id": 36362523, "comment_id": 60365500, "body": "Not sure is this can help, but i see often that JsonView uses classes, instead of interfaces. Please, try to create <code>class SampleView</code> and use it. Maybe it would help."}, {"owner": {"reputation": 131, "user_id": 893405, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/4649b5a9f1cf23ba00066758632cca4d?s=128&d=identicon&r=PG", "display_name": "Fernando Luiz", "link": "https://stackoverflow.com/users/893405/fernando-luiz"}, "reply_to_user": {"reputation": 11834, "user_id": 1538877, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/N9qfZ.jpg?s=128&g=1", "display_name": "Ruslan", "link": "https://stackoverflow.com/users/1538877/ruslan"}, "edited": false, "score": 0, "creation_date": 1459630825, "post_id": 36362523, "comment_id": 60374697, "body": "I tried. Same problem"}, {"owner": {"reputation": 11834, "user_id": 1538877, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/N9qfZ.jpg?s=128&g=1", "display_name": "Ruslan", "link": "https://stackoverflow.com/users/1538877/ruslan"}, "edited": false, "score": 0, "creation_date": 1459719745, "post_id": 36362523, "comment_id": 60400035, "body": "Try to replace <code>data class</code> with class written in java, i think there are problem with annotations on data class properties."}, {"owner": {"reputation": 25525, "user_id": 750510, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/6995f16e417430a024c8413ae2d4aca1?s=128&d=identicon&r=PG", "display_name": "madhead", "link": "https://stackoverflow.com/users/750510/madhead"}, "edited": false, "score": 0, "creation_date": 1461708755, "post_id": 36362523, "comment_id": 61320075, "body": "Maybe you&#39;ve <a href=\"https://jira.spring.io/browse/SPR-13331\" rel=\"nofollow noreferrer\">faced this issue</a>?"}], "answers": [{"tags": [], "owner": {"reputation": 81, "user_id": 5258628, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-fGxoELUSKo8/AAAAAAAAAAI/AAAAAAAAARI/TYtdAVecoh4/photo.jpg?sz=128", "display_name": "julo", "link": "https://stackoverflow.com/users/5258628/julo"}, "is_accepted": false, "score": 0, "last_activity_date": 1514532874, "creation_date": 1514532874, "answer_id": 48019143, "question_id": 36362523, "link": "https://stackoverflow.com/questions/36362523/jsonview-in-spring-kotlin/48019143#48019143", "title": "JsonView in Spring + Kotlin", "body": "<p>I was running into the same problem until I added the following dependency:</p>\n\n<pre><code>compile 'com.fasterxml.jackson.module:jackson-module-kotlin'\n</code></pre>\n"}], "owner": {"reputation": 131, "user_id": 893405, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/4649b5a9f1cf23ba00066758632cca4d?s=128&d=identicon&r=PG", "display_name": "Fernando Luiz", "link": "https://stackoverflow.com/users/893405/fernando-luiz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1329, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1514532874, "creation_date": 1459532256, "last_edit_date": 1459683219, "question_id": 36362523, "link": "https://stackoverflow.com/questions/36362523/jsonview-in-spring-kotlin", "title": "JsonView in Spring + Kotlin", "body": "<p>Server returns empty json with JsonView:</p>\n\n<pre><code>[ { }, { } ]\n</code></pre>\n\n<p>I use only <code>Jackson2ObjectMapperBuilder</code> bean to configure <code>jackson</code>:</p>\n\n<pre><code>@Bean\nopen fun objectMapperBuilder() = Jackson2ObjectMapperBuilder()\n    .modulesToInstall(KotlinModule())\n    .propertyNamingStrategy(PropertyNamingStrategy.CAMEL_CASE_TO_LOWER_CASE_WITH_UNDERSCORES)\n    .featuresToEnable(SerializationFeature.WRITE_EMPTY_JSON_ARRAYS)\n</code></pre>\n\n<p><strong>Controller:</strong></p>\n\n<pre><code>@RestController\n@RequestMapping(\"/api/drivers\")\nclass DriversController @Autowired constructor(val driverService: DriverService) {\n\n    @JsonView(Views.Public::class)\n    @RequestMapping(\"/nearest\")\n    fun nearest(): List&lt;Driver&gt; {\n        val drivers = driverService.findNearest(49.437551, 32.025263)\n\n        return drivers\n    }\n</code></pre>\n\n<p><strong>Driver table entity:</strong></p>\n\n<pre><code>@Entity\n@Table(name = \"ct_drivers\")\ndata class Driver(\n\n    @Id\n    @Column(name = \"id\")\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    var id: Int = 0,\n\n    @JsonView(Views.Public::class)\n    @Column(name = \"first_name\")\n    var firstName: String = \"\",\n\n    @JsonView(Views.Public::class)\n    @Column(name = \"last_name\")\n    var lastName: String = \"\",\n\n    @Column(name = \"phone\")\n    var phone: String = \"\"\n\n)\n</code></pre>\n\n<p><strong>Views object:</strong></p>\n\n<pre><code>object Views {\n    interface Public {}\n}\n</code></pre>\n\n<p>Dependencies list:</p>\n\n<pre><code>compile 'org.springframework.boot:spring-boot-starter-web'\ncompile 'org.springframework.boot:spring-boot-devtools'\ncompile 'org.springframework.boot:spring-boot-starter-data-jpa'\ncompile 'org.springframework.boot:spring-boot-starter-thymeleaf'\ncompile 'org.springframework.security.oauth:spring-security-oauth2'\ncompile 'org.springframework:spring-messaging'\ncompile 'org.springframework:springloaded:1.2.5.RELEASE'\ncompile 'org.springframework:spring-tx'\ncompile 'org.springframework:spring-orm:4.2.5.RELEASE'\ncompile 'org.hibernate:hibernate-core:5.1.0.Final'\ncompile 'org.hibernate:hibernate-entitymanager:5.1.0.Final'\ncompile 'org.hibernate:hibernate-spatial:5.1.0.Final'\ncompile 'com.corundumstudio.socketio:netty-socketio:1.7.8'\ncompile 'org.postgresql:postgresql:9.3-1101-jdbc41'\ncompile 'com.github.salomonbrys.kotson:kotson:2.1.0'\ncompile 'com.fasterxml.jackson.module:jackson-module-kotlin:2.7.3'\ncompile 'org.apache.httpcomponents:httpcore:4.3.3'\ncompile 'org.apache.httpcomponents:httpclient:4.3.3'\ncompile \"org.jetbrains.kotlin:kotlin-stdlib:${kotlinVersion}\"\n</code></pre>\n\n<p>How to configure <code>JsonView</code> correctly in my case? May be I forgot something?</p>\n"}, {"tags": ["android", "multithreading", "kotlin", "android-handler", "ui-thread"], "comments": [{"owner": {"reputation": 13934, "user_id": 4096987, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9b66edfbc16fa01f3f45d764a3fa01bb?s=128&d=identicon&r=PG&f=1", "display_name": "AndroidEx", "link": "https://stackoverflow.com/users/4096987/androidex"}, "edited": false, "score": 0, "creation_date": 1459541838, "post_id": 36356577, "comment_id": 60349487, "body": "mb something in the <code>info()</code> implementation?"}], "answers": [{"tags": [], "owner": {"reputation": 25134, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 0, "last_activity_date": 1459515302, "creation_date": 1459515302, "answer_id": 36356930, "question_id": 36356577, "link": "https://stackoverflow.com/questions/36356577/posting-to-ui-thread/36356930#36356930", "title": "Posting to UI thread", "body": "<p>I was able to work around this by starting the thread itself from a <code>post</code>, i.e. </p>\n\n<pre><code>view.post({\n  thread() {\n    info(\"before post\")\n    view.post({ info(\"inside post\") })\n    info(\"after post\")\n  }\n})\n</code></pre>\n\n<p>but I would like to understand why I needed to do that.</p>\n"}, {"tags": [], "owner": {"reputation": 867, "user_id": 5500449, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/439709b90e57d0ba4f2d1f0b065bb16e?s=128&d=identicon&r=PG&f=1", "display_name": "Jefferson Tavares", "link": "https://stackoverflow.com/users/5500449/jefferson-tavares"}, "is_accepted": false, "score": 0, "last_activity_date": 1459516649, "creation_date": 1459516649, "answer_id": 36357408, "question_id": 36356577, "link": "https://stackoverflow.com/questions/36356577/posting-to-ui-thread/36357408#36357408", "title": "Posting to UI thread", "body": "<p>I would recommend you to have a look at Handlers. Its a safer way of updating UI objects when performing operations on a different thread. Basically you just have to pass in the handler object to your thread in order to update the Ui</p>\n\n<p>More info here\n<a href=\"http://developer.android.com/intl/pt-br/reference/android/os/Handler.html\" rel=\"nofollow\">http://developer.android.com/intl/pt-br/reference/android/os/Handler.html</a></p>\n"}, {"comments": [{"owner": {"reputation": 25134, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1459584483, "post_id": 36370807, "comment_id": 60360234, "body": "What would be the correct time to start the <code>thread()</code> without relying on user interaction like the click in your example?"}, {"owner": {"reputation": 233128, "user_id": 807126, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xpNqK.jpg?s=128&g=1", "display_name": "Doug Stevenson", "link": "https://stackoverflow.com/users/807126/doug-stevenson"}, "reply_to_user": {"reputation": 25134, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1459584682, "post_id": 36370807, "comment_id": 60360299, "body": "I would guess during the View&#39;s onAttachedToWindow(), or a registered View.OnAttachStateChangeListener."}, {"owner": {"reputation": 25134, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1459584685, "post_id": 36370807, "comment_id": 60360300, "body": "Oh and BTW I never thought it&#39;d be Kotlin-specific, but tagged it as Kotlin so that someone who looks at the minimal repro example can figure out what language that is."}], "tags": [], "owner": {"reputation": 233128, "user_id": 807126, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xpNqK.jpg?s=128&g=1", "display_name": "Doug Stevenson", "link": "https://stackoverflow.com/users/807126/doug-stevenson"}, "is_accepted": true, "score": 5, "last_activity_date": 1513645141, "last_edit_date": 1513645141, "creation_date": 1459584330, "answer_id": 36370807, "question_id": 36356577, "link": "https://stackoverflow.com/questions/36356577/posting-to-ui-thread/36370807#36370807", "title": "Posting to UI thread", "body": "<p>The underlying issue actually has nothing to do with Kotlin.</p>\n\n<p>The problem is that <code>View.post()</code> only schedules its work successfully on the main thread if the view is <em>currently</em> attached to the view hierarchy.  The final attach of the view doesn't happen at the time of <code>setContentView()</code>.  It happens some time later.</p>\n\n<p>In the event that the subject view of the <code>post()</code> is not currently attached (as is the case shown in the problem), the <code>View</code> creates a <code>RunQueue</code> for the current thread (stored as a thread local) and schedules the work on that <code>RunQueue</code>.</p>\n\n<p>So, the problem for the given sample is as follows.  Since <code>View.post()</code> is not called on the main thread, it will create a new <code>RunQueue</code> for the current, non-main thread without checking to see if it's being directed by a <code>Looper</code> (as is the main thread). This means the scheduled <code>Runnable</code> essentially goes into a <code>RunQueue</code> that is not processed until a <code>Looper</code> starts.  In the case shown here, that <code>Looper</code> is never started, the new thread terminates, and the work is never executed.</p>\n\n<p>If the new thread with <code>post</code> was delayed until after the view was attached, for example, when a click is registered on it, the <code>post</code> will likely be able to schedule the work on the main thread.  But that's not the case here since the post occurs 1) before the view is attached, and 2) on a different non-<code>Looper</code> thread that terminates immediately.</p>\n"}], "owner": {"reputation": 25134, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2025, "favorite_count": 3, "accepted_answer_id": 36370807, "answer_count": 3, "score": 2, "last_activity_date": 1513645141, "creation_date": 1459514328, "last_edit_date": 1459514848, "question_id": 36356577, "link": "https://stackoverflow.com/questions/36356577/posting-to-ui-thread", "title": "Posting to UI thread", "body": "<p>I would like to create a new thread in <code>onCreate</code> and communicate with the UI thread using <code>post</code> on a <code>View</code>. However, the <code>post</code>ed statements never seem to be run. Here's a small example:</p>\n\n<pre><code>import android.app.Activity\nimport android.os.Bundle\nimport android.widget.TextView    \nimport kotlin.concurrent.*\nimport org.jetbrains.anko.*\n\nclass MainActivity: Activity(), AnkoLogger {\n  protected override fun onCreate(savedInstanceState: Bundle?) {\n    super.onCreate(savedInstanceState)\n\n    val view = TextView(this)\n    setContentView(view)\n\n    thread() {\n      info(\"before post\")\n      view.post({ info(\"inside post\") })\n      info(\"after post\")\n    }\n  }\n}\n</code></pre>\n\n<p>Looking at the log, I can only see <code>before post</code> and <code>after post</code>, but never <code>inside post</code>. </p>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["java", "android", "nullable", "kotlin"], "comments": [{"owner": {"reputation": 3293, "user_id": 2387054, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4cd83f1dff60bd2a2620f3732c6658db?s=128&d=identicon&r=PG", "display_name": "zgc7009", "link": "https://stackoverflow.com/users/2387054/zgc7009"}, "edited": false, "score": 0, "creation_date": 1459457314, "post_id": 36343280, "comment_id": 60308721, "body": "The reason it is vital that you follow the NonNull pattern is because it also comes with the CallSuper annotation. If you passed a null value, there would be no checks in the super method since the annotation is to ensure the value isn&#39;t null. You will almost certainly end up with a NPE. If you aren&#39;t calling this method explicitly outside of the framework it should never come with a null value as the framework will respect this annotation."}, {"owner": {"reputation": 91, "user_id": 4966022, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cGjmHRuMasM/AAAAAAAAAAI/AAAAAAAAAEE/edhauODqM3I/photo.jpg?sz=128", "display_name": "brain", "link": "https://stackoverflow.com/users/4966022/brain"}, "reply_to_user": {"reputation": 3293, "user_id": 2387054, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4cd83f1dff60bd2a2620f3732c6658db?s=128&d=identicon&r=PG", "display_name": "zgc7009", "link": "https://stackoverflow.com/users/2387054/zgc7009"}, "edited": false, "score": 0, "creation_date": 1459457793, "post_id": 36343280, "comment_id": 60308988, "body": "The library is calling that method and passing a null value, not my code. The library is breaking it&#39;s own annotation. When I override in Java and allow the null to go through to the super method, no NPE occurs."}, {"owner": {"reputation": 3293, "user_id": 2387054, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4cd83f1dff60bd2a2620f3732c6658db?s=128&d=identicon&r=PG", "display_name": "zgc7009", "link": "https://stackoverflow.com/users/2387054/zgc7009"}, "edited": false, "score": 0, "creation_date": 1459457950, "post_id": 36343280, "comment_id": 60309068, "body": "What in the world, yea that&#39;s just odd."}, {"owner": {"reputation": 91, "user_id": 4966022, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cGjmHRuMasM/AAAAAAAAAAI/AAAAAAAAAEE/edhauODqM3I/photo.jpg?sz=128", "display_name": "brain", "link": "https://stackoverflow.com/users/4966022/brain"}, "reply_to_user": {"reputation": 3293, "user_id": 2387054, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4cd83f1dff60bd2a2620f3732c6658db?s=128&d=identicon&r=PG", "display_name": "zgc7009", "link": "https://stackoverflow.com/users/2387054/zgc7009"}, "edited": false, "score": 0, "creation_date": 1459546423, "post_id": 36343280, "comment_id": 60351830, "body": "I asked about this in Slack and there are no current plans to address the issue. <a href=\"https://kotlinlang.slack.com/archives/general/p1459529683002816\" rel=\"nofollow noreferrer\">kotlinlang.slack.com/archives/general/p1459529683002816</a>"}], "answers": [{"comments": [{"owner": {"reputation": 91, "user_id": 4966022, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cGjmHRuMasM/AAAAAAAAAAI/AAAAAAAAAEE/edhauODqM3I/photo.jpg?sz=128", "display_name": "brain", "link": "https://stackoverflow.com/users/4966022/brain"}, "edited": false, "score": 3, "creation_date": 1459529597, "post_id": 36344954, "comment_id": 60342946, "body": "I just hope they add a way to suppress or ignore that warning for cases like this. It&#39;s a pain to create that intermediate class just to fix one parameter."}], "tags": [], "owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "is_accepted": false, "score": 8, "last_activity_date": 1459535290, "last_edit_date": 1459535290, "creation_date": 1459463456, "answer_id": 36344954, "question_id": 36343280, "link": "https://stackoverflow.com/questions/36343280/how-can-i-override-a-java-method-and-change-the-nullability-of-a-parameter/36344954#36344954", "title": "How can I override a java method, and change the nullability of a parameter?", "body": "<p>There seems to be no straightforward way to suppress nullability annotation handling by Kotlin compiler.</p>\n\n<p>As a workaround, you can make an intermediate derived class with <code>@Nullable</code> annotation in Java: when Kotlin compiler sees both <code>@Nullable</code> and <code>@NonNull</code> on the same code element it behaves as if there were no nullability annotations. Then just subclass it in Kotlin. Example:</p>\n\n<p>Consider a class with a <code>@NonNull</code> parameter in Java:</p>\n\n<pre><code>abstract class Base {\n    public abstract void f(@NonNull String str);\n    //...\n}\n</code></pre>\n\n<p>Kotlin understands the annotation: <code>f(str: String)</code>, the type is non-null.</p>\n\n<p>Now extend <code>Base</code> in Java, override the method and add <code>@Nullable</code> annotation to the parameter in <code>Intermediate</code>:</p>\n\n<pre><code>abstract class Intermediate extends Base {\n    @Override\n    public abstract void f(@Nullable String str);\n}\n</code></pre>\n\n<p>For <code>Intermediate</code>, Kotlin sees <code>f(str: String!)</code>, the parameter has <a href=\"https://kotlinlang.org/docs/reference/java-interop.html#null-safety-and-platform-types\" rel=\"noreferrer\">platform type</a>, that is, its nullability is unknown.</p>\n\n<p>After that, you will be able to declare nullable parameter in a Kotlin subclass of <code>Intermediate</code>:</p>\n\n<pre><code>class Derived(): Intermediate() {\n    override fun f(url: String?) { ... }\n}\n</code></pre>\n"}], "owner": {"reputation": 91, "user_id": 4966022, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cGjmHRuMasM/AAAAAAAAAAI/AAAAAAAAAEE/edhauODqM3I/photo.jpg?sz=128", "display_name": "brain", "link": "https://stackoverflow.com/users/4966022/brain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2412, "favorite_count": 4, "answer_count": 1, "score": 9, "last_activity_date": 1459535290, "creation_date": 1459456587, "last_edit_date": 1459468510, "question_id": 36343280, "link": "https://stackoverflow.com/questions/36343280/how-can-i-override-a-java-method-and-change-the-nullability-of-a-parameter", "title": "How can I override a java method, and change the nullability of a parameter?", "body": "<p>I'm overriding a method from a Java library, and the parameter for the function is annotated as <code>@NonNull</code>. However, when the method is called, the parameter frequently comes in with a <code>null</code> value. When I override the method in Kotlin, it forces me to respect the <code>@NonNull</code> annotation and mark the parameter as not nullable. Of course, Kotlin throws an exception at run time when the parameter comes in with a null value. Is there some way I can override the method in Kotlin and ignore the <code>@NonNull</code> annotation?</p>\n\n<p>Specifically, I'm using the appcompat library for Android. The method is in AppCompatActivity.java</p>\n\n<pre><code>@CallSuper\npublic void onSupportActionModeFinished(@NonNull ActionMode mode) {\n}\n</code></pre>\n\n<p>The override in Kotlin:</p>\n\n<pre><code>override fun onSupportActionModeFinished(mode: ActionMode) {\n    super.onSupportActionModeFinished(mode)\n}\n</code></pre>\n"}, {"tags": ["reflection", "kotlin"], "answers": [{"tags": [], "owner": {"reputation": 25812, "user_id": 288456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf294ff6d86cc587dec43e2af34a9532?s=128&d=identicon&r=PG", "display_name": "Alexander Udalov", "link": "https://stackoverflow.com/users/288456/alexander-udalov"}, "is_accepted": true, "score": 2, "last_activity_date": 1459447190, "creation_date": 1459447190, "answer_id": 36340475, "question_id": 36335191, "link": "https://stackoverflow.com/questions/36335191/is-it-safe-to-call-kclass-memberproperties-on-an-unknown-any-object/36340475#36340475", "title": "Is it safe to call kclass.memberProperties on an unknown (Any) object?", "body": "<p>This is a bug that has been fixed recently and is available in nightly builds. The upcoming Kotlin 1.0.2 release will include the fix. Here's the original issue: <a href=\"https://youtrack.jetbrains.com/issue/KT-11258\" rel=\"nofollow\">KT-11258</a>.</p>\n"}], "owner": {"reputation": 5483, "user_id": 1356130, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/71a884fac9d80ee3171a4018b1eaf660?s=128&d=identicon&r=PG", "display_name": "atok", "link": "https://stackoverflow.com/users/1356130/atok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 36340475, "answer_count": 1, "score": 1, "last_activity_date": 1459452339, "creation_date": 1459431712, "last_edit_date": 1459452339, "question_id": 36335191, "link": "https://stackoverflow.com/questions/36335191/is-it-safe-to-call-kclass-memberproperties-on-an-unknown-any-object", "title": "Is it safe to call kclass.memberProperties on an unknown (Any) object?", "body": "<p>I assumed that it's OK to just access <code>members</code> field of a <code>KClass</code> object. But I have found a case when it's not. Both tests throw exceptions. </p>\n\n<pre><code>@Test fun mapProperties() {\n    val map = mapOf(\"a\" to \"b\")\n    val cls = map.javaClass.kotlin\n    cls.members\n}\n</code></pre>\n\n<p>Throws: <code>kotlin.reflect.KotlinReflectionInternalError: Incorrect resolution sequence for Java field public open val values: kotlin.collections.MutableCollection&lt;(V..V?)&gt; defined in java.util.Collections.SingletonMap[JavaPropertyDescriptor@10163d6]</code></p>\n\n<pre><code>@Test fun mapProperties2() {\n    val map = mapOf(\"a\" to \"b\")\n    val cls = clsByReified(map)\n    cls.members\n}\n\ninline fun &lt;reified T: Any&gt; clsByReified(instance: T): KClass&lt;T&gt; {\n    return T::class\n}\n</code></pre>\n\n<p>Throws: <code>kotlin.reflect.KotlinReflectionInternalError: No metadata found for public abstract val entries: [Not-computed] defined in kotlin.collections.Map[DeserializedPropertyDescriptor@5c1a8622]</code></p>\n\n<p>Not sure if I stumbled upon a bug or just missing something. </p>\n"}, {"tags": ["java", "android", "kotlin", "android-espresso"], "answers": [{"comments": [{"owner": {"reputation": 3386, "user_id": 307735, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/4z7bq.jpg?s=128&g=1", "display_name": "clemp6r", "link": "https://stackoverflow.com/users/307735/clemp6r"}, "edited": false, "score": 0, "creation_date": 1459415822, "post_id": 36329037, "comment_id": 60280417, "body": "I use DI with dagger 1.2.2 in my app, but the suggested fix did not help. Thanx anyway."}], "tags": [], "owner": {"reputation": 74, "user_id": 3185595, "user_type": "registered", "profile_image": "https://graph.facebook.com/1161914600/picture?type=large", "display_name": "Thahaseen", "link": "https://stackoverflow.com/users/3185595/thahaseen"}, "is_accepted": false, "score": 0, "last_activity_date": 1459415611, "creation_date": 1459415611, "answer_id": 36329037, "question_id": 36328767, "link": "https://stackoverflow.com/questions/36328767/android-instrument-test-with-espresso-fails-nosuchmethoderror-get-in-javax-in/36329037#36329037", "title": "Android instrument test with Espresso fails: NoSuchMethodError get() in javax.inject.Provider", "body": "<p>I think you are using DI in your project. Refer Donn Felker blog,</p>\n\n<p><a href=\"http://www.donnfelker.com/android-studio-espresso-2-0-classnotfoundexception/\" rel=\"nofollow\">http://www.donnfelker.com/android-studio-espresso-2-0-classnotfoundexception/</a></p>\n\n<p>Hope this helps you.</p>\n"}, {"tags": [], "owner": {"reputation": 3386, "user_id": 307735, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/4z7bq.jpg?s=128&g=1", "display_name": "clemp6r", "link": "https://stackoverflow.com/users/307735/clemp6r"}, "is_accepted": true, "score": 2, "last_activity_date": 1460127348, "creation_date": 1460127348, "answer_id": 36502838, "question_id": 36328767, "link": "https://stackoverflow.com/questions/36328767/android-instrument-test-with-espresso-fails-nosuchmethoderror-get-in-javax-in/36502838#36502838", "title": "Android instrument test with Espresso fails: NoSuchMethodError get() in javax.inject.Provider", "body": "<p>The solution is to add the following in the proguard file of the application:</p>\n\n<pre><code>-keep class javax.inject.* { *; }\n</code></pre>\n\n<p>Otherwise the <code>get()</code> method is removed by Proguard.</p>\n"}], "owner": {"reputation": 3386, "user_id": 307735, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/4z7bq.jpg?s=128&g=1", "display_name": "clemp6r", "link": "https://stackoverflow.com/users/307735/clemp6r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 909, "favorite_count": 0, "accepted_answer_id": 36502838, "answer_count": 2, "score": 2, "last_activity_date": 1460127348, "creation_date": 1459414882, "question_id": 36328767, "link": "https://stackoverflow.com/questions/36328767/android-instrument-test-with-espresso-fails-nosuchmethoderror-get-in-javax-in", "title": "Android instrument test with Espresso fails: NoSuchMethodError get() in javax.inject.Provider", "body": "<p>When I run my Android instrument test, Espresso class initialization fails with the following stacktrace:</p>\n\n<pre><code>java.lang.NoSuchMethodError: No interface method get()Ljava/lang/Object; in class Ljavax/inject/Provider; or its super classes (declaration of 'javax.inject.Provider' appears in /data/app/com.myapp.mock.debug-2/base.apk)\nat android.support.test.espresso.DaggerBaseLayerComponent.idlingResourceRegistry(DaggerBaseLayerComponent.java:101)\nat android.support.test.espresso.Espresso.&lt;clinit&gt;(Espresso.java:52)\n...\n</code></pre>\n\n<p>I don't know if it is relevant, but my project uses Kotlin.</p>\n\n<p>Any idea?</p>\n"}, {"tags": ["android", "android-asynctask", "kotlin"], "comments": [{"owner": {"reputation": 341, "user_id": 6060929, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a48b976f0b3a4b0221c4648e49c7259a?s=128&d=identicon&r=PG&f=1", "display_name": "Ashim Kansal", "link": "https://stackoverflow.com/users/6060929/ashim-kansal"}, "edited": false, "score": 1, "creation_date": 1459413738, "post_id": 36327989, "comment_id": 60278907, "body": "Parameters and return type of async task overrided functions are depends upon parameter defined in AsyncTask&lt;Void, Void, Boolean&gt;(). So change the third parameter Boolean to what you want in onpostExecute method."}, {"owner": {"reputation": 3773, "user_id": 3111083, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/eb85298c8d24eeeb1747416973003726?s=128&d=identicon&r=PG&f=1", "display_name": "sunil sunny", "link": "https://stackoverflow.com/users/3111083/sunil-sunny"}, "edited": false, "score": 0, "creation_date": 1459415424, "post_id": 36327989, "comment_id": 60280161, "body": "You are returning &quot;result&quot; to postExecute..From this code the &quot;result&quot; is always false.. You are never changing it&#39;s value ?"}, {"owner": {"reputation": 523, "user_id": 4963585, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/ryVZf.jpg?s=128&g=1", "display_name": "whitney13625", "link": "https://stackoverflow.com/users/4963585/whitney13625"}, "reply_to_user": {"reputation": 341, "user_id": 6060929, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a48b976f0b3a4b0221c4648e49c7259a?s=128&d=identicon&r=PG&f=1", "display_name": "Ashim Kansal", "link": "https://stackoverflow.com/users/6060929/ashim-kansal"}, "edited": false, "score": 0, "creation_date": 1459416911, "post_id": 36327989, "comment_id": 60281255, "body": "Thanks @AshimKansal for telling me how to change the return type, helps a lot! Now I could try to focus on dealing with completion block  only..."}, {"owner": {"reputation": 523, "user_id": 4963585, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/ryVZf.jpg?s=128&g=1", "display_name": "whitney13625", "link": "https://stackoverflow.com/users/4963585/whitney13625"}, "reply_to_user": {"reputation": 3773, "user_id": 3111083, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/eb85298c8d24eeeb1747416973003726?s=128&d=identicon&r=PG&f=1", "display_name": "sunil sunny", "link": "https://stackoverflow.com/users/3111083/sunil-sunny"}, "edited": false, "score": 0, "creation_date": 1459417118, "post_id": 36327989, "comment_id": 60281441, "body": "To, @sunilsunny Yes, the result value is not changed, and actually it&#39;s no use to change it after getting the authentication result in the completion block, which runs in different place."}, {"owner": {"reputation": 2973, "user_id": 1649615, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/11yOm.jpg?s=128&g=1", "display_name": "Mickey Tin", "link": "https://stackoverflow.com/users/1649615/mickey-tin"}, "edited": false, "score": 1, "creation_date": 1459432205, "post_id": 36327989, "comment_id": 60292633, "body": "MyLoginService().login is already an asynchronious call, so not need to call in in onBackground"}, {"owner": {"reputation": 523, "user_id": 4963585, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/ryVZf.jpg?s=128&g=1", "display_name": "whitney13625", "link": "https://stackoverflow.com/users/4963585/whitney13625"}, "edited": false, "score": 0, "creation_date": 1459493062, "post_id": 36327989, "comment_id": 60320087, "body": "That&#39;s it! Finally I moved MyLoginService().login on main thread and discarded the default generated UserLoginTask, it works! Thanks a lot!"}], "answers": [{"comments": [{"owner": {"reputation": 523, "user_id": 4963585, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/ryVZf.jpg?s=128&g=1", "display_name": "whitney13625", "link": "https://stackoverflow.com/users/4963585/whitney13625"}, "edited": false, "score": 0, "creation_date": 1459493256, "post_id": 36331159, "comment_id": 60320189, "body": "Finally I moved my login service to the main thread and solved the problem. However the exchanger you mentioned seems to be an useful tool! Learned something new, thanks!"}], "tags": [], "owner": {"reputation": 50303, "user_id": 170842, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/c2ea72b8d001d81fb6ce3f356e45eb3a?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/170842/michael"}, "is_accepted": false, "score": 2, "last_activity_date": 1459421164, "creation_date": 1459421164, "answer_id": 36331159, "question_id": 36327989, "link": "https://stackoverflow.com/questions/36327989/how-to-return-result-in-doinbackground-after-login-api-completion-block-is-finis/36331159#36331159", "title": "How to return result in doInBackground after login API completion block is finished in UserLoginTask", "body": "<p>You can do that but it's not a good idea. In your case it's better to use something like Rx or futures and not an <code>AsyncTask</code>.</p>\n\n<pre><code>override fun doInBackground(vararg params: Void?): Boolean? {\n  val exchanger = Exchanger&lt;Boolean&gt;()\n  MyLoginService().login(mUsername, mPassword, onCompleted = { token -&gt;\n    exchanger.exchange(token != null)\n  })\n\n  return try {\n    exchanger.exchange(false)\n  } catch (exception: InterruptedException) {\n    false\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 523, "user_id": 4963585, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/ryVZf.jpg?s=128&g=1", "display_name": "whitney13625", "link": "https://stackoverflow.com/users/4963585/whitney13625"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 401, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1459421164, "creation_date": 1459412801, "last_edit_date": 1459417187, "question_id": 36327989, "link": "https://stackoverflow.com/questions/36327989/how-to-return-result-in-doinbackground-after-login-api-completion-block-is-finis", "title": "How to return result in doInBackground after login API completion block is finished in UserLoginTask", "body": "<p>I used default LoginActivity in Android Studio and created a simple login view. In my app, the authentication task and access token generation is done by the server via API call. However, since the api call must have a completion block, my login function in <code>doInBackground</code> also does. Therefore the authentication result exists in the thread of the completion block, which makes the returned result of the original <code>doInBackground</code> to <code>onPostExecute</code> incorrect. The functions are overriden, so I cannot change their parameters and formats. I'm still new in android developing and still not very familiar with its asynchronized task, so I would like to ask if there is any way to halt in <code>doInBackground</code> and wait for the result in the completion block? Or is there any better solution to solve my API login? Thanks.</p>\n\n<p>Here the code of my UserLoginTask (written in kotlin but I think the concept would be the same with java):</p>\n\n<pre><code>inner class UserLoginTask internal constructor(private val mUsername: String, private val mPassword) : AsyncTask&lt;Void, Void, Boolean&gt;() {\n    override fun doInBackground(vararg params: Void?): Boolean? {\n        var result = false\n        try {\n            Thread.sleep(2000)\n        } catch(e: InterruptedException) {\n            return false\n        }\n\n        MyLoginService().login(mUsername, mPassword, onCompleted = { token -&gt;\n            // I want to get the login result from here and return it to onPostExecute\n            // It's no use if I change the result to true here because the result is already returned before completion.\n        })\n\n        return result\n    }\n\n    override fun onPostExecute(success: Boolean?) {\n        mAuthTask = null\n        showProgress(false)\n        if(success!!) {\n            finish()\n        } else {\n            mPasswordView!!.error = getString(R.string.error_incorrect_password)\n            mPasswordView!!.requestFocus()\n        }\n\n    }\n\n    override fun onCancelled() {\n        mAuthTask = null\n        showProgress(false)\n    }\n}\n</code></pre>\n"}, {"tags": ["kotlin"], "answers": [{"tags": [], "owner": {"reputation": 3284, "user_id": 1098758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dca1d5f8e92ef9d9ba7a2aa7d6257d0c?s=128&d=identicon&r=PG", "display_name": "Lionel Port", "link": "https://stackoverflow.com/users/1098758/lionel-port"}, "is_accepted": true, "score": 1, "last_activity_date": 1459395424, "creation_date": 1459395424, "answer_id": 36323679, "question_id": 36323623, "link": "https://stackoverflow.com/questions/36323623/escape-reserved-words-in-an-import/36323679#36323679", "title": "Escape reserved words in an import", "body": "<p>One method I've found that works is to import it with an alias which is ok but it does change the name used in code.</p>\n\n<pre><code>import org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.__ as underscore\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3284, "user_id": 1098758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dca1d5f8e92ef9d9ba7a2aa7d6257d0c?s=128&d=identicon&r=PG", "display_name": "Lionel Port", "link": "https://stackoverflow.com/users/1098758/lionel-port"}, "edited": false, "score": 0, "creation_date": 1459472387, "post_id": 36323722, "comment_id": 60314038, "body": "This doesn&#39;t compile. See screenshot from updated answer."}, {"owner": {"reputation": 109956, "user_id": 159145, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/r8ryC.png?s=128&g=1", "display_name": "Dai", "link": "https://stackoverflow.com/users/159145/dai"}, "reply_to_user": {"reputation": 3284, "user_id": 1098758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dca1d5f8e92ef9d9ba7a2aa7d6257d0c?s=128&d=identicon&r=PG", "display_name": "Lionel Port", "link": "https://stackoverflow.com/users/1098758/lionel-port"}, "edited": false, "score": 0, "creation_date": 1459473648, "post_id": 36323722, "comment_id": 60314314, "body": "@LionelPort I typed the exact same code into try.kotlinlang.org at my end and it worked - are you typing a different backtick character? What keyboard layout are you using? Is your computer set to a different locale or encoding?"}, {"owner": {"reputation": 3284, "user_id": 1098758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dca1d5f8e92ef9d9ba7a2aa7d6257d0c?s=128&d=identicon&r=PG", "display_name": "Lionel Port", "link": "https://stackoverflow.com/users/1098758/lionel-port"}, "edited": false, "score": 0, "creation_date": 1459483295, "post_id": 36323722, "comment_id": 60316800, "body": "Its the backtick character (left of the 1 on an us intl keyboard layout). It works fine in code blocks just not in imports. I had defined the &quot;__&quot; class separately in the blah package so maybe that&#39;s why you don&#39;t see the error. I&#39;ve updated my answer to show a definition of the class."}, {"owner": {"reputation": 109956, "user_id": 159145, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/r8ryC.png?s=128&g=1", "display_name": "Dai", "link": "https://stackoverflow.com/users/159145/dai"}, "reply_to_user": {"reputation": 3284, "user_id": 1098758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dca1d5f8e92ef9d9ba7a2aa7d6257d0c?s=128&d=identicon&r=PG", "display_name": "Lionel Port", "link": "https://stackoverflow.com/users/1098758/lionel-port"}, "edited": false, "score": 0, "creation_date": 1459484413, "post_id": 36323722, "comment_id": 60317079, "body": "@LionelPort I can now reproduce the problem and I have found a solution. I have updated my answer."}, {"owner": {"reputation": 3284, "user_id": 1098758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dca1d5f8e92ef9d9ba7a2aa7d6257d0c?s=128&d=identicon&r=PG", "display_name": "Lionel Port", "link": "https://stackoverflow.com/users/1098758/lionel-port"}, "edited": false, "score": 0, "creation_date": 1459486696, "post_id": 36323722, "comment_id": 60317637, "body": "Yes that was the conclusion I had yesterday (see answer below). You can wild card (*) import or alias. Really seems like a bug to me that it&#39;s not consistently applied."}, {"owner": {"reputation": 4776, "user_id": 965730, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/52b8036d3289cbb544c6be0a98b254c7?s=128&d=identicon&r=PG", "display_name": "Hendrik Jander", "link": "https://stackoverflow.com/users/965730/hendrik-jander"}, "edited": false, "score": 0, "creation_date": 1525635056, "post_id": 36323722, "comment_id": 87424355, "body": "Fun fact: There is a method &quot;as()&quot; in gremlin in the __ class. So one would need the import org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.__.&zwnj;&#8203;as to use in the query DSL. I tried several things but could nt get that one to work"}], "tags": [], "owner": {"reputation": 109956, "user_id": 159145, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/r8ryC.png?s=128&g=1", "display_name": "Dai", "link": "https://stackoverflow.com/users/159145/dai"}, "is_accepted": false, "score": 4, "last_activity_date": 1459484396, "last_edit_date": 1459484396, "creation_date": 1459395736, "answer_id": 36323722, "question_id": 36323623, "link": "https://stackoverflow.com/questions/36323623/escape-reserved-words-in-an-import/36323722#36323722", "title": "Escape reserved words in an import", "body": "<p>Disclaimer: I am not a Kotlin user.</p>\n\n<p>The Kotlin Grammar page ( <a href=\"https://kotlinlang.org/docs/reference/grammar.html#SimpleName\" rel=\"nofollow\">https://kotlinlang.org/docs/reference/grammar.html#SimpleName</a> ) states that the <code>import</code> keyword is followed by a <code>SimpleName (\".\" SimpleName)</code> where <code>SimpleName</code> is defined as either <code>&lt;java identifier&gt;</code> or <code>\"``\" &lt;java identifier&gt; \"``\"</code></p>\n\n<p>According to the above rules, each component that needs escaping should be surrounded in single backtick characters. As only the last name is reserved your code should look like this:</p>\n\n<pre><code>import org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.`__`\n</code></pre>\n\n<p>I tried using this in an online Kotlin tool ( <a href=\"http://try.kotlinlang.org/\" rel=\"nofollow\">http://try.kotlinlang.org/</a> ) and the syntax was accepted.</p>\n\n<h2>Update</h2>\n\n<p>I created a 2-file program in try.kotlinlang.org and I can reproduce the problem, and fix it.</p>\n\n<p>So the issue isn't just that keywords and other reserved words need to be escaped with backticks (though in this case, the name <code>__</code> (two underscores) is not a keyword in Kotlin, but that Kotlin does not seem to allow reserved names to even exist in-scope!</p>\n\n<p>Here's my test-case:</p>\n\n<h3>File1.kt</h3>\n\n<pre><code>package blah\n\nclass `__` {\n    fun foo(): Int {\n        return 5\n    }\n}\n</code></pre>\n\n<h3>File2.kt</h3>\n\n<pre><code>import blah.__\n\nfun test2() {\n    val us = __()\n    us.foo\n}\n</code></pre>\n\n<p>This gives me this compile-time error:</p>\n\n<blockquote>\n  <p><code>File2.kt</code> - Error:(1,) Names _, <strong>, _</strong>, ..., are reserved in Kotlin</p>\n</blockquote>\n\n<p>If I change <code>File2.kt</code> to this, then it works fine:</p>\n\n<pre><code>import blah.__ as underscore\n\nfun test2() {\n    val us = underscore()\n    us.foo\n}\n</code></pre>\n\n<p>Using backticks doesn't seem to help at all, but it does give me unexpected errors:</p>\n\n<pre><code>import blah.`__` as `__`\n\nfun test2() {\n    val us = `__`()          &lt;-- error is here\n    us.foo()\n}\n</code></pre>\n\n<blockquote>\n  <p><code>File2.kt</code> - Error: (4, 13) Unresolved reference: <code>__</code></p>\n</blockquote>\n\n<p>Variations of the names with backticks and unescaped double-underscores yields no effect.</p>\n\n<p>So it seems the solution is to alias the name to something else during import.</p>\n"}, {"comments": [{"owner": {"reputation": 3284, "user_id": 1098758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dca1d5f8e92ef9d9ba7a2aa7d6257d0c?s=128&d=identicon&r=PG", "display_name": "Lionel Port", "link": "https://stackoverflow.com/users/1098758/lionel-port"}, "edited": false, "score": 0, "creation_date": 1459472407, "post_id": 36336346, "comment_id": 60314042, "body": "This does not compile. See screenshot from updated answer."}, {"owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "reply_to_user": {"reputation": 3284, "user_id": 1098758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dca1d5f8e92ef9d9ba7a2aa7d6257d0c?s=128&d=identicon&r=PG", "display_name": "Lionel Port", "link": "https://stackoverflow.com/users/1098758/lionel-port"}, "edited": false, "score": 0, "creation_date": 1459487297, "post_id": 36336346, "comment_id": 60317841, "body": "that might be a bug in the parser"}], "tags": [], "owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "is_accepted": false, "score": 0, "last_activity_date": 1459487261, "last_edit_date": 1459487261, "creation_date": 1459434666, "answer_id": 36336346, "question_id": 36323623, "link": "https://stackoverflow.com/questions/36323623/escape-reserved-words-in-an-import/36336346#36336346", "title": "Escape reserved words in an import", "body": "<p>As specified in the docs, your import must look like:</p>\n\n<pre><code>import org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.`__`\n</code></pre>\n\n<p>Then to use the underscore symbol in the code you'll have to escape it every time, so an alias is the best solution:</p>\n\n<pre><code>`__`.foo()\n</code></pre>\n\n<p>Docs: <a href=\"https://kotlinlang.org/docs/reference/java-interop.html#escaping-for-java-identifiers-that-are-keywords-in-kotlin\" rel=\"nofollow\">https://kotlinlang.org/docs/reference/java-interop.html#escaping-for-java-identifiers-that-are-keywords-in-kotlin</a></p>\n"}], "owner": {"reputation": 3284, "user_id": 1098758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dca1d5f8e92ef9d9ba7a2aa7d6257d0c?s=128&d=identicon&r=PG", "display_name": "Lionel Port", "link": "https://stackoverflow.com/users/1098758/lionel-port"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1674, "favorite_count": 1, "accepted_answer_id": 36323679, "answer_count": 3, "score": 2, "last_activity_date": 1459487261, "creation_date": 1459395009, "last_edit_date": 1459483115, "question_id": 36323623, "link": "https://stackoverflow.com/questions/36323623/escape-reserved-words-in-an-import", "title": "Escape reserved words in an import", "body": "<p>When using Java classes in Kotlin, sometimes they use identifiers that are reserved word in kotlin. The java interop documentation says you can use backtick (`) character but this doesn't work in imports. So how to escaped reserved words on import.</p>\n\n<p>e.g. The tinkerpop library has a class called '__' but thats a Kotlin reserved so if I import it like below it gives an error.</p>\n\n<pre><code>import org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.__\n</code></pre>\n\n<p>I can import it using the wild card like this:</p>\n\n<pre><code>import org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.*\n</code></pre>\n\n<p>but because I only use the one class then Intellij's code formatter replaces it with the previous version of the import that gives an error. (Which I guess is a bug in the intellij formatter as well)</p>\n\n<p>For the answers that suggest using backtick ` works. It does not. This does not compile even on try.kotlinlang.org.\nAssuming a class exists defined as</p>\n\n<pre><code>package blah\n\nclass `__` {\n\n}\n</code></pre>\n\n<p>This is what happens when you import it with backticks.\n<a href=\"https://i.stack.imgur.com/a4jkA.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/a4jkA.png\" alt=\"Escapingdoesnotcompile\"></a></p>\n"}]