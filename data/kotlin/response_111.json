[{"tags": ["kotlin"], "answers": [{"tags": [], "owner": {"reputation": 3852, "user_id": 7079453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f35f4fd1c0eaa060ffdc533c89b481e9?s=128&d=identicon&r=PG&f=1", "display_name": "F. George", "link": "https://stackoverflow.com/users/7079453/f-george"}, "is_accepted": true, "score": 15, "last_activity_date": 1487798702, "creation_date": 1487798702, "answer_id": 42402554, "question_id": 42401781, "link": "https://stackoverflow.com/questions/42401781/how-to-find-all-classes-in-a-package-using-reflection-in-kotlin/42402554#42402554", "title": "How to find all classes in a package using reflection in kotlin", "body": "<p>Kotlin on the JVM suffers the same issue as Java in this regard due to the implementation of class loaders.</p>\n\n<blockquote>\n  <p><em>Class loaders are not required to tell the VM which classes it can provide, instead they are just handed requests for classes, and have to return a class or throw an exception.</em></p>\n</blockquote>\n\n<p>Source and more information: <a href=\"https://stackoverflow.com/q/520328\"><code>Can you find all classes in a package using reflection?</code></a></p>\n\n<p>To summarize the linked thread, there are a number of solutions that allow you to inspect your current class path.</p>\n\n<ul>\n<li>The <a href=\"https://github.com/ronmamo/reflections\" rel=\"noreferrer\">Reflections</a> library is pretty straight forward and has a lot of additional functionality like getting all subtypes of a class, <strong>get all types/members annotated with some annotation, optionally with annotation parameters matching</strong>, etc.</li>\n<li><a href=\"https://github.com/google/guava\" rel=\"noreferrer\">Guava</a> has <a href=\"https://google.github.io/guava/releases/21.0/api/docs/com/google/common/reflect/ClassPath.html\" rel=\"noreferrer\"><code>ClassPath</code></a>, which returns <a href=\"https://google.github.io/guava/releases/21.0/api/docs/com/google/common/reflect/ClassPath.ClassInfo.html\" rel=\"noreferrer\"><code>ClassInfo</code></a> POJO's - not enough for your use case, but useful to know as Guava is available almost everywhere.</li>\n<li>Write your own by querying classloader resources and code sources. Would not suggest this route unless you absolutely cannot add library dependencies.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 462, "user_id": 333817, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/006f8342c7002c3783371171da9b4ef2?s=128&d=identicon&r=PG", "display_name": "Francis Huang", "link": "https://stackoverflow.com/users/333817/francis-huang"}, "is_accepted": false, "score": 0, "last_activity_date": 1586629709, "last_edit_date": 1586629709, "creation_date": 1586629265, "answer_id": 61161663, "question_id": 42401781, "link": "https://stackoverflow.com/questions/42401781/how-to-find-all-classes-in-a-package-using-reflection-in-kotlin/61161663#61161663", "title": "How to find all classes in a package using reflection in kotlin", "body": "<p>Here's an example of querying classloader resources, adapted from <a href=\"https://www.javaworld.com/article/2077477/java-tip-113--identify-subclasses-at-runtime.html\" rel=\"nofollow noreferrer\">https://www.javaworld.com/article/2077477/java-tip-113--identify-subclasses-at-runtime.html</a></p>\n\n<p>Requires Java 8 or higher.</p>\n\n<pre><code>// Call this function using something like:\n//     findClasses(\"com.mypackage.mysubpackage\")\n// Modified from https://www.javaworld.com/article/2077477/java-tip-113--identify-subclasses-at-runtime.html\nfun findClasses(pckgname: String) {\n    // Translate the package name into an absolute path\n    var name = pckgname\n    if (!name.startsWith(\"/\")) {\n        name = \"/$name\"\n    }\n    name = name.replace('.', '/')\n\n    // Get a File object for the package\n    val url: URL = Launcher::class.java.getResource(name)\n    val directory = File(url.getFile())\n\n    println(\"Finding classes:\")\n    if (directory.exists()) {\n        // Get the list of the files contained in the package\n        directory.walk()\n            .filter { f -&gt; f.isFile() &amp;&amp; f.name.contains('$') == false &amp;&amp; f.name.endsWith(\".class\") }\n            .forEach {\n                val fullyQualifiedClassName = pckgname +\n                    it.canonicalPath.removePrefix(directory.canonicalPath)\n                    .dropLast(6) // remove .class\n                    .replace('/', '.')\n                try {\n                    // Try to create an instance of the object\n                    val o = Class.forName(fullyQualifiedClassName).getDeclaredConstructor().newInstance()\n                    if (o is MyInterfaceOrClass) {\n                        println(fullyQualifiedClassName)\n                        // Optionally, make a function call here: o.myFunction()\n                    }\n                } catch (cnfex: ClassNotFoundException) {\n                    System.err.println(cnfex)\n                } catch (iex: InstantiationException) {\n                    // We try to instantiate an interface\n                    // or an object that does not have a\n                    // default constructor\n                } catch (iaex: IllegalAccessException) {\n                    // The class is not public\n                }\n            }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 617, "user_id": 4758450, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/9897ceba4a31cee556fd0204e963cd8c?s=128&d=identicon&r=PG&f=1", "display_name": "nrudnyk", "link": "https://stackoverflow.com/users/4758450/nrudnyk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9133, "favorite_count": 2, "accepted_answer_id": 42402554, "answer_count": 2, "score": 10, "last_activity_date": 1586629709, "creation_date": 1487795863, "question_id": 42401781, "link": "https://stackoverflow.com/questions/42401781/how-to-find-all-classes-in-a-package-using-reflection-in-kotlin", "title": "How to find all classes in a package using reflection in kotlin", "body": "<p>Is it possible to find all <code>kotlin</code> classes in a given package? </p>\n\n<p>I also need only annotated classes but it's not a big deal. Any suggestions ?</p>\n"}, {"tags": ["kotlin", "conductor", "kotlin-null-safety"], "comments": [{"owner": {"reputation": 2988, "user_id": 1507512, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/5EsQG.jpg?s=128&g=1", "display_name": "Massimo", "link": "https://stackoverflow.com/users/1507512/massimo"}, "edited": false, "score": 0, "creation_date": 1487783330, "post_id": 42397686, "comment_id": 71942904, "body": "why you have a leak? maybe the problem is on the SalesController rather than on its properties? I&#39;ve never needed to explicitly set to null a property injected by Dagger to avoid leak problems..."}, {"owner": {"reputation": 10814, "user_id": 891242, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/5719e9d6125bf8f75501a83e68b11412?s=128&d=identicon&r=PG", "display_name": "ZakTaccardi", "link": "https://stackoverflow.com/users/891242/zaktaccardi"}, "reply_to_user": {"reputation": 2988, "user_id": 1507512, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/5EsQG.jpg?s=128&g=1", "display_name": "Massimo", "link": "https://stackoverflow.com/users/1507512/massimo"}, "edited": false, "score": 0, "creation_date": 1487783919, "post_id": 42397686, "comment_id": 71943293, "body": "@Massimo Conductor&#39;s controller instances survive config changes <a href=\"https://github.com/bluelinelabs/Conductor\" rel=\"nofollow noreferrer\">github.com/bluelinelabs/Conductor</a>"}, {"owner": {"reputation": 1361, "user_id": 3286059, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c03116cc2ac1d8e53a16fda1af383b8b?s=128&d=identicon&r=PG", "display_name": "Dimezis", "link": "https://stackoverflow.com/users/3286059/dimezis"}, "edited": false, "score": 0, "creation_date": 1487956633, "post_id": 42397686, "comment_id": 72032737, "body": "If you need to nullify them, you don&#39;t need to have <code>lateinit</code> then. And I&#39;m pretty sure you are don&#39;t have any leak there, you are just mixing some definitions. You would leak if your presenter would reference your View, not vice-versa"}], "answers": [{"comments": [{"owner": {"reputation": 24586, "user_id": 3255152, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fbd95ef81d0a85310fee8dd46e0f65b0?s=128&d=identicon&r=PG&f=1", "display_name": "mfulton26", "link": "https://stackoverflow.com/users/3255152/mfulton26"}, "edited": false, "score": 0, "creation_date": 1487786827, "post_id": 42398736, "comment_id": 71945218, "body": "I didn&#39;t think you could have <code>@Inject</code> on a &#39;member property with delegate&#39;."}, {"owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "reply_to_user": {"reputation": 24586, "user_id": 3255152, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fbd95ef81d0a85310fee8dd46e0f65b0?s=128&d=identicon&r=PG&f=1", "display_name": "mfulton26", "link": "https://stackoverflow.com/users/3255152/mfulton26"}, "edited": false, "score": 0, "creation_date": 1487788386, "post_id": 42398736, "comment_id": 71946200, "body": "@mfulton26, thanks for the remark! Do you think it will work with <code>@set:Inject</code>?"}, {"owner": {"reputation": 24586, "user_id": 3255152, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fbd95ef81d0a85310fee8dd46e0f65b0?s=128&d=identicon&r=PG&f=1", "display_name": "mfulton26", "link": "https://stackoverflow.com/users/3255152/mfulton26"}, "edited": false, "score": 0, "creation_date": 1487790545, "post_id": 42398736, "comment_id": 71947450, "body": "Good thinking. I think it will (I&#39;m not using Dagger or anything but at least that compiles)."}, {"owner": {"reputation": 10814, "user_id": 891242, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/5719e9d6125bf8f75501a83e68b11412?s=128&d=identicon&r=PG", "display_name": "ZakTaccardi", "link": "https://stackoverflow.com/users/891242/zaktaccardi"}, "edited": false, "score": 0, "creation_date": 1487894516, "post_id": 42398736, "comment_id": 72002438, "body": "This is perfect. Works great - except I&#39;m not sure what to do now with named injections. normally I did <code>@field:[Inject Named(&quot;bold&quot;)]</code>, but you can&#39;t use <code>@field</code> with delegated properties"}, {"owner": {"reputation": 10814, "user_id": 891242, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/5719e9d6125bf8f75501a83e68b11412?s=128&d=identicon&r=PG", "display_name": "ZakTaccardi", "link": "https://stackoverflow.com/users/891242/zaktaccardi"}, "edited": false, "score": 0, "creation_date": 1487896163, "post_id": 42398736, "comment_id": 72002915, "body": "@hotkey nope. Dagger2 ignores the <code>@Named</code> part"}], "tags": [], "owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "is_accepted": false, "score": 11, "last_activity_date": 1488204937, "last_edit_date": 1488204937, "creation_date": 1487785612, "answer_id": 42398736, "question_id": 42397686, "link": "https://stackoverflow.com/questions/42397686/how-to-set-lateinit-kotlin-property-to-null/42398736#42398736", "title": "How to set lateinit Kotlin property to null", "body": "<p>Kotlin <code>lateinit</code> properties use <code>null</code> as an uninitialized flag value, and there's no clean way to set <code>null</code> in the backing field of a <code>lateinit</code> property without reflection.</p>\n\n<hr>\n\n<p>However, Kotlin allows you to override the properties behavior using delegated properties. Seems like there's no delegate that allows that in <code>kotlin-stdlib</code>, but if you need exactly this behavior, you can <a href=\"https://kotlinlang.org/docs/reference/delegated-properties.html#delegated-properties\" rel=\"noreferrer\">implement your own delegate</a> to do that, adding some code to your utils:</p>\n\n<pre><code>class ResettableManager {\n    private val delegates = mutableListOf&lt;ResettableNotNullDelegate&lt;*, *&gt;&gt;()\n\n    fun register(delegate: ResettableNotNullDelegate&lt;*, *&gt;) { delegates.add(delegate) }\n\n    fun reset() { delegatesToReset.forEach { it.reset() } }\n}\n\nclass Resettable&lt;R, T : Any&gt;(manager: ResettableManager) {\n    init { manager.register(this) }\n\n    private var value: T? = null\n\n    operator fun getValue(thisRef: R, property: KProperty&lt;*&gt;): T =\n            value ?: throw UninitializedPropertyAccessException()\n\n    operator fun setValue(thisRef: R, property: KProperty&lt;*&gt;, t: T) { value = t }\n\n    fun reset() { value = null }\n}\n</code></pre>\n\n<p>And the usage: </p>\n\n<pre><code>class SalesController : BaseController, SalesView {\n    val resettableManager = ResettableManager()\n    @set:Inject var viewBinder: SalesController.ViewBinder by Resettable(resettableManager)\n    @set:Inject var renderer: SalesRenderer by Resettable(resettableManager)\n    @set:Inject var presenter: SalesPresenter by Resettable(resettableManager)\n\n    fun onDestroyView() {\n        resettableManager.reset()\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 10814, "user_id": 891242, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/5719e9d6125bf8f75501a83e68b11412?s=128&d=identicon&r=PG", "display_name": "ZakTaccardi", "link": "https://stackoverflow.com/users/891242/zaktaccardi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6251, "favorite_count": 5, "answer_count": 1, "score": 15, "last_activity_date": 1502611271, "creation_date": 1487782546, "last_edit_date": 1502611271, "question_id": 42397686, "link": "https://stackoverflow.com/questions/42397686/how-to-set-lateinit-kotlin-property-to-null", "title": "How to set lateinit Kotlin property to null", "body": "<p>The below class has a very unique lifecycle, which requires me to temporarily null out <code>lateinit</code> properties</p>\n\n<pre><code>class SalesController : BaseController, SalesView {\n    @Inject lateinit var viewBinder: SalesController.ViewBinder\n    @Inject lateinit var renderer: SalesRenderer\n    @Inject lateinit var presenter: SalesPresenter\n    lateinit private var component: SalesScreenComponent\n\n    override var state = SalesScreen.State.INITIAL  //only property that I want to survive config changes\n\n    fun onCreateView(): View {  /** lateinit variables are set here */ }\n    fun onDestroyView() {\n         //lateinit variables need to be dereferences here, or we have a memory leak \n         renderer = null!! //here's the problem: throws exception bc it's a non-nullable property\n</code></pre>\n\n<p>}\n    }</p>\n\n<p>Here's how it's used by the framework.</p>\n\n<pre><code>controller.onCreateView() //same instance of controller\ncontroller.onDestroyView() //same instance of controller\ncontroller.onCreateView() //same instance of controller\ncontroller.onDestroyView() //same instance of controller\n</code></pre>\n\n<p>My <code>lateinit</code> properties are injected by dagger, and I need to set them to <code>null</code> in <code>onDestroyView</code> - or have a memory leak. This however is not possible in kotlin, as far as I am aware (without reflection). I could make these properties nullable, but that would defeat the purpose of Kotlin's null safety.</p>\n\n<p>I'm not quite sure how to solve this. Ideally there could be some type of annotation processor that would generate java code to null out specific variables automatically in <code>onDestroyView</code>?</p>\n"}, {"tags": ["kotlin"], "answers": [{"tags": [], "owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "is_accepted": true, "score": 7, "last_activity_date": 1487767967, "last_edit_date": 1487767967, "creation_date": 1487754312, "answer_id": 42386984, "question_id": 42386765, "link": "https://stackoverflow.com/questions/42386765/how-to-make-the-argument-default/42386984#42386984", "title": "How to make the argument default?", "body": "<p>When you make a call to a function with default arguments, you still cannot skip them implicitly and pass the following ones, you can only use explicit named arguments to do that.</p>\n\n<p>Example:</p>\n\n<pre><code>fun f(x: Int, y: Double = 0.0, z: String) { /*...*/ }\n</code></pre>\n\n<ul>\n<li><p>You can always pass <code>x</code> as non-named argument, because it is placed before the default argument:</p>\n\n<pre><code>f(1, z = \"abc\")\n</code></pre></li>\n<li><p>You can, of course, pass all the arguments in their order:</p>\n\n<pre><code>f(1, 1.0, \"abc\")\n</code></pre></li>\n<li><p>But you cannot skip a default argument and pass those following it without an explicit label:</p>\n\n<pre><code>f(1, \"abc\") // ERROR\nf(1, z = \"abc\") // OK\n</code></pre></li>\n</ul>\n\n<p><sup><a href=\"http://try.kotlinlang.org/#/UserProjects/g1fjcii1lkc8m7q5jtmqbo8bq2/vme9og0rek6h0evoanavuvi06o\" rel=\"nofollow noreferrer\">(demo of this code)</a></sup></p>\n\n<p>Basically, when you don't use named arguments, the arguments are passed in the order of the parameters, without skipping the default arguments.</p>\n\n<p>The only exception is made for the code block syntax of the last argument when it has functional type:</p>\n\n<pre><code>fun g(x: Int = 0, action: () -&gt; Unit) { action() }\n\ng(0) { println(\"abc\") }\ng { println(\"abc\") } // OK\n</code></pre>\n"}], "owner": {"reputation": 5483, "user_id": 1356130, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/71a884fac9d80ee3171a4018b1eaf660?s=128&d=identicon&r=PG", "display_name": "atok", "link": "https://stackoverflow.com/users/1356130/atok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 0, "accepted_answer_id": 42386984, "answer_count": 1, "score": 2, "last_activity_date": 1487767967, "creation_date": 1487753728, "question_id": 42386765, "link": "https://stackoverflow.com/questions/42386765/how-to-make-the-argument-default", "title": "How to make the argument default?", "body": "<p>I've found a strange case of the default argument value not being default:</p>\n\n<pre><code>class Dog\nclass DogHouse(dog: Dog)\n\ninline fun &lt;T: Any, A: Any&gt; build(sth: String = \"\", call: (A) -&gt; T) {}\n\nfun main(args: Array&lt;String&gt;) {\n    build(call = ::DogHouse)\n    build(::DogHouse)  // This line fails to compile\n}\n</code></pre>\n\n<p>The compilation error:</p>\n\n<pre><code>Error:(11, 5) Kotlin: Type inference failed: inline fun &lt;T : Any, A : Any&gt; build(sth: String = ..., call: (A) -&gt; T): Unit\ncannot be applied to\n(KFunction1&lt;@ParameterName Dog, DogHouse&gt;)\n\nError:(11, 11) Kotlin: Type mismatch: inferred type is KFunction1&lt;@ParameterName Dog, DogHouse&gt; but String was expected\n\nError:(11, 21) Kotlin: No value passed for parameter call\n</code></pre>\n"}, {"tags": ["kotlin", "tornadofx"], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 6677943, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2153be0b527a1e4c25bfc127c3638ed6?s=128&d=identicon&r=PG&f=1", "display_name": "Mauricio Kanada", "link": "https://stackoverflow.com/users/6677943/mauricio-kanada"}, "edited": false, "score": 1, "creation_date": 1487766191, "post_id": 42385796, "comment_id": 71930140, "body": "Wow. Nothing like be answered by the lead programmer! I&#39;m in initial touch with kotlin and tornadofx. So, I don&#39;t know the best solutions for a problem. Anyway, thanks a lot!!!"}, {"owner": {"reputation": 7027, "user_id": 1437402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fbbcf2a192382575c5cdd4d1a0e98a0?s=128&d=identicon&r=PG", "display_name": "Edvin Syse", "link": "https://stackoverflow.com/users/1437402/edvin-syse"}, "reply_to_user": {"reputation": 63, "user_id": 6677943, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2153be0b527a1e4c25bfc127c3638ed6?s=128&d=identicon&r=PG&f=1", "display_name": "Mauricio Kanada", "link": "https://stackoverflow.com/users/6677943/mauricio-kanada"}, "edited": false, "score": 0, "creation_date": 1487839031, "post_id": 42385796, "comment_id": 71967456, "body": "Happy to help :) Keep the questions coming, it&#39;s good to get more info about TornadoFX here on SO!"}], "tags": [], "owner": {"reputation": 7027, "user_id": 1437402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fbbcf2a192382575c5cdd4d1a0e98a0?s=128&d=identicon&r=PG", "display_name": "Edvin Syse", "link": "https://stackoverflow.com/users/1437402/edvin-syse"}, "is_accepted": true, "score": 6, "last_activity_date": 1487751141, "last_edit_date": 1487751141, "creation_date": 1487750630, "answer_id": 42385796, "question_id": 42381874, "link": "https://stackoverflow.com/questions/42381874/cant-use-fontawesomefx-with-kotlin-and-tornadofx/42385796#42385796", "title": "Can&#39;t use fontawesomefx with kotlin and tornadofx", "body": "<p>You didn't post your complete class, but it looks like you try to run the <code>list.forEach</code> instruction outside any method or init block? Kotlin gets confused by the <code>size</code> accessor, use <code>setSize()</code> to avoid the issue.</p>\n\n<p>Here is a complete class with minimal changes to your sample that compiles and runs, and shows you the icons in a vbox.</p>\n\n<pre><code>data class ButtonInfo(val texto: String, val icon: GlyphIcon&lt;*&gt;)\n\nclass IconView : View() {\n    val list = listOf(\n            ButtonInfo(\"Cadastro\", FontAwesomeIconView(FontAwesomeIcon.ADDRESS_BOOK)),\n            ButtonInfo(\"Corrida\", MaterialDesignIconView(MaterialDesignIcon.RUN)),\n            ButtonInfo(\"Classificacao\", FontAwesomeIconView(FontAwesomeIcon.LIST)))\n\n    override val root = vbox {\n        list.forEach {\n            it.icon.setSize(\"3em\")\n            button(it.texto, it.icon) {\n                contentDisplay = ContentDisplay.TOP\n                minWidth = 200.0\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>I used the <code>button</code> builder instead of manually adding to the root node.</p>\n\n<p>Let me offer an alternative:</p>\n\n<pre><code>class IconView : View() {\n    override val root = vbox {\n        button(\"Cadastro\").icon(FontAwesomeIcon.ADDRESS_BOOK)\n        button(\"Corrida\").icon(MaterialDesignIcon.RUN)\n        button(\"Classificacao\").icon(FontAwesomeIcon.LIST)\n    }\n}\n</code></pre>\n\n<p>Then you define this function in a utility file:</p>\n\n<pre><code>fun Button.icon(icon: GlyphIcons, minButtonWidth: Double = 200.0) {\n    graphic = when (icon) {\n        is FontAwesomeIcon -&gt; FontAwesomeIconView(icon)\n        is MaterialDesignIcon -&gt; MaterialDesignIconView(icon)\n        else -&gt; throw IllegalArgumentException(\"Unknown font family ${icon.fontFamily}\")\n    }\n    with(graphic as GlyphIcon&lt;*&gt;) {\n        contentDisplay = ContentDisplay.TOP\n        setSize(\"3em\")\n    }\n    minWidth = minButtonWidth\n}\n</code></pre>\n\n<p>It makes it much easier to see what's going on at the call site.</p>\n\n<p>Also, the <code>setSize(\"3em\")</code> is only there to support Scene Builder. Consider using the <code>glyphSize</code> accessor instead.</p>\n"}], "owner": {"reputation": 63, "user_id": 6677943, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2153be0b527a1e4c25bfc127c3638ed6?s=128&d=identicon&r=PG&f=1", "display_name": "Mauricio Kanada", "link": "https://stackoverflow.com/users/6677943/mauricio-kanada"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 799, "favorite_count": 0, "accepted_answer_id": 42385796, "answer_count": 1, "score": 4, "last_activity_date": 1487751141, "creation_date": 1487732248, "question_id": 42381874, "link": "https://stackoverflow.com/questions/42381874/cant-use-fontawesomefx-with-kotlin-and-tornadofx", "title": "Can&#39;t use fontawesomefx with kotlin and tornadofx", "body": "<p>I'm trying create some JavaFX buttons with FontAwesomeFX icons using TornadoFX. This is the code</p>\n\n<pre><code>    data class ButtonInfo(val texto: String, val icon: GlyphIcon&lt;*&gt;)\n\n    val list = listOf(\n        ButtonInfo(\"Cadastro\", FontAwesomeIconView(FontAwesomeIcon.ADDRESS_BOOK)),\n        ButtonInfo(\"Corrida\", MaterialDesignIconView(MaterialDesignIcon.RUN)),\n        ButtonInfo(\"Classificacao\", FontAwesomeIconView(FontAwesomeIcon.LIST)))\n\n    list.forEach {\n        it.icon.size = \"3em\"\n        val bt = Button(it.texto, it.icon)\n        bt.contentDisplay = ContentDisplay.TOP\n        bt.minWidth = 200.0\n        root += bt\n    }\n</code></pre>\n\n<p>In compilation I get this error:</p>\n\n<pre><code>Type parameter bound for T in var &lt;T : Enum&lt;T!&gt;!&gt; GlyphIcon&lt;T&gt;.size: String! where T : GlyphIcons!\n</code></pre>\n\n<p>is not satisfied: inferred type CapturedTypeConstructor(*) is not a subtype of GlyphIcons!</p>\n\n<p>The GlyphIcon is a Java abstract class with this declaration:</p>\n\n<pre><code>public abstract class GlyphIcon&lt;T extends Enum&lt;T&gt; &amp; GlyphIcons&gt; extends Text\n</code></pre>\n\n<p>I don't know how turn around this error. If I declare:</p>\n\n<pre><code>data class ButtonInfo(val texto: String, val icon: Text)\n</code></pre>\n\n<p>I don't get the above mentioned error, but I miss '.size' property. How I can declare my class 'ButtonInfo' so that this code works?</p>\n"}, {"tags": ["java", "unit-testing", "testing", "kotlin", "language-interoperability"], "answers": [{"comments": [{"owner": {"reputation": 1614, "user_id": 3609514, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/92C38.jpg?s=128&g=1", "display_name": "TheTechWolf", "link": "https://stackoverflow.com/users/3609514/thetechwolf"}, "edited": false, "score": 0, "creation_date": 1487718253, "post_id": 42379601, "comment_id": 71908563, "body": "Never intended to write Java tests for Kotlin that would be really bad idea :) It was more to check how it behaves that way. But what about if I want to verify if that method is called (using Mockito for example) and not to check return value?"}, {"owner": {"reputation": 630270, "user_id": 571407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f0d9dec16bae1e06552af55ddefc11f?s=128&d=identicon&r=PG", "display_name": "JB Nizet", "link": "https://stackoverflow.com/users/571407/jb-nizet"}, "reply_to_user": {"reputation": 1614, "user_id": 3609514, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/92C38.jpg?s=128&g=1", "display_name": "TheTechWolf", "link": "https://stackoverflow.com/users/3609514/thetechwolf"}, "edited": false, "score": 0, "creation_date": 1487718325, "post_id": 42379601, "comment_id": 71908597, "body": "As the Java code shows, an extension method is actually a static method. Mockito can&#39;t mock static methods."}, {"owner": {"reputation": 352, "user_id": 1452741, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SGY4S.jpg?s=128&g=1", "display_name": "Mitch Ware", "link": "https://stackoverflow.com/users/1452741/mitch-ware"}, "reply_to_user": {"reputation": 1614, "user_id": 3609514, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/92C38.jpg?s=128&g=1", "display_name": "TheTechWolf", "link": "https://stackoverflow.com/users/3609514/thetechwolf"}, "edited": false, "score": 2, "creation_date": 1505142156, "post_id": 42379601, "comment_id": 79279528, "body": "@TheTechWolf you really shouldn&#39;t be concerned with checking whether or not your extension method was called, you should just verify that the expected result is there. If your extension method is overly complex and requires asserting its invocation, it probably should be refactored out into a more testable class.  Though this all depends on your use case and what the extension function is actually doing, what&#39;s your use case?"}, {"owner": {"reputation": 409, "user_id": 1987425, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hghA0.png?s=128&g=1", "display_name": "rontho", "link": "https://stackoverflow.com/users/1987425/rontho"}, "reply_to_user": {"reputation": 352, "user_id": 1452741, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SGY4S.jpg?s=128&g=1", "display_name": "Mitch Ware", "link": "https://stackoverflow.com/users/1452741/mitch-ware"}, "edited": false, "score": 0, "creation_date": 1515660923, "post_id": 42379601, "comment_id": 83386963, "body": "I agree with @MitchWare. Extensions functions should be really simple. If it feels like you need to write tests for it, just extract it as a class, mock it where needed and write test for it."}, {"owner": {"reputation": 4336, "user_id": 819651, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b3b2801b397b45b57b784c83b6274e22?s=128&d=identicon&r=PG", "display_name": "Lu&#237;s Soares", "link": "https://stackoverflow.com/users/819651/lu%c3%ads-soares"}, "edited": false, "score": 2, "creation_date": 1523183360, "post_id": 42379601, "comment_id": 86446764, "body": "what if those extensions are inside a class?"}, {"owner": {"reputation": 10239, "user_id": 273456, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/elCxp.jpg?s=128&g=1", "display_name": "Zordid", "link": "https://stackoverflow.com/users/273456/zordid"}, "edited": false, "score": 1, "creation_date": 1605708997, "post_id": 42379601, "comment_id": 114734151, "body": "Exactly - how can I test an extension function that is defined within a class? That&#39;s the search that brought me to this question - which is not answered at all here. Sad. Testing a top-level extension function is easy and not even worth the question and answer..."}], "tags": [], "owner": {"reputation": 630270, "user_id": 571407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f0d9dec16bae1e06552af55ddefc11f?s=128&d=identicon&r=PG", "display_name": "JB Nizet", "link": "https://stackoverflow.com/users/571407/jb-nizet"}, "is_accepted": true, "score": 26, "last_activity_date": 1487717883, "creation_date": 1487717883, "answer_id": 42379601, "question_id": 42379450, "link": "https://stackoverflow.com/questions/42379450/how-should-i-test-kotlin-extension-functions/42379601#42379601", "title": "How should I test Kotlin extension functions?", "body": "<p>Well, to test a method, whether static or not, you call it as real code would do, and you check that it does the right thing.</p>\n\n<p>Assuming this extension method, for example, is defined in the file com/foo/Bar.kt:</p>\n\n<pre><code>fun String.lengthPlus1(): Int {\n    return this.length + 1\n}\n</code></pre>\n\n<p>If you write your test in Kotlin (which you would typically do to test Kotlin code), you would write</p>\n\n<pre><code>assertThat(\"foo\".lengthPlus1()).isEqualTo(4);\n</code></pre>\n\n<p>If you write it in Java (but why would you do that?)</p>\n\n<pre><code>assertThat(BarKt.lengthPlus1(\"foo\")).isEqualTo(4);\n</code></pre>\n"}], "owner": {"reputation": 1614, "user_id": 3609514, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/92C38.jpg?s=128&g=1", "display_name": "TheTechWolf", "link": "https://stackoverflow.com/users/3609514/thetechwolf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8243, "favorite_count": 0, "accepted_answer_id": 42379601, "answer_count": 1, "score": 22, "last_activity_date": 1487717883, "creation_date": 1487717168, "question_id": 42379450, "link": "https://stackoverflow.com/questions/42379450/how-should-i-test-kotlin-extension-functions", "title": "How should I test Kotlin extension functions?", "body": "<p>Can somebody tell me how should I unit-test extension functions in Kotlin? Since they are resolved statically should they be tested as static method calls or as non static ? Also since language is fully interoperable with Java, how Java unit test for Kotlin extension functions should be performed ?  </p>\n"}, {"tags": ["groovy", "collections", "kotlin"], "answers": [{"tags": [], "owner": {"reputation": 79983, "user_id": 147024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b35432f97606c0a31da17084d2414966?s=128&d=identicon&r=PG", "display_name": "yole", "link": "https://stackoverflow.com/users/147024/yole"}, "is_accepted": true, "score": 2, "last_activity_date": 1487670734, "creation_date": 1487670734, "answer_id": 42363963, "question_id": 42357582, "link": "https://stackoverflow.com/questions/42357582/kotlin-equivalent-to-groovy-spead-dot/42363963#42363963", "title": "Kotlin equivalent to Groovy spead-dot (*.)", "body": "<p>No, it's not possible to create new operators in Kotlin.</p>\n"}], "owner": {"reputation": 45871, "user_id": 2788, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/28acae7d7979a1cd603921a198532e7d?s=128&d=identicon&r=PG", "display_name": "Strelok", "link": "https://stackoverflow.com/users/2788/strelok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 0, "accepted_answer_id": 42363963, "answer_count": 1, "score": 1, "last_activity_date": 1487670734, "creation_date": 1487643884, "last_edit_date": 1487644540, "question_id": 42357582, "link": "https://stackoverflow.com/questions/42357582/kotlin-equivalent-to-groovy-spead-dot", "title": "Kotlin equivalent to Groovy spead-dot (*.)", "body": "<p>Given the following code to get a list of all account numbers in one nice list I have to do the following:</p>\n\n<pre><code>data class Customer(val accounts : List&lt;Account&gt;)\ndata class Account(val number : String)\n\nfun getCustomers() = arrayListOf(\n    Customer(\n        arrayListOf(Account(\"1\"),Account(\"2\"))\n    ),\n    Customer(\n        arrayListOf(Account(\"3\"),Account(\"4\"))\n    )\n)\nfun main(args: Array&lt;String&gt;) {\n    // long\n    println(getCustomers().map{ it.accounts }.flatten().map{ it.number })\n    // a little shorter (just discovered while typing the question)\n    println(getCustomers().flatMap{ it.accounts }.map{ it.number })\n</code></pre>\n\n<p><a href=\"http://try.kotlinlang.org/#/UserProjects/65mgo770kfs3h0paf2l69soohv/2cha0nl35um6fc5v2ptkg8gtdt\" rel=\"nofollow noreferrer\">Playground Link</a></p>\n\n<p>In Groovy given the same class structure I could do:</p>\n\n<pre><code>    println(getCustomers()*.accounts*.number.flatten())\n    // or even\n    println(getCustomers().accounts.number.flatten())\n</code></pre>\n\n<p><a href=\"https://groovyconsole.appspot.com/script/5126581479538688\" rel=\"nofollow noreferrer\">Playground Link</a></p>\n\n<p>Which is a little bit nicer. Is it possible to \"create\" an operator (say *.) to do similar to the Groovy version? </p>\n"}, {"tags": ["kotlin", "kdoc"], "comments": [{"owner": {"reputation": 6474, "user_id": 270143, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/tB6Fg.jpg?s=128&g=1", "display_name": "ycomp", "link": "https://stackoverflow.com/users/270143/ycomp"}, "edited": false, "score": 0, "creation_date": 1487644708, "post_id": 42357067, "comment_id": 71866172, "body": "p.s. unrelated - how can you escape <code>[</code> and <code>]</code> when I do <code>Hello [abc]</code> I run into problems with IDEA thinking abc is an identifier but really I need it to literally be brackets"}, {"owner": {"reputation": 416, "user_id": 7051875, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa1d447e29cc41ce81809d7156c05de5?s=128&d=identicon&r=PG&f=1", "display_name": "tango24", "link": "https://stackoverflow.com/users/7051875/tango24"}, "edited": false, "score": 0, "creation_date": 1506864893, "post_id": 42357067, "comment_id": 79979899, "body": "You can escape <code>[</code> and <code>]</code>with ``. I could not find documentation, but at least for the latter has a [test case][intellij-markdown/test/data/parser/linkDefinitions.md]&zwnj;&#8203;."}, {"owner": {"reputation": 416, "user_id": 7051875, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa1d447e29cc41ce81809d7156c05de5?s=128&d=identicon&r=PG&f=1", "display_name": "tango24", "link": "https://stackoverflow.com/users/7051875/tango24"}, "edited": false, "score": 0, "creation_date": 1506865410, "post_id": 42357067, "comment_id": 79980059, "body": "Edit to last post (after fighting with the markup in stackoverflow comments) -- @ycomp: You can escape <code>[</code> and <code>]</code>with \\. I could not find documentation, but at least the latter has a <a href=\"http://intellij-markdown/test/data/parser/linkDefinitions.md\" rel=\"nofollow noreferrer\">test case</a>. Obviously, the escape character is not consumed, but remains visible (at least in the Quick-Documentation). Moreover, you can always mark the respective region as <code>code</code>."}], "owner": {"reputation": 6474, "user_id": 270143, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/tB6Fg.jpg?s=128&g=1", "display_name": "ycomp", "link": "https://stackoverflow.com/users/270143/ycomp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1487640179, "creation_date": 1487640179, "question_id": 42357067, "link": "https://stackoverflow.com/questions/42357067/markdown-vs-multiple", "title": "Markdown # vs multiple #", "body": "<p>I noticed that the use of <code>#</code> or <code>##</code> or <code>####</code> is equivalent... will the always be the case?</p>\n\n<p>I want to use only a '#' sometimes because it is more convenient, as long as it doesn't become much bigger text in the future.</p>\n\n<p>I'm not sure if this applies to generated documentation since I don't know how to generate it, I only found command line instructions but surely there must be an easier way from the IDE that I just haven't found yet.</p>\n"}, {"tags": ["dependency-injection", "guice", "kotlin"], "comments": [{"owner": {"reputation": 25812, "user_id": 288456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf294ff6d86cc587dec43e2af34a9532?s=128&d=identicon&r=PG", "display_name": "Alexander Udalov", "link": "https://stackoverflow.com/users/288456/alexander-udalov"}, "edited": false, "score": 1, "creation_date": 1487662955, "post_id": 42353374, "comment_id": 71872870, "body": "Try <code>@JvmSuppressWildcards List&lt;PuNoManager&gt;</code> or <code>MutableList&lt;PuNoManager&gt;</code>"}, {"owner": {"reputation": 15395, "user_id": 17339, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/d1ed8a9e71adc2b356cfc4e020e0dd0f?s=128&d=identicon&r=PG", "display_name": "Drew Stephens", "link": "https://stackoverflow.com/users/17339/drew-stephens"}, "reply_to_user": {"reputation": 25812, "user_id": 288456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf294ff6d86cc587dec43e2af34a9532?s=128&d=identicon&r=PG", "display_name": "Alexander Udalov", "link": "https://stackoverflow.com/users/288456/alexander-udalov"}, "edited": false, "score": 0, "creation_date": 1487686457, "post_id": 42353374, "comment_id": 71888856, "body": "Great workaround idea\u2014the annotation didn&#39;t work, but changing the constructor to request a <code>MutableList&lt;PuNoManager&gt;</code> got the injection to work properly.  When I pull out the debugger in the <code>@Provides</code> method the <code>listOf()</code> creates an <code>ArrayList</code>, which is indeed a mutable list."}, {"owner": {"reputation": 11569, "user_id": 502399, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ccf39757e9c47ae99df42bdb286c6e5c?s=128&d=identicon&r=PG", "display_name": "Tavian Barnes", "link": "https://stackoverflow.com/users/502399/tavian-barnes"}, "edited": false, "score": 0, "creation_date": 1487702885, "post_id": 42353374, "comment_id": 71900245, "body": "I think the annotation should be <code>List&lt;@JvmSuppressWildcards PuNoManager&gt;</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 25812, "user_id": 288456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf294ff6d86cc587dec43e2af34a9532?s=128&d=identicon&r=PG", "display_name": "Alexander Udalov", "link": "https://stackoverflow.com/users/288456/alexander-udalov"}, "is_accepted": true, "score": 3, "last_activity_date": 1487754046, "creation_date": 1487754046, "answer_id": 42386876, "question_id": 42353374, "link": "https://stackoverflow.com/questions/42353374/why-isnt-guice-finding-my-listinterface-binding/42386876#42386876", "title": "Why isn&#39;t Guice finding my List&lt;Interface&gt; binding?", "body": "<p><code>List&lt;X&gt;</code> in Kotlin is translated to <code>java.util.List&lt;? extends X&gt;</code> on the JVM. Apparently, Guice doesn't support injection of such values. To avoid the wildcard here, you can use a <code>MutableList&lt;X&gt;</code> instead, which translates to <code>java.util.List&lt;X&gt;</code></p>\n"}, {"tags": [], "owner": {"reputation": 4169, "user_id": 341772, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/250b3c601cbd646bece3d2464b024488?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/341772/max"}, "is_accepted": false, "score": 0, "last_activity_date": 1571433698, "creation_date": 1571433698, "answer_id": 58458369, "question_id": 42353374, "link": "https://stackoverflow.com/questions/42353374/why-isnt-guice-finding-my-listinterface-binding/58458369#58458369", "title": "Why isn&#39;t Guice finding my List&lt;Interface&gt; binding?", "body": "<p>Try adding <a href=\"https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.jvm/-jvm-suppress-wildcards/index.html\" rel=\"nofollow noreferrer\"><code>@JvmSuppressWildcards</code></a> to the module class.</p>\n"}], "owner": {"reputation": 15395, "user_id": 17339, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/d1ed8a9e71adc2b356cfc4e020e0dd0f?s=128&d=identicon&r=PG", "display_name": "Drew Stephens", "link": "https://stackoverflow.com/users/17339/drew-stephens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 461, "favorite_count": 0, "accepted_answer_id": 42386876, "answer_count": 2, "score": 2, "last_activity_date": 1571433698, "creation_date": 1487621301, "question_id": 42353374, "link": "https://stackoverflow.com/questions/42353374/why-isnt-guice-finding-my-listinterface-binding", "title": "Why isn&#39;t Guice finding my List&lt;Interface&gt; binding?", "body": "<p>I've got a interface with a couple of implementations:</p>\n\n<pre><code>interface PuNoManager {\n    fun notifyUser(userId: Int)\n}\n\nclass FcmManager\n@Inject\nconstructor(val fcmClient: FcmClient) : PuNoManager {\n    override fun notifyUser(userId: Int) { ...  }\n}\n\nclass ApnsManager\n@Inject\nconstructor(val apnsClient: ApnsClient) : PuNoManager {\n    override fun notifyUser(userId: Int) { ...  }\n}\n</code></pre>\n\n<p>Which are both bound in my <code>Module</code>, along with a <code>@Provides</code>-annotated method to get a <code>List&lt;PuNoManager&gt;</code>:</p>\n\n<pre><code>class PuNoModule: AbstractModule() {\n    override fun configure() {\n        bind(ApnsManager::class.java)\n        bind(FcmManager::class.java)\n    }\n\n    @Provides\n    fun puNoManagers(apnsManager: ApnsManager, fcmManager: FcmManager): List&lt;PuNoManager&gt; {\n        return listOf(apnsManager, fcmManager)\n    }\n}\n</code></pre>\n\n<p>The problem arises when I have a class that needs the <code>List&lt;PuNoManager&gt;</code>\u2014Guice complains that the type hasn't been bound:</p>\n\n<pre><code>Explicit bindings are required and java.util.List&lt;? extends ...PuNoManager&gt; is not explicitly bound.\n  while locating java.util.List&lt;? extends ...PuNoManager&gt;\n</code></pre>\n\n<p>I know my Guice setup is working, as I previously had just the <code>ApnsManager</code> and am adding the second <code>PuNoManager</code>, <code>FcmManager</code>.  The problem stems from the dependent class requesting injection of <code>List&lt;PuNoManager&gt;</code> instead of just <code>ApnsManager</code>.</p>\n"}, {"tags": ["kotlin"], "comments": [{"owner": {"reputation": 583, "user_id": 6932415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21eb39eb48004add7a1ac82b85632170?s=128&d=identicon&r=PG&f=1", "display_name": "Michiel", "link": "https://stackoverflow.com/users/6932415/michiel"}, "edited": false, "score": 0, "creation_date": 1610747500, "post_id": 42341541, "comment_id": 116239531, "body": "it&#39;s not an answer to your question, but perhaps a solution: although <code>b</code> is a val, <code>derived</code>  can still be a var. Why not recreate <code>Derived()</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 79983, "user_id": 147024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b35432f97606c0a31da17084d2414966?s=128&d=identicon&r=PG", "display_name": "yole", "link": "https://stackoverflow.com/users/147024/yole"}, "is_accepted": true, "score": 10, "last_activity_date": 1487587942, "creation_date": 1487587942, "answer_id": 42342608, "question_id": 42341541, "link": "https://stackoverflow.com/questions/42341541/in-kotlin-is-it-possible-to-change-delegation-at-runtime/42342608#42342608", "title": "In Kotlin, is it possible to change delegation at Runtime?", "body": "<p>No, this is not supported in Kotlin as of version 1.1, but this is under consideration for a future version. This is tracked by <a href=\"https://youtrack.jetbrains.com/issue/KT-5870\" rel=\"noreferrer\">this feature request</a>.</p>\n"}], "owner": {"reputation": 3115, "user_id": 20365, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cee28ad2f2324fd3a02d78014e3944f7?s=128&d=identicon&r=PG", "display_name": "ilkinulas", "link": "https://stackoverflow.com/users/20365/ilkinulas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 891, "favorite_count": 0, "accepted_answer_id": 42342608, "answer_count": 1, "score": 7, "last_activity_date": 1487588056, "creation_date": 1487585009, "last_edit_date": 1487588056, "question_id": 42341541, "link": "https://stackoverflow.com/questions/42341541/in-kotlin-is-it-possible-to-change-delegation-at-runtime", "title": "In Kotlin, is it possible to change delegation at Runtime?", "body": "<p>The generated byte code for the below code creates a <code>private final Base $$delegate_0</code> field in the <code>Derived</code> class. When the mutable field <code>b</code> is assigned the original delegate does not change. </p>\n\n<p>Is there a way to change the delegate at runtime while keeping the <code>zero boilerplate</code> implementation? </p>\n\n<pre>\ninterface Base {\n    fun print()\n}\n\nclass BaseImpl(val x: Int) : Base {\n    override fun print() { println(x) }\n}\n\nclass Derived(var b: Base) : Base by b\n\nfun main(args: Array) {\n    val b = BaseImpl(10)\n    val derived = Derived(b)\n    derived.print()// prints 10\n\n    derived.b = BaseImpl(20)\n    derived.print()// prints 10\n}\n</pre>\n\n<p>The sample is taken from the docs <a href=\"https://kotlinlang.org/docs/reference/delegation.html\" rel=\"noreferrer\">https://kotlinlang.org/docs/reference/delegation.html</a> and edited.</p>\n"}, {"tags": ["kotlin"], "answers": [{"comments": [{"owner": {"reputation": 501, "user_id": 4309170, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MnGfl.jpg?s=128&g=1", "display_name": "Han", "link": "https://stackoverflow.com/users/4309170/han"}, "edited": false, "score": 0, "creation_date": 1487570152, "post_id": 42337274, "comment_id": 71827007, "body": "Thanks, can you also tell me how can we print it using a simple for loop?"}, {"owner": {"reputation": 3852, "user_id": 7079453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f35f4fd1c0eaa060ffdc533c89b481e9?s=128&d=identicon&r=PG&f=1", "display_name": "F. George", "link": "https://stackoverflow.com/users/7079453/f-george"}, "reply_to_user": {"reputation": 501, "user_id": 4309170, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MnGfl.jpg?s=128&g=1", "display_name": "Han", "link": "https://stackoverflow.com/users/4309170/han"}, "edited": false, "score": 0, "creation_date": 1487570417, "post_id": 42337274, "comment_id": 71827127, "body": "Depends on how you want to print it, using <code>.forEach</code> would be one way. You seem to be new to Kotlin, so you may want to consult <a href=\"https://kotlinlang.org/docs/reference/basic-syntax.html\" rel=\"nofollow noreferrer\">the reference</a> to learn at your own pace."}, {"owner": {"reputation": 501, "user_id": 4309170, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MnGfl.jpg?s=128&g=1", "display_name": "Han", "link": "https://stackoverflow.com/users/4309170/han"}, "edited": false, "score": 0, "creation_date": 1487570627, "post_id": 42337274, "comment_id": 71827233, "body": "Okay sure. Thanks for your help :)"}, {"owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "edited": false, "score": 0, "creation_date": 1487570733, "post_id": 42337274, "comment_id": 71827266, "body": "Access the elements as usual <code>data[i][j][k]</code>"}], "tags": [], "owner": {"reputation": 3852, "user_id": 7079453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f35f4fd1c0eaa060ffdc533c89b481e9?s=128&d=identicon&r=PG&f=1", "display_name": "F. George", "link": "https://stackoverflow.com/users/7079453/f-george"}, "is_accepted": true, "score": 2, "last_activity_date": 1487569473, "creation_date": 1487569473, "answer_id": 42337274, "question_id": 42337003, "link": "https://stackoverflow.com/questions/42337003/multidimensional-3d-matrix-in-kotlin/42337274#42337274", "title": "Multidimensional &#39;3D&#39; Matrix in Kotlin", "body": "<p>Kotlin currently does not support array literals.</p>\n\n<p>You can use a combination of <code>arrayOf()</code> and <code>intArrayOf()</code>:</p>\n\n<pre><code>val data = arrayOf(\n  arrayOf(intArrayOf(0, 0), intArrayOf(0)),\n  arrayOf(intArrayOf(0, 1), intArrayOf(0)),\n  arrayOf(intArrayOf(1, 0), intArrayOf(0)),\n  arrayOf(intArrayOf(1, 1), intArrayOf(1))\n)\n</code></pre>\n\n<p>You can cut down a little bit on the verbosity using import aliasing if needed:</p>\n\n<pre><code>import kotlin.arrayOf as arr\nimport kotlin.intArrayOf as iarr\n\nval data = arr(\n  arr(iarr(0, 0), iarr(0)),\n  arr(iarr(0, 1), iarr(0)),\n  arr(iarr(1, 0), iarr(0)),\n  arr(iarr(1, 1), iarr(1))\n)\n</code></pre>\n\n<p>Also note that you can auto-convert Java code to Kotlin</p>\n\n<ul>\n<li>in IntelliJ IDEA: copy Java code into a Kotlin file, a confirmation prompt will open.</li>\n<li>online: using <a href=\"http://try.kotlinlang.org\" rel=\"nofollow noreferrer\">http://try.kotlinlang.org</a>.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 60850, "user_id": 221955, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0bc09e1bd45610fc85274cd7bb002c56?s=128&d=identicon&r=PG", "display_name": "Michael Anderson", "link": "https://stackoverflow.com/users/221955/michael-anderson"}, "is_accepted": false, "score": 2, "last_activity_date": 1501719877, "last_edit_date": 1501719877, "creation_date": 1487642697, "answer_id": 42357423, "question_id": 42337003, "link": "https://stackoverflow.com/questions/42337003/multidimensional-3d-matrix-in-kotlin/42357423#42357423", "title": "Multidimensional &#39;3D&#39; Matrix in Kotlin", "body": "<p>When working with arrays in most languages I find it nice to create a helper class, rather than working directly with an <code>int[][][]</code> type. This way you can ensure certain invariants hold (such as all rows having the same length), and ensure better data locality. It can also let you efficiently implement certain operations such as slicing, sub-matrices,  transpose etc. </p>\n\n<p>My usual set of classes would look something like this for 3D. (though I'd probably template on the stored type, rather than hard code it for <code>Int</code>)\nIts pretty incomplete, but the main at the end shows how many of the functions work. </p>\n\n<p>But to show how you can create a 3D array from values you can do</p>\n\n<pre><code>val V = /* .. as in  mEQ5aNLrK3lqs3kfSa5HbvsTWe0nIu's answer */\nval M = Matrix3D(NX,NY,NZ).transform( { v, ix, iy, iz -&gt; V[ix][iy][iz] } ) \n</code></pre>\n\n<p>Further examples are </p>\n\n<pre><code>fun main(args: Array&lt;String&gt;) {\n\n  // Create an empty matrix\n  val v = Matrix3D(4,4,2);\n\n  // We can access elements via [a,b,c] or [a][b][c]\n  v[0,1,1] = 7;\n  print(v)\n  println(\"v[0,1,1]=\" + v[0,1,1])\n  println(\"v[0][1][1]=\" + v[0][1][1])\n\n  println(\"-----\")\n  // Make the matrix a little more interesting\n  v.transform({ w,ix,iy,iz -&gt; ix+iy+iz})\n  print(v)\n\n  println(\"-----\")  \n  // Transform just the slice with ix=2\n  // Slices are fast, as they copy no elements. \n  // but if you change them you change the original\n\n  v[2].transform({w,iy,iz -&gt; w+3})\n  print(v)\n\n  // If you dont want to change the original you can always\n  // create an independent copy\n  print(v[2].bake().transform({w,iy,iz -&gt; w-3}))\n\n  println(\"-----\")\n  // W is the slice of v with ix=0\n  // Can easily extend the slicing options to allow slicing along \n  // any axis - I'd like to add v[_,1,_] to mean the slice with iy=1\n  //  but I've not got to that yet.\n  val W = v[0]\n  print(\"W=\\n\")\n  print(v[0])\n  print(\"W^T=\\n\")\n\n  // Fast transpose, no elements are copied.\n  val WT=v[0].transpose()\n  print(WT)\n\n  // Changing the transpose slice writes back into the original\n  WT[1,1]=5\n  print(V)\n}\n\nfun print(M:Matrix3D) {\n   for(iz in 0..(M.nz-1)) {\n        for(iy in 0..(M.ny-1)) {\n            for(ix in 0..(M.nx-1)){\n                 print(\"%d \".format(M[ix,iy,iz]))\n            }\n            print(\"\\n\")\n        }\n       print(\"\\n\")\n    } \n}\n\nfun print(M:Matrix2D) {\n    for(iy in 0..(M.ny-1)) {\n        for(ix in 0..(M.nx-1)){\n             print(\"%d \".format(M[ix,iy]))\n        }\n        print(\"\\n\")\n    }\n}\n</code></pre>\n\n<p>The library code looks like this:</p>\n\n<pre><code>class Matrix1D(\n    val v:Array&lt;Int&gt;, \n    val nx:Int,\n    val offset:Int,\n    val xstride:Int) {\n      // TODO: Check that the nx,offset,strides etc are valid\n\n    constructor(nx:Int) : this(Array(nx,{i-&gt;0}), nx, 0, 1) {\n\n    }\n\n    fun offsetof(ix:Int):Int {\n        return offset + ix*xstride\n    }\n\n    operator fun get(ix:Int): Int {\n      return v[offsetof(ix)]\n    }\n\n    operator fun set(ix:Int, v:Int) {\n      this.v[offsetof(ix)] = v\n    }\n\n    fun reverse() : Matrix1D {\n        return Matrix1D(v, nx, offsetof(nx-1), -xstride)\n    }\n\n    fun submatrix(startx:Int, newNX:Int) : Matrix1D {\n        return Matrix1D(v,newNX,offsetof(startx), xstride)\n    }\n\n    fun transform(body: (Int, Int) -&gt; Int ) {\n        for(ix in 0..(nx-1)){\n            this[ix] = body(this[ix], ix)\n        }\n    } \n\n    fun bake() : Matrix1D {\n        val rv = Matrix1D(nx);\n        for(ix in 0..(nx-1)) {\n            rv[ix] = this[ix]\n        }\n        return rv\n    }\n}\n\nclass Matrix2D(\n    val v:Array&lt;Int&gt;, \n    val nx:Int, val ny:Int,\n    val offset:Int,\n    val xstride:Int, val ystride:Int) {\n      // TODO: Check that the nx,ny,offset,strides etc are valid\n\n    constructor(nx:Int, ny:Int) : this(Array(nx*ny,{i-&gt;0}), nx, ny, 0, 1, nx ) {\n\n    }\n\n    fun offsetof(ix:Int,iy:Int): Int {\n        return offset + ix*xstride + iy*ystride\n    }\n\n    operator fun get(ix:Int,iy:Int): Int {\n      return v[offsetof(ix,iy)]\n    }\n\n    operator fun set(ix:Int,iy:Int,v:Int) {\n      this.v[offsetof(ix,iy)] = v\n    }\n\n    operator fun get(ix:Int): Matrix1D {\n        return Matrix1D(v, ny, offsetof(ix,0), ystride)\n    }\n\n    fun transpose(): Matrix2D {\n        return Matrix2D(v,ny,nx,offset,ystride,xstride)\n    }\n\n    fun submatrix(startx:Int, starty:Int, newNX:Int, newNY:Int) : Matrix2D {\n        return Matrix2D(v,newNX,newNY,offsetof(startx,starty), xstride, ystride)\n    }\n\n    fun transform(body: (Int, Int, Int) -&gt; Int ) {\n        for(iy in 0..(ny-1)) {\n            for(ix in 0..(nx-1)){\n                 this[ix,iy] = body(this[ix,iy], ix,iy)\n            }\n        }\n    } \n\n    fun bake() : Matrix2D {\n        val rv = Matrix2D(nx,ny);\n        for(ix in 0..(nx-1)) {\n            for(iy in 0..(ny-1)) {\n                    rv[ix,iy] = this[ix,iy]\n            }\n        }\n        return rv\n    }\n}\n\nclass Matrix3D(\n    val v:Array&lt;Int&gt;, \n    val nx:Int, val ny:Int, val nz:Int, \n    val offset:Int,\n    val xstride:Int, val ystride:Int, val zstride:Int) {\n      // TODO: Check that the nx,ny,nz,offset,strides etc are valid\n\n    constructor(nx:Int, ny:Int, nz:Int) : this(Array(nx*ny*nz,{i-&gt;0}), nx, ny, nz, 0, 1, nx, nx*ny ) {\n\n    }\n    operator fun get(ix:Int,iy:Int,iz:Int): Int {\n      return v[offset + ix*xstride + iy*ystride + iz*zstride]\n    }\n\n    operator fun set(ix:Int,iy:Int,iz:Int, v:Int) {\n      this.v[offset + ix*xstride + iy*ystride + iz*zstride] = v\n    }\n\n    operator fun get(ix:Int): Matrix2D {\n        return Matrix2D(v, ny, nz, offset + ix*xstride, ystride, zstride )\n    }\n\n    fun transform(body: (Int, Int, Int, Int) -&gt; Int ) {\n       for(iz in 0..(nz-1)) {\n        for(iy in 0..(ny-1)) {\n            for(ix in 0..(nx-1)){\n                 this[ix,iy,iz] = body(this[ix,iy,iz], ix,iy,iz)\n            }\n        }\n    } \n}\n\n    fun bake() : Matrix3D {\n        val rv = Matrix3D(nx,ny,nz);\n        for(ix in 0..(nx-1)) {\n            for(iy in 0..(ny-1)) {\n                for(iz in 0..(nz-1)){\n                    rv[ix,iy,iz] = this[ix,iy,iz]\n                }\n            }\n        }\n        return rv\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 501, "user_id": 4309170, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MnGfl.jpg?s=128&g=1", "display_name": "Han", "link": "https://stackoverflow.com/users/4309170/han"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2589, "favorite_count": 0, "accepted_answer_id": 42337274, "answer_count": 2, "score": 2, "last_activity_date": 1501719877, "creation_date": 1487568011, "last_edit_date": 1487570113, "question_id": 42337003, "link": "https://stackoverflow.com/questions/42337003/multidimensional-3d-matrix-in-kotlin", "title": "Multidimensional &#39;3D&#39; Matrix in Kotlin", "body": "<p>What will be the syntax of creating a 3D matrix in Kotlin. It's Java equivalent is as follows:</p>\n\n<pre><code>public static final int[][][] data = {{{0,0},{0}},{{0,1},{0}},{{1,0},{0}},{{1,1},{1}}};\n</code></pre>\n\n<p>Thanks </p>\n\n<p>Edit:\nAlso how can I print the Kotlin code using the simple println?</p>\n"}, {"tags": ["spring", "kotlin", "byte-buddy"], "answers": [{"tags": [], "owner": {"reputation": 3852, "user_id": 7079453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f35f4fd1c0eaa060ffdc533c89b481e9?s=128&d=identicon&r=PG&f=1", "display_name": "F. George", "link": "https://stackoverflow.com/users/7079453/f-george"}, "is_accepted": false, "score": 0, "last_activity_date": 1487568047, "creation_date": 1487568047, "answer_id": 42337009, "question_id": 42333069, "link": "https://stackoverflow.com/questions/42333069/using-a-kotlin-object-in-a-class-generated-at-runtime/42337009#42337009", "title": "Using a Kotlin object in a class generated at runtime", "body": "<p><strong>Disclaimer:</strong> I'm a hobby programmer and have not worked with Spring yet. There's a bunch of speculation here based on what I <em>heard</em> about Spring.</p>\n\n<hr>\n\n<p>I have a hunch this might be a classloader problem - you may have 2 <code>StaticAppContext</code> classes loaded in 2 different classloaders due to your usage of <code>ClassLoader.getSystemClassLoader()</code> in <code>D4JModuleLoaderReplacer.replaceModuleLoader()</code>.</p>\n\n<p>To confirm this, log creation of the <code>StaticAppContext</code> object in an <code>init { ... }</code> block. Example:</p>\n\n<pre><code>@Component\nobject StaticAppContext : ApplicationContextAware {\n    private val LOGGER = getLogger(StaticAppContext::class)\n\n    init {\n        LOGGER.info(\"StaticAppContext created. Classloader: ${javaClass.classLoader}\")\n    }\n\n    ...\n}\n</code></pre>\n\n<p>If my theory is right, you should get 2 creation log messages.</p>\n\n<p>If this is the case, I believe you should use the current context classloader (<code>Thread.currentThread().getContextClassLoader()</code>) instead.</p>\n"}, {"tags": [], "owner": {"reputation": 37971, "user_id": 1237575, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/bc96521f79789d75fa63cfa5c2758765?s=128&d=identicon&r=PG", "display_name": "Rafael Winterhalter", "link": "https://stackoverflow.com/users/1237575/rafael-winterhalter"}, "is_accepted": false, "score": 1, "last_activity_date": 1487610550, "creation_date": 1487610550, "answer_id": 42350473, "question_id": 42333069, "link": "https://stackoverflow.com/questions/42333069/using-a-kotlin-object-in-a-class-generated-at-runtime/42350473#42350473", "title": "Using a Kotlin object in a class generated at runtime", "body": "<p>A Kotlin <code>object</code> is compiled to the following layout:</p>\n\n<pre><code>public final class StaticAppContext {\n  public static final StaticAppContext INSTANCE;\n  private StaticAppContext();\n  static {}\n}\n</code></pre>\n\n<p>The class is implicitly a singleton. I do therefore wonder if the problem is a race in class loading. There is a good chance that the static initializer was already called. Are you sure that you are getting the correct log messages?</p>\n"}], "owner": {"reputation": 21, "user_id": 3149903, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ea2c05072d3162126d0d40dd6357ee?s=128&d=identicon&r=PG", "display_name": "jmesserli", "link": "https://stackoverflow.com/users/3149903/jmesserli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1624, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1487624128, "creation_date": 1487539567, "last_edit_date": 1487624128, "question_id": 42333069, "link": "https://stackoverflow.com/questions/42333069/using-a-kotlin-object-in-a-class-generated-at-runtime", "title": "Using a Kotlin object in a class generated at runtime", "body": "<p>I am using ByteBuddy to rebase a class of another library in order to add Spring dependency injection to it. The problem is that I can't instantiate the class that is used as the interceptor, which means that I can't use Spring to inject the <code>ApplicationContext</code> into the interceptor.  </p>\n\n<p>To get around this, I created an object <code>StaticAppContext</code>, which gets the <code>ApplicationContext</code> injected by implementing <code>ApplicationContextAware</code>:</p>\n\n<pre><code>@Component\nobject StaticAppContext : ApplicationContextAware {\n    private val LOGGER = getLogger(StaticAppContext::class)\n\n    @Volatile @JvmStatic lateinit var context: ApplicationContext\n\n    override fun setApplicationContext(applicationContext: ApplicationContext?) {\n        context = applicationContext!!\n        LOGGER.info(\"ApplicationContext injected\")\n    }\n}\n</code></pre>\n\n<p>This is getting injected just fine (I can see the log message), but when I try to access the <code>ApplicationContext</code> from the interceptor, I get <code>kotlin.UninitializedPropertyAccessException: lateinit property context has not been initialized</code>.</p>\n\n<p>The class that rebases the class and the incerceptor are defined in this class:</p>\n\n<pre><code>package nu.peg.discord.d4j\n\nimport net.bytebuddy.ByteBuddy\nimport net.bytebuddy.dynamic.ClassFileLocator\nimport net.bytebuddy.dynamic.loading.ClassLoadingStrategy\nimport net.bytebuddy.implementation.MethodDelegation\nimport net.bytebuddy.implementation.SuperMethodCall\nimport net.bytebuddy.implementation.bind.annotation.*\nimport net.bytebuddy.matcher.ElementMatchers\nimport net.bytebuddy.pool.TypePool\nimport nu.peg.discord.config.BeanNameRegistry.STATIC_APP_CONTEXT\nimport nu.peg.discord.config.StaticAppContext\nimport nu.peg.discord.util.getLogger\nimport org.springframework.beans.BeansException\nimport org.springframework.beans.factory.config.AutowireCapableBeanFactory\nimport org.springframework.context.annotation.DependsOn\nimport org.springframework.stereotype.Component\nimport sx.blah.discord.api.IDiscordClient\nimport sx.blah.discord.modules.Configuration\nimport sx.blah.discord.modules.IModule\nimport sx.blah.discord.modules.ModuleLoader\nimport java.lang.reflect.Constructor\nimport java.util.ArrayList\nimport javax.annotation.PostConstruct\n\n/**\n * TODO Short summary\n *\n * @author Joel Messerli @15.02.2017\n */\n@Component @DependsOn(STATIC_APP_CONTEXT)\nclass D4JModuleLoaderReplacer : IModule {\n    companion object {\n        private val LOGGER = getLogger(D4JModuleLoaderReplacer::class)\n    }\n\n    @PostConstruct\n    fun replaceModuleLoader() {\n        val pool = TypePool.Default.ofClassPath()\n\n        ByteBuddy().rebase&lt;Any&gt;(\n                pool.describe(\"sx.blah.discord.modules.ModuleLoader\").resolve(), ClassFileLocator.ForClassLoader.ofClassPath()\n        ).constructor(\n                ElementMatchers.any()\n        ).intercept(\n                SuperMethodCall.INSTANCE.andThen(MethodDelegation.to(pool.describe(\"nu.peg.discord.d4j.SpringInjectingModuleLoaderInterceptor\").resolve()))\n        ).make().load(ClassLoader.getSystemClassLoader(), ClassLoadingStrategy.Default.INJECTION)\n\n        LOGGER.info(\"The D4J ModuleLoader has been replaced with ByteBuddy to allow for Spring injection\")\n    }\n\n    override fun getName() = \"Spring Injecting Module Loader\"\n    override fun enable(client: IDiscordClient?) = true\n    override fun getVersion() = \"1.0.0\"\n    override fun getMinimumDiscord4JVersion() = \"1.7\"\n    override fun getAuthor() = \"Joel Messerli &lt;hi.github@peg.nu&gt;\"\n    override fun disable() {}\n}\n\nclass SpringInjectingModuleLoaderInterceptor {\n    companion object {\n        private val LOGGER = getLogger(SpringInjectingModuleLoaderInterceptor::class)\n\n        @Suppress(\"UNCHECKED_CAST\")\n        @JvmStatic\n        fun &lt;T&gt; intercept(\n                @This loader: ModuleLoader,\n                @Origin ctor: Constructor&lt;T&gt;,\n                @Argument(0) discordClient: IDiscordClient?,\n\n                @FieldValue(\"modules\") modules: List&lt;Class&lt;out IModule&gt;&gt;,\n                @FieldValue(\"loadedModules\") loadedModules: MutableList&lt;IModule&gt;\n        ) {\n            LOGGER.debug(\"Intercepting $ctor\")\n            val loaderClass = loader.javaClass\n            val clientField = loaderClass.getDeclaredField(\"client\")\n            clientField.isAccessible = true\n            clientField.set(loader, discordClient)\n\n            val canModuleLoadMethod = loaderClass.getDeclaredMethod(\"canModuleLoad\", IModule::class.java)\n            canModuleLoadMethod.isAccessible = true\n\n            val factory = StaticAppContext.context.autowireCapableBeanFactory\n            for (moduleClass in modules) {\n                try {\n                    val wired = factory.autowire(moduleClass, AutowireCapableBeanFactory.AUTOWIRE_BY_TYPE, false) as IModule\n                    LOGGER.info(\"Loading autowired module {}@{} by {}\", wired.name, wired.version, wired.author)\n                    if (canModuleLoadMethod.invoke(loader, wired) as Boolean) {\n                        loadedModules.add(wired)\n                    } else {\n                        LOGGER.info(\"${wired.name} needs at least version ${wired.minimumDiscord4JVersion} to be loaded (skipped)\")\n                    }\n                } catch (e: BeansException) {\n                    LOGGER.info(\"Spring could not create bean\", e)\n                }\n            }\n\n            if (Configuration.AUTOMATICALLY_ENABLE_MODULES) { // Handles module load order and loads the modules\n                val toLoad = ArrayList&lt;IModule&gt;(loadedModules)\n\n                val loadModuleMethod = loaderClass.getDeclaredMethod(\"loadModule\", IModule::class.java)\n                while (toLoad.size &gt; 0) {\n                    toLoad.filter { loadModuleMethod.invoke(loader, it) as Boolean }.forEach { toLoad.remove(it) }\n                }\n            }\n            LOGGER.info(\"Module loading complete\")\n        }\n    }\n}\n</code></pre>\n\n<p>When I debug this, IntelliJ shows that a new instance of StaticAppContext is created when the interceptor tries to access the <code>StaticAppContext</code>, which makes sense since the exception is thrown.</p>\n\n<p>Are Kotlin objects not really Singletons when called from generated code or am I doing something wrong? What would be a way to work around this?</p>\n\n<p>The project can also be found on Github: <a href=\"https://github.com/jmesserli/discord-bernbot/tree/master/src/main/kotlin/nu/peg/discord\" rel=\"nofollow noreferrer\">https://github.com/jmesserli/discord-bernbot/tree/master/src/main/kotlin/nu/peg/discord</a></p>\n\n<hr>\n\n<p><strong>Edit</strong><br>\nI was able to fix the problem by removing <code>spring-boot-devtools</code> which add their own <code>ClassLoader</code>. When I tried the suggestion to use <code>Thread.currentThread().contextClassLoader</code>, I got a different exception telling me that it was already loaded by a different <code>ClassLoader</code> (which confirms that it was a problem with the <code>ClassLoader</code>s). Also, it seems that the assumption that there might be a race was correct.</p>\n\n<p>I am having a different problem now, I'll do some research to see if I can solve it myself.</p>\n"}, {"tags": ["codenameone", "kotlin"], "comments": [{"owner": {"reputation": 8164, "user_id": 5593959, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/9StDn.jpg?s=128&g=1", "display_name": "Dima Rostopira", "link": "https://stackoverflow.com/users/5593959/dima-rostopira"}, "edited": false, "score": 0, "creation_date": 1487529608, "post_id": 42329892, "comment_id": 71815015, "body": "Yes, you can, why not?"}, {"owner": {"reputation": 4616, "user_id": 515377, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/qczen.jpg?s=128&g=1", "display_name": "Graham", "link": "https://stackoverflow.com/users/515377/graham"}, "reply_to_user": {"reputation": 8164, "user_id": 5593959, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/9StDn.jpg?s=128&g=1", "display_name": "Dima Rostopira", "link": "https://stackoverflow.com/users/5593959/dima-rostopira"}, "edited": false, "score": 0, "creation_date": 1487535427, "post_id": 42329892, "comment_id": 71817122, "body": "I&#39;m not so sure about that. Codename One does not alow local builds unless you have enterprise support. Kotlin has to be tied in with the build process in order to work. Is there a way to customize the build process on their servers they require you to use?"}, {"owner": {"reputation": 8164, "user_id": 5593959, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/9StDn.jpg?s=128&g=1", "display_name": "Dima Rostopira", "link": "https://stackoverflow.com/users/5593959/dima-rostopira"}, "edited": false, "score": 0, "creation_date": 1487536291, "post_id": 42329892, "comment_id": 71817397, "body": "If they use Gradle - you can use Kotlin. It&#39;s just a gradle plugin + standard library, not separate compilator"}, {"owner": {"reputation": 4616, "user_id": 515377, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/qczen.jpg?s=128&g=1", "display_name": "Graham", "link": "https://stackoverflow.com/users/515377/graham"}, "reply_to_user": {"reputation": 8164, "user_id": 5593959, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/9StDn.jpg?s=128&g=1", "display_name": "Dima Rostopira", "link": "https://stackoverflow.com/users/5593959/dima-rostopira"}, "edited": false, "score": 0, "creation_date": 1487536839, "post_id": 42329892, "comment_id": 71817587, "body": "I don&#39;t think we&#39;re on the same page. Kotlin does have a compiler that compiles to Java class files. That&#39;s what Grade calls in its build process. Even if they were using Maven I could get it to work. But whether or not they allow you to customize that on their server is what I&#39;m wondering."}, {"owner": {"reputation": 8164, "user_id": 5593959, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/9StDn.jpg?s=128&g=1", "display_name": "Dima Rostopira", "link": "https://stackoverflow.com/users/5593959/dima-rostopira"}, "edited": false, "score": 0, "creation_date": 1487537333, "post_id": 42329892, "comment_id": 71817761, "body": "Kotlin plugin is added in project level build.gradle, same as Google Play Services plugin. I&#39;m highly doubt, that they prohibited GMS"}, {"owner": {"reputation": 49574, "user_id": 756809, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/jFZnE.jpg?s=128&g=1", "display_name": "Shai Almog", "link": "https://stackoverflow.com/users/756809/shai-almog"}, "edited": false, "score": 0, "creation_date": 1487567364, "post_id": 42329892, "comment_id": 71826102, "body": "javac happens on the client which is what matters here... Our server translators for iOS, Windows, JavaScript etc. are all open source so if you need something there you can use pull requests to get things done"}, {"owner": {"reputation": 49574, "user_id": 756809, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/jFZnE.jpg?s=128&g=1", "display_name": "Shai Almog", "link": "https://stackoverflow.com/users/756809/shai-almog"}, "edited": false, "score": 1, "creation_date": 1497360420, "post_id": 42329892, "comment_id": 76037688, "body": "Just edited my answer based on a new announcement we made. We will introduce Kotlin support later this year: <a href=\"https://www.codenameone.com/blog/kotlin-wora-ios-iphone-windows-android.html\" rel=\"nofollow noreferrer\">codenameone.com/blog/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 4316, "user_id": 2935174, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/790492d96cde9864edfb54c10904e204?s=128&d=identicon&r=PG&f=1", "display_name": "steve hannah", "link": "https://stackoverflow.com/users/2935174/steve-hannah"}, "edited": false, "score": 2, "creation_date": 1487610565, "post_id": 42336885, "comment_id": 71851846, "body": "In addition, Kotlin has a runtime library that needs to be included. Including this would require explicit support.  And the library itself may depend on parts of the JRE that aren&#39;t yet supported by Codename One.  When I added Mirah support, I chose Mirah because it was the <i>only</i> JVM language (other than Java) that didn&#39;t require its own runtime library."}], "tags": [], "owner": {"reputation": 49574, "user_id": 756809, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/jFZnE.jpg?s=128&g=1", "display_name": "Shai Almog", "link": "https://stackoverflow.com/users/756809/shai-almog"}, "is_accepted": true, "score": 4, "last_activity_date": 1499767444, "last_edit_date": 1499767444, "creation_date": 1487567293, "answer_id": 42336885, "question_id": 42329892, "link": "https://stackoverflow.com/questions/42329892/can-i-use-kotlin-with-codename-one/42336885#42336885", "title": "Can I use Kotlin with Codename One?", "body": "<p>Updated July 2017: Public beta of Kotlin support is now available: <a href=\"https://www.codenameone.com/blog/kotlin-support-public-beta.html\" rel=\"nofollow noreferrer\">https://www.codenameone.com/blog/kotlin-support-public-beta.html</a></p>\n\n<p>Updated Jun 2017: We've just announced we'll do it by the end of the year: <a href=\"https://www.codenameone.com/blog/kotlin-wora-ios-iphone-windows-android.html\" rel=\"nofollow noreferrer\">https://www.codenameone.com/blog/kotlin-wora-ios-iphone-windows-android.html</a></p>\n\n<p>Original answer below for reference:</p>\n\n<p>There is no official support for that. We contacted the Kotlin team a while back after RoboVM was discontinued and offered to help with integration but this didn't lead anywhere. If there is interest in working together from their team we'll help.</p>\n\n<p>This might be something you can do yourself e.g. Steve Hannah wrote support for Mirah (a subset of Ruby) before we brought him into our team: <a href=\"https://www.codenameone.com/search?q=mirah\" rel=\"nofollow noreferrer\">https://www.codenameone.com/search?q=mirah</a></p>\n\n<p>You can edit our Ant script to call a gradle script that will instrument the code before sending it onward to the compiler. I'm not sure how hard that will be and might \"just work\" with no further effort. </p>\n\n<p>However, there could be two potential problems:</p>\n\n<ul>\n<li><p>Creative usage of bytecode that might fail in some cases (e.g. on iOS, Windows UWP translation). This is unlikely but possible as we test only with javac</p></li>\n<li><p>Usage of API's we don't have - this is possible. E.g. the Kotlin compiler might implicitly rely on parts of the <a href=\"https://www.codenameone.com/blog/why-we-dont-support-the-full-java-api.html\" rel=\"nofollow noreferrer\">Java SE API we don't support</a> in which case the fix might be harder but doable either in Kotlin or in Codename One or somewhere in between with a pre-post processor of the bytecode</p></li>\n</ul>\n"}], "owner": {"reputation": 4616, "user_id": 515377, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/qczen.jpg?s=128&g=1", "display_name": "Graham", "link": "https://stackoverflow.com/users/515377/graham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 401, "favorite_count": 3, "accepted_answer_id": 42336885, "answer_count": 1, "score": 7, "last_activity_date": 1499767444, "creation_date": 1487522403, "question_id": 42329892, "link": "https://stackoverflow.com/questions/42329892/can-i-use-kotlin-with-codename-one", "title": "Can I use Kotlin with Codename One?", "body": "<p>I am a big fan of Kotlin and would like to use it with Codename One instead of Java. Since Kotlin interops seamlessly with Java am I able to use it to build an app with Codename One?</p>\n"}, {"tags": ["junit", "kotlin"], "comments": [{"owner": {"reputation": 25812, "user_id": 288456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf294ff6d86cc587dec43e2af34a9532?s=128&d=identicon&r=PG", "display_name": "Alexander Udalov", "link": "https://stackoverflow.com/users/288456/alexander-udalov"}, "edited": false, "score": 0, "creation_date": 1487662811, "post_id": 42328080, "comment_id": 71872792, "body": "Please always provide the error message / exception stack trace. People can&#39;t help you without knowing what error exactly do you get"}], "answers": [{"tags": [], "owner": {"reputation": 3321, "user_id": 2323964, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e348b1e9034b66bcd141fe0e65eacb83?s=128&d=identicon&r=PG&f=1", "display_name": "Novaterata", "link": "https://stackoverflow.com/users/2323964/novaterata"}, "is_accepted": false, "score": 0, "last_activity_date": 1516400527, "creation_date": 1516400527, "answer_id": 48350383, "question_id": 42328080, "link": "https://stackoverflow.com/questions/42328080/run-junit-tests-written-in-kotlin-with-category-annotation/48350383#48350383", "title": "Run junit tests written in Kotlin with @category annotation", "body": "<p>Even though class names with spaces are allowed in Kotlin, they go against the naming convention, which is PascalCase or UpperCamelCase if you will. I just tested this with the latest JUnit 4 and it doesn't work. </p>\n\n<pre><code>\"C:\\Program Files\\Java\\jdk1.8.0_131\\bin\\java\" -ea -Didea.test.cyclic.buffer.size=1048576 \"-javaagent:C:\\Program Files\\JetBrains\\IntelliJ IDEA Community Edition 2017.3\\lib\\idea_rt.jar=56217:C:\\Program Files\\JetBrains\\IntelliJ IDEA Community Edition 2017.3\\bin\" -Dfile.encoding=UTF-8 -classpath \"C:\\Program Files\\JetBrains\\IntelliJ IDEA Community Edition 2017.3\\lib\\idea_rt.jar\" com.intellij.rt.execution.CommandLineWrapper C:\\Users\\foo\\AppData\\Local\\Temp\\idea_classpath com.intellij.rt.execution.junit.JUnitStarter -ideVersion5 -junit4 com.foo.bar.http.BarHTTPApplicationTest,systemInfoGET\n\njava.lang.reflect.GenericSignatureFormatError: Signature Parse error: expected '&lt;' or ';' but got  \n    Remaining input:  Tests;\n\n    at sun.reflect.generics.parser.SignatureParser.error(SignatureParser.java:124)\n    at sun.reflect.generics.parser.SignatureParser.parsePackageNameAndSimpleClassTypeSignature(SignatureParser.java:348)\n    at sun.reflect.generics.parser.SignatureParser.parseClassTypeSignature(SignatureParser.java:310)\n    at sun.reflect.generics.parser.SignatureParser.parseFieldTypeSignature(SignatureParser.java:289)\n    at sun.reflect.generics.parser.SignatureParser.parseFieldTypeSignature(SignatureParser.java:283)\n    at sun.reflect.generics.parser.SignatureParser.parseTypeSignature(SignatureParser.java:485)\n    at sun.reflect.generics.parser.SignatureParser.parseTypeSig(SignatureParser.java:188)\n    at sun.reflect.annotation.AnnotationParser.parseSig(AnnotationParser.java:436)\n    at sun.reflect.annotation.AnnotationParser.parseClassValue(AnnotationParser.java:420)\n    at sun.reflect.annotation.AnnotationParser.parseClassArray(AnnotationParser.java:724)\n    at sun.reflect.annotation.AnnotationParser.parseArray(AnnotationParser.java:531)\n    at sun.reflect.annotation.AnnotationParser.parseMemberValue(AnnotationParser.java:355)\n    at sun.reflect.annotation.AnnotationParser.parseAnnotation2(AnnotationParser.java:286)\n    at sun.reflect.annotation.AnnotationParser.parseAnnotations2(AnnotationParser.java:120)\n    at sun.reflect.annotation.AnnotationParser.parseAnnotations(AnnotationParser.java:72)\n    at java.lang.reflect.Executable.declaredAnnotations(Executable.java:599)\n    at java.lang.reflect.Executable.declaredAnnotations(Executable.java:597)\n    at java.lang.reflect.Executable.getDeclaredAnnotations(Executable.java:588)\n    at java.lang.reflect.Method.getDeclaredAnnotations(Method.java:630)\n    at java.lang.reflect.AccessibleObject.getAnnotations(AccessibleObject.java:207)\n    at org.junit.runners.model.FrameworkMethod.getAnnotations(FrameworkMethod.java:187)\n    at org.junit.runners.model.TestClass.addToAnnotationLists(TestClass.java:84)\n    at org.junit.runners.model.TestClass.scanAnnotatedMembers(TestClass.java:66)\n    at org.junit.runners.model.TestClass.&lt;init&gt;(TestClass.java:57)\n    at org.junit.runners.ParentRunner.createTestClass(ParentRunner.java:88)\n    at org.junit.runners.ParentRunner.&lt;init&gt;(ParentRunner.java:83)\n    at org.junit.runners.BlockJUnit4ClassRunner.&lt;init&gt;(BlockJUnit4ClassRunner.java:65)\n    at org.junit.internal.builders.JUnit4Builder.runnerForClass(JUnit4Builder.java:10)\n    at org.junit.runners.model.RunnerBuilder.safeRunnerForClass(RunnerBuilder.java:59)\n    at org.junit.internal.builders.AllDefaultPossibilitiesBuilder.runnerForClass(AllDefaultPossibilitiesBuilder.java:26)\n    at org.junit.runners.model.RunnerBuilder.safeRunnerForClass(RunnerBuilder.java:59)\n    at org.junit.internal.requests.ClassRequest.getRunner(ClassRequest.java:33)\n    at org.junit.internal.requests.FilterRequest.getRunner(FilterRequest.java:36)\n    at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:49)\n    at com.intellij.rt.execution.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:47)\n    at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:242)\n    at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:70)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:498)\n    at com.intellij.rt.execution.CommandLineWrapper.main(CommandLineWrapper.java:65)\n\n\nProcess finished with exit code -1\n</code></pre>\n\n<p>So, maybe one day it will be possible, but not right now.</p>\n"}], "owner": {"reputation": 43, "user_id": 7419952, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6cfd1cc47cb037357792094dcda125e1?s=128&d=identicon&r=PG&f=1", "display_name": "fotrenc", "link": "https://stackoverflow.com/users/7419952/fotrenc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 421, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1516400527, "creation_date": 1487512641, "last_edit_date": 1487516766, "question_id": 42328080, "link": "https://stackoverflow.com/questions/42328080/run-junit-tests-written-in-kotlin-with-category-annotation", "title": "Run junit tests written in Kotlin with @category annotation", "body": "<p>\nI have got a question.\nIs it possible to annotate Junit tests, written in Kotlin,\nby @Category with spaces in interface name? \nI want to have something like this:</p>\n\n<pre><code>@Test\n@Category(`Kotlin interface`::class)\nfun `Test with spaces`() {\n</code></pre>\n\n<p>Now I receive an exception</p>\n"}, {"tags": ["gradle", "kotlin"], "answers": [{"tags": [], "owner": {"reputation": 25194, "user_id": 787968, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/LPwWe.jpg?s=128&g=1", "display_name": "Rene Groeschke", "link": "https://stackoverflow.com/users/787968/rene-groeschke"}, "is_accepted": false, "score": 1, "last_activity_date": 1487464675, "creation_date": 1487464675, "answer_id": 42322323, "question_id": 42320216, "link": "https://stackoverflow.com/questions/42320216/how-can-i-run-kotlin-script-kts-files-from-within-gradle/42322323#42322323", "title": "How can I run Kotlin-Script (*.kts) files from within Gradle?", "body": "<p>You have two options here to run a gradle build file named <code>build.gradle.kts</code>.</p>\n\n<ol>\n<li>Change the name of your build file in <code>settings.gradle</code> to <code>build.gradle.kts</code>:\n<code>rootProject.buildFileName = 'build.gradle.kts'</code> and run <code>gradle &lt;tasknames&gt;</code>.</li>\n<li>Run <code>gradle -b build.gradle.kts &lt;tasknames&gt;</code>.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 1453, "user_id": 2141659, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FfmvC.jpg?s=128&g=1", "display_name": "innov8", "link": "https://stackoverflow.com/users/2141659/innov8"}, "is_accepted": false, "score": 0, "last_activity_date": 1507530191, "last_edit_date": 1507530191, "creation_date": 1507523271, "answer_id": 46638867, "question_id": 42320216, "link": "https://stackoverflow.com/questions/42320216/how-can-i-run-kotlin-script-kts-files-from-within-gradle/46638867#46638867", "title": "How can I run Kotlin-Script (*.kts) files from within Gradle?", "body": "<p>Note that with version gradle 4.21 (current at the time of writing this), you do not need any \"buildFileName\" entry, or any other entry in <code>settings.gradle</code>.  If there is a <code>build.gradle.kts</code> and no <code>build.gradle</code>, <code>gradle</code> will use <code>build.gradle.kts</code> by default.</p>\n\n<p>However having the setting for <code>buildFileName</code> does allow <code>build.gradle</code> to be ignored. Without the setting, you have to remove (or rename) <code>build.gradle</code> in order to run build.gradle.kts.  </p>\n\n<p>If you have both a <code>build.gradle</code> and a <code>build.gradle.kts</code> you can switch between the two by commenting and un-commenting the <code>buildFileName</code> setting.</p>\n"}], "owner": {"reputation": 101, "user_id": 1905313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8139a41f0bbb438fd96ba73b9d294a68?s=128&d=identicon&r=PG", "display_name": "Richard Catlin", "link": "https://stackoverflow.com/users/1905313/richard-catlin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 464, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1574243396, "creation_date": 1487449013, "last_edit_date": 1574243396, "question_id": 42320216, "link": "https://stackoverflow.com/questions/42320216/how-can-i-run-kotlin-script-kts-files-from-within-gradle", "title": "How can I run Kotlin-Script (*.kts) files from within Gradle?", "body": "<p>How can I run Kotlin-Script (*.kts) files from within Gradle?</p>\n\n<p>From the command line, I can call:\nkotlinc -script foo.kts </p>\n\n<p>How can I do this from gradle (build.gradle)?</p>\n"}, {"tags": ["kotlin"], "comments": [{"owner": {"reputation": 630270, "user_id": 571407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f0d9dec16bae1e06552af55ddefc11f?s=128&d=identicon&r=PG", "display_name": "JB Nizet", "link": "https://stackoverflow.com/users/571407/jb-nizet"}, "edited": false, "score": 0, "creation_date": 1487413112, "post_id": 42313677, "comment_id": 71781641, "body": "Alt-Enter, expand the first suggested option (labeled &quot;Remove variable &#39;xyz&#39;&quot;), choose one of the options suggested, labeled &quot;Suppress &#39;UNUSED_VARIABLE&#39; for xxx&quot;. That said, I really don&#39;t understand the point of keeping such an unused variable."}], "answers": [{"comments": [{"owner": {"reputation": 6474, "user_id": 270143, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/tB6Fg.jpg?s=128&g=1", "display_name": "ycomp", "link": "https://stackoverflow.com/users/270143/ycomp"}, "edited": false, "score": 0, "creation_date": 1487415177, "post_id": 42313931, "comment_id": 71782223, "body": "thanks, it works now. What was confusing me was that there was no remove option - only a safe delete - so I ignored that before because I usually don&#39;t like safe delete. But I found similar options under the safe delete for supression"}], "tags": [], "owner": {"reputation": 3852, "user_id": 7079453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f35f4fd1c0eaa060ffdc533c89b481e9?s=128&d=identicon&r=PG&f=1", "display_name": "F. George", "link": "https://stackoverflow.com/users/7079453/f-george"}, "is_accepted": true, "score": 9, "last_activity_date": 1487413689, "creation_date": 1487413689, "answer_id": 42313931, "question_id": 42313677, "link": "https://stackoverflow.com/questions/42313677/suppress-an-unused-variable-warning/42313931#42313931", "title": "suppress an unused variable warning", "body": "<p>In IntelliJ IDEA, a right-side arrow on an ALT+ENTER context menu (like this: <img src=\"https://i.imgur.com/P9oNdvP.png\" alt=\"\">) means that you can use your arrow keys to navigate further along the menu. In this case, it leads to your answer:</p>\n\n<p><img src=\"https://i.imgur.com/i7Mp3zt.png\" alt=\"\"></p>\n\n<pre><code>@Suppress(\"UNUSED_VARIABLE\")\nval unused = \"\"\n</code></pre>\n\n<p>If you do not get the initial context menu (<code>Remove variable '...'</code>), you may have disabled the \"Unused assignment\" inspection in your current project. You can fix this by going to Settings -> Editor -> Inspections.</p>\n"}], "owner": {"reputation": 6474, "user_id": 270143, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/tB6Fg.jpg?s=128&g=1", "display_name": "ycomp", "link": "https://stackoverflow.com/users/270143/ycomp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1816, "favorite_count": 0, "accepted_answer_id": 42313931, "answer_count": 1, "score": 3, "last_activity_date": 1525797472, "creation_date": 1487411873, "last_edit_date": 1525797472, "question_id": 42313677, "link": "https://stackoverflow.com/questions/42313677/suppress-an-unused-variable-warning", "title": "suppress an unused variable warning", "body": "<p>How can I suppress the inspection in Kotlin for an unused variable</p>\n\n<p><code>val xyz = abc</code></p>\n\n<p>I get the squiggly line but <code>ALT-ENTER</code> is useless for this, I tried also to create in another method several variables unused and they also lack the <code>ALT-ENTER</code> ability to ignore the warning. Although I have definitely used <code>ALT-ENTER</code> for this in the past, although maybe it was only in java, can't remember.</p>\n\n<p>So I must manually construct it by hand. I've been trying several variations but I can't get anything to work. Please tell me the correct <code>//noinspection</code> or <code>@SupressWarnings</code> to use, thanks</p>\n"}, {"tags": ["collections", "kotlin"], "answers": [{"comments": [{"owner": {"reputation": 310, "user_id": 5721293, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YS3zr1hKPEg/AAAAAAAAAAI/AAAAAAAAAbU/47FzwrIS6-A/photo.jpg?sz=128", "display_name": "Harry J", "link": "https://stackoverflow.com/users/5721293/harry-j"}, "edited": false, "score": 0, "creation_date": 1487409548, "post_id": 42313076, "comment_id": 71780604, "body": "I like this function, it seems like it should be alongside the <code>filterNotNull()</code> for list / iterables though I&#39;m not sure of how that would modify computation cost to apply the function in comparison to those"}], "tags": [], "owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "is_accepted": false, "score": 13, "last_activity_date": 1487407797, "last_edit_date": 1495539971, "creation_date": 1487407797, "answer_id": 42313076, "question_id": 42312826, "link": "https://stackoverflow.com/questions/42312826/is-there-a-way-to-filter-out-null-any-values-in-kotlin-map/42313076#42313076", "title": "Is there a way to filter out null Any? values in Kotlin Map?", "body": "<p>The compiler just doesn't perform type analysis deep enough to infer that, for example, <code>input.filterValues { it != null }</code> filters out <code>null</code> values from the map and thus the resulting map should have a not-null value type. Basically there can be arbitrary predicate with arbitrary meaning in terms of types and nullability.</p>\n\n<p>There is no special case function for filtering <code>null</code> values out of a map in the stdlib (like there is <a href=\"https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/filter-is-instance.html\" rel=\"noreferrer\"><code>.filterIsInstance&lt;T&gt;()</code></a> for iterables). Therefore your easiest solution is to apply an unchecked cast thus telling the compiler that you are sure about the type safety not being violated:</p>\n\n<pre><code>@Suppress(\"UNCHECKED_CAST\")\nfun &lt;K, V&gt; Map&lt;K, V?&gt;.filterNotNullValues() = filterValues { it != null } as Map&lt;K, V&gt;\n</code></pre>\n\n<p>See also: <a href=\"https://stackoverflow.com/questions/36569421/kotlin-how-to-work-with-list-casts-unchecked-cast-kotlin-collections-listkot\">another question with a similar problem</a> about <code>is</code>-check. </p>\n"}, {"comments": [{"owner": {"reputation": 310, "user_id": 5721293, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YS3zr1hKPEg/AAAAAAAAAAI/AAAAAAAAAbU/47FzwrIS6-A/photo.jpg?sz=128", "display_name": "Harry J", "link": "https://stackoverflow.com/users/5721293/harry-j"}, "edited": false, "score": 0, "creation_date": 1487411393, "post_id": 42313096, "comment_id": 71781134, "body": "can the call to <code>mapValues</code> be simplified or are we stuck with taking in the <code>Map.Entry</code>? It seems weird that it wouldn&#39;t just provide the value of type V and expect a return of type R to me but I suppose that would incur a performance cost that iterating over an entry set doesn&#39;t. Maybe the function name is too ambiguous?"}, {"owner": {"reputation": 310, "user_id": 5721293, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YS3zr1hKPEg/AAAAAAAAAAI/AAAAAAAAAbU/47FzwrIS6-A/photo.jpg?sz=128", "display_name": "Harry J", "link": "https://stackoverflow.com/users/5721293/harry-j"}, "edited": false, "score": 0, "creation_date": 1487412028, "post_id": 42313096, "comment_id": 71781369, "body": "I just realised that <code>.mapValues { it.value as Any }</code> achieves the same result, and removes passing the already accessible <code>it</code>"}, {"owner": {"reputation": 630270, "user_id": 571407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f0d9dec16bae1e06552af55ddefc11f?s=128&d=identicon&r=PG", "display_name": "JB Nizet", "link": "https://stackoverflow.com/users/571407/jb-nizet"}, "reply_to_user": {"reputation": 310, "user_id": 5721293, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YS3zr1hKPEg/AAAAAAAAAAI/AAAAAAAAAbU/47FzwrIS6-A/photo.jpg?sz=128", "display_name": "Harry J", "link": "https://stackoverflow.com/users/5721293/harry-j"}, "edited": false, "score": 1, "creation_date": 1487412130, "post_id": 42313096, "comment_id": 71781391, "body": "I don&#39;t think it has anything to do with performance. Whether the mapper function takes an entry or a value doesn&#39;t change anything: the mapValues() function still needs to iterate over all entries. Taking an entry rather than just a value allows doing more things than just taking the value, because you might need to have access to the key to decide how to transform the value."}, {"owner": {"reputation": 310, "user_id": 5721293, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YS3zr1hKPEg/AAAAAAAAAAI/AAAAAAAAAbU/47FzwrIS6-A/photo.jpg?sz=128", "display_name": "Harry J", "link": "https://stackoverflow.com/users/5721293/harry-j"}, "edited": false, "score": 0, "creation_date": 1487412542, "post_id": 42313096, "comment_id": 71781515, "body": "yeah that&#39;s a good point. I actually decided this implementation was better from removing the Unchecked cast warning, and ended up just writing an extension function <code>fun &lt;K,V&gt; Map&lt;K,V?&gt;.filterNullValues() = this.filterValues{it!=null}.mapValues { it.value as V }</code> which seems to pass a trivial test I checked against."}, {"owner": {"reputation": 630270, "user_id": 571407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f0d9dec16bae1e06552af55ddefc11f?s=128&d=identicon&r=PG", "display_name": "JB Nizet", "link": "https://stackoverflow.com/users/571407/jb-nizet"}, "reply_to_user": {"reputation": 310, "user_id": 5721293, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YS3zr1hKPEg/AAAAAAAAAAI/AAAAAAAAAbU/47FzwrIS6-A/photo.jpg?sz=128", "display_name": "Harry J", "link": "https://stackoverflow.com/users/5721293/harry-j"}, "edited": false, "score": 1, "creation_date": 1487412652, "post_id": 42313096, "comment_id": 71781543, "body": "It&#39;s less efficient than removing the warning, and removing the warning is safe in this case. If you really create your own function anyway, implementing it as I show in my answer would be more efficient than doing two passes on the map."}, {"owner": {"reputation": 310, "user_id": 5721293, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YS3zr1hKPEg/AAAAAAAAAAI/AAAAAAAAAbU/47FzwrIS6-A/photo.jpg?sz=128", "display_name": "Harry J", "link": "https://stackoverflow.com/users/5721293/harry-j"}, "edited": false, "score": 0, "creation_date": 1487412858, "post_id": 42313096, "comment_id": 71781584, "body": "Right. That makes sense from the performance perspective. Kotlin&#39;s stream/iterate-like functions are still a bit lost on me being so new."}, {"owner": {"reputation": 1979, "user_id": 4323043, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d973162d2d5ded9dcd374603be854bd5?s=128&d=identicon&r=PG&f=1", "display_name": "\ucd5c\ubd09\uc7ac", "link": "https://stackoverflow.com/users/4323043/%ec%b5%9c%eb%b4%89%ec%9e%ac"}, "edited": false, "score": 0, "creation_date": 1601275731, "post_id": 42313096, "comment_id": 113345119, "body": "why don&#39;t you use extension?"}], "tags": [], "owner": {"reputation": 630270, "user_id": 571407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f0d9dec16bae1e06552af55ddefc11f?s=128&d=identicon&r=PG", "display_name": "JB Nizet", "link": "https://stackoverflow.com/users/571407/jb-nizet"}, "is_accepted": true, "score": 17, "last_activity_date": 1487407966, "creation_date": 1487407966, "answer_id": 42313096, "question_id": 42312826, "link": "https://stackoverflow.com/questions/42312826/is-there-a-way-to-filter-out-null-any-values-in-kotlin-map/42313096#42313096", "title": "Is there a way to filter out null Any? values in Kotlin Map?", "body": "<p>The filter functions return a Map with the same generic types as the original map. To transform the type of the value, you need to map the values from Any? to Any, by doing a cast. The compiler can't know that the predicate you pass to filter() makes sure all the values of the filtered map are non-null, so it can't use type inference. So your best et is to use</p>\n\n<pre><code>val filtered: Map&lt;String, Any&gt; = map.filterValues { it != null }.mapValues { it -&gt; it.value as Any }\n</code></pre>\n\n<p>or to define a function doing the filtering and the transformation in a single pass, and thus be able to use smart casts:</p>\n\n<pre><code>fun filterNotNullValues(map: Map&lt;String, Any?&gt;): Map&lt;String, Any&gt; {\n    val result = LinkedHashMap&lt;String, Any&gt;()\n    for ((key, value) in map) {\n        if (value != null) result[key] = value\n    }\n    return result\n}\n</code></pre>\n"}], "owner": {"reputation": 310, "user_id": 5721293, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YS3zr1hKPEg/AAAAAAAAAAI/AAAAAAAAAbU/47FzwrIS6-A/photo.jpg?sz=128", "display_name": "Harry J", "link": "https://stackoverflow.com/users/5721293/harry-j"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8445, "favorite_count": 0, "accepted_answer_id": 42313096, "answer_count": 2, "score": 15, "last_activity_date": 1487407966, "creation_date": 1487405856, "question_id": 42312826, "link": "https://stackoverflow.com/questions/42312826/is-there-a-way-to-filter-out-null-any-values-in-kotlin-map", "title": "Is there a way to filter out null Any? values in Kotlin Map?", "body": "<p>I'm trying to think of a function that would allow a <code>Map&lt;String, Any?&gt;</code> object to be treated as <code>Map&lt;String,Any&gt;</code> through type inference through applying a single function.</p>\n\n<p>I am pretty new to the transformation functions in Kotlin and have tried the various <code>filter</code> and <code>filterValues</code> <code>filterNot</code> on the map like so:</p>\n\n<pre><code>val input = mapOf(Pair(\"first\",null))\nval filtered: Map&lt;String,Any&gt; = input.filter { it.value!=null }\n</code></pre>\n\n<p>it also fails to compile with any of these</p>\n\n<pre><code>input.filterValues { it!=null }\ninput.filterNot { it.value==null }\ninput.filterNot { it.value is Nothing }\n</code></pre>\n\n<p>The closest I can seem to get is applying multiple steps or having an Unchecked cast warning. I would have thought that filtering the values to be <code>!=null</code> would suffice. My only other thought is that it's due to the generics?</p>\n"}, {"tags": ["enums", "kotlin"], "answers": [{"tags": [], "owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "is_accepted": true, "score": 11, "last_activity_date": 1487373842, "last_edit_date": 1487373842, "creation_date": 1487372020, "answer_id": 42308768, "question_id": 42308580, "link": "https://stackoverflow.com/questions/42308580/kotlin-extension-for-next-enum-value-without-reflection/42308768#42308768", "title": "Kotlin extension for next Enum value without reflection", "body": "<p>You can do that without reflection in Kotlin 1.1 (currently, you can try <a href=\"https://blog.jetbrains.com/kotlin/2017/02/kotlin-1-1-release-candidate-is-here/\" rel=\"noreferrer\">the 1.1 RC build</a>) using the <a href=\"https://kotlinlang.org/docs/reference/whatsnew11.html#generic-enum-value-access\" rel=\"noreferrer\"><code>enumValues&lt;T&gt;()</code></a>, which does not use the reflection inside, because it is inlined at call sites instead, and the corresponding <code>enum</code> type is placed in the resulting code at compile-time. Example:</p>\n\n<pre><code>inline fun &lt;reified T: Enum&lt;T&gt;&gt; T.next(): T {\n    val values = enumValues&lt;T&gt;()\n    val nextOrdinal = (ordinal + 1) % values.size\n    return values[nextOrdinal]\n}\n</code></pre>\n\n<p><sup><a href=\"http://try.kotlinlang.org/#/UserProjects/65pvv8ejnl7ufkqafd8alaje1b/b6vva175vvkm9f36cmbg2p8sin\" rel=\"noreferrer\">(demo of this code)</a>  | The <code>inline</code> and <code>reified</code> are required because <code>enumValues&lt;T&gt;()</code> has <a href=\"https://kotlinlang.org/docs/reference/inline-functions.html#reified-type-parameters\" rel=\"noreferrer\"><code>reified T</code></a>.</sup> </p>\n\n<p>An alternative that works with Kotlin 1.0.6 (but still uses <a href=\"https://docs.oracle.com/javase/7/docs/api/java/lang/Enum.html#getDeclaringClass()\" rel=\"noreferrer\"><code>getDeclaringClass()</code></a> from Java reflection):</p>\n\n<pre><code>fun &lt;T: Enum&lt;T&gt;&gt; T.next(): T {\n    val values = declaringClass.enumConstants\n    val nextOrdinal = (ordinal + 1) % values.size\n    return values[nextOrdinal]\n}\n</code></pre>\n"}], "owner": {"reputation": 480, "user_id": 4198170, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Rg8HcQrpIIY/AAAAAAAAAAI/AAAAAAAACD8/oih8PPkarOA/photo.jpg?sz=128", "display_name": "Tobse", "link": "https://stackoverflow.com/users/4198170/tobse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3042, "favorite_count": 0, "accepted_answer_id": 42308768, "answer_count": 1, "score": 3, "last_activity_date": 1487373842, "creation_date": 1487371114, "question_id": 42308580, "link": "https://stackoverflow.com/questions/42308580/kotlin-extension-for-next-enum-value-without-reflection", "title": "Kotlin extension for next Enum value without reflection", "body": "<p>I wrote a Kotlin extension which adds <code>next()</code> for enum values. But is there an better way to do that?</p>\n\n<pre><code>fun &lt;T : Enum&lt;*&gt;&gt; T.next(): T {\n    val values = this::class.java.getEnumConstants()\n    return if (this.ordinal &lt; values.size - 1) \n            values[this.ordinal + 1] \n        else \n            values[0]\n}\nenum class Color {Red, Yellow, Green}\nColor.Red.next() //Yellow\n</code></pre>\n\n<ol>\n<li>Can I achieve that without reflections?</li>\n<li>If not, how to do that with Kotlins reflection?</li>\n</ol>\n\n<p>The Idea is to iterate from enum value to the next. But only for a specific value, not for whole enum <code>values()</code> list. The thing I want to prevent is to add the following to every enum type: </p>\n\n<pre><code>fun next() = if (this.ordinal == Color.values().size - 1) \n        Color.values()[0] \n    else \n        Color.values()[this.ordinal + 1]\n</code></pre>\n"}, {"tags": ["java", "jpa", "gradle", "spring-boot", "kotlin"], "comments": [{"owner": {"reputation": 8022, "user_id": 1068649, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5e44a15ecb4ee475548612da03c81f33?s=128&d=identicon&r=PG", "display_name": "James Bassett", "link": "https://stackoverflow.com/users/1068649/james-bassett"}, "edited": false, "score": 0, "creation_date": 1487374131, "post_id": 42306386, "comment_id": 71773109, "body": "FYI you don&#39;t have to generate a meta-model if you don&#39;t want to - see <a href=\"https://github.com/consoleau/kotlin-jpa-specification-dsl\" rel=\"nofollow noreferrer\">kotlin-jpa-specification-dsl</a>"}, {"owner": {"reputation": 1801, "user_id": 1522378, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d3e96719e19637a23b5edf4e326c302c?s=128&d=identicon&r=PG", "display_name": "Exia", "link": "https://stackoverflow.com/users/1522378/exia"}, "reply_to_user": {"reputation": 8022, "user_id": 1068649, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5e44a15ecb4ee475548612da03c81f33?s=128&d=identicon&r=PG", "display_name": "James Bassett", "link": "https://stackoverflow.com/users/1068649/james-bassett"}, "edited": false, "score": 0, "creation_date": 1487389977, "post_id": 42306386, "comment_id": 71776408, "body": "The meta-model is used in my other java code."}], "answers": [{"tags": [], "owner": {"reputation": 76, "user_id": 8254465, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LxaI8cdfwoU/AAAAAAAAAAI/AAAAAAAAABE/oIJ2pOV4ZZY/photo.jpg?sz=128", "display_name": "Frans van Buul", "link": "https://stackoverflow.com/users/8254465/frans-van-buul"}, "is_accepted": false, "score": 0, "last_activity_date": 1518255224, "creation_date": 1518255224, "answer_id": 48719271, "question_id": 42306386, "link": "https://stackoverflow.com/questions/42306386/how-to-add-kotlin-class-to-gradle-javacompile-task/48719271#48719271", "title": "How to add kotlin class to gradle JavaCompile task", "body": "<p>The Hibernate meta-model generator is implemented as a JSR 269 annotation processor. When using Kotlin, you'll need to enable annotation processing explicitly by <a href=\"https://kotlinlang.org/docs/reference/kapt.html\" rel=\"nofollow noreferrer\">applying the kapt compiler plugin</a>. When you do that, you'll find that the meta-model gets generated for Kotlin entities.</p>\n"}], "owner": {"reputation": 1801, "user_id": 1522378, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d3e96719e19637a23b5edf4e326c302c?s=128&d=identicon&r=PG", "display_name": "Exia", "link": "https://stackoverflow.com/users/1522378/exia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 527, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1518255224, "creation_date": 1487361565, "last_edit_date": 1487527184, "question_id": 42306386, "link": "https://stackoverflow.com/questions/42306386/how-to-add-kotlin-class-to-gradle-javacompile-task", "title": "How to add kotlin class to gradle JavaCompile task", "body": "<p>I use kotlin and java with spring boot to develop my project.\nMy build tool is gradle, a task is defined as follows:</p>\n\n<pre><code>configurations {\n  providedRuntime\n  jpametamodel\n}\n\ndependencies {\n    jpametamodel ('org.hibernate:hibernate-jpamodelgen:4.3.11.Final')\n}\n\ntask generateMetaModel(type: JavaCompile, group: 'build', description: 'metamodel generate') {\n\n   source = sourceSets.main.java\n   classpath = configurations.compile + configurations.jpametamodel\n   options.compilerArgs = [\"-proc:only\"]\n   destinationDir = sourceSets.generated.java.srcDirs.iterator().next()\n\n  doFirst {\n      delete(sourceSets.generated.java.srcDirs)\n  }\n}\n</code></pre>\n\n<p>This task works with out kotlin class, but if I add kotlin class, the task cannot work by throw the following errors:</p>\n\n<pre><code>Hibernate JPA 2 Static-Metamodel Generator 4.3.11.Final\n/.../src/main/java/com/app/web/rest/UserResource.java:18: \nCannot find .....\nimport com.app.web.rest.dto.SimpleUser;\n                         ^\n Symbol:   Class SimpleUser\n Position: Package com.app.web.rest.dto\n</code></pre>\n\n<p>The SimpleUser is defined in kotlin file:</p>\n\n<pre><code> SimpleUser.kt\n data class SimpleUser(val str:String)\n</code></pre>\n"}, {"tags": ["java", "android", "kotlin"], "answers": [{"comments": [{"owner": {"reputation": 490, "user_id": 2659925, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wLNh1.jpg?s=128&g=1", "display_name": "Skullper", "link": "https://stackoverflow.com/users/2659925/skullper"}, "edited": false, "score": 0, "creation_date": 1487320891, "post_id": 42293079, "comment_id": 71741538, "body": "Thx. It should be working but not in my situation. I need:  <code>val tabs = ArrayList&lt;BaseFragment&lt;BasePresenter&gt;&gt;() tabs.add(instanceOf&lt;ProfileFragment&gt;())</code> Maybe I&#39;m doing something wrong in my base architecture?"}, {"owner": {"reputation": 6473, "user_id": 2660462, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/e7866e763430b8848f14ffdacb61b99f?s=128&d=identicon&r=PG", "display_name": "Lukas Lechner", "link": "https://stackoverflow.com/users/2660462/lukas-lechner"}, "reply_to_user": {"reputation": 490, "user_id": 2659925, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wLNh1.jpg?s=128&g=1", "display_name": "Skullper", "link": "https://stackoverflow.com/users/2659925/skullper"}, "edited": false, "score": 0, "creation_date": 1487321584, "post_id": 42293079, "comment_id": 71741912, "body": "In kotlin you just use <code>()</code> to create instances, so <code>tabs.add(ProfileFragment())</code> should work"}, {"owner": {"reputation": 19114, "user_id": 4137489, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4d6e58042c9b1e87df5f5df4796b389f?s=128&d=identicon&r=PG&f=1", "display_name": "marstran", "link": "https://stackoverflow.com/users/4137489/marstran"}, "reply_to_user": {"reputation": 490, "user_id": 2659925, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wLNh1.jpg?s=128&g=1", "display_name": "Skullper", "link": "https://stackoverflow.com/users/2659925/skullper"}, "edited": false, "score": 0, "creation_date": 1487322837, "post_id": 42293079, "comment_id": 71742720, "body": "@PavliukR You should specify the complete type of <code>BaseFragment</code> in your Java code too by the way. It is a raw type in the example you gave. It should give you a compiler warning."}, {"owner": {"reputation": 490, "user_id": 2659925, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wLNh1.jpg?s=128&g=1", "display_name": "Skullper", "link": "https://stackoverflow.com/users/2659925/skullper"}, "edited": false, "score": 0, "creation_date": 1487322884, "post_id": 42293079, "comment_id": 71742758, "body": "I know. It&#39;s an extension for me:  <code>inline fun &lt;reified T : Fragment&gt; instanceOf(vararg params: Pair&lt;String, Any&gt;)         = T::class.java.newInstance().apply {     arguments = bundleOf(*params) }</code> That&#39;s why I use that line of code"}, {"owner": {"reputation": 490, "user_id": 2659925, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wLNh1.jpg?s=128&g=1", "display_name": "Skullper", "link": "https://stackoverflow.com/users/2659925/skullper"}, "reply_to_user": {"reputation": 19114, "user_id": 4137489, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4d6e58042c9b1e87df5f5df4796b389f?s=128&d=identicon&r=PG&f=1", "display_name": "marstran", "link": "https://stackoverflow.com/users/4137489/marstran"}, "edited": false, "score": 0, "creation_date": 1487323028, "post_id": 42293079, "comment_id": 71742869, "body": "@marstran What do you mean: the complete type of BaseFragment As I know kotlin do not support raw types."}, {"owner": {"reputation": 19114, "user_id": 4137489, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4d6e58042c9b1e87df5f5df4796b389f?s=128&d=identicon&r=PG&f=1", "display_name": "marstran", "link": "https://stackoverflow.com/users/4137489/marstran"}, "reply_to_user": {"reputation": 490, "user_id": 2659925, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wLNh1.jpg?s=128&g=1", "display_name": "Skullper", "link": "https://stackoverflow.com/users/2659925/skullper"}, "edited": false, "score": 0, "creation_date": 1487323158, "post_id": 42293079, "comment_id": 71742970, "body": "@PavliukR I just mean that your Java code should be this: <code>private ArrayList&lt;BaseFragment&lt;SomePresenterType&gt;&gt; fragments;</code>. No, Kotlin does not support raw types, but you shouldn&#39;t use raw types in Java either."}, {"owner": {"reputation": 490, "user_id": 2659925, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wLNh1.jpg?s=128&g=1", "display_name": "Skullper", "link": "https://stackoverflow.com/users/2659925/skullper"}, "reply_to_user": {"reputation": 19114, "user_id": 4137489, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4d6e58042c9b1e87df5f5df4796b389f?s=128&d=identicon&r=PG&f=1", "display_name": "marstran", "link": "https://stackoverflow.com/users/4137489/marstran"}, "edited": false, "score": 0, "creation_date": 1487323338, "post_id": 42293079, "comment_id": 71743119, "body": "@marstran I understand. Thx"}, {"owner": {"reputation": 490, "user_id": 2659925, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wLNh1.jpg?s=128&g=1", "display_name": "Skullper", "link": "https://stackoverflow.com/users/2659925/skullper"}, "edited": false, "score": 0, "creation_date": 1487323638, "post_id": 42293079, "comment_id": 71743360, "body": "@lukle Ok, I think your answer is right, but it&#39;s not working for my case. But thank you"}], "tags": [], "owner": {"reputation": 6473, "user_id": 2660462, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/e7866e763430b8848f14ffdacb61b99f?s=128&d=identicon&r=PG", "display_name": "Lukas Lechner", "link": "https://stackoverflow.com/users/2660462/lukas-lechner"}, "is_accepted": true, "score": 2, "last_activity_date": 1487320582, "creation_date": 1487320582, "answer_id": 42293079, "question_id": 42292942, "link": "https://stackoverflow.com/questions/42292942/generics-and-abstract-class-in-kotlin/42293079#42293079", "title": "Generics and abstract class in Kotlin", "body": "<p>You need to specify a type for your <code>T</code></p>\n\n<pre><code>val tabs = ArrayList&lt;BaseFragment&lt;SomePresenterType&gt;&gt;()\n</code></pre>\n"}], "owner": {"reputation": 490, "user_id": 2659925, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wLNh1.jpg?s=128&g=1", "display_name": "Skullper", "link": "https://stackoverflow.com/users/2659925/skullper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1695, "favorite_count": 0, "accepted_answer_id": 42293079, "answer_count": 1, "score": 1, "last_activity_date": 1487320631, "creation_date": 1487320151, "last_edit_date": 1487320631, "question_id": 42292942, "link": "https://stackoverflow.com/questions/42292942/generics-and-abstract-class-in-kotlin", "title": "Generics and abstract class in Kotlin", "body": "<p>I have a base abstract class:</p>\n\n<pre><code>abstract class BaseFragment&lt;T : BasePresenter&gt; : Fragment(){\n\n    protected var presenter : T? = null\n\n    abstract fun providePresenter() : T\n\n    abstract fun getLayoutId() : Int\n\n    abstract fun onCreate()\n\n    override fun onCreateView(inflater: LayoutInflater?, container: ViewGroup?, savedInstanceState: Bundle?): View? {\n        val root = inflater?.inflate(getLayoutId(), container, false)\n        presenter = providePresenter()\n        return root\n    }\n\n    override fun onViewCreated(view: View?, savedInstanceState: Bundle?) {\n        onCreate()\n    }\n\n}\n</code></pre>\n\n<p>My code in JAVA:</p>\n\n<pre><code>//JAVA\n\nprivate ArrayList&lt;BaseFragment&gt; fragments;\n</code></pre>\n\n<p>How can I use it Kotlin? Code bellow not working</p>\n\n<pre><code>//Kotlin\n\nval tabs = ArrayList&lt;BaseFragment&gt;() //error: One type argument expected for class BaseFragment&lt;T : BasePresenter&gt; : Fragment\n</code></pre>\n"}, {"tags": ["generics", "compiler-errors", "kotlin"], "answers": [{"tags": [], "owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "is_accepted": true, "score": 3, "last_activity_date": 1487328235, "last_edit_date": 1487328235, "creation_date": 1487271004, "answer_id": 42282284, "question_id": 42282283, "link": "https://stackoverflow.com/questions/42282283/how-to-prohibit-function-calls-with-a-certain-subtype-of-a-parameter-type/42282284#42282284", "title": "How to prohibit function calls with a certain subtype of a parameter type?", "body": "<p>There is a way to prohibit the calls for a certain generic type argument: the deprecation. Using the <a href=\"https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-deprecated/\" rel=\"nofollow noreferrer\"><code>@Deprecated</code></a> annotation in this case looks quite clumsy, but it solves the problem (*).</p>\n\n<p>You can define an overload of <code>bar(...)</code> with a more concrete type and deprecate the overload with level <a href=\"https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-deprecation-level/index.html\" rel=\"nofollow noreferrer\"><code>DeprecationLevel.ERROR</code></a>:</p>\n\n<pre><code>@Deprecated(\"bar should not be called with Qux\", level = DeprecationLevel.ERROR)\nfun &lt;T : Qux&gt; bar(t: T) = bar(t as Foo)\n</code></pre>\n\n<p>After that, when a <code>bar(...)</code> call is resolved for a <code>Qux</code> argument, the deprecated overload will take precedence because it features more concrete types. Therefore the calls will produce a compile-time error:</p>\n\n<pre><code>bar(Qux())\n^ Using 'bar(T): Unit' is an error. bar should not be called with Qux\n</code></pre>\n\n<p><sup>(*) Note, however, that <strong>this will only work for <code>Qux</code> as static type</strong> (the one used for the call resolution), and the function can still be called as <code>bar(Qux() as Foo)</code>. Quite expectedly, you cannot produce a compile-time error if the argument type is only known at runtime.</sup></p>\n\n<hr>\n\n<p>The same approach can be used to produce errors or warnings for functions that should only react on <code>null</code>s in some way, so that calling them with a not-null type makes no sense:</p>\n\n<pre><code>fun checkNotNull(x: Any?) = x ?: throw IllegalStateException(\"Should not be null\")\n\n@Deprecated(\"It is meaningless with a not-null argument.\", DeprecationLevel.WARNING)\n@JvmName(\"checkNotNull--notNullArgument\")\nfun checkNotNull(x: Any) = checkNotNull(x as Any?)\n</code></pre>\n"}], "owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 42282284, "answer_count": 1, "score": 1, "last_activity_date": 1487328235, "creation_date": 1487271004, "last_edit_date": 1487271412, "question_id": 42282283, "link": "https://stackoverflow.com/questions/42282283/how-to-prohibit-function-calls-with-a-certain-subtype-of-a-parameter-type", "title": "How to prohibit function calls with a certain subtype of a parameter type?", "body": "<p>Suppose I have a generic function:</p>\n\n<pre><code>fun &lt;T: Foo&gt; bar(t: T) { ... }\n</code></pre>\n\n<p>Then, later at some point in time, I decided that it is meaningless (or even erroneous) to call <code>bar(...)</code> with <code>T</code> specialized as <code>Qux</code>, which is, of course, one of the <code>Foo</code>'s subtypes. But I have a strong reason not to change the classes hierarchy (e.g. I don't have access to that code).</p>\n\n<p>Is there a way to prohibit the calls to <code>bar(t)</code> with <code>T</code> specialized as <code>Qux</code>?</p>\n"}, {"tags": ["android", "lambda", "memory-leaks", "kotlin"], "comments": [{"owner": {"reputation": 1078, "user_id": 1045135, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5acc14131a09fcafec2b1dbe8361ad8d?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/1045135/andrew"}, "edited": false, "score": 3, "creation_date": 1504236869, "post_id": 42271208, "comment_id": 78945697, "body": "So does lambdas capture enclosing object when it doesn&#39;t use any methord or field of enclosing object? They are different points of: <a href=\"https://discuss.kotlinlang.org/t/function-literals-and-reference-to-enclosing-class/416\" rel=\"nofollow noreferrer\">discuss.kotlinlang.org/t/&hellip;</a> <a href=\"https://discuss.kotlinlang.org/t/lambda-expression-or-anonymous-function-keep-an-implicit-reference-of-the-enclosing-class/1429\" rel=\"nofollow noreferrer\">discuss.kotlinlang.org/t/&hellip;</a>"}, {"owner": {"reputation": 4580, "user_id": 662618, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/485a36e2fb0e89238446e0789d7094a9?s=128&d=identicon&r=PG", "display_name": "loloof64", "link": "https://stackoverflow.com/users/662618/loloof64"}, "reply_to_user": {"reputation": 1078, "user_id": 1045135, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5acc14131a09fcafec2b1dbe8361ad8d?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/1045135/andrew"}, "edited": false, "score": 0, "creation_date": 1504244641, "post_id": 42271208, "comment_id": 78947668, "body": "Thank you very much. Gonna listen to them soon :)"}, {"owner": {"reputation": 4580, "user_id": 662618, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/485a36e2fb0e89238446e0789d7094a9?s=128&d=identicon&r=PG", "display_name": "loloof64", "link": "https://stackoverflow.com/users/662618/loloof64"}, "reply_to_user": {"reputation": 1078, "user_id": 1045135, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5acc14131a09fcafec2b1dbe8361ad8d?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/1045135/andrew"}, "edited": false, "score": 0, "creation_date": 1504331197, "post_id": 42271208, "comment_id": 78982092, "body": "In fact no so useful fact. Anyway thank you"}], "answers": [{"comments": [{"owner": {"reputation": 4580, "user_id": 662618, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/485a36e2fb0e89238446e0789d7094a9?s=128&d=identicon&r=PG", "display_name": "loloof64", "link": "https://stackoverflow.com/users/662618/loloof64"}, "edited": false, "score": 0, "creation_date": 1487244213, "post_id": 42272484, "comment_id": 71701060, "body": "Thank you. You confirm the impression I got when &quot;profiling&quot; the application : I did not notice any memory problem. Just the fact that the GC is called from time to time."}, {"owner": {"reputation": 4580, "user_id": 662618, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/485a36e2fb0e89238446e0789d7094a9?s=128&d=identicon&r=PG", "display_name": "loloof64", "link": "https://stackoverflow.com/users/662618/loloof64"}, "edited": false, "score": 0, "creation_date": 1487244533, "post_id": 42272484, "comment_id": 71701273, "body": "But, as another confusion point for me, let&#39;s say that in the positive button callback I can add (without compilation error) the following line <code>explorerRecyclerView.invalidate()</code>, where explorerRecyclerView is a member of my MainActivity class, indirectly host of the lambda. So, the activity Garbage Collection could be prevented, right ?"}, {"owner": {"reputation": 25774, "user_id": 885028, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/xJkDj.jpg?s=128&g=1", "display_name": "aga", "link": "https://stackoverflow.com/users/885028/aga"}, "reply_to_user": {"reputation": 4580, "user_id": 662618, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/485a36e2fb0e89238446e0789d7094a9?s=128&d=identicon&r=PG", "display_name": "loloof64", "link": "https://stackoverflow.com/users/662618/loloof64"}, "edited": false, "score": 2, "creation_date": 1487245137, "post_id": 42272484, "comment_id": 71701743, "body": "Well, it&#39;s basically the same as in Java: will the activity be garbage-collected when the click listener of the Dialog is doing some work (assuming this click listener uses some of the activity methods)? No. Will it be garbage-collected once the click listener has performed its duties and the activity is finished? Yes."}, {"owner": {"reputation": 1867, "user_id": 3848334, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/XyhMu.jpg?s=128&g=1", "display_name": "David", "link": "https://stackoverflow.com/users/3848334/david"}, "edited": false, "score": 0, "creation_date": 1590487002, "post_id": 42272484, "comment_id": 109690650, "body": "@aga Yes Because of single-threaded(Main thread) architecture of android view system."}], "tags": [], "owner": {"reputation": 25774, "user_id": 885028, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/xJkDj.jpg?s=128&g=1", "display_name": "aga", "link": "https://stackoverflow.com/users/885028/aga"}, "is_accepted": false, "score": 15, "last_activity_date": 1487244981, "last_edit_date": 1487244981, "creation_date": 1487244002, "answer_id": 42272484, "question_id": 42271208, "link": "https://stackoverflow.com/questions/42271208/kotlin-safe-lambdas-no-memory-leak/42272484#42272484", "title": "Kotlin : safe lambdas (no memory leak)?", "body": "<p>Memory leaks happen when some object which should be removed because it isn't needed anymore can not be removed because something which has a longer lifetime has a reference to this object. The simplest example is storing the reference to the <code>Activity</code> in the <code>static</code> variable (I'm talking from the Java perspective, but it's similar in Kotlin): after the user has clicked on 'Back' button the <code>Activity</code> is not needed anymore, but it will be kept in memory nevertheless - because some static variable still points to this activity.<br>\nNow, in your example you are not assigning your <code>Activity</code> to some <code>static</code> variable, there're no Kotlin's <code>object</code>s involved which could keep your <code>Activity</code> from being garbage-collected - all the objects involved in your code have roughly the same lifetime, which means there will be no memory leaks.</p>\n\n<p>P.S. I've refreshed my memories on the Kotlin's implementation of the lambdas: in the case of the negative button click handler you aren't referencing the outer scope, thus compiler will create single instance of the click listener which will be reused across all the clicks on this button. In the case of the positive button click listener, you're referencing the outer scope (<code>this@MainActivity</code>), so in this case Kotlin will be creating a new instance of the anonymous class each time you create a dialog (and this instance will have the reference to the outer class, <code>MainActivity</code>), so the behavior is exactly the same as if you had written this code in Java.</p>\n"}, {"comments": [{"owner": {"reputation": 4580, "user_id": 662618, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/485a36e2fb0e89238446e0789d7094a9?s=128&d=identicon&r=PG", "display_name": "loloof64", "link": "https://stackoverflow.com/users/662618/loloof64"}, "edited": false, "score": 3, "creation_date": 1487253012, "post_id": 42275638, "comment_id": 71707656, "body": "Indeed I meant Anonymous classes. Yes, Kotlin shoud really have implemented the weak reference capture option for lambda, really agree with that. So I see the point, I need to be as carefull with Kotlin lambda than with Java inner/anonymous classes. So kotlin lambdas are not safe, I should use static inner class and with WeakReferences to any View reference inside them."}, {"owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "edited": false, "score": 0, "creation_date": 1487417953, "post_id": 42275638, "comment_id": 71783029, "body": "WeakReferences has its share of problems, and less obvious than memory leaks. Also my guess is that could reimplement what you want in Kotlin so that your lambdas would use weakReference (with a little help of <code>crossinline</code>)"}, {"owner": {"reputation": 1113, "user_id": 6113810, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-llqbl5KwhLI/AAAAAAAAAAI/AAAAAAAAABQ/VoRh5qAwe_U/photo.jpg?sz=128", "display_name": "Stan Mots", "link": "https://stackoverflow.com/users/6113810/stan-mots"}, "edited": false, "score": 0, "creation_date": 1487419180, "post_id": 42275638, "comment_id": 71783427, "body": "Of course, weak references sometimes can cause problems too. But, in my opinion, it&#39;s always better to have a choice. Regarding <code>crossinline</code>, correct me if I&#39;m wrong, but if we are using third-party library it is impossible to enforce inline behavior from the calling side, right?"}, {"owner": {"reputation": 14732, "user_id": 1501222, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/a40764e17b8f967052f9600079692f16?s=128&d=identicon&r=PG", "display_name": "BeniBela", "link": "https://stackoverflow.com/users/1501222/benibela"}, "edited": false, "score": 1, "creation_date": 1545004348, "post_id": 42275638, "comment_id": 94463595, "body": "That is hard to understand. So when the lambda captures, it creates new objects and they presumably contain references to the variables used in the lambda. Do these objects also contain  a reference to <code>this</code> of the outer class, if <code>this</code> is never used in the lambda, or only if <code>this</code> is used?"}, {"owner": {"reputation": 1113, "user_id": 6113810, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-llqbl5KwhLI/AAAAAAAAAAI/AAAAAAAAABQ/VoRh5qAwe_U/photo.jpg?sz=128", "display_name": "Stan Mots", "link": "https://stackoverflow.com/users/6113810/stan-mots"}, "reply_to_user": {"reputation": 14732, "user_id": 1501222, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/a40764e17b8f967052f9600079692f16?s=128&d=identicon&r=PG", "display_name": "BeniBela", "link": "https://stackoverflow.com/users/1501222/benibela"}, "edited": false, "score": 0, "creation_date": 1545082080, "post_id": 42275638, "comment_id": 94495153, "body": "@BeniBela The lambda will capture a reference to <code>this</code> only if you are using properties and/or calling methods of <code>this</code> object inside lambda&#39;s body."}, {"owner": {"reputation": 1853, "user_id": 1388943, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/26584dd4a526d6f441abef793bfb0dcc?s=128&d=identicon&r=PG", "display_name": "stdout", "link": "https://stackoverflow.com/users/1388943/stdout"}, "edited": false, "score": 0, "creation_date": 1552733208, "post_id": 42275638, "comment_id": 97129247, "body": "@StanMots As far as I can see, it has this reference regardless you use a variable or method of the enclosing class. If you use it though, you just have a new instance instead a singleton one."}, {"owner": {"reputation": 1853, "user_id": 1388943, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/26584dd4a526d6f441abef793bfb0dcc?s=128&d=identicon&r=PG", "display_name": "stdout", "link": "https://stackoverflow.com/users/1388943/stdout"}, "edited": false, "score": 0, "creation_date": 1552734429, "post_id": 42275638, "comment_id": 97129543, "body": "Also, I think closures are only created in certain situations like if you return a function type or if you pass it into another function. When it&#39;s only a parameter, there should be nothing to worry about in terms of leaking things. inlining &quot;boils away&quot; the problem of object creation (thus the runtime overhead) - nothing much to do with leaking. I would be glad if someone approves this though :)."}, {"owner": {"reputation": 2836, "user_id": 1259924, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0cc57bb88e4314676b158471aa4d94bd?s=128&d=identicon&r=PG", "display_name": "Greg Brown", "link": "https://stackoverflow.com/users/1259924/greg-brown"}, "edited": false, "score": 1, "creation_date": 1554459526, "post_id": 42275638, "comment_id": 97769533, "body": "Maybe I&#39;m just confused because I&#39;m used to Swift&#39;s behavior, but I don&#39;t feel like Mike Hearn&#39;s response fully answers the question. In Swift, self is always captured unless it is declared as [weak self]. In Java (from your link), &quot;lambdas that do not capture members from the enclosing instance do not hold a reference to it&quot;. Mike Hearn implies that Kotlin&#39;s behavior is similar to Java, but it isn&#39;t completely clear. &quot;If the lambda doesn&#39;t capture&quot; is still somewhat ambiguous. What determines if the lambda will capture?"}, {"owner": {"reputation": 2836, "user_id": 1259924, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0cc57bb88e4314676b158471aa4d94bd?s=128&d=identicon&r=PG", "display_name": "Greg Brown", "link": "https://stackoverflow.com/users/1259924/greg-brown"}, "edited": false, "score": 1, "creation_date": 1554459752, "post_id": 42275638, "comment_id": 97769645, "body": "@StanMots You mention that &quot;the lambda will capture a reference to this only if you are using properties and/or calling methods of this object inside lambda&#39;s body&quot;. Can you share anything that specifically documents this behavior?"}], "tags": [], "owner": {"reputation": 1113, "user_id": 6113810, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-llqbl5KwhLI/AAAAAAAAAAI/AAAAAAAAABQ/VoRh5qAwe_U/photo.jpg?sz=128", "display_name": "Stan Mots", "link": "https://stackoverflow.com/users/6113810/stan-mots"}, "is_accepted": true, "score": 39, "last_activity_date": 1487518577, "last_edit_date": 1487518577, "creation_date": 1487252531, "answer_id": 42275638, "question_id": 42271208, "link": "https://stackoverflow.com/questions/42271208/kotlin-safe-lambdas-no-memory-leak/42275638#42275638", "title": "Kotlin : safe lambdas (no memory leak)?", "body": "<p><strong>Edit (February 19, 2017):</strong> I received a very comprehensive <a href=\"https://discuss.kotlinlang.org/t/lambdas-and-implicit-references-to-the-instance-of-the-enclosing-class/2288/2?u=storix\" rel=\"noreferrer\">reply</a> from Mike Hearn regarding this issue:</p>\n\n<blockquote>\n  <p>Like in Java, what happens in Kotlin varies in different cases.</p>\n  \n  <ul>\n  <li>If the lambda is passed to an inline function and isn't marked noinline, then the whole thing boils away and no additional classes or\n  objects are created.</li>\n  <li>If the lambda doesn't capture, then it'll be emitted as a singleton class whose instance is reused again and again (one class+one object\n  allocation).</li>\n  <li>If the lambda captures then a new object is created each time the lambda is used.</li>\n  </ul>\n  \n  <p>Thus it is similar behaviour to Java except for the inlining case\n  where it's even cheaper. This efficient approach to encoding lambdas\n  is one reason why functional programming in Kotlin is more attractive\n  than in Java.</p>\n</blockquote>\n\n<hr>\n\n<p><strong>Edit (February 17, 2017):</strong> I've posted a question regarding this topic in the <a href=\"https://discuss.kotlinlang.org/t/lambdas-and-implicit-references-to-the-instance-of-the-enclosing-class/2288\" rel=\"noreferrer\">Kotlin discussions</a>. Maybe Kotlin engineers will bring something new to the table.</p>\n\n<hr>\n\n<blockquote>\n  <p>are kotlin lambdas simply converted to Java Anonymous functions ?</p>\n</blockquote>\n\n<p>I was asking this question myself (one simple correction here: these are called <em>Anonymous Classes</em>, not functions). There is no clear answer in the <code>Koltin</code> documentation. They just <a href=\"https://kotlinlang.org/docs/reference/inline-functions.html\" rel=\"noreferrer\">state</a> that</p>\n\n<blockquote>\n  <p>Using higher-order functions imposes certain runtime penalties: each\n  function is an object, and it captures a closure, i.e. those variables\n  that are accessed in the body of the function.</p>\n</blockquote>\n\n<p>It is a bit confusing what they mean by <em>variables that are accessed in the body of the function</em>. Is the reference to the instance of the enclosing class also counted?</p>\n\n<p>I've seen the topic you are referencing in your question but it seems it is outdated as for now. I've found more up-to-date information <a href=\"https://discuss.kotlinlang.org/t/lambda-expression-or-anonymous-function-keep-an-implicit-reference-of-the-enclosing-class/1429\" rel=\"noreferrer\">here</a>:</p>\n\n<blockquote>\n  <p>Lambda expression or anonymous function <strong>keep an implicit reference</strong> of\n  the enclosing class</p>\n</blockquote>\n\n<p>So, unfortunately, it seems that Kotlin's lambdas have the same problems as Java's Anonymous Inner Classes.</p>\n\n<h2>Why Anonymous Inner Classes are bad?</h2>\n\n<p>From the <code>Java</code> <a href=\"https://docs.oracle.com/javase/specs/jls/se7/html/jls-8.html\" rel=\"noreferrer\">specs</a>:</p>\n\n<blockquote>\n  <p>An instance i of a direct inner class C of a class O is associated\n  with an instance of O, known as the immediately enclosing instance of\n  i. The immediately enclosing instance of an object, if any, is\n  determined when the object is created</p>\n</blockquote>\n\n<p>What this means is that the anonymous class will always have an <strong>implicit</strong> reference to the instance of the enclosing class. And since the reference is implicit there is no way to get rid of it.</p>\n\n<p>Look at the trivial example</p>\n\n<pre><code>public class YourActivity extends Activity {\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        new Thread(new Runnable() {\n                 // the inner class will keep the implicit reference to the outer activity\n                @Override\n                public void run() {\n                 // long-running task\n                }\n        }).start();\n   }\n}\n</code></pre>\n\n<p>As you can see, in this case there will be the memory leak until the long-running task is executed. One workaround for this is to use static nested class.</p>\n\n<p>Since <code>Kotlin's</code> <strong>non-inlined</strong> lambdas hold the reference to the instance of the enclosing class they have similar issues regarding memory leaks.</p>\n\n<h2>Bonus: Quick Comparison With Other Lambda Implementations</h2>\n\n<h2>Java 8 Lambdas</h2>\n\n<p><strong>Syntax:</strong> </p>\n\n<ul>\n<li><p>Declare SAM (single abstract method) interface</p>\n\n<pre><code>interface Runnable { void run(); }\n</code></pre></li>\n<li><p>Use this interface as a type for a lambda</p>\n\n<pre><code>public void canTakeLambda(Runnable r) { ... }\n</code></pre></li>\n<li><p>Pass your lambda</p>\n\n<pre><code>canTakeLambda(() -&gt; System.out.println(\"Do work in lambda...\"));\n</code></pre></li>\n</ul>\n\n<p><strong>Memory leak issues:</strong> As stated in <a href=\"http://cr.openjdk.java.net/~briangoetz/lambda/lambda-state-final.html\" rel=\"noreferrer\">specs</a>:</p>\n\n<blockquote>\n  <p>References to this -- including implicit references through\n  unqualified field references or method invocations -- are,\n  essentially, references to a final local variable. Lambda bodies that\n  contain such references capture the appropriate instance of this. <strong>In\n  other cases, no reference to this is retained</strong> by the object.</p>\n</blockquote>\n\n<p>Simply put, if you do not use any fields / methods from the enclosing class there is no implicit reference to <code>this</code> as in the case of anonymous classes. </p>\n\n<h2>Retrolambda</h2>\n\n<p>From the <a href=\"https://github.com/orfjackal/retrolambda\" rel=\"noreferrer\">docs</a></p>\n\n<blockquote>\n  <p>Lambda expressions are backported by converting them to anonymous\n  inner classes. This includes the optimization of using a <strong>singleton\n  instance for stateless lambda</strong> expressions to avoid repeated object\n  allocation.</p>\n</blockquote>\n\n<p>I guess, it's self-explanatory.</p>\n\n<h2>Apple's Swift</h2>\n\n<p><strong>Syntax:</strong> </p>\n\n<ul>\n<li><p>Declaration is similar to Kotlin, in Swift lambdas are called closures:</p>\n\n<pre><code>func someFunctionThatTakesAClosure(closure: (String) -&gt; Void) {}\n</code></pre></li>\n<li><p>Pass the closure</p>\n\n<pre><code>someFunctionThatTakesAClosure { print($0) }\n</code></pre>\n\n<p>Here, <code>$0</code> refer to the closure\u2019s first <code>String</code> argument. This corresponds to <code>it</code> in Kotlin. Note: Unlike Kotlin, in Swift we can refer also to the other arguments like <code>$1</code>, <code>$2</code> etc.</p></li>\n</ul>\n\n<p><strong>Memory leak issues:</strong> </p>\n\n<p>In Swift, just like in Java 8, the closure captures a strong reference to <code>self</code> (<code>this</code> in Java and Kotlin) only if it accesses a property of the instance, such as <code>self.someProperty</code>, or if the closure calls a method on the instance, such as <code>self.someMethod()</code>.</p>\n\n<p>Also developers can easily specify that they want to capture only the weak reference:</p>\n\n<pre><code>   someFunctionThatTakesAClosure { [weak self] in print($0) }\n</code></pre>\n\n<p>I wish it were possible in Kotlin too :)</p>\n"}, {"tags": [], "owner": {"reputation": 21553, "user_id": 434004, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/50a236e50d72e5e32f294d62dc57b5ba?s=128&d=identicon&r=PG", "display_name": "Graham Perks", "link": "https://stackoverflow.com/users/434004/graham-perks"}, "is_accepted": false, "score": 9, "last_activity_date": 1617509189, "last_edit_date": 1617509189, "creation_date": 1575398651, "answer_id": 59163461, "question_id": 42271208, "link": "https://stackoverflow.com/questions/42271208/kotlin-safe-lambdas-no-memory-leak/59163461#59163461", "title": "Kotlin : safe lambdas (no memory leak)?", "body": "<p>Here's a simple example of a (potential) leak, where the closure/block captures <code>this</code>:</p>\n<pre><code>class SomeClass {\n    fun doWork() {\n        doWorkAsync { onResult() } // leaks, this.onResult() captures `this`\n    }\n\n    fun onResult() { /* some work */ }\n}\n</code></pre>\n<p>You'll need to use a WeakReference.</p>\n<pre><code>fun doWork() {\n    val weakThis = WeakReference(this)\n    doWorkAsync { weakThis?.get()?.onResult() } // no capture, no leak!\n}\n</code></pre>\n<p>It'd be great if Kotlin copied the [weak self] syntactic sugar idea from Swift.</p>\n"}], "owner": {"reputation": 4580, "user_id": 662618, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/485a36e2fb0e89238446e0789d7094a9?s=128&d=identicon&r=PG", "display_name": "loloof64", "link": "https://stackoverflow.com/users/662618/loloof64"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13083, "favorite_count": 16, "accepted_answer_id": 42275638, "answer_count": 3, "score": 48, "last_activity_date": 1617509189, "creation_date": 1487240851, "last_edit_date": 1487242268, "question_id": 42271208, "link": "https://stackoverflow.com/questions/42271208/kotlin-safe-lambdas-no-memory-leak", "title": "Kotlin : safe lambdas (no memory leak)?", "body": "<p>After having read <a href=\"https://medium.com/freenet-engineering/memory-leaks-in-android-identify-treat-and-avoid-d0b1233acc8#.yet4778q1\" rel=\"noreferrer\">this article about Memory Leaks</a>, I am wondering whether using lambdas in Kotlin Android project is safe. It's true that lambda syntax makes me program with more ease, but what about the Memory Leaks ?</p>\n\n<p>As an example of the problematic, I've taken a piece of code from one of my projects, where I build an AlertDialog. This code is inside the MainActivity class of my project.</p>\n\n<pre><code>fun deleteItemOnConfirmation(id: Long) : Unit {\n        val item = explorerAdapter.getItemAt(id.toInt())\n        val stringId = if (item.isDirectory) R.string.about_to_delete_folder else R.string.about_to_delete_file\n\n        val dialog = AlertDialog.Builder(this).\n                setMessage(String.format(getString(stringId), item.name)).setPositiveButton(\n                R.string.ok, {dialog: DialogInterface, id: Int -&gt;\n                        val success = if (item.isDirectory) ExplorerFileManager.deleteFolderRecursively(item.name)\n                        else ExplorerFileManager.deleteFile(item.name)\n                        if (success) {\n                            explorerAdapter.deleteItem(item)\n                            explorerRecyclerView.invalidate()\n                        }\n                        else Toast.makeText(this@MainActivity, R.string.file_deletion_error, Toast.LENGTH_SHORT).show()\n                    }).setNegativeButton(\n                R.string.cancel, {dialog: DialogInterface, id: Int -&gt;\n                    dialog.cancel()\n        })\n\n        dialog.show()\n}\n</code></pre>\n\n<p>My question is very simple : can the two lambdas set for positive and negative buttons lead to Memory Leaks ? (I also mean, are kotlin lambdas simply converted to Java Anonymous functions ?)</p>\n\n<p>Edit : Maybe I've got my answer <a href=\"https://discuss.kotlinlang.org/t/function-literals-and-reference-to-enclosing-class/416\" rel=\"noreferrer\">in this Jetbrains Topic</a>.</p>\n"}]