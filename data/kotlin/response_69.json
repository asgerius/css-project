[{"tags": ["android", "kotlin"], "comments": [{"owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "edited": false, "score": 0, "creation_date": 1462435866, "post_id": 37039856, "comment_id": 61639426, "body": "Do you pass a local variable as <code>listener</code>? Is it stored somewhere else, e.g. in a property of the Activity?"}, {"owner": {"reputation": 537, "user_id": 5207721, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/686783f7f5ad8284b8c1491775db498c?s=128&d=identicon&r=PG&f=1", "display_name": "gesuwall", "link": "https://stackoverflow.com/users/5207721/gesuwall"}, "reply_to_user": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "edited": false, "score": 0, "creation_date": 1462442869, "post_id": 37039856, "comment_id": 61643415, "body": "yes I pass a local variable, but I don&#39;t store it anywhere"}], "answers": [{"tags": [], "owner": {"reputation": 4412, "user_id": 1650580, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Su7AM.jpg?s=128&g=1", "display_name": "Mike Buhot", "link": "https://stackoverflow.com/users/1650580/mike-buhot"}, "is_accepted": false, "score": 1, "last_activity_date": 1462448139, "creation_date": 1462448139, "answer_id": 37049582, "question_id": 37039856, "link": "https://stackoverflow.com/questions/37039856/weakreference-not-working-in-kotlin/37049582#37049582", "title": "WeakReference not working in Kotlin", "body": "<p>You need to hold a strong reference to the OnBitmapProcessedListener somewhere else to ensure the GC doesn't clear WeakReference.</p>\n"}, {"comments": [{"owner": {"reputation": 29751, "user_id": 3286489, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yTcB3.png?s=128&g=1", "display_name": "Elye", "link": "https://stackoverflow.com/users/3286489/elye"}, "edited": false, "score": 2, "creation_date": 1468826502, "post_id": 37049586, "comment_id": 64267456, "body": "What&#39;s the purpose of having a weakReference when something it stored need to be a StrongReference? Wouldn&#39;t this prevent the object from garbage collected? (i.e. the purpose of weakReference is so that, the object it contain could be free when needed)."}, {"owner": {"reputation": 1073, "user_id": 4127441, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/7pi4r.png?s=128&g=1", "display_name": "rgv", "link": "https://stackoverflow.com/users/4127441/rgv"}, "edited": false, "score": 0, "creation_date": 1539874948, "post_id": 37049586, "comment_id": 92667500, "body": "I am not an expert but if I have to hold a strong reference to properly use a weak reference of the same object, why not just have a manually nullable object, so I can decide when the reference can be cleared."}, {"owner": {"reputation": 44381, "user_id": 471160, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/9Z23A.jpg?s=128&g=1", "display_name": "marcinj", "link": "https://stackoverflow.com/users/471160/marcinj"}, "edited": false, "score": 0, "creation_date": 1542912048, "post_id": 37049586, "comment_id": 93747006, "body": "Usually listener interface is implemented by activity class, and activity instance is being passed to async task. Activity&#39;s reference is being kept by system - at least for the time it is not destroyed. By keeping its reference in async task as WeakReference you don&#39;t risk leaking activity references. From op&#39;s description, listener is implemented using separate class which keeps reference to Activity - at least its not clear from the original description."}], "tags": [], "owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "is_accepted": true, "score": 16, "last_activity_date": 1462453257, "last_edit_date": 1495539940, "creation_date": 1462448154, "answer_id": 37049586, "question_id": 37039856, "link": "https://stackoverflow.com/questions/37039856/weakreference-not-working-in-kotlin/37049586#37049586", "title": "WeakReference not working in Kotlin", "body": "<p>The problem is in the <a href=\"https://docs.oracle.com/javase/7/docs/api/java/lang/ref/WeakReference.html\" rel=\"noreferrer\"><code>WeakReference</code></a> and local variable that you pass as <code>listener</code>.</p>\n\n<p><code>WeakReference</code> is <a href=\"https://stackoverflow.com/questions/9809074/java-difference-between-strong-soft-weak-phantom-reference\">known not to keep an object from being garbage collected</a>, so if there's no other reachable <em>strong reference</em> to it, it may be recycled at any moment once the method referencing it through local variable finishes. And this is exactly what happens in your case since the weak reference becomes <code>null</code>.</p>\n\n<p>The solution is to store a <em>strong reference</em> to the object that is passed as <code>listener</code> somewhere in the calling code (as it uses the activity, the activity itself may store it in a property, so that the <code>listener</code>'s lifetime would match that of the activity).</p>\n\n<p>For example, declare a property</p>\n\n<pre><code>lateinit var currentListener: OnBitmapProcessedListener\n</code></pre>\n\n<p>in the activity code, then store the <code>listener</code> you create in that property:</p>\n\n<pre><code>val task = PhotoRotationTask(uri, filePath, resolver)\n\ntask.setOnBitmapProcessedListener(object : OnBitmapProcessedListener {\n         // here goes the implementation\n     }.apply { currentListener = this } // note this line\n)\n</code></pre>\n\n<p>If multiple tasks and listeners are possible, then take care of storing all the listeners.</p>\n"}], "owner": {"reputation": 537, "user_id": 5207721, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/686783f7f5ad8284b8c1491775db498c?s=128&d=identicon&r=PG&f=1", "display_name": "gesuwall", "link": "https://stackoverflow.com/users/5207721/gesuwall"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14903, "favorite_count": 2, "accepted_answer_id": 37049586, "answer_count": 2, "score": 16, "last_activity_date": 1462453257, "creation_date": 1462404871, "question_id": 37039856, "link": "https://stackoverflow.com/questions/37039856/weakreference-not-working-in-kotlin", "title": "WeakReference not working in Kotlin", "body": "<p>I'm implementing an <code>AsyncTask</code> in Kotlin, and I need a <code>WeakReference</code> for the callback that runs in the <code>onPostExecute()</code> method. I set the listener reference before calling <code>execute()</code>, but once <code>onPostExecute()</code> is called, the value of <code>WeakReference</code> is <code>null</code>.</p>\n\n<pre><code>class PhotoRotationTask(uri: Uri, filePath: String, resolver: ContentResolver) : AsyncTask&lt;Int, Int, Int&gt;() {\n    private var weakRef : WeakReference&lt;OnBitmapProcessedListener&gt;? = null\n\n    var sourceUri : Uri\n    var resolver : ContentResolver\n    var destPath: String\n\n    init {\n        this.sourceUri = uri\n        this.resolver = resolver\n        this.destPath = filePath\n    }\n\n    fun setOnBitmapProcessedListener(listener: OnBitmapProcessedListener){\n        weakRef = WeakReference(listener)\n        Log.d(\"RotationTask\", \"set listener ${weakRef?.get() != null}\") //This Log proves that weakRef is initialized before onPostExecute()\n    }\n\n    override fun doInBackground(vararg params: Int?): Int? {\n        //Bitmap processing, weakRef is never called in this function\n    }\n\n    override fun onPostExecute(result: Int?) {\n        Log.d(\"RotationTask\", \"result: $result\") //This log proves that onPostExecute() is called eventually\n        weakRef!!.get()?.onBitmapProcessed() //This implies that weakRef is not null, because app never crashes, but onBitmapProcessed is not called, so the reference is gone.\n    }\n\n}\n</code></pre>\n\n<p>The <code>listener</code> variable modifies my activity's UI, therefore it holds a reference to my activity. Activity is never recreated, my phone is still, never rotated or touched after AsyncTask starts. How is the <code>WeakReference</code> cleared??</p>\n"}, {"tags": ["markdown", "kotlin", "flowchart"], "comments": [{"owner": {"reputation": 17307, "user_id": 869184, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/58a3657cee7bdb5f537020660d9711e0?s=128&d=identicon&r=PG&f=1", "display_name": "Ilya", "link": "https://stackoverflow.com/users/869184/ilya"}, "edited": false, "score": 2, "creation_date": 1462372303, "post_id": 37028386, "comment_id": 61611562, "body": "Flowchart isn&#39;t a construction inherent to markdown syntax like <code>*bold*</code> is. Please explain why do you expect it to be supported?"}, {"owner": {"reputation": 1358, "user_id": 5218585, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/gtN7e.jpg?s=128&g=1", "display_name": "Allen Vork", "link": "https://stackoverflow.com/users/5218585/allen-vork"}, "reply_to_user": {"reputation": 17307, "user_id": 869184, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/58a3657cee7bdb5f537020660d9711e0?s=128&d=identicon&r=PG&f=1", "display_name": "Ilya", "link": "https://stackoverflow.com/users/869184/ilya"}, "edited": false, "score": 0, "creation_date": 1462413826, "post_id": 37028386, "comment_id": 61631663, "body": "I wanna use the diagram to show the structre of my class. When people take a look of the class, they can have a clear sense of it."}], "answers": [{"comments": [{"owner": {"reputation": 3462, "user_id": 2094298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/26a93895eedcc45a0ebc3bb0da2cfbe6?s=128&d=identicon&r=PG", "display_name": "Ruckus T-Boom", "link": "https://stackoverflow.com/users/2094298/ruckus-t-boom"}, "edited": false, "score": 1, "creation_date": 1462388709, "post_id": 37035964, "comment_id": 61622247, "body": "Out of idle curiosity, do you have some environment where that snippet would actually render a chart?"}, {"owner": {"reputation": 1358, "user_id": 5218585, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/gtN7e.jpg?s=128&g=1", "display_name": "Allen Vork", "link": "https://stackoverflow.com/users/5218585/allen-vork"}, "edited": false, "score": 0, "creation_date": 1462413999, "post_id": 37035964, "comment_id": 61631712, "body": "I&#39;m using <code>Cmd MarkDown</code>, the flowchart syntax works on it."}, {"owner": {"reputation": 3462, "user_id": 2094298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/26a93895eedcc45a0ebc3bb0da2cfbe6?s=128&d=identicon&r=PG", "display_name": "Ruckus T-Boom", "link": "https://stackoverflow.com/users/2094298/ruckus-t-boom"}, "reply_to_user": {"reputation": 1358, "user_id": 5218585, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/gtN7e.jpg?s=128&g=1", "display_name": "Allen Vork", "link": "https://stackoverflow.com/users/5218585/allen-vork"}, "edited": false, "score": 0, "creation_date": 1462457969, "post_id": 37035964, "comment_id": 61653180, "body": "That&#39;s interesting. I&#39;ve never seen that one before. But it has a number of extensions that normal markdown does not offer (like the charting and math syntax). Kotlin supports more vanilla markdown. See <a href=\"https://kotlinlang.org/docs/reference/kotlin-doc.html\" rel=\"nofollow noreferrer\">kotlinlang.org/docs/reference/kotlin-doc.html</a>"}], "tags": [], "owner": {"reputation": 3462, "user_id": 2094298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/26a93895eedcc45a0ebc3bb0da2cfbe6?s=128&d=identicon&r=PG", "display_name": "Ruckus T-Boom", "link": "https://stackoverflow.com/users/2094298/ruckus-t-boom"}, "is_accepted": false, "score": 1, "last_activity_date": 1462462166, "last_edit_date": 1462462166, "creation_date": 1462388673, "answer_id": 37035964, "question_id": 37028386, "link": "https://stackoverflow.com/questions/37028386/kotlin-file-doesnt-support-flowchart-written-by-markdown/37035964#37035964", "title": "kotlin file doesn&#39;t support flowchart written by markdown?", "body": "<p>As Ilya said, markdown doesn't have support for flowchart construction. What you are doing is telling markdown (specifically GitHub flavored markdown in this case) to render preformatted text and highlight it according to the syntax of <code>flow</code> language.</p>\n\n<p>If you have an environment where your above code actually shows a chart, it's custom functionality in that environment, and you shouldn't expect it anywhere else.</p>\n\n<p>The markdown that Kotlin supports is <a href=\"https://kotlinlang.org/docs/reference/kotlin-doc.html#inline-markup\" rel=\"nofollow\">documented here</a> (basically <a href=\"http://daringfireball.net/projects/markdown/syntax\" rel=\"nofollow\">vanilla markdown</a> with some extensions for linking to different bits of code).</p>\n"}], "owner": {"reputation": 1358, "user_id": 5218585, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/gtN7e.jpg?s=128&g=1", "display_name": "Allen Vork", "link": "https://stackoverflow.com/users/5218585/allen-vork"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1462462166, "creation_date": 1462366284, "question_id": 37028386, "link": "https://stackoverflow.com/questions/37028386/kotlin-file-doesnt-support-flowchart-written-by-markdown", "title": "kotlin file doesn&#39;t support flowchart written by markdown?", "body": "<p>I'm using kotlin to develope android app. We know kotlin uses markdown to document its code. So I try to draw a flowchart by markdown syntax as below:</p>\n\n<pre><code>/**\n * Created by zhangruofan on 16-3-2.\n *\n * ```flow\n * st=&gt;start: Start|past:&gt;http://www.google.com[blank]\n * e=&gt;end: End:&gt;http://www.google.com\n * op1=&gt;operation: My Operation|past\n * op2=&gt;operation: Stuff|current\n * sub1=&gt;subroutine: My Subroutine|invalid\n * cond=&gt;condition: Yes\n * or No?|approved:&gt;http://www.baidu.com\n * c2=&gt;condition: Good idea|rejected\n * io=&gt;inputoutput: catch something...|request\n *\n * st-&gt;op1(right)-&gt;cond\n * cond(yes, right)-&gt;c2\n * cond(no)-&gt;sub1(left)-&gt;op1\n * c2(yes)-&gt;io-&gt;e\n * c2(no)-&gt;op2-&gt;e\n * ```\n */\n</code></pre>\n\n<p>but the flowchart doesn't show.Some other markdown syntax such as <code>**Bold**</code> does work. I don't know how to make it work.</p>\n"}, {"tags": ["generics", "kotlin"], "answers": [{"comments": [{"owner": {"reputation": 2154, "user_id": 2312075, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g2VYN.jpg?s=128&g=1", "display_name": "saarrrr", "link": "https://stackoverflow.com/users/2312075/saarrrr"}, "edited": false, "score": 0, "creation_date": 1462415748, "post_id": 37018637, "comment_id": 61632162, "body": "reified is the way"}, {"owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "edited": false, "score": 2, "creation_date": 1462870735, "post_id": 37018637, "comment_id": 61806645, "body": "This won&#39;t retain actual type parameters: <code>T::class.java</code> will represent <code>List&lt;*&gt;</code>, not <code>List&lt;Number&gt;</code>, but there&#39;s a solution that will do it for reified generics -- super class tokens."}, {"owner": {"reputation": 17307, "user_id": 869184, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/58a3657cee7bdb5f537020660d9711e0?s=128&d=identicon&r=PG&f=1", "display_name": "Ilya", "link": "https://stackoverflow.com/users/869184/ilya"}, "reply_to_user": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "edited": false, "score": 0, "creation_date": 1462891736, "post_id": 37018637, "comment_id": 61822383, "body": "@hotkey I assume <code>Builder</code> class doesn&#39;t require actual type parameters to be retained, because it takes a constructor argument <code>Class&lt;T&gt;</code> and not <code>Type</code> as it&#39;s stated in the question."}, {"owner": {"reputation": 3042, "user_id": 2787507, "user_type": "registered", "accept_rate": 23, "profile_image": "https://i.stack.imgur.com/lv63g.jpg?s=128&g=1", "display_name": "nutella_eater", "link": "https://stackoverflow.com/users/2787507/nutella-eater"}, "edited": false, "score": 0, "creation_date": 1509362359, "post_id": 37018637, "comment_id": 80974208, "body": "@Ilya what is the Builder class? Can you provide the package name?"}, {"owner": {"reputation": 17307, "user_id": 869184, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/58a3657cee7bdb5f537020660d9711e0?s=128&d=identicon&r=PG&f=1", "display_name": "Ilya", "link": "https://stackoverflow.com/users/869184/ilya"}, "reply_to_user": {"reputation": 3042, "user_id": 2787507, "user_type": "registered", "accept_rate": 23, "profile_image": "https://i.stack.imgur.com/lv63g.jpg?s=128&g=1", "display_name": "nutella_eater", "link": "https://stackoverflow.com/users/2787507/nutella-eater"}, "edited": false, "score": 0, "creation_date": 1509367148, "post_id": 37018637, "comment_id": 80977264, "body": "@alexeypolusov it&#39;s the class from the question."}], "tags": [], "owner": {"reputation": 17307, "user_id": 869184, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/58a3657cee7bdb5f537020660d9711e0?s=128&d=identicon&r=PG&f=1", "display_name": "Ilya", "link": "https://stackoverflow.com/users/869184/ilya"}, "is_accepted": true, "score": 18, "last_activity_date": 1462336928, "creation_date": 1462336928, "answer_id": 37018637, "question_id": 37016058, "link": "https://stackoverflow.com/questions/37016058/getting-class-of-list-with-generic-eg-listnumberclass/37018637#37018637", "title": "Getting Class of list with generic eg: List&lt;Number&gt;::class", "body": "<p>Due to <a href=\"https://docs.oracle.com/javase/tutorial/java/generics/genTypes.html\">generic type erasure</a> <code>List</code> class has a single implementation for all its generic instantiations. You can only get a class corresponding to <code>List&lt;*&gt;</code> type, and thus create only <code>Builder&lt;List&lt;*&gt;&gt;</code>.</p>\n\n<p>That builder instance is suitable for building a list of <em>something</em>. And again due to type erasure what that something is you can decide by yourself with the help of unchecked casts:</p>\n\n<pre><code>Builder(List::class.java) as Builder&lt;List&lt;Number&gt;&gt;\nBuilder(List::class.java as Class&lt;List&lt;Number&gt;&gt;)\n</code></pre>\n\n<p>Another approach is to create inline reified helper function:</p>\n\n<pre><code>inline fun &lt;reified T : Any&gt; Builder() = Builder(T::class.java)\n</code></pre>\n\n<p>and use it the following way:</p>\n\n<pre><code>Builder&lt;List&lt;Number&gt;&gt;()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "is_accepted": false, "score": 9, "last_activity_date": 1462824398, "last_edit_date": 1495540424, "creation_date": 1462708437, "answer_id": 37099526, "question_id": 37016058, "link": "https://stackoverflow.com/questions/37016058/getting-class-of-list-with-generic-eg-listnumberclass/37099526#37099526", "title": "Getting Class of list with generic eg: List&lt;Number&gt;::class", "body": "<p>The solution is to use <a href=\"https://kotlinlang.org/docs/reference/inline-functions.html#reified-type-parameters\" rel=\"noreferrer\">reified generics</a> in couple with <a href=\"http://gafter.blogspot.ru/2006/12/super-type-tokens.html\" rel=\"noreferrer\">super class tokens</a>.</p>\n\n<p>Please refer to <a href=\"https://stackoverflow.com/questions/36253310/how-to-get-actual-type-arguments-of-a-reified-generic-parameter-in-kotlin\">this question</a> for the method explained. Constructors in Kotlin don't support reified generics, but you can use <code>TypeReference</code> described there to write a <code>builder</code> factory function which will retain actual generic parameters at runtime:</p>\n\n<pre><code>inline &lt;reified T: Any&gt; fun builder(): Builder&lt;T&gt; {\n    val type = object : TypeReference&lt;T&gt;() {}.type\n    return Builder(type)\n}\n</code></pre>\n\n<p>Then inside <code>Builder</code> you can check if <code>type</code> is <code>ParameterizedType</code>, and if it is, <code>type.actualTypeArguments</code> will contain the actual generic parameters.</p>\n\n<p>For example, <code>builder&lt;List&lt;Number&gt;&gt;()</code> will retain the information about <code>Number</code> at runtime.</p>\n\n<p>The limitation of this approach is that you cannot use non-reified generic as a reified type parameter because the type must be known at compile-time.</p>\n"}, {"tags": [], "owner": {"reputation": 2902, "user_id": 1421435, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/o99uu.jpg?s=128&g=1", "display_name": "Shivanand Darur", "link": "https://stackoverflow.com/users/1421435/shivanand-darur"}, "is_accepted": false, "score": 0, "last_activity_date": 1564133519, "creation_date": 1564133519, "answer_id": 57217120, "question_id": 37016058, "link": "https://stackoverflow.com/questions/37016058/getting-class-of-list-with-generic-eg-listnumberclass/57217120#57217120", "title": "Getting Class of list with generic eg: List&lt;Number&gt;::class", "body": "<p>If you are using gson library already in the project(for example json parsing). It provides a class for this. <code>com.google.gson.reflect.TypeToken()</code>. So you could use something like,</p>\n\n<pre><code> Builder&lt;List&lt;Number&gt;&gt;(object : TypeToken&lt;List&lt;Number&gt;&gt;() {}.type::class)\n</code></pre>\n"}], "owner": {"reputation": 744, "user_id": 3708426, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1696669719/picture?type=large", "display_name": "Jonathan Leitschuh", "link": "https://stackoverflow.com/users/3708426/jonathan-leitschuh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12154, "favorite_count": 4, "accepted_answer_id": 37018637, "answer_count": 3, "score": 21, "last_activity_date": 1564133519, "creation_date": 1462318380, "last_edit_date": 1477938245, "question_id": 37016058, "link": "https://stackoverflow.com/questions/37016058/getting-class-of-list-with-generic-eg-listnumberclass", "title": "Getting Class of list with generic eg: List&lt;Number&gt;::class", "body": "<p>I have a generically typed class <code>Builder&lt;T&gt;</code> that takes a constructor argument <code>Class&lt;T&gt;</code> so I can keep the type around. This is a class that I use a lot in java code so I don't want to change the signature.\nWhen I try to use the constructor like this: </p>\n\n<p><code>Builder&lt;List&lt;Number&gt;&gt;(List&lt;Number&gt;::class)</code></p>\n\n<p>I get an error: \"Only classes are allowed on the left hand side of a class literal\"</p>\n\n<p>Any way to resolve this?\nI can't change the constructor for <code>Builder</code>, too many java classes rely upon it.</p>\n\n<p>I understand the whole type erasure issue, I really just want to make the compiler happy.</p>\n"}, {"tags": ["kotlin"], "answers": [{"tags": [], "owner": {"reputation": 50303, "user_id": 170842, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/c2ea72b8d001d81fb6ce3f356e45eb3a?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/170842/michael"}, "is_accepted": false, "score": 10, "last_activity_date": 1592680423, "last_edit_date": 1592680423, "creation_date": 1462290729, "answer_id": 37008786, "question_id": 37008709, "link": "https://stackoverflow.com/questions/37008709/how-to-create-an-infinitely-long-sequence-in-kotlin/37008786#37008786", "title": "How to create an infinitely long sequence in Kotlin", "body": "<p>If you need an infinite sequence you should use the new <code>sequence</code> function:</p>\n<pre><code>val sequence = sequence {\n  while (true) {\n    yield(someValue())\n  }\n}\n</code></pre>\n<p><strong>Previous answer</strong></p>\n<p>Use <code>Int.MAX_VALUE</code> as the upper bound. You cannot have an integer greater than <code>Int.MAX_VALUE</code>.</p>\n<pre><code>val allInts = (1..Int.MAX_VALUE).asSequence()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 630270, "user_id": 571407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f0d9dec16bae1e06552af55ddefc11f?s=128&d=identicon&r=PG", "display_name": "JB Nizet", "link": "https://stackoverflow.com/users/571407/jb-nizet"}, "is_accepted": true, "score": 16, "last_activity_date": 1508946110, "last_edit_date": 1508946110, "creation_date": 1462291059, "answer_id": 37008908, "question_id": 37008709, "link": "https://stackoverflow.com/questions/37008709/how-to-create-an-infinitely-long-sequence-in-kotlin/37008908#37008908", "title": "How to create an infinitely long sequence in Kotlin", "body": "<pre><code>val sequence = generateSequence(1) { it + 1 }\nval taken = sequence.take(5);\ntaken.forEach { println(it) }\n</code></pre>\n\n<p>This is not really infinite, though: it will overflow when Integer.MAX_VALUE is reached.</p>\n"}, {"tags": [], "owner": {"reputation": 1404, "user_id": 564553, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/cca53f9b89c73e85539a7f599585c789?s=128&d=identicon&r=PG", "display_name": "BPS", "link": "https://stackoverflow.com/users/564553/bps"}, "is_accepted": false, "score": 4, "last_activity_date": 1505485088, "creation_date": 1505485088, "answer_id": 46241762, "question_id": 37008709, "link": "https://stackoverflow.com/questions/37008709/how-to-create-an-infinitely-long-sequence-in-kotlin/46241762#46241762", "title": "How to create an infinitely long sequence in Kotlin", "body": "<p>JB's answer is good but you could also go with</p>\n\n<pre><code>generateSequence(1, Int::inc)\n</code></pre>\n\n<p>if you're into the whole brevity thing.</p>\n"}], "owner": {"reputation": 6147, "user_id": 43836, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/cbfa20635c9269675d54547c080c9b64?s=128&d=identicon&r=PG", "display_name": "pondermatic", "link": "https://stackoverflow.com/users/43836/pondermatic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2436, "favorite_count": 1, "accepted_answer_id": 37008908, "answer_count": 3, "score": 12, "last_activity_date": 1592680423, "creation_date": 1462290494, "question_id": 37008709, "link": "https://stackoverflow.com/questions/37008709/how-to-create-an-infinitely-long-sequence-in-kotlin", "title": "How to create an infinitely long sequence in Kotlin", "body": "<p>I'm looking for something like </p>\n\n<pre><code>val allInts = (1..).asSequence()\n</code></pre>\n\n<p>so I could, for example</p>\n\n<pre><code>allInts.take(5)\n</code></pre>\n"}, {"tags": ["android", "clojure", "kotlin", "compojure", "http-kit"], "comments": [{"owner": {"reputation": 6458, "user_id": 2720553, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/100001579071481/picture?type=large", "display_name": "Rohit Arya", "link": "https://stackoverflow.com/users/2720553/rohit-arya"}, "edited": false, "score": 0, "creation_date": 1462258306, "post_id": 36997512, "comment_id": 61548407, "body": "add code for how you are making call."}, {"owner": {"reputation": 13, "user_id": 2091229, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/baba0d9a220b3ebf43a3b1126d64372d?s=128&d=identicon&r=PG", "display_name": "lemaiyan", "link": "https://stackoverflow.com/users/2091229/lemaiyan"}, "reply_to_user": {"reputation": 6458, "user_id": 2720553, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/100001579071481/picture?type=large", "display_name": "Rohit Arya", "link": "https://stackoverflow.com/users/2720553/rohit-arya"}, "edited": false, "score": 0, "creation_date": 1462261711, "post_id": 36997512, "comment_id": 61550234, "body": "@RohitArya I have added the code as requested."}], "answers": [{"tags": [], "owner": {"reputation": 13, "user_id": 2091229, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/baba0d9a220b3ebf43a3b1126d64372d?s=128&d=identicon&r=PG", "display_name": "lemaiyan", "link": "https://stackoverflow.com/users/2091229/lemaiyan"}, "is_accepted": true, "score": 0, "last_activity_date": 1462644018, "creation_date": 1462644018, "answer_id": 37091921, "question_id": 36997512, "link": "https://stackoverflow.com/questions/36997512/retrofit-failing-to-post-on-samsung-s3-android-version-4-0-4-while-on-data/37091921#37091921", "title": "Retrofit failing to post on samsung s3 android version 4.0.4 while on data", "body": "<p>After many days of debugging trying to figure out what the issue I finally found a solution the issue is not retrofit but it's the webserver I am using. I have my application done in clojure and I am using <a href=\"http://www.http-kit.org/\" rel=\"nofollow\">http-kit</a> as my webserver and compojure for routing.</p>\n\n<p>For some reason requests that are coming from s3 the uri in the http-kit request map also includes the host hence it's not being mapped to any route on my defroute. For example say if the route I am looking for is <code>/login</code> the uri in the http-kit request map for the request coming from the s3 contains <code>http://example.com/login</code> but from the other phones it contains <code>/login</code>. Hence the uri doesn't match any of my routes I have defined in the compojure defroute and goes straight to not-found and hence the 404 error</p>\n\n<p><strong>The Solution</strong></p>\n\n<p>To solve this problem I had to extend <a href=\"https://github.com/weavejester/compojure\" rel=\"nofollow\">Compojure</a> <code>routes.clj</code> and added the following function</p>\n\n<pre><code>(defn other-found\n\"if for some reason the route is defined and is not found \"\n[body]\n(fn [request]\n  (-&gt; (response/render body request)\n    (status 200)\n    (cond-&gt; (= (:request-method request) :head) (assoc :body nil)))))\n</code></pre>\n\n<p>In defroute if the uri is not matched I use the function <code>other-found</code> and pass it the the function <code>not-found-page</code>(you can name this function whatever you want to call it) in the function I get the uri from the request parameter parse it and get the endpoint then use <code>condp</code> to map the end point to the appropriate function.</p>\n\n<p>Hope this helps someone with a similar problem.</p>\n"}], "owner": {"reputation": 13, "user_id": 2091229, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/baba0d9a220b3ebf43a3b1126d64372d?s=128&d=identicon&r=PG", "display_name": "lemaiyan", "link": "https://stackoverflow.com/users/2091229/lemaiyan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 37091921, "answer_count": 1, "score": 0, "last_activity_date": 1462644095, "creation_date": 1462258193, "last_edit_date": 1462644095, "question_id": 36997512, "link": "https://stackoverflow.com/questions/36997512/retrofit-failing-to-post-on-samsung-s3-android-version-4-0-4-while-on-data", "title": "Retrofit failing to post on samsung s3 android version 4.0.4 while on data", "body": "<p>I have an android app that works well on other android devices but it fails on samsung s3 running android version 4.0.4 on data. Retrofit throws 404 (page not found error) but the page exists and if I make the same request on wifi it works well. Anyone with an idea on what could be misbehaving. Thanks</p>\n\n<p>Please find below the stack trace</p>\n\n<pre><code>    retrofit.RetrofitError: 404 Not Found\n    at retrofit.RestAdapter$RestHandler.invokeRequest (RestAdapter.java:388)\n    at retrofit.RestAdapter$RestHandler.access$100 (RestAdapter.java:220)\n    at retrofit.RestAdapter$RestHandler$2.obtainResponse (RestAdapter.java:278)\n    at retrofit.CallbackRunnable.run (CallbackRunnable.java:42)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker (ThreadPoolExecutor.java:1076)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run (ThreadPoolExecutor.java:569)\n    at retrofit.Platform$Android$2$1.run (Platform.java:142)\n    at java.lang.Thread.run (Thread.java:856)\n</code></pre>\n\n<p>Below is the code I am using to make the call</p>\n\n<pre><code>    val tailorsInterface = RestAdapter.Builder()\n                .setEndpoint(resources.getString(R.string.base_url))\n                .build().create(TailorsInterface::class.java)\n\n    tailorsInterface.addTailor(txtName.text.toString(), txtEmail.text.toString(),\n                Utils.parsePhone(txtPhone.text.toString(), \"254\"), txtAddress.text.toString(),\n                txtLon.text.toString(), txtLat.text.toString(), txtPassword.text.toString(),\n                Common.LOCATIONS!!.get(spTowns.selectedItemPosition).id, object : Callback&lt;DefaultResponse&gt; {\n\n\n            override fun success(defaultResponse: DefaultResponse, response: Response) {\n                dialog.hide()\n                if(defaultResponse.success == 1.toLong()){\n                    val alertDialog: AlertDialog\n                    val builder = AlertDialog.Builder(this@TailorsRegisterActivity)\n                            .setTitle(resources.getString(R.string.app_name))\n                            .setMessage(\"Tailor successfully registered, click OK to continue to login\")\n                            .setPositiveButton(\"OK\") { dialog, which -&gt; run{dialog.dismiss()\n                                val loginIntent: Intent = Intent(this@TailorsRegisterActivity, TailorsLoginActivity::class.java)\n                                startActivity(loginIntent)\n                            } }\n                    alertDialog = builder.create()\n                    alertDialog.show()\n\n                }else{\n                    val alertDialog: AlertDialog\n                    val builder = AlertDialog.Builder(this@TailorsRegisterActivity)\n                            .setTitle(resources.getString(R.string.app_name))\n                            .setMessage(\"An Error occurred please try again later\")\n                            .setPositiveButton(\"OK\") { dialog, which -&gt; run{dialog.dismiss()\n                                finish()} }\n                    alertDialog = builder.create()\n                    alertDialog.show()\n                }\n            }\n\n    @FormUrlEncoded\n    @POST(\"/tailors\")\n    public fun addTailor(@Field(\"name\") name: String, @Field(\"email\") email: String,\n                     @Field(\"phone\") phone: String, @Field(\"address\") address: String,\n                     @Field(\"lon\") lon: String, @Field(\"lat\") lat: String,\n                     @Field(\"password\") password: String, @Field(\"town\") town: Int,\n                     cb: Callback&lt;DefaultResponse&gt;)\n\n    data class DefaultResponse (\n            var success: Long,\n            var message: String\n   )\n</code></pre>\n"}, {"tags": ["java", "delegates", "kotlin"], "answers": [{"tags": [], "owner": {"reputation": 4427, "user_id": 4706743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b05c3b09628ba8955d6d7a188271af?s=128&d=identicon&r=PG&f=1", "display_name": "D3xter", "link": "https://stackoverflow.com/users/4706743/d3xter"}, "is_accepted": false, "score": 6, "last_activity_date": 1462819285, "last_edit_date": 1462819285, "creation_date": 1462259684, "answer_id": 36997940, "question_id": 36993654, "link": "https://stackoverflow.com/questions/36993654/kotlin-delegation-to-expression-instead-of-fixed-reference/36997940#36997940", "title": "Kotlin delegation to expression instead of fixed reference", "body": "<p>Right now there is no way to do that. See <a href=\"https://youtrack.jetbrains.com/issue/KT-5870\" rel=\"nofollow\">Kotlin issue KT-5870</a></p>\n\n<blockquote>\n  <p>Currenlty Kotlin evaluates expression for delegate in class initializer</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 50303, "user_id": 170842, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/c2ea72b8d001d81fb6ce3f356e45eb3a?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/170842/michael"}, "edited": false, "score": 1, "creation_date": 1462283559, "post_id": 37000028, "comment_id": 61564625, "body": "In this case you have to delegate all the methods manually what the author is trying to avoid."}, {"owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "reply_to_user": {"reputation": 50303, "user_id": 170842, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/c2ea72b8d001d81fb6ce3f356e45eb3a?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/170842/michael"}, "edited": false, "score": 0, "creation_date": 1462295002, "post_id": 37000028, "comment_id": 61572477, "body": "@Michael yes it is true, however I only have to do the manual delegation only once for <code>Holder</code>, after that I can use it with no additional boilerplate"}, {"owner": {"reputation": 50303, "user_id": 170842, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/c2ea72b8d001d81fb6ce3f356e45eb3a?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/170842/michael"}, "edited": false, "score": 0, "creation_date": 1462297844, "post_id": 37000028, "comment_id": 61574122, "body": "You don&#39;t need any additional classes for that. Just delegate everything right from <code>Derived</code>."}, {"owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "reply_to_user": {"reputation": 50303, "user_id": 170842, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/c2ea72b8d001d81fb6ce3f356e45eb3a?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/170842/michael"}, "edited": false, "score": 0, "creation_date": 1462300507, "post_id": 37000028, "comment_id": 61575711, "body": "ye but I would have to manually delegate at <code>Derived2</code>, <code>Derived3</code>, etc. <code>Handle</code> keeps this all in one place"}, {"owner": {"reputation": 4427, "user_id": 4706743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b05c3b09628ba8955d6d7a188271af?s=128&d=identicon&r=PG&f=1", "display_name": "D3xter", "link": "https://stackoverflow.com/users/4706743/d3xter"}, "edited": false, "score": 0, "creation_date": 1462366231, "post_id": 37000028, "comment_id": 61606505, "body": "@voddan Only when he got multiple Derived. From what the author said, its not clear if he got Derived2/3/4"}, {"owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "edited": false, "score": 0, "creation_date": 1462366308, "post_id": 37000028, "comment_id": 61606576, "body": "I believe all possibly usefull options are welcome here"}], "tags": [], "owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "is_accepted": false, "score": 0, "last_activity_date": 1462266523, "creation_date": 1462266523, "answer_id": 37000028, "question_id": 36993654, "link": "https://stackoverflow.com/questions/36993654/kotlin-delegation-to-expression-instead-of-fixed-reference/37000028#37000028", "title": "Kotlin delegation to expression instead of fixed reference", "body": "<p>You can add a level of indirection: </p>\n\n<pre><code>class Holder(var impl: Spec) : Spec {\n    override fun sayHello() = impl.sayHello()    \n}\n\nclass Derived(target: Spec, \n              private val holder: Holder = Holder(target)) : Spec by holder {\n\n    fun changeTarget(newTarget: Spec) {\n        holder.impl = newTarget\n    }\n}\n</code></pre>\n\n<p>Unfortunately <code>holder</code> must be a constructor parameter in order to be used with the delegation construct (as for Kotlin v1.0), so it complicates the primary constructor.</p>\n"}], "owner": {"reputation": 2018, "user_id": 1772838, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/k9Njj.png?s=128&g=1", "display_name": "Parker Hoyes", "link": "https://stackoverflow.com/users/1772838/parker-hoyes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 782, "favorite_count": 1, "answer_count": 2, "score": 6, "last_activity_date": 1462819285, "creation_date": 1462234923, "question_id": 36993654, "link": "https://stackoverflow.com/questions/36993654/kotlin-delegation-to-expression-instead-of-fixed-reference", "title": "Kotlin delegation to expression instead of fixed reference", "body": "<p>Suppose I have a very intricate specification defined as an interface:</p>\n\n<pre><code>interface Spec {\n    fun sayHello()\n}\n</code></pre>\n\n<p>And a standard implementation:</p>\n\n<pre><code>class Impl(private val msg: String) : Spec {\n    override fun sayHello() {\n        println(msg)\n    }\n}\n</code></pre>\n\n<p>Now suppose that I want to create a class that implements this specification and delegates to an implementation, but the exact delegate object is mutable throughout the object's lifetime. Here's an example:</p>\n\n<pre><code>class Derived(var target: Spec) : Spec by target\n</code></pre>\n\n<p>The problem with the above example is that the constructor argument <code>target</code> is set as the delegate object when the constructor is called. The delegate is then accessed by the class directly instead of performing a property access. (This has been confirmed by looking through the bytecode produced by Kotlin.)</p>\n\n<p>So, even if the property <code>target</code> is modified after the class is constructed, the delegate does not change.</p>\n\n<p>Can anybody provide a method for performing this delegation in Kotlin without having to write out every single method?</p>\n\n<p>An ideal solution would also allow for delegation to something as general as a lambda or other expression that would be evaluated and used as the delegate whenever the delegate is needed throughout the lifetime of the object.</p>\n"}, {"tags": ["scope", "dsl", "kotlin"], "comments": [{"owner": {"reputation": 35078, "user_id": 615306, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/5a11940d70233031c01ead6c0b62c990?s=128&d=identicon&r=PG", "display_name": "Kirill Rakhman", "link": "https://stackoverflow.com/users/615306/kirill-rakhman"}, "edited": false, "score": 2, "creation_date": 1462261371, "post_id": 36992822, "comment_id": 61550030, "body": "This is currently not possible but it&#39;s planned for 1.1 according to <a href=\"https://youtrack.jetbrains.com/issue/KT-11551\" rel=\"nofollow noreferrer\">youtrack.jetbrains.com/issue/KT-11551</a>"}], "answers": [{"comments": [{"owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "edited": false, "score": 0, "creation_date": 1462339368, "post_id": 37000303, "comment_id": 61589425, "body": "@KirillRakhman please see the edit. Now for n classes it is only n dummy functions, not (n^2)/2. And thanks to the <code>level</code> parameter those deprecations are not warnings, but errors. With that I fail to see any benefit of a language level feature for that use case like in KT-11551"}], "tags": [], "owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "is_accepted": true, "score": 9, "last_activity_date": 1462339113, "last_edit_date": 1462339113, "creation_date": 1462267386, "answer_id": 37000303, "question_id": 36992822, "link": "https://stackoverflow.com/questions/36992822/kotlin-restrict-extension-method-scope/37000303#37000303", "title": "Kotlin - Restrict extension method scope", "body": "<p>You can use a workaround with <code>deprecated</code>:</p>\n\n<pre><code>class Outer {\n    fun middle(op: Middle.() -&gt; Unit): Middle {...}\n\n    @Deprecated(\"can not be used inside a Outer block\", level = DeprecationLevel.ERROR)\n    fun outer(op: Outer.() -&gt; Unit): Outer = TODO()\n}\n\nclass Middle {\n    fun inner(op: Inner.() -&gt; Unit): Inner {...}\n\n    @Deprecated(\"can not be used inside a Middle block\", level = DeprecationLevel.ERROR)\n    fun middle(op: Middle.() -&gt; Unit): Middle = TODO()\n}\n\nclass Inner {\n    @Deprecated(\"can not be used inside a Inner block\", level = DeprecationLevel.ERROR)\n    fun inner(op: Inner.() -&gt; Unit): Inner = TODO()\n}\n</code></pre>\n\n<p>Now the compiler will give you an error, and IDE will not suggest a wrong function in the completion:</p>\n\n<pre><code>outer {\n    middle {\n        inner {\n            middle { }  // error\n        }\n    }\n}\n</code></pre>\n\n<p><s>But you really should not do it for big DSLs. It is better to wait for <a href=\"https://youtrack.jetbrains.com/issue/KT-11551\">https://youtrack.jetbrains.com/issue/KT-11551</a> as @KirillRakhman suggested. </s></p>\n\n<p><strong>Edit:</strong> After I fixed my example, it became much smaller. With one dummy function for a class it is not that much of boilerplate after all.</p>\n"}, {"tags": [], "owner": {"reputation": 870, "user_id": 11351392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33b7a69ff8d14960b71442fb76a469a2?s=128&d=identicon&r=PG&f=1", "display_name": "lotor", "link": "https://stackoverflow.com/users/11351392/lotor"}, "is_accepted": false, "score": 0, "last_activity_date": 1555333792, "creation_date": 1555333792, "answer_id": 55689929, "question_id": 36992822, "link": "https://stackoverflow.com/questions/36992822/kotlin-restrict-extension-method-scope/55689929#55689929", "title": "Kotlin - Restrict extension method scope", "body": "<p>The official way to restrict scope is <a href=\"https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-dsl-marker/index.html\" rel=\"nofollow noreferrer\">DslMarker</a>.\nIt cannot help in some cases (when you need to annotate java sources, for example) - and here <code>@Deprecated</code> is used. But try <code>DslMarker</code> first.</p>\n\n<pre><code>@DslMarker\n@Target(AnnotationTarget.CLASS, AnnotationTarget.TYPE)\nannotation class Scope\n\n@Scope\nclass Outer {\n    fun middle(op: Middle.() -&gt; Unit): Middle { /**/ }\n}\n\n@Scope\nclass Middle {\n    fun inner(op: Inner.() -&gt; Unit): Inner {/**/ }\n}\n\nclass Inner\n</code></pre>\n\n<p>Thus the last <em>middle</em> call is not compilable anymore.</p>\n"}], "owner": {"reputation": 3462, "user_id": 2094298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/26a93895eedcc45a0ebc3bb0da2cfbe6?s=128&d=identicon&r=PG", "display_name": "Ruckus T-Boom", "link": "https://stackoverflow.com/users/2094298/ruckus-t-boom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 790, "favorite_count": 3, "accepted_answer_id": 37000303, "answer_count": 2, "score": 5, "last_activity_date": 1555333792, "creation_date": 1462229270, "question_id": 36992822, "link": "https://stackoverflow.com/questions/36992822/kotlin-restrict-extension-method-scope", "title": "Kotlin - Restrict extension method scope", "body": "<p>Is there a way to restrict extension methods in DSLs?</p>\n\n<p>Say I have a class structure like this:</p>\n\n<pre><code>class Outer {\n    fun middle(op: Middle.() -&gt; Unit): Middle {\n        val middle = Middle()\n        middle.op()\n        return middle\n    }\n}\n\nclass Middle {\n    fun inner(op: Inner.() -&gt; Unit): Inner {\n        val inner = Inner()\n        inner.op()\n        return inner\n    }\n}\n\nclass Inner\n\nfun outer(op: Outer.() -&gt; Unit): Outer {\n    val outer = Outer()\n    outer.op()\n    return outer\n}\n</code></pre>\n\n<p>I can then create a call like so:</p>\n\n<pre><code>outer {\n    middle {\n        inner {\n            middle { }  // Here is the problem\n        }\n    }\n}\n</code></pre>\n\n<p>My problem is that the marked <code>middle { }</code> call is confusing, as it adds a <code>Middle</code> to the <code>Outer</code> when it looks like it is adding to the <code>Inner</code>.</p>\n\n<p>Is there a way to not allow the <code>middle { }</code> call?</p>\n"}, {"tags": ["generics", "constructor", "kotlin"], "answers": [{"comments": [{"owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "edited": false, "score": 0, "creation_date": 1462267594, "post_id": 36991474, "comment_id": 61553611, "body": "basically this is like wildcard in Java"}, {"owner": {"reputation": 326, "user_id": 817703, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4f4671f0249a7d69c2b07c3df6638232?s=128&d=identicon&r=PG", "display_name": "Ronald", "link": "https://stackoverflow.com/users/817703/ronald"}, "edited": false, "score": 0, "creation_date": 1462297700, "post_id": 36991474, "comment_id": 61574024, "body": "Since the CrudRepository is part of the spring data I can not change this easily. However when I use your version of the GenericKotlinService and use some repository calls, e.g. repository.findOne(id) I get an error : Kotlin: Out-protected type &#39;CrudRepository&lt;out Any, out Serializable&gt;&#39; prohibits the use of public abstract fun findOne(po: ID!), so I probably have to study a bit more on the out keyword."}], "tags": [], "owner": {"reputation": 50303, "user_id": 170842, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/c2ea72b8d001d81fb6ce3f356e45eb3a?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/170842/michael"}, "is_accepted": true, "score": 4, "last_activity_date": 1462222317, "creation_date": 1462222317, "answer_id": 36991474, "question_id": 36990972, "link": "https://stackoverflow.com/questions/36990972/kotlin-and-generic-constructors-leave-me-baffled/36991474#36991474", "title": "Kotlin and generic constructors leave me baffled", "body": "<p>The thing is that <code>ForumRepository</code> is not <code>CrudRepository&lt;Any, Serializable&gt;</code>. But it can be convertible to <code>CrudRepository&lt;Any, Serializable&gt;</code> if both type parameters are in <code>out</code> positions. So you can either define the <code>CrudRepository</code> in the following way</p>\n\n<pre><code>interface CrudRepository&lt;out T, out U&gt;\n</code></pre>\n\n<p>or accept <code>CrudRepository</code> with <code>out</code> type parameters in <code>GenericKotlinService</code> constructor</p>\n\n<pre><code>abstract class GenericKotlinService&lt;T&gt;(\n    val repository: CrudRepository&lt;out Any, out Serializable&gt;\n)\n</code></pre>\n"}], "owner": {"reputation": 326, "user_id": 817703, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4f4671f0249a7d69c2b07c3df6638232?s=128&d=identicon&r=PG", "display_name": "Ronald", "link": "https://stackoverflow.com/users/817703/ronald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 547, "favorite_count": 0, "accepted_answer_id": 36991474, "answer_count": 1, "score": 3, "last_activity_date": 1462222317, "creation_date": 1462220392, "last_edit_date": 1462220708, "question_id": 36990972, "link": "https://stackoverflow.com/questions/36990972/kotlin-and-generic-constructors-leave-me-baffled", "title": "Kotlin and generic constructors leave me baffled", "body": "<p>Not understanding Kotlin in combination with Generics.</p>\n\n<p>I was trying to move some of my java towards kotlin. Couple of those classes are spring-data repositories\nand a generic service that takes as generic parameter a type of repository, e.g.:</p>\n\n<pre><code>@Transactional\ninterface ForumRepository : CrudRepository&lt;Forum, Long&gt; {\n    fun findByName(name: String): Forum?\n}\n</code></pre>\n\n<p>Then the GenericKotlinService :</p>\n\n<pre><code>abstract class GenericKotlinService&lt;T&gt;(val repository: CrudRepository&lt;Any, Serializable&gt;) {\n    fun &lt;T&gt; findOne(id: Serializable): T {\n        return repository.findOne(id) as T\n    }\n    fun delete(id: Any) {\n        repository.delete(id)\n    }\n}\n</code></pre>\n\n<p>However, now when I try to create a service that uses this generic service with a specific crudRepository\nI always get errors, e.g.</p>\n\n<pre><code>class ForumService @Autowired constructor(repository: ForumRepository) : GenericKotlinService&lt;Forum&gt;(repository) {\n    open fun findByName(name: String) = repository.findByName(name)\n}\n</code></pre>\n\n<p>or</p>\n\n<pre><code>class ForumService : GenericKotlinService&lt;Forum&gt; {\n    @Autowired\n    constructor(repository: ForumRepository) : super(repository)\n    open fun findByName(name: String) = repository.findByName(name)\n}\n</code></pre>\n\n<p>The error is </p>\n\n<pre><code>required CrudRepository&lt;Forum, Long&gt; but got a ForumRepository. \n</code></pre>\n\n<p>When I use the following java GenericService:</p>\n\n<pre><code>public abstract class GenericService&lt;T&gt; {\n    private final CrudRepository repository;\n    public GenericService(CrudRepository repository) {\n        this.repository = repository;\n    }\n    public T findOne(Serializable id) {\n        return (T) repository.findOne(id);\n    }\n    public void delete(Serializable id) {\n        repository.delete(id);\n    }\n}\n</code></pre>\n\n<p>and use this one in the ForumService:</p>\n\n<pre><code>class ForumService @Autowired constructor(val repository: ForumRepository) : GenericService&lt;Forum&gt;(repository) {\n    open fun findByName(name: String) = repository.findByName(name)\n}\n</code></pre>\n\n<p>everything works. I do not see how I can use my GenericKotlinService instead?</p>\n"}, {"tags": ["reflection", "kotlin"], "answers": [{"tags": [], "owner": {"reputation": 35078, "user_id": 615306, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/5a11940d70233031c01ead6c0b62c990?s=128&d=identicon&r=PG", "display_name": "Kirill Rakhman", "link": "https://stackoverflow.com/users/615306/kirill-rakhman"}, "is_accepted": true, "score": 8, "last_activity_date": 1462261128, "last_edit_date": 1462261128, "creation_date": 1462204011, "answer_id": 36986477, "question_id": 36986334, "link": "https://stackoverflow.com/questions/36986334/can-i-get-a-kfunction-from-a-variable-of-function-type-in-kotlin/36986477#36986477", "title": "Can I get a KFunction from a variable of function type in Kotlin?", "body": "<p>You can simply cast <code>() -&gt; Unit</code> to <code>KFunction&lt;*&gt;</code>. Theoretically, this is an implementation detail, but I don't think it will ever break.</p>\n\n<pre><code>fun functionName(function: () -&gt; Unit) : String {\n  val functionAsKFunction: KFunction&lt;*&gt; = function as KFunction&lt;*&gt; \n  return functionAsKFunction.name\n}\n</code></pre>\n\n<p><strong>Edit</strong>: Obviously, this won't work for lambdas (what name would you expect anyway?) To prevent crashes, you can use a safe cast like so:</p>\n\n<pre><code>fun functionName(function: () -&gt; Unit) : String? {\n  val functionAsKFunction: KFunction&lt;*&gt; = function as? KFunction&lt;*&gt; ?: return null\n  return functionAsKFunction.name\n}\n</code></pre>\n"}], "owner": {"reputation": 16077, "user_id": 97777, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/fb95aca1c80de718bbfa01447220633b?s=128&d=identicon&r=PG", "display_name": "Duncan McGregor", "link": "https://stackoverflow.com/users/97777/duncan-mcgregor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1542, "favorite_count": 0, "accepted_answer_id": 36986477, "answer_count": 1, "score": 5, "last_activity_date": 1462261128, "creation_date": 1462203612, "question_id": 36986334, "link": "https://stackoverflow.com/questions/36986334/can-i-get-a-kfunction-from-a-variable-of-function-type-in-kotlin", "title": "Can I get a KFunction from a variable of function type in Kotlin?", "body": "<p>I'm trying to get the name that a function was defined with </p>\n\n<pre><code>fun aFunction() = Unit\n\nfun functionName(function: () -&gt; Unit) : String {\n  val functionAsKFunction: KFunction&lt;Unit&gt; = someMiracle(function)\n  return functionAsKFunction.name\n}\n\nassertEquals(\"aFunction\", functionName(::aFunction)) \n</code></pre>\n"}, {"tags": ["android", "kotlin", "kotlin-android-extensions"], "answers": [{"comments": [{"owner": {"reputation": 927, "user_id": 2015751, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/29d0313be56df012c70064c768046964?s=128&d=identicon&r=PG", "display_name": "daemontus", "link": "https://stackoverflow.com/users/2015751/daemontus"}, "edited": false, "score": 0, "creation_date": 1474058783, "post_id": 37110594, "comment_id": 66393666, "body": "I see you are using the test coverage flag - there seems to be a bug there that might be causing a lot of weird behaviour :) <a href=\"https://youtrack.jetbrains.com/issue/KT-11333\" rel=\"nofollow noreferrer\">youtrack.jetbrains.com/issue/KT-11333</a>"}], "tags": [], "owner": {"reputation": 1, "user_id": 4079394, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1561256306b6a6204d9d5e34f53fd8a?s=128&d=identicon&r=PG&f=1", "display_name": "antaranin", "link": "https://stackoverflow.com/users/4079394/antaranin"}, "is_accepted": true, "score": 0, "last_activity_date": 1462781263, "creation_date": 1462781263, "answer_id": 37110594, "question_id": 36986295, "link": "https://stackoverflow.com/questions/36986295/kotlin-classes-containing-android-extensions-not-built-on-consequent-builds/37110594#37110594", "title": "Kotlin classes containing android-extensions not built on consequent builds", "body": "<p>Ok, so I managed to figure it out, maybe it will help someone else. Apparently the problem was with java annotations (<code>@DebugLog, @NonNull, @Icicle</code> etc.), if they were present in any of the kotlin classes, it would compile semi-randomly. After removing thoses it works flawlessly.</p>\n"}], "owner": {"reputation": 1, "user_id": 4079394, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1561256306b6a6204d9d5e34f53fd8a?s=128&d=identicon&r=PG&f=1", "display_name": "antaranin", "link": "https://stackoverflow.com/users/4079394/antaranin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 339, "favorite_count": 1, "accepted_answer_id": 37110594, "answer_count": 1, "score": 0, "last_activity_date": 1462781263, "creation_date": 1462203483, "last_edit_date": 1462204479, "question_id": 36986295, "link": "https://stackoverflow.com/questions/36986295/kotlin-classes-containing-android-extensions-not-built-on-consequent-builds", "title": "Kotlin classes containing android-extensions not built on consequent builds", "body": "<p>I have recently decided to port our company android application into kotlin. It works well, however, when I use any of the kotlin extensions, I get a weird behaviour. I noticed that any of the classes using extensions (be it anko, or self declared extensions) is only build the first time, and on each subsequent build it is not present among other classes. Kotlin classes that do not use extensions are built correctly all the time. \nThis leads to a NoClassDefFoundError whenever I run the program (on subsequent builds, the first one runs without issues).\nI have tried everything and I am starting to get a bit desperate\u2026\nHere is my build.gradle for the whole project:</p>\n\n<pre><code>    buildscript {\n    ext.kotlin_version = '1.0.1-2'\n    ext.support_version = '23.3.0'\n    ext.anko_version = '0.8.3'\n    repositories {\n        jcenter()\n    }\n\n    dependencies {\n        classpath 'com.android.tools.build:gradle:2.1.0'\n        classpath 'com.google.gms:google-services:2.0.0-alpha6'\n        classpath 'org.codehaus.groovy:gradle-groovy-android-plugin:0.3.7'\n        classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version\"\n\n        // NOTE: Do not place your application dependencies here; they belong\n        // in the individual module build.gradle files\n    }\n}\n\nallprojects {\n}\n</code></pre>\n\n<p>Here is build.gradle for the module that I am attempting to use kotlin in</p>\n\n<pre><code>buildscript {\n    repositories {\n        jcenter()\n        mavenCentral()\n        maven {\n            url 'http://repo.spring.io/milestone'\n        }\n        maven {\n            url \"http://repo.bodar.com/\"\n        }\n    }\n\n    dependencies {\n        classpath 'com.jakewharton.hugo:hugo-plugin:1.2.1'\n        classpath 'me.tatarka:gradle-retrolambda:3.2.4'\n    }\n}\n\napply plugin: 'com.android.application'\napply plugin: 'com.jakewharton.hugo'\napply plugin: 'me.tatarka.retrolambda'\napply plugin: 'groovyx.grooid.groovy-android'\napply plugin: 'kotlin-android'\napply plugin: 'kotlin-android-extensions'\n\nandroid {\n    compileSdkVersion 23\n    buildToolsVersion \"23.0.2\"\n    productFlavors {\n        dev {\n            minSdkVersion 21\n        }\n        prod {\n            minSdkVersion 19\n        }\n    }\n\n    sourceSets {\n        main.java.srcDirs += 'src/main/kotlin'\n    }\n\n    lintOptions {\n        disable 'InvalidPackage'\n    }\n\n    packagingOptions {\n        exclude 'META-INF/LICENSE.txt'\n        exclude 'META-INF/license.txt'\n        exclude 'META-INF/NOTICE.txt'\n        exclude 'META-INF/notice.txt'\n        exclude 'META-INF/services/javax.annotation.processing.Processor'\n        exclude 'META-INF/services/org.codehaus.groovy.transform.ASTTransformation'\n        exclude 'LICENSE.txt'\n    }\n\n    compileOptions {\n        sourceCompatibility JavaVersion.VERSION_1_8\n        targetCompatibility JavaVersion.VERSION_1_8\n    }\n\n    defaultConfig {\n        applicationId \"com.example.name\"\n        minSdkVersion 16\n        targetSdkVersion 23\n        multiDexEnabled true\n        vectorDrawables.useSupportLibrary = true\n\n        testInstrumentationRunner \"android.support.test.runner.AndroidJUnitRunner\"\n        resValue \"string\", \"tray__authority\", \"${applicationId}.tray\"\n    }\n\n\n    dexOptions {\n        javaMaxHeapSize \"4g\"\n    }\n\n    retrolambda {\n        jvmArgs '-noverify'\n    }\n\n\n\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'\n        }\n        debug {\n            testCoverageEnabled = true\n        }\n    }\n}\n\nkapt {\n    generateStubs = true\n}\n\nrepositories {\n    jcenter()\n    mavenCentral()\n    maven {\n        url \"http://repo.bodar.com/\"\n    }\n    maven {\n        url \"https://clojars.org/repo/\"\n    }\n    maven { url \"http://oss.sonatype.org/content/repositories/snapshots/\" }\n}\n\ndependencies {\n    compile \"org.jetbrains.kotlin:kotlin-stdlib:$kotlin_version\"\n    compile \"org.jetbrains.anko:anko-common:$anko_version\"\n    androidTestCompile 'org.codehaus.groovy:groovy:2.4.2:grooid'\n    androidTestCompile 'com.andrewreitz:spock-android:1.2.2'\n    androidTestCompile 'com.android.support.test:testing-support-lib:0.1'\n    androidTestCompile('org.spockframework:spock-core:1.0-groovy-2.4') {\n        exclude group: 'org.codehaus.groovy'\n        exclude group: 'junit'\n    }\n    // Optional, needed for mocking\n    androidTestCompile 'com.google.dexmaker:dexmaker:1.2'\n\n    compile files('libs/nineoldandroids-2.4.0.jar')\n    compile files('libs/guava-18.0.jar')\n    provided 'org.projectlombok:lombok:1.16.4'\n    compile files('libs/icepick-2.3.6.jar')\n    compile files('libs/icepick-processor-2.3.6.jar')\n    compile files('libs/FlurryAnalytics-5.5.0.jar')\n    compile project(':fliclib')\n    compile \"com.android.support:support-annotations:$support_version\"\n    compile \"com.android.support:recyclerview-v7:$support_version\"\n    compile \"com.android.support:appcompat-v7:$support_version\"\n    compile \"com.android.support:design:$support_version\"\n    compile \"com.android.support:support-v4:$support_version\"\n    compile 'com.android.support:multidex:1.0.1'\n    compile 'com.androidplot:androidplot-core:0.9.6'\n    compile 'com.google.android.gms:play-services-analytics:8.4.0'\n    compile 'com.google.android.gms:play-services-gcm:8.4.0'\n    compile 'com.nhaarman.listviewanimations:lib-core:3.1.0@aar'\n    compile 'com.nhaarman.listviewanimations:lib-manipulation:3.1.0@aar'\n    compile 'com.nhaarman.listviewanimations:lib-core-slh:3.1.0@aar'\n    compile 'com.jakewharton:butterknife:7.0.1'\n    compile 'org.springframework.android:spring-android-rest-template:2.0.0.M1'\n    compile 'com.google.code.gson:gson:2.4'\n    compile 'com.joooonho:selectableroundedimageview:1.0.1'\n    compile 'com.googlecode.totallylazy:totallylazy:1.73'\n    compile 'net.grandcentrix.tray:tray:0.9.2'\n    compile 'org.solovyev.android.views:linear-layout-manager:0.5@aar'\n    compile 'jp.wasabeef:recyclerview-animators:2.1.0'\n    compile 'com.soundcloud.android:android-crop:1.0.1@aar'\n    compile 'com.github.castorflex.verticalviewpager:library:19.0.1'\n    compile 'com.github.traex.expandablelayout:library:1.3'\n}\n\napply plugin: 'com.google.gms.google-services'\n</code></pre>\n\n<p>Here is the manifest for that module (or rather it's heading as the code is propietary)</p>\n\n<pre><code>&lt;manifest package=\"com.package.name\"\n          xmlns:android=\"http://schemas.android.com/apk/res/android\"\n          android:versionCode=\"23\"\n          android:versionName=\"0.9.1\"&gt;\n</code></pre>\n"}, {"tags": ["gradle", "jvm", "travis-ci", "kotlin"], "answers": [{"tags": [], "owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "is_accepted": true, "score": 4, "last_activity_date": 1463568046, "last_edit_date": 1463568046, "creation_date": 1462205041, "answer_id": 36986757, "question_id": 36985347, "link": "https://stackoverflow.com/questions/36985347/my-kotlin-project-cannot-resolve-dependencies-on-travis-ci/36986757#36986757", "title": "My Kotlin project Cannot resolve dependencies on Travis-CI", "body": "<p>Add</p>\n\n<pre><code>repositories {\n     mavenCentral()\n}\n</code></pre>\n\n<p>to your <code>buildscript { ... }</code> scope as well.</p>\n\n<p>Also, consider using a newer Kotlin version, the up-to-date one can be found <a href=\"https://kotlinlang.org/docs/reference/using-gradle.html\" rel=\"nofollow\">here</a>.</p>\n"}], "owner": {"reputation": 1174, "user_id": 1704264, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/p4stn.png?s=128&g=1", "display_name": "Luan Castro", "link": "https://stackoverflow.com/users/1704264/luan-castro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1188, "favorite_count": 0, "accepted_answer_id": 36986757, "answer_count": 1, "score": 1, "last_activity_date": 1463568046, "creation_date": 1462200592, "question_id": 36985347, "link": "https://stackoverflow.com/questions/36985347/my-kotlin-project-cannot-resolve-dependencies-on-travis-ci", "title": "My Kotlin project Cannot resolve dependencies on Travis-CI", "body": "<p>I In an attempt to integrate my Kotlin project with Travis-CI, can not generate a successfully build, I get message that my gradle not found the repository ...</p>\n\n<p>The repository is in my file build.gradle</p>\n\n<pre><code>version '1.0-SNAPSHOT'\n\nbuildscript {\n    dependencies {\n        classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:1.0.0-beta-4584\"\n    }\n}\n\napply plugin: 'java'\napply plugin: 'kotlin'\n\nsourceCompatibility = 1.5\n\nrepositories {\n    mavenCentral()\n    maven {\n        url \"http://repository.jetbrains.com/all\"\n    }\n}\n\ndependencies {\n    testCompile 'org.spek:spek:0.1.188'\n    compile \"org.jetbrains.kotlin:kotlin-stdlib:1.0.0-beta-4584\"\n    testCompile group: 'junit', name: 'junit', version: '4.11'\n}\n</code></pre>\n\n<p>My travis is very simple</p>\n\n<pre><code>language: java\n</code></pre>\n\n<p>The message received is</p>\n\n<pre><code>FAILURE: Build failed with an exception.\n* What went wrong:\nA problem occurred configuring root project 'dojo-s01e01-cheque-por-extenso'.\n&gt; Could not resolve all dependencies for configuration ':classpath'.\n   &gt; Cannot resolve external dependency org.jetbrains.kotlin:kotlin-gradle-plugin:1.0.0-beta-4584 because no repositories are defined.\n     Required by:\n         :dojo-s01e01-cheque-por-extenso:unspecified\n* Try:\nRun with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output.\nBUILD FAILED\n</code></pre>\n\n<p>the Link to build is -> <a href=\"https://travis-ci.org/castrolol/dojo-s01e01-cheque-por-extenso.kotlin/builds/127235950\" rel=\"nofollow\">https://travis-ci.org/castrolol/dojo-s01e01-cheque-por-extenso.kotlin/builds/127235950</a></p>\n"}, {"tags": ["kotlin"], "comments": [{"owner": {"reputation": 341, "user_id": 5421493, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b6b6095bc8d6179fea9399fdd782ff6c?s=128&d=identicon&r=PG&f=1", "display_name": "Mahabub", "link": "https://stackoverflow.com/users/5421493/mahabub"}, "reply_to_user": {"reputation": 630270, "user_id": 571407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f0d9dec16bae1e06552af55ddefc11f?s=128&d=identicon&r=PG", "display_name": "JB Nizet", "link": "https://stackoverflow.com/users/571407/jb-nizet"}, "edited": false, "score": 0, "creation_date": 1462006809, "post_id": 36952815, "comment_id": 61463729, "body": "unresolve reference stream, unresolve reference Collectors"}, {"owner": {"reputation": 630270, "user_id": 571407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f0d9dec16bae1e06552af55ddefc11f?s=128&d=identicon&r=PG", "display_name": "JB Nizet", "link": "https://stackoverflow.com/users/571407/jb-nizet"}, "edited": false, "score": 0, "creation_date": 1462006946, "post_id": 36952815, "comment_id": 61463764, "body": "So the problem is not the lambda. The problem is that Kotlin collections don&#39;t have a stream() method. See <a href=\"https://youtrack.jetbrains.com/issue/KT-5175\" rel=\"nofollow noreferrer\">youtrack.jetbrains.com/issue/KT-5175</a>"}, {"owner": {"reputation": 341, "user_id": 5421493, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b6b6095bc8d6179fea9399fdd782ff6c?s=128&d=identicon&r=PG&f=1", "display_name": "Mahabub", "link": "https://stackoverflow.com/users/5421493/mahabub"}, "reply_to_user": {"reputation": 630270, "user_id": 571407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f0d9dec16bae1e06552af55ddefc11f?s=128&d=identicon&r=PG", "display_name": "JB Nizet", "link": "https://stackoverflow.com/users/571407/jb-nizet"}, "edited": false, "score": 0, "creation_date": 1462007009, "post_id": 36952815, "comment_id": 61463774, "body": "what is the kotlin way to get list of string from list of Account Object"}, {"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "edited": false, "score": 0, "creation_date": 1462832155, "post_id": 36952815, "comment_id": 61793335, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/35721528/how-can-i-call-collectcollectors-tolist-on-a-java-8-stream-in-kotlin\">How can I call collect(Collectors.toList()) on a Java 8 Stream in Kotlin?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 630270, "user_id": 571407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f0d9dec16bae1e06552af55ddefc11f?s=128&d=identicon&r=PG", "display_name": "JB Nizet", "link": "https://stackoverflow.com/users/571407/jb-nizet"}, "is_accepted": true, "score": 12, "last_activity_date": 1462007437, "last_edit_date": 1495540964, "creation_date": 1462007077, "answer_id": 36952922, "question_id": 36952815, "link": "https://stackoverflow.com/questions/36952815/java-8-lambda-to-kotlin-lambda/36952922#36952922", "title": "Java 8 lambda to kotlin lambda", "body": "<p>Kotlin collections don't have a <code>stream()</code> method.</p>\n\n<p>As mentioned in <a href=\"https://youtrack.jetbrains.com/issue/KT-5175\" rel=\"nofollow noreferrer\">https://youtrack.jetbrains.com/issue/KT-5175</a>, \nyou can use</p>\n\n<pre><code>(data1 as java.util.Collection&lt;Account&gt;).stream()...\n</code></pre>\n\n<p>or you can use one of the native Kotlin alternatives that don't use streams, listed in the answers to <a href=\"https://stackoverflow.com/questions/34642254/what-java-8-stream-collect-equivalents-are-available-in-the-standard-kotlin-libr\">this question</a>:</p>\n\n<pre><code>val list = data1.map { it.name }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "is_accepted": false, "score": 1, "last_activity_date": 1462832236, "last_edit_date": 1495541433, "creation_date": 1462831910, "answer_id": 37126264, "question_id": 36952815, "link": "https://stackoverflow.com/questions/36952815/java-8-lambda-to-kotlin-lambda/37126264#37126264", "title": "Java 8 lambda to kotlin lambda", "body": "<p>As @JBNizet says, don't use streams at all, if you are converting to Kotlin then convert all the way:</p>\n\n<pre><code>List&lt;String&gt; collect = data1.stream().map(account -&gt; account.getName()).collect(Collectors.toList());\n</code></pre>\n\n<p>to </p>\n\n<pre><code>val collect = data1.map { it.name } // already is a list, and use property `name`\n</code></pre>\n\n<p>and in other cases you will find that other collection types can become lists simply with <code>toList()</code> or to a set as <code>toSet()</code> and so on.  And everything in Streams has an equivalent in Kotlin runtime already.</p>\n\n<p>There is no need for Java 8 Streams at all with Kotlin, they are more verbose and add no value.  </p>\n\n<p>For more replacements to avoid Streams, read: <a href=\"https://stackoverflow.com/questions/34642254/what-java-8-stream-collect-equivalents-are-available-in-the-standard-kotlin-libr\">What Java 8 Stream.collect equivalents are available in the standard Kotlin library?</a></p>\n\n<p>You should read the following as well:</p>\n\n<ul>\n<li>Kotlin API reference for <a href=\"https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/index.html\" rel=\"nofollow noreferrer\"><code>kotlin.collections</code></a></li>\n<li>Kotlin API reference for <a href=\"https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.sequences/index.html\" rel=\"nofollow noreferrer\"><code>kotlin.sequences</code></a></li>\n</ul>\n\n<p>And maybe this is a duplicate of: <a href=\"https://stackoverflow.com/questions/35721528/how-can-i-call-collectcollectors-tolist-on-a-java-8-stream-in-kotlin\">How can I call collect(Collectors.toList()) on a Java 8 Stream in Kotlin?</a></p>\n"}], "owner": {"reputation": 341, "user_id": 5421493, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b6b6095bc8d6179fea9399fdd782ff6c?s=128&d=identicon&r=PG&f=1", "display_name": "Mahabub", "link": "https://stackoverflow.com/users/5421493/mahabub"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1936, "favorite_count": 0, "accepted_answer_id": 36952922, "answer_count": 2, "score": 5, "last_activity_date": 1462832236, "creation_date": 1462006293, "last_edit_date": 1462006880, "question_id": 36952815, "link": "https://stackoverflow.com/questions/36952815/java-8-lambda-to-kotlin-lambda", "title": "Java 8 lambda to kotlin lambda", "body": "<pre><code>public class Main {\n    static class Account {\n        private Long id;\n        private String name;\n        private Book book;\n\n        public Account(Long id, String name, Book book) {\n            this.id = id;\n            this.name = name;\n            this.book = book;\n        }\n\n        public String getName() {\n            return name;\n        }\n    }\n    public static void main(String[] args) {\n        List&lt;Account&gt; data1 = new ArrayList&lt;&gt;();\n        data1.add(new Account(1L,\"name\",null));\n        List&lt;String&gt; collect = data1.stream().map(account -&gt; account.getName()).collect(Collectors.toList());\n\n        System.out.println(collect);\n    }\n}\n</code></pre>\n\n<p>In the above code I am trying to convert the following line</p>\n\n<pre><code>List&lt;String&gt; collect = data1.stream().map(account -&gt; account.getName()).collect(Collectors.toList());\n</code></pre>\n\n<p>into kotlin code. Kotlin online editor gives me the following code</p>\n\n<pre><code> val collect = data1.stream().map({ account-&gt; account.getName() }).collect(Collectors.toList())\n    println(collect)\n</code></pre>\n\n<p>which gives compilation error when i try to run it.</p>\n\n<p>how to fix this???</p>\n\n<p>or what is the kotlin way to get list of string from list of Account Object</p>\n"}, {"tags": ["kotlin"], "answers": [{"tags": [], "owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "is_accepted": true, "score": 5, "last_activity_date": 1461972501, "creation_date": 1461972501, "answer_id": 36948975, "question_id": 36948888, "link": "https://stackoverflow.com/questions/36948888/kotlin-operator-cannot-be-applied-to-kotlin-int-and-person-error/36948975#36948975", "title": "Kotlin: Operator &#39;==&#39; cannot be applied to &#39;kotlin.Int&#39; and &#39;Person?&#39; Error", "body": "<p>Kotlin's <code>maxBy</code> function (<a href=\"https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/max-by.html\" rel=\"nofollow\">https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/max-by.html</a>) returns <code>T?</code> for an iterable of T (like a list of T's).</p>\n\n<p>Therefore, <code>people.maxBy(Person::age)</code> returns a value of type <code>Person?</code>, but you're trying to compare it to an integer. You can compare the age of this <code>Person?</code> if you wish:</p>\n\n<pre><code>people.filter { it.age == people.maxBy(Person::age)?.age }\n</code></pre>\n\n<p>Will output <code>[Person(name=Bob, age=31)]</code> for your sample.</p>\n"}, {"tags": [], "owner": {"reputation": 25812, "user_id": 288456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf294ff6d86cc587dec43e2af34a9532?s=128&d=identicon&r=PG", "display_name": "Alexander Udalov", "link": "https://stackoverflow.com/users/288456/alexander-udalov"}, "is_accepted": false, "score": 9, "last_activity_date": 1461972809, "creation_date": 1461972809, "answer_id": 36949022, "question_id": 36948888, "link": "https://stackoverflow.com/questions/36948888/kotlin-operator-cannot-be-applied-to-kotlin-int-and-person-error/36949022#36949022", "title": "Kotlin: Operator &#39;==&#39; cannot be applied to &#39;kotlin.Int&#39; and &#39;Person?&#39; Error", "body": "<p>Use <code>map</code> + <code>max</code> instead of <code>maxBy</code>. Also extract the maximum value to a variable to avoid computing it multiple times:</p>\n\n<pre><code>data class Person(val name: String, val age: Int)\nval people = listOf(Person(\"Alice\", 29), Person(\"Bob\", 31))\nval maxAge = people.map(Person::age).max()\npeople.filter { it.age == maxAge }\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1045, "user_id": 4410813, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-JSSJ_0XXr7o/AAAAAAAAAAI/AAAAAAAAKSQ/_Z5gjtDL1U0/photo.jpg?sz=128", "display_name": "jorgemf", "link": "https://stackoverflow.com/users/4410813/jorgemf"}, "edited": false, "score": 0, "creation_date": 1462890448, "post_id": 37062470, "comment_id": 61821345, "body": "So, why my solution which works is being downvoted? It returns a list of people with the maximum age. Other solutions are more inefficient as they requires to calculate the maximum per every comparison."}], "tags": [], "owner": {"reputation": 1045, "user_id": 4410813, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-JSSJ_0XXr7o/AAAAAAAAAAI/AAAAAAAAKSQ/_Z5gjtDL1U0/photo.jpg?sz=128", "display_name": "jorgemf", "link": "https://stackoverflow.com/users/4410813/jorgemf"}, "is_accepted": false, "score": 0, "last_activity_date": 1462890349, "last_edit_date": 1462890349, "creation_date": 1462495292, "answer_id": 37062470, "question_id": 36948888, "link": "https://stackoverflow.com/questions/36948888/kotlin-operator-cannot-be-applied-to-kotlin-int-and-person-error/37062470#37062470", "title": "Kotlin: Operator &#39;==&#39; cannot be applied to &#39;kotlin.Int&#39; and &#39;Person?&#39; Error", "body": "<p>I would do something like this:</p>\n\n<pre><code>list = people.groupBy{ it.age }.maxBy{ it.key }?.value\n</code></pre>\n"}], "owner": {"reputation": 381, "user_id": 6162031, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c2087196e379c933f145a94453e5e592?s=128&d=identicon&r=PG&f=1", "display_name": "MLev", "link": "https://stackoverflow.com/users/6162031/mlev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1779, "favorite_count": 0, "accepted_answer_id": 36948975, "answer_count": 3, "score": 2, "last_activity_date": 1462890349, "creation_date": 1461971943, "question_id": 36948888, "link": "https://stackoverflow.com/questions/36948888/kotlin-operator-cannot-be-applied-to-kotlin-int-and-person-error", "title": "Kotlin: Operator &#39;==&#39; cannot be applied to &#39;kotlin.Int&#39; and &#39;Person?&#39; Error", "body": "<p>I have the following code from the \"Kotlin In Action\" MEAP book that is supposed to find the maximum age of people in the group and return all people of that age:</p>\n\n<pre><code>data class Person(val name: String, val age: Int)\nval people = listOf(Person(\"Alice\", 29), Person(\"Bob\", 31))\npeople.filter {it.age == people.maxBy(Person::age)}\n</code></pre>\n\n<p>However, I am receiving the following error:  \"Kotlin: Operator '==' cannot be applied to 'kotlin.Int' and 'Person?'.\"  How do I fix the code to make it work?</p>\n"}, {"tags": ["interop", "aspectj", "kotlin"], "comments": [{"owner": {"reputation": 24586, "user_id": 3255152, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fbd95ef81d0a85310fee8dd46e0f65b0?s=128&d=identicon&r=PG&f=1", "display_name": "mfulton26", "link": "https://stackoverflow.com/users/3255152/mfulton26"}, "edited": false, "score": 0, "creation_date": 1462200765, "post_id": 36946057, "comment_id": 61525301, "body": "I&#39;ve created <a href=\"https://youtrack.jetbrains.com/issue/KT-12179\" rel=\"nofollow noreferrer\">youtrack.jetbrains.com/issue/KT-12179</a> with a demo project attached which reproduces the compilation error."}], "answers": [{"tags": [], "owner": {"reputation": 17986, "user_id": 4730812, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d336a10204c1cd2e7fa47071ed629669?s=128&d=identicon&r=PG&f=1", "display_name": "piotrek1543", "link": "https://stackoverflow.com/users/4730812/piotrek1543"}, "is_accepted": true, "score": 0, "last_activity_date": 1471382065, "creation_date": 1471382065, "answer_id": 38984598, "question_id": 36946057, "link": "https://stackoverflow.com/questions/36946057/kotlin-compilation-error-unresolved-aspectj-supertype/38984598#38984598", "title": "Kotlin compilation error: unresolved AspectJ supertype", "body": "<p>Problem was fixed in <code>AspectJ</code>. </p>\n\n<p>See <a href=\"https://bugs.eclipse.org/bugs/show_bug.cgi?id=493554\" rel=\"nofollow\">https://bugs.eclipse.org/bugs/show_bug.cgi?id=493554</a> for more details .</p>\n\n<p>Hope it will help.</p>\n"}], "owner": {"reputation": 24586, "user_id": 3255152, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fbd95ef81d0a85310fee8dd46e0f65b0?s=128&d=identicon&r=PG&f=1", "display_name": "mfulton26", "link": "https://stackoverflow.com/users/3255152/mfulton26"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 506, "favorite_count": 1, "accepted_answer_id": 38984598, "answer_count": 1, "score": 1, "last_activity_date": 1471382065, "creation_date": 1461957867, "question_id": 36946057, "link": "https://stackoverflow.com/questions/36946057/kotlin-compilation-error-unresolved-aspectj-supertype", "title": "Kotlin compilation error: unresolved AspectJ supertype", "body": "<p>I'm trying to use a Java library in my Kotlin project.</p>\n\n<p>Creating variables in my project of types defined in the library works fine, e.g. <code>val foo: Foo = fooProvider.get()</code>, but introducing code that actually <em>uses</em> these types, e.g. <code>foo.toString()</code>, causes a compilation error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Error:Kotlin: Supertypes of the following classes cannot be resolved. Please make sure you have the required dependencies in the classpath:\n    class com.example.Foo, unresolved supertypes: ajcMightHaveAspect\n</code></pre>\n\n<p>From what I have found so far my example <code>Foo</code> type <code>implements</code> <code>ajcMightHaveAspect</code> which is some type of AspectJ interface.</p>\n\n<p><code>aspectjrt</code> is on my classpath but I cannot find <code>ajcMightHaveAspect</code> defined anywhere.</p>\n\n<p>Is this a Kotlin compiler bug? Am I doing something wrong?</p>\n"}, {"tags": ["android", "android-ndk", "kotlin"], "comments": [{"owner": {"reputation": 51929, "user_id": 1524450, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BSzDV.png?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/1524450/michael"}, "edited": false, "score": 2, "creation_date": 1461917051, "post_id": 36932662, "comment_id": 61425285, "body": "Have you tried replacing <code>native</code> with <code>external</code>?"}, {"owner": {"reputation": 4784, "user_id": 3848666, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aHqMh.png?s=128&g=1", "display_name": "Ken Van Hoeylandt", "link": "https://stackoverflow.com/users/3848666/ken-van-hoeylandt"}, "edited": false, "score": 2, "creation_date": 1461917357, "post_id": 36932662, "comment_id": 61425485, "body": "Does it make a difference to put <code>native fun stringFromNative(): String</code> outside of the companion object and into the <code>MainActivity</code>?"}, {"owner": {"reputation": 568, "user_id": 3519135, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0ceede25916bef6abce5b945318954d1?s=128&d=identicon&r=PG&f=1", "display_name": "Garf1eld", "link": "https://stackoverflow.com/users/3519135/garf1eld"}, "reply_to_user": {"reputation": 4784, "user_id": 3848666, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aHqMh.png?s=128&g=1", "display_name": "Ken Van Hoeylandt", "link": "https://stackoverflow.com/users/3848666/ken-van-hoeylandt"}, "edited": false, "score": 0, "creation_date": 1461917653, "post_id": 36932662, "comment_id": 61425670, "body": "@KenVanHoeylandt Solved!Thank you!"}], "answers": [{"tags": [], "owner": {"reputation": 4784, "user_id": 3848666, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aHqMh.png?s=128&g=1", "display_name": "Ken Van Hoeylandt", "link": "https://stackoverflow.com/users/3848666/ken-van-hoeylandt"}, "is_accepted": true, "score": 11, "last_activity_date": 1461918165, "last_edit_date": 1461918165, "creation_date": 1461917869, "answer_id": 36933152, "question_id": 36932662, "link": "https://stackoverflow.com/questions/36932662/android-how-to-call-ndk-function-from-kotlin/36933152#36933152", "title": "Android: How to call ndk function from Kotlin?", "body": "<p>Put <code>external fun stringFromNative(): String</code> outside of the companion object and into the <code>MainActivity</code>.</p>\n\n<p>(I found the answer by looking at <a href=\"https://github.com/ligee/kotlin-ndk-samples\" rel=\"noreferrer\">https://github.com/ligee/kotlin-ndk-samples</a>)</p>\n"}, {"comments": [{"owner": {"reputation": 3249, "user_id": 7147233, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/94f37773a80589840319d063ee51ab16?s=128&d=identicon&r=PG&f=1", "display_name": "WhatsThePoint", "link": "https://stackoverflow.com/users/7147233/whatsthepoint"}, "edited": false, "score": 0, "creation_date": 1550049659, "post_id": 54666175, "comment_id": 96123304, "body": "Code only answers arent encouraged as they dont provide much information for future readers please provide some explanation to what you have written"}], "tags": [], "owner": {"reputation": 2639, "user_id": 6766264, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/PLc6P.jpg?s=128&g=1", "display_name": "Makvin", "link": "https://stackoverflow.com/users/6766264/makvin"}, "is_accepted": false, "score": 8, "last_activity_date": 1550048535, "creation_date": 1550048535, "answer_id": 54666175, "question_id": 36932662, "link": "https://stackoverflow.com/questions/36932662/android-how-to-call-ndk-function-from-kotlin/54666175#54666175", "title": "Android: How to call ndk function from Kotlin?", "body": "<pre><code>Kotlin :\n\ncall method from ndk file\n external fun stringFromJNI(): String\n\n\n load c++ file\n companion object {\n        init {\n            System.loadLibrary(\"native-lib\")\n        }\n    }\n</code></pre>\n"}], "owner": {"reputation": 568, "user_id": 3519135, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0ceede25916bef6abce5b945318954d1?s=128&d=identicon&r=PG&f=1", "display_name": "Garf1eld", "link": "https://stackoverflow.com/users/3519135/garf1eld"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7095, "favorite_count": 3, "accepted_answer_id": 36933152, "answer_count": 2, "score": 13, "last_activity_date": 1601086264, "creation_date": 1461916310, "last_edit_date": 1601086264, "question_id": 36932662, "link": "https://stackoverflow.com/questions/36932662/android-how-to-call-ndk-function-from-kotlin", "title": "Android: How to call ndk function from Kotlin?", "body": "<p>This code works on Java. But after migration to Kotlin, compiler higlits method  <code>native fun stringFromNative(): String</code> as error with  following text:</p>\n<blockquote>\n<p>Function without a body must be abstract</p>\n</blockquote>\n<pre><code>class MainActivity : AppCompatActivity() {\n\noverride fun onCreate(savedInstanceState: Bundle?) {\n    super.onCreate(savedInstanceState)\n    setContentView(R.layout.activity_main)\n\n    Toast.makeText(this, stringFromNative(), Toast.LENGTH_LONG).show()\n}\n\ncompanion object {\n\n    init {\n        System.loadLibrary(&quot;_ndkkt&quot;)\n    }\n    native fun stringFromNative(): String\n}\n}\n</code></pre>\n<p>Thanks @KenVanHoeylandt!</p>\n<p>Andswer is:</p>\n<pre><code>class MainActivity : AppCompatActivity() {\n\noverride fun onCreate(savedInstanceState: Bundle?) {\n    super.onCreate(savedInstanceState)\n    setContentView(R.layout.activity_main)\n\n    Toast.makeText(this, stringFromNative(), Toast.LENGTH_LONG).show()\n}\n\n   init {\n        System.loadLibrary(&quot;_ndkkt&quot;)\n    }\n\n    external fun getStringFromNative(): String\n}\n\n}\n</code></pre>\n<p>If you wish to use this native function in another class you can specify the class which encloses it as in:</p>\n<pre><code>val aStringFromNative : String = MainActivity().getStringFromNative()\n</code></pre>\n"}, {"tags": ["android", "kotlin"], "answers": [{"tags": [], "owner": {"reputation": 89682, "user_id": 675383, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/6e7a971eb341ffeaa3efca407239bf3b?s=128&d=identicon&r=PG", "display_name": "nhaarman", "link": "https://stackoverflow.com/users/675383/nhaarman"}, "is_accepted": true, "score": 4, "last_activity_date": 1461836876, "creation_date": 1461836876, "answer_id": 36910991, "question_id": 36910834, "link": "https://stackoverflow.com/questions/36910834/kotlin-collections-throw-classnotfoundexception-on-android/36910991#36910991", "title": "Kotlin collections throw ClassNotFoundException on Android", "body": "<p>You need to depend on the Kotlin standard library which contains these classes:</p>\n\n<pre><code>dependencies {\n   /* ... */\n   compile \"org.jetbrains.kotlin:kotlin-stdlib:$kotlin_version\"\n}\n</code></pre>\n"}], "owner": {"reputation": 2427, "user_id": 3309681, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/246bcef5402ea06302c68bd02301e54d?s=128&d=identicon&r=PG&f=1", "display_name": "Suyash", "link": "https://stackoverflow.com/users/3309681/suyash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3911, "favorite_count": 0, "accepted_answer_id": 36910991, "answer_count": 1, "score": 6, "last_activity_date": 1461836876, "creation_date": 1461836439, "question_id": 36910834, "link": "https://stackoverflow.com/questions/36910834/kotlin-collections-throw-classnotfoundexception-on-android", "title": "Kotlin collections throw ClassNotFoundException on Android", "body": "<p>Using any of the lines below throws a ClassNotFoundException when app is run on Android.</p>\n\n<pre><code>val list = listOf(\"a\", \"b\")\nval arrayList = arrayListOf(\"a\", \"b\")\nval map = mapOf(\"key\" to \"value\")\n</code></pre>\n\n<p>The exception:</p>\n\n<pre><code>04-28 15:12:00.770 27326-27326/com.example.kotlin E/AndroidRuntime: FATAL EXCEPTION: main\nProcess: com.example.kotlin, PID: 27326\njava.lang.NoClassDefFoundError: Failed resolution of: Lkotlin/collections/CollectionsKt;\n    at com.example.kotlin.MainActivity.onCreate(MainActivity.kt:17)\n    at android.app.Activity.performCreate(Activity.java:6237)\n    at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1107)\n    at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2369)\n    at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:2476)\n    at android.app.ActivityThread.-wrap11(ActivityThread.java)\n    at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1344)\n    at android.os.Handler.dispatchMessage(Handler.java:102)\n    at android.os.Looper.loop(Looper.java:148)\n    at android.app.ActivityThread.main(ActivityThread.java:5417)\n    at java.lang.reflect.Method.invoke(Native Method)\n    at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:726)\n    at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:616)\n Caused by: java.lang.ClassNotFoundException: Didn't find class \"kotlin.collections.CollectionsKt\" on path: DexPathList[[zip file \"/data/app/com.example.kotlin-1/base.apk\"],nativeLibraryDirectories=[/data/app/com.example.kotlin-1/lib/x86, /vendor/lib, /system/lib]]\n    at dalvik.system.BaseDexClassLoader.findClass(BaseDexClassLoader.java:56)\n    at java.lang.ClassLoader.loadClass(ClassLoader.java:511)\n    at java.lang.ClassLoader.loadClass(ClassLoader.java:469)\n    at com.example.kotlin.MainActivity.onCreate(MainActivity.kt:17)\u00a0\n    at android.app.Activity.performCreate(Activity.java:6237)\u00a0\n    at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1107)\u00a0\n    at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2369)\u00a0\n    at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:2476)\u00a0\n    at android.app.ActivityThread.-wrap11(ActivityThread.java)\u00a0\n    at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1344)\u00a0\n    at android.os.Handler.dispatchMessage(Handler.java:102)\u00a0\n    at android.os.Looper.loop(Looper.java:148)\u00a0\n    at android.app.ActivityThread.main(ActivityThread.java:5417)\u00a0\n    at java.lang.reflect.Method.invoke(Native Method)\u00a0\n    at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:726)\u00a0\n    at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:616)\u00a0\n    Suppressed: java.lang.ClassNotFoundException: kotlin.collections.CollectionsKt\n    at java.lang.Class.classForName(Native Method)\n    at java.lang.BootClassLoader.findClass(ClassLoader.java:781)\n    at java.lang.BootClassLoader.loadClass(ClassLoader.java:841)\n    at java.lang.ClassLoader.loadClass(ClassLoader.java:504)\n            ... 14 more\n Caused by: java.lang.NoClassDefFoundError: Class not found using the boot class loader; no stack trace available\n</code></pre>\n\n<p>The following is my app module gradle file:</p>\n\n<pre><code>apply plugin: 'com.android.application'\napply plugin: 'kotlin-android'\napply plugin: 'kotlin-android-extensions'\n\nandroid {\n    compileSdkVersion 23\n    buildToolsVersion \"24.0.0 rc3\"\n\n    defaultConfig {\n        applicationId \"com.example.kotlin\"\n        minSdkVersion 16\n        targetSdkVersion 23\n        versionCode 1\n        versionName \"1.0\"\n    }\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'\n        }\n    }\n    dataBinding {\n        enabled = true\n    }\n    sourceSets {\n        main.java.srcDirs += 'src/main/kotlin'\n    }\n}\n\ndependencies {\n    compile fileTree(dir: 'libs', include: ['*.jar'])\n    testCompile 'junit:junit:4.12'\n    compile 'com.android.support:appcompat-v7:23.3.0'\n    compile 'com.android.support:gridlayout-v7:23.3.0'\n    compile 'com.android.support:cardview-v7:23.3.0'\n\n    kapt 'com.android.databinding:compiler:2.1.0-beta3'\n}\n\nbuildscript {\n    ext.kotlin_version = '1.0.1-2'\n    repositories {\n        mavenCentral()\n    }\n    dependencies {\n        classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version\"\n    }\n}\nrepositories {\n    mavenCentral()\n}\n\nkapt {\n    generateStubs = true\n}\n</code></pre>\n\n<p>Is there any other dependency I need to add to gradle in order to use any of the Kotlin collection classes?</p>\n"}, {"tags": ["spring", "rest", "spring-boot", "patch", "kotlin"], "comments": [{"owner": {"reputation": 9502, "user_id": 1377895, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/08b21d815dc9a832a99bf93b6f28f01b?s=128&d=identicon&r=PG", "display_name": "Roman Vottner", "link": "https://stackoverflow.com/users/1377895/roman-vottner"}, "edited": false, "score": 1, "creation_date": 1461833115, "post_id": 36907723, "comment_id": 61381793, "body": "A patch is a collection of single instructions the server has to execute in order to transform state A into state B. The client therefore has to tell the server which instructions are needed for the transformation. Look at <a href=\"http://jsonpatch.com/\" rel=\"nofollow noreferrer\">JSON Patch</a> on how a PATCH request body may look like. As you&#39;ve also asked about what to do if a field to remove is not available: The <a href=\"https://tools.ietf.org/html/rfc5789\" rel=\"nofollow noreferrer\">PATCH RFC</a> clearly states: either all instructions succeed or none (atomicity)"}, {"owner": {"reputation": 32343, "user_id": 155213, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57bc3e08faeb981ddc81abd1d25c3bf1?s=128&d=identicon&r=PG", "display_name": "miensol", "link": "https://stackoverflow.com/users/155213/miensol"}, "reply_to_user": {"reputation": 9502, "user_id": 1377895, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/08b21d815dc9a832a99bf93b6f28f01b?s=128&d=identicon&r=PG", "display_name": "Roman Vottner", "link": "https://stackoverflow.com/users/1377895/roman-vottner"}, "edited": false, "score": 4, "creation_date": 1461833635, "post_id": 36907723, "comment_id": 61382128, "body": "@RomanVottner <a href=\"https://tools.ietf.org/html/rfc6902\" rel=\"nofollow noreferrer\">JSON Patch</a> indeed might be valid alternative however it&#39;s not as easy to implement on the client side as plain old <a href=\"https://tools.ietf.org/html/rfc5789\" rel=\"nofollow noreferrer\">http PATCH</a> assuming following natural description of changes i.e. <code>{name: &quot;Mario&quot;}</code> mreaning <i>update <code>name</code> attribute value to <code>&quot;Mario&quot;</code></i>. How would the request validation work in case of JSON Patch?"}, {"owner": {"reputation": 9502, "user_id": 1377895, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/08b21d815dc9a832a99bf93b6f28f01b?s=128&d=identicon&r=PG", "display_name": "Roman Vottner", "link": "https://stackoverflow.com/users/1377895/roman-vottner"}, "edited": false, "score": 0, "creation_date": 1461833647, "post_id": 36907723, "comment_id": 61382138, "body": "Btw: the versioning is used on the API and not on the resource. You can also use versioning on the resource but this is often handled with <code>ETAG</code> or <code>If-Modified</code> headers or a further resource-property like <code>version</code>"}, {"owner": {"reputation": 9502, "user_id": 1377895, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/08b21d815dc9a832a99bf93b6f28f01b?s=128&d=identicon&r=PG", "display_name": "Roman Vottner", "link": "https://stackoverflow.com/users/1377895/roman-vottner"}, "reply_to_user": {"reputation": 32343, "user_id": 155213, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57bc3e08faeb981ddc81abd1d25c3bf1?s=128&d=identicon&r=PG", "display_name": "miensol", "link": "https://stackoverflow.com/users/155213/miensol"}, "edited": false, "score": 1, "creation_date": 1461834333, "post_id": 36907723, "comment_id": 61382586, "body": "@miensol I&#39;m not sure what you are asking for in particular. Do you mean how a client has to create the JSON-Patch body for the name change? Or how the server should execute each instruction? For the primer one: client has state A of a resource but he wants the resource to be state B. He will have to iterate over all fields that need to be changed and add an instruction to the JSON-Patch message. The server will have to create a transaction and try to perform the changes via update instructions. New fields might need DB table altering beforhand and UPDATE instructions to the DB layer"}, {"owner": {"reputation": 32343, "user_id": 155213, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57bc3e08faeb981ddc81abd1d25c3bf1?s=128&d=identicon&r=PG", "display_name": "miensol", "link": "https://stackoverflow.com/users/155213/miensol"}, "reply_to_user": {"reputation": 9502, "user_id": 1377895, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/08b21d815dc9a832a99bf93b6f28f01b?s=128&d=identicon&r=PG", "display_name": "Roman Vottner", "link": "https://stackoverflow.com/users/1377895/roman-vottner"}, "edited": false, "score": 1, "creation_date": 1461834714, "post_id": 36907723, "comment_id": 61382860, "body": "@RomanVottner By validation I meant validation of the request <b>on the server side</b> ideally annotation driven as in the example provided in the question. I agree that using transactional boundary to provide atomicity of the whole operation is the way to go. However the question doesn&#39;t mention using DB."}, {"owner": {"reputation": 9502, "user_id": 1377895, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/08b21d815dc9a832a99bf93b6f28f01b?s=128&d=identicon&r=PG", "display_name": "Roman Vottner", "link": "https://stackoverflow.com/users/1377895/roman-vottner"}, "reply_to_user": {"reputation": 32343, "user_id": 155213, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57bc3e08faeb981ddc81abd1d25c3bf1?s=128&d=identicon&r=PG", "display_name": "miensol", "link": "https://stackoverflow.com/users/155213/miensol"}, "edited": false, "score": 1, "creation_date": 1461836628, "post_id": 36907723, "comment_id": 61384269, "body": "@miensol Instead of using a tailor-made <code>PatchUserRequest</code> a more generic class can be used which holds a list of JSON objects (the concrete instructions) which on iterating through the list, might check in a mapping for a field to a validation rule if the value adheres to the validation rule defined in the mapping or fails otherwise which would cause the transaction to roll back. This might also be possible with specifying constraints on the data layer itself (altough you try to neglect DBs for the OPs actual question)"}, {"owner": {"reputation": 9502, "user_id": 1377895, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/08b21d815dc9a832a99bf93b6f28f01b?s=128&d=identicon&r=PG", "display_name": "Roman Vottner", "link": "https://stackoverflow.com/users/1377895/roman-vottner"}, "reply_to_user": {"reputation": 32343, "user_id": 155213, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57bc3e08faeb981ddc81abd1d25c3bf1?s=128&d=identicon&r=PG", "display_name": "miensol", "link": "https://stackoverflow.com/users/155213/miensol"}, "edited": false, "score": 1, "creation_date": 1461843109, "post_id": 36907723, "comment_id": 61388758, "body": "@miensol I&#39;m currently not aware of a sample implementation yet. If I find time I will give it a shot"}], "answers": [{"comments": [{"owner": {"reputation": 32343, "user_id": 155213, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57bc3e08faeb981ddc81abd1d25c3bf1?s=128&d=identicon&r=PG", "display_name": "miensol", "link": "https://stackoverflow.com/users/155213/miensol"}, "edited": false, "score": 3, "creation_date": 1462612651, "post_id": 36976259, "comment_id": 61717513, "body": "The validation on <a href=\"http://stackoverflow.com/questions/6283726/jsf-jsr-303-bean-validation-why-on-getter-and-not-setter\">the setter alone will not work</a>. If you move it to the getter you&#39;d still need to, based on <code>containsName</code>, <b>either prevent validation from being fired</b> or <b>filter out actual errors</b> related to <code>getName</code>."}], "tags": [], "owner": {"reputation": 1910, "user_id": 2472066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17e8fc1cad4aa24aacbfcc6b80d653a9?s=128&d=identicon&r=PG&f=1", "display_name": "niekname", "link": "https://stackoverflow.com/users/2472066/niekname"}, "is_accepted": false, "score": 8, "last_activity_date": 1462170841, "creation_date": 1462170841, "answer_id": 36976259, "question_id": 36907723, "link": "https://stackoverflow.com/questions/36907723/how-to-do-patch-properly-in-strongly-typed-languages-based-on-spring-example/36976259#36976259", "title": "How to do PATCH properly in strongly typed languages based on Spring - example", "body": "<p>I have had the same problem, so here are my experiences / solutions.</p>\n\n<p>I would suggest that you implement the patch as it should be, so if</p>\n\n<ul>\n<li>a key is present with a value > the value is set</li>\n<li>a key is present with an empty string > the empty string is set</li>\n<li>a key is present with a null value > the field is set to null</li>\n<li>a key is absent > the value for that key is not changed</li>\n</ul>\n\n<p>If you don't do that, you'll soon get an api which is hard to understand.</p>\n\n<p>So I would drop your first option </p>\n\n<blockquote>\n  <p>Agree with the client that if he wants to remove a property he should send me an empty string (but what about dates and other non-string types?)</p>\n</blockquote>\n\n<p>The second option is actually a good option in my opinion. And that is also what we did (kind of).</p>\n\n<p>I'm not sure if you can make the validation properties work with this option, but then again, should this validation not be on your domain layer? This could throw an exception from the domain which is handled by the rest layer and translated into a bad request.</p>\n\n<p>This is how we did it in one application:</p>\n\n<pre><code>class PatchUserRequest {\n  private boolean containsName = false;\n  private String name;\n\n  private boolean containsEmail = false;\n  private String email;\n\n  @Length(max = 100) // haven't tested this, but annotation is allowed on method, thus should work\n  void setName(String name) {\n    this.containsName = true;\n    this.name = name;\n  }\n\n  boolean containsName() {\n    return containsName;\n  }\n\n  String getName() {\n    return name;\n  }\n}\n...\n</code></pre>\n\n<p>The json deserializer will instantiate the PatchUserRequest but it will only call the setter method for fields that are present. So the contains boolean for missing fields will remain false.</p>\n\n<p>In another app we used the same principle but a little different. (I prefer this one)</p>\n\n<pre><code>class PatchUserRequest {\n  private static final String NAME_KEY = \"name\";\n\n  private Map&lt;String, ?&gt; fields = new HashMap&lt;&gt;();;\n\n  @Length(max = 100) // haven't tested this, but annotation is allowed on method, thus should work\n  void setName(String name) {\n    fields.put(NAME_KEY, name);\n  }\n\n  boolean containsName() {\n    return fields.containsKey(NAME_KEY);\n  }\n\n  String getName() {\n    return (String) fields.get(NAME_KEY);\n  }\n}\n...\n</code></pre>\n\n<p>You could also do the same by letting your PatchUserRequest extend Map.</p>\n\n<p>Another option might be to write your own json deserializer, but I haven't tried that myself.</p>\n\n<blockquote>\n  <p>One could say that PATCH shouldn't be used in such example and I should use PUT to update my User.</p>\n</blockquote>\n\n<p>I don't agree with this. I also use PATCH &amp; PUT the same way as you stated:</p>\n\n<ul>\n<li>PUT - update object with its whole representation (replace)</li>\n<li>PATCH - update object with given fields only (update)</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 8617, "user_id": 638225, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df8bebd125339c83eb28e0f9aa48ced1?s=128&d=identicon&r=PG", "display_name": "Christoph Leiter", "link": "https://stackoverflow.com/users/638225/christoph-leiter"}, "is_accepted": false, "score": 4, "last_activity_date": 1462298853, "last_edit_date": 1462298853, "creation_date": 1462297432, "answer_id": 37010895, "question_id": 36907723, "link": "https://stackoverflow.com/questions/36907723/how-to-do-patch-properly-in-strongly-typed-languages-based-on-spring-example/37010895#37010895", "title": "How to do PATCH properly in strongly typed languages based on Spring - example", "body": "<p>As you noted the main problem is that we don't have multiple null-like values to distinguish between explicit and implicit nulls. Since you tagged this question Kotlin I tried to come up with a solution which uses <a href=\"https://kotlinlang.org/docs/reference/delegated-properties.html\" rel=\"nofollow\">Delegated Properties</a> and <a href=\"https://kotlinlang.org/docs/reference/reflection.html\" rel=\"nofollow\">Property References</a>. One important constraint is that it works transparently with Jackson which is used by Spring Boot.</p>\n\n<p>The idea is to automatically store the information which fields have been explicitly set to null by using delegated properties.</p>\n\n<p>First define the delegate:</p>\n\n<pre><code>class ExpNull&lt;R, T&gt;(private val explicitNulls: MutableSet&lt;KProperty&lt;*&gt;&gt;) {\n    private var v: T? = null\n    operator fun getValue(thisRef: R, property: KProperty&lt;*&gt;) = v\n    operator fun setValue(thisRef: R, property: KProperty&lt;*&gt;, value: T) {\n        if (value == null) explicitNulls += property\n        else explicitNulls -= property\n        v = value\n    }\n}\n</code></pre>\n\n<p>This acts like a proxy for the property but stores the null properties in the given <code>MutableSet</code>.</p>\n\n<p>Now in your <code>DTO</code>:</p>\n\n<pre><code>class User {\n    val explicitNulls = mutableSetOf&lt;KProperty&lt;*&gt;&gt;() \n    var name: String? by ExpNull(explicitNulls)\n}\n</code></pre>\n\n<p>Usage is something like this:</p>\n\n<pre><code>@Test fun `test with missing field`() {\n    val json = \"{}\"\n\n    val user = ObjectMapper().readValue(json, User::class.java)\n    assertTrue(user.name == null)\n    assertTrue(user.explicitNulls.isEmpty())\n}\n\n@Test fun `test with explicit null`() {\n    val json = \"{\\\"name\\\": null}\"\n\n    val user = ObjectMapper().readValue(json, User::class.java)\n    assertTrue(user.name == null)\n    assertEquals(user.explicitNulls, setOf(User::name))\n}\n</code></pre>\n\n<p>This works because Jackson explicitly calls <code>user.setName(null)</code> in the second case and omits the call in the first case.</p>\n\n<p>You can of course get a bit more fancy and add some methods to an interface which your DTO should implement.</p>\n\n<pre><code>interface ExpNullable {\n    val explicitNulls: Set&lt;KProperty&lt;*&gt;&gt;\n\n    fun isExplicitNull(property: KProperty&lt;*&gt;) = property in explicitNulls\n}\n</code></pre>\n\n<p>Which makes the checks a bit nicer with <code>user.isExplicitNull(User::name)</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 32343, "user_id": 155213, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57bc3e08faeb981ddc81abd1d25c3bf1?s=128&d=identicon&r=PG", "display_name": "miensol", "link": "https://stackoverflow.com/users/155213/miensol"}, "is_accepted": true, "score": 20, "last_activity_date": 1462623215, "last_edit_date": 1495542753, "creation_date": 1462404649, "answer_id": 37039815, "question_id": 36907723, "link": "https://stackoverflow.com/questions/36907723/how-to-do-patch-properly-in-strongly-typed-languages-based-on-spring-example/37039815#37039815", "title": "How to do PATCH properly in strongly typed languages based on Spring - example", "body": "<h2>TL;DR</h2>\n\n<p><strong><a href=\"https://github.com/bright/patchy\" rel=\"noreferrer\">patchy</a></strong> is a tiny library I've come up with that takes care of the major boilerplate code needed to properly handle <code>PATCH</code> in Spring i.e.:</p>\n\n<pre><code>class Request : PatchyRequest {\n    @get:NotBlank\n    val name:String? by { _changes }\n\n    override var _changes = mapOf&lt;String,Any?&gt;()\n}\n\n@RestController\nclass PatchingCtrl {\n    @RequestMapping(\"/\", method = arrayOf(RequestMethod.PATCH))\n    fun update(@Valid request: Request){\n        request.applyChangesTo(entity)\n    }\n}\n</code></pre>\n\n<h3>Simple solution</h3>\n\n<p>Since <a href=\"https://tools.ietf.org/html/rfc5789\" rel=\"noreferrer\"><code>PATCH</code></a> request represent changes to be applied to the resource we need to model it explicitly. </p>\n\n<p>One way is to use a plain old <code>Map&lt;String,Any?&gt;</code> where every <code>key</code> submitted by a client would represent a change to the corresponding attribute of the resource:</p>\n\n<pre><code>@RequestMapping(\"/entity/{id}\", method = arrayOf(RequestMethod.PATCH))\nfun update(@RequestBody changes:Map&lt;String,Any?&gt;, @PathVariable id:Long) {\n    val entity = db.find&lt;Entity&gt;(id)\n    changes.forEach { entry -&gt;\n        when(entry.key){\n            \"firstName\" -&gt; entity.firstName = entry.value?.toString() \n            \"lastName\" -&gt; entity.lastName = entry.value?.toString() \n        }\n    }\n    db.save(entity)\n}\n</code></pre>\n\n<p>The above is very easy to follow however:</p>\n\n<ul>\n<li>we <strong>do not have validation</strong> of the request values</li>\n</ul>\n\n<p>The above can be mitigated by introducing validation annotations on the domain layer objects. While this is very convenient in simple scenarios it tends to be impractical as soon as we introduce <a href=\"https://stackoverflow.com/questions/1972933/cross-field-validation-with-hibernate-validator-jsr-303\">conditional validation</a> depending on the state of the domain object or on the role of the principal performing a change. More importantly after the product lives for a while and new validation rules are introduced it's pretty common to still allow for an entity to be update in non user edit contexts. It seems to be more pragmatic to <a href=\"https://lostechies.com/jimmybogard/2010/02/24/strengthening-your-domain-aggregate-construction/\" rel=\"noreferrer\">enforce invariants on the domain layer</a> but <a href=\"https://lostechies.com/jimmybogard/2016/04/29/validation-inside-or-outside-entities/\" rel=\"noreferrer\">keep the validation at the edges</a>.</p>\n\n<ul>\n<li>will be very similar in potentially many places</li>\n</ul>\n\n<p>This is actually very easy to tackle and in 80% of cases the following would work:</p>\n\n<pre><code>fun Map&lt;String,Any?&gt;.applyTo(entity:Any) {\n    val entityEditor = BeanWrapperImpl(entity)\n    forEach { entry -&gt;\n        if(entityEditor.isWritableProperty(entry.key)){\n            entityEditor.setPropertyValue(entry.key, entityEditor.convertForProperty(entry.value, entry.key))\n        }\n    }\n}\n</code></pre>\n\n<h3>Validating the request</h3>\n\n<p>Thanks to <a href=\"https://kotlinlang.org/docs/reference/delegated-properties.html\" rel=\"noreferrer\">delegated properties in Kotlin</a> it's very easy to build a wrapper around <code>Map&lt;String,Any?&gt;</code>:</p>\n\n<pre><code>class NameChangeRequest(val changes: Map&lt;String, Any?&gt; = mapOf()) {\n    @get:NotBlank\n    val firstName: String? by changes\n    @get:NotBlank\n    val lastName: String? by changes\n}\n</code></pre>\n\n<p>And using <a href=\"http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/validation/Validator.html#validate-java.lang.Object-org.springframework.validation.Errors-\" rel=\"noreferrer\"><code>Validator</code></a> interface we can filter out errors related to attributes not present in the request like so:</p>\n\n<pre><code>fun filterOutFieldErrorsNotPresentInTheRequest(target:Any, attributesFromRequest: Map&lt;String, Any?&gt;?, source: Errors): BeanPropertyBindingResult {\n    val attributes = attributesFromRequest ?: emptyMap()\n    return BeanPropertyBindingResult(target, source.objectName).apply {\n        source.allErrors.forEach { e -&gt;\n            if (e is FieldError) {\n                if (attributes.containsKey(e.field)) {\n                    addError(e)\n                }\n            } else {\n                addError(e)\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Obviously we can streamline the development with <a href=\"http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/method/support/HandlerMethodArgumentResolver.html\" rel=\"noreferrer\"><code>HandlerMethodArgumentResolver</code></a> which I did below.</p>\n\n<h3>Simplest solution</h3>\n\n<p>I thought that it would make sense to wrap what've described above into a simple to use library - behold <a href=\"https://github.com/bright/patchy\" rel=\"noreferrer\"><strong>patchy</strong></a>. With <strong>patchy</strong> one can have a strongly typed request input model along with declarative validations. All you have to do is to import the configuration <code>@Import(PatchyConfiguration::class)</code> and implement <code>PatchyRequest</code> interface in your model.</p>\n\n<h3>Further reading</h3>\n\n<ul>\n<li><a href=\"https://spring.io/blog/2014/10/22/introducing-spring-sync\" rel=\"noreferrer\">Spring Sync</a></li>\n<li><a href=\"https://github.com/fge/json-patch\" rel=\"noreferrer\">fge/json-patch</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 71, "user_id": 9594388, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc1491c2c83a1ebbf71bcd9f3bc8335f?s=128&d=identicon&r=PG&f=1", "display_name": "voychris", "link": "https://stackoverflow.com/users/9594388/voychris"}, "is_accepted": false, "score": 3, "last_activity_date": 1522813877, "creation_date": 1522813877, "answer_id": 49642461, "question_id": 36907723, "link": "https://stackoverflow.com/questions/36907723/how-to-do-patch-properly-in-strongly-typed-languages-based-on-spring-example/49642461#49642461", "title": "How to do PATCH properly in strongly typed languages based on Spring - example", "body": "<p>What I do in some of the applications is create an <code>OptionalInput</code> class which can distinguish whether a value is set or not:</p>\n\n<pre><code>class OptionalInput&lt;T&gt; {\n\n    private boolean _isSet = false\n\n    @Valid\n    private T value\n\n    void set(T value) {\n        this._isSet = true\n        this.value = value\n    }\n\n    T get() {\n        return this.value\n    }\n\n    boolean isSet() {\n        return this._isSet\n    }\n}\n</code></pre>\n\n<p>Then in your request class:</p>\n\n<pre><code>class PatchUserRequest {\n\n    @OptionalInputLength(max = 100L)\n    final OptionalInput&lt;String&gt; name = new OptionalInput&lt;&gt;()\n\n    void setName(String name) {\n        this.name.set(name)\n    }\n}\n</code></pre>\n\n<p>The properties can be validated by creating a <code>@OptionalInputLength</code>.</p>\n\n<p>Usage is:</p>\n\n<pre><code>void update(@Valid @RequestBody PatchUserRequest request) {\n    if (request.name.isSet()) {\n        // Do the stuff\n    }\n}\n</code></pre>\n\n<p>NOTE: The code is written in <code>groovy</code> but you get the idea. I've used this approach for a few APIs already and it seems to be doing it's job quite well.</p>\n"}], "owner": {"reputation": 11090, "user_id": 1570496, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/EtLKv.jpg?s=128&g=1", "display_name": "KlimczakM", "link": "https://stackoverflow.com/users/1570496/klimczakm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10425, "favorite_count": 14, "accepted_answer_id": 37039815, "answer_count": 4, "score": 56, "last_activity_date": 1614682418, "creation_date": 1461827506, "last_edit_date": 1551261922, "question_id": 36907723, "link": "https://stackoverflow.com/questions/36907723/how-to-do-patch-properly-in-strongly-typed-languages-based-on-spring-example", "title": "How to do PATCH properly in strongly typed languages based on Spring - example", "body": "<p>According to my knowledge:</p>\n\n<ul>\n<li><code>PUT</code> - update object with its whole representation (replace)</li>\n<li><code>PATCH</code> - update object with given fields only (update)</li>\n</ul>\n\n<p>I'm using Spring to implement a pretty simple HTTP server. When a user wants to update his data he needs to make a HTTP <code>PATCH</code> to some endpoint (let's say: <code>api/user</code>). His request body is mapped to a DTO via <code>@RequestBody</code>, which looks like this:</p>\n\n<pre><code>class PatchUserRequest {\n    @Email\n    @Length(min = 5, max = 50)\n    var email: String? = null\n\n    @Length(max = 100)\n    var name: String? = null\n    ...\n}\n</code></pre>\n\n<p>Then I use an object of this class to update (patch) the user object:</p>\n\n<pre><code>fun patchWithRequest(userRequest: PatchUserRequest) {\n    if (!userRequest.email.isNullOrEmpty()) {\n        email = userRequest.email!!\n    }\n    if (!userRequest.name.isNullOrEmpty()) {\n        name = userRequest.name\n    }    \n    ...\n}\n</code></pre>\n\n<p>My doubt is: what if a client (web app for example) would like to clear a property? I would ignore such a change. </p>\n\n<p><strong>How can I know, if a user wanted to clear a property (he sent me null intentionally) or he just doesn't want to change it? It will be null in my object in both cases.</strong></p>\n\n<p>I can see two options here:</p>\n\n<ul>\n<li>Agree with the client that if he wants to remove a property he should send me an empty string (but what about dates and other non-string types?)</li>\n<li>Stop using DTO mapping and use a simple map, which will let me check if a field was given empty or not given at all. What about request body validation then? I use <code>@Valid</code> right now.</li>\n</ul>\n\n<p>How should such cases should be properly handled, in harmony with REST and all good practices?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>One could say that <code>PATCH</code> shouldn't be used in such an example, and I should use <code>PUT</code> to update my User. But what about model changes (e.g. adding a new property)? I would have to version my API (or the user endpoint alone) after every User change. E.g. I would have <code>api/v1/user</code> endpoint which accepts <code>PUT</code> with an old request body, and <code>api/v2/user</code> endpoint which accepts <code>PUT</code> with a new request body. I guess it's not the solution and <code>PATCH</code> exists for a reason.</p>\n"}]