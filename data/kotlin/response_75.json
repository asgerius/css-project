[{"tags": ["java", "android", "networking", "ip", "kotlin"], "comments": [{"owner": {"reputation": 2798, "user_id": 4316327, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/cbvZf.jpg?s=128&g=1", "display_name": "Truong Hieu", "link": "https://stackoverflow.com/users/4316327/truong-hieu"}, "edited": false, "score": 0, "creation_date": 1539528423, "post_id": 37847404, "comment_id": 92526075, "body": "It was a long time, but did you solve this problem?"}], "owner": {"reputation": 79, "user_id": 3103181, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/nvYlc.png?s=128&g=1", "display_name": "heyjohnnyfunt", "link": "https://stackoverflow.com/users/3103181/heyjohnnyfunt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1044, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1466032780, "creation_date": 1466032780, "last_edit_date": 1495542162, "question_id": 37847404, "link": "https://stackoverflow.com/questions/37847404/android-local-vpn-service-can-not-forward-packets", "title": "Android local VPN Service: can not forward packets", "body": "<p>I'm trying to implement simple Android firewall app through VPN service. </p>\n\n<p>Basic scheme looks like this:</p>\n\n<p><a href=\"https://i.stack.imgur.com/3F0sr.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/3F0sr.png\" alt=\"enter image description here\"></a></p>\n\n<p>I'm trying to simply forward packets through my VPN service. So I've started with implementing <a href=\"https://android.googlesource.com/platform/development/+/master/samples/ToyVpn/src/com/example/android/toyvpn\" rel=\"nofollow noreferrer\">ToyVpn</a> Google example (time to time taking a glance at <a href=\"http://www.thegeekstuff.com/2014/06/android-vpn-service/\" rel=\"nofollow noreferrer\">this</a> example) for my purposes, but it's not working: when my VPN is running I see that packets are sent, but I've got no response. </p>\n\n<p><em>App is written on Kotlin, but it's not complicated for Java lovers.</em></p>\n\n<p>My <strong>Builder</strong> is configured with IP and route as shown below:</p>\n\n<pre><code>val builder = Builder()\nbuilder.addAddress(\"10.0.0.2\", 32).addRoute(\"0.0.0.0\", 0)\nmInterface = builder.establish()\n</code></pre>\n\n<p>After that I'm setting a <strong>tunnel</strong> a way it's shown in ToyVpn, but my VPN server destination IP address is local:</p>\n\n<pre><code>val tunnel = DatagramChannel.open()\nif (!protect(tunnel.socket())) {\n    throw IllegalStateException(\"Cannot protect the tunnel\");\n}\ntunnel.connect(InetSocketAddress(\"127.0.0.1\", 55555))\ntunnel.configureBlocking(false)\nprotect(tunnel.socket())\n</code></pre>\n\n<p>After that I'm trying to forward packets from <code>in</code> and <code>out</code> FileInputStream's (also taken from ToyVpn):</p>\n\n<pre><code>val `in` = FileInputStream(mInterface!!.fileDescriptor)\nval out = FileOutputStream(mInterface!!.fileDescriptor)\nvar timer = 0\n        while (true) {\n            var idle = true\n\n            var length = `in`.read(packet.array())\n\n            if (length &gt; 0) {\n                packet.limit(length)\n                tunnel.write(packet);\n                packet.clear()\n                idle = false\n                if (timer &lt; 1) {\n                    timer = 1\n                }\n\n            }\n            length = tunnel.read(packet)\n\n            if (length &gt; 0) {\n                if (packet.get(0).toInt() !== 0) {\n                    out.write(packet.array(), 0, length)\n                }\n                packet.clear()\n                idle = false\n                if (timer &gt; 0) {\n                    timer = 0\n                }\n            }\n            if (idle) {\n                Thread.sleep(100)\n                timer += if (timer &gt; 0) 100 else -100\n                if (timer &lt; -15000) {\n                    packet.put(0.toByte()).limit(1)\n                    for (i in 0..2) {\n                        packet.position(0)\n                        tunnel.write(packet)\n                    }\n                    packet.clear()\n                    timer = 1\n                }\n                if (timer &gt; 20000) {\n                    throw IllegalStateException(\"Timed out\")\n                }\n            }\n            Thread.sleep(50)\n        }\n</code></pre>\n\n<p><strong>My first question:</strong> What am I doing wrong? The code is clear and should work properly, but it does not!</p>\n\n<p>Basicly I want my service to fitler packets by IP address. I know that huge apps like <a href=\"https://play.google.com/store/apps/details?id=jp.co.taosoftware.android.packetcapture&amp;hl=ru\" rel=\"nofollow noreferrer\">tPacketCapture</a> parse packets from the scratch and than reconstruct them.</p>\n\n<p><strong>My second question:</strong> Is there a way to make packet filtering simplier if I want to fetch only the IP address? </p>\n\n<p><strong>P.S.:</strong> Actualy I've already asked a similar question about it <a href=\"https://stackoverflow.com/questions/37779720/android-local-vpn-service-cant-get-response\">here</a> a few days ago, but error had another nature related to Kotlin language, which app is developed on. Also I've seen <a href=\"https://stackoverflow.com/questions/17766405/android-vpnservice-to-capture-packets-wont-capture-packets\">this</a> and <a href=\"https://stackoverflow.com/questions/20237743/android-firewall-with-vpnservice\">this</a> questions, but the answers there didn't help me. </p>\n"}, {"tags": ["kotlin"], "comments": [{"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "edited": false, "score": 0, "creation_date": 1466170167, "post_id": 37846813, "comment_id": 63220483, "body": "It is possible you are asking the wrong question, and XY problem (<a href=\"http://xyproblem.info/\" rel=\"nofollow noreferrer\">xyproblem.info</a>) ... Did you want to ask &quot;How do I deserialize JSON for a Kotlin data class that does not have a default empty constructor?&quot;  If so, I added an answer for that below."}], "answers": [{"tags": [], "owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "is_accepted": true, "score": 4, "last_activity_date": 1466051670, "creation_date": 1466051670, "answer_id": 37849969, "question_id": 37846813, "link": "https://stackoverflow.com/questions/37846813/empty-second-ctor-in-kotlin/37849969#37849969", "title": "Empty second ctor in Kotlin", "body": "<p>There is a convention (just for that case :) that a parameterless constructor is generated if all parameters have default values:</p>\n\n<pre><code>//Kotlin\ndata class UserRto(val lastName: String = \"\",\n                   val firstName: String = \"\",\n                   val email: String = \"\",\n                   val password: String = \"\")\n\n//Java\nnew UserRto();\nnew UserRto(\"a\", \"a\", \"a\", \"a\");\n</code></pre>\n\n<p>Your solution with an explicit empty constructor has an advantage that all parameters must be provided, or non. But it is not a big deal in most cases and it is rarely used.</p>\n"}, {"tags": [], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "is_accepted": false, "score": 3, "last_activity_date": 1466170414, "last_edit_date": 1466170414, "creation_date": 1466170077, "answer_id": 37882847, "question_id": 37846813, "link": "https://stackoverflow.com/questions/37846813/empty-second-ctor-in-kotlin/37882847#37882847", "title": "Empty second ctor in Kotlin", "body": "<p>You do not specify which JSON deserialization library you are using.  It is likely that you do not need this secondary constructor at all and can work directly with the class constructor that contains all of the properties as parameters.  </p>\n\n<ul>\n<li>For Jackson, use the <a href=\"https://github.com/FasterXML/jackson-module-kotlin\" rel=\"nofollow\">Jackson-Kotlin module</a> which automatically handles all of Kotlins unqiue cases including ability to call a constructor or factory with all of the parameters being properties (and in 2.8.x this includes default values for parameters being used for missing properties in the JSON)</li>\n<li>For Gson, I think <a href=\"https://github.com/SalomonBrys/Kotson\" rel=\"nofollow\">Kotson</a> might do the same.</li>\n</ul>\n\n<p>Google might find others for these or other libraries as well.  </p>\n\n<p>Then you would only need:</p>\n\n<pre><code>data class UserRto(val lastName: String, val firstName: String, val email: String, val password: String)\n</code></pre>\n\n<p>And with the Jackson-Kotlin module you would simply:</p>\n\n<pre><code>val user: UserRto = jacksonObjectMapper().readValue(jsonString)\n</code></pre>\n"}], "owner": {"reputation": 771, "user_id": 4939370, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d88bd94bd8f15918c7095a9c03e628b6?s=128&d=identicon&r=PG&f=1", "display_name": "yogiginger", "link": "https://stackoverflow.com/users/4939370/yogiginger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "accepted_answer_id": 37849969, "answer_count": 2, "score": 2, "last_activity_date": 1466170414, "creation_date": 1466029451, "question_id": 37846813, "link": "https://stackoverflow.com/questions/37846813/empty-second-ctor-in-kotlin", "title": "Empty second ctor in Kotlin", "body": "<pre><code>data class UserRto(val lastName: String, val firstName: String, val email: String, val password: String) {\n    constructor() : this(\"\", \"\", \"\", \"\")\n}\n</code></pre>\n\n<p>Is this the easiest way to get a second ctor without arguments (for json desrialization)?</p>\n"}, {"tags": ["kotlin"], "answers": [{"tags": [], "owner": {"reputation": 24586, "user_id": 3255152, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fbd95ef81d0a85310fee8dd46e0f65b0?s=128&d=identicon&r=PG&f=1", "display_name": "mfulton26", "link": "https://stackoverflow.com/users/3255152/mfulton26"}, "is_accepted": false, "score": 4, "last_activity_date": 1466019537, "creation_date": 1466019537, "answer_id": 37844336, "question_id": 37844009, "link": "https://stackoverflow.com/questions/37844009/how-to-find-the-users-documents-directory-with-kotlin/37844336#37844336", "title": "How to find the user&#39;s documents directory with Kotlin?", "body": "<p>\"Use property access syntax\" is an inspection that \"reports calls to java get and set methods that can be replaced with use of Kotlin synthetic properties.\"</p>\n\n<p>i.e. You can replace <code>fw.getDefaultDirectory()</code> with <code>fw.defaultDirectory</code>.</p>\n"}], "owner": {"reputation": 21, "user_id": 6471279, "user_type": "registered", "profile_image": "https://graph.facebook.com/10205113245784663/picture?type=large", "display_name": "paztor", "link": "https://stackoverflow.com/users/6471279/paztor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 912, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1466019537, "creation_date": 1466018248, "question_id": 37844009, "link": "https://stackoverflow.com/questions/37844009/how-to-find-the-users-documents-directory-with-kotlin", "title": "How to find the user&#39;s documents directory with Kotlin?", "body": "<pre><code>val fr = javax.swing.JFileChooser()\nval fw = fr.fileSystemView\nval documentsPath = fw.getDefaultDirectory().toString()\n\nprintln(documentsPath)\n</code></pre>\n\n<p>I tried this code but IDEA said \"Use property access syntax\"..\nIs there a better way?</p>\n"}, {"tags": ["kotlin"], "answers": [{"comments": [{"owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "edited": false, "score": 0, "creation_date": 1466051816, "post_id": 37838903, "comment_id": 63159043, "body": "it&#39;s al in the signature <code>action: (ByteArray, Int) -&gt; Unit</code>"}], "tags": [], "owner": {"reputation": 17307, "user_id": 869184, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/58a3657cee7bdb5f537020660d9711e0?s=128&d=identicon&r=PG&f=1", "display_name": "Ilya", "link": "https://stackoverflow.com/users/869184/ilya"}, "is_accepted": true, "score": 6, "last_activity_date": 1466002408, "creation_date": 1466002408, "answer_id": 37838903, "question_id": 37837706, "link": "https://stackoverflow.com/questions/37837706/kotlin-foreachblock-example/37838903#37838903", "title": "Kotlin foreachblock example", "body": "<p>A lambda passed to <code>forEachBlock</code> must accept two parameters. First is a <code>ByteArray</code> buffer, and second is the number of bytes with actual data in that array. </p>\n\n<pre><code>file.forEachBlock { buffer, count -&gt;\n    messageDigest.update(buffer, 0, count)\n}\n</code></pre>\n"}], "owner": {"reputation": 110, "user_id": 971169, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dc24d9e9f128cf66c4d977dc9ce49d70?s=128&d=identicon&r=PG", "display_name": "user971169", "link": "https://stackoverflow.com/users/971169/user971169"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 368, "favorite_count": 0, "accepted_answer_id": 37838903, "answer_count": 1, "score": 2, "last_activity_date": 1466002408, "creation_date": 1465999321, "question_id": 37837706, "link": "https://stackoverflow.com/questions/37837706/kotlin-foreachblock-example", "title": "Kotlin foreachblock example", "body": "<p>I am trying to learn Kotlin and am having trouble with file.foreachblock function(<a href=\"https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.io/java.io.-file/for-each-block.html\" rel=\"nofollow\">https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.io/java.io.-file/for-each-block.html</a>). </p>\n\n<p>Specifically I want to update the messageDigest with the byte array, but it is not clear to me how I would do this. Any examples would be great</p>\n\n<p>something like</p>\n\n<pre><code>file.foreachblock(){ -&gt;\n  messageDigest.update(it.bytearray, 0, it.length);\n}\n</code></pre>\n"}, {"tags": ["annotations", "kotlin"], "comments": [{"owner": {"reputation": 32343, "user_id": 155213, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57bc3e08faeb981ddc81abd1d25c3bf1?s=128&d=identicon&r=PG", "display_name": "miensol", "link": "https://stackoverflow.com/users/155213/miensol"}, "edited": false, "score": 3, "creation_date": 1465989650, "post_id": 37833395, "comment_id": 63129042, "body": "<a href=\"http://stackoverflow.com/questions/5143256/why-was-avoid-enums-where-you-only-need-ints-removed-from-androids-performanc\">Why don&#39;t you use <code>enum</code></a>?"}, {"owner": {"reputation": 3925, "user_id": 3806331, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ab7f221d4245947fd3260c364ffd0645?s=128&d=identicon&r=PG&f=1", "display_name": "johnny_crq", "link": "https://stackoverflow.com/users/3806331/johnny-crq"}, "reply_to_user": {"reputation": 32343, "user_id": 155213, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57bc3e08faeb981ddc81abd1d25c3bf1?s=128&d=identicon&r=PG", "display_name": "miensol", "link": "https://stackoverflow.com/users/155213/miensol"}, "edited": false, "score": 3, "creation_date": 1465992487, "post_id": 37833395, "comment_id": 63131209, "body": "no reason just a pathetic one. Enums were discouraged a couple years ago by google due to performance reasons. I&#39;m used to preferring static constants with intdef annotations. But when i changed to Kotlin that feature is gone"}, {"owner": {"reputation": 8164, "user_id": 5593959, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/9StDn.jpg?s=128&g=1", "display_name": "Dima Rostopira", "link": "https://stackoverflow.com/users/5593959/dima-rostopira"}, "edited": false, "score": 2, "creation_date": 1488199985, "post_id": 37833395, "comment_id": 72112050, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/35976002/how-to-use-android-support-typedef-annotations-in-kotlin\">How to use Android Support typedef annotations in kotlin?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 494, "user_id": 3703516, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/MEEub.jpg?s=128&g=1", "display_name": "Raeglan", "link": "https://stackoverflow.com/users/3703516/raeglan"}, "edited": false, "score": 18, "creation_date": 1520955215, "post_id": 37839539, "comment_id": 85523505, "body": "Aren&#39;t enums grossly inefficient on Android?"}, {"owner": {"reputation": 79983, "user_id": 147024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b35432f97606c0a31da17084d2414966?s=128&d=identicon&r=PG", "display_name": "yole", "link": "https://stackoverflow.com/users/147024/yole"}, "reply_to_user": {"reputation": 494, "user_id": 3703516, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/MEEub.jpg?s=128&g=1", "display_name": "Raeglan", "link": "https://stackoverflow.com/users/3703516/raeglan"}, "edited": false, "score": 9, "creation_date": 1520956662, "post_id": 37839539, "comment_id": 85524611, "body": "No, they are not."}, {"owner": {"reputation": 494, "user_id": 3703516, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/MEEub.jpg?s=128&g=1", "display_name": "Raeglan", "link": "https://stackoverflow.com/users/3703516/raeglan"}, "edited": false, "score": 11, "creation_date": 1520956903, "post_id": 37839539, "comment_id": 85524813, "body": "&quot;For example, enums often require more than twice as much memory as static constants. You should strictly avoid using enums on Android.&quot; - <a href=\"https://developer.android.com/topic/performance/memory.html#Overhead\" rel=\"nofollow noreferrer\">developer.android.com/topic/performance/memory.html#Overhead</a>"}, {"owner": {"reputation": 494, "user_id": 3703516, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/MEEub.jpg?s=128&g=1", "display_name": "Raeglan", "link": "https://stackoverflow.com/users/3703516/raeglan"}, "edited": false, "score": 3, "creation_date": 1520956958, "post_id": 37839539, "comment_id": 85524856, "body": "I wanted to know if the way Kotlin handles enums makes a difference."}, {"owner": {"reputation": 1739, "user_id": 532368, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fDowM.png?s=128&g=1", "display_name": "Mokkun", "link": "https://stackoverflow.com/users/532368/mokkun"}, "edited": false, "score": 0, "creation_date": 1522733024, "post_id": 37839539, "comment_id": 86252449, "body": "@yole <a href=\"https://www.youtube.com/watch?v=Hzs6OBcvNQE\" rel=\"nofollow noreferrer\">youtube.com/watch?v=Hzs6OBcvNQE</a> (The price of ENUMs (100 Days of Google Dev))"}, {"owner": {"reputation": 79983, "user_id": 147024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b35432f97606c0a31da17084d2414966?s=128&d=identicon&r=PG", "display_name": "yole", "link": "https://stackoverflow.com/users/147024/yole"}, "reply_to_user": {"reputation": 494, "user_id": 3703516, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/MEEub.jpg?s=128&g=1", "display_name": "Raeglan", "link": "https://stackoverflow.com/users/3703516/raeglan"}, "edited": false, "score": 17, "creation_date": 1522752553, "post_id": 37839539, "comment_id": 86263169, "body": "@Raeglan This advice is no longer relevant for ART; it has now been removed from the doc page you&#39;ve linked to."}, {"owner": {"reputation": 4050, "user_id": 4963858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06ec7ca489576e7299e8f4d37ffaf149?s=128&d=identicon&r=PG&f=1", "display_name": "hqzxzwb", "link": "https://stackoverflow.com/users/4963858/hqzxzwb"}, "edited": false, "score": 7, "creation_date": 1535367882, "post_id": 37839539, "comment_id": 91025987, "body": "@yole It has been removed from the memory advices, but not from here: <a href=\"https://developer.android.com/topic/performance/reduce-apk-size\" rel=\"nofollow noreferrer\">developer.android.com/topic/performance/reduce-apk-size</a>"}, {"owner": {"reputation": 1537, "user_id": 1392366, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/FBF0r.png?s=128&g=1", "display_name": "LiTTle", "link": "https://stackoverflow.com/users/1392366/little"}, "edited": false, "score": 1, "creation_date": 1558084390, "post_id": 37839539, "comment_id": 98991944, "body": "Any news about <code>enum</code>s vs <code>IntDef</code> for apk size? Should we stick to <code>IntDef</code>?"}, {"owner": {"reputation": 2775, "user_id": 2102748, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a1adcb8ed924ecd1045fd6252a7df18?s=128&d=identicon&r=PG", "display_name": "milosmns", "link": "https://stackoverflow.com/users/2102748/milosmns"}, "edited": false, "score": 1, "creation_date": 1565943760, "post_id": 37839539, "comment_id": 101509265, "body": "It&#39;s true that enums have a bit bigger mem footprint in comparison to integers, but it&#39;s not a big deal anymore. You don&#39;t have a 100 enums anyway, plus ART now optimizes enum memory usage. But even if you&#39;re really constrained in terms of memory, note that if you use Proguard (or D8/R8) optimizations, it might convert simple enums to integers, so if you don&#39;t have any extra enum properties, this will most likely happen out-of-the-box. <a href=\"https://www.guardsquare.com/en/products/proguard/manual/usage/optimizations\" rel=\"nofollow noreferrer\">guardsquare.com/en/products/proguard/manual/usage/optimizati&zwnj;&#8203;ons</a> Look for <code>class&#47;unboxing&#47;enum</code>."}, {"owner": {"reputation": 1046, "user_id": 6756683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SvBZm.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/6756683/daniel"}, "edited": false, "score": 3, "creation_date": 1570700549, "post_id": 37839539, "comment_id": 102999093, "body": "@yole absolutely right! Using enums is fine now. Watch GoogleIO video: <a href=\"https://www.youtube.com/watch?v=IrMw7MEgADk&amp;feature=youtu.be&amp;t=857\" rel=\"nofollow noreferrer\">youtube.com/watch?v=IrMw7MEgADk&amp;feature=youtu.be&amp;t=857</a>"}, {"owner": {"reputation": 1671, "user_id": 953178, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/A2e1C.png?s=128&g=1", "display_name": "Jamal", "link": "https://stackoverflow.com/users/953178/jamal"}, "edited": false, "score": 0, "creation_date": 1613299435, "post_id": 37839539, "comment_id": 117027834, "body": "@yole and 4 years later: when it will be available?"}], "tags": [], "owner": {"reputation": 79983, "user_id": 147024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b35432f97606c0a31da17084d2414966?s=128&d=identicon&r=PG", "display_name": "yole", "link": "https://stackoverflow.com/users/147024/yole"}, "is_accepted": true, "score": 32, "last_activity_date": 1466004083, "creation_date": 1466004083, "answer_id": 37839539, "question_id": 37833395, "link": "https://stackoverflow.com/questions/37833395/kotlin-annotation-intdef/37839539#37839539", "title": "Kotlin Annotation IntDef", "body": "<p>As of Kotlin 1.0.3, the <code>@IntDef</code> annotation is not supported, but support is planned for later versions. </p>\n\n<p>The Kotlin way of making these compile time checks is to use an <code>enum class</code> instead of a series of <code>Int</code> constants.</p>\n"}, {"comments": [{"owner": {"reputation": 3925, "user_id": 3806331, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ab7f221d4245947fd3260c364ffd0645?s=128&d=identicon&r=PG&f=1", "display_name": "johnny_crq", "link": "https://stackoverflow.com/users/3806331/johnny-crq"}, "edited": false, "score": 0, "creation_date": 1466006389, "post_id": 37840170, "comment_id": 63141602, "body": "nah :p i am not. aha. but thanks for the tip anyway. might help another ppl"}], "tags": [], "owner": {"reputation": 9097, "user_id": 44816, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/aOoXk.jpg?s=128&g=1", "display_name": "Enrico", "link": "https://stackoverflow.com/users/44816/enrico"}, "is_accepted": false, "score": 2, "last_activity_date": 1466005743, "creation_date": 1466005743, "answer_id": 37840170, "question_id": 37833395, "link": "https://stackoverflow.com/questions/37833395/kotlin-annotation-intdef/37840170#37840170", "title": "Kotlin Annotation IntDef", "body": "<p>If you are calling <code>setMeasureText</code> from Java you can get it to work by creating your IntDef in Java too</p>\n\n<pre><code>// UnitType.java\n@Retention(RetentionPolicy.SOURCE)\n@IntDef({MeasureText.UNIT_KG, MeasureText.UNIT_LB, MeasureText.UNIT_NONE})\npublic @interface UnitType {}\n</code></pre>\n\n<p>h/t <a href=\"http://www.tonicartos.com/2015/11/again-supporting-android-typedefs-in.html\" rel=\"nofollow\">Tonic Artos</a></p>\n\n<p>You will also need to update your companion object to make your values longs and publicly accessible</p>\n\n<pre><code>companion object{\n    const val UNIT_NONE = -1L\n    const val UNIT_KG = 1L\n    const val UNIT_LB = 0L\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3925, "user_id": 3806331, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ab7f221d4245947fd3260c364ffd0645?s=128&d=identicon&r=PG&f=1", "display_name": "johnny_crq", "link": "https://stackoverflow.com/users/3806331/johnny-crq"}, "edited": false, "score": 24, "creation_date": 1488364810, "post_id": 42486280, "comment_id": 72194726, "body": "this does not solve anything. You can create annotation the same way as Java, but you cannot benefit from using IntDef on Kotlin because the compiler doesn&#39;t know how to interpret it. The advantage of IntDef is that, it will show in auto-completion and therefore, you can, most of the times, use IntDef contacts instead of enum. Take away the compiler part, and the annotation itself is useless."}, {"owner": {"reputation": 8164, "user_id": 5593959, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/9StDn.jpg?s=128&g=1", "display_name": "Dima Rostopira", "link": "https://stackoverflow.com/users/5593959/dima-rostopira"}, "reply_to_user": {"reputation": 3925, "user_id": 3806331, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ab7f221d4245947fd3260c364ffd0645?s=128&d=identicon&r=PG&f=1", "display_name": "johnny_crq", "link": "https://stackoverflow.com/users/3806331/johnny-crq"}, "edited": false, "score": 2, "creation_date": 1488365019, "post_id": 42486280, "comment_id": 72194874, "body": "@user3806331 not agree. Autocomplete is not the only point. It&#39;s usefull, because annotated parameter is checked at compile time, so you can&#39;t call this function with <code>-1L</code> by mistake"}, {"owner": {"reputation": 2509, "user_id": 1738090, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9c5127a1f300d2f092a5eeb7f76ce348?s=128&d=identicon&r=PG", "display_name": "w3bshark", "link": "https://stackoverflow.com/users/1738090/w3bshark"}, "edited": false, "score": 12, "creation_date": 1500311264, "post_id": 42486280, "comment_id": 77268912, "body": "I don&#39;t think this is true. I&#39;ve tested using a @StringDef as part one of my Kotlin class&#39;s constructor parameters and a compile time warning/error was never thrown when I passed an invalid type to it."}, {"owner": {"reputation": 3531, "user_id": 4093150, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/kMzNa.jpg?s=128&g=1", "display_name": "Sanf0rd", "link": "https://stackoverflow.com/users/4093150/sanf0rd"}, "edited": false, "score": 0, "creation_date": 1546647467, "post_id": 42486280, "comment_id": 94931001, "body": "@DimaRostopira, I got your point but this code doesn&#39;t have completion either the compile-time annotation check."}, {"owner": {"reputation": 691, "user_id": 2335052, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/gajpf.jpg?s=128&g=1", "display_name": "Billyjoker", "link": "https://stackoverflow.com/users/2335052/billyjoker"}, "edited": false, "score": 0, "creation_date": 1562860008, "post_id": 42486280, "comment_id": 100520371, "body": "It works for me. In my case i wanted String definition, so i&#39;ve replaced IntDef by StringDef, i&#39;ve defined the val as strings and is working right"}, {"owner": {"reputation": 2309, "user_id": 5033303, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-uLul884YV6o/AAAAAAAAAAI/AAAAAAAAAB4/XzPVDX3_Xz0/photo.jpg?sz=128", "display_name": "Ali Zarei", "link": "https://stackoverflow.com/users/5033303/ali-zarei"}, "reply_to_user": {"reputation": 3925, "user_id": 3806331, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ab7f221d4245947fd3260c364ffd0645?s=128&d=identicon&r=PG&f=1", "display_name": "johnny_crq", "link": "https://stackoverflow.com/users/3806331/johnny-crq"}, "edited": false, "score": 0, "creation_date": 1608023695, "post_id": 42486280, "comment_id": 115448436, "body": "@johnny_crq hey there , is there any update to your comment now?"}], "tags": [], "owner": {"reputation": 8164, "user_id": 5593959, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/9StDn.jpg?s=128&g=1", "display_name": "Dima Rostopira", "link": "https://stackoverflow.com/users/5593959/dima-rostopira"}, "is_accepted": false, "score": 50, "last_activity_date": 1524560407, "last_edit_date": 1524560407, "creation_date": 1488199948, "answer_id": 42486280, "question_id": 37833395, "link": "https://stackoverflow.com/questions/37833395/kotlin-annotation-intdef/42486280#42486280", "title": "Kotlin Annotation IntDef", "body": "<p>Strange thing, but this question comes in search before the same with <a href=\"https://stackoverflow.com/a/38537175/5593959\">right answer</a></p>\n\n<p>Copying it here:</p>\n\n<pre><code>import android.support.annotation.IntDef\npublic class Test {\n\n    companion object {\n\n         @IntDef(SLOW, NORMAL, FAST)\n         @Retention(AnnotationRetention.SOURCE)\n         annotation class Speed\n\n         const val SLOW = 0\n         const val NORMAL = 1\n         const val FAST = 2\n    }\n\n    @Speed\n    private var speed: Int=SLOW\n\n    public fun setSpeed(@Speed speed: Int) {\n        this.speed = speed\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 785, "user_id": 1437766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f5ad8341e854c4d8630249aae5b6fbf?s=128&d=identicon&r=PG", "display_name": "evi", "link": "https://stackoverflow.com/users/1437766/evi"}, "is_accepted": false, "score": 3, "last_activity_date": 1533639933, "creation_date": 1533639933, "answer_id": 51725249, "question_id": 37833395, "link": "https://stackoverflow.com/questions/37833395/kotlin-annotation-intdef/51725249#51725249", "title": "Kotlin Annotation IntDef", "body": "<p>My preferred way to use IntDef with Kotlin is to use top-level declarations:</p>\n\n<pre><code>package com.example.tips\n\n\nconst val TIP_A = 1\nconst val TIP_B = 2\nconst val TIP_C = 3\n\n@IntDef(TIP_A, TIP_B, TIP_C)\n@Retention(AnnotationRetention.SOURCE)\nannotation class TipId\n\n\nclass TipsDataProvider {\n\n    fun markTip(@TipId tipId: Int) {\n    ...\n    }\n}\n</code></pre>\n\n<p>No extra class or object required! \nMore info about top-level declarations <a href=\"https://blog.egorand.me/where-do-i-put-my-constants-in-kotlin/\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 10684712, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66b391070d4ce70669fe114b5d78f455?s=128&d=identicon&r=PG&f=1", "display_name": "you", "link": "https://stackoverflow.com/users/10684712/you"}, "is_accepted": false, "score": -1, "last_activity_date": 1567738560, "last_edit_date": 1567738560, "creation_date": 1567734868, "answer_id": 57814811, "question_id": 37833395, "link": "https://stackoverflow.com/questions/37833395/kotlin-annotation-intdef/57814811#57814811", "title": "Kotlin Annotation IntDef", "body": "<p>As the accepted answer said,use an <code>enum class</code> in kotlin.</p>\n\n<p>I wrote the specific code of the question asked,it may help some people new in kotlin:</p>\n\n<pre><code>class MeasureTextView: TextView {\n   enum class UnitType(val value : Int){\n       UNIT_NONE(-1),\n       UNIT_KG(0),\n       UNIT_LB(1)\n   }\n\n   fun setMeasureText(number: Float, unitType: UnitType){\n       val suffix = unitType.value\n   }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 9000, "user_id": 2851687, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/2wGfz.jpg?s=128&g=1", "display_name": "ralphgabb", "link": "https://stackoverflow.com/users/2851687/ralphgabb"}, "edited": false, "score": 1, "creation_date": 1602495020, "post_id": 62607232, "comment_id": 113728304, "body": "Thanks for reference. The open and close brackets are not necessary."}], "tags": [], "owner": {"reputation": 1695, "user_id": 2897869, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/JmkEF.jpg?s=128&g=1", "display_name": "Hossein Kurd", "link": "https://stackoverflow.com/users/2897869/hossein-kurd"}, "is_accepted": false, "score": 1, "last_activity_date": 1602495071, "last_edit_date": 1602495071, "creation_date": 1593243337, "answer_id": 62607232, "question_id": 37833395, "link": "https://stackoverflow.com/questions/37833395/kotlin-annotation-intdef/62607232#62607232", "title": "Kotlin Annotation IntDef", "body": "<p>Try it:</p>\n<pre><code>companion object {\n    const val VALUE_1: Int = 1\n    const val VALUE_2: Int = 2\n    const val VALUE_3: Int = 3\n}\n\n@IntDef(value = [VALUE_1, VALUE_2, VALUE_3])\n@Retention(AnnotationRetention.SOURCE)\nannotation class TestClassName\n</code></pre>\n"}], "owner": {"reputation": 3925, "user_id": 3806331, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ab7f221d4245947fd3260c364ffd0645?s=128&d=identicon&r=PG&f=1", "display_name": "johnny_crq", "link": "https://stackoverflow.com/users/3806331/johnny-crq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 27845, "favorite_count": 4, "accepted_answer_id": 37839539, "answer_count": 6, "score": 35, "last_activity_date": 1602495071, "creation_date": 1465987952, "question_id": 37833395, "link": "https://stackoverflow.com/questions/37833395/kotlin-annotation-intdef", "title": "Kotlin Annotation IntDef", "body": "<p>I have this code sample:</p>\n\n<pre><code>class MeasureTextView: TextView {\n    constructor(context: Context?) : super(context)\n    constructor(context: Context?, attrs: AttributeSet?) : super(context, attrs)\n    constructor(context: Context?, attrs: AttributeSet?, defStyleAttr: Int) : super(context, attrs, defStyleAttr)\n    constructor(context: Context?, attrs: AttributeSet?, defStyleAttr: Int, defStyleRes: Int) : super(context, attrs, defStyleAttr, defStyleRes)\n\n    companion object{\n        val UNIT_NONE = -1\n        val UNIT_KG = 1\n        val UNIT_LB = 0            \n    }\n\n    fun setMeasureText(number: Float, unitType: Int){\n\n        val suffix = when(unitType){\n            UNIT_NONE -&gt; {\n                EMPTY_STRING\n            }\n            UNIT_KG -&gt; {\n                KG_SUFIX\n            }\n            UNIT_LB -&gt; {\n                LB_SUFIX\n            }\n            else -&gt; throw IllegalArgumentException(\"Wrong unitType passed to formatter: MeasureTextView.setMeasureText\")\n        }\n\n        // set the final text\n        text = \"$number $suffix\"\n    }\n}\n</code></pre>\n\n<p>I want to be able to use, at compile time, the auto complete feature in conjunction with IntDef annotation, so when i invoke <code>setMeasureText(...)</code>,\nthe static variables are shown as options to the argument of this method.</p>\n\n<p>I have searched about this, and i couldn't find if Kotlin supported this java-style annotations (intdef for example). So i have tried it, and made an annotation for this, but it won't show in autocompletion.</p>\n\n<p>My question:\n- Is Java annotation IntDef supported in Kotlin (latest version)</p>\n\n<ul>\n<li><p>If it is, how can i turn in ON in the Android Studio IDE (if it works, i can't get the compiler to suggest it).</p></li>\n<li><p>If it is not, is there any Kotlin-way of make this compile time checks</p></li>\n</ul>\n"}, {"tags": ["android", "synchronization", "adapter", "kotlin", "authenticator"], "owner": {"reputation": 21, "user_id": 6468905, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RLrCG.jpg?s=128&g=1", "display_name": "Tiberiu Golaes", "link": "https://stackoverflow.com/users/6468905/tiberiu-golaes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 317, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1465986654, "creation_date": 1465986654, "question_id": 37832874, "link": "https://stackoverflow.com/questions/37832874/no-android-content-syncadapter-meta-data", "title": "No android.content.SyncAdapter meta-data", "body": "<p>I'm trying to implement the sync-adapter for my app and i'm encountering this issue: </p>\n\n<blockquote>\n  <p>org.xmlpull.v1.XmlPullParserException: No android.content.SyncAdapter\n  meta-data</p>\n</blockquote>\n\n<p>Due to this ( i hope), my sync adapter is not calling onPerformSync(). I know that this question was previously asked but the answers don't help in my case. I have to mention that i'm using a StubContentProvider as in the google example and here are some of the configuration files :</p>\n\n<p>Manifest:</p>\n\n<pre><code> &lt;service android:name=\".sync.AuthenticatorService\"&gt;\n        &lt;meta-data\n            android:name=\"android.accounts.AccountAuthenticator\"\n            android:resource=\"@xml/authenticator\" /&gt;\n        &lt;intent-filter&gt;\n            &lt;action android:name=\"android.accounts.AccountAuthenticator\" /&gt;\n        &lt;/intent-filter&gt;\n    &lt;/service&gt;\n\n    &lt;provider\n        android:name=\".sync.StubContentProvider\"\n        android:authorities=\"${applicationId}.sync.StubContentProvider\"\n        android:exported=\"false\"\n        android:label=\"@string/app_name\"\n        android:syncable=\"true\" /&gt;\n\n    &lt;!-- Sync Adapter --&gt;\n    &lt;service\n        android:name=\".sync.SyncDataService\"\n        android:label=\"@string/app_name\"\n        android:exported=\"false\"&gt;\n        &lt;intent-filter&gt;\n            &lt;action android:name=\"android.content.SyncAdapter\" /&gt;\n        &lt;/intent-filter&gt;\n        &lt;meta-data\n            android:name=\"android.content.SyncAdapter\"\n            android:resource=\"@xml/syncadapter\" /&gt;\n    &lt;/service&gt;\n</code></pre>\n\n<p>syncadapter.xml</p>\n\n<pre><code>    &lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;sync-adapter\n    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:contentAuthority=\"@string/account_authorities\"\n    android:accountType=\"one.random.net\"\n    android:allowParallelSyncs=\"true\"\n    android:isAlwaysSyncable=\"true\"\n    android:supportsUploading=\"false\"\n    android:userVisible=\"true\" /&gt;\n</code></pre>\n\n<p>authenticator.xml:</p>\n\n<pre><code>    &lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;account-authenticator\n    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:accountType=\"one.random.net\"\n    android:icon=\"@mipmap/ic_launcher\"\n    android:label=\"@string/app_name\"\n    android:smallIcon=\"@mipmap/ic_launcher\"/&gt;\n</code></pre>\n\n<p>SyncSupport.kt: </p>\n\n<pre><code>fun setupSyncAdapter(context: Context) {\n        // Create the account type and default account\n        val accountName = context.getString(R.string.account_name)\n        val accountType = ACCOUNT_TYPE\n        val newAccount = Account(accountName, accountType)\n        Log.d(\"Sync\", \"Account is $newAccount\")\n        // Get an instance of the account manager\n        val accountManager = context.getSystemService(Context.ACCOUNT_SERVICE) as AccountManager\n        Log.d(\"Sync\", \"Account manager\")\n        // Add the account and account type, no password or user data\n        // If successful, return the Account object, otherwise report an error.\n        Log.d(\"Sync\", \"Account manager size ${accountManager.getAccountsByType(accountType).size}\")\n      /*  ContentResolver.setSyncAutomatically(newAccount, AUTHORITY, true)\n        ContentResolver.setIsSyncable(newAccount, AUTHORITY, 1)*/\n\n        try {\n            if (accountManager.addAccountExplicitly(newAccount, null, null)) {\n                //  If you don't set android:syncable=\"true\" in your &lt;provider&gt; element in the\n                // manifest, then call context.setIsSyncable(account, AUTHORITY, 1) here\n                Log.d(\"Sync\", \"Sync Account added\")\n            } else {\n                // The account exists or some other error occurred. Log this, report it,\n                // or handle it internally.\n                Log.d(\"Sync\", \"Sync Account not added or error\")\n            }\n        } catch(e: Exception) {\n            Log.e(\"SyncSupport\", e.message, e)\n            return\n        }\n\n        periodicSync(context)\n\n    }\n\n    /**\n     * Expedite a sync request, this will run even if there is sync queued up.\n     *\n     * **Remember this does IO, and should be threaded**\n\n     * @param context\n     */\n    fun requestSyncNow(context: Context) {\n        val account = getAccount(context) ?: return\n\n        // Pass the settings flags by inserting them in a bundle\n        val settingsBundle = Bundle()\n        settingsBundle.putBoolean(ContentResolver.SYNC_EXTRAS_MANUAL, true)\n        settingsBundle.putBoolean(ContentResolver.SYNC_EXTRAS_EXPEDITED, true)\n        settingsBundle.putBoolean(KEY_SYNC, true)\n        // Request the sync for the default account, authority, and manual sync settings\n      /*  ContentResolver.setSyncAutomatically(account, AUTHORITY, true)\n        ContentResolver.setIsSyncable(account, AUTHORITY, 1)*/\n        ContentResolver.requestSync(account, AUTHORITY, settingsBundle)\n    }\n\n    /**\n     * Requests a sync, at the next opportunity.\n     *\n     *\n     * **This does IO, remember to call it off the UI thread.**\n\n     * @param context\n     */\n    fun requestSync(context: Context) {\n        val account = getAccount(context) ?: return\n\n        val settingsBundle = Bundle()\n        settingsBundle.putBoolean(ContentResolver.SYNC_EXTRAS_MANUAL, true\n        settingsBundle.putBoolean(KEY_SYNC, true)\n        /*\n     * Signal the framework to run your sync adapter. Assume that\n     * app initialization has already created the account.\n     */\n        ContentResolver.setSyncAutomatically(account, AUTHORITY, true)\n        ContentResolver.setIsSyncable(account, AUTHORITY, 1)\n        ContentResolver.requestSync(account, AUTHORITY, settingsBundle)\n\n    }\n\n    fun periodicSync(context: Context) {\n        val account = getAccount(context) ?: return\n        Log.d(\"Sync\", \"Periodic sync triggered\")\n        ContentResolver.setSyncAutomatically(account, AUTHORITY, true)\n    //    ContentResolver.setIsSyncable(account, AUTHORITY, 1)\n        // We run the Sync Adapter every 12 hours normally or every 5 min's on dev to test.\n        //noinspection ConstantConditions\n        val pollPeriod = if (BuildConfig.DEBUG) TimeUnit.MINUTES.toSeconds(5L) else TimeUnit.HOURS.toSeconds(12L)\n        val settingsBundle = Bundle()\n\n        settingsBundle.putBoolean(KEY_SYNC, true)\n\n        val b = SyncRequest.Builder().syncPeriodic(pollPeriod, pollPeriod)\n        b.setSyncAdapter(account, AUTHORITY)\n        b.setExtras(settingsBundle)\n        ContentResolver.requestSync(b.build())\n\n        //Timber.i(\"Sync: PeriodicSync: %ss\", pollPeriod.toString())\n    }\n\n    fun getAccount(context: Context): Account? {\n        val accountManager = context.applicationContext.getSystemService(Context.ACCOUNT_SERVICE) as AccountManager\n        val accountsByType = accountManager.getAccountsByType(ACCOUNT_TYPE)\n        for (account in accountsByType) return account\n        return null\n    }\n</code></pre>\n\n<p>From what i've checked multiple times the strings are OK but for some reason i'm still getting this error. </p>\n"}, {"tags": ["java", "kotlin", "kotlin-interop"], "comments": [{"owner": {"reputation": 4377, "user_id": 2836797, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KMjjk.png?s=128&g=1", "display_name": "It&#39;s Your App LLC", "link": "https://stackoverflow.com/users/2836797/its-your-app-llc"}, "edited": false, "score": 0, "creation_date": 1522690386, "post_id": 37828790, "comment_id": 86238398, "body": "This is ugly and makes me not even want to use Kotlin. I keep seeing these weird things over and over as I use the language more and more."}, {"owner": {"reputation": 64215, "user_id": 11238, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/BGDex.png?s=128&g=1", "display_name": "Randy Sugianto &#39;Yuku&#39;", "link": "https://stackoverflow.com/users/11238/randy-sugianto-yuku"}, "reply_to_user": {"reputation": 4377, "user_id": 2836797, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KMjjk.png?s=128&g=1", "display_name": "It&#39;s Your App LLC", "link": "https://stackoverflow.com/users/2836797/its-your-app-llc"}, "edited": false, "score": 8, "creation_date": 1522731798, "post_id": 37828790, "comment_id": 86251999, "body": "It is because for Java interop. Kotlin itself is nice and quite elegant."}, {"owner": {"reputation": 1206, "user_id": 5724101, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e2a46babf9752ea51ce8a92cf0f6b2c7?s=128&d=identicon&r=PG&f=1", "display_name": "mojmir.novak", "link": "https://stackoverflow.com/users/5724101/mojmir-novak"}, "reply_to_user": {"reputation": 4377, "user_id": 2836797, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KMjjk.png?s=128&g=1", "display_name": "It&#39;s Your App LLC", "link": "https://stackoverflow.com/users/2836797/its-your-app-llc"}, "edited": false, "score": 0, "creation_date": 1607514224, "post_id": 37828790, "comment_id": 115294711, "body": "@It&#39;sYourAppLLC You can see this only when you are using Kotlin code in Java code. Easy fix to it is to eliminate the use of Java code and write all in Kotlin. There is no more reason to use Java anymore when we have Kotlin. IMHO."}], "answers": [{"comments": [{"owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "edited": false, "score": 11, "creation_date": 1466052200, "post_id": 37834971, "comment_id": 63159168, "body": "it is hard to believe that the compiler couldn&#39;t figure the last example out without a real Unit instance."}, {"owner": {"reputation": 761, "user_id": 3763032, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/667ae3c0db85f45c13ba6a9fa845a371?s=128&d=identicon&r=PG", "display_name": "mochadwi", "link": "https://stackoverflow.com/users/3763032/mochadwi"}, "edited": false, "score": 0, "creation_date": 1577952964, "post_id": 37834971, "comment_id": 105288240, "body": "unfortunately <code>java.util.function.*</code> only available above 23. refer this answer <a href=\"https://stackoverflow.com/a/48686292/3763032\">here</a> and use <a href=\"https://github.com/retrostreams/android-retrostreams\" rel=\"nofollow noreferrer\">android-retrostreams</a> to support API below 24"}], "tags": [], "owner": {"reputation": 35078, "user_id": 615306, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/5a11940d70233031c01ead6c0b62c990?s=128&d=identicon&r=PG", "display_name": "Kirill Rakhman", "link": "https://stackoverflow.com/users/615306/kirill-rakhman"}, "is_accepted": true, "score": 59, "last_activity_date": 1490969283, "last_edit_date": 1490969283, "creation_date": 1465992325, "answer_id": 37834971, "question_id": 37828790, "link": "https://stackoverflow.com/questions/37828790/why-do-i-have-to-return-unit-instance-when-implementing-in-java-a-kotlin-functio/37834971#37834971", "title": "Why do I have to return Unit.INSTANCE when implementing in Java a Kotlin function that returns a Unit?", "body": "<p><code>Unit</code> in Kotlin is mostly equivalent to <code>void</code> in Java, however only when the rules of the JVM allow it.</p>\n\n<p>Functional types in Kotlin are represented by interfaces like:</p>\n\n<pre><code>public interface Function1&lt;in P1, out R&gt; : Function&lt;R&gt; {\n    /** Invokes the function with the specified argument. */\n    public operator fun invoke(p1: P1): R\n}\n</code></pre>\n\n<p>When you declare <code>(Int) -&gt; Unit</code>, from Java's point of view this is equivalent to <code>Function&lt;Integer, Unit&gt;</code>. That's why you have to return a value. To work around this problem, in Java there are two separate interfaces <code>Consumer&lt;T&gt;</code> and <code>Function&lt;T, R&gt;</code> for when you don't have/have a return value.</p>\n\n<p>The Kotlin designers decided to forgo the duplication of functional interfaces and instead rely on compiler \"magic\". If you declare a lambda in Kotlin, you don't have to return a value because the compiler will insert one for you.</p>\n\n<p>To make your life a little bit easier, you can write a helper method that wraps a <code>Consumer&lt;T&gt;</code> in a <code>Function1&lt;T, Unit&gt;</code>:</p>\n\n<pre><code>public class FunctionalUtils {\n    public static &lt;T&gt; Function1&lt;T, Unit&gt; fromConsumer(Consumer&lt;T&gt; callable) {\n        return t -&gt; {\n            callable.accept(t);\n            return Unit.INSTANCE;\n        };\n    }\n}\n</code></pre>\n\n<p>Usage:</p>\n\n<pre><code>f(fromConsumer(integer -&gt; doSomething()));\n</code></pre>\n\n<hr>\n\n<p>Fun fact: The special handling of <code>Unit</code> by the Kotlin compiler is the reason you can write code like:</p>\n\n<pre><code>fun foo() {\n    return Unit\n}\n</code></pre>\n\n<p>or</p>\n\n<pre><code>fun bar() = println(\"Hello World\")\n</code></pre>\n\n<p>Both methods have return type <code>void</code> in the generated bytecode but the compiler is smart enough to figure that out and allow you to use return statements/expressions anyway.</p>\n"}, {"comments": [{"owner": {"reputation": 5198, "user_id": 11377112, "user_type": "registered", "profile_image": "https://graph.facebook.com/158814934598574/picture?type=large", "display_name": "Animesh Sahu", "link": "https://stackoverflow.com/users/11377112/animesh-sahu"}, "edited": false, "score": 0, "creation_date": 1609762384, "post_id": 52949351, "comment_id": 115915050, "body": "Although looks elegant, but is creating two different anonymous objects at runtime which isn&#39;t good."}], "tags": [], "owner": {"reputation": 1630, "user_id": 3256989, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/1RHkQ.jpg?s=128&g=1", "display_name": "ultraon", "link": "https://stackoverflow.com/users/3256989/ultraon"}, "is_accepted": false, "score": 1, "last_activity_date": 1540298432, "creation_date": 1540298432, "answer_id": 52949351, "question_id": 37828790, "link": "https://stackoverflow.com/questions/37828790/why-do-i-have-to-return-unit-instance-when-implementing-in-java-a-kotlin-functio/52949351#52949351", "title": "Why do I have to return Unit.INSTANCE when implementing in Java a Kotlin function that returns a Unit?", "body": "<p>I use this approach for Kotlin &amp; Java. The methods of MyKotlinClass you will see in Java, in Kotlin you will see both methods (class method + extension function).\n</p>\n\n<pre><code>MyKotlinClass {\n\n  //Method to use in Java, but not restricted to use in Kotlin.\n    fun f(cb: Consumer&lt;Int&gt;) { //Java8 Consumer, or any custom with the same interface\n      int i = getYourInt()\n      cb.accept(i)\n    }\n}\n\n//Extension for Kotlin. It will be used in Kotlin.\nfun MyKotlinClass.f(cb: (Int) -&gt; Unit) {\n    f(Consumer { cb(it) })\n}\n</code></pre>\n"}], "owner": {"reputation": 64215, "user_id": 11238, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/BGDex.png?s=128&g=1", "display_name": "Randy Sugianto &#39;Yuku&#39;", "link": "https://stackoverflow.com/users/11238/randy-sugianto-yuku"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 16126, "favorite_count": 10, "accepted_answer_id": 37834971, "answer_count": 2, "score": 55, "last_activity_date": 1540298432, "creation_date": 1465975712, "question_id": 37828790, "link": "https://stackoverflow.com/questions/37828790/why-do-i-have-to-return-unit-instance-when-implementing-in-java-a-kotlin-functio", "title": "Why do I have to return Unit.INSTANCE when implementing in Java a Kotlin function that returns a Unit?", "body": "<p>If I have a Kotlin function</p>\n\n<pre><code>fun f(cb: (Int) -&gt; Unit)\n</code></pre>\n\n<p>and I want to call <code>f</code> from Java, I have to do it like:</p>\n\n<pre><code>f(i -&gt; {\n     dosomething();\n     return Unit.INSTANCE;\n});\n</code></pre>\n\n<p>which looks very ugly. Why can't I just write it like <code>f(i -&gt; dosomething());</code>, since <code>Unit</code> in Kotlin is equivalent to <code>void</code> in Java?</p>\n"}, {"tags": ["kotlin"], "comments": [{"owner": {"reputation": 89682, "user_id": 675383, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/6e7a971eb341ffeaa3efca407239bf3b?s=128&d=identicon&r=PG", "display_name": "nhaarman", "link": "https://stackoverflow.com/users/675383/nhaarman"}, "edited": false, "score": 2, "creation_date": 1465936561, "post_id": 37821469, "comment_id": 63107009, "body": "You know that <code>copy</code> returns a new instance, and does not modify the receiver?"}], "answers": [{"comments": [{"owner": {"reputation": 19114, "user_id": 4137489, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4d6e58042c9b1e87df5f5df4796b389f?s=128&d=identicon&r=PG&f=1", "display_name": "marstran", "link": "https://stackoverflow.com/users/4137489/marstran"}, "edited": false, "score": 4, "creation_date": 1465974761, "post_id": 37821662, "comment_id": 63119253, "body": "Also, you should do <code>val list = state?.list?.subList(0,1) ?: emptyList()</code>, instead of using the <code>!!</code>-operator to avoid NullPointerExceptions."}], "tags": [], "owner": {"reputation": 19114, "user_id": 4137489, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4d6e58042c9b1e87df5f5df4796b389f?s=128&d=identicon&r=PG&f=1", "display_name": "marstran", "link": "https://stackoverflow.com/users/4137489/marstran"}, "is_accepted": true, "score": 10, "last_activity_date": 1466334225, "last_edit_date": 1466334225, "creation_date": 1465936657, "answer_id": 37821662, "question_id": 37821469, "link": "https://stackoverflow.com/questions/37821469/kotlin-data-class-copy-with-changed-var-value/37821662#37821662", "title": "Kotlin data class copy with changed var value", "body": "<p>The <code>copy</code> method does not mutate the original object. It returns a new object with the changed values. I tried your example, and both of your copies work as expected when I capture the returned object in a new <code>val</code>:</p>\n\n<pre><code>val list = state!!.list.subList(0,1)\n\n// Creates a new object with the new list.\nval withNewList = state.copy(list = list)\n\n// Creates a new object with the new isFetching.\nval withNewIsFetching = withNewList.copy(isFetching = true)\n</code></pre>\n\n<p>If you want to mutate the list-value of your <code>state</code>-object, you can just do this:</p>\n\n<pre><code>val list = state!!.list.subList(0,1)\nstate.list = list\n</code></pre>\n"}], "owner": {"reputation": 706, "user_id": 1001883, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/81TSW.jpg?s=128&g=1", "display_name": "aleien", "link": "https://stackoverflow.com/users/1001883/aleien"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6249, "favorite_count": 0, "accepted_answer_id": 37821662, "answer_count": 1, "score": 4, "last_activity_date": 1466334225, "creation_date": 1465935934, "question_id": 37821469, "link": "https://stackoverflow.com/questions/37821469/kotlin-data-class-copy-with-changed-var-value", "title": "Kotlin data class copy with changed var value", "body": "<p>Why can't you copy data class object with var value change?</p>\n\n<pre><code>data class AppState(var list: List&lt;Image&gt; = ArrayList&lt;Image&gt;(),\n                val uiState: UIState = UIState.LIST,\n                val isFetching: Boolean = false)\n\n...\n\nval list = state!!.list.sublist(0,1);\nstate.copy(list = list)        // No change\nstate.copy(isFetching = true)  // Works like a charm\n</code></pre>\n"}, {"tags": ["generics", "kotlin"], "answers": [{"tags": [], "owner": {"reputation": 24586, "user_id": 3255152, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fbd95ef81d0a85310fee8dd46e0f65b0?s=128&d=identicon&r=PG&f=1", "display_name": "mfulton26", "link": "https://stackoverflow.com/users/3255152/mfulton26"}, "is_accepted": true, "score": 4, "last_activity_date": 1465921343, "creation_date": 1465921343, "answer_id": 37817378, "question_id": 37817018, "link": "https://stackoverflow.com/questions/37817018/kotlin-trouble-understanding-generics/37817378#37817378", "title": "Kotlin: trouble understanding generics", "body": "<p><code>T</code> and <code>Model</code> may not be the same types. As such, you will need separate generic parameters for each list parameter:</p>\n\n<pre><code>fun &lt;T1, T2&gt; twoParamFunc(oldList: List&lt;T1&gt;, newList: List&lt;T2&gt;)\n        where T1 : A, T1 : B, T2 : A, T2 : B { }\n</code></pre>\n"}], "owner": {"reputation": 809, "user_id": 5360247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a3bd815adc338fc30cb1d4b950bc655?s=128&d=identicon&r=PG&f=1", "display_name": "Artur  Dumchev", "link": "https://stackoverflow.com/users/5360247/artur-dumchev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "accepted_answer_id": 37817378, "answer_count": 1, "score": 3, "last_activity_date": 1465930918, "creation_date": 1465920217, "last_edit_date": 1465930918, "question_id": 37817018, "link": "https://stackoverflow.com/questions/37817018/kotlin-trouble-understanding-generics", "title": "Kotlin: trouble understanding generics", "body": "<p>I have a model implementing two interfaces</p>\n\n<pre><code>interface A\ninterface B\nclass Model() : A, B\n</code></pre>\n\n<p>When I  pass one parameter as a List of my Model class, compiler understands that Model is A and B. But when I pass two parameters, where one of them is given with the type T (where T: A, T: B), compiler cant understand it.</p>\n\n<pre><code>protected fun &lt;T&gt; test(givenList: List&lt;T&gt;) where T : A, T : B {\n\n    val testList = ArrayList&lt;Model&gt;()\n    oneParamFunc(testList) // will compile\n    oneParamFunc(givenList) // will compile\n\n    twoParamFunc(givenList, testList) // won't  compile (inferred type Any is not a subtype of A)\n    twoParamFunc&lt;T&gt;(givenList, testList) // won't compile (Required List&lt;T&gt;, Found ArrayList&lt;Model&gt;)\n}\n\nprotected fun &lt;T&gt; oneParamFunc(list: List&lt;T&gt;) where T : A, T : B { }\nprotected fun &lt;T&gt; twoParamFunc(oldList: List&lt;T&gt;, newList: List&lt;T&gt;) where T : A, T : B { }\n</code></pre>\n\n<p>What do I need to change to make it work?</p>\n"}, {"tags": ["android", "kotlin", "android-databinding"], "comments": [{"owner": {"reputation": 29521, "user_id": 1950649, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Yb5YJ.jpg?s=128&g=1", "display_name": "Vladimir Mironov", "link": "https://stackoverflow.com/users/1950649/vladimir-mironov"}, "edited": false, "score": 2, "creation_date": 1465906421, "post_id": 37809128, "comment_id": 63087478, "body": "It&#39;s a known issue <a href=\"https://youtrack.jetbrains.com/issue/KT-12402\" rel=\"nofollow noreferrer\">youtrack.jetbrains.com/issue/KT-12402</a>"}, {"owner": {"reputation": 2292, "user_id": 3383038, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/PR3Vp.jpg?s=128&g=1", "display_name": "Oleg Osipenko", "link": "https://stackoverflow.com/users/3383038/oleg-osipenko"}, "reply_to_user": {"reputation": 29521, "user_id": 1950649, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Yb5YJ.jpg?s=128&g=1", "display_name": "Vladimir Mironov", "link": "https://stackoverflow.com/users/1950649/vladimir-mironov"}, "edited": false, "score": 0, "creation_date": 1466071270, "post_id": 37809128, "comment_id": 63169842, "body": "Yeah, thanks. Very useful tracker for those using Kotlin.  Seems like something related to Kotlin Lint, I think"}], "answers": [{"tags": [], "owner": {"reputation": 5069, "user_id": 1510222, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8148c5fe86305366fef9466c2cf2143b?s=128&d=identicon&r=PG&f=1", "display_name": "Arkadiusz Cie\u015bli\u0144ski", "link": "https://stackoverflow.com/users/1510222/arkadiusz-cie%c5%9bli%c5%84ski"}, "is_accepted": false, "score": 1, "last_activity_date": 1488476436, "creation_date": 1488476436, "answer_id": 42562262, "question_id": 37809128, "link": "https://stackoverflow.com/questions/37809128/data-binding-kotlin-android-studio-errors/42562262#42562262", "title": "Data Binding Kotlin Android studio errors", "body": "<p>Until the IDE shows the error, you can use this:</p>\n\n<pre><code>binding.setVariable(BR.model, Model())\n</code></pre>\n\n<p>It is not so concise as kotlin form but the red color will not drive you crazy any more ;)</p>\n"}], "owner": {"reputation": 2292, "user_id": 3383038, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/PR3Vp.jpg?s=128&g=1", "display_name": "Oleg Osipenko", "link": "https://stackoverflow.com/users/3383038/oleg-osipenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2811, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1488476436, "creation_date": 1465899230, "question_id": 37809128, "link": "https://stackoverflow.com/questions/37809128/data-binding-kotlin-android-studio-errors", "title": "Data Binding Kotlin Android studio errors", "body": "<p>I am trying to use Data binding library in my project, that is written in Kotlin. I am using Kotlin v.1.0.2 &amp; Gradle plugin v. 2.12 and with binding compiler. My build.gradle configured as follows:</p>\n\n<pre><code>android {\n    dataBinding {\n        enabled = true\n    }\n}\nkapt {\n    generateStubs = true\n}\ndependencies {\n    kapt \"com.google.dagger:dagger-compiler:2.2\"\n    provided \"org.glassfish:javax.annotation:10.0-b28\"\n    kapt \"com.android.databinding:compiler:2.12\"\n}\n</code></pre>\n\n<p>In my Fragment layout I declared <code>&lt;data&gt;</code> block with some variables:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;layout xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt;\n    &lt;data&gt;\n        &lt;import type=\"android.view.View\"/&gt;\n        &lt;import type=\"com.xxx.ui.AuthorizationPresenter\"/&gt;\n        &lt;import type=\"com.xxx.entity.AuthProvider\"/&gt;\n        &lt;variable\n            name=\"model\"\n            type=\"com.xxx.ui.authorization.Model\"/&gt;\n        &lt;variable\n            name=\"presenter\"\n            type=\"com.xxx.ui.authorization.AuthorizationPresenter\"/&gt;\n\n    &lt;/data&gt;\n    &lt;FrameLayout\n  ... /&gt;\n&lt;/layout&gt;\n</code></pre>\n\n<p>And then in my <code>AuthorizationFragment.kt</code> class I am setting these variables:</p>\n\n<pre><code>override fun onCreateView(inflater: LayoutInflater?, container: ViewGroup?, savedInstanceState: Bundle?): View? {\n    binding = FragmentAuthorizationBinding.inflate(inflater)\n    binding?.presenter = presenter\n    binding?.model = Model()\n    binding?.addOnRebindCallback(object : OnRebindCallback&lt;FragmentAuthorizationBinding&gt;() {\n        override fun onPreBind(binding: FragmentAuthorizationBinding?): Boolean {\n            val sceneRoot = binding?.root as ViewGroup\n            TransitionManager.beginDelayedTransition(sceneRoot)\n            return true\n        }\n    })\n    return binding?.root\n}\n</code></pre>\n\n<p>And the problem is though this code successfully compiles and builds APK, Android studio marks these lines</p>\n\n<pre><code>binding?.presenter = presenter\nbinding?.model = Model()\n</code></pre>\n\n<p>as invalid and shows the following error: <code>Cannot access class 'com.xxx.ui.authorization.AuthorizationPresenter'. Check your module classpath for missing or conflicting dependencies</code>. \nI tried to add <code>kapt 'com.google.guava:guava:19.0'</code> to my <code>build.gradle</code>, but nothing has changed.\nAlso worth to mention that problem is only appears when I write my fragment in Kotlin, when it is written in Java everything is ok. </p>\n"}, {"tags": ["interface", "kotlin"], "comments": [{"owner": {"reputation": 32343, "user_id": 155213, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57bc3e08faeb981ddc81abd1d25c3bf1?s=128&d=identicon&r=PG", "display_name": "miensol", "link": "https://stackoverflow.com/users/155213/miensol"}, "edited": false, "score": 1, "creation_date": 1465892209, "post_id": 37805860, "comment_id": 63077531, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/37672023/how-to-create-an-instance-of-anonymous-interface-in-kotlin\">How to create an instance of anonymous interface in Kotlin?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 29751, "user_id": 3286489, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yTcB3.png?s=128&g=1", "display_name": "Elye", "link": "https://stackoverflow.com/users/3286489/elye"}, "edited": false, "score": 0, "creation_date": 1465890484, "post_id": 37805931, "comment_id": 63076465, "body": "Thanks! Great. When I search in <a href=\"https://kotlinlang.org/docs/reference/interfaces.html\" rel=\"nofollow noreferrer\">kotlinlang.org/docs/reference/interfaces.html</a>, it didn&#39;t even touch anything on that. The documentation is quite obscured. Search on the internet also can&#39;t find it. The only place to find this is to manually write a Java code, and convert it... Hopefully my stackoverflow question would help others searching for this quickly to find it. Thanks!"}, {"owner": {"reputation": 630270, "user_id": 571407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f0d9dec16bae1e06552af55ddefc11f?s=128&d=identicon&r=PG", "display_name": "JB Nizet", "link": "https://stackoverflow.com/users/571407/jb-nizet"}, "reply_to_user": {"reputation": 29751, "user_id": 3286489, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yTcB3.png?s=128&g=1", "display_name": "Elye", "link": "https://stackoverflow.com/users/3286489/elye"}, "edited": false, "score": 0, "creation_date": 1465891079, "post_id": 37805931, "comment_id": 63076823, "body": "I suggested to improve the documentation in the kotlin slack. I agree that the information isn&#39;t that easy to find in the doc."}, {"owner": {"reputation": 29751, "user_id": 3286489, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yTcB3.png?s=128&g=1", "display_name": "Elye", "link": "https://stackoverflow.com/users/3286489/elye"}, "edited": false, "score": 0, "creation_date": 1465891293, "post_id": 37805931, "comment_id": 63076966, "body": "That sounds great!"}, {"owner": {"reputation": 630270, "user_id": 571407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f0d9dec16bae1e06552af55ddefc11f?s=128&d=identicon&r=PG", "display_name": "JB Nizet", "link": "https://stackoverflow.com/users/571407/jb-nizet"}, "reply_to_user": {"reputation": 29751, "user_id": 3286489, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yTcB3.png?s=128&g=1", "display_name": "Elye", "link": "https://stackoverflow.com/users/3286489/elye"}, "edited": false, "score": 2, "creation_date": 1465900082, "post_id": 37805931, "comment_id": 63082900, "body": "The documentation has been improved: <a href=\"https://kotlinlang.org/docs/reference/nested-classes.html#anonymous-inner-classes\" rel=\"nofollow noreferrer\">kotlinlang.org/docs/reference/&hellip;</a> and <a href=\"https://kotlinlang.org/docs/reference/classes.html#creating-instances-of-classes\" rel=\"nofollow noreferrer\">kotlinlang.org/docs/reference/&hellip;</a>"}, {"owner": {"reputation": 29751, "user_id": 3286489, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yTcB3.png?s=128&g=1", "display_name": "Elye", "link": "https://stackoverflow.com/users/3286489/elye"}, "edited": false, "score": 0, "creation_date": 1465991590, "post_id": 37805931, "comment_id": 63130552, "body": "Cool for improving the documentation. Look at the number of &#39;tick&#39; at your answer within two days. Clearly this is a hot question and your answer helps to answer them."}, {"owner": {"reputation": 3967, "user_id": 2736039, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/pWFP5.png?s=128&g=1", "display_name": "Ultimo_m", "link": "https://stackoverflow.com/users/2736039/ultimo-m"}, "edited": false, "score": 0, "creation_date": 1508501242, "post_id": 37805931, "comment_id": 80644773, "body": "I dont know why you rollback my edit but can you tell IntelliJ to fix this: <a href=\"https://ibb.co/mHZuqm\" rel=\"nofollow noreferrer\">ibb.co/mHZuqm</a>"}, {"owner": {"reputation": 630270, "user_id": 571407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f0d9dec16bae1e06552af55ddefc11f?s=128&d=identicon&r=PG", "display_name": "JB Nizet", "link": "https://stackoverflow.com/users/571407/jb-nizet"}, "reply_to_user": {"reputation": 3967, "user_id": 2736039, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/pWFP5.png?s=128&g=1", "display_name": "Ultimo_m", "link": "https://stackoverflow.com/users/2736039/ultimo-m"}, "edited": false, "score": 1, "creation_date": 1508515427, "post_id": 37805931, "comment_id": 80653416, "body": "@Ultimo_m sorry for that. The syntax with parentheses is correct to create an anonymous object extending a class and calling its default constructor. When implementing an interface, the parentheses should indeed not be there."}], "tags": [], "owner": {"reputation": 630270, "user_id": 571407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f0d9dec16bae1e06552af55ddefc11f?s=128&d=identicon&r=PG", "display_name": "JB Nizet", "link": "https://stackoverflow.com/users/571407/jb-nizet"}, "is_accepted": true, "score": 44, "last_activity_date": 1508515280, "last_edit_date": 1508515280, "creation_date": 1465890262, "answer_id": 37805931, "question_id": 37805860, "link": "https://stackoverflow.com/questions/37805860/how-to-instantiate-an-anonymous-class-that-implements-an-interface-in-kotlin/37805931#37805931", "title": "How to instantiate an anonymous class that implements an interface in Kotlin", "body": "<p>As explained in <a href=\"https://kotlinlang.org/docs/reference/object-declarations.html\" rel=\"noreferrer\">the documentation</a>:</p>\n\n<pre><code>animation.setAnimationListener(object : Animation.AnimationListener {\n    // All the other override functions\n})\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 29751, "user_id": 3286489, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yTcB3.png?s=128&g=1", "display_name": "Elye", "link": "https://stackoverflow.com/users/3286489/elye"}, "is_accepted": false, "score": 6, "last_activity_date": 1480519848, "creation_date": 1480519848, "answer_id": 40892187, "question_id": 37805860, "link": "https://stackoverflow.com/questions/37805860/how-to-instantiate-an-anonymous-class-that-implements-an-interface-in-kotlin/40892187#40892187", "title": "How to instantiate an anonymous class that implements an interface in Kotlin", "body": "<p>Apparently the latest way (using Kotlin 1.0.5) of doing it is now without the parenthesis, given there's no empty constructor for the interface.</p>\n\n<pre><code>animation.setAnimationListener(object : Animation.AnimationListener {\n    // All the other override functions\n})\n</code></pre>\n"}], "owner": {"reputation": 29751, "user_id": 3286489, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yTcB3.png?s=128&g=1", "display_name": "Elye", "link": "https://stackoverflow.com/users/3286489/elye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8955, "favorite_count": 1, "accepted_answer_id": 37805931, "answer_count": 2, "score": 17, "last_activity_date": 1508515280, "creation_date": 1465890050, "last_edit_date": 1466323463, "question_id": 37805860, "link": "https://stackoverflow.com/questions/37805860/how-to-instantiate-an-anonymous-class-that-implements-an-interface-in-kotlin", "title": "How to instantiate an anonymous class that implements an interface in Kotlin", "body": "<p>In Java, instantiate an interface object is as easy as <code>new Interface()</code>... and override all the required functions as below, on <code>AnimationListener</code></p>\n\n<pre><code>private void doingSomething(Context context) {\n    Animation animation = AnimationUtils.loadAnimation(context, android.R.anim.fade_in);\n    animation.setAnimationListener(new Animation.AnimationListener() {\n        // All the other override functions\n    });\n}\n</code></pre>\n\n<p>However, in Kotlin when we type</p>\n\n<pre><code>private fun doingSomething(context: Context) {\n    val animation = AnimationUtils.loadAnimation(context, android.R.anim.fade_in)\n    animation.setAnimationListener(Animation.AnimationListener(){\n        // All the other override functions\n    })\n}\n</code></pre>\n\n<p>It error complaints unresolved References AnimationListener.</p>\n"}, {"tags": ["enums", "kotlin"], "comments": [{"owner": {"reputation": 3987, "user_id": 2449744, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/zky84.jpg?s=128&g=1", "display_name": "Eldar Agalarov", "link": "https://stackoverflow.com/users/2449744/eldar-agalarov"}, "edited": false, "score": 0, "creation_date": 1594297322, "post_id": 37794850, "comment_id": 111080626, "body": "Your Enum should implement Identifiable interface with id property and companion object should extend abstract class GettableById which holds idToEnumValue map and returns enum value based on id. Details is below in my answer."}], "answers": [{"comments": [{"owner": {"reputation": 24586, "user_id": 3255152, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fbd95ef81d0a85310fee8dd46e0f65b0?s=128&d=identicon&r=PG&f=1", "display_name": "mfulton26", "link": "https://stackoverflow.com/users/3255152/mfulton26"}, "edited": false, "score": 9, "creation_date": 1465839085, "post_id": 37795810, "comment_id": 63057684, "body": "I was about to recommend the same. In addition, I would make <code>fromInt</code> return non-null like <code>Enum.valueOf(String)</code>: <code>map[type] ?: throw IllegalArgumentException()</code>"}, {"owner": {"reputation": 630270, "user_id": 571407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f0d9dec16bae1e06552af55ddefc11f?s=128&d=identicon&r=PG", "display_name": "JB Nizet", "link": "https://stackoverflow.com/users/571407/jb-nizet"}, "reply_to_user": {"reputation": 24586, "user_id": 3255152, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fbd95ef81d0a85310fee8dd46e0f65b0?s=128&d=identicon&r=PG&f=1", "display_name": "mfulton26", "link": "https://stackoverflow.com/users/3255152/mfulton26"}, "edited": false, "score": 4, "creation_date": 1465839354, "post_id": 37795810, "comment_id": 63057822, "body": "Given the kotlin support for null-safety, returning null from the method wouldn&#39;t bother me as it would in Java: the caller will be forced by the compiler to deal with a null returned value, and decide what to do (throw or do something else)."}, {"owner": {"reputation": 1215, "user_id": 2108961, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/999e2065097ff2ebc60148d16acfb124?s=128&d=identicon&r=PG", "display_name": "Baron", "link": "https://stackoverflow.com/users/2108961/baron"}, "edited": false, "score": 0, "creation_date": 1465849370, "post_id": 37795810, "comment_id": 63063044, "body": "Thanks, that is pretty compact code. The reason I had fromInt(type: Int?) is that in my case I was mapping values from a database and using JDBI to do the mapping, which returns an Int? and not an Int when retrieving a column value. If for instance, that column is nullable and returns a null, it seems ok in my use case to pass the nullable along."}, {"owner": {"reputation": 6434, "user_id": 539599, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/6iB0U.jpg?s=128&g=1", "display_name": "Raphael", "link": "https://stackoverflow.com/users/539599/raphael"}, "edited": false, "score": 0, "creation_date": 1490384949, "post_id": 37795810, "comment_id": 73105521, "body": "@JBNizet I agree; so why does the standard <code>valueOf(String)</code> not return an optional? *sigh*"}, {"owner": {"reputation": 630270, "user_id": 571407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f0d9dec16bae1e06552af55ddefc11f?s=128&d=identicon&r=PG", "display_name": "JB Nizet", "link": "https://stackoverflow.com/users/571407/jb-nizet"}, "reply_to_user": {"reputation": 6434, "user_id": 539599, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/6iB0U.jpg?s=128&g=1", "display_name": "Raphael", "link": "https://stackoverflow.com/users/539599/raphael"}, "edited": false, "score": 1, "creation_date": 1490385345, "post_id": 37795810, "comment_id": 73105739, "body": "@Raphael because enums were introduced in Java 5 and Optional in Java 8."}, {"owner": {"reputation": 6434, "user_id": 539599, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/6iB0U.jpg?s=128&g=1", "display_name": "Raphael", "link": "https://stackoverflow.com/users/539599/raphael"}, "edited": false, "score": 0, "creation_date": 1490388762, "post_id": 37795810, "comment_id": 73107420, "body": "@JBNizet Last I looked, Kotlin was a lot newer."}, {"owner": {"reputation": 481, "user_id": 617232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1fd29e558765db544be2245cf953912?s=128&d=identicon&r=PG", "display_name": "Hoang Tran", "link": "https://stackoverflow.com/users/617232/hoang-tran"}, "edited": false, "score": 2, "creation_date": 1519313943, "post_id": 37795810, "comment_id": 84869412, "body": "my version of this code use <code>by lazy{}</code> for the <code>map</code> and <code>getOrDefault()</code> for safer access by <code>value</code>"}, {"owner": {"reputation": 2283, "user_id": 320911, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/adCJz.jpg?s=128&g=1", "display_name": "Arto Bendiken", "link": "https://stackoverflow.com/users/320911/arto-bendiken"}, "edited": false, "score": 2, "creation_date": 1526567916, "post_id": 37795810, "comment_id": 87804161, "body": "This solution works well. Note that to be able to call <code>Type.fromInt()</code> from Java code, you will need to annotate the method with <code>@JvmStatic</code>."}, {"owner": {"reputation": 313, "user_id": 636971, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d481cf2de2cca1b6c7f62f06a52f6987?s=128&d=identicon&r=PG", "display_name": "Alex V.", "link": "https://stackoverflow.com/users/636971/alex-v"}, "edited": false, "score": 1, "creation_date": 1549442028, "post_id": 37795810, "comment_id": 95898892, "body": "You could even replace <code>fromInt</code> with <code>operator fun invoke(type: Int) = map[type]!!</code>, and then use constructor syntax <code>val t = Type(x)</code>."}, {"owner": {"reputation": 719, "user_id": 4504727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab85f16f9d482ba8794eb333c89b852d?s=128&d=identicon&r=PG&f=1", "display_name": "IPP Nerd", "link": "https://stackoverflow.com/users/4504727/ipp-nerd"}, "edited": false, "score": 0, "creation_date": 1606383760, "post_id": 37795810, "comment_id": 114949619, "body": "This solution has the downside of (some) memory consumption, but does not better perform than other solutions that do not use a Map."}], "tags": [], "owner": {"reputation": 630270, "user_id": 571407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f0d9dec16bae1e06552af55ddefc11f?s=128&d=identicon&r=PG", "display_name": "JB Nizet", "link": "https://stackoverflow.com/users/571407/jb-nizet"}, "is_accepted": true, "score": 195, "last_activity_date": 1562589069, "last_edit_date": 1562589069, "creation_date": 1465838949, "answer_id": 37795810, "question_id": 37794850, "link": "https://stackoverflow.com/questions/37794850/effective-enums-in-kotlin-with-reverse-lookup/37795810#37795810", "title": "Effective Enums in Kotlin with reverse lookup?", "body": "<p>First of all, the argument of <code>fromInt()</code> should be an <code>Int</code>, not an <code>Int?</code>. Trying to get a <code>Type</code> using null will obviously lead to null, and a caller shouldn't even try doing that. The <code>Map</code> has also no reason to be mutable. The code can be reduced to:</p>\n\n<pre><code>companion object {\n    private val map = Type.values().associateBy(Type::value)\n    fun fromInt(type: Int) = map[type]\n}\n</code></pre>\n\n<p>That code is so short that, frankly, I'm not sure it's worth trying to find a reusable solution.</p>\n"}, {"comments": [{"owner": {"reputation": 166, "user_id": 3738453, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bfc5f2468216dbb6dc7c980e7587f16f?s=128&d=identicon&r=PG&f=1", "display_name": "Connor Wyatt", "link": "https://stackoverflow.com/users/3738453/connor-wyatt"}, "edited": false, "score": 3, "creation_date": 1482058379, "post_id": 37796340, "comment_id": 69614027, "body": "That&#39;s a lot of work for such a simple operation, the accepted answer is much cleaner IMO"}, {"owner": {"reputation": 32343, "user_id": 155213, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57bc3e08faeb981ddc81abd1d25c3bf1?s=128&d=identicon&r=PG", "display_name": "miensol", "link": "https://stackoverflow.com/users/155213/miensol"}, "reply_to_user": {"reputation": 166, "user_id": 3738453, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bfc5f2468216dbb6dc7c980e7587f16f?s=128&d=identicon&r=PG&f=1", "display_name": "Connor Wyatt", "link": "https://stackoverflow.com/users/3738453/connor-wyatt"}, "edited": false, "score": 2, "creation_date": 1482073115, "post_id": 37796340, "comment_id": 69617797, "body": "Fully agree for simple use it&#39;s definitely better. I had the above code already to handle explicit names for given enumerated member."}, {"owner": {"reputation": 3987, "user_id": 2449744, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/zky84.jpg?s=128&g=1", "display_name": "Eldar Agalarov", "link": "https://stackoverflow.com/users/2449744/eldar-agalarov"}, "edited": false, "score": 0, "creation_date": 1594049095, "post_id": 37796340, "comment_id": 110983279, "body": "Your code using reflection (bad) and is bloated (bad too)."}], "tags": [], "owner": {"reputation": 32343, "user_id": 155213, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57bc3e08faeb981ddc81abd1d25c3bf1?s=128&d=identicon&r=PG", "display_name": "miensol", "link": "https://stackoverflow.com/users/155213/miensol"}, "is_accepted": false, "score": 6, "last_activity_date": 1465841436, "last_edit_date": 1465841436, "creation_date": 1465840929, "answer_id": 37796340, "question_id": 37794850, "link": "https://stackoverflow.com/questions/37794850/effective-enums-in-kotlin-with-reverse-lookup/37796340#37796340", "title": "Effective Enums in Kotlin with reverse lookup?", "body": "<p>I found myself doing the reverse lookup by custom, hand coded, value couple of times and came of up with following approach.</p>\n\n<p>Make <code>enum</code>s implement a shared interface:</p>\n\n<pre><code>interface Codified&lt;out T : Serializable&gt; {\n    val code: T\n}\n\nenum class Alphabet(val value: Int) : Codified&lt;Int&gt; {\n    A(1),\n    B(2),\n    C(3);\n\n    override val code = value\n}\n</code></pre>\n\n<p>This interface <em>(however strange the name is :))</em> marks a certain value as the explicit code. The goal is to be able to write:</p>\n\n<pre><code>val a = Alphabet::class.decode(1) //Alphabet.A\nval d = Alphabet::class.tryDecode(4) //null\n</code></pre>\n\n<p>Which can easily be achieved with the following code:</p>\n\n<pre><code>interface Codified&lt;out T : Serializable&gt; {\n    val code: T\n\n    object Enums {\n        private val enumCodesByClass = ConcurrentHashMap&lt;Class&lt;*&gt;, Map&lt;Serializable, Enum&lt;*&gt;&gt;&gt;()\n\n        inline fun &lt;reified T, TCode : Serializable&gt; decode(code: TCode): T where T : Codified&lt;TCode&gt;, T : Enum&lt;*&gt; {\n            return decode(T::class.java, code)\n        }\n\n        fun &lt;T, TCode : Serializable&gt; decode(enumClass: Class&lt;T&gt;, code: TCode): T where T : Codified&lt;TCode&gt; {\n            return tryDecode(enumClass, code) ?: throw IllegalArgumentException(\"No $enumClass value with code == $code\")\n        }\n\n        inline fun &lt;reified T, TCode : Serializable&gt; tryDecode(code: TCode): T? where T : Codified&lt;TCode&gt; {\n            return tryDecode(T::class.java, code)\n        }\n\n        @Suppress(\"UNCHECKED_CAST\")\n        fun &lt;T, TCode : Serializable&gt; tryDecode(enumClass: Class&lt;T&gt;, code: TCode): T? where T : Codified&lt;TCode&gt; {\n            val valuesForEnumClass = enumCodesByClass.getOrPut(enumClass as Class&lt;Enum&lt;*&gt;&gt;, {\n                enumClass.enumConstants.associateBy { (it as T).code }\n            })\n\n            return valuesForEnumClass[code] as T?\n        }\n    }\n}\n\nfun &lt;T, TCode&gt; KClass&lt;T&gt;.decode(code: TCode): T\n        where T : Codified&lt;TCode&gt;, T : Enum&lt;T&gt;, TCode : Serializable \n        = Codified.Enums.decode(java, code)\n\nfun &lt;T, TCode&gt; KClass&lt;T&gt;.tryDecode(code: TCode): T?\n        where T : Codified&lt;TCode&gt;, T : Enum&lt;T&gt;, TCode : Serializable\n        = Codified.Enums.tryDecode(java, code)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3987, "user_id": 2449744, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/zky84.jpg?s=128&g=1", "display_name": "Eldar Agalarov", "link": "https://stackoverflow.com/users/2449744/eldar-agalarov"}, "edited": false, "score": 1, "creation_date": 1594048707, "post_id": 37802257, "comment_id": 110983045, "body": "Why you use open class? Just make it abstract."}], "tags": [], "owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "is_accepted": false, "score": 29, "last_activity_date": 1465873243, "creation_date": 1465873243, "answer_id": 37802257, "question_id": 37794850, "link": "https://stackoverflow.com/questions/37794850/effective-enums-in-kotlin-with-reverse-lookup/37802257#37802257", "title": "Effective Enums in Kotlin with reverse lookup?", "body": "<p>It makes not much sense in this case, but here is a \"logic extraction\" for @JBNized's solution:</p>\n\n<pre><code>open class EnumCompanion&lt;T, V&gt;(private val valueMap: Map&lt;T, V&gt;) {\n    fun fromInt(type: T) = valueMap[type]\n}\n\nenum class TT(val x: Int) {\n    A(10),\n    B(20),\n    C(30);\n\n    companion object : EnumCompanion&lt;Int, TT&gt;(TT.values().associateBy(TT::x))\n}\n\n//sorry I had to rename things for sanity\n</code></pre>\n\n<p>In general that's the thing about companion objects that they can be reused (unlike static members in a Java class)</p>\n"}, {"comments": [{"owner": {"reputation": 16055, "user_id": 2914140, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/Ik94c.jpg?s=128&g=1", "display_name": "CoolMind", "link": "https://stackoverflow.com/users/2914140/coolmind"}, "edited": false, "score": 0, "creation_date": 1545917472, "post_id": 47113332, "comment_id": 94730309, "body": "This works for constants 0, 1, ..., N. If you have them like 100, 50, 35, then it won&#39;t give a right result."}], "tags": [], "owner": {"reputation": 964, "user_id": 2504085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dfd8681a57d495a2206e0fef72a9cef?s=128&d=identicon&r=PG", "display_name": "shmulik.r", "link": "https://stackoverflow.com/users/2504085/shmulik-r"}, "is_accepted": false, "score": -1, "last_activity_date": 1509815522, "creation_date": 1509815522, "answer_id": 47113332, "question_id": 37794850, "link": "https://stackoverflow.com/questions/37794850/effective-enums-in-kotlin-with-reverse-lookup/47113332#47113332", "title": "Effective Enums in Kotlin with reverse lookup?", "body": "<p>val t = Type.values()[ordinal]</p>\n\n<p>:)</p>\n"}, {"comments": [{"owner": {"reputation": 58671, "user_id": 6509751, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/260caa996ae8ac9fcee35487aa8d7c81?s=128&d=identicon&r=PG&f=1", "display_name": "creativecreatorormaybenot", "link": "https://stackoverflow.com/users/6509751/creativecreatorormaybenot"}, "edited": false, "score": 4, "creation_date": 1521064635, "post_id": 47126179, "comment_id": 85579607, "body": "An obvious enhancement is using <code>first { ... }</code> instead because there is no use for multiple results."}, {"owner": {"reputation": 65664, "user_id": 3998402, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b1deae6b5ee0cdf29e9a4d9f219f547a?s=128&d=identicon&r=PG&f=1", "display_name": "humazed", "link": "https://stackoverflow.com/users/3998402/humazed"}, "reply_to_user": {"reputation": 58671, "user_id": 6509751, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/260caa996ae8ac9fcee35487aa8d7c81?s=128&d=identicon&r=PG&f=1", "display_name": "creativecreatorormaybenot", "link": "https://stackoverflow.com/users/6509751/creativecreatorormaybenot"}, "edited": false, "score": 9, "creation_date": 1533149374, "post_id": 47126179, "comment_id": 90245123, "body": "No, using <code>first</code> is not an enhancement as it changes the behavior and throws <code>NoSuchElementException</code> if the item is not found where <code>find</code> which is equal to <code>firstOrNull</code> returns <code>null</code>.    so if you want to throw instead of returning null use <code>first</code>"}, {"owner": {"reputation": 879, "user_id": 3319147, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/UDAjm.png?s=128&g=1", "display_name": "ecth", "link": "https://stackoverflow.com/users/3319147/ecth"}, "edited": false, "score": 0, "creation_date": 1559716256, "post_id": 47126179, "comment_id": 99502761, "body": "This method can be used with enums with multiple values: <code>fun valueFrom(valueA: Int, valueB: String): EnumType? = values().find { it.valueA == valueA &amp;&amp; it.valueB == valueB }</code>  Also you can throw an exception if the values are not in the enum:  <code>fun valueFrom( ... ) = values().find { ... } ?: throw Exception(&quot;any message&quot;)</code>  or you can use it when calling this method:  <code>var enumValue = EnumType.valueFrom(valueA, valueB) ?: throw Exception( ...)</code>"}, {"owner": {"reputation": 3987, "user_id": 2449744, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/zky84.jpg?s=128&g=1", "display_name": "Eldar Agalarov", "link": "https://stackoverflow.com/users/2449744/eldar-agalarov"}, "edited": false, "score": 0, "creation_date": 1594048663, "post_id": 47126179, "comment_id": 110983015, "body": "Your method have linear complexity O(n). Better to use lookup in predefined HashMap with O(1) complexity."}, {"owner": {"reputation": 65664, "user_id": 3998402, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b1deae6b5ee0cdf29e9a4d9f219f547a?s=128&d=identicon&r=PG&f=1", "display_name": "humazed", "link": "https://stackoverflow.com/users/3998402/humazed"}, "edited": false, "score": 1, "creation_date": 1594049335, "post_id": 47126179, "comment_id": 110983406, "body": "yes, I know but in most cases, the enum will have very small number of states so it doesn&#39;t matter either way, what&#39;s more readable."}], "tags": [], "owner": {"reputation": 65664, "user_id": 3998402, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b1deae6b5ee0cdf29e9a4d9f219f547a?s=128&d=identicon&r=PG&f=1", "display_name": "humazed", "link": "https://stackoverflow.com/users/3998402/humazed"}, "is_accepted": false, "score": 41, "last_activity_date": 1509912894, "creation_date": 1509912894, "answer_id": 47126179, "question_id": 37794850, "link": "https://stackoverflow.com/questions/37794850/effective-enums-in-kotlin-with-reverse-lookup/47126179#47126179", "title": "Effective Enums in Kotlin with reverse lookup?", "body": "<p>we can use <a href=\"https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/find.html\" rel=\"noreferrer\"><code>find</code></a> which <strong>Returns the first element matching the given predicate, or null if no such element was found.</strong></p>\n\n<pre><code>companion object {\n   fun valueOf(value: Int): Type? = Type.values().find { it.value == value }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 949, "user_id": 951155, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f46953d14e2bb66efbad8d8e502528bc?s=128&d=identicon&r=PG", "display_name": "incises", "link": "https://stackoverflow.com/users/951155/incises"}, "is_accepted": false, "score": 1, "last_activity_date": 1555703492, "last_edit_date": 1555703492, "creation_date": 1555702460, "answer_id": 55766971, "question_id": 37794850, "link": "https://stackoverflow.com/questions/37794850/effective-enums-in-kotlin-with-reverse-lookup/55766971#55766971", "title": "Effective Enums in Kotlin with reverse lookup?", "body": "<p>A variant of some previous proposals might be the following, using ordinal field and getValue :</p>\n\n<pre><code>enum class Type {\nA, B, C;\n\ncompanion object {\n    private val map = values().associateBy(Type::ordinal)\n\n    fun fromInt(number: Int): Type {\n        require(number in 0 until map.size) { \"number out of bounds (must be positive or zero &amp; inferior to map.size).\" }\n        return map.getValue(number)\n    }\n}\n</code></pre>\n\n<p>}</p>\n"}, {"comments": [{"owner": {"reputation": 719, "user_id": 4504727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab85f16f9d482ba8794eb333c89b852d?s=128&d=identicon&r=PG&f=1", "display_name": "IPP Nerd", "link": "https://stackoverflow.com/users/4504727/ipp-nerd"}, "edited": false, "score": 0, "creation_date": 1606384249, "post_id": 55971130, "comment_id": 114949826, "body": "This solution performs well and gives the option to provide a default value or <code>?: throw IllegalArgumentException(status.toString())</code>"}], "tags": [], "owner": {"reputation": 2811, "user_id": 1461602, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/zD5wZ.jpg?s=128&g=1", "display_name": "Tormod Haugene", "link": "https://stackoverflow.com/users/1461602/tormod-haugene"}, "is_accepted": false, "score": 3, "last_activity_date": 1556891183, "creation_date": 1556891183, "answer_id": 55971130, "question_id": 37794850, "link": "https://stackoverflow.com/questions/37794850/effective-enums-in-kotlin-with-reverse-lookup/55971130#55971130", "title": "Effective Enums in Kotlin with reverse lookup?", "body": "<p>Another example implementation. This also sets the default value (here to <code>OPEN</code>) if no the input matches no enum option:</p>\n\n<pre><code>enum class Status(val status: Int) {\nOPEN(1),\nCLOSED(2);\n\ncompanion object {\n    @JvmStatic\n    fun fromInt(status: Int): Status =\n        values().find { value -&gt; value.status == status } ?: OPEN\n}\n</code></pre>\n\n<p>}</p>\n"}, {"comments": [{"owner": {"reputation": 745, "user_id": 5323344, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fe9d73857dd62fae8a55e9430c55a75f?s=128&d=identicon&r=PG&f=1", "display_name": "AleksandrH", "link": "https://stackoverflow.com/users/5323344/aleksandrh"}, "edited": false, "score": 0, "creation_date": 1571268574, "post_id": 57572556, "comment_id": 103188032, "body": "Definitely more idiomatic! Cheers."}], "tags": [], "owner": {"reputation": 293, "user_id": 8317973, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Pc7sI.jpg?s=128&g=1", "display_name": "Ivan Plantevin", "link": "https://stackoverflow.com/users/8317973/ivan-plantevin"}, "is_accepted": false, "score": 23, "last_activity_date": 1566300287, "creation_date": 1566300287, "answer_id": 57572556, "question_id": 37794850, "link": "https://stackoverflow.com/questions/37794850/effective-enums-in-kotlin-with-reverse-lookup/57572556#57572556", "title": "Effective Enums in Kotlin with reverse lookup?", "body": "<p>Another option, that could be considered more \"idiomatic\", would be the following:</p>\n\n<pre><code>companion object {\n    private val map = Type.values().associateBy(Type::value)\n    operator fun get(value: Int) = map[value]\n}\n</code></pre>\n\n<p>Which can then be used like <code>Type[type]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 770, "user_id": 3483558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/37b2b303b492c4f50106da398a0335f8?s=128&d=identicon&r=PG&f=1", "display_name": "Shalbert", "link": "https://stackoverflow.com/users/3483558/shalbert"}, "is_accepted": false, "score": 0, "last_activity_date": 1591203092, "creation_date": 1591203092, "answer_id": 62178297, "question_id": 37794850, "link": "https://stackoverflow.com/questions/37794850/effective-enums-in-kotlin-with-reverse-lookup/62178297#62178297", "title": "Effective Enums in Kotlin with reverse lookup?", "body": "<p>Came up with a more generic solution</p>\n\n<pre><code>inline fun &lt;reified T : Enum&lt;*&gt;&gt; findEnumConstantFromProperty(predicate: (T) -&gt; Boolean): T? =\nT::class.java.enumConstants?.find(predicate)\n</code></pre>\n\n<p>Example usage:</p>\n\n<pre><code>findEnumConstantFromProperty&lt;Type&gt; { it.value == 1 } // Equals Type.A\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3987, "user_id": 2449744, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/zky84.jpg?s=128&g=1", "display_name": "Eldar Agalarov", "link": "https://stackoverflow.com/users/2449744/eldar-agalarov"}, "is_accepted": false, "score": 1, "last_activity_date": 1594296521, "last_edit_date": 1594296521, "creation_date": 1594047061, "answer_id": 62758659, "question_id": 37794850, "link": "https://stackoverflow.com/questions/37794850/effective-enums-in-kotlin-with-reverse-lookup/62758659#62758659", "title": "Effective Enums in Kotlin with reverse lookup?", "body": "<p><strong>True Idiomatic Kotlin Way.</strong> Without bloated reflection code:</p>\n<pre><code>interface Identifiable&lt;T : Number&gt; {\n\n    val id: T\n}\n\nabstract class GettableById&lt;T, R&gt;(values: Array&lt;R&gt;) where T : Number, R : Enum&lt;R&gt;, R : Identifiable&lt;T&gt; {\n\n    private val idToValue: Map&lt;T, R&gt; = values.associateBy { it.id }\n\n    operator fun get(id: T): R = getById(id)\n\n    fun getById(id: T): R = idToValue.getValue(id)\n}\n\nenum class DataType(override val id: Short): Identifiable&lt;Short&gt; {\n\n    INT(1), FLOAT(2), STRING(3);\n\n    companion object: GettableById&lt;Short, DataType&gt;(values())\n}\n\nfun main() {\n    println(DataType.getById(1))\n    // or\n    println(DataType[2])\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 242, "user_id": 11454979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/656e72891e182fd676fd3cc31a076024?s=128&d=identicon&r=PG&f=1", "display_name": "Oliver", "link": "https://stackoverflow.com/users/11454979/oliver"}, "is_accepted": false, "score": 0, "last_activity_date": 1598381771, "creation_date": 1598381771, "answer_id": 63585422, "question_id": 37794850, "link": "https://stackoverflow.com/questions/37794850/effective-enums-in-kotlin-with-reverse-lookup/63585422#63585422", "title": "Effective Enums in Kotlin with reverse lookup?", "body": "<p>A slightly extended approach of the accepted solution with null check and invoke function</p>\n<pre><code>fun main(args: Array&lt;String&gt;) {\n    val a = Type.A // find by name\n    val anotherA = Type.valueOf(&quot;A&quot;) // find by name with Enums default valueOf\n    val aLikeAClass = Type(3) // find by value using invoke - looks like object creation\n\n    val againA = Type.of(3) // find by value\n    val notPossible = Type.of(6) // can result in null\n    val notPossibleButThrowsError = Type.ofNullSave(6) // can result in IllegalArgumentException\n\n    // prints: A, A, 0, 3\n    println(&quot;$a, ${a.name}, ${a.ordinal}, ${a.value}&quot;)\n    // prints: A, A, A null, java.lang.IllegalArgumentException: No enum constant Type with value 6\n    println(&quot;$anotherA, $againA, $aLikeAClass $notPossible, $notPossibleButThrowsError&quot;)\n}\n\nenum class Type(val value: Int) {\n    A(3),\n    B(4),\n    C(5);\n\n    companion object {\n        private val map = values().associateBy(Type::value)\n        operator fun invoke(type: Int) = ofNullSave(type)\n        fun of(type: Int) = map[type]\n        fun ofNullSave(type: Int) = map[type] ?: IllegalArgumentException(&quot;No enum constant Type with value $type&quot;)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2157, "user_id": 3422470, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kmBhR.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/3422470/james"}, "is_accepted": false, "score": 0, "last_activity_date": 1605982634, "creation_date": 1605982634, "answer_id": 64946503, "question_id": 37794850, "link": "https://stackoverflow.com/questions/37794850/effective-enums-in-kotlin-with-reverse-lookup/64946503#64946503", "title": "Effective Enums in Kotlin with reverse lookup?", "body": "<p>Based on your example, i might suggest removing the associated value and just use the <code>ordinal</code> which is similar to an index.</p>\n<blockquote>\n<p>ordinal - Returns the ordinal of this enumeration constant (its position in its enum declaration, where the initial constant is assigned an ordinal of zero).</p>\n</blockquote>\n<pre><code>enum class NavInfoType {\n    GreenBuoy,\n    RedBuoy,\n    OtherBeacon,\n    Bridge,\n    Unknown;\n\n    companion object {\n        private val map = values().associateBy(NavInfoType::ordinal)\n        operator fun get(value: Int) = map[value] ?: Unknown\n    }\n}\n</code></pre>\n<p>In my case i wanted to return <code>Unknown</code> if the <code>map</code> returned <code>null</code>. You could also throw an illegal argument exception by replacing the <code>get</code> with the following:</p>\n<pre><code>operator fun get(value: Int) = map[value] ?: throw IllegalArgumentException()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1303, "user_id": 431668, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/db8d950e7ad34c98b0ac9a6b5596de2b?s=128&d=identicon&r=PG", "display_name": "Giordano", "link": "https://stackoverflow.com/users/431668/giordano"}, "is_accepted": false, "score": 0, "last_activity_date": 1609291201, "creation_date": 1609291201, "answer_id": 65500831, "question_id": 37794850, "link": "https://stackoverflow.com/questions/37794850/effective-enums-in-kotlin-with-reverse-lookup/65500831#65500831", "title": "Effective Enums in Kotlin with reverse lookup?", "body": "<p>An approach that reuses code:</p>\n<pre><code>interface IndexedEnum {\n    val value: Int\n\n    companion object {\n        inline fun &lt;reified T : IndexedEnum&gt; valueOf(value: Int) =\n            T::class.java.takeIf { it.isEnum }?.enumConstants?.find { it.value == value }\n    }\n}\n</code></pre>\n<p>Then the enums can be made indexable:</p>\n<pre><code>enum class Type(override val value: Int): IndexedEnum {\n    A(1),\n    B(2),\n    C(3)\n}\n</code></pre>\n<p>and reverse searched like so:</p>\n<pre><code>IndexedEnum.valueOf&lt;Type&gt;(3)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3784, "user_id": 1449683, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/8b53ee2b64a8868fcb13e6a143435807?s=128&d=identicon&r=PG&f=1", "display_name": "squirrel", "link": "https://stackoverflow.com/users/1449683/squirrel"}, "is_accepted": false, "score": 0, "last_activity_date": 1612561596, "creation_date": 1612561596, "answer_id": 66071045, "question_id": 37794850, "link": "https://stackoverflow.com/questions/37794850/effective-enums-in-kotlin-with-reverse-lookup/66071045#66071045", "title": "Effective Enums in Kotlin with reverse lookup?", "body": "<p>If you have a lot of enums, this might save a few keystrokes:</p>\n<pre><code>inline fun &lt;reified T : Enum&lt;T&gt;, V&gt; ((T) -&gt; V).find(value: V): T? {\n    return enumValues&lt;T&gt;().firstOrNull { this(it) == value }\n}\n</code></pre>\n<p>Use it like this:</p>\n<pre><code>enum class Algorithms(val string: String) {\n    Sha1(&quot;SHA-1&quot;),\n    Sha256(&quot;SHA-256&quot;),\n}\n\nfun main() = println(\n    Algorithms::string.find(&quot;SHA-256&quot;)\n            ?: throw IllegalArgumentException(&quot;Bad algorithm string: SHA-256&quot;)\n)\n</code></pre>\n<p>This will print <code>Sha256</code></p>\n"}], "owner": {"reputation": 1215, "user_id": 2108961, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/999e2065097ff2ebc60148d16acfb124?s=128&d=identicon&r=PG", "display_name": "Baron", "link": "https://stackoverflow.com/users/2108961/baron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44049, "favorite_count": 13, "accepted_answer_id": 37795810, "answer_count": 14, "score": 120, "last_activity_date": 1612561596, "creation_date": 1465835446, "last_edit_date": 1508670583, "question_id": 37794850, "link": "https://stackoverflow.com/questions/37794850/effective-enums-in-kotlin-with-reverse-lookup", "title": "Effective Enums in Kotlin with reverse lookup?", "body": "<p>I'm trying to find the best way to do a 'reverse lookup' on an enum in Kotlin. One of my takeaways from Effective Java was that you introduce a static map inside the enum to handle the reverse lookup. Porting this over to Kotlin with a simple enum leads me to code that looks like this:</p>\n\n<pre><code>enum class Type(val value: Int) {\n    A(1),\n    B(2),\n    C(3);\n\n    companion object {\n        val map: MutableMap&lt;Int, Type&gt; = HashMap()\n\n        init {\n            for (i in Type.values()) {\n                map[i.value] = i\n            } \n        }\n\n        fun fromInt(type: Int?): Type? {\n            return map[type]\n        }\n    }\n}\n</code></pre>\n\n<p>My question is, is this the best way to do this, or is there a better way? What if I have several enums that follow a similar pattern? Is there a way in Kotlin to make this code more re-usable across enums?</p>\n"}, {"tags": ["kotlin"], "answers": [{"tags": [], "owner": {"reputation": 4021, "user_id": 3830108, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/elcXQ.jpg?s=128&g=1", "display_name": "Cortwave", "link": "https://stackoverflow.com/users/3830108/cortwave"}, "is_accepted": true, "score": 18, "last_activity_date": 1465828439, "creation_date": 1465828439, "answer_id": 37792491, "question_id": 37792206, "link": "https://stackoverflow.com/questions/37792206/how-do-i-initialize-a-final-field-in-kotlin/37792491#37792491", "title": "How do I initialize a final field in Kotlin?", "body": "<p>You can set <code>val</code> value in init block:</p>\n\n<pre><code>class MyClass {\n\n    val s: String\n\n    init {\n        s = \"value\"\n    }\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 699, "user_id": 709528, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a54d1fc5131216dc0c9d9bc729ea0782?s=128&d=identicon&r=PG", "display_name": "frogcoder", "link": "https://stackoverflow.com/users/709528/frogcoder"}, "is_accepted": false, "score": 9, "last_activity_date": 1465916777, "creation_date": 1465916777, "answer_id": 37815766, "question_id": 37792206, "link": "https://stackoverflow.com/questions/37792206/how-do-i-initialize-a-final-field-in-kotlin/37815766#37815766", "title": "How do I initialize a final field in Kotlin?", "body": "<p>You can also initialize the value with <a href=\"https://kotlinlang.org/docs/reference/delegated-properties.html#lazy\" rel=\"noreferrer\"><code>by lazy</code></a> the value will be initialized the first time it is referred. An example</p>\n\n<pre><code>val s by lazy { RemoteService.result() }\n</code></pre>\n\n<p>kotlin will guess the type of s from the return type of the expression.</p>\n"}, {"tags": [], "owner": {"reputation": 2444, "user_id": 287761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UZJAT.png?s=128&g=1", "display_name": "Enselic", "link": "https://stackoverflow.com/users/287761/enselic"}, "is_accepted": false, "score": 0, "last_activity_date": 1565945373, "creation_date": 1565945373, "answer_id": 57521571, "question_id": 37792206, "link": "https://stackoverflow.com/questions/37792206/how-do-i-initialize-a-final-field-in-kotlin/57521571#57521571", "title": "How do I initialize a final field in Kotlin?", "body": "<p>It has been possible to do it simply like this since the very first official stable release of Kotlin:</p>\n\n<pre><code>class MyClass {\n    val s = RemoteService.result()\n}\n</code></pre>\n"}], "owner": {"reputation": 6221, "user_id": 259288, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c018a1f0997014d4d8332b17bc392ef2?s=128&d=identicon&r=PG", "display_name": "Johnny", "link": "https://stackoverflow.com/users/259288/johnny"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8548, "favorite_count": 0, "accepted_answer_id": 37792491, "answer_count": 3, "score": 13, "last_activity_date": 1565945373, "creation_date": 1465827719, "question_id": 37792206, "link": "https://stackoverflow.com/questions/37792206/how-do-i-initialize-a-final-field-in-kotlin", "title": "How do I initialize a final field in Kotlin?", "body": "<p>Let's say I declared a final field with <code>private final String s</code> (Java) or <code>val s</code> (Kotlin). During initialization I want to initialize the field with the result of a call to a remote service. In Java I would be able to initialize it in the constructor (e.g. <code>s = RemoteService.result()</code>), but in Kotlin I can't figure out how to do that because as far as I can tell the field has to be initialized in the same line it's declared. What's the solution here?</p>\n"}, {"tags": ["android", "enums", "kotlin"], "comments": [{"owner": {"reputation": 79983, "user_id": 147024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b35432f97606c0a31da17084d2414966?s=128&d=identicon&r=PG", "display_name": "yole", "link": "https://stackoverflow.com/users/147024/yole"}, "edited": false, "score": 2, "creation_date": 1465828640, "post_id": 37790545, "comment_id": 63051206, "body": "This appears to be a bug in Kotlin: <a href=\"https://youtrack.jetbrains.com/issue/KT-12694\" rel=\"nofollow noreferrer\">youtrack.jetbrains.com/issue/KT-12694</a>"}], "owner": {"reputation": 466, "user_id": 5056573, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/940712002645523/picture?type=large", "display_name": "henorek", "link": "https://stackoverflow.com/users/5056573/henorek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 211, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1465822872, "creation_date": 1465822872, "question_id": 37790545, "link": "https://stackoverflow.com/questions/37790545/kotlin-runtimeinvisibleparameterannotations-attribute-mytypestring", "title": "Kotlin RuntimeInvisibleParameterAnnotations attribute: MyType(String)", "body": "<p>I have a problem with parametric enums in Kotlin, after integration with Dagger2 I got RuntimeInvisibleParameterAnnotaions attribute: MyType(String) exception during compile time. Any ideas how to fix that? Non parametric enums works like a charm</p>\n\n<p>MyType:</p>\n\n<pre><code>enum class MyType\nconstructor(val value: String) {\n  ABC(\"123\"), DEF(\"456\");\n}\n</code></pre>\n\n<p>Kotlin 1.0.2 with kapt generateStubs = true</p>\n"}, {"tags": ["android", "kotlin"], "comments": [{"owner": {"reputation": 32343, "user_id": 155213, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57bc3e08faeb981ddc81abd1d25c3bf1?s=128&d=identicon&r=PG", "display_name": "miensol", "link": "https://stackoverflow.com/users/155213/miensol"}, "edited": false, "score": 1, "creation_date": 1465821758, "post_id": 37790129, "comment_id": 63046201, "body": "What do you mean by &quot;I can&#39;t save Double in shared preferences&quot; ?"}, {"owner": {"reputation": 9328, "user_id": 4613968, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/100000926329265/picture?type=large", "display_name": "Mathew Hany", "link": "https://stackoverflow.com/users/4613968/mathew-hany"}, "reply_to_user": {"reputation": 32343, "user_id": 155213, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57bc3e08faeb981ddc81abd1d25c3bf1?s=128&d=identicon&r=PG", "display_name": "miensol", "link": "https://stackoverflow.com/users/155213/miensol"}, "edited": false, "score": 2, "creation_date": 1465821806, "post_id": 37790129, "comment_id": 63046243, "body": "There is no <code>putDouble</code> method in the SharedPreferences object."}, {"owner": {"reputation": 3337, "user_id": 3084577, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/H0gcm.jpg?s=128&g=1", "display_name": "lubilis", "link": "https://stackoverflow.com/users/3084577/lubilis"}, "edited": false, "score": 3, "creation_date": 1465821809, "post_id": 37790129, "comment_id": 63046245, "body": "<a href=\"http://stackoverflow.com/questions/16319237/cant-put-double-sharedpreferences\" title=\"cant put double sharedpreferences\">stackoverflow.com/questions/16319237/&hellip;</a> &amp; <a href=\"http://stackoverflow.com/questions/3604849/where-to-save-android-gps-latitude-longitude-points\" title=\"where to save android gps latitude longitude points\">stackoverflow.com/questions/3604849/&hellip;</a>"}, {"owner": {"reputation": 37399, "user_id": 906362, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/677b4a116774ecdee4b161903bdcfb28?s=128&d=identicon&r=PG", "display_name": "Budius", "link": "https://stackoverflow.com/users/906362/budius"}, "edited": false, "score": 0, "creation_date": 1465821878, "post_id": 37790129, "comment_id": 63046290, "body": "here <a href=\"http://stackoverflow.com/questions/16319237/cant-put-double-sharedpreferences\" title=\"cant put double sharedpreferences\">stackoverflow.com/questions/16319237/&hellip;</a>"}, {"owner": {"reputation": 9328, "user_id": 4613968, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/100000926329265/picture?type=large", "display_name": "Mathew Hany", "link": "https://stackoverflow.com/users/4613968/mathew-hany"}, "edited": false, "score": 0, "creation_date": 1465821909, "post_id": 37790129, "comment_id": 63046310, "body": "I read those but I don&#39;t know how to use <code>Double.doubleToLongBits</code> in kotlin"}, {"owner": {"reputation": 124932, "user_id": 2308683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/eac16c9fc481cb6825f8b3a35f916b5c?s=128&d=identicon&r=PG", "display_name": "OneCricketeer", "link": "https://stackoverflow.com/users/2308683/onecricketeer"}, "edited": false, "score": 2, "creation_date": 1465822008, "post_id": 37790129, "comment_id": 63046391, "body": "There&#39;s a nice search bar on StackOverflow.  <a href=\"http://stackoverflow.com/questions/35397116/convert-double-to-bytearray-or-arraybyte-kotlin\" title=\"convert double to bytearray or arraybyte kotlin\">stackoverflow.com/questions/35397116/&hellip;</a>"}, {"owner": {"reputation": 124932, "user_id": 2308683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/eac16c9fc481cb6825f8b3a35f916b5c?s=128&d=identicon&r=PG", "display_name": "OneCricketeer", "link": "https://stackoverflow.com/users/2308683/onecricketeer"}, "edited": false, "score": 1, "creation_date": 1465822191, "post_id": 37790129, "comment_id": 63046532, "body": "I think the Location object is Parcelable, though, so just store that"}], "owner": {"reputation": 9328, "user_id": 4613968, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/100000926329265/picture?type=large", "display_name": "Mathew Hany", "link": "https://stackoverflow.com/users/4613968/mathew-hany"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 300, "favorite_count": 0, "closed_date": 1465822322, "answer_count": 0, "score": 0, "last_activity_date": 1465821663, "creation_date": 1465821663, "question_id": 37790129, "link": "https://stackoverflow.com/questions/37790129/save-and-load-double-values-in-shared-preferences", "closed_reason": "Duplicate", "title": "Save and load double values in shared preferences", "body": "<p>I have a <code>Location</code> object and I want to save it in shared preferences, but I can't because it's an object, so I thought of saving latitude and longitude in shared preferences instead, but the problem is that <code>location.getLatitude()</code> and <code>location.getLongitude()</code> return <code>Double</code> and I can't save <code>Double</code> in shared preferences, however I can save <code>Float</code>, so my question is: Is it a good idea to save latitude and longitude as floats instead of doubles? Is there another way that I missed?</p>\n"}, {"tags": ["java", "android", "vpn", "kotlin", "kotlin-android-extensions"], "comments": [{"owner": {"reputation": 89682, "user_id": 675383, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/6e7a971eb341ffeaa3efca407239bf3b?s=128&d=identicon&r=PG", "display_name": "nhaarman", "link": "https://stackoverflow.com/users/675383/nhaarman"}, "edited": false, "score": 2, "creation_date": 1465813460, "post_id": 37779720, "comment_id": 63040736, "body": "Learn how to create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 79, "user_id": 3103181, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/nvYlc.png?s=128&g=1", "display_name": "heyjohnnyfunt", "link": "https://stackoverflow.com/users/3103181/heyjohnnyfunt"}, "reply_to_user": {"reputation": 89682, "user_id": 675383, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/6e7a971eb341ffeaa3efca407239bf3b?s=128&d=identicon&r=PG", "display_name": "nhaarman", "link": "https://stackoverflow.com/users/675383/nhaarman"}, "edited": false, "score": 0, "creation_date": 1465827038, "post_id": 37779720, "comment_id": 63050123, "body": "@nhaarman thank&#39;s for the tip!"}], "answers": [{"comments": [{"owner": {"reputation": 79, "user_id": 3103181, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/nvYlc.png?s=128&g=1", "display_name": "heyjohnnyfunt", "link": "https://stackoverflow.com/users/3103181/heyjohnnyfunt"}, "edited": false, "score": 0, "creation_date": 1465830786, "post_id": 37783355, "comment_id": 63052726, "body": "I&#39;ve updated the question. I&#39;ve faced another problem. I can&#39;t get any response, but I see that bytes are sending away.  My interface has such configureation: builder.addAddress(&quot;10.0.0.2&quot;, 32).addRoute(&quot;0.0.0.0&quot;, 0) And my tunnel is connected to tunnel.connect(InetSocketAddress(&quot;127.0.0.1&quot;, 55555)). I suppose, I don&#39;t understand something.. But as I can see other examples, their packet forwarding is working with such configurations. Can you give a tip, what might be wrong? Thank you very much!"}, {"owner": {"reputation": 32343, "user_id": 155213, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57bc3e08faeb981ddc81abd1d25c3bf1?s=128&d=identicon&r=PG", "display_name": "miensol", "link": "https://stackoverflow.com/users/155213/miensol"}, "reply_to_user": {"reputation": 79, "user_id": 3103181, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/nvYlc.png?s=128&g=1", "display_name": "heyjohnnyfunt", "link": "https://stackoverflow.com/users/3103181/heyjohnnyfunt"}, "edited": false, "score": 2, "creation_date": 1465839320, "post_id": 37783355, "comment_id": 63057803, "body": "@heyjohnnyfunt The updated question seems like a problem with different root cause - the one I answered was about language usage - whereas the problem you&#39;re having now seems related to Android API usage and network configuration. I guess it would make sense to create a separate question with an image of network nodes (with addresses) and description of what you&#39;re trying to achieve."}, {"owner": {"reputation": 807, "user_id": 2940478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0Wcj9.jpg?s=128&g=1", "display_name": "some1", "link": "https://stackoverflow.com/users/2940478/some1"}, "edited": false, "score": 0, "creation_date": 1594648004, "post_id": 37783355, "comment_id": 111190158, "body": "I think most of us overlook the <a href=\"https://android.googlesource.com/platform/development/+/master/samples/ToyVpn/server/linux\" rel=\"nofollow noreferrer\">ToyVpnServer.cpp</a> which is needed to complete the solution. Anyway, I am not sure how to implement that piece on Android with no root access."}], "tags": [], "owner": {"reputation": 32343, "user_id": 155213, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57bc3e08faeb981ddc81abd1d25c3bf1?s=128&d=identicon&r=PG", "display_name": "miensol", "link": "https://stackoverflow.com/users/155213/miensol"}, "is_accepted": true, "score": 4, "last_activity_date": 1465804078, "last_edit_date": 1465804078, "creation_date": 1465800523, "answer_id": 37783355, "question_id": 37779720, "link": "https://stackoverflow.com/questions/37779720/android-local-vpn-service-cant-get-response/37783355#37783355", "title": "Android local VPN Service: can&#39;t get response", "body": "<p>The error logged in logcat:</p>\n\n<pre><code>Caused by: java.lang.IllegalArgumentException: Parameter specified as non-null is null: method kotlin.jvm.internal.Intrinsics.checkParameterIsNotNull, parameter intent\n              at com.example.skogs.wifictrl.model.VpnFilter.onStartCommand(VpnFilter.kt)\n</code></pre>\n\n<p>indicates the problem. </p>\n\n<p>The documentation of <a href=\"https://developer.android.com/reference/android/app/Service.html\" rel=\"nofollow\"><code>onStartCommand</code></a> states that (emphasis mine):</p>\n\n<blockquote>\n  <p>Intent: The Intent supplied to startService(Intent), as given. <strong>This\n  may be null</strong> if the service is being restarted after its process has\n  gone away, and it had previously returned anything except\n  START_STICKY_COMPATIBILITY.</p>\n</blockquote>\n\n<p>Hence  you should handle the <code>null</code> case accordingly at the very least by changing the signature of <code>onStartCommand</code> in Kotlin to:</p>\n\n<pre><code>override fun onStartCommand(intent:Intent?, flags:Int, startId:Int) {\n</code></pre>\n"}], "owner": {"reputation": 79, "user_id": 3103181, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/nvYlc.png?s=128&g=1", "display_name": "heyjohnnyfunt", "link": "https://stackoverflow.com/users/3103181/heyjohnnyfunt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5550, "favorite_count": 1, "accepted_answer_id": 37783355, "answer_count": 1, "score": 1, "last_activity_date": 1516126592, "creation_date": 1465770753, "last_edit_date": 1495540018, "question_id": 37779720, "link": "https://stackoverflow.com/questions/37779720/android-local-vpn-service-cant-get-response", "title": "Android local VPN Service: can&#39;t get response", "body": "<p>I'm quite new to Android and its services. I'm trying to implement a <strong>local</strong> VPN service in my app (with Kotlin and Java). </p>\n\n<h2>QUESTION</h2>\n\n<p>My VPN service taken from <a href=\"https://android.googlesource.com/platform/development/+/master/samples/ToyVpn/src/com/example/android/toyvpn/ToyVpnClient.java\" rel=\"nofollow noreferrer\">ToyVpn</a> Google example, combined with examples from <a href=\"https://stackoverflow.com/questions/17766405/android-vpnservice-to-capture-packets-wont-capture-packets\">1</a>, <a href=\"https://stackoverflow.com/questions/20237743/android-firewall-with-vpnservice\">2</a>, <a href=\"http://www.thegeekstuff.com/2014/06/android-vpn-service/\" rel=\"nofollow noreferrer\">3</a> to use it locally (without connection to remote server) is NOT working.</p>\n\n<hr>\n\n<h2>MY APP PRINCIPE</h2>\n\n<p><em>I saw <a href=\"https://stackoverflow.com/questions/17766405/android-vpnservice-to-capture-packets-wont-capture-packets\">this</a> and <a href=\"https://stackoverflow.com/questions/20237743/android-firewall-with-vpnservice\">this</a> SO questions, but the answers there aren't very insightful and I can't find the solution for my issue.</em></p>\n\n<p><strong>So the app is pretty simple</strong>: it should forward all of the packets when user click \"YES\"-button on the main activity, and when click \"NO\" - block it. The purpose: <em>to use it as a <strong>firewall</em></strong>, like that:</p>\n\n<p><a href=\"https://i.stack.imgur.com/3F0sr.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/3F0sr.png\" alt=\"The principle of my VPN app\"></a></p>\n\n<p>All of my code is written on Kotlin language, but it's not complicated and is very clear for JAVA developers. So I hope the code above is pretty clear as it is taken from <a href=\"https://android.googlesource.com/platform/development/+/master/samples/ToyVpn/src/com/example/android/toyvpn/ToyVpnClient.java\" rel=\"nofollow noreferrer\">here</a> (ToyVpn example provided by Google) and just converted to kotlin.</p>\n\n<hr>\n\n<h2>MY CONFIGURATION &amp; CODE</h2>\n\n<p>To enable VPN service in my app I placed in my <strong>AndroidManifest.xml</strong> into <code>&lt;application&gt;</code> tag this setting:</p>\n\n<pre><code>&lt;service android:name=\"com.example.username.wifictrl.model.VpnFilter\"\n         android:permission=\"android.permission.BIND_VPN_SERVICE\" &gt;\n    &lt;intent-filter&gt;\n        &lt;action android:name=\"android.net.VpnService\" /&gt;\n    &lt;/intent-filter&gt;\n&lt;/service&gt;\n</code></pre>\n\n<p>My <strong>MainActivity</strong> code contains:</p>\n\n<pre><code>override fun onCreate(savedInstanceState: Bundle?) {\n\n        super.onCreate(savedInstanceState)\n\n        ... // omitted for the sake of brevity\n\n        val intent = VpnService.prepare(this);\n        if (intent != null) {\n            startActivityForResult(intent, 0);\n        } else {\n            onActivityResult(0, RESULT_OK, null);\n        }\n\n        ... // omitted for the sake of brevity\n    }\n\n    override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {\n        super.onActivityResult(requestCode, resultCode, data)\n        if (resultCode == RESULT_OK) {\n            val intent = Intent(this, VpnFilter::class.java);\n            startService(intent);\n        }\n    }\n</code></pre>\n\n<p>My <strong>VpnFilter class</strong> is quite similar to <a href=\"https://android.googlesource.com/platform/development/+/master/samples/ToyVpn/src/com/example/android/toyvpn/ToyVpnService.java\" rel=\"nofollow noreferrer\">ToyVpn</a> service class, but has to work locally without any authentication, handshake etc, so I've edited example with such settings:</p>\n\n<pre><code> private void configure() throws Exception {\n    // If the old interface has exactly the same parameters, use it!\n    if (mInterface != null) {\n        Log.i(TAG, \"Using the previous interface\");\n        return;\n    }\n\n    // Configure a builder while parsing the parameters.\n    Builder builder = new Builder();\n    builder.setSession(TAG)\n    builder.addAddress(\"10.0.0.2\", 32).addRoute(\"0.0.0.0\", 0)\n    try {\n        mInterface.close();\n    } catch (Exception e) {}\n\n    mInterface = builder.establish();\n}\n</code></pre>\n\n<p>And in my <strong>run</strong> function I've just configured tunnel to connect to the local IP address:</p>\n\n<pre><code>tunnel.connect(InetSocketAddress(\"127.0.0.1\", 8087))\n</code></pre>\n\n<p>Thereby:</p>\n\n<ol>\n<li>the <strong>settings</strong> of the VPN configurations are quite similar to <a href=\"http://www.thegeekstuff.com/2014/06/android-vpn-service/\" rel=\"nofollow noreferrer\">this</a> example and both examples from SO questions, mentioned above, for local usage.</li>\n<li>and my <strong>packet forwarding</strong> is taken from <a href=\"https://android.googlesource.com/platform/development/+/master/samples/ToyVpn/src/com/example/android/toyvpn/ToyVpnService.java\" rel=\"nofollow noreferrer\">ToyVpn</a> example. </li>\n</ol>\n\n<p>I know that my VPN is running, because if I change <strong>addRoute</strong> configuration, I won't be able to access Internet.  </p>\n\n<p>So I don't know what I'm actually doing wrong! If I use code for packet forwarding from ToyVpn, app is <strong>crashing</strong> every time <strong>new packet comes</strong>. </p>\n\n<p><strong>Update</strong></p>\n\n<p>The above is solved, but I see, that packets are sending away, but I cannot get any response. I can't figure out why. </p>\n\n<hr>\n\n<h2>FULL JAVA CODE OF MY VPN SERVICE</h2>\n\n<pre><code>public class VpnFilter extends VpnService implements Handler.Callback, Runnable {\n    private static final String TAG = \"MyVpnService\";\n\n    private Handler mHandler;\n    private Thread mThread;\n\n    private ParcelFileDescriptor mInterface;\n\n    @Override\n    public int onStartCommand(Intent intent, int flags, int startId) {\n        // The handler is only used to show messages.\n        if (mHandler == null) {\n            mHandler = new Handler(this);\n        }\n\n        // Stop the previous session by interrupting the thread.\n        if (mThread != null) {\n            mThread.interrupt();\n        }\n\n        // Start a new session by creating a new thread.\n        mThread = new Thread(this, \"ToyVpnThread\");\n        mThread.start();\n        return START_STICKY;\n    }\n\n    @Override\n    public void onDestroy() {\n        if (mThread != null) {\n            mThread.interrupt();\n        }\n    }\n\n    @Override\n    public boolean handleMessage(Message message) {\n        if (message != null) {\n            Toast.makeText(this, message.what, Toast.LENGTH_SHORT).show();\n        }\n        return true;\n    }\n\n    @Override\n    public synchronized void run() {\n        Log.i(TAG,\"running vpnService\");\n        try {\n            runVpnConnection();\n        } catch (Exception e) {\n            e.printStackTrace();\n            //Log.e(TAG, \"Got \" + e.toString());\n        } finally {\n            try {\n                mInterface.close();\n            } catch (Exception e) {\n                // ignore\n            }\n            mInterface = null;\n\n            mHandler.sendEmptyMessage(R.string.disconnected);\n            Log.i(TAG, \"Exiting\");\n        }\n    }\n\n    private void configure() throws Exception {\n        // If the old interface has exactly the same parameters, use it!\n        if (mInterface != null) {\n            Log.i(TAG, \"Using the previous interface\");\n            return;\n        }\n\n        // Configure a builder while parsing the parameters.\n        Builder builder = new Builder();\n        builder.setSession(TAG)\n        builder.addAddress(\"10.0.0.2\", 32).addRoute(\"0.0.0.0\", 0)\n        try {\n            mInterface.close();\n        } catch (Exception e) {\n            // ignore\n        }\n\n        mInterface = builder.establish();\n    }\n\n    private boolean runVpnConnection() throws Exception {\n\n        configure()\n\n        val in = new FileInputStream(mInterface.fileDescriptor)\n\n        // Packets received need to be written to this output stream.\n        val out = new FileOutputStream(mInterface.fileDescriptor)\n\n        // The UDP channel can be used to pass/get ip package to/from server\n        val tunnel = DatagramChannel.open()\n\n        // For simplicity, we use the same thread for both reading and\n        // writing. Here we put the tunnel into non-blocking mode.\n        tunnel.configureBlocking(false)\n\n        // Allocate the buffer for a single packet.\n        val packet = ByteBuffer.allocate(32767)\n\n        // Connect to the server, localhost is used for demonstration only.\n        tunnel.connect(InetSocketAddress(\"127.0.0.1\", 8087))\n\n        // Protect this socket, so package send by it will not be feedback to the vpn service.\n        protect(tunnel.socket())\n\n        // We use a timer to determine the status of the tunnel. It\n        // works on both sides. A positive value means sending, and\n        // any other means receiving. We start with receiving.\n        int timer = 0\n\n        // We keep forwarding packets till something goes wrong.\n        while (true) {\n            // Assume that we did not make any progress in this iteration.\n            boolean idle = true\n\n            // Read the outgoing packet from the input stream.\n            int length = `in`.read(packet.array())\n\n            if (length &gt; 0) {\n\n                Log.i(TAG, \"************new packet\")\n\n                // Write the outgoing packet to the tunnel.\n                packet.limit(length)\n                tunnel.write(packet);\n                packet.clear()\n                // There might be more outgoing packets.\n                idle = false\n                // If we were receiving, switch to sending.\n                if (timer &lt; 1) {\n                    timer = 1\n                }\n\n            }\n\n            length = tunnel.read(packet)\n\n            if (length &gt; 0) {\n                // Ignore control messages, which start with zero.\n                if (packet.get(0).toInt() !== 0) {\n                    // Write the incoming packet to the output stream.\n                    out.write(packet.array(), 0, length)\n                }\n                packet.clear()\n                // There might be more incoming packets.\n                idle = false\n                // If we were sending, switch to receiving.\n                if (timer &gt; 0) {\n                    timer = 0\n                }\n            }\n            // If we are idle or waiting for the network, sleep for a\n            // fraction of time to avoid busy looping.\n            if (idle) {\n                Thread.sleep(100)\n                // Increase the timer. This is inaccurate but good enough,\n                // since everything is operated in non-blocking mode.\n                timer += if (timer &gt; 0) 100 else -100\n                // We are receiving for a long time but not sending.\n                if (timer &lt; -15000) {\n                    // Send empty control messages.\n                    packet.put(0.toByte()).limit(1)\n                    for (i in 0..2) {\n                        packet.position(0)\n                        tunnel.write(packet)\n                    }\n                    packet.clear()\n                    // Switch to sending.\n                    timer = 1\n                }\n                // We are sending for a long time but not receiving.\n                if (timer &gt; 20000) {\n                    throw IllegalStateException(\"Timed out\")\n                }\n            }\n            Thread.sleep(50)\n        }\n    }\n}\n</code></pre>\n\n<hr>\n\n<h2>LOG CAT OUTPUT</h2>\n\n<p>In my <strong>LogCat</strong> panel I've got this trace when app crashes:</p>\n\n<pre><code>   FATAL EXCEPTION: main\n    java.lang.RuntimeException: Unable to start service com.example.username.wifictrl.model.VpnFilter@41ebbfb8 with null: java.lang.IllegalArgumentException: Parameter specified as non-null is null: method kotlin.jvm.internal.Intrinsics.checkParameterIsNotNull, parameter intent\n          at android.app.ActivityThread.handleServiceArgs(ActivityThread.java:2950)\n          at android.app.ActivityThread.access$1900(ActivityThread.java:151)\n          at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1442)\n          at android.os.Handler.dispatchMessage(Handler.java:99)\n          at android.os.Looper.loop(Looper.java:155)\n          at android.app.ActivityThread.main(ActivityThread.java:5520)\n          at java.lang.reflect.Method.invokeNative(Native Method)\n          at java.lang.reflect.Method.invoke(Method.java:511)                                                                                   at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:1029)\n          at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:796)\n          at dalvik.system.NativeStart.main(Native Method)\n    Caused by: java.lang.IllegalArgumentException: Parameter specified as non-null is null: method kotlin.jvm.internal.Intrinsics.checkParameterIsNotNull, parameter intent\n              at com.example.skogs.wifictrl.model.VpnFilter.onStartCommand(VpnFilter.kt)\n              at android.app.ActivityThread.handleServiceArgs(ActivityThread.java:2916)\n              at android.app.ActivityThread.access$1900(ActivityThread.java:151)\u00a0\n              at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1442)\u00a0\n              at android.os.Handler.dispatchMessage(Handler.java:99)\u00a0\n              at android.os.Looper.loop(Looper.java:155)\u00a0\n              at android.app.ActivityThread.main(ActivityThread.java:5520)\u00a0\n              at java.lang.reflect.Method.invokeNative(Native Method)\u00a0\n              at java.lang.reflect.Method.invoke(Method.java:511)\u00a0\n              at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:1029)  at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:796)\u00a0\n              at dalvik.system.NativeStart.main(Native Method)\u00a0\n</code></pre>\n"}, {"tags": ["java-8", "log4j2", "kotlin"], "answers": [{"tags": [], "owner": {"reputation": 630270, "user_id": 571407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f0d9dec16bae1e06552af55ddefc11f?s=128&d=identicon&r=PG", "display_name": "JB Nizet", "link": "https://stackoverflow.com/users/571407/jb-nizet"}, "is_accepted": true, "score": 13, "last_activity_date": 1465718850, "last_edit_date": 1465718850, "creation_date": 1465676234, "answer_id": 37768144, "question_id": 37767444, "link": "https://stackoverflow.com/questions/37767444/kotlin-logging-with-lambda-parameters/37768144#37768144", "title": "kotlin logging with lambda parameters", "body": "<p>The problem is that <code>debug()</code> is overloaded, and has another method taking a vararg Object as argument. Kotlin chooses that overload rather than the one taking a <code>Supplier&lt;?&gt;</code> as argument, because it doesn't know that the lambda expression is supposed to be a Supplier.</p>\n\n<p>Just specify it as a Supplier:</p>\n\n<pre><code>log.debug(\"random {}\", Supplier { UUID.randomUUID() })\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 13177, "user_id": 411965, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/UVUN2.jpg?s=128&g=1", "display_name": "oshai", "link": "https://stackoverflow.com/users/411965/oshai"}, "is_accepted": false, "score": 2, "last_activity_date": 1534962849, "creation_date": 1534962849, "answer_id": 51973138, "question_id": 37767444, "link": "https://stackoverflow.com/questions/37767444/kotlin-logging-with-lambda-parameters/51973138#51973138", "title": "kotlin logging with lambda parameters", "body": "<p>Check out <a href=\"https://github.com/MicroUtils/kotlin-logging\" rel=\"nofollow noreferrer\">https://github.com/MicroUtils/kotlin-logging</a> . It also provide those features:</p>\n\n<p>A convenient and performant logging library wrapping slf4j with Kotlin extensions.</p>\n\n<p>Call log methods, without checking whether the respective log level is enabled:</p>\n\n<pre><code>logger.debug { \"Some $expensive message!\" }\n</code></pre>\n\n<p>Behind the scenes the expensive message do not get evaluated if debug is not enabled:</p>\n\n<pre><code>if (logger.isDebugEnabled) logger.debug(\"Some $expensive message!\")\n</code></pre>\n\n<p>Define the logger, without explicitly specifying the class name: </p>\n\n<pre><code>// Place definition above class declaration to make field static  \nprivate val logger = KotlinLogging.logger {}\n</code></pre>\n"}], "owner": {"reputation": 8300, "user_id": 654799, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/S83OA.jpg?s=128&g=1", "display_name": "vach", "link": "https://stackoverflow.com/users/654799/vach"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1781, "favorite_count": 3, "accepted_answer_id": 37768144, "answer_count": 2, "score": 15, "last_activity_date": 1534962849, "creation_date": 1465671304, "question_id": 37767444, "link": "https://stackoverflow.com/questions/37767444/kotlin-logging-with-lambda-parameters", "title": "kotlin logging with lambda parameters", "body": "<p>In log4j2 we have a handy feature which is described as</p>\n\n<pre><code>// Java-8 style optimization: no need to explicitly check the log level:\n// the lambda expression is not evaluated if the TRACE level is not enabled\nlogger.trace(\"Some long-running operation returned {}\", () -&gt; expensiveOperation());\n</code></pre>\n\n<p>my attempt to use this in kotlin</p>\n\n<pre><code>log.debug(\"random {}\", { UUID.randomUUID() })\n</code></pre>\n\n<p>which will print</p>\n\n<pre><code>random Function0&lt;java.util.UUID&gt;\n</code></pre>\n\n<p><strong>How do we use lambda argument logging with kotlin? Or how do we explicitly tell kotlin what method to call?</strong></p>\n"}, {"tags": ["java", "code-coverage", "kotlin", "jacoco"], "comments": [{"owner": {"reputation": 89682, "user_id": 675383, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/6e7a971eb341ffeaa3efca407239bf3b?s=128&d=identicon&r=PG", "display_name": "nhaarman", "link": "https://stackoverflow.com/users/675383/nhaarman"}, "edited": false, "score": 0, "creation_date": 1465649801, "post_id": 37763969, "comment_id": 62996589, "body": "Technically, you have four constructors in byte code, and you call only one of them. This would be the same as in Java."}, {"owner": {"reputation": 35330, "user_id": 322642, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0030846647f93ba6bf0938a199688c2e?s=128&d=identicon&r=PG", "display_name": "ligi", "link": "https://stackoverflow.com/users/322642/ligi"}, "reply_to_user": {"reputation": 89682, "user_id": 675383, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/6e7a971eb341ffeaa3efca407239bf3b?s=128&d=identicon&r=PG", "display_name": "nhaarman", "link": "https://stackoverflow.com/users/675383/nhaarman"}, "edited": false, "score": 0, "creation_date": 1465650678, "post_id": 37763969, "comment_id": 62996874, "body": "I am calling different constructors - but only one is seen by jacoco"}, {"owner": {"reputation": 89682, "user_id": 675383, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/6e7a971eb341ffeaa3efca407239bf3b?s=128&d=identicon&r=PG", "display_name": "nhaarman", "link": "https://stackoverflow.com/users/675383/nhaarman"}, "edited": false, "score": 0, "creation_date": 1465650752, "post_id": 37763969, "comment_id": 62996896, "body": "Ah, so it&#39;s the other way around. Makes sense."}, {"owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "edited": false, "score": 0, "creation_date": 1465664339, "post_id": 37763969, "comment_id": 63001305, "body": "how do you know you call different constructors? From kotlin only one should be visible (the one with the matrix)"}], "answers": [{"comments": [{"owner": {"reputation": 35330, "user_id": 322642, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0030846647f93ba6bf0938a199688c2e?s=128&d=identicon&r=PG", "display_name": "ligi", "link": "https://stackoverflow.com/users/322642/ligi"}, "edited": false, "score": 0, "creation_date": 1465660032, "post_id": 37764733, "comment_id": 62999865, "body": "I would like to have a high overall coverage percentage"}, {"owner": {"reputation": 2750, "user_id": 661598, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BVAlk.png?s=128&g=1", "display_name": "wst", "link": "https://stackoverflow.com/users/661598/wst"}, "reply_to_user": {"reputation": 35330, "user_id": 322642, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0030846647f93ba6bf0938a199688c2e?s=128&d=identicon&r=PG", "display_name": "ligi", "link": "https://stackoverflow.com/users/322642/ligi"}, "edited": false, "score": 1, "creation_date": 1488981012, "post_id": 37764733, "comment_id": 72470785, "body": "@ligi Adding unnecessary magic to your code only to get betters numbers in reports is bad practice and you should avoid it. Just make sure your most important methods are covered."}], "tags": [], "owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "is_accepted": false, "score": 3, "last_activity_date": 1465654466, "creation_date": 1465654466, "answer_id": 37764733, "question_id": 37763969, "link": "https://stackoverflow.com/questions/37763969/jacoco-coverage-and-kotlin-default-parameters/37764733#37764733", "title": "Jacoco coverage and Kotlin default parameters", "body": "<p>Are you sure you need a 100% coverage on those constructors? Those constructors are auto-generated by the compiler, which guaranties their correctness (to a bigger extend than code coverage).</p>\n\n<p>IMO it is enough to test the constructor with all custom parameters. An additional test for all default parameters may cover the calculation of the default values.</p>\n\n<p>Overall, testing an auto generated code may be not the best idea.</p>\n"}, {"comments": [{"owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "edited": false, "score": 1, "creation_date": 1465702662, "post_id": 37766370, "comment_id": 63009437, "body": "technically the &quot;default 3-parameter constructor&quot; has 4 parameters (the last one is mask)"}], "tags": [], "owner": {"reputation": 89682, "user_id": 675383, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/6e7a971eb341ffeaa3efca407239bf3b?s=128&d=identicon&r=PG", "display_name": "nhaarman", "link": "https://stackoverflow.com/users/675383/nhaarman"}, "is_accepted": true, "score": 4, "last_activity_date": 1465664637, "creation_date": 1465664637, "answer_id": 37766370, "question_id": 37763969, "link": "https://stackoverflow.com/questions/37763969/jacoco-coverage-and-kotlin-default-parameters/37766370#37766370", "title": "Jacoco coverage and Kotlin default parameters", "body": "<p>Since you're using the <a href=\"https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.jvm/-jvm-overloads/#jvmoverloads\" rel=\"nofollow\"><code>@JvmOverloads</code></a> annotation, the compiler will generate 3 overloaded constructors. This annotation is mainly used to be able to omit parameters in plain Java.</p>\n\n<blockquote>\n<pre><code>@Target([AnnotationTarget.FUNCTION, AnnotationTarget.CONSTRUCTOR])\nannotation class JvmOverloads\n</code></pre>\n  \n  <p>Instructs the Kotlin compiler\n  to generate overloads for this function that substitute default\n  parameter values.</p>\n  \n  <p>If a method has N parameters and M of which have default values, M\n  overloads are generated: the first one takes N-1 parameters (all but\n  the last one that takes a default value), the second takes N-2\n  parameters, and so on.</p>\n</blockquote>\n\n<p>When calling the constructor with any number of parameters in Kotlin, the default 3-parameter constructor will be invoked - where the <a href=\"https://kotlinlang.org/docs/reference/functions.html#default-arguments\" rel=\"nofollow\">default values</a> are used for parameters that are omitted.<br>\nThus it makes sense that Jacoco does not mark the overloads as covered: they're not.</p>\n\n<p>Like @voddan said, these overloads are generated, and guaranteed correct. It doesn't make much sense to test these separate.</p>\n\n<p>If you do want full coverage however, remove the <code>@JvmOverloads</code> annotation. This should prevent the additional overloads from being generated.</p>\n\n<p>If you can't remove the annotation because you will be calling the overloaded constructor from Java, then having a Java test suite that covers these makes sense after all: it's a real world scenario you want covered.</p>\n"}], "owner": {"reputation": 35330, "user_id": 322642, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0030846647f93ba6bf0938a199688c2e?s=128&d=identicon&r=PG", "display_name": "ligi", "link": "https://stackoverflow.com/users/322642/ligi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1742, "favorite_count": 1, "accepted_answer_id": 37766370, "answer_count": 2, "score": 2, "last_activity_date": 1465664637, "creation_date": 1465649674, "question_id": 37763969, "link": "https://stackoverflow.com/questions/37763969/jacoco-coverage-and-kotlin-default-parameters", "title": "Jacoco coverage and Kotlin default parameters", "body": "<p>I am having the following constructor:</p>\n\n<pre><code>open class IPFS @JvmOverloads constructor(protected val base_url: String = \"http://127.0.0.1:5001/api/v0/\",\n                                          protected val okHttpClient: OkHttpClient = OkHttpClient.Builder().build(),\n                                          protected val moshi: Moshi = Moshi.Builder().build()) {\n</code></pre>\n\n<p>Now when measuring coverage I always get misses for when defaults are used. The only way out I can imagine is to write some tests in java that use the other constructors - but I would like to stay in pure kotlin - is there a way to do this?</p>\n\n<p><a href=\"https://i.stack.imgur.com/SFIyd.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/SFIyd.png\" alt=\"enter image description here\"></a></p>\n\n<p>Update: I am using constructors like IPFS() in my tests - but I think on the generated java bytecode this is converted to the constructor with all 3 parameters - and this is the only thing jacoco sees</p>\n"}, {"tags": ["kotlin"], "answers": [{"comments": [{"owner": {"reputation": 5057, "user_id": 4695271, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/fNlXZ.png?s=128&g=1", "display_name": "x80486", "link": "https://stackoverflow.com/users/4695271/x80486"}, "edited": false, "score": 0, "creation_date": 1465590465, "post_id": 37756075, "comment_id": 62982693, "body": "I&#39;m using IDEA and when I evaluate the expression <code>(any is Int &amp;&amp; any &lt; 10)</code> for <code>5</code> it&#39;s <code>true</code>; on the other hand, if I delete the <code>any</code> from the <code>when</code> expression it works, but I have to repeat <code>any</code> every single time in the branches (which is something I was trying to avoid by using <code>when (any)</code>)."}, {"owner": {"reputation": 5057, "user_id": 4695271, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/fNlXZ.png?s=128&g=1", "display_name": "x80486", "link": "https://stackoverflow.com/users/4695271/x80486"}, "edited": false, "score": 0, "creation_date": 1465591050, "post_id": 37756075, "comment_id": 62982932, "body": "...and it gets more &quot;interesting&quot;; if I just add <code>when (any)</code> to your first solution...nothing works saying that it&#39;s <code>another Any</code> for <i>any</i> value! So it looks like the <code>any</code> parameter and the <code>any</code> in the <code>when</code> is &quot;not the same&quot;...that cannot be true."}, {"owner": {"reputation": 11834, "user_id": 1538877, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/N9qfZ.jpg?s=128&g=1", "display_name": "Ruslan", "link": "https://stackoverflow.com/users/1538877/ruslan"}, "reply_to_user": {"reputation": 5057, "user_id": 4695271, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/fNlXZ.png?s=128&g=1", "display_name": "x80486", "link": "https://stackoverflow.com/users/4695271/x80486"}, "edited": false, "score": 1, "creation_date": 1465591376, "post_id": 37756075, "comment_id": 62983057, "body": "For sure <code>(any is Int &amp;&amp; any &lt; 10)</code> for <code>5</code> is <code>true</code>, but <code>true</code> doesn&#39;t match <code>5</code>, so first branch doesn&#39;t evaluate."}, {"owner": {"reputation": 11834, "user_id": 1538877, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/N9qfZ.jpg?s=128&g=1", "display_name": "Ruslan", "link": "https://stackoverflow.com/users/1538877/ruslan"}, "reply_to_user": {"reputation": 5057, "user_id": 4695271, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/fNlXZ.png?s=128&g=1", "display_name": "x80486", "link": "https://stackoverflow.com/users/4695271/x80486"}, "edited": false, "score": 2, "creation_date": 1465591468, "post_id": 37756075, "comment_id": 62983099, "body": "It&#39;s doesn&#39;t work because <code>when (foo) {}</code> and <code>when {}</code> have different semantics. This semantics described well in documentation."}, {"owner": {"reputation": 17307, "user_id": 869184, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/58a3657cee7bdb5f537020660d9711e0?s=128&d=identicon&r=PG&f=1", "display_name": "Ilya", "link": "https://stackoverflow.com/users/869184/ilya"}, "edited": false, "score": 0, "creation_date": 1465865140, "post_id": 37756075, "comment_id": 63068121, "body": "Note that checking if a value of <code>Any</code> type is in the range <code>0..10</code> will iterate the values of the range until an equal value is found."}], "tags": [], "owner": {"reputation": 11834, "user_id": 1538877, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/N9qfZ.jpg?s=128&g=1", "display_name": "Ruslan", "link": "https://stackoverflow.com/users/1538877/ruslan"}, "is_accepted": true, "score": 7, "last_activity_date": 1465591292, "last_edit_date": 1465591292, "creation_date": 1465588041, "answer_id": 37756075, "question_id": 37755789, "link": "https://stackoverflow.com/questions/37755789/pattern-match-doesnt-work-for-int-clause-branch/37756075#37756075", "title": "&quot;Pattern match&quot; doesn&#39;t work for Int clause (branch)", "body": "<p>When you pass an argument, <code>when</code> checks if argument matches values in branches, and 5 not matches calculated <code>true</code> in first branch. So basically you can fix your code this way:</p>\n\n<pre><code>fun typeCheck(any: Any): Any = when {\n    (any is Int &amp;&amp; any &lt; 10) -&gt; \"(small) integer\"\n    any is Int -&gt; \"integer\"\n    any is Double -&gt; \"double\"\n    any is String -&gt; \"string\"\n    else -&gt; \"another Any\"\n}\n</code></pre>\n\n<p>or </p>\n\n<pre><code>fun typeCheck(any: Any): Any = when (any) {\n    in 0..10 -&gt; \"(small) integer\"\n    is Int -&gt; \"integer\"\n    is Double -&gt; \"double\"\n    is String -&gt; \"string\"\n    else -&gt; \"another Any\"\n}\n</code></pre>\n\n<p>See <a href=\"https://kotlinlang.org/docs/reference/control-flow.html#when-expression\" rel=\"noreferrer\">When Expression</a></p>\n"}], "owner": {"reputation": 5057, "user_id": 4695271, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/fNlXZ.png?s=128&g=1", "display_name": "x80486", "link": "https://stackoverflow.com/users/4695271/x80486"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 1, "accepted_answer_id": 37756075, "answer_count": 1, "score": 3, "last_activity_date": 1465591292, "creation_date": 1465586676, "last_edit_date": 1465590722, "question_id": 37755789, "link": "https://stackoverflow.com/questions/37755789/pattern-match-doesnt-work-for-int-clause-branch", "title": "&quot;Pattern match&quot; doesn&#39;t work for Int clause (branch)", "body": "<p>I have this piece of code in Kotlin (which I started learning):</p>\n\n<pre><code>package io.shido.learning\n\nimport java.time.Instant\n\nfun typeCheck(any: Any): Any = when (any) {\n  (any is Int &amp;&amp; any &lt; 10) -&gt; \"(small) integer\"\n  is Int -&gt; \"integer\"\n  is Double -&gt; \"double\"\n  is String -&gt; \"string\"\n  else -&gt; \"another Any\"\n}\n\nfun main(args: Array&lt;String&gt;) {\n  println(\"type check for: 5 (${typeCheck(5)})\")\n  println(\"type check for: 20 (${typeCheck(20)})\")\n  println(\"type check for: 56.0 (${typeCheck(56.0)})\")\n  println(\"type check for: \\\"a string\\\" (${typeCheck(\"a string\")})\")\n  println(\"type check for: Instant (${typeCheck(Instant.now())})\")\n}\n</code></pre>\n\n<p>...so I was expecting that <code>typeCheck(5)</code> returned <code>(small) integer</code> and not <code>integer</code> as it currently does.</p>\n\n<p>Does anyone has any insights? The first branch is <code>true</code> indeed for <code>5</code>.</p>\n\n<p><a href=\"https://i.stack.imgur.com/qmUst.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/qmUst.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["kotlin"], "answers": [{"tags": [], "owner": {"reputation": 25812, "user_id": 288456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf294ff6d86cc587dec43e2af34a9532?s=128&d=identicon&r=PG", "display_name": "Alexander Udalov", "link": "https://stackoverflow.com/users/288456/alexander-udalov"}, "is_accepted": true, "score": 5, "last_activity_date": 1465574501, "creation_date": 1465574501, "answer_id": 37752599, "question_id": 37751966, "link": "https://stackoverflow.com/questions/37751966/how-can-i-assign-a-value-to-kmutableproperty-parameter/37752599#37752599", "title": "How can I assign a value to KMutableProperty parameter?", "body": "<p>Kotlin 1.0 does not allow the <code>this::intProperty</code> syntax, but this is being worked currently and will be available soon as a part of the early access preview of 1.1 (<a href=\"https://youtrack.jetbrains.com/issue/KT-6947\" rel=\"noreferrer\">issue</a>, <a href=\"https://github.com/Kotlin/KEEP/issues/5\" rel=\"noreferrer\">KEEP proposal</a>).</p>\n\n<p>With this in mind, I'd consider doing what you're describing in another way, for example making <code>bind</code> accept a lambda which sets the property:</p>\n\n<pre><code>class MyBinder {\n    fun bind(setProperty: (Int) -&gt; Unit) {\n        setProperty(internalIntValue)\n    }\n}\n\n...\n\nmyBinder.bind { intProperty = it }\n</code></pre>\n\n<p>Anyway, to answer your question about setting the value of <code>KMutableProperty</code>: to set the value of some property or, technically speaking, to invoke the property setter, you should know its arity, or the number of parameters that property (and its getter/setter) accepts. Properties declared in a file do not accept any parameters, member properties and extension properties require one parameter (the receiver instance), while member properties which are also extensions take two parameters. These kinds of properties are represented by the following subtypes of <code>KMutableProperty</code> respectively: <code>KMutableProperty0</code>, <code>KMutableProperty1</code>, <code>KMutableProperty2</code> -- the number means the arity and their generic type parameters mean the types of receivers. Each of these property types has a <code>set</code> method with the corresponding parameters. Some examples:</p>\n\n<pre><code>fun setValue(property: KMutableProperty0&lt;Int&gt;, value: Int) {\n    property.set(value)\n}\n\nfun setValue(property: KMutableProperty1&lt;SomeType, Int&gt;, instance: SomeType, value: Int) {\n    property.set(instance, value)\n}\n</code></pre>\n\n<p>Note that there's no <code>set</code> (or <code>get</code>) method in the abstract <code>KMutableProperty</code> interface precisely because it's impossible to declare it, not knowing the number of required receiver parameters.</p>\n"}, {"tags": [], "owner": {"reputation": 1453, "user_id": 2804610, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/m7Bke.jpg?s=128&g=1", "display_name": "EPadronU", "link": "https://stackoverflow.com/users/2804610/epadronu"}, "is_accepted": false, "score": 1, "last_activity_date": 1465576690, "last_edit_date": 1465576690, "creation_date": 1465576326, "answer_id": 37753140, "question_id": 37751966, "link": "https://stackoverflow.com/questions/37751966/how-can-i-assign-a-value-to-kmutableproperty-parameter/37753140#37753140", "title": "How can I assign a value to KMutableProperty parameter?", "body": "<p>Additionally to Alexander's answer, you can try something like this:</p>\n\n<pre><code>import kotlin.reflect.KMutableProperty\n\nclass Binder {\n  val internalIntValue = 10\n\n  fun bind(self: Any, aProperty: KMutableProperty&lt;Int&gt;) {\n    aProperty.setter.call(self, internalIntValue)\n  }\n}\n\nclass Foo {\n  var bar = 1\n\n  fun changeBar() {\n    Binder().bind(this, Foo::bar)\n  }\n}\n\nfun main(args: Array&lt;String&gt;) {\n  val foo = Foo()\n\n  assert(1 == foo.bar)\n\n  foo.changeBar()\n\n  assert(10 == foo.bar)\n}\n</code></pre>\n\n<p>A more robust/safe way to do the same thing:</p>\n\n<pre><code>fun &lt;T&gt; bind(self: T, aProperty: KMutableProperty1&lt;T, Int&gt;) {\n  aProperty.set(self, internalIntValue)\n}\n</code></pre>\n\n<p>My thanks to Alexander. His answer gave me the previous idea.</p>\n"}], "owner": {"reputation": 1890, "user_id": 251369, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/5e85d79c4d7bbe9f7e51305b100351cf?s=128&d=identicon&r=PG", "display_name": "k_shil", "link": "https://stackoverflow.com/users/251369/k-shil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2049, "favorite_count": 0, "accepted_answer_id": 37752599, "answer_count": 2, "score": 4, "last_activity_date": 1465576690, "creation_date": 1465572578, "question_id": 37751966, "link": "https://stackoverflow.com/questions/37751966/how-can-i-assign-a-value-to-kmutableproperty-parameter", "title": "How can I assign a value to KMutableProperty parameter?", "body": "<p>In a method I would like to receive KMutableProperty as parameter and assign a value to it.</p>\n\n<p>Another question is what is the correct way of passing a parameter into such a method.</p>\n\n<p>Basically I would like to have something like that:</p>\n\n<pre><code>class MyBinder {\n  ...\n\n  fun bind(property: KMutableProperty&lt;Int&gt;): Unit {\n     property.set(internalIntValue)\n  }\n}\n</code></pre>\n\n<p>And then call it in another class</p>\n\n<pre><code>  myBinder.bind(this::intProperty)\n</code></pre>\n"}, {"tags": ["android", "kotlin", "anko"], "comments": [{"owner": {"reputation": 89682, "user_id": 675383, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/6e7a971eb341ffeaa3efca407239bf3b?s=128&d=identicon&r=PG", "display_name": "nhaarman", "link": "https://stackoverflow.com/users/675383/nhaarman"}, "edited": false, "score": 0, "creation_date": 1465559888, "post_id": 37744847, "comment_id": 62964901, "body": "<code>&#47;&#47; error!</code>. What error?"}, {"owner": {"reputation": 119, "user_id": 2753903, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/558c6d47dac857f6ca16b9dbf4675ae3?s=128&d=identicon&r=PG&f=1", "display_name": "abond", "link": "https://stackoverflow.com/users/2753903/abond"}, "reply_to_user": {"reputation": 89682, "user_id": 675383, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/6e7a971eb341ffeaa3efca407239bf3b?s=128&d=identicon&r=PG", "display_name": "nhaarman", "link": "https://stackoverflow.com/users/675383/nhaarman"}, "edited": false, "score": 0, "creation_date": 1465560712, "post_id": 37744847, "comment_id": 62965396, "body": "Error is that there is no such thing as &quot;fragment&quot; in anko. The question is how to convert provided XML view into anko DSL?"}], "answers": [{"comments": [{"owner": {"reputation": 119, "user_id": 2753903, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/558c6d47dac857f6ca16b9dbf4675ae3?s=128&d=identicon&r=PG&f=1", "display_name": "abond", "link": "https://stackoverflow.com/users/2753903/abond"}, "edited": false, "score": 0, "creation_date": 1465631234, "post_id": 37753029, "comment_id": 62991308, "body": "Thank you, yanex! And can you tell me, do you have forum or user group specially for Anko or SO is the best place to post Anko related questions?"}, {"owner": {"reputation": 1091, "user_id": 3423539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99231e6fe7118c7409fdbcedd6d3afcc?s=128&d=identicon&r=PG", "display_name": "yanex", "link": "https://stackoverflow.com/users/3423539/yanex"}, "reply_to_user": {"reputation": 119, "user_id": 2753903, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/558c6d47dac857f6ca16b9dbf4675ae3?s=128&d=identicon&r=PG&f=1", "display_name": "abond", "link": "https://stackoverflow.com/users/2753903/abond"}, "edited": false, "score": 0, "creation_date": 1465688120, "post_id": 37753029, "comment_id": 63007332, "body": "For now you can just use &#39;Android&#39; category for such kind of posts. And, also, we have Slack community with the #anko channel."}], "tags": [], "owner": {"reputation": 1091, "user_id": 3423539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99231e6fe7118c7409fdbcedd6d3afcc?s=128&d=identicon&r=PG", "display_name": "yanex", "link": "https://stackoverflow.com/users/3423539/yanex"}, "is_accepted": true, "score": 1, "last_activity_date": 1465575921, "creation_date": 1465575921, "answer_id": 37753029, "question_id": 37744847, "link": "https://stackoverflow.com/questions/37744847/fragment-tag-equivalent-in-anko-dsl/37753029#37753029", "title": "&lt;fragment&gt; tag equivalent in anko DSL", "body": "<p>Currently there is no special function in Anko, you can just use Android APIs for doing this.</p>\n\n<pre><code>supportFragmentManager.beginTransaction().add(this.id,\n        com.myapp.MyFragment()).commit()\n</code></pre>\n\n<p>Note that you need to set an <code>id</code> to your <code>linearLayout</code>, as <code>add</code> method requires it being set.</p>\n"}], "owner": {"reputation": 119, "user_id": 2753903, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/558c6d47dac857f6ca16b9dbf4675ae3?s=128&d=identicon&r=PG&f=1", "display_name": "abond", "link": "https://stackoverflow.com/users/2753903/abond"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 647, "favorite_count": 1, "accepted_answer_id": 37753029, "answer_count": 1, "score": 1, "last_activity_date": 1465575921, "creation_date": 1465551350, "last_edit_date": 1465554965, "question_id": 37744847, "link": "https://stackoverflow.com/questions/37744847/fragment-tag-equivalent-in-anko-dsl", "title": "&lt;fragment&gt; tag equivalent in anko DSL", "body": "<p>How can I replace this XML with Anko DSL equivalent?</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;LinearLayout\n        android:orientation=\"vertical\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"&gt;\n\n      // more code here....\n\n      &lt;fragment android:id=\"@+id/my_fragment\"\n          android:layout_width=\"340dp\"\n          android:layout_height=\"match_parent\"\n          android:layout_gravity=\"start\"\n          android:name=\"com.myapp.MyFragment\"\n          /&gt;\n\n      // more code here....\n\n&lt;/LinearLayout&gt;\n</code></pre>\n\n<p>Anko version:</p>\n\n<pre><code>UI {\n    linearLayout {\n        orientation= VERTICAL\n\n        fragment {  // error! \n             name = \"com.myapp.MyFragment\"\n        }\n\n    }.lparams(width=..., height=...)\n}\n</code></pre>\n\n<p>Seems there is no eqiuvalen for fragment tag in DSL.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["generics", "kotlin"], "answers": [{"comments": [{"owner": {"reputation": 486, "user_id": 4927659, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dFv5iWcQeXM/AAAAAAAAAAI/AAAAAAAAAO4/ICam7FMQ_pU/photo.jpg?sz=128", "display_name": "Anton Tarasov", "link": "https://stackoverflow.com/users/4927659/anton-tarasov"}, "edited": false, "score": 0, "creation_date": 1465555955, "post_id": 37744361, "comment_id": 62962418, "body": "I described that in my question. With star projections I can not assign a value to <code>getPresenter().view</code> \u0438\u043b\u0438 <code>getPresenter().router</code>. Android Studio complains about type mismatch."}, {"owner": {"reputation": 24586, "user_id": 3255152, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fbd95ef81d0a85310fee8dd46e0f65b0?s=128&d=identicon&r=PG&f=1", "display_name": "mfulton26", "link": "https://stackoverflow.com/users/3255152/mfulton26"}, "edited": false, "score": 0, "creation_date": 1465560953, "post_id": 37744361, "comment_id": 62965557, "body": "I suspect what you are describing is a compiler bug. I recommend reporting the issue with an example. As a workaround you can cast the <code>BasePresenter&lt;*, *&gt;</code> returned by <code>getPresenter()</code>: <code>(getPresenter() as BasePresenter&lt;Any?, Any?&gt;).view = something</code>."}], "tags": [], "owner": {"reputation": 89682, "user_id": 675383, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/6e7a971eb341ffeaa3efca407239bf3b?s=128&d=identicon&r=PG", "display_name": "nhaarman", "link": "https://stackoverflow.com/users/675383/nhaarman"}, "is_accepted": false, "score": 1, "last_activity_date": 1465549986, "creation_date": 1465549986, "answer_id": 37744361, "question_id": 37741830, "link": "https://stackoverflow.com/questions/37741830/how-to-properly-override-a-method-returning-an-instance-of-generic-class-in-kotl/37744361#37744361", "title": "How to properly override a method returning an instance of generic class in Kotlin", "body": "<p>Use <code>BasePresenter&lt;*,*&gt;</code> for that.</p>\n\n<p>From the <a href=\"https://kotlinlang.org/docs/reference/generics.html#star-projections\" rel=\"nofollow\">docs</a>:</p>\n\n<blockquote>\n  <p>Star-projections</p>\n  \n  <p>Sometimes you want to say that you know nothing about the type\n  argument, but still want to use it in a safe way. The safe way here is\n  to define such a projection of the generic type, that every concrete\n  instantiation of that generic type would be a subtype of that\n  projection.</p>\n  \n  <p>Kotlin provides so called star-projection syntax for this:</p>\n  \n  <p>For <code>Foo&lt;out T&gt;</code>, where <code>T</code> is a covariant type parameter with the\n  upper bound <code>TUpper</code>, <code>Foo&lt;*&gt;</code> is equivalent to <code>Foo&lt;out TUpper&gt;</code>. It\n  means that when the <code>T</code> is unknown you can safely read values of\n  <code>TUpper</code> from <code>Foo&lt;*&gt;</code>. For <code>Foo&lt;in T&gt;</code>, where <code>T</code> is a contravariant\n  type parameter, <code>Foo&lt;*&gt;</code> is equivalent to <code>Foo&lt;in Nothing&gt;</code>. It means\n  there is nothing you can write to <code>Foo&lt;*&gt;</code> in a safe way when <code>T</code> is\n  unknown. For <code>Foo&lt;T&gt;</code>, where <code>T</code> is an invariant type parameter with\n  the upper bound <code>TUpper</code>, <code>Foo&lt;*&gt;</code> is equivalent to <code>Foo&lt;out TUpper&gt;</code>\n  for reading values and to <code>Foo&lt;in Nothing&gt;</code> for writing values. If a\n  generic type has several type parameters each of them can be projected\n  independently. For example, if the type is declared as interface\n  <code>Function&lt;in T, out U&gt;</code> we can imagine the following star-projections:</p>\n  \n  <p><code>Function&lt;*, String&gt;</code> means <code>Function&lt;in Nothing, String&gt;</code>;\n  <code>Function&lt;Int, *&gt;</code> means <code>Function&lt;Int, out Any?&gt;</code>; <code>Function&lt;*, *&gt;</code>\n  means <code>Function&lt;in Nothing, out Any?&gt;</code>. Note: star-projections are\n  very much like Java\u2019s raw types, but safe.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 25812, "user_id": 288456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf294ff6d86cc587dec43e2af34a9532?s=128&d=identicon&r=PG", "display_name": "Alexander Udalov", "link": "https://stackoverflow.com/users/288456/alexander-udalov"}, "is_accepted": false, "score": 2, "last_activity_date": 1465574903, "creation_date": 1465574903, "answer_id": 37752724, "question_id": 37741830, "link": "https://stackoverflow.com/questions/37741830/how-to-properly-override-a-method-returning-an-instance-of-generic-class-in-kotl/37752724#37752724", "title": "How to properly override a method returning an instance of generic class in Kotlin", "body": "<p>The \"cast can never succeed\" warning is incorrect here. The correct message for the warning should be \"unchecked cast\" because this cast may or may not be correct, but this cannot be discovered by running your program.</p>\n\n<p>There's <a href=\"https://youtrack.jetbrains.com/issue/KT-6611\" rel=\"nofollow\">an issue</a> in the tracker which in fact was <a href=\"https://github.com/jetbrains/kotlin/commit/4b6b35dadf68a9088c58c14ed3d49f9d307ff4d0\" rel=\"nofollow\">fixed</a> several days ago. The fix will likely make it to Kotlin 1.0.3.</p>\n"}], "owner": {"reputation": 486, "user_id": 4927659, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dFv5iWcQeXM/AAAAAAAAAAI/AAAAAAAAAO4/ICam7FMQ_pU/photo.jpg?sz=128", "display_name": "Anton Tarasov", "link": "https://stackoverflow.com/users/4927659/anton-tarasov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 950, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1465574903, "creation_date": 1465541921, "question_id": 37741830, "link": "https://stackoverflow.com/questions/37741830/how-to-properly-override-a-method-returning-an-instance-of-generic-class-in-kotl", "title": "How to properly override a method returning an instance of generic class in Kotlin", "body": "<p>I have an abstract generic class:</p>\n\n<pre><code>abstract class BasePresenter&lt;View, Router&gt; {\n\n    var view: View? = null\n    var router: Router? = null\n\n    abstract fun OnStart()\n    abstract fun OnStop()\n\n}\n</code></pre>\n\n<p>And I have a subclass of it: </p>\n\n<pre><code>class NewsListPresenter : BasePresenter&lt;NewsListView, MainRouter&gt;() {\n    override fun OnStop() {\n        //\n    }\n\n    override fun OnStart() {\n        //\n    }\n}\n</code></pre>\n\n<p>Also I have a class with a protected abstract method:</p>\n\n<pre><code>protected abstract fun getPresenter() : BasePresenter&lt;Any?, Any?&gt;\n</code></pre>\n\n<p>And I have it overridden in a subclass:</p>\n\n<pre><code>override fun getPresenter(): BasePresenter&lt;Any?, Any?&gt; {\n    return NewsListPresenter() as BasePresenter&lt;Any?, Any?&gt;\n}\n</code></pre>\n\n<p>Android Studio highlights the overridden function cast saying \"This cast never succeed\". I tried using <code>in Any</code>, <code>out Any</code> and <code>*</code> and it doesn't work. When I tried to use <code>*</code> I could not use the <code>getPresenter()</code> method in the class where it is originally defined. Android Studio complains about type mismatch: required Nothing?, found BaseFragment.\nIn Java the same code would work perfectly and I didn't think that it would be a problem in Kotlin. What is the right way to implement this?</p>\n"}, {"tags": ["regex", "string", "replace", "tokenize", "kotlin"], "comments": [{"owner": {"reputation": 630270, "user_id": 571407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f0d9dec16bae1e06552af55ddefc11f?s=128&d=identicon&r=PG", "display_name": "JB Nizet", "link": "https://stackoverflow.com/users/571407/jb-nizet"}, "edited": false, "score": 0, "creation_date": 1465507264, "post_id": 37736110, "comment_id": 62943976, "body": "You&#39;re not using any regex in the above code. You replacing a substring literal (which doesn&#39;t exist), by an empty string. Read the api doc: <a href=\"https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.text/replace.html\" rel=\"nofollow noreferrer\">kotlinlang.org/api/latest/jvm/stdlib/kotlin.text/replace.htm&zwnj;&#8203;l</a>. If you want to use a regex, then you need to pass a Regex instance as argument."}, {"owner": {"reputation": 1, "user_id": 5631548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a4951a0cbac008022426ec37666c06a?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Zavarella", "link": "https://stackoverflow.com/users/5631548/michael-zavarella"}, "edited": false, "score": 0, "creation_date": 1465509336, "post_id": 37736110, "comment_id": 62944740, "body": "Immediately after asking the question I found the &quot;&quot;.toRegex() function... Today&#39;s been a rough day... Thanks so much for your answers."}, {"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "edited": false, "score": 0, "creation_date": 1465571823, "post_id": 37736110, "comment_id": 62973059, "body": "regex is not the best model for this, there are SQL parsers out there such as <a href=\"https://calcite.apache.org/\" rel=\"nofollow noreferrer\">Apache Calcite</a> or using Antlr and one of the existing gramar files to create one."}], "owner": {"reputation": 1, "user_id": 5631548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a4951a0cbac008022426ec37666c06a?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Zavarella", "link": "https://stackoverflow.com/users/5631548/michael-zavarella"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 511, "favorite_count": 0, "closed_date": 1465654171, "answer_count": 0, "score": 0, "last_activity_date": 1465506418, "creation_date": 1465506106, "last_edit_date": 1465506418, "question_id": 37736110, "link": "https://stackoverflow.com/questions/37736110/tokenizing-a-string-in-kotlin", "closed_reason": "Duplicate", "title": "Tokenizing a string in Kotlin", "body": "<p>I have a sql query string to create or replace a trigger for an Oracle DB that looks like this...</p>\n\n<pre><code>CREATE OR REPLACE TRIGGER schema.trigger_name \n    BEFORE DELETE ON schema.table_c \n    FOR EACH ROW \n    BEGIN \n        INSERT INTO table_h (col_1, \n                              col_2, \n                              col_3, \n                              col_4) \n        VALUES (val_1,\n                val_2,\n                val_3,\n                val_4) \n    END\n</code></pre>\n\n<p>I'm trying to remove all of the SQL keywords so that I am left with a map looking something like...</p>\n\n<pre><code>{trigger_name \"schema.trigger_name\",\n on_table     \"schema.table_c\",\n hist_table   \"schema.table_h\",\n cols         [\"col_1\", ... ],\n values       [\"val_1\", ... ]}\n</code></pre>\n\n<p>I'm trying right now to use a regular expression to remove all of the keywords and then I'll be able to split the remaining string up accordingly. My replace looks like this...</p>\n\n<pre><code>val r = s.replace(\n        \"^(BEFORE DELETE ON\" +\n        \"|CREATE OR REPLACE TRIGGER\" +\n        \"|BEGIN\" +\n        \"|INSERT INTO\" +\n        \"|VALUES\" +\n        \"|END)\", \"\")\n</code></pre>\n\n<p>Where s is the string that I gave above. When I run this, there is no change in the output. I'm not very good at regex (I very rarely use it), so it wouldn't be a shock to hear that mine is absolutely wrong. I'm also very new to Kotlin, so if there is a more idiomatic way to do this (which I'm sure there is) I would be very excited to learn!</p>\n"}, {"tags": ["hibernate", "jpa", "orm", "lazy-loading", "kotlin"], "comments": [{"owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "edited": false, "score": 0, "creation_date": 1465534019, "post_id": 37733629, "comment_id": 62950667, "body": "I don&#39;t see how the word &quot;harmful&quot; is applicable here. Could you clarify its use or delete it from the question if it is not important?"}, {"owner": {"reputation": 317, "user_id": 2681754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7184d202cdf2dcb759d852059498a8e?s=128&d=identicon&r=PG&f=1", "display_name": "johnp", "link": "https://stackoverflow.com/users/2681754/johnp"}, "reply_to_user": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "edited": false, "score": 0, "creation_date": 1465544224, "post_id": 37733629, "comment_id": 62955210, "body": "Mainly it&#39;s the fact that at least Hibernate cannot lazy-load classes that are final or have final accessor methods and using data classes for JPA often looks like a good thing to do, but can actually hurt performance, because they are final by definition (at the moment at least; heard that may change). The title is very clickbaity, because I thought that should be something more universally known and to prevent e.g. applications ported to Kotlin having worse performance than the Java counterpart and users then blaming Kotlin :/"}, {"owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "edited": false, "score": 0, "creation_date": 1465553119, "post_id": 37733629, "comment_id": 62960670, "body": "Thank you for paraphrasing the question!"}], "answers": [{"comments": [{"owner": {"reputation": 317, "user_id": 2681754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7184d202cdf2dcb759d852059498a8e?s=128&d=identicon&r=PG&f=1", "display_name": "johnp", "link": "https://stackoverflow.com/users/2681754/johnp"}, "edited": false, "score": 1, "creation_date": 1465543778, "post_id": 37740312, "comment_id": 62954909, "body": "Thank you for your answer! One of the things that struck me as odd was that final classes can&#39;t be lazy loaded in Hibernate and I imagined that could seriously hurt performance if not taken into consideration. I personally switched to <a href=\"https://ebean-orm.github.io/\" rel=\"nofollow noreferrer\">Ebean</a> a couple weeks ago, because it explicitly mentions Kotlin and has a lower entry barrier than Hibernate, but I haven&#39;t heard of Exposed yet and will definitely take a look at it."}, {"owner": {"reputation": 2276, "user_id": 377320, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/359d03ed63df432a022cc8e3a2fe60fe?s=128&d=identicon&r=PG", "display_name": "Martin Vysny", "link": "https://stackoverflow.com/users/377320/martin-vysny"}, "edited": false, "score": 0, "creation_date": 1519544436, "post_id": 37740312, "comment_id": 84947824, "body": "Lazy loading means that Hibernate needs to load the data only when the getter is invoked for the first time. However, the getter is already implemented by a programmer (as a simple field read)! Hibernate thus needs to change the functionality of that method so that it polls the JDBC at call time. You can change a method by modifying the bytecode at compile phase, or by dynamically extending the class and overriding the setters."}, {"owner": {"reputation": 2276, "user_id": 377320, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/359d03ed63df432a022cc8e3a2fe60fe?s=128&d=identicon&r=PG", "display_name": "Martin Vysny", "link": "https://stackoverflow.com/users/377320/martin-vysny"}, "edited": false, "score": 0, "creation_date": 1519544645, "post_id": 37740312, "comment_id": 84947871, "body": "If you are willing to consider a Kotlin-specific ORM, <a href=\"https://github.com/mvysny/vok-orm\" rel=\"nofollow noreferrer\">github.com/mvysny/vok-orm</a> could be a good option. It still uses POJOs which may e.g. be annotated with JSR303 annotations and passed around to web forms; it uses Sql2o behind the scenes; it focuses on Kotlin as the sole target language. Disclaimer: I&#39;m the author."}], "tags": [], "owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "is_accepted": true, "score": 11, "last_activity_date": 1465554479, "last_edit_date": 1465554479, "creation_date": 1465535296, "answer_id": 37740312, "question_id": 37733629, "link": "https://stackoverflow.com/questions/37733629/kotlin-with-jpa-hibernate-no-lazy-loading-without-open/37740312#37740312", "title": "Kotlin with JPA/Hibernate: no lazy-loading without `open`?", "body": "<p>The tutorial you provided specifies:</p>\n\n<blockquote>\n  <p>The entity class must have a public or protected no-argument constructor ... Interface may not be designated as an entity ... The entity class must not be final. No methods or persistent instance variables of the entity class may be final.</p>\n</blockquote>\n\n<p>Kotlin classes follow the JavaBeans convention for setters/getters.</p>\n\n<p>If your ORM has requirements as the above, then you indeed have to specify <code>open</code> on the class and its methods:</p>\n\n<pre><code>open class Person(open val name: String = \"\", \n                  open val age: Int = 0)\n</code></pre>\n\n<p>The default values for all of the constructor parameters allow Kotlin to generate an additional empty constructor. Alternatively you can provide it as a secondary constructor:</p>\n\n<pre><code>open class Person(open val name: String, open val age: Int) {\n    constructor() : this(\"\", 0)\n}\n</code></pre>\n\n<p>Note that <code>open val</code> creates a private final field and an open getter. If that's not enough, use annotations like <code>@JvmField open val name</code>.</p>\n\n<p>ORMs like the on you use have additional friction with Kotlin code because of the questionable design patterns they use (like making everything non-final). </p>\n\n<p>A good option is to use a Kotlin-specific ORM. For example <a href=\"https://github.com/JetBrains/Exposed\" rel=\"noreferrer\">Exposed</a> is supported by JetBrains and used for some of its products, which speaks for itself. Another option is <a href=\"https://ebean-orm.github.io/\" rel=\"noreferrer\">Ebean</a> which officially supports Kotlin (thanks @johnp)</p>\n"}], "owner": {"reputation": 317, "user_id": 2681754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7184d202cdf2dcb759d852059498a8e?s=128&d=identicon&r=PG&f=1", "display_name": "johnp", "link": "https://stackoverflow.com/users/2681754/johnp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5044, "favorite_count": 4, "accepted_answer_id": 37740312, "answer_count": 1, "score": 7, "last_activity_date": 1465554479, "creation_date": 1465496987, "last_edit_date": 1465545203, "question_id": 37733629, "link": "https://stackoverflow.com/questions/37733629/kotlin-with-jpa-hibernate-no-lazy-loading-without-open", "title": "Kotlin with JPA/Hibernate: no lazy-loading without `open`?", "body": "<p>Most Kotlin JPA example code looks like this</p>\n\n<pre><code>class Person(val name: String, val age: Int) { /* ... */ }\n</code></pre>\n\n<p>or even</p>\n\n<pre><code>data class Person(val name: String=\"\", val age: Int=0) { /* ... */ }\n</code></pre>\n\n<p>Now, the <a href=\"https://docs.jboss.org/hibernate/orm/5.1/userguide/html_single/Hibernate_User_Guide.html#entity-pojo\" rel=\"noreferrer\">Hibernate User Guide</a>, and I think also several other ORMs, state that they usually want to create proxies or otherwise extend the model class, but to allow that in Kotlin the class has to be explicitly defined <code>open</code>. This is currently impossible with data classes and I assume, judging from my own experience, that most people don't think about it when writing JPA entities in Kotlin.</p>\n\n<p>So, to come to my question (this is stackoverflow after all), is it enough to do</p>\n\n<pre><code> open class Person(val name: String, val age: Int) { /* ... */ }\n</code></pre>\n\n<p>or would we actually have to do</p>\n\n<pre><code> open class Person(open val name: String, open val age: Int) { /* ... */ }\n</code></pre>\n\n<p>to not needlessly hinder the ORM at doing its job properly?<br>\nIf it really is harmful, we should probably propose to add a warning to IntelliJ IDEA, that if a class is has an <code>@Entity</code> annotation, it should be defined <code>open</code>.</p>\n"}, {"tags": ["android", "kotlin", "anko"], "answers": [{"tags": [], "owner": {"reputation": 8927, "user_id": 2767703, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/nj9nV.png?s=128&g=1", "display_name": "Kevin van Mierlo", "link": "https://stackoverflow.com/users/2767703/kevin-van-mierlo"}, "is_accepted": false, "score": 2, "last_activity_date": 1480595198, "last_edit_date": 1480595198, "creation_date": 1480594653, "answer_id": 40910471, "question_id": 37728702, "link": "https://stackoverflow.com/questions/37728702/how-to-use-selectablebuttonbackground-on-anko/40910471#40910471", "title": "How to use selectableButtonBackground on Anko?", "body": "<p>I just created an extension function to get the resource ids for attributes.</p>\n\n<pre><code>val Context.selectableItemBackgroundResource: Int get() {\n    return getResourceIdAttribute(R.attr.selectableItemBackground)\n}\n\nfun Context.getResourceIdAttribute(@AttrRes attribute: Int) : Int {\n    val typedValue = TypedValue()\n    theme.resolveAttribute(attribute, typedValue, true)\n    return typedValue.resourceId\n}\n</code></pre>\n\n<p>This way you can also add more attributes if needed. Example to put it in anko:</p>\n\n<pre><code>frameLayout {\n   textView {\n      text = \"Test\"\n      backgroundResource = selectableItemBackgroundResource\n      isClickable = true\n   }\n}\n</code></pre>\n\n<p>Don't forget the isClickable, else you won't see anything when you're clicking the textView</p>\n"}, {"tags": [], "owner": {"reputation": 16, "user_id": 6655384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eed31358bc042b6fc765c97e69f87a65?s=128&d=identicon&r=PG&f=1", "display_name": "Erdenian", "link": "https://stackoverflow.com/users/6655384/erdenian"}, "is_accepted": false, "score": 0, "last_activity_date": 1553524876, "creation_date": 1553524876, "answer_id": 55340340, "question_id": 37728702, "link": "https://stackoverflow.com/questions/37728702/how-to-use-selectablebuttonbackground-on-anko/55340340#55340340", "title": "How to use selectableButtonBackground on Anko?", "body": "<p>Another way to achieve this with Anko:</p>\n\n<pre><code>val backgroundResource = attr(R.attr.selectableItemBackgroundBorderless).resourceId\n</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 3495177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/quLvg.jpg?s=128&g=1", "display_name": "Lucas Albuquerque", "link": "https://stackoverflow.com/users/3495177/lucas-albuquerque"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 572, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1553524876, "creation_date": 1465482264, "question_id": 37728702, "link": "https://stackoverflow.com/questions/37728702/how-to-use-selectablebuttonbackground-on-anko", "title": "How to use selectableButtonBackground on Anko?", "body": "<p>How do I use <code>selectableButtonBackground</code> attribute on a custom View that uses Anko's <code>apply()</code> method inside its constructor like the following structure?</p>\n\n<pre><code>class XPTO(context: Context) : CardView(context) {\n\n    init {\n         this.apply {\n             // I'd like to invoke selectableButtonBackground here\n         }\n}\n</code></pre>\n\n<p>I've tried to do <code>context.obtainStyledAttributes(arrayOf(R.attr.selectableItemBackground).toIntArray()).getDrawable(0)</code> but with no success.</p>\n"}, {"tags": ["generics", "kotlin"], "comments": [{"owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "edited": false, "score": 0, "creation_date": 1465479327, "post_id": 37727319, "comment_id": 62926430, "body": "on what line do you get the exception? Please mark it with a comment"}, {"owner": {"reputation": 5111, "user_id": 785663, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8b32f09978c0b55f375b81e9179dc568?s=128&d=identicon&r=PG", "display_name": "mabi", "link": "https://stackoverflow.com/users/785663/mabi"}, "reply_to_user": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "edited": false, "score": 0, "creation_date": 1465479970, "post_id": 37727319, "comment_id": 62926947, "body": "@voddan Totally forgot it wasn&#39;t obvious from the &quot;works with casting&quot; lines. Marked, unfortunately the lines are quite long."}, {"owner": {"reputation": 1045, "user_id": 4410813, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-JSSJ_0XXr7o/AAAAAAAAAAI/AAAAAAAAKSQ/_Z5gjtDL1U0/photo.jpg?sz=128", "display_name": "jorgemf", "link": "https://stackoverflow.com/users/4410813/jorgemf"}, "edited": false, "score": 0, "creation_date": 1465492389, "post_id": 37727319, "comment_id": 62935687, "body": "Why do you use kClass? I think it is not a good idea to use that class if you want to use extension of classes/interfaces. Why not this: <code>kotlin  fun &lt;T: Obj&gt; getDetails(obj :Obj, uuid: String): Details&lt;out T&gt;{     when(obj){      is User -&gt;  -&gt; return Api.Details&lt;User&gt;(response = Api.DetailsResponse(wrapped = obj))      is Case -&gt; ... } </code>"}, {"owner": {"reputation": 5111, "user_id": 785663, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8b32f09978c0b55f375b81e9179dc568?s=128&d=identicon&r=PG", "display_name": "mabi", "link": "https://stackoverflow.com/users/785663/mabi"}, "reply_to_user": {"reputation": 1045, "user_id": 4410813, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-JSSJ_0XXr7o/AAAAAAAAAAI/AAAAAAAAKSQ/_Z5gjtDL1U0/photo.jpg?sz=128", "display_name": "jorgemf", "link": "https://stackoverflow.com/users/4410813/jorgemf"}, "edited": false, "score": 0, "creation_date": 1465503860, "post_id": 37727319, "comment_id": 62942293, "body": "@jorgemf: the full signature is <code>fun &lt;T: Obj&gt; getDetails(type: KClass&lt;T&gt;, uuid: String, fields: List&lt;String&gt; = type.members.map { it.name})</code>, other than that, I only use <code>type</code> to signal the deserialization target to jackson."}, {"owner": {"reputation": 1045, "user_id": 4410813, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-JSSJ_0XXr7o/AAAAAAAAAAI/AAAAAAAAKSQ/_Z5gjtDL1U0/photo.jpg?sz=128", "display_name": "jorgemf", "link": "https://stackoverflow.com/users/4410813/jorgemf"}, "edited": false, "score": 0, "creation_date": 1465570896, "post_id": 37727319, "comment_id": 62972450, "body": "@mabi Based on @x2bool solution and conversation. I think what you want to do is impossible, you cannot defined a function which sometimes returns a Details&lt;User&gt; and others Details&lt;Case&gt;, it is going to return always Details&lt;Obj&gt;. So you are going to need a cast. One thing you can do is to add the output value of the function as an input element. <code>fun &lt;T: Obj&gt; getDetails( type: kClass&lt;T&gt;, uuid: String, ..., output: Details&lt;T&gt;)</code> and then call the function with the concrete details class you want and only add the object in details: <code>getDetails(Case::kClass, Api.Details&lt;Case&gt;())</code>"}, {"owner": {"reputation": 5111, "user_id": 785663, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8b32f09978c0b55f375b81e9179dc568?s=128&d=identicon&r=PG", "display_name": "mabi", "link": "https://stackoverflow.com/users/785663/mabi"}, "reply_to_user": {"reputation": 1045, "user_id": 4410813, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-JSSJ_0XXr7o/AAAAAAAAAAI/AAAAAAAAKSQ/_Z5gjtDL1U0/photo.jpg?sz=128", "display_name": "jorgemf", "link": "https://stackoverflow.com/users/4410813/jorgemf"}, "edited": false, "score": 0, "creation_date": 1465758289, "post_id": 37727319, "comment_id": 63023657, "body": "@jorgemf I don&#39;t get it - the generic version I posted <i>works</i> and returns a completely typed instance each call. I get that flow analysis is hard and maybe too much for the compiler to work out I&#39;m always returning the promised type. But I&#39;m still wondering why the compiler warns me that &quot;this cast will never succeed&quot;?"}, {"owner": {"reputation": 1045, "user_id": 4410813, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-JSSJ_0XXr7o/AAAAAAAAAAI/AAAAAAAAKSQ/_Z5gjtDL1U0/photo.jpg?sz=128", "display_name": "jorgemf", "link": "https://stackoverflow.com/users/4410813/jorgemf"}, "edited": false, "score": 0, "creation_date": 1465822755, "post_id": 37727319, "comment_id": 63046917, "body": "Using in and out solves your problem, read my answer."}], "answers": [{"comments": [{"owner": {"reputation": 5111, "user_id": 785663, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8b32f09978c0b55f375b81e9179dc568?s=128&d=identicon&r=PG", "display_name": "mabi", "link": "https://stackoverflow.com/users/785663/mabi"}, "edited": false, "score": 0, "creation_date": 1465487182, "post_id": 37729083, "comment_id": 62932464, "body": "That certainly gets me rid of the cast, very good! But now I reduce every return value to <code>Obj</code> ie, I won&#39;t be able to access <code>Case.subject</code> w/o a cast."}, {"owner": {"reputation": 2276, "user_id": 1740335, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/QHyBk.png?s=128&g=1", "display_name": "x2bool", "link": "https://stackoverflow.com/users/1740335/x2bool"}, "reply_to_user": {"reputation": 5111, "user_id": 785663, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8b32f09978c0b55f375b81e9179dc568?s=128&d=identicon&r=PG", "display_name": "mabi", "link": "https://stackoverflow.com/users/785663/mabi"}, "edited": false, "score": 0, "creation_date": 1465543617, "post_id": 37729083, "comment_id": 62954821, "body": "Then you can&#39;t do that. You&#39;re trying to return two specific types from a generic function. You have to specify the lower bounds."}], "tags": [], "owner": {"reputation": 2276, "user_id": 1740335, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/QHyBk.png?s=128&g=1", "display_name": "x2bool", "link": "https://stackoverflow.com/users/1740335/x2bool"}, "is_accepted": false, "score": 1, "last_activity_date": 1465483289, "creation_date": 1465483289, "answer_id": 37729083, "question_id": 37727319, "link": "https://stackoverflow.com/questions/37727319/returning-specific-instances-from-generic-function/37729083#37729083", "title": "Returning specific instances from generic function", "body": "<p>Variance annotation might help you, just change generic parameter <strong>T</strong> to <strong>out Obj</strong> in the following function (in both interface and implementer class):</p>\n\n<pre><code>fun &lt;T: Obj&gt; getDetails(type: KClass&lt;T&gt;, uuid: String): Details&lt;out Obj&gt;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1045, "user_id": 4410813, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-JSSJ_0XXr7o/AAAAAAAAAAI/AAAAAAAAKSQ/_Z5gjtDL1U0/photo.jpg?sz=128", "display_name": "jorgemf", "link": "https://stackoverflow.com/users/4410813/jorgemf"}, "is_accepted": false, "score": 1, "last_activity_date": 1465822723, "creation_date": 1465822723, "answer_id": 37790498, "question_id": 37727319, "link": "https://stackoverflow.com/questions/37727319/returning-specific-instances-from-generic-function/37790498#37790498", "title": "Returning specific instances from generic function", "body": "<p>This should solve your problem:</p>\n\n<pre><code>    override fun getDetails(type: KClass&lt;in Obj&gt;, uuid: String): Api.Details&lt;out Obj&gt; {\n        when (type) {\n            Case::class -&gt; return Api.Details(response = Api.DetailsResponse(wrapped = testCase))\n            User::class -&gt; return Api.Details(response = Api.DetailsResponse(wrapped = testUser))\n            else -&gt; return Api.Details(error = UnsupportedOperationException())\n        }\n    }\n</code></pre>\n\n<p>In order to understand it better you can read the kotlin documentation about variance in generics: <a href=\"https://kotlinlang.org/docs/reference/generics.html\" rel=\"nofollow\">https://kotlinlang.org/docs/reference/generics.html</a></p>\n\n<p>There are things you cannot do in java as:</p>\n\n<pre><code>Collection&lt;String&gt; strings = ...\nCollection&lt;Object&gt; objs = strings; // this will fail\n</code></pre>\n\n<p>There are a lot of cases when you only want to read the generics objects so there is no problem to make that assignment. The way to tell kotlin this is possible is using the words in and out. In means you are going to read the generics but not write them and out mean you are going to write them.</p>\n"}], "owner": {"reputation": 5111, "user_id": 785663, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8b32f09978c0b55f375b81e9179dc568?s=128&d=identicon&r=PG", "display_name": "mabi", "link": "https://stackoverflow.com/users/785663/mabi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 434, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1465822723, "creation_date": 1465478723, "last_edit_date": 1465479917, "question_id": 37727319, "link": "https://stackoverflow.com/questions/37727319/returning-specific-instances-from-generic-function", "title": "Returning specific instances from generic function", "body": "<p>My question is about type inference with generic methods.</p>\n\n<p>I've got the following scenario:</p>\n\n<pre><code>interface Obj {\n    val Id: String\n}\ndata class User(override val Id: String, val name: String): Obj\ndata class Case(override val Id: String, val subject: String): Obj\n\ninterface Api {\n    fun &lt;T: Obj&gt; getLastUpdated(type: KClass&lt;T&gt;, backTill: Duration = Duration.ofDays(1)): LastUpdated\n\n    fun &lt;T: Obj&gt; getDetails(type: KClass&lt;T&gt;, uuid: String): Details&lt;T&gt;\n\n    data class LastUpdatedResponse(val ids: List&lt;String&gt; = emptyList(),\n                                   val latestDateCovered: String = \"\")\n    data class LastUpdated(val error: Throwable? = null, val response: LastUpdatedResponse? = null)\n\n    data class DetailsResponse&lt;T&gt;(val wrapped: T)\n    data class Details&lt;T&gt;(val error: Throwable? = null, val response: DetailsResponse&lt;T&gt;? = null)\n}\n</code></pre>\n\n<p>In my tests, I need to know exactly what the mocked API needs to return, thus</p>\n\n<pre><code>val testCase = Case(\"123\", \"Testing\")\nval testUser = User(\"321\", \"Dummy\")\nval mockApi = object: Api {\n    override fun &lt;T : Obj&gt; getLastUpdated(type: KClass&lt;T&gt;, backTill: Duration): Api.LastUpdated {\n        return Api.LastUpdated(response = Api.LastUpdatedResponse(listOf(\"123\")))\n    }\n\n    override fun &lt;T : Obj&gt; getDetails(type: KClass&lt;T&gt;, uuid: String): Details&lt;T&gt; {\n        when (type) {\n            Case::class -&gt; return Api.Details(response = Api.DetailsResponse(wrapped = testCase)) // &lt;- this fails\n            User::class -&gt; return Api.Details(response = Api.DetailsResponse(wrapped = testUser)) // &lt;- as does this\n            else -&gt; return Api.Details(error = UnsupportedOperationException())\n        }\n    }\n}\n</code></pre>\n\n<p>However, this fails to compile with:</p>\n\n<pre><code>Error:(114, 43) Kotlin: Type inference failed. Expected type mismatch: inferred type is Api.Details&lt;Case&gt; but Api.Details&lt;T&gt; was expected\n</code></pre>\n\n<p>I can make it work with casting:</p>\n\n<pre><code>when (type) {\n    Case::class -&gt; return Api.Details(response = Api.DetailsResponse(wrapped = testCase)) as Api.Details&lt;T&gt;\n    User::class -&gt; return Api.Details(response = Api.DetailsResponse(wrapped = testUser)) as Api.Details&lt;T&gt;\n</code></pre>\n\n<p>But then I get a warning informing me that \"this cast will never succeed\" - running my tests, it does and works as expected.</p>\n\n<p>My question is - why doesn't this work without casting and what should I use instead?</p>\n"}]