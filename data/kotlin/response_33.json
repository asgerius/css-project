[{"tags": ["java", "android", "kotlin", "enums", "proguard"], "answers": [{"comments": [{"owner": {"reputation": 11015, "user_id": 4583267, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/DcEqh.jpg?s=128&g=1", "display_name": "Thomas Vos", "link": "https://stackoverflow.com/users/4583267/thomas-vos"}, "edited": false, "score": 1, "creation_date": 1513981566, "post_id": 32236950, "comment_id": 82866012, "body": "I just tried this and decompiled the code, but a simple enum class (only enums, no fields) still appears as an enum instead of an int. Is there anything I&#39;m doing wrong? I&#39;m using the &#39;proguard-android-optimize.txt&#39; file."}, {"owner": {"reputation": 73871, "user_id": 1426891, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gFJE8.png?s=128&g=1", "display_name": "Jeff Bowman", "link": "https://stackoverflow.com/users/1426891/jeff-bowman"}, "reply_to_user": {"reputation": 11015, "user_id": 4583267, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/DcEqh.jpg?s=128&g=1", "display_name": "Thomas Vos", "link": "https://stackoverflow.com/users/4583267/thomas-vos"}, "edited": false, "score": 0, "creation_date": 1513981827, "post_id": 32236950, "comment_id": 82866091, "body": "@ThomasVos Note that that file has a default specification to <a href=\"https://android.googlesource.com/platform/sdk/+/master/files/proguard-android-optimize.txt#48\" rel=\"nofollow noreferrer\">keep static class members on enums</a>, which may interfere with unboxing. I&#39;d try removing that first, as long as you don&#39;t use the <code>values()</code> method or <code>String</code> conversion (which pretty much limits you to equality checks)."}, {"owner": {"reputation": 11015, "user_id": 4583267, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/DcEqh.jpg?s=128&g=1", "display_name": "Thomas Vos", "link": "https://stackoverflow.com/users/4583267/thomas-vos"}, "edited": false, "score": 2, "creation_date": 1513982131, "post_id": 32236950, "comment_id": 82866183, "body": "Thanks for the reply. I already removed those lines by copying the file into my source code, and remove the android proguard rules file in gradle. However, the enums still appear in the decompiled code."}, {"owner": {"reputation": 3269, "user_id": 5868421, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6EqgS.png?s=128&g=1", "display_name": "Maksim Turaev", "link": "https://stackoverflow.com/users/5868421/maksim-turaev"}, "reply_to_user": {"reputation": 11015, "user_id": 4583267, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/DcEqh.jpg?s=128&g=1", "display_name": "Thomas Vos", "link": "https://stackoverflow.com/users/4583267/thomas-vos"}, "edited": false, "score": 0, "creation_date": 1538043826, "post_id": 32236950, "comment_id": 92008708, "body": "@ThomasVos I also tried to verify enum conversion and for the first time it failed. But i managed to force a conversion. Look at this repository <a href=\"https://github.com/maxim-pandra/ProguardEnumIntDefTest\" rel=\"nofollow noreferrer\">github.com/maxim-pandra/ProguardEnumIntDefTest</a>"}, {"owner": {"reputation": 972, "user_id": 1229735, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/82d3be299cc6d15d5bbe4c424030b1d1?s=128&d=identicon&r=PG", "display_name": "yiati", "link": "https://stackoverflow.com/users/1229735/yiati"}, "reply_to_user": {"reputation": 3269, "user_id": 5868421, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6EqgS.png?s=128&g=1", "display_name": "Maksim Turaev", "link": "https://stackoverflow.com/users/5868421/maksim-turaev"}, "edited": false, "score": 0, "creation_date": 1539617810, "post_id": 32236950, "comment_id": 92557619, "body": "@MaksimTuraev What do you mean by &quot;force a conversion&quot;? I&#39;ve checked out that repo, and it seems like it&#39;s still not converting enums to ints."}, {"owner": {"reputation": 3269, "user_id": 5868421, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6EqgS.png?s=128&g=1", "display_name": "Maksim Turaev", "link": "https://stackoverflow.com/users/5868421/maksim-turaev"}, "reply_to_user": {"reputation": 972, "user_id": 1229735, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/82d3be299cc6d15d5bbe4c424030b1d1?s=128&d=identicon&r=PG", "display_name": "yiati", "link": "https://stackoverflow.com/users/1229735/yiati"}, "edited": false, "score": 0, "creation_date": 1539621805, "post_id": 32236950, "comment_id": 92559477, "body": "@yiati did you ran debug or release build? proguard in my repo configured to debug build. Then with apk analizer i could see converted enums. Please check build type. And tell if this was the problem. Are you using apk analyzer to see see convertion?"}, {"owner": {"reputation": 972, "user_id": 1229735, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/82d3be299cc6d15d5bbe4c424030b1d1?s=128&d=identicon&r=PG", "display_name": "yiati", "link": "https://stackoverflow.com/users/1229735/yiati"}, "reply_to_user": {"reputation": 3269, "user_id": 5868421, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6EqgS.png?s=128&g=1", "display_name": "Maksim Turaev", "link": "https://stackoverflow.com/users/5868421/maksim-turaev"}, "edited": false, "score": 0, "creation_date": 1539629129, "post_id": 32236950, "comment_id": 92562958, "body": "@MaksimTuraev I ran both debug and release, and used the apk analyzer. In both cases the <code>StateEnum</code> class is still 458 bytes with all of the class information."}, {"owner": {"reputation": 3269, "user_id": 5868421, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6EqgS.png?s=128&g=1", "display_name": "Maksim Turaev", "link": "https://stackoverflow.com/users/5868421/maksim-turaev"}, "reply_to_user": {"reputation": 972, "user_id": 1229735, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/82d3be299cc6d15d5bbe4c424030b1d1?s=128&d=identicon&r=PG", "display_name": "yiati", "link": "https://stackoverflow.com/users/1229735/yiati"}, "edited": false, "score": 0, "creation_date": 1539633826, "post_id": 32236950, "comment_id": 92565082, "body": "@yiati. I have updated a sample. There was a mistake I forgot to push. Now enum converts to int, but the class itself doesn&#39;t get cleaned up entirely.  You can see an accepted issue here <a href=\"https://sourceforge.net/p/proguard/bugs/724/\" rel=\"nofollow noreferrer\">sourceforge.net/p/proguard/bugs/724</a>."}, {"owner": {"reputation": 972, "user_id": 1229735, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/82d3be299cc6d15d5bbe4c424030b1d1?s=128&d=identicon&r=PG", "display_name": "yiati", "link": "https://stackoverflow.com/users/1229735/yiati"}, "reply_to_user": {"reputation": 3269, "user_id": 5868421, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6EqgS.png?s=128&g=1", "display_name": "Maksim Turaev", "link": "https://stackoverflow.com/users/5868421/maksim-turaev"}, "edited": false, "score": 0, "creation_date": 1539636225, "post_id": 32236950, "comment_id": 92566112, "body": "@MaksimTuraev awesome that worked for me, thanks! I did add disable obfuscation to make it easier to confirm."}], "tags": [], "owner": {"reputation": 73871, "user_id": 1426891, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gFJE8.png?s=128&g=1", "display_name": "Jeff Bowman", "link": "https://stackoverflow.com/users/1426891/jeff-bowman"}, "is_accepted": true, "score": 23, "last_activity_date": 1440624205, "creation_date": 1440624205, "answer_id": 32236950, "question_id": 32236870, "link": "https://stackoverflow.com/questions/32236870/does-proguard-converts-all-enums-to-int-or-needs-to-be-configured-for-this/32236950#32236950", "title": "Does proguard converts all enums to int or needs to be configured for this", "body": "<p>The optimization is listed on ProGuard's <a href=\"http://proguard.sourceforge.net/manual/optimizations.html\">optimizations page</a>. It appears to be one of the default optimizations, but it (like other optimizations) can be specified explicitly if you need more control (e.g. disabling all <code>class/*</code> optimizations aside from enum unboxing).</p>\n\n<blockquote>\n  <p><strong>class/unboxing/enum</strong></p>\n  \n  <blockquote>\n    <p>Simplifies enum types to integer constants, whenever possible.</p>\n  </blockquote>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 15831, "user_id": 5925259, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/89crf.jpg?s=128&g=1", "display_name": "Yogesh Umesh Vaity", "link": "https://stackoverflow.com/users/5925259/yogesh-umesh-vaity"}, "is_accepted": false, "score": 0, "last_activity_date": 1607091992, "creation_date": 1607091992, "answer_id": 65145339, "question_id": 32236870, "link": "https://stackoverflow.com/questions/32236870/does-proguard-converts-all-enums-to-int-or-needs-to-be-configured-for-this/65145339#65145339", "title": "Does proguard converts all enums to int or needs to be configured for this", "body": "<h2>Proguard Settings</h2>\n<p>The Proguard needs to have the configuration like following:</p>\n<pre><code>minifyEnabled true\nproguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\n</code></pre>\n<p>Note the inclusion of the <code>proguard-android-optimize.txt</code> file and not the <code>proguard-android.txt</code> file.</p>\n<p><a href=\"https://github.com/maxim-pandra/ProguardEnumIntDefTest\" rel=\"nofollow noreferrer\">ProguardEnumIntDefTest</a> is a sample project on Github that tries to find out if Proguard converts enums into ints.</p>\n<hr />\n<h2>Optimization</h2>\n<p>For the Proguard to optimize an <code>enum</code>, that <code>enum</code> should not have methods and associated values(fields). Proguard converts these simple enums to ints so, you get the type-safety of the enums at compile-time and the performance of the ints at runtime!</p>\n<hr />\n"}], "owner": {"reputation": 1051, "user_id": 3167086, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/b2217dee36e531a5ab72c7a715f18671?s=128&d=identicon&r=PG&f=1", "display_name": "karma", "link": "https://stackoverflow.com/users/3167086/karma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4131, "favorite_count": 0, "accepted_answer_id": 32236950, "answer_count": 2, "score": 15, "last_activity_date": 1607451368, "creation_date": 1440623881, "last_edit_date": 1607451368, "question_id": 32236870, "link": "https://stackoverflow.com/questions/32236870/does-proguard-converts-all-enums-to-int-or-needs-to-be-configured-for-this", "title": "Does proguard converts all enums to int or needs to be configured for this", "body": "<p>Does proguard automatically converts enums to integer for memory optimization or I have to configure it to do this?\nIf I do have to configure what is the configuration?</p>\n"}, {"tags": ["kotlin", "data-class"], "comments": [{"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "edited": false, "score": 0, "creation_date": 1452106583, "post_id": 32151378, "comment_id": 57026730, "body": "It would be good to show your attempt at the code (or equivalent in Java you wanted ), for future questions..."}], "answers": [{"comments": [{"owner": {"reputation": 1571, "user_id": 4187837, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/797990d500303b57e9f9042f73ded007?s=128&d=identicon&r=PG&f=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/4187837/gavin"}, "edited": false, "score": 1, "creation_date": 1440264834, "post_id": 32151772, "comment_id": 52205684, "body": "Thanks!  I think I was confused as the wisdom of the net suggested that extending data classes was problematic.  I hadn&#39;t thought about extending an abstract class, which to be fair is pretty dumb of me, I should have seen that option. Of all the options I like the last one! Reading between the lines you can extend data class just as you would a normal class?"}, {"owner": {"reputation": 1571, "user_id": 4187837, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/797990d500303b57e9f9042f73ded007?s=128&d=identicon&r=PG&f=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/4187837/gavin"}, "edited": false, "score": 0, "creation_date": 1440265025, "post_id": 32151772, "comment_id": 52205731, "body": "Yeah the &quot;design&quot; is a little contradictory, as it has evolved; initially it was just to deal with one playlist file and learning Kotlin.  As I have enjoyed using Kotlin more and wanted to do more with the script its just grown in functionality if not so much in lines of code.  Normally i wouldn&#39;t extend EmptyPlaylist from Playlist :)"}, {"owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "reply_to_user": {"reputation": 1571, "user_id": 4187837, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/797990d500303b57e9f9042f73ded007?s=128&d=identicon&r=PG&f=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/4187837/gavin"}, "edited": false, "score": 0, "creation_date": 1440278723, "post_id": 32151772, "comment_id": 52209385, "body": "@Gavin, yes, <code>data</code> class inheritance is limited: you can&#39;t define new properties in the primary constructor nor override <code>componentN</code> functions, and you&#39;ll probably have to override <code>equals</code> and <code>hashCode</code> (which is another pain in the neck when working with class hierarchy) in both parent and child classes. But it&#39;s possible if you just add new properties and functions in class body and don&#39;t expect them to be automatically used by <code>data</code> under-the-hood code."}, {"owner": {"reputation": 1571, "user_id": 4187837, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/797990d500303b57e9f9042f73ded007?s=128&d=identicon&r=PG&f=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/4187837/gavin"}, "edited": false, "score": 0, "creation_date": 1440279974, "post_id": 32151772, "comment_id": 52209748, "body": "ah thanks for clearing that up.  I think it would have worked for my purposes."}, {"owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "reply_to_user": {"reputation": 1571, "user_id": 4187837, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/797990d500303b57e9f9042f73ded007?s=128&d=identicon&r=PG&f=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/4187837/gavin"}, "edited": false, "score": 0, "creation_date": 1452153130, "post_id": 32151772, "comment_id": 57044977, "body": "Updated the answer so that it&#39;s up-to-date with Kotlin restrictions on data classes."}], "tags": [], "owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "is_accepted": true, "score": 4, "last_activity_date": 1452152992, "last_edit_date": 1452152992, "creation_date": 1440211778, "answer_id": 32151772, "question_id": 32151378, "link": "https://stackoverflow.com/questions/32151378/how-to-mimic-or-achieve-is-a-relationships-for-kotlin-data-classes/32151772#32151772", "title": "How to mimic or achieve IS-A relationships for Kotlin data classes", "body": "<p>UPD: Kotlin Beta added restrictions on <code>data</code> classes, so the answer has also been updated.</p>\n\n<blockquote>\n  <ul>\n  <li>Data classes cannot be abstract, open, sealed or inner;</li>\n  <li>Data classes may not extend other classes (but may implement interfaces).</li>\n  </ul>\n</blockquote>\n\n<p>So the only option for building their hierarchies is interfaces. This restriction may be released in future versions.\n<hr>\nThe idea of inheriting <code>EmptyPlaylist</code> from <code>Playlist</code> which is presumed non-empty according to your words looks a little bit contradictory, but there are options:</p>\n\n<ul>\n<li><p>You can make both <code>TracksPlaylist</code> and <code>EmptyPlaylist</code> implement some <code>Playlist</code> interface. This is reasonable because <code>EmptyPlaylist</code> may not contain everything that a <code>Playlist</code> does. This would look like:</p>\n\n<pre><code>public interface Playlist\n\ndata class TracksPlaylist(val name: String, val tracks: List&lt;Track&gt;) : Playlist\ndata class EmptyPlaylist(val name: String): Playlist\n</code></pre></li>\n<li><p>If you don't want multiple instances of <code>EmptyPlaylist</code> to even exist, you can make it a <code>val</code> instead of distinct class and avoid is-checks, just comparing to</p>\n\n<pre><code>val EMPTY_PLAYLIST = TracksPlaylist(\"EMPTY\", listOf())\n</code></pre>\n\n<p>This is applicable when <em>empty playlists</em> are all equal so that a single object is sufficient to represent them all.</p></li>\n<li><p>You can use <a href=\"https://kotlinlang.org/docs/reference/classes.html#sealed-classes\" rel=\"nofollow\"><code>sealed</code> classes</a>. This doesn't allow you to use <code>data</code> classes, but <code>sealed</code> classes may fit for building class hierarchies like this.</p>\n\n<p><code>sealed</code> class is an abstract class which can only have its subclasses be declared inside its body. This gives the compiler guarantees that these are the only subclasses. Example:</p>\n\n<pre><code>sealed class Playlist(val name: String) {\n    class Tracks(name: String, val tracks: List&lt;Track&gt;): Playlist(name)\n    class Playlists(name: String, val innerPlaylists: List&lt;Playlist&gt;): Playlist(name)\n    object Empty: Playlist(\"EMPTY\")\n}\n</code></pre>\n\n<p>After that, you will be able to use <code>when</code> statement without specifying <code>else</code> branch if you state all the subclasses and objects of the sealed class:</p>\n\n<pre><code>when (p) {\n    is Playlist.Tracks -&gt; { /* ... */ }\n    is Playlist.Playlists -&gt; { /* ... */ }\n    Playlist.Empty -&gt; { /* ... */ }\n}\n</code></pre>\n\n<p>However, this option requires you to deal with <code>equals</code>, <code>hashCode</code>, <code>toString</code>, <code>copy</code> and <code>componentN</code> on your own, if you need them.</p></li>\n</ul>\n"}], "owner": {"reputation": 1571, "user_id": 4187837, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/797990d500303b57e9f9042f73ded007?s=128&d=identicon&r=PG&f=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/4187837/gavin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 351, "favorite_count": 0, "accepted_answer_id": 32151772, "answer_count": 1, "score": 2, "last_activity_date": 1464615098, "creation_date": 1440206873, "last_edit_date": 1464615098, "question_id": 32151378, "link": "https://stackoverflow.com/questions/32151378/how-to-mimic-or-achieve-is-a-relationships-for-kotlin-data-classes", "title": "How to mimic or achieve IS-A relationships for Kotlin data classes", "body": "<p>I have been exploring Kotlin and have written a small program/script that does a task I find boring.</p>\n\n<p>In the development of the program I use data classes to represent a Playlist. at one point in the design I wanted to have a special type of <code>Playlist</code> that was <code>EmptyPlaylist</code>.</p>\n\n<p>I couldn't get this to work.</p>\n\n<p>How would you achieve this relationship with Kotlin?</p>\n\n<p>In Java, I would just extend <code>Playlist</code> (or perhaps create an interface/abstract class for them both to inherit from).</p>\n\n<p>I just wanted to be able to have a <code>List&lt;Playlist&gt;</code> rather than <code>List&lt;Playlist?&gt;</code></p>\n\n<p>In the end I just created a <code>Playlist</code> object, but I am interested in if it is possible to create IS-A hierarchies with data classes.</p>\n"}]