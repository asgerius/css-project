[{"tags": ["reflection", "kotlin", "type-safety"], "comments": [{"owner": {"reputation": 1339, "user_id": 1359988, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/00c331889adb81f68b66cd75734459a6?s=128&d=identicon&r=PG", "display_name": "zjuhasz", "link": "https://stackoverflow.com/users/1359988/zjuhasz"}, "edited": false, "score": 0, "creation_date": 1474497165, "post_id": 39627398, "comment_id": 66560633, "body": "My colleague found another SO post which says Kotlin has no way to do this and the only way is to use Java reflection (assuming you&#39;re targeting JVM). <a href=\"http://stackoverflow.com/questions/35851719/how-to-compare-classes-and-interfaces/35852445#35852445\" title=\"how to compare classes and interfaces\">stackoverflow.com/questions/35851719/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1339, "user_id": 1359988, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/00c331889adb81f68b66cd75734459a6?s=128&d=identicon&r=PG", "display_name": "zjuhasz", "link": "https://stackoverflow.com/users/1359988/zjuhasz"}, "is_accepted": false, "score": 5, "last_activity_date": 1615304421, "last_edit_date": 1615304421, "creation_date": 1474501458, "answer_id": 39628121, "question_id": 39627398, "link": "https://stackoverflow.com/questions/39627398/kotlin-class-literals-with-empty-left-hand-side-are-not-yet-supported/39628121#39628121", "title": "Kotlin class literals with empty left hand side are not yet supported?", "body": "<p>I guess it wouldn't be clear if Kotlin used the <code>is</code> operator differently between a <code>KClass</code> and another <code>KClass</code> as it does between an instance and a type which is why what I was trying to do doesn't work. Anyway I made this little infix function to imitate the functionality. However it only works with JVM target of course since it's using Java reflection. This is going off of the <a href=\"https://stackoverflow.com/questions/35851719/how-to-compare-classes-and-interfaces/35852445#35852445\">answer given in this SO post</a>.</p>\n<pre><code>infix fun &lt;T : Any, C : Any&gt; KClass&lt;T&gt;.can(comparate: KClass&lt;C&gt;) =\n   comparate.java.isAssignableFrom(this.java)\n</code></pre>\n<p>This will allow you to do exactly what I was trying to do but with the <code>can</code> function instead of the is operator like so:</p>\n<pre><code>if(String::class can Any::class)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "is_accepted": true, "score": 4, "last_activity_date": 1474538927, "last_edit_date": 1474538927, "creation_date": 1474502104, "answer_id": 39628194, "question_id": 39627398, "link": "https://stackoverflow.com/questions/39627398/kotlin-class-literals-with-empty-left-hand-side-are-not-yet-supported/39628194#39628194", "title": "Kotlin class literals with empty left hand side are not yet supported?", "body": "<p>Your error message is that the <code>is</code> check expects a class name and not a reference to a KClass on the right side.  The message itself might be a little unclear.  But the same applies in Java, you would not use <code>instanceOf</code> operator but instead would call <code>isAssignableFrom</code>.</p>\n\n<p>For help on solving the problem, you have examples that can be found in Github...</p>\n\n<p>In the <a href=\"https://github.com/kohesive/klutter\" rel=\"nofollow\">Klutter library</a> are examples of a lot of combinations of instanceOf style checking between <code>Class</code>, <code>KClass</code>, <code>Type</code> and <code>KType</code> as well as primitives.  You can copy ideas from there.  There are many combinations that you might want to have covered in the long run.</p>\n\n<p>Here is a sampling of <a href=\"https://github.com/kohesive/klutter/blob/v2/reflect/src/main/kotlin/uy/klutter/reflect/Types.kt\" rel=\"nofollow\">a big mix of extensions</a> for checking if one type is assignable from the other.  A few examples are:</p>\n\n<pre><code>fun &lt;T : Any, O : Any&gt; KClass&lt;T&gt;.isAssignableFrom(other: KClass&lt;O&gt;): Boolean {\n    if (this.java == other.java) return true\n    return this.java.isAssignableFrom(other.java)\n}\n\nfun &lt;T : Any&gt; KClass&lt;T&gt;.isAssignableFrom(other: Class&lt;*&gt;): Boolean {\n    if (this.java == other) return true\n    return this.java.isAssignableFrom(other)\n}\n\nfun KClass&lt;*&gt;.isAssignableFromOrSamePrimitive(other: KType): Boolean {\n    return (this.java as Type).isAssignableFromOrSamePrimitive(other.javaType) \n}\n\nfun KClass&lt;*&gt;.isAssignableFromOrSamePrimitive(other: Type): Boolean {\n    return (this.java as Type).isAssignableFromOrSamePrimitive(other)\n}\n\nfun Type.isAssignableFromOrSamePrimitive(other: Type): Boolean {\n    if (this == other) return true\n    if (this is Class&lt;*&gt;) {\n        if (other is Class&lt;*&gt;) {\n            return this == other.kotlin.javaObjectType || this == other.kotlin.javaPrimitiveType ||\n                    this.isAssignableFrom(other)\n        }\n        return this.isAssignableFrom(other.erasedType())\n    }\n    return this.erasedType().isAssignableFrom(other.erasedType())\n}\n\n// ... and so on for every permutation of types\n</code></pre>\n\n<p>See the <a href=\"https://github.com/kohesive/klutter/blob/v2/reflect/src/main/kotlin/uy/klutter/reflect/Types.kt\" rel=\"nofollow\">linked source for all permutations</a>.  </p>\n\n<p>And you will need this <a href=\"https://github.com/kohesive/klutter/blob/v2/reflect/src/main/kotlin/uy/klutter/reflect/TypeInfo.kt#L25-L44\" rel=\"nofollow\"><code>erasedType()</code> extension</a> used by the above samples -- which goes from a <code>Type</code> back to a <code>Class</code> (after type erasure):</p>\n\n\n\n<pre><code>@Suppress(\"UNCHECKED_CAST\") fun Type.erasedType(): Class&lt;Any&gt; {\n    return when (this) {\n        is Class&lt;*&gt; -&gt; this as Class&lt;Any&gt;\n        is ParameterizedType -&gt; this.getRawType().erasedType()\n        is GenericArrayType -&gt; {\n            // getting the array type is a bit trickier\n            val elementType = this.getGenericComponentType().erasedType()\n            val testArray = java.lang.reflect.Array.newInstance(elementType, 0)\n            testArray.javaClass\n        }\n        is TypeVariable&lt;*&gt; -&gt; {\n            // not sure yet\n            throw IllegalStateException(\"Not sure what to do here yet\")\n        }\n        is WildcardType -&gt; {\n            this.getUpperBounds()[0].erasedType()\n        }\n        else -&gt; throw IllegalStateException(\"Should not get here.\")\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1339, "user_id": 1359988, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/00c331889adb81f68b66cd75734459a6?s=128&d=identicon&r=PG", "display_name": "zjuhasz", "link": "https://stackoverflow.com/users/1359988/zjuhasz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 636, "favorite_count": 0, "accepted_answer_id": 39628194, "answer_count": 2, "score": 6, "last_activity_date": 1615304421, "creation_date": 1474496125, "last_edit_date": 1474496600, "question_id": 39627398, "link": "https://stackoverflow.com/questions/39627398/kotlin-class-literals-with-empty-left-hand-side-are-not-yet-supported", "title": "Kotlin class literals with empty left hand side are not yet supported?", "body": "<p>I am trying to check if a type conforms to a another type with an if expression like so:</p>\n\n<pre><code>if (String::class is Any::class)\n</code></pre>\n\n<p>This gives me the error class literals with empty left hand side are not yet supported. Can anyone elaborate on that error and/or tell me how I should be doing this check?</p>\n\n<p>edit (clarification): I can't do an equality check because I need to know if the class on the left either matches the class on the right or is a subclass of it. So if an instance of the class on the left can be safely cast to the class on the right.</p>\n\n<p>Basically I need the equivalent of:</p>\n\n<pre><code>if (\"A string\" is Any)\n</code></pre>\n\n<p>But without having a String instance, String just being used an example here.</p>\n"}, {"tags": ["properties", "abstract", "kotlin"], "answers": [{"tags": [], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "is_accepted": true, "score": 11, "last_activity_date": 1474502600, "creation_date": 1474502600, "answer_id": 39628247, "question_id": 39627225, "link": "https://stackoverflow.com/questions/39627225/kotlin-abstract-protected-property/39628247#39628247", "title": "Kotlin Abstract Protected Property", "body": "<p>You will receive an IDE inspection style warnings in Kotlin for things like extra semi-colons you don't need, an extra generic type parameters that can already be inferred, and more.  Yours for redundant visibility modifier is along the same lines.</p>\n\n<p>If you expand the inspection message you will see the full text:</p>\n\n<blockquote>\n  <p>This inspection reports visibility modifiers which match the default visibility of an element (public for most elements, protected for members that override a protected member).</p>\n</blockquote>\n\n<p>And you can turn the inspection off within your IDE if you no longer what to see it.</p>\n\n<p><strong>A few more notes about this:</strong></p>\n\n<p>When overriding a method or member of an ancestor class you are already at the same access level as when it was declared.  Saying <code>protected</code> is stating the obvious (to the compiler which knows it is <code>protected</code>). </p>\n\n<p>You are allowed to restate the access modifier again if you want.  And you can open it up more, by changing it to <code>public</code>.  But you cannot restrict it further, for example going to <code>private</code> (because if it is private how could you override it, that idea is incompatible with <code>override</code>) which becomes a compiler error.</p>\n"}], "owner": {"reputation": 6636, "user_id": 691639, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/e237f683765ca5ad65c9060cf73a0991?s=128&d=identicon&r=PG", "display_name": "Eliezer", "link": "https://stackoverflow.com/users/691639/eliezer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9069, "favorite_count": 0, "accepted_answer_id": 39628247, "answer_count": 1, "score": 15, "last_activity_date": 1474502600, "creation_date": 1474495173, "question_id": 39627225, "link": "https://stackoverflow.com/questions/39627225/kotlin-abstract-protected-property", "title": "Kotlin Abstract Protected Property", "body": "<p>If I have the following class hierarchy:    </p>\n\n<pre><code>abstract class Foo&lt;out T : Bar&gt;() {\n  abstract protected val thing: T\n}\n\nclass Baz : Foo&lt;BarImpl&gt; {\n  override protected val thing: T = ...\n}\n</code></pre>\n\n<p>I get a warning on Baz::thing saying:</p>\n\n<blockquote>\n  <p>Redundant visibility modifier</p>\n</blockquote>\n\n<p>Does that mean the compiler treats it as protected without you needing to specify that, or that it has to be public?</p>\n"}, {"tags": ["jackson", "kotlin"], "answers": [{"tags": [], "owner": {"reputation": 289, "user_id": 5000452, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/fa8529c8a37ada8f9b91e390558ae8d0?s=128&d=identicon&r=PG&f=1", "display_name": "gcscaglia", "link": "https://stackoverflow.com/users/5000452/gcscaglia"}, "is_accepted": true, "score": 3, "last_activity_date": 1474470695, "creation_date": 1474470695, "answer_id": 39620375, "question_id": 39618748, "link": "https://stackoverflow.com/questions/39618748/jackson-deserialization-kotlin-data-classes-defaults-for-missing-fields-per/39620375#39620375", "title": "Jackson deserialization - Kotlin data classes - Defaults for missing fields per mapper", "body": "<p>This can be achieved by combining <a href=\"http://wiki.fasterxml.com/JacksonMixInAnnotations\" rel=\"nofollow\">MinInAnnotations</a> and <a href=\"http://wiki.fasterxml.com/JacksonFeatureValueInjection\" rel=\"nofollow\">ValueInjection</a>. </p>\n\n<p>Complete solution as follows:</p>\n\n<pre><code>data class MyPojo(val notInJson: Int, val inJson: Int)\n\nclass MyPojoMixIn {\n    @JacksonInject(\"notInJson\") val notInJson: Int = 0\n}\n\nfun deserialize(jsonString: String, valueForFieldNotInJson: Int): MyPojo {\n    val injectables = InjectableValues.Std().addValue(\"notInJson\", valueForFieldNotInJson)\n    val reader = jacksonObjectMapper()\n            .addMixIn(MyPojo::class.java, MyPojoMixIn::class.java)\n            .readerFor(MyPojo::class.java)\n            .with(injectables)\n    return reader.readValue(jsonString)\n}\n</code></pre>\n"}], "owner": {"reputation": 289, "user_id": 5000452, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/fa8529c8a37ada8f9b91e390558ae8d0?s=128&d=identicon&r=PG&f=1", "display_name": "gcscaglia", "link": "https://stackoverflow.com/users/5000452/gcscaglia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 368, "favorite_count": 0, "accepted_answer_id": 39620375, "answer_count": 1, "score": 1, "last_activity_date": 1474470695, "creation_date": 1474466382, "question_id": 39618748, "link": "https://stackoverflow.com/questions/39618748/jackson-deserialization-kotlin-data-classes-defaults-for-missing-fields-per", "title": "Jackson deserialization - Kotlin data classes - Defaults for missing fields per mapper", "body": "<p>Given this data class:</p>\n\n<pre><code>data class MyPojo(val notInJson: Int, val inJson: Int)\n</code></pre>\n\n<p>Assume I want to implement a function of the form:</p>\n\n<pre><code>fun deserialize(jsonString: String, valueForFieldNotInJson: Int): MyPojo\n</code></pre>\n\n<p>Where <code>jsonString</code> does not include a field named <code>notInJson</code>. Assume also, that I have no control over <code>MyPojo</code> class definition.</p>\n\n<p>How could I use Jackson library to deserialize <code>MyPojo</code> from <code>jsonString</code> and augment the missing field (<code>notInJson</code>) from <code>valueForFieldNotInJson</code> parameter?</p>\n\n<h3>Notes:</h3>\n\n<ul>\n<li>Basically, the question is about deserializing a Immutable class, where some fields come from Json and others are supplied at runtime.</li>\n<li>Using custom deserializers or <a href=\"http://wiki.fasterxml.com/JacksonFeatureBuilderPattern\" rel=\"nofollow\">builders</a> will not work because missing values are unknow at compile time.</li>\n</ul>\n"}, {"tags": ["lambda", "kotlin", "constructor-overloading"], "answers": [{"tags": [], "owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "is_accepted": false, "score": 6, "last_activity_date": 1474473010, "last_edit_date": 1474473010, "creation_date": 1474459237, "answer_id": 39616000, "question_id": 39615472, "link": "https://stackoverflow.com/questions/39615472/how-to-overload-constructors-in-kotlin-differs-in-lambda-return-type/39616000#39616000", "title": "How to overload constructors in kotlin differs in lambda return type", "body": "<p>You cannot define constructors with signatures that differ only in generic parameters (in your case, it's generic parameters for <code>Function1&lt;in P1, out R&gt;</code>) because the signatures would clash after generics erasure.</p>\n\n<p>However, in your case <code>Unit</code> is subtype of <code>Any</code>, and since <code>Function&lt;in P1, out R&gt;</code> <a href=\"https://kotlinlang.org/docs/reference/generics.html#variance\" rel=\"nofollow\">is covariant on <code>R</code></a>, you can pass a function that returns <code>Unit</code> to the second constructor, so just remove the first one.</p>\n\n<p>Simplified example:</p>\n\n<pre><code>class C(val action: (Int) -&gt; Any)\n\nfun main(args: Array&lt;String&gt;) {\n    val f: (Int) -&gt; Unit = { println(it) }\n    C(f)\n}\n</code></pre>\n\n<p>For more complicated cases, <a href=\"https://github.com/yole/kotlin-style-guide/issues/22\" rel=\"nofollow\">consider changing to factory functions</a>: unlike constructors, you can annotate them with <a href=\"https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.jvm/-jvm-name/\" rel=\"nofollow\"><code>@JvmName</code></a> to avoid the signatures clash:</p>\n\n<pre><code>@JvmName(\"createCUnit\")\nfun createC(f: (Int) -&gt; Unit) = C(f)\n\nfun createC(f: (Int) -&gt; Any) = C(f)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2222, "user_id": 1574133, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YypZZ.jpg?s=128&g=1", "display_name": "rafal", "link": "https://stackoverflow.com/users/1574133/rafal"}, "is_accepted": false, "score": 3, "last_activity_date": 1474460098, "creation_date": 1474460098, "answer_id": 39616294, "question_id": 39615472, "link": "https://stackoverflow.com/questions/39615472/how-to-overload-constructors-in-kotlin-differs-in-lambda-return-type/39616294#39616294", "title": "How to overload constructors in kotlin differs in lambda return type", "body": "<p>When targeting JVM backend, all Kotlin classes are compiled to JVM bytecode. The problem with java's bytecode is <a href=\"https://en.wikipedia.org/wiki/Type_erasure\" rel=\"nofollow\">type erasure</a>. This means that all info about generics is removed (it's Java's issue not Kotlin's).</p>\n\n<p>Declaring functional type <code>(transaction: Transaction) -&gt; Unit</code> is eqivalent to using this type: <code>Function1&lt;Transaction, Unit&gt;</code>. However, for JVM bytecode both <code>Function1&lt;Transaction, Unit&gt;</code> and <code>Function1&lt;Transaction, Any&gt;</code> are the same.</p>\n\n<p>This means that both your constructors have the same signature in JVM world.</p>\n\n<p>You can \"simulate\" constructors using <code>companion object</code></p>\n\n<pre><code>class MyClass {\n    constructor(db: Database, h: Handler&lt;Transaction&gt;)\n\n    companion object {\n        operator fun invoke(db: Database, handler: (transaction: Transaction) -&gt; Unit) = MyClass(db, Handler&lt;Transaction&gt;({ handler.invoke(it) }))\n\n        @JvmName(\"alternative_constructor\")\n        operator fun invoke(db: Database, handler: (transaction:     Transaction) -&gt; Any) = MyClass(db, Handler&lt;Transaction&gt;({ handler.invoke(it) }))\n    }\n}\n</code></pre>\n\n<p>And usage looks like this:</p>\n\n<pre><code>fun main(args: Array&lt;String&gt;) {\n    val db = Database()\n\n    MyClass(db, Handler {  }) //real constructor\n    MyClass(db){ } //version from companion object\n}\n</code></pre>\n"}], "owner": {"reputation": 187, "user_id": 6778072, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fc2Y8.jpg?s=128&g=1", "display_name": "rusna", "link": "https://stackoverflow.com/users/6778072/rusna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1110, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1474641125, "creation_date": 1474457705, "last_edit_date": 1474641125, "question_id": 39615472, "link": "https://stackoverflow.com/questions/39615472/how-to-overload-constructors-in-kotlin-differs-in-lambda-return-type", "title": "How to overload constructors in kotlin differs in lambda return type", "body": "<p>I have two constructors which are different only in their lambda return type. Is there any option how to overload them? I was trying to use <strong>JvmOverloads</strong> annotation, but it didn't work.</p>\n\n<pre><code>constructor(db : Database, handler: ( transaction: Transaction) -&gt; Unit) : this(db, Handler&lt;Transaction&gt;( {handler.invoke(it)}))\n\n@JvmOverloads\nconstructor(db : Database, handler: ( transaction: Transaction) -&gt; Any) : this(db, Handler&lt;Transaction&gt;( {handler.invoke(it)}))\n</code></pre>\n"}, {"tags": ["generics", "kotlin"], "answers": [{"tags": [], "owner": {"reputation": 25812, "user_id": 288456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf294ff6d86cc587dec43e2af34a9532?s=128&d=identicon&r=PG", "display_name": "Alexander Udalov", "link": "https://stackoverflow.com/users/288456/alexander-udalov"}, "is_accepted": false, "score": 10, "last_activity_date": 1474381205, "creation_date": 1474381205, "answer_id": 39596613, "question_id": 39596420, "link": "https://stackoverflow.com/questions/39596420/how-do-i-constrain-a-kotlin-extension-function-parameter-to-be-the-same-as-the-e/39596613#39596613", "title": "How do I constrain a Kotlin extension function parameter to be the same as the extended type?", "body": "<p>As far as I know, this is not possible in Kotlin 1.0. There are several issues in the tracker (<a href=\"https://youtrack.jetbrains.com/issue/KT-13198\" rel=\"noreferrer\">first</a>, <a href=\"https://youtrack.jetbrains.com/issue/KT-13138\" rel=\"noreferrer\">second</a>) about a similar use case, and the solution proposed in the first one is likely going to help here in the future as well.</p>\n"}, {"comments": [{"owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "edited": false, "score": 1, "creation_date": 1474382781, "post_id": 39596957, "comment_id": 66502941, "body": "It would be possible to define an extension property and add <code>invoke()</code> function to <code>Wrapper</code> to make this workaround syntactically identical to function call, but there seems to be a bug in the compiler which prevents me from doing so."}, {"owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "edited": false, "score": 1, "creation_date": 1474385203, "post_id": 39596957, "comment_id": 66504502, "body": "Funny thing is that even <code>(&quot;abc&quot;.foo)(&quot;abc&quot;)</code> works. :D"}, {"owner": {"reputation": 16077, "user_id": 97777, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/fb95aca1c80de718bbfa01447220633b?s=128&d=identicon&r=PG", "display_name": "Duncan McGregor", "link": "https://stackoverflow.com/users/97777/duncan-mcgregor"}, "reply_to_user": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "edited": false, "score": 0, "creation_date": 1474406489, "post_id": 39596957, "comment_id": 66516383, "body": "I think given the bug, this is going to be accepted, but thanks @hotkey for the work"}, {"owner": {"reputation": 16077, "user_id": 97777, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/fb95aca1c80de718bbfa01447220633b?s=128&d=identicon&r=PG", "display_name": "Duncan McGregor", "link": "https://stackoverflow.com/users/97777/duncan-mcgregor"}, "edited": false, "score": 0, "creation_date": 1474757119, "post_id": 39596957, "comment_id": 66663461, "body": "In practice<code>Wrapper</code> doesn&#39;t even need to capture a parameter, just be returned and have <code>.get()</code> defined."}, {"owner": {"reputation": 1715, "user_id": 910095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04e96728ed86fffbb7960da7fe34cd47?s=128&d=identicon&r=PG", "display_name": "Nikola Mihajlovi\u0107", "link": "https://stackoverflow.com/users/910095/nikola-mihajlovi%c4%87"}, "edited": false, "score": 0, "creation_date": 1612913720, "post_id": 39596957, "comment_id": 116914232, "body": "This no longer works in Kotlin 1.4. It will simply compile."}], "tags": [], "owner": {"reputation": 32343, "user_id": 155213, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57bc3e08faeb981ddc81abd1d25c3bf1?s=128&d=identicon&r=PG", "display_name": "miensol", "link": "https://stackoverflow.com/users/155213/miensol"}, "is_accepted": true, "score": 13, "last_activity_date": 1474383772, "last_edit_date": 1495540442, "creation_date": 1474382145, "answer_id": 39596957, "question_id": 39596420, "link": "https://stackoverflow.com/questions/39596420/how-do-i-constrain-a-kotlin-extension-function-parameter-to-be-the-same-as-the-e/39596957#39596957", "title": "How do I constrain a Kotlin extension function parameter to be the same as the extended type?", "body": "<p>As mentioned by <a href=\"https://stackoverflow.com/a/39596613/155213\">@Alexander Udalov</a> it's not possible to do directly but there's a workaround where you define the extension method on another type like so:</p>\n\n<pre><code>data class Wrapper&lt;T&gt;(val value: T)\n\nval &lt;T&gt; T.ext: Wrapper&lt;T&gt; get() = Wrapper(this)\n\nfun &lt;T&gt; Wrapper&lt;T&gt;.thing(p: T) {\n    println(\"value = $value, param = $p\")\n}\n</code></pre>\n\n<p>With the above the following compiles:</p>\n\n<pre><code>\"abc\".ext.thing(\"A\")\n</code></pre>\n\n<p>but the next fails </p>\n\n<pre><code>\"abc\".ext.thing(2)\n</code></pre>\n\n<p>with:</p>\n\n<pre><code>Kotlin: Type inference failed: Cannot infer type parameter T in fun &lt;T&gt; Wrapper&lt;T&gt;.thing(p: T): Unit\nNone of the following substitutions\nreceiver: Wrapper&lt;String&gt;  arguments: (String)\nreceiver: Wrapper&lt;Int&gt;  arguments: (Int)\ncan be applied to\nreceiver: Wrapper&lt;String&gt;  arguments: (Int)\n</code></pre>\n\n<p>As suggested by @hotkey it seems that it should be possible to avoid the need for explicit <code>Wrapper</code> type with the following extension property:</p>\n\n<pre><code>val &lt;T&gt; T.thing: (T) -&gt; Any? get() = { println(\"extension body\") }\n</code></pre>\n\n<p>And then use it as <code>\"abc\".thing(\"A\")</code> but <strong>it also fails</strong>. Surprisingly the following does compile <code>\"abc\".thing.invoke(\"A\")</code></p>\n"}, {"tags": [], "owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "is_accepted": false, "score": 5, "last_activity_date": 1474385490, "creation_date": 1474385490, "answer_id": 39598190, "question_id": 39596420, "link": "https://stackoverflow.com/questions/39596420/how-do-i-constrain-a-kotlin-extension-function-parameter-to-be-the-same-as-the-e/39598190#39598190", "title": "How do I constrain a Kotlin extension function parameter to be the same as the extended type?", "body": "<p>Improving @miensol's workaround and making it visually identical to function call:</p>\n\n<pre><code>val &lt;T&gt; T.foo: (T) -&gt; SomeType get() = { other -&gt; ... }\n</code></pre>\n\n<p>This is an extension property that provides a lambda, which can be immediately called with an argument of the same type <code>T</code> like this:</p>\n\n<pre><code>\"abc\".foo(1) // Fail\n\"abc\".foo(\"def\") // OK\n</code></pre>\n\n<hr>\n\n<p>Unfortunately, there <strong><a href=\"https://youtrack.jetbrains.com/issue/KT-13965\" rel=\"noreferrer\">seems to be a bug in the compiler</a></strong> which prevents you from writing <code>\"abc\".thing(\"abc\")</code>, but either of <code>\"abc\".thing.invoke(\"abc\")</code> and <code>(\"abc\".thing)(\"abc)</code> work well and filter out calls with non-strings.</p>\n"}], "owner": {"reputation": 16077, "user_id": 97777, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/fb95aca1c80de718bbfa01447220633b?s=128&d=identicon&r=PG", "display_name": "Duncan McGregor", "link": "https://stackoverflow.com/users/97777/duncan-mcgregor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1010, "favorite_count": 1, "accepted_answer_id": 39596957, "answer_count": 3, "score": 18, "last_activity_date": 1507851866, "creation_date": 1474380654, "last_edit_date": 1507851866, "question_id": 39596420, "link": "https://stackoverflow.com/questions/39596420/how-do-i-constrain-a-kotlin-extension-function-parameter-to-be-the-same-as-the-e", "title": "How do I constrain a Kotlin extension function parameter to be the same as the extended type?", "body": "<p>I want to write an extension method on a generic type T, where the matched type constrains a method parameter.</p>\n\n<p>I want this to compile:</p>\n\n<pre><code>\"Hello\".thing(\"world\")\n</code></pre>\n\n<p>But not this, as 42 is not a String:</p>\n\n<pre><code>\"Hello\".thing(42)\n</code></pre>\n\n<p>This definition doesn\u2019t work, because T is satisfied by <code>Any</code></p>\n\n<pre><code>fun &lt;T&gt; T.thing(p: T) {}\n</code></pre>\n"}, {"tags": ["kotlin"], "comments": [{"owner": {"reputation": 8022, "user_id": 1068649, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5e44a15ecb4ee475548612da03c81f33?s=128&d=identicon&r=PG", "display_name": "James Bassett", "link": "https://stackoverflow.com/users/1068649/james-bassett"}, "edited": false, "score": 0, "creation_date": 1474370762, "post_id": 39592772, "comment_id": 66494419, "body": "Shouldn&#39;t <code>isArray()</code> return Boolean?"}], "answers": [{"comments": [{"owner": {"reputation": 12262, "user_id": 943, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d2ffa472b72f308b8b5b6cc8ea528e4a?s=128&d=identicon&r=PG", "display_name": "RodeoClown", "link": "https://stackoverflow.com/users/943/rodeoclown"}, "edited": false, "score": 0, "creation_date": 1474371616, "post_id": 39592856, "comment_id": 66494975, "body": "That second option seems like a lot more work, thanks for the explanation here of what&#39;s going on!"}], "tags": [], "owner": {"reputation": 89682, "user_id": 675383, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/6e7a971eb341ffeaa3efca407239bf3b?s=128&d=identicon&r=PG", "display_name": "nhaarman", "link": "https://stackoverflow.com/users/675383/nhaarman"}, "is_accepted": false, "score": 2, "last_activity_date": 1474370837, "creation_date": 1474370837, "answer_id": 39592856, "question_id": 39592772, "link": "https://stackoverflow.com/questions/39592772/why-wont-the-result-of-a-function-work-as-a-clause-in-a-when-statement-in-kotli/39592856#39592856", "title": "Why won&#39;t the result of a function work as a clause in a when statement in Kotlin?", "body": "<pre><code>return when (obj) {\n    null -&gt; \"null\"\n    [...]\n    isArray(obj) -&gt; \"Array\"\n    else -&gt; \"Other object\"\n}\n</code></pre>\n\n<p>This seems to match the result of <code>isArray(obj)</code> (a <code>Boolean</code>) to the <code>obj</code> itself. Therefore, it's making the comparison <code>obj == true</code>, which is false.</p>\n\n<p>If you want a <code>when</code> expression that uses boolean statements, you can do:</p>\n\n<pre><code>return when {\n    obj == null -&gt; \"null\"\n    [...]\n    isArray(obj) -&gt; \"Array\"\n    else -&gt; \"Other object\"\n}\n</code></pre>\n\n<p>Of course, this will require you to write a lot of <code>obj == x</code> checks.</p>\n"}, {"comments": [{"owner": {"reputation": 12262, "user_id": 943, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d2ffa472b72f308b8b5b6cc8ea528e4a?s=128&d=identicon&r=PG", "display_name": "RodeoClown", "link": "https://stackoverflow.com/users/943/rodeoclown"}, "edited": false, "score": 0, "creation_date": 1474371502, "post_id": 39592912, "comment_id": 66494898, "body": "Ah, thanks for that - makes sense that I can&#39;t mix the two (although I wish I could :)). I&#39;ll merge the two into the one <code>when</code> clause."}, {"owner": {"reputation": 12262, "user_id": 943, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d2ffa472b72f308b8b5b6cc8ea528e4a?s=128&d=identicon&r=PG", "display_name": "RodeoClown", "link": "https://stackoverflow.com/users/943/rodeoclown"}, "edited": false, "score": 0, "creation_date": 1474371600, "post_id": 39592912, "comment_id": 66494964, "body": "I looked for the isArray, and I couldn&#39;t find it - that makes an even better answer :)"}], "tags": [], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "is_accepted": true, "score": 4, "last_activity_date": 1474371780, "last_edit_date": 1474371780, "creation_date": 1474370975, "answer_id": 39592912, "question_id": 39592772, "link": "https://stackoverflow.com/questions/39592772/why-wont-the-result-of-a-function-work-as-a-clause-in-a-when-statement-in-kotli/39592912#39592912", "title": "Why won&#39;t the result of a function work as a clause in a when statement in Kotlin?", "body": "<p>You have two issues, first is that <code>isArray</code> needs to return <code>Boolean</code> and not <code>Any</code>.</p>\n\n<p>The second problem is that you are using the form of <a href=\"http://kotlinlang.org/docs/reference/control-flow.html#when-expression\" rel=\"nofollow\"><code>when</code> expression</a> that has a fixed condition, <code>obj</code> and you are mixing that with the form of <code>when</code> that has no fixed condition and uses only boolean expressions.  The documentation isn't clear on the difference.</p>\n\n<p>Fixed condition <code>when</code> expression:</p>\n\n<pre><code>when(obj) {\n    null -&gt; \"null\"\n    is Array&lt;*&gt;, is IntArray, is DoubleArray -&gt; \"Array\"\n    else -&gt; \"Other object\"\n}\n</code></pre>\n\n<p>versus what you need to use, boolean expressions in a <code>when</code> expression:</p>\n\n<pre><code>when {                            // &lt;--- no (obj) here\n    obj == null -&gt; \"null\"\n    isArray(obj) -&gt; \"Array\"\n    else -&gt; \"Other object\"\n}\n</code></pre>\n\n<p>Although a much simpler way to find an array is this:</p>\n\n<pre><code>obj.javaClass.isArray\n</code></pre>\n\n<p>So you can change your <code>when</code> expression to simply be:</p>\n\n<pre><code>when {\n    obj == null -&gt; \"null\"\n    obj.javaClass.isArray -&gt; \"Array\"\n    else -&gt; \"Other object\"\n}\n</code></pre>\n"}], "owner": {"reputation": 12262, "user_id": 943, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d2ffa472b72f308b8b5b6cc8ea528e4a?s=128&d=identicon&r=PG", "display_name": "RodeoClown", "link": "https://stackoverflow.com/users/943/rodeoclown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 39592912, "answer_count": 2, "score": 1, "last_activity_date": 1474371780, "creation_date": 1474370548, "question_id": 39592772, "link": "https://stackoverflow.com/questions/39592772/why-wont-the-result-of-a-function-work-as-a-clause-in-a-when-statement-in-kotli", "title": "Why won&#39;t the result of a function work as a clause in a when statement in Kotlin?", "body": "<p>I have the following (edited for length) Kotlin functions:</p>\n\n<pre><code>fun getType(obj: Any?): String {\n    if (obj != null)\n        println(\"$obj -&gt; isArray:${isArray(obj)}\")\n\n    return when (obj) {\n        null -&gt; \"null\"\n        [...]\n        isArray(obj) -&gt; \"Array\"\n        else -&gt; \"Other object\"\n    }\n}\n\nprivate fun isArray(obj: Any): Any = \n        obj is Array&lt;*&gt; ||\n        [...]\n        obj is IntArray\n</code></pre>\n\n<p>When I <code>assertEquals(\"Array\", getType(intArrayOf(1,2,3,4)))</code> I get the following output:</p>\n\n<pre><code>[I@1e25b76 -&gt; isArray:true\n\norg.junit.ComparisonFailure: \nExpected :Array\nActual   :Other object\n</code></pre>\n\n<p>So the <code>isArray</code> call is returning <code>true</code>, but it's not being recognised in the <code>when</code> clause. Why wouldn't it return <code>\"Array\"</code> here?</p>\n\n<p>(I can work around this by putting this specific call before the <code>when</code> statement, but that's ugly)</p>\n"}, {"tags": ["java", "reflection", "kotlin"], "comments": [{"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "edited": false, "score": 0, "creation_date": 1474370262, "post_id": 39589780, "comment_id": 66494066, "body": "Are you interested in fields (i.e. raw java classes) or properties (i.e. javabeans or Kotlin classes)?  Are you dealing only with Kotlin classes or also Java classes?"}, {"owner": {"reputation": 7128, "user_id": 4189582, "user_type": "registered", "accept_rate": 88, "profile_image": "https://lh3.googleusercontent.com/-rJzuadzQg0o/AAAAAAAAAAI/AAAAAAAAABQ/lRX62PozZNA/photo.jpg?sz=128", "display_name": "Ivar Reukers", "link": "https://stackoverflow.com/users/4189582/ivar-reukers"}, "reply_to_user": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "edited": false, "score": 0, "creation_date": 1474370342, "post_id": 39589780, "comment_id": 66494121, "body": "only Kotlin classes but @hotkey &#39;s solution worked for my particular problem"}, {"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "edited": false, "score": 0, "creation_date": 1474370404, "post_id": 39589780, "comment_id": 66494170, "body": "&quot;<i>there is no documentation about this call</i>&quot; -- links for that documentation are below."}, {"owner": {"reputation": 7128, "user_id": 4189582, "user_type": "registered", "accept_rate": 88, "profile_image": "https://lh3.googleusercontent.com/-rJzuadzQg0o/AAAAAAAAAAI/AAAAAAAAABQ/lRX62PozZNA/photo.jpg?sz=128", "display_name": "Ivar Reukers", "link": "https://stackoverflow.com/users/4189582/ivar-reukers"}, "reply_to_user": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "edited": false, "score": 0, "creation_date": 1474370446, "post_id": 39589780, "comment_id": 66494196, "body": "I know, saw it after, I couldn&#39;t find it at first/didn&#39;t know what to search for so I missed that documentation"}], "answers": [{"comments": [{"owner": {"reputation": 7128, "user_id": 4189582, "user_type": "registered", "accept_rate": 88, "profile_image": "https://lh3.googleusercontent.com/-rJzuadzQg0o/AAAAAAAAAAI/AAAAAAAAABQ/lRX62PozZNA/photo.jpg?sz=128", "display_name": "Ivar Reukers", "link": "https://stackoverflow.com/users/4189582/ivar-reukers"}, "edited": false, "score": 0, "creation_date": 1474363870, "post_id": 39590049, "comment_id": 66489950, "body": "and is it possible to create an MyClass object, and set these <code>declaredFields</code> (using the Java reflection) with the <code>Field.name</code>?"}, {"owner": {"reputation": 1057, "user_id": 3674079, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/1m1O1.jpg?s=128&g=1", "display_name": "quangkid", "link": "https://stackoverflow.com/users/3674079/quangkid"}, "edited": false, "score": 1, "creation_date": 1521256765, "post_id": 39590049, "comment_id": 85666296, "body": "In case java class has a field is <code>public static final String</code>, can I get its string value?"}], "tags": [], "owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "is_accepted": true, "score": 21, "last_activity_date": 1474364244, "last_edit_date": 1474364244, "creation_date": 1474362683, "answer_id": 39590049, "question_id": 39589780, "link": "https://stackoverflow.com/questions/39589780/kotlin-reflection-getting-all-field-names-of-a-class/39590049#39590049", "title": "Kotlin reflection - getting all field names of a Class", "body": "<p>Probably what you want is to get properties of a class, not fields. This can be done as follows:</p>\n\n<pre><code>MyClass::class.declaredMemberProperties\n</code></pre>\n\n<p>Getting fields is also possible through Java reflection:</p>\n\n<pre><code>MyClass::class.java.declaredFields\n</code></pre>\n\n<p>But fields are rather an implementation detail in Kotlin, because some properties might have no <a href=\"https://kotlinlang.org/docs/reference/properties.html#backing-fields\">backing field</a>.</p>\n\n<hr>\n\n<p>As to the visibility, for properties you can check the getter visibility modifiers:</p>\n\n<pre><code>val p = MyClass::class.declaredMemberProperties.first()\nval modifiers = p.javaGetter?.modifiers\n</code></pre>\n\n<p>Note: it's <code>null</code> in case of a simple <code>private val</code> or <a href=\"https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.jvm/-jvm-field/\"><code>@JvmField</code></a> usage. Then you can inspect <code>p.javaField</code> instead.</p>\n\n<p>Then, if <code>modifiers</code> is not <code>null</code>, just check it with <code>Modifier.isPrivate(...)</code>.</p>\n\n<p>Properties in Kotlin can have <a href=\"https://kotlinlang.org/docs/reference/properties.html#getters-and-setters\">separate visibility modifiers for getter and setter</a>, but a setter access cannot be more permissive than that of the getter, which is effectively the property visibility.</p>\n"}, {"tags": [], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "is_accepted": false, "score": 4, "last_activity_date": 1474364768, "last_edit_date": 1474364768, "creation_date": 1474364352, "answer_id": 39590698, "question_id": 39589780, "link": "https://stackoverflow.com/questions/39589780/kotlin-reflection-getting-all-field-names-of-a-class/39590698#39590698", "title": "Kotlin reflection - getting all field names of a Class", "body": "<p>There is indeed documentation available for Kotlin reflection: <a href=\"http://kotlinlang.org/docs/reference/reflection.html\" rel=\"nofollow\">an overall summary of reflection</a> and the <a href=\"http://kotlinlang.org/api/latest/jvm/stdlib/kotlin.reflect/index.html\" rel=\"nofollow\">API docs</a> including for the <a href=\"http://kotlinlang.org/api/latest/jvm/stdlib/kotlin.reflect/-k-class/members.html\" rel=\"nofollow\">KClass.members</a> function.  You can also jump to the declaration of that method and you will see it is documented in the source code as well.</p>\n"}, {"tags": [], "owner": {"reputation": 16055, "user_id": 2914140, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/Ik94c.jpg?s=128&g=1", "display_name": "CoolMind", "link": "https://stackoverflow.com/users/2914140/coolmind"}, "is_accepted": false, "score": 2, "last_activity_date": 1590490507, "creation_date": 1590490507, "answer_id": 62020546, "question_id": 39589780, "link": "https://stackoverflow.com/questions/39589780/kotlin-reflection-getting-all-field-names-of-a-class/62020546#62020546", "title": "Kotlin reflection - getting all field names of a Class", "body": "<p>Use <code>MyClass::class.java.declaredFields</code> or it's instance: <code>myObject::class.java.declaredFields</code>.</p>\n"}], "owner": {"reputation": 7128, "user_id": 4189582, "user_type": "registered", "accept_rate": 88, "profile_image": "https://lh3.googleusercontent.com/-rJzuadzQg0o/AAAAAAAAAAI/AAAAAAAAABQ/lRX62PozZNA/photo.jpg?sz=128", "display_name": "Ivar Reukers", "link": "https://stackoverflow.com/users/4189582/ivar-reukers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 15985, "favorite_count": 1, "accepted_answer_id": 39590049, "answer_count": 3, "score": 15, "last_activity_date": 1590490507, "creation_date": 1474361921, "last_edit_date": 1481208111, "question_id": 39589780, "link": "https://stackoverflow.com/questions/39589780/kotlin-reflection-getting-all-field-names-of-a-class", "title": "Kotlin reflection - getting all field names of a Class", "body": "<p>How can I get a list of a Kotlin data class it's <code>declaredFields</code>? Like Java's <code>getDeclaredFields()</code></p>\n\n<p>And if this is possible is it also possible to filter for <code>public</code> and <code>private</code> fields? (Like Java's <code>Modifier.isPrivate(field.getModifiers())</code>)</p>\n"}, {"tags": ["java", "android", "apk", "android-volley", "kotlin"], "comments": [{"owner": {"reputation": 1032, "user_id": 6468241, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/QdzXN.jpg?s=128&g=1", "display_name": "PriyankaChauhan", "link": "https://stackoverflow.com/users/6468241/priyankachauhan"}, "edited": false, "score": 0, "creation_date": 1474360223, "post_id": 39589166, "comment_id": 66487675, "body": "check the apk&#39;s minimum version and your phone vesrion"}, {"owner": {"reputation": 801, "user_id": 1382827, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ad6fb14f386fdbd82584bd90b6372d7a?s=128&d=identicon&r=PG", "display_name": "Samyn", "link": "https://stackoverflow.com/users/1382827/samyn"}, "reply_to_user": {"reputation": 1032, "user_id": 6468241, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/QdzXN.jpg?s=128&g=1", "display_name": "PriyankaChauhan", "link": "https://stackoverflow.com/users/6468241/priyankachauhan"}, "edited": false, "score": 0, "creation_date": 1474360285, "post_id": 39589166, "comment_id": 66487716, "body": "I&#39;m quite literally using the same device as I am using for development. this is not the issue here."}, {"owner": {"reputation": 2863, "user_id": 4596556, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/c2c6906f02b7691bc0a73d839b2ffa03?s=128&d=identicon&r=PG&f=1", "display_name": "Madhukar Hebbar", "link": "https://stackoverflow.com/users/4596556/madhukar-hebbar"}, "edited": false, "score": 0, "creation_date": 1474360604, "post_id": 39589166, "comment_id": 66487916, "body": "Is it the signed apk? Have you enabled <code>unknown resources</code> setting?. In some case if the apk file is not downloaded correctly/fully then this error may occurs."}, {"owner": {"reputation": 801, "user_id": 1382827, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ad6fb14f386fdbd82584bd90b6372d7a?s=128&d=identicon&r=PG", "display_name": "Samyn", "link": "https://stackoverflow.com/users/1382827/samyn"}, "edited": false, "score": 0, "creation_date": 1474362939, "post_id": 39589166, "comment_id": 66489333, "body": "This APK is signed and unknown resources are allowed."}], "answers": [{"tags": [], "owner": {"reputation": 801, "user_id": 1382827, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ad6fb14f386fdbd82584bd90b6372d7a?s=128&d=identicon&r=PG", "display_name": "Samyn", "link": "https://stackoverflow.com/users/1382827/samyn"}, "is_accepted": true, "score": 0, "last_activity_date": 1474363285, "creation_date": 1474363285, "answer_id": 39590270, "question_id": 39589166, "link": "https://stackoverflow.com/questions/39589166/downloading-and-installing-an-apk-using-volley/39590270#39590270", "title": "Downloading and installing an APK using volley", "body": "<p>The issue is with the directories. I tried writing to a cache directory, and installing from there. Change the directory to <code>context.getExternalFilesDir(&lt;Appname&gt;, \"update.apk\")</code> and it will install without a problem.</p>\n"}], "owner": {"reputation": 801, "user_id": 1382827, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ad6fb14f386fdbd82584bd90b6372d7a?s=128&d=identicon&r=PG", "display_name": "Samyn", "link": "https://stackoverflow.com/users/1382827/samyn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 500, "favorite_count": 0, "accepted_answer_id": 39590270, "answer_count": 1, "score": 0, "last_activity_date": 1474363285, "creation_date": 1474360118, "last_edit_date": 1474360383, "question_id": 39589166, "link": "https://stackoverflow.com/questions/39589166/downloading-and-installing-an-apk-using-volley", "title": "Downloading and installing an APK using volley", "body": "<p>I'm tring to download an update over the web. This is with the latest volley version. I'm using a <code>Stringrequest</code> at the moment.</p>\n\n<pre><code>class UpdateService : IntentService(\"Update Serivce\") {\ncompanion object {\n    val VERSION_URL = \"&lt;version url&gt;\"\n    val FILE_URL = \"&lt;apk url&gt;\"\n    val LOG_TAG = \"UPDATE\"\n    fun initialize(context: Context) = context.startService(Intent(context, UpdateService::class.java))\n}\n\n/**\n * Checks remote for an update\n */\noverride fun onHandleIntent(intent: Intent?) {\n    Log.d(LOG_TAG, \"Retrieving new version\")\n    // Get version number\n    NetworkService().get(Uri.parse(VERSION_URL),\n            Response.Listener { success(it) },\n            Response.ErrorListener {\n                Log.d(LOG_TAG, \"Failed to update ${it.toString()}\")\n                FirebaseCrash.report(it)\n            })\n}\n\nprivate fun success(it: String?) {\n    Log.d(LOG_TAG, \"Remote version: $it\")\n    Log.d(LOG_TAG, \"Local version: ${BuildConfig.VERSION_NAME}\")\n\n    if (!it.equals(BuildConfig.VERSION_NAME)) {\n        Log.d(LOG_TAG, \"Fetching new update\")\n        NetworkService().get(\n                Uri.parse(FILE_URL),\n                Response.Listener { installUpdate(it) },\n                Response.ErrorListener {\n                    Log.d(LOG_TAG, \"failed to get new APK\")\n                    FirebaseCrash.report(it)\n                }\n        )\n    }\n}\n\nprivate fun installUpdate(it: String) {\n    Log.d(LOG_TAG, \"retrieved update\")\n\n    val file = File(this.externalCacheDir, \"update.apk\")\n\n    if(!file.exists()){\n        file.createNewFile()\n    }\n\n    file.writeBytes(it.toByteArray())\n\n    val intent = Intent(Intent.ACTION_VIEW)\n    intent.setDataAndType(Uri.fromFile(file), \"application/vnd.android.package-archive\")\n    intent.flags = Intent.FLAG_ACTIVITY_NEW_TASK\n\n    Log.d(LOG_TAG, \"Installing\")\n\n    startActivity(intent)\n}\n</code></pre>\n\n<p>}</p>\n\n<p>When launching the installing activity, I will get a parse error from android. </p>\n\n<p><a href=\"https://i.stack.imgur.com/4D13f.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/4D13f.png\" alt=\"can&#39;t parse\"></a></p>\n\n<p>How can I download and save the file as an usable APK with volley?</p>\n"}, {"tags": ["kotlin"], "comments": [{"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "edited": false, "score": 1, "creation_date": 1474364719, "post_id": 39588793, "comment_id": 66490454, "body": "Places that might be good starting points for reading:  <a href=\"https://discuss.kotlinlang.org/c/javascript\" rel=\"nofollow noreferrer\">discuss.kotlinlang.org/c/javascript</a>, Kotlin Slack #javascript channel, and this other SO question <a href=\"http://stackoverflow.com/questions/36250680/writing-javascript-applications-with-kotlin\" title=\"writing javascript applications with kotlin\">stackoverflow.com/questions/36250680/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2015, "user_id": 1109309, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f8a2b866ae0dc92a9e774d0094da8f4d?s=128&d=identicon&r=PG", "display_name": "Alexey Andreev", "link": "https://stackoverflow.com/users/1109309/alexey-andreev"}, "is_accepted": true, "score": 7, "last_activity_date": 1474371626, "creation_date": 1474371626, "answer_id": 39593109, "question_id": 39588793, "link": "https://stackoverflow.com/questions/39588793/use-javascript-libraries-in-kotlin/39593109#39593109", "title": "Use Javascript libraries in Kotlin", "body": "<p>There's no <code>native</code> keyword anymore, there's <code>@native</code> annotation. Currently, it's working solution and you can use it with 1.0.x branch of Kotlin compiler. However, we are going do deprecate this annotation in favour of <code>extern</code> annotations, so be prepared to rewrite your code eventually for 1.1.x branch.</p>\n\n<p>When you put <code>@native</code> annotation on a class or on a top-level function, two things happen:</p>\n\n<ol>\n<li>Its body is not compiled to JavaScript.</li>\n<li>Compiler references this class or function directly, without package name and mangling.</li>\n</ol>\n\n<p>I think it's easier to explain by providing example of a JavaScript library:</p>\n\n<pre><code>function A(x) {\n    this.x = x;\n    this.y = 0;\n}\nA.prototype.foo = function(z) {\n    return this.x + this.y + z;\n}\n\nfunction min(a, b) {\n    return a &lt; b ? a : b;\n}\n</code></pre>\n\n<p>and a corresponding Kotlin declaration</p>\n\n<pre><code>@native class A(val x: Int) {\n    var y: Int = noImpl\n\n    fun foo(z: Int): Int = noImpl\n}\n\n@native fun min(a: Int, b: Int): Int = noImpl\n</code></pre>\n\n<p>Note that <code>noImpl</code> is a special placeholder that's required because of non-abstract functions required bodies and non-abstract properties require initializers. BTW, when we replace <code>@native</code> with <code>extern</code>, we'll get rid of this <code>noImpl</code>.</p>\n\n<p>Another aspect of interoperation with JS libraries is including libraries via module system. Sorry, we don't have any solution right now (but are going to release it soon). See <a href=\"https://github.com/Kotlin/KEEP/blob/a52e37e274489eb563b0ab7e482b7ab249dad0d3/proposals/js/consume-js-modules.md\">proposal</a>. You can use the following workaround for node.js/CommonJS:</p>\n\n<pre><code>@native interface ExternalModule {\n    fun foo(x: Int)\n}\n\n@native fun require(name: String): dynamic = noImpl\n\nfun main(args: Array&lt;String&gt;) {\n   val module: ExternalModule = require(\"externalModule\")\n   module.foo(123)\n}\n</code></pre>\n\n<p>where external module is declared like this</p>\n\n<pre><code>function foo(x) {\n    return x + 1;\n}\nmodule.exports = { foo : foo };\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2133, "user_id": 1480587, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/QGpb2.jpg?s=128&g=1", "display_name": "Peter T.", "link": "https://stackoverflow.com/users/1480587/peter-t"}, "is_accepted": false, "score": 0, "last_activity_date": 1490361435, "creation_date": 1490361435, "answer_id": 43000527, "question_id": 39588793, "link": "https://stackoverflow.com/questions/39588793/use-javascript-libraries-in-kotlin/43000527#43000527", "title": "Use Javascript libraries in Kotlin", "body": "<p>Kotlin 1.1 introduces the <code>external</code>modifier that can be used to declare functions and classes written directly in JS, see <a href=\"http://kotlinlang.org/docs/reference/js-interop.html\" rel=\"nofollow noreferrer\">http://kotlinlang.org/docs/reference/js-interop.html</a></p>\n"}, {"tags": [], "owner": {"reputation": 869, "user_id": 535761, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c77b1c62b2a5f3db01e050e59fd5280?s=128&d=identicon&r=PG", "display_name": "Boon", "link": "https://stackoverflow.com/users/535761/boon"}, "is_accepted": false, "score": 2, "last_activity_date": 1496924125, "last_edit_date": 1496924125, "creation_date": 1496889435, "answer_id": 44425753, "question_id": 39588793, "link": "https://stackoverflow.com/questions/39588793/use-javascript-libraries-in-kotlin/44425753#44425753", "title": "Use Javascript libraries in Kotlin", "body": "<p>I added a simple barebone project as an example of how to do Kotlin2Js.</p>\n\n<p><a href=\"https://bitbucket.org/mantis78/gradle4kotlin2js/src\" rel=\"nofollow noreferrer\">https://bitbucket.org/mantis78/gradle4kotlin2js/src</a></p>\n\n<p>Here is the gradle file that is the main recipe.</p>\n\n<pre><code>group 'org.boonhighendtech'\nversion '1.0-SNAPSHOT'\n\nbuildscript {\n    ext.kotlin_version = '1.1.2-5'\n    repositories {\n        maven { url 'http://dl.bintray.com/kotlin/kotlin-dev/' }\n        mavenCentral()\n    }\n    dependencies {\n        classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version\"\n    }\n}\n\napply plugin: 'kotlin2js'\n\nrepositories {\n    maven { url 'http://dl.bintray.com/kotlin/kotlin-dev/' }\n    mavenCentral()\n}\n\ndependencies {\n    compile \"org.jetbrains.kotlin:kotlin-stdlib-js:$kotlin_version\"\n}\n\nbuild {\n    outputs.dir(\"web/\")\n}\n\nbuild.doLast {\n    copy {\n        from 'src/main/webapp'\n        into 'web/'\n        include '**/*.html'\n        include '**/*.js'\n        include '**/*.jpg'\n        include '**/*.png'\n    }\n\n    configurations.compile.each { File file -&gt;\n        copy {\n            includeEmptyDirs = false\n\n            from zipTree(file.absolutePath)\n            into \"${projectDir}/web\"\n            include { fileTreeElement -&gt;\n                def path = fileTreeElement.path\n                path.endsWith(\".js\") &amp;&amp; (path.startsWith(\"META-INF/resources/\") || !path.startsWith(\"META-INF/\"))\n            }\n        }\n    }\n}\n\nclean.doLast {\n    file(new File(projectDir, \"/web\")).deleteDir()\n}\n\ncompileKotlin2Js {\n    kotlinOptions.outputFile = \"${projectDir}/web/output.js\"\n    kotlinOptions.moduleKind = \"amd\"\n    kotlinOptions.sourceMap = true\n}\n</code></pre>\n\n<p>Firstly, you can assign a dynamic variable then essentially code it like you code JavaScript, dynamically.</p>\n\n<p>e.g.</p>\n\n<pre><code>val jQuery: dynamic = passedInJQueryRef\njQuery.whateverFunc()\n</code></pre>\n\n<p>But if your intention is to have it typed, then you need to introduce types to the external library. One way is to make use of the relatively extensive libraries of typedefs by <a href=\"https://github.com/DefinitelyTyped/DefinitelyTyped\" rel=\"nofollow noreferrer\">https://github.com/DefinitelyTyped/DefinitelyTyped</a></p>\n\n<p>Find the ts.d there, then run ts2kt (<a href=\"https://github.com/Kotlin/ts2kt\" rel=\"nofollow noreferrer\">https://github.com/Kotlin/ts2kt</a>) to get your Kotlin files. That typically gets you there. Occasionally, certain conversions are not well done. You will have to hand fix the conversion. E.g. snapsvg's snapsvg.attr() call takes in \"{}\" but it got converted to some strange interface.</p>\n\n<p>It was</p>\n\n<pre><code>fun attr(params: `ts$2`): Snap.Element\n</code></pre>\n\n<p>And I replaced it with</p>\n\n<pre><code> fun attr(params: Json): Snap.Element\n</code></pre>\n\n<p>and it works like a charm.</p>\n"}], "owner": {"reputation": 660, "user_id": 3924873, "user_type": "registered", "accept_rate": 78, "profile_image": "https://graph.facebook.com/1805002242/picture?type=large", "display_name": "Francis Fredrick Valero", "link": "https://stackoverflow.com/users/3924873/francis-fredrick-valero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3886, "favorite_count": 0, "accepted_answer_id": 39593109, "answer_count": 3, "score": 8, "last_activity_date": 1496924125, "creation_date": 1474358762, "last_edit_date": 1474454677, "question_id": 39588793, "link": "https://stackoverflow.com/questions/39588793/use-javascript-libraries-in-kotlin", "title": "Use Javascript libraries in Kotlin", "body": "<p>The last time I used Kotlin was Dec 2015 when I used it to <a href=\"https://github.com/francisvalero/euler-in-kotlin\" rel=\"noreferrer\">solve a couple of Project Euler problems.</a></p>\n\n<p>This time I want to try its interoperability with Javascript. Now my question is, how do we import/use existing Javascript libraries in Kotlin? \nI've seen some people using the <code>native</code> keyword, and I just want a brief explanation of it.</p>\n"}, {"tags": ["java", "lambda", "kotlin"], "answers": [{"tags": [], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "is_accepted": true, "score": 3, "last_activity_date": 1474336995, "creation_date": 1474336995, "answer_id": 39584625, "question_id": 39583976, "link": "https://stackoverflow.com/questions/39583976/kotin-how-to-specify-return-label-when-enclosed-in-lambda/39584625#39584625", "title": "Kotin How to Specify Return Label When Enclosed in Lambda", "body": "<p>If you want to return from the inner lambda you can by using <a href=\"https://kotlinlang.org/docs/reference/returns.html#return-at-labels\" rel=\"nofollow\">return at label</a>:</p>\n\n<pre><code> Emptylambda outer@ {\n     container[String(), Any(), Any()] inner@ {  // &lt;--- add label here\n        val myCondition = true\n        if (myCondition) return@inner            // &lt;--- exits from lambda \n\n        print(it)\n    }\n}\n</code></pre>\n\n<p>But you cannot return all the way to label <code>outer</code>.</p>\n"}], "owner": {"reputation": 2108, "user_id": 1377037, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/b5941b2951d33748024848f82e7bf784?s=128&d=identicon&r=PG", "display_name": "Jonathan Beaudoin", "link": "https://stackoverflow.com/users/1377037/jonathan-beaudoin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 1, "accepted_answer_id": 39584625, "answer_count": 1, "score": 3, "last_activity_date": 1474342039, "creation_date": 1474331328, "last_edit_date": 1474342039, "question_id": 39583976, "link": "https://stackoverflow.com/questions/39583976/kotin-how-to-specify-return-label-when-enclosed-in-lambda", "title": "Kotin How to Specify Return Label When Enclosed in Lambda", "body": "<p>Ran into an issue when making a EntityContainer for a game (a container of Lists on NPCs, Players, Objects etc). When overriding the invoke operator and in the case where my code is wrapped inside of a parent lambda, I have no way to add a <code>return</code> statement.</p>\n\n<pre><code>import java.util.*\n\nfun main(args: Array&lt;String&gt;) {\n    val container = Container&lt;String&gt;()\n    container.addList(listOf(\"h\", \"e\", \"l\", \"l\", \"o\"))\n    container.addList(listOf(\" \"))\n    container.addList(listOf(\"w\", \"o\", \"r\", \"l\", \"d\", \"!\"))\n\n    Emptylambda {\n        container[String(), Any(), Any()].forEach {\n            val myCondition = true\n            if (myCondition) return@forEach\n\n            print(it)\n        }\n    }\n\n    println(\"\\n\\n\")\n\n    Emptylambda {\n        container[String(), Any(), Any()] {\n            val myCondition = true\n            if (myCondition) return //Does not compile\n\n            print(it)\n        }\n    }\n\n}\n\n\nclass Container&lt;E&gt; {\n\n    private val lists = ArrayList&lt;List&lt;E&gt;&gt;(10)\n\n    fun addList(list: List&lt;E&gt;) = lists.add(list)\n\n    fun forEach(action: (E) -&gt; Unit): Unit {\n        lists.forEach {\n            it.forEach {\n                action(it)\n            }\n        }\n    }\n\n    operator fun invoke(action: (E) -&gt; Unit) = this.forEach { action(it) }\n\n    operator fun get(vararg ignored: Any): Container&lt;E&gt; { return this }\n}\n\nobject Emptylambda {\n    operator fun invoke(action: () -&gt; Unit) {\n        action()\n    }\n}\n</code></pre>\n\n<p>Here is the error:</p>\n\n<pre><code>Error:(43, 21) Kotlin: 'return' is not allowed here\n</code></pre>\n\n<p>This is a small sample of something I wrote to easily reproduce the issue. A realworld example would be as follows.</p>\n\n<pre><code>GameScreen { \n     entities[EntityType.PLAYER, EntityType.NPC] {\n           val entity = it\n           if (!entity.isReady()) return //Cant use return here\n           //Draw onto screen\n     }\n}\n</code></pre>\n"}, {"tags": ["null", "kotlin"], "answers": [{"tags": [], "owner": {"reputation": 24586, "user_id": 3255152, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fbd95ef81d0a85310fee8dd46e0f65b0?s=128&d=identicon&r=PG&f=1", "display_name": "mfulton26", "link": "https://stackoverflow.com/users/3255152/mfulton26"}, "is_accepted": true, "score": 8, "last_activity_date": 1474337475, "creation_date": 1474337475, "answer_id": 39584698, "question_id": 39583928, "link": "https://stackoverflow.com/questions/39583928/kotlin-set-to-null-if-not-null/39584698#39584698", "title": "Kotlin Set to Null If Not Null", "body": "<p>You can use the <a href=\"https://kotlinlang.org/docs/reference/idioms.html#execute-if-not-null\" rel=\"noreferrer\">execute if not null idiom</a>:</p>\n\n<pre><code>test?.let { test = null }\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 24586, "user_id": 3255152, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fbd95ef81d0a85310fee8dd46e0f65b0?s=128&d=identicon&r=PG&f=1", "display_name": "mfulton26", "link": "https://stackoverflow.com/users/3255152/mfulton26"}, "edited": false, "score": 1, "creation_date": 1474373370, "post_id": 39585713, "comment_id": 66496120, "body": "1) I suggest adding this as a comment to the question instead of as an answer as this doesn&#39;t actually answer the question. 2) If it is null - something does happen: an assignment. For simple properties setting it to <code>null</code> is not a problem but for properties with a backing property, etc. I can see why one might want to only set it to <code>null</code> if it isn&#39;t already <code>null</code>."}, {"owner": {"reputation": 11834, "user_id": 1538877, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/N9qfZ.jpg?s=128&g=1", "display_name": "Ruslan", "link": "https://stackoverflow.com/users/1538877/ruslan"}, "reply_to_user": {"reputation": 24586, "user_id": 3255152, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fbd95ef81d0a85310fee8dd46e0f65b0?s=128&d=identicon&r=PG&f=1", "display_name": "mfulton26", "link": "https://stackoverflow.com/users/3255152/mfulton26"}, "edited": false, "score": 0, "creation_date": 1474448035, "post_id": 39585713, "comment_id": 66530870, "body": "But we have concrete case - defined variable, not property."}, {"owner": {"reputation": 24586, "user_id": 3255152, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fbd95ef81d0a85310fee8dd46e0f65b0?s=128&d=identicon&r=PG&f=1", "display_name": "mfulton26", "link": "https://stackoverflow.com/users/3255152/mfulton26"}, "edited": false, "score": 0, "creation_date": 1474459231, "post_id": 39585713, "comment_id": 66538460, "body": "True. Perhaps you could clarify that if it is <code>null</code>, an assignment does happen but it just sets the variable to the same value: <code>null</code>."}, {"owner": {"reputation": 6636, "user_id": 691639, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/e237f683765ca5ad65c9060cf73a0991?s=128&d=identicon&r=PG", "display_name": "Eliezer", "link": "https://stackoverflow.com/users/691639/eliezer"}, "edited": false, "score": 1, "creation_date": 1474570190, "post_id": 39585713, "comment_id": 66596717, "body": "I know this is the better way to do it, but I was asking specifically about Kotlin idioms."}], "tags": [], "owner": {"reputation": 11834, "user_id": 1538877, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/N9qfZ.jpg?s=128&g=1", "display_name": "Ruslan", "link": "https://stackoverflow.com/users/1538877/ruslan"}, "is_accepted": false, "score": 4, "last_activity_date": 1474460872, "last_edit_date": 1474460872, "creation_date": 1474345844, "answer_id": 39585713, "question_id": 39583928, "link": "https://stackoverflow.com/questions/39583928/kotlin-set-to-null-if-not-null/39585713#39585713", "title": "Kotlin Set to Null If Not Null", "body": "<p>Just assign null to local variable:</p>\n\n<pre><code>test = null\n</code></pre>\n\n<p>In case if it's not null - you assign null to this variable.\nIn case if variable is null - you just assign null to it, so nothing changed.</p>\n"}, {"tags": [], "owner": {"reputation": 6636, "user_id": 691639, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/e237f683765ca5ad65c9060cf73a0991?s=128&d=identicon&r=PG", "display_name": "Eliezer", "link": "https://stackoverflow.com/users/691639/eliezer"}, "is_accepted": false, "score": 1, "last_activity_date": 1497285764, "creation_date": 1497285764, "answer_id": 44504593, "question_id": 39583928, "link": "https://stackoverflow.com/questions/39583928/kotlin-set-to-null-if-not-null/44504593#44504593", "title": "Kotlin Set to Null If Not Null", "body": "<p>I came up with this extensions which makes this simpler:</p>\n\n<pre><code>inline fun &lt;T, R&gt; T.letThenNull(block: (T) -&gt; R): T? { block(this); return null }\nval test: Any? = null\n...\ntest = test?.letThenNull { /* do something with test */ }\n</code></pre>\n"}], "owner": {"reputation": 6636, "user_id": 691639, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/e237f683765ca5ad65c9060cf73a0991?s=128&d=identicon&r=PG", "display_name": "Eliezer", "link": "https://stackoverflow.com/users/691639/eliezer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7179, "favorite_count": 0, "accepted_answer_id": 39584698, "answer_count": 3, "score": 6, "last_activity_date": 1497285764, "creation_date": 1474330922, "question_id": 39583928, "link": "https://stackoverflow.com/questions/39583928/kotlin-set-to-null-if-not-null", "title": "Kotlin Set to Null If Not Null", "body": "<p>Is there an idiom in Kotlin for setting a variable to null if it is not already null? Something more semantically pleasing than:</p>\n\n<pre><code>var test: String? = null\nif(test != null) test = null\n</code></pre>\n"}, {"tags": ["java", "kotlin", "apache-commons-io"], "comments": [{"owner": {"reputation": 3574, "user_id": 58530, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/fUC3C.jpg?s=128&g=1", "display_name": "Brian Kent", "link": "https://stackoverflow.com/users/58530/brian-kent"}, "edited": false, "score": 0, "creation_date": 1474320153, "post_id": 39582014, "comment_id": 66474507, "body": "Do you know what the data looks like? How uniform are the line breaks?"}, {"owner": {"reputation": 1242, "user_id": 211560, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/1a36612786c959d96dbc0163bb286991?s=128&d=identicon&r=PG", "display_name": "Arthur", "link": "https://stackoverflow.com/users/211560/arthur"}, "reply_to_user": {"reputation": 3574, "user_id": 58530, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/fUC3C.jpg?s=128&g=1", "display_name": "Brian Kent", "link": "https://stackoverflow.com/users/58530/brian-kent"}, "edited": false, "score": 0, "creation_date": 1474320308, "post_id": 39582014, "comment_id": 66474557, "body": "@BrianKent, I&#39;m not sure what you mean by how uniform the line breaks are but the data in question is an XML file from the OpenStreetMap project."}, {"owner": {"reputation": 24586, "user_id": 3255152, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fbd95ef81d0a85310fee8dd46e0f65b0?s=128&d=identicon&r=PG&f=1", "display_name": "mfulton26", "link": "https://stackoverflow.com/users/3255152/mfulton26"}, "edited": false, "score": 0, "creation_date": 1474329800, "post_id": 39582014, "comment_id": 66477524, "body": "Are you sure you need to process the file in reverse order? I suspect you would be better off reading the lines in their natural order and saving off chunks of data to temporary files and/or a database and then processing the data in this intermediary format which if chunked into smaller files and/or with a database can then easily be processed in reverse order."}, {"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1474330983, "post_id": 39582014, "comment_id": 66477768, "body": "Hang on, how can you read XML back to front?"}, {"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "edited": false, "score": 0, "creation_date": 1474335687, "post_id": 39582014, "comment_id": 66478734, "body": "I wrote a new one reverse file reader that is around 4x slower then reading forward instead of the 17x you encountered.  <a href=\"http://stackoverflow.com/a/39583921/3679676\">stackoverflow.com/a/39583921/3679676</a>"}, {"owner": {"reputation": 1242, "user_id": 211560, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/1a36612786c959d96dbc0163bb286991?s=128&d=identicon&r=PG", "display_name": "Arthur", "link": "https://stackoverflow.com/users/211560/arthur"}, "reply_to_user": {"reputation": 24586, "user_id": 3255152, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fbd95ef81d0a85310fee8dd46e0f65b0?s=128&d=identicon&r=PG&f=1", "display_name": "mfulton26", "link": "https://stackoverflow.com/users/3255152/mfulton26"}, "edited": false, "score": 0, "creation_date": 1474352132, "post_id": 39582014, "comment_id": 66483268, "body": "@mfulton26 - I don&#39;t strictly need to read it in reverse order.  The OSM file is constructed of relations, ways and nodes. I know which relations I want based upon certain criterea.  Each relation has a number of Ways IDs. I can then lookup each Way I&#39;m interested in based on ID, these then contain a list of Nodes. Then I can look up Nodes based upon IDs.  This all works at the moment by parsing three times, but I thought I might be able to read the file in backwards as that might save time."}], "answers": [{"tags": [], "owner": {"reputation": 628808, "user_id": 139985, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/147c5a9cc1feec049c50da791ac7d144?s=128&d=identicon&r=PG", "display_name": "Stephen C", "link": "https://stackoverflow.com/users/139985/stephen-c"}, "is_accepted": false, "score": 3, "last_activity_date": 1474517065, "last_edit_date": 1474517065, "creation_date": 1474325038, "answer_id": 39583170, "question_id": 39582014, "link": "https://stackoverflow.com/questions/39582014/why-is-reversedlinesfilereader-so-slow/39583170#39583170", "title": "Why is ReversedLinesFileReader so slow?", "body": "<p>The correct way to investigate this problem would be:</p>\n\n<ol>\n<li>Write a version of this test in pure Java.</li>\n<li>Benchmark it to make sure that the performance problem is still there.</li>\n<li>Profile it to figure out where the performance bottleneck is.</li>\n</ol>\n\n<hr>\n\n<blockquote>\n  <p>Q: Am I using ReversedLinesFileReader in the correct way?</p>\n</blockquote>\n\n<p>Yes.  (Assuming that it is an appropriate thing to use a line reader at all.  That depends on what it is you are really trying to do.  For instance, if you just wanted to count lines backwards, then you should be reading 1 character at a time and counting the newline sequences.)</p>\n\n<blockquote>\n  <p>Q: I am running Linux Mint with an Ext4 file system on an SSD. Could this have anything to do with it?</p>\n</blockquote>\n\n<p>Possibly.  Reading a file in reverse means that the read-ahead strategies used by the OS to give fast I/O may not work.  It could be interacting with the characteristics of an SSD.</p>\n\n<blockquote>\n  <p>Q: Is it just the case that files should not be read from the end to the start?</p>\n</blockquote>\n\n<p>Possibly.  See above.</p>\n\n<hr>\n\n<p>The other thing that you have not considered is that your file could actually contain some extremely long lines.  The bottleneck <em>could</em> be the assembly of the characters into (long) lines.  </p>\n\n<p>Looking at the <a href=\"https://commons.apache.org/proper/commons-io/javadocs/api-2.5/src-html/org/apache/commons/io/input/ReversedLinesFileReader.html\" rel=\"nofollow\">source code</a>, it would seem that there is potential for <code>O(N^2)</code> behavior when lines are very long.  The critical part is (I think) in the way that \"rollover\" is handled by <code>FilePart</code>.  Note the way that the \"left over\" data gets copied. </p>\n"}, {"comments": [{"owner": {"reputation": 239210, "user_id": 2711488, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FhkI9.jpg?s=128&g=1", "display_name": "Holger", "link": "https://stackoverflow.com/users/2711488/holger"}, "edited": false, "score": 0, "creation_date": 1562767189, "post_id": 39583921, "comment_id": 100481036, "body": "It is impossible for UTF-8 multi-byte sequences to look like a new line. UTF-8 was specifically designed to have no representation of non-ASCII characters that look like ASCII bytes. The <code>ReversedLinesFileReader</code> is exploiting that property. So there\u2019s no bug."}], "tags": [], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "is_accepted": true, "score": 2, "last_activity_date": 1474336423, "last_edit_date": 1474336423, "creation_date": 1474330869, "answer_id": 39583921, "question_id": 39582014, "link": "https://stackoverflow.com/questions/39582014/why-is-reversedlinesfilereader-so-slow/39583921#39583921", "title": "Why is ReversedLinesFileReader so slow?", "body": "<p>You are asking for a very expensive operation.  Not only are you using random access in blocks to read the file and going backwards (so if the file system is reading ahead, it is reading the wrong direction), you are also reading an XML file which is UTF-8 and the encoding is slower than a fixed byte encoding.</p>\n\n<p>Then on top of that you are using a less than efficient algorithm.  It reads a block at a time of inconvenient size  (is it disk block size aware? are you setting the block size to match your file system?) backwards while processing encoding and makes (unnecessary?) copy of the partial byte array and then turns it into a string (do you need a string to parse?).  It could create the string without the copy and really creating the string probably could be deferred and you work directly from the buffer only decoding if you need to (XML parsers for example also work from ByteArrays or buffers).  And there are other array copies that just are not needed but it is more convenient for the code.</p>\n\n<p>It also  might have a bug in that it checks for newlines without considering that the character might mean something different if actually is part of a multi-byte sequence.  It would have to look back a few extra characters to check this for variable length encodings, I don't see it doing that.</p>\n\n<p>So instead of a nice forward only heavily buffered sequential read of a file which is the fastest thing you can do on your filesystem, you are doing random reads of 1 block at a time.  It should at least read multiple disk blocks so that it can use the forward momentum (set blocksize to some multiple of your disk block size will help) and also avoid the number of \"left over\" copies made at buffer boundaries.</p>\n\n<p>There are probably faster approaches.  But it'll not be as fast as reading a file in forward order.</p>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>Ok, so I tried an experiment with a rather silly version that processes around 27G of data by reading the first 10 million lines from wikidata JSON dump and reversing those lines.</p>\n\n<p>Timings on my 2015 Mac Book Pro (with all my dev stuff and many chrome windows open eating memory and some CPU all the time, about 5G of total memory is free, VM size is default with no parameters set at all, not run under debugger):</p>\n\n<pre><code>reading in reverse order: 244,648 ms = 244 secs = 4 min 4 secs\nreading in forward order:  77,564 ms =  77 secs = 1 min 17 secs\n\ntemp file count:   201\napprox char count: 29,483,478,770 (line content not including line endings)\ntotal line count:  10,050,000\n</code></pre>\n\n<p>The algorithm is to read the original file by lines buffering 50000 lines at a time, writing the lines in reverse order to a numbered temp file.  Then after all files are written, they are read in reverse numerical order forward by lines.  Basically dividing them into reverse sort order fragments of the original.  It could be optimized because this is the most naive version of that algorithm with no tuning.  But it does do what file systems do best, sequential reads and sequential writes with good sized buffers.  </p>\n\n<p>So this is a lot faster than the one you were using and it could be tuned from here to be more efficient.  You could trade CPU for disk I/O size and try using gzipped files as well, maybe a two threaded model to have the next buffer gzipping while processing the previous.  Less string allocations, checking each file function to make sure nothing extra is going on, make sure no double buffering, and more.   </p>\n\n<p>The ugly but functional code is:</p>\n\n\n\n<pre><code>package com.stackoverflow.reversefile\n\nimport java.io.File\nimport java.util.*\n\nfun main(args: Array&lt;String&gt;) {\n    val maxBufferSize = 50000\n    val lineBuffer = ArrayList&lt;String&gt;(maxBufferSize)\n    val tempFiles = ArrayList&lt;File&gt;()\n    val originalFile = File(\"/data/wikidata/20150629.json\")\n    val tempFilePrefix = \"/data/wikidata/temp/temp\"\n    val maxLines = 10000000\n\n    var approxCharCount: Long = 0\n    var tempFileCount = 0\n    var lineCount = 0\n\n    val startTime = System.currentTimeMillis()\n\n    println(\"Writing reversed partial files...\")\n\n    try {\n        fun flush() {\n            val bufferSize = lineBuffer.size\n            if (bufferSize &gt; 0) {\n                lineCount += bufferSize\n                tempFileCount++\n                File(\"$tempFilePrefix-$tempFileCount\").apply {\n                    bufferedWriter().use { writer -&gt;\n                        ((bufferSize - 1) downTo 0).forEach { idx -&gt;\n                            writer.write(lineBuffer[idx])\n                            writer.newLine()\n                        }\n                    }\n                    tempFiles.add(this)\n                }\n                lineBuffer.clear()\n            }\n\n            println(\"  flushed at $lineCount lines\")\n        }\n\n        // read and break into backword sorted chunks\n        originalFile.bufferedReader(bufferSize = 4096 * 32)\n                .lineSequence()\n                .takeWhile { lineCount &lt;= maxLines }.forEach { line -&gt;\n                    lineBuffer.add(line)\n                    if (lineBuffer.size &gt;= maxBufferSize) flush()\n                }\n        flush()\n\n        // read backword sorted chunks backwards\n        println(\"Reading reversed lines ...\")\n        tempFiles.reversed().forEach { tempFile -&gt;\n            tempFile.bufferedReader(bufferSize = 4096 * 32).lineSequence()\n                .forEach { line -&gt;\n                    approxCharCount += line.length\n                    // a line has been read here\n                }\n            println(\"  file $tempFile current char total $approxCharCount\")\n        }\n    } finally {\n        tempFiles.forEach { it.delete() }\n    }\n\n    val elapsed =  System.currentTimeMillis() - startTime\n\n    println(\"temp file count:   $tempFileCount\")\n    println(\"approx char count: $approxCharCount\")\n    println(\"total line count:  $lineCount\")\n    println()\n    println(\"Elapsed:  ${elapsed}ms  ${elapsed / 1000}secs  ${elapsed / 1000 / 60}min  \")\n\n    println(\"reading original file again:\")\n    val againStartTime = System.currentTimeMillis()\n    var againLineCount = 0\n    originalFile.bufferedReader(bufferSize = 4096 * 32)\n            .lineSequence()\n            .takeWhile { againLineCount &lt;= maxLines }\n            .forEach { againLineCount++ }\n    val againElapsed =  System.currentTimeMillis() - againStartTime\n    println(\"Elapsed:  ${againElapsed}ms  ${againElapsed / 1000}secs  ${againElapsed / 1000 / 60}min  \")\n}\n</code></pre>\n"}], "owner": {"reputation": 1242, "user_id": 211560, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/1a36612786c959d96dbc0163bb286991?s=128&d=identicon&r=PG", "display_name": "Arthur", "link": "https://stackoverflow.com/users/211560/arthur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3177, "favorite_count": 1, "accepted_answer_id": 39583921, "answer_count": 2, "score": 5, "last_activity_date": 1474517065, "creation_date": 1474318737, "question_id": 39582014, "link": "https://stackoverflow.com/questions/39582014/why-is-reversedlinesfilereader-so-slow", "title": "Why is ReversedLinesFileReader so slow?", "body": "<p>I have a file that is 21.6GB and I want to read it from the end to the start rather than from the beginning to the end as you would usually do.</p>\n\n<p>If I read each line of the file from the start to the end using the following code, then it takes 1 minute, 12 seconds.</p>\n\n<pre><code>val startTime = System.currentTimeMillis()\nFile(\"very-large-file.xml\").forEachLine {\n    val i = 0\n}\nval diff = System.currentTimeMillis() - startTime\nprintln(diff.timeFormat())\n</code></pre>\n\n<p>Now, I have read that to read in a file in reverse then I should use <code>ReversedLinesFileReader</code> from Apache Commons.  I have created the following extension function to do just this:</p>\n\n<pre><code>fun File.forEachLineFromTheEndOfFile(action: (line: String) -&gt; Unit) {\n    val reader = ReversedLinesFileReader(this, Charset.defaultCharset())\n    var line = reader.readLine()\n    while (line != null) {\n        action.invoke(line)\n        line = reader.readLine()\n    }\n\n    reader.close()\n}\n</code></pre>\n\n<p>and then call it in the following way, which is the same as the previous way only with a call to <code>forEachLineFromTheEndOfFile</code> function:</p>\n\n<pre><code>val startTime = System.currentTimeMillis()\nFile(\"very-large-file.xml\").forEachLineFromTheEndOfFile {\n    val i = 0\n}\nval diff = System.currentTimeMillis() - startTime\nprintln(diff.timeFormat())\n</code></pre>\n\n<p>This took <strong>17 minutes and 50 seconds</strong> to run!</p>\n\n<ul>\n<li>Am I using <code>ReversedLinesFileReader</code> in the correct way?</li>\n<li>I am running Linux Mint with an Ext4 file system on an SSD.  Could this have anything to do with it?</li>\n<li>Is it just the case that files should not be read from the end to the start?</li>\n</ul>\n"}, {"tags": ["gradle", "kotlin"], "comments": [{"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "edited": false, "score": 4, "creation_date": 1474297136, "post_id": 39576170, "comment_id": 66462242, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/9355690/how-to-run-compiled-class-file-in-kotlin\">how to run compiled class file in Kotlin?</a>"}, {"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "edited": false, "score": 1, "creation_date": 1474297199, "post_id": 39576170, "comment_id": 66462293, "body": "There is a section on using Gradle application plugin to run a Kotlin app: <a href=\"http://stackoverflow.com/a/26402542/3679676\">stackoverflow.com/a/26402542/3679676</a> ... or did you need it to run as-if it is a task in some other way?  But that answer could also give you the clues you need."}], "answers": [{"comments": [{"owner": {"reputation": 1343, "user_id": 9005383, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-rymLhVRbsIw/AAAAAAAAAAI/AAAAAAAAG20/cTAJhtYO4mY/photo.jpg?sz=128", "display_name": "Tamim Attafi", "link": "https://stackoverflow.com/users/9005383/tamim-attafi"}, "edited": false, "score": 0, "creation_date": 1614170479, "post_id": 39579280, "comment_id": 117302816, "body": "Is there a way to get runtimeClasspath for apps with android application plugin?"}], "tags": [], "owner": {"reputation": 9459, "user_id": 1432980, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/e646027bcc545177a971230c1e23134a?s=128&d=identicon&r=PG", "display_name": "lapots", "link": "https://stackoverflow.com/users/1432980/lapots"}, "is_accepted": true, "score": 16, "last_activity_date": 1474307634, "last_edit_date": 1495535428, "creation_date": 1474307634, "answer_id": 39579280, "question_id": 39576170, "link": "https://stackoverflow.com/questions/39576170/proper-way-to-run-kotlin-application-from-gradle-task/39579280#39579280", "title": "proper way to run kotlin application from gradle task", "body": "<p>Thanks to the link <a href=\"https://stackoverflow.com/questions/9355690/how-to-run-compiled-class-file-in-kotlin/26402542#26402542\">how to run compiled class file in Kotlin?</a> provided by @JaysonMinard\nthat <code>main</code></p>\n\n<pre><code>@file:JvmName(\"Example\")\n\npackage com.lapots.game.journey.ims.example\n\n\nfun main(args: Array&lt;String&gt;) {\n    print(\"executable!\")\n}\n</code></pre>\n\n<p>and that <code>task</code> </p>\n\n<pre><code>task runExample(type: JavaExec) {\n    main = 'com.lapots.game.journey.ims.example.Example'\n    classpath = sourceSets.main.runtimeClasspath\n}\n</code></pre>\n\n<p>did the trick</p>\n"}, {"comments": [{"owner": {"reputation": 563, "user_id": 3676968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/8n1A5.png?s=128&g=1", "display_name": "Michel", "link": "https://stackoverflow.com/users/3676968/michel"}, "edited": false, "score": 2, "creation_date": 1575629051, "post_id": 48904926, "comment_id": 104639626, "body": "For someone having the same stupid problem as me: it should be <code>apply plugin: &quot;application&quot;</code> (note the <code>:</code> here!)"}, {"owner": {"reputation": 425, "user_id": 12627634, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89606d4c6653ad9094d1cbf6db5c373d?s=128&d=identicon&r=PG&f=1", "display_name": "Nailuj29", "link": "https://stackoverflow.com/users/12627634/nailuj29"}, "edited": false, "score": 0, "creation_date": 1610557367, "post_id": 48904926, "comment_id": 116173813, "body": "it appears the colon is not in the answer."}], "tags": [], "owner": {"reputation": 6413, "user_id": 1099045, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/88d35eb0f5a0f6297ed005cc4021a6f8?s=128&d=identicon&r=PG", "display_name": "Subash", "link": "https://stackoverflow.com/users/1099045/subash"}, "is_accepted": false, "score": 13, "last_activity_date": 1525234418, "last_edit_date": 1525234418, "creation_date": 1519213025, "answer_id": 48904926, "question_id": 39576170, "link": "https://stackoverflow.com/questions/39576170/proper-way-to-run-kotlin-application-from-gradle-task/48904926#48904926", "title": "proper way to run kotlin application from gradle task", "body": "<p>You can also use <code>gradle</code> application plugin for this.</p>\n\n<pre><code>// example.kt\npackage com.lapots.game.journey.ims.example\n\nfun main(args: Array&lt;String&gt;) {\n    print(\"executable!\")\n}\n</code></pre>\n\n<p>add this to your <code>build.gradle</code></p>\n\n<pre><code>// build.gradle\napply plugin \"application\"\nmainClassName = 'com.lapots.game.journey.ims.example.ExampleKt'\n</code></pre>\n\n<p>Then run your application as follows.</p>\n\n<pre><code>./gradlew run\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7683, "user_id": 590437, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/oehge.jpg?s=128&g=1", "display_name": "Holger Brandl", "link": "https://stackoverflow.com/users/590437/holger-brandl"}, "is_accepted": false, "score": 13, "last_activity_date": 1535376074, "last_edit_date": 1535376074, "creation_date": 1524752009, "answer_id": 50045271, "question_id": 39576170, "link": "https://stackoverflow.com/questions/39576170/proper-way-to-run-kotlin-application-from-gradle-task/50045271#50045271", "title": "proper way to run kotlin application from gradle task", "body": "<p>In case you're using a Kotlin buildfile <code>build.gradle.kts</code> you would need to do</p>\n\n<pre><code>apply {\n    plugin(\"kotlin\")\n    plugin(\"application\")\n}    \n\nconfigure&lt;ApplicationPluginConvention&gt; {\n    mainClassName = \"my.cool.App\"\n}\n</code></pre>\n\n<p>If you apply the <code>application</code> plugin using the <code>plugins {}</code> block instead you could make it simpler:</p>\n\n<pre><code>plugins {\n    application\n}\n\napplication {\n    mainClassName = \"my.cool.App\"\n}\n</code></pre>\n\n<p>For details see <a href=\"https://github.com/gradle/kotlin-dsl/blob/master/doc/getting-started/Configuring-Plugins.md\" rel=\"noreferrer\">https://github.com/gradle/kotlin-dsl/blob/master/doc/getting-started/Configuring-Plugins.md</a></p>\n"}, {"comments": [{"owner": {"reputation": 437, "user_id": 3081328, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DcC2w.jpg?s=128&g=1", "display_name": "Hunter_71", "link": "https://stackoverflow.com/users/3081328/hunter-71"}, "edited": false, "score": 0, "creation_date": 1588626783, "post_id": 61435192, "comment_id": 108966906, "body": "Thank you for that post, really helpful :) Configuration is nice and clean :)"}], "tags": [], "owner": {"reputation": 51, "user_id": 7600756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af3b6f406afcac5380e66c229b08a1e6?s=128&d=identicon&r=PG", "display_name": "Jerv Norsk", "link": "https://stackoverflow.com/users/7600756/jerv-norsk"}, "is_accepted": false, "score": 5, "last_activity_date": 1587868911, "creation_date": 1587868911, "answer_id": 61435192, "question_id": 39576170, "link": "https://stackoverflow.com/questions/39576170/proper-way-to-run-kotlin-application-from-gradle-task/61435192#61435192", "title": "proper way to run kotlin application from gradle task", "body": "<p>I found another way from the @lapots answer.</p>\n\n<p>In your <code>example.kt</code>:</p>\n\n<pre class=\"lang-kotlin prettyprint-override\"><code>@file:JvmName(\"Example\")\n\npackage your.organization.example\n\nfun main(string: Array&lt;String&gt;) {\n    println(\"Yay! I'm running!\")\n}\n</code></pre>\n\n<p>Then in your <code>build.gradle.kts</code>:</p>\n\n<pre class=\"lang-kotlin prettyprint-override\"><code>plugins {\n    kotlin(\"jvm\") version \"1.3.72\"\n    application\n}\n\napplication {\n    mainClassName = \"your.organization.example.Example\"\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2750, "user_id": 8308081, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-pReTF2MKrbE/AAAAAAAAAAI/AAAAAAAAADI/-BW8Tt3EURc/photo.jpg?sz=128", "display_name": "Lukas Kirner", "link": "https://stackoverflow.com/users/8308081/lukas-kirner"}, "is_accepted": false, "score": 3, "last_activity_date": 1591801988, "creation_date": 1591801988, "answer_id": 62307009, "question_id": 39576170, "link": "https://stackoverflow.com/questions/39576170/proper-way-to-run-kotlin-application-from-gradle-task/62307009#62307009", "title": "proper way to run kotlin application from gradle task", "body": "<p>For <code>build.gradle.kts</code> users</p>\n\n<p>main file:</p>\n\n<pre><code>package com.foo.game.journey.ims.example\n\n\nfun main(args: Array&lt;String&gt;) {\n    println(\"Hello, world!\")\n}\n</code></pre>\n\n<p>build.gradle.kts file:</p>\n\n<pre><code>plugins {\n    application\n    kotlin(\"jvm\") version \"1.3.72\" // &lt;-- your kotlin version here\n}\n\napplication {\n    mainClassName = \"com.lapots.game.journey.ims.example.ExampleKt\"\n}\n\n...\n</code></pre>\n\n<p>And run with the following command:</p>\n\n<pre><code>./gradlew run\n</code></pre>\n"}], "owner": {"reputation": 9459, "user_id": 1432980, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/e646027bcc545177a971230c1e23134a?s=128&d=identicon&r=PG", "display_name": "lapots", "link": "https://stackoverflow.com/users/1432980/lapots"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13602, "favorite_count": 2, "accepted_answer_id": 39579280, "answer_count": 5, "score": 25, "last_activity_date": 1591801988, "creation_date": 1474296806, "question_id": 39576170, "link": "https://stackoverflow.com/questions/39576170/proper-way-to-run-kotlin-application-from-gradle-task", "title": "proper way to run kotlin application from gradle task", "body": "<p>I've got simple script</p>\n\n<pre><code>package com.lapots.game.journey.ims.example\n\n\nfun main(args: Array&lt;String&gt;) {\n    println(\"Hello, world!\")\n}\n</code></pre>\n\n<p>And here is <code>gradle</code> task </p>\n\n<pre><code>task runExample(type: JavaExec) {\n    main ='com.lapots.game.journey.ims.example.Example'\n    classpath = sourceSets.main.runtimeClasspath\n}\n</code></pre>\n\n<p>But when I try to run task <code>gradle runExample</code> I get error</p>\n\n<p><code>Error: Could not find or load main class com.lapots.game.journey.ims.example.Example</code></p>\n\n<p>What is the proper way to run application?</p>\n"}, {"tags": ["java", "xml", "spring", "classloader", "kotlin"], "comments": [{"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1474296389, "post_id": 39575901, "comment_id": 66461768, "body": "<code>context:component-scan</code> use MAGIC that is not compatible with <code>URLClassLoader</code>. No luck."}, {"owner": {"reputation": 152, "user_id": 774091, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/40b29796ca1d084dac2ba009abe6324b?s=128&d=identicon&r=PG", "display_name": "Majid Asgari-Bidhendi", "link": "https://stackoverflow.com/users/774091/majid-asgari-bidhendi"}, "reply_to_user": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1474303674, "post_id": 39575901, "comment_id": 66466272, "body": "@talex but I have used ClassPathXmlApplicationContext with exactly same xml (with package-scanning and schedule features) in regular spring boot apps or simple spring apps. The only different is adding class loader. How the spring add import to other XMLs in regular apps? It must have a solution."}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 1, "creation_date": 1474303988, "post_id": 39575901, "comment_id": 66466476, "body": "Unfortunately. With MAGIC it happens very often. The rison is that Java have no function to enumerate classes and subpackages in package and <code>component-scan</code> depends on this feature. Current implementation use trick that read <code>jar</code> files as simple <code>zip</code> and get list of classes. But it only work default class loader. In theory it is possible to implemnt this for other ClassLoader, but no one did it yet."}, {"owner": {"reputation": 152, "user_id": 774091, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/40b29796ca1d084dac2ba009abe6324b?s=128&d=identicon&r=PG", "display_name": "Majid Asgari-Bidhendi", "link": "https://stackoverflow.com/users/774091/majid-asgari-bidhendi"}, "reply_to_user": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "edited": false, "score": 0, "creation_date": 1474305324, "post_id": 39575901, "comment_id": 66467206, "body": "@talex thanks for your answer. I fixed it."}], "answers": [{"tags": [], "owner": {"reputation": 152, "user_id": 774091, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/40b29796ca1d084dac2ba009abe6324b?s=128&d=identicon&r=PG", "display_name": "Majid Asgari-Bidhendi", "link": "https://stackoverflow.com/users/774091/majid-asgari-bidhendi"}, "is_accepted": true, "score": 1, "last_activity_date": 1474305250, "creation_date": 1474305250, "answer_id": 39578606, "question_id": 39575901, "link": "https://stackoverflow.com/questions/39575901/load-spring-xml-config-dynamically/39578606#39578606", "title": "Load spring xml config dynamically", "body": "<p>Great answer from @talex guided me. I fixed it by setting the current class loader:</p>\n\n<pre><code>val loader = URLClassLoader(arrayOf(entry.toFile().toURL()), Thread.currentThread().contextClassLoader)\nThread.currentThread().contextClassLoader = loader\n</code></pre>\n"}], "owner": {"reputation": 152, "user_id": 774091, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/40b29796ca1d084dac2ba009abe6324b?s=128&d=identicon&r=PG", "display_name": "Majid Asgari-Bidhendi", "link": "https://stackoverflow.com/users/774091/majid-asgari-bidhendi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1492, "favorite_count": 1, "accepted_answer_id": 39578606, "answer_count": 1, "score": 1, "last_activity_date": 1474307334, "creation_date": 1474296044, "last_edit_date": 1474307334, "question_id": 39575901, "link": "https://stackoverflow.com/questions/39575901/load-spring-xml-config-dynamically", "title": "Load spring xml config dynamically", "body": "<p>At the startup time of a spring app, I want to scan a path on the computer, find the jar files and build a spring application context from an xml config files inside them. Every thing is OK to add jar file to the classpath and making an ApplicationContext. But I can't find any beans from new context. All of needed dependencies are available in the jar files in the specific path on computer (via a maven copier plugin) expect those dependencies which are in the base spring project (for example spring dependency itself).\nThe code is (In Kotlin language):</p>\n\n<pre><code>var loader = URLClassLoader(arrayOf(entry.toFile().toURL()), Thread.currentThread().contextClassLoader)\n...\nval context = ClassPathXmlApplicationContext(\"classpath*:/$name\")//name is xml file. I'm sure the address in classpath is right. context is not creating when the address in wrong. for example: classpath://$name\nval services = context.getBeanNamesForType(IService::class.java)//services is empty\n</code></pre>\n\n<p>I have tried many other ways to load the xml but none of them was successful. for example:</p>\n\n<pre><code>val beans = DefaultListableBeanFactory(applicationContext)\nval reader = XmlBeanDefinitionReader(beans)\nreader.beanClassLoader = loader\nreader.resourceLoader = resourceLoader\nreader.setValidationMode(XmlBeanDefinitionReader.VALIDATION_XSD)\njarFile.getInputStream(jarEntry).use {\n    reader.loadBeanDefinitions(EncodedResource(InputStreamResource(it)))\n}\nbeans.preInstantiateSingletons()\n</code></pre>\n\n<p>the xml inside jar file looks like this:</p>\n\n<pre><code>&lt;beans xmlns=\"http://www.springframework.org/schema/beans\"\n   xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n   xmlns:context=\"http://www.springframework.org/schema/context\"\n   xsi:schemaLocation=\"http://www.springframework.org/schema/context\n      http://www.springframework.org/schema/context/spring-context-3.0.xsd\n      http://www.springframework.org/schema/beans\n      http://www.springframework.org/schema/beans/spring-beans-3.0.xsd\"&gt;\n&lt;import resource=\"classpath*:/xxx-logic-context.xml\"/&gt;\n&lt;context:annotation-config/&gt;\n&lt;context:component-scan base-package=\"aa.bbb.ccc.server\"/&gt;\n&lt;/beans&gt;\n</code></pre>\n\n<p>It's really interesting: When I define regular Beans instead using package scaning feature, I can get the bean in a sort of code</p>\n"}, {"tags": ["android", "base64", "kotlin"], "comments": [{"owner": {"reputation": 24586, "user_id": 3255152, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fbd95ef81d0a85310fee8dd46e0f65b0?s=128&d=identicon&r=PG&f=1", "display_name": "mfulton26", "link": "https://stackoverflow.com/users/3255152/mfulton26"}, "edited": false, "score": 0, "creation_date": 1474291980, "post_id": 39573984, "comment_id": 66458723, "body": "This looks like a compilation bug. e.g. If the compiler is failing because it doesn&#39;t have enough memory allocated then the exception thrown should state such (which it doesn&#39;t). I suggest reporting the issue at <a href=\"https://youtrack.jetbrains.com/issues/KT\" rel=\"nofollow noreferrer\">youtrack.jetbrains.com/issues/KT</a>. You might search online for a way to increase the kotlin compiler&#39;s allocated memory or something like that."}], "answers": [{"comments": [{"owner": {"reputation": 22943, "user_id": 870674, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0463b7a46ed49025082a795ac2f67f49?s=128&d=identicon&r=PG", "display_name": "klimat", "link": "https://stackoverflow.com/users/870674/klimat"}, "edited": false, "score": 1, "creation_date": 1474296294, "post_id": 39575880, "comment_id": 66461697, "body": "the string has less than 0,5MB not 0.5GB ;) I know i can load the content from file... but still it would be nice to have it at compilation time."}, {"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "reply_to_user": {"reputation": 22943, "user_id": 870674, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0463b7a46ed49025082a795ac2f67f49?s=128&d=identicon&r=PG", "display_name": "klimat", "link": "https://stackoverflow.com/users/870674/klimat"}, "edited": false, "score": 0, "creation_date": 1474296466, "post_id": 39575880, "comment_id": 66461823, "body": "@mklimek edited and leaving answer (other people in the future may need this work around, the answer is for the community as well)"}, {"owner": {"reputation": 655, "user_id": 9766649, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40571cd16468b9dce1aff3a76cc29dd7?s=128&d=identicon&r=PG&f=1", "display_name": "user155", "link": "https://stackoverflow.com/users/9766649/user155"}, "edited": false, "score": 0, "creation_date": 1559218487, "post_id": 39575880, "comment_id": 99356527, "body": "There is much better solution. Put files to assets folder (not in the resources) and use <code>assets.open(&quot;jpeg_base64.txt&quot;).bufferedReader().readText()</code>"}], "tags": [], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "is_accepted": false, "score": 4, "last_activity_date": 1474296308, "last_edit_date": 1495540109, "creation_date": 1474295998, "answer_id": 39575880, "question_id": 39573984, "link": "https://stackoverflow.com/questions/39573984/how-long-string-property-can-be-in-kotlin/39575880#39575880", "title": "How long String property can be in Kotlin?", "body": "<p>As mentioned in a comment by @mfulton26 that something is going on with the compiler when loading the string.  A crash bug that should be reported to <a href=\"http://kotl.in/issue\" rel=\"nofollow noreferrer\">Kotlin issue tracker</a>.</p>\n\n<p>As a work-around you can add this as a file in your <code>src/main/resources</code> directory and loading the string dynamically either as a <code>String</code> or as <code>ByteArray</code>.  </p>\n\n<p>For example, if the file was <code>src/main/resources/abstract-colors.txt</code> you could <a href=\"https://stackoverflow.com/questions/39500045/in-kotlin-how-do-i-read-the-entire-contents-of-an-inputstream-into-a-string#39500046\">read the entire file into a string</a>:</p>\n\n\n\n<pre><code>val ABSTRACT_COLORS = javaClass.getResourceAsStream(\"/abstract-colors.txt\")\n                               .bufferedReader().use { it.readText() }\n</code></pre>\n\n<p>If you did not need it to be base64 encoded, you could store the image as binary and read it into an <code>ByteArray</code>.</p>\n\n<pre><code>val ABSTRACT_COLORS = javaClass.getResourceAsStream(\"/abstract-colors.jpg\")\n                               .use { it.readBytes() }\n</code></pre>\n"}], "owner": {"reputation": 22943, "user_id": 870674, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0463b7a46ed49025082a795ac2f67f49?s=128&d=identicon&r=PG", "display_name": "klimat", "link": "https://stackoverflow.com/users/870674/klimat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1204, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1474296308, "creation_date": 1474290371, "last_edit_date": 1495541706, "question_id": 39573984, "link": "https://stackoverflow.com/questions/39573984/how-long-string-property-can-be-in-kotlin", "title": "How long String property can be in Kotlin?", "body": "<p>I created simple <code>Base64Images</code> helper class which contains this body:</p>\n\n<pre><code>companion object{\n  val ABSTRACT_COLORS = \"[image encoded in base64]\"\n}\n</code></pre>\n\n<p><code>ABSTRACT_COLORS</code> is actually a string which has 570438 characters.<br/></p>\n\n<p>During compilation I got:</p>\n\n<pre><code>org.jetbrains.kotlin.codegen.CompilationException: Back-end (JVM) Internal error: Failed to generate property ABSTRACT_COLORS\n...\n...\nThe root cause was thrown at: ByteVector.java:213 at org.jetbrains.kotlin.codegen.MemberCodegen.genFunctionOrProperty(MemberCodegen.java:205)\nCaused by: java.lang.IllegalArgumentException\n</code></pre>\n\n<p>I thought I can store <a href=\"https://stackoverflow.com/questions/1179983/how-many-characters-can-a-java-string-have\">2147483647 (2<sup>31</sup> - 1)</a> characters in a string.</p>\n\n<p>Why is that?</p>\n\n<p>I posted this image below. <br/>\nYou can use <a href=\"https://www.base64-image.de/\" rel=\"nofollow noreferrer\">this tool</a> to generate base64.</p>\n\n<p>Hint: editing this class or compiling the project freezes Android Studio.<br/>\nI'd use some lightweight editor to edit and terminal to compile it. </p>\n\n<p><a href=\"https://i.stack.imgur.com/Htg5k.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Htg5k.jpg\" alt=\"enter image description here\"></a> </p>\n"}, {"tags": ["kotlin"], "answers": [{"tags": [], "owner": {"reputation": 2572, "user_id": 182393, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/228bbbe93c8d0e5beff9c962e01d14a7?s=128&d=identicon&r=PG", "display_name": "Kozio\u0142ek", "link": "https://stackoverflow.com/users/182393/kozio%c5%82ek"}, "is_accepted": false, "score": 1, "last_activity_date": 1474275897, "creation_date": 1474275897, "answer_id": 39569269, "question_id": 39568931, "link": "https://stackoverflow.com/questions/39568931/is-there-even-a-simpler-way-to-express-anonymous-classes-in-kotlin/39569269#39569269", "title": "Is there even a simpler way to express anonymous classes in Kotlin?", "body": "<p>If you want to extend/implement some class/interface in your anonymous class there is no other way than:</p>\n\n<pre><code>object: Thread(\"Name\"){\n    //...\n}.start()\n</code></pre>\n\n<p>The simplest possible construction is of course:</p>\n\n<pre><code>val adhoc = object{\n    // some code here\n}\n</code></pre>\n\n<p>but there are no simpler way to do this.</p>\n\n<p><a href=\"https://kotlinlang.org/docs/reference/object-declarations.html\" rel=\"nofollow\">Documentation</a>, but You probably read that.</p>\n"}, {"comments": [{"owner": {"reputation": 89682, "user_id": 675383, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/6e7a971eb341ffeaa3efca407239bf3b?s=128&d=identicon&r=PG", "display_name": "nhaarman", "link": "https://stackoverflow.com/users/675383/nhaarman"}, "edited": false, "score": 1, "creation_date": 1474277603, "post_id": 39569381, "comment_id": 66449432, "body": "You&#39;re not providing a solution to the problem (anonymous class syntax), but rather a different way to use the <code>Thread</code> class."}, {"owner": {"reputation": 22943, "user_id": 870674, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0463b7a46ed49025082a795ac2f67f49?s=128&d=identicon&r=PG", "display_name": "klimat", "link": "https://stackoverflow.com/users/870674/klimat"}, "reply_to_user": {"reputation": 89682, "user_id": 675383, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/6e7a971eb341ffeaa3efca407239bf3b?s=128&d=identicon&r=PG", "display_name": "nhaarman", "link": "https://stackoverflow.com/users/675383/nhaarman"}, "edited": false, "score": 1, "creation_date": 1474278748, "post_id": 39569381, "comment_id": 66450151, "body": "@nhaarman are you sure his problem is about shorter anonymous classes or rather shorter code in general? If you&#39;re a subject purist you&#39;re right but if take an effort to understand his real intention you might be wrong: <code>But I feel that there is a simpler way of doing this, however I can&#39;t find any examples.</code>"}, {"owner": {"reputation": 4190, "user_id": 2207729, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/076e4de85fdcd7632642b930f525cfaf?s=128&d=identicon&r=PG&f=1", "display_name": "PedroD", "link": "https://stackoverflow.com/users/2207729/pedrod"}, "edited": false, "score": 0, "creation_date": 1474283623, "post_id": 39569381, "comment_id": 66453118, "body": "Yes, my goal was to make the code shorter, thanks! Sorry if I wasn&#39;t clear in my question. I am all for less code, as long as it doesn&#39;t affect readability. That was the main reason for me to go from Java to Kotlin."}, {"owner": {"reputation": 89682, "user_id": 675383, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/6e7a971eb341ffeaa3efca407239bf3b?s=128&d=identicon&r=PG", "display_name": "nhaarman", "link": "https://stackoverflow.com/users/675383/nhaarman"}, "reply_to_user": {"reputation": 4190, "user_id": 2207729, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/076e4de85fdcd7632642b930f525cfaf?s=128&d=identicon&r=PG&f=1", "display_name": "PedroD", "link": "https://stackoverflow.com/users/2207729/pedrod"}, "edited": false, "score": 0, "creation_date": 1474283790, "post_id": 39569381, "comment_id": 66453209, "body": "@PedroD You were talking about <code>PS. I know that starting a Thread like this is a bad practice</code>. This answer overcomes the bad practice, you&#39;re not inheriting from <code>Thread</code> anymore, but rather passing a <code>Runnable</code> to the constructor."}, {"owner": {"reputation": 4190, "user_id": 2207729, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/076e4de85fdcd7632642b930f525cfaf?s=128&d=identicon&r=PG&f=1", "display_name": "PedroD", "link": "https://stackoverflow.com/users/2207729/pedrod"}, "edited": false, "score": 0, "creation_date": 1474283991, "post_id": 39569381, "comment_id": 66453341, "body": "Is inheriting from <code>Thread</code> is also considered a bad practice? The bad practice I was referring to was creating a headless thread. I.e. I will have no control for this thread&#39;s life-cycle from that moment on, because I have no references to it. By the book, I should keep a list of all my threads."}, {"owner": {"reputation": 22943, "user_id": 870674, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0463b7a46ed49025082a795ac2f67f49?s=128&d=identicon&r=PG", "display_name": "klimat", "link": "https://stackoverflow.com/users/870674/klimat"}, "reply_to_user": {"reputation": 89682, "user_id": 675383, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/6e7a971eb341ffeaa3efca407239bf3b?s=128&d=identicon&r=PG", "display_name": "nhaarman", "link": "https://stackoverflow.com/users/675383/nhaarman"}, "edited": false, "score": 0, "creation_date": 1474284605, "post_id": 39569381, "comment_id": 66453774, "body": "@nhaarman did you change your mind about a usability of this answer? :)"}, {"owner": {"reputation": 89682, "user_id": 675383, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/6e7a971eb341ffeaa3efca407239bf3b?s=128&d=identicon&r=PG", "display_name": "nhaarman", "link": "https://stackoverflow.com/users/675383/nhaarman"}, "edited": false, "score": 0, "creation_date": 1474285684, "post_id": 39569381, "comment_id": 66454391, "body": "Ah, sure. I can&#39;t undo the down vote though until you make an edit ;)"}, {"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "edited": false, "score": 0, "creation_date": 1474288599, "post_id": 39569381, "comment_id": 66456346, "body": "There is another way to implement an anonymous class, this is misleading because it does not consider SAM conversions."}], "tags": [], "owner": {"reputation": 22943, "user_id": 870674, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0463b7a46ed49025082a795ac2f67f49?s=128&d=identicon&r=PG", "display_name": "klimat", "link": "https://stackoverflow.com/users/870674/klimat"}, "is_accepted": false, "score": 4, "last_activity_date": 1474289277, "last_edit_date": 1474289277, "creation_date": 1474276290, "answer_id": 39569381, "question_id": 39568931, "link": "https://stackoverflow.com/questions/39568931/is-there-even-a-simpler-way-to-express-anonymous-classes-in-kotlin/39569381#39569381", "title": "Is there even a simpler way to express anonymous classes in Kotlin?", "body": "<p>There's no different way to implement an anonymous class (except <a href=\"https://kotlinlang.org/docs/reference/java-interop.html\" rel=\"nofollow\">SAM conversions</a>).<br/>\nBut you can still simplify your code by:</p>\n\n<pre><code> Thread({ val a = 3 }).start()\n</code></pre>\n\n<p>or with thread name:</p>\n\n<pre><code>Thread({ val a = 3 }, \"Cute Thread\").start()\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 17307, "user_id": 869184, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/58a3657cee7bdb5f537020660d9711e0?s=128&d=identicon&r=PG&f=1", "display_name": "Ilya", "link": "https://stackoverflow.com/users/869184/ilya"}, "edited": false, "score": 2, "creation_date": 1474313784, "post_id": 39569687, "comment_id": 66471584, "body": "And if you&#39;re about to write such function, there&#39;s already one at your disposal in stdlib: <a href=\"https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.concurrent/thread.html\" rel=\"nofollow noreferrer\">kotlinlang.org/api/latest/jvm/stdlib/kotlin.concurrent/&hellip;</a>"}], "tags": [], "owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "is_accepted": false, "score": 2, "last_activity_date": 1474288517, "last_edit_date": 1474288517, "creation_date": 1474277269, "answer_id": 39569687, "question_id": 39568931, "link": "https://stackoverflow.com/questions/39568931/is-there-even-a-simpler-way-to-express-anonymous-classes-in-kotlin/39569687#39569687", "title": "Is there even a simpler way to express anonymous classes in Kotlin?", "body": "<p>You code is absolutely correct. The only way to simplify it is it extract the logic into a function and then reuse it:</p>\n\n\n\n<pre><code>fun newThread(name: String, block: () -&gt; Unit): Thread {\n    return object : Thread(name) {\n        override fun run() = block()\n    }.start()\n}\n</code></pre>\n\n<p>Usage:</p>\n\n<pre><code>newThread(\"Cute Thread\") {\n    val a = 3\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4190, "user_id": 2207729, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/076e4de85fdcd7632642b930f525cfaf?s=128&d=identicon&r=PG&f=1", "display_name": "PedroD", "link": "https://stackoverflow.com/users/2207729/pedrod"}, "edited": false, "score": 0, "creation_date": 1491777524, "post_id": 39572766, "comment_id": 73690212, "body": "Awesome! Thanks!"}, {"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "reply_to_user": {"reputation": 4190, "user_id": 2207729, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/076e4de85fdcd7632642b930f525cfaf?s=128&d=identicon&r=PG&f=1", "display_name": "PedroD", "link": "https://stackoverflow.com/users/2207729/pedrod"}, "edited": false, "score": 1, "creation_date": 1492353204, "post_id": 39572766, "comment_id": 73933533, "body": "@PedroD answer has been modernized"}, {"owner": {"reputation": 107167, "user_id": 878126, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/D5dZW.jpg?s=128&g=1", "display_name": "android developer", "link": "https://stackoverflow.com/users/878126/android-developer"}, "edited": false, "score": 0, "creation_date": 1611609443, "post_id": 39572766, "comment_id": 116502780, "body": "This is nice for <code>thread</code> as it already exists, but how can I create my own implementation that will allow a shorter version too?  For example some simple interface as <code>interface OnResultCallback{     fun onSuccess(result: SomeResultClass) }</code>"}, {"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "reply_to_user": {"reputation": 107167, "user_id": 878126, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/D5dZW.jpg?s=128&g=1", "display_name": "android developer", "link": "https://stackoverflow.com/users/878126/android-developer"}, "edited": false, "score": 0, "creation_date": 1614341979, "post_id": 39572766, "comment_id": 117362907, "body": "@androiddeveloper please create a new question as yours is not related to this specific question.  Also see &quot;SAM conversion for Kotlin interfaces&quot; in latest Kotlin releases."}, {"owner": {"reputation": 107167, "user_id": 878126, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/D5dZW.jpg?s=128&g=1", "display_name": "android developer", "link": "https://stackoverflow.com/users/878126/android-developer"}, "edited": false, "score": 0, "creation_date": 1614419197, "post_id": 39572766, "comment_id": 117383393, "body": "@JaysonMinard I don&#39;t remember why I asked this, but the answer is &quot;fun interface&quot;, I think."}], "tags": [], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "is_accepted": true, "score": 2, "last_activity_date": 1492353033, "last_edit_date": 1492353033, "creation_date": 1474286754, "answer_id": 39572766, "question_id": 39568931, "link": "https://stackoverflow.com/questions/39568931/is-there-even-a-simpler-way-to-express-anonymous-classes-in-kotlin/39572766#39572766", "title": "Is there even a simpler way to express anonymous classes in Kotlin?", "body": "<p>One issue here is that the <code>Thread</code> class constructor has parameters in a bad order for Kotlin.  For <code>Runnable</code> you can easily use a <a href=\"https://kotlinlang.org/docs/reference/java-interop.html#sam-conversions\" rel=\"nofollow noreferrer\">SAM conversion</a> (<em>a single method interface can be treated as a lambda</em>) but because the lambda is not the last parameter it looks kinda clunky.  In the case where there is only one parameter it is fine:</p>\n\n\n\n<pre><code>Thread { val a = 3 }.start()\n</code></pre>\n\n<p>However with more than one parameter, they are backwards causing this uglier syntax with the lambda as a parameter inside the parenthesis:</p>\n\n<pre><code>Thread({ val a = 3 }, \"some name\").start()\n</code></pre>\n\n<p><strong>Instead you should use the Kotlin stdlib function <a href=\"https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.concurrent/thread.html\" rel=\"nofollow noreferrer\"><code>thread()</code></a></strong></p>\n\n<p>With that function you have simpler syntax of:</p>\n\n<pre><code>// create thread, auto start it, runs lambda in thread\nthread { val a = 3 }  \n\n// create thread with given name, auto start it, runs lambda in thread\nthread(name = \"Cute Thread\") { val a = 3 }  \n\n// creates thread that is paused, with a lambda to run later\nthread(false) { val a = 3 } \n\n// creates thread that is paused with a given name, with a lambda to run later\nthread(false, name = \"Cute Thread\") { val a = 3 } \n</code></pre>\n\n<p>See also: <a href=\"https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.concurrent/thread.html\" rel=\"nofollow noreferrer\"><code>thread()</code> function documentation</a></p>\n"}], "owner": {"reputation": 4190, "user_id": 2207729, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/076e4de85fdcd7632642b930f525cfaf?s=128&d=identicon&r=PG&f=1", "display_name": "PedroD", "link": "https://stackoverflow.com/users/2207729/pedrod"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1360, "favorite_count": 1, "accepted_answer_id": 39572766, "answer_count": 4, "score": 1, "last_activity_date": 1492353033, "creation_date": 1474274875, "question_id": 39568931, "link": "https://stackoverflow.com/questions/39568931/is-there-even-a-simpler-way-to-express-anonymous-classes-in-kotlin", "title": "Is there even a simpler way to express anonymous classes in Kotlin?", "body": "<p>I translated this Java</p>\n\n<pre><code>new Thread(\"Cute Thread\") {\n  public void run() {\n    int a = 3;\n  }\n}.start();\n</code></pre>\n\n<p>to this Kotlin</p>\n\n<pre><code>object : Thread(\"Cute Thread\") {\n  override fun run() {\n     val a = 3\n  }\n}.start()\n</code></pre>\n\n<p>But I feel that there is a simpler way of doing this, however I can't find any examples.</p>\n\n<p>I've tried </p>\n\n<pre><code>  Thread(\"Cute Thread\") { val a = 3 }.start()\n</code></pre>\n\n<p>But with no success...</p>\n\n<p>PS. I know that starting a Thread like this is a bad practice.</p>\n"}, {"tags": ["kotlin", "kovenant"], "answers": [{"comments": [{"owner": {"reputation": 17307, "user_id": 869184, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/58a3657cee7bdb5f537020660d9711e0?s=128&d=identicon&r=PG&f=1", "display_name": "Ilya", "link": "https://stackoverflow.com/users/869184/ilya"}, "edited": false, "score": 0, "creation_date": 1474313611, "post_id": 39564969, "comment_id": 66471507, "body": "This seems to be an alternative to using <code>task</code> method: <a href=\"http://kovenant.komponents.nl/api/core_usage/#task\" rel=\"nofollow noreferrer\">kovenant.komponents.nl/api/core_usage/#task</a>. Could you explain in answer when it should be used instead of <code>task</code>?"}, {"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "reply_to_user": {"reputation": 17307, "user_id": 869184, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/58a3657cee7bdb5f537020660d9711e0?s=128&d=identicon&r=PG&f=1", "display_name": "Ilya", "link": "https://stackoverflow.com/users/869184/ilya"}, "edited": false, "score": 0, "creation_date": 1474326126, "post_id": 39564969, "comment_id": 66476601, "body": "synchronous (Promise.of vs. async (task) dispatching of the code, but making sure the calculated value doesn&#39;t leak the exception."}, {"owner": {"reputation": 17307, "user_id": 869184, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/58a3657cee7bdb5f537020660d9711e0?s=128&d=identicon&r=PG&f=1", "display_name": "Ilya", "link": "https://stackoverflow.com/users/869184/ilya"}, "edited": false, "score": 0, "creation_date": 1474329498, "post_id": 39564969, "comment_id": 66477465, "body": "Another thing that concerns me with the proposed <code>Promise.of</code> overload is that now its behavior is unexpected when one wants to have a promise of functional type <code>Promise&lt;() -&gt; V&gt;</code>, but gets <code>Promise&lt;V&gt;</code> instead."}, {"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "reply_to_user": {"reputation": 17307, "user_id": 869184, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/58a3657cee7bdb5f537020660d9711e0?s=128&d=identicon&r=PG&f=1", "display_name": "Ilya", "link": "https://stackoverflow.com/users/869184/ilya"}, "edited": false, "score": 0, "creation_date": 1474331092, "post_id": 39564969, "comment_id": 66477783, "body": "It could have a different name if that was your concern.  I&#39;m not trying to add to the Kovenant library, where he would need to consider those options.  I&#39;m suggesting a model for not leaking exceptions where I&#39;ve seen developers leak them too many times.  And an example of that includes making it re-usable, and someone will have to pick the best name for that.  As a private helper class you can consider your world in which you need to name things and what functionality you might have, if this is for Kovenant as a feature suggestion he&#39;ll have to consider the WHOLE world."}], "tags": [], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "is_accepted": true, "score": 2, "last_activity_date": 1474256080, "creation_date": 1474256080, "answer_id": 39564969, "question_id": 39564968, "link": "https://stackoverflow.com/questions/39564968/in-kotlin-when-using-kovenant-promise-ofvalue-sometimes-i-leak-exceptions/39564969#39564969", "title": "In Kotlin when using Kovenant Promise.of(value) sometimes I leak exceptions", "body": "<p>The problem is that you are leaking exceptions outside the chain of your promises.  Imagine this code:</p>\n\n<pre><code>fun makeMyPromise(): Promise&lt;Int, Exception&gt; {\n    val result: Int = callSomeCalculation()  // &lt;--- exception occurs here\n    val deferred = deferred&lt;Int, Exception&gt;()\n    deferred.resolve(result)\n    return deferred.promise\n}\n</code></pre>\n\n<p>This is basically what  your code is doing in the first line.  And if an exception is thrown the method will exit with the exception and <code>deferred.reject</code> is never called.  Changing the code to this:</p>\n\n<pre><code>fun makeMyPromise(): Promise&lt;Int, Exception&gt; {\n    val deferred = deferred&lt;Int, Exception&gt;()\n    try {\n        val result: Int = callSomeCalculation()  // &lt;--- exception occurs here\n        deferred.resolve(result)\n    } catch (ex: Exception) {\n        deferred.reject(ex)\n    }\n    return deferred.promise\n}\n</code></pre>\n\n<p>Would be more correct and catch your exception.  And it ensures nothing could leak from the promise chain.</p>\n\n<p>So going back to your original code, your <code>callSomeCalculation()</code> is happening before the <code>Promise.of()</code> method is called and there is no way it can provide this sort of protection.  It happens before Kovenant has an idea you are even creating a promise.  So you need a new <code>Promise.of(lambda)</code> method that accepts a code block that can be completely protected against such leaks.</p>\n\n<p>Here is a new <code>Promise.of(lambda)</code> extension function: </p>\n\n<pre><code>fun &lt;V&gt; Promise.Companion.of(codeBlock: () -&gt; V): Promise&lt;V, Exception&gt; {\n    val deferred = deferred&lt;V, Exception&gt;()\n    try {\n        deferred.resolve(codeBlock())\n    }\n    catch (ex: Exception) {\n        deferred.reject(ex)\n    }\n    return deferred.promise\n}\n</code></pre>\n\n<p>Which would be used as:</p>\n\n<pre><code>Promise.of { callSomeCalculation() }   &lt;-- sometimes throws exception\n  .then { ... }\n  .then { ... }\n  .fail { ex -&gt; log.error(ex) }        &lt;-- exception ALWAYS logged!\n</code></pre>\n\n<p>Notice the parenthesis <code>()</code> changed to <code>{}</code> brackets because now the code block is being passed into the <code>Promise.of</code> method and wrapped with exception handling, preventing any leaks.  You will now see your exception logged in the later <code>fail { .. }</code> block.</p>\n"}], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 436, "favorite_count": 0, "accepted_answer_id": 39564969, "answer_count": 1, "score": 2, "last_activity_date": 1474256080, "creation_date": 1474256080, "last_edit_date": 1610973576, "question_id": 39564968, "link": "https://stackoverflow.com/questions/39564968/in-kotlin-when-using-kovenant-promise-ofvalue-sometimes-i-leak-exceptions", "title": "In Kotlin when using Kovenant Promise.of(value) sometimes I leak exceptions", "body": "<p>Using Kovenant, I use <code>Promise.of(value)</code> function at times to create a synchronous result that I want to wrap as a promise.  But sometimes calls like:</p>\n\n<pre class=\"lang-kotlin prettyprint-override\"><code>Promise.of(callSomeCalculation())  &lt;-- throws exception sometimes\n  .then { ... }\n  .then { ... }\n  .fail { ex -&gt; log.error(ex) }    &lt;-- exception is not logged\n</code></pre>\n<p>This code loses exceptions that happen during the first promise.  Where did they go?  They are never logged.  And sometimes they just crash my app with unhandled exception.  Why isn't the promise catching them all?</p>\n<p><strong>Note:</strong> <em>this question is intentionally written and answered by the author (<a href=\"https://blog.stackoverflow.com/2011/07/its-ok-to-ask-and-answer-your-own-questions/\">Self-Answered Questions</a>), so that solutions for interesting problems are shared in SO.</em></p>\n"}, {"tags": ["kotlin", "kovenant"], "answers": [{"tags": [], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "is_accepted": true, "score": 3, "last_activity_date": 1474256143, "last_edit_date": 1474256143, "creation_date": 1474255443, "answer_id": 39564903, "question_id": 39564902, "link": "https://stackoverflow.com/questions/39564902/using-kovenant-from-kotlin-i-keep-getting-into-repetitive-code-using-deferred/39564903#39564903", "title": "Using Kovenant from Kotlin I keep getting into repetitive code using Deferred", "body": "<p>You can use the same pattern as the extension function <code>Lock.withLock()</code> and <code>Closeable.use()</code> do, which is to wrap a lambda with handling that you want and infer types nicely to avoid boilerplate around your <a href=\"http://kovenant.komponents.nl/api/core_usage/#deferred\" rel=\"nofollow\"><code>Deferred</code></a> instance.</p>\n\n<p>The function <code>withDeferred</code>:</p>\n\n\n\n<pre><code>fun &lt;T : Any?&gt; withDeferred(codeBlock: Deferred&lt;T, Exception&gt;.() -&gt; Unit): Promise&lt;T, Exception&gt; {\n    val deferred = deferred&lt;T, Exception&gt;()\n    try {\n        deferred.codeBlock()\n    }\n    catch (ex: Exception) {\n        deferred.reject(ex)\n    }\n    return deferred.promise\n}\n</code></pre>\n\n<p>Which can then be used as:</p>\n\n<pre><code>fun foo(): Promise&lt;SomeType, Exception&gt; {\n    return withDeferred { \n         // bunch of work that calls resolve() or reject()\n    }\n}\n</code></pre>\n\n<p>However, it isn't as pretty when you chain promises directly.  Problems will arise when you do not have clear types that can be inferred for the generics of your <code>Deferred</code> instance.  So chaining these might require generics to be specified at the call site, for example:</p>\n\n<pre><code>fun foo(): Promise&lt;SomeType, Exception&gt; {\n    return withDeferred&lt;PreviousType&gt; {\n         // bunch of work that calls resolve(PreviousType) or reject()\n    } bind { previous -&gt;\n        withDeferred&lt;SomeType&gt; {\n             // bunch of work that calls resolve(SomeType) or reject()\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 39564903, "answer_count": 1, "score": 3, "last_activity_date": 1474256143, "creation_date": 1474255443, "last_edit_date": 1610973576, "question_id": 39564902, "link": "https://stackoverflow.com/questions/39564902/using-kovenant-from-kotlin-i-keep-getting-into-repetitive-code-using-deferred", "title": "Using Kovenant from Kotlin I keep getting into repetitive code using Deferred", "body": "<p>When using Kovenant from Kotlin, I end up with a lot of code that is the pattern of:</p>\n\n<pre class=\"lang-kotlin prettyprint-override\"><code>fun foo(): Promise&lt;SomeResultType, Exception&gt; {\n    val deferred = deferred&lt;SomeResultType, Exception&gt;()\n    try {\n        // bunch of work that deferred.resolve() or deferred.reject()\n    }\n    catch (ex: Exception) {\n       deferred.reject(ex)\n    }\n    return deferred.promise\n}\n</code></pre>\n<p>I know I can use <code>task { ... }</code> for an async promise and that will take care of some of this, but when I am already async or writing adapters to other async classes I want to use a <code>Deferred</code> instance.</p>\n<p>Is there something like <code>task { ... }</code> that makes a deferred instead and takes care of all the extra work?</p>\n<p><strong>Note:</strong> <em>this question is intentionally written and answered by the author (<a href=\"https://blog.stackoverflow.com/2011/07/its-ok-to-ask-and-answer-your-own-questions/\">Self-Answered Questions</a>), so that solutions for interesting problems are shared in SO.</em></p>\n"}, {"tags": ["kotlin", "vert.x"], "answers": [{"comments": [{"owner": {"reputation": 1619, "user_id": 535610, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/417582acc1fe15ced315fc81ecdd0d8e?s=128&d=identicon&r=PG", "display_name": "Usman Saleem", "link": "https://stackoverflow.com/users/535610/usman-saleem"}, "edited": false, "score": 0, "creation_date": 1507255061, "post_id": 39564571, "comment_id": 80146984, "body": "Newbie question here, how will I register (or use) simplifiedRedirectorToHttpsHandler? For instance, my typical set up is: <code>private fun createRouter() = Router.router(vertx).apply {         route().handler(BodyHandler.create())          ...</code>  <i>Updated</i>: Never mind, I got it :) <code>Router.router(vertx).apply {         route().redirectToHttpsHandler()         route().handler(BodyHandler.create())</code>"}], "tags": [], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "is_accepted": true, "score": 2, "last_activity_date": 1474252212, "last_edit_date": 1495541703, "creation_date": 1474252212, "answer_id": 39564571, "question_id": 39564570, "link": "https://stackoverflow.com/questions/39564570/in-vertx-i-need-to-redirect-all-http-requests-to-the-same-url-but-for-https/39564571#39564571", "title": "In Vertx I need to redirect all HTTP requests to the same URL but for HTTPS", "body": "<p>First, it is best if your proxy or load balancer can do this check and redirect for you since it has knowledge of the public URL and is a simpler process at that first contact with the user.  But, you can also do it server-side with a little more complexity.</p>\n\n<p>The flag you are checking, <code>context.request().isSSL</code> is only valid for the incoming connection to Vertx-web and does not consider the end-user's connect to your proxy or load balancer.  You need to use the <code>X-Forwarded-Proto</code> header (and sometimes <code>X-Forwarded-Scheme</code>) and check the actual protocol of the user.  And only if that header is not present you can use <code>context.request().isSSL</code></p>\n\n<p>You also need to externalize your own URL to be able to redirect on the server side to something that the browser can use to find you, your public URL.</p>\n\n<p>First, there is a Kotlin function in this Stack Overflow answer for <code>RoutingContext.externalizeUrl()</code>, you will need it here: <br/>\n<a href=\"https://stackoverflow.com/questions/39564199/i-have-a-vertx-request-and-i-need-to-calculate-an-externally-visible-public-ur/39564200#39564200\">I have a Vertx request and I need to calculate an externally visible (public) URL</a></p>\n\n<p>Then knowing your public URL you can use the following handler which has default values for the intended public HTTPS port (<em>default 443 will vanish from URL</em>), which form of redirect (<em>i.e. 302</em>), and on any exceptions if the route should be failed or continued:</p>\n\n\n\n<pre><code>fun Route.redirectToHttpsHandler(publicHttpsPort: Int = 443, redirectCode: Int = 302, failOnUrlBuilding: Boolean = true) {\n    handler { context -&gt;\n        val proto = context.request().getHeader(\"X-Forwarded-Proto\")\n                ?: context.request().getHeader(\"X-Forwarded-Scheme\")\n        if (proto == \"https\") {\n            context.next()\n        } else if (proto.isNullOrBlank() &amp;&amp; context.request().isSSL) {\n            context.next()\n        } else {\n            try {\n                val myPublicUri = URI(context.externalizeUrl())\n                val myHttpsPublicUri = URI(\"https\", \n                        myPublicUri.userInfo, \n                        myPublicUri.host, \n                        publicHttpsPort,\n                        myPublicUri.rawPath, \n                        myPublicUri.rawQuery, \n                        myPublicUri.rawFragment)\n                context.response().putHeader(\"location\", myHttpsPublicUri.toString()).setStatusCode(redirectCode).end()\n            } catch (ex: Throwable) {\n                if (failOnUrlBuilding) context.fail(ex)\n                else context.next()\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>A simpler version might be to just trust the <code>context.externalizeUrl</code> class and see if it has the correct protocol and port and redirect if not:</p>\n\n<pre><code>fun Route.simplifiedRedirectToHttpsHandler(publicHttpsPort: Int = 443, redirectCode: Int = 302, failOnUrlBuilding: Boolean = true) {\n    handler { context -&gt;\n        try {\n            val myPublicUri = URI(context.externalizeUrl())\n            if (myPublicUri.scheme == \"http\") {\n                val myHttpsPublicUri = URI(\"https\",\n                        myPublicUri.userInfo,\n                        myPublicUri.host,\n                        publicHttpsPort,\n                        myPublicUri.rawPath,\n                        myPublicUri.rawQuery,\n                        myPublicUri.rawFragment)\n                context.response().putHeader(\"location\", myHttpsPublicUri.toString()).setStatusCode(redirectCode).end()\n            }\n            else {\n                context.next()\n            }\n        } catch (ex: Throwable) {\n            if (failOnUrlBuilding) context.fail(ex)\n            else context.next()\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4314, "favorite_count": 0, "accepted_answer_id": 39564571, "answer_count": 1, "score": 3, "last_activity_date": 1474252212, "creation_date": 1474252212, "last_edit_date": 1610973576, "question_id": 39564570, "link": "https://stackoverflow.com/questions/39564570/in-vertx-i-need-to-redirect-all-http-requests-to-the-same-url-but-for-https", "title": "In Vertx I need to redirect all HTTP requests to the same URL but for HTTPS", "body": "<p>I have written a Vertx-web handler in Koltin that redirects any request I receive that is HTTP to HTTPS, and I'm using <code>context.request().isSSL</code> to determine if the request is not SSL, and this worked fine until I put my code behind a load balancer.  If the load balancer talks to my Vertx-web server on HTTPS then it thinks all user requests are HTTPS even if they are not.  And if I change the load balancer to talk to Vertx-web on HTTP then every request is redirected endlessly even if already the user is using HTTPS.</p>\n<p>Then I also see another problem, that the redirect using <code>context.request().absoluteURI()</code> goes to the private address instead of the publically available address that the user is actually talking to.</p>\n<p>Is there a handler in Vertx-web that I'm missing that does this, or some idiomatic way to solve this?   Should I just do this from JavaScript since it sees the real user address instead of trying a server-side redirect?</p>\n<p>I'm coding in Kotlin, so any examples for that language are great!</p>\n<p><strong>Note:</strong> <em>this question is intentionally written and answered by the author (<a href=\"https://blog.stackoverflow.com/2011/07/its-ok-to-ask-and-answer-your-own-questions/\">Self-Answered Questions</a>), so that solutions for interesting problems are shared in SO.</em></p>\n"}, {"tags": ["kotlin", "vert.x"], "answers": [{"comments": [{"owner": {"reputation": 5912, "user_id": 3950982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7491f45ae073ed6bfe01b1e63fb06bf0?s=128&d=identicon&r=PG", "display_name": "Luke Hutchison", "link": "https://stackoverflow.com/users/3950982/luke-hutchison"}, "edited": false, "score": 0, "creation_date": 1552006061, "post_id": 39564200, "comment_id": 96859599, "body": "What&#39;s with the <code>request().headers().filter { it.value.isNullOrBlank() }</code> part? Why only include null or blank request headers in the URI? Is that just for style?"}, {"owner": {"reputation": 5912, "user_id": 3950982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7491f45ae073ed6bfe01b1e63fb06bf0?s=128&d=identicon&r=PG", "display_name": "Luke Hutchison", "link": "https://stackoverflow.com/users/3950982/luke-hutchison"}, "edited": false, "score": 1, "creation_date": 1552008055, "post_id": 39564200, "comment_id": 96860008, "body": "Also, it doesn&#39;t look like this will quite compile -- <code>dividePort</code> returns a <code>Pair&lt;String, String&gt;</code>, so <code>forwardedHostOptionalPort</code> is a <code>String</code>, which means that <code>requestPort</code> can be an integer or a string. Therefore the test in the <code>finalPort</code> assignment that compares <code>requestPort</code> to two integers will fail. (Unless there&#39;s something I don&#39;t know about Kotlin...)"}, {"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "reply_to_user": {"reputation": 5912, "user_id": 3950982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7491f45ae073ed6bfe01b1e63fb06bf0?s=128&d=identicon&r=PG", "display_name": "Luke Hutchison", "link": "https://stackoverflow.com/users/3950982/luke-hutchison"}, "edited": false, "score": 1, "creation_date": 1552054083, "post_id": 39564200, "comment_id": 96877611, "body": "@LukeHutchison thanks, it would compile but was comparing any <code>Any?</code> to an <code>Int</code> later when checking the port numbers and <code>equals()</code> would work in that direction.  But was icky, and is cleaned up now.  thanks for catching that!"}, {"owner": {"reputation": 5912, "user_id": 3950982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7491f45ae073ed6bfe01b1e63fb06bf0?s=128&d=identicon&r=PG", "display_name": "Luke Hutchison", "link": "https://stackoverflow.com/users/3950982/luke-hutchison"}, "edited": false, "score": 0, "creation_date": 1552168053, "post_id": 39564200, "comment_id": 96910302, "body": "Jayson -- you mentioned &quot;and maybe oddballs like <code>X-Forwarded-Ssl: on</code>, <code>Front-End-Https: on</code>, but your code doesn&#39;t show how to handle these. What needs to be done for these cases? + Please see my other question in the first comment above."}, {"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "reply_to_user": {"reputation": 5912, "user_id": 3950982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7491f45ae073ed6bfe01b1e63fb06bf0?s=128&d=identicon&r=PG", "display_name": "Luke Hutchison", "link": "https://stackoverflow.com/users/3950982/luke-hutchison"}, "edited": false, "score": 0, "creation_date": 1552324220, "post_id": 39564200, "comment_id": 96957065, "body": "@LukeHutchison The headers that are filtered are not useful for the algorithm to figure out the new URL.  Headers are not part of the URL, but they are used to determine how to make the new URL.  I just stripped out those I didn&#39;t want to interfere with anything the code was doing, mostly I didn&#39;t want nullable values in the type for my map since none of the Headers I use can be null to be used."}, {"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "reply_to_user": {"reputation": 5912, "user_id": 3950982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7491f45ae073ed6bfe01b1e63fb06bf0?s=128&d=identicon&r=PG", "display_name": "Luke Hutchison", "link": "https://stackoverflow.com/users/3950982/luke-hutchison"}, "edited": false, "score": 1, "creation_date": 1552324352, "post_id": 39564200, "comment_id": 96957138, "body": "@LukeHutchison those headers I mentioned as optional would depend on whatever is in front of your server and are not needed unless you have a proxy or load balancer sending something unique.  Those were examples of some that people might run into, and the list would depend on what actual deployment model you are using.  I didn&#39;t list nor incorporate all choices because I do not know all of them. I just gave some examples."}, {"owner": {"reputation": 5912, "user_id": 3950982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7491f45ae073ed6bfe01b1e63fb06bf0?s=128&d=identicon&r=PG", "display_name": "Luke Hutchison", "link": "https://stackoverflow.com/users/3950982/luke-hutchison"}, "edited": false, "score": 1, "creation_date": 1552474155, "post_id": 39564200, "comment_id": 97020282, "body": "Surely you wanted <code>filter {!it.value.isNullOrBlank() }</code> then? You&#39;re missing <code>! </code>."}, {"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "reply_to_user": {"reputation": 5912, "user_id": 3950982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7491f45ae073ed6bfe01b1e63fb06bf0?s=128&d=identicon&r=PG", "display_name": "Luke Hutchison", "link": "https://stackoverflow.com/users/3950982/luke-hutchison"}, "edited": false, "score": 1, "creation_date": 1552668327, "post_id": 39564200, "comment_id": 97112413, "body": "@LukeHutchison uff, ... is now <code>filterNot</code>"}], "tags": [], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "is_accepted": true, "score": 7, "last_activity_date": 1552668303, "last_edit_date": 1552668303, "creation_date": 1474248554, "answer_id": 39564200, "question_id": 39564199, "link": "https://stackoverflow.com/questions/39564199/i-have-a-vertx-request-and-i-need-to-calculate-an-externally-visible-public-ur/39564200#39564200", "title": "I have a Vertx request and I need to calculate an externally visible (public) URL", "body": "<p>This is a more complicated issue, and the logic is the same for most App servers if they do not already provide an URL externalization function. </p>\n\n<p>To do this correctly, you need to handle all of these headers:</p>\n\n<ul>\n<li><code>X-Forwarded-Proto</code> (or <code>X-Forwarded-Scheme: https</code>, and maybe oddballs like <code>X-Forwarded-Ssl: on</code>, <code>Front-End-Https: on</code>)</li>\n<li><code>X-Forwarded-Host</code> (as \"myhost.com\" or \"myhost.com:port\")</li>\n<li><code>X-Forwarded-Port</code></li>\n</ul>\n\n<p>And if you want to resolve and return a URL that is not the current one you need to also consider:</p>\n\n<ul>\n<li>partial without host, for example \"/something/here\" or \"under/me\"  resolving to the servers public protocol, host, port as well as that abosolute or relative path</li>\n<li>partial with host/port, for example \"//somehost.com:8983/thing\" would add the same scheme (http/https) as this server and keep the rest</li>\n<li>full, URL's that are fully qualified are returned untouched, so they are safe to pass to this function (\"http://...\", \"https://...\") and won't be modified</li>\n</ul>\n\n<p>Here is a pair of extension functions to <code>RoutingContext</code> that will handle all these cases and fall back when the load balancer / proxy headers are not present so will work in both cases of direct connections to the server and those going through the intermediary.  You pass in the absolute or relative URL (to the current page) and it will return a public version of the same.</p>\n\n\n\n<pre><code>// return current URL as public URL\nfun RoutingContext.externalizeUrl(): String {\n    return externalizeUrl(URI(request().absoluteURI()).pathPlusParmsOfUrl())\n}\n\n// resolve a related URL as a public URL\nfun RoutingContext.externalizeUrl(resolveUrl: String): String {\n    val cleanHeaders = request().headers().filterNot { it.value.isNullOrBlank() }\n            .map { it.key to it.value }.toMap()\n    return externalizeURI(URI(request().absoluteURI()), resolveUrl, cleanHeaders).toString()\n}\n</code></pre>\n\n<p>Which call an internal function that does the real work (<em>and is more testable since there is no need to mock the <code>RoutingContext</code></em>):</p>\n\n<pre><code>internal fun externalizeURI(requestUri: URI, resolveUrl: String, headers: Map&lt;String, String&gt;): URI {\n    // special case of not touching fully qualified resolve URL's\n    if (resolveUrl.startsWith(\"http://\") || resolveUrl.startsWith(\"https://\")) return URI(resolveUrl)\n\n    val forwardedScheme = headers.get(\"X-Forwarded-Proto\")\n            ?: headers.get(\"X-Forwarded-Scheme\")\n            ?: requestUri.getScheme()\n\n    // special case of //host/something URL's\n    if (resolveUrl.startsWith(\"//\")) return URI(\"$forwardedScheme:$resolveUrl\")\n\n    val (forwardedHost, forwardedHostOptionalPort) =\n            dividePort(headers.get(\"X-Forwarded-Host\") ?: requestUri.getHost())\n\n    val fallbackPort = requestUri.getPort().let { explicitPort -&gt;\n        if (explicitPort &lt;= 0) {\n            if (\"https\" == forwardedScheme) 443 else 80\n        } else {\n            explicitPort\n        }\n    }\n    val requestPort: Int = headers.get(\"X-Forwarded-Port\")?.toInt()\n            ?: forwardedHostOptionalPort\n            ?: fallbackPort\n    val finalPort = when {\n        forwardedScheme == \"https\" &amp;&amp; requestPort == 443 -&gt; \"\"\n        forwardedScheme == \"http\" &amp;&amp; requestPort == 80 -&gt; \"\"\n        else -&gt; \":$requestPort\"\n    }\n\n    val restOfUrl = requestUri.pathPlusParmsOfUrl()\n    return URI(\"$forwardedScheme://$forwardedHost$finalPort$restOfUrl\").resolve(resolveUrl)\n}\n</code></pre>\n\n<p><strong>And a few related helper functions:</strong></p>\n\n<pre><code>internal fun URI.pathPlusParmsOfUrl(): String {\n    val path = this.getRawPath().let { if (it.isNullOrBlank()) \"\" else it.mustStartWith('/') }\n    val query = this.getRawQuery().let { if (it.isNullOrBlank()) \"\" else it.mustStartWith('?') }\n    val fragment = this.getRawFragment().let { if (it.isNullOrBlank()) \"\" else it.mustStartWith('#') }\n    return \"$path$query$fragment\"\n}\n\ninternal fun dividePort(hostWithOptionalPort: String): Pair&lt;String, Int?&gt; {\n    val parts = if (hostWithOptionalPort.startsWith('[')) { // ipv6\n        Pair(hostWithOptionalPort.substringBefore(']') + ']', hostWithOptionalPort.substringAfter(\"]:\", \"\"))\n    } else { // ipv4\n        Pair(hostWithOptionalPort.substringBefore(':'), hostWithOptionalPort.substringAfter(':', \"\"))\n    }\n    return Pair(parts.first, if (parts.second.isNullOrBlank()) null else parts.second.toInt())\n}\n\nfun String.mustStartWith(prefix: Char): String {\n    return if (this.startsWith(prefix)) { this } else { prefix + this }\n}\n</code></pre>\n"}], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 843, "favorite_count": 0, "accepted_answer_id": 39564200, "answer_count": 1, "score": 5, "last_activity_date": 1552668303, "creation_date": 1474248554, "last_edit_date": 1610973576, "question_id": 39564199, "link": "https://stackoverflow.com/questions/39564199/i-have-a-vertx-request-and-i-need-to-calculate-an-externally-visible-public-ur", "title": "I have a Vertx request and I need to calculate an externally visible (public) URL", "body": "<p>I am using Vertx 3 with Kotlin, and at times I need to return a specific URI from the perspective of the public URL which is not the same as what the Vertx-web request thinks my URL is.  This is likely due to my load balancer or proxy receiving one URL, and then forwarding to my application on an internal URL.</p>\n<p>So if I do this:</p>\n\n<pre class=\"lang-kotlin prettyprint-override\"><code>val publicUrl = context.request().absoluteURI() \n</code></pre>\n<p>I end up with a URL like <code>http://10.10.103.22:8080/some/page</code> instead of <code>https://app.mydomain.com/some/page</code>.  Everything is wrong about that URL!</p>\n<p>I found a header that supposedly tell me more about the original request such as <code>X-Forwarded-Host</code> but it only includes <code>app.mydomain.com</code> or sometimes it has the port <code>app.mydomain:80</code> but that isn't enough to figure out all parts of the URL, I end up with something like <code>http://app.mydomain.com:8080/some/page</code> which is still not the correct public URL.</p>\n<p>I also need to handle not just my current URL, but peer URL's, like while on page &quot;something/page1&quot; go to &quot;something/page2&quot; on same server.  The same problems mentioned about when I try to resolve to another URL because important parts of the public URL are unobtainable.</p>\n<p>Is there a method in Vertx-web I'm missing to determine this public URL, or some idiomatic way to solve this?</p>\n<p>I'm coding in Kotlin, so any examples for that language are great!</p>\n<p><strong>Note:</strong> <em>this question is intentionally written and answered by the author (<a href=\"https://blog.stackoverflow.com/2011/07/its-ok-to-ask-and-answer-your-own-questions/\">Self-Answered Questions</a>), so that solutions for interesting problems are shared in SO.</em></p>\n"}, {"tags": ["extension-methods", "kotlin"], "answers": [{"tags": [], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "is_accepted": true, "score": 3, "last_activity_date": 1474257388, "last_edit_date": 1474257388, "creation_date": 1474256882, "answer_id": 39565064, "question_id": 39564198, "link": "https://stackoverflow.com/questions/39564198/kotlin-inline-method-is-not-visible-unless-extending-the-class/39565064#39565064", "title": "Kotlin inline Method is not Visible Unless Extending the Class", "body": "<p>The issue is that you wrote an extension function for some instance of <code>RandomClass</code> within a different receiver of <code>RandomClass</code>.  So it can only be used from with <code>RandomClass</code> where both the instance <code>this</code> of <code>RandomClass</code> can be inferred along with the explicit or implied receiver.  There is no way in Kotlin to specify both an instance of a class and a different receiver at the same time.  You can only do it when you specify one and the other can be implied.</p>\n\n<p>The problem maybe is more obvious if we mock it up:</p>\n\n<pre><code>class A {\n   inline fun B.foo() { ... }\n}   \n\nA().foo() &lt;--- nope, need B().foo() within A()\nB().foo() &lt;--- nope, can't see B.foo() from outside A instance (scoped extension)\nA::B.foo() &lt;--- doesn't exist as syntax, I made this up\n</code></pre>\n\n<p>How can you specify both <code>A</code> and <code>B</code> at the same time?  There is no syntax for \"Instance A receiver B call foo()\".  </p>\n\n<p>But if you are inside of <code>A</code> already, for example:</p>\n\n<pre><code>class A {\n   inline fun B.foo() { ... }\n\n   fun bar() { B().foo() }  &lt;-- all good!  We have A, we have B, and can call foo\n}   \n</code></pre>\n\n<p>The instance for <code>A</code> is satisfied by the class itself, and the receiver by the new instance of <code>B</code> being created before <code>Foo</code> is called.  The only different from your code is that you called <code>A</code> instance and <code>B</code> receiver the same thing but they are two parameters that need to be known to make this type of function call.</p>\n\n<p>In your case you have two simple options to get rid of the need for both instance and receiver:</p>\n\n<p><strong>1.  Don't make <code>myFunction</code> an extension function, only make it inline:</strong></p>\n\n<pre><code>open class RandomClass&lt;out E&gt;() {\n    fun iterator(): Iterator&lt;E&gt; {\n        TODO()\n    }\n\n    inline fun myFunction(action: (E) -&gt; Unit): Unit {\n        for (e in iterator()) action(e)\n    }\n}\n</code></pre>\n\n<p><strong>2.  move the inline extension outside of the class so it doesn't also need an instance:</strong></p>\n\n<pre><code>open class RandomClass&lt;out E&gt;() {\n    fun iterator(): Iterator&lt;E&gt; {\n        TODO()\n    }\n}\n\ninline fun &lt;E&gt; RandomClass&lt;E&gt;.myFunction(action: (E) -&gt; Unit): Unit {\n    for (e in iterator()) action(e)\n}\n</code></pre>\n\n<p>Either way, you have no compiler errors anymore. </p>\n"}, {"tags": [], "owner": {"reputation": 17307, "user_id": 869184, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/58a3657cee7bdb5f537020660d9711e0?s=128&d=identicon&r=PG&f=1", "display_name": "Ilya", "link": "https://stackoverflow.com/users/869184/ilya"}, "is_accepted": false, "score": 0, "last_activity_date": 1474319630, "last_edit_date": 1495541781, "creation_date": 1474313095, "answer_id": 39580618, "question_id": 39564198, "link": "https://stackoverflow.com/questions/39564198/kotlin-inline-method-is-not-visible-unless-extending-the-class/39580618#39580618", "title": "Kotlin inline Method is not Visible Unless Extending the Class", "body": "<pre><code>class A {\n   inline fun B.foo() { ... }\n}   \n</code></pre>\n\n<p><code>foo</code> is called member extension function, because it is a member of class <code>A</code> and an extension for class <code>B</code>. Inside of <code>foo</code> there are two receivers available:</p>\n\n<ul>\n<li><code>this@A</code> is called dispatch receiver,</li>\n<li><code>this@foo</code> or simply <code>this</code> is called extension receiver.</li>\n</ul>\n\n<blockquote>\n  <p>How can you specify both A and B at the same time? There is no syntax for \"Instance A receiver B call foo()\".</p>\n</blockquote>\n\n<p>Actually there is such syntax, you just need to have <code>A</code> as implicit <code>this</code> dispatch receiver:</p>\n\n<pre><code>with(A()) {\n   B().foo()\n}\n</code></pre>\n\n<p>Here you have instance of <code>A</code> specified as implicit dispatch receiver and instance of <code>B</code> as explicit extension receiver.</p>\n\n<p>How it would look like with classes from question:</p>\n\n<pre><code>val randomClass = RandomClass&lt;Any&gt;()\nval anotherRandomClass = RandomClass&lt;Any&gt;()\nwith(randomClass) {\n    // randomClass is both dispatch receiver and extension receiver\n    myFunction {  }\n    // randomClass is dispatch receiver and anotherRandomClass is extension receiver\n    anotherRandomClass.myFunction {  }\n}\n</code></pre>\n\n<p>But in your case there is no need to make <code>myFunction</code> member extension, because it doesn't use two receivers inside. Just make it either member or extension, not both, as <a href=\"https://stackoverflow.com/a/39565064/869184\">this answer</a> suggests.</p>\n"}], "owner": {"reputation": 2108, "user_id": 1377037, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/b5941b2951d33748024848f82e7bf784?s=128&d=identicon&r=PG", "display_name": "Jonathan Beaudoin", "link": "https://stackoverflow.com/users/1377037/jonathan-beaudoin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 582, "favorite_count": 1, "accepted_answer_id": 39565064, "answer_count": 2, "score": 2, "last_activity_date": 1474319630, "creation_date": 1474248528, "last_edit_date": 1474313295, "question_id": 39564198, "link": "https://stackoverflow.com/questions/39564198/kotlin-inline-method-is-not-visible-unless-extending-the-class", "title": "Kotlin inline Method is not Visible Unless Extending the Class", "body": "<p>I've ran into an issue in a library I'm writing for zero-garbage collections. I've wrote a <code>myFunction</code> function but I have an issue where I can NOT call the function unless I extend the class (in this case) <code>RandomClass</code></p>\n\n\n\n<pre><code>package com.charlatano\n\nfun main(args: Array&lt;String&gt;) {\n    val hello = RandomClass&lt;String&gt;()\n    hello.myFunction { // Unresolved reference: myFunction          \n    }\n}\n\nclass myClass {\n    private val list = RandomClass&lt;String&gt;()\n\n    fun loop() {\n        list.myFunction { // Unresolved reference: myFunction               \n        }\n    }\n}\n\nclass myClassInherit : RandomClass&lt;String&gt;() {      \n    private val list = RandomClass&lt;String&gt;()\n\n    fun loop() {\n        list.myFunction { // Compiles without issue             \n        }\n    }\n}\n\nopen class RandomClass&lt;out E&gt;() {       \n    fun iterator(): Iterator&lt;E&gt; {\n        TODO()\n    }\n\n    inline fun &lt;E&gt; RandomClass&lt;E&gt;.myFunction(action: (E) -&gt; Unit): Unit {\n        for (e in iterator()) action(e)\n    }       \n}\n</code></pre>\n\n<p>Here is the error: </p>\n\n<pre><code>Error:(23, 8) Kotlin: Unresolved reference: myFunction\n</code></pre>\n"}, {"tags": ["java", "android", "rx-java", "kotlin", "rx-android"], "answers": [{"comments": [{"owner": {"reputation": 3389, "user_id": 4853702, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/d4108214e2f91f7a04a4ccd5c2d553b0?s=128&d=identicon&r=PG&f=1", "display_name": "Alexandr", "link": "https://stackoverflow.com/users/4853702/alexandr"}, "edited": false, "score": 0, "creation_date": 1474288350, "post_id": 39569418, "comment_id": 66456173, "body": "Yeah, that&#39;s a good solution. But I just google a little bit and found info about <code>Completable</code>. It became <code>@Beta</code> in last <code>RxJava</code> update and it fits my needs."}, {"owner": {"reputation": 3389, "user_id": 4853702, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/d4108214e2f91f7a04a4ccd5c2d553b0?s=128&d=identicon&r=PG&f=1", "display_name": "Alexandr", "link": "https://stackoverflow.com/users/4853702/alexandr"}, "edited": false, "score": 0, "creation_date": 1474323302, "post_id": 39569418, "comment_id": 66475716, "body": "<code>filter { it }</code> does not replace <code>.flatMap { if(it == true) Observable.just(it) else Observable.never() }</code> as in flatMap I return <code>Observable.never()</code> which will never call <code>onComplete</code>."}, {"owner": {"reputation": 10995, "user_id": 476690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7843bb075c05be6886a97b77e36758ff?s=128&d=identicon&r=PG", "display_name": "dwursteisen", "link": "https://stackoverflow.com/users/476690/dwursteisen"}, "reply_to_user": {"reputation": 3389, "user_id": 4853702, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/d4108214e2f91f7a04a4ccd5c2d553b0?s=128&d=identicon&r=PG&f=1", "display_name": "Alexandr", "link": "https://stackoverflow.com/users/4853702/alexandr"}, "edited": false, "score": 1, "creation_date": 1474350291, "post_id": 39569418, "comment_id": 66482518, "body": "Check that your app don&#39;t leak memory with never. (I&#39;m not sure)"}], "tags": [], "owner": {"reputation": 10995, "user_id": 476690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7843bb075c05be6886a97b77e36758ff?s=128&d=identicon&r=PG", "display_name": "dwursteisen", "link": "https://stackoverflow.com/users/476690/dwursteisen"}, "is_accepted": false, "score": 2, "last_activity_date": 1474292534, "last_edit_date": 1474292534, "creation_date": 1474276428, "answer_id": 39569418, "question_id": 39564054, "link": "https://stackoverflow.com/questions/39564054/when-not-to-use-rxjavas-observable/39569418#39569418", "title": "When not to use RxJava&#39;s Observable?", "body": "<p>Using nested subscription is bad code smell. To use another <code>Observable</code> after the completion of another, you can <code>concat</code> Observables.</p>\n\n<p>You code can be simplier. For example, instead of using this : </p>\n\n\n\n<pre><code>.flatMap { if(it == true) Observable.just(it) else Observable.never() } \n</code></pre>\n\n<p>you can use <code>filter</code>instead.</p>\n\n<p>So removing nested subscription + <code>filter</code> will lead to this code : </p>\n\n<pre><code>fun lockAppIfNeeded() {\n    appLockManager.shouldLock()\n                 .doOnNext { logger.debug(\"shouldLock: $it\") }\n                 .filter { it } // flow down only if it == true\n                 .flatMap { appLockManager.setLocked() } // then lock\n                 .ignoreElements() // throw away appLockManager items\n                 .concatWith(securityManager.anyPassword())\n                 .subscribe {\n                       if (it) {\n                            view.navigateToAskPassword() // anyPassword is true\n                       } else {\n                           view.navigateToFirstPasswordSetup() // anyPassword is false\n                       }\n                })\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3389, "user_id": 4853702, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/d4108214e2f91f7a04a4ccd5c2d553b0?s=128&d=identicon&r=PG&f=1", "display_name": "Alexandr", "link": "https://stackoverflow.com/users/4853702/alexandr"}, "is_accepted": false, "score": 0, "last_activity_date": 1474288605, "creation_date": 1474288605, "answer_id": 39573376, "question_id": 39564054, "link": "https://stackoverflow.com/questions/39564054/when-not-to-use-rxjavas-observable/39573376#39573376", "title": "When not to use RxJava&#39;s Observable?", "body": "<p>An alternative solution to presented by @dwursteisen will be to use <code>Completable</code>. According to <a href=\"https://github.com/ReactiveX/RxJava/blob/1.x/CHANGES.md\" rel=\"nofollow\">changelog</a> it just became <code>@Beta</code>.</p>\n\n<p>There is improved <code>lockAppIfNeeded()</code> method:</p>\n\n<pre><code>fun lockAppIfNeeded() {\n    appLockManager.shouldLock()\n            .doOnNext { logger.debug(\"shouldLock: $it\") }\n            .filter { it } // flow down only if it == true\n            .toCompletable()\n            .concatWith(appLockManager.setLocked()) // then lock\n            .andThen(securityManager.anyPassword())\n            .subscribe(sub {\n                if (it) {\n                    view.navigateToAskPassword() // anyPassword is true\n                } else {\n                    view.navigateToFirstPasswordSetup() // anyPassword is false\n                }\n            })\n}\n</code></pre>\n\n<p>Where <code>setLock()</code> returns <code>Completable</code>:</p>\n\n<pre><code>fun setLocked(): Completable {\n    return Completable.fromAction { this.locked = true }\n            .compose(rxHelper.applySchedulersToCompletable())\n}\n</code></pre>\n\n<p>Also, <code>Observable</code> in <code>shoudlLock()</code> can be replaced with <code>Single</code> (<code>Observable</code> that emits one item).</p>\n"}], "owner": {"reputation": 3389, "user_id": 4853702, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/d4108214e2f91f7a04a4ccd5c2d553b0?s=128&d=identicon&r=PG&f=1", "display_name": "Alexandr", "link": "https://stackoverflow.com/users/4853702/alexandr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 504, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1474292534, "creation_date": 1474246926, "question_id": 39564054, "link": "https://stackoverflow.com/questions/39564054/when-not-to-use-rxjavas-observable", "title": "When not to use RxJava&#39;s Observable?", "body": "<p>For example, I have a simple Manager in my application where I trying to keep everything <code>reactive</code>:</p>\n\n<pre><code>class AppLockManager {\n\n    private val logger = LoggerFactory.getLogger(javaClass)\n\n    private val rxHelper: RxHelper\n    private val securityManager: DiarySecurityManager\n\n    private var locked = false\n    private var lastUnlockTime: LocalDateTime? = null\n\n    constructor(rxHelper: RxHelper, securityManager: DiarySecurityManager) {\n        this.rxHelper = rxHelper\n        this.securityManager = securityManager\n    }\n\n    fun shouldLock(): Observable&lt;Boolean&gt; {\n        return securityManager.isSecutiryEnabled()\n                .doOnNext { logger.debug(\"isSecurityEnabled: $it\") }\n                .map { it &amp;&amp; !locked &amp;&amp; isLockTimerExpired() }\n                .doOnNext { logger.debug(\"shouldLock: $it\") }\n                .compose(rxHelper.applySchedulers())\n    }\n\n    private fun isLockTimerExpired(): Boolean {\n        if(lastUnlockTime == null) return true\n        val timerExpiredMoment = lastUnlockTime!!.plusSeconds(30)\n        val now = LocalDateTime.now().isAfter(timerExpiredMoment)\n        val isExpired = LocalDateTime.now().isAfter(timerExpiredMoment)\n        logger.debug(\"timerExpiredMoment: $timerExpiredMoment / now: $now; isExpired: $isExpired\")\n        return isExpired\n    }\n\n    fun setLocked(): Observable&lt;Void&gt; {\n        return Observable.create&lt;Void&gt; {\n            this.locked = true\n            it.onCompleted()\n        }.compose(rxHelper.applySchedulers())\n    }\n\n    fun setUnlocked(): Observable&lt;Void&gt; {\n        return Observable.create&lt;Void&gt; {\n            this.locked = false\n            lastUnlockTime = LocalDateTime.now()\n        }.compose(rxHelper.applySchedulers())\n    }\n\n    fun resetLockTimer(): Observable&lt;Void&gt; {\n        return Observable.create&lt;Void&gt; {\n            lastUnlockTime = LocalDateTime.now()\n        }.compose(rxHelper.applySchedulers())\n    }\n\n}\n</code></pre>\n\n<p>It's a simple class that count time and emits <code>true</code> from <code>shouldLock()</code> when my application must be locked.</p>\n\n<p>There is how I use it:</p>\n\n<pre><code>fun lockAppIfNeeded() {\n    appLockManager.shouldLock()\n            .doOnNext { logger.debug(\"shouldLock: $it\") }\n            .flatMap { if(it == true) Observable.just(it) else Observable.never() } // flow down only if it == true\n            .flatMap { appLockManager.setLocked() } // then lock\n            .subscribe(sub({}, Throwable::printStackTrace, { // use onComplete as source Observable is empty\n                securityManager.anyPassword().subscribe {\n                    if (it) {\n                        view.navigateToAskPassword() // anyPassword is true\n                    } else {\n                        view.navigateToFirstPasswordSetup() // anyPassword is false\n                    }\n                }\n            }))\n}\n</code></pre>\n\n<p>Looks ugly, isn't it? :)</p>\n\n<p>I just can't find right operator to combine empty Observable(<code>appLockManager.setLocked()</code>) with <code>securityManager.anyPassword()</code> wwitch return Observable that emits one item.</p>\n\n<p>This has led me to believe that I should not use RxJava for methods like <code>appLockManager.setLocked()</code>.</p>\n\n<p><strong>Should I use Observables here?</strong> Specially for <code>setLocked()</code>/<code>setUnlocked()</code>/<code>resetLockTimer()</code> methods which just updating <code>AppLockManager</code> and returns no data at all.</p>\n"}, {"tags": ["elasticsearch", "kotlin", "kovenant"], "answers": [{"tags": [], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "is_accepted": true, "score": 3, "last_activity_date": 1474241527, "last_edit_date": 1474241527, "creation_date": 1474241209, "answer_id": 39563568, "question_id": 39563567, "link": "https://stackoverflow.com/questions/39563567/in-kotlin-how-do-i-integrate-a-kovenant-promise-with-elasticsearch-async-respon/39563568#39563568", "title": "In Kotlin, how do I integrate a Kovenant promise with Elasticsearch async responses?", "body": "<p>You can use the Kovenant <a href=\"http://kovenant.komponents.nl/api/core_usage/#deferred\" rel=\"nofollow\"><code>Deferred</code> class</a> to create a promise without dispatching via an async <code>task</code> as you did in your sample.  The model is basically:</p>\n\n<ol>\n<li>create a deferred instance</li>\n<li>hook up to the async handlers and resolve or reject the deferred based on async callbacks</li>\n<li>return the <code>deferred.promise</code> to the caller</li>\n</ol>\n\n<p>In code, this would look like:</p>\n\n\n\n<pre><code>fun doSearch(): Promise&lt;SearchResponse, Throwable&gt; {\n    val deferred = deferred&lt;Response, Throwable&gt;()\n    esClient.prepareSearch(\"index\")\n        .setQuery(QueryBuilders.matchAllQuery())\n        .execute(object: ActionListener&lt;T&gt; {\n                   override fun onResponse(response: T) {\n                       deferred.resolve(response)\n                   }\n\n                   override fun onFailure(e: Throwable) {\n                       deferred.reject(e)\n                   })\n    return deferred.promise\n}\n</code></pre>\n\n<p>A re-usable way to do this is to first create an adapter that can just adapt Elasticsearch's desire for an <code>ActionListener</code> to work generically work with a promise:</p>\n\n<pre><code>fun &lt;T: Any&gt; promiseResult(deferred: Deferred&lt;T, Exception&gt;): ActionListener&lt;T&gt; {\n   return object: ActionListener&lt;T&gt; {\n       override fun onResponse(response: T) {\n           deferred.resolve(response)\n       }\n\n       override fun onFailure(e: Throwable) {\n           deferred.reject(wrapThrowable(e))\n       }\n   }\n}\n\nclass WrappedThrowableException(cause: Throwable): Exception(cause.message, cause)\nfun wrapThrowable(rawEx: Throwable): Exception = if (rawEx is Exception) rawEx else WrappedThrowableException(rawEx)\n</code></pre>\n\n<p>Note:  the <code>wrapThrowable()</code> method is there to change a <code>Throwable</code> into an <code>Exception</code> because current versions (<code>3.3.0</code>) of Kovenant have some methods that expect the rejection type of the promise to descend from <code>Exception</code> (<em>for example <a href=\"http://kovenant.komponents.nl/api/functional_usage/#bind\" rel=\"nofollow\"><code>bind()</code></a></em>) and you can stay with <code>Throwable</code> if you use <a href=\"http://kovenant.komponents.nl/api/core_usage/#unwrap\" rel=\"nofollow\"><code>unwrap()</code></a> instead for nested promises.  </p>\n\n<p>Now use this adapter function to generically extend Elasticsearch <code>ActionRequestBuilder</code> which is pretty much the only thing you ever will call <code>execute()</code> on; creating a new <code>promise()</code> extension function:</p>\n\n<pre><code>fun &lt;Request: ActionRequest&lt;*&gt;, Response: ActionResponse, RequestBuilder: ActionRequestBuilder&lt;*, *, *, *&gt;, Client: ElasticsearchClient&lt;*&gt;&gt;\n        ActionRequestBuilder&lt;Request, Response, RequestBuilder, Client&gt;.promise(): Promise&lt;Response, Exception&gt; {\n    val deferred = deferred&lt;Response, Exception&gt;()\n    this.execute(promiseResult(deferred))\n    return deferred.promise\n}\n</code></pre>\n\n<p>Now you can call <code>promise()</code> instead of <code>execute()</code>:</p>\n\n<pre><code>esClient.prepareSearch(\"index\")\n            .setQuery(QueryBuilders.matchAllQuery())\n            .promise()\n</code></pre>\n\n<p>And start chaining your promises...</p>\n\n<pre><code>esClient.admin().indices().prepareCreate(\"index1\").setSettings(\"...\").promise()\n        .bind {\n            esClient.admin().cluster().prepareHealth()\n                    .setWaitForGreenStatus()\n                    .promise()\n        } bind {\n            esClient.prepareIndex(\"index1\", \"type1\")\n                    .setSource(...)\n                    .promise()\n        } bind {\n            esClient.prepareSearch(\"index1\")\n                    .setQuery(QueryBuilders.matchAllQuery())\n                    .promise()\n        } then { searchResults -&gt;\n            // ... use searchResults\n        }.success {\n            // ...\n        }.fail {\n            // ...\n        }\n}\n</code></pre>\n\n<p>You should be familiar with <a href=\"http://kovenant.komponents.nl/api/functional_usage/#bind\" rel=\"nofollow\"><code>bind()</code></a> and <a href=\"http://kovenant.komponents.nl/api/core_usage/#unwrap\" rel=\"nofollow\"><code>unwrap()</code></a> when you have nested promises you want to chain without nesting deeper.  You can use <code>unwrap().then</code> in place of <code>bind</code> in the above cases if you did not want to include <a href=\"http://kovenant.komponents.nl/api/functional_usage/\" rel=\"nofollow\"><code>kovenant-functional</code></a>.</p>\n\n<p>Every call you have in Elasticsearch will be able to use <code>promise()</code> instead of <code>execute()</code> due to the consistent nature of all request objects in the Elasticsearch client.</p>\n"}], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 541, "favorite_count": 0, "accepted_answer_id": 39563568, "answer_count": 1, "score": 2, "last_activity_date": 1474247969, "creation_date": 1474241209, "last_edit_date": 1610973576, "question_id": 39563567, "link": "https://stackoverflow.com/questions/39563567/in-kotlin-how-do-i-integrate-a-kovenant-promise-with-elasticsearch-async-respon", "title": "In Kotlin, how do I integrate a Kovenant promise with Elasticsearch async responses?", "body": "<p>I use Kovenant in my Kotlin application, and I'm calling Elasticsearch which has its own async API.  I would rather use promises but the best I can come up with is something like:</p>\n\n<pre class=\"lang-kotlin prettyprint-override\"><code>task {      \n    esClient.prepareSearch(&quot;index123&quot;)\n            .setQuery(QueryBuilders.matchAllQuery())\n            .execute().actionGet()\n} then { \n    ...\n} success {\n    ...\n} fail {\n    ...\n}\n</code></pre>\n<p>Which makes an Kovenant async task thread, then Elasticsearch uses a thread from its pool, and then <code>actionGet()</code> synchronously blocks Elasticsearch to get back a result.  It seems silly to spawn new threads while blocking others.  Is there an approach to integrate the thread dispatching more closely?</p>\n<p><strong>Note:</strong> <em>this question is intentionally written and answered by the author (<a href=\"https://blog.stackoverflow.com/2011/07/its-ok-to-ask-and-answer-your-own-questions/\">Self-Answered Questions</a>), so that solutions for interesting problems are shared in SO.</em></p>\n"}, {"tags": ["kotlin"], "answers": [{"tags": [], "owner": {"reputation": 20461, "user_id": 1452094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a12b28824b215e4886da2e9f376369f?s=128&d=identicon&r=PG", "display_name": "Kiskae", "link": "https://stackoverflow.com/users/1452094/kiskae"}, "is_accepted": true, "score": 2, "last_activity_date": 1474211257, "creation_date": 1474211257, "answer_id": 39559142, "question_id": 39558253, "link": "https://stackoverflow.com/questions/39558253/cannot-resolve-reference-to-methods/39559142#39559142", "title": "cannot resolve reference to methods", "body": "<p><code>class Generic&lt;IConsumer&gt;(val consumer : IConsumer) {</code></p>\n\n<p>You are creating a class <code>Generic</code> with a generic type parameter called <code>IConsumer</code>. This type parameter will shadow the interface you defined within that class, so you it actually says is:</p>\n\n<p><code>class Generic&lt;IConsumer : Any&gt;(val consumer : Any) {</code></p>\n\n<p>That is why it cannot resolve the method, since the generic parameter can only be interpreted as <code>Any</code>.</p>\n\n<p>To fix either change the type parameter to have the appropriate names and bound (<code>class Generic&lt;T : IConsumer&gt;(val consumer : T) {</code>) or remove the generics entirely</p>\n"}], "owner": {"reputation": 9459, "user_id": 1432980, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/e646027bcc545177a971230c1e23134a?s=128&d=identicon&r=PG", "display_name": "lapots", "link": "https://stackoverflow.com/users/1432980/lapots"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 39559142, "answer_count": 1, "score": 0, "last_activity_date": 1474211257, "creation_date": 1474206041, "last_edit_date": 1474210456, "question_id": 39558253, "link": "https://stackoverflow.com/questions/39558253/cannot-resolve-reference-to-methods", "title": "cannot resolve reference to methods", "body": "<p>I've got interfaces</p>\n\n<pre><code>interface IIMSIdentifiable {\n    fun setImsId(id : String)\n    fun getImsId() : String\n}\n\ninterface IIMSConsumer : IIMSIdentifiable {\n    fun consumeAsync(message : GRLMessage)\n}\n</code></pre>\n\n<p>And I've got a class that contains object with <code>IIMSConsumer</code> type</p>\n\n<pre><code>class IMSObject&lt;IIMSConsumer&gt; : Thread {\n    constructor(component : IIMSConsumer) {\n        obj = component\n        // IMSContext.instance.registerObject(this) // hm type mismatch\n    }\n\n    val objectMessageQueue = LinkedBlockingDeque&lt;GRLMessage&gt;()\n    val obj : IIMSConsumer\n    var isRunning = true\n\n    override fun run() {\n        while(isRunning) {\n            processMessages()\n        }\n    }\n\n    fun stopProcessing() {\n        isRunning = false\n    }\n\n    fun processMessages() {\n        objectMessageQueue.forEach {\n            obj.consumeAsync(it)\n        }\n    }\n\n    fun getObjectId() : String {\n        return obj.getImsId()\n    }\n}\n</code></pre>\n\n<p>But it cannot resolve references</p>\n\n<pre><code>fun processMessages() {\n    objectMessageQueue.forEach {\n        obj.consumeAsync(it) // cannot resolve reference !!!\n    }\n}\n\nfun getObjectId() : String {\n    return obj.getImsId() // cannot resolve reference !!!\n}\n</code></pre>\n\n<p>What is the problem? Oddly enought it did not ask for imports despite being located in different packages</p>\n\n<pre><code>com.lapots.game.journey.ims.domain.IMSObject\ncom.lapots.game.journey.ims.api.IIMSConsumer\n</code></pre>\n\n<p>I tried to test in on something simpler and get the same error with <code>unresolved reference</code></p>\n\n<pre><code>interface IConsumer {\n    fun consume() : String\n}\n\nclass Generic&lt;IConsumer&gt;(val consumer : IConsumer) {\n    fun invoke() {\n        print(consumer.consume()) // unresolved reference\n    }\n\n}\n\nfun main(args: Array&lt;String&gt;) {\n    val consumer = object : IConsumer {\n        override fun consume() : String {\n            return \"I consume\"\n        }\n    }\n    val generic = Generic&lt;IConsumer&gt;(consumer)\n    generic.invoke()\n}\n</code></pre>\n"}, {"tags": ["java", "maven", "kotlin"], "comments": [{"owner": {"reputation": 8303, "user_id": 3165602, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8b194cca5dcf6906c0911564bfb4166c?s=128&d=identicon&r=PG", "display_name": "Oleg Sklyar", "link": "https://stackoverflow.com/users/3165602/oleg-sklyar"}, "edited": false, "score": 0, "creation_date": 1474153243, "post_id": 39552403, "comment_id": 66416574, "body": "Your dependency on <code>auto-service</code> is optional yet apparently your code does not work without it. So why is it optional then?"}, {"owner": {"reputation": 41, "user_id": 6576884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b89ae2e4c8e766add7471883bb83afb9?s=128&d=identicon&r=PG&f=1", "display_name": "Mitya", "link": "https://stackoverflow.com/users/6576884/mitya"}, "reply_to_user": {"reputation": 8303, "user_id": 3165602, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8b194cca5dcf6906c0911564bfb4166c?s=128&d=identicon&r=PG", "display_name": "Oleg Sklyar", "link": "https://stackoverflow.com/users/3165602/oleg-sklyar"}, "edited": false, "score": 0, "creation_date": 1474154091, "post_id": 39552403, "comment_id": 66416726, "body": "@OlegSklyar it&#39;s not working even if i remove optional filed. I added it because in <code>auto-service</code> documentation they say that i need to make it optional."}], "answers": [{"tags": [], "owner": {"reputation": 41, "user_id": 5293266, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39505e76af5b3171af22c34d62b68ff0?s=128&d=identicon&r=PG&f=1", "display_name": "tritot", "link": "https://stackoverflow.com/users/5293266/tritot"}, "is_accepted": false, "score": 1, "last_activity_date": 1532344729, "last_edit_date": 1532344729, "creation_date": 1532343712, "answer_id": 51477259, "question_id": 39552403, "link": "https://stackoverflow.com/questions/39552403/annotation-processing-with-kotlin-maven-plugin/51477259#51477259", "title": "Annotation processing with kotlin-maven-plugin", "body": "<p>auto-service is using annotation processor too so you have to add into your kotlin-maven-plugin (before compile section) this:</p>\n\n<pre><code>&lt;execution&gt;\n    &lt;id&gt;kapt&lt;/id&gt;\n    &lt;goals&gt;\n        &lt;goal&gt;kapt&lt;/goal&gt;\n    &lt;/goals&gt;\n    &lt;configuration&gt;\n        &lt;sourceDirs&gt;\n            &lt;sourceDir&gt;src/main/kotlin&lt;/sourceDir&gt;\n            &lt;sourceDir&gt;src/main/java&lt;/sourceDir&gt;\n        &lt;/sourceDirs&gt;\n        &lt;annotationProcessorPaths&gt;\n            &lt;!-- Specify your annotation processors here. --&gt;\n            &lt;annotationProcessorPath&gt;\n                &lt;groupId&gt;com.google.auto.service&lt;/groupId&gt;\n                &lt;artifactId&gt;auto-service&lt;/artifactId&gt;\n                &lt;version&gt;1.0-rc4&lt;/version&gt;\n            &lt;/annotationProcessorPath&gt;\n        &lt;/annotationProcessorPaths&gt;\n    &lt;/configuration&gt;\n&lt;/execution&gt;\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 6576884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b89ae2e4c8e766add7471883bb83afb9?s=128&d=identicon&r=PG&f=1", "display_name": "Mitya", "link": "https://stackoverflow.com/users/6576884/mitya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 995, "favorite_count": 2, "answer_count": 1, "score": 4, "last_activity_date": 1532344729, "creation_date": 1474152149, "last_edit_date": 1474237741, "question_id": 39552403, "link": "https://stackoverflow.com/questions/39552403/annotation-processing-with-kotlin-maven-plugin", "title": "Annotation processing with kotlin-maven-plugin", "body": "<p>So i have maven project with 2 modules.</p>\n\n<p>Root pom.xml looks like this:</p>\n\n<pre><code>&lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n     xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n     xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt;\n&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n\n&lt;groupId&gt;kashier&lt;/groupId&gt;\n&lt;artifactId&gt;Kashier&lt;/artifactId&gt;\n&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;\n&lt;packaging&gt;pom&lt;/packaging&gt;\n\n&lt;modules&gt;\n    &lt;module&gt;AnnotationProcessing&lt;/module&gt;\n    &lt;module&gt;TestProject&lt;/module&gt;\n&lt;/modules&gt;\n</code></pre>\n\n<p></p>\n\n<p>And the pom.xml for AnnotationProcessing module :</p>\n\n<pre><code>&lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n     xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n     xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt;\n&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n\n\n&lt;parent&gt;\n    &lt;groupId&gt;kashier&lt;/groupId&gt;\n    &lt;artifactId&gt;Kashier&lt;/artifactId&gt;\n    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;\n&lt;/parent&gt;\n\n&lt;artifactId&gt;AnnotationProcessing&lt;/artifactId&gt;\n&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;\n&lt;packaging&gt;jar&lt;/packaging&gt;\n\n&lt;properties&gt;\n    &lt;kotlin.version&gt;1.0.3&lt;/kotlin.version&gt;\n&lt;/properties&gt;\n\n&lt;dependencies&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.jetbrains.kotlin&lt;/groupId&gt;\n        &lt;artifactId&gt;kotlin-stdlib&lt;/artifactId&gt;\n        &lt;version&gt;${kotlin.version}&lt;/version&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.jetbrains.kotlin&lt;/groupId&gt;\n        &lt;artifactId&gt;kotlin-test&lt;/artifactId&gt;\n        &lt;version&gt;${kotlin.version}&lt;/version&gt;\n        &lt;scope&gt;test&lt;/scope&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;com.google.auto.service&lt;/groupId&gt;\n        &lt;artifactId&gt;auto-service&lt;/artifactId&gt;\n        &lt;version&gt;1.0-rc2&lt;/version&gt;\n        &lt;optional&gt;true&lt;/optional&gt;\n    &lt;/dependency&gt;\n&lt;/dependencies&gt;\n\n&lt;build&gt;\n    &lt;plugins&gt;\n        &lt;plugin&gt;\n            &lt;groupId&gt;org.jetbrains.kotlin&lt;/groupId&gt;\n            &lt;artifactId&gt;kotlin-maven-plugin&lt;/artifactId&gt;\n            &lt;version&gt;${kotlin.version}&lt;/version&gt;\n            &lt;executions&gt;\n                &lt;execution&gt;\n                    &lt;id&gt;compile&lt;/id&gt;\n                    &lt;phase&gt;compile&lt;/phase&gt;\n                    &lt;goals&gt;\n                        &lt;goal&gt;compile&lt;/goal&gt;\n                    &lt;/goals&gt;\n                &lt;/execution&gt;\n                &lt;execution&gt;\n                    &lt;id&gt;test-compile&lt;/id&gt;\n                    &lt;phase&gt;test-compile&lt;/phase&gt;\n                    &lt;goals&gt;\n                        &lt;goal&gt;test-compile&lt;/goal&gt;\n                    &lt;/goals&gt;\n                &lt;/execution&gt;\n            &lt;/executions&gt;\n        &lt;/plugin&gt;\n    &lt;/plugins&gt;\n&lt;/build&gt;\n</code></pre>\n\n<p></p>\n\n<p>Now everything works fine only if i manually create javax.annotation.processing.Processor file in resources directory.\nThat means that auto-service is not working and the question is: how do i make it work?</p>\n\n<p>Also i tried to make the same project with java and it works. So i think that the problem is in kotlin-maven-plugin.</p>\n\n<p>Source code of the project can be found <a href=\"https://github.com/mitya1337/Kashier\" rel=\"nofollow\">here</a></p>\n"}, {"tags": ["kotlin"], "answers": [{"tags": [], "owner": {"reputation": 32343, "user_id": 155213, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57bc3e08faeb981ddc81abd1d25c3bf1?s=128&d=identicon&r=PG", "display_name": "miensol", "link": "https://stackoverflow.com/users/155213/miensol"}, "is_accepted": false, "score": 3, "last_activity_date": 1486448451, "last_edit_date": 1486448451, "creation_date": 1474137144, "answer_id": 39550344, "question_id": 39550280, "link": "https://stackoverflow.com/questions/39550280/cleanest-way-to-reassign-the-value-of-the-variable-when-the-condition-is-met-in/39550344#39550344", "title": "Cleanest way to reassign the value of the variable when the condition is met in Kotlin", "body": "<p>In Kotlin <code>if</code> statement <a href=\"https://kotlinlang.org/docs/reference/control-flow.html#if-expression\" rel=\"nofollow noreferrer\">is an expression</a> therefore you can write:</p>\n\n<pre><code>var tempTime: Long = 60\n...\nval interval = 60L\ntempTime = if (tempTime == 0L) {\n    interval\n} else {\n    tempTime - 1\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1167, "user_id": 2003085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90fe46ce3e8f0190efda30422ad36450?s=128&d=identicon&r=PG", "display_name": "wint", "link": "https://stackoverflow.com/users/2003085/wint"}, "is_accepted": false, "score": 0, "last_activity_date": 1474137669, "creation_date": 1474137669, "answer_id": 39550436, "question_id": 39550280, "link": "https://stackoverflow.com/questions/39550280/cleanest-way-to-reassign-the-value-of-the-variable-when-the-condition-is-met-in/39550436#39550436", "title": "Cleanest way to reassign the value of the variable when the condition is met in Kotlin", "body": "<p>Using <code>Backing Field</code></p>\n\n<pre><code>var tempTime = 0\n    set(newValue) {\n        if ( newValue &lt; - 50 ) {\n            field = 0\n        } else {\n            field = newValue\n        }\n    }\n</code></pre>\n\n<p>Using <code>Backing Properties</code></p>\n\n<pre><code>private var _tempTime = 0\nvar tempTime: Int\n    get() { return _tempTime }\n    set(newValue) {\n        if ( newValue &lt; - 50 ) {\n            _tempTime = 0\n        } else {\n            _tempTime = newValue\n        }\n    }\n</code></pre>\n\n<p><a href=\"https://kotlinlang.org/docs/reference/properties.html\" rel=\"nofollow\">https://kotlinlang.org/docs/reference/properties.html</a></p>\n"}, {"tags": [], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "is_accepted": false, "score": 0, "last_activity_date": 1474156879, "creation_date": 1474156879, "answer_id": 39552860, "question_id": 39550280, "link": "https://stackoverflow.com/questions/39550280/cleanest-way-to-reassign-the-value-of-the-variable-when-the-condition-is-met-in/39552860#39552860", "title": "Cleanest way to reassign the value of the variable when the condition is met in Kotlin", "body": "<p>If you want to encapsulate this into a re-usable class:</p>\n\n\n\n<pre><code>class RepeatingInterval(val interval: Int, var current: Int = 0) {\n    fun dec(): Int {\n        current = if (current == 0) interval else current-1\n        return current\n    }\n}\n</code></pre>\n\n<p>Then you can just:</p>\n\n<pre><code>val counter = RepeatingInterval(60)\n\n// whenever you want to decrement it without worrying about it rolling over\nval tempTime = counter.dec()\n</code></pre>\n\n<p>You can also add an <code>inc()</code> method to go the otherway with the interval:</p>\n\n<pre><code>class RepeatingInterval(val interval: Int, var current: Int = 0) {\n    fun dec(): Int {\n        current = if (current &lt;= 0) interval else current-1\n        return current\n    }\n\n    fun inc(): Int {\n        current = if (current &gt;= interval) 0 else current+1\n        return current\n    }\n}\n</code></pre>\n\n<p>None of above is thread safe.  If you want thread safe:</p>\n\n<pre><code>class RepeatingInterval(val interval: Int, starting: Int = 0) {\n    val current = AtomicInteger(starting)\n\n    fun dec(): Int {\n        return current.accumulateAndGet(-1) { prev, x -&gt; if (prev &lt;= 0) interval else prev + x }\n    }\n\n    fun inc(): Int {\n        return  current.accumulateAndGet(+1) { prev, x -&gt; if (prev &gt;= interval) 0 else prev + x }\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5110, "user_id": 1542319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/49d8051261a5786e0fed00556f644191?s=128&d=identicon&r=PG", "display_name": "SerCe", "link": "https://stackoverflow.com/users/1542319/serce"}, "is_accepted": false, "score": 2, "last_activity_date": 1474157283, "creation_date": 1474157283, "answer_id": 39552887, "question_id": 39550280, "link": "https://stackoverflow.com/questions/39550280/cleanest-way-to-reassign-the-value-of-the-variable-when-the-condition-is-met-in/39552887#39552887", "title": "Cleanest way to reassign the value of the variable when the condition is met in Kotlin", "body": "<p>You can use <code>when</code>. In my opinion, it looks cleaner.</p>\n\n<pre><code>var tempTime = 0L\nval interval = 5L\ntempTime = when (tempTime) {\n    0L -&gt; interval\n    else -&gt; tempTime\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "is_accepted": false, "score": 2, "last_activity_date": 1474185801, "creation_date": 1474185801, "answer_id": 39555426, "question_id": 39550280, "link": "https://stackoverflow.com/questions/39550280/cleanest-way-to-reassign-the-value-of-the-variable-when-the-condition-is-met-in/39555426#39555426", "title": "Cleanest way to reassign the value of the variable when the condition is met in Kotlin", "body": "<p>I don't think this is language specific. If you want to hide this behaviour, use the @jasonminard's answer. If your goal is to express it in the code, do what you would have done in C or Java or any other language:</p>\n\n<pre><code>var tempTime = 60L\nval mod = (60 + 1)\n\n// decrement:\ntempTime = (tempTime - 1 + mod) % mod\n</code></pre>\n"}], "owner": {"reputation": 466, "user_id": 5056573, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/940712002645523/picture?type=large", "display_name": "henorek", "link": "https://stackoverflow.com/users/5056573/henorek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 768, "favorite_count": 0, "answer_count": 5, "score": 2, "last_activity_date": 1486448451, "creation_date": 1474136716, "last_edit_date": 1475347004, "question_id": 39550280, "link": "https://stackoverflow.com/questions/39550280/cleanest-way-to-reassign-the-value-of-the-variable-when-the-condition-is-met-in", "title": "Cleanest way to reassign the value of the variable when the condition is met in Kotlin", "body": "<p>Let's say that I have Long variable which is decremented by some method.\nI want to set it to 60 after its decremented to 0. I tried apply function</p>\n\n<pre><code>  private var tempTime = interval.apply {\n    if (this.equals(0L)) tempTime = interval\n  }\n</code></pre>\n\n<p>but it's not even correct syntax.</p>\n\n<p><code>tempTime</code> is my variable which is gonna be decremented, <code>interval</code> is default value that I want to set after <code>tempTime</code> reach 0. Also, is there any way to avoid this ugly <code>if equals 0L</code> statement?</p>\n"}, {"tags": ["kotlin"], "answers": [{"comments": [{"owner": {"reputation": 3495, "user_id": 923820, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/49c33d2b536b9d15e46920a9026f4a2a?s=128&d=identicon&r=PG", "display_name": "Alexey Dmitriev", "link": "https://stackoverflow.com/users/923820/alexey-dmitriev"}, "edited": false, "score": 0, "creation_date": 1497171772, "post_id": 39542100, "comment_id": 75958569, "body": "&quot;So you cannot prevent some of HTTP properties from bleeding into the HTTPS scope.&quot; -- for everyone&#39;s reference, this is fixed in Kotlin 1.1 (use <code>@DslMarker</code> annotation)."}], "tags": [], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "is_accepted": true, "score": 3, "last_activity_date": 1474076471, "last_edit_date": 1495541634, "creation_date": 1474076471, "answer_id": 39542100, "question_id": 39542099, "link": "https://stackoverflow.com/questions/39542099/in-kotlin-how-can-you-limit-the-choices-in-a-fluent-builder-for-different-forks/39542100#39542100", "title": "In Kotlin, how can you limit the choices in a fluent Builder for different forks of settings", "body": "<p>You need to think of your builder as more of a DSL with a series of classes instead of just one class; even if sticking with the builder pattern.  The context of the grammar changes which builder class is currently active.  </p>\n\n<p>Let's start with a simple option that forks the builder class only when the user selects between HTTP (default) and HTTPS, keeping the builder feel:</p>\n\n\n\n<p>A quick extension function that we'll use to make fluent methods prettier:</p>\n\n<pre><code>fun &lt;T: Any&gt; T.fluently(func: ()-&gt;Unit): T {\n    return this.apply { func() }\n}\n</code></pre>\n\n<p>Now the main code:</p>\n\n<pre><code>// our main builder class\nclass HttpServerBuilder internal constructor () {\n    private var host: String = \"localhost\"\n    private var port: Int? = null\n    private var context: String = \"/\"\n\n    fun withHost(host: String) = fluently { this.host = host }\n    fun withPort(port: Int) = fluently { this.port = port }\n    fun withContext(context: String) = fluently { this.context = context }\n\n    // !!! transition to another internal builder class !!!\n    fun withSsl(): HttpsServerBuilder = HttpsServerBuilder()\n\n    fun build(): Server = Server(host, port ?: 80, context, false, null, null)\n\n    // our context shift builder class when configuring HTTPS server\n    inner class HttpsServerBuilder internal constructor () {\n        private var keyStore: String? = null\n        private var keyStorePassword: String? = null\n\n        fun withKeystore(keystore: String) = fluently { this.keyStore = keyStore }\n        fun withKeystorePassword(password: String) = fluently { this.keyStorePassword = password }\n\n        // manually delegate to the outer class for withPort and withContext\n        fun withPort(port: Int) = fluently { this@HttpServerBuilder.port = port }\n        fun withContext(context: String) = fluently { this@HttpServerBuilder.context = context }\n\n        // different validation for HTTPS server than HTTP\n        fun build(): Server {\n            return Server(host, port ?: 443, context, true,\n                    keyStore ?: throw IllegalArgumentException(\"keyStore must be present for SSL\"),\n                    keyStorePassword ?: throw IllegalArgumentException(\"KeyStore password is required for SSL\"))\n        }\n    }\n}\n</code></pre>\n\n<p>And a helper function to start off a builder to match your code in the question above:</p>\n\n<pre><code>fun serverBuilder(): HttpServerBuilder {\n    return HttpServerBuilder()\n}\n</code></pre>\n\n<p>In this model we use an inner class that can continue to operate on some values of the builder and optionally carry its own unique values and unique validation of the final <code>build()</code>.  The builder transitions the user's context to this inner class on the <code>withSsl()</code> call.  </p>\n\n<p>Therefore the user is limited to only the options allowed at each \"fork in the road\".  Calling <code>withKeystore()</code> before <code>withSsl()</code> is no longer allowed.  You have the error you desire.</p>\n\n<p>An issue here is that you must manually delegate from the inner class back to the outer class any settings that you want to continue to work.  If this was a large number, this could be annoying.  Instead you could make common settings into an interface, and use <a href=\"https://kotlinlang.org/docs/reference/delegation.html#class-delegation\" rel=\"nofollow noreferrer\">class delegation</a> to delegate from the nested class to the outer class. </p>\n\n<p>So here is the builder refactored to use a common interface:</p>\n\n<pre><code>private interface HttpServerBuilderCommon {\n    var host: String\n    var port: Int?\n    var context: String\n\n    fun withHost(host: String): HttpServerBuilderCommon\n    fun withPort(port: Int): HttpServerBuilderCommon\n    fun withContext(context: String): HttpServerBuilderCommon\n\n    fun build(): Server\n}\n</code></pre>\n\n<p>With the nested class delegating via this interface to the outer:</p>\n\n<pre><code>class HttpServerBuilder internal constructor (): HttpServerBuilderCommon {\n    override var host: String = \"localhost\"\n    override var port: Int? = null\n    override var context: String = \"/\"\n\n    override fun withHost(host: String) = fluently { this.host = host }\n    override fun withPort(port: Int) = fluently { this.port = port }\n    override fun withContext(context: String) = fluently { this.context = context }\n\n    // transition context to HTTPS builder\n    fun withSsl(): HttpsServerBuilder = HttpsServerBuilder(this)\n\n    override fun build(): Server = Server(host, port ?: 80, context, false, null, null)\n\n    // nested instead of inner class that delegates to outer any common settings\n    class HttpsServerBuilder internal constructor (delegate: HttpServerBuilder): HttpServerBuilderCommon by delegate {\n        private var keyStore: String? = null\n        private var keyStorePassword: String? = null\n\n        fun withKeystore(keystore: String) = fluently { this.keyStore = keyStore }\n        fun withKeystorePassword(password: String) = fluently { this.keyStorePassword = password }\n\n        override fun build(): Server {\n            return Server(host, port ?: 443, context, true,\n                    keyStore ?: throw IllegalArgumentException(\"keyStore must be present for SSL\"),\n                    keyStorePassword ?: throw IllegalArgumentException(\"KeyStore password is required for SSL\"))\n        }\n    }\n}\n</code></pre>\n\n<p>We end up with the same net effect.  If you have additional forks you can continue to open the interface for inheritance and add settings for each level in a new descendant for each level.</p>\n\n<p>Although the first example may be smaller due to a small number of settings it could be the opposite when there is a much greater number of settings and we had more forks in the road that were building up more and more settings, then the interface + delegation model may not save a lot of code but it will reduce the chance that you forget a specific method to delegate or have a different method signature than expected.  </p>\n\n<p>It is a subjective difference between the two models.</p>\n\n<p><strong>About using DSL style builder instead:</strong></p>\n\n<p>If you used a DSL model instead, for example:</p>\n\n<pre><code>Server {\n    host = \"localhost\" \n    port = 80  \n    context = \"/secured\"\n    ssl {\n        keystore = \"mystore.kstore\"\n        password = \"p@ssw0rd!\"\n    }\n}\n</code></pre>\n\n<p>You have the advantage that you don't have to worry about delegating settings or the order of method calls because within a DSL you tend to enter and exit the scope of a partial builder and therefore already have some context shifting.  The issue here is that because you are using implied receivers for each part of the DSL, the scope can bleed from an outer object to an inner object.  This would be possible:</p>\n\n<pre><code>Server {\n    host = \"localhost\" \n    port = 80  \n    context = \"/secured\"\n    ssl {\n        keystore = \"mystore.kstore\"\n        password = \"p@ssw0rd!\"\n        ssl {\n            keystore = \"mystore.kstore\"\n            password = \"p@ssw0rd!\"\n            ssl {\n                keystore = \"mystore.kstore\"\n                password = \"p@ssw0rd!\"\n                port = 443\n                host = \"0.0.0.0\"\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>So you cannot prevent some of HTTP properties from bleeding into the HTTPS scope.  This is intended to be fixed in <a href=\"https://youtrack.jetbrains.com/issue/KT-11551\" rel=\"nofollow noreferrer\">KT-11551</a>,   see here for more details: <a href=\"https://stackoverflow.com/questions/36992822/kotlin-restrict-extension-method-scope\">Kotlin - Restrict extension method scope</a> </p>\n"}], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 1, "accepted_answer_id": 39542100, "answer_count": 1, "score": 7, "last_activity_date": 1474076471, "creation_date": 1474076471, "last_edit_date": 1610973576, "question_id": 39542099, "link": "https://stackoverflow.com/questions/39542099/in-kotlin-how-can-you-limit-the-choices-in-a-fluent-builder-for-different-forks", "title": "In Kotlin, how can you limit the choices in a fluent Builder for different forks of settings", "body": "<p>In Kotlin, I am writing a builder and want a series of steps that are obvious and must be completed.  With a fluent builder I can present all steps but not really set the order they must occur, nor can I change which ones are available based on the previous step.  So:</p>\n\n<pre class=\"lang-kotlin prettyprint-override\"><code>serverBuilder().withHost(&quot;localhost&quot;)\n         .withPort(8080)\n         .withContext(&quot;/something&quot;)\n         .build()\n</code></pre>\n<p>is fine, but then adding options like SSL certs:</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>serverBuilder().withHost(&quot;localhost&quot;)\n         .withSsl()\n         .withKeystore(&quot;mystore.kstore&quot;)\n         .withContext(&quot;/secured&quot;)\n         .build()\n</code></pre>\n<p>Now nothing prevents the non-ssl version from having the <code>withKeystore</code> and other options.  There should be an error when calling this SSL method without first turning on <code>withSsl()</code>:</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>serverBuilder().withHost(&quot;localhost&quot;)\n         .withPort(8080)\n         .withContext(&quot;/something&quot;)\n         .withKeystore(&quot;mystore.kstore&quot;)   &lt;------ SHOULD BE ERROR!\n         .build()\n</code></pre>\n<p>And it might be more complicated with more forks in the road where I only want some objects present and not others.</p>\n<p>How do I limit which functions are available at each fork in the builder logic?  Is this impossible for a builder, and instead should be a DSL?</p>\n<p><strong>Note:</strong> <em>this question is intentionally written and answered by the author (<a href=\"https://blog.stackoverflow.com/2011/07/its-ok-to-ask-and-answer-your-own-questions/\">Self-Answered Questions</a>), so that the idiomatic answers to commonly asked Kotlin topics are present in SO.</em></p>\n"}, {"tags": ["kotlin"], "comments": [{"owner": {"reputation": 3462, "user_id": 2094298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/26a93895eedcc45a0ebc3bb0da2cfbe6?s=128&d=identicon&r=PG", "display_name": "Ruckus T-Boom", "link": "https://stackoverflow.com/users/2094298/ruckus-t-boom"}, "edited": false, "score": 0, "creation_date": 1474064083, "post_id": 39540722, "comment_id": 66395571, "body": "Did you try <code>headerMap += pair</code>?"}, {"owner": {"reputation": 9459, "user_id": 1432980, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/e646027bcc545177a971230c1e23134a?s=128&d=identicon&r=PG", "display_name": "lapots", "link": "https://stackoverflow.com/users/1432980/lapots"}, "reply_to_user": {"reputation": 3462, "user_id": 2094298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/26a93895eedcc45a0ebc3bb0da2cfbe6?s=128&d=identicon&r=PG", "display_name": "Ruckus T-Boom", "link": "https://stackoverflow.com/users/2094298/ruckus-t-boom"}, "edited": false, "score": 0, "creation_date": 1474064176, "post_id": 39540722, "comment_id": 66395599, "body": "I got <code>Assignment operators ambiguity</code>"}, {"owner": {"reputation": 3462, "user_id": 2094298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/26a93895eedcc45a0ebc3bb0da2cfbe6?s=128&d=identicon&r=PG", "display_name": "Ruckus T-Boom", "link": "https://stackoverflow.com/users/2094298/ruckus-t-boom"}, "edited": false, "score": 0, "creation_date": 1474065019, "post_id": 39540722, "comment_id": 66395804, "body": "I believe that is because your <code>headerMap</code> is a <code>var</code> instead of a <code>val</code>."}, {"owner": {"reputation": 3462, "user_id": 2094298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/26a93895eedcc45a0ebc3bb0da2cfbe6?s=128&d=identicon&r=PG", "display_name": "Ruckus T-Boom", "link": "https://stackoverflow.com/users/2094298/ruckus-t-boom"}, "edited": false, "score": 0, "creation_date": 1474065426, "post_id": 39540722, "comment_id": 66395888, "body": "Also, anywhere you are using <code>Pair(&quot;Some Text&quot;, &quot;Some Other Text&quot;)</code> you could just use <code>&quot;Some Text&quot; to &quot;Some Other Text&quot;</code>"}, {"owner": {"reputation": 9459, "user_id": 1432980, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/e646027bcc545177a971230c1e23134a?s=128&d=identicon&r=PG", "display_name": "lapots", "link": "https://stackoverflow.com/users/1432980/lapots"}, "reply_to_user": {"reputation": 3462, "user_id": 2094298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/26a93895eedcc45a0ebc3bb0da2cfbe6?s=128&d=identicon&r=PG", "display_name": "Ruckus T-Boom", "link": "https://stackoverflow.com/users/2094298/ruckus-t-boom"}, "edited": false, "score": 0, "creation_date": 1474066083, "post_id": 39540722, "comment_id": 66396023, "body": "I thought <code>val</code> was read-only or that applies only to reference?"}, {"owner": {"reputation": 3462, "user_id": 2094298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/26a93895eedcc45a0ebc3bb0da2cfbe6?s=128&d=identicon&r=PG", "display_name": "Ruckus T-Boom", "link": "https://stackoverflow.com/users/2094298/ruckus-t-boom"}, "edited": false, "score": 1, "creation_date": 1474066175, "post_id": 39540722, "comment_id": 66396046, "body": "Only to the reference. It&#39;s a <code>MutableMap</code> so it can be changed, you just can&#39;t replace it with another map."}], "answers": [{"tags": [], "owner": {"reputation": 9459, "user_id": 1432980, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/e646027bcc545177a971230c1e23134a?s=128&d=identicon&r=PG", "display_name": "lapots", "link": "https://stackoverflow.com/users/1432980/lapots"}, "is_accepted": false, "score": 0, "last_activity_date": 1474064247, "creation_date": 1474064247, "answer_id": 39540845, "question_id": 39540722, "link": "https://stackoverflow.com/questions/39540722/add-new-key-value-represented-by-a-pair-to-a-mutablemap/39540845#39540845", "title": "Add new key-value represented by a `Pair` to a `MutableMap`", "body": "<p>Well for now as a solution I created extension for <code>MutableMap</code></p>\n\n<pre><code>fun MutableMap&lt;String, String&gt;.put(pair : Pair&lt;String, String&gt;) {\n    this.put(pair.first, pair.second)\n}\n</code></pre>\n\n<p>Which allowed me to write like this</p>\n\n<pre><code>fun header(closure: GRLMessage.() -&gt; Pair&lt;String, String&gt;) : GRLMessage {\n    headerMap.put(closure())\n    return this\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3462, "user_id": 2094298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/26a93895eedcc45a0ebc3bb0da2cfbe6?s=128&d=identicon&r=PG", "display_name": "Ruckus T-Boom", "link": "https://stackoverflow.com/users/2094298/ruckus-t-boom"}, "is_accepted": true, "score": 3, "last_activity_date": 1474065304, "creation_date": 1474065304, "answer_id": 39540980, "question_id": 39540722, "link": "https://stackoverflow.com/questions/39540722/add-new-key-value-represented-by-a-pair-to-a-mutablemap/39540980#39540980", "title": "Add new key-value represented by a `Pair` to a `MutableMap`", "body": "<p>Does your <code>headerMap</code> need to be a var? If not, you can change it to a val and use <code>headerMap += closure()</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 3462, "user_id": 2094298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/26a93895eedcc45a0ebc3bb0da2cfbe6?s=128&d=identicon&r=PG", "display_name": "Ruckus T-Boom", "link": "https://stackoverflow.com/users/2094298/ruckus-t-boom"}, "edited": false, "score": 1, "creation_date": 1474135686, "post_id": 39541571, "comment_id": 66412083, "body": "What is the purpose of the <code>fluently</code> function? Why not just use <code>apply</code> since that&#39;s all <code>fluently</code> does?"}, {"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "reply_to_user": {"reputation": 3462, "user_id": 2094298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/26a93895eedcc45a0ebc3bb0da2cfbe6?s=128&d=identicon&r=PG", "display_name": "Ruckus T-Boom", "link": "https://stackoverflow.com/users/2094298/ruckus-t-boom"}, "edited": false, "score": 0, "creation_date": 1474154637, "post_id": 39541571, "comment_id": 66416830, "body": "because one is self evident as to the intent and the other doesn&#39;t."}, {"owner": {"reputation": 3462, "user_id": 2094298, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/26a93895eedcc45a0ebc3bb0da2cfbe6?s=128&d=identicon&r=PG", "display_name": "Ruckus T-Boom", "link": "https://stackoverflow.com/users/2094298/ruckus-t-boom"}, "edited": false, "score": 0, "creation_date": 1474154835, "post_id": 39541571, "comment_id": 66416858, "body": "Fair enough. I was wondering if there was something more subtle I was missing."}], "tags": [], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "is_accepted": false, "score": 2, "last_activity_date": 1474071690, "last_edit_date": 1474071690, "creation_date": 1474070474, "answer_id": 39541571, "question_id": 39540722, "link": "https://stackoverflow.com/questions/39540722/add-new-key-value-represented-by-a-pair-to-a-mutablemap/39541571#39541571", "title": "Add new key-value represented by a `Pair` to a `MutableMap`", "body": "<p>Adding an <a href=\"https://kotlinlang.org/docs/reference/extensions.html#extension-functions\" rel=\"nofollow\">extension function</a> makes your fluent methods more obviously fluent:</p>\n\n\n\n<pre><code>fun &lt;T: Any&gt; T.fluently(func: ()-&gt;Unit): T {\n    return this.apply { func() } \n}\n</code></pre>\n\n<p>With that your fluent function is always clear about its return:</p>\n\n<pre><code>fun header(closure: GRLMessage.() -&gt; Pair&lt;String, String&gt;) : GRLMessage {\n    return fluently { headerMap += closure() }\n}\n</code></pre>\n\n<p>Which is really the same as:</p>\n\n<pre><code>fun header(closure: GRLMessage.() -&gt; Pair&lt;String, String&gt;) : GRLMessage {\n    return this.apply { headerMap += closure() }\n}\n</code></pre>\n\n<p>But the extension function adds a touch of readability.</p>\n\n<p>Above I use the answer given in by @Ruckus for solving your specific question of adding a <code>Pair</code> to the <code>headerMap</code>.  But you have other options that you might want to know about for other use cases of your DSL...</p>\n\n<p>You can use <a href=\"https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/let.html\" rel=\"nofollow\"><code>let</code></a>, <a href=\"https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/apply.html\" rel=\"nofollow\"><code>apply</code></a> or <a href=\"https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/with.html\" rel=\"nofollow\"><code>with</code></a> which would allow any type of decomposition of the results of <code>closure()</code> call (maybe it is more complicated than <code>Pair</code> in the future).  All of these are basically the same, <em>minus their resulting value</em>:</p>\n\n<pre><code>with(closure()) { headerMap.put(this.first, this.second) }\nclosure().apply { headerMap.put(this.first, this.second) }\nclosure().let { headerMap.put(it.first, it.second) }\n</code></pre>\n\n<p>Using <code>let</code> or <code>apply</code> is nice if you want to handle a case where <code>closure()</code> allows nullable return, in which case you might want to take action only if not <code>null</code>:</p>\n\n<pre><code>closure()?.apply { headerMap.put(this.first, this.second) }\nclosure()?.let { headerMap.put(it.first, it.second) }\n</code></pre>\n\n<p><strong>Other notes about your code:</strong></p>\n\n<ul>\n<li>use <code>val</code> instead of <code>var</code> unless you have no other choice</li>\n<li><code>lateinit</code> (or the similar <code>Delegates.notNull()</code>) seem dangerous to use in an uncontrolled lifecycle where there is no guarantee it will be completed, because the error message will be confusing and happen at some unexpected time in the future.  There are likely other ways to solve this with a DSL that chains calls to create more of a multi-step grammar</li>\n<li><p>You can shorten code by only having types on one side of the assignment, for example:</p>\n\n<pre><code>val myMap = mutableMapOf&lt;String, String&gt;()\n</code></pre>\n\n<p>instead of</p>\n\n<pre><code>var myMap : MutableMap&lt;String, String&gt; = mutableMapOf()\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 9459, "user_id": 1432980, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/e646027bcc545177a971230c1e23134a?s=128&d=identicon&r=PG", "display_name": "lapots", "link": "https://stackoverflow.com/users/1432980/lapots"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 704, "favorite_count": 0, "accepted_answer_id": 39540980, "answer_count": 3, "score": 1, "last_activity_date": 1474071805, "creation_date": 1474063441, "last_edit_date": 1474071805, "question_id": 39540722, "link": "https://stackoverflow.com/questions/39540722/add-new-key-value-represented-by-a-pair-to-a-mutablemap", "title": "Add new key-value represented by a `Pair` to a `MutableMap`", "body": "<p>I currently have this class with <code>dsl</code> like building ability</p>\n\n<pre><code>class GRLMessage {\n    var headerMap : MutableMap&lt;String, String&gt; = mutableMapOf()\n    lateinit var methodType : GRLMethod\n    lateinit var multipartObject : IGRLMultipart\n\n    fun message(closure: GRLMessage.() -&gt; Unit) : GRLMessage {\n        closure()\n        return this\n    }\n\n    fun method(closure: GRLMessage.() -&gt; GRLMethod) : GRLMessage {\n        methodType = closure()\n        return this\n    }\n\n    fun headers(closure: GRLMessage.() -&gt; Unit) : GRLMessage {\n        closure()\n        return this\n    }\n\n    fun header(closure: GRLMessage.() -&gt; Pair&lt;String, String&gt;) : GRLMessage {\n        var pair = closure()\n        headerMap.put(pair.first, pair.second)\n        return this\n    }\n\n    fun multipart(closure: GRLMessage.() -&gt; IGRLMultipart) : GRLMessage {\n        multipartObject = closure()\n        return this\n    }\n}\n</code></pre>\n\n<p>And I test it like this</p>\n\n<pre><code>class GRLMessageTest {\n\n    data class DummyMultipart(val field: String) : IGRLMultipart {\n        override fun getContent() {\n            this\n        }\n    }\n\n    @Test fun grlMessageBuilderTest() {\n        val grlMessage = GRLMessage().message {\n            method { GRLMethod.POST }\n            headers {\n                header { Pair(\"contentType\", \"object\") }\n                header { Pair(\"objectType\", \"DummyMultipart\") }\n            }\n            multipart { DummyMultipart(\"dummy\") }\n        }\n\n        val multipart = DummyMultipart(\"dummy\")\n        val headers = mapOf(\n                Pair(\"contentType\", \"object\"),\n                Pair(\"objectType\", \"DummyMultipart\")\n        )\n        val method = GRLMethod.POST\n\n        assertEquals(multipart, grlMessage.multipartObject)\n        assertEquals(method, grlMessage.methodType)\n        assertEquals(headers, grlMessage.headerMap)\n    }\n}\n</code></pre>\n\n<p>But despite providing </p>\n\n<pre><code>header { Pair(\"contentType\", \"object\") }\n</code></pre>\n\n<p>I still have to evaluate <code>closure</code> inside <code>header</code> method and directly <code>put</code> key and value into my <code>MutableMap</code></p>\n\n<pre><code>fun header(closure: GRLMessage.() -&gt; Pair&lt;String, String&gt;) : GRLMessage {\n    var pair = closure()\n    headerMap.put(pair.first, pair.second)\n    return this\n}\n</code></pre>\n\n<p>Is there a better way adding entries to <code>Map</code>?</p>\n"}, {"tags": ["kotlin"], "comments": [{"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "edited": false, "score": 0, "creation_date": 1474059777, "post_id": 39539938, "comment_id": 66394069, "body": "can you show your <code>build.gradle</code> and also if you are in a package or not for each of these files (what is the <code>package</code> statement of each file)"}, {"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "edited": false, "score": 0, "creation_date": 1474059933, "post_id": 39539938, "comment_id": 66394129, "body": "also what version of Kotlin?"}, {"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "edited": false, "score": 1, "creation_date": 1474060730, "post_id": 39539938, "comment_id": 66394421, "body": "Writing a DSL in Kotlin is not the simplest first day task, I&#39;d recommend you have a full understanding of the language and have studied other Kotlin based DSL implementations first, there are a lot of tricks to know and your approach will have problems due to fighting the data class and that default constructor and more.  I&#39;d start simpler and come back to DSL after you have the breadth of the language under your belt."}, {"owner": {"reputation": 9459, "user_id": 1432980, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/e646027bcc545177a971230c1e23134a?s=128&d=identicon&r=PG", "display_name": "lapots", "link": "https://stackoverflow.com/users/1432980/lapots"}, "reply_to_user": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "edited": false, "score": 0, "creation_date": 1474060848, "post_id": 39539938, "comment_id": 66394470, "body": "Well I prefer learning language by using it for my selected purpose. Also I am not planning to dive deep into Kotlin (at least now) as I mostly Java and Groovy. Just wanted to try it in scope of my application."}], "answers": [{"comments": [{"owner": {"reputation": 9459, "user_id": 1432980, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/e646027bcc545177a971230c1e23134a?s=128&d=identicon&r=PG", "display_name": "lapots", "link": "https://stackoverflow.com/users/1432980/lapots"}, "edited": false, "score": 0, "creation_date": 1474060158, "post_id": 39540082, "comment_id": 66394220, "body": "Oh I see! Thanks. Now I get other errors (regarding type mismatch and no value passing) but whatever. I think I know how to resolve it."}, {"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "reply_to_user": {"reputation": 9459, "user_id": 1432980, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/e646027bcc545177a971230c1e23134a?s=128&d=identicon&r=PG", "display_name": "lapots", "link": "https://stackoverflow.com/users/1432980/lapots"}, "edited": false, "score": 0, "creation_date": 1474060207, "post_id": 39540082, "comment_id": 66394238, "body": "new questions should be new SO questions after you work to resolve them of course.  Enjoy Kotlin!"}, {"owner": {"reputation": 9459, "user_id": 1432980, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/e646027bcc545177a971230c1e23134a?s=128&d=identicon&r=PG", "display_name": "lapots", "link": "https://stackoverflow.com/users/1432980/lapots"}, "edited": false, "score": 0, "creation_date": 1474060484, "post_id": 39540082, "comment_id": 66394323, "body": "Well I know that."}], "tags": [], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "is_accepted": true, "score": 4, "last_activity_date": 1474060182, "last_edit_date": 1474060182, "creation_date": 1474060059, "answer_id": 39540082, "question_id": 39539938, "link": "https://stackoverflow.com/questions/39539938/unresolved-reference-to-class-methods/39540082#39540082", "title": "unresolved reference to class, methods", "body": "<p>You have a naming mismatch between your class and the reference to the class from your tests.</p>\n\n<p>Your class is named <code>GRLMessage</code> but in your test you reference it as <code>GrlMessage</code> and Kotlin is case sensitive.  These are therefore not considered the same.  You need to use exactly the same identifier in both.</p>\n"}], "owner": {"reputation": 9459, "user_id": 1432980, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/e646027bcc545177a971230c1e23134a?s=128&d=identicon&r=PG", "display_name": "lapots", "link": "https://stackoverflow.com/users/1432980/lapots"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4448, "favorite_count": 0, "accepted_answer_id": 39540082, "answer_count": 1, "score": 0, "last_activity_date": 1474060182, "creation_date": 1474059283, "last_edit_date": 1474060060, "question_id": 39539938, "link": "https://stackoverflow.com/questions/39539938/unresolved-reference-to-class-methods", "title": "unresolved reference to class, methods", "body": "<p>I am new to <code>kotlin</code> (basically started today)</p>\n\n<p>I want to write a <code>dsl</code> like builder for my <code>GRLMessage</code> class.</p>\n\n<pre><code>data class GRLMessage(var method: GRLMethod, var headers: Map&lt;String, String&gt;, var multipart: Object) {\n\n    fun message(init: GRLMessage.() -&gt; Unit) : GRLMessage {\n        init()\n        return this\n    }\n\n    fun method(init: GRLMessage.() -&gt; GRLMethod) : GRLMessage {\n        method = init()\n        return this\n    }\n\n    fun headers(init: GRLMessage.() -&gt; Unit) : GRLMessage {\n        init()\n        return this\n    }\n\n    fun header(init: GRLMessage.() -&gt; Pair&lt;String, String&gt;) : GRLMessage {\n        headers.plus(init())\n        return this\n    }\n\n    fun multipart(init: GRLMessage.() -&gt; Object) : GRLMessage {\n        multipart = this.init()\n        return this\n    }\n}\n</code></pre>\n\n<p>In order to check it I added test.</p>\n\n<pre><code>import org.junit.Assert.*\nimport org.junit.*\n\nclass GRLMessageTest {\n\n    data class DummyMultipart(val field: String) {}\n\n    @Test fun grlMessageBuilderTest() {\n        val grlMessage = GrlMessage().message {\n            method { GRLMethod.POST }\n            headers {\n                header { Pair(\"contentType\", \"object\") }\n                header { Pair(\"objectType\", \"DummyMultipart\") }\n            }\n            multipart { DummyMultipart(\"dummy\") }\n        }\n\n        val multipart = DummyMultipart(\"dummy\")\n        val headers = mapOf(\n                Pair(\"contentType\", \"object\"),\n                Pair(\"objectType\", \"DummyMultipart\")\n        )\n        val method = GRLMethod.POST\n\n        assertEquals(multipart, grlMessage.multipart)\n        assertEquals(headers, grlMessage.headers)\n        assertEquals(method, grlMessage.method)\n    }\n}\n</code></pre>\n\n<p>Both classes are in the same packages (relatively - one is in <code>src/main/kotlin</code>, another one is in <code>src/test/kotlin</code>).</p>\n\n<p>When I try to build application using <code>gradle build</code> it fails on <code>compileTestKotlin</code> task with errors</p>\n\n<pre><code>GRLMessageTest.kt: (13, 26): Unresolved reference: GrlMessage\nGRLMessageTest.kt: (14, 13): Unresolved reference: method\nGRLMessageTest.kt: (15, 13): Unresolved reference: headers\nGRLMessageTest.kt: (17, 17): Unresolved reference: header\nGRLMessageTest.kt: (19, 13): Unresolved reference: multipart\n</code></pre>\n\n<p>What is the problem?</p>\n\n<p>Here is the layout</p>\n\n<p><a href=\"https://i.stack.imgur.com/VBsGA.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/VBsGA.png\" alt=\"enter image description here\"></a></p>\n\n<p>Here is the <code>build.gradle</code> for that concrete subproject and plugin</p>\n\n<p><a href=\"https://i.stack.imgur.com/3Ssvr.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/3Ssvr.png\" alt=\"enter image description here\"></a>\n<a href=\"https://i.stack.imgur.com/fA6nj.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/fA6nj.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["maven", "kotlin", "kapt"], "comments": [{"owner": {"reputation": 7770, "user_id": 2252572, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/5Sv5r.png?s=128&g=1", "display_name": "Bacteria", "link": "https://stackoverflow.com/users/2252572/bacteria"}, "edited": false, "score": 0, "creation_date": 1474030154, "post_id": 39531333, "comment_id": 66378111, "body": "Yes you can. You need to add <code>kotlin-maven-plugin</code>"}, {"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "reply_to_user": {"reputation": 7770, "user_id": 2252572, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/5Sv5r.png?s=128&g=1", "display_name": "Bacteria", "link": "https://stackoverflow.com/users/2252572/bacteria"}, "edited": false, "score": 1, "creation_date": 1474034813, "post_id": 39531333, "comment_id": 66381245, "body": "@Bikku that is not correct, it does not support APT"}], "answers": [{"comments": [{"owner": {"reputation": 9318, "user_id": 922584, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/05766da42bea2cb7c9e185fa66be4725?s=128&d=identicon&r=PG", "display_name": "Vojt\u011bch", "link": "https://stackoverflow.com/users/922584/vojt%c4%9bch"}, "edited": false, "score": 1, "creation_date": 1495541653, "post_id": 39533157, "comment_id": 75287530, "body": "Is this still true? There seem to be <code>&lt;goal&gt;kapt&lt;&#47;goal&gt;</code> within <code>kotlin-maven-plugin</code> - described here: <a href=\"https://kotlinlang.org/docs/reference/kapt.html\" rel=\"nofollow noreferrer\">kotlinlang.org/docs/reference/kapt.html</a>"}], "tags": [], "owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "is_accepted": true, "score": 5, "last_activity_date": 1495552253, "last_edit_date": 1495552253, "creation_date": 1474033777, "answer_id": 39533157, "question_id": 39531333, "link": "https://stackoverflow.com/questions/39531333/is-kapt-supported-in-maven/39533157#39533157", "title": "Is kapt supported in maven?", "body": "<p>Since Kotlin 1.1.2 there is now support for both Gradle and Maven to run the KAPT plugins.  This is documented in <a href=\"https://kotlinlang.org/docs/reference/kapt.html\" rel=\"nofollow noreferrer\">Using Kotlin annotation processing tool</a> where it says to:</p>\n\n<blockquote>\n  <p>Add an execution of the kapt goal from kotlin-maven-plugin before compile:</p>\n</blockquote>\n\n<pre><code>&lt;execution&gt;\n    &lt;id&gt;kapt&lt;/id&gt;\n    &lt;goals&gt;\n        &lt;goal&gt;kapt&lt;/goal&gt;\n    &lt;/goals&gt;\n    &lt;configuration&gt;\n        &lt;sourceDirs&gt;\n            &lt;sourceDir&gt;src/main/kotlin&lt;/sourceDir&gt;\n            &lt;sourceDir&gt;src/main/java&lt;/sourceDir&gt;\n        &lt;/sourceDirs&gt;\n        &lt;annotationProcessorPaths&gt;\n            &lt;!-- Specify your annotation processors here. --&gt;\n            &lt;annotationProcessorPath&gt;\n                &lt;groupId&gt;com.google.dagger&lt;/groupId&gt;\n                &lt;artifactId&gt;dagger-compiler&lt;/artifactId&gt;\n                &lt;version&gt;2.9&lt;/version&gt;\n            &lt;/annotationProcessorPath&gt;\n        &lt;/annotationProcessorPaths&gt;\n    &lt;/configuration&gt;\n&lt;/execution&gt;\n</code></pre>\n"}], "owner": {"reputation": 14564, "user_id": 997851, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/63c8b0590595c3de58406678ef99a6bf?s=128&d=identicon&r=PG", "display_name": "sockeqwe", "link": "https://stackoverflow.com/users/997851/sockeqwe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2215, "favorite_count": 1, "accepted_answer_id": 39533157, "answer_count": 1, "score": 6, "last_activity_date": 1495552253, "creation_date": 1474028252, "question_id": 39531333, "link": "https://stackoverflow.com/questions/39531333/is-kapt-supported-in-maven", "title": "Is kapt supported in maven?", "body": "<p>Is it possible to run kapt (kotlin annotation processing) in a maven based project?</p>\n\n<p>If yes how do I integrate kapt in maven build system?</p>\n"}, {"tags": ["kotlin"], "comments": [{"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "edited": false, "score": 0, "creation_date": 1474058652, "post_id": 39529722, "comment_id": 66393611, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/34241816/how-to-generate-serialversionuid-for-kotlin-exceptions\">How to generate serialVersionUID for kotlin exceptions?</a>"}, {"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "edited": false, "score": 0, "creation_date": 1474058848, "post_id": 39529722, "comment_id": 66393701, "body": "<b>Now documented in:</b> <a href=\"https://stackoverflow.com/documentation/kotlin/2273/idioms/23147/serializable-and-serialversionuid-in-kotlin\">stackoverflow.com/documentation/kotlin/2273/idioms/23147/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 10122, "user_id": 527533, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/9cf51c8acb0daff517ba6f3c5815a54c?s=128&d=identicon&r=PG", "display_name": "Jan Vladimir Mostert", "link": "https://stackoverflow.com/users/527533/jan-vladimir-mostert"}, "is_accepted": false, "score": 2, "last_activity_date": 1474023159, "creation_date": 1474023159, "answer_id": 39529723, "question_id": 39529722, "link": "https://stackoverflow.com/questions/39529722/locking-down-the-serialversionuid-in-kotlin/39529723#39529723", "title": "Locking down the serialVersionUID in Kotlin", "body": "<p>The solution was actually much simpler than I thought, use a companion object. This now serializes perfectly and if I add more fields, it still serializes to disk and deserializes unless I change the <code>serialVersionUID</code></p>\n\n<p>Base:</p>\n\n<pre><code>abstract class BaseModel&lt;T&gt;(\n        var id: Int? = null,\n        private val fileName: String,\n        private val data: MutableList&lt;T&gt;,\n        private val indices: MutableMap&lt;Int, T&gt;\n) : Serializable {\n\n    companion object {\n        @JvmStatic private val serialVersionUID: Long = 1\n    }\n\n    ...\n\n}\n</code></pre>\n\n<p>Project:</p>\n\n<pre><code>class Project(\n        var name: String = \"\",\n        var repo: String = \"\"\n\n) : BaseModel&lt;Project&gt;(\n        data = Data.projects,\n        indices = Data.projectsIndex,\n        fileName = \"data/projects.dat\"\n), Serializable {\n\n    companion object {\n        @JvmStatic private val serialVersionUID: Long = 1\n    }\n\n    override fun toString(): String {\n        return \"Project: id=${id}, name=${name}, repo=${repo}\"\n    }\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 17307, "user_id": 869184, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/58a3657cee7bdb5f537020660d9711e0?s=128&d=identicon&r=PG&f=1", "display_name": "Ilya", "link": "https://stackoverflow.com/users/869184/ilya"}, "is_accepted": true, "score": 8, "last_activity_date": 1474037414, "last_edit_date": 1474037414, "creation_date": 1474033887, "answer_id": 39533205, "question_id": 39529722, "link": "https://stackoverflow.com/questions/39529722/locking-down-the-serialversionuid-in-kotlin/39533205#39533205", "title": "Locking down the serialVersionUID in Kotlin", "body": "<p>You can define <code>serialVersionUID</code> as a constant in a companion object: </p>\n\n<pre><code>abstract class BaseModel&lt;T&gt; : Serializable {\n    companion object {\n        private const val serialVersionUID: Long = -1\n    }\n}\n</code></pre>\n\n<p>Constants are compiled to fields, and fields of a companion are stored as static fields of the class that contains companion. Therefore you get what you need \u2013 a private static field <code>serialVersionUID</code> in your serializable class.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 9454607, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZxwRS.jpg?s=128&g=1", "display_name": "Scott Smith", "link": "https://stackoverflow.com/users/9454607/scott-smith"}, "is_accepted": false, "score": 0, "last_activity_date": 1576721592, "creation_date": 1576721592, "answer_id": 59402456, "question_id": 39529722, "link": "https://stackoverflow.com/questions/39529722/locking-down-the-serialversionuid-in-kotlin/59402456#59402456", "title": "Locking down the serialVersionUID in Kotlin", "body": "<p>Install this plugin: <a href=\"https://plugins.jetbrains.com/plugin/13497-generateserialversionuid/versions\" rel=\"nofollow noreferrer\">GenerateSerialVersionUID</a>\uff0cuse plugin to auto generate default serial version uid\uff0cusage: <a href=\"https://github.com/yuanhoujun/intellij-generate-serial-version-uid-plugin\" rel=\"nofollow noreferrer\">Click here</a>.</p>\n"}], "owner": {"reputation": 10122, "user_id": 527533, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/9cf51c8acb0daff517ba6f3c5815a54c?s=128&d=identicon&r=PG", "display_name": "Jan Vladimir Mostert", "link": "https://stackoverflow.com/users/527533/jan-vladimir-mostert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1736, "favorite_count": 0, "accepted_answer_id": 39533205, "answer_count": 3, "score": 3, "last_activity_date": 1576721592, "creation_date": 1474023159, "question_id": 39529722, "link": "https://stackoverflow.com/questions/39529722/locking-down-the-serialversionuid-in-kotlin", "title": "Locking down the serialVersionUID in Kotlin", "body": "<p>I've been battling the whole morning to lock down the <code>serialVersionUID</code> in a Kotlin class. I have a <code>BaseModel</code> which is extended by <code>Project</code></p>\n\n<pre><code>abstract class BaseModel&lt;T&gt;(\n        var id: Int? = null,\n        private val fileName: String,\n        private val data: MutableList&lt;T&gt;,\n        private val indices: MutableMap&lt;Int, T&gt;\n) : Serializable {\n\n  ...\n\n   protected fun writeToDisk() {\n       val oos = ObjectOutputStream(BufferedOutputStream(FileOutputStream(fetchFileName()))   )\n       oos.writeObject(fetchData());\n       oos.close();\n   }\n\n\n}\n</code></pre>\n\n<p>And the project class:</p>\n\n<pre><code>class Project(\n        var name: String = \"\",\n        var repo: String = \"\"\n\n) : BaseModel&lt;Project&gt;(\n        data = Data.projects,\n        indices = Data.projectsIndex,\n        fileName = \"data/projects.dat\"\n), Serializable {\n\n    ...\n\n    override fun toString(): String {\n        return \"Project: id=${id}, name=${name}, repo=${repo}\"\n    }\n\n}\n</code></pre>\n\n<p>Every time I write to Disk and then change anything in the class and try to read it back again, I would get:</p>\n\n<blockquote>\n  <p>java.io.InvalidClassException: com.jvaas.bob.model.Project; local\n  class incompatible: stream classdesc serialVersionUID =\n  4156405178259085766, local class serialVersionUID =\n  2024101567466310467</p>\n</blockquote>\n\n<p>I've tried adding:</p>\n\n<pre><code>private val serialVersionUID: Long = 1 \n</code></pre>\n\n<p>to all classes with no effect.</p>\n\n<p>Some examples on StackOverflow were using <code>serialVersionUid</code> which had no effect either (I believe this is intelliJ lowercasing the last two letters for some reason)</p>\n\n<p><code>@JvmStatic</code> doesn't work here since it's not an <code>object</code>, I've tried making it non-private with no success.</p>\n"}, {"tags": ["java", "liferay", "portlet", "kotlin"], "answers": [{"tags": [], "owner": {"reputation": 43212, "user_id": 13447, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/K6sTa.jpg?s=128&g=1", "display_name": "Olaf Kock", "link": "https://stackoverflow.com/users/13447/olaf-kock"}, "is_accepted": true, "score": 1, "last_activity_date": 1474012924, "creation_date": 1474012924, "answer_id": 39526504, "question_id": 39525690, "link": "https://stackoverflow.com/questions/39525690/is-a-kotlin-liferay-portlet-possible/39526504#39526504", "title": "Is a Kotlin Liferay portlet possible?", "body": "<p>Kotlin targets the JVM - so technically: Yes. </p>\n\n<p>Will anybody be able to help you doing so, share their findings: Probably not. </p>\n\n<p>Do common build processes exist? Not that I know.</p>\n\n<p>And it'll probably make a difference if you write a portlet for Liferay 6.2 or for 7 - unless you're aiming at just the standard JSR286 portlet.</p>\n\n<p>This is a little bit like PHP-portlets in a Java Portal. It can be done, but once you run into the first issue, you'll have a hard time finding anyone to help you identify (or fix) the problem.</p>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 6864849, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-y8ZRUA13Tj4/AAAAAAAAAAI/AAAAAAAAAKE/YZBrTw-v7vw/photo.jpg?sz=128", "display_name": "Marcel Mika", "link": "https://stackoverflow.com/users/6864849/marcel-mika"}, "is_accepted": false, "score": 4, "last_activity_date": 1474638112, "creation_date": 1474638112, "answer_id": 39662321, "question_id": 39525690, "link": "https://stackoverflow.com/questions/39525690/is-a-kotlin-liferay-portlet-possible/39662321#39662321", "title": "Is a Kotlin Liferay portlet possible?", "body": "<p>It's possible to write portlets in Kotlin with just a little bit of tweaking.</p>\n\n<p>Download the latest version of kotlin library:\n<a href=\"https://github.com/JetBrains/kotlin/releases/tag/v1.0.4\" rel=\"nofollow\">https://github.com/JetBrains/kotlin/releases/tag/v1.0.4</a></p>\n\n<p>Unzip and copy the whole content of lib folder into the Liferay SDK lib folder. So at the end you should have something like /path-to-liferay-sdk/lib/kotlin-*.jar </p>\n\n<p>Open build-comon.xml file in Liferay SDK directory and search for <strong><em>javac</em></strong> tag (it's around line 900). </p>\n\n<p>Add the following line before the javac tag:</p>\n\n<pre><code>&lt;typedef resource=\"org/jetbrains/kotlin/ant/antlib.xml\" classpath=\"${sdk.dir}/lib/kotlin-ant.jar\"/&gt;\n</code></pre>\n\n<p>and also insert <code>&lt;withKotlin/&gt;</code> inside the javac tag:</p>\n\n<pre><code>&lt;typedef resource=\"org/jetbrains/kotlin/ant/antlib.xml\" classpath=\"${sdk.dir}/lib/kotlin-ant.jar\"/&gt;\n&lt;javac\n  classpathref=\"@{javac.classpathref}\"\n  compiler=\"${javac.compiler}\"\n  debug=\"${javac.debug}\"\n  deprecation=\"${javac.deprecation}\"\n  destdir=\"@{javac.destdir}\"\n  encoding=\"${javac.encoding}\"\n  includeAntRuntime=\"false\"\n  nowarn=\"${javac.nowarn}\"\n  source=\"${javac.source}\"\n  srcdir=\"@{javac.srcdir}\"\n  target=\"${javac.target}\"&gt;\n &lt;withKotlin/&gt;\n&lt;/javac&gt;\n</code></pre>\n\n<p>That's it. If you run <code>ant deploy</code> ant will compile *.kt files together with *.java for you. Now, if you are using Intellij IDEA you can add a Kotlin file into your project. The IDE will configure the project for you. It will also add 3 files (kotlin-reflect.jar, kotlin-runtime.jar, kotlin-runtime-sources.jar) into the newly created lib folder. However, you need to copy these files into the docroot/WEB-INF/lib folder to make it available.</p>\n\n<p>I posted a blog about it here: <a href=\"http://www.lims.io/blog/liferay-portlets-in-kotlin\" rel=\"nofollow\">http://www.lims.io/blog/liferay-portlets-in-kotlin</a></p>\n"}], "owner": {"reputation": 117, "user_id": 5068316, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/UfF2J.jpg?s=128&g=1", "display_name": "Meik Behnfeldt", "link": "https://stackoverflow.com/users/5068316/meik-behnfeldt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 506, "favorite_count": 0, "accepted_answer_id": 39526504, "answer_count": 2, "score": 2, "last_activity_date": 1474638112, "creation_date": 1474009877, "question_id": 39525690, "link": "https://stackoverflow.com/questions/39525690/is-a-kotlin-liferay-portlet-possible", "title": "Is a Kotlin Liferay portlet possible?", "body": "<p>As I couldn't find any example for this I am wondering if it is possible to create a Liferay Portlet which uses (pure) Kotlin instead of traditional Java.</p>\n"}, {"tags": ["intellij-idea", "kotlin"], "comments": [{"owner": {"reputation": 11834, "user_id": 1538877, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/N9qfZ.jpg?s=128&g=1", "display_name": "Ruslan", "link": "https://stackoverflow.com/users/1538877/ruslan"}, "edited": false, "score": 3, "creation_date": 1473950853, "post_id": 39512679, "comment_id": 66344000, "body": "<a href=\"https://github.com/yole/kotlin-style-guide\" rel=\"nofollow noreferrer\">github.com/yole/kotlin-style-guide</a>"}, {"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "edited": false, "score": 1, "creation_date": 1473980200, "post_id": 39512679, "comment_id": 66358761, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/28206515/is-there-an-official-kotlin-style-guide\">Is there an official Kotlin style guide?</a>"}, {"owner": {"reputation": 2954, "user_id": 5652513, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2bQCi.jpg?s=128&g=1", "display_name": "methodsignature", "link": "https://stackoverflow.com/users/5652513/methodsignature"}, "edited": false, "score": 0, "creation_date": 1513978070, "post_id": 39512679, "comment_id": 82865029, "body": "This isn&#39;t a duplicate of <a href=\"http://stackoverflow.com/questions/28206515/is-there-an-official-kotlin-style-guide\">Is there an official Kotlin style guide?</a>.  This question isn&#39;t for conventions, it is for importable IntelliJ settings."}], "answers": [{"comments": [{"owner": {"reputation": 2954, "user_id": 5652513, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2bQCi.jpg?s=128&g=1", "display_name": "methodsignature", "link": "https://stackoverflow.com/users/5652513/methodsignature"}, "edited": false, "score": 0, "creation_date": 1513978162, "post_id": 39513102, "comment_id": 82865062, "body": "The settings I had didn&#39;t follow the conventions spelled out <a href=\"http://kotlinlang.org/docs/reference/coding-conventions.html\" rel=\"nofollow noreferrer\">here</a>, so reformatting did nothing useful."}], "tags": [], "owner": {"reputation": 24586, "user_id": 3255152, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fbd95ef81d0a85310fee8dd46e0f65b0?s=128&d=identicon&r=PG&f=1", "display_name": "mfulton26", "link": "https://stackoverflow.com/users/3255152/mfulton26"}, "is_accepted": false, "score": 11, "last_activity_date": 1474032706, "last_edit_date": 1474032706, "creation_date": 1473948095, "answer_id": 39513102, "question_id": 39512679, "link": "https://stackoverflow.com/questions/39512679/styleguide-settings-for-kotlin/39513102#39513102", "title": "Styleguide settings for Kotlin", "body": "<p>There's no need to grab/import them they are built into IntelliJ IDEA's Kotlin language support plugin.</p>\n\n<p>You can reformat Kotlin source code just like you would code written in Java or other supported languages.</p>\n\n<p>From <a href=\"https://www.jetbrains.com/help/idea/2016.2/reformatting-source-code.html\" rel=\"noreferrer\">IntelliJ IDEA 2016.2 Help :: Reformatting Source Code</a>:</p>\n\n<blockquote>\n  <h2>Basics</h2>\n  \n  <p>IntelliJ IDEA lets you reformat source code to meet the requirements\n  of your code style. IntelliJ IDEA will lay out spacing, indents,\n  keywords etc. Reformatting can apply to the selected text, entire\n  file, or entire project.</p>\n  \n  <p>It is also possible to apply reformatting to the parts of the source\n  code only, using the <a href=\"https://www.jetbrains.com/help/idea/2016.2/code-style.html#formatter_options\" rel=\"noreferrer\">formatting markers</a>.</p>\n  \n  <h2>Reformatting code</h2>\n  \n  <p>To reformat code for a directory, follow these steps:</p>\n  \n  <ol>\n  <li>In the Project tool window, select a module or directory you want to\n  apply your reformatting to.</li>\n  <li><p>From the main menu, select <strong>Code | Reformat\n  Code</strong> or press <code>Ctrl+Alt+L</code>.</p>\n  \n  <p>Alternatively, in the <a href=\"https://www.jetbrains.com/help/idea/2016.2/project-tool-window.html\" rel=\"noreferrer\">Project tool window</a>,\n  right-click the directory and from the context menu, select <strong>Reformat\n  Code</strong>.</p></li>\n  <li>In the <a href=\"https://www.jetbrains.com/help/idea/2016.2/reformat-code-on-directory-dialog.html\" rel=\"noreferrer\">Reformat Code</a> dialog box, specify the necessary options\n  and filters for you reformatting and click <strong>Run</strong>.</li>\n  </ol>\n  \n  <h2>Reformatting code for the current file</h2>\n  \n  <p>To reformat code for the current file, follow these steps:</p>\n  \n  <ol>\n  <li><p>In the editor of the currently opened file, press <code>Ctrl+Shift+Alt+L</code>.</p>\n  \n  <p>Note that if you select <strong>Code | Reformat Code</strong> from the main menu or\n  press <code>Ctrl+Alt+L</code>, IntelliJ IDEA will try to reformat the source code\n  automatically without opening the <a href=\"https://www.jetbrains.com/help/idea/2016.2/reformat-file-dialog.html\" rel=\"noreferrer\">Reformat File</a> dialog.</p></li>\n  <li>In the <a href=\"https://www.jetbrains.com/help/idea/2016.2/reformat-file-dialog.html\" rel=\"noreferrer\">Reformat File</a> dialog, specify options for the reformatting and click\n  Run.</li>\n  </ol>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 17986, "user_id": 4730812, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d336a10204c1cd2e7fa47071ed629669?s=128&d=identicon&r=PG&f=1", "display_name": "piotrek1543", "link": "https://stackoverflow.com/users/4730812/piotrek1543"}, "is_accepted": false, "score": 0, "last_activity_date": 1476534440, "creation_date": 1476534440, "answer_id": 40059014, "question_id": 39512679, "link": "https://stackoverflow.com/questions/39512679/styleguide-settings-for-kotlin/40059014#40059014", "title": "Styleguide settings for Kotlin", "body": "<p>There is discussion on Official Kotlin page: <a href=\"https://discuss.kotlinlang.org/t/official-kotlin-style-guide/213/5\" rel=\"nofollow\">https://discuss.kotlinlang.org/t/official-kotlin-style-guide/213/5</a></p>\n\n<p>The most interesting part of it is @yole answer:</p>\n\n<blockquote>\n  <p>Yes, IntelliJ IDEA <em>does have a built-in formatter</em> for Kotlin code, and\n  we plan to <em>improve it significantly</em> before the release. We do not have\n  any plans to provide any kind of tool that would complain about\n  \"incorrect\" formatting, for any definition of \"incorrect\".</p>\n</blockquote>\n\n<p>Of course, as @IRUS noticed there's also an Github repo, where you can report any issue or problem with Kotlin coding style.</p>\n\n<p>Just follow: <a href=\"https://github.com/yole/kotlin-style-guide\" rel=\"nofollow\">https://github.com/yole/kotlin-style-guide</a></p>\n\n<p>This might be also handful: <a href=\"https://www.jetbrains.com/help/idea/2016.2/code-style.html\" rel=\"nofollow\">https://www.jetbrains.com/help/idea/2016.2/code-style.html</a></p>\n\n<p>Hope it will help</p>\n"}, {"tags": [], "owner": {"reputation": 5406, "user_id": 2308720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6t559.jpg?s=128&g=1", "display_name": "Oleksandr", "link": "https://stackoverflow.com/users/2308720/oleksandr"}, "is_accepted": false, "score": 2, "last_activity_date": 1509702095, "creation_date": 1509702095, "answer_id": 47092561, "question_id": 39512679, "link": "https://stackoverflow.com/questions/39512679/styleguide-settings-for-kotlin/47092561#47092561", "title": "Styleguide settings for Kotlin", "body": "<p>As of today (November 3nd, 2017), there's also the <a href=\"https://android.github.io/kotlin-guides/style.html\" rel=\"nofollow noreferrer\">official Kotlin style guide for Android</a> maintained by Google.</p>\n\n<p>It doesn't have a plugin yet, but there is an issue <a href=\"https://github.com/android/kotlin-guides/issues/2\" rel=\"nofollow noreferrer\">Evaluate providing IntelliJ code style configuration</a> which (I guess) will be solved in the nearest future.</p>\n"}], "owner": {"reputation": 7853, "user_id": 1534407, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/btu16.jpg?s=128&g=1", "display_name": "vtor", "link": "https://stackoverflow.com/users/1534407/vtor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6702, "favorite_count": 2, "answer_count": 3, "score": 17, "last_activity_date": 1509702095, "creation_date": 1473947029, "question_id": 39512679, "link": "https://stackoverflow.com/questions/39512679/styleguide-settings-for-kotlin", "title": "Styleguide settings for Kotlin", "body": "<p>I've started to use Koltin heavily and struggling a bit with code formatting. </p>\n\n<p>Although there is an official <a href=\"http://kotlinlang.org/docs/reference/coding-conventions.html\" rel=\"noreferrer\">coding conventions</a> guide, but I wonder if there is any public available styleguide settings for IntelliJ (such as <a href=\"https://github.com/google/styleguide\" rel=\"noreferrer\">google codestyle</a> for Java) which you can grab/import and use?</p>\n"}]