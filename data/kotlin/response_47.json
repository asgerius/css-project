[{"tags": ["function", "operator-overloading", "kotlin", "jvm-languages", "reification"], "answers": [{"comments": [{"owner": {"reputation": 7656, "user_id": 1938929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/OeAme.png?s=128&g=1", "display_name": "Jire", "link": "https://stackoverflow.com/users/1938929/jire"}, "edited": false, "score": 0, "creation_date": 1449096028, "post_id": 34041140, "comment_id": 55863216, "body": "This is unfortunate :-( Does set have the same problem?"}], "tags": [], "owner": {"reputation": 20424, "user_id": 445715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3824489df267d3bf86bbc678b9745ac4?s=128&d=identicon&r=PG", "display_name": "Andrey Breslav", "link": "https://stackoverflow.com/users/445715/andrey-breslav"}, "is_accepted": true, "score": 4, "last_activity_date": 1449054220, "creation_date": 1449054220, "answer_id": 34041140, "question_id": 34037017, "link": "https://stackoverflow.com/questions/34037017/kotlin-unsupportedoperationexception-for-reified-generic-with-get-set-operator/34041140#34041140", "title": "Kotlin: UnsupportedOperationException for reified generic with get/set operator", "body": "<p>It's a bug: <a href=\"https://youtrack.jetbrains.com/issue/KT-9211\" rel=\"nofollow\">https://youtrack.jetbrains.com/issue/KT-9211</a></p>\n\n<p>As a workaround, use <code>.get(...)</code> instead of <code>[...]</code></p>\n"}], "owner": {"reputation": 7656, "user_id": 1938929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/OeAme.png?s=128&g=1", "display_name": "Jire", "link": "https://stackoverflow.com/users/1938929/jire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1778, "favorite_count": 0, "accepted_answer_id": 34041140, "answer_count": 1, "score": 0, "last_activity_date": 1449054220, "creation_date": 1449040969, "last_edit_date": 1449046301, "question_id": 34037017, "link": "https://stackoverflow.com/questions/34037017/kotlin-unsupportedoperationexception-for-reified-generic-with-get-set-operator", "title": "Kotlin: UnsupportedOperationException for reified generic with get/set operator", "body": "<p>I am trying to convert the functions <code>read</code> and <code>write</code> in my library to operator functions <code>get</code> and <code>set</code>, respectively. My functions use a reified generic type, they are also inline methods. (You can see my library <a href=\"https://github.com/Jire/kotmem\" rel=\"nofollow\">here</a>.)</p>\n\n<p>The compiler has no issue letting me pass and I don't see why using non-operator functions the inference works just fine, yet using operators fails at runtime.</p>\n\n<pre><code>Exception in thread \"main\" java.lang.UnsupportedOperationException: This function has a reified type parameter and thus can only be inlined at compilation time, not called directly.\n    at kotlin.jvm.internal.Intrinsics.throwUndefinedForReified(Intrinsics.java:173)\n    at kotlin.jvm.internal.Intrinsics.throwUndefinedForReified(Intrinsics.java:167)\n    at kotlin.jvm.internal.Intrinsics.reifyJavaClass(Intrinsics.java:201)\n</code></pre>\n\n<p>The code is as follows:</p>\n\n<pre><code>operator inline fun &lt;reified T&gt; get(address: Long): T {\n    ...\n}\n\noperator inline fun &lt;reified T&gt; get(address: Int): T = get(address.toLong())\n\noperator inline fun &lt;reified T&gt; set(address: Long, data: T) {\n   ...\n}\n\noperator inline fun &lt;reified T&gt; set(address: Int, data: T): Unit = set(address.toLong(), data)\n</code></pre>\n\n<p>The interesting part is that I can do this with infix functions just fine, for example:</p>\n\n<pre><code>class Example { infix inline fun &lt;reified T&gt; foo(bar: Int) = Any() as T }\n\nfun main(args: Array&lt;String&gt;) {\n    val example = Example()\n    val foobar: Any = example foo 12345\n}\n</code></pre>\n\n<p>I can also do this with other operators, for example both of these work:</p>\n\n<pre><code>operator inline fun &lt;reified T&gt; minus(bar: Int) = foo&lt;T&gt;(bar)\n\noperator inline fun &lt;reified T&gt; plus(bar: Int) = foo&lt;T&gt;(bar)\n</code></pre>\n\n<p>I also noticed that even <code>invoke</code> works correctly! This is strange since it seems both <code>invoke</code> and <code>get</code> would have identical implementations.</p>\n\n<p><code>operator inline fun &lt;reified T&gt; invoke(bar: Int) = foo&lt;T&gt;(bar)</code></p>\n\n<p>But if I add the following function to example: <code>operator inline fun &lt;reified T&gt; get(bar: Int) = foo&lt;T&gt;(bar)</code> and then try the following call I run into the error: <code>val get: Any = example[12345]</code></p>\n"}, {"tags": ["properties", "kotlin"], "comments": [{"owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "edited": false, "score": 1, "creation_date": 1449060108, "post_id": 34032341, "comment_id": 55840484, "body": "I see no reason for that not to work. Think it&#39;s a bug"}], "answers": [{"comments": [{"owner": {"reputation": 7699, "user_id": 1831151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UXpvY.png?s=128&g=1", "display_name": "eski", "link": "https://stackoverflow.com/users/1831151/eski"}, "edited": false, "score": 1, "creation_date": 1449075522, "post_id": 34045876, "comment_id": 55851726, "body": "I&#39;m wondering about the same question you asked in that ticket, why would the val case work. If you try to reference &#39;a&#39; before it&#39;s initialized in the init block you get the error &#39;Variable &#39;a&#39; must be initialized.&#39; I don&#39;t see any reason it wouldn&#39;t be the same for a var."}, {"owner": {"reputation": 14571, "user_id": 1542343, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/0c67fc696612cc6c62a17d8bb2fdd17f?s=128&d=identicon&r=PG", "display_name": "gvlasov", "link": "https://stackoverflow.com/users/1542343/gvlasov"}, "reply_to_user": {"reputation": 7699, "user_id": 1831151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UXpvY.png?s=128&g=1", "display_name": "eski", "link": "https://stackoverflow.com/users/1831151/eski"}, "edited": false, "score": 0, "creation_date": 1449085970, "post_id": 34045876, "comment_id": 55857863, "body": "@eski You might want to join the discussion at the bug tracker."}], "tags": [], "owner": {"reputation": 14571, "user_id": 1542343, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/0c67fc696612cc6c62a17d8bb2fdd17f?s=128&d=identicon&r=PG", "display_name": "gvlasov", "link": "https://stackoverflow.com/users/1542343/gvlasov"}, "is_accepted": true, "score": 1, "last_activity_date": 1505853373, "last_edit_date": 1505853373, "creation_date": 1449068359, "answer_id": 34045876, "question_id": 34032341, "link": "https://stackoverflow.com/questions/34032341/why-wont-code-that-initializes-a-variable-interface-property-in-init-block-comp/34045876#34045876", "title": "Why won&#39;t code that initializes a variable interface property in init block compile?", "body": "<p><a href=\"http://youtrack.jetbrains.com/issue/KT-10252\" rel=\"nofollow noreferrer\">I reported this as a bug</a>, but turns out this behavior is by design because:</p>\n\n<blockquote>\n  <p>you could have code in the init block that could observe the property in its uninitialized state</p>\n</blockquote>\n"}], "owner": {"reputation": 14571, "user_id": 1542343, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/0c67fc696612cc6c62a17d8bb2fdd17f?s=128&d=identicon&r=PG", "display_name": "gvlasov", "link": "https://stackoverflow.com/users/1542343/gvlasov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 1, "accepted_answer_id": 34045876, "answer_count": 1, "score": 4, "last_activity_date": 1505853373, "creation_date": 1449013108, "last_edit_date": 1449013705, "question_id": 34032341, "link": "https://stackoverflow.com/questions/34032341/why-wont-code-that-initializes-a-variable-interface-property-in-init-block-comp", "title": "Why won&#39;t code that initializes a variable interface property in init block compile?", "body": "<pre><code>interface A {\n    var a: Int\n}\n\nclass AJunior : A {\n    override var a: Int\n\n    init {\n        a = 3\n    }\n}\n</code></pre>\n\n<p>It won't compile because</p>\n\n<blockquote>\n  <p>Property must be initialized or be abstract</p>\n</blockquote>\n\n<p>But it <em>is</em> initialized. I know I can write:</p>\n\n<pre><code>override var a: Int = 3\n</code></pre>\n\n<p>But why won't the first example compile? My guess would be that it is a bug or an intentional limitation to simplify compiler implementation, but I'm not sure.</p>\n"}, {"tags": ["java", "drag-and-drop", "awt", "lwjgl", "kotlin"], "comments": [{"owner": {"reputation": 4016, "user_id": 1460833, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bc4821b9c16457694f503b42831198f1?s=128&d=identicon&r=PG", "display_name": "Sergey Mashkov", "link": "https://stackoverflow.com/users/1460833/sergey-mashkov"}, "edited": false, "score": 0, "creation_date": 1448965437, "post_id": 34016097, "comment_id": 55791225, "body": "The following works well for me: <a href=\"https://gist.github.com/cy6erGn0m/ba1d95d708c9d6195010\" rel=\"nofollow noreferrer\">gist.github.com/cy6erGn0m/ba1d95d708c9d6195010</a>   Perhaps something wrong with the component itself. What the display mounted on ?"}, {"owner": {"reputation": 389, "user_id": 4354023, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/PFCMP.jpg?s=128&g=1", "display_name": "Daniil Dubrovsky", "link": "https://stackoverflow.com/users/4354023/daniil-dubrovsky"}, "reply_to_user": {"reputation": 4016, "user_id": 1460833, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bc4821b9c16457694f503b42831198f1?s=128&d=identicon&r=PG", "display_name": "Sergey Mashkov", "link": "https://stackoverflow.com/users/1460833/sergey-mashkov"}, "edited": false, "score": 0, "creation_date": 1448975633, "post_id": 34016097, "comment_id": 55797425, "body": "Yes, it&#39;s works in Swing based application. But I am writing LWjGL (OpenGL wrapper for Java)  application and don&#39;t have access to JFrame"}], "owner": {"reputation": 389, "user_id": 4354023, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/PFCMP.jpg?s=128&g=1", "display_name": "Daniil Dubrovsky", "link": "https://stackoverflow.com/users/4354023/daniil-dubrovsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 315, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1448961260, "creation_date": 1448959481, "last_edit_date": 1448961260, "question_id": 34016097, "link": "https://stackoverflow.com/questions/34016097/implement-file-dragdrop-with-lwjgl", "title": "Implement file Drag&amp;Drop with LWjGL", "body": "<p>I would like to ask how can i implement file drag and drop with LWjGL. \nI am not quite good with AWT so i tried to search for some code examples and found out that i need to create <code>DropTarget</code> object and provide him a <code>DropTargetListener</code> implementation. I also not sure what i should use as Component, I found <code>Display.getParent()</code> method which gives us a Component but it's usually returns <code>null</code>. I have no idea what to do with my DropTarget object after that</p>\n\n<p>My code (it doesn't seem to work because nothing is printed):</p>\n\n<pre><code>    import java.awt.dnd.*\n    import org.lwjgl.opengl.Display\n\n    ...\n\n    var dropListener =  object : DropTargetListener{\n        override fun drop(dtde: DropTargetDropEvent?) {\n            println(\"drop()\")\n        }\n\n        override fun dragExit(dte: DropTargetEvent?) {\n            println(\"dragExit()\")\n        }\n\n        override fun dropActionChanged(dtde: DropTargetDragEvent?) {\n            println(\"dropActionChanged()\")\n        }\n\n        override fun dragEnter(dtde: DropTargetDragEvent?) {\n            println(\"dragEnter()\")\n        }\n\n        override fun dragOver(dtde: DropTargetDragEvent?) {\n            println(\"dragOver()\")\n        }\n    }\n\n    var dropTarget = DropTarget(Display.getParent(), DnDConstants.ACTION_COPY_OR_MOVE, dropListener, true)\n</code></pre>\n"}, {"tags": ["kotlin"], "comments": [{"owner": {"reputation": 73428, "user_id": 3679676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0faaf44a8922cf165ff73d9efd0dade?s=128&d=identicon&r=PG", "display_name": "Jayson Minard", "link": "https://stackoverflow.com/users/3679676/jayson-minard"}, "edited": false, "score": 0, "creation_date": 1451052863, "post_id": 34010442, "comment_id": 56668894, "body": "Please report this as a bug to the Kotlin issue tracker if you do not find an existing bug that matches.  <a href=\"https://youtrack.jetbrains.com\" rel=\"nofollow noreferrer\">youtrack.jetbrains.com</a>  ... you can then note the bug you created here so others can find it.  Your bug report can be added as an answer to your own question or you can update the question to note the link to the bug."}], "answers": [{"tags": [], "owner": {"reputation": 24586, "user_id": 3255152, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fbd95ef81d0a85310fee8dd46e0f65b0?s=128&d=identicon&r=PG&f=1", "display_name": "mfulton26", "link": "https://stackoverflow.com/users/3255152/mfulton26"}, "is_accepted": true, "score": 2, "last_activity_date": 1449179816, "creation_date": 1449179816, "answer_id": 34076991, "question_id": 34010442, "link": "https://stackoverflow.com/questions/34010442/why-doesnt-smart-cast-handle-this-situation/34076991#34076991", "title": "Why doesn&#39;t smart-cast handle this situation?", "body": "<p>It just isn't as smart as you think it is.</p>\n\n<p>There are a slew of smart cast related issues in IntelliJ IDEA's issue tracking system. e.g. <a href=\"https://youtrack.jetbrains.com/issue/KT-6822\" rel=\"nofollow\">https://youtrack.jetbrains.com/issue/KT-6822</a> which is a subtask of <a href=\"https://youtrack.jetbrains.com/issue/KT-2454\" rel=\"nofollow\">https://youtrack.jetbrains.com/issue/KT-2454</a> which lists other possibly related issues. I would go through those and see if your issue is already tracked or not and, if not, creating one for this and see what comes of it.</p>\n"}], "owner": {"reputation": 33762, "user_id": 16050, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/7e1282298aec568f8bad5afe46cb40b8?s=128&d=identicon&r=PG", "display_name": "sanity", "link": "https://stackoverflow.com/users/16050/sanity"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 629, "favorite_count": 0, "accepted_answer_id": 34076991, "answer_count": 1, "score": 4, "last_activity_date": 1449179816, "creation_date": 1448928820, "question_id": 34010442, "link": "https://stackoverflow.com/questions/34010442/why-doesnt-smart-cast-handle-this-situation", "title": "Why doesn&#39;t smart-cast handle this situation?", "body": "<p>I have some code with a similar structure to this:</p>\n\n<pre><code>private fun test() : Double {\n    val a : Double? = 15.0\n    val b : Double? = 20.0\n    return if (a == null &amp;&amp; b == null) {\n        0\n    } else if (a != null &amp;&amp; b == null) {\n        a\n    } else if (a == null &amp;&amp; b != null) {\n        b\n    } else {\n        a+b\n    }\n}\n</code></pre>\n\n<p>From my understanding, smart casting should infer that in the final 'else' statement, neither a nor b can be null, yet it doesn't seem to infer this which results in an error.</p>\n\n<p>Is there a legitimate reason that smartcasting isn't working in the way I expect here, or is it just not as smart as I think it is?</p>\n"}, {"tags": ["android", "kotlin"], "answers": [{"comments": [{"owner": {"reputation": 574, "user_id": 2123961, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/350a4de4937f98c0ec1c97caad52c510?s=128&d=identicon&r=PG", "display_name": "mradzinski", "link": "https://stackoverflow.com/users/2123961/mradzinski"}, "edited": false, "score": 4, "creation_date": 1491765134, "post_id": 34005063, "comment_id": 73686365, "body": "Agree on the infix, I&#39;ve always found <code>or</code> to be a little bit confusing"}], "tags": [], "owner": {"reputation": 89682, "user_id": 675383, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/6e7a971eb341ffeaa3efca407239bf3b?s=128&d=identicon&r=PG", "display_name": "nhaarman", "link": "https://stackoverflow.com/users/675383/nhaarman"}, "is_accepted": true, "score": 88, "last_activity_date": 1448908950, "last_edit_date": 1448908950, "creation_date": 1448906731, "answer_id": 34005063, "question_id": 34004977, "link": "https://stackoverflow.com/questions/34004977/best-way-to-combine-integer-flags-using-kotlin/34005063#34005063", "title": "Best way to combine integer flags using Kotlin?", "body": "<p>Just use <a href=\"https://kotlinlang.org/docs/reference/basic-types.html#operations\"><code>or</code></a>:</p>\n\n<pre><code>getWindow().getDecorView().setSystemUiVisibility(\n  View.SYSTEM_UI_FLAG_LAYOUT_STABLE or\n  View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION or\n  View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN\n);\n</code></pre>\n\n<p>This may be a little confusing. You can create a little helper extension function <code>with</code> (or whatever) to make it more readable:</p>\n\n<pre><code>infix fun Int.with(x: Int) = this.or(x)\n\ngetWindow().getDecorView().setSystemUiVisibility(\n  View.SYSTEM_UI_FLAG_LAYOUT_STABLE with\n  View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION with\n  View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN\n);\n</code></pre>\n"}], "owner": {"reputation": 493, "user_id": 942737, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JMU7q.jpg?s=128&g=1", "display_name": "whiskeyjoe", "link": "https://stackoverflow.com/users/942737/whiskeyjoe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11310, "favorite_count": 3, "accepted_answer_id": 34005063, "answer_count": 1, "score": 41, "last_activity_date": 1448908950, "creation_date": 1448906382, "last_edit_date": 1448906706, "question_id": 34004977, "link": "https://stackoverflow.com/questions/34004977/best-way-to-combine-integer-flags-using-kotlin", "title": "Best way to combine integer flags using Kotlin?", "body": "<p>In java we regularly combine flags via the | operator.</p>\n\n<p>e.g. </p>\n\n<pre><code>getWindow().getDecorView().setSystemUiVisibility(\n  View.SYSTEM_UI_FLAG_LAYOUT_STABLE | \n  View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION | \n  View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN\n);\n</code></pre>\n\n<p>I can't seem to find the equivalent operator in Kotlin. Anyone know a convenient way to combine integer flags in Kotlin?</p>\n"}, {"tags": ["kotlin", "jvm-languages"], "answers": [{"tags": [], "owner": {"reputation": 25812, "user_id": 288456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf294ff6d86cc587dec43e2af34a9532?s=128&d=identicon&r=PG", "display_name": "Alexander Udalov", "link": "https://stackoverflow.com/users/288456/alexander-udalov"}, "is_accepted": true, "score": 9, "last_activity_date": 1448920214, "last_edit_date": 1448920214, "creation_date": 1448847011, "answer_id": 33990223, "question_id": 33987746, "link": "https://stackoverflow.com/questions/33987746/are-kotlins-reified-types-incorrect-for-primitives-on-the-jvm/33990223#33990223", "title": "Are Kotlin&#39;s reified types incorrect for primitives on the JVM?", "body": "<p>This is somewhat confusing, but the current behavior is by design. This approach has a major benefit compared to the one where we would treat <code>T::class.java</code> as a primitive class. If the function has a parameter of type <code>T</code>, its Java class is always equal to <code>T::class.java</code> at runtime (assuming <code>T</code> is final). This is actually a very sensible thing to expect:</p>\n\n<pre><code>    inline fun &lt;reified T : Any&gt; foo(t: T) {\n        assert(T::class.java == t.javaClass)\n    }\n</code></pre>\n\n<p>This happens because the parameter of a generic type <code>T</code> can only have a reference value at runtime, which is necessarily a boxed value if <code>T</code> is a primitive type.</p>\n\n<p>Also see a thread on the Kotlin forum on this subject: <a href=\"https://devnet.jetbrains.com/thread/475540\" rel=\"nofollow\">https://devnet.jetbrains.com/thread/475540</a></p>\n"}], "owner": {"reputation": 16077, "user_id": 97777, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/fb95aca1c80de718bbfa01447220633b?s=128&d=identicon&r=PG", "display_name": "Duncan McGregor", "link": "https://stackoverflow.com/users/97777/duncan-mcgregor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 990, "favorite_count": 1, "accepted_answer_id": 33990223, "answer_count": 1, "score": 9, "last_activity_date": 1505853464, "creation_date": 1448829184, "last_edit_date": 1505853464, "question_id": 33987746, "link": "https://stackoverflow.com/questions/33987746/are-kotlins-reified-types-incorrect-for-primitives-on-the-jvm", "title": "Are Kotlin&#39;s reified types incorrect for primitives on the JVM?", "body": "<p>If a Kotlin function invocation reifies a primitive, say <code>Int</code>, the 'passed' class is that for the boxed primitive, not the unboxed version.</p>\n\n<pre><code>inline fun &lt;reified T&gt; reify() = T::class\n\n@Test fun reified_type_doesnt_match_for_primitive() {\n    assertNotEquals(Int::class, reify&lt;Int&gt;())\n    assertNotEquals(Int::class.java, reify&lt;Int&gt;().java)\n    assertNotEquals&lt;Any&gt;(Int::class, reify&lt;Int?&gt;())\n\n    val nullableInt: Int? = 42\n    assertNotEquals(nullableInt!!.javaClass.kotlin, reify&lt;Int&gt;())\n\n    assertEquals&lt;Any&gt;(java.lang.Integer::class.java, reify&lt;Int&gt;().java)\n}\n\n@Test fun reified_type_matches_for_class() {\n    assertEquals(String::class, reify&lt;String&gt;())\n}\n</code></pre>\n\n<p>Is this a bug?</p>\n"}, {"tags": ["java", "reflection", "kotlin"], "comments": [{"owner": {"reputation": 25812, "user_id": 288456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf294ff6d86cc587dec43e2af34a9532?s=128&d=identicon&r=PG", "display_name": "Alexander Udalov", "link": "https://stackoverflow.com/users/288456/alexander-udalov"}, "edited": false, "score": 1, "creation_date": 1448790222, "post_id": 33980151, "comment_id": 55718610, "body": "How do you &quot;print <code>type</code>&quot;? Can you paste the full sample? What do you mean by &quot;it shows&quot;?"}, {"owner": {"reputation": 16077, "user_id": 97777, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/fb95aca1c80de718bbfa01447220633b?s=128&d=identicon&r=PG", "display_name": "Duncan McGregor", "link": "https://stackoverflow.com/users/97777/duncan-mcgregor"}, "edited": false, "score": 1, "creation_date": 1448792139, "post_id": 33980151, "comment_id": 55719157, "body": "The answer is yes. Now what&#39;s the question ;-?"}, {"owner": {"reputation": 7656, "user_id": 1938929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/OeAme.png?s=128&g=1", "display_name": "Jire", "link": "https://stackoverflow.com/users/1938929/jire"}, "reply_to_user": {"reputation": 25812, "user_id": 288456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf294ff6d86cc587dec43e2af34a9532?s=128&d=identicon&r=PG", "display_name": "Alexander Udalov", "link": "https://stackoverflow.com/users/288456/alexander-udalov"}, "edited": false, "score": 0, "creation_date": 1448793312, "post_id": 33980151, "comment_id": 55719490, "body": "@AlexanderUdalov I printed via <code>println</code>  @DuncanMcGregor The question has been updated.  The question now contains a link to the actual use case."}, {"owner": {"reputation": 25812, "user_id": 288456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf294ff6d86cc587dec43e2af34a9532?s=128&d=identicon&r=PG", "display_name": "Alexander Udalov", "link": "https://stackoverflow.com/users/288456/alexander-udalov"}, "edited": false, "score": 0, "creation_date": 1448824824, "post_id": 33980151, "comment_id": 55729409, "body": "I still have no idea how to reproduce the problem you&#39;re describing. If I add <code>println(type)</code> to the code above and call <code>read&lt;Boolean&gt;(0L)</code> for example, I get <code>class kotlin.Boolean</code> as expected. Can you please provide the full source code which results in <code>KClassImpl</code> printed and any other information required to reproduce this?"}, {"owner": {"reputation": 7656, "user_id": 1938929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/OeAme.png?s=128&g=1", "display_name": "Jire", "link": "https://stackoverflow.com/users/1938929/jire"}, "reply_to_user": {"reputation": 25812, "user_id": 288456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf294ff6d86cc587dec43e2af34a9532?s=128&d=identicon&r=PG", "display_name": "Alexander Udalov", "link": "https://stackoverflow.com/users/288456/alexander-udalov"}, "edited": false, "score": 0, "creation_date": 1448842104, "post_id": 33980151, "comment_id": 55735140, "body": "@AlexanderUdalov My full project source code is in the question although I don&#39;t think I am clear enough. This question has a unit test: <a href=\"http://stackoverflow.com/questions/33987746/are-kotlins-reified-types-incorrect-for-primitives-on-the-jvm\" title=\"are kotlins reified types incorrect for primitives on the jvm\">stackoverflow.com/questions/33987746/&hellip;</a>"}, {"owner": {"reputation": 25812, "user_id": 288456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf294ff6d86cc587dec43e2af34a9532?s=128&d=identicon&r=PG", "display_name": "Alexander Udalov", "link": "https://stackoverflow.com/users/288456/alexander-udalov"}, "edited": false, "score": 0, "creation_date": 1448843885, "post_id": 33980151, "comment_id": 55735523, "body": "That question concerns how exactly do class literals work for primitive Kotlin classes. This question, on the other hand, is titled &quot;Reflection exposes KClassImpl&quot; which is once again what I&#39;m trying to reproduce. Your project code doesn&#39;t have any <code>println</code>s, and <code>println(type)</code> works as expected, that&#39;s why I was asking you to specify what exactly did you do to make &quot;KClassImpl&quot; appear on the screen."}, {"owner": {"reputation": 25812, "user_id": 288456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf294ff6d86cc587dec43e2af34a9532?s=128&d=identicon&r=PG", "display_name": "Alexander Udalov", "link": "https://stackoverflow.com/users/288456/alexander-udalov"}, "edited": false, "score": 1, "creation_date": 1448844018, "post_id": 33980151, "comment_id": 55735565, "body": "Anyway, most likely you did <code>println(type.javaClass)</code> which would print <code>KClassImpl</code> regardless of how primitive class literals would work in Kotlin, because the Java class of the <i>variable</i> named <code>type</code> is an implementation of <code>KClass</code> (because <code>type</code>&#39;s type is <code>KClass</code>...) which happens to be <code>KClassImpl</code> at runtime."}], "answers": [{"comments": [{"owner": {"reputation": 7656, "user_id": 1938929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/OeAme.png?s=128&g=1", "display_name": "Jire", "link": "https://stackoverflow.com/users/1938929/jire"}, "edited": false, "score": 0, "creation_date": 1448913473, "post_id": 33990368, "comment_id": 55769629, "body": "In this example <a href=\"https://gist.github.com/Jire/63da3cf482bb9f5d4749\" rel=\"nofollow noreferrer\">gist.github.com/Jire/63da3cf482bb9f5d4749</a> where I call read like <code>val example: Int = read(123)</code> it fails the first two if statements and the last succeeds. This is what does not make sense to me."}, {"owner": {"reputation": 25812, "user_id": 288456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf294ff6d86cc587dec43e2af34a9532?s=128&d=identicon&r=PG", "display_name": "Alexander Udalov", "link": "https://stackoverflow.com/users/288456/alexander-udalov"}, "reply_to_user": {"reputation": 7656, "user_id": 1938929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/OeAme.png?s=128&g=1", "display_name": "Jire", "link": "https://stackoverflow.com/users/1938929/jire"}, "edited": false, "score": 0, "creation_date": 1448920642, "post_id": 33990368, "comment_id": 55773482, "body": "Then please ask exactly that next time, because I was trying to figure out why are you observing <code>KClassImpl</code> somewhere, based on the way this question is titled and worded. If you&#39;re no longer observing <code>KClassImpl</code>, then please rephrase the question to stop confusing people who are trying to help. Anyway, I think Duncan&#39;s question and the answer there should help you now."}, {"owner": {"reputation": 7656, "user_id": 1938929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/OeAme.png?s=128&g=1", "display_name": "Jire", "link": "https://stackoverflow.com/users/1938929/jire"}, "edited": false, "score": 0, "creation_date": 1449041915, "post_id": 33990368, "comment_id": 55829490, "body": "First and foremost I want to thank you for helping me with this. Your answer to @DuncanMcGregor did not work even if mapping for example <code>Boolean::class.java</code> to <code>1</code> and then querying for <code>T::class.java</code>. I have since updated my question and it should be more clear."}], "tags": [], "owner": {"reputation": 25812, "user_id": 288456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf294ff6d86cc587dec43e2af34a9532?s=128&d=identicon&r=PG", "display_name": "Alexander Udalov", "link": "https://stackoverflow.com/users/288456/alexander-udalov"}, "is_accepted": false, "score": 3, "last_activity_date": 1448848351, "creation_date": 1448848351, "answer_id": 33990368, "question_id": 33980151, "link": "https://stackoverflow.com/questions/33980151/kotlin-reified-generics-dont-seem-to-work-right-for-hash-equals-comparisons/33990368#33990368", "title": "Kotlin: Reified generics don&#39;t seem to work right for hash/equals comparisons", "body": "<p>Most likely you've written something like <code>println(type.javaClass)</code> which may seem to make sense, but actually doesn't because it always prints <code>class kotlin.reflect.jvm.internal.KClassImpl</code>, since that is the internal implementation class of the <code>KClass</code> interface.</p>\n\n<p>Why does <code>type.javaClass</code> work that way? <code>javaClass</code> is an extension property which gets a runtime Java class of any value passed to it as a receiver. Its signature is:</p>\n\n<pre><code>val &lt;T : Any&gt; T.javaClass: Class&lt;T&gt;\n</code></pre>\n\n<p><code>type</code> is a perfectly valid value of type <code>KClass&lt;T&gt;</code>, so <code>type.javaClass</code>'s resulting type is <code>Class&lt;KClass&lt;T&gt;&gt;</code>. This is already almost entirely meaningless unless you want to introspect symbols of the <code>KClass</code> implementation class. Since <code>type</code> is a <code>KClassImpl</code> instance at runtime, <code>type.javaClass</code> is effectively a <code>Class</code> instance representing the class named <code>kotlin.reflect.jvm.internal.KClassImpl</code>.</p>\n\n<p>This is a bit confusing and definitely not what you wanted to do. If you want to print a class instance to the screen, you can just call <code>println(type)</code>. If you want to obtain a Java <code>Class</code> instance corresponding to the <code>KClass</code> instance you have, you can use the <code>java</code> extension property: <code>type.java</code>. <code>java</code>'s signature is:</p>\n\n<pre><code>val &lt;T : Any&gt; KClass&lt;T&gt;.java: Class&lt;T&gt;\n</code></pre>\n\n<p>So if <code>type</code> is a <code>KClass&lt;T&gt;</code>, then <code>type.java</code> is a <code>Class&lt;T&gt;</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 7656, "user_id": 1938929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/OeAme.png?s=128&g=1", "display_name": "Jire", "link": "https://stackoverflow.com/users/1938929/jire"}, "edited": false, "score": 1, "creation_date": 1449713011, "post_id": 33993753, "comment_id": 56131275, "body": "Thus I should map the Java boxed type&#39;s <code>KClass</code> (e.g. <code>java.lang.Boolean::class</code>) to what I need. Then I can access easily using <code>T::class</code>. (I did this here: <a href=\"https://github.com/Jire/kotmem/blob/master/src/main/kotlin/org/jire/kotmem/DataType.kt\" rel=\"nofollow noreferrer\">github.com/Jire/kotmem/blob/master/src/main/kotlin/org/jire/&zwnj;&#8203;&hellip;</a> )"}], "tags": [], "owner": {"reputation": 16077, "user_id": 97777, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/fb95aca1c80de718bbfa01447220633b?s=128&d=identicon&r=PG", "display_name": "Duncan McGregor", "link": "https://stackoverflow.com/users/97777/duncan-mcgregor"}, "is_accepted": true, "score": 1, "last_activity_date": 1448869906, "last_edit_date": 1495542782, "creation_date": 1448869906, "answer_id": 33993753, "question_id": 33980151, "link": "https://stackoverflow.com/questions/33980151/kotlin-reified-generics-dont-seem-to-work-right-for-hash-equals-comparisons/33993753#33993753", "title": "Kotlin: Reified generics don&#39;t seem to work right for hash/equals comparisons", "body": "<p>I believe that the key types in your Map are <code>KClass</code> instances for the primitive types (Java int rather than Integer). The reified type in the function is the <code>KClass</code> instance for the boxed type (Integer), as seen in <a href=\"https://stackoverflow.com/questions/33987746/are-kotlins-reified-types-incorrect-for-primitives-on-the-jvm\">Are Kotlin&#39;s reified types incorrect for primitives on the JVM?</a></p>\n\n<p>Whilst these two <code>KClass</code>s print as the same thing, they are not equal, so your lookup fails.</p>\n"}], "owner": {"reputation": 7656, "user_id": 1938929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/OeAme.png?s=128&g=1", "display_name": "Jire", "link": "https://stackoverflow.com/users/1938929/jire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 952, "favorite_count": 1, "accepted_answer_id": 33993753, "answer_count": 2, "score": 5, "last_activity_date": 1449546503, "creation_date": 1448779184, "last_edit_date": 1449546503, "question_id": 33980151, "link": "https://stackoverflow.com/questions/33980151/kotlin-reified-generics-dont-seem-to-work-right-for-hash-equals-comparisons", "title": "Kotlin: Reified generics don&#39;t seem to work right for hash/equals comparisons", "body": "<p>I have a map of <code>KClass</code> to <code>Int</code>. I then have a function which has a reified generic type. I'd then expect the following situation, thus, to give me the <code>Int</code> associated with <code>Boolean::class</code></p>\n\n<pre><code>val kclassToInt = mapOf(Boolean::class to 1, Byte::class to 1, Short::class to 2)\n\ninline fun &lt;reified T&gt; myExpectations() =\n        assertEquals(1, kclassToInt.getRaw(T::class), \"Why doesn't it work? :'(\")\n</code></pre>\n\n<p>I'm greeted with <code>Why doesn't it work? :'(. Expected &lt;1&gt;, actual &lt;null&gt;.</code> from a call to it like this <code>myExpectations&lt;Boolean&gt;()</code>.</p>\n\n<p>I then tried to use <code>.java</code> off, so I was using Java's <code>Class</code> rather than Kotlin's <code>KClass</code>.</p>\n\n<pre><code>val classToInt = mapOf(Boolean::class.java to 1, Byte::class.java to 1, Short::class.java to 2)\n\ninline fun &lt;reified T : Any&gt; anotherExpectation() =\n        assertEquals(1, classToInt.getRaw(T::class.java))\n</code></pre>\n\n<p>This time I was again greeted by assertion error: <code>java.lang.AssertionError: Expected &lt;1&gt;, actual &lt;null&gt;.</code></p>\n\n<p>Finally I tried using <code>.javaClass</code> rather than <code>.java</code>:</p>\n\n<pre><code>val javaClassToInt = mapOf(Boolean::class.javaClass to 1, Byte::class.javaClass to 1, Short::class.javaClass to 2)\n\ninline fun &lt;reified T&gt; pleaseWork() =\n        assertEquals(1, javaClassToInt.getRaw(T::class.javaClass))\n</code></pre>\n\n<p>This time it was really strange. I was greeted with this: <code>java.lang.AssertionError: Expected &lt;1&gt;, actual &lt;2&gt;.</code> This seems to be because all <code>.javaClass</code> refer to <code>KClassImpl</code>.</p>\n\n<p>Finally I resorted to what I didn't want to do, use <code>.qualifiedName</code>:</p>\n\n<pre><code>val qnToInt = mapOf(Boolean::class.qualifiedName to 1, Byte::class.qualifiedName to 1, Short::class.qualifiedName to 2)\n\ninline fun &lt;reified T&gt; iKnowItWorks() =\n        assertEquals(1, qnToInt.getRaw(T::class.qualifiedName))\n</code></pre>\n\n<p>Which of course works and is what I use in my actual use case: <a href=\"https://github.com/Jire/kotmem/blob/master/src/main/kotlin/org/jire/kotmem/Process.kt\" rel=\"nofollow\">https://github.com/Jire/kotmem/blob/master/src/main/kotlin/org/jire/kotmem/Process.kt</a></p>\n"}, {"tags": ["kotlin"], "answers": [{"comments": [{"owner": {"reputation": 2667, "user_id": 3358488, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6804ecef4a62a5536c875a22733d6594?s=128&d=identicon&r=PG&f=1", "display_name": "user118967", "link": "https://stackoverflow.com/users/3358488/user118967"}, "edited": false, "score": 1, "creation_date": 1593318571, "post_id": 33997612, "comment_id": 110735154, "body": "In 2020 I am getting this error and this solution did not work for me."}], "tags": [], "owner": {"reputation": 2951, "user_id": 916370, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0eea76e95785761bee36ffcc0bdd7b33?s=128&d=identicon&r=PG", "display_name": "goodwinnk", "link": "https://stackoverflow.com/users/916370/goodwinnk"}, "is_accepted": true, "score": 10, "last_activity_date": 1448971994, "last_edit_date": 1448971994, "creation_date": 1448883069, "answer_id": 33997612, "question_id": 33979322, "link": "https://stackoverflow.com/questions/33979322/kotlin-error-could-not-find-or-load-main-class-defaultpackage/33997612#33997612", "title": "Kotlin - Error: Could not find or load main class _DefaultPackage", "body": "<p>This was a severe bug (<a href=\"https://youtrack.jetbrains.com/issue/KT-10221\" rel=\"noreferrer\">KT-10221</a>) in automatic generation of Launch Configuration in plugin version 0.4.0. It was fixed in 0.5.0 so the recommendend way to workaround is to update plugin.</p>\n\n<p>The source of the problem was that the plugin used an old pattern for generating name of the class for main function that had been abandoned by Kotlin compiler. </p>\n\n<p>It's possible to workaround it by editing launch configuration (<em>Eclipse Menu -> Run -> Run Configurations...</em>) by hand and changing <em>Main class</em> field in <em>Java Application</em> group. If the file is named <em>hello.kt</em> with no package directive, as it is described in tutorial, than corrected string should be <strong>HelloKt</strong>. </p>\n\n<p>If file has name <em>other.kt</em> with package <em>my.tutorial</em> than the <em>Main Class</em> should contain <em>my.tutorial.HelloKt</em>. You can read more about it in the section <a href=\"http://kotlinlang.org/docs/reference/java-to-kotlin-interop.html#package-level-functions\" rel=\"noreferrer\">Package-Level Functions</a> of <em>Calling Kotlin From Java</em> page.</p>\n"}, {"comments": [{"owner": {"reputation": 2667, "user_id": 3358488, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6804ecef4a62a5536c875a22733d6594?s=128&d=identicon&r=PG&f=1", "display_name": "user118967", "link": "https://stackoverflow.com/users/3358488/user118967"}, "edited": false, "score": 0, "creation_date": 1593318794, "post_id": 45140260, "comment_id": 110735197, "body": "I don&#39;t see these options in Eclipse 2018-12."}], "tags": [], "owner": {"reputation": 1268, "user_id": 815627, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5ab5720f16295983ed87acad08143bc0?s=128&d=identicon&r=PG", "display_name": "mdev", "link": "https://stackoverflow.com/users/815627/mdev"}, "is_accepted": false, "score": 3, "last_activity_date": 1500283003, "creation_date": 1500283003, "answer_id": 45140260, "question_id": 33979322, "link": "https://stackoverflow.com/questions/33979322/kotlin-error-could-not-find-or-load-main-class-defaultpackage/45140260#45140260", "title": "Kotlin - Error: Could not find or load main class _DefaultPackage", "body": "<p>I have been getting the same issue. And after putting the right compiler output path, it got resolved.</p>\n\n<p><code>Go to Project -&gt; Project Compiler output :\nIn the text box, fill this:\n[Absolute Path]/{Project Name}/out</code></p>\n"}, {"tags": [], "owner": {"reputation": 1131, "user_id": 624341, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/aoyVF.jpg?s=128&g=1", "display_name": "Igor Rodriguez", "link": "https://stackoverflow.com/users/624341/igor-rodriguez"}, "is_accepted": false, "score": 2, "last_activity_date": 1510929091, "creation_date": 1510929091, "answer_id": 47353011, "question_id": 33979322, "link": "https://stackoverflow.com/questions/33979322/kotlin-error-could-not-find-or-load-main-class-defaultpackage/47353011#47353011", "title": "Kotlin - Error: Could not find or load main class _DefaultPackage", "body": "<p>In my case I was having this problem while trying to run the program using the Application Gradle plugin. The problem was in the <code>mainClassName</code> property using single quotes instead of double ones</p>\n\n<p>This didn't work:</p>\n\n<pre><code>mainClassName = 'demo.HelloWorldKt'\n</code></pre>\n\n<p>With double quotes, it works: </p>\n\n<pre><code>mainClassName = \"demo.HelloWorldKt\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 430, "user_id": 4887314, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Lq5D0UzVGBo/AAAAAAAAAAI/AAAAAAAAHsg/CG-ByHArkqs/photo.jpg?sz=128", "display_name": "Invest", "link": "https://stackoverflow.com/users/4887314/invest"}, "is_accepted": false, "score": 1, "last_activity_date": 1549986317, "creation_date": 1549986317, "answer_id": 54653808, "question_id": 33979322, "link": "https://stackoverflow.com/questions/33979322/kotlin-error-could-not-find-or-load-main-class-defaultpackage/54653808#54653808", "title": "Kotlin - Error: Could not find or load main class _DefaultPackage", "body": "<p>For me it worked after I installed the correct JDK. I first had JDK 11 but the tutorial I did was with JDK 8 so after I installed this and set it in the \"installed JREs\" options it found the main class without having any \"mainClassName\" or any other option in the build.gradle file.</p>\n"}, {"tags": [], "owner": {"reputation": 91, "user_id": 2679477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12a8f2c7e64f7d276c4f3381e3d102d2?s=128&d=identicon&r=PG&f=1", "display_name": "David Karla", "link": "https://stackoverflow.com/users/2679477/david-karla"}, "is_accepted": false, "score": 0, "last_activity_date": 1580920255, "creation_date": 1580920255, "answer_id": 60080162, "question_id": 33979322, "link": "https://stackoverflow.com/questions/33979322/kotlin-error-could-not-find-or-load-main-class-defaultpackage/60080162#60080162", "title": "Kotlin - Error: Could not find or load main class _DefaultPackage", "body": "<p>For me, it worked in a fresh eclipse workspace. Possibly, the Kotlin eclipse plugin is not playing well with other plugins (in my case, PyDev).</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 7767356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7894f9c079818d45245acaa0e2a4c5ba?s=128&d=identicon&r=PG&f=1", "display_name": "Legionary", "link": "https://stackoverflow.com/users/7767356/legionary"}, "is_accepted": false, "score": 0, "last_activity_date": 1585785846, "creation_date": 1585785846, "answer_id": 60982257, "question_id": 33979322, "link": "https://stackoverflow.com/questions/33979322/kotlin-error-could-not-find-or-load-main-class-defaultpackage/60982257#60982257", "title": "Kotlin - Error: Could not find or load main class _DefaultPackage", "body": "<p>I'm creating a Kotlin Application with JavaFX and I had this issue until I went to:\n  Run > Run Configurations > Java Application > Common\nI unticked \"Allocate console\" and it fixed the issue.</p>\n"}], "owner": {"reputation": 660, "user_id": 3924873, "user_type": "registered", "accept_rate": 78, "profile_image": "https://graph.facebook.com/1805002242/picture?type=large", "display_name": "Francis Fredrick Valero", "link": "https://stackoverflow.com/users/3924873/francis-fredrick-valero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 18870, "favorite_count": 1, "accepted_answer_id": 33997612, "answer_count": 6, "score": 13, "last_activity_date": 1585785846, "creation_date": 1448770227, "question_id": 33979322, "link": "https://stackoverflow.com/questions/33979322/kotlin-error-could-not-find-or-load-main-class-defaultpackage", "title": "Kotlin - Error: Could not find or load main class _DefaultPackage", "body": "<p>I followed the Kotlin tutorial for eclipse here : <a href=\"https://kotlinlang.org/docs/tutorials/getting-started-eclipse.html\" rel=\"noreferrer\">Getting Started With Eclipse Luna</a></p>\n\n<p>However, I'm running into this error: </p>\n\n<pre><code>Error: Could not find or load main class _DefaultPackage\n</code></pre>\n\n<p>Anyone who knows to get around this?</p>\n"}, {"tags": ["android", "kotlin", "anko"], "comments": [{"owner": {"reputation": 35078, "user_id": 615306, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/5a11940d70233031c01ead6c0b62c990?s=128&d=identicon&r=PG", "display_name": "Kirill Rakhman", "link": "https://stackoverflow.com/users/615306/kirill-rakhman"}, "edited": false, "score": 4, "creation_date": 1448755978, "post_id": 33977484, "comment_id": 55712278, "body": "It seems like a bug. I filed an issue here: <a href=\"https://youtrack.jetbrains.com/issue/KT-10219\" rel=\"nofollow noreferrer\">youtrack.jetbrains.com/issue/KT-10219</a>"}], "answers": [{"tags": [], "owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "is_accepted": true, "score": 1, "last_activity_date": 1452865360, "creation_date": 1452865360, "answer_id": 34812427, "question_id": 33977484, "link": "https://stackoverflow.com/questions/33977484/anko-inner-scope-of-apply-confusing-property-resolution/34812427#34812427", "title": "Anko: inner scope of apply, confusing property resolution", "body": "<p>It was actually a bug in scoping.</p>\n\n<p>The <a href=\"https://youtrack.jetbrains.com/issue/KT-10219#tab=Changes\" rel=\"nofollow\">corresponding issue</a> has been marked as fixed, so the fix is likely to appear in the next release.</p>\n"}], "owner": {"reputation": 110088, "user_id": 2196460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mAcQx.png?s=128&g=1", "display_name": "hotkey", "link": "https://stackoverflow.com/users/2196460/hotkey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 290, "favorite_count": 0, "accepted_answer_id": 34812427, "answer_count": 1, "score": 5, "last_activity_date": 1452865360, "creation_date": 1448751991, "last_edit_date": 1448752687, "question_id": 33977484, "link": "https://stackoverflow.com/questions/33977484/anko-inner-scope-of-apply-confusing-property-resolution", "title": "Anko: inner scope of apply, confusing property resolution", "body": "<p>I'm writing an Android layout using Anko DSL.\nWhen defining a <code>TextView</code>, I wanted to make it center-aligned, so I wrote this:</p>\n\n<pre><code>verticalLayout {\n    textView(R.string.txt_greeting).apply {\n        gravity = Gravity.CENTER_HORIZONTAL // &lt;- this should have changed the alignment\n        textSize = 20.0f\n    }\n    //...\n}\n</code></pre>\n\n<p>But the alignment didn't change. In debugger I saw that gravity is set for the <code>LinearLayout</code> which is the <code>TextView</code>'s parent. </p>\n\n<p>Changing the statement to either</p>\n\n<pre><code>textView(R.string.txt_greeting).let { it.gravity = Gravity.CENTER_HORIZONTAL }\n</code></pre>\n\n<p>and </p>\n\n<pre><code>textView(R.string.txt_greeting).apply { this@apply.gravity = Gravity.CENTER_HORIZONTAL }\n</code></pre>\n\n<p>and even</p>\n\n<pre><code>textView(R.string.txt_greeting).apply { this.gravity = Gravity.CENTER_HORIZONTAL }\n</code></pre>\n\n<p>solves the problem, thus in the original code implicit <code>this</code> is definitely resolved to <code>this@verticalLayout</code>.</p>\n\n<p>Why does this happen? </p>\n\n<p>Do I misunderstand something in Kotlin lambdas or is it a bug in Kotlin or Anko?</p>\n"}, {"tags": ["java", "generics", "casting", "kotlin"], "answers": [{"comments": [{"owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "edited": false, "score": 0, "creation_date": 1448789781, "post_id": 33976325, "comment_id": 55718498, "body": "shouldn&#39;t the compiler complain that a type parameter shadowed <code>LocalDateTime</code>?"}, {"owner": {"reputation": 7027, "user_id": 1437402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fbbcf2a192382575c5cdd4d1a0e98a0?s=128&d=identicon&r=PG", "display_name": "Edvin Syse", "link": "https://stackoverflow.com/users/1437402/edvin-syse"}, "reply_to_user": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "edited": false, "score": 0, "creation_date": 1448812354, "post_id": 33976325, "comment_id": 55724895, "body": "It doesn&#39;t, but I don&#39;t think that happens in Java either. My class didn&#39;t even have an import for java.time.LocalDateTime, so there was really no way the compiler could know that. However, even with an import it doesn&#39;t complain."}, {"owner": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "edited": false, "score": 0, "creation_date": 1448815941, "post_id": 33976325, "comment_id": 55726067, "body": "would you care fill a feature request for such a warning? It could save someone quite a time"}, {"owner": {"reputation": 7027, "user_id": 1437402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fbbcf2a192382575c5cdd4d1a0e98a0?s=128&d=identicon&r=PG", "display_name": "Edvin Syse", "link": "https://stackoverflow.com/users/1437402/edvin-syse"}, "reply_to_user": {"reputation": 25728, "user_id": 3144601, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/94FMr.jpg?s=128&g=1", "display_name": "voddan", "link": "https://stackoverflow.com/users/3144601/voddan"}, "edited": false, "score": 0, "creation_date": 1448997554, "post_id": 33976325, "comment_id": 55811939, "body": "I&#39;m thinking that there must be a reason why this isn&#39;t implemented in javac already. Most of the time, you might not have an import, so the use case is pretty slim I think."}], "tags": [], "owner": {"reputation": 7027, "user_id": 1437402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fbbcf2a192382575c5cdd4d1a0e98a0?s=128&d=identicon&r=PG", "display_name": "Edvin Syse", "link": "https://stackoverflow.com/users/1437402/edvin-syse"}, "is_accepted": false, "score": 2, "last_activity_date": 1448743807, "creation_date": 1448743807, "answer_id": 33976325, "question_id": 33976196, "link": "https://stackoverflow.com/questions/33976196/why-does-this-type-need-explicit-cast/33976325#33976325", "title": "Why does this type need explicit cast?", "body": "<p>Just figured it out, newbie mistake. The LocalDateTime type parameter is just an alias. The correct declaration would be:</p>\n\n<pre><code>fun &lt;S&gt; TableColumn&lt;S, LocalDateTime&gt;.formatAsDateTime() =\n    cellFormat { text = dateTimeFormatter.format(it) }\n</code></pre>\n"}], "owner": {"reputation": 7027, "user_id": 1437402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fbbcf2a192382575c5cdd4d1a0e98a0?s=128&d=identicon&r=PG", "display_name": "Edvin Syse", "link": "https://stackoverflow.com/users/1437402/edvin-syse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 289, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1448743807, "creation_date": 1448742959, "question_id": 33976196, "link": "https://stackoverflow.com/questions/33976196/why-does-this-type-need-explicit-cast", "title": "Why does this type need explicit cast?", "body": "<p>I've created an extension function to JavaFX TableColumn that makes it more concise to implement a cellFactory without the repetetive boilerplate. The extension function is defined like this:</p>\n\n<pre><code>inline fun &lt;S, T&gt; TableColumn&lt;S, T&gt;.cellFormat(crossinline formatter: (TableCell&lt;S, T&gt;.(T) -&gt; Unit)) {\n    cellFactory = Callback { column: TableColumn&lt;S, T&gt; -&gt;\n        object : TableCell&lt;S, T&gt;() {\n            override fun updateItem(item: T, empty: Boolean) {\n                super.updateItem(item, empty)\n\n                if (item == null || empty) {\n                    text = null\n                    graphic = null\n                } else {\n                    formatter(this, item)\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>To format a TableCell I only need to define what should happen in TableCell.updateItem when there is a non-null item available for the current cell. To format a LocalDateTime for example, I can now write:</p>\n\n<pre><code>column.cellFormat { text = DateTimeFormatter.ISO_DATE_TIME.format(it) }\n</code></pre>\n\n<p>I then went on to define another extension that does just this, so I can just write:</p>\n\n<pre><code>column.formatAsDateTime()\n</code></pre>\n\n<p>This function uses the first function, like this:</p>\n\n<pre><code>fun &lt;S, LocalDateTime&gt; TableColumn&lt;S, LocalDateTime&gt;.formatAsDateTime() =\n    cellFormat { value -&gt;\n        text = DateTimeFormatter.ISO_DATE_TIME.format(value as TemporalAccessor)\n    }\n</code></pre>\n\n<p>My question is why I have to cast the LocalDateTime to TemporalAccessor?</p>\n\n<p>My first attempt was:</p>\n\n<pre><code>text = DateTimeFormatter.ISO_DATE_TIME.format(value)\n</code></pre>\n\n<p>The compiler complains:</p>\n\n<blockquote>\n  <p>Type mismatch: inferred type is LocalDateTime but java.time.TemporalAccessor! was expected</p>\n</blockquote>\n\n<p>Granted, the DateTimeFormatter#format function takes a TemporalAccessor, not a LocalDateTime, but LocalDateTime does indeed implement TemporalAccessor (via Temporal).</p>\n\n<p>The cast to TemporalAccessor is only needed in the formatAsDateTime extension function, not when using cellFormat directly from the call site.</p>\n\n<p>Shouldn't Kotlin be able to perform this smart cast automatically?</p>\n"}, {"tags": ["maven", "spring-boot", "integration-testing", "kotlin"], "comments": [{"owner": {"reputation": 26227, "user_id": 1429387, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/LVOVA.jpg?s=128&g=1", "display_name": "naXa", "link": "https://stackoverflow.com/users/1429387/naxa"}, "edited": false, "score": 0, "creation_date": 1448700955, "post_id": 33969442, "comment_id": 55695670, "body": "I&#39;ve just found that <a href=\"http://blog.jetbrains.com/kotlin/2014/10/m9-is-here/#comment-26342\" rel=\"nofollow noreferrer\">maven kotlin plugin does not support incremental build</a>..."}], "answers": [{"comments": [{"owner": {"reputation": 7454, "user_id": 1418097, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/647fd44358712b7e73d70ae66daec14e?s=128&d=identicon&r=PG", "display_name": "Display Name", "link": "https://stackoverflow.com/users/1418097/display-name"}, "edited": false, "score": 0, "creation_date": 1451668320, "post_id": 34005791, "comment_id": 56859553, "body": "I&#39;m still experiencing something very similar to this bug. Which version should have the fix? I&#39;m using <code>kotlin-plugin-1.0.0-beta-1038-IJ143-19</code> I think."}], "tags": [], "owner": {"reputation": 4016, "user_id": 1460833, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bc4821b9c16457694f503b42831198f1?s=128&d=identicon&r=PG", "display_name": "Sergey Mashkov", "link": "https://stackoverflow.com/users/1460833/sergey-mashkov"}, "is_accepted": true, "score": 2, "last_activity_date": 1448909471, "creation_date": 1448909471, "answer_id": 34005791, "question_id": 33969442, "link": "https://stackoverflow.com/questions/33969442/kotlin-running-an-integration-test-error-fun-main-is-already-defined/34005791#34005791", "title": "Kotlin - running an integration test, error `fun main is already defined`", "body": "<p>It is a bug (<a href=\"https://youtrack.jetbrains.com/issue/KT-10051\" rel=\"nofollow\">https://youtrack.jetbrains.com/issue/KT-10051</a>). Already fixed and the fix will be delivered very soon</p>\n"}], "owner": {"reputation": 26227, "user_id": 1429387, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/LVOVA.jpg?s=128&g=1", "display_name": "naXa", "link": "https://stackoverflow.com/users/1429387/naxa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 441, "favorite_count": 0, "accepted_answer_id": 34005791, "answer_count": 1, "score": 1, "last_activity_date": 1448909471, "creation_date": 1448700713, "question_id": 33969442, "link": "https://stackoverflow.com/questions/33969442/kotlin-running-an-integration-test-error-fun-main-is-already-defined", "title": "Kotlin - running an integration test, error `fun main is already defined`", "body": "<p>I have written an integration test for a Web application but I don't know how to run this test. Maven build fails with the following error when I execute <code>mvn test</code></p>\n\n<pre><code>[INFO] Compiling Kotlin sources from [src/main/kotlin]\n[INFO] Classpath: &lt;...&gt;\n[INFO] Classes directory is &lt;...&gt;\\target\\classes\n[INFO] Module name is demo\n[ERROR] &lt;...&gt;\\src\\main\\kotlin\\demo\\Application.kt: (9, 1) 'public fun main(args: kotlin.Array&lt;kotlin.String&gt;): kotlin.Unit' is already defined in demo\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n</code></pre>\n\n<p>Here is my main class (Application.kt)</p>\n\n<pre><code>package demo\n\nimport org.springframework.boot.SpringApplication\nimport org.springframework.boot.autoconfigure.SpringBootApplication\n\n@SpringBootApplication\nopen class Application\n\nfun main(args: Array&lt;String&gt;) {\n    SpringApplication.run(Application::class.java, *args)\n}\n</code></pre>\n\n<p>Here is a part of my test class</p>\n\n<pre><code>package demo\n\nimport org.junit.runner.RunWith\nimport org.springframework.boot.test.SpringApplicationConfiguration\nimport org.springframework.boot.test.WebIntegrationTest\nimport org.springframework.test.context.junit4.SpringJUnit4ClassRunner\nimport demo.Application\nimport demo.model.City\nimport demo.repository.CityRepository\n\n@RunWith(SpringJUnit4ClassRunner.class)\n@SpringApplicationConfiguration(classes = Application.class)\n@WebIntegrationTest({\"server.port=8080\"})\nclass CityControllerTest {\n    @Autowired\n    private var cityRepository: CityRepository?\n    private val restTemplate: RestTemplate = TestRestTemplate()\n    // ...\n}\n</code></pre>\n\n<p>There is no such error when I execute <code>mvn clean test</code>. So I suppose Kotlin is frightened of previously compiled classes. Though I am very unsure...</p>\n\n<p>What is the right way to run an integration test?</p>\n"}, {"tags": ["kotlin"], "answers": [{"tags": [], "owner": {"reputation": 25812, "user_id": 288456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf294ff6d86cc587dec43e2af34a9532?s=128&d=identicon&r=PG", "display_name": "Alexander Udalov", "link": "https://stackoverflow.com/users/288456/alexander-udalov"}, "is_accepted": true, "score": 17, "last_activity_date": 1448675753, "creation_date": 1448675753, "answer_id": 33966869, "question_id": 33966186, "link": "https://stackoverflow.com/questions/33966186/how-to-delegate-implementation-to-a-property-in-kotlin/33966869#33966869", "title": "How to delegate implementation to a property in Kotlin?", "body": "<p>This is not currently possible. The expression in the <code>by</code>-clause is computed only once before the construction of the class, so you cannot reference symbols of that class.</p>\n\n<p>There is a <a href=\"https://youtrack.jetbrains.com/issue/KT-83\">request in the issue tracker</a> to allow this, although it's almost definitely not going to be supported in Kotlin 1.0.</p>\n\n<p>One funny workaround that <em>sometimes</em> works is to make the property which you want to be a delegate, a constructor parameter with the default value instead. That way it'll be accessible both in the <code>by</code>-clause and in the class body:</p>\n\n<pre><code>class Foo(val xs: List&lt;Int&gt; = ArrayList&lt;Int&gt;()) : List&lt;Int&gt; by xs {\n    fun bar() {\n        println(xs)\n    }\n}\n</code></pre>\n\n<p>Keep in mind though that <code>xs</code> in <code>by xs</code> is still calculated only once here, so even if <code>xs</code> is a <code>var</code> property, only the default value provided in the constructor will be used. It's not a universal solution, but sometimes it can help.</p>\n"}, {"comments": [{"owner": {"reputation": 7656, "user_id": 1938929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/OeAme.png?s=128&g=1", "display_name": "Jire", "link": "https://stackoverflow.com/users/1938929/jire"}, "edited": false, "score": 0, "creation_date": 1449045711, "post_id": 33971677, "comment_id": 55831324, "body": "I&#39;m curious about why this deprecation happened. I receive the same in cases like this. What is the motivation?"}], "tags": [], "owner": {"reputation": 945, "user_id": 1055786, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/d789d6ff09543bac5699d0a365a59d98?s=128&d=identicon&r=PG", "display_name": "Marcin Kaczmarek", "link": "https://stackoverflow.com/users/1055786/marcin-kaczmarek"}, "is_accepted": false, "score": 6, "last_activity_date": 1450210128, "last_edit_date": 1450210128, "creation_date": 1448716264, "answer_id": 33971677, "question_id": 33966186, "link": "https://stackoverflow.com/questions/33966186/how-to-delegate-implementation-to-a-property-in-kotlin/33971677#33971677", "title": "How to delegate implementation to a property in Kotlin?", "body": "<p>Expanding on the answer of Alexander Udalov, I came up with a solution using a private base class</p>\n\n<pre><code>private open class FooBase(protected val xs : MutableList&lt;Int&gt;) : List&lt;Int&gt; by xs { }\n\nclass Foo() : FooBase(ArrayList()) {\n    fun bar() {\n        xs.add(5)\n    }\n}\n</code></pre>\n\n<p>Now I can have access to the property backing my interface implementation but am not restricted to operations provided by that interface while still hiding the actual implementation from the user.</p>\n\n<p><strong>Note:</strong> Although it works, I get the following warning from IntelliJ IDEA 15 CE which arises from <code>EXPOSED_SUPER_CLASS</code> inspection: <em>Deprecated: subclass effective visibility 'public' should be the same or less permissive than its superclass effective visibility 'private'</em>. I'm not quite sure what the <em>deprecated</em> part here means \u2013 whether the warning will be removed in the future or this won't compile at some point. Anyway, we don't really have to use a <code>private open</code> class, <code>abstract</code> or simply <code>open</code> will do, because even if the user is allowed to create an instance of <code>FooBase</code>, there is not much he can do with it.</p>\n\n<h2>Update:</h2>\n\n<p>There is actualy a simple and compact solution that does not use any suspicious behaviour:</p>\n\n<pre><code>class Foo private constructor(private val xs: ArrayList&lt;Int&gt;) : List&lt;Int&gt; by xs {\n    constructor() : this(ArrayList&lt;Int&gt;()) { }\n}\n</code></pre>\n"}], "owner": {"reputation": 945, "user_id": 1055786, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/d789d6ff09543bac5699d0a365a59d98?s=128&d=identicon&r=PG", "display_name": "Marcin Kaczmarek", "link": "https://stackoverflow.com/users/1055786/marcin-kaczmarek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1974, "favorite_count": 4, "accepted_answer_id": 33966869, "answer_count": 2, "score": 23, "last_activity_date": 1450210128, "creation_date": 1448668568, "last_edit_date": 1448716653, "question_id": 33966186, "link": "https://stackoverflow.com/questions/33966186/how-to-delegate-implementation-to-a-property-in-kotlin", "title": "How to delegate implementation to a property in Kotlin?", "body": "<p>Kotlin enables me to implement an interface by delegating to a primary constructor argument like so:</p>\n\n<pre><code>class Foo(xs : ArrayList&lt;Int&gt;) : List&lt;Int&gt; by xs { }\n</code></pre>\n\n<p>But this exhibits the backing implementer to the user. Delegating to an anonymous also seems to be ok:</p>\n\n<pre><code>class Foo() : List&lt;Int&gt; by ArrayList&lt;Int&gt;() { }\n</code></pre>\n\n<p>This hides the implementation details, but we loose access to features not provided by the interface, which in this case is mutability.</p>\n\n<p>I would therefore like to delegate the implementation to a property that is not in the primary constructor. What I would like to have is similar to</p>\n\n<pre><code>class Foo() : List&lt;Int&gt; by xs {\n    val xs : List&lt;Int&gt; = ArrayList&lt;Int&gt;()\n}\n</code></pre>\n\n<p>which doesn't compile.</p>\n\n<p>Is it possible to have a property defined explicitly in the class body and still be able to delegate implementation to it?</p>\n"}, {"tags": ["java", "arrays", "jna", "kotlin", "psapi"], "comments": [{"owner": {"reputation": 25812, "user_id": 288456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf294ff6d86cc587dec43e2af34a9532?s=128&d=identicon&r=PG", "display_name": "Alexander Udalov", "link": "https://stackoverflow.com/users/288456/alexander-udalov"}, "edited": false, "score": 1, "creation_date": 1448620217, "post_id": 33950973, "comment_id": 55668566, "body": "Kotlin arrays <i>are</i> Java arrays. Have you tried passing a <code>WinDef.HMODULE[]</code> in Java? I&#39;m not sure JNA supports that..."}], "answers": [{"comments": [{"owner": {"reputation": 7656, "user_id": 1938929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/OeAme.png?s=128&g=1", "display_name": "Jire", "link": "https://stackoverflow.com/users/1938929/jire"}, "edited": false, "score": 0, "creation_date": 1448761499, "post_id": 33956352, "comment_id": 55713399, "body": "Thanks. Here is the solution in Kotlin: <a href=\"https://gist.github.com/Jire/9d6360068efcefc86756\" rel=\"nofollow noreferrer\">gist.github.com/Jire/9d6360068efcefc86756</a>"}], "tags": [], "owner": {"reputation": 9289, "user_id": 17175, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/9a89d4cf026c5eb3af2b3fdea1925723?s=128&d=identicon&r=PG", "display_name": "technomage", "link": "https://stackoverflow.com/users/17175/technomage"}, "is_accepted": true, "score": 3, "last_activity_date": 1448623533, "creation_date": 1448623533, "answer_id": 33956352, "question_id": 33950973, "link": "https://stackoverflow.com/questions/33950973/kotlin-create-and-refer-true-java-arrays-for-jna/33956352#33956352", "title": "Kotlin: Create and refer true Java arrays (for JNA)", "body": "<p>Direct mapping does not support arrays of <code>Pointer</code> or arrays of <code>NativeMapped</code> (<a href=\"https://github.com/java-native-access/jna/blob/master/www/DirectMapping.md\" rel=\"nofollow\">see docs</a>).</p>\n\n<p>You can manually construct a buffer of pointers and pass that:</p>\n\n<pre><code>Pointer modules = new Memory(Pointer.SIZE * length);\nint offset = 0;\nfor (h: hmodules) {\n    modules.setPointer(Pointer.SIZE * offset, h.getPointer())\n    offset += 1;\n}\n</code></pre>\n"}], "owner": {"reputation": 7656, "user_id": 1938929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/OeAme.png?s=128&g=1", "display_name": "Jire", "link": "https://stackoverflow.com/users/1938929/jire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 832, "favorite_count": 0, "accepted_answer_id": 33956352, "answer_count": 1, "score": 2, "last_activity_date": 1448623533, "creation_date": 1448603244, "question_id": 33950973, "link": "https://stackoverflow.com/questions/33950973/kotlin-create-and-refer-true-java-arrays-for-jna", "title": "Kotlin: Create and refer true Java arrays (for JNA)", "body": "<p>I am trying to use JNA with Kotlin and I've ran into a problem. <code>Caused by: java.lang.IllegalArgumentException: class [Lcom.sun.jna.platform.win32.WinDef$HMODULE; is not a supported argument type (in method EnumProcessModulesEx in class kotmem.unsafe.Psapi)</code></p>\n\n<p>My <code>Psapi</code> direct-mapped object:</p>\n\n<pre><code>package kotmem.unsafe\n\nimport com.sun.jna.*\nimport com.sun.jna.platform.win32.*\nimport com.sun.jna.ptr.*\n\nobject Psapi {\n\n    // note Array&lt;WinDef.HMODULE?&gt;\n    external fun EnumProcessModulesEx(process: Pointer, modules: Array&lt;WinDef.HMODULE?&gt;, cb: Int,\n                                      neededModules: IntByReference, flags: Int): Boolean\n\n    external fun GetModuleInformation(process: Pointer, module: WinDef.HMODULE, moduleInfo: LPMODULEINFO, cb: Int): Boolean\n\n    external fun GetModuleBaseNameA(process: Pointer, module: WinDef.HMODULE, fileName: ByteArray, size: Int): Int\n\n    init {\n        Native.register(NativeLibrary.getInstance(\"Psapi\"))\n    }\n\n}\n</code></pre>\n\n<p>The issue seems to lay in the way I'm calling it. JNA doesn't like Kotlin's <code>Array</code> class I'm assuming because it doesn't know how to map such. Is there a way to refer to real Java arrays so that JNA can map this function? Also, is there a way to construct such?</p>\n\n<p>This is the way I'm calling it:</p>\n\n<pre><code>fun modulesOfProcess(process: UnsafeProcess): List&lt;UnsafeModule&gt; {\n    val list = emptyList&lt;UnsafeModule&gt;()\n\n    val process = process.handle.pointer\n\n    // note that I construct using arrayOfNulls\n    val modules = arrayOfNulls&lt;WinDef.HMODULE&gt;(1024)\n    val needed = IntByReference()\n\n    Psapi.EnumProcessModulesEx(process, modules, modules.size, needed, 1)\n\n    for (i in 0..needed.value / 4) {\n        val module = modules[i] ?: continue\n        val info = LPMODULEINFO()\n        if (!Psapi.GetModuleInformation(process, module, info, info.size()))\n            list + UnsafeModule(module, info)\n    }\n\n    return list\n}\n</code></pre>\n"}]