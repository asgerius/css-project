[{"tags": ["ruby-on-rails", "ruby", "firebase", "google-cloud-storage", "firebase-storage"], "comments": [{"owner": {"reputation": 766, "user_id": 1772133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf9816fbc30091abe048f667191cc81e?s=128&d=identicon&r=PG", "display_name": "Chris Hall", "link": "https://stackoverflow.com/users/1772133/chris-hall"}, "edited": false, "score": 1, "creation_date": 1524701647, "post_id": 50032829, "comment_id": 87082117, "body": "I did some quick checking around and the only thing I could think of was that maybe that user doesn&#39;t have correct IAM permissions for that particular bucket/folder for some reason.  Have you checked those at all?"}, {"owner": {"reputation": 11, "user_id": 5004391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ER3v6.jpg?s=128&g=1", "display_name": "Matt Davis", "link": "https://stackoverflow.com/users/5004391/matt-davis"}, "reply_to_user": {"reputation": 766, "user_id": 1772133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf9816fbc30091abe048f667191cc81e?s=128&d=identicon&r=PG", "display_name": "Chris Hall", "link": "https://stackoverflow.com/users/1772133/chris-hall"}, "edited": false, "score": 0, "creation_date": 1524767241, "post_id": 50032829, "comment_id": 87115611, "body": "The account I&#39;m logged in to Firebase console with is marked as &quot;Owner&quot; of the project. It&#39;s not marked as a service account, however. Maybe that&#39;s the issue?"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 5004391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ER3v6.jpg?s=128&g=1", "display_name": "Matt Davis", "link": "https://stackoverflow.com/users/5004391/matt-davis"}, "edited": false, "score": 0, "creation_date": 1524767007, "post_id": 50035048, "comment_id": 87115487, "body": "It looks like my rules are set to allow read even w/o auth:       <code>allow read;</code>       <code>allow write: if request.auth != null;</code>"}, {"owner": {"reputation": 86, "user_id": 9701656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KINcI.jpg?s=128&g=1", "display_name": "Marvin Qui&#241;&#243;nez", "link": "https://stackoverflow.com/users/9701656/marvin-qui%c3%b1%c3%b3nez"}, "reply_to_user": {"reputation": 11, "user_id": 5004391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ER3v6.jpg?s=128&g=1", "display_name": "Matt Davis", "link": "https://stackoverflow.com/users/5004391/matt-davis"}, "edited": false, "score": 0, "creation_date": 1524785010, "post_id": 50035048, "comment_id": 87122735, "body": "Your rules say the User should be authenticated for read the file. Try to change the rules from  &quot;if request.auth != null&quot; to &quot;if request.auth === null&quot;"}], "tags": [], "owner": {"reputation": 86, "user_id": 9701656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KINcI.jpg?s=128&g=1", "display_name": "Marvin Qui&#241;&#243;nez", "link": "https://stackoverflow.com/users/9701656/marvin-qui%c3%b1%c3%b3nez"}, "is_accepted": false, "score": 0, "last_activity_date": 1524718273, "creation_date": 1524718273, "answer_id": 50035048, "question_id": 50032829, "link": "https://stackoverflow.com/questions/50032829/firebase-storage-unable-to-download-files-uploaded-via-ruby-api/50035048#50035048", "title": "Firebase storage: Unable to download files uploaded via Ruby API", "body": "<p>Have you change your storage rules? Enter to Storage and after to rules in Firebase Console (web) and look your rules.</p>\n\n<p>If you have this:</p>\n\n<pre><code>allow read: if request.auth != null;\n</code></pre>\n\n<p>Means users should be authenticated for read the file.</p>\n\n<p>Use this for more security rules practices.</p>\n"}], "owner": {"reputation": 11, "user_id": 5004391, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ER3v6.jpg?s=128&g=1", "display_name": "Matt Davis", "link": "https://stackoverflow.com/users/5004391/matt-davis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 489, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524731407, "creation_date": 1524700078, "last_edit_date": 1524731407, "question_id": 50032829, "link": "https://stackoverflow.com/questions/50032829/firebase-storage-unable-to-download-files-uploaded-via-ruby-api", "title": "Firebase storage: Unable to download files uploaded via Ruby API", "body": "<p>I'm using the google-cloud-storage service to upload and download files from my Ruby on Rails app to Firebase storage (part of another app I'm interfacing with). </p>\n\n<p>Uploading works perfectly, using the JSON key from the Firebase service accounts section. I'm uploading files like this: </p>\n\n<pre><code>STORAGE = Google::Cloud::Storage.new(\n    project_id: \"blah\",\n    credentials: File.join(Rails.root, 'config', 'firebase-auth.json')\n)\n\nBUCKET = STORAGE.bucket DEFAULT_BUCKET_ID\n\n...\n\nfile_on_firebase = BUCKET.create_file(file_path.to_s, firebase_path, acl: \"public_read\")\n</code></pre>\n\n<p>I can see the uploaded files in the Firebase storage console, but when I try to download them via the console I get the following error in my browser's console:</p>\n\n<pre><code>uncaught exception: CustomError: Error in protected function: Firebase Storage: \nUser is not authenticated, please authenticate using Firebase Authentication and try again.\n</code></pre>\n\n<p>This is strange because the account I'm accessing Firebase console with is the main service account, and I can download other (manually uploaded) files no problem. The only ones I have trouble downloading are the ones uploaded from my Rails app.</p>\n\n<p>Any thoughts? I'm thinking it must have to do with setting the <code>acl</code> attribute of the <code>file</code> to <code>public_read</code>. Not sure why that would prevent downloading the file from the console, however. It seems like I can access files OK using their <code>public_url</code>.</p>\n"}, {"tags": ["ruby", "minitest"], "comments": [{"owner": {"reputation": 5141, "user_id": 193980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/aafa8848c4b764f080b1b31a51eab73d?s=128&d=identicon&r=PG", "display_name": "Phlip", "link": "https://stackoverflow.com/users/193980/phlip"}, "edited": false, "score": 0, "creation_date": 1524688558, "post_id": 50030562, "comment_id": 87077890, "body": "The standard Minitest assertion <code>assert_difference</code> also calls a block, and has the same bug."}], "answers": [{"comments": [{"owner": {"reputation": 5141, "user_id": 193980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/aafa8848c4b764f080b1b31a51eab73d?s=128&d=identicon&r=PG", "display_name": "Phlip", "link": "https://stackoverflow.com/users/193980/phlip"}, "edited": false, "score": 0, "creation_date": 1524698153, "post_id": 50032509, "comment_id": 87081285, "body": "Minitest never calls your version of <code>filter_backtrace</code>, which I put in the nearest <code>test_helper.rb</code>."}], "tags": [], "owner": {"reputation": 38092, "user_id": 18706, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cabf735ce7b8b4471ef46ea54f71832d?s=128&d=identicon&r=PG", "display_name": "mahemoff", "link": "https://stackoverflow.com/users/18706/mahemoff"}, "is_accepted": false, "score": 0, "last_activity_date": 1524697277, "creation_date": 1524697277, "answer_id": 50032509, "question_id": 50030562, "link": "https://stackoverflow.com/questions/50030562/minitest-reports-the-wrong-line-number-when-an-assertion-fails-inside-a-block/50032509#50032509", "title": "Minitest reports the wrong line number when an assertion fails inside a block", "body": "<p>You could try to configure it to log exceptions in test_helper.rb:</p>\n\n<pre><code>def MiniTest.filter_backtrace(backtrace)\n  backtrace\nend\n</code></pre>\n\n<p>I'm not sure if this is the default, but depending on your configuration, the backtrace might not be shown.</p>\n"}], "owner": {"reputation": 5141, "user_id": 193980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/aafa8848c4b764f080b1b31a51eab73d?s=128&d=identicon&r=PG", "display_name": "Phlip", "link": "https://stackoverflow.com/users/193980/phlip"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 102, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1524697277, "creation_date": 1524687032, "question_id": 50030562, "link": "https://stackoverflow.com/questions/50030562/minitest-reports-the-wrong-line-number-when-an-assertion-fails-inside-a-block", "title": "Minitest reports the wrong line number when an assertion fails inside a block", "body": "<p>I have written an assertion that collects new records created while it yields to a block. Here's an example, with a failing assertion inside that block:</p>\n\n<pre><code>  product =\n    assert_latest_record Product do  #  line 337\n      post :create, \n           :product =&gt; { ... }\n      assert false  #  line 340\n    end\n</code></pre>\n\n<p>The source of my assertion is below, but I don't think it's relevant. It does not intercept Minitest exceptions, or even call <code>rescue</code> or <code>ensure</code>.</p>\n\n<p>The problem is when an assertion inside that block fails. The fault diagnostic message reports the line number as <code>337</code> the line of the outer assertion, not <code>340</code>, the line of the inner assertion that failed. This is important if, for example, my colleagues have written a run-on test with way too many lines in it; isolating a failing line becomes more difficult.</p>\n\n<p>Why doesn't Minitest report the correct line number?</p>\n\n<hr>\n\n<p>The source:</p>\n\n<pre><code>##\n# When a test case calls methods that write new ActiveModel records to a database,\n# sometimes the test needs to assert those records were created, by fetching them back\n# for inspection. +assert_latest_record+ collects every record in the given model or\n# models that appear while its block runs, and returns either a single record or a ragged\n# array.\n#\n# ==== Parameters\n#\n# * +models+ - At least 1 ActiveRecord model or association.\n# * +message+ - Optional string or -&gt;{block} to provide more diagnostics at failure time.\n# * &lt;code&gt;&amp;block&lt;/code&gt; - Required block to call and monitor for new records.\n#\n# ==== Example\n#\n#   user, email_addresses =\n#     assert_latest_record User, EmailAddress, -&gt;{ 'Need moar records!' } do\n#       post :create, ...\n#     end\n#   assert_equal 'franklyn', user.login  #  1 user, so not an array\n#   assert_equal 2, email_addresses.size\n#   assert_equal 'franklyn@gmail.com', email_addresses.first.mail\n#   assert_equal 'franklyn@hotmail.com', email_addresses.second.mail\n#\n# ==== Returns\n#\n# The returned value is a set of one or more created records. The set is normalized,\n# so all arrays of one item are replaced with the item itself.\n#\n# ==== Operations\n#\n# The last argument to +assert_latest_record+ can be a string or a callable block.\n# At failure time the assertion adds this string or this block's return value to\n# the diagnostic message.\n#\n# You may call +assert_latest_record+ with anything that responds to &lt;code&gt;.pluck(:id)&lt;/code&gt;\n# and &lt;code&gt;.where()&lt;/code&gt;, including ActiveRecord associations:\n#\n#   user = User.last\n#   email_address =\n#     assert_latest_record user.email_addresses do\n#       post :add_email_address, user_id: user.id, ...\n#     end\n#   assert_equal 'franklyn@philly.com', email_address.mail\n#   assert_equal email_address.user_id, user.id, 'This assertion is redundant.'\n#\ndef assert_latest_record(*models, &amp;block)\n  models, message = _get_latest_record_args(models, 'assert')\n  latests = _get_latest_record(models, block)\n  latests.include?(nil) and _flunk_latest_record(models, latests, message, true)\n  pass  #  Increment the test runner's assertion count\n  return latests.size &gt; 1 ? latests : latests.first\nend\n\n##\n# When a test case calls methods that might write new ActiveModel records to a\n# database, sometimes the test must check that no records were written.\n# +refute_latest_record+ watches for new records in the given class or classes\n# that appear while its block runs, and fails if any appear.\n#\n# ==== Parameters\n#\n# See +assert_latest_record+.\n#\n# ==== Operations\n#\n#   refute_latest_record User, EmailAddress, -&gt;{ 'GET should not create records' } do\n#     get :index\n#   end\n#\n# The last argument to +refute_latest_record+ can be a string or a callable block.\n# At failure time the assertion adds this string or this block's return value to\n# the diagnostic message.\n#\n# Like +assert_latest_record+, you may call +refute_latest_record+ with anything\n# that responds to &lt;code&gt;pluck(:id)&lt;/code&gt; and &lt;code&gt;where()&lt;/code&gt;, including\n# ActiveRecord associations.\n#\ndef refute_latest_record(*models, &amp;block)\n  models, message = _get_latest_record_args(models, 'refute')\n  latests = _get_latest_record(models, block)\n  latests.all?(&amp;:nil?) or _flunk_latest_record(models, latests, message, false)\n  pass\n  return\nend\n\n##\n# Sometimes a test must detect new records without using an assertion that passes\n# judgment on whether they should have been written. Call +get_latest_record+ to\n# return a ragged array of records created during its block, or +nil+:\n#\n#   user, email_addresses, posts =\n#     get_latest_record User, EmailAddress, Post do\n#       post :create, ...\n#     end\n#\n#   assert_nil posts, \"Don't create Post records while creating a User\"\n#\n# Unlike +assert_latest_record+, +get_latest_record+ does not take a +message+ string\n# or block, because it has no diagnostic message.\n#\n# Like +assert_latest_record+, you may call +get_latest_record+ with anything\n# that responds to &lt;code&gt;.pluck(:id)&lt;/code&gt; and &lt;code&gt;.where()&lt;/code&gt;, including\n# ActiveRecord associations.\n#\ndef get_latest_record(*models, &amp;block)\n  assert models.any?, 'Call get_latest_record with one or more ActiveRecord models or associations.'\n  refute_nil block, 'Call get_latest_record with a block.'\n  records = _get_latest_record(models, block)\n  return records.size &gt; 1 ? records : records.first\nend  #  Methods should be easy to use correctly and hard to use incorrectly...\n\ndef _get_latest_record_args(models, what) #:nodoc:\n  message = nil\n  message = models.pop unless models.last.respond_to?(:pluck)\n  valid_message = message.nil? || message.kind_of?(String) || message.respond_to?(:call)\n  models.length &gt; 0 &amp;&amp; valid_message and return models, message\n\n  raise \"call #{what}_latest_record(models..., message) with any number\\n\" +\n        'of Model classes or associations, followed by an optional diagnostic message'\nend\nprivate :_get_latest_record_args\n\ndef _get_latest_record(models, block) #:nodoc:\n  id_sets = models.map{ |model| model.pluck(*model.primary_key) }  #  Sorry about your memory!\n  block.call\n  record_sets = []\n\n  models.each_with_index do |model, index|\n    pk = model.primary_key\n    set = id_sets[index]\n\n    records =\n      if set.length == 0\n        model\n      elsif pk.is_a?(Array)\n        pks = pk.map{ |k| \"`#{k}` = ?\" }.join(' AND ')\n        pks = [ \"(#{pks})\" ] * set.length\n        pks = pks.join(' OR ')\n        model.where.not(pks, *set.flatten)\n      else\n        model.where.not(pk =&gt; set)\n      end\n\n    records = records.order(pk).to_a\n    record_sets.push records.size &gt; 1 ? records : records.first\n  end\n\n  return record_sets\nend\nprivate :_get_latest_record\n\ndef _flunk_latest_record(models, latests, message, polarity) #:nodoc:\n  itch_list = []\n\n  models.each_with_index do |model, index|\n    records_found = latests[index] != nil\n    records_found == polarity or itch_list &lt;&lt; model.name\n  end\n\n  itch_list = itch_list.join(', ')\n  diagnostic = \"should#{' not' unless polarity} create new #{itch_list} record(s) in block\"\n  message = nil if message == ''\n  message = message.call.to_s if message.respond_to?(:call)\n  message = [ message, diagnostic ].compact.join(\"\\n\")\n  raise Minitest::Assertion, message\nend\nprivate :_flunk_latest_record\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-4", "activerecord"], "answers": [{"comments": [{"owner": {"reputation": 2401, "user_id": 2873548, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b90a1fd45fc72bd55f8948b385d4626f?s=128&d=identicon&r=PG&f=1", "display_name": "anonn023432", "link": "https://stackoverflow.com/users/2873548/anonn023432"}, "edited": false, "score": 0, "creation_date": 1524689529, "post_id": 50030777, "comment_id": 87078341, "body": "So in that case, what do I do with the <code>where condition in the model</code> because if that last messages turns out to be <code>only_for_buyer</code> then the conversation won&#39;t have any message right?"}, {"owner": {"reputation": 1088, "user_id": 3236163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f4a825085dda7d9ea059838a3d6dcd7?s=128&d=identicon&r=PG", "display_name": "elyalvarado", "link": "https://stackoverflow.com/users/3236163/elyalvarado"}, "reply_to_user": {"reputation": 2401, "user_id": 2873548, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b90a1fd45fc72bd55f8948b385d4626f?s=128&d=identicon&r=PG&f=1", "display_name": "anonn023432", "link": "https://stackoverflow.com/users/2873548/anonn023432"}, "edited": false, "score": 1, "creation_date": 1524690101, "post_id": 50030777, "comment_id": 87078612, "body": "You can add the condition in the relationship <code>has_one :last_message, -&gt; { order(created_at: :desc).where(only_for_buyer: false) }, source: :message</code>"}, {"owner": {"reputation": 2401, "user_id": 2873548, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b90a1fd45fc72bd55f8948b385d4626f?s=128&d=identicon&r=PG&f=1", "display_name": "anonn023432", "link": "https://stackoverflow.com/users/2873548/anonn023432"}, "edited": false, "score": 0, "creation_date": 1524690565, "post_id": 50030777, "comment_id": 87078816, "body": "Yeah I did the same thing; is there a way to sort the conversations according to the <code>created_at</code> date for the <code>last_message</code> too?"}, {"owner": {"reputation": 1088, "user_id": 3236163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f4a825085dda7d9ea059838a3d6dcd7?s=128&d=identicon&r=PG", "display_name": "elyalvarado", "link": "https://stackoverflow.com/users/3236163/elyalvarado"}, "reply_to_user": {"reputation": 2401, "user_id": 2873548, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b90a1fd45fc72bd55f8948b385d4626f?s=128&d=identicon&r=PG&f=1", "display_name": "anonn023432", "link": "https://stackoverflow.com/users/2873548/anonn023432"}, "edited": false, "score": 1, "creation_date": 1524691016, "post_id": 50030777, "comment_id": 87079015, "body": "When you do the <code>includes(:last_message)</code> then you should be able to do <code>.order(&#39;messages.created_at&#39;)</code> after if you want to sort on that field."}, {"owner": {"reputation": 2401, "user_id": 2873548, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b90a1fd45fc72bd55f8948b385d4626f?s=128&d=identicon&r=PG&f=1", "display_name": "anonn023432", "link": "https://stackoverflow.com/users/2873548/anonn023432"}, "edited": false, "score": 0, "creation_date": 1524691395, "post_id": 50030777, "comment_id": 87079171, "body": "Yes, you&#39;re correct. I was trying to do <code>.order(&#39;last_message.created_at&#39;)</code> but of course what you&#39;re saying makes sense"}, {"owner": {"reputation": 2401, "user_id": 2873548, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b90a1fd45fc72bd55f8948b385d4626f?s=128&d=identicon&r=PG&f=1", "display_name": "anonn023432", "link": "https://stackoverflow.com/users/2873548/anonn023432"}, "edited": false, "score": 0, "creation_date": 1524691529, "post_id": 50030777, "comment_id": 87079239, "body": "I have a follow-up though; if I use <code>.order(&#39;messages.created_at&#39;)</code> then it pulls the messages for the conversations again rather than using the <code>last_message</code> so it sort of defeats the purpose"}, {"owner": {"reputation": 2401, "user_id": 2873548, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b90a1fd45fc72bd55f8948b385d4626f?s=128&d=identicon&r=PG&f=1", "display_name": "anonn023432", "link": "https://stackoverflow.com/users/2873548/anonn023432"}, "edited": false, "score": 0, "creation_date": 1524691580, "post_id": 50030777, "comment_id": 87079261, "body": "According to <code>bullet</code> I should add an <code>includes</code> for <code>messages</code> over here now because I&#39;m sorting on the basis of created_At` for <code>messages</code>"}, {"owner": {"reputation": 2401, "user_id": 2873548, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b90a1fd45fc72bd55f8948b385d4626f?s=128&d=identicon&r=PG&f=1", "display_name": "anonn023432", "link": "https://stackoverflow.com/users/2873548/anonn023432"}, "edited": false, "score": 0, "creation_date": 1524691670, "post_id": 50030777, "comment_id": 87079288, "body": "<code>source: :message</code> didn&#39;t work for me so I did it as <code>class_name: &quot;Message&quot;</code> instead, but I don&#39;t think that should affect the sort"}, {"owner": {"reputation": 1088, "user_id": 3236163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f4a825085dda7d9ea059838a3d6dcd7?s=128&d=identicon&r=PG", "display_name": "elyalvarado", "link": "https://stackoverflow.com/users/3236163/elyalvarado"}, "reply_to_user": {"reputation": 2401, "user_id": 2873548, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b90a1fd45fc72bd55f8948b385d4626f?s=128&d=identicon&r=PG&f=1", "display_name": "anonn023432", "link": "https://stackoverflow.com/users/2873548/anonn023432"}, "edited": false, "score": 1, "creation_date": 1524692036, "post_id": 50030777, "comment_id": 87079432, "body": "Well, in that case I&#39;ll do the sorting on ruby like in your <code>sorted_conversations</code> method, but instead of on all messages use the last_message. If you pass your loaded conversations that include the last message, this won&#39;t trigger new queries because the info is already there."}], "tags": [], "owner": {"reputation": 1088, "user_id": 3236163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f4a825085dda7d9ea059838a3d6dcd7?s=128&d=identicon&r=PG", "display_name": "elyalvarado", "link": "https://stackoverflow.com/users/3236163/elyalvarado"}, "is_accepted": true, "score": 2, "last_activity_date": 1524687906, "creation_date": 1524687906, "answer_id": 50030777, "question_id": 50030388, "link": "https://stackoverflow.com/questions/50030388/last-message-in-conversation-for-preview/50030777#50030777", "title": "Last message in conversation for preview", "body": "<p>You can add a relationship in your <code>Conversation</code> model to its last message:</p>\n\n<p><code>has_one :last_message, -&gt; { order(created_at: :desc) }, source: :message</code></p>\n\n<p>And then in your search instead of doing <code>Conversation.includes(:messages)</code> you do <code>Conversation.includes(:last_message)</code></p>\n"}], "owner": {"reputation": 2401, "user_id": 2873548, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b90a1fd45fc72bd55f8948b385d4626f?s=128&d=identicon&r=PG&f=1", "display_name": "anonn023432", "link": "https://stackoverflow.com/users/2873548/anonn023432"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "accepted_answer_id": 50030777, "answer_count": 1, "score": 2, "last_activity_date": 1524687906, "creation_date": 1524686249, "question_id": 50030388, "link": "https://stackoverflow.com/questions/50030388/last-message-in-conversation-for-preview", "title": "Last message in conversation for preview", "body": "<p>I have a <code>Conversation</code> model which <code>has_many</code> <code>messages</code>. I want to pull all the conversations for a user and display the last <code>message</code> preview to the users. I am doing this as follows:</p>\n\n<p><code>Conversations_controller</code>:</p>\n\n<pre><code>def index\n  @conversations = Conversation.includes(:messages)\n                               .get_seller_conversations(@seller)\nend\n</code></pre>\n\n<p><code>Conversation</code> model:</p>\n\n<pre><code>def self.get_seller_conversations(seller)\n  @conversations = seller.conversations\n                         .includes(buyer: :user)\n                         .joins(:messages)\n                         .where(messages: { only_for_buyer: false })\n                         .distinct\n  new.sorted_conversations(@conversations)\nend\n\n\ndef sorted_conversations(conversations)\n  conversations.sort_by { |c| c.messages.last.created_at }\n  .reverse\nend\n</code></pre>\n\n<p><code>index.json.jbuilder</code> -> view</p>\n\n<pre><code>json.array!(@conversations.reject { |c| c.messages == [] }.map do |c|\n  x = c.messages.last\n  { ...\n    ...\n    preview: x.content ? x.content[0..100] : x.attachment_url }\nend)\n</code></pre>\n\n<p>So I have to pull all the messages over here to sort the conversations and show the preview of the last message. Is there a way I can only pull the last message for every conversation and thus make this more efficient?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "activerecord"], "comments": [{"owner": {"reputation": 2765, "user_id": 5864985, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/UlhbW.jpg?s=128&g=1", "display_name": "Ronan Lopes", "link": "https://stackoverflow.com/users/5864985/ronan-lopes"}, "edited": false, "score": 0, "creation_date": 1524686195, "post_id": 50030334, "comment_id": 87076783, "body": "don&#39;t know if I got it right... you want an array where the first ones have agent like smith and the last ones who don&#39;t?"}, {"owner": {"reputation": 541, "user_id": 7773621, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b4bfe00cf0e21d8915f252905ccc73d3?s=128&d=identicon&r=PG&f=1", "display_name": "Boucherie", "link": "https://stackoverflow.com/users/7773621/boucherie"}, "reply_to_user": {"reputation": 2765, "user_id": 5864985, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/UlhbW.jpg?s=128&g=1", "display_name": "Ronan Lopes", "link": "https://stackoverflow.com/users/5864985/ronan-lopes"}, "edited": false, "score": 0, "creation_date": 1524686275, "post_id": 50030334, "comment_id": 87076815, "body": "Yup - I want to take everything that fits &#39;group&#39; and move it to the beginning of the array."}, {"owner": {"reputation": 2765, "user_id": 5864985, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/UlhbW.jpg?s=128&g=1", "display_name": "Ronan Lopes", "link": "https://stackoverflow.com/users/5864985/ronan-lopes"}, "edited": false, "score": 0, "creation_date": 1524686408, "post_id": 50030334, "comment_id": 87076871, "body": "so you want just order? like [ &#39;agent like smith true&#39;, &#39;agent like smith false&#39;]?"}, {"owner": {"reputation": 541, "user_id": 7773621, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b4bfe00cf0e21d8915f252905ccc73d3?s=128&d=identicon&r=PG&f=1", "display_name": "Boucherie", "link": "https://stackoverflow.com/users/7773621/boucherie"}, "reply_to_user": {"reputation": 2765, "user_id": 5864985, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/UlhbW.jpg?s=128&g=1", "display_name": "Ronan Lopes", "link": "https://stackoverflow.com/users/5864985/ronan-lopes"}, "edited": false, "score": 0, "creation_date": 1524686503, "post_id": 50030334, "comment_id": 87076907, "body": "Yeah - like, if group? then unshift."}, {"owner": {"reputation": 2765, "user_id": 5864985, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/UlhbW.jpg?s=128&g=1", "display_name": "Ronan Lopes", "link": "https://stackoverflow.com/users/5864985/ronan-lopes"}, "edited": false, "score": 0, "creation_date": 1524686669, "post_id": 50030334, "comment_id": 87076995, "body": "made an answer... don&#39;t know if I got it right, but take a look"}, {"owner": {"reputation": 9659, "user_id": 6136634, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7487290ff90aebf6848d9c638c067bb?s=128&d=identicon&r=PG", "display_name": "Gerry", "link": "https://stackoverflow.com/users/6136634/gerry"}, "edited": false, "score": 0, "creation_date": 1524697757, "post_id": 50030334, "comment_id": 87081199, "body": "It will be really helpful if you add an example of input and expected output."}, {"owner": {"reputation": 541, "user_id": 7773621, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b4bfe00cf0e21d8915f252905ccc73d3?s=128&d=identicon&r=PG&f=1", "display_name": "Boucherie", "link": "https://stackoverflow.com/users/7773621/boucherie"}, "edited": false, "score": 0, "creation_date": 1524754957, "post_id": 50030334, "comment_id": 87108743, "body": "Updated the question - looking to turn a condition into a boolean so that the elements meeting that condition will be first in the array."}], "answers": [{"comments": [{"owner": {"reputation": 541, "user_id": 7773621, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b4bfe00cf0e21d8915f252905ccc73d3?s=128&d=identicon&r=PG&f=1", "display_name": "Boucherie", "link": "https://stackoverflow.com/users/7773621/boucherie"}, "edited": false, "score": 0, "creation_date": 1524687024, "post_id": 50030467, "comment_id": 87077146, "body": "This is good, but I need to be able to set <code>group = @listings.joins(:spec).where(&#39;specs.agent ilike ?&#39;, &#39;%smith%&#39;)</code> as a condition to be called - hence the need for a boolean"}, {"owner": {"reputation": 2765, "user_id": 5864985, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/UlhbW.jpg?s=128&g=1", "display_name": "Ronan Lopes", "link": "https://stackoverflow.com/users/5864985/ronan-lopes"}, "reply_to_user": {"reputation": 541, "user_id": 7773621, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b4bfe00cf0e21d8915f252905ccc73d3?s=128&d=identicon&r=PG&f=1", "display_name": "Boucherie", "link": "https://stackoverflow.com/users/7773621/boucherie"}, "edited": false, "score": 0, "creation_date": 1524687184, "post_id": 50030467, "comment_id": 87077222, "body": "@Boucherie don&#39;t got it right so. Can you explain with more details what you&#39;re trying to do? please update the question"}, {"owner": {"reputation": 541, "user_id": 7773621, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b4bfe00cf0e21d8915f252905ccc73d3?s=128&d=identicon&r=PG&f=1", "display_name": "Boucherie", "link": "https://stackoverflow.com/users/7773621/boucherie"}, "edited": false, "score": 0, "creation_date": 1524754982, "post_id": 50030467, "comment_id": 87108766, "body": "Updated the question."}, {"owner": {"reputation": 541, "user_id": 7773621, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b4bfe00cf0e21d8915f252905ccc73d3?s=128&d=identicon&r=PG&f=1", "display_name": "Boucherie", "link": "https://stackoverflow.com/users/7773621/boucherie"}, "edited": false, "score": 0, "creation_date": 1524756666, "post_id": 50030467, "comment_id": 87109906, "body": "Damn...yeah, the dev who set this up agrees - just got pointed to <code>ransack</code> gem docs"}, {"owner": {"reputation": 541, "user_id": 7773621, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b4bfe00cf0e21d8915f252905ccc73d3?s=128&d=identicon&r=PG&f=1", "display_name": "Boucherie", "link": "https://stackoverflow.com/users/7773621/boucherie"}, "edited": false, "score": 0, "creation_date": 1524761955, "post_id": 50030467, "comment_id": 87112976, "body": "Okay, this is right, and I&#39;m going to mark it right, but my strategy shifted considerably  - this helped parse through different methodologies though, so thanks :)"}, {"owner": {"reputation": 2765, "user_id": 5864985, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/UlhbW.jpg?s=128&g=1", "display_name": "Ronan Lopes", "link": "https://stackoverflow.com/users/5864985/ronan-lopes"}, "reply_to_user": {"reputation": 541, "user_id": 7773621, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b4bfe00cf0e21d8915f252905ccc73d3?s=128&d=identicon&r=PG&f=1", "display_name": "Boucherie", "link": "https://stackoverflow.com/users/7773621/boucherie"}, "edited": false, "score": 0, "creation_date": 1524841138, "post_id": 50030467, "comment_id": 87146869, "body": "I&#39;m glad if it helped in any way. Good luck!"}], "tags": [], "owner": {"reputation": 2765, "user_id": 5864985, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/UlhbW.jpg?s=128&g=1", "display_name": "Ronan Lopes", "link": "https://stackoverflow.com/users/5864985/ronan-lopes"}, "is_accepted": true, "score": 1, "last_activity_date": 1524755737, "last_edit_date": 1524755737, "creation_date": 1524686607, "answer_id": 50030467, "question_id": 50030334, "link": "https://stackoverflow.com/questions/50030334/set-values-as-boolean-in-array-and-change-position-in-ruby-rails-5/50030467#50030467", "title": "Set values as boolean in array and change position in ruby (Rails 5)", "body": "<p>You can do it like this:</p>\n\n<pre><code>group = Listings.all.joins(:spec).where('specs.agent ilike ?', '%smith%') +\n Listings.all.joins(:spec).where.not('specs.agent ilike ?', '%smith%')\n</code></pre>\n\n<p>So it will put on the group variable first the ones that match the condition, and after those, the ones that doesn't</p>\n\n<p>EDIT:\ndon't know exactly why you need a separate method to do that (since the way I showed before would give you the correct order anyway). But there's a problem with the syntax you showed on edit: you're trying to call a instance method that calls the whole ActiveRecord method where (same problem as the answer of steenslag). If you wanna do the way you presented, I think this way should work better:</p>\n\n<pre><code>#this method should be on Listing model\ndef get_smith_listings?\n  self.spec.broker.to_s.include?(\"smith\")\nend\n\n@listings = Listings.includes(:spec).all #important to avoid n+1 queries\n\n# here the 0 or 1 position will depende the true/false order you want\n@listings.sort_by { |item| item.get_smith_listings? ? 0 : 1 }\n</code></pre>\n\n<p>I still don't got why you wanna do it that way and guess there's probably a better way to do what you want... but for now I can't help more than that. Good luck!</p>\n"}, {"comments": [{"owner": {"reputation": 541, "user_id": 7773621, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b4bfe00cf0e21d8915f252905ccc73d3?s=128&d=identicon&r=PG&f=1", "display_name": "Boucherie", "link": "https://stackoverflow.com/users/7773621/boucherie"}, "edited": false, "score": 0, "creation_date": 1524687544, "post_id": 50030642, "comment_id": 87077394, "body": "so <code>(@listing).partition { |v| v.group? } </code> ?"}, {"owner": {"reputation": 73209, "user_id": 290394, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d7908f05c89e965f6bc5308ad6f41256?s=128&d=identicon&r=PG", "display_name": "steenslag", "link": "https://stackoverflow.com/users/290394/steenslag"}, "reply_to_user": {"reputation": 541, "user_id": 7773621, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b4bfe00cf0e21d8915f252905ccc73d3?s=128&d=identicon&r=PG&f=1", "display_name": "Boucherie", "link": "https://stackoverflow.com/users/7773621/boucherie"}, "edited": false, "score": 0, "creation_date": 1524690183, "post_id": 50030642, "comment_id": 87078648, "body": "I&#39;m just guessing here ( have no data and no Rails) , I would try <code>groups = @listings.partition.joins(:spec).where(&#39;specs.agent ilike ?&#39;, &#39;%smith%&#39;)</code>"}, {"owner": {"reputation": 2765, "user_id": 5864985, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/UlhbW.jpg?s=128&g=1", "display_name": "Ronan Lopes", "link": "https://stackoverflow.com/users/5864985/ronan-lopes"}, "edited": false, "score": 1, "creation_date": 1524690798, "post_id": 50030642, "comment_id": 87078912, "body": "that wouldn&#39;t work... you can&#39;t apply joins on an enumerable. Also, partition needs a block with the condition to separate the objects based on that condition, and it&#39;s applied over each record, so you can&#39;t use where. So, something like this could work: @listings.includes(:spec).partition{|l| l.spec.agent.include?(&quot;smith&quot;)}"}, {"owner": {"reputation": 73209, "user_id": 290394, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d7908f05c89e965f6bc5308ad6f41256?s=128&d=identicon&r=PG", "display_name": "steenslag", "link": "https://stackoverflow.com/users/290394/steenslag"}, "reply_to_user": {"reputation": 2765, "user_id": 5864985, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/UlhbW.jpg?s=128&g=1", "display_name": "Ronan Lopes", "link": "https://stackoverflow.com/users/5864985/ronan-lopes"}, "edited": false, "score": 0, "creation_date": 1524691627, "post_id": 50030642, "comment_id": 87079276, "body": "@RonanLopes Even without Rails knowledge, yours seems to make much more sense."}], "tags": [], "owner": {"reputation": 73209, "user_id": 290394, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d7908f05c89e965f6bc5308ad6f41256?s=128&d=identicon&r=PG", "display_name": "steenslag", "link": "https://stackoverflow.com/users/290394/steenslag"}, "is_accepted": false, "score": 2, "last_activity_date": 1524687347, "creation_date": 1524687347, "answer_id": 50030642, "question_id": 50030334, "link": "https://stackoverflow.com/questions/50030334/set-values-as-boolean-in-array-and-change-position-in-ruby-rails-5/50030642#50030642", "title": "Set values as boolean in array and change position in ruby (Rails 5)", "body": "<p><a href=\"https://ruby-doc.org/core-2.5.0/Enumerable.html#method-i-partition\" rel=\"nofollow noreferrer\">Enumerable#partition</a> does that: it results in an array of 2 arrays. The first contains all items for which the block is true, the second are the falses.</p>\n"}], "owner": {"reputation": 541, "user_id": 7773621, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b4bfe00cf0e21d8915f252905ccc73d3?s=128&d=identicon&r=PG&f=1", "display_name": "Boucherie", "link": "https://stackoverflow.com/users/7773621/boucherie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 50030467, "answer_count": 2, "score": 0, "last_activity_date": 1524755737, "creation_date": 1524686031, "last_edit_date": 1524755192, "question_id": 50030334, "link": "https://stackoverflow.com/questions/50030334/set-values-as-boolean-in-array-and-change-position-in-ruby-rails-5", "title": "Set values as boolean in array and change position in ruby (Rails 5)", "body": "<p>I have a set of objects through ActiveRecord, and need to iterate through them to ID a set of conditions. </p>\n\n<pre><code>def get_smith_listings\n  Listing.joins(:spec).where('specs.broker ilike ?', '%smith%')\nend\n\n@listings = Listings.all #actually a built query\n\n@listings.sort_by { |item| item.get_smith_listings? ? 0 : 1 }\n\n=&gt; EXPLAIN for: SELECT \"listings\".* FROM \"listings\" INNER JOIN \"specs\" ON \"specs\".\"listing_id\" = \"listings\".\"id\" WHERE (specs.agent ilike '%smith%')\n                                      QUERY PLAN\n--------------------------------------------------------------------------------------\n Nested Loop  (cost=0.28..848.56 rows=1 width=668)\n   -&gt;  Seq Scan on specs  (cost=0.00..840.25 rows=1 width=4)\n         Filter: ((agent)::text ~~* '%smith%'::text)\n   -&gt;  Index Scan using listings_pkey on listings  (cost=0.28..8.30 rows=1 width=668)\n         Index Cond: (id = specs.listing_id)\n</code></pre>\n\n<p>(the nature of the question has changed slightly as I've zeroed in on the method required)</p>\n\n<p>I'm having trouble structuring this in a way that a) gets my method recognized (new to helpers) and sets up the query to sort using the boolean.</p>\n\n<p>UPDATE: For this seeking clarification, this is the direction I'm trying to take on this problem: <a href=\"https://www.mateoclarke.com/blog/2015/10/14/what-i-learned-boolean-ruby/\" rel=\"nofollow noreferrer\">https://www.mateoclarke.com/blog/2015/10/14/what-i-learned-boolean-ruby/</a></p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 9030, "user_id": 5101476, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JCQrl.jpg?s=128&g=1", "display_name": "ice\u30c4", "link": "https://stackoverflow.com/users/5101476/ice%e3%83%84"}, "edited": false, "score": 1, "creation_date": 1524685050, "post_id": 50030069, "comment_id": 87076283, "body": "Related, if not a dup <a href=\"https://stackoverflow.com/questions/41783001/why-would-each-with-object-and-inject-switch-the-order-of-block-parameters\" title=\"why would each with object and inject switch the order of block parameters\">stackoverflow.com/questions/41783001/&hellip;</a>"}, {"owner": {"reputation": 9254, "user_id": 625365, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ab819ffb4ef53da36f840e46dd72e967?s=128&d=identicon&r=PG", "display_name": "spike", "link": "https://stackoverflow.com/users/625365/spike"}, "reply_to_user": {"reputation": 9030, "user_id": 5101476, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JCQrl.jpg?s=128&g=1", "display_name": "ice\u30c4", "link": "https://stackoverflow.com/users/5101476/ice%e3%83%84"}, "edited": false, "score": 0, "creation_date": 1524685178, "post_id": 50030069, "comment_id": 87076347, "body": "That&#39;s interesting. I&#39;d ask to leave this open though in case there&#39;s a reason that isn&#39;t just historically how it was done. I have a hunch there&#39;s something related to functional programming (currying, partial application) that&#39;s somehow related but I don&#39;t know."}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1524931996, "post_id": 50030069, "comment_id": 87173052, "body": "Hi, can you explain a little bit more what is confusing you? You are calling <code>reduce</code> on the sequence 5, 6, 7, 8, 9, 10, and the first iteration of the block is <code>5 + 6</code>. It seems perfectly logical to me, especially since the semantics of <code>reduce</code> is essentially &quot;insert the operation in between all elements&quot;, i.e. <code>5 + 6 + 7 + 8 + 9 + 10</code> in your example."}, {"owner": {"reputation": 9254, "user_id": 625365, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ab819ffb4ef53da36f840e46dd72e967?s=128&d=identicon&r=PG", "display_name": "spike", "link": "https://stackoverflow.com/users/625365/spike"}, "reply_to_user": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1525044256, "post_id": 50030069, "comment_id": 87200633, "body": "@J&#246;rgWMittag I&#39;m not confused, I was looking for a reason why the arguments were put in the order they are in the design of the function itself."}], "answers": [{"comments": [{"owner": {"reputation": 91121, "user_id": 179125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5594142dcc49a24b1902ec8059181f8d?s=128&d=identicon&r=PG&f=1", "display_name": "Jordan Running", "link": "https://stackoverflow.com/users/179125/jordan-running"}, "edited": false, "score": 2, "creation_date": 1524686710, "post_id": 50030380, "comment_id": 87077016, "body": "I could be wrong, but don&#39;t think <code>Symbol#to_proc</code> (and thereby <code>&amp;:sym</code>) was introduced until Ruby 1.8.7, which is long after <code>inject</code>&#39;s argument order was chosen."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "reply_to_user": {"reputation": 91121, "user_id": 179125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5594142dcc49a24b1902ec8059181f8d?s=128&d=identicon&r=PG&f=1", "display_name": "Jordan Running", "link": "https://stackoverflow.com/users/179125/jordan-running"}, "edited": false, "score": 0, "creation_date": 1524686795, "post_id": 50030380, "comment_id": 87077050, "body": "@JordanRunning That&#39;s an interesting point, but this was likely the intent."}], "tags": [], "owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "is_accepted": true, "score": 1, "last_activity_date": 1524686229, "creation_date": 1524686229, "answer_id": 50030380, "question_id": 50030069, "link": "https://stackoverflow.com/questions/50030069/why-are-the-arguments-of-reduce-in-the-order-they-are/50030380#50030380", "title": "Why are the arguments of reduce in the order they are?", "body": "<p>It's mostly so you can do things like this:</p>\n\n<pre><code>(5..10).reduce(&amp;:+)\n</code></pre>\n\n<p>Where that expands to:</p>\n\n<pre><code>(5..10).reduce { |a,b| a.send(:+, b) } \n</code></pre>\n\n<p>Which is equivalent to:</p>\n\n<pre><code>(5..10).reduce { |a,b| a + b }\n</code></pre>\n\n<p>So it makes sense that way. Note the order is the opposite of <code>each_with_object</code>.</p>\n"}], "owner": {"reputation": 9254, "user_id": 625365, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ab819ffb4ef53da36f840e46dd72e967?s=128&d=identicon&r=PG", "display_name": "spike", "link": "https://stackoverflow.com/users/625365/spike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 50030380, "answer_count": 1, "score": 2, "last_activity_date": 1527697121, "creation_date": 1524684941, "last_edit_date": 1527697121, "question_id": 50030069, "link": "https://stackoverflow.com/questions/50030069/why-are-the-arguments-of-reduce-in-the-order-they-are", "title": "Why are the arguments of reduce in the order they are?", "body": "<p>I always forget the arguments of <code>reduce</code> in ruby (<a href=\"https://ruby-doc.org/core/Enumerable.html#method-i-reduce\" rel=\"nofollow noreferrer\">https://ruby-doc.org/core/Enumerable.html#method-i-reduce</a>) which is called like this:</p>\n\n<pre><code>(5..10).reduce { |sum, n| sum + n }\n</code></pre>\n\n<p>Is there a language design reason why the accumulator is passed in first or is it just an arbitrary choice? JS works the same way. </p>\n"}, {"tags": ["sql", "ruby-on-rails", "ruby", "activerecord"], "comments": [{"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1524684587, "post_id": 50029438, "comment_id": 87076097, "body": "I&#39;ll give this a shot in a while, if no-one beats me to it, but basically this can be done with a <code>group_by</code> with the rounded month, then counting."}, {"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1524684645, "post_id": 50029438, "comment_id": 87076122, "body": "Something like: <code>select(&quot;date_trunc(&#39;month&#39;, soft_destroyed_at) as month&quot;).group(&quot;month&quot;).count</code> ... I haven&#39;t tried running it yet."}, {"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1524684721, "post_id": 50029438, "comment_id": 87076155, "body": "The syntax <i>might</i> vary depending on your database type, though - so you&#39;d best specify that in the question."}, {"owner": {"reputation": 781, "user_id": 291503, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2986e67e29cf2ad3de088f9f8bc131cf?s=128&d=identicon&r=PG", "display_name": "mikker", "link": "https://stackoverflow.com/users/291503/mikker"}, "reply_to_user": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1524687027, "post_id": 50029438, "comment_id": 87077148, "body": "It&#39;s Postgres of course! Updated the question :)"}, {"owner": {"reputation": 781, "user_id": 291503, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2986e67e29cf2ad3de088f9f8bc131cf?s=128&d=identicon&r=PG", "display_name": "mikker", "link": "https://stackoverflow.com/users/291503/mikker"}, "reply_to_user": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1524687077, "post_id": 50029438, "comment_id": 87077183, "body": "I toyed around with <code>group</code> and <code>select</code> but then it came to the <code>where</code>s and I gave up."}, {"owner": {"reputation": 1230, "user_id": 511203, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ec96aadd672b8056173e4e8a5225d8b?s=128&d=identicon&r=PG", "display_name": "Mike Gorski", "link": "https://stackoverflow.com/users/511203/mike-gorski"}, "edited": false, "score": 0, "creation_date": 1524707510, "post_id": 50029438, "comment_id": 87083492, "body": "I&#39;m not sure how the <code>soft_destroyed_at</code> is used. Here&#39;s one idea. It groups by the start of the month for <code>soft_destroyed_at</code>:   <code>Subscription.where(   &#39;soft_destroyed_at IS NULL OR created_at &lt; soft_destroyed_at OR created_at &lt; suspended_at&#39; ).group(&quot;date_trunc(&#39;month&#39;, soft_destroyed_at)&quot;).count</code>"}], "answers": [{"comments": [{"owner": {"reputation": 781, "user_id": 291503, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2986e67e29cf2ad3de088f9f8bc131cf?s=128&d=identicon&r=PG", "display_name": "mikker", "link": "https://stackoverflow.com/users/291503/mikker"}, "edited": false, "score": 0, "creation_date": 1525080206, "post_id": 50079681, "comment_id": 87211372, "body": "<code>ERROR:  column &quot;next&quot; does not exist</code>"}, {"owner": {"reputation": 781, "user_id": 291503, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2986e67e29cf2ad3de088f9f8bc131cf?s=128&d=identicon&r=PG", "display_name": "mikker", "link": "https://stackoverflow.com/users/291503/mikker"}, "edited": false, "score": 0, "creation_date": 1525165865, "post_id": 50079681, "comment_id": 87244838, "body": "Kind of works! Only kink is that it skips zero values. If a given month has 0 matching rows it is completely omitted from the result."}, {"owner": {"reputation": 2885, "user_id": 3372172, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q3RaO.png?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/3372172/pablo"}, "reply_to_user": {"reputation": 781, "user_id": 291503, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2986e67e29cf2ad3de088f9f8bc131cf?s=128&d=identicon&r=PG", "display_name": "mikker", "link": "https://stackoverflow.com/users/291503/mikker"}, "edited": false, "score": 0, "creation_date": 1525178089, "post_id": 50079681, "comment_id": 87250266, "body": "You could change to an outer join instead. It should work I guess."}, {"owner": {"reputation": 781, "user_id": 291503, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2986e67e29cf2ad3de088f9f8bc131cf?s=128&d=identicon&r=PG", "display_name": "mikker", "link": "https://stackoverflow.com/users/291503/mikker"}, "edited": false, "score": 0, "creation_date": 1525198640, "post_id": 50079681, "comment_id": 87261034, "body": "That includes the keys, but empty values are <code>1</code> instead of <code>0</code> \ud83d\ude02"}, {"owner": {"reputation": 2885, "user_id": 3372172, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q3RaO.png?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/3372172/pablo"}, "reply_to_user": {"reputation": 781, "user_id": 291503, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2986e67e29cf2ad3de088f9f8bc131cf?s=128&d=identicon&r=PG", "display_name": "mikker", "link": "https://stackoverflow.com/users/291503/mikker"}, "edited": false, "score": 0, "creation_date": 1525206360, "post_id": 50079681, "comment_id": 87264744, "body": "Use count(created_at) instead of count(*)"}], "tags": [], "owner": {"reputation": 2885, "user_id": 3372172, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q3RaO.png?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/3372172/pablo"}, "is_accepted": true, "score": 1, "last_activity_date": 1525206462, "last_edit_date": 1525206462, "creation_date": 1524939369, "answer_id": 50079681, "question_id": 50029438, "link": "https://stackoverflow.com/questions/50029438/get-series-of-counts-with-conditions-using-activerecord/50079681#50079681", "title": "Get series of counts with conditions using ActiveRecord", "body": "<p>You can use this query (I used 12 month in 2017; just change as you wish). This assumes a Postgresql DB, as you said in a comment:</p>\n\n<pre><code>query = \n  \"select months.month, count(created_at) \"\\\n  \"from \"\\\n    \"(select DATE '2017-01-01'+(interval '1' month * generate_series(0,11)) as month, \"\\\n            \"DATE '2017-02-01'+(interval '1' month * generate_series(0,11)) as next) months \"\\\n    \"outer join subscriptions on \"\\\n    \"created_at &lt; month and \"\\\n    \"(soft_destroyed_at IS NULL or soft_destroyed_at &gt;= next) and \"\\\n    \"(suspended_at IS NULL OR suspended_at &gt;= next) \"\\\n  \"group by month \"\\\n  \"order by month\"\n\nresults = ActiveRecord::Base.connection.execute(query)\n</code></pre>\n\n<p>The first subquery (the <code>select</code> inside <code>from</code>) generates this:</p>\n\n<pre><code>month                 next\n\"2017-01-01 00:00:00\";\"2017-02-01 00:00:00\"\n\"2017-02-01 00:00:00\";\"2017-03-01 00:00:00\"\n\"2017-03-01 00:00:00\";\"2017-04-01 00:00:00\"\n\"2017-04-01 00:00:00\";\"2017-05-01 00:00:00\"\n\"2017-05-01 00:00:00\";\"2017-06-01 00:00:00\"\n\"2017-06-01 00:00:00\";\"2017-07-01 00:00:00\"\n\"2017-07-01 00:00:00\";\"2017-08-01 00:00:00\"\n\"2017-08-01 00:00:00\";\"2017-09-01 00:00:00\"\n\"2017-09-01 00:00:00\";\"2017-10-01 00:00:00\"\n\"2017-10-01 00:00:00\";\"2017-11-01 00:00:00\"\n\"2017-11-01 00:00:00\";\"2017-12-01 00:00:00\"\n\"2017-12-01 00:00:00\";\"2018-01-01 00:00:00\"\n</code></pre>\n\n<p>Next is only used to make it easier to check if the subscription was active at least until next month (destroyed or suspended are >= next (which guarantees the subscriber was active during current month).</p>\n"}], "owner": {"reputation": 781, "user_id": 291503, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2986e67e29cf2ad3de088f9f8bc131cf?s=128&d=identicon&r=PG", "display_name": "mikker", "link": "https://stackoverflow.com/users/291503/mikker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 236, "favorite_count": 0, "accepted_answer_id": 50079681, "answer_count": 1, "score": 3, "last_activity_date": 1525206462, "creation_date": 1524682266, "last_edit_date": 1524748160, "question_id": 50029438, "link": "https://stackoverflow.com/questions/50029438/get-series-of-counts-with-conditions-using-activerecord", "title": "Get series of counts with conditions using ActiveRecord", "body": "<p>I'm displaying a graph of <code>Subscription</code> counts that may have been <code>soft_destroyed_at</code> at some point.</p>\n\n<p>To do this I run a query for each month which is of course not as good as one big honking query but my SQL skills fail me once again.</p>\n\n<p>Here's how I do it in Ruby:</p>\n\n<pre><code>months = (0..12).map { |i| i.months.ago.end_of_month }\n\nstats = Hash[months.map do |eom|\n  [\n    eom.beginning_of_month.to_date,\n    Subscription.where(\n      'created_at &lt; ?' \\\n      'AND (soft_destroyed_at IS NULL ' \\\n      '  OR soft_destroyed_at &gt; ?) ' \\\n      'AND (suspended_at IS NULL ' \\\n      '  OR suspended_at &gt; ?)',\n      eom, eom, eom\n    ).count\n  ]\nend]\n\n# =&gt; { 2018-04-01 =&gt; 10, 2018-03-01 =&gt; 15, ... }\n</code></pre>\n\n<p>How could I write this as one query using ActiveRecord \u2013 or if necessary using <em>raw</em> SQL></p>\n\n<p>The database is Postgres 10.2, the app is Rails 5.2.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 211, "user_id": 4287118, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh4.googleusercontent.com/-lgSRWHI-t5o/AAAAAAAAAAI/AAAAAAAABT8/Q8JFtdEhp_g/photo.jpg?sz=128", "display_name": "Hemant Patil", "link": "https://stackoverflow.com/users/4287118/hemant-patil"}, "edited": false, "score": 0, "creation_date": 1524681527, "post_id": 50029225, "comment_id": 87074533, "body": "Not possible to include whole lines of chunk"}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1524681801, "post_id": 50029225, "comment_id": 87074672, "body": "Please paste your error not a single line, impossible to help like this."}, {"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 2, "creation_date": 1524685962, "post_id": 50029225, "comment_id": 87076688, "body": "How can we reproduce your error? Can you provide more context of the code?"}], "owner": {"reputation": 211, "user_id": 4287118, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh4.googleusercontent.com/-lgSRWHI-t5o/AAAAAAAAAAI/AAAAAAAABT8/Q8JFtdEhp_g/photo.jpg?sz=128", "display_name": "Hemant Patil", "link": "https://stackoverflow.com/users/4287118/hemant-patil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 381, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1524681496, "creation_date": 1524681496, "question_id": 50029225, "link": "https://stackoverflow.com/questions/50029225/actionviewhelperscontrollerhelperparams-delegated-to-controller-params-but", "title": "ActionView::Helpers::ControllerHelper#params delegated to controller.params, but controller is nil", "body": "<p>Frustrated by this issue. whenever I refresh my page I get below lines printed on my console,</p>\n\n<pre><code>ActionView::Template::Error: ActionView::Helpers::ControllerHelper#params delegated to controller.params, but controller is nil: #&lt;WebConsole::View:0x007fbf0137b398 @_config={}, @view_renderer=#&lt;ActionView::Renderer:0x007fbf0137af88 @lookup_context=#&lt;ActionView::LookupContext:0x007fbf0137b348 @details_key=nil, @cache=true, @prefixes=[], @rendered_format=:html, @details={:locale=&gt;[:en], :formats=&gt;[:html, :js, :text, :css, :ics, :csv, :vcf, :png, :jpeg, :gif, :bmp, :tiff, :svg, :mpeg, :xml, :rss, :atom, :yaml, :multipart_form, :url_encoded_form, :json, :pdf, :zip, :gzip, :xlsx], :variants=&gt;[], :handlers=&gt;[:raw, :erb, :html, :builder, :ruby, :axlsx, :coffee, :jbuilder, :haml]}, @view_paths=#&lt;ActionView::PathSet:0x007fbf0137b230 @paths=[#&lt;ActionView::OptimizedFileSystemResolver:0x007fbf0137b1e0 @pattern=\":prefix/:action{.:locale,}{.:formats,}{+:variants,}{.:handlers,}\", @cache=#&lt;ActionView::Resolver::Cache:0x7fbf0137b1b8 keys=4 queries=0&gt;, @path=\"/home/hemant/.rvm/gems/ruby-2.3.1/gems/web-console-3.5.1/lib/web_console/templates\"&gt;]&gt;&gt;&gt;, @env={\"rack.version\"=&gt;[1, 3], \"rack.errors\"=&gt;#&lt;IO:&lt;STDERR&gt;&gt;, \"rack.multithread\"=&gt;true, \"rack.multiprocess\"=&gt;false, \"rack.run_once\"=&gt;false, \"SCRIPT_NAME\"=&gt;\"\", \"QUERY_STRING\"=&gt;\"\", \"SERVER_PROTOCOL\"=&gt;\"HTTP/1.1\", \"SERVER_SOFTWARE\"=&gt;\"puma 3.11.3 Love Song\", \"GATEWAY_INTERFACE\"=&gt;\"CGI/1.2\", \"REQUEST_METHOD\"=&gt;\"GET\", \"REQUEST_PATH\"=&gt;\"/assets/pxiByp8kv8JHgFVrLDz8Z1xlFQ.woff2\", \"REQUEST_URI\"=&gt;\"/assets/pxiByp8kv8JHgFVrLDz8Z1xlFQ.woff2\", \"HTTP_VERSION\"=&gt;\"HTTP/1.1\", \"HTTP_HOST\"=&gt;\"localhost:3000\", \"HTTP_CONNECTION\"=&gt;\"keep-alive\", \"HTTP_ORIGIN\"=&gt;\"http://localhost:3000\", \"HTTP_USER_AGENT\"=&gt;\"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36\", \"HTTP_ACCEPT\"=&gt;\"*/*\", \"HTTP_REFERER\"=&gt;\"http://localhost:3000/assets/google300.css\", \"HTTP_ACCEPT_ENCODING\"=&gt;\"gzip, deflate, br\", \"HTTP_ACCEPT_LANGUAGE\"=&gt;\"en-GB,en-US;q=0.9,en;q=0.8\", \"HTTP_COOKIE\"=&gt;\"_premier_ats_session=YllLSEZLb3VWOUc0MTExRUlEMUhVcmxEOGtlUDdEeU1ueHFzVHpJNlRnTDI5dnY1dkNQYlFyVG92QzY4M0tpSjZ1bWF4cEVXKzBlUHNkZjhVODFOczhSQUNRUjVnU0UvSVM4RkxOSWdlNEN1bENNOWQvaVYyWDdtZFJnUlhmTzJzLzA4ZTZsaXpjUk5sOFR4bXdLck85V0RWQW1md0tZc2FwOWhMbXc4V3N5dDZ5a3Q5S1VuMjZwVVBnaU54OW9xbnpEamc2d0xpSklMTStEUDUwK1RGbm5QTUxNaTRqQXdUUU9FdWdON2g4ZlJ6UXB5WjFYZC9jcklrdVhrRmlxa1dSbHBPYkJpRGgvcjVINDZhaEJlYlE9PS0tdmR4UWh4dEI2T0JHeHJKalVjdjZ5UT09--cfb90a4802dac6a20f923d1d5202481f5daee857; _sofu_session=c29e17476d0eb841a1cf27e353e8bd2e\", \"SERVER_NAME\"=&gt;\"localhost\", \"SERVER_PORT\"=&gt;\"3000\", \"PATH_INFO\"=&gt;\"/assets/pxiByp8kv8JHgFVrLDz8Z1xlFQ.woff2\", \"REMOTE_ADDR\"=&gt;\"127.0.0.1\", \"puma.socket\"=&gt;#&lt;TCPSocket:fd 18&gt;, \"rack.hijack?\"=&gt;true, \"rack.hijack\"=&gt;#&lt;Puma::Client:0x2b83b64 @ready=true&gt;, \"rack.input\"=&gt;#&lt;Puma::NullIO:0x0000000623acc0&gt;, \"rack.url_scheme\"=&gt;\"http\", \"rack.after_reply\"=&gt;[], \"puma.config\"=&gt;#&lt;Puma::Configuration:0x0000000635ace0 @options=#&lt;Puma::UserFileDefaultOptions:0x0000000635aa38 @user_options={:log_requests=&gt;false, :app=&gt;#&lt;Sofu::Application:0x000000053c0e10 @_all_autoload_paths=[\"/home/hemant/hemant/sofu/lib\", \"/home/hemant/hemant/sofu/app/assets\", \"/home/hemant/hemant/sofu/app/channels\", \"/home/hemant/hemant/sofu/app/controllers\", \"/home/hemant/hemant/sofu/app/controllers/concerns\", \"/home/hemant/hemant/sofu/app/datatables\", \"/home/hemant/hemant/sofu/app/helpers\", \"/home/hemant/hemant/sofu/app/jobs\", \"/home/hemant/hemant/sofu/app/mailers\", \"/home/hemant/hemant/sofu/app/models\", \"/home/hemant/hemant/sofu/app/models/concerns\"], @_all_load_paths=[\"/home/hemant/hemant/sofu/lib\", \"/home/hemant/hemant/sofu/vendor\", \"/home/hemant/hemant/sofu/app/assets\", \"/home/hemant/hemant/sofu/app/channels\", \"/home/hemant/hemant/sofu/app/controllers\", \"/home/hemant/hemant/sofu/app/controllers/concerns\", \"/home/hemant/hemant/sofu/app/datatables\", \"/home/hemant/hemant/sofu/app/helpers\", \"/home/hemant/hemant/sofu/app/jobs\", \"/home/hemant/hemant/sofu/app/mailers\", \"/home/hemant/hemant/sofu/app/models\", \"/home/hemant/hemant/sofu/app/models/concerns\"], @app=#&lt;Rack::Sendfile:0x000000060269e8 @app=#&lt;ActionDispatch::Static:0x00000006026d58 @app=#&lt;ActionDispatch::Executor:0x00000006026da8 @app=#&lt;ActiveSupport::Cache::Strategy::LocalCache::Middleware:0x000000050ba450 @name=\"ActiveSupport::Cache::Strategy::LocalCache\", @local_cache_key=:active_support_cache_null_store_local_cache_42362840, @app=#&lt;Rack::Runtime:0x00000006026dd0 @app=#&lt;Rack::MethodOverride:0x00000006026df8 @app=#&lt;ActionDispatch::RequestId:0x00000006026e20 @app=#&lt;RequestStore::Middleware:0x00000006026e48 @app=#&lt;Sprockets::Rails::QuietAssets:0x000000060270f0 @app=#&lt;Rails::Rack::Logger:0x00000006027140 @app=#&lt;ActionDispatch::ShowExceptions:0x00000006027168 @app=#&lt;WebConsole::Middleware:0x00000006027190 @app=#&lt;ActionDispatch::DebugExceptions:0x000000060271b8 @app=#&lt;ActionDispatch::RemoteIp:0x000000060271e0 @app=#&lt;ActionDispatch::Reloader:0x00000006027230 @app=#&lt;ActionDispatch::Callbacks:0x00000006027258 @app=#&lt;ActiveRecord::Migration::CheckPending:0x00000006027280 @app=#&lt;ActionDispatch::Cookies:0x000000060272a8 @app=#&lt;ActionDispatch::Session::ActiveRecordStore:0x00000006027370 @app=#&lt;Rack::Head:0x00000006027398 @app=#&lt;Rack::ConditionalGet:0x000000060273c0 @app=#&lt;Rack::ETag:0x000000060273e8 @app=#&lt;Warden::Manager:0x000000060274b0 @config={:default_scope=&gt;:user, :scope_defaults=&gt;{}, :default_strategies=&gt;{:user=&gt;[:rememberable, :database_authenticatable]}, :intercept_401=&gt;false, :failure_app=&gt;#&lt;Devise::Delegator:0x0000000420a658&gt;}, @app=#&lt;Remotipart::Middleware:0x000000060274d8 @app=#&lt;Rack::Pjax:0x00000006027528 @app=#&lt;ActionDispatch::Routing::RouteSet:0x000000051bde60&gt;&gt;&gt;&gt;, @cache_control=\"max-age=0, private, must-revalidate\", @no_cache_control=\"no-cache\"&gt;&gt;&gt;, @default_options={:path=&gt;\"/\", :domain=&gt;nil, :expire_after=&gt;nil, :secure=&gt;false, :httponly=&gt;true, :defer=&gt;false, :renew=&gt;false}, @key=\"_sofu_session\", @cookie_only=true&gt;&gt;, @last_check=1524678822&gt;&gt;, @executor=#&lt;Class:0x0000000535e558&gt;&gt;, @check_ip=true, @proxies=[#&lt;IPAddr: IPv4:127.0.0.1/255.255.255.255&gt;, #&lt;IPAddr: IPv6:0000:0000:0000:0000:0000:0000:0000:0001/ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff&gt;, #&lt;IPAddr: IPv6:fc00:0000:0000:0000:0000:0000:0000:0000/fe00:0000:0000:0000:0000:0000:0000:0000&gt;, #&lt;IPAddr: IPv4:10.0.0.0/255.0.0.0&gt;, #&lt;IPAddr: IPv4:172.16.0.0/255.240.0.0&gt;, #&lt;IPAddr: IPv4:192.168.0.0/255.255.0.0&gt;]&gt;, @routes_app=#&lt;Sofu::Application:0x000000053c0e10 ...&gt;, @response_format=:default&gt;&gt;, @exceptions_app=#&lt;ActionDispatch::PublicExceptions:0x00000006074b48 @public_path=#&lt;Pathname:/home/hemant/hemant/sofu/public&gt;&gt;&gt;, @taggers=[]&gt;, @assets_regex=/\\A\\/{0,2}\\/assets/&gt;&gt;&gt;&gt;, @header_name=\"X-Runtime\"&gt;&gt;, @executor=#&lt;Class:0x0000000536bc30&gt;&gt;, @file_handler=#&lt;ActionDispatch::FileHandler:0x00000006026ce0 @root=\"/home/hemant/hemant/sofu/public\", @file_server=#&lt;Rack::File:0x00000006026ba0 @root=\"/home/hemant/hemant/sofu/public\", @headers={}, @default_mime=\"text/plain\", @head=#&lt;Rack::Head:0x00000006026a10 @app=#&lt;Proc:0x00000006026a88@/home/hemant/.rvm/gems/ruby-2.3.1/gems/rack-2.0.4/lib/rack/file.rb:26 (lambda)&gt;&gt;&gt;, @index=\"index\"&gt;&gt;, @variation=nil, @mappings=[]&gt;, @config=#&lt;Rails::Application::Configuration:0x0000000535df18 @root=#&lt;Pathname:/home/hemant/hemant/sofu&gt;, @generators=#&lt;Rails::Configuration::Generators:0x000000029fe578 @aliases={}, @options={:rails=&gt;{:orm=&gt;:active_record, :test_framework=&gt;:test_unit, :integration_tool=&gt;:test_unit, :stylesheet_engine=&gt;:scss, :javascript_engine=&gt;:coffee}, :active_record=&gt;{:migration=&gt;true, :timestamps=&gt;true}, :test_unit=&gt;{:fixture=&gt;true, :fixture_replacement=&gt;nil}}, @fallbacks={}, @templates=[], @colorize_logging=true, @api_only=false, @hidden_namespaces=[\"sass\"]&gt;, @middleware=#&lt;ActionDispatch::MiddlewareStack:0x000000063492b0 @middlewares=[Rack::Sendfile, ActionDispatch::Static, ActionDispatch::Executor, ActiveSupport::Cache::Strategy::LocalCache::Middleware, Rack::Runtime, Rack::MethodOverride, ActionDispatch::RequestId, RequestStore::Middleware, Sprockets::Rails::QuietAssets, Rails::Rack::Logger, ActionDispatch::ShowExceptions, WebConsole::Middleware, ActionDispatch::DebugExceptions, ActionDispatch::RemoteIp, ActionDispatch::Reloader, ActionDispatch::Callbacks, ActiveRecord::Migration::CheckPending, ActionDispatch::Cookies, ActionDispatch::Session::ActiveRecordStore, ActionDispatch::Flash, Rack::Head, Rack::ConditionalGet, Rack::ETag, Warden::Manager, Remotipart::Middleware, ActionDispatch::Flash, Rack::Pjax]&gt;, @encoding=\"utf-8\", @allow_concurrency=nil, @consider_all_requests_local=true, @filter_parameters=[:password], @filter_redirect=[], @helpers_paths=[\"/home/hemant/hemant/sofu/app/helpers\", \"/home/hemant/.rvm/gems/ruby-2.3.1/gems/font-awesome-rails-4.7.0.3/app/helpers\", \"/home/hemant/.rvm/gems/ruby-2.3.1/gems/devise-4.4.3/app/helpers\"], @public_file_server={:enabled=&gt;true, :index_name=&gt;\"index\"}, @force_ssl=false, @ssl_options={:hsts=&gt;{:subdomains=&gt;true}}, @session_store=:active_record_store, @session_options={:key=&gt;\"_sofu_session\"}, @time_zone=\"UTC\", @be\n</code></pre>\n\n<p>I checked this link : <a href=\"https://stackoverflow.com/questions/22875355/runtimeerror-exception-actionviewhelperscontrollerhelperresponse-deleg\">*** RuntimeError Exception: ActionView::Helpers::ControllerHelper#response delegated to controller.response, but controller is nil</a></p>\n\n<p>but nothing helped me</p>\n"}, {"tags": ["html", "ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1524682053, "post_id": 50029147, "comment_id": 87074798, "body": "why do you need any of this complex logic in the controller?  where is &#39;@mesurement` defined? If it&#39;s an instance of a model, then move this logic to a model method."}], "answers": [{"tags": [], "owner": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "is_accepted": false, "score": 2, "last_activity_date": 1524683699, "last_edit_date": 1524683699, "creation_date": 1524683078, "answer_id": 50029646, "question_id": 50029147, "link": "https://stackoverflow.com/questions/50029147/how-to-show-a-calculation-in-controller-to-the-view-rails/50029646#50029646", "title": "How to show a calculation in controller to the view (Rails)", "body": "<p>It seems like your primary problem is that you're calling <code>calculate</code> on <code>@measurement</code> here:</p>\n\n<pre><code>&lt;p&gt;\n  &lt;strong&gt;Body Fat (%): &lt;/strong&gt;\n  &lt;%= @measurement.calculate %&gt;\n&lt;/p&gt;\n</code></pre>\n\n<p>But, it looks like the <code>calculate</code> logic is in the controller. I don't know what the <code>calculate</code> method looks like on <code>@measurement</code>, but apparently it's return <code>nil</code> or some such thing. </p>\n\n<p>If I were you, I'd move all this logic into a <code>BodyFatCalculator</code> class, something like: </p>\n\n<pre><code>class BodyFatCalculator\n\n  # using a constant makes it a *little* easier to make sure you don't have\n  # a typo in your constant values\n  CONST_VALUES = {\n    male: {\n      one:    1.112,\n      two:    0.00043499,\n      three:  0.00000055,\n      four:   0.00028826\n    },\n    female: {\n      one:    1.097,\n      two:    0.00046971,\n      three:  0.00000056,\n      four:   0.00012828\n    }\n  }\n\n  # this just defines the methods 'const_one', 'const_two', etc. that\n  # return the appropriate constant from above. The const_val\n  # method is defined below.\n  [:one, :two, :three, :four].each do |const_ref|\n    define_method(\"const_#{const_ref}\") do \n      const_val const_ref\n    end\n  end\n\n  # provides a getter/setter for @measurement\n  attr_accessor :measurement\n\n  class &lt;&lt; self\n\n    # class-level method that lets you do BodyFatCalculator.calculate.\n    # Requires that a 'measurement' is passed in as an argument.\n    def calculate(measurement)\n      new(measurement).calculate\n    end\n\n  end\n\n  # sets the @measurement instance variable.\n  def initialize(measurement)\n    @measurement = measurement\n  end\n\n  # does the calculation\n  def calculate\n    (495 / body_density) - 450\n  end\n\n  # calculates body density. I think this is a *little* more readable\n  # so that it's easier to see if you have the formula right. The 'const_one',\n  # 'const_two', etc. methods were defined at the top. \n  # The `sum_two` method is defined below.\n  def body_density\n    const_one - ( const_two * sum_two ) + ( const_three * sum_two^2 ) + ( const_four * measurement.age )\n  end\n\n  # given a type (like ':one', ':two', etc.), uses 'measurement.gender_type'\n  # to return the correct constant.\n  def const_value(type)\n    CONST_VALUES[measurement.gender_type.underscore.to_sym][type]\n  end\n\n  # given an array of names, will sum the values from '@measurement'\n  # that correspond to the name.\n  def sum_of *names\n    names.each_with_object(0) do |name, sum|\n      sum += measurement.send(name)\n    end\n  end\n\n  # sum of a specific set of values from '@measurement'.\n  def sum_two\n    @sum_two ||= sum_of(*w(chest Midaxillary Tricep Subscapular Abdominal Suprailiac Thigh))\n  end\n\nend\n</code></pre>\n\n<p>(WARNING: Hasn't been tested.)</p>\n\n<p>Then, in your controller, do something like: </p>\n\n<pre><code>def show\n  @body_fat = BodyFatCalculator.calculate(@measurement)\nend\n</code></pre>\n\n<p>And in your view:</p>\n\n<pre><code>&lt;p&gt;\n  &lt;strong&gt;Body Fat (%): &lt;/strong&gt;\n  &lt;%= @body_fat %&gt;\n&lt;/p&gt;\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 0, "creation_date": 1524723503, "post_id": 50035359, "comment_id": 87087962, "body": "Or, Solution #3, you could create a <code>BodyFatCalculator</code> class... ;-) Nice work!"}], "tags": [], "owner": {"reputation": 23, "user_id": 5230747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61302142299c1549f9cf99813d67b0d9?s=128&d=identicon&r=PG&f=1", "display_name": "johnnyh", "link": "https://stackoverflow.com/users/5230747/johnnyh"}, "is_accepted": false, "score": 1, "last_activity_date": 1524720078, "creation_date": 1524720078, "answer_id": 50035359, "question_id": 50029147, "link": "https://stackoverflow.com/questions/50029147/how-to-show-a-calculation-in-controller-to-the-view-rails/50035359#50035359", "title": "How to show a calculation in controller to the view (Rails)", "body": "<p>A few notes:</p>\n\n<p>1) Be sure to follow <a href=\"https://github.com/bbatsov/ruby-style-guide#naming\" rel=\"nofollow noreferrer\">Ruby naming conventions</a>: use snake case for symbols, methods, and variables (e.g. <code>bodyDensityMale</code> should be <code>body_density_male</code> and <code>Midaxillary</code>, <code>Tricep</code>, etc. should be <code>midaxillary</code>, <code>tricep</code>)</p>\n\n<p>2) <code>^</code> is the Ruby <a href=\"https://www.tutorialspoint.com/ruby/ruby_operators.htm\" rel=\"nofollow noreferrer\">binary XOR operator</a>.  <code>**</code> is for exponents.</p>\n\n<p>3) There is a bug in your controller condition due to <code>=</code> vs <code>==</code>.  </p>\n\n<pre><code>if (@measurement.gender_type = 'Male')\n</code></pre>\n\n<p>should be</p>\n\n<pre><code>if (@measurement.gender_type == 'Male')\n</code></pre>\n\n<p>The first is assigning the value, so it will always be true.  <code>==</code> is for equality comparison.</p>\n\n<p>The calculation logic is best moved out of the controller and into a model or service class.  Here are two solutions for putting it in the <code>Measurement</code> model:</p>\n\n<pre><code>################################################################################\n# Solution #1\n################################################################################\nclass Measurement\n  MALE = 'Male'\n\n  def body_fat\n    (495 / body_density) - 450\n  end\n\n  def body_density\n    gender_type == MALE ? body_density_male : body_density_female\n  end\n\n  def body_density_male\n    1.112 -\n    (0.00043499 * body_density_sum) +\n    (0.00000055 * body_density_sum ** 2) -\n    (0.00028826 * age)\n  end\n\n  def body_density_female\n    1.097 -\n    (0.00046971 * body_density_sum) +\n    (0.00000056 * body_density_sum ** 2) -\n    (0.00012828 * age)\n  end\n\n  def body_density_sum\n    [chest, midaxillary, tricep, subscapular, abdominal, suprailiac, thigh].sum\n  end\nend\n\n################################################################################\n# Solution #2 using subclasses\n################################################################################\nclass Measurement\n  def body_fat\n    (495 / body_density) - 450\n  end\n\n  def body_density_sum\n    [chest, midaxillary, tricep, subscapular, abdominal, suprailiac, thigh].sum\n  end\nend\n\nclass MaleMeasurement &lt; Measurement\n  def body_density\n    1.112 -\n    (0.00043499 * body_density_sum) +\n    (0.00000055 * body_density_sum ** 2) -\n    (0.00028826 * age)\n  end\nend\n\nclass FemaleMeasurement &lt; Measurement\n  def body_density\n    1.097 -\n    (0.00046971 * body_density_sum) +\n    (0.00000056 * body_density_sum ** 2) -\n    (0.00012828 * age)\n  end\nend\n</code></pre>\n\n<p>To use Solution #2 with subclasses you would have to have set up the <code>Measurement</code> model and database table using <a href=\"http://api.rubyonrails.org/classes/ActiveRecord/Inheritance.html\" rel=\"nofollow noreferrer\">single table inheritance</a>.  Solution #1 would require no database changes and is probably quickest/easiest (you could refactor down the road).</p>\n\n<p>With either solution though, in your view:</p>\n\n<pre><code>&lt;p&gt;\n  &lt;strong&gt;Body Fat (%): &lt;/strong&gt;\n  &lt;%= @measurement.body_fat %&gt;\n&lt;/p&gt;\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 9699611, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Karan Edikala", "link": "https://stackoverflow.com/users/9699611/karan-edikala"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1524879330, "creation_date": 1524681205, "last_edit_date": 1524681435, "question_id": 50029147, "link": "https://stackoverflow.com/questions/50029147/how-to-show-a-calculation-in-controller-to-the-view-rails", "title": "How to show a calculation in controller to the view (Rails)", "body": "<p>I am building a website that can store body measurements and calculate body fat using jackson/ pollock 7 method formula. I am pretty new to rails and not sure how I can output the calculation from the measurements controller into the show.html.</p>\n\n<p>Measurements_controller.rb calculate method:</p>\n\n<pre><code>def calculate\n\n  bodyDensityMale = 1.112 - (0.00043499 * (@measurement.chest + @measurement.Midaxillary + @measurement.Tricep+@measurement.Subscapular+@measurement.Abdominal\n+@measurement.Suprailiac+@measurement.Thigh)) + (0.00000055 * (@measurement.chest+@measurement.Midaxillary+@measurement.Tricep+@measurement.Subscapular+@measurement.Abdominal\n+@measurement.Suprailiac+@measurement.Thigh)^2) - (0.00028826 * @measurement.age)\n\n  bodyDensityFemale = 1.097 - (0.00046971 * (@measurement.chest + @measurement.Midaxillary+@measurement.Tricep+@measurement.Subscapular+@measurement.Abdominal\n+@measurement.Suprailiac+@measurement.Thigh)) + (0.00000056 * (@measurement.chest+@measurement.Midaxillary+@measurement.Tricep+@measurement.Subscapular+@measurement.Abdominal\n+@measurement.Suprailiac+@measurement.Thigh)^2) - (0.00012828 * @measurement.age)\n\n  bodyFatMale = (495 / bodyDensityMale) - 450\n  bodyFatFemale = (495 / bodyDensityFemale) - 450\n\n  if (@measurement.gender_type = 'Male')\n    puts bodyFatMale\n  else\n    puts bodyFatFemale\n  end\nend\n</code></pre>\n\n<p>show.html.erb </p>\n\n<pre><code>&lt;p&gt;\n    &lt;strong&gt;Body Fat (%): &lt;/strong&gt;\n    &lt;%= @measurement.calculate %&gt;\n&lt;/p&gt;\n</code></pre>\n\n<p>When I create the entry there are no errors but the Body fat % field shows up empty. I appreciate any help!</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-4", "activerecord"], "comments": [{"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1524681212, "post_id": 50028903, "comment_id": 87074363, "body": "why not store if buyer is a client/lead as a boolean in the client table?"}, {"owner": {"reputation": 2401, "user_id": 2873548, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b90a1fd45fc72bd55f8948b385d4626f?s=128&d=identicon&r=PG&f=1", "display_name": "anonn023432", "link": "https://stackoverflow.com/users/2873548/anonn023432"}, "reply_to_user": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1524681883, "post_id": 50028903, "comment_id": 87074710, "body": "@lacostenycoder because a buyer may be a <code>client</code> for a specific <code>seller</code> but a <code>lead</code> for a different <code>seller</code> depending on whether the <code>buyer</code> has bought any paid product from the specific <code>seller</code>"}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1524682271, "post_id": 50028903, "comment_id": 87074907, "body": "Move as much of the model logic to model methods, keep a little logic as possible in the view, especially while iterating. Hard to offer more specific help without understanding of your models and their relations."}], "answers": [{"comments": [{"owner": {"reputation": 2401, "user_id": 2873548, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b90a1fd45fc72bd55f8948b385d4626f?s=128&d=identicon&r=PG&f=1", "display_name": "anonn023432", "link": "https://stackoverflow.com/users/2873548/anonn023432"}, "edited": false, "score": 0, "creation_date": 1524685360, "post_id": 50029618, "comment_id": 87076418, "body": "Thank You for your help. I moved it to a scope as you suggested but I&#39;m still looking for a way to make this more efficient. Specifically I&#39;m unsure if the <code>join</code> is causing it to load more data than necessarry"}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "reply_to_user": {"reputation": 2401, "user_id": 2873548, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b90a1fd45fc72bd55f8948b385d4626f?s=128&d=identicon&r=PG&f=1", "display_name": "anonn023432", "link": "https://stackoverflow.com/users/2873548/anonn023432"}, "edited": false, "score": 0, "creation_date": 1524687041, "post_id": 50029618, "comment_id": 87077154, "body": "the <code>.join</code> is just doing a sql join so it should not cause any performance issue. But you may wanna use <a href=\"https://github.com/flyerhzm/bullet\" rel=\"nofollow noreferrer\">github.com/flyerhzm/bullet</a> to check for N+1 queries etc. For memory concerns check out <a href=\"https://github.com/SamSaffron/memory_profiler\" rel=\"nofollow noreferrer\">github.com/SamSaffron/memory_profiler</a> and there are many others"}], "tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": true, "score": 1, "last_activity_date": 1524682953, "creation_date": 1524682953, "answer_id": 50029618, "question_id": 50028903, "link": "https://stackoverflow.com/questions/50028903/rails-pulling-every-attribute-of-included-data/50029618#50029618", "title": "Rails pulling every attribute of included data", "body": "<p>Whatever you do you should move this out of the view and to a method probably on buyer. But from what we can tell, this shouldn't have to build ruby objects if it's just an active record relation.  Create a scope on buyer and pass in <code>@seller</code></p>\n\n<pre><code>c.buyer.purchases\n       .where(seller: @seller)\n       .where('subscription = ? OR product_price &gt; ?',true, 0)\n       .exists?\n</code></pre>\n\n<p>move to model, probably Purchase?</p>\n\n<pre><code>class Purchase\n  scope :already_client, -&gt; (seller) {\n    .where(seller: seller)\n    .where('subscription = ? OR product_price &gt; ?',true, 0)\n    .exists?\n  }\nend\n</code></pre>\n\n<p>inside your json builder:</p>\n\n<pre><code>already_client: c.buyer.purchases.already_client(@seller)\n</code></pre>\n"}], "owner": {"reputation": 2401, "user_id": 2873548, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b90a1fd45fc72bd55f8948b385d4626f?s=128&d=identicon&r=PG&f=1", "display_name": "anonn023432", "link": "https://stackoverflow.com/users/2873548/anonn023432"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 31, "favorite_count": 0, "accepted_answer_id": 50029618, "answer_count": 1, "score": 0, "last_activity_date": 1524682953, "creation_date": 1524680166, "question_id": 50028903, "link": "https://stackoverflow.com/questions/50028903/rails-pulling-every-attribute-of-included-data", "title": "Rails pulling every attribute of included data", "body": "<p>I have a <code>conversations</code> controller which is used to pull all the conversations for a user of type <code>seller</code>. </p>\n\n<p>Sellers can have <code>products</code> which can be <code>purchased</code> by <code>buyers</code> and the <code>product</code> may be free. For the list of conversations every <code>buyer</code> is tagged as a <code>client</code> or a <code>lead</code> depending on the following factors:</p>\n\n<p><code>buyer</code> purchased a paid product or subscribed to a product => <code>client</code></p>\n\n<p><code>else</code> => <code>lead</code></p>\n\n<p>My <code>converastions_controller</code> is:</p>\n\n<pre><code>@conversation = Conversation.includes(:messages)\n                            .get_coach_conversations(@seller)\n</code></pre>\n\n<p>My <code>Conversation</code> model has the method:</p>\n\n<pre><code>def self.get_seller_conversations(seller)\n  @conversations = seller.conversations\n                         .includes(buyer: [:purchases, :user])\n                         .joins(:messages)\n                         .where(messages: {only_for_buyer: false})\n                         .distinct\n  new.sorted_conversations(@conversations)\nend\n\ndef sorted_conversations(conversations)\n  conversations.sort_by { |c| c.messages.last.created_at }\n               .reverse\nend\n</code></pre>\n\n<p>And then in my <code>jbuilder</code> for the <code>seller/conversations</code> <code>index</code> method I have the following check to check if the <code>buyer</code> is a  <code>client</code> or a <code>lead</code></p>\n\n<p><code>coach/conversations/index.json.jbuilder</code>:</p>\n\n<pre><code>json.array!(@conversations.map do |c|\n  ...\n  ...\n  already_client: c.buyer.purchases\n                         .where(seller: @seller)\n                         .where('subscription = ? OR product_price &gt; ?',\n                                 true, 0)\n                         .exists?\nend)\n</code></pre>\n\n<p>I think I can expect this to be a slow request because I'm pulling a lot of content for the check but that <code>join</code> seems to be pulling all the attributes of every <code>model</code> which is included in the ActiveRecord request. Wondering if there's a better way to check this without needing to pull all the data.</p>\n\n<p>For my includes the models have been included for the following information:</p>\n\n<p><code>buyer</code> -> <code>users</code> are connected to <code>conversations</code> through <code>buyer/seller</code> model</p>\n\n<p><code>purchases</code> -> check if <code>buyer</code> is a <code>client/lead</code></p>\n\n<p><code>user</code> -> <code>buyers</code> <code>name</code> and <code>display picture</code></p>\n"}, {"tags": ["ruby", "zoho"], "comments": [{"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1524916466, "post_id": 50028775, "comment_id": 87168572, "body": "Can you post your <code>RubyZoho.configure </code> block code?"}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1524916811, "post_id": 50028775, "comment_id": 87168660, "body": "And the code where you&#39;re actually creating the task?"}, {"owner": {"reputation": 5141, "user_id": 193980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/aafa8848c4b764f080b1b31a51eab73d?s=128&d=identicon&r=PG", "display_name": "Phlip", "link": "https://stackoverflow.com/users/193980/phlip"}, "reply_to_user": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1524930568, "post_id": 50028775, "comment_id": 87172605, "body": "They are trivial but I added them."}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1524932632, "post_id": 50028775, "comment_id": 87173271, "body": "Seems obvious, but are we&#39;re sure <code>lead.id</code> returns a value? do both <code>lead.save</code> and <code>task.save</code> work?  is it possible that <code>lead = found.first; lead == nil</code> ?"}, {"owner": {"reputation": 5141, "user_id": 193980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/aafa8848c4b764f080b1b31a51eab73d?s=128&d=identicon&r=PG", "display_name": "Phlip", "link": "https://stackoverflow.com/users/193980/phlip"}, "reply_to_user": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1524942464, "post_id": 50028775, "comment_id": 87176162, "body": "Both <code>lead.save</code> and <code>task.save</code> are working because I can find the records they wrote in Zoho. <code>lead</code> is not <code>nil</code>, and <code>lead.id</code> is <code>3209647000000176001</code>. Still no link between the records."}], "answers": [{"comments": [{"owner": {"reputation": 5141, "user_id": 193980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/aafa8848c4b764f080b1b31a51eab73d?s=128&d=identicon&r=PG", "display_name": "Phlip", "link": "https://stackoverflow.com/users/193980/phlip"}, "edited": false, "score": 0, "creation_date": 1525209130, "post_id": 50080825, "comment_id": 87265930, "body": "It wasn&#39;t me. But I&#39;m still processing your answer; I have a higher-priority task now"}, {"owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "reply_to_user": {"reputation": 5141, "user_id": 193980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/aafa8848c4b764f080b1b31a51eab73d?s=128&d=identicon&r=PG", "display_name": "Phlip", "link": "https://stackoverflow.com/users/193980/phlip"}, "edited": false, "score": 0, "creation_date": 1525271134, "post_id": 50080825, "comment_id": 87292302, "body": "@Phlip, no worries. Just do it a timely manner, so in case it doesn&#39;t work we can look at other possibilities."}], "tags": [], "owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "is_accepted": false, "score": 1, "last_activity_date": 1524947762, "creation_date": 1524947762, "answer_id": 50080825, "question_id": 50028775, "link": "https://stackoverflow.com/questions/50028775/in-rubyzoho-how-to-set-task-related-to-lead-id/50080825#50080825", "title": "In RubyZoho, how to set Task.related_to Lead.id?", "body": "<p>If you look at the documentation it has a section on this</p>\n\n<p><a href=\"https://www.zoho.com/creator/help/script/creating-a-record-in-zoho-crm.html#create-lead\" rel=\"nofollow noreferrer\">https://www.zoho.com/creator/help/script/creating-a-record-in-zoho-crm.html#create-lead</a></p>\n\n<pre><code>taskInfo = {\n\"Task Owner\" : input.Owner_Name,\n\"SMOWNERID\" : input.Owner_ID,\n\"Subject\" : input.Subject,\n\"Description\" : input.Description,\n\"SEMODULE\" : \"Accounts\",\n\"SEID\" : input.Account_ID,\n\"CONTACTID\" : input.Contact_ID};\ncrmResp = zoho.crm.create(\"Tasks\", taskInfo);\n</code></pre>\n\n<blockquote>\n  <p>SMOWNERID is the ID of the Owner</p>\n  \n  <p>SEMODULE can be Accounts or Leads or Cases</p>\n  \n  <p>SEID is the ID of the Record given in the SEMODULE</p>\n  \n  <p>CONTACTID is the ID of the contact record</p>\n</blockquote>\n\n<p>Also if you look at the <code>ruby_zoho_rspec</code> for creating new task</p>\n\n<p><a href=\"https://github.com/amalc/rubyzoho/blob/950ffe369252f8fad3e7ae67ebddec859c84e19b/spec/ruby_zoho_spec.rb\" rel=\"nofollow noreferrer\">https://github.com/amalc/rubyzoho/blob/950ffe369252f8fad3e7ae67ebddec859c84e19b/spec/ruby_zoho_spec.rb</a></p>\n\n<pre><code>it 'should save an task record related to an account' do\nVCR.use_cassette 'zoho/task_related_to_account' do\n  a = RubyZoho::Crm::Account.all.first\n  e = RubyZoho::Crm::Task.new(\n      :task_owner =&gt; a.account_owner,\n      :subject =&gt; \"Task should be related to #{a.account_name} #{Time.now}\",\n      :description =&gt; 'Nothing',\n      :smownerid =&gt; \"#{a.smownerid}\",\n      :status =&gt; 'Not Started',\n      :priority =&gt; 'High',\n      :send_notification_email =&gt; 'False',\n      :due_date =&gt; '2014-02-16 16:00:00',\n      :start_datetime =&gt; Time.now.to_s[1, 19],\n      :end_datetime =&gt; '2014-02-16 16:00:00',\n      :related_to =&gt; \"#{a.account_name}\",\n      :seid =&gt; \"#{a.accountid}\",\n      :semodule =&gt; 'Accounts'\n  )\n  r_expected = e.save\n  r = RubyZoho::Crm::Task.find_by_activityid(r_expected.id)\n  r.first.subject[0..20].should eq(r_expected.subject[0..20])\nend\n</code></pre>\n\n<p>So that should help you out link it by specifying <code>SEMODULE</code> and <code>SEID</code></p>\n"}], "owner": {"reputation": 5141, "user_id": 193980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/aafa8848c4b764f080b1b31a51eab73d?s=128&d=identicon&r=PG", "display_name": "Phlip", "link": "https://stackoverflow.com/users/193980/phlip"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1524947762, "creation_date": 1524679727, "last_edit_date": 1524930402, "question_id": 50028775, "link": "https://stackoverflow.com/questions/50028775/in-rubyzoho-how-to-set-task-related-to-lead-id", "title": "In RubyZoho, how to set Task.related_to Lead.id?", "body": "<p>I wrote this question up at RubyZoho's forum, but it's languishing there, and it's such a simple question it deserves a wider audience.</p>\n\n<p>I have used RubyZoho to upload a new Lead record to the Zoho CRM API, and now I want to upload a Task with its \"related to\" field set to that Lead.</p>\n\n<p>Configuring RubyZoho:</p>\n\n<pre><code>RubyZoho.configure do |config|\n  config.api_key = Setting.plugin_redmine_tigase['zoho_authorization_token']\n  config.crm_modules = [\n      'Leads',\n      'Tasks'\n  ]\n  config.ignore_fields_with_bad_names = true\n  config.cache_fields = true\nend\n</code></pre>\n\n<p>Creating the lead:</p>\n\n<pre><code>  lead = RubyZoho::Crm::Lead.new\n  lead.first_name = splut.first\n  lead.last_name = splut.last\n  lead.full_name = params[:name]\n  lead.company = params[:company]\n  lead.email = params[:mail]\n  lead.description = description\n  lead.save\n</code></pre>\n\n<p>Creating the Task:</p>\n\n<pre><code>  found = RubyZoho::Crm::Lead.find_by_email(params[:mail])\n  lead = found.first\n  task = RubyZoho::Crm::Task.new\n  task.related_to = lead.id\n  task.subject = params[:subject]\n  task.description = description\n  task.save\n</code></pre>\n\n<p>I tried <code>task.related_to = lead.leadid</code>, and got a Task record with a blank \"related to\" in the Zoho website. And when I try <code>task.related_to = 'Lead'; task.relatedtoid = lead.leadid</code>, I get a <code>undefined method relatedtoid=</code>, naturally because the variable has no setter.</p>\n\n<p>So what am I missing? how do I do this simple thing?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "delayed-job"], "comments": [{"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1524676182, "post_id": 50027706, "comment_id": 87071789, "body": "Wouldn&#39;t this be better suited to something like a <code>cron</code> job, or a single daemonised script? If you want the job to re-run indefinitely, it seems a bit pointless to re-enqueue a background task over and over."}, {"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1524676387, "post_id": 50027706, "comment_id": 87071883, "body": "Or alternatively, why not just enqueue a job <i>when an <code>AzureVideo</code> gets <code>state=5</code></i>, and pass in that id/model as a parameter? Then you don&#39;t need to keep polling the entire record set like this."}, {"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1524676533, "post_id": 50027706, "comment_id": 87071965, "body": "Side note 1: Doing <code>.all.map { ... }.compact</code> is incredibly inefficient. You should use <code>.where.not(state: 5)</code>"}, {"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1524676576, "post_id": 50027706, "comment_id": 87071986, "body": "Side note 2: The <code>to_update.empty?</code> check is redundant. If the array is empty, then the <code>.each</code> will not yield anything anyway."}, {"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 1, "creation_date": 1524676656, "post_id": 50027706, "comment_id": 87072022, "body": "Side note 3: The whole point of enums is to map &quot;human-friendly names&quot; to &quot;computer-friendly&quot; numbers. You shouldn&#39;t be referencing <code>state=5</code> in the code, you should be referencing whatever it&#39;s called in the enum. <a href=\"http://api.rubyonrails.org/v5.1/classes/ActiveRecord/Enum.html\" rel=\"nofollow noreferrer\">api.rubyonrails.org/v5.1/classes/ActiveRecord/Enum.html</a> -- What you&#39;re doing now <i>works</i>, but it misses out on one of the main benefits to this technique."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1524677823, "post_id": 50027706, "comment_id": 87072643, "body": "I&#39;ve got to agree. If your job is always running it&#39;s not a job, it&#39;s a background process. Those aren&#39;t hard to write, you&#39;ll just need something to stand it back up if it crashes out and there&#39;s dozens of tools that &quot;daemonize&quot; things like that, including <code>systemctl</code> if that&#39;s available for you."}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1524678129, "post_id": 50027706, "comment_id": 87072787, "body": "I wonder if <code>def after(job); Delayed::Job.enqueue job; end</code> won\u2019t do?"}], "answers": [{"tags": [], "owner": {"reputation": 1670, "user_id": 6388521, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh4.googleusercontent.com/-VdFWPJVSpRc/AAAAAAAAAAI/AAAAAAAAAFo/vCc8QOz6v9Y/photo.jpg?sz=128", "display_name": "Ruslan", "link": "https://stackoverflow.com/users/6388521/ruslan"}, "is_accepted": false, "score": 0, "last_activity_date": 1524691594, "creation_date": 1524691594, "answer_id": 50031602, "question_id": 50027706, "link": "https://stackoverflow.com/questions/50027706/how-to-make-a-delayed-job-enqueue-itself/50031602#50031602", "title": "How to make a delayed job enqueue itself", "body": "<p>This is how I did it:</p>\n\n<pre><code>def after(job)      \n  Delayed::Job.transaction do\n    Delayed::Job.create(handler: job.handler, queue: job.queue, run_at: job.run_at + 5.minutes)\n    job.destroy\n  end\nend\n</code></pre>\n\n<p>It will re-schedule the job to run every <code>5.minutes</code> after original has finihsed. Been using it in production for major part of the year with out any issues. Also have the same logic in <code>#error(job)</code> callback</p>\n"}], "owner": {"reputation": 301, "user_id": 7943372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hfY2O.gif?s=128&g=1", "display_name": "bassment", "link": "https://stackoverflow.com/users/7943372/bassment"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 780, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1524691594, "creation_date": 1524675793, "question_id": 50027706, "link": "https://stackoverflow.com/questions/50027706/how-to-make-a-delayed-job-enqueue-itself", "title": "How to make a delayed job enqueue itself", "body": "<p>I am implementing a video streaming interface for Azure's Media Services API in Rails and I need to continuously update the uploaded video in order to process it (copy, encode) through Media Services, the status will eventually be either available or failed. To do this I decided to use delayed jobs, however, I am not sure what's the best way to keep a job always running. </p>\n\n<pre><code>class UpdateAzureVideosJob &lt; ApplicationJob\n  queue_as :azure_media_service\n\n  def perform\n    to_update = AzureVideo.all.map{ |v| v if v.state != 5 }.compact\n    unless to_update.empty?\n      to_update.each do |video|\n        video.update\n      end\n    end\n\n    sleep(5)\n    Delayed::Job.enqueue self\n  end\n\n  def before(job)\n    Delayed::Job.where(\"last_error is NULL AND queue = ? AND created_at &lt;   ?\", job.queue, DateTime.now).delete_all\n  end\nend\n</code></pre>\n\n<p>The reason I delete previous jobs of the same queue is because when I call enqueue method inside perform it adds an extra job which then adds an extra job and the queue with the scheduled jobs gets dirty really quickly.    </p>\n\n<p>I am just experimenting and this is probably the closest workaround (although a bit silly) for my case. I haven't tried other alternatives but any suggestions would be appreciated. Thank you.</p>\n"}, {"tags": ["mysql", "ruby-on-rails", "ruby", "migration"], "comments": [{"owner": {"reputation": 628, "user_id": 4643970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AwK4h.jpg?s=128&g=1", "display_name": "Mahmoud Sayed", "link": "https://stackoverflow.com/users/4643970/mahmoud-sayed"}, "edited": false, "score": 1, "creation_date": 1524676108, "post_id": 50027561, "comment_id": 87071742, "body": "Check this one <a href=\"https://github.com/plataformatec/devise/wiki/How-To:-Allow-users-to-sign-in-using-their-username-or-email-address\" rel=\"nofollow noreferrer\">on Device gem Wiki</a>, you can only use name instead of using email and username as they described in the link."}, {"owner": {"reputation": 8378, "user_id": 2076787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bfe965ab5ef94a0568bc61c36b46d4c?s=128&d=identicon&r=PG", "display_name": "D-side", "link": "https://stackoverflow.com/users/2076787/d-side"}, "edited": false, "score": 0, "creation_date": 1524738359, "post_id": 50027561, "comment_id": 87097155, "body": "Though I suspect you rather need not &quot;name or email&quot;, but &quot;name only&quot;, that case is covered in a different guide: <a href=\"https://github.com/plataformatec/devise/wiki/How-To:-Allow-users-to-sign-in-with-something-other-than-their-email-address\" rel=\"nofollow noreferrer\">github.com/plataformatec/devise/wiki/&hellip;</a>"}], "owner": {"reputation": 143, "user_id": 4930434, "user_type": "registered", "accept_rate": 94, "profile_image": "https://graph.facebook.com/880140592046671/picture?type=large", "display_name": "Lucas Oliveira", "link": "https://stackoverflow.com/users/4930434/lucas-oliveira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 39, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1524675545, "creation_date": 1524675228, "last_edit_date": 1524675545, "question_id": 50027561, "link": "https://stackoverflow.com/questions/50027561/migration-how-to-add-a-unique-constraint-to-an-already-populated-table", "title": "Migration - How to add a UNIQUE constraint to an already populated table?", "body": "<p>I have a technicians table which consists only of name and timestamps columns in production, but now I need to use it as a devise model.</p>\n\n<pre><code> class Technician &lt; ActiveRecord::Base\n    validates_presence_of   :name\n    validates_uniqueness_of :name\n end\n</code></pre>\n\n<p>Using <code>'rails generate devise technician'</code> led me to a migration with all that is necessary to make my technician model a devise model.</p>\n\n<pre><code>class AddDeviseToTechnicians &lt; ActiveRecord::Migration\n  def change\n    change_table(:technicians) do |t|\n      ## Database authenticatable\n      t.string :email,              null: false, default: \"\"\n      t.string :encrypted_password, null: false, default: \"\"\n    end\n  end\nend\n</code></pre>\n\n<p>But I can't migrate since email is a '<code>unique: true</code>' column, nor drop my technicians table. What should I do?</p>\n\n<p>I was thinking of setting the email field of each technician as: <code>name_attribute + \"@email.com\"</code>, but what's the best way to do this? \nI'm using a MYSQL database.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "elasticsearch"], "answers": [{"tags": [], "owner": {"reputation": 1506, "user_id": 2831700, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5e40a909ecdd6e94a32e120c0044ac9d?s=128&d=identicon&r=PG", "display_name": "IvRRimUm", "link": "https://stackoverflow.com/users/2831700/ivrrimum"}, "is_accepted": true, "score": 0, "last_activity_date": 1528115559, "creation_date": 1528115559, "answer_id": 50680724, "question_id": 50027359, "link": "https://stackoverflow.com/questions/50027359/rails-elasticsearch-mappings-are-ignored/50680724#50680724", "title": "Rails elasticsearch Mappings are ignored", "body": "<p>When indexing, rails-ealsticsearch uses <code>as_indexed_json</code>. Here's my example:</p>\n\n<pre><code>def as_indexed_json(options = {})\n  as_json(include: {\n    user: {\n      only: [\n        :id,\n        :slug, \n        :name\n      ]\n    }\n  })\nend\n</code></pre>\n"}], "owner": {"reputation": 1506, "user_id": 2831700, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5e40a909ecdd6e94a32e120c0044ac9d?s=128&d=identicon&r=PG", "display_name": "IvRRimUm", "link": "https://stackoverflow.com/users/2831700/ivrrimum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 19, "favorite_count": 0, "accepted_answer_id": 50680724, "answer_count": 1, "score": 1, "last_activity_date": 1528115559, "creation_date": 1524674518, "last_edit_date": 1524676223, "question_id": 50027359, "link": "https://stackoverflow.com/questions/50027359/rails-elasticsearch-mappings-are-ignored", "title": "Rails elasticsearch Mappings are ignored", "body": "<p>So I have been trying to make this work for few hours now, nothing seems to work.</p>\n\n<p>I have <code>mappings</code> defined in my model:</p>\n\n<pre><code>  settings do\n    mappings dynamic: false do\n      indexes :title, type: 'text'\n      indexes :description, type: 'text'\n      indexes :user, type: 'text' do\n        indexes :name, type: 'text'\n      end\n    end\n  end\n</code></pre>\n\n<p>But when I do:</p>\n\n<p><code>Podcast.__elasticsearch__.delete_index! force: true</code>\n<code>Podcast.__elasticsearch__.create_index! force: true</code>\n<code>Podcast.__elasticsearch__.import force: true</code></p>\n\n<p>and visit: <code>http://localhost:9200/podcasts/_search?pretty=true&amp;q=*:*&amp;size=1000</code></p>\n\n<p>I see all of the model data poured into the indexes(I need only title, description and user name).</p>\n\n<p>What is the problem here?</p>\n"}, {"tags": ["ruby", "tk"], "answers": [{"tags": [], "owner": {"reputation": 676, "user_id": 9344150, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b13c12af25a724e0c1fd61cdb45fdca2?s=128&d=identicon&r=PG&f=1", "display_name": "kojix2", "link": "https://stackoverflow.com/users/9344150/kojix2"}, "is_accepted": true, "score": 0, "last_activity_date": 1525854442, "creation_date": 1525854442, "answer_id": 50248773, "question_id": 50026924, "link": "https://stackoverflow.com/questions/50026924/retrieve-first-column-value-from-tktiletreeview-in-ruby/50248773#50248773", "title": "Retrieve first column value from TK::Tile::Treeview in Ruby", "body": "<p>I do not know if I understand exactly what you want to do,</p>\n\n<pre><code>item.text\n</code></pre>\n\n<p>might be a solution.</p>\n"}], "owner": {"reputation": 38, "user_id": 9698734, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Marc", "link": "https://stackoverflow.com/users/9698734/marc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 50248773, "answer_count": 1, "score": 0, "last_activity_date": 1525854442, "creation_date": 1524672877, "question_id": 50026924, "link": "https://stackoverflow.com/questions/50026924/retrieve-first-column-value-from-tktiletreeview-in-ruby", "title": "Retrieve first column value from TK::Tile::Treeview in Ruby", "body": "<p>I try to retrieve the value of the first column from an item retrieved from a treeview using \"item.get(\"#0\")\" but I got this error \"RuntimeError: Display column #0 cannot be set\". This method works for the other columns.\nCan anyone help to figure out a solution?</p>\n\n<p>Regards, \nMarc</p>\n\n<p>Here is a standalone example code:</p>\n\n<pre><code>require 'tk'\nrequire 'tkextlib/tile'\n$root = TkRoot.new\n$frame = Tk::Tile::Frame.new($root)\n$tree = Tk::Tile::Treeview.new($frame)\n\n$tree['columns'] = ['action_text','action_description']\n$tree.column_configure(\"#0\", :width =&gt; 100)\n$tree.heading_configure(\"#0\", :text =&gt; 'la 1er colonne')\n$tree.column_configure('action_text', :width =&gt; 100, :anchor =&gt; 'center')\n$tree.heading_configure('action_text', :text =&gt; 'Text')\n\n$tree.column_configure('action_description', :width =&gt; 100, :anchor =&gt; 'w')\n$tree.heading_configure('action_description', :text =&gt; 'Description')\n\n# Inserted at the root, program chooses id:\n$tree.insert('', 'end', :id =&gt; 'widgets', :text =&gt; 'Widget Tour')\n\n# Same thing, but inserted as first child:\n$tree.insert('', 0, :id =&gt; 'gallery', :text =&gt; 'Applications')\n\n# Treeview chooses the id:\nitem = $tree.insert('', 'end', :text =&gt; 'Tutorial')\n\n# Inserted underneath an existing node:\n$tree.insert( 'widgets', 'end', :text =&gt; 'Canvas')\n$tree.insert( item, 'end', :text =&gt; 'Tree')\n$tree.insert('', 2, :text =&gt; 'tata')\n$tree.insert('', 'end', :text =&gt; 'envolee', :values =&gt; ['le centre', 'la description'])\n\n$frame.grid(:column =&gt; 0, :row =&gt; 0, :sticky =&gt; 'nsew') {padding \"3 3 12 12\"}\n$tree.grid(:column =&gt; 0, :row =&gt; 0, :sticky =&gt; 'nsew')\n\nTkGrid.columnconfigure($root, 0, :weight =&gt; 1)\nTkGrid.rowconfigure($root, 0, :weight =&gt; 1)\nTkGrid.columnconfigure($frame, 0, :weight =&gt; 1)\nTkGrid.rowconfigure($frame, 0, :weight =&gt; 1)\n\ndef create_action\n item = $tree.selection_get[0]\n puts item\n puts \"ID:\" \n puts item.id\n puts \"Index:\" \n puts item.index\n puts \"action_text:\"\n puts item.get('action_text')\n puts \"1:\"\n puts item.get('#1')\n puts $tree.get(item.id, '#0')\n puts \"0:\"\n puts item.get(\"#0\")\nend\n\n$tree.bind(\"Double-1\") { create_action }\nTk.mainloop\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "rubygems"], "answers": [{"tags": [], "owner": {"reputation": 61438, "user_id": 63034, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/ZXKMO.jpg?s=128&g=1", "display_name": "mikej", "link": "https://stackoverflow.com/users/63034/mikej"}, "is_accepted": true, "score": 2, "last_activity_date": 1524673019, "creation_date": 1524673019, "answer_id": 50026957, "question_id": 50026730, "link": "https://stackoverflow.com/questions/50026730/nomethoderror-while-mymethod-do-exists/50026957#50026957", "title": "NoMethodError while MyMethod do exists", "body": "<p>To call the method on your class you first need to create an instance of the class and then call the method on that instance. e.g.</p>\n\n<pre><code>tm = Tm.new\nt = tm.load_translation(hashfile)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2890, "user_id": 1237117, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/H7dfY.jpg?s=128&g=1", "display_name": "mridula", "link": "https://stackoverflow.com/users/1237117/mridula"}, "is_accepted": false, "score": 1, "last_activity_date": 1524673038, "creation_date": 1524673038, "answer_id": 50026965, "question_id": 50026730, "link": "https://stackoverflow.com/questions/50026730/nomethoderror-while-mymethod-do-exists/50026965#50026965", "title": "NoMethodError while MyMethod do exists", "body": "<p>You are not calling the <code>load_translation</code> method from the object of <code>class</code> <code>Tm</code>.</p>\n\n<p>You need an instance of the class:</p>\n\n<pre><code>tm = Tm.new\ntm.load_translation(hashfile)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 5384136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d592f5b93f1dde17dfc2d553fc38ccc?s=128&d=identicon&r=PG", "display_name": "Mowsar", "link": "https://stackoverflow.com/users/5384136/mowsar"}, "is_accepted": false, "score": 0, "last_activity_date": 1525073040, "creation_date": 1525073040, "answer_id": 50095773, "question_id": 50026730, "link": "https://stackoverflow.com/questions/50026730/nomethoderror-while-mymethod-do-exists/50095773#50095773", "title": "NoMethodError while MyMethod do exists", "body": "<p>It is needed to call the <strong>load_translation</strong> method at first by creating an instance of the class ~</p>\n\n<pre><code>tm = Tm.new\ntm.load_translation(hashfile)\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 3748480, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/1049328313/picture?type=large", "display_name": "Arb", "link": "https://stackoverflow.com/users/3748480/arb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 50026957, "answer_count": 3, "score": -3, "last_activity_date": 1525073040, "creation_date": 1524672259, "last_edit_date": 1524673200, "question_id": 50026730, "link": "https://stackoverflow.com/questions/50026730/nomethoderror-while-mymethod-do-exists", "title": "NoMethodError while MyMethod do exists", "body": "<p>I can't understand how can I solve this error since the method do really exists, I have tested  it with the 'Hi' method.</p>\n\n<pre><code>irb(main):001:0&gt; require 'yaml'\n=&gt; true\nirb(main):002:0&gt; require 'tm'\n=&gt; true\nirb(main):003:0&gt; Tm.hi\nHey Tm here for duty!\n=&gt; nil\nirb(main):004:0&gt; hashfile = YAML.load_file('fr.yaml')\n=&gt; {\"fr\"=&gt;{\"colors\"=&gt;{\"yellow\"=&gt;\"Jaune\", \"white\"=&gt;\"Blanc\"}, \"hello\"=&gt;\"Bonjour\"}}\nirb(main):005:0&gt; t = load_translation(hashfile)\nTraceback (most recent call last):\n        2: from /Users/abderrahmane/.rbenv/versions/2.5.1/bin/irb:11:in `&lt;main&gt;'\n        1: from (irb):5 NoMethodError (undefined method `load_translation' for main:Object)\n</code></pre>\n\n<p>With my class:</p>\n\n<pre><code>class Tm\n\n  def self.hi\n    puts \"Hey Tm here for duty!\"\n  end\n\n  def auxload(hash, lang, concat='')\n    ans = {}\n    hash.each do |key, val|\n      if val.class == Hash\n        aux = auxload(val, lang, concat+key+'.')\n        aux.each do |k, v|\n          ans[k]=v\n        end\n      else\n        ans[concat+key]={lang =&gt; val}\n      end\n    end\n    return ans\n  end\n\n  # load the translation from the yaml files\n  def load_translation(hash)\n    key,value = hash.first\n    return auxload(value,key)\n  end\n\nend\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 370, "user_id": 3798525, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/xPLE1.jpg?s=128&g=1", "display_name": "Danilo C&#226;ndido", "link": "https://stackoverflow.com/users/3798525/danilo-c%c3%a2ndido"}, "edited": false, "score": 0, "creation_date": 1524671646, "post_id": 50026457, "comment_id": 87069357, "body": "If you aren&#39;t using threads you can call one and after call another sequentially.  my_functionA() my_funcitonB()"}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1524671762, "post_id": 50026457, "comment_id": 87069431, "body": "Some some example code, it&#39;s unclear what you&#39;re asking."}], "answers": [{"comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1524677705, "post_id": 50027040, "comment_id": 87072579, "body": "Minor note, but it&#39;s an important element of Ruby style: Omit empty parentheses on method calls. It&#39;s just <code>foo</code> and <code>bar</code> at the end."}, {"owner": {"reputation": 1808, "user_id": 9184597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7875ba2d289a9f0e410a82fb7f15f03?s=128&d=identicon&r=PG&f=1", "display_name": "R.F. Nelson", "link": "https://stackoverflow.com/users/9184597/r-f-nelson"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 1, "creation_date": 1524698103, "post_id": 50027040, "comment_id": 87081276, "body": "@tadman Indeed, thanks for pointing that out. I updated my answer accordingly."}], "tags": [], "owner": {"reputation": 1808, "user_id": 9184597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7875ba2d289a9f0e410a82fb7f15f03?s=128&d=identicon&r=PG&f=1", "display_name": "R.F. Nelson", "link": "https://stackoverflow.com/users/9184597/r-f-nelson"}, "is_accepted": true, "score": 1, "last_activity_date": 1524698054, "last_edit_date": 1524698054, "creation_date": 1524673315, "answer_id": 50027040, "question_id": 50026457, "link": "https://stackoverflow.com/questions/50026457/how-to-run-expressions-or-functions-in-order/50027040#50027040", "title": "How to run expressions or functions in order", "body": "<p>If you're not using threads, the code below would run sequentially.</p>\n\n<pre><code>def foo\n  puts(\"foo\")\nend\n\ndef bar\n  puts(\"bar\")\nend\n\nfoo\nbar\n</code></pre>\n"}], "owner": {"reputation": 167, "user_id": 7947672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6d91daf5ab8d9caa18f4152d524236d?s=128&d=identicon&r=PG&f=1", "display_name": "zhu chen", "link": "https://stackoverflow.com/users/7947672/zhu-chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33, "favorite_count": 0, "accepted_answer_id": 50027040, "answer_count": 1, "score": -1, "last_activity_date": 1524698054, "creation_date": 1524671391, "last_edit_date": 1524672355, "question_id": 50026457, "link": "https://stackoverflow.com/questions/50026457/how-to-run-expressions-or-functions-in-order", "title": "How to run expressions or functions in order", "body": "<p>How can I make my rails app to run functions in order? I like to have function A finish running before function B begins running.</p>\n"}, {"tags": ["ruby", "regex", "hash"], "comments": [{"owner": {"reputation": 14010, "user_id": 3109182, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4b305f0077055b4fdcf715067775d5a?s=128&d=identicon&r=PG", "display_name": "Anthony", "link": "https://stackoverflow.com/users/3109182/anthony"}, "edited": false, "score": 0, "creation_date": 1524668252, "post_id": 50025428, "comment_id": 87066976, "body": "is it a CSV?  does it have headers?"}, {"owner": {"reputation": 95, "user_id": 7654323, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/A2FAs.jpg?s=128&g=1", "display_name": "beansbeans", "link": "https://stackoverflow.com/users/7654323/beansbeans"}, "reply_to_user": {"reputation": 14010, "user_id": 3109182, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4b305f0077055b4fdcf715067775d5a?s=128&d=identicon&r=PG", "display_name": "Anthony", "link": "https://stackoverflow.com/users/3109182/anthony"}, "edited": false, "score": 0, "creation_date": 1524668345, "post_id": 50025428, "comment_id": 87067030, "body": "Not CSV, just a plain text file. <code>my_hash = Hash[*File.read(&#39;file.cfg&#39;).split(&#47;[, \\n]+&#47;)]</code>"}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1524669004, "post_id": 50025428, "comment_id": 87067516, "body": "I doubt the result you are getting with your code is what you indeed want to get as a result."}, {"owner": {"reputation": 14010, "user_id": 3109182, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4b305f0077055b4fdcf715067775d5a?s=128&d=identicon&r=PG", "display_name": "Anthony", "link": "https://stackoverflow.com/users/3109182/anthony"}, "edited": false, "score": 0, "creation_date": 1524669176, "post_id": 50025428, "comment_id": 87067639, "body": "what do you want the hash to look like?"}, {"owner": {"reputation": 95, "user_id": 7654323, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/A2FAs.jpg?s=128&g=1", "display_name": "beansbeans", "link": "https://stackoverflow.com/users/7654323/beansbeans"}, "reply_to_user": {"reputation": 14010, "user_id": 3109182, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4b305f0077055b4fdcf715067775d5a?s=128&d=identicon&r=PG", "display_name": "Anthony", "link": "https://stackoverflow.com/users/3109182/anthony"}, "edited": false, "score": 0, "creation_date": 1524670206, "post_id": 50025428, "comment_id": 87068394, "body": "Well @Anthony istarted with the assumption that I would need a hash similar to <code>{&quot;server1&quot;=&gt;[&quot;jim&quot;, &quot;22&quot;], &quot;server2&quot;=&gt;[&quot;bob&quot;,&quot;22&quot;]}</code> but I&#39;m not so sure an array would be simpler here."}], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 7654323, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/A2FAs.jpg?s=128&g=1", "display_name": "beansbeans", "link": "https://stackoverflow.com/users/7654323/beansbeans"}, "edited": false, "score": 0, "creation_date": 1524669652, "post_id": 50025763, "comment_id": 87067996, "body": "Let me try this real quick and verify."}, {"owner": {"reputation": 95, "user_id": 7654323, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/A2FAs.jpg?s=128&g=1", "display_name": "beansbeans", "link": "https://stackoverflow.com/users/7654323/beansbeans"}, "edited": false, "score": 0, "creation_date": 1524670073, "post_id": 50025763, "comment_id": 87068297, "body": "Is this making a key=&gt; then putting two things &quot;john, 22&quot; into one value? I believe the desired result woud be <code>{&quot;server1&quot;=&gt;[&quot;jim&quot;, &quot;22&quot;], &quot;server2&quot;=&gt;[&quot;bob&quot;,&quot;22&quot;]}</code>"}], "tags": [], "owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "is_accepted": true, "score": 1, "last_activity_date": 1524670275, "last_edit_date": 1524670275, "creation_date": 1524669129, "answer_id": 50025763, "question_id": 50025428, "link": "https://stackoverflow.com/questions/50025428/read-file-into-hash-with-2-values-per-key/50025763#50025763", "title": "Read file into hash with 2 values per key?", "body": "<p>I suppose this is the expected result:</p>\n\n<pre><code>File.readlines('/tmp/blah.cfg').map do |line|\n  line.split(',', 2).map(&amp;:strip)\nend.to_h\n#\u21d2 {\"server1\"=&gt;\"jim, 22\", \"server2\"=&gt;\"bob, 44\"}\n</code></pre>\n\n<p>One might also split the rest into an array:</p>\n\n<pre><code>File.readlines('/tmp/blah.cfg').map do |line|\n  k, *v = line.split(',').map(&amp;:strip)\n  [k, v]\nend.to_h\n#\u21d2 {\"server1\"=&gt;[\"jim\", \"22\"], \"server2\"=&gt;[\"bob\", \"44\"]}\n</code></pre>\n"}], "owner": {"reputation": 95, "user_id": 7654323, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/A2FAs.jpg?s=128&g=1", "display_name": "beansbeans", "link": "https://stackoverflow.com/users/7654323/beansbeans"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 50025763, "answer_count": 1, "score": -1, "last_activity_date": 1524670275, "creation_date": 1524668210, "question_id": 50025428, "link": "https://stackoverflow.com/questions/50025428/read-file-into-hash-with-2-values-per-key", "title": "Read file into hash with 2 values per key?", "body": "<p>Very similar question to: <a href=\"https://stackoverflow.com/questions/4119763/using-ruby-reading-a-file-containing-name-value-pairs-into-a-hash\">Using Ruby, Reading a file, containing name/value pairs into a hash</a></p>\n\n<p>file:</p>\n\n<p><code>server1, jim, 22\nserver2, bob, 44\n</code></p>\n\n<p>Tried this regular expression:</p>\n\n<p><code>Hash[*File.read('file.cfg').split(/[, \\n]+/)]</code></p>\n\n<p>But I get:\n<code>odd number of arguments for Hash (ArgumentError)</code></p>\n\n<p>Me trying this out: <a href=\"http://rubular.com/r/BE6ZG2nTMw\" rel=\"nofollow noreferrer\">http://rubular.com/r/BE6ZG2nTMw</a></p>\n\n<p>What is the way to approach this? Is the issue the way the hash is initialized or my regexp?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "persistent", "inspect"], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 8578329, "user_type": "registered", "accept_rate": 30, "profile_image": "https://lh5.googleusercontent.com/-5deGzFJd4lY/AAAAAAAAAAI/AAAAAAAAAEA/-lgub0iNYYc/photo.jpg?sz=128", "display_name": "Ludovic WEBER", "link": "https://stackoverflow.com/users/8578329/ludovic-weber"}, "edited": false, "score": 0, "creation_date": 1524668085, "post_id": 50025358, "comment_id": 87066854, "body": "Oh nice ! Thank you very much ! &lt;%= is like inspect ?"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 95, "user_id": 8578329, "user_type": "registered", "accept_rate": 30, "profile_image": "https://lh5.googleusercontent.com/-5deGzFJd4lY/AAAAAAAAAAI/AAAAAAAAAEA/-lgub0iNYYc/photo.jpg?sz=128", "display_name": "Ludovic WEBER", "link": "https://stackoverflow.com/users/8578329/ludovic-weber"}, "edited": false, "score": 1, "creation_date": 1524668119, "post_id": 50025358, "comment_id": 87066880, "body": "@LudovicWEBER: no, it&#39;s like puts."}, {"owner": {"reputation": 2989, "user_id": 1009655, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/K3jdk.png?s=128&g=1", "display_name": "Frederik Spang", "link": "https://stackoverflow.com/users/1009655/frederik-spang"}, "edited": false, "score": 0, "creation_date": 1524668341, "post_id": 50025358, "comment_id": 87067023, "body": "in erb its not puts, its output to buffer <code>&lt;% concat &quot;something&quot; %&gt;</code> (see <a href=\"http://api.rubyonrails.org/classes/ActionView/Helpers/TextHelper.html#method-i-concat\" rel=\"nofollow noreferrer\">api.rubyonrails.org/classes/ActionView/Helpers/&hellip;</a>)"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 2989, "user_id": 1009655, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/K3jdk.png?s=128&g=1", "display_name": "Frederik Spang", "link": "https://stackoverflow.com/users/1009655/frederik-spang"}, "edited": false, "score": 0, "creation_date": 1524668683, "post_id": 50025358, "comment_id": 87067272, "body": "@FrederikSpang: of course, it&#39;s not puts, it&#39;s &quot;like puts&quot;, conceptually."}], "tags": [], "owner": {"reputation": 2298, "user_id": 5883753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b32d66e6c723279fdfc2a90b269a070c?s=128&d=identicon&r=PG&f=1", "display_name": "fongfan999", "link": "https://stackoverflow.com/users/5883753/fongfan999"}, "is_accepted": false, "score": 1, "last_activity_date": 1524667962, "creation_date": 1524667962, "answer_id": 50025358, "question_id": 50025288, "link": "https://stackoverflow.com/questions/50025288/persitent-inspect-on-page-ruby-on-rails/50025358#50025358", "title": "Persitent .inspect on page Ruby on Rails", "body": "<p>I thought you were using <code>&lt;%= %&gt;</code> (equal sign) instead of <code>&lt;% %&gt;</code> (no equal sign) in your <code>:each</code> method in your views something like this:</p>\n\n<pre><code>&lt;%= @articles.each %&gt;\n# ...\n&lt;% end %&gt;\n</code></pre>\n"}], "owner": {"reputation": 95, "user_id": 8578329, "user_type": "registered", "accept_rate": 30, "profile_image": "https://lh5.googleusercontent.com/-5deGzFJd4lY/AAAAAAAAAAI/AAAAAAAAAEA/-lgub0iNYYc/photo.jpg?sz=128", "display_name": "Ludovic WEBER", "link": "https://stackoverflow.com/users/8578329/ludovic-weber"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 23, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524667962, "creation_date": 1524667752, "question_id": 50025288, "link": "https://stackoverflow.com/questions/50025288/persitent-inspect-on-page-ruby-on-rails", "title": "Persitent .inspect on page Ruby on Rails", "body": "<p>I'm learning Ruby On rails.\nActually all my articles works correctly (CRUD), but i still have my posts.inspect on my page. \nHowever i deleted this, but still continues to be displayed. </p>\n\n<p>I checked all my files, i don't have \"puts posts.inspect\".\nWhy it still displayed ?</p>\n\n<p>Check screen\nThanks for you help !</p>\n\n<p><a href=\"https://i.stack.imgur.com/6Vcvz.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/6Vcvz.png\" alt=\"persistent inspect\"></a></p>\n"}, {"tags": ["ruby", "markdown", "middleman"], "comments": [{"owner": {"reputation": 91121, "user_id": 179125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5594142dcc49a24b1902ec8059181f8d?s=128&d=identicon&r=PG&f=1", "display_name": "Jordan Running", "link": "https://stackoverflow.com/users/179125/jordan-running"}, "edited": false, "score": 0, "creation_date": 1524667438, "post_id": 50025005, "comment_id": 87066359, "body": "Okay, you&#39;ve described what you want to do. What part are you having a problem with?"}, {"owner": {"reputation": 646, "user_id": 8919469, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f51a8277c113b7415c6b2bbd82be9615?s=128&d=identicon&r=PG&f=1", "display_name": "johan", "link": "https://stackoverflow.com/users/8919469/johan"}, "reply_to_user": {"reputation": 91121, "user_id": 179125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5594142dcc49a24b1902ec8059181f8d?s=128&d=identicon&r=PG&f=1", "display_name": "Jordan Running", "link": "https://stackoverflow.com/users/179125/jordan-running"}, "edited": false, "score": 0, "creation_date": 1524667569, "post_id": 50025005, "comment_id": 87066461, "body": "I need that the method <code>run_http_request</code> make the API call Like this nothing is executed... Nothing is appening here... I am missing something but I don&#39;t know what it is ( not yet an expert )"}], "answers": [{"comments": [{"owner": {"reputation": 646, "user_id": 8919469, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f51a8277c113b7415c6b2bbd82be9615?s=128&d=identicon&r=PG&f=1", "display_name": "johan", "link": "https://stackoverflow.com/users/8919469/johan"}, "edited": false, "score": 1, "creation_date": 1524667995, "post_id": 50025220, "comment_id": 87066789, "body": "That&#39;s a lot ! You&#39;ve saved my day :)"}, {"owner": {"reputation": 2298, "user_id": 5883753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b32d66e6c723279fdfc2a90b269a070c?s=128&d=identicon&r=PG&f=1", "display_name": "fongfan999", "link": "https://stackoverflow.com/users/5883753/fongfan999"}, "reply_to_user": {"reputation": 646, "user_id": 8919469, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f51a8277c113b7415c6b2bbd82be9615?s=128&d=identicon&r=PG&f=1", "display_name": "johan", "link": "https://stackoverflow.com/users/8919469/johan"}, "edited": false, "score": 0, "creation_date": 1524668107, "post_id": 50025220, "comment_id": 87066863, "body": "Hi @NEL, I&#39;m very glad to hear that. Why didn&#39;t you vote up my answer :))."}, {"owner": {"reputation": 646, "user_id": 8919469, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f51a8277c113b7415c6b2bbd82be9615?s=128&d=identicon&r=PG&f=1", "display_name": "johan", "link": "https://stackoverflow.com/users/8919469/johan"}, "edited": false, "score": 1, "creation_date": 1524668610, "post_id": 50025220, "comment_id": 87067221, "body": "Just did it :) sorry I though I did"}, {"owner": {"reputation": 2298, "user_id": 5883753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b32d66e6c723279fdfc2a90b269a070c?s=128&d=identicon&r=PG&f=1", "display_name": "fongfan999", "link": "https://stackoverflow.com/users/5883753/fongfan999"}, "reply_to_user": {"reputation": 646, "user_id": 8919469, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f51a8277c113b7415c6b2bbd82be9615?s=128&d=identicon&r=PG&f=1", "display_name": "johan", "link": "https://stackoverflow.com/users/8919469/johan"}, "edited": false, "score": 1, "creation_date": 1524669087, "post_id": 50025220, "comment_id": 87067573, "body": "I think we don&#39;t need to strip the code string, <code>eval</code> already done it for us."}], "tags": [], "owner": {"reputation": 2298, "user_id": 5883753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b32d66e6c723279fdfc2a90b269a070c?s=128&d=identicon&r=PG&f=1", "display_name": "fongfan999", "link": "https://stackoverflow.com/users/5883753/fongfan999"}, "is_accepted": true, "score": 1, "last_activity_date": 1524669100, "last_edit_date": 1524669100, "creation_date": 1524667561, "answer_id": 50025220, "question_id": 50025005, "link": "https://stackoverflow.com/questions/50025005/execute-ruby-code-from-markdown-tag/50025220#50025220", "title": "Execute ruby code from markdown tag", "body": "<p>Try to the following:</p>\n\n<pre><code>content = File.read('../_example.md')\nmatches = content.match(/```ruby(.+)```/m)\n\ncode = matches[1] # matches[0] contains the code and the ```ruby``` part\neval(code)\n</code></pre>\n\n<p>Hope it helps!</p>\n"}], "owner": {"reputation": 646, "user_id": 8919469, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f51a8277c113b7415c6b2bbd82be9615?s=128&d=identicon&r=PG&f=1", "display_name": "johan", "link": "https://stackoverflow.com/users/8919469/johan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "closed_date": 1524673120, "accepted_answer_id": 50025220, "answer_count": 1, "score": 0, "last_activity_date": 1524669100, "creation_date": 1524666930, "last_edit_date": 1524667257, "question_id": 50025005, "link": "https://stackoverflow.com/questions/50025005/execute-ruby-code-from-markdown-tag", "closed_reason": "Needs details or clarity", "title": "Execute ruby code from markdown tag", "body": "<p>I am asked to to test the examples I provide in a markdown documentation (website created with Middleman).</p>\n\n<p>I need to test if the examples of the API request I suggest are correct.</p>\n\n<p>So in my example I have: </p>\n\n<p><strong>_example.md</strong>\n</p>\n\n<pre><code>```ruby\nuri = URI.parse(\"http://localhost:3000/oauth/token\")\nrequest = Net::HTTP::Post.new(uri)\nrequest.content_type = \"application/x-www-form-urlencoded; charset=utf-8\"\nrequest.set_form_data(\n  \"client_id\" =&gt; \"id\",\n  \"client_secret\" =&gt; \"secret\",\n  \"grant_type\" =&gt; \"password\",\n  \"password\" =&gt; \"password\",\n  \"username\" =&gt; \"user@example.com\"\n)\n\nreq_options = {\n  use_ssl: uri.scheme == \"https\"\n}\n\nresponse = Net::HTTP.start(uri.hostname, uri.port, req_options) do |http|\n  http.request(request)\nend\nresponse.code\n```\n</code></pre>\n\n<p>The idea is to enter in the mardown file and read between <code>```ruby  ```</code> tags\nin my test file \n<strong>test.rb</strong></p>\n\n<pre><code>def run_http_request\n\n  File.open('../_example.md').each_line do |line|\n    next if line.start_with? '```'\n    line\n  end\n\nend\n</code></pre>\n\n<p>I would like this methode to execute the http request...</p>\n"}, {"tags": ["ruby", "ubuntu-16.04", "inspec"], "answers": [{"tags": [], "owner": {"reputation": 3665, "user_id": 9797143, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/173377baee1db5827d6a9be47a5c082c?s=128&d=identicon&r=PG&f=1", "display_name": "Brandon Miller", "link": "https://stackoverflow.com/users/9797143/brandon-miller"}, "is_accepted": false, "score": 0, "last_activity_date": 1528340908, "creation_date": 1528340908, "answer_id": 50732385, "question_id": 50024314, "link": "https://stackoverflow.com/questions/50024314/cis-benchmarks-compliance-translated-to-ruby-scripts/50732385#50732385", "title": "CIS benchmarks compliance translated to ruby scripts", "body": "<p>You don't really need to know <code>ruby</code> to use <code>inspec</code>. You could try using the resources like <a href=\"https://learn.chef.io/tracks/compliance-automation#/\" rel=\"nofollow noreferrer\">Compliance Automation With Inspec</a> on Learn Chef. That website has all the resources you need to learn everything Chef related.</p>\n"}, {"tags": [], "owner": {"reputation": 11424, "user_id": 584674, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/mZZN5.gif?s=128&g=1", "display_name": "james.garriss", "link": "https://stackoverflow.com/users/584674/james-garriss"}, "is_accepted": false, "score": 0, "last_activity_date": 1538415654, "creation_date": 1538415654, "answer_id": 52596211, "question_id": 50024314, "link": "https://stackoverflow.com/questions/50024314/cis-benchmarks-compliance-translated-to-ruby-scripts/52596211#52596211", "title": "CIS benchmarks compliance translated to ruby scripts", "body": "<blockquote>\n  <p>Can I use another language for coding those scripts?</p>\n</blockquote>\n\n<p>No.  </p>\n\n<p>From the documentation: </p>\n\n<blockquote>\n  <p>The InSpec DSL is a Ruby DSL for writing audit controls, which\n  includes audit resources that you can invoke.</p>\n</blockquote>\n\n<p>[<a href=\"https://www.inspec.io/docs/reference/dsl_inspec/]\" rel=\"nofollow noreferrer\">https://www.inspec.io/docs/reference/dsl_inspec/]</a></p>\n\n<p>At a minimal, you must learn the Ruby DSL in order to write InSpec tests.  And if you also learn Ruby, you'll be able to write a lot of additional tests that can't be done with the Ruby DSL alone (though it is quite capable).  Ruby is a simple scripting language with a host of tutorials on the web; I suspect you'll be able to pick it up in no time.</p>\n"}], "owner": {"reputation": 37, "user_id": 9423784, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tQOvD.jpg?s=128&g=1", "display_name": "Aicha KERMICHE", "link": "https://stackoverflow.com/users/9423784/aicha-kermiche"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 204, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1538415654, "creation_date": 1524664933, "question_id": 50024314, "link": "https://stackoverflow.com/questions/50024314/cis-benchmarks-compliance-translated-to-ruby-scripts", "title": "CIS benchmarks compliance translated to ruby scripts", "body": "<p>I\u2019ve been discovering inspec lately and I\u2019m trying to translate some CIS benchmarks to ruby scripts that I can execute using InSpec.</p>\n\n<p>The thing is that I\u2019m not familiar with ruby, by any chance, can I use another language for coding those scripts ?\nI\u2019ve been following a youtube tutorial from chef :</p>\n\n<p>Create a Profile - What to expect when you're InSpec'ing\n<a href=\"https://www.youtube.com/watch?v=K0npgDsES9s\" rel=\"nofollow noreferrer\">https://www.youtube.com/watch?v=K0npgDsES9s</a></p>\n\n<p>I couldn\u2019t even install atom correctly on ubuntu 16.04,</p>\n\n<p>Did anone face the same issues ?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "sqlite", "heroku", "bundler"], "comments": [{"owner": {"reputation": 91778, "user_id": 354577, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/dI6cA.jpg?s=128&g=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/354577/chris"}, "edited": false, "score": 0, "creation_date": 1524665459, "post_id": 50024123, "comment_id": 87064975, "body": "&quot;Heroku doesn&#39;t allow sqlite in production.&quot; Do you have a reference for that? Its ephemeral filesystem would seriously limit the utility of file-based databases, but SQLite can operate in memory. I&#39;m not sure how <code>pdf-extract</code> uses SQLite, though."}, {"owner": {"reputation": 95, "user_id": 6586495, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210141822044857/picture?type=large", "display_name": "Noah Finberg", "link": "https://stackoverflow.com/users/6586495/noah-finberg"}, "reply_to_user": {"reputation": 91778, "user_id": 354577, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/dI6cA.jpg?s=128&g=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/354577/chris"}, "edited": false, "score": 0, "creation_date": 1524666470, "post_id": 50024123, "comment_id": 87065668, "body": "<a href=\"https://stackoverflow.com/questions/7963561/heroku-cannot-run-git-push-heroku-master\" title=\"heroku cannot run git push heroku master\">stackoverflow.com/questions/7963561/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 6586495, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210141822044857/picture?type=large", "display_name": "Noah Finberg", "link": "https://stackoverflow.com/users/6586495/noah-finberg"}, "edited": false, "score": 0, "creation_date": 1524666765, "post_id": 50024675, "comment_id": 87065906, "body": "The issue is HyPDF doesn&#39;t do what I need it to do. Pdf-extract did it perfectly when I tested it in a ruby script. Is there anyway to remove a dependency from a ruby gem or replace sqlite with pg as a dependency instead? I&#39;m looking to extract the references from a PDF document (e.g. pdf-extract extract --references --titles myfile.pdf)."}, {"owner": {"reputation": 1808, "user_id": 9184597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7875ba2d289a9f0e410a82fb7f15f03?s=128&d=identicon&r=PG&f=1", "display_name": "R.F. Nelson", "link": "https://stackoverflow.com/users/9184597/r-f-nelson"}, "reply_to_user": {"reputation": 95, "user_id": 6586495, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210141822044857/picture?type=large", "display_name": "Noah Finberg", "link": "https://stackoverflow.com/users/6586495/noah-finberg"}, "edited": false, "score": 0, "creation_date": 1524667193, "post_id": 50024675, "comment_id": 87066190, "body": "@NoahFinberg If you must use this gem, then you cannot deploy to Heroku. Hacking the gem to use Postgres instead of SQLite would probably be more work than finding an alternative to Heroku."}], "tags": [], "owner": {"reputation": 1808, "user_id": 9184597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7875ba2d289a9f0e410a82fb7f15f03?s=128&d=identicon&r=PG&f=1", "display_name": "R.F. Nelson", "link": "https://stackoverflow.com/users/9184597/r-f-nelson"}, "is_accepted": false, "score": 0, "last_activity_date": 1524665999, "creation_date": 1524665999, "answer_id": 50024675, "question_id": 50024123, "link": "https://stackoverflow.com/questions/50024123/rails-pdf-extract-gem-has-sqlite-as-dependency-but-im-using-pg-because-heroku/50024675#50024675", "title": "Rails pdf-extract gem has sqlite as dependency, but I&#39;m using pg because Heroku requires it so bundle install fails", "body": "<p>I would save yourself the time and trouble involved with getting this to work and look at alternative libraries. There is a PDF text extraction gem called <a href=\"https://devcenter.heroku.com/articles/hypdf\" rel=\"nofollow noreferrer\">HyPDF</a> that is also a Heroku <a href=\"https://devcenter.heroku.com/categories/add-ons\" rel=\"nofollow noreferrer\">add-on</a>.  </p>\n"}, {"tags": [], "owner": {"reputation": 4693, "user_id": 5501536, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/50b9ab14ab8699a3862c14ee48126abe?s=128&d=identicon&r=PG&f=1", "display_name": "chevybow", "link": "https://stackoverflow.com/users/5501536/chevybow"}, "is_accepted": true, "score": 2, "last_activity_date": 1524667060, "creation_date": 1524667060, "answer_id": 50025054, "question_id": 50024123, "link": "https://stackoverflow.com/questions/50024123/rails-pdf-extract-gem-has-sqlite-as-dependency-but-im-using-pg-because-heroku/50025054#50025054", "title": "Rails pdf-extract gem has sqlite as dependency, but I&#39;m using pg because Heroku requires it so bundle install fails", "body": "<p>There is no way to use a gem that has a dependency if you cannot install that dependency. Your options are to </p>\n\n<ul>\n<li>Use a different PDF Gem </li>\n<li>Use an alternative to Heroku </li>\n<li>Find a way to implement the functionality you need from Pdf-extract yourself without using any gems </li>\n<li>Go through the gem's code to see where it uses sqlite and try to get rid of that code without breaking the gem</li>\n</ul>\n"}], "owner": {"reputation": 95, "user_id": 6586495, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210141822044857/picture?type=large", "display_name": "Noah Finberg", "link": "https://stackoverflow.com/users/6586495/noah-finberg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 2, "accepted_answer_id": 50025054, "answer_count": 2, "score": 1, "last_activity_date": 1524850334, "creation_date": 1524664351, "last_edit_date": 1524850334, "question_id": 50024123, "link": "https://stackoverflow.com/questions/50024123/rails-pdf-extract-gem-has-sqlite-as-dependency-but-im-using-pg-because-heroku", "title": "Rails pdf-extract gem has sqlite as dependency, but I&#39;m using pg because Heroku requires it so bundle install fails", "body": "<p>I've been trying to install <a href=\"https://github.com/CrossRef/pdfextract\" rel=\"nofollow noreferrer\">pdf-extract</a> as a gem in my Rails app. When I go to build, I get this error because it uses sqlite as a dependency:</p>\n\n<pre><code>Fetching sqlite3 1.3.13\nInstalling sqlite3 1.3.13 with native extensions\nGem::Ext::BuildError: ERROR: Failed to build gem native extension.\n\n    current directory: /home/vagrant/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/sqlite3-1.3.13/ext/sqlite3\n/home/vagrant/.rbenv/versions/2.3.0/bin/ruby -r ./siteconf20180425-3298-14ft47q.rb extconf.rb\nchecking for sqlite3.h... no\nsqlite3.h is missing. Try 'brew install sqlite3',\n'yum install sqlite-devel' or 'apt-get install libsqlite3-dev'\nand check your shared library search path (the\nlocation where your sqlite3 shared library is located).\n*** extconf.rb failed ***\nCould not create Makefile due to some reason, probably lack of necessary\nlibraries and/or headers.  Check the mkmf.log file for more details.  You may\nneed configuration options.\n\nProvided configuration options:\n    --with-opt-dir\n    --without-opt-dir\n    --with-opt-include\n    --without-opt-include=${opt-dir}/include\n    --with-opt-lib\n    --without-opt-lib=${opt-dir}/lib\n    --with-make-prog\n    --without-make-prog\n    --srcdir=.\n    --curdir\n    --ruby=/home/vagrant/.rbenv/versions/2.3.0/bin/$(RUBY_BASE_NAME)\n    --with-sqlite3-config\n    --without-sqlite3-config\n    --with-pkg-config\n    --without-pkg-config\n    --with-sqlite3-dir\n    --without-sqlite3-dir\n    --with-sqlite3-include\n    --without-sqlite3-include=${sqlite3-dir}/include\n    --with-sqlite3-lib\n    --without-sqlite3-lib=${sqlite3-dir}/lib\n\nTo see why this extension failed to compile, please check the mkmf.log which can be found here:\n\n  /home/vagrant/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/extensions/x86_64-linux/2.3.0-static/sqlite3-1.3.13/mkmf.log\n\nextconf failed, exit code 1\n\nGem files will remain installed in /home/vagrant/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/sqlite3-1.3.13 for inspection.\nResults logged to /home/vagrant/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/extensions/x86_64-linux/2.3.0-static/sqlite3-1.3.13/gem_make.out\n\nAn error occurred while installing sqlite3 (1.3.13), and Bundler cannot continue.\nMake sure that `gem install sqlite3 -v '1.3.13'` succeeds before bundling.\n\nIn Gemfile:\n  pdf-extract was resolved to 0.1.1, which depends on\n    sqlite3\n</code></pre>\n\n<p>Is there anyway I can still use pdf-extract? Heroku doesn't allow sqlite in production.</p>\n\n<p>Any help is greatly appreciated.</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>For those who encounter this issue in the future: I attempted to hack the gem to get it to work with postgres--this seemed to work though it caused the gem's performance to tank. Ultimately, I created an entirely separate api-only app, deployed directly to AWS using Elastic Beanstalk rather than through Heroku so that app could use sqlite3, and called the api-app to implement the gem functionality in my original app. </p>\n\n<p>This approach would likely work well for any gems that cause dependency issues in a preexisting Rails app.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-4"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1524664418, "post_id": 50024084, "comment_id": 87064261, "body": "Where/how do you call <code>car_params</code>?"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1524664510, "post_id": 50024084, "comment_id": 87064323, "body": "Note that <code>params.require</code> expects <code>params</code> to be an <code>ActionController::Parameters</code>. It does NOT work on a plain hash."}, {"owner": {"reputation": 40732, "user_id": 984621, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/817afccebcbe3a4983a5e8c584f30373?s=128&d=identicon&r=PG", "display_name": "user984621", "link": "https://stackoverflow.com/users/984621/user984621"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1524665176, "post_id": 50024084, "comment_id": 87064778, "body": "I do call <code>car_params</code>  from (Crud) services (Cars -&gt; Crud -&gt; CreateService -&gt; here&#39;s the call of <code>car_params</code>). If I load data from a file and putting it to a hash, can I somehow convert this plain hash to <code>ActionController::Parameters</code>? Is there a way to simulate this behavior (or possibly work-around it)? Thank you"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1524665307, "post_id": 50024084, "comment_id": 87064865, "body": "Just don&#39;t use require/permit. You can closely emulate it with fetch/slice."}, {"owner": {"reputation": 40732, "user_id": 984621, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/817afccebcbe3a4983a5e8c584f30373?s=128&d=identicon&r=PG", "display_name": "user984621", "link": "https://stackoverflow.com/users/984621/user984621"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1524665464, "post_id": 50024084, "comment_id": 87064981, "body": "I need to use it, because 90% of the application is using this structure. The rest 10% will use loading &amp; saving data from the file to the DB."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1524666000, "post_id": 50024084, "comment_id": 87065328, "body": "&quot;Is there a way to simulate this behavior (or possibly work-around it)&quot; - yes. fetch/slice."}], "answers": [{"tags": [], "owner": {"reputation": 580, "user_id": 1293749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08497221017521ae126ca4fa7134ce8e?s=128&d=identicon&r=PG", "display_name": "Jim Ryan", "link": "https://stackoverflow.com/users/1293749/jim-ryan"}, "is_accepted": false, "score": 4, "last_activity_date": 1524731801, "last_edit_date": 1524731801, "creation_date": 1524684452, "answer_id": 50029957, "question_id": 50024084, "link": "https://stackoverflow.com/questions/50024084/rails-private-method-require-called-for-hash-when-creating-a-record-ma/50029957#50029957", "title": "Rails: &quot;private method `require&#39; called for #&lt;Hash...&quot; when creating a record manually (not through the form)", "body": "<p>It's tough to answer without knowing where <code>car_params</code> is defined, but I can tell you with certainty that the issue is that the <code>params</code> you are passing it is an ordinary Ruby <code>Hash</code> and not a Rails <code>ActionController::Parameters</code>, which is where <code>#require</code> is defined.</p>\n\n<p>You can either not use strong parameters, and replace it with <code>fetch</code> and <code>slice</code>, like so:</p>\n\n<pre><code>params.fetch(:car).slice(:attr1, :attr2, ...) \n</code></pre>\n\n<p>Or if you really want to use strong parameters, you can wrap your Hash like so:</p>\n\n<pre><code>ActionController::Parameters.new(some_ruby_hash)\n</code></pre>\n\n<p>And then you can call <code>#require</code> and <code>#permit</code> on it. </p>\n"}], "owner": {"reputation": 40732, "user_id": 984621, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/817afccebcbe3a4983a5e8c584f30373?s=128&d=identicon&r=PG", "display_name": "user984621", "link": "https://stackoverflow.com/users/984621/user984621"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1363, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1524731801, "creation_date": 1524664257, "question_id": 50024084, "link": "https://stackoverflow.com/questions/50024084/rails-private-method-require-called-for-hash-when-creating-a-record-ma", "title": "Rails: &quot;private method `require&#39; called for #&lt;Hash...&quot; when creating a record manually (not through the form)", "body": "<p>I have a text file with data which I need to store in the database.</p>\n\n<p>In a Rails controller action, I have something like this:</p>\n\n<pre><code>class ImportDataController &lt; ApplicationController\n  protect_from_forgery except: :abc_client\n\n  def abc_client\n    ...simplified code:...\n    ...loading data from a file...\n    car = {}\n    car[:attr1] = something\n    car[:attr2] = something\n    car[:attr3] = something\n    ...and so on...\n\n    ...now I try to save the record to the DB...\n    @car = Cars::Crud::CreateService.new(car).create\n  end\nend\n</code></pre>\n\n<p>And I get this error:</p>\n\n<pre><code>private method `require' called for #&lt;Hash:0x007fb2e2ef6040&gt;\n</code></pre>\n\n<p>and the error points on this block of the code:</p>\n\n<pre><code>def car_params(params)\n  params.require(:car).permit(:attr1, :attr2, ...)\n</code></pre>\n\n<p>I tried to also create a record \"normally\" via a Rails form and copied the hash from the console and tried to save it, like:</p>\n\n<pre><code>params = {\"utf8\"=&gt;\"\u2713\", \"authenticity_token\"=&gt;\"kXMd23s4msX2OzhUAX2CWqyphnpCPNorQOvoitatj8uBsQBgGYbTgfoR1wTTWlufo++esyb5m9ogBfSHbCrAPA==\", \"car\"=&gt;{\"attr1\"=&gt;\"6\", ...\n\n@car = Cars::Crud::CreateService.new(params).create\n</code></pre>\n\n<p>But it resulted in the same error message.</p>\n\n<p>How do I figure it out?</p>\n\n<p>Thank you</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "testing", "rspec", "rspec-rails"], "comments": [{"owner": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 0, "creation_date": 1524660390, "post_id": 50022646, "comment_id": 87061444, "body": "Yes, because you didn&#39;t define <code>tracker</code> before calling it."}], "answers": [{"tags": [], "owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "is_accepted": true, "score": 2, "last_activity_date": 1524660693, "creation_date": 1524660693, "answer_id": 50022879, "question_id": 50022646, "link": "https://stackoverflow.com/questions/50022646/test-that-method-was-called-inside-another-method-with-rspec/50022879#50022879", "title": "test that method was called inside another method with rspec", "body": "<p>You cannot access <code>tracker</code> because it is a local variable.</p>\n\n<p>You could stub your <code>set_tracker</code> method instead and return an <a href=\"https://relishapp.com/rspec/rspec-mocks/v/3-7/docs/verifying-doubles/using-an-instance-double\" rel=\"nofollow noreferrer\">instance double</a>:</p>\n\n<pre><code>describe '#track_event' do\n  let(:tracker_double) { instance_double(Tracker) }\n\n  it 'should call event method' do\n    allow(foo).to receive(:set_tracker).and_return(tracker_double)\n    expect(tracker_double).to receive(:event)\n    foo.track_event\n  end\nend\n</code></pre>\n\n<p><code>foo</code> is your test subject.</p>\n"}, {"tags": [], "owner": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "is_accepted": false, "score": 0, "last_activity_date": 1524660699, "creation_date": 1524660699, "answer_id": 50022885, "question_id": 50022646, "link": "https://stackoverflow.com/questions/50022646/test-that-method-was-called-inside-another-method-with-rspec/50022885#50022885", "title": "test that method was called inside another method with rspec", "body": "<p>Assuming in your rspecs, <code>subject</code> is the instance of class where <code>track_event</code> method is defined, you can stub the value returned from <code>set_tracker</code> to an object defined by you and then check if the method <code>event</code> is called on that <code>tracker</code> object.</p>\n\n<pre><code> describe '#track_event' do\n   # Build a tracker object\n   let(:tracker) { &lt;Whatever type of object you expect as a tracker&gt; }\n\n   # Stub the output of `set_tracker`\n   before { allow(subject).to receive(:set_tracker) { tracker } }\n\n   it 'should call event method' do\n     expect(tracker).to receive(:event)\n   end\n\n   after { subject.track_event }\n end\n</code></pre>\n\n<p>I would recommend verifying the arguments too with the method call.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9697411"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5046, "favorite_count": 1, "accepted_answer_id": 50022879, "answer_count": 2, "score": 3, "last_activity_date": 1524660699, "creation_date": 1524660032, "question_id": 50022646, "link": "https://stackoverflow.com/questions/50022646/test-that-method-was-called-inside-another-method-with-rspec", "title": "test that method was called inside another method with rspec", "body": "<p>I have to write a spec for the following method:</p>\n\n<pre><code>def track_event\n  tracker = set_tracker\n  category = define_event_category\n  tracker.event(category: category, action: name, label: properties['short_name'], value: properties['paid'])\nend\n</code></pre>\n\n<p>To be specific I have to to check if method <code>event</code> is called on the variable <code>tracker</code> when <code>track_event</code> is called. I tried to do it like this:</p>\n\n<pre><code>describe '#track_event' do\n  it 'should call event method' do\n    expect(tracker).to receive(:event)\n  end\nend\n</code></pre>\n\n<p>and got an error <code>undefined local variable or method 'tracker'</code>. What do I do wrong?</p>\n"}, {"tags": ["ruby", "httparty", "mailchimp-api-v3.0"], "comments": [{"owner": {"reputation": 5449, "user_id": 681520, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/701baebf68d1d7faa9f9def6a24fe356?s=128&d=identicon&r=PG", "display_name": "Kimmo Lehto", "link": "https://stackoverflow.com/users/681520/kimmo-lehto"}, "edited": false, "score": 0, "creation_date": 1524658885, "post_id": 50021727, "comment_id": 87060267, "body": "You may need to do <code>}.to_json</code> on line 112. Looks like mailchip wants the body as a string, you&#39;re sending a bunch of json objects where the body is a json object also, instead of a string that contains json."}, {"owner": {"reputation": 7437, "user_id": 375721, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/nosh5.png?s=128&g=1", "display_name": "martins", "link": "https://stackoverflow.com/users/375721/martins"}, "reply_to_user": {"reputation": 5449, "user_id": 681520, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/701baebf68d1d7faa9f9def6a24fe356?s=128&d=identicon&r=PG", "display_name": "Kimmo Lehto", "link": "https://stackoverflow.com/users/681520/kimmo-lehto"}, "edited": false, "score": 0, "creation_date": 1524659277, "post_id": 50021727, "comment_id": 87060581, "body": "That&#39;s right! Post your comment as an answer. :-D"}, {"owner": {"reputation": 5449, "user_id": 681520, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/701baebf68d1d7faa9f9def6a24fe356?s=128&d=identicon&r=PG", "display_name": "Kimmo Lehto", "link": "https://stackoverflow.com/users/681520/kimmo-lehto"}, "edited": false, "score": 0, "creation_date": 1524660269, "post_id": 50021727, "comment_id": 87061353, "body": "Maybe you have to add the auth header to each batched operation instead of only to the <code>Http.post</code>."}, {"owner": {"reputation": 5449, "user_id": 681520, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/701baebf68d1d7faa9f9def6a24fe356?s=128&d=identicon&r=PG", "display_name": "Kimmo Lehto", "link": "https://stackoverflow.com/users/681520/kimmo-lehto"}, "edited": false, "score": 0, "creation_date": 1524660653, "post_id": 50021727, "comment_id": 87061641, "body": "According to mailchimp api docs the basic auth in POST should suffice."}, {"owner": {"reputation": 7437, "user_id": 375721, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/nosh5.png?s=128&g=1", "display_name": "martins", "link": "https://stackoverflow.com/users/375721/martins"}, "reply_to_user": {"reputation": 5449, "user_id": 681520, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/701baebf68d1d7faa9f9def6a24fe356?s=128&d=identicon&r=PG", "display_name": "Kimmo Lehto", "link": "https://stackoverflow.com/users/681520/kimmo-lehto"}, "edited": false, "score": 0, "creation_date": 1524661100, "post_id": 50021727, "comment_id": 87062004, "body": "I know, that&#39;s why I find it so strange! I&#39;ve emailed support also. Will keep you updated here."}, {"owner": {"reputation": 7437, "user_id": 375721, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/nosh5.png?s=128&g=1", "display_name": "martins", "link": "https://stackoverflow.com/users/375721/martins"}, "reply_to_user": {"reputation": 5449, "user_id": 681520, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/701baebf68d1d7faa9f9def6a24fe356?s=128&d=identicon&r=PG", "display_name": "Kimmo Lehto", "link": "https://stackoverflow.com/users/681520/kimmo-lehto"}, "edited": false, "score": 0, "creation_date": 1524728368, "post_id": 50021727, "comment_id": 87090860, "body": "@KimmoLehto Turns one has to supply the API key when querying the batch ID. Post updated. :)"}], "answers": [{"tags": [], "owner": {"reputation": 7437, "user_id": 375721, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/nosh5.png?s=128&g=1", "display_name": "martins", "link": "https://stackoverflow.com/users/375721/martins"}, "is_accepted": false, "score": 0, "last_activity_date": 1524742056, "creation_date": 1524742056, "answer_id": 50041796, "question_id": 50021727, "link": "https://stackoverflow.com/questions/50021727/httparty-to-batch-update-users-on-mailchimp-3-0-api/50041796#50041796", "title": "HTTParty to batch update users on MailChimp 3.0 API", "body": "<p>I was using the wrong list ID. It's not the ID you see in the URL.\nFrom the page where you can see the list, click <strong>Settings, List names and default</strong> . That's where the list ID is located.<a href=\"https://i.stack.imgur.com/eicfv.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/eicfv.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 7437, "user_id": 375721, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/nosh5.png?s=128&g=1", "display_name": "martins", "link": "https://stackoverflow.com/users/375721/martins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 362, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524742056, "creation_date": 1524657405, "last_edit_date": 1524741715, "question_id": 50021727, "link": "https://stackoverflow.com/questions/50021727/httparty-to-batch-update-users-on-mailchimp-3-0-api", "title": "HTTParty to batch update users on MailChimp 3.0 API", "body": "<p>I'm trying to use the batch API to add a new field to my list members.\nI'm able to post a batch request to the API and I receive a batch ID back.\nThe batch request is accepted successfully but when I check the status of that job, I can see that is has failed:</p>\n\n<pre><code>[{\"status_code\":404,\"operation_id\":null,\n\"response\":\"{\\\"type\\\":\\\"http:\\/\\/developer.mailchimp.com\\/documentation\\/\nmailchimp\\/guides\\/error-glossary\\/\\\",\n\\\"title\\\":\\\"Resource Not Found\\\",\n\\\"status\\\":404,\n\\\"detail\\\":\\\"The requested resource could not be found.\\\",\\\"instance\\\":\\\"\\\"}\"}]\n</code></pre>\n\n<p><strong>Ruby code</strong></p>\n\n<pre><code> 98     def update_member_count_for_all_users\n 99       # https://developer.mailchimp.com/documentation/mailchimp/reference/batches/\n100       operations = []\n101       User.all.each do |user|\n102         next unless user_valid?(user) and user.email.present?\n103         subscriber_hash = Digest::MD5.hexdigest user.email.downcase\n104\n105         operations &lt;&lt; {\n106           method: \"PUT\",\n107           path: \"lists/#{list_id}/members/#{subscriber_hash}\",\n108           body: {\n109             merge_fields: {\n110               M_COUNT: user.family&amp;.users&amp;.count || 0\n111             }\n112           }\n113         }\n114       end\n115\n116       body = { operations: operations }\n117       url = \"#{base_url}/batches\"\n118       response = HTTParty.post(\n119                   url,\n120                   body: body.to_json,\n121                   basic_auth: { username: 'whatever', password: @api_key }\n122                  )\n123\n124       puts \"POSTING: \\n\\n\"\n125       puts \"#{base_url}/batches \\n\"  +\n126            \"body: #{body} \\n\" +\n127            \"basic_auth: { username: 'whatever', password: #{@api_key} } \\n\"\n128       puts \"=========== \\n\"\n129\n130       puts \"response is \\n\\n #{response} \\n\\n\"\n131\n132     end\n</code></pre>\n\n<p><strong>RSpec output</strong></p>\n\n<pre><code>    [{\"id\":\"BATCH_ID\",\"status\":\"pending\",\"total_operations\":0,\n\"finished_operations\":0,\"errored_operations\":0,\n\"submitted_at\":\"2018-04-25T12:34:27+00:00\",\"completed_at\":\"\",\"response_body_url\":\"\",\n\"_links\":\\[{\"rel\":\"parent\",\"href\":\"https://us17.api.mailchimp.com/3.0/batches\",\n\"method\":\"GET\",\"targetSchema\":\"https://us17.api.mailchimp.com/schema/\n3.0/Definitions/Batches/CollectionResponse.json\",\n \"schema\":\"https://us17.api.mailchimp.com/schema/3.0/CollectionLinks/Batches.json\"},\n{\"rel\":\"self\",\"href\":\"https://us17.api.mailchimp.com/3.0/batches/c2b6dc406e\",\"method\":\"GET\",\n \"targetSchema\":\"https://us17.api.mailchimp.com/schema/3.0/Definitions/Batches/Response.json\"},{\"rel\":\"delete\",  \"href\":\"https://us17.api.mailchimp.com/3.0/batches/c2b6dc406e\",\"method\":\"DELETE\"}\\]}][1]\n</code></pre>\n\n<p><strong>Checking the batch request</strong></p>\n\n<pre><code>\u279c  ~ curl https://us17.api.mailchimp.com/3.0/batches/BATCH_ID  \\\n     --user 'anystring:API-KEY' \n\n    \"_links\": [\n        {\n            \"href\": \"https://us17.api.mailchimp.com/3.0/batches\",\n            \"method\": \"GET\",\n            \"rel\": \"parent\",\n            \"schema\": \"https://us17.api.mailchimp.com/schema/3.0/CollectionLinks/Batches.json\",\n            \"targetSchema\": \"https://us17.api.mailchimp.com/schema/3.0/Definitions/Batches/CollectionResponse.json\"\n        },\n        {\n            \"href\": \"https://us17.api.mailchimp.com/3.0/batches/6788b3cca5\",\n            \"method\": \"GET\",\n            \"rel\": \"self\",\n            \"targetSchema\": \"https://us17.api.mailchimp.com/schema/3.0/Definitions/Batches/Response.json\"\n        },\n        {\n            \"href\": \"https://us17.api.mailchimp.com/3.0/batches/6788b3cca5\",\n            \"method\": \"DELETE\",\n            \"rel\": \"delete\"\n        }\n    ],\n    \"completed_at\": \"2018-04-25T12:25:20+00:00\",\n    \"errored_operations\": 1,\n    \"finished_operations\": 1,\n    \"id\": \"6788b3cca5\",\n    \"response_body_url\": \"https://mailchimp-api-batch.s3.amazonaws.com/6788b3cca5-response.tar.gz?AWSAccessKeyId=KEY&amp;Expires=1524727875&amp;Signature=SIG\",\n    \"status\": \"finished\",\n    \"submitted_at\": \"2018-04-25T12:25:13+00:00\",\n    \"total_operations\": 1\n}\n</code></pre>\n\n<p>This is the content of the response_body_url:</p>\n\n<pre><code>[{\"status_code\":404,\"operation_id\":null,\"response\":\"{\\\"type\\\":\\\"http:\\/\\/developer.mailchimp.com\\/documentation\\/mailchimp\\/guides\\/error-glossary\\/\\\",\\\"title\\\":\\\"Resource Not Found\\\",\\\"status\\\":404,\\\"detail\\\":\\\"The requested resource could not be found.\\\",\\\"instance\\\":\\\"\\\"}\"}]\n</code></pre>\n"}, {"tags": ["html", "ruby", "bootstrap-4", "haml", "afas-online"], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 9434676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-k1qYP2rYjPk/AAAAAAAAAAI/AAAAAAAAJbQ/OtbhZO4mX3I/photo.jpg?sz=128", "display_name": "akin", "link": "https://stackoverflow.com/users/9434676/akin"}, "edited": false, "score": 0, "creation_date": 1524658843, "post_id": 50021707, "comment_id": 87060234, "body": "I did the same thing and tried other things to like using the =link_to under the .col. Problem was at the end that I had my Tab wrong, which is very sensitive in haml. THanks btw it worked I only had to do this: change the .col with the =link position and had to have the Tabs on the right place :)"}], "tags": [], "owner": {"reputation": 1905, "user_id": 232838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8342950f34a66d9ec7cfe10b33d5494c?s=128&d=identicon&r=PG", "display_name": "koffeinfrei", "link": "https://stackoverflow.com/users/232838/koffeinfrei"}, "is_accepted": true, "score": 4, "last_activity_date": 1524657320, "creation_date": 1524657320, "answer_id": 50021707, "question_id": 50021480, "link": "https://stackoverflow.com/questions/50021480/link-to-using-on-div-instead-of-text/50021707#50021707", "title": "Link_to using on div instead of text", "body": "<p><a href=\"http://api.rubyonrails.org/classes/ActionView/Helpers/UrlHelper.html#method-i-link_to\" rel=\"nofollow noreferrer\">You can pass a block</a> instead of a text label to the <code>link_to</code> helper, which allows you to nest your whole markup in the link:</p>\n\n<pre><code>= link_to update_bookkeeping_claims_claim_manager_path(@claim_manager), method: 'post' do\n  .col-sm-6.col-md-5.col-lg-3.item.ibox-title.import{:onclick =&gt; \"move()\"}\n    [...]\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 9434676, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-k1qYP2rYjPk/AAAAAAAAAAI/AAAAAAAAJbQ/OtbhZO4mX3I/photo.jpg?sz=128", "display_name": "akin", "link": "https://stackoverflow.com/users/9434676/akin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 50021707, "answer_count": 1, "score": 1, "last_activity_date": 1553067836, "creation_date": 1524656669, "last_edit_date": 1553067836, "question_id": 50021480, "link": "https://stackoverflow.com/questions/50021480/link-to-using-on-div-instead-of-text", "title": "Link_to using on div instead of text", "body": "<p>Can I use the link_to clickable for the whole div instead of only clicking on \u00a8Boeken naar afas\u00a8?</p>\n\n<p>Like at this moment if you click on \u00a8boeken naar afas\u00a8 then the link_to does something.\nI want to have it on the div instead of the text. So when you click on the div then it will be triggerd the \u00a8update_bookkeeping_claims_claim_manager_path(@claim_manager), method: 'post'\u00a8</p>\n\n<pre><code>      .col-sm-6.col-md-5.col-lg-3.item.ibox-title.import{:onclick =&gt; \"move()\"}\n        .box.boxBatenmanager\n          .boxInsite.boxTop\n            %i.fa.fa-exchange.icon.iconApps\n            %h3.name\n              Baten boeken naar #{@claim_manager.bookkeeping_name || 'AFAS'} do\n              %br/\n            %h4.description\n              Uw heeft #{@claim_manager.claims.scheduled_to_update_bookkeeping.count} baten\n              (#{@claim_manager.institution_claim_mutations.scheduled_to_update_bookkeeping.count} mutaties) aangemerkt om te boeken.\n              = link_to \"Boeken naar AFAS\", update_bookkeeping_claims_claim_manager_path(@claim_manager), method: 'post'\n              %br/\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-4", "html-lists", "nokogiri"], "answers": [{"comments": [{"owner": {"reputation": 271, "user_id": 6929856, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/b914dd226ff7b648e0820d82dcd6a02e?s=128&d=identicon&r=PG&f=1", "display_name": "ankur", "link": "https://stackoverflow.com/users/6929856/ankur"}, "edited": false, "score": 0, "creation_date": 1524658912, "post_id": 50021980, "comment_id": 87060291, "body": "Also, Can you add  spaces for each level  whenever we are embedding the tags?"}, {"owner": {"reputation": 12464, "user_id": 1376448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f16da5431a99911ebc32093a28bc591?s=128&d=identicon&r=PG", "display_name": "kiddorails", "link": "https://stackoverflow.com/users/1376448/kiddorails"}, "reply_to_user": {"reputation": 271, "user_id": 6929856, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/b914dd226ff7b648e0820d82dcd6a02e?s=128&d=identicon&r=PG&f=1", "display_name": "ankur", "link": "https://stackoverflow.com/users/6929856/ankur"}, "edited": false, "score": 0, "creation_date": 1524665346, "post_id": 50021980, "comment_id": 87064890, "body": "@ankur added that as explanation. I will further suggest you to play with <code>object_id</code> of nodes to get more clarity."}], "tags": [], "owner": {"reputation": 12464, "user_id": 1376448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f16da5431a99911ebc32093a28bc591?s=128&d=identicon&r=PG", "display_name": "kiddorails", "link": "https://stackoverflow.com/users/1376448/kiddorails"}, "is_accepted": true, "score": 1, "last_activity_date": 1524665297, "last_edit_date": 1524665297, "creation_date": 1524658174, "answer_id": 50021980, "question_id": 50021063, "link": "https://stackoverflow.com/questions/50021063/parse-nested-li-inside-ul-and-ol/50021980#50021980", "title": "parse nested li inside ul and ol", "body": "<p>Perhaps you need this:</p>\n\n<pre><code>content.css('ol').reverse.each do |ol| \n  ol.css('&gt; li').each_with_index { |li,index| li.inner_html=\"#{index + 1} \"+li.inner_html }\nend\ncontent.css('ul &gt; li').reverse.each { |li| li.inner_html=\"\\u2022 \"+li.inner_html }\n\nputs content\n\n&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.0 Transitional//EN\" \"http://www.w3.org/TR/REC-html40/loose.dtd\"&gt;\n&lt;html&gt;&lt;body&gt;\n&lt;ol&gt;\n  &lt;li&gt;1 Introduction\n    &lt;ol&gt;\n      &lt;li&gt;1 hyy ssss&lt;/li&gt;\n    &lt;/ol&gt;\n  &lt;/li&gt;\n  &lt;li&gt;2 Description&lt;/li&gt;\n  &lt;li&gt;3 Observation&lt;/li&gt;\n  &lt;li&gt;4 Results&lt;/li&gt;\n  &lt;li&gt;5 Summary&lt;/li&gt;\n&lt;/ol&gt;\n&lt;ul&gt;\n  &lt;li&gt;\u2022 Introduction&lt;/li&gt;\n  &lt;li&gt;\u2022 Description\n    &lt;ul&gt;\n      &lt;li&gt;\u2022 Observation\n        &lt;ul&gt;\n          &lt;li&gt;\u2022 Results\n            &lt;ul&gt;\n              &lt;li&gt;\u2022 Summary&lt;/li&gt;\n            &lt;/ul&gt;\n          &lt;/li&gt;\n        &lt;/ul&gt;\n      &lt;/li&gt;\n    &lt;/ul&gt;\n  &lt;/li&gt;\n  &lt;li&gt;\u2022 Overview&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/body&gt;&lt;/html&gt;\n</code></pre>\n\n<p>Reason of doing <code>reverse</code> -<br>\nConsider the dom:</p>\n\n<pre><code>&lt;ul&gt;\n  &lt;li&gt;Description\n    &lt;ul&gt;\n      &lt;li&gt;Observation&lt;/li&gt;\n    &lt;/ul&gt;\n  &lt;/li&gt;\n&lt;/ul&gt;\n</code></pre>\n\n<p>When you do <code>content.css('ul &gt; li')</code>, you get in order of [description, observation]. Without <code>reverse</code>, when you run the snippet, you change the <em>description</em>, but doing so will also change the <code>object_id</code> of <em>observation</em> node. Then you changed the <em>observation</em> node which is not referenced anywhere in <code>content</code>. That's why, I reversed it and acquired <code>children</code> before parents. By doing this, I made sure I'm changing the child first and then changed the parent so <em>parent</em> was aware of the change in child and there is no unreferenced node anywhere.</p>\n\n<p>Suppose description's node id is 1234 and observation node_id is 2345. When you <em>mutated</em> description, it changed itself but also changed it's child(2345). New object id can be 3456 and 4567 respectively. Then you changed 2345 (by iteration), but it makes no effect because your <code>content</code> is showing 3456 -> 4567</p>\n\n<p>Hope this makes sense.</p>\n"}], "owner": {"reputation": 271, "user_id": 6929856, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/b914dd226ff7b648e0820d82dcd6a02e?s=128&d=identicon&r=PG&f=1", "display_name": "ankur", "link": "https://stackoverflow.com/users/6929856/ankur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 0, "accepted_answer_id": 50021980, "answer_count": 1, "score": 0, "last_activity_date": 1525841541, "creation_date": 1524655461, "last_edit_date": 1525841541, "question_id": 50021063, "link": "https://stackoverflow.com/questions/50021063/parse-nested-li-inside-ul-and-ol", "title": "parse nested li inside ul and ol", "body": "<p>I have a scenario in which when li comes under <strong>ul</strong> I need to replace it with a dot(.)  and when li comes and <strong>ol</strong> I need to replace it with a number. </p>\n\n<p>But the problem is-</p>\n\n<p>1) It is not doing for nested li</p>\n\n<p>2) It is appending at the same level. Same level means as soon as it finds li it will first add <strong>dot(.)</strong> and then it will add <strong>number</strong>.</p>\n\n<p>What I want</p>\n\n<p>1) Whenever li comes inside ul it should add dot(.). </p>\n\n<p>2) Whenever li comes inside ol it should add a number.</p>\n\n<pre><code>data = \"&lt;ol&gt;\\n&lt;li&gt;Introduction\\n&lt;ol&gt;\\n&lt;li&gt;hyy ssss&lt;/li&gt;\\n&lt;/ol&gt;\\n&lt;/li&gt;\\n&lt;li&gt;Description&lt;/li&gt;\\n&lt;li&gt;Observation&lt;/li&gt;\\n&lt;li&gt;Results&lt;/li&gt;\\n&lt;li&gt;Summary&lt;/li&gt;\\n&lt;/ol&gt;\\n&lt;ul&gt;\\n&lt;li&gt;Introduction&lt;/li&gt;\\n&lt;li&gt;Description\\n&lt;ul&gt;\\n&lt;li&gt;Observation\\n&lt;ul&gt;\\n&lt;li&gt;Results\\n&lt;ul&gt;\\n&lt;li&gt;Summary&lt;/li&gt;\\n&lt;/ul&gt;\\n&lt;/li&gt;\\n&lt;/ul&gt;\\n&lt;/li&gt;\\n&lt;/ul&gt;\\n&lt;/li&gt;\\n&lt;li&gt;Overview&lt;/li&gt;\\n&lt;/ul&gt;\\n&lt;p&gt;All the testing regarding bullet points would have been covered with the above content. Hence publishing this content will make an entry in in the selected  page, cricket page and so on.&lt;/p&gt;\\n\"\n\n    content = Nokogiri::HTML.parse(data)\n    content.at('ul').children.xpath(\"//li\").each { |li| li.inner_html=\"\\u2022 \"+li.inner_html }\n    content.at('ol').children.xpath(\"//li\").each_with_index { |li,index| li.inner_html=\"#{index} \"+li.inner_html }\n</code></pre>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 9030, "user_id": 5101476, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JCQrl.jpg?s=128&g=1", "display_name": "ice\u30c4", "link": "https://stackoverflow.com/users/5101476/ice%e3%83%84"}, "edited": false, "score": 0, "creation_date": 1524654457, "post_id": 50020343, "comment_id": 87057054, "body": "Maybe restructure to <code>hash = FIXED_COUNTRY_TO_PHONE.map { |h| [h[:country], h[:customer_phone]]  }.to_h #=&gt;  {&quot;FI&quot;=&gt;&quot;+4672345678&quot;, &quot;SE&quot;=&gt;&quot;+4672311178&quot;}</code>. Then you can do <code>hash[&#39;FI&#39;] #=&gt; &quot;+4672345678&quot;</code> etc"}, {"owner": {"reputation": 7004, "user_id": 1103606, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/0d93cc650b93939ea91066fcb5aefae0?s=128&d=identicon&r=PG", "display_name": "Peter Penzov", "link": "https://stackoverflow.com/users/1103606/peter-penzov"}, "reply_to_user": {"reputation": 9030, "user_id": 5101476, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JCQrl.jpg?s=128&g=1", "display_name": "ice\u30c4", "link": "https://stackoverflow.com/users/5101476/ice%e3%83%84"}, "edited": false, "score": 0, "creation_date": 1524654516, "post_id": 50020343, "comment_id": 87057090, "body": "I don&#39;t want to change the above code. Can you show me how I can get the customer_phone value based on the country code."}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 1, "creation_date": 1524654757, "post_id": 50020343, "comment_id": 87057248, "body": "<code>FIXED_COUNTRY_TO_PHONE.detect { |h| h[:country] == &#39;FI&#39; }[:customer_phone]</code>."}, {"owner": {"reputation": 7004, "user_id": 1103606, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/0d93cc650b93939ea91066fcb5aefae0?s=128&d=identicon&r=PG", "display_name": "Peter Penzov", "link": "https://stackoverflow.com/users/1103606/peter-penzov"}, "edited": false, "score": 0, "creation_date": 1524654885, "post_id": 50020343, "comment_id": 87057341, "body": "I got <code>execute&#39;: undefined method </code>[]&#39; for nil:NilClass (RuntimeError)"}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1524654944, "post_id": 50020343, "comment_id": 87057385, "body": "There was a typo in the original version of the comment, I have it updated. Try again, it works now."}, {"owner": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 0, "creation_date": 1524659425, "post_id": 50020343, "comment_id": 87060678, "body": "In your &quot;try&quot; (<code>FIXED_COUNTRY_TO_PHONE[country]</code>), <code>country</code> was undefined"}], "answers": [{"comments": [{"owner": {"reputation": 7004, "user_id": 1103606, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/0d93cc650b93939ea91066fcb5aefae0?s=128&d=identicon&r=PG", "display_name": "Peter Penzov", "link": "https://stackoverflow.com/users/1103606/peter-penzov"}, "edited": false, "score": 0, "creation_date": 1524653551, "post_id": 50020378, "comment_id": 87056493, "body": "I wan to get only FI as output."}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "reply_to_user": {"reputation": 7004, "user_id": 1103606, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/0d93cc650b93939ea91066fcb5aefae0?s=128&d=identicon&r=PG", "display_name": "Peter Penzov", "link": "https://stackoverflow.com/users/1103606/peter-penzov"}, "edited": false, "score": 0, "creation_date": 1524653608, "post_id": 50020378, "comment_id": 87056526, "body": "@PeterPenzov Yes, I have updated the code, can you check it?"}, {"owner": {"reputation": 7004, "user_id": 1103606, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/0d93cc650b93939ea91066fcb5aefae0?s=128&d=identicon&r=PG", "display_name": "Peter Penzov", "link": "https://stackoverflow.com/users/1103606/peter-penzov"}, "edited": false, "score": 0, "creation_date": 1524654001, "post_id": 50020378, "comment_id": 87056760, "body": "One more question how I can get the customer_phone value based on the country code. I want to send the country code and the the fixed value."}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1524654984, "post_id": 50020378, "comment_id": 87057412, "body": "<code>select {}.first</code> is called <code>detect</code> btw."}, {"owner": {"reputation": 9030, "user_id": 5101476, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JCQrl.jpg?s=128&g=1", "display_name": "ice\u30c4", "link": "https://stackoverflow.com/users/5101476/ice%e3%83%84"}, "edited": false, "score": 0, "creation_date": 1524655209, "post_id": 50020378, "comment_id": 87057558, "body": "<code>find</code> is more idiomatic."}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "reply_to_user": {"reputation": 9030, "user_id": 5101476, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JCQrl.jpg?s=128&g=1", "display_name": "ice\u30c4", "link": "https://stackoverflow.com/users/5101476/ice%e3%83%84"}, "edited": false, "score": 0, "creation_date": 1524655246, "post_id": 50020378, "comment_id": 87057597, "body": "@SagarPandya why is that?"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 1, "creation_date": 1524655363, "post_id": 50020378, "comment_id": 87057678, "body": "@mudasobwa: common sense says so. Wtf is detect? :) I personally only use it on activerecord associations and other things where <code>find</code> has another meaning."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 1, "creation_date": 1524655501, "post_id": 50020378, "comment_id": 87057788, "body": "@mudasobwa: also ruby style guide says so, if it has any authority to you :)"}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1524655566, "post_id": 50020378, "comment_id": 87057829, "body": "@SergioTulentsev you must have known there is no authority to me in ruby at all :) I always use <code>detect</code> anyway."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1524655725, "post_id": 50020378, "comment_id": 87057923, "body": "@mudasobwa: indeed, I knew the answer before I asked. Hence the wording of my comment :)"}, {"owner": {"reputation": 9030, "user_id": 5101476, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JCQrl.jpg?s=128&g=1", "display_name": "ice\u30c4", "link": "https://stackoverflow.com/users/5101476/ice%e3%83%84"}, "edited": false, "score": 0, "creation_date": 1524655783, "post_id": 50020378, "comment_id": 87057962, "body": "So are we agreeing <code>find</code> for Ruby, but <code>detect</code> for Rails?"}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 1, "creation_date": 1524655807, "post_id": 50020378, "comment_id": 87057972, "body": "Please don\u2019t count me in this agreement :-P"}], "tags": [], "owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "is_accepted": true, "score": 1, "last_activity_date": 1524655021, "last_edit_date": 1524655021, "creation_date": 1524653371, "answer_id": 50020378, "question_id": 50020343, "link": "https://stackoverflow.com/questions/50020343/get-value-from-ruby-hash/50020378#50020378", "title": "Get value from Ruby hash", "body": "<p>Hash is within an array so use this</p>\n\n<pre><code>p FIXED_COUNTRY_TO_PHONE.map{|x| x[:country]}\n</code></pre>\n\n<p>output</p>\n\n<pre><code>[\"FI\", \"SE\"]\n</code></pre>\n\n<p>If you want to take the first country then</p>\n\n<pre><code>p FIXED_COUNTRY_TO_PHONE.first[:country]\n</code></pre>\n\n<p>If you want to take the last country then</p>\n\n<pre><code>p FIXED_COUNTRY_TO_PHONE.last[:country]\n</code></pre>\n\n<p>Getting the country code according to country</p>\n\n<pre><code>p FIXED_COUNTRY_TO_PHONE.detect{|x| x[:country].eql?'FI'}[:customer_phone]\n</code></pre>\n"}], "owner": {"reputation": 7004, "user_id": 1103606, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/0d93cc650b93939ea91066fcb5aefae0?s=128&d=identicon&r=PG", "display_name": "Peter Penzov", "link": "https://stackoverflow.com/users/1103606/peter-penzov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 50020378, "answer_count": 1, "score": -5, "last_activity_date": 1524655021, "creation_date": 1524653275, "question_id": 50020343, "link": "https://stackoverflow.com/questions/50020343/get-value-from-ruby-hash", "title": "Get value from Ruby hash", "body": "<p>I want to use this Ruby code to get fixed values:</p>\n\n<pre><code>FIXED_COUNTRY_TO_PHONE = [\n    { country: 'FI', customer_phone: '+4672345678' },\n    { country: 'SE', customer_phone: '+4672311178' }\n  ].freeze\n</code></pre>\n\n<p>I tries this: <code>FIXED_COUNTRY_TO_PHONE[country]</code> but I don't get the customer_phone value. How I can get the value?</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 2223, "user_id": 5480409, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ySDx0.png?s=128&g=1", "display_name": "Francesco B.", "link": "https://stackoverflow.com/users/5480409/francesco-b"}, "edited": false, "score": 0, "creation_date": 1524656302, "post_id": 50019999, "comment_id": 87058375, "body": "can you add <code>print ciphertext</code>  <code>print symetricKey </code>  <code>print symetricKey </code>  before <code>cleartext = ciphertext &#47; (symetricKey &#47; symetricKey &#47; 100)</code> ?"}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1524662583, "post_id": 50019999, "comment_id": 87063109, "body": "In <a href=\"https://stackoverflow.com/q/49979474/477037\">your previous question</a> you had <code>cleartext * (symetricKey * symetricKey * 100)</code>, now you have <code>ciphertext &#47; (symetricKey &#47; symetricKey &#47; 100)</code>. What are you trying to do!?"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1524680393, "post_id": 50019999, "comment_id": 87073938, "body": "Ruby strongly encourages method and variable names to be lower-case only, so this should be <code>symmetric_key</code>. Case has significant meaning in Ruby, capitals indicate <code>ClassName</code> and <code>CONSTANT_NAME</code> type identifiers."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1524680485, "post_id": 50019999, "comment_id": 87073992, "body": "Another thing to consider is this code could be boiled down <i>considerably</i> by using a hash-style lookup table or some simple math combined with the <code>ord</code> function. You&#39;re also setting yourself up for failure here as the text <code>ab</code> and <code>l</code> are not differentiated by your code. Both map to <code>12</code>."}], "answers": [{"comments": [{"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1524674835, "post_id": 50021285, "comment_id": 87071076, "body": "In #1 I suggest you remove <code>... is always 1, divided by 100 that&#39;s always 0.01</code>, since it&#39;s addressed in #2. In #2, &quot;...so 0.01 is rounded down to 0&quot; is an incorrect interpretation of how integer division is done (as I&#39;m sure you know). I suggest you simply remove references to floating point values. Also, I find your first sentence gratuitous and adds nothing. The OP is clearly a newbie. I&#39;ll delete this comment once you&#39;ve seen it."}], "tags": [], "owner": {"reputation": 5746, "user_id": 4984564, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/9bc286af6678a63ceb881eaf9e966f5f?s=128&d=identicon&r=PG", "display_name": "DarkWiiPlayer", "link": "https://stackoverflow.com/users/4984564/darkwiiplayer"}, "is_accepted": true, "score": 6, "last_activity_date": 1524656475, "last_edit_date": 1524656475, "creation_date": 1524656159, "answer_id": 50021285, "question_id": 50019999, "link": "https://stackoverflow.com/questions/50019999/ruby-zerodivisionerror/50021285#50021285", "title": "Ruby ZeroDivisionError", "body": "<p>It doesn't work because the formula <code>ciphertext / (symetricKey / symetricKey / 100)</code> makes no sense at all.</p>\n\n<ol>\n<li><code>symetricKey / symetricKey</code> is always 1, divided by 100 that's always 0.01</li>\n<li><code>symetricKey / symetricKey / 100</code> both operands are integers, so 0.01 is rounded down to 0</li>\n<li><code>ciphertext / (symetricKey / symetricKey / 100)</code> is equivalent to <code>ciphertext / 0</code> (see 2.)</li>\n</ol>\n\n<p>Your error is exactly what it says in the message: you're dividing by 0.</p>\n\n<p>EDIT: As a small bonus, your code is broken anyway. <code>'k'</code> for example is converted into <code>11</code>, but when decrypting that will turn into <code>'aa'</code></p>\n"}, {"comments": [{"owner": {"reputation": 5746, "user_id": 4984564, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/9bc286af6678a63ceb881eaf9e966f5f?s=128&d=identicon&r=PG", "display_name": "DarkWiiPlayer", "link": "https://stackoverflow.com/users/4984564/darkwiiplayer"}, "edited": false, "score": 0, "creation_date": 1524724311, "post_id": 50032891, "comment_id": 87088446, "body": "Just a tiny problem I noticed: Even if the numbers start with 0, converting them to integers, doing math to them and converting them back, if the number starts with 0 you will lose that anyway. This would turn, for example, <code>0113</code> into <code>113</code>; the a still turns into a k and the m can&#39;t be read because there&#39;s only a 3 left, which would lead to an error at best, or a completely incorrect output at worst."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "reply_to_user": {"reputation": 5746, "user_id": 4984564, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/9bc286af6678a63ceb881eaf9e966f5f?s=128&d=identicon&r=PG", "display_name": "DarkWiiPlayer", "link": "https://stackoverflow.com/users/4984564/darkwiiplayer"}, "edited": false, "score": 0, "creation_date": 1524725525, "post_id": 50032891, "comment_id": 87089149, "body": "@DarkWiiPlayer, if one is encrypting and decrypting strings, what would be the point of converting any of the substrings of the coded message to integers (and doing math on them)?"}, {"owner": {"reputation": 5746, "user_id": 4984564, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/9bc286af6678a63ceb881eaf9e966f5f?s=128&d=identicon&r=PG", "display_name": "DarkWiiPlayer", "link": "https://stackoverflow.com/users/4984564/darkwiiplayer"}, "edited": false, "score": 0, "creation_date": 1524732467, "post_id": 50032891, "comment_id": 87093392, "body": "Not sure if there&#39;s much of a point, but it&#39;s what OP does in the original code."}], "tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": false, "score": 0, "last_activity_date": 1524706946, "last_edit_date": 1524706946, "creation_date": 1524700603, "answer_id": 50032891, "question_id": 50019999, "link": "https://stackoverflow.com/questions/50019999/ruby-zerodivisionerror/50032891#50032891", "title": "Ruby ZeroDivisionError", "body": "<p>Your question has been answered, but I'd like to suggest a more Ruby-like way to solve your problem.</p>\n\n<p>If you look at the doc for <a href=\"http://ruby-doc.org/core-2.4.0/String.html#method-i-gsub\" rel=\"nofollow noreferrer\">Hash#gsub</a> you will see that the second form of the method, written <code>str.gsub(pattern, hash)</code>, where <code>pattern</code> is generally a regular expression and <code>hash</code> is, of course, a hash. Here's an example.</p>\n\n<pre><code>h = { 'c'=&gt;'C', 'a'=&gt;'A', 'n'=&gt;'N', 'd'=&gt;'D', 'o'=&gt;'$', 'g'=&gt;'G' }\n\n'cat and dog.'.gsub(/./, h)\n  #=&gt; \"CAANDD$G\"\n</code></pre>\n\n<p><code>/./</code> is a regular expression that simply matches any one character in <code>str</code>. It first matches <code>'c'</code>, then <code>'a'</code>, and so on. Consider the first letter, <code>'c'</code>. Ruby checks to see if the hash <code>h</code> has a key <code>'c'</code>. It does, so that character is replaced with the value of <code>'c'</code> in the hash, <code>'C'</code>. Next, <code>'a'</code> is replaced with <code>'A'</code>. <code>h</code> does not have a key <code>'t'</code>, however, so Ruby converts <code>'t'</code> to an empty string. Similarly, the characters <code>' '</code> (a space) and <code>'.'</code> (a period) are not keys in <code>h</code>, so those characters are also converted to empty strings.</p>\n\n<p>This form of <code>gsub</code> seems perfect for encrypting and decrypting strings.</p>\n\n<p>Let's first construct the encoding hash.</p>\n\n<pre><code>arr = ('a'..'z').zip('01'..'26')\n  #=&gt; [[\"a\", \"01\"], [\"b\", \"02\"],..., [\"z\", \"26\"]]\nencode = arr.to_h\n  #=&gt; {\"a\"=&gt;\"01\", \"b\"=&gt;\"02\",..., \"z\"=&gt;\"26\"}\nencode[' '] = \"27\"\nencode['.'] = \"28\"\n</code></pre>\n\n<p>So now</p>\n\n<pre><code>encode\n  #=&gt; {\"a\"=&gt;\"01\", \"b\"=&gt;\"02\",..., \"z\"=&gt;\"26\", \" \"=&gt;\"27\", \".\"=&gt;\".\" }\n</code></pre>\n\n<p><code>'a'..'z'</code> and <code>'01'..'2'</code> are <a href=\"http://ruby-doc.org/core-2.4.0/Range.html\" rel=\"nofollow noreferrer\">Range</a>s. See the docs for <a href=\"http://ruby-doc.org/core-2.4.0/Enumerable.html#method-i-zip\" rel=\"nofollow noreferrer\">Enumerable#zip</a> and <a href=\"http://ruby-doc.org/core-2.4.0/Array.html#method-i-to_h\" rel=\"nofollow noreferrer\">Array#to_h</a>. We would normally write those two lines as a single chained expression.</p>\n\n<pre><code>encode = ('a'..'z').zip('01'..'26').to_h\n</code></pre>\n\n<p>Notice that the values begin with <code>\"01\"</code>, so that all are strings of the same length (2). If we started the values with <code>\"1\"</code> how could we decode the string <code>\"1226\"</code>? Would that be <code>'abbd'</code> (1-2-3-4), <code>'abz'</code> (1-2-26), <code>'lz'</code> (12-26) or one of the other possibilities. That is not an issue if all the values of the hash <code>encode</code> are strings of length 2.</p>\n\n<p>We could construct the hash for decoding in the same way( <code>{'01'=&gt;'a', '02'=&gt;'b',...}</code>), but it's easier to use the method <a href=\"http://ruby-doc.org/core-2.4.0/Hash.html#method-i-invert\" rel=\"nofollow noreferrer\">Hash#invert</a>:</p>\n\n<pre><code>decode = encode.invert\n  #=&gt; {\"01\"=&gt;\"a\", \"02\"=&gt;\"b\",..., \"26\"=&gt;\"z\", \"27\"=&gt;\" \", \"28\"=&gt;\".\"} \n</code></pre>\n\n<p>If the string to be encrypted is</p>\n\n<pre><code>str = \"how now, brown cow.\"\n</code></pre>\n\n<p>we can encode it with</p>\n\n<pre><code>encrypted = str.gsub(/./, encode)\n  #=&gt; \"081523271415232702181523142703152328\"\n</code></pre>\n\n<p>which can then be decoded with</p>\n\n<pre><code>decoded = encrypted.gsub(/../, decode)\n  #=&gt; \"how now, brown cow.\"\n</code></pre>\n\n<p>Notice that the regular expression (\"regex\") for decoding matches any two characters at a time.</p>\n\n<p>Two points. Firstly, we could use <a href=\"http://ruby-doc.org/core-2.4.0/Hash.html#method-i-update\" rel=\"nofollow noreferrer\">Hash#update</a> (aka <code>merge!</code>) to write </p>\n\n<pre><code>encode = ('a'..'z').zip('01'..'26').to_h\nencode.update( ' '=&gt;\"27\", '.'=&gt;\"28\" )\n</code></pre>\n\n<p>Ruby allows us to write <code>encode.update({ ' '=&gt;\"27\", '.'=&gt;\"28\" })</code> without the braces (an example of <a href=\"https://medium.com/@Parmaviolet/trick-or-treat-ruby-s-syntactic-sugar-80c9d80a4c4b\" rel=\"nofollow noreferrer\">syntactic sugar</a>).</p>\n\n<p>The better way is to use <a href=\"http://ruby-doc.org/core-2.4.0/Hash.html#method-i-default_proc-3D\" rel=\"nofollow noreferrer\">Hash#default_proc=</a> to write</p>\n\n<pre><code>encode = ('a'..'z').zip('01'..'26').to_h\nencode.default_proc = proc { |h,k| h[k] = k }\n</code></pre>\n\n<p>This is a bit complicated for a Ruby newbie, but the effect is to cause <code>encode[k]</code> to return <code>k</code> if <code>encode</code> does not have a key <code>k</code>. For example, <code>encode['.'] #=&gt; '.'</code>.</p>\n"}], "owner": {"reputation": 29, "user_id": 9497129, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bMm41bUdZik/AAAAAAAAAAI/AAAAAAAAAAQ/ZIGmfepMCAY/photo.jpg?sz=128", "display_name": "huw", "link": "https://stackoverflow.com/users/9497129/huw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 50021285, "answer_count": 2, "score": 0, "last_activity_date": 1524706946, "creation_date": 1524652303, "question_id": 50019999, "link": "https://stackoverflow.com/questions/50019999/ruby-zerodivisionerror", "title": "Ruby ZeroDivisionError", "body": "<p>I am trying to create a encryption alghoritm in ruby. The encryption works fine, but the decryption part fails. The error is at line 67, and says the following:</p>\n\n<blockquote>\n  <p>decryption.rb:67:ln '/': divided by zero (ZeroDivisionError)</p>\n</blockquote>\n\n<p>I have no idea why this is happening and i cannot find a answer to my question online.</p>\n\n<p>This is the source code:</p>\n\n<pre><code>print \"&gt;\"\n\nciphertext = gets.chomp\n\nprint \"&gt;\"\n\nsymetricKey = gets.chomp\n\nsymetricKey.gsub! 'a', '1'\nsymetricKey.gsub! 'b', '2'\nsymetricKey.gsub! 'c', '3'\nsymetricKey.gsub! 'd', '4'\nsymetricKey.gsub! 'e', '5'\nsymetricKey.gsub! 'f', '6'\nsymetricKey.gsub! 'g', '7'\nsymetricKey.gsub! 'h', '8'\nsymetricKey.gsub! 'i', '9'\nsymetricKey.gsub! 'j', '10'\nsymetricKey.gsub! 'k', '11'\nsymetricKey.gsub! 'l', '12'\nsymetricKey.gsub! 'm', '13'\nsymetricKey.gsub! 'n', '14'\nsymetricKey.gsub! 'o', '15'\nsymetricKey.gsub! 'p', '16'\nsymetricKey.gsub! 'q', '17'\nsymetricKey.gsub! 'r', '18'\nsymetricKey.gsub! 's', '19'\nsymetricKey.gsub! 't', '20'\nsymetricKey.gsub! 'u', '21'\nsymetricKey.gsub! 'v', '22'\nsymetricKey.gsub! 'w', '23'\nsymetricKey.gsub! 'x', '24'\nsymetricKey.gsub! 'y', '25'\nsymetricKey.gsub! 'z', '26'\n\nsymetricKey=symetricKey.to_i\n\nciphertext.gsub! 'a', '1'\nciphertext.gsub! 'b', '2'\nciphertext.gsub! 'c', '3'\nciphertext.gsub! 'd', '4'\nciphertext.gsub! 'e', '5'\nciphertext.gsub! 'f', '6'\nciphertext.gsub! 'g', '7'\nciphertext.gsub! 'h', '8'\nciphertext.gsub! 'i', '9'\nciphertext.gsub! 'j', '10'\nciphertext.gsub! 'k', '11'\nciphertext.gsub! 'l', '12'\nciphertext.gsub! 'm', '13'\nciphertext.gsub! 'n', '14'\nciphertext.gsub! 'o', '15'\nciphertext.gsub! 'p', '16'\nciphertext.gsub! 'q', '17'\nciphertext.gsub! 'r', '18'\nciphertext.gsub! 's', '19'\nciphertext.gsub! 't', '20'\nciphertext.gsub! 'u', '21'\nciphertext.gsub! 'v', '22'\nciphertext.gsub! 'w', '23'\nciphertext.gsub! 'x', '24'\nciphertext.gsub! 'y', '25'\nciphertext.gsub! 'z', '26'\n\nciphertext = ciphertext.to_i\n\ncleartext = ciphertext / (symetricKey / symetricKey / 100)\n\nprint\"\\n\"\n\ncleartext.to_s\n\ncleartext.gsub! '1' ,'a'\ncleartext.gsub! '2' ,'b'\ncleartext.gsub! '3' ,'c'\ncleartext.gsub! '4' ,'d'\ncleartext.gsub! '5' ,'e'\ncleartext.gsub! '6' ,'f'\ncleartext.gsub! '7' ,'g'\ncleartext.gsub! '8' ,'h'\ncleartext.gsub! '9' ,'i'\ncleartext.gsub! '10' ,'j'\ncleartext.gsub! '11' ,'k'\ncleartext.gsub! '12' ,'l'\ncleartext.gsub! '13' ,'m'\ncleartext.gsub! '14' ,'n'\ncleartext.gsub! '15' ,'o'\ncleartext.gsub! '16' ,'p'\ncleartext.gsub! '17' ,'q'\ncleartext.gsub! '18' ,'r'\ncleartext.gsub! '19' ,'s'\ncleartext.gsub! '20' ,'t'\ncleartext.gsub! '21' ,'u'\ncleartext.gsub! '22' ,'v'\ncleartext.gsub! '23' ,'w'\ncleartext.gsub! '24' ,'x'\ncleartext.gsub! '25' ,'y'\ncleartext.gsub! '26' ,'z'\n\nputs cleartext\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "openweathermap"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1524651640, "post_id": 50019665, "comment_id": 87055429, "body": "What is the name of that file and how is it rendered? I&#39;m betting it doesn&#39;t have an <code>.erb</code> anywhere in the name."}, {"owner": {"reputation": 711, "user_id": 9607391, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Gje7h6HlhXo/AAAAAAAAAAI/AAAAAAAAAaM/WKvRP-PEe9g/photo.jpg?sz=128", "display_name": "Johan Faerch", "link": "https://stackoverflow.com/users/9607391/johan-faerch"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1524651734, "post_id": 50019665, "comment_id": 87055484, "body": "home.html.erb ;)"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1524652072, "post_id": 50019665, "comment_id": 87055715, "body": "Define &quot;doesn&#39;t work&quot;. is the api key correctly rendered on the page? You may find you forgot to add something."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1524652284, "post_id": 50019665, "comment_id": 87055834, "body": "The followup question is indeed irrelevant / out-of-scope."}, {"owner": {"reputation": 711, "user_id": 9607391, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Gje7h6HlhXo/AAAAAAAAAAI/AAAAAAAAAaM/WKvRP-PEe9g/photo.jpg?sz=128", "display_name": "Johan Faerch", "link": "https://stackoverflow.com/users/9607391/johan-faerch"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1524652826, "post_id": 50019665, "comment_id": 87056119, "body": "@SergioTulentsev Is this out of scope: How do I keep the api key hidden?"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1524652850, "post_id": 50019665, "comment_id": 87056131, "body": "Out of scope of the original form of this question, yes. It was about rendering problem. And &quot;how do I keep api key hidden&quot; is something else <b>entirely</b>."}, {"owner": {"reputation": 711, "user_id": 9607391, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Gje7h6HlhXo/AAAAAAAAAAI/AAAAAAAAAaM/WKvRP-PEe9g/photo.jpg?sz=128", "display_name": "Johan Faerch", "link": "https://stackoverflow.com/users/9607391/johan-faerch"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1524653224, "post_id": 50019665, "comment_id": 87056317, "body": "Thanks @SergioTulentsev I have removed that part"}, {"owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 0, "creation_date": 1524656802, "post_id": 50019665, "comment_id": 87058717, "body": "How did you check that <code>ENV[&quot;api_key&quot;]</code> is actually set in your environment?"}, {"owner": {"reputation": 711, "user_id": 9607391, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Gje7h6HlhXo/AAAAAAAAAAI/AAAAAAAAAaM/WKvRP-PEe9g/photo.jpg?sz=128", "display_name": "Johan Faerch", "link": "https://stackoverflow.com/users/9607391/johan-faerch"}, "reply_to_user": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 0, "creation_date": 1524658119, "post_id": 50019665, "comment_id": 87059660, "body": "@spickermann The actual api key is shown in the HTML but since the quotes are missing it throws an error"}], "answers": [{"comments": [{"owner": {"reputation": 5746, "user_id": 4984564, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/9bc286af6678a63ceb881eaf9e966f5f?s=128&d=identicon&r=PG", "display_name": "DarkWiiPlayer", "link": "https://stackoverflow.com/users/4984564/darkwiiplayer"}, "reply_to_user": {"reputation": 711, "user_id": 9607391, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Gje7h6HlhXo/AAAAAAAAAAI/AAAAAAAAAaM/WKvRP-PEe9g/photo.jpg?sz=128", "display_name": "Johan Faerch", "link": "https://stackoverflow.com/users/9607391/johan-faerch"}, "edited": false, "score": 0, "creation_date": 1524658513, "post_id": 50021517, "comment_id": 87059979, "body": "@JohanFaerch Isn&#39;t that the point? You say it crashes because of the missing quotes. Also your first example has <code>appid: &#39;1234567890&#39;</code>, not <code>appid: 1234567890</code>"}, {"owner": {"reputation": 711, "user_id": 9607391, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Gje7h6HlhXo/AAAAAAAAAAI/AAAAAAAAAaM/WKvRP-PEe9g/photo.jpg?sz=128", "display_name": "Johan Faerch", "link": "https://stackoverflow.com/users/9607391/johan-faerch"}, "edited": false, "score": 0, "creation_date": 1524662004, "post_id": 50021517, "comment_id": 87062667, "body": "In your suggestion it inserts the actual code as a string and not the api key.  My &#39;first example&#39; is from the yml file which has different syntax - Without quotes.  I need to get the actual api key passed inside of quotes like shown in the first script in my question."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 711, "user_id": 9607391, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Gje7h6HlhXo/AAAAAAAAAAI/AAAAAAAAAaM/WKvRP-PEe9g/photo.jpg?sz=128", "display_name": "Johan Faerch", "link": "https://stackoverflow.com/users/9607391/johan-faerch"}, "edited": false, "score": 0, "creation_date": 1524662721, "post_id": 50021517, "comment_id": 87063209, "body": "@JohanFaerch &quot;Just inserts &lt;%= ENV[&quot;api_key&quot;] %&gt; as a string&quot; - no, I don&#39;t think so. Must be you did something wrong while applying this answer."}, {"owner": {"reputation": 711, "user_id": 9607391, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Gje7h6HlhXo/AAAAAAAAAAI/AAAAAAAAAaM/WKvRP-PEe9g/photo.jpg?sz=128", "display_name": "Johan Faerch", "link": "https://stackoverflow.com/users/9607391/johan-faerch"}, "edited": false, "score": 0, "creation_date": 1524662878, "post_id": 50021517, "comment_id": 87063298, "body": "Sorry. Misunderstood your last part. The first script example is the correct and working one but with the api key entered directly in the file."}, {"owner": {"reputation": 5746, "user_id": 4984564, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/9bc286af6678a63ceb881eaf9e966f5f?s=128&d=identicon&r=PG", "display_name": "DarkWiiPlayer", "link": "https://stackoverflow.com/users/4984564/darkwiiplayer"}, "edited": false, "score": 0, "creation_date": 1524663465, "post_id": 50021517, "comment_id": 87063625, "body": "From what you&#39;ve told us, my best guess is that you just don&#39;t feed the file through erb at all."}], "tags": [], "owner": {"reputation": 5746, "user_id": 4984564, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/9bc286af6678a63ceb881eaf9e966f5f?s=128&d=identicon&r=PG", "display_name": "DarkWiiPlayer", "link": "https://stackoverflow.com/users/4984564/darkwiiplayer"}, "is_accepted": false, "score": 0, "last_activity_date": 1524656760, "creation_date": 1524656760, "answer_id": 50021517, "question_id": 50019665, "link": "https://stackoverflow.com/questions/50019665/ruby-insert-envapi-key-in-script/50021517#50021517", "title": "Ruby insert ENV[api_key] in script", "body": "<p>How about <code>appid: '&lt;%= ENV[\"api_key\"] %&gt;'</code>?</p>\n"}, {"comments": [{"owner": {"reputation": 711, "user_id": 9607391, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Gje7h6HlhXo/AAAAAAAAAAI/AAAAAAAAAaM/WKvRP-PEe9g/photo.jpg?sz=128", "display_name": "Johan Faerch", "link": "https://stackoverflow.com/users/9607391/johan-faerch"}, "edited": false, "score": 0, "creation_date": 1524662254, "post_id": 50022037, "comment_id": 87062858, "body": "Hmm. That inserts <code>&amp;quot;1234567890&amp;quot;</code> into the script!?"}, {"owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "reply_to_user": {"reputation": 711, "user_id": 9607391, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Gje7h6HlhXo/AAAAAAAAAAI/AAAAAAAAAaM/WKvRP-PEe9g/photo.jpg?sz=128", "display_name": "Johan Faerch", "link": "https://stackoverflow.com/users/9607391/johan-faerch"}, "edited": false, "score": 0, "creation_date": 1524687185, "post_id": 50022037, "comment_id": 87077224, "body": "<code>==</code> is the ERB equivalent to <a href=\"http://api.rubyonrails.org/v5.0/classes/ActionView/Helpers/OutputSafetyHelper.html#method-i-raw\" rel=\"nofollow noreferrer\">Rails&#39; <code>raw</code> output helper method</a> that does not HTML escape the output."}], "tags": [], "owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "is_accepted": true, "score": 1, "last_activity_date": 1524669068, "last_edit_date": 1524669068, "creation_date": 1524658331, "answer_id": 50022037, "question_id": 50019665, "link": "https://stackoverflow.com/questions/50019665/ruby-insert-envapi-key-in-script/50022037#50022037", "title": "Ruby insert ENV[api_key] in script", "body": "<p>I would do:</p>\n\n<pre><code>&lt;%== ENV['api_key'].to_json %&gt;\n</code></pre>\n"}], "owner": {"reputation": 711, "user_id": 9607391, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Gje7h6HlhXo/AAAAAAAAAAI/AAAAAAAAAaM/WKvRP-PEe9g/photo.jpg?sz=128", "display_name": "Johan Faerch", "link": "https://stackoverflow.com/users/9607391/johan-faerch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 50022037, "answer_count": 2, "score": 1, "last_activity_date": 1524669068, "creation_date": 1524651305, "last_edit_date": 1524653786, "question_id": 50019665, "link": "https://stackoverflow.com/questions/50019665/ruby-insert-envapi-key-in-script", "title": "Ruby insert ENV[api_key] in script", "body": "<p>In application.yml I have <code>api_key: 1234567890</code></p>\n\n<p>If I do this (inserting the api key 'appid' directly) it works (widget shows and populates):</p>\n\n<pre><code>&lt;script&gt;\n  window.myWidgetParam ? window.myWidgetParam : window.myWidgetParam = [];  window.myWidgetParam.push({id: 15,cityid: '2643743',appid: '1234567890' %&gt;,units: 'metric',containerid: 'openweathermap-widget-15',  });  (function() {var script = document.createElement('script');script.async = true;script.charset = \"utf-8\";script.src = \"//openweathermap.org/themes/openweathermap/assets/vendor/owm/js/weather-widget-generator.js\";var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(script, s);  })();\n&lt;/script&gt;\n</code></pre>\n\n<p>But if I do this (inserting <code>&lt;%= ENV[\"api_key\"] %&gt;</code>) it doesn't (widget not showing due to missing quotes around the api key):</p>\n\n<pre><code>&lt;script&gt;\n  window.myWidgetParam ? window.myWidgetParam : window.myWidgetParam = [];  window.myWidgetParam.push({id: 15,cityid: '2643743',appid: &lt;%= ENV[\"api_key\"] %&gt;,units: 'metric',containerid: 'openweathermap-widget-15',  });  (function() {var script = document.createElement('script');script.async = true;script.charset = \"utf-8\";script.src = \"//openweathermap.org/themes/openweathermap/assets/vendor/owm/js/weather-widget-generator.js\";var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(script, s);  })();\n&lt;/script&gt;\n</code></pre>\n\n<p>What am I missing?</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1524633582, "post_id": 50014008, "comment_id": 87045209, "body": "<code>s</code> is a variable defined in the cited question. Don&#39;t write that in the main body of question even before citing that question, as if it were an established fact that <code>s</code> is used to represent each string in an array called <code>strings</code>."}], "answers": [{"tags": [], "owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "is_accepted": false, "score": 1, "last_activity_date": 1524631335, "last_edit_date": 1524631335, "creation_date": 1524631030, "answer_id": 50014150, "question_id": 50014008, "link": "https://stackoverflow.com/questions/50014008/converting-between-symbols-and-strings/50014150#50014150", "title": "Converting between symbols and strings", "body": "<p>Your code is \"if the string <em>contains</em> a letter <em>s</em>\" not \"for each string (<em>s</em>) in the array...\". It means they're hinting at using the variable <code>s</code> to represent each entry as you loop.</p>\n\n<p>The problem is phrased using classic mathematical speak, like \"for each person <em>P</em> in the population <em>O</em>... where <em>O</em> represents the set of all people living in city <em>C</em>...\"</p>\n\n<p>The reason the code doesn't work is because of this line:</p>\n\n<pre><code>strings.gsub! (/s/, .to_sym)\n</code></pre>\n\n<p>That's not valid Ruby. The <code>.to_sym</code> method <em>must</em> operate on something, it doesn't work in isolation. Additionally, <code>strings</code> is an array, it's not actually a string. In your loop <code>string</code> represents an individual entry. It should be <em>more like</em> this:</p>\n\n<pre><code>string.gsub!(/s/, string.to_sym)\n</code></pre>\n\n<p>Yet that's still not right because you can't have symbols inside of strings. An object is either a string <em>or</em> a symbol, not both.</p>\n\n<p>The answer below is correct because it pushes a symbol value in and no <code>gsub</code> is required.</p>\n"}, {"comments": [{"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 2, "creation_date": 1524633840, "post_id": 50014212, "comment_id": 87045306, "body": "Nitpicking: <code>&amp;</code> is not only about \u201ca single method called on the block variable\u201d it\u2019s more general approach of converting anything to <i>proc</i> and passing the result to the receiver <i>as block</i>, e.g. <code>[1,2,3,4,5].detect(&amp;3.method(:==))</code>. In the aforementioned case it works because of <a href=\"https://ruby-doc.org/core/Symbol.html#method-i-to_proc\" rel=\"nofollow noreferrer\"><code>Symbol#to_proc</code></a> is implemented."}], "tags": [], "owner": {"reputation": 4600, "user_id": 5961578, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/df7cbfdd2a92a7926af3bbb8648318aa?s=128&d=identicon&r=PG", "display_name": "moveson", "link": "https://stackoverflow.com/users/5961578/moveson"}, "is_accepted": false, "score": 4, "last_activity_date": 1524631430, "creation_date": 1524631430, "answer_id": 50014212, "question_id": 50014008, "link": "https://stackoverflow.com/questions/50014008/converting-between-symbols-and-strings/50014212#50014212", "title": "Converting between symbols and strings", "body": "<p>As @tadman mentions, the question is not about <code>gsub</code> at all, but rather about iterating over an array and applying an operation to each element to create a new array. </p>\n\n<p>The \"correct\" answer you show in your question will work, but a more typical Ruby solution would be to use <code>map</code>, like this:</p>\n\n<pre><code>&gt;&gt; strings = [\"cat\", \"deer\", \"mouse\"]\n&gt;&gt; symbols = strings.map { |s| s.to_sym }\n#&gt; [:cat, :deer, :mouse]\n</code></pre>\n\n<p>Anytime you see this pattern, where a single method is called on the block variable, you can use an even more concise shorthand like this:</p>\n\n<pre><code>&gt;&gt; symbols = strings.map(&amp;:to_sym)\n#&gt; [:cat, :deer, :mouse]\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 9627510, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Hamzah Osman", "link": "https://stackoverflow.com/users/9627510/hamzah-osman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 261, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1526114690, "creation_date": 1524629996, "last_edit_date": 1526114690, "question_id": 50014008, "link": "https://stackoverflow.com/questions/50014008/converting-between-symbols-and-strings", "title": "Converting between symbols and strings", "body": "<p><strong>I was asked this question:</strong></p>\n\n<blockquote>\n  <p>We have an array of strings we'd like to later use as hash keys, but we'd rather they be symbols.</p>\n  \n  <ol>\n  <li>Create a new variable, <code>symbols</code>, and store an empty array in it.</li>\n  <li>Use <code>.each</code> to iterate over the <code>strings</code> array.</li>\n  <li>For each <code>s</code> in <code>strings</code>, use <code>.to_sym</code> to convert <code>s</code> to a symbol and use <code>.push</code> to add that new symbol to <code>symbols</code>. </li>\n  <li>Print the <code>symbols</code> array.</li>\n  </ol>\n</blockquote>\n\n<p><strong>The correct answer given was this:</strong></p>\n\n<pre><code>strings.each do |s|\n  symbols.push(s.to_sym)\nend \n\nprint symbols\n</code></pre>\n\n<p><strong>I did it like this:</strong></p>\n\n<pre><code>strings.each do |string|\n  if strings.include? \"s\"\n    strings.gsub! (/s/, .to_sym)\n  end\n  symbols.push (string)\nend\n\nprint symbols\n</code></pre>\n\n<p>The code didn't work. I'm trying to get help in that regards.</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 5669, "user_id": 7429104, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/TZAPt.jpg?s=128&g=1", "display_name": "Aman", "link": "https://stackoverflow.com/users/7429104/aman"}, "edited": false, "score": 0, "creation_date": 1524629934, "post_id": 50013832, "comment_id": 87044228, "body": "you can use joins or includes."}], "answers": [{"comments": [{"owner": {"reputation": 1245, "user_id": 1735713, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/0KIJo.jpg?s=128&g=1", "display_name": "chaintng", "link": "https://stackoverflow.com/users/1735713/chaintng"}, "edited": false, "score": 0, "creation_date": 1524635247, "post_id": 50014253, "comment_id": 87045801, "body": "As i mentioned in the post. I know that i can merge into single SQL query. But i interested in dealing with async. Let say, it is not SQL, but calling to certain API Endpoint..."}], "tags": [], "owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "is_accepted": false, "score": 1, "last_activity_date": 1524631758, "creation_date": 1524631758, "answer_id": 50014253, "question_id": 50013832, "link": "https://stackoverflow.com/questions/50013832/is-there-something-similar-to-js-promise-all-in-ruby/50014253#50014253", "title": "Is there something similar to JS &#39;Promise.all()&#39; in Ruby?", "body": "<p>Sure just do the count in one database call:</p>\n\n<pre><code>blogs = Blog\n  .select('blogs.id, COUNT(DISTINCT blog_comments.user_id) AS comment_count')\n  .joins('LEFT JOIN blog_comments ON blog_comments.blog_id = blogs.id')\n  .where(comments: { id: params[:ids]\u00a0})\n  .group('blogs.id')\n\nresults = blogs.map do |blog|\n  { id: blog.id, comment_count: blog.comment_count }\nend\n\nrender json: results.to_json\n</code></pre>\n\n<p>You might need to change the statements depending on how your table as named in the database because I just guessed by the name of your associations.</p>\n"}, {"tags": [], "owner": {"reputation": 38790, "user_id": 665240, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/32fc08ee80cf129f6b1e8593eccb9a03?s=128&d=identicon&r=PG", "display_name": "Carl Zulauf", "link": "https://stackoverflow.com/users/665240/carl-zulauf"}, "is_accepted": false, "score": 4, "last_activity_date": 1524635395, "creation_date": 1524635395, "answer_id": 50014860, "question_id": 50013832, "link": "https://stackoverflow.com/questions/50013832/is-there-something-similar-to-js-promise-all-in-ruby/50014860#50014860", "title": "Is there something similar to JS &#39;Promise.all()&#39; in Ruby?", "body": "<p>There are multiple ways to solve this in ruby, including promises (enabled by gems).</p>\n\n<p>JavaScript accomplishes asynchronous execution using an event loop and event driven I/O. There are event libraries to accomplish the same thing in ruby. One of the most popular is <a href=\"https://github.com/eventmachine/eventmachine\" rel=\"nofollow noreferrer\"><code>eventmachine</code></a>.</p>\n\n<p>As you mentioned, threads can also solve this problem. Thread-safety is a big topic and is further complicated by different thread models in different flavors of ruby (MRI, JRuby, etc). In summary I'll just say that of course threads can be used safely... there are just times when that is difficult. However, when used with blocking I/O (like to an API or a database request) threads can be very useful and fairly straight-forward. A solution with threads might look something like this:</p>\n\n<pre><code># run blocking IO requests simultaneously\nthread_pool = [\n  Thread.new { execute_sql_1 },\n  Thread.new { execute_sql_2 },\n  Thread.new { execute_sql_3 },\n  # ...\n]\n\n# wait for the slowest one to finish\nthread_pool.each(&amp;:join)\n</code></pre>\n\n<p>You also have access to other currency models, like the actor model, async classes, promises, and others enabled by gems like <a href=\"https://github.com/ruby-concurrency/concurrent-ruby\" rel=\"nofollow noreferrer\"><code>concurrent-ruby</code></a>.</p>\n\n<p>Finally, ruby concurrency can take the form of multiple processes communicating through built in mechanisms (drb, sockets, etc) or through distributed message brokers (redis, rabbitmq, etc).</p>\n"}, {"comments": [{"owner": {"reputation": 1245, "user_id": 1735713, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/0KIJo.jpg?s=128&g=1", "display_name": "chaintng", "link": "https://stackoverflow.com/users/1735713/chaintng"}, "edited": false, "score": 0, "creation_date": 1524671428, "post_id": 50022020, "comment_id": 87069209, "body": "Yeah, i think this is what i looking for. But i just wondering do we need to have Thread Pool in this case? Is there anything to worry about using thread? Some of my colleagues really dont embrace the thread and he complain that it might dangerous if we didnt understand it fully. What\u2019s ur idea?"}, {"owner": {"reputation": 5746, "user_id": 4984564, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/9bc286af6678a63ceb881eaf9e966f5f?s=128&d=identicon&r=PG", "display_name": "DarkWiiPlayer", "link": "https://stackoverflow.com/users/4984564/darkwiiplayer"}, "reply_to_user": {"reputation": 1245, "user_id": 1735713, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/0KIJo.jpg?s=128&g=1", "display_name": "chaintng", "link": "https://stackoverflow.com/users/1735713/chaintng"}, "edited": false, "score": 0, "creation_date": 1524722910, "post_id": 50022020, "comment_id": 87087722, "body": "You will always need some sort of thread pool if you want to wait for all threads to finish, BUT there&#39;s no need to explicitly name it. In my example it&#39;s just an intermediary state between two <code>.map</code> calls."}, {"owner": {"reputation": 5746, "user_id": 4984564, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/9bc286af6678a63ceb881eaf9e966f5f?s=128&d=identicon&r=PG", "display_name": "DarkWiiPlayer", "link": "https://stackoverflow.com/users/4984564/darkwiiplayer"}, "reply_to_user": {"reputation": 1245, "user_id": 1735713, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/0KIJo.jpg?s=128&g=1", "display_name": "chaintng", "link": "https://stackoverflow.com/users/1735713/chaintng"}, "edited": false, "score": 0, "creation_date": 1524723050, "post_id": 50022020, "comment_id": 87087769, "body": "Threads are dangerous, yes, but so is any form of parallelism if you do it incorrectly. Two threads can mess with each others data and break your program, but if you have each thread responsible of its own state, then you don&#39;t need to worry about how they interact. For more complex tasks that may not always be possible, but for running database queries in parallel it certainly is."}], "tags": [], "owner": {"reputation": 5746, "user_id": 4984564, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/9bc286af6678a63ceb881eaf9e966f5f?s=128&d=identicon&r=PG", "display_name": "DarkWiiPlayer", "link": "https://stackoverflow.com/users/4984564/darkwiiplayer"}, "is_accepted": false, "score": 1, "last_activity_date": 1524658301, "creation_date": 1524658301, "answer_id": 50022020, "question_id": 50013832, "link": "https://stackoverflow.com/questions/50013832/is-there-something-similar-to-js-promise-all-in-ruby/50022020#50022020", "title": "Is there something similar to JS &#39;Promise.all()&#39; in Ruby?", "body": "<h1>Okay, generalizing a bit:</h1>\n\n<p>You have a list of data <code>data</code> and want to operate on that data asynchronously. Assuming the operation is the same for all entries in your list, you can do this:</p>\n\n<pre><code>data = [1, 2, 3, 4] # Example data\noperation = -&gt; (data_entry) { data * 2 } # Our operation: multiply by two\nresults = data.map{ |e| Thread.new(e, &amp;operation) }.map{ |t| t.value }\n</code></pre>\n\n<h2>Taking it apart:</h2>\n\n<pre><code>data = [1, 2, 3, 4]\n</code></pre>\n\n<p>This could be anything from database IDs to URIs. Using numbers for simplicity here.</p>\n\n<pre><code>operation = -&gt; (data_entry) { data * 2 }\n</code></pre>\n\n<p>Definition of a lambda that takes one argument and does some calculation on it. This could be an API call, an SQL query or any other operation that takes some time to complete. Again, for simplicity, I'm just multiplicating the numbers by 2.</p>\n\n<pre><code>results =\n</code></pre>\n\n<p>This array will contain the results of all the asynchronous operations.</p>\n\n<pre><code>data.map{ |e| Thread.new(e, &amp;operation) }...\n</code></pre>\n\n<p>For every entry in the data set, spawn a thread that runs <code>operation</code> and pass the entry as argument. This is the <code>data_entry</code> argument in the lambda.</p>\n\n<pre><code>...map{ |t| t.value }\n</code></pre>\n\n<p>Extract the value from each thread. This will wait for the thread to finish first, so by the end of this line all your data will be there.</p>\n\n<h2>Lambdas</h2>\n\n<p>Lambdas are really just glorified blocks that raise an error if you pass in the wrong number of arguments. The syntax <code>-&gt; (arguments) {code}</code> is just syntactic sugar for <code>Lambda.new { |arguments| code }</code>.</p>\n\n<p>When a method accepts a block like <code>Thread.new { do_async_stuff_here }</code> you can also pass a Lambda or Proc object prefixed with <code>&amp;</code> and it will be treated the same way.</p>\n"}], "owner": {"reputation": 1245, "user_id": 1735713, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/0KIJo.jpg?s=128&g=1", "display_name": "chaintng", "link": "https://stackoverflow.com/users/1735713/chaintng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 655, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1524658301, "creation_date": 1524628651, "last_edit_date": 1524634483, "question_id": 50013832, "link": "https://stackoverflow.com/questions/50013832/is-there-something-similar-to-js-promise-all-in-ruby", "title": "Is there something similar to JS &#39;Promise.all()&#39; in Ruby?", "body": "<p>Below is a code that should be optimized:</p>\n\n<pre><code>def statistics\n  blogs = Blog.where(id: params[:ids])\n  results = blogs.map do |blog|\n    {\n      id: blog.id,\n      comment_count: blog.blog_comments.select(\"DISTINCT user_id\").count\n    }\n  end\n  render json: results.to_json\nend\n</code></pre>\n\n<p>Each SQL query cost around 200ms. If I have 10 blog posts, this function would take 2s because it runs synchronously. I can use <code>GROUP BY</code> to optimize the query, but I put that aside first because the task could be a third party request, and I am interested in how Ruby deals with async.</p>\n\n<p>In Javascript, when I want to dispatch multiple asynchronous works and wait all of them to resolve, I can use <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all\" rel=\"nofollow noreferrer\"><code>Promise.all()</code></a>. I wonder what the alternatives are for Ruby language to solve this problem.</p>\n\n<p>Do I need a thread for this case? And is it safe to do that in Ruby?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "database", "url", "activerecord"], "comments": [{"owner": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 1, "creation_date": 1524622551, "post_id": 50012943, "comment_id": 87042540, "body": "It seems rather unlikely that you would need to run through <i>millions</i> of <code>.exists?</code> to find a unique number. How many existing numbers would there need to be for the given approach to create performance issues? How many digits would you need an identifier to be in order for the given approach <i>not</i> to create performance issues?"}, {"owner": {"reputation": 4600, "user_id": 5961578, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/df7cbfdd2a92a7926af3bbb8648318aa?s=128&d=identicon&r=PG", "display_name": "moveson", "link": "https://stackoverflow.com/users/5961578/moveson"}, "edited": false, "score": 0, "creation_date": 1524622643, "post_id": 50012943, "comment_id": 87042556, "body": "Just project the highest number of records you can foresee in the most optimistic scenario, and use integers that will provide you 2 or 3 orders of magnitude headroom. This will make single collisions unlikely and more than one collision extremely unlikely."}, {"owner": {"reputation": 2902, "user_id": 523051, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/497825ebbcb0e06c2451d3ff91d644b2?s=128&d=identicon&r=PG", "display_name": "chrickso", "link": "https://stackoverflow.com/users/523051/chrickso"}, "reply_to_user": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 0, "creation_date": 1524623090, "post_id": 50012943, "comment_id": 87042632, "body": "@jvillian i agree millions is a bit outlandish but lets say there are millions of records already and here is my method of generating the hash_id: hash_id = Array.new(8) { rand(10) }.join , i can imagine it spitting out plenty of numbers that have been used already and if every lookup takes a 1-2 milliseconds, the delay on the user end could be very long."}, {"owner": {"reputation": 2902, "user_id": 523051, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/497825ebbcb0e06c2451d3ff91d644b2?s=128&d=identicon&r=PG", "display_name": "chrickso", "link": "https://stackoverflow.com/users/523051/chrickso"}, "reply_to_user": {"reputation": 4600, "user_id": 5961578, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/df7cbfdd2a92a7926af3bbb8648318aa?s=128&d=identicon&r=PG", "display_name": "moveson", "link": "https://stackoverflow.com/users/5961578/moveson"}, "edited": false, "score": 0, "creation_date": 1524623108, "post_id": 50012943, "comment_id": 87042636, "body": "@moveson , any concern with my method of generating the hash (shown in above comment)?"}, {"owner": {"reputation": 4600, "user_id": 5961578, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/df7cbfdd2a92a7926af3bbb8648318aa?s=128&d=identicon&r=PG", "display_name": "moveson", "link": "https://stackoverflow.com/users/5961578/moveson"}, "edited": false, "score": 0, "creation_date": 1524623746, "post_id": 50012943, "comment_id": 87042796, "body": "Looks fine to me. Or you could just generate a single random number and ensure consistent number of digits by filling any empty spaces with zeros: <code>rand(100_000_000_000).to_s.rjust(11, &#39;0&#39;)</code>"}, {"owner": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "reply_to_user": {"reputation": 4600, "user_id": 5961578, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/df7cbfdd2a92a7926af3bbb8648318aa?s=128&d=identicon&r=PG", "display_name": "moveson", "link": "https://stackoverflow.com/users/5961578/moveson"}, "edited": false, "score": 0, "creation_date": 1524623981, "post_id": 50012943, "comment_id": 87042856, "body": "If you have an algorithm that generates potentially 100_000_000_000 options  (as @moveson suggests) and you have 10_000_000 existing records, what is the probability that you will pull an already-existing number in one iteration? Two? Three? How many iterations before p is functionally zero?"}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 0, "creation_date": 1524624089, "post_id": 50012943, "comment_id": 87042888, "body": "Why not use Optimus? There are <a href=\"https://github.com/jenssegers/optimus\" rel=\"nofollow noreferrer\">PHP</a> and <a href=\"https://github.com/pjebs/optimus-go\" rel=\"nofollow noreferrer\">Go</a> implementations to work from."}, {"owner": {"reputation": 1088, "user_id": 3236163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f4a825085dda7d9ea059838a3d6dcd7?s=128&d=identicon&r=PG", "display_name": "elyalvarado", "link": "https://stackoverflow.com/users/3236163/elyalvarado"}, "edited": false, "score": 0, "creation_date": 1524628492, "post_id": 50012943, "comment_id": 87043879, "body": "The likelihood of a collision if you use a random number with 9 digits is so low that you probably won&#39;t see it in your lifetime. And even if there is a collision it&#39;ll get lost in your error messages and you won&#39;t even know it, because your code should be able to handle this kind of errors gracefully. Just use: <code>SecureRandom.random_number(100_000_000)</code> if you need consistent width add some zero padding. Oh, and forget the repeated key check, its not worth it in this case."}, {"owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 0, "creation_date": 1524629219, "post_id": 50012943, "comment_id": 87044053, "body": "Optimize for reading: Generate <code>x</code> random numbers upfront and store them in a database table. When you actually need a number just pick the next random number from that table and mark it as used. If there are only <code>y</code> unused random numbers left in the table start a background job that fills the table up with new numbers. Close <code>x</code> and <code>y</code> wisely depending on how many numbers you usually need on a daily base..."}], "answers": [{"tags": [], "owner": {"reputation": 1905, "user_id": 232838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8342950f34a66d9ec7cfe10b33d5494c?s=128&d=identicon&r=PG", "display_name": "koffeinfrei", "link": "https://stackoverflow.com/users/232838/koffeinfrei"}, "is_accepted": false, "score": 2, "last_activity_date": 1524653160, "last_edit_date": 1524653160, "creation_date": 1524641117, "answer_id": 50016365, "question_id": 50012943, "link": "https://stackoverflow.com/questions/50012943/with-rails-5-what-is-the-most-efficient-way-to-generate-and-use-a-basecamp-styl/50016365#50016365", "title": "With Rails 5, what is the most efficient way to generate and use a Basecamp-style &quot;hash_id&quot; (instead of sequential row id&#39;s) for each new record?", "body": "<p>Efficiency-wise I think you should be fine. <a href=\"https://gitlab.com/gitlab-org/gitlab-ce/blob/master/app/models/concerns/token_authenticatable.rb#L12-15\" rel=\"nofollow noreferrer\">GitLab also uses something similar</a> for unique token generation.</p>\n\n<p>There's another issue though that's worth considering:</p>\n\n<p>Your method does not guarantee to generate a unique key, as the operation is not atomic (neither is GitLab's). Between checking for uniqueness and writing the record to the database the same key <em>could</em> have been generated.</p>\n\n<p>You have at least 2 options to handle this. Both solution should also be more efficient (which is your main concern).</p>\n\n<h2>Catch the DB's unique key constrain violation on save</h2>\n\n<pre><code>def save\n  begin\n    self.hash_id = generate_hash_id\n    super\n  rescue ActiveRecord::RecordNotUnique =&gt; e\n    # 1. you may need to check the message for the specific constraint\n    # 2. you may need to implement an abort condition to prevent infinite retries\n    retry\n  end\nend\n</code></pre>\n\n<p>You could can also do this in an ActiveRecord callback.</p>\n\n<h2>Have the DB generate the key</h2>\n\n<p>An alternative solution would be to have your database generate the unique key on create. A function like the one described in this blogpost <a href=\"https://rob.conery.io/2014/05/28/a-better-id-generator-for-postgresql/\" rel=\"nofollow noreferrer\">A Better ID Generator For PostgreSQL</a> may serve your purpose better.</p>\n\n<p>This solution has the advantage that your application code does not need to be concerned about generating or catching collisions. The drawback is though that this solution is DB specific.</p>\n"}], "owner": {"reputation": 2902, "user_id": 523051, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/497825ebbcb0e06c2451d3ff91d644b2?s=128&d=identicon&r=PG", "display_name": "chrickso", "link": "https://stackoverflow.com/users/523051/chrickso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524653160, "creation_date": 1524621212, "last_edit_date": 1524622318, "question_id": 50012943, "link": "https://stackoverflow.com/questions/50012943/with-rails-5-what-is-the-most-efficient-way-to-generate-and-use-a-basecamp-styl", "title": "With Rails 5, what is the most efficient way to generate and use a Basecamp-style &quot;hash_id&quot; (instead of sequential row id&#39;s) for each new record?", "body": "<p>What I'm going for is URL's very similar to <a href=\"https://basecamp.com/\" rel=\"nofollow noreferrer\">Basecamp</a>'s:</p>\n\n<pre><code>https://3.basecamp.com/4000818/buckets/7452203/message_boards/1039416768\n</code></pre>\n\n<p>I have already achieved this functionality by following <a href=\"https://hackernoon.com/how-to-use-hash-ids-in-your-url-in-ruby-on-rails-5-e8b7cdd31733\" rel=\"nofollow noreferrer\">this guide</a>, but I am unsatisfied with the process of needing to run potentially millions of .exists? lookups to find an open number and fear this will very quickly hamper performance of my app.</p>\n\n<pre><code>def set_hash_id\n    hash_id = nil\n    loop do\n      hash_id = SecureRandom.urlsafe_base64(9).gsub(/-|_/,('a'..'z').to_a[rand(26)])\n      break unless self.class.name.constantize.where(:hash_id =&gt; hash_id).exists?\n    end\n    self.hash_id = hash_id\n  end\n</code></pre>\n\n<p>I find it hard to believe that Basecamp is relying on something so inefficient on every record save and I'm looking to find out how they do it or to find a setup that will look the same but without the overhead of the linked tutorial.</p>\n\n<p>I'd appreciate any input on methods to generate a non-sequential record ID. I am not interested in UUID's as I can't stand the non-pleasing URL's they generate. Also, they must be integers. Basically, exactly like the Basecamp URL but without the overhead of the exists? checks. Is it possible they are doing some kind of combination of numbers with an encoded timestamp or something to ensure there is no collisions? I have explored the <a href=\"http://www.hashids.org/ruby/\" rel=\"nofollow noreferrer\">hashids.org</a> method but this does not generate integer-only hashes.</p>\n\n<p>I am using Postgres as my database, in case this is helpful.</p>\n"}, {"tags": ["ruby", "hanami", "ruby-object-mapper"], "comments": [{"owner": {"reputation": 16564, "user_id": 1261399, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/679444399bbf92e3a5d3f16347809f3f?s=128&d=identicon&r=PG", "display_name": "Leo Correa", "link": "https://stackoverflow.com/users/1261399/leo-correa"}, "edited": false, "score": 0, "creation_date": 1524606886, "post_id": 50011179, "comment_id": 87038958, "body": "I&#39;m not familiar with Hanami but it looks like it uses <code>rom-repository</code> and <code>sequel</code> under the scenes. Something like <code>aggregate(:user_info)</code> should work according to <a href=\"http://api.rom-rb.org/rom/ROM/Repository/Root#aggregate-instance_method\" rel=\"nofollow noreferrer\">api.rom-rb.org/rom/ROM/Repository/&hellip;</a> let me know if this helps so i can make it the answer"}, {"owner": {"reputation": 2860, "user_id": 1013173, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/072162a90979f670d87c36ae8818ea13?s=128&d=identicon&r=PG", "display_name": "Sergey Potapov", "link": "https://stackoverflow.com/users/1013173/sergey-potapov"}, "reply_to_user": {"reputation": 16564, "user_id": 1261399, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/679444399bbf92e3a5d3f16347809f3f?s=128&d=identicon&r=PG", "display_name": "Leo Correa", "link": "https://stackoverflow.com/users/1261399/leo-correa"}, "edited": false, "score": 0, "creation_date": 1524607645, "post_id": 50011179, "comment_id": 87039229, "body": "Thanks. <code>aggregate</code> is quite similar to what I am trying to achieve: it returns the same set of data I am trying to obtain, but it does 2 request: - first to fetch all <code>users</code> - second to fetch all <code>user_infos</code> with condition <code>user_id IN (1,2,3,4, 5 ...)</code>. It just enumerates ids of all fetched users in SQL query."}, {"owner": {"reputation": 16564, "user_id": 1261399, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/679444399bbf92e3a5d3f16347809f3f?s=128&d=identicon&r=PG", "display_name": "Leo Correa", "link": "https://stackoverflow.com/users/1261399/leo-correa"}, "edited": false, "score": 0, "creation_date": 1524613475, "post_id": 50011179, "comment_id": 87040680, "body": "I wonder if performing the join and then the aggregate explicitly would work. I&#39;m sorry I don&#39;t have much knowledge of the gems. Just vaguely looked at the docs"}], "answers": [{"tags": [], "owner": {"reputation": 740, "user_id": 1673407, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e96c0fca120336cd8aa4ab86b4db0e65?s=128&d=identicon&r=PG", "display_name": "kaikuchn", "link": "https://stackoverflow.com/users/1673407/kaikuchn"}, "is_accepted": false, "score": 2, "last_activity_date": 1548346445, "last_edit_date": 1548346445, "creation_date": 1524643019, "answer_id": 50016906, "question_id": 50011179, "link": "https://stackoverflow.com/questions/50011179/how-to-fetch-data-from-multiple-tables-with-one-sql-query-in-hanami/50016906#50016906", "title": "How to fetch data from multiple tables with one SQL query in Hanami?", "body": "<p>When you fetch data via a Repository in Hanami the result set is mapped into entities.\nBy default the <code>UserRepository</code> will map to the <code>User</code> entity. I'm guessing that that entity does not have attributes for the columns from <code>user_info</code>.</p>\n\n<p>What you need to do is create an Entity that can contain the data that you want to fetch from the database and then call <code>.as(ThatEntityYouCreated)</code> on the result set. E.g.,</p>\n\n<pre><code>def users_with_info\n  users.join(:user_info).map_to(UserWithInfo)\nend\n</code></pre>\n\n<p>If you do not want to create an Entity and just want to get a plain hash, you can do this:</p>\n\n<pre><code>users.join(:user_info).map.to_a\n</code></pre>\n\n<p>However, I consider this to be a crutch. You should not return Hashes from your Repository methods.</p>\n"}, {"tags": [], "owner": {"reputation": 42, "user_id": 4789597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e36998db94ff46933db968fa524c9a5e?s=128&d=identicon&r=PG", "display_name": "nfilzi", "link": "https://stackoverflow.com/users/4789597/nfilzi"}, "is_accepted": false, "score": 0, "last_activity_date": 1524786579, "creation_date": 1524786579, "answer_id": 50053367, "question_id": 50011179, "link": "https://stackoverflow.com/questions/50011179/how-to-fetch-data-from-multiple-tables-with-one-sql-query-in-hanami/50053367#50053367", "title": "How to fetch data from multiple tables with one SQL query in Hanami?", "body": "<p>I believe we faced this exact issue with a teammate of mine on one of our Hanami project, and this is <strong><a href=\"https://github.com/nfilzi/housing-list/blob/master/lib/housing_list/repositories/housing_repository.rb#L50\" rel=\"nofollow noreferrer\">how we solved it</a>.</strong></p>\n\n<p>We basically bypassed Hanami repository, going straight to the underlying ROM relation, using <strong><a href=\"http://www.rubydoc.info/github/rom-rb/rom/ROM%2FRelation:wrap\" rel=\"nofollow noreferrer\"><code>ROM::Relation#wrap</code></a></strong> in order to get our <code>User</code> entity joined with the entity of interest.</p>\n\n<p>Let met know if it helped you, or if you need more details. Cheers!</p>\n"}], "owner": {"reputation": 2860, "user_id": 1013173, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/072162a90979f670d87c36ae8818ea13?s=128&d=identicon&r=PG", "display_name": "Sergey Potapov", "link": "https://stackoverflow.com/users/1013173/sergey-potapov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 590, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1548346445, "creation_date": 1524606496, "question_id": 50011179, "link": "https://stackoverflow.com/questions/50011179/how-to-fetch-data-from-multiple-tables-with-one-sql-query-in-hanami", "title": "How to fetch data from multiple tables with one SQL query in Hanami?", "body": "<p>I have Hanami models <code>User</code> and <code>UserInfo</code> that have <code>has_one</code> association.</p>\n\n<p>Repositories look the following:</p>\n\n<pre><code>class UserInfoRepository &lt; Hanami::Repository\nend\n\nclass UserRepository &lt; Hanami::Repository\n  associations do\n    has_one :user_info\n  end\nend\n</code></pre>\n\n<p>Question: who can I join and load both tables with one query? (I am looking for something similar to Rails' <code>includes</code>).</p>\n\n<p>So far I've tried </p>\n\n<pre><code>def users_with_info\n  users.join(:user_info)\nend\n</code></pre>\n\n<p>It does the join, but does not select columns from <code>user_infos</code> table.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "elasticsearch"], "comments": [{"owner": {"reputation": 43225, "user_id": 297087, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/17b3a5816f0647e9b0f7c49d60f93e7b?s=128&d=identicon&r=PG", "display_name": "Salil", "link": "https://stackoverflow.com/users/297087/salil"}, "edited": false, "score": 1, "creation_date": 1524607423, "post_id": 50011137, "comment_id": 87039148, "body": "Please share the complete error with backtrace"}, {"owner": {"reputation": 399, "user_id": 4942371, "user_type": "registered", "profile_image": "https://graph.facebook.com/1108098145872549/picture?type=large", "display_name": "mareck_ste", "link": "https://stackoverflow.com/users/4942371/mareck-ste"}, "reply_to_user": {"reputation": 43225, "user_id": 297087, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/17b3a5816f0647e9b0f7c49d60f93e7b?s=128&d=identicon&r=PG", "display_name": "Salil", "link": "https://stackoverflow.com/users/297087/salil"}, "edited": false, "score": 0, "creation_date": 1524611532, "post_id": 50011137, "comment_id": 87040245, "body": "@Salil I&#39;ve added above a link to the trace you&#39;ve asked for."}, {"owner": {"reputation": 2031, "user_id": 670339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942f0170639d3fd6d2bd3a2ce057e3e7?s=128&d=identicon&r=PG", "display_name": "Marc Talbot", "link": "https://stackoverflow.com/users/670339/marc-talbot"}, "edited": false, "score": 0, "creation_date": 1524612230, "post_id": 50011137, "comment_id": 87040401, "body": "The stack trace says that your error is not where you think it is.  It&#39;s not in the create method, it&#39;s inside the mass_hide method."}, {"owner": {"reputation": 399, "user_id": 4942371, "user_type": "registered", "profile_image": "https://graph.facebook.com/1108098145872549/picture?type=large", "display_name": "mareck_ste", "link": "https://stackoverflow.com/users/4942371/mareck-ste"}, "reply_to_user": {"reputation": 2031, "user_id": 670339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942f0170639d3fd6d2bd3a2ce057e3e7?s=128&d=identicon&r=PG", "display_name": "Marc Talbot", "link": "https://stackoverflow.com/users/670339/marc-talbot"}, "edited": false, "score": 0, "creation_date": 1524613180, "post_id": 50011137, "comment_id": 87040617, "body": "@MarcTalbot sorry for confusing you, I had reorganized the code a bit meaning that line numbering in the trace does not comply with the line numbering of the samples provided. Here is the <a href=\"https://pasteboard.co/HiaiTEy.png\" rel=\"nofollow noreferrer\">screenshot</a> where the execution stopped."}, {"owner": {"reputation": 523, "user_id": 2817111, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99961f704b8fb737c723a0b403887949?s=128&d=identicon&r=PG", "display_name": "mikwat", "link": "https://stackoverflow.com/users/2817111/mikwat"}, "edited": false, "score": 0, "creation_date": 1524624534, "post_id": 50011137, "comment_id": 87042987, "body": "Can you print out <code>mh.query_params.inspect</code> right before you call <code>mass_hide</code>?"}, {"owner": {"reputation": 399, "user_id": 4942371, "user_type": "registered", "profile_image": "https://graph.facebook.com/1108098145872549/picture?type=large", "display_name": "mareck_ste", "link": "https://stackoverflow.com/users/4942371/mareck-ste"}, "reply_to_user": {"reputation": 523, "user_id": 2817111, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99961f704b8fb737c723a0b403887949?s=128&d=identicon&r=PG", "display_name": "mikwat", "link": "https://stackoverflow.com/users/2817111/mikwat"}, "edited": false, "score": 0, "creation_date": 1524638940, "post_id": 50011137, "comment_id": 87047706, "body": "@mikwat it has given me the output: <code>{&quot;supplier&quot;=&gt;&quot;Zariadenie pre seniorov &quot;}</code>"}], "answers": [{"comments": [{"owner": {"reputation": 399, "user_id": 4942371, "user_type": "registered", "profile_image": "https://graph.facebook.com/1108098145872549/picture?type=large", "display_name": "mareck_ste", "link": "https://stackoverflow.com/users/4942371/mareck-ste"}, "edited": false, "score": 0, "creation_date": 1524639952, "post_id": 50014866, "comment_id": 87048218, "body": "Thanks a lot ! This helped me :)"}], "tags": [], "owner": {"reputation": 20458, "user_id": 122087, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/431c64e3e3fd0c892ad2a7e4150cf63e?s=128&d=identicon&r=PG", "display_name": "Paul A Jungwirth", "link": "https://stackoverflow.com/users/122087/paul-a-jungwirth"}, "is_accepted": true, "score": 2, "last_activity_date": 1524635424, "creation_date": 1524635424, "answer_id": 50014866, "question_id": 50011137, "link": "https://stackoverflow.com/questions/50011137/ruby-on-rails-wrong-number-of-arguments-0-for-1-even-if-provided/50014866#50014866", "title": "Ruby on Rails: wrong number of arguments (0 for 1) even if provided", "body": "<p>The problem is that you have defined this helper function:</p>\n\n<pre><code>def mass_hide(query)\n</code></pre>\n\n<p>But you are calling it with zero arguments.</p>\n\n<p>First you call it with one argument, when you say <code>mass_hide(mh.query_params)</code>. That's fine.</p>\n\n<p>But then on the next line you also say <code>mass_hide.search_parameters</code>. To Ruby that means <code>mass_hide().search_parameters</code>. Perhaps you meant to write <code>mh.search_parameters</code>? I'm not sure. But <code>mass_hide</code> is the method that wants 1 param, and that's the callsite where you pass it 0.</p>\n\n<p>I hope that helps!</p>\n"}], "owner": {"reputation": 399, "user_id": 4942371, "user_type": "registered", "profile_image": "https://graph.facebook.com/1108098145872549/picture?type=large", "display_name": "mareck_ste", "link": "https://stackoverflow.com/users/4942371/mareck-ste"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 768, "favorite_count": 0, "accepted_answer_id": 50014866, "answer_count": 1, "score": 2, "last_activity_date": 1524635424, "creation_date": 1524606311, "last_edit_date": 1592644375, "question_id": 50011137, "link": "https://stackoverflow.com/questions/50011137/ruby-on-rails-wrong-number-of-arguments-0-for-1-even-if-provided", "title": "Ruby on Rails: wrong number of arguments (0 for 1) even if provided", "body": "<p>We <em>inherited a rails project</em> (the whole thing is based on elasticsearch). Thus, the application lists all the documents meeting the provided search criteria by a user. Imagine a facet or so, once you've selected i.e. a specific range of dates it gives you the documents that were created at that time.</p>\n<p>We have been currently working on expanding its functionality accordingly:</p>\n<blockquote>\n<p>Our priority is to <em><strong>utilize the elastic query</strong></em> such that <em><strong>all\nmatched</strong></em> documents by that query could be <em><strong>multiply altered</strong></em> (in\nour case, we've been trying to hide all the documents). Then we want to send the query to appropriate rake task that would take care of it.</p>\n</blockquote>\n<p>After the button responsible for mass hiding is clicked the controller's create method gets called, thereby creating a <code>mass_hiding</code> record in database (for convenience we keep a track of hidings which would allow us to revert the mass action afterwards).</p>\n<pre><code>  def create\n    mh = current_user.mass_hidings.build(params[:mass_hiding])\n    mh.save!\n    mass_hide(mh.query_params)\n    redirect_to search_documents_path(mass_hide.search_parameters)\n  end  \n\n  def mass_hide(query)\n    search = factic.create_restrictions_search(MultiJson.load(query.to_json))\n    Resque.enqueue(Document::Jobs::HideDocuments, nil, search.to_scrollable.build_query)\n  end\n</code></pre>\n<p>However, the line <strong>3</strong> of the create method <code>mass_hide(mh.query_params)</code> triggers the following exception once it gets executed:</p>\n<blockquote>\n<p>ArgumentError in Admin::MassHidingsController#create\n<em><strong>wrong number of arguments (0 for 1)</strong></em></p>\n<p><em>Full trace</em> can be found <a href=\"https://pastebin.com/mSXZRP99\" rel=\"nofollow noreferrer\"><strong>here</strong></a>.</p>\n</blockquote>\n<pre><code>Parameters:\n\n{&quot;utf8&quot;=&gt;&quot;\u2713&quot;,\n &quot;authenticity_token&quot;=&gt;&quot;6mZvRcp4HJuoBWMRToA2gPec9Wv8T82hiTJQ/STf1j/sDhQ+16mBW3QkRmhqlJIHKR0kvX/kqwQh205hp6RuDg==&quot;,\n &quot;mass_hiding&quot;=&gt;{&quot;serialized_query_params&quot;=&gt;&quot;{}&quot;,\n &quot;description&quot;=&gt;&quot;test&quot;},\n &quot;commit&quot;=&gt;&quot;Hide documents&quot;}\n</code></pre>\n<p>Further, here is the schema representation of <code>mass_hiding</code> as well as the appropriate model:</p>\n<p><strong>schema.rb</strong></p>\n<pre><code>create_table &quot;mass_hidings&quot;, force: :cascade do |t|\n    t.integer  &quot;user_id&quot;\n    t.text     &quot;serialized_query_params&quot;\n    t.string   &quot;description&quot;\n    t.datetime &quot;created_at&quot;,              null: false\n    t.datetime &quot;updated_at&quot;,              null: false\nend\n</code></pre>\n<p><strong>mass_hiding.rb</strong></p>\n<pre><code>class MassHiding &lt; ActiveRecord::Base\n  attr_accessible :serialized_query_params, :description\n  belongs_to :user\n\n  def query_params=(params)\n    self.serialized_query_params = Oj.dump(params)\n  end\n\n  def query_params\n    Oj.load(self.serialized_query_params).with_indifferent_access\n  end\n\n  def self.find_or_initialize_by_user_and_query_params(user, query_params)\n    self.find_or_initialize_by_user_id_and_serialized_query_params(user.id, Oj.dump(query_params))\n  end\nend\n</code></pre>\n<p>Thank you for your help in advance.</p>\n"}, {"tags": ["sql", "ruby-on-rails", "ruby", "postgresql", "ruby-on-rails-5"], "comments": [{"owner": {"reputation": 16229, "user_id": 525478, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3b6c0b47a0c430a0b141baee7ea845be?s=128&d=identicon&r=PG", "display_name": "Brad Werth", "link": "https://stackoverflow.com/users/525478/brad-werth"}, "edited": false, "score": 0, "creation_date": 1524607553, "post_id": 50010712, "comment_id": 87039186, "body": "<a href=\"https://github.com/pat/thinking-sphinx\" rel=\"nofollow noreferrer\">github.com/pat/thinking-sphinx</a>"}, {"owner": {"reputation": 16229, "user_id": 525478, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3b6c0b47a0c430a0b141baee7ea845be?s=128&d=identicon&r=PG", "display_name": "Brad Werth", "link": "https://stackoverflow.com/users/525478/brad-werth"}, "edited": false, "score": 0, "creation_date": 1524607633, "post_id": 50010712, "comment_id": 87039221, "body": "<a href=\"https://www.postgresql.org/docs/9.1/static/textsearch-controls.html\" rel=\"nofollow noreferrer\">postgresql.org/docs/9.1/static/textsearch-controls.html</a>"}, {"owner": {"reputation": 1088, "user_id": 3236163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f4a825085dda7d9ea059838a3d6dcd7?s=128&d=identicon&r=PG", "display_name": "elyalvarado", "link": "https://stackoverflow.com/users/3236163/elyalvarado"}, "edited": false, "score": 2, "creation_date": 1524617690, "post_id": 50010712, "comment_id": 87041511, "body": "What database are you using?"}, {"owner": {"reputation": 3320, "user_id": 4950680, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C8cEh.jpg?s=128&g=1", "display_name": "Martin Zinovsky", "link": "https://stackoverflow.com/users/4950680/martin-zinovsky"}, "edited": false, "score": 1, "creation_date": 1524629395, "post_id": 50010712, "comment_id": 87044111, "body": "If I were you I would write it in raw sql in my question and add <code>sql</code> tag so smart sql guys could come and help me out :) And specify db you are using"}], "answers": [{"comments": [{"owner": {"reputation": 1359, "user_id": 2529330, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eDQN2.jpg?s=128&g=1", "display_name": "obenda", "link": "https://stackoverflow.com/users/2529330/obenda"}, "reply_to_user": {"reputation": 2960, "user_id": 7426461, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/Ldwxy.jpg?s=128&g=1", "display_name": "Cannon Moyer", "link": "https://stackoverflow.com/users/7426461/cannon-moyer"}, "edited": false, "score": 0, "creation_date": 1524942121, "post_id": 50011515, "comment_id": 87176053, "body": "@CannonMoyer, have you seen my answer?"}], "tags": [], "owner": {"reputation": 1359, "user_id": 2529330, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eDQN2.jpg?s=128&g=1", "display_name": "obenda", "link": "https://stackoverflow.com/users/2529330/obenda"}, "is_accepted": false, "score": 1, "last_activity_date": 1524817576, "last_edit_date": 1524817576, "creation_date": 1524608572, "answer_id": 50011515, "question_id": 50010712, "link": "https://stackoverflow.com/questions/50010712/rank-query-results-rails/50011515#50011515", "title": "Rank Query Results - Rails", "body": "<p>The combination of where and or actually create a single SQL query with no \"precedence\" of the results\nYou will have to\n1. break it down to separate queries\n2. for each record found, count in how many queries it was found\n3. order your results by this counter in descending order</p>\n\n<p>Here is some code (it can be prettier):</p>\n\n<pre><code>class Customer &lt; ApplicationRecord\n    def self.relevance_search(query)\n        matches = []\n        matches &lt;&lt; Customer.where(first_name: query)\n        matches &lt;&lt; Customer.where(last_name: query)\n        matches &lt;&lt; Customer.where(email: query)\n        matches &lt;&lt; Customer.where(main_phone: query)\n\n        counter = {}\n        matches.each do |match|\n            match.each do |match_result|\n                id = match_result.id\n                if counter.key? id\n                    counter[id] += 1\n                else\n                    counter[id] = 1\n                end\n            end\n        end\n        counter.map { |id, occurrences| { relevance: 100*(occurrences/4.0), customer: Customer.find(id) } }.sort_by { |r| r[:relevance] }.reverse!\n    end\nend\n</code></pre>\n\n<p>Usage:</p>\n\n<pre><code>Customer.relevance_search [\"John\", \"Doe\", \"111-111-1111\"]\n</code></pre>\n\n<p>The return value is and array ordered by relevance in %</p>\n\n<p>Enjoy :)</p>\n"}], "owner": {"reputation": 2960, "user_id": 7426461, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/Ldwxy.jpg?s=128&g=1", "display_name": "Cannon Moyer", "link": "https://stackoverflow.com/users/7426461/cannon-moyer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1524817576, "creation_date": 1524603953, "last_edit_date": 1524661904, "question_id": 50010712, "link": "https://stackoverflow.com/questions/50010712/rank-query-results-rails", "title": "Rank Query Results - Rails", "body": "<p>I've got the following query that searches my customer database and does so successfully:</p>\n\n<pre><code>SELECT  \"customers\".* FROM \"customers\" WHERE (((\"customers\".\"first_name\" IN ('John', 'Doe') OR \"customers\".\"last_name\" IN ('John', 'Doe')) OR \"customers\".\"email\" IN ('John', 'Doe')) OR \"customers\".\"main_phone\" IN ('John', 'Doe'))\n</code></pre>\n\n<p>The equivalent Rails query is:</p>\n\n<pre><code>array = [\"John\",\"Doe\",\"111-111-1111\"]\n\nCustomer.where(first_name: array).or(customers.where(last_name: array)).or(customers.where(email: array)).or(customers.where(main_phone: array))\n</code></pre>\n\n<p>This works fine, however I am wanting to rank the results. For example, if record # 1 matches for both first and last name, I want that record to display at the top of my results. How could I do this?</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1524601059, "post_id": 50010063, "comment_id": 87036869, "body": "These other stackoverflow questions should get you started:  <a href=\"https://stackoverflow.com/questions/27306879/merging-hash-values-in-an-array-of-hashes-based-on-key\" title=\"merging hash values in an array of hashes based on key\">stackoverflow.com/questions/27306879/&hellip;</a> , <a href=\"https://stackoverflow.com/questions/24233493/merge-duplicates-in-array-of-hashes\" title=\"merge duplicates in array of hashes\">stackoverflow.com/questions/24233493/&hellip;</a> , <a href=\"https://stackoverflow.com/questions/2871323/ruby-merge-two-hash-as-one-and-with-value-connected\" title=\"ruby merge two hash as one and with value connected\">stackoverflow.com/questions/2871323/&hellip;</a> , <a href=\"https://stackoverflow.com/questions/24916479/rails-ruby-merge-two-hashes-with-same-key-different-values\" title=\"rails ruby merge two hashes with same key different values\">stackoverflow.com/questions/24916479/&hellip;</a>"}, {"owner": {"reputation": 2048, "user_id": 1268652, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/CO9Tz.jpg?s=128&g=1", "display_name": "Pascal Raszyk", "link": "https://stackoverflow.com/users/1268652/pascal-raszyk"}, "edited": false, "score": 0, "creation_date": 1524601106, "post_id": 50010063, "comment_id": 87036889, "body": "From a quick glance you can use <code>Enumerable#reduce</code> for this task: <a href=\"https://ruby-doc.org/core-2.2.3/Enumerable.html#method-i-reduce\" rel=\"nofollow noreferrer\">ruby-doc.org/core-2.2.3/Enumerable.html#method-i-reduce</a>"}, {"owner": {"reputation": 3, "user_id": 9693107, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-PKaA7hEB604/AAAAAAAAAAI/AAAAAAAAAB4/Ze2izyIUPYg/photo.jpg?sz=128", "display_name": "John", "link": "https://stackoverflow.com/users/9693107/john"}, "edited": false, "score": 0, "creation_date": 1524608190, "post_id": 50010063, "comment_id": 87039386, "body": "Hi, yes that was a mistake. I have corrected the formatted cars array in the question to have the correct values. Thanks :)"}, {"owner": {"reputation": 17357, "user_id": 794242, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/e871d15815cfef926f21737a5ccd30c4?s=128&d=identicon&r=PG", "display_name": "Wand Maker", "link": "https://stackoverflow.com/users/794242/wand-maker"}, "edited": false, "score": 0, "creation_date": 1524628431, "post_id": 50010063, "comment_id": 87043861, "body": "formatted_cars is still not valid ruby value."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 9693107, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-PKaA7hEB604/AAAAAAAAAAI/AAAAAAAAAB4/Ze2izyIUPYg/photo.jpg?sz=128", "display_name": "John", "link": "https://stackoverflow.com/users/9693107/john"}, "edited": false, "score": 0, "creation_date": 1524611084, "post_id": 50011698, "comment_id": 87040143, "body": "Thanks for the answer, yes basically the data type has to be odd because the formatted_cars array is used to populate a a select field in react form. :)"}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "reply_to_user": {"reputation": 3, "user_id": 9693107, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-PKaA7hEB604/AAAAAAAAAAI/AAAAAAAAAB4/Ze2izyIUPYg/photo.jpg?sz=128", "display_name": "John", "link": "https://stackoverflow.com/users/9693107/john"}, "edited": false, "score": 1, "creation_date": 1524637471, "post_id": 50011698, "comment_id": 87046862, "body": "@John If he has answered your question, please consider accepting his answer, there is tic in the left top, you need to click, after clicking that button, it will become green colour."}, {"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "reply_to_user": {"reputation": 3, "user_id": 9693107, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-PKaA7hEB604/AAAAAAAAAAI/AAAAAAAAAB4/Ze2izyIUPYg/photo.jpg?sz=128", "display_name": "John", "link": "https://stackoverflow.com/users/9693107/john"}, "edited": false, "score": 0, "creation_date": 1524644990, "post_id": 50011698, "comment_id": 87051126, "body": "@John I would still suggest using some well-structured model like the above, and generating the necessary &quot;React JSON&quot; format as a separate method. If this is a rails application, you could do this via a standard serializer; or if we&#39;re doing this in plain ruby objects then how about: <code>class CarMake; def to_json; {name: name, value: models.map(&amp;:name)}; end; end</code> ... Although my point still stands that you&#39;ve got a rather muddled up naming convention between <code>model</code> (should be &quot;make&quot;!), <code>type</code> (should be &quot;model&quot;) and <code>value</code> (should be &quot;makes&quot;)."}], "tags": [], "owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "is_accepted": true, "score": 4, "last_activity_date": 1524609804, "creation_date": 1524609804, "answer_id": 50011698, "question_id": 50010063, "link": "https://stackoverflow.com/questions/50010063/how-do-i-format-an-array-of-objects-with-ruby/50011698#50011698", "title": "How do I format an array of objects with ruby?", "body": "<p>There are many ways to do this. Here is one;</p>\n\n<pre><code>cars = [\n  {model: 'nissan', type: 'wingroad'},\n  {model: 'nissan', type: 'sunny'},\n  {model: 'nissan', type: 'terrano'},\n  {model: 'toyota', type: 'hilux'}\n]\n\ncars\n  .group_by { |car| car[:model] }\n  .map { |model, cars| {name: model, value: cars.map { |car| car[:type] }} }\n</code></pre>\n\n<p>...However, why are you starting with such an odd data format, and aiming to finish with another odd data format? (By \"odd\", I basically mean relying on an array of hashes of arrays to store the data.)</p>\n\n<p>There <em>may</em> be a good reason for this (e.g. integration with a 3rd party API), but otherwise I would suggest making this somehow more object-oriented and using classes to define the make/model of the cars. For example, perhaps something like:</p>\n\n<pre><code># e.g. Nissan\nclass CarMake\n  attr_reader :name, :models\n  def initialize(name)\n    @name = name\n    @models = []\n  end\n\n  def add_model(name)\n    model = CarModel.new(name)\n    @models &lt;&lt; model\n    model.make = self\n  end\nend\n\n# e.g. WingRoad\nclass CarModel\n  attr_reader :name\n  attr_accessor :make\n  def initialize(name)\n    @name = name\n  end\nend\n\n# Assuming we still need to start with this data structure!\ncars = [\n  {model: 'nissan', type: 'wingroad'},\n  {model: 'nissan', type: 'sunny'},\n  {model: 'nissan', type: 'terrano'},\n  {model: 'toyota', type: 'hilux'}\n]\n\ncar_makes = {}\ncars.each do |car|\n  car_makes[car[:model]] ||= CarMake.new(car[:model])\n  car_makes[car[:model]].add_model(car[:type])\nend\n</code></pre>\n\n<p>This is just one of many possible ways to organise the code, and although it may be a little more complex to understand at first, the resulting data structure is much more useful:</p>\n\n<pre><code>car_makes\n=&gt; {\"nissan\"=&gt;\n  #&lt;CarMake:0x00007ff2ee44ad20\n   @models=\n    [#&lt;CarModel:0x00007ff2ee44aca8 @make=#&lt;CarMake:0x00007ff2ee44ad20 ...&gt;, @name=\"wingroad\"&gt;,\n     #&lt;CarModel:0x00007ff2ee44ac80 @make=#&lt;CarMake:0x00007ff2ee44ad20 ...&gt;, @name=\"sunny\"&gt;,\n     #&lt;CarModel:0x00007ff2ee44ac58 @make=#&lt;CarMake:0x00007ff2ee44ad20 ...&gt;, @name=\"terrano\"&gt;],\n   @name=\"nissan\"&gt;,\n \"toyota\"=&gt;#&lt;CarMake:0x00007ff2ee44ac30 @models=[#&lt;CarModel:0x00007ff2ee44ab68 @make=#&lt;CarMake:0x00007ff2ee44ac30 ...&gt;, @name=\"hilux\"&gt;], @name=\"toyota\"&gt;}\n\ncar_makes['nissan'].models\n=&gt; [#&lt;CarModel:0x00007ff2ee44aca8 @make=#&lt;CarMake:0x00007ff2ee44ad20 @models=[...], @name=\"nissan\"&gt;, @name=\"wingroad\"&gt;,\n #&lt;CarModel:0x00007ff2ee44ac80 @make=#&lt;CarMake:0x00007ff2ee44ad20 @models=[...], @name=\"nissan\"&gt;, @name=\"sunny\"&gt;,\n #&lt;CarModel:0x00007ff2ee44ac58 @make=#&lt;CarMake:0x00007ff2ee44ad20 @models=[...], @name=\"nissan\"&gt;, @name=\"terrano\"&gt;]\n\ncar_makes['nissan'].models.first\n=&gt; #&lt;CarModel:0x00007ff2ee44aca8\n @make=\n  #&lt;CarMake:0x00007ff2ee44ad20\n   @models=\n    [#&lt;CarModel:0x00007ff2ee44aca8 ...&gt;,\n     #&lt;CarModel:0x00007ff2ee44ac80 @make=#&lt;CarMake:0x00007ff2ee44ad20 ...&gt;, @name=\"sunny\"&gt;,\n     #&lt;CarModel:0x00007ff2ee44ac58 @make=#&lt;CarMake:0x00007ff2ee44ad20 ...&gt;, @name=\"terrano\"&gt;],\n   @name=\"nissan\"&gt;,\n @name=\"wingroad\"&gt;\n\ncar_makes['nissan'].models.first.make\n=&gt; #&lt;CarMake:0x00007ff2ee44ad20\n @models=\n  [#&lt;CarModel:0x00007ff2ee44aca8 @make=#&lt;CarMake:0x00007ff2ee44ad20 ...&gt;, @name=\"wingroad\"&gt;,\n   #&lt;CarModel:0x00007ff2ee44ac80 @make=#&lt;CarMake:0x00007ff2ee44ad20 ...&gt;, @name=\"sunny\"&gt;,\n   #&lt;CarModel:0x00007ff2ee44ac58 @make=#&lt;CarMake:0x00007ff2ee44ad20 ...&gt;, @name=\"terrano\"&gt;],\n @name=\"nissan\"&gt;\n</code></pre>\n\n<p>...And so on. We now have a <em>structured</em> data, instead of just arbitrary (and mis-named!) mixes of arrays and hashes that are messy to manipulate.</p>\n"}, {"tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": false, "score": 0, "last_activity_date": 1524621151, "creation_date": 1524621151, "answer_id": 50012932, "question_id": 50010063, "link": "https://stackoverflow.com/questions/50010063/how-do-i-format-an-array-of-objects-with-ruby/50012932#50012932", "title": "How do I format an array of objects with ruby?", "body": "<pre><code>cars = [{model: 'nissan', type: 'wingroad'},\n        {model: 'nissan', type: 'sunny'},\n        {model: 'nissan', type: 'terrano'},\n        {model: 'toyota', type: 'hilux'}]\n\ncars.each_with_object({}) { |g,h| (h[g[:model]] ||= []) &lt;&lt; g[:type] }.\n     map { |k,v| { model:k, type:v } }\n  #=&gt; [{:model=&gt;\"nissan\", :type=&gt;[\"wingroad\", \"sunny\", \"terrano\"]},\n  #    {:model=&gt;\"toyota\", :type=&gt;[\"hilux\"]}]\n</code></pre>\n\n<p>Note that</p>\n\n<pre><code>cars.each_with_object({}) { |g,h| (h[g[:model]] ||= []) &lt;&lt; g[:type] }\n  #=&gt; {\"nissan\"=&gt;[\"wingroad\", \"sunny\", \"terrano\"], \"toyota\"=&gt;[\"hilux\"]}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6679, "user_id": 7117003, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HaW1a.png?s=128&g=1", "display_name": "petezurich", "link": "https://stackoverflow.com/users/7117003/petezurich"}, "edited": false, "score": 1, "creation_date": 1524637515, "post_id": 50014744, "comment_id": 87046895, "body": "Please make this a full answer, not just a code answer with no explanation."}, {"owner": {"reputation": 3, "user_id": 9693107, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-PKaA7hEB604/AAAAAAAAAAI/AAAAAAAAAB4/Ze2izyIUPYg/photo.jpg?sz=128", "display_name": "John", "link": "https://stackoverflow.com/users/9693107/john"}, "edited": false, "score": 0, "creation_date": 1525036402, "post_id": 50014744, "comment_id": 87198909, "body": "Thanks for the attempt but the answer is not returned in the correct format, it is supposed to be nested in an array.   [{name: &#39;nissan&#39;, value: [&#39;wingroad&#39;, &#39;sunny&#39;, &#39;terrano&#39;]}, {name: &#39;toyota&#39;, value: [&#39;hilux&#39;]}]"}], "tags": [], "owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "is_accepted": false, "score": 0, "last_activity_date": 1524637766, "last_edit_date": 1524637766, "creation_date": 1524634812, "answer_id": 50014744, "question_id": 50010063, "link": "https://stackoverflow.com/questions/50010063/how-do-i-format-an-array-of-objects-with-ruby/50014744#50014744", "title": "How do I format an array of objects with ruby?", "body": "<p>Yes, there is, as follows:</p>\n\n<pre><code>cars.group_by{|h| h[:model]}.transform_values{|v| v.map{|h| h[:type]}}\n#=&gt; {\"nissan\"=&gt;[\"wingroad\", \"sunny\", \"terrano\"], \"toyota\"=&gt;[\"hilux\"]}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 9693107, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-PKaA7hEB604/AAAAAAAAAAI/AAAAAAAAAB4/Ze2izyIUPYg/photo.jpg?sz=128", "display_name": "John", "link": "https://stackoverflow.com/users/9693107/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1369, "favorite_count": 0, "accepted_answer_id": 50011698, "answer_count": 3, "score": 0, "last_activity_date": 1524637766, "creation_date": 1524600765, "last_edit_date": 1524631638, "question_id": 50010063, "link": "https://stackoverflow.com/questions/50010063/how-do-i-format-an-array-of-objects-with-ruby", "title": "How do I format an array of objects with ruby?", "body": "<p>I am a bit lost on how to format this array of objects.  </p>\n\n<p>Initial array:</p>\n\n<pre><code>cars = [{model: 'nissan', type: 'wingroad'},{model: 'nissan', type: 'sunny'},{model: 'nissan', type: 'terrano'},{model: 'toyota', type: 'hilux'}]\n</code></pre>\n\n<p>Expected Output:</p>\n\n<pre><code>formatted_cars = [{name: 'nissan', value: ['wingroad', 'sunny', 'terrano']}, {name: 'toyota', value: ['hilux']\n</code></pre>\n\n<p>Would I map over the results and apply an inject then apply some cunning merge techniques for that formatted array. Or is there another way to go about it? </p>\n\n<p>I am new to ruby and would love any help, thanks :)</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "scaffolding"], "comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 1, "creation_date": 1524599527, "post_id": 50009714, "comment_id": 87036173, "body": "That is not really the purpose of scaffolding you could just generate the controllers and the views though <code>rails g controller Admin::Locations new create edit index destroy</code> You will have to add the appropriate routes though."}, {"owner": {"reputation": 1027, "user_id": 7172464, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mxB5X.jpg?s=128&g=1", "display_name": "Nino", "link": "https://stackoverflow.com/users/7172464/nino"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1524599922, "post_id": 50009714, "comment_id": 87036348, "body": "@engineersmnky I was looking for a lazy-way to create the views, but I guess I could this and just copy paste the views from a blank CRUD project"}, {"owner": {"reputation": 1027, "user_id": 7172464, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mxB5X.jpg?s=128&g=1", "display_name": "Nino", "link": "https://stackoverflow.com/users/7172464/nino"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1524600358, "post_id": 50009714, "comment_id": 87036543, "body": "They won&#39;t have content, only the default notice <code>&lt;h1&gt;Admin::Locations#index&lt;&#47;h1&gt;....</code>"}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1524600676, "post_id": 50009714, "comment_id": 87036692, "body": "Very true but scaffolded views are extremely simplistic with the intention of them being modified"}], "answers": [{"comments": [{"owner": {"reputation": 131, "user_id": 374513, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/625e99cca23b3893a070c84dc3b0ac13?s=128&d=identicon&r=PG", "display_name": "life_like_weeds", "link": "https://stackoverflow.com/users/374513/life-like-weeds"}, "edited": false, "score": 1, "creation_date": 1588087816, "post_id": 50010204, "comment_id": 108762522, "body": "The Rails way to do this is with <code>rails g scaffold_controller Admin::Locations --model-name=Location</code>"}], "tags": [], "owner": {"reputation": 1027, "user_id": 7172464, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mxB5X.jpg?s=128&g=1", "display_name": "Nino", "link": "https://stackoverflow.com/users/7172464/nino"}, "is_accepted": true, "score": 0, "last_activity_date": 1524601384, "creation_date": 1524601384, "answer_id": 50010204, "question_id": 50009714, "link": "https://stackoverflow.com/questions/50009714/create-a-scaffold-with-custom-namespace-and-existing-model/50010204#50010204", "title": "Create a scaffold with custom namespace and existing model", "body": "<p>As suggested by @engineersmnky the best way to do this is :</p>\n\n<pre><code>rails g controller Admin::Locations new create edit index destroy\n</code></pre>\n\n<p>Then I suggest to create a blank rails project and do :</p>\n\n<pre><code>rails g scaffold Admin::Location\n</code></pre>\n\n<p>After this you can replace views by the ones generated on the newly created app (<code>/app/views/admin/locations</code>)</p>\n\n<p>Maybe there is a better solution, I would love to know if it's the case !</p>\n"}], "owner": {"reputation": 1027, "user_id": 7172464, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mxB5X.jpg?s=128&g=1", "display_name": "Nino", "link": "https://stackoverflow.com/users/7172464/nino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 427, "favorite_count": 0, "accepted_answer_id": 50010204, "answer_count": 1, "score": 0, "last_activity_date": 1524601384, "creation_date": 1524599258, "question_id": 50009714, "link": "https://stackoverflow.com/questions/50009714/create-a-scaffold-with-custom-namespace-and-existing-model", "title": "Create a scaffold with custom namespace and existing model", "body": "<p>I want to generate scaffold with a custom namespace but I want it to use an existing model/table.</p>\n\n<p>If I generate a scaffold like this it generate scaffold with a custom namespace but use a new table <code>admin_locations</code> :</p>\n\n<pre><code>rails generate scaffold Admin::Location\n</code></pre>\n\n<p>Is there a way to do the same thing but using the existing <code>Location</code> model and <code>locations</code> table ?</p>\n"}, {"tags": ["javascript", "css", "ruby-on-rails", "ruby", "html-table"], "answers": [{"tags": [], "owner": {"reputation": 1203, "user_id": 142846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/beae3c4b7d0869b9dcd329406d936c1a?s=128&d=identicon&r=PG", "display_name": "Jim Kane", "link": "https://stackoverflow.com/users/142846/jim-kane"}, "is_accepted": false, "score": 0, "last_activity_date": 1524592562, "creation_date": 1524592562, "answer_id": 50008049, "question_id": 50007675, "link": "https://stackoverflow.com/questions/50007675/javascript-ability-to-customize-table-columns-a-button-that-allows-users-to-rem/50008049#50008049", "title": "Javascript ability to customize table columns. A button that allows users to remove and add new columns", "body": "<p>I suggest that you investigate using the <a href=\"https://www.datatables.net/\" rel=\"nofollow noreferrer\">DataTables</a> jQuery plugin. While it may not bet the ultimate scalable solution, it's much quicker to get started and figure out whether the feature is something your users want. Specifically, there is a <a href=\"https://www.datatables.net/extensions/buttons/\" rel=\"nofollow noreferrer\">buttons</a> DataTables extension that allows end users to modify the table on-page. If you need to persist the user's preferences you may have to write that part yourself.</p>\n"}, {"comments": [{"owner": {"reputation": 47, "user_id": 3422743, "user_type": "registered", "profile_image": "https://graph.facebook.com/791875706/picture?type=large", "display_name": "apuente", "link": "https://stackoverflow.com/users/3422743/apuente"}, "edited": false, "score": 0, "creation_date": 1524598048, "post_id": 50008767, "comment_id": 87035425, "body": "This should definitely get me started. I will try this when I get home! Thanks! Could you maybe add to your fiddle. Like some links that represent new columns, and when you click on those, they appear in the table."}], "tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": true, "score": 1, "last_activity_date": 1524597047, "last_edit_date": 1524597047, "creation_date": 1524595334, "answer_id": 50008767, "question_id": 50007675, "link": "https://stackoverflow.com/questions/50007675/javascript-ability-to-customize-table-columns-a-button-that-allows-users-to-rem/50008767#50008767", "title": "Javascript ability to customize table columns. A button that allows users to remove and add new columns", "body": "<p>If you want a more comprehensive solution, I would also recommend <a href=\"https://datatables.net/examples/api/show_hide.html\" rel=\"nofollow noreferrer\">jQuery DataTables see this for ideas</a></p>\n\n<p>The hide part can be done easily with basic html, css, and jquery. Maybe this is enough to give you some idea how to do what you're trying to.  For this example I'm just using a very simple table.</p>\n\n<pre><code>&lt;style&gt;\n  .hidden {\n  display: none;\n}\n&lt;/style&gt;\n\n&lt;table&gt;\n  &lt;tr class=\"header_row\"&gt;\n    &lt;td class=\"column1\", id=\"column1\"&gt;col1&lt;/td&gt;\n    &lt;td class=\"column2\", id=\"column2\"&gt;col2&lt;/td&gt;\n    &lt;td class=\"column3\", id=\"column3\"&gt;col3&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td class=\"column1\"&gt;col 1 stuff&lt;/td&gt;\n    &lt;td class=\"column2\"&gt;col 2 stuff&lt;/td&gt;\n    &lt;td class=\"column3\"&gt;col 3 stuff&lt;/td&gt;\n  &lt;/tr&gt;\n&lt;/table&gt;\n\n&lt;script&gt;\n  $('tr td').click(function(){\n    var toggleId = this.id;\n    $('.'+toggleId).toggleClass('hidden');\n  });\n&lt;/script&gt;\n</code></pre>\n\n<p>See working bare bones example: <a href=\"https://jsfiddle.net/a4rwgtdh/\" rel=\"nofollow noreferrer\">https://jsfiddle.net/a4rwgtdh/</a></p>\n"}], "owner": {"reputation": 47, "user_id": 3422743, "user_type": "registered", "profile_image": "https://graph.facebook.com/791875706/picture?type=large", "display_name": "apuente", "link": "https://stackoverflow.com/users/3422743/apuente"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 50008767, "answer_count": 2, "score": 0, "last_activity_date": 1524597421, "creation_date": 1524591051, "last_edit_date": 1524597421, "question_id": 50007675, "link": "https://stackoverflow.com/questions/50007675/javascript-ability-to-customize-table-columns-a-button-that-allows-users-to-rem", "title": "Javascript ability to customize table columns. A button that allows users to remove and add new columns", "body": "<p>I would like to make my table customizable. I'm looking for the ability to add new columns and remove existing columns. For visualizing what I want to do, here is my site: <a href=\"https://www.coinmarketstreet.com/\" rel=\"nofollow noreferrer\">https://www.coinmarketstreet.com/</a>. I would like to add a button that allows users to change the layout of the table. For example, if a user wants to remove the Dominance column and display a Price BTC column, he has the ability of doing so with the click of a button.</p>\n\n<p>Here is my HTML table:</p>\n\n<pre><code>&lt;table class=\"table coin_table\"&gt;\n    &lt;tr class=\"header_row\"&gt;\n      &lt;th&gt;&lt;%= sortable \"rank\", \"#\" %&gt;&lt;/th&gt;\n      &lt;th class=\"text-center\"&gt;Symbol&lt;/th&gt;\n      &lt;th class=\"text-center\"&gt;&lt;%= sortable \"name\", \"Coin\" %&gt;&lt;/th&gt;\n      &lt;th class=\"text-center\"&gt;&lt;%= sortable \"price\", \"Price\" %&gt;&lt;/th&gt;\n      &lt;th class=\"text-center\"&gt;&lt;%= sortable \"percent_change_1h\", \"Change(1Hr)\" %&gt;&lt;/th&gt;\n      &lt;th class=\"text-center\"&gt;&lt;%= sortable \"change_24hr\", \"Change(24Hr)\" %&gt;&lt;/th&gt;\n      &lt;th class=\"text-center\"&gt;&lt;%= sortable \"percent_change_7d\", \"Change(7D)\" %&gt;&lt;/i&gt;&lt;/th&gt;\n      &lt;th class=\"text-center\"&gt;&lt;%= sortable \"market_cap\", \"Market Cap\" %&gt;&lt;/th&gt;\n      &lt;th class=\"text-center\"&gt;&lt;%= sortable \"volume_24hr\", \"24 Hr Volume\" %&gt;&lt;/th&gt;\n      &lt;th class=\"text-center\"&gt;&lt;%= sortable \"current_supply\", \"Current Supply\" %&gt;&lt;/th&gt;\n      &lt;th class=\"text-center\"&gt;Dominance&lt;/th&gt;\n    &lt;/tr&gt;\n\n    &lt;% @cryptos.each do |crypto| %&gt;\n      &lt;tr class=\"text-center\" data-link=\"&lt;%= crypto_path(crypto.id) %&gt;\"&gt;\n        &lt;th class=\"column_1\"&gt;&lt;%= crypto.rank %&gt;&lt;/th&gt;\n          &lt;td&gt;&lt;div&gt;&lt;%= fetch_image_tag(crypto.symbol, :width =&gt; 50, :height =&gt; 50, :crop =&gt; :fill) %&gt;&lt;/div&gt;&lt;/td&gt;\n        &lt;td class = \"center_style2\"&gt;&lt;div&gt;&lt;%= crypto.name %&gt;&lt;/div&gt;&lt;div&gt;(&lt;%= crypto.nick_name %&gt;)&lt;/div&gt;&lt;/td&gt;\n\n        &lt;% if crypto.price == nil %&gt;\n           &lt;td class=\"center_style\"&gt;?&lt;/td&gt;\n        &lt;% else %&gt;\n            &lt;% if crypto.price &lt; 1 %&gt;\n              &lt;td class=\"center_style\"&gt;&lt;%= convert_number_currency(crypto.price, cookies[:selected_currency], 6) %&gt;&lt;/td&gt;\n            &lt;% else %&gt;\n              &lt;td class=\"center_style\"&gt;&lt;%= convert_number_currency(crypto.price, cookies[:selected_currency], 2) %&gt;&lt;/td&gt;\n            &lt;% end %&gt;\n        &lt;% end %&gt;\n\n        &lt;% if crypto.percent_change_1h == nil %&gt;\n          &lt;td class = \"center_style\"&gt;?&lt;/td&gt;\n        &lt;% else %&gt;\n          &lt;% if crypto.percent_change_1h &lt; 0 %&gt;\n            &lt;td class=\"percent_change down center_style\"&gt;&lt;%= number_to_percentage(crypto.percent_change_1h, precision: 2) %&gt;&lt;/td&gt;\n          &lt;% else %&gt;\n            &lt;td class=\"percent_change up center_style\"&gt;&lt;%= number_to_percentage(crypto.percent_change_1h, precision: 2) %&gt;&lt;/td&gt;\n          &lt;% end %&gt;\n        &lt;% end %&gt;\n\n        &lt;% if crypto.change_24hr == nil %&gt;\n          &lt;td class = \"center_style\"&gt;?&lt;/td&gt;\n        &lt;% else %&gt;\n          &lt;% if crypto.change_24hr &lt; 0 %&gt;\n            &lt;td class=\"percent_change down center_style\"&gt;&lt;%= number_to_percentage(crypto.change_24hr, precision: 2) %&gt;&lt;/td&gt;\n          &lt;% else %&gt;\n            &lt;td class=\"percent_change up center_style\"&gt;&lt;%= number_to_percentage(crypto.change_24hr, precision: 2) %&gt;&lt;/td&gt;\n          &lt;% end %&gt;\n        &lt;% end %&gt;\n\n        &lt;% if crypto.percent_change_7d == nil %&gt;\n          &lt;td class = \"center_style\"&gt;?&lt;/td&gt;\n        &lt;% else %&gt;\n          &lt;% if crypto.percent_change_7d &lt; 0 %&gt;\n            &lt;td class=\"percent_change down center_style\"&gt;&lt;%= number_to_percentage(crypto.percent_change_7d, precision: 2) %&gt;&lt;/td&gt;\n          &lt;% else %&gt;\n            &lt;td class=\"percent_change up center_style\"&gt;&lt;%= number_to_percentage(crypto.percent_change_7d, precision: 2) %&gt;&lt;/td&gt;\n          &lt;% end %&gt;\n        &lt;% end %&gt;\n\n        &lt;% if crypto.market_cap == nil %&gt;\n          &lt;td class = \"center_style\"&gt;?&lt;/td&gt;\n        &lt;% else %&gt;\n          &lt;td class = \"center_style\"&gt;&lt;%= convert_number_currency(crypto.market_cap, cookies[:selected_currency], 0) %&gt;&lt;/td&gt;\n        &lt;% end %&gt;\n\n        &lt;% if crypto.volume_24hr == nil %&gt;\n          &lt;td class=\"center_style\"&gt;$0&lt;/td&gt;\n        &lt;% else %&gt;\n          &lt;td class=\"center_style\"&gt;&lt;%= convert_number_currency(crypto.volume_24hr, cookies[:selected_currency], 0) %&gt;&lt;/td&gt;\n        &lt;% end %&gt;\n\n        &lt;% if crypto.current_supply == nil %&gt;\n          &lt;td class=\"center_style\"&gt;?&lt;/td&gt;\n        &lt;% else %&gt;\n          &lt;td class=\"center_style\"&gt;&lt;%= number_with_delimiter(crypto.current_supply, :delimiter =&gt; ',') + \" \" + crypto.nick_name %&gt;&lt;/td&gt;\n        &lt;% end %&gt;\n        &lt;td class=\"center_style\"&gt;&lt;%= number_to_percentage((crypto.market_cap / @market_cap_sum) * 100, precision: 2) %&gt;&lt;/td&gt;\n      &lt;/tr&gt;\n    &lt;% end %&gt;\n&lt;/table&gt;\n</code></pre>\n\n<p>I have not been able to find an easy guide to do this, so if I could be pointed to the right direction it would be greatly appreciated. Also, a simple code example on how to do this would be even more appreciated!</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "postgresql"], "comments": [{"owner": {"reputation": 2390, "user_id": 4812050, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/hzLjT.jpg?s=128&g=1", "display_name": "Cruz Nunez", "link": "https://stackoverflow.com/users/4812050/cruz-nunez"}, "edited": false, "score": 0, "creation_date": 1524586768, "post_id": 50006408, "comment_id": 87029488, "body": "If your <code>param[:created_at]</code> is correct, you shouldn&#39;t have to do anything to it. Maybe give us some more example code and we can help."}, {"owner": {"reputation": 1230, "user_id": 511203, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ec96aadd672b8056173e4e8a5225d8b?s=128&d=identicon&r=PG", "display_name": "Mike Gorski", "link": "https://stackoverflow.com/users/511203/mike-gorski"}, "edited": false, "score": 1, "creation_date": 1524587522, "post_id": 50006408, "comment_id": 87029901, "body": "Your error message says <code>order_date</code> but the example code uses <code>created_at</code> - which one are you having problems with? In rails, the <code>created_at</code> and <code>updated_at</code> are set automatically - you don&#39;t have to do anything with them."}, {"owner": {"reputation": 167, "user_id": 7947672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6d91daf5ab8d9caa18f4152d524236d?s=128&d=identicon&r=PG&f=1", "display_name": "zhu chen", "link": "https://stackoverflow.com/users/7947672/zhu-chen"}, "edited": false, "score": 0, "creation_date": 1524588301, "post_id": 50006408, "comment_id": 87030322, "body": "Please see post again for more codes. Very bad at this. Thanks again!"}, {"owner": {"reputation": 1230, "user_id": 511203, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ec96aadd672b8056173e4e8a5225d8b?s=128&d=identicon&r=PG", "display_name": "Mike Gorski", "link": "https://stackoverflow.com/users/511203/mike-gorski"}, "edited": false, "score": 0, "creation_date": 1524590329, "post_id": 50006408, "comment_id": 87031420, "body": "Can you share the form or front end that is passing in the <code>created_at</code> param?"}, {"owner": {"reputation": 167, "user_id": 7947672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6d91daf5ab8d9caa18f4152d524236d?s=128&d=identicon&r=PG&f=1", "display_name": "zhu chen", "link": "https://stackoverflow.com/users/7947672/zhu-chen"}, "edited": false, "score": 0, "creation_date": 1524592258, "post_id": 50006408, "comment_id": 87032363, "body": "<code>module.exports = function(payload, actions) {        let createdDate = payload.created_at.split(&quot;T&quot;)[0].toString();   return actions.http.post(process.env.DATABASE_URL, {created_at: createdDate}).then(({ data }) =&gt; {     console.log(&#39;data is &#39;, data)   }) }</code>"}], "answers": [{"comments": [{"owner": {"reputation": 167, "user_id": 7947672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6d91daf5ab8d9caa18f4152d524236d?s=128&d=identicon&r=PG&f=1", "display_name": "zhu chen", "link": "https://stackoverflow.com/users/7947672/zhu-chen"}, "edited": false, "score": 0, "creation_date": 1524588237, "post_id": 50006648, "comment_id": 87030282, "body": "It shouldn&#39;t be, but the error I am getting back says it is an integer type. The data I am looking at on my terminal/logs shows it as string. Please see post again for my edits and more codes"}, {"owner": {"reputation": 167, "user_id": 7947672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6d91daf5ab8d9caa18f4152d524236d?s=128&d=identicon&r=PG&f=1", "display_name": "zhu chen", "link": "https://stackoverflow.com/users/7947672/zhu-chen"}, "edited": false, "score": 0, "creation_date": 1524592604, "post_id": 50006648, "comment_id": 87032573, "body": "Tried your method, it is still returning the following error. (PG::DatatypeMismatch: ERROR:  column &quot;order_date&quot; is of type date but expression is of type integer"}, {"owner": {"reputation": 13, "user_id": 7402378, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/--ZRfXgn_M1s/AAAAAAAAAAI/AAAAAAAAAGg/OYxm3fgwa84/photo.jpg?sz=128", "display_name": "neymar sabin", "link": "https://stackoverflow.com/users/7402378/neymar-sabin"}, "reply_to_user": {"reputation": 167, "user_id": 7947672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6d91daf5ab8d9caa18f4152d524236d?s=128&d=identicon&r=PG&f=1", "display_name": "zhu chen", "link": "https://stackoverflow.com/users/7947672/zhu-chen"}, "edited": false, "score": 0, "creation_date": 1524593539, "post_id": 50006648, "comment_id": 87033092, "body": "What is the class of <code>params[:created_at]</code> ? Use <code>binding.pry</code> in the create method and determine class of <code>params[:created_at]</code>."}, {"owner": {"reputation": 167, "user_id": 7947672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6d91daf5ab8d9caa18f4152d524236d?s=128&d=identicon&r=PG&f=1", "display_name": "zhu chen", "link": "https://stackoverflow.com/users/7947672/zhu-chen"}, "edited": false, "score": 0, "creation_date": 1524593713, "post_id": 50006648, "comment_id": 87033186, "body": "I think I figure out what my problem is. I shouldn&#39;t be using intepolation with sql queries."}, {"owner": {"reputation": 13, "user_id": 7402378, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/--ZRfXgn_M1s/AAAAAAAAAAI/AAAAAAAAAGg/OYxm3fgwa84/photo.jpg?sz=128", "display_name": "neymar sabin", "link": "https://stackoverflow.com/users/7402378/neymar-sabin"}, "reply_to_user": {"reputation": 167, "user_id": 7947672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6d91daf5ab8d9caa18f4152d524236d?s=128&d=identicon&r=PG&f=1", "display_name": "zhu chen", "link": "https://stackoverflow.com/users/7947672/zhu-chen"}, "edited": false, "score": 0, "creation_date": 1524593926, "post_id": 50006648, "comment_id": 87033302, "body": "I don&#39;t understand why you are writing sql statements ? Stringify params before sending could also solve your problem."}], "tags": [], "owner": {"reputation": 13, "user_id": 7402378, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/--ZRfXgn_M1s/AAAAAAAAAAI/AAAAAAAAAGg/OYxm3fgwa84/photo.jpg?sz=128", "display_name": "neymar sabin", "link": "https://stackoverflow.com/users/7402378/neymar-sabin"}, "is_accepted": false, "score": 0, "last_activity_date": 1524587233, "creation_date": 1524587233, "answer_id": 50006648, "question_id": 50006408, "link": "https://stackoverflow.com/questions/50006408/rails-pgdatatypemismatch-error/50006648#50006648", "title": "Rails - PG::DatatypeMismatch: ERROR", "body": "<p>You could do something like <code>created_at = Date.parse(params[:created_at])</code>, but i don't think it's nescessary. Some more information might be helpful. Is your params an <code>integer</code> type? </p>\n"}, {"comments": [{"owner": {"reputation": 167, "user_id": 7947672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6d91daf5ab8d9caa18f4152d524236d?s=128&d=identicon&r=PG&f=1", "display_name": "zhu chen", "link": "https://stackoverflow.com/users/7947672/zhu-chen"}, "edited": false, "score": 0, "creation_date": 1524597034, "post_id": 50009127, "comment_id": 87034941, "body": "OMG thank you so much! Didn&#39;t know I had to put quotes on the #{variable}. As for the better solution, I know that I shouldnt use direct SQL, but this is server/database living outside of my computer and I am not even sure how to access it via the rails method if not direct sql(I am very beginner level at this A_A). Once again, thank you!"}], "tags": [], "owner": {"reputation": 1230, "user_id": 511203, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ec96aadd672b8056173e4e8a5225d8b?s=128&d=identicon&r=PG", "display_name": "Mike Gorski", "link": "https://stackoverflow.com/users/511203/mike-gorski"}, "is_accepted": true, "score": 3, "last_activity_date": 1524621427, "last_edit_date": 1524621427, "creation_date": 1524596710, "answer_id": 50009127, "question_id": 50006408, "link": "https://stackoverflow.com/questions/50006408/rails-pgdatatypemismatch-error/50009127#50009127", "title": "Rails - PG::DatatypeMismatch: ERROR", "body": "<p>If you still want to use direct SQL (which I advise against in Rails, since Rails does the SQL for you), you need to change it to wrap your date in single quotes.</p>\n\n<pre><code>sql = \"insert into api.salesorder(site, order_date, sale_type,sales_rep, terms, customer_number) values('WHS','#{created_at}','CUST','HOUSE','PRE','123456')\"\n</code></pre>\n\n<p>A better solution would be to leverage Rails to do the SQL work for you. Something like this:</p>\n\n<pre><code># in app/models/salesorder.rb\nclass Salesorder &lt; ActiveRecord::Base\nend\n\n# in app/controller/salesorder_controller.rb\nclass SalesorderController &lt; ApplicationController\n  def create\n    @salesorder = Salesorder.new\n    @salesorder.order_date = params[:created_at]\n    @salesorder.site = 'WHS'\n    @salesorder.sale_type = 'CUST'\n    @salesorder.sales_rep = 'HOUSE'\n    @salesorder.terms = 'PRE'\n    @salesorder.customer_number = '123456'\n\n    if @salesorder.save\n      redirect_to @salesorder, notice: 'Salesorder was successfully created.'\n    else\n      render :new\n    end\n  end\nend\n</code></pre>\n"}], "owner": {"reputation": 167, "user_id": 7947672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6d91daf5ab8d9caa18f4152d524236d?s=128&d=identicon&r=PG&f=1", "display_name": "zhu chen", "link": "https://stackoverflow.com/users/7947672/zhu-chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 256, "favorite_count": 0, "accepted_answer_id": 50009127, "answer_count": 2, "score": 1, "last_activity_date": 1524621907, "creation_date": 1524586358, "last_edit_date": 1524621907, "question_id": 50006408, "link": "https://stackoverflow.com/questions/50006408/rails-pgdatatypemismatch-error", "title": "Rails - PG::DatatypeMismatch: ERROR", "body": "<p>So it's a very beginner question, I am getting the following error. I know that I need to convert it over to string type. I have tried many kinds of conversion method, but yet to work. Hard coding this field as something like '2018-01-01' works. The param content that I am getting back is correct. It is the type that is creating this error. I even try to convert it over to a date type and tested the type and returned true, but still fail to succeed. Let me know if this makes sense.</p>\n\n<pre><code>PG::DatatypeMismatch: ERROR:  column \"order_date\" is of type date but expression is of type integer\n</code></pre>\n\n<p>My expresson</p>\n\n<pre><code>created_at = (params[:created_at])\n</code></pre>\n\n<p>Have tried</p>\n\n<pre><code>created_at = (params[:created_at]).to_date\ncreated_at = (params[:created_at]).to_s\n</code></pre>\n\n<p>I am trying to get the <code>params[:created_at]</code> from the payload and use the following code to insert into psql. So I think I should go with the create action. Please let me know what I am doing wrong.</p>\n\n<pre><code>def create\n  created_at = (params[:created_at])\n  puts created_at\n  sql = \"insert into api.salesorder(site, order_date,sale_type,sales_rep,terms,customer_number) values('WHS',#{created_at},'CUST','HOUSE','PRE','123456')\"\n  results = ActiveRecord::Base.connection.execute(sql)\nend\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "activerecord"], "answers": [{"tags": [], "owner": {"reputation": 470, "user_id": 9606113, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1e08f711c246aef8f24cf90bf273546?s=128&d=identicon&r=PG&f=1", "display_name": "ActiveModel_Dirty", "link": "https://stackoverflow.com/users/9606113/activemodel-dirty"}, "is_accepted": false, "score": 0, "last_activity_date": 1524587656, "creation_date": 1524587656, "answer_id": 50006779, "question_id": 50006084, "link": "https://stackoverflow.com/questions/50006084/how-do-i-associate-my-model-in-rails-between-teams-users-and-organizations/50006779#50006779", "title": "How do i associate my model in rails between teams, users and organizations?", "body": "<p>I'd recommend foregoing the <code>has_and_belongs_to_many</code> relationship in favor of <code>has_many through:</code>, which will allow you to have more flexibility with the <code>Organization</code> model.</p>\n\n<p>Something like this:</p>\n\n<pre><code>class User &lt; ApplicationRecord\n  has_many :organizations\n  has_many :teams, through: :organizations\nend\n</code></pre>\n\n<hr>\n\n<pre><code>class Team &lt; ApplicationRecord\n  has_many :organizations\n  has_many :users, through: :organizations\nend\n</code></pre>\n\n<hr>\n\n<pre><code>class Organization &lt; ApplicationRecord\n  belongs_to :users\n  belongs_to :teams\nend\n</code></pre>\n\n<hr>\n\n<p>This way your associations are defined cleanly between three models without the Rails magic of <code>has_and_belongs_to_many</code>. This allows you use of the <code>Organization</code> model.</p>\n"}], "owner": {"reputation": 13, "user_id": 7402378, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/--ZRfXgn_M1s/AAAAAAAAAAI/AAAAAAAAAGg/OYxm3fgwa84/photo.jpg?sz=128", "display_name": "neymar sabin", "link": "https://stackoverflow.com/users/7402378/neymar-sabin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 158, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524587656, "creation_date": 1524585331, "question_id": 50006084, "link": "https://stackoverflow.com/questions/50006084/how-do-i-associate-my-model-in-rails-between-teams-users-and-organizations", "title": "How do i associate my model in rails between teams, users and organizations?", "body": "<p>I am doing a project in rails which allows multiple users to be a part of organization(user belongs to only one organization). Organization has multiple teams and user also can belong to multiple teams. Besides, the organization part I did other associations like this.</p>\n\n<pre><code>class User &lt; ApplicationRecord\n   has_and_belongs_to_many :teams\nend \n\nclass Team &lt; ApplicationRecord\n   has_and_belongs_to_many :users\nend\n</code></pre>\n\n<p>My thought on adding organizations association is like this. </p>\n\n<pre><code>class User &lt; ApplicationRecord\n  has_and_belongs_to_many :teams\n  belongs_to :organization\nend\n\nclass Organization &lt; ApplicationRecord\n  has_many :users\n  has_many :teams\nend\n\nclass Team &lt; ApplicationRecord\n  has_and_belongs_to_many :users\n  belongs_to :organization\nend\n</code></pre>\n\n<p>Are there any other ways, so that I can add organization model which would be helpful for future purposes too?</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["ruby", "selenium-webdriver"], "comments": [{"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1524586753, "post_id": 50005962, "comment_id": 87029477, "body": "You have missed out one line <code>next if index.eql?0</code> Go back copy properly this time, okay?"}, {"owner": {"reputation": 83, "user_id": 9419102, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/3b0a94b437e39bbb234559d4300691ef?s=128&d=identicon&r=PG&f=1", "display_name": "Fatna", "link": "https://stackoverflow.com/users/9419102/fatna"}, "reply_to_user": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1524588538, "post_id": 50005962, "comment_id": 87030451, "body": "I have it in my code, just did not post it her, I am going to update it. but still wondering why after every iteration we have to go next only if index is 0 ."}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1524589494, "post_id": 50005962, "comment_id": 87030995, "body": "I have written an answer using which you don&#39;t have to skip the index 0"}], "owner": {"reputation": 83, "user_id": 9419102, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/3b0a94b437e39bbb234559d4300691ef?s=128&d=identicon&r=PG&f=1", "display_name": "Fatna", "link": "https://stackoverflow.com/users/9419102/fatna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 80, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1524589765, "creation_date": 1524584952, "last_edit_date": 1524588565, "question_id": 50005962, "link": "https://stackoverflow.com/questions/50005962/how-to-deal-with-table-rows-with-pagination", "title": "How to deal with table rows with pagination", "body": "<p>To test all rows in a table, I use this code:</p>\n\n<pre><code>driver.find_elements(xpath: \"//table//tr\").each_with_index  do |_, index|\n  next if index.eql?0\n  driver.find_element(xpath: \"//table//tr[#{index}]/td[1]/a\").click\n  # some other testing code here\n  driver.navigate.back\nend\n</code></pre>\n\n<p>When the table is paginated, using my code will stop when reaching the last row of the first page.</p>\n\n<p>Any idea will be helpful.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "bootstrap-modal"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 9691729, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2347a46d6c08a257620376e92b1237e2?s=128&d=identicon&r=PG&f=1", "display_name": "AdSheldon", "link": "https://stackoverflow.com/users/9691729/adsheldon"}, "edited": false, "score": 0, "creation_date": 1524612236, "post_id": 50009327, "comment_id": 87040403, "body": "Good point Paul, I hadn&#39;t thought about it that way. I will try to make it work using the guide you have posted."}], "tags": [], "owner": {"reputation": 1493, "user_id": 2236470, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/J8hqM.jpg?s=128&g=1", "display_name": "Paul Byrne", "link": "https://stackoverflow.com/users/2236470/paul-byrne"}, "is_accepted": false, "score": 1, "last_activity_date": 1524597441, "creation_date": 1524597441, "answer_id": 50009327, "question_id": 50005173, "link": "https://stackoverflow.com/questions/50005173/ruby-on-rails-submit-review-text-and-photos-in-one-form/50009327#50009327", "title": "Ruby on Rails - Submit Review Text and Photos in one form", "body": "<p>You are nesting form_for inside form_for. This is not the way to do this.</p>\n\n<p>Please check out the example in the guides.</p>\n\n<p><a href=\"http://guides.rubyonrails.org/form_helpers.html#nested-forms\" rel=\"nofollow noreferrer\">http://guides.rubyonrails.org/form_helpers.html#nested-forms</a></p>\n"}], "owner": {"reputation": 1, "user_id": 9691729, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2347a46d6c08a257620376e92b1237e2?s=128&d=identicon&r=PG&f=1", "display_name": "AdSheldon", "link": "https://stackoverflow.com/users/9691729/adsheldon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524597441, "creation_date": 1524582778, "question_id": 50005173, "link": "https://stackoverflow.com/questions/50005173/ruby-on-rails-submit-review-text-and-photos-in-one-form", "title": "Ruby on Rails - Submit Review Text and Photos in one form", "body": "<p>this is my first ever question on here, I only started writing code properly around 4-5 months ago so please be kind. </p>\n\n<p>I'm trying to build a simple review site using Ruby on Rails. I want my users to be able to use a review form (inside a Bootstrap modal) to submit reviews and upload multiple photos at the same time but can't seem to get it to submit to both DB tables with just one button (tables are Reviews and Photos).</p>\n\n<p>Currently users can submit photos and reviews in isolation with two separate buttons on the form but not together with one button. The issue with this two button solution is that the modal closes when either button is clicked and the form is submitted. I've looked into AJAX for the photo upload part but am not sure if this would work?</p>\n\n<p><a href=\"https://i.stack.imgur.com/dWEjX.jpg\" rel=\"nofollow noreferrer\">Screenshot of review form</a></p>\n\n<p><strong>Leave Review Button which triggers Modal Pop-up</strong></p>\n\n<pre><code>&lt;!-- Trigger the modal with a button --&gt;\n&lt;button type=\"button\" class=\"btn btn-normal leave-review-button\" data-toggle=\"modal\" data-target=\"#myModal_&lt;%= @area.id %&gt;\"&gt;\nLeave Review\n&lt;/button&gt;\n\n &lt;% if !user_signed_in? %&gt;\n  &lt;!-- Modal --&gt;\n&lt;div id=\"myModal_&lt;%= @area.id %&gt;\" class=\"modal fade\" role=\"dialog\"&gt;\n  &lt;div class=\"modal-dialog\"&gt;\n\n    &lt;!-- Modal content--&gt;\n    &lt;div class=\"modal-content\"&gt;\n      &lt;div class=\"modal-header\"&gt;\n        &lt;button type=\"button\" class=\"close\" data-dismiss=\"modal\"&gt;&amp;times;&lt;/button&gt;\n        &lt;h4 class=\"modal-title\"&gt;Please &lt;%= link_to \"login\", new_user_session_path %&gt; or &lt;%= link_to \"sign up\", new_user_registration_path %&gt; to leave a review&lt;/h4&gt;\n      &lt;/div&gt;\n\n\n  &lt;% else %&gt;\n\n&lt;!-- Modal --&gt;\n&lt;div id=\"myModal_&lt;%= @area.id %&gt;\" class=\"modal fade\" role=\"dialog\"&gt;\n  &lt;div class=\"modal-dialog\"&gt;\n\n    &lt;!-- Modal content--&gt;\n    &lt;div class=\"modal-content\"&gt;\n      &lt;div class=\"modal-header\"&gt;\n        &lt;button type=\"button\" class=\"close\" data-dismiss=\"modal\"&gt;&amp;times;&lt;/button&gt;\n        &lt;h4 class=\"modal-title\"&gt;Your Review&lt;/h4&gt;\n        &lt;h5&gt; Leave your honest review below &lt;/h5&gt;\n        &lt;%= render 'areas/photo_upload_form' %&gt;\n      &lt;/div&gt;\n\n\n\n      &lt;div class=\"modal-body\"&gt;\n        &lt;%= form_for current_user.reviews.new, html: {multipart: true} do |f| %&gt;\n          &lt;div class=\"form-group text-center\"&gt;\n            &lt;div id=\"stars\"&gt;&lt;/div&gt;\n          &lt;/div&gt;\n          &lt;div class=\"form-group\"&gt;\n            &lt;%= f.text_area :comment, rows: 3, class: \"form-control\" %&gt;\n          &lt;/div&gt;\n\n            &lt;%= f.hidden_field :area_id, value: @area.id %&gt;\n            &lt;%= form_for @area, url: area_photos_path(@area), method: 'post', html: {multipart: true} do |f| %&gt;\n\n\n          &lt;div class=\"text-center\"&gt;\n            &lt;%= f.submit \"Add Review\", class: \"btn btn-normal\" %&gt;\n          &lt;/div&gt;\n\n        &lt;% end %&gt;\n       &lt;% end %&gt;\n       &lt;% end %&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n\n  &lt;/div&gt;\n&lt;/div&gt;\n&lt;/div&gt;\n\n&lt;script&gt;\n  $('#stars').raty({\n    path: '/assets',\n    scoreName: 'review[star]',\n    score: 1\n  });\n&lt;/script&gt;\n</code></pre>\n\n<p><strong>_photo_upload_form partial</strong></p>\n\n<pre><code>&lt;%= form_for @area, url: area_photos_path(@area), method: 'post', html: {multipart: true} do |f| %&gt;\n  &lt;span class=\"btn btn-default btn-file text-babu\"&gt;\n     &lt;i class=\"fa fa-cloud-upload\" aria-hidden=\"true\"&gt;&lt;/i&gt; Select Photos\n     &lt;%= file_field_tag \"images[]\", type: :file, multiple: true %&gt;\n  &lt;/span&gt;\n\n   &lt;div class=\"text-center\"&gt;\n     &lt;%= f.submit \"Add Photos\", class: \"btn btn-form\" %&gt;\n   &lt;/div&gt;\n\n&lt;% end %&gt;\n</code></pre>\n\n<p><strong>reviews_controller.rb</strong></p>\n\n<pre><code>class ReviewsController &lt; ApplicationController\n\n  skip_before_action :verify_authenticity_token\n\n  def create\n\n   @area = Area.where(\n                    id: review_params[:area_id]\n                   ).first\n\n    if !@area.nil?\n\n      @has_reviewed = Review.where(\n                        area_id: @area.id,\n                        user_id: review_params[:user_id]\n                      ).first\n\n      if @has_reviewed.nil?\n          # Allow to review\n        @review = current_user.reviews.create(review_params)\n        redirect_back(fallback_location: request.referrer)\n        flash[:success] = \"Review created...\"\n        else\n          # Already reviewed\n          flash[:success] = \"You already reviewed this Area\"\n      end\n\n    else\n      flash[:alert] = \"No area found\"\n    end\n  end\n\n  def destroy\n    @review = Review.find(params[:id])\n    @review.destroy\n    redirect_back(fallback_location: request.referrer, notice: \"Review successfully deleted\")\n  end\n\n\n  private\n   def review_params\n     params.require(:review).permit(:comment, :star, :area_id, :user_id, :photo)\n   end\n end\n</code></pre>\n\n<p><strong>photos_controller.rb</strong></p>\n\n<pre><code>class PhotosController &lt; ApplicationController\n\n  def create\n    @area = Area.find(params[:area_id])\n\n\n    if params[:images]\n      params[:images].each do |img|\n        @area.photos.create(image: img, user_id: current_user.id)\n      end\n\n      @photos = @area.photos\n      redirect_back(fallback_location: request.referer, notice: \"Saved...\")\n    end\n  end\nend\n</code></pre>\n"}, {"tags": ["ruby", "chef-infra", "chef-recipe"], "comments": [{"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1524579279, "post_id": 50003854, "comment_id": 87024130, "body": "That output is not valid Ruby."}], "answers": [{"comments": [{"owner": {"reputation": 637, "user_id": 4347446, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/515608942796a1ad61a00222b6014344?s=128&d=identicon&r=PG&f=1", "display_name": "TyMac", "link": "https://stackoverflow.com/users/4347446/tymac"}, "edited": false, "score": 0, "creation_date": 1524604064, "post_id": 50009926, "comment_id": 87038059, "body": "7: DNS2=&lt;%= node[&#39;dns_dtbg&#39;][&#39;dns_servers_dtbg&#39;][1] %&gt;          8: PEERDNS=no          9: NETMASK=&lt;%= node[&quot;network&quot;][&quot;interfaces&quot;][&quot;ens192&quot;][&quot;addresses&quot;].values.&zwnj;&#8203;find { |i| i[&quot;family&quot;] == &quot;inet&quot; }[&quot;netmask&quot;] %&gt;         10: TYPE=Ethernet"}, {"owner": {"reputation": 637, "user_id": 4347446, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/515608942796a1ad61a00222b6014344?s=128&d=identicon&r=PG&f=1", "display_name": "TyMac", "link": "https://stackoverflow.com/users/4347446/tymac"}, "edited": false, "score": 0, "creation_date": 1524604071, "post_id": 50009926, "comment_id": 87038060, "body": "[2018-04-24T17:06:45-04:00] ERROR:         Chef::Mixin::Template::TemplateError (undefined method `[]&#39; for nil:NilClass) on line #9:"}, {"owner": {"reputation": 1365, "user_id": 4894399, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tY1Cz7EDNxc/AAAAAAAAAAI/AAAAAAAABb4/3Qa15VP4_ZY/photo.jpg?sz=128", "display_name": "Szymon Szypulski", "link": "https://stackoverflow.com/users/4894399/szymon-szypulski"}, "reply_to_user": {"reputation": 637, "user_id": 4347446, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/515608942796a1ad61a00222b6014344?s=128&d=identicon&r=PG&f=1", "display_name": "TyMac", "link": "https://stackoverflow.com/users/4347446/tymac"}, "edited": false, "score": 0, "creation_date": 1524642857, "post_id": 50009926, "comment_id": 87049857, "body": "Please use proper code formatting. Are you sure it is <code>ens192</code>? In you example it was <code>ens5</code>. Also as I wrote, you should check if any previous mash is not empty / nil (for example <code>[&quot;network&quot;][&quot;interfaces&quot;][&quot;ens192&quot;]</code> may be nil)."}, {"owner": {"reputation": 637, "user_id": 4347446, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/515608942796a1ad61a00222b6014344?s=128&d=identicon&r=PG&f=1", "display_name": "TyMac", "link": "https://stackoverflow.com/users/4347446/tymac"}, "edited": false, "score": 0, "creation_date": 1524650700, "post_id": 50009926, "comment_id": 87054852, "body": "I previously added the reply output above to the original question. I am trouble shooting on different machines... one ens192, one ens5 and one eth0. The mash is not empty."}], "tags": [], "owner": {"reputation": 1365, "user_id": 4894399, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tY1Cz7EDNxc/AAAAAAAAAAI/AAAAAAAABb4/3Qa15VP4_ZY/photo.jpg?sz=128", "display_name": "Szymon Szypulski", "link": "https://stackoverflow.com/users/4894399/szymon-szypulski"}, "is_accepted": false, "score": 0, "last_activity_date": 1524600163, "creation_date": 1524600163, "answer_id": 50009926, "question_id": 50003854, "link": "https://stackoverflow.com/questions/50003854/how-can-i-retrieve-the-netmask-attribute-from-ohai/50009926#50009926", "title": "How can I retrieve the netmask attribute from OHAI?", "body": "<pre><code>node[\"network\"][\"interfaces\"][\"ens192\"][\"addresses\"].values.find { |i| i[\"family\"] == \"inet\" }[\"netmask\"]\n</code></pre>\n\n<p>You should also check if you are not getting any empty Mash along the road.</p>\n"}, {"comments": [{"owner": {"reputation": 637, "user_id": 4347446, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/515608942796a1ad61a00222b6014344?s=128&d=identicon&r=PG&f=1", "display_name": "TyMac", "link": "https://stackoverflow.com/users/4347446/tymac"}, "edited": false, "score": 0, "creation_date": 1525086623, "post_id": 50088932, "comment_id": 87214950, "body": "This worked thanks! Not clear on your steps to test with Pry or IRB however... can you link to an example?"}], "tags": [], "owner": {"reputation": 19821, "user_id": 170230, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/cNDYy.png?s=128&g=1", "display_name": "Draco Ater", "link": "https://stackoverflow.com/users/170230/draco-ater"}, "is_accepted": true, "score": 0, "last_activity_date": 1525020815, "last_edit_date": 1525020815, "creation_date": 1525019694, "answer_id": 50088932, "question_id": 50003854, "link": "https://stackoverflow.com/questions/50003854/how-can-i-retrieve-the-netmask-attribute-from-ohai/50088932#50088932", "title": "How can I retrieve the netmask attribute from OHAI?", "body": "<pre><code>node[:network][:interfaces][:ens5][:addresses].detect do |k,v|\n  v[:family]=='inet'\nend.last[:netmask]\n</code></pre>\n\n<p>You could find out it by pasting your json to pry or irb, and check the result every time after adding another nested key fetch. Also, you can probably improve this answer by using <code>Hash#dig</code>. </p>\n"}], "owner": {"reputation": 637, "user_id": 4347446, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/515608942796a1ad61a00222b6014344?s=128&d=identicon&r=PG&f=1", "display_name": "TyMac", "link": "https://stackoverflow.com/users/4347446/tymac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "accepted_answer_id": 50088932, "answer_count": 2, "score": 1, "last_activity_date": 1525020815, "creation_date": 1524579055, "last_edit_date": 1524604247, "question_id": 50003854, "link": "https://stackoverflow.com/questions/50003854/how-can-i-retrieve-the-netmask-attribute-from-ohai", "title": "How can I retrieve the netmask attribute from OHAI?", "body": "<p>I need to be able to grab the netmask for an instance's interface when bootstrapping the instance. After running ohai on the instance, I have the following output that will supply the netmask:</p>\n\n<pre><code> \"network\": {\n    \"interfaces\": {\n      \"lo\": {\n        \"mtu\": \"65536\",\n        \"flags\": [\n          \"LOOPBACK\",\n          \"UP\",\n          \"LOWER_UP\"\n        ],\n        \"encapsulation\": \"Loopback\",\n        \"addresses\": {\n          \"127.0.0.1\": {\n            \"family\": \"inet\",\n            \"prefixlen\": \"8\",\n            \"netmask\": \"255.0.0.0\",\n            \"scope\": \"Node\"\n          }\n        },\n        \"state\": \"unknown\"\n      },\n      \"ens5\": {\n        \"type\": \"ens\",\n        \"number\": \"5\",\n        \"mtu\": \"9001\",\n        \"flags\": [\n          \"BROADCAST\",\n          \"MULTICAST\",\n          \"UP\",\n          \"LOWER_UP\"\n        ],\n        \"encapsulation\": \"Ethernet\",\n        \"addresses\": {\n          \"0E:D6:03:1B:8D:42\": {\n            \"family\": \"lladdr\"\n          },\n          \"10.191.196.213\": {\n            \"family\": \"inet\",\n            \"prefixlen\": \"24\",\n            \"netmask\": \"255.255.255.0\",\n             \"broadcast\": \"10.191.196.255\",\n            \"scope\": \"Global\"\n          }\n         },...\n</code></pre>\n\n<p>I'm not getting the correct syntax, but I have found that I can get the IP address with this:</p>\n\n<pre><code>node[:network][:interfaces][:eth0][:addresses].detect{|k,v| v[:family] == \"inet\" }.first\n</code></pre>\n\n<p>Using this however, will not get the netmask:</p>\n\n<pre><code>node[:network][:interfaces][:ens192][:addresses][:netmask]\n</code></pre>\n\n<p>Any ideas on the correct ruby to get this value?</p>\n\n<p>*Edit - using:</p>\n\n<pre><code>node[\"network\"][\"interfaces\"][\"ens192\"][\"addresses\"].values.find { |i| i[\"family\"] == \"inet\" }[\"netmask\"]\n</code></pre>\n\n<p>I get this error:</p>\n\n<pre><code>    [2018-04-24T17:06:45-04:00] ERROR:\n\n   Chef::Mixin::Template::TemplateError (undefined method `[]' for nil:NilClass) on line #9:\n     7: DNS2=&lt;%= node['dns_dtbg']['dns_servers_dtbg'][1] %&gt;\n     8: PEERDNS=no\n     9: NETMASK=&lt;%= node[\"network\"][\"interfaces\"][\"ens192\"][\"addresses\"].values.find { |i| i[\"family\"] == \"inet\" }[\"netmask\"] %&gt;\n    10: TYPE=Ethernet\n</code></pre>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 1, "creation_date": 1524575421, "post_id": 50002529, "comment_id": 87021255, "body": "Do you have a specific question?"}, {"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1524575479, "post_id": 50002529, "comment_id": 87021312, "body": "Your requ[i]red out is not valid ruby."}, {"owner": {"reputation": 2231, "user_id": 1238868, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b9884f1eabc8587f2c9dfd2b1ccf9a6?s=128&d=identicon&r=PG", "display_name": "Michael Chaney", "link": "https://stackoverflow.com/users/1238868/michael-chaney"}, "edited": false, "score": 0, "creation_date": 1524575511, "post_id": 50002529, "comment_id": 87021332, "body": "I edited the question - presumably he&#39;s wanting an array."}, {"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1524575534, "post_id": 50002529, "comment_id": 87021354, "body": "Are you sure you want to use the full power of Ruby on Rails and not just Ruby?"}, {"owner": {"reputation": 2231, "user_id": 1238868, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b9884f1eabc8587f2c9dfd2b1ccf9a6?s=128&d=identicon&r=PG", "display_name": "Michael Chaney", "link": "https://stackoverflow.com/users/1238868/michael-chaney"}, "edited": false, "score": 0, "creation_date": 1524575795, "post_id": 50002529, "comment_id": 87021547, "body": "Note that I also changed the tag to just &quot;ruby&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 9030, "user_id": 5101476, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JCQrl.jpg?s=128&g=1", "display_name": "ice\u30c4", "link": "https://stackoverflow.com/users/5101476/ice%e3%83%84"}, "edited": false, "score": 1, "creation_date": 1524587747, "post_id": 50002722, "comment_id": 87030034, "body": "Or you can use a lookahead and a lookbehind <code>str.scan(&#47;(?&lt;=\\[).*?(?=\\])&#47;)</code> to avoid using <code>flatten</code>."}], "tags": [], "owner": {"reputation": 2231, "user_id": 1238868, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b9884f1eabc8587f2c9dfd2b1ccf9a6?s=128&d=identicon&r=PG", "display_name": "Michael Chaney", "link": "https://stackoverflow.com/users/1238868/michael-chaney"}, "is_accepted": true, "score": 3, "last_activity_date": 1524575873, "creation_date": 1524575873, "answer_id": 50002722, "question_id": 50002529, "link": "https://stackoverflow.com/questions/50002529/capture-all-keywords-from-string-with-brackets-rails/50002722#50002722", "title": "Capture all keywords from string with brackets rails", "body": "<p>You just need to use the <code>scan</code> method with a regular expression:</p>\n\n<pre><code>str.scan(/\\[(.*?)\\]/).flatten\n</code></pre>\n\n<p>Actual output:</p>\n\n<pre><code>2.2-head :001 &gt; str = \"Coming this week for [CurrentCourseName] chapter [Chaptername] of interesting event [EventName]\"\n =&gt; \"Coming this week for [CurrentCourseName] chapter [Chaptername] of interesting event [EventName]\" \n2.2-head :002 &gt; str.scan(/\\[(.*?)\\]/).flatten\n =&gt; [\"CurrentCourseName\", \"Chaptername\", \"EventName\"] \n</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 9623154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98844b11a75c5a78d87ab3906904677f?s=128&d=identicon&r=PG&f=1", "display_name": "J.Dev", "link": "https://stackoverflow.com/users/9623154/j-dev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 50002722, "answer_count": 1, "score": -1, "last_activity_date": 1524580080, "creation_date": 1524575294, "last_edit_date": 1524580080, "question_id": 50002529, "link": "https://stackoverflow.com/questions/50002529/capture-all-keywords-from-string-with-brackets-rails", "title": "Capture all keywords from string with brackets rails", "body": "<p>I want to capture all occurrence of keywords from below string in hash.</p>\n\n<pre><code>str = \"Coming this week for [CurrentCourseName] chapter [Chaptername] of interesting event [EventName]\"\n</code></pre>\n\n<p><strong>Required Output:</strong></p>\n\n<pre><code>[\"CurrentCourseName\", \"Chaptername\", \"EventName\"]\n</code></pre>\n"}, {"tags": ["ruby", "hash"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1524573456, "post_id": 50001869, "comment_id": 87019767, "body": "<a href=\"https://ruby-doc.org/core-2.4.0/Hash.html#method-i-transform_values\" rel=\"nofollow noreferrer\">ruby-doc.org/core-2.4.0/Hash.html#method-i-transform_values</a>"}, {"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 1, "creation_date": 1524573498, "post_id": 50001869, "comment_id": 87019805, "body": "You mean &quot;key&quot;, not &quot;value&quot;."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 1, "creation_date": 1524574089, "post_id": 50001869, "comment_id": 87020238, "body": "@sawa: also it&#39;s not an array."}, {"owner": {"reputation": 301, "user_id": 7572104, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/i976n.png?s=128&g=1", "display_name": "Tearzz", "link": "https://stackoverflow.com/users/7572104/tearzz"}, "edited": false, "score": 0, "creation_date": 1524574239, "post_id": 50001869, "comment_id": 87020353, "body": "Then what is it?"}, {"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 1, "creation_date": 1524574284, "post_id": 50001869, "comment_id": 87020396, "body": "It&#39;s called a hash."}], "answers": [{"comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 4, "creation_date": 1524573703, "post_id": 50001972, "comment_id": 87019977, "body": "This is for 2.5+"}], "tags": [], "owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "is_accepted": false, "score": 3, "last_activity_date": 1524573654, "creation_date": 1524573654, "answer_id": 50001972, "question_id": 50001869, "link": "https://stackoverflow.com/questions/50001869/replace-each-key-in-a-hash/50001972#50001972", "title": "Replace each key in a hash", "body": "<pre><code>admin_commands.transform_keys{|k| prefix + k}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11736, "user_id": 610351, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f4ee98206d84b25a83228e285c678f0?s=128&d=identicon&r=PG", "display_name": "Geoffroy", "link": "https://stackoverflow.com/users/610351/geoffroy"}, "edited": false, "score": 0, "creation_date": 1524573780, "post_id": 50001985, "comment_id": 87020036, "body": "just got downvoted, care to explain why? So I can improve my post and provide better answer"}, {"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 1, "creation_date": 1524573840, "post_id": 50001985, "comment_id": 87020084, "body": "<code>NameError: undefined local variable or method `x&#39; for main:Object</code>. Lesson: Copy and paste does not always work."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1524573993, "post_id": 50001985, "comment_id": 87020182, "body": "Instead of map+to_h, it is <i>probably</i> better to use reduce/each_with_object."}, {"owner": {"reputation": 11736, "user_id": 610351, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f4ee98206d84b25a83228e285c678f0?s=128&d=identicon&r=PG", "display_name": "Geoffroy", "link": "https://stackoverflow.com/users/610351/geoffroy"}, "reply_to_user": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1524574032, "post_id": 50001985, "comment_id": 87020203, "body": "@sawa I added another solution first, and then added <code>transform_keys!</code>, while precising that it&#39;s not available to all ruby version. But yeah, I copied pasted the block because that was easier haha"}, {"owner": {"reputation": 11736, "user_id": 610351, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f4ee98206d84b25a83228e285c678f0?s=128&d=identicon&r=PG", "display_name": "Geoffroy", "link": "https://stackoverflow.com/users/610351/geoffroy"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1524574131, "post_id": 50001985, "comment_id": 87020271, "body": "@SergioTulentsev wouldn&#39;t enumerating on the hash always return an array of pairs?"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1524574218, "post_id": 50001985, "comment_id": 87020333, "body": "@Geoffroy: each key-value pair is yielded to the enumerator block, yes. No need to keep all of them in a temp array."}], "tags": [], "owner": {"reputation": 11736, "user_id": 610351, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f4ee98206d84b25a83228e285c678f0?s=128&d=identicon&r=PG", "display_name": "Geoffroy", "link": "https://stackoverflow.com/users/610351/geoffroy"}, "is_accepted": true, "score": 3, "last_activity_date": 1524573848, "last_edit_date": 1524573848, "creation_date": 1524573690, "answer_id": 50001985, "question_id": 50001869, "link": "https://stackoverflow.com/questions/50001869/replace-each-key-in-a-hash/50001985#50001985", "title": "Replace each key in a hash", "body": "<p>If you're using ruby >= 2.5</p>\n\n<pre><code>admin_commands.transform_keys!{|k| prefix + k}\n</code></pre>\n\n<p>Otherwise:</p>\n\n<pre><code>prefix = \"!\"\nadmin_commands = {\"Hello\" =&gt; \"\"}\nadmin_commands = admin_commands.map {|k, v| [prefix + k, v]}.to_h\n</code></pre>\n\n<p>This method maps each key/value pair of the hash to an array, effectively returning an array of pair, which is then transformed back to an hash using <code>to_h</code></p>\n"}, {"tags": [], "owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "is_accepted": false, "score": 2, "last_activity_date": 1524576934, "creation_date": 1524576934, "answer_id": 50003086, "question_id": 50001869, "link": "https://stackoverflow.com/questions/50001869/replace-each-key-in-a-hash/50003086#50003086", "title": "Replace each key in a hash", "body": "<p>Just out of curiosity:</p>\n\n<pre><code>admin_commands.each_with_object({}) do |(k, v), hash|\n  hash[\"#{prefix}#{k}\"] = v\nend\n#\u21d2 {\"!Hello\"=&gt;\"\"}\nadmin_commands.\n  keys.\n  map(&amp;prefix.method(:+)).\n  zip(admin_commands.values).\n  to_h\n#\u21d2 {\"!Hello\"=&gt;\"\"}\n</code></pre>\n"}], "owner": {"reputation": 301, "user_id": 7572104, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/i976n.png?s=128&g=1", "display_name": "Tearzz", "link": "https://stackoverflow.com/users/7572104/tearzz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 50001985, "answer_count": 3, "score": -1, "last_activity_date": 1524577786, "creation_date": 1524573353, "last_edit_date": 1524577786, "question_id": 50001869, "link": "https://stackoverflow.com/questions/50001869/replace-each-key-in-a-hash", "title": "Replace each key in a hash", "body": "<p>I have this code:</p>\n\n<pre><code>prefix = \"!\"\nadmin_commands = {\"hello\" =&gt; \"\"}\nif admin_commands.length &gt; 0\n  admin_commands.map! { |command| prefix + command }\nend\n</code></pre>\n\n<p>How would I change the key <code>\"hello\"</code> in <code>admin_commands</code> to <code>\"!hello\"</code>?</p>\n"}, {"tags": ["ruby", "docker"], "answers": [{"tags": [], "owner": {"reputation": 107, "user_id": 3766652, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100000329832586/picture?type=large", "display_name": "SkunKz", "link": "https://stackoverflow.com/users/3766652/skunkz"}, "is_accepted": false, "score": 1, "last_activity_date": 1524598945, "creation_date": 1524598945, "answer_id": 50009656, "question_id": 50001768, "link": "https://stackoverflow.com/questions/50001768/docker-ruby-container-with-smashing-load-error/50009656#50009656", "title": "Docker ruby container with smashing - load Error", "body": "<p>There is a naming mistake in your directory structure which results in your error.</p>\n\n<p>Unfortunately, persons who don't have access to the repository are not able to resolve your error.</p>\n\n<p>To be clear the file (which smashing is looking for) <code>lib/imelk_service/imelkCalls.rb</code> is named <code>lib/imelk_service/ImelkCalls.rb</code> (mark the capital I letter from Imelk).\nI updated your code and pushed it back into the repository.</p>\n\n<p>Kind regards,</p>\n\n<p>Marvyn</p>\n"}], "owner": {"reputation": 21, "user_id": 8036899, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e07b4ee5382cf4b919ab6b14bc7b1f3?s=128&d=identicon&r=PG&f=1", "display_name": "Philipp G.", "link": "https://stackoverflow.com/users/8036899/philipp-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 347, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524598945, "creation_date": 1524573063, "last_edit_date": 1524575749, "question_id": 50001768, "link": "https://stackoverflow.com/questions/50001768/docker-ruby-container-with-smashing-load-error", "title": "Docker ruby container with smashing - load Error", "body": "<p>I created a Dockerfile, which is the following</p>\n\n<pre><code>FROM ruby:2.2.3\n\nWORKDIR /usr/src/app\n\n\nRUN apt-get update &amp;&amp; \\\n    apt-get -y install nodejs &amp;&amp; \\\n    apt-get -y clean\n\nCOPY Gemfile Gemfile.lock ./\nRUN bundle install\nRUN bundle update\n\nCOPY ./dashboards ./dashboards\nCOPY ./widgets ./widgets\nCOPY ./jobs ./jobs\nCOPY ./config ./config\nCOPY ./config.ru .\nCOPY ./lib ./lib\nCOPY ./assets ./assets\n\nENV PORT 3030\nEXPOSE $PORT\n\nCMD [\"/bin/sh\"]\n</code></pre>\n\n<p>I can't run <a href=\"https://github.com/Smashing/smashing\" rel=\"nofollow noreferrer\">smashing</a> in a Docker container. I get a LoadError. The Gemfile just references smashing to install the required packages. Unfortunately, if I start my container and run <code>smashing start</code>, I get the following error:</p>\n\n<pre><code>/usr/src/app/jobs/scheduler.rb:4:in `require_relative': cannot load such file -- /usr/src/app/lib/imelk_service/imelkCalls.rb (LoadError)\n    from /usr/src/app/jobs/scheduler.rb:4:in `&lt;top (required)&gt;'\n    from /usr/local/bundle/gems/backports-3.11.3/lib/backports/std_lib.rb:9:in `require'\n    from /usr/local/bundle/gems/backports-3.11.3/lib/backports/std_lib.rb:9:in `require_with_backports'\n    from /usr/local/bundle/gems/smashing-1.1.0/lib/dashing/app.rb:169:in `block in require_glob'\n    from /usr/local/bundle/gems/smashing-1.1.0/lib/dashing/app.rb:168:in `each'\n    from /usr/local/bundle/gems/smashing-1.1.0/lib/dashing/app.rb:168:in `require_glob'\n    from /usr/local/bundle/gems/smashing-1.1.0/lib/dashing/app.rb:179:in `&lt;top (required)&gt;'\n    from /usr/local/bundle/gems/smashing-1.1.0/lib/dashing.rb:3:in `require'\n    from /usr/local/bundle/gems/smashing-1.1.0/lib/dashing.rb:3:in `&lt;top (required)&gt;'\n    from config.ru:1:in `require'\n    from config.ru:1:in `block in &lt;main&gt;'\n    from /usr/local/bundle/gems/rack-2.0.5/lib/rack/builder.rb:55:in `instance_eval'\n    from /usr/local/bundle/gems/rack-2.0.5/lib/rack/builder.rb:55:in `initialize'\n    from config.ru:1:in `new'\n    from config.ru:1:in `&lt;main&gt;'\n    from /usr/local/bundle/gems/thin-1.7.2/lib/rack/adapter/loader.rb:33:in `eval'\n    from /usr/local/bundle/gems/thin-1.7.2/lib/rack/adapter/loader.rb:33:in `load'\n    from /usr/local/bundle/gems/thin-1.7.2/lib/thin/controllers/controller.rb:182:in `load_rackup_config'\n    from /usr/local/bundle/gems/thin-1.7.2/lib/thin/controllers/controller.rb:72:in `start'\n    from /usr/local/bundle/gems/thin-1.7.2/lib/thin/runner.rb:203:in `run_command'\n    from /usr/local/bundle/gems/thin-1.7.2/lib/thin/runner.rb:159:in `run!'\n    from /usr/local/bundle/gems/thin-1.7.2/bin/thin:6:in `&lt;top (required)&gt;'\n    from /usr/local/bundle/bin/thin:16:in `load'\n    from /usr/local/bundle/bin/thin:16:in `&lt;main&gt;'\n</code></pre>\n\n<p>I'm trying to figure out why. I checked that file <code>\u00ecmelkCalls.rb</code> exists. Outside of Docker, my code runs, so it can't be that. I'm guessing it's some missing dependencies, but I have no clue which one this could be. I tried it with Ruby versions 2.5 and 2.3, but I get the same error.</p>\n\n<p>Hopefully, someone has an idea on what I'm doing wrong or could point me in the right direction.</p>\n\n<p>Additional information that might be usefull (from within the Docker container):</p>\n\n<p>ruby version: ruby 2.2.3p173 (2015-08-18 revision 51636) [x86_64-linux]</p>\n\n<p>gem version: 2.5.0</p>\n\n<p>bundler version: Bundler version 1.10.6</p>\n\n<p>Gemfile.lock:</p>\n\n<pre><code>GEM\n  remote: https://rubygems.org/\n  specs:\n    backports (3.11.3)\n    coffee-script (2.4.1)\n      coffee-script-source\n      execjs\n    coffee-script-source (1.12.2)\n    concurrent-ruby (1.0.5)\n    daemons (1.2.6)\n    et-orbi (1.1.0)\n      tzinfo\n    eventmachine (1.2.5)\n    execjs (2.7.0)\n    multi_json (1.13.1)\n    mustermann (1.0.2)\n    rack (2.0.5)\n    rack-protection (2.0.1)\n      rack\n    rufus-scheduler (3.4.2)\n      et-orbi (~&gt; 1.0)\n    sass (3.4.25)\n    sinatra (2.0.1)\n      mustermann (~&gt; 1.0)\n      rack (~&gt; 2.0)\n      rack-protection (= 2.0.1)\n      tilt (~&gt; 2.0)\n    sinatra-contrib (2.0.1)\n      backports (&gt;= 2.0)\n      multi_json\n      mustermann (~&gt; 1.0)\n      rack-protection (= 2.0.1)\n      sinatra (= 2.0.1)\n      tilt (&gt;= 1.3, &lt; 3)\n    smashing (1.1.0)\n      coffee-script (~&gt; 2.4.1)\n      execjs (~&gt; 2.7.0)\n      rack (~&gt; 2.0.0)\n      rufus-scheduler (~&gt; 3.4.2)\n      sass (~&gt; 3.4.24)\n      sinatra (~&gt; 2.0.0)\n      sinatra-contrib (~&gt; 2.0.0)\n      sprockets (~&gt; 3.7.1)\n      thin (~&gt; 1.7.0)\n      thor (~&gt; 0.19.4)\n    sprockets (3.7.1)\n      concurrent-ruby (~&gt; 1.0)\n      rack (&gt; 1, &lt; 3)\n    thin (1.7.2)\n      daemons (~&gt; 1.0, &gt;= 1.0.9)\n      eventmachine (~&gt; 1.0, &gt;= 1.0.4)\n      rack (&gt;= 1, &lt; 3)\n    thor (0.19.4)\n    thread_safe (0.3.6)\n    tilt (2.0.8)\n    tzinfo (1.2.5)\n      thread_safe (~&gt; 0.1)\n\nPLATFORMS\n  ruby\n\nDEPENDENCIES\n  smashing\n\nBUNDLED WITH\n   1.16.1\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "autoload"], "comments": [{"owner": {"reputation": 2537, "user_id": 5371321, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/ZFyVo.jpg?s=128&g=1", "display_name": "Narasimha Reddy - Geeker", "link": "https://stackoverflow.com/users/5371321/narasimha-reddy-geeker"}, "edited": false, "score": 0, "creation_date": 1524568086, "post_id": 49999773, "comment_id": 87016165, "body": "can you post the code where you are using this Hook class?"}, {"owner": {"reputation": 19325, "user_id": 67505, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/094c0ec476b95ed7619d6a4cb918da78?s=128&d=identicon&r=PG", "display_name": "Chen Kinnrot", "link": "https://stackoverflow.com/users/67505/chen-kinnrot"}, "edited": false, "score": 0, "creation_date": 1524568867, "post_id": 49999773, "comment_id": 87016689, "body": "Shouldn&#39;t you initialize it with `$hook=Hook.new"}, {"owner": {"reputation": 21, "user_id": 4154690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5b41c8fe5d16e3d406fb06dc6a82cb7?s=128&d=identicon&r=PG", "display_name": "J&#233;r&#233;mie Bonal", "link": "https://stackoverflow.com/users/4154690/j%c3%a9r%c3%a9mie-bonal"}, "reply_to_user": {"reputation": 2537, "user_id": 5371321, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/ZFyVo.jpg?s=128&g=1", "display_name": "Narasimha Reddy - Geeker", "link": "https://stackoverflow.com/users/5371321/narasimha-reddy-geeker"}, "edited": false, "score": 0, "creation_date": 1524569427, "post_id": 49999773, "comment_id": 87017080, "body": "@NarasimhaReddy: I added the code, it&#39;s pretty basic though, a simple callback. @ChenKinnrot: We don&#39;t need to instantiate it because we use it as a single central object, we don&#39;t need it as a class <i>per se</i>, only as a constant that we&#39;ll be able to call on. @Stefan: I forgot the <code>class &lt;&lt; self</code> in my simplified Hook class. My bad."}, {"owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 0, "creation_date": 1524569499, "post_id": 49999773, "comment_id": 87017132, "body": "Do both calls (<code>subscibe</code> and <code>publish</code>) happen in the same request?"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1524569515, "post_id": 49999773, "comment_id": 87017145, "body": "Try running your rails app with <code>cache_classes=true</code> (and eager_load too)"}, {"owner": {"reputation": 21, "user_id": 4154690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5b41c8fe5d16e3d406fb06dc6a82cb7?s=128&d=identicon&r=PG", "display_name": "J&#233;r&#233;mie Bonal", "link": "https://stackoverflow.com/users/4154690/j%c3%a9r%c3%a9mie-bonal"}, "reply_to_user": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 0, "creation_date": 1524569855, "post_id": 49999773, "comment_id": 87017343, "body": "@spickermann: No, the <code>subscribe</code>  happens in an initializer, so at the app boot. The  <code>publish</code> is the only part that happens inside the request."}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 4154690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5b41c8fe5d16e3d406fb06dc6a82cb7?s=128&d=identicon&r=PG", "display_name": "J&#233;r&#233;mie Bonal", "link": "https://stackoverflow.com/users/4154690/j%c3%a9r%c3%a9mie-bonal"}, "is_accepted": true, "score": 2, "last_activity_date": 1524765286, "last_edit_date": 1524765286, "creation_date": 1524569781, "answer_id": 50000699, "question_id": 49999773, "link": "https://stackoverflow.com/questions/49999773/rails-forgets-class-between-initializer-and-queries/50000699#50000699", "title": "Rails &#39;forgets&#39; class between initializer and queries", "body": "<p>I finally found a fix, even if I don't fully understand it (I'm still a bit unclear on how Rails handles autoloading I guess \u2014 I'll need to investigate deeper when I have the time).</p>\n\n<p>The <code>Hook</code> class was inside a module (<code>OurApp::Hook</code>) which I had omitted for clarity in the example I shared (my mistake, obviously).\nI noticed that <code>OurApp.constants</code> was losing a few constants other than <code>Hook</code>.\nI went inside <code>lib/our_app.rb</code> and modified it so:</p>\n\n<pre><code>module OurApp\n  autoload :Hook, 'lib/our_app/hook.rb'\n  # ...\nend\n</code></pre>\n\n<p>That seems to do the trick, no more issues.</p>\n\n<p>Thanks everybody !</p>\n"}], "owner": {"reputation": 21, "user_id": 4154690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5b41c8fe5d16e3d406fb06dc6a82cb7?s=128&d=identicon&r=PG", "display_name": "J&#233;r&#233;mie Bonal", "link": "https://stackoverflow.com/users/4154690/j%c3%a9r%c3%a9mie-bonal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 50000699, "answer_count": 1, "score": 0, "last_activity_date": 1524765286, "creation_date": 1524566842, "last_edit_date": 1524569257, "question_id": 49999773, "link": "https://stackoverflow.com/questions/49999773/rails-forgets-class-between-initializer-and-queries", "title": "Rails &#39;forgets&#39; class between initializer and queries", "body": "<p>I'm encountering a peculiar issue on Rails.</p>\n\n<p>We've set up a <code>Hook</code> class to handle a small pub/sub mechanism inside our app it goes something like this</p>\n\n<pre><code>class Hook\n  @subscriptions = {}\n\n  class &lt;&lt; self\n    def subscribe(message, &amp;block)\n      @subscriptions[message] ||= []\n      @subscriptions[message] &lt;&lt; block\n    end\n\n    def publish(message)\n      @subscriptions[message].each(&amp;:call)\n    end\n  end\nend\n</code></pre>\n\n<p>(It's a tiny bit more fleshed out but you get the idea).</p>\n\n<p>The problem is:</p>\n\n<p>In an initializer we've got <code>Hook.subscribe(:change) { ... }</code>\nBut when the model calls <code>Hook.publish(:change)</code>, nothing happens. A quick check shows that until <code>Hook</code> is called again by the model, a <code>defined? Hook</code> returns <code>nil</code>.</p>\n\n<p>The code in the model is</p>\n\n<pre><code>after_commit do\n  # byebug\n  Hook.publish(:change)\nend\n</code></pre>\n\n<p>Even weirder: In the initializer I set up a global variable to hold the constant <code>$hook = Hook</code>, the constant is indeed here inside the <code>$hook</code> variable in the model but doesn't match the Hook it autoloads.</p>\n\n<pre><code># inside a debugger in the model\n\n&gt; defined? Hook\n=&gt; nil\n\n&gt; $hook\n=&gt; Hook\n\n&gt; Hook # will trigger autoloading\n=&gt; Hook\n\n&gt; defined? Hook\n=&gt; \"constant\"\n\n&gt; Hook == $hook\n=&gt; false\n\n&gt; Hook.instance_variable_get(:@subscriptions)\n=&gt; {}\n\n&gt; $hook.instance_variable_get(:@subscriptions)\n=&gt; { change: [&lt;Proc:...&gt;] }\n\n&gt; Hook.object_id == $hook.object_id\n=&gt; false\n</code></pre>\n\n<p>If I set it back as the constant <code>Hook = $hook</code> through the debugger everything behaves properly again \u2014 the constant is maintained with the proper variables across requests, even.</p>\n\n<p>I'm reaching the end of my wits here. As anybody got any idea what might be going on?</p>\n"}, {"tags": ["mysql", "ruby-on-rails", "ruby", "activerecord", "dump"], "comments": [{"owner": {"reputation": 11736, "user_id": 610351, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f4ee98206d84b25a83228e285c678f0?s=128&d=identicon&r=PG", "display_name": "Geoffroy", "link": "https://stackoverflow.com/users/610351/geoffroy"}, "edited": false, "score": 0, "creation_date": 1524569112, "post_id": 49999651, "comment_id": 87016862, "body": "What does <code>Poi.find(33).subtype</code> returns?"}, {"owner": {"reputation": 1, "user_id": 8649754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d9404b3367b41312ed9410e58970f5b?s=128&d=identicon&r=PG&f=1", "display_name": "Nils Kuijpers", "link": "https://stackoverflow.com/users/8649754/nils-kuijpers"}, "reply_to_user": {"reputation": 11736, "user_id": 610351, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f4ee98206d84b25a83228e285c678f0?s=128&d=identicon&r=PG", "display_name": "Geoffroy", "link": "https://stackoverflow.com/users/610351/geoffroy"}, "edited": false, "score": 0, "creation_date": 1524569613, "post_id": 49999651, "comment_id": 87017209, "body": "it returns &quot;172&quot; (as i&#39;d expect)"}, {"owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 1, "creation_date": 1524569899, "post_id": 49999651, "comment_id": 87017375, "body": "I wouldn&#39;t expect <code>Poi#subtype</code> to return a <code>String</code> if <code>subtype</code> was an <code>Integer</code> column in the database. Please explain why you expect it to be a <code>String</code>. Furthermore: Are there <code>enum</code> or <code>validate</code> definitions in your model? Please post your model."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1524574632, "post_id": 49999651, "comment_id": 87020675, "body": "Are you sure you are connecting to the same db where the records actually are and not to a development environment that is empty?"}, {"owner": {"reputation": 1, "user_id": 8649754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d9404b3367b41312ed9410e58970f5b?s=128&d=identicon&r=PG&f=1", "display_name": "Nils Kuijpers", "link": "https://stackoverflow.com/users/8649754/nils-kuijpers"}, "edited": false, "score": 0, "creation_date": 1524583063, "post_id": 49999651, "comment_id": 87026939, "body": "Thanks guys for the replies. It turned out that due to some funky migrations the subtype field was indeed a string. The real miracle here is that in some cases it DID work, because it shouldn&#39;t have. Case closed!"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 8649754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d9404b3367b41312ed9410e58970f5b?s=128&d=identicon&r=PG&f=1", "display_name": "Nils Kuijpers", "link": "https://stackoverflow.com/users/8649754/nils-kuijpers"}, "is_accepted": true, "score": 0, "last_activity_date": 1524583482, "creation_date": 1524583482, "answer_id": 50005421, "question_id": 49999651, "link": "https://stackoverflow.com/questions/49999651/ruby-on-rails-where-clause-not-finding-correct-records/50005421#50005421", "title": "Ruby on rails where clause not finding correct records", "body": "<p>Thanks guys for the replies. It turned out that due to some funky migrations the subtype field was indeed a string. The real miracle here is that in some cases it DID work, because it shouldn't have. Case closed! </p>\n"}], "owner": {"reputation": 1, "user_id": 8649754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d9404b3367b41312ed9410e58970f5b?s=128&d=identicon&r=PG&f=1", "display_name": "Nils Kuijpers", "link": "https://stackoverflow.com/users/8649754/nils-kuijpers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 50005421, "answer_count": 1, "score": 0, "last_activity_date": 1524583482, "creation_date": 1524566484, "last_edit_date": 1524569065, "question_id": 49999651, "link": "https://stackoverflow.com/questions/49999651/ruby-on-rails-where-clause-not-finding-correct-records", "title": "Ruby on rails where clause not finding correct records", "body": "<p>I have a rails model which is set up like this:</p>\n\n<p>Poi:</p>\n\n<pre><code>id : int\nname : varchar\nsubtype : int\n</code></pre>\n\n<p>I recently migrated a lot of records from one database to another using mysql_dump and import. The migration seemed to have gone well, and if I query an id in the console it finds that records. There is a record like this:</p>\n\n<pre><code>id : 33\nname : testpoi\nsubtype : 172\n</code></pre>\n\n<p>If I try to find it using: </p>\n\n<pre><code>Poi.where(:subtype =&gt; 172).first\n</code></pre>\n\n<p>it always returns nil</p>\n\n<p>If I run this exact query on the system from which I migrated the database it does work.</p>\n\n<p>If I run <code>Poi.find(33)</code> it finds it too. I've tried </p>\n\n<pre><code>Poi.where(:subtype =&gt; \"172\").first \n</code></pre>\n\n<p>as well to make sure its not a datatype mismatch, but to no avail.</p>\n\n<p>Also, if I add this object to a collection </p>\n\n<pre><code>@otherobject.poilist &lt;&lt; Poi.find(33) #=&gt; which has a has many with foreign key subtype\n</code></pre>\n\n<p>it works just fine (returns true after saving), but if I then restart the production console the association no longer exists, even though the subtype id matches the id of the containing object.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "jquery-templates", "sprockets"], "owner": {"reputation": 960, "user_id": 4109592, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/7Sip6.jpg?s=128&g=1", "display_name": "Nick Schwaderer", "link": "https://stackoverflow.com/users/4109592/nick-schwaderer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 501, "favorite_count": 0, "answer_count": 0, "score": 5, "last_activity_date": 1524559371, "creation_date": 1524559371, "question_id": 49997123, "link": "https://stackoverflow.com/questions/49997123/fixing-sprockets-deprecation-method-register-engine-is-deprecated", "title": "Fixing sprockets deprecation: method `register_engine` is deprecated", "body": "<h1>Versions</h1>\n\n<ul>\n<li>Ruby 2.4.3</li>\n<li>Rails 5.1.3</li>\n<li>sprockets 3.7.3</li>\n<li>jquery-tmpl-rails 1.1.0</li>\n</ul>\n\n<h2>Issue:</h2>\n\n<p>The latest version of <code>jquery-tmpl-rails</code> triggers a sprockets deprecation warning of:</p>\n\n<pre><code>DEPRECATION WARNING: Sprockets method `register_engine` is deprecated.\nPlease register a mime type using `register_mime_type` then\nuse `register_compressor` or `register_transformer`.\n\nhttps://github.com/rails/sprockets/blob/master/guides/extending_sprockets.md#supporting-all-versions-of-sprockets-in-processors \n(called from block (2 levels) in &lt;class:Railtie&gt; at /my/path/to/gems/jquery-tmpl-rails-ef6f58001d41/lib/jquery-tmpl-rails/engine.rb:10)\n</code></pre>\n\n<h2>Attempts at resolution:</h2>\n\n<p>Following the deprecation warning, the problem within the gem simply resides here: <a href=\"https://github.com/jimmycuadra/jquery-tmpl-rails/blob/master/lib/jquery-tmpl-rails/engine.rb#L10\" rel=\"noreferrer\">https://github.com/jimmycuadra/jquery-tmpl-rails/blob/master/lib/jquery-tmpl-rails/engine.rb#L10</a></p>\n\n<p>Which is currently:</p>\n\n<p><code>app.assets.register_engine(\".tmpl\", JqueryTemplate)</code></p>\n\n<p>I then visited the sprockets guide for handling deprecations, extensibility and compliance with sprockets 2,3,4. <a href=\"https://github.com/rails/sprockets/blob/master/guides/extending_sprockets.md#supporting-all-versions-of-sprockets-in-processors\" rel=\"noreferrer\">https://github.com/rails/sprockets/blob/master/guides/extending_sprockets.md#supporting-all-versions-of-sprockets-in-processors</a></p>\n\n<p>I made my best attempt at rectifying the problem with a commit on this fork here: <a href=\"https://github.com/oceanshq/jquery-tmpl-rails/commit/de7a59894f512efb3c1eba432da3517f21d921a2\" rel=\"noreferrer\">https://github.com/oceanshq/jquery-tmpl-rails/commit/de7a59894f512efb3c1eba432da3517f21d921a2</a></p>\n\n<p>Which was:</p>\n\n<pre><code>asset.register_mime_type 'application/javascript', extensions: ['.tmpl'], charset: :unicode\nasset.register_preprocessor 'application/javascript', JqueryTemplate\n</code></pre>\n\n<p>However, this attempt simply deals out breakages when trying to run the web application at all or test it on the CI. So obviously I've missed something.</p>\n\n<h3>Questions</h3>\n\n<ul>\n<li>Is there a simple syntactical approach I am missing here? </li>\n<li>It was unclear to me in the docs, although <code>register_engine</code> is deprecated in Sprockets 3, is it actually possible to migrate from <code>register_engine</code> while staying in Sprockets 3?</li>\n<li>If we are remaining on Sprockets 3 for the foreseeable future, is it kosher to silence this? Generally I work viewing deprecations as 'bugs that need fixing'</li>\n</ul>\n"}, {"tags": ["ruby-on-rails", "ruby", "pagination", "kaminari"], "comments": [{"owner": {"reputation": 413, "user_id": 5149471, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-Sqr06HaqS7s/AAAAAAAAAAI/AAAAAAAAABc/0GICbgbAH0A/photo.jpg?sz=128", "display_name": "Akash Pinnaka", "link": "https://stackoverflow.com/users/5149471/akash-pinnaka"}, "edited": false, "score": 0, "creation_date": 1524730829, "post_id": 49996863, "comment_id": 87092372, "body": "Have you used <code>.paginate</code> method on <code>@search</code>?"}], "owner": {"reputation": 11, "user_id": 9625912, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-uChMycNqow0/AAAAAAAAAAI/AAAAAAAAADA/1qLLUf7Erxs/photo.jpg?sz=128", "display_name": "Andrey Anischik", "link": "https://stackoverflow.com/users/9625912/andrey-anischik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 72, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1524715092, "creation_date": 1524558547, "last_edit_date": 1524715092, "question_id": 49996863, "link": "https://stackoverflow.com/questions/49996863/problems-with-pagination-rails", "title": "Problems with pagination Rails", "body": "<p>When I try to go to the next page, it redirects to board first page. This problem has appeared after adding sort and search. Maybe this is something wrong with routes. </p>\n\n<p><strong>BoardController</strong></p>\n\n<pre><code>class BoardController &lt; ApplicationController\n  def index\n    if params[:set_locale]\n      redirect_to board_url(locale: params[:set_locale])\n    else\n      @search = Ad.published.search(params[:q])\n      @ads = @search.result.page(params[:page])\n      @search.build_condition\n      @search.build_sort if @search.sorts.empty?\n    end\n  end\n\n  def search\n    index\n    render :index\n  end\nend\n</code></pre>\n\n<p><strong>Board Index.html.slim</strong></p>\n\n<pre><code>= search_form_for @search, url: search_ads_path, method: :post do |f|\n  = f.condition_fields do |c|\n    = render \"condition_fields\", f: c\n  .field\n   = t('.sort')\n   = f.sort_fields do |s|\n    = s.sort_select\n  .actions\n    = f.submit t('.look_for')\n\n  ...\n\n = paginate @ads\n</code></pre>\n\n<p><strong>_condition_fileds</strong></p>\n\n<pre><code>.field\n  = f.attribute_fields do |a|\n    = a.attribute_select associations: [:category]\n  = f.predicate_select\n  = f.value_fields do |v|\n    = v.text_field :value\n  = link_to t('.remove'), '#', class: \"remove_fields\"\n</code></pre>\n\n<p><strong>Routes</strong></p>\n\n<pre><code>Rails.application.routes.draw do\n  resources :users\n  get 'home/index'\n  get 'board/index'\n  scope '(:locale)' do\n    resources :images\n    devise_for :users\n    resources :categories\n    resources :ads do\n      collection do\n       get 'search'\n      end\n      collection { post :search, to: 'board#index' }\n    end\n    root to: 'board#index', as: 'board', via: :all\n  end\nend\n</code></pre>\n"}, {"tags": ["ruby", "vagrant"], "answers": [{"tags": [], "owner": {"reputation": 44774, "user_id": 4296747, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-muYS9LV5AoA/AAAAAAAAAAI/AAAAAAAACG4/KcTmlFyGWRI/photo.jpg?sz=128", "display_name": "Frederic Henri", "link": "https://stackoverflow.com/users/4296747/frederic-henri"}, "is_accepted": false, "score": 1, "last_activity_date": 1524642229, "creation_date": 1524642229, "answer_id": 50016670, "question_id": 49996721, "link": "https://stackoverflow.com/questions/49996721/vagrant-set-ip-address-in-loop-with-maths/50016670#50016670", "title": "vagrant set ip address in loop with maths", "body": "<p>This is more a ruby question than a vagrant question but you do your string interpolation wrong so the statement</p>\n\n<pre><code>$ip = \"10.1.10.#{i}+80\"\n</code></pre>\n\n<p>returns a string that is <code>10.1.10.3+80</code> and of course this is not a valid IP.</p>\n\n<p>what you're looking at is </p>\n\n<pre><code>ip = \"10.1.10.#{i+80}\"\n</code></pre>\n\n<p>which will make the right math.</p>\n\n<p>You can easily check in irb on your command line</p>\n\n<pre><code>irb(main):001:0&gt; num_instances = 3\n=&gt; 3\nirb(main):002:0&gt; (1..num_instances).each do |i|\nirb(main):003:1* ip = \"10.1.10.#{i+80}\"\nirb(main):004:1&gt; p ip\nirb(main):005:1&gt; end\n\"10.1.10.81\"\n\"10.1.10.82\"\n\"10.1.10.83\"\n=&gt; 1..3\n</code></pre>\n\n<p>PS: Note, you dont need all the <code>$</code> when you declare variables in ruby.</p>\n"}], "owner": {"reputation": 2607, "user_id": 1687633, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/60d2bf8cfba448b4227154c74fa8b12a?s=128&d=identicon&r=PG", "display_name": "KillerSnail", "link": "https://stackoverflow.com/users/1687633/killersnail"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 445, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1524642256, "creation_date": 1524558042, "last_edit_date": 1524642256, "question_id": 49996721, "link": "https://stackoverflow.com/questions/49996721/vagrant-set-ip-address-in-loop-with-maths", "title": "vagrant set ip address in loop with maths", "body": "<p>I am trying to write a script to set up a dynamic number of nodes in vagrant.</p>\n\n<p>so it runs as</p>\n\n<pre><code># -*- mode: ruby -*-\n# vi: set ft=ruby :\n\nVagrant.configure(\"2\") do |config|\n\n  $num_instances = 3\n\n  (1..$num_instances).each do |i|\n\n    $ip = \"10.1.10.#{i}+80\"\n    config.vm.define \"node#{i}\" do |node|\n      node.vm.box = \"generic/ubuntu1604\"\n\n      node.vm.provider :libvirt do |domain|\n        domain.memory = 1024\n        domain.cpus = 1\n        domain.nic_model_type = \"virtio\"\n        domain.kvm_hidden = true\n      end\n\n      node.vm.hostname = \"t2-node#{i}\"\n      node.vm.network \"public_network\",\n                    :ip =&gt; $ip,\n                    :type =&gt; \"bridge\" ,\n                    :dev =&gt; \"br1\",\n                    :mode =&gt; \"bridge\",\n                    :use_dhcp_assigned_default_route =&gt; true\n\n    end\n  end\nend\n</code></pre>\n\n<p>but I get an error: </p>\n\n<pre><code>Unknown interface eth1\nError: ??? prefix is expected rather than \"10.1.10.3+80/255.255.255.0\".\n</code></pre>\n\n<p>so I guess the addition for the <code>$1p</code> variable isn't being done properly?</p>\n\n<p>any ideas?</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 3, "creation_date": 1524555161, "post_id": 49995650, "comment_id": 87008014, "body": "There are several <code>fetch</code> methods. Please make clear which class you are referring to."}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 1, "creation_date": 1524556299, "post_id": 49995650, "comment_id": 87008726, "body": "Unless your hash has a default value, you can simply use <code>hsh[:key]</code>."}, {"owner": {"reputation": 646, "user_id": 6695861, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/845e32a9576a6670db748fb456c089e8?s=128&d=identicon&r=PG&f=1", "display_name": "P. Boro", "link": "https://stackoverflow.com/users/6695861/p-boro"}, "reply_to_user": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1524556648, "post_id": 49995650, "comment_id": 87008922, "body": "@Stefan there are several advantages of using <code>fetch</code> instead of <code>[]</code>"}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 1, "creation_date": 1524556751, "post_id": 49995650, "comment_id": 87008978, "body": "@P.Boro what are the advantages of using <code>hsh.fetch(:key, nil)</code> instead of <code>hsh[:key]</code>?"}, {"owner": {"reputation": 646, "user_id": 6695861, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/845e32a9576a6670db748fb456c089e8?s=128&d=identicon&r=PG&f=1", "display_name": "P. Boro", "link": "https://stackoverflow.com/users/6695861/p-boro"}, "reply_to_user": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1524556882, "post_id": 49995650, "comment_id": 87009044, "body": "@Stefan e.g. when we expect key to be always present. We can catch errors earlier in the stack and make it easier to debug this way. Google the topic - there are planty of resources ."}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1524557366, "post_id": 49995650, "comment_id": 87009316, "body": "@P.Boro <code>hsh.fetch(:key, nil)</code> doesn&#39;t raise an error if <code>:key</code> is missing, it just returns <code>nil</code>."}, {"owner": {"reputation": 646, "user_id": 6695861, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/845e32a9576a6670db748fb456c089e8?s=128&d=identicon&r=PG&f=1", "display_name": "P. Boro", "link": "https://stackoverflow.com/users/6695861/p-boro"}, "reply_to_user": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 1, "creation_date": 1524557791, "post_id": 49995650, "comment_id": 87009593, "body": "@Stefan Ah, you are totally right :) But I prefer to always use <code>Hash#fetch</code>. Imo <code>Hash#[]</code> is often too abused and used even when we require some values to be present. <code>fetch(:key, nil)</code> is more verbose. It tells other devs that we do it intentionally. But this is my personal opinion, I just like it this way and that&#39;s why I&#39;m asking this question :)"}, {"owner": {"reputation": 3320, "user_id": 4950680, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C8cEh.jpg?s=128&g=1", "display_name": "Martin Zinovsky", "link": "https://stackoverflow.com/users/4950680/martin-zinovsky"}, "reply_to_user": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 2, "creation_date": 1524560563, "post_id": 49995650, "comment_id": 87011258, "body": "@Stefan I also use Hash#fetch over Hash#[] for exactly same reasons. It says what keys are required in hash and for me its better to get key not found then undefined method on nil down the road. Also fetch(:key, nil) explicitly says that there might be nil and developer should play around that"}, {"owner": {"reputation": 5449, "user_id": 681520, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/701baebf68d1d7faa9f9def6a24fe356?s=128&d=identicon&r=PG", "display_name": "Kimmo Lehto", "link": "https://stackoverflow.com/users/681520/kimmo-lehto"}, "edited": false, "score": 3, "creation_date": 1524568858, "post_id": 49995650, "comment_id": 87016682, "body": "There&#39;s only one nil in memory. With <code>hash.fetch(:key) { nil }</code> there&#39;s now a block that returns nil in the memory too."}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 2, "creation_date": 1524602735, "post_id": 49995650, "comment_id": 87037576, "body": "By the way, I never understood these &quot;Which is more efficient&quot; questions. If someone wants to know which one of two pieces of code is more efficient, you just run both and see \u2026 which one is more efficient. Which is much more efficient than crafting a question on <a href=\"https://stackoverflow.com\">Stack Overflow</a>, and then waiting for others to do exactly the same thing you could have done yourself."}], "answers": [{"comments": [{"owner": {"reputation": 3320, "user_id": 4950680, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C8cEh.jpg?s=128&g=1", "display_name": "Martin Zinovsky", "link": "https://stackoverflow.com/users/4950680/martin-zinovsky"}, "edited": false, "score": 0, "creation_date": 1524555035, "post_id": 49995724, "comment_id": 87007918, "body": "<code>although nil would be the return value anyway if the :key is not found.</code> Nope. If there is no value for the key you get <code>KeyError</code>. Thats main difference between <a href=\"https://ruby-doc.org/core-2.5.0/Hash.html#method-i-fetch\" rel=\"nofollow noreferrer\">Hash#fetch</a> and <code>Hash#[]</code>"}], "tags": [], "owner": {"reputation": 11736, "user_id": 610351, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f4ee98206d84b25a83228e285c678f0?s=128&d=identicon&r=PG", "display_name": "Geoffroy", "link": "https://stackoverflow.com/users/610351/geoffroy"}, "is_accepted": false, "score": 5, "last_activity_date": 1524556169, "last_edit_date": 1524556169, "creation_date": 1524554798, "answer_id": 49995724, "question_id": 49995650, "link": "https://stackoverflow.com/questions/49995650/fetchkey-nil-vs-fetchkey-nil-which-is-more-efficient/49995724#49995724", "title": "fetch(:key, nil) vs fetch(:key) { nil }. Which is more efficient?", "body": "<p>That's some micro optimization you shouldn't worry about. The difference is more semantic. If the <code>:key</code> is not found,</p>\n\n<pre><code>fetch(:key, nil)\n</code></pre>\n\n<p>will return the value <code>nil</code>.</p>\n\n<pre><code>fetch(:key) {nil}\n</code></pre>\n\n<p>will evaluate the block and return the value, although <code>nil</code> would be the return value anyway if you use <code>hash[:key]</code></p>\n\n<p>For such a trivial case, I'd recommend using <code>fetch(:key, nil)</code>.</p>\n\n<p>Passing a block would enable you to compute a more complex value if and only if the <code>:key</code> is not found, e.g.:</p>\n\n<pre><code>fetch(:key) { read(url).parse.get('value') }\n</code></pre>\n\n<p>If you really want to know which one is more efficient, you may try benchmarking it, although if the block call is not optimized, I'm quite sure the block will be a bit slower.</p>\n"}, {"comments": [{"owner": {"reputation": 646, "user_id": 6695861, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/845e32a9576a6670db748fb456c089e8?s=128&d=identicon&r=PG&f=1", "display_name": "P. Boro", "link": "https://stackoverflow.com/users/6695861/p-boro"}, "edited": false, "score": 0, "creation_date": 1524563897, "post_id": 49997626, "comment_id": 87013442, "body": "Great man, that&#39;s what I needed! Thank you! :) So <code>fetch</code> with block is slower for missing keys. Gonna send your answer to person who told me to use blocks with nil :P"}, {"owner": {"reputation": 3320, "user_id": 4950680, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C8cEh.jpg?s=128&g=1", "display_name": "Martin Zinovsky", "link": "https://stackoverflow.com/users/4950680/martin-zinovsky"}, "edited": false, "score": 1, "creation_date": 1524564467, "post_id": 49997626, "comment_id": 87013799, "body": "specify ruby version please"}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "reply_to_user": {"reputation": 3320, "user_id": 4950680, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C8cEh.jpg?s=128&g=1", "display_name": "Martin Zinovsky", "link": "https://stackoverflow.com/users/4950680/martin-zinovsky"}, "edited": false, "score": 0, "creation_date": 1524565947, "post_id": 49997626, "comment_id": 87014771, "body": "@MartinZinovsky <code>ruby 2.5.0p0 (2017-12-25 revision 61468) [x86_64-darwin15]</code>"}], "tags": [], "owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "is_accepted": true, "score": 2, "last_activity_date": 1524560923, "creation_date": 1524560923, "answer_id": 49997626, "question_id": 49995650, "link": "https://stackoverflow.com/questions/49995650/fetchkey-nil-vs-fetchkey-nil-which-is-more-efficient/49997626#49997626", "title": "fetch(:key, nil) vs fetch(:key) { nil }. Which is more efficient?", "body": "<p>Out of curiosity:</p>\n\n<pre><code>require 'benchmark'\n\nN = 1_000_000\n\ndef benchmark(hsh)\n  Benchmark.bm(23) do |x|\n    x.report('hsh[:key]') { N.times { hsh[:key] } }\n    x.report('hsh.fetch(:key, nil)') { N.times { hsh.fetch(:key, nil ) } }\n    x.report('hsh.fetch(:key) { nil }') { N.times { hsh.fetch(:key) { nil } } }\n  end\nend\n\nputs\nputs ' Missing key '.center(69, '-')\nbenchmark({})\n\nputs\nputs ' Existing key '.center(69, '-')\nbenchmark({ key: 1 })\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>---------------------------- Missing key ----------------------------\n                              user     system      total        real\nhsh[:key]                 0.067592   0.000116   0.067708 (  0.067754)\nhsh.fetch(:key, nil)      0.075391   0.000078   0.075469 (  0.075515)\nhsh.fetch(:key) { nil }   0.132427   0.000238   0.132665 (  0.132850)\n\n--------------------------- Existing key ----------------------------\n                              user     system      total        real\nhsh[:key]                 0.058410   0.000007   0.058417 (  0.058422)\nhsh.fetch(:key, nil)      0.072805   0.000007   0.072812 (  0.072816)\nhsh.fetch(:key) { nil }   0.076052   0.000326   0.076378 (  0.076835)\n</code></pre>\n"}], "owner": {"reputation": 646, "user_id": 6695861, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/845e32a9576a6670db748fb456c089e8?s=128&d=identicon&r=PG&f=1", "display_name": "P. Boro", "link": "https://stackoverflow.com/users/6695861/p-boro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 0, "accepted_answer_id": 49997626, "answer_count": 2, "score": -2, "last_activity_date": 1524560923, "creation_date": 1524554576, "question_id": 49995650, "link": "https://stackoverflow.com/questions/49995650/fetchkey-nil-vs-fetchkey-nil-which-is-more-efficient", "title": "fetch(:key, nil) vs fetch(:key) { nil }. Which is more efficient?", "body": "<p>I once been told to use <code>fetch(:key) { nil }</code> instead of <code>fetch(:key, nil)</code> because even <code>nil</code> takes some memory and it's better to evaluate it only if key is not found.</p>\n\n<p>I am not sure if this is right approach. Doesn't this block take some memory too? Is there a way to check this?</p>\n"}, {"tags": ["ruby", "content-management-system", "shopify"], "answers": [{"tags": [], "owner": {"reputation": 10262, "user_id": 2329464, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07c1b92b1c0090716296537fc12d028b?s=128&d=identicon&r=PG", "display_name": "drip", "link": "https://stackoverflow.com/users/2329464/drip"}, "is_accepted": true, "score": 2, "last_activity_date": 1524552750, "creation_date": 1524552750, "answer_id": 49995139, "question_id": 49994631, "link": "https://stackoverflow.com/questions/49994631/shopify-bulk-file-upload-to-assets/49995139#49995139", "title": "Shopify bulk file upload to assets", "body": "<p>There is no actual bulk upload option for shopify.</p>\n\n<p>That said you can use <code>themekit</code> create a local instance of your theme and add the files in the asset folder and the themekit will start uploading each file separately in a queue.</p>\n\n<p>You can refer to <a href=\"https://shopify.github.io/themekit/\" rel=\"nofollow noreferrer\">https://shopify.github.io/themekit/</a></p>\n\n<p>In order for  this to work you need:</p>\n\n<ol>\n<li>themekit added to your local machine</li>\n<li>create a <code>private app</code> in your store ( from the Apps screen there is\nprivate app option at the bottom <code>Working with a developer on your\nshop? Manage private apps</code> )</li>\n<li>create a <code>config.yml</code> file in our local machine ( following this\nguide\n<a href=\"https://shopify.github.io/themekit/#configure-an-existing-theme\" rel=\"nofollow noreferrer\">https://shopify.github.io/themekit/#configure-an-existing-theme</a> )</li>\n<li>download your theme <code>theme download</code></li>\n<li>start watching it <code>theme watch</code></li>\n<li>paste your image files in the asset folder</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 3285, "user_id": 2423824, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0xeNZ.jpg?s=128&g=1", "display_name": "Josh Brown", "link": "https://stackoverflow.com/users/2423824/josh-brown"}, "is_accepted": false, "score": 2, "last_activity_date": 1524552840, "creation_date": 1524552840, "answer_id": 49995165, "question_id": 49994631, "link": "https://stackoverflow.com/questions/49994631/shopify-bulk-file-upload-to-assets/49995165#49995165", "title": "Shopify bulk file upload to assets", "body": "<p>You can use Shopify's <a href=\"https://help.shopify.com/api/reference/asset\" rel=\"nofollow noreferrer\">Assets API</a> to upload them, using a custom app or a tool like <a href=\"https://shopify.github.io/themekit/\" rel=\"nofollow noreferrer\">Themekit</a>.</p>\n"}], "owner": {"reputation": 408, "user_id": 5934971, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/681975301945404/picture?type=large", "display_name": "Christopher", "link": "https://stackoverflow.com/users/5934971/christopher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 831, "favorite_count": 0, "accepted_answer_id": 49995139, "answer_count": 2, "score": 0, "last_activity_date": 1524555568, "creation_date": 1524550652, "last_edit_date": 1524555568, "question_id": 49994631, "link": "https://stackoverflow.com/questions/49994631/shopify-bulk-file-upload-to-assets", "title": "Shopify bulk file upload to assets", "body": "<p>I wanted to upload my previous theme on shopify, which is a 401mb zip file. But the shopify only allows 50mb max upload. So I unzipped my theme, then moved away some files from their asset folder, making the theme lighter. Then rezipped it, and uploaded it.</p>\n\n<p>Now, I have successfully uploaded the theme. I need to upload all 300+ images that were moved from their asset files back to the uploaded theme. How do I do a bulk upload on the assets?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "activerecord", "polymorphism"], "comments": [{"owner": {"reputation": 648, "user_id": 10313894, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hVS6l.jpg?s=128&g=1", "display_name": "ARK", "link": "https://stackoverflow.com/users/10313894/ark"}, "edited": false, "score": 0, "creation_date": 1596722517, "post_id": 49993903, "comment_id": 111907183, "body": "I know it is a little late to say this but it may help someone: Your schema is a little askew. <code>Address</code> should not have <code>Friends</code>. This is not realistic. Think about it."}], "answers": [{"comments": [{"owner": {"reputation": 1271, "user_id": 6015670, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/900baefc5c7d81efc949c24d6e00ec7d?s=128&d=identicon&r=PG&f=1", "display_name": "Hugo", "link": "https://stackoverflow.com/users/6015670/hugo"}, "edited": false, "score": 0, "creation_date": 1524585533, "post_id": 49994042, "comment_id": 87028731, "body": "Is it normal then that by the very same query written using User.find_by(Address.last.addressable_id) is faster than Address.last.user ?"}], "tags": [], "owner": {"reputation": 5800, "user_id": 4287733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/835e993afb1e20c1981dd6b8b59ded2d?s=128&d=identicon&r=PG", "display_name": "Nermin", "link": "https://stackoverflow.com/users/4287733/nermin"}, "is_accepted": true, "score": 1, "last_activity_date": 1524555136, "last_edit_date": 1524555136, "creation_date": 1524547846, "answer_id": 49994042, "question_id": 49993903, "link": "https://stackoverflow.com/questions/49993903/active-record-get-associated-model-with-polymorphic-relation/49994042#49994042", "title": "Active Record get associated model with polymorphic relation", "body": "<pre><code>Address.new.addressable # will give the addressed object\n# Depending what was addressed it will return User or Friend\n</code></pre>\n\n<p>But to achieve this what you ask, you would need to create a method, and it would not be treated as a relation (could not be used in the join)</p>\n\n<pre><code>class Address &lt; ApplicationRecord\n  belongs_to :addressable, polymorphic: true\n\n  def user\n    addressable if addressable_type == User.name\n  end\n\n  def friend\n    addressable if addressable_type == Friend.name\n  end\nend\n</code></pre>\n\n<p>You can not call relations in class, you have to call them on an object.\n<code>Address.user # will throw an error</code></p>\n\n<p>Also <code>Address</code> has a relation type <code>belongs_to</code> so you do not have a list of friends for address, you have a list of addresses for a friend.</p>\n"}, {"tags": [], "owner": {"reputation": 301, "user_id": 6701820, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Q_9g0OuM9ZQ/AAAAAAAAAAI/AAAAAAAAAEw/ktX4E3hT93s/photo.jpg?sz=128", "display_name": "TheVinspro", "link": "https://stackoverflow.com/users/6701820/thevinspro"}, "is_accepted": false, "score": 1, "last_activity_date": 1524555837, "creation_date": 1524555837, "answer_id": 49996050, "question_id": 49993903, "link": "https://stackoverflow.com/questions/49993903/active-record-get-associated-model-with-polymorphic-relation/49996050#49996050", "title": "Active Record get associated model with polymorphic relation", "body": "<p>As you defined a polymorphic model. </p>\n\n<pre><code>class Address &lt; ApplicationRecord\n  belongs_to :addressable, polymorphic: true\nend\n</code></pre>\n\n<p><strong>One address will be associated with One instance of either <code>User</code> or <code>Friend</code></strong>.</p>\n\n<p>see <a href=\"http://guides.rubyonrails.org/association_basics.html#polymorphic-associations\" rel=\"nofollow noreferrer\">http://guides.rubyonrails.org/association_basics.html#polymorphic-associations</a></p>\n\n<blockquote>\n  <p><em>With polymorphic associations, a model can belong to more than one other model, on a single association.</em></p>\n</blockquote>\n\n<pre><code>Address.last.user or Address.first.friend\n</code></pre>\n\n<p>Here you defined a relation between address and friend.</p>\n\n<pre><code>class Friend &lt; ApplicationRecord\n  belongs_to :user\n  has_many :addresses, :as =&gt; :addressable, dependent: :destroy\nend\n</code></pre>\n\n<p>so each instance of <code>Friend</code> can have multiple instances of <code>Address</code> like:</p>\n\n<pre><code>Friend.last.addresses # office address, home address\n</code></pre>\n"}], "owner": {"reputation": 1271, "user_id": 6015670, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/900baefc5c7d81efc949c24d6e00ec7d?s=128&d=identicon&r=PG&f=1", "display_name": "Hugo", "link": "https://stackoverflow.com/users/6015670/hugo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 524, "favorite_count": 0, "accepted_answer_id": 49994042, "answer_count": 2, "score": 0, "last_activity_date": 1524583907, "creation_date": 1524547084, "last_edit_date": 1524583907, "question_id": 49993903, "link": "https://stackoverflow.com/questions/49993903/active-record-get-associated-model-with-polymorphic-relation", "title": "Active Record get associated model with polymorphic relation", "body": "<p>I have a polymorphic address model like so:</p>\n\n<pre><code>class Address &lt; ApplicationRecord\n  belongs_to :addressable, polymorphic: true\nend\n</code></pre>\n\n<p>As well as two possible associations, users and friends:</p>\n\n<pre><code>class User &lt; ApplicationRecord\n  has_many :friends, dependent: :destroy\n  has_one :address, :as =&gt; :addressable, dependent: :destroy\nend\n\nclass Friend &lt; ApplicationRecord\n  belongs_to :user\n  has_many :addresses, :as =&gt; :addressable, dependent: :destroy\nend\n</code></pre>\n\n<p>I would like to be able to get the friends or the user from the address. Both are related to the Address model.</p>\n\n<p>How could I have the following:</p>\n\n<pre><code>Address.last.user\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>Address.last.friends.first\n</code></pre>\n\n<p>Thank you</p>\n"}, {"tags": ["arrays", "ruby"], "comments": [{"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1524549900, "post_id": 49993190, "comment_id": 87005115, "body": "Your expected output is not valid Ruby expression."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 1, "creation_date": 1524551361, "post_id": 49993190, "comment_id": 87005788, "body": "...and it&#39;s not just the missing commas. As an aside, &quot;s&quot;, as in &quot;string&quot;, is not the best name for an array. &quot;a&quot;, &quot;arr&quot; or &quot;array&quot; would be more fitting."}], "answers": [{"tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": true, "score": 1, "last_activity_date": 1553459497, "last_edit_date": 1553459497, "creation_date": 1524543290, "answer_id": 49993319, "question_id": 49993190, "link": "https://stackoverflow.com/questions/49993190/best-way-to-turn-an-array-into-a-2d-array-in-ruby/49993319#49993319", "title": "Best way to turn an array into a 2D array in Ruby", "body": "<p>Use <a href=\"https://ruby-doc.org/core/Enumerable.html#method-i-each_slice\" rel=\"nofollow noreferrer\"><code>Enumerable#each_slice</code></a>:</p>\n\n<blockquote>\n  <p><strong>each_slice(n) { ... } \u2192 nil</strong><br>\n  <strong>each_slice(n) \u2192 an_enumerator</strong><br>\n  Iterates the given block for each slice of <code>n</code> elements. If no block is given, returns an enumerator.</p>\n</blockquote>\n\n<p>So you'd say:</p>\n\n<pre><code>s.each_slice(2).to_a\n</code></pre>\n\n<p>or</p>\n\n<pre><code>s.each_slice(2).entries\n</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 3630116, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf3117d471c5880aaace2e3cffe4f6c7?s=128&d=identicon&r=PG&f=1", "display_name": "cooltop101", "link": "https://stackoverflow.com/users/3630116/cooltop101"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 0, "closed_date": 1524551467, "accepted_answer_id": 49993319, "answer_count": 1, "score": 0, "last_activity_date": 1553459497, "creation_date": 1524542376, "last_edit_date": 1524549870, "question_id": 49993190, "link": "https://stackoverflow.com/questions/49993190/best-way-to-turn-an-array-into-a-2d-array-in-ruby", "closed_reason": "Duplicate", "title": "Best way to turn an array into a 2D array in Ruby", "body": "<p>Say I have an array:</p>\n\n<pre><code>s = [\"Abc\", 123, \"Abc\", 123, \"Abc\", 123, \"Abc\", 123, \"Abc\", 123]\n</code></pre>\n\n<p>What would be the best way to turn it into</p>\n\n<pre><code>array = [[\"Abc\",123][\"Abc\",123][\"Abc\",123][\"Abc\",123][\"Abc\",123]\n</code></pre>\n"}, {"tags": ["mysql", "ruby"], "comments": [{"owner": {"reputation": 2946, "user_id": 1430057, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/Tbizp.jpg?s=128&g=1", "display_name": "Subash", "link": "https://stackoverflow.com/users/1430057/subash"}, "edited": false, "score": 0, "creation_date": 1524534701, "post_id": 49992295, "comment_id": 87001236, "body": "Did you check if you have the <code>lmysqlclient</code> dependency installed ?"}], "answers": [{"tags": [], "owner": {"reputation": 127444, "user_id": 492405, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/SSPGk.png?s=128&g=1", "display_name": "vcsjones", "link": "https://stackoverflow.com/users/492405/vcsjones"}, "is_accepted": true, "score": 1, "last_activity_date": 1524534754, "creation_date": 1524534754, "answer_id": 49992321, "question_id": 49992295, "link": "https://stackoverflow.com/questions/49992295/unable-to-install-ruby-mysql-gem-on-mac-os-x/49992321#49992321", "title": "Unable to install Ruby MySQL Gem on Mac OS X", "body": "<p>You don't have the <code>mysqlclient</code> library installed. The easiest way to get it on your machine is to use <a href=\"https://brew.sh/\" rel=\"nofollow noreferrer\">Homebrew</a> and do <code>brew install mysql</code>.</p>\n\n<p>The <code>mysql</code> gem has native extensions - that is, when the gem is installed, native parts of it are compiled. You will need a C/C++ toolchain as well on your Mac for this to work. If you have XCode installed, you should be good to go as it provides clang.</p>\n"}], "owner": {"reputation": 11353, "user_id": 3787051, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/k2G2V.png?s=128&g=1", "display_name": "Alex Harvey", "link": "https://stackoverflow.com/users/3787051/alex-harvey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 49992321, "answer_count": 1, "score": 1, "last_activity_date": 1524534754, "creation_date": 1524534588, "question_id": 49992295, "link": "https://stackoverflow.com/questions/49992295/unable-to-install-ruby-mysql-gem-on-mac-os-x", "title": "Unable to install Ruby MySQL Gem on Mac OS X", "body": "<p>When attempting to install the Ruby MySQL Gem on Mac OS X:</p>\n\n<pre><code># ~/.rvm/gems/ruby-2.1.4/extensions/x86_64-darwin-14/2.1.0-static/mysql-2.9.1/mkmf.log\nfind_library: checking for mysql_query() in -lmysqlclient... -------------------- no\n</code></pre>\n\n<p>Similar messages about the same missing function throughout mkmf.log.</p>\n\n<p>I assume missing dependencies but I don't know what they would be or where this would be documented. Google doesn't seem to help. And the project is unmaintained.</p>\n\n<p>Tried Ruby 2.1.4, 2.2.7, 2.4.1.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "database"], "comments": [{"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1524549938, "post_id": 49992092, "comment_id": 87005129, "body": "What is your question?"}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1524551719, "post_id": 49992092, "comment_id": 87005985, "body": "Where does the migration file and its content come from? Did you run <code>rails generate</code>? If so, have you edited or renamed the file afterward?"}], "answers": [{"comments": [{"owner": {"reputation": 5962, "user_id": 115159, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ac02a81e50f368f6d5c7a14b99ce2469?s=128&d=identicon&r=PG", "display_name": "Dharam Gollapudi", "link": "https://stackoverflow.com/users/115159/dharam-gollapudi"}, "edited": false, "score": 0, "creation_date": 1524536179, "post_id": 49992126, "comment_id": 87001480, "body": "Yes, the name part of the filename, after the timestamp should match the class name, that\u2019s how Rails knows which class to call. BTW, in rails, you name the file names all lower case, you model Cheese, should be in a file named cheese.rb, not Cheese.rb."}, {"owner": {"reputation": 136, "user_id": 3540495, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ON2ijeeDNqw/AAAAAAAAAAI/AAAAAAAAAR8/9HRK2QEV9o4/photo.jpg?sz=128", "display_name": "ArMD", "link": "https://stackoverflow.com/users/3540495/armd"}, "edited": false, "score": 0, "creation_date": 1524538264, "post_id": 49992126, "comment_id": 87001940, "body": "Also try to use Rails generate migration"}, {"owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 2, "creation_date": 1524546783, "post_id": 49992126, "comment_id": 87003972, "body": "It would probably have been a better idea to rename the migration to <code>20180423222002_create_cheeses.rb</code> because that migration file includes a migration that creates cheeses. Whereas a <code>Cheeses</code> class implies that it handles a collection of cheeses. You might need that name in your app later on."}], "tags": [], "owner": {"reputation": 632, "user_id": 9170938, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/uWg5N.png?s=128&g=1", "display_name": "Tsardines", "link": "https://stackoverflow.com/users/9170938/tsardines"}, "is_accepted": false, "score": -1, "last_activity_date": 1524533241, "creation_date": 1524533241, "answer_id": 49992126, "question_id": 49992092, "link": "https://stackoverflow.com/questions/49992092/nameerror-uninitialized-constant/49992126#49992126", "title": "NameError: uninitialized constant &quot;________&quot;", "body": "<p>Update: I figured it out. :|</p>\n\n<p>The first line is supposed to read <code>class Cheeses.</code></p>\n\n<pre><code>class Cheeses &lt; ActiveRecord::Migration[5.2]\n  def change\n    create_table :cheeses do |t|\n      t.string :name\n      t.string :milk_type\n      t.string :image_url\n      t.string :description\n\n      t.timestamps\n    end\n  end\nend\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 301, "user_id": 6701820, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Q_9g0OuM9ZQ/AAAAAAAAAAI/AAAAAAAAAEw/ktX4E3hT93s/photo.jpg?sz=128", "display_name": "TheVinspro", "link": "https://stackoverflow.com/users/6701820/thevinspro"}, "is_accepted": true, "score": 5, "last_activity_date": 1524556424, "creation_date": 1524556424, "answer_id": 49996227, "question_id": 49992092, "link": "https://stackoverflow.com/questions/49992092/nameerror-uninitialized-constant/49996227#49996227", "title": "NameError: uninitialized constant &quot;________&quot;", "body": "<p>Rename the model's file name.</p>\n\n<p><code>straight_curdin/app/models/Cheese.rb</code> to <code>straight_curdin/app/models/cheese.rb</code>. as rails convention model's file name should be in small letters.</p>\n\n<pre><code>class Cheese &lt; ApplicationRecord\nend\n</code></pre>\n"}], "owner": {"reputation": 632, "user_id": 9170938, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/uWg5N.png?s=128&g=1", "display_name": "Tsardines", "link": "https://stackoverflow.com/users/9170938/tsardines"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 788, "favorite_count": 1, "accepted_answer_id": 49996227, "answer_count": 2, "score": -1, "last_activity_date": 1524556424, "creation_date": 1524532915, "last_edit_date": 1524550009, "question_id": 49992092, "link": "https://stackoverflow.com/questions/49992092/nameerror-uninitialized-constant", "title": "NameError: uninitialized constant &quot;________&quot;", "body": "<p>I'm working on a homework assignment and when I attempt to run <code>rails db:migrate</code> I'm getting the error, <code>unitialized constant Cheeses</code>.</p>\n\n<p>I believe something's misnamed.</p>\n\n<p>Here are my files:</p>\n\n<p><strong>straight_curdin/db/migrate/20180423222002_cheeses.rb</strong></p>\n\n<pre><code>class CreateCheeses &lt; ActiveRecord::Migration[5.2]\n  def change\n    create_table :cheeses do |t|\n      t.string :name\n      t.string :milk_type\n      t.string :image_url\n      t.string :description\n\n      t.timestamps\n    end\n  end\nend\n</code></pre>\n\n<p><strong>straight_curdin/app/models/Cheese.rb</strong></p>\n\n<pre><code>class Cheese &lt; ApplicationRecord\nend\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-5"], "comments": [{"owner": {"reputation": 26120, "user_id": 219883, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/c35b5b0f9e7cce48864f4f1545ead995?s=128&d=identicon&r=PG", "display_name": "Taryn East", "link": "https://stackoverflow.com/users/219883/taryn-east"}, "edited": false, "score": 0, "creation_date": 1524547293, "post_id": 49991597, "comment_id": 87004136, "body": "This question is a little beyond S/O to help you with... but yes, that is the general idea of how to solve the problem. 1) accept time with timezone, 2) convert to UTC when storing, 3) convert to local when displaying."}, {"owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "edited": false, "score": 0, "creation_date": 1524547893, "post_id": 49991597, "comment_id": 87004345, "body": "For example, I would use relative time. I mean the server should use his reference time and each client its own. You then need to pick the current client time for doing calculation against the server time. So, times on server are consistent and clients just see a converted time. To get the client side time I guess you need some javascript to send this information to rails. Maybe <a href=\"https://github.com/kbaum/browser-timezone-rails\" rel=\"nofollow noreferrer\">this gem</a> can give some hint."}], "answers": [{"tags": [], "owner": {"reputation": 301, "user_id": 6701820, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Q_9g0OuM9ZQ/AAAAAAAAAAI/AAAAAAAAAEw/ktX4E3hT93s/photo.jpg?sz=128", "display_name": "TheVinspro", "link": "https://stackoverflow.com/users/6701820/thevinspro"}, "is_accepted": true, "score": 0, "last_activity_date": 1524560672, "creation_date": 1524560672, "answer_id": 49997543, "question_id": 49991597, "link": "https://stackoverflow.com/questions/49991597/supporting-timezones-in-rails/49997543#49997543", "title": "Supporting Timezones in Rails", "body": "<p>@Cannon Moyer if you see table structure of any table. updated_at and created_at columns store <strong>timestamp without timezone</strong>. When displaying, These values are automatically converted with timezone as application's timezone(UTC or IST) is set. so don't need to worry about time when a given user accesses/creates records.</p>\n\n<p>For your case as @iGian suggested <a href=\"https://github.com/kbaum/browser-timezone-rails\" rel=\"nofollow noreferrer\">this gem</a> is useful for you. It sets the Rails timezone to the browser's configured timezone for each request.</p>\n"}], "owner": {"reputation": 2960, "user_id": 7426461, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/Ldwxy.jpg?s=128&g=1", "display_name": "Cannon Moyer", "link": "https://stackoverflow.com/users/7426461/cannon-moyer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 1, "accepted_answer_id": 49997543, "answer_count": 1, "score": 2, "last_activity_date": 1524560672, "creation_date": 1524528433, "question_id": 49991597, "link": "https://stackoverflow.com/questions/49991597/supporting-timezones-in-rails", "title": "Supporting Timezones in Rails", "body": "<p>I've got an application that allows users within the same company to create job records, view, edit, and search these jobs. The users are spread out all over the United States. A user in California may need to update a job for a user in New York and visa versa.</p>\n\n<p>I read through an article that suggested setting <code>Time.zone</code> in the controller with a before action, but if I do this, I assume that Rails would then save that record in the current time zone for like the California user. Then, if the New York user updates the same record then <code>updated_at</code> time would then be in a different time zone than the <code>created_at</code> attribute. Ideally, I see all of my records having a UTC time and then when a given user accesses/creates records, the time is displayed to them in their set timezone but saved in the database as UTC. I'm not sure how to do this or if it's even the correct approach. Can anyone provide some guidance?</p>\n\n<p>Thanks in advance. </p>\n"}, {"tags": ["ruby-on-rails", "ruby", "api", "faraday", "mashape"], "comments": [{"owner": {"reputation": 3320, "user_id": 4950680, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C8cEh.jpg?s=128&g=1", "display_name": "Martin Zinovsky", "link": "https://stackoverflow.com/users/4950680/martin-zinovsky"}, "edited": false, "score": 0, "creation_date": 1524552106, "post_id": 49991485, "comment_id": 87006217, "body": "Include paths to these files in your question.  Also did you try to move <code>Request</code> under <code>Spoonacular::Recipe</code> namespace? And if it shouldnt be there did you try to refer to global scope with <code>::Request.where(...)</code>?"}, {"owner": {"reputation": 3320, "user_id": 4950680, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C8cEh.jpg?s=128&g=1", "display_name": "Martin Zinovsky", "link": "https://stackoverflow.com/users/4950680/martin-zinovsky"}, "edited": false, "score": 0, "creation_date": 1524560924, "post_id": 49991485, "comment_id": 87011509, "body": "I bet path to <code>request.rb</code> contains <code>&#47;spoonacular&#47;recipe&#47;</code> so rails tries to resolve <code>Request</code> constant based on that"}, {"owner": {"reputation": 3320, "user_id": 4950680, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C8cEh.jpg?s=128&g=1", "display_name": "Martin Zinovsky", "link": "https://stackoverflow.com/users/4950680/martin-zinovsky"}, "edited": false, "score": 0, "creation_date": 1524572577, "post_id": 49991485, "comment_id": 87019160, "body": "So did <code>::Request.where(...)</code> work? Also I would suggest to move <code>request.rb</code> and <code>connection.rb</code> to <code>app&#47;services&#47;spoonacular&#47;</code> namespace. In that case you call it like <code>Spoonacular::Request</code>"}, {"owner": {"reputation": 327, "user_id": 6606895, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/869a5553f346bad7fe4cb8c49543e29d?s=128&d=identicon&r=PG", "display_name": "Kristis", "link": "https://stackoverflow.com/users/6606895/kristis"}, "reply_to_user": {"reputation": 3320, "user_id": 4950680, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C8cEh.jpg?s=128&g=1", "display_name": "Martin Zinovsky", "link": "https://stackoverflow.com/users/4950680/martin-zinovsky"}, "edited": false, "score": 0, "creation_date": 1524576776, "post_id": 49991485, "comment_id": 87022292, "body": "You mean like this?  response = ::Request.where(&#39;recipes/random&#39;, cache, query.merge({ number: MAX_LIMIT })) I moved all files to spoonacular folder and now I get error --&gt; Unable to autoload constant Spoonacular::Request"}, {"owner": {"reputation": 3320, "user_id": 4950680, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C8cEh.jpg?s=128&g=1", "display_name": "Martin Zinovsky", "link": "https://stackoverflow.com/users/4950680/martin-zinovsky"}, "edited": false, "score": 0, "creation_date": 1524576916, "post_id": 49991485, "comment_id": 87022399, "body": "Did you encircle <code>class Request</code> with <code>module Spoonacular</code> after you move <code>request.rb</code>?"}, {"owner": {"reputation": 327, "user_id": 6606895, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/869a5553f346bad7fe4cb8c49543e29d?s=128&d=identicon&r=PG", "display_name": "Kristis", "link": "https://stackoverflow.com/users/6606895/kristis"}, "reply_to_user": {"reputation": 3320, "user_id": 4950680, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C8cEh.jpg?s=128&g=1", "display_name": "Martin Zinovsky", "link": "https://stackoverflow.com/users/4950680/martin-zinovsky"}, "edited": false, "score": 0, "creation_date": 1524577117, "post_id": 49991485, "comment_id": 87022520, "body": "Yes, I did it now. Now I get same error as before --&gt; undefined method `map&#39; for &lt;ActionController::Parameters {&quot;number&quot;=&gt;12} permitted: false&gt;:ActionController::Parameters"}], "answers": [{"comments": [{"owner": {"reputation": 327, "user_id": 6606895, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/869a5553f346bad7fe4cb8c49543e29d?s=128&d=identicon&r=PG", "display_name": "Kristis", "link": "https://stackoverflow.com/users/6606895/kristis"}, "edited": false, "score": 0, "creation_date": 1524579667, "post_id": 50003730, "comment_id": 87024419, "body": "I made changes like you said, but still same problem. I updated question."}, {"owner": {"reputation": 3320, "user_id": 4950680, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C8cEh.jpg?s=128&g=1", "display_name": "Martin Zinovsky", "link": "https://stackoverflow.com/users/4950680/martin-zinovsky"}, "reply_to_user": {"reputation": 327, "user_id": 6606895, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/869a5553f346bad7fe4cb8c49543e29d?s=128&d=identicon&r=PG", "display_name": "Kristis", "link": "https://stackoverflow.com/users/6606895/kristis"}, "edited": false, "score": 0, "creation_date": 1524584315, "post_id": 50003730, "comment_id": 87027884, "body": "@Kristis I dont really see what you have changed"}, {"owner": {"reputation": 327, "user_id": 6606895, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/869a5553f346bad7fe4cb8c49543e29d?s=128&d=identicon&r=PG", "display_name": "Kristis", "link": "https://stackoverflow.com/users/6606895/kristis"}, "edited": false, "score": 0, "creation_date": 1524584652, "post_id": 50003730, "comment_id": 87028126, "body": "I made changes in controller query method and in recipe.rb file self.random method. Also, I encircled connection and request class in module Spoonacular."}, {"owner": {"reputation": 3320, "user_id": 4950680, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C8cEh.jpg?s=128&g=1", "display_name": "Martin Zinovsky", "link": "https://stackoverflow.com/users/4950680/martin-zinovsky"}, "reply_to_user": {"reputation": 327, "user_id": 6606895, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/869a5553f346bad7fe4cb8c49543e29d?s=128&d=identicon&r=PG", "display_name": "Kristis", "link": "https://stackoverflow.com/users/6606895/kristis"}, "edited": false, "score": 0, "creation_date": 1524588532, "post_id": 50003730, "comment_id": 87030448, "body": "@Kristis There is still old version of <code>query</code> method in your question."}, {"owner": {"reputation": 3320, "user_id": 4950680, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C8cEh.jpg?s=128&g=1", "display_name": "Martin Zinovsky", "link": "https://stackoverflow.com/users/4950680/martin-zinovsky"}, "reply_to_user": {"reputation": 327, "user_id": 6606895, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/869a5553f346bad7fe4cb8c49543e29d?s=128&d=identicon&r=PG", "display_name": "Kristis", "link": "https://stackoverflow.com/users/6606895/kristis"}, "edited": false, "score": 0, "creation_date": 1524588789, "post_id": 50003730, "comment_id": 87030602, "body": "@Kristis Check out <a href=\"http://guides.rubyonrails.org/action_controller_overview.html#strong-parameters\" rel=\"nofollow noreferrer\">RubyOnRails Guide about strong params</a>. It will help you understand your second issue"}, {"owner": {"reputation": 327, "user_id": 6606895, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/869a5553f346bad7fe4cb8c49543e29d?s=128&d=identicon&r=PG", "display_name": "Kristis", "link": "https://stackoverflow.com/users/6606895/kristis"}, "edited": false, "score": 0, "creation_date": 1524621976, "post_id": 50003730, "comment_id": 87042421, "body": "I made query permitted with this code --&gt; params.permit(query: {}) but getting same error --&gt; undefined method `map&#39; for &lt;ActionController::Parameters {&quot;number&quot;=&gt;12} permitted: true&gt;:ActionController::Parameters"}, {"owner": {"reputation": 3320, "user_id": 4950680, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C8cEh.jpg?s=128&g=1", "display_name": "Martin Zinovsky", "link": "https://stackoverflow.com/users/4950680/martin-zinovsky"}, "reply_to_user": {"reputation": 327, "user_id": 6606895, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/869a5553f346bad7fe4cb8c49543e29d?s=128&d=identicon&r=PG", "display_name": "Kristis", "link": "https://stackoverflow.com/users/6606895/kristis"}, "edited": false, "score": 0, "creation_date": 1524628679, "post_id": 50003730, "comment_id": 87043928, "body": "@Kristis Try to convert it to Hash object with <code>query.to_h</code>"}, {"owner": {"reputation": 1139, "user_id": 4468463, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/mFyjG.jpg?s=128&g=1", "display_name": "Liz", "link": "https://stackoverflow.com/users/4468463/liz"}, "edited": false, "score": 0, "creation_date": 1549783194, "post_id": 50003730, "comment_id": 96021943, "body": "@MartinZinovsky I&#39;m following the same tutorial (apparently) and getting the same errors.  Adding <code>to_h</code> gives the error: <code>unable to convert unpermitted parameters to hash</code>"}], "tags": [], "owner": {"reputation": 3320, "user_id": 4950680, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C8cEh.jpg?s=128&g=1", "display_name": "Martin Zinovsky", "link": "https://stackoverflow.com/users/4950680/martin-zinovsky"}, "is_accepted": true, "score": 1, "last_activity_date": 1524628777, "last_edit_date": 1524628777, "creation_date": 1524578667, "answer_id": 50003730, "question_id": 49991485, "link": "https://stackoverflow.com/questions/49991485/undefined-method-map-api-request/50003730#50003730", "title": "undefined method `map&#39; api request", "body": "<p>You have 2 separate errors here. </p>\n\n<blockquote>\n  <p>uninitialized constant Spoonacular::Recipe::Request</p>\n</blockquote>\n\n<p>This one you can fix by explicitly setting top-level scope for <code>Request</code> class:</p>\n\n<pre><code>::Request.where(...)\n</code></pre>\n\n<p>It applies if you keep <code>Request</code> file in <code>app/spoonacular/request.rb</code>. But I suggest to move it to <code>app/services/spoonacular/</code> where all your other <code>spoonacular</code> related classes are. So in this case you need to encircle <code>class Request</code> in <code>module Spoonacular</code>. After that you can call it like that:</p>\n\n<pre><code>Spoonacular::Request.where(...)\n</code></pre>\n\n<p>Same goes for class <code>Connection</code>.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/5032844/ruby-what-does-prefix-do\">SO answer about scope resolution operator</a></p>\n\n<hr>\n\n<blockquote>\n  <p>undefined method `map' for {\"number\"=>12} permitted:\n  false>:ActionController::Parameters</p>\n</blockquote>\n\n<p>This one comes from private <code>query</code> method in <code>recipes_controller.rb</code>. <code>params</code> is <code>ActionController::Parameters</code> object and in order to retrieve values from it you need to permit them first:</p>\n\n<pre><code>def query\n  params.permit(:query).to_h\nend\n</code></pre>\n\n<p>Now it should return <code>Hash</code> object. </p>\n\n<p><a href=\"https://stackoverflow.com/questions/34949505/rails-5-unable-to-retrieve-hash-values-from-parameter\">Here is detailed answer</a> on SO about that</p>\n\n<p><a href=\"http://guides.rubyonrails.org/action_controller_overview.html#strong-parameters\" rel=\"nofollow noreferrer\">RubyOnRails Guide about strong params</a></p>\n"}], "owner": {"reputation": 327, "user_id": 6606895, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/869a5553f346bad7fe4cb8c49543e29d?s=128&d=identicon&r=PG", "display_name": "Kristis", "link": "https://stackoverflow.com/users/6606895/kristis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 460, "favorite_count": 1, "closed_date": 1524638682, "accepted_answer_id": 50003730, "answer_count": 1, "score": 0, "last_activity_date": 1524628777, "creation_date": 1524527485, "last_edit_date": 1524589647, "question_id": 49991485, "link": "https://stackoverflow.com/questions/49991485/undefined-method-map-api-request", "closed_reason": "Not suitable for this site", "title": "undefined method `map&#39; api request", "body": "<p>I followed tutorial how to integrate 3rd party api with a ruby on rails but I get an error </p>\n\n<blockquote>\n  <p>undefined method `map' for \n  \n  <p>{\"number\"=>12} permitted: false>:ActionController::Parameters</p>\n</blockquote>\n\n<p>which points to <strong>request.rb</strong></p>\n\n<pre><code>query_string = query.map{|k,v| \"#{k}=#{v}\"}.join(\"&amp;\")\n</code></pre>\n\n<p>Full code</p>\n\n<p><strong>recipes_controller.rb</strong></p>\n\n<pre><code>class RecipesController &lt; ApplicationController\n\n  def index\n    @tag = query.fetch(:tags, 'all')\n    @refresh_params = refresh_params\n    @recipes, @errors = Spoonacular::Recipe.random(query, clear_cache)\n  end\n\n  def show\n    @recipe = Spoonacular::Recipe.find(params[:id])\n  end\n\n  private\n   def query\n     params.permit(:query).fetch(:query, {})\n   end\n\n  def clear_cache\n    params[:clear_cache].present?\n  end\n\n  def refresh_params\n    refresh = { clear_cache: true }\n    refresh.merge!({ query: query }) if query.present?\n    refresh\n  end\nend\n</code></pre>\n\n<p><strong>app/services/spoonacular/recipes.rb</strong></p>\n\n<pre><code>module Spoonacular\n  class Recipe &lt; Base\n    attr_accessor :aggregate_likes,\n                  :dairy_free,\n                  :gluten_free,\n                  :id,\n                  :image,\n                  :ingredients,\n                  :instructions,\n                  :ready_in_minutes,\n                  :title,\n                  :vegan,\n                  :vegetarian\n\n    MAX_LIMIT = 12\n    CACHE_DEFAULTS = { expires_in: 7.days, force: false }\n\n    def self.random(query = {}, clear_cache)\n      cache = CACHE_DEFAULTS.merge({ force: clear_cache })\n      response = Spoonacular::Request.where('recipes/random', cache, query.merge({ number: MAX_LIMIT }))\n      recipes = response.fetch('recipes', []).map { |recipe| Recipe.new(recipe) }\n      [ recipes, response[:errors] ]\n    end\n\n    def self.find(id)\n      response = Spoonacular::Request.get(\"recipes/#{id}/information\", CACHE_DEFAULTS)\n      Recipe.new(response)\n    end\n\n    def initialize(args = {})\n      super(args)\n      self.ingredients = parse_ingredients(args)\n      self.instructions = parse_instructions(args)\n    end\n\n    def parse_ingredients(args = {})\n      args.fetch(\"extendedIngredients\", []).map { |ingredient| Ingredient.new(ingredient) }\n    end\n\n    def parse_instructions(args = {})\n      instructions = args.fetch(\"analyzedInstructions\", [])\n      if instructions.present?\n        steps = instructions.first.fetch(\"steps\", [])\n        steps.map { |instruction| Instruction.new(instruction) }\n      else\n        []\n      end\n    end\n  end\nend\n</code></pre>\n\n<p><strong>app/services/spoonacular/base.rb</strong></p>\n\n<pre><code>module Spoonacular\n  class Base\n    attr_accessor :errors\n\n    def initialize(args = {})\n      args.each do |name, value|\n        attr_name = name.to_s.underscore\n        send(\"#{attr_name}=\", value) if respond_to?(\"#{attr_name}=\")\n      end\n    end\n  end\nend\n</code></pre>\n\n<p><strong>app/services/spoonacular/request.rb</strong></p>\n\n<pre><code>module Spoonacular\n  class Request\n    class &lt;&lt; self\n      def where(resource_path, cache, query = {}, options = {})\n        response, status = get_json(resource_path, cache, query)\n        status == 200 ? response : errors(response)\n      end\n\n      def get(id, cache)\n        response, status = get_json(id, cache)\n        status == 200 ? response : errors(response)\n      end\n\n      def errors(response)\n        error = { errors: { status: response[\"status\"], message: response[\"message\"] } }\n        response.merge(error)\n      end\n\n      def get_json(root_path, cache, query = {})\n        query_string = query.map{|k,v| \"#{k}=#{v}\"}.join(\"&amp;\")\n        path = query.empty?? root_path : \"#{root_path}?#{query_string}\"\n        response =  Rails.cache.fetch(path, expires_in: cache[:expires_in], force: cache[:force]) do\n          api.get(path)\n        end\n        [JSON.parse(response.body), response.status]\n      end\n\n      def api\n        Connection.api\n      end\n    end\n  end\nend\n</code></pre>\n\n<p><strong>app/services/spoonacular/connection.rb</strong></p>\n\n<pre><code>require 'faraday'\nrequire 'json'\nmodule Spoonacular\n  class Connection\n    BASE = 'https://spoonacular-recipe-food-nutrition-v1.p.mashape.com'\n\n    def self.api\n      Faraday.new(url: BASE) do |faraday|\n        faraday.response :logger\n        faraday.adapter Faraday.default_adapter\n        faraday.headers['Content-Type'] = 'application/json'\n        faraday.headers['X-Mashape-Key'] ='key'\n      end\n    end\n  end\nend\n</code></pre>\n\n<p>Thank you for any help.</p>\n"}, {"tags": ["arrays", "ruby"], "answers": [{"comments": [{"owner": {"reputation": 172, "user_id": 6831572, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/d0bdcbb13d6f5b35393b736e4d030f44?s=128&d=identicon&r=PG&f=1", "display_name": "Zonet", "link": "https://stackoverflow.com/users/6831572/zonet"}, "edited": false, "score": 0, "creation_date": 1524522884, "post_id": 49990822, "comment_id": 86998339, "body": "I had no idea you could pass <code>uniq</code> a block. Wow haha. Thanks, Phlip!"}, {"owner": {"reputation": 5141, "user_id": 193980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/aafa8848c4b764f080b1b31a51eab73d?s=128&d=identicon&r=PG", "display_name": "Phlip", "link": "https://stackoverflow.com/users/193980/phlip"}, "edited": false, "score": 0, "creation_date": 1524523155, "post_id": 49990822, "comment_id": 86998402, "body": "I didn&#39;t know it either. But my editor, RubyMine, lets me enter <code>[].uniq</code> and hit Control+B, and it takes me to the source, with its documentation, faster than Google could."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 1, "creation_date": 1524523529, "post_id": 49990822, "comment_id": 86998503, "body": "lainK, <a href=\"http://ruby-doc.org/core-2.4.0/Array.html#method-i-uniq\" rel=\"nofollow noreferrer\">Array#uniq</a> has permitted the use of a block for some time. <a href=\"http://ruby-doc.org/core-2.4.0/Enumerable.html#method-i-uniq\" rel=\"nofollow noreferrer\">Enumerable#uniq</a> made its debut in Ruby v2.4 and it too could take a block."}], "tags": [], "owner": {"reputation": 5141, "user_id": 193980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/aafa8848c4b764f080b1b31a51eab73d?s=128&d=identicon&r=PG", "display_name": "Phlip", "link": "https://stackoverflow.com/users/193980/phlip"}, "is_accepted": true, "score": 5, "last_activity_date": 1524522507, "creation_date": 1524522507, "answer_id": 49990822, "question_id": 49990787, "link": "https://stackoverflow.com/questions/49990787/retain-first-matching-element-of-array/49990822#49990822", "title": "Retain first matching element of array", "body": "<p>Here's from the commentary documentation for Array#uniq:</p>\n\n<pre><code>b = [[\"student\",\"sam\"], [\"student\",\"george\"], [\"teacher\",\"matz\"]]\nb.uniq { |s| s.first } # =&gt; [[\"student\", \"sam\"], [\"teacher\", \"matz\"]]\n</code></pre>\n\n<p>So it appears that <code>b.uniq{ |s| s[0] }</code> would unique-ify an array by the first character of each string.</p>\n"}, {"comments": [{"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 2, "creation_date": 1524558909, "post_id": 49993901, "comment_id": 87010258, "body": "Internally, <code>uniq</code> also uses a hash to remove the duplicates. Although more like <code>b.each_with_object({}) { |s, h| h[s.first] ||= s }.values</code> where <code>s.first</code> is the return value from the given block."}], "tags": [], "owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "is_accepted": false, "score": 1, "last_activity_date": 1524547073, "creation_date": 1524547073, "answer_id": 49993901, "question_id": 49990787, "link": "https://stackoverflow.com/questions/49990787/retain-first-matching-element-of-array/49993901#49993901", "title": "Retain first matching element of array", "body": "<p>Just out of curiosity (thanks @Phlip for the input I have shamelessly stolen):</p>\n\n<pre><code>b = [[\"student\",\"sam\"], [\"student\",\"george\"], [\"teacher\",\"matz\"]]\nb.reverse.to_h.to_a.reverse\n#\u21d2 [[\"student\", \"sam\"], [\"teacher\", \"matz\"]]\n</code></pre>\n"}], "owner": {"reputation": 172, "user_id": 6831572, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/d0bdcbb13d6f5b35393b736e4d030f44?s=128&d=identicon&r=PG&f=1", "display_name": "Zonet", "link": "https://stackoverflow.com/users/6831572/zonet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 49990822, "answer_count": 2, "score": 1, "last_activity_date": 1524550233, "creation_date": 1524522287, "last_edit_date": 1524550233, "question_id": 49990787, "link": "https://stackoverflow.com/questions/49990787/retain-first-matching-element-of-array", "title": "Retain first matching element of array", "body": "<p>I have an array as follows:</p>\n\n<pre><code>['a=1', 'b=2', 'a=2']\n</code></pre>\n\n<p>I want to filter the array to that the elements are unique with respect to their first character. I want the result:</p>\n\n<pre><code>['a=1', 'b=2']\n</code></pre>\n\n<p>In regards to the above, <code>[\"a\", \"b\", \"a\"]</code> becomes <code>[\"a\", \"b\"]</code>.</p>\n\n<p>All help is appreciated.</p>\n"}, {"tags": ["ruby", "loops"], "comments": [{"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 1, "creation_date": 1524550337, "post_id": 49990680, "comment_id": 87005279, "body": "&quot;until the user&#39;s input is String value&quot; -- User&#39;s input is always a string."}], "answers": [{"comments": [{"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 1, "creation_date": 1524550620, "post_id": 49991179, "comment_id": 87005396, "body": "If you want to detect a digit, matching with a regex that has <code>\\d</code> is enough. You don&#39;t need to count."}, {"owner": {"reputation": 172, "user_id": 6831572, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/d0bdcbb13d6f5b35393b736e4d030f44?s=128&d=identicon&r=PG&f=1", "display_name": "Zonet", "link": "https://stackoverflow.com/users/6831572/zonet"}, "reply_to_user": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1524607730, "post_id": 49991179, "comment_id": 87039261, "body": "That&#39;s true, but I thought giving a ruby solution would be easier for OP to understand. Plus, it&#39;s more readable."}, {"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 1, "creation_date": 1524634254, "post_id": 49991179, "comment_id": 87045454, "body": "Using regex is possible within Ruby, and that is what I meant. Regex match is much more readable than counting how may matches there are, and then seeing that it is positive."}, {"owner": {"reputation": 172, "user_id": 6831572, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/d0bdcbb13d6f5b35393b736e4d030f44?s=128&d=identicon&r=PG&f=1", "display_name": "Zonet", "link": "https://stackoverflow.com/users/6831572/zonet"}, "reply_to_user": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1531077097, "post_id": 49991179, "comment_id": 89449355, "body": "Slightly late, but I completely disagree. In the solution I gave, even if you&#39;re not familiar with Ruby, you can still figure out what&#39;s going on. If you&#39;re not familiar with regex however, well, you&#39;ll have no idea what&#39;s it doing."}], "tags": [], "owner": {"reputation": 172, "user_id": 6831572, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/d0bdcbb13d6f5b35393b736e4d030f44?s=128&d=identicon&r=PG&f=1", "display_name": "Zonet", "link": "https://stackoverflow.com/users/6831572/zonet"}, "is_accepted": false, "score": -1, "last_activity_date": 1524525193, "creation_date": 1524525193, "answer_id": 49991179, "question_id": 49990680, "link": "https://stackoverflow.com/questions/49990680/loop-until-answer-is-a-string/49991179#49991179", "title": "Loop until answer is a string", "body": "<p><code>gets.chomp</code> will always return a string, and as such there is no need to call <code>to_s</code> on the method.</p>\n\n<p>If you don't want the user to be able to input any integers, you could use the following for a clean solution: </p>\n\n<p><code>name.count(\"0-9\") &gt; 0</code></p>\n\n<p>If this returns <code>true</code>, then you know that the user's input contains at least one number.</p>\n"}, {"comments": [{"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 1, "creation_date": 1524554467, "post_id": 49995371, "comment_id": 87007547, "body": "Looks like the OP also wants to break from the loop. And actually that seems to be the OP&#39;s main concern in this question (despite the many other issues that you pointed out). Probably you might want to add an <code>else</code> branch."}], "tags": [], "owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "is_accepted": false, "score": 2, "last_activity_date": 1524555514, "last_edit_date": 1524555514, "creation_date": 1524553579, "answer_id": 49995371, "question_id": 49990680, "link": "https://stackoverflow.com/questions/49990680/loop-until-answer-is-a-string/49995371#49995371", "title": "Loop until answer is a string", "body": "<p>Your code has several issues:</p>\n\n<ol>\n<li><p>Your input and output is out of order. You gather input before prompting and that input (from your first line) is never used:</p>\n\n<pre><code>name1 = gets.chomp.to_s           # &lt;- Ruby is waiting for input\nloop do\n  print \"Please enter your name \" # &lt;- user is prompted to enter name\n  name1 = gets.chomp.to_s         # &lt;- previous input is overwritten\n  # ...\nend\n</code></pre>\n\n<p>The first line should probably be deleted.</p></li>\n<li><p><a href=\"http://ruby-doc.org/core-2.5.0/Kernel.html#method-i-gets\" rel=\"nofollow noreferrer\"><code>gets</code></a> might return <code>nil</code>, but <a href=\"http://ruby-doc.org/core-2.5.0/String.html#method-i-chomp\" rel=\"nofollow noreferrer\"><code>chomp</code></a> <em>always</em> returns a string. Calling <code>to_s</code> afterwards is therefore superfluous.</p></li>\n<li><p>Your <code>if-else</code> construct is actually:</p>\n\n<pre><code>if name1.empty?\n  puts \"No input.\"\nelse\n  name1.to_i\n  puts \"Illegal character ':'\"\nend\n</code></pre>\n\n<p>So whenever the input is not <code>empty?</code>, you convert it to an integer (discarding the result) and print an error message. You probably want an <code>elsif</code> instead (<code>/.../</code> is a <a href=\"http://ruby-doc.org/core-2.5.0/Regexp.html\" rel=\"nofollow noreferrer\">regexp</a> and <code>\\d</code> matches a digit):</p>\n\n<pre><code>if name1.empty?\n  puts 'No input.'\nelsif name1.match? /\\d/\n  puts 'Digits not allowed.'\nend\n</code></pre>\n\n<p>You could also use a <a href=\"http://ruby-doc.org/core-2.5.0/doc/syntax/control_expressions_rdoc.html#label-case+Expression\" rel=\"nofollow noreferrer\"><code>case</code> expression</a>:</p>\n\n<pre><code>case name1\nwhen ''\n  puts 'No input.'\nwhen /\\d/\n  puts 'Digits not allowed.'\nend\n</code></pre></li>\n<li><p>You never break out of your <code>loop</code>. The code keeps looping even if no error was found. This can be fixed by adding a <a href=\"http://ruby-doc.org/core-2.5.0/doc/syntax/control_expressions_rdoc.html#label-break+Statement\" rel=\"nofollow noreferrer\"><code>break</code> statement</a> in an <code>else</code> branch (to either <code>if</code> or <code>case</code>):</p>\n\n<pre><code>  # ...\nelse\n  break\nend\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 1, "user_id": 9688122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb7565d3469ceab00c94e7c70862ee0f?s=128&d=identicon&r=PG", "display_name": "Yunee", "link": "https://stackoverflow.com/users/9688122/yunee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1524555514, "creation_date": 1524521566, "last_edit_date": 1524550464, "question_id": 49990680, "link": "https://stackoverflow.com/questions/49990680/loop-until-answer-is-a-string", "title": "Loop until answer is a string", "body": "<p>I'm trying to loop this question until the user's input is a string value:</p>\n\n<blockquote>\n  <p><strong>Question: What is your name?</strong> </p>\n  \n  <ul>\n  <li>I don't want the user to just press enter and leave the name blank.</li>\n  <li>I don't want the user's input to be numeric/numbers.</li>\n  </ul>\n</blockquote>\n\n<p>Please see my code below:</p>\n\n<pre><code>name1 = gets.chomp.to_s    \nloop do\n  print \"Please enter your name \"\n  name1 = gets.chomp.to_s\n  if name1.empty?\n    puts \"No input.\"\n  else name1.to_i\n    puts \"Illegal character ':'\"\n  end\nend\n</code></pre>\n\n<p>With this code, I can't proceed to the next question even if I input a string value. Please help.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "rubygems", "bundler", "gemfile"], "comments": [{"owner": {"reputation": 16229, "user_id": 525478, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3b6c0b47a0c430a0b141baee7ea845be?s=128&d=identicon&r=PG", "display_name": "Brad Werth", "link": "https://stackoverflow.com/users/525478/brad-werth"}, "edited": false, "score": 0, "creation_date": 1524520594, "post_id": 49990500, "comment_id": 86997589, "body": "what does the gemfile.lock look like?"}, {"owner": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 1, "creation_date": 1524520630, "post_id": 49990500, "comment_id": 86997599, "body": "Are you using <code>spring</code>? If so, you might want to try <code>spring stop</code> in the console."}, {"owner": {"reputation": 121, "user_id": 7275142, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w1fVJ.jpg?s=128&g=1", "display_name": "Alejandro Aristiz&#225;bal", "link": "https://stackoverflow.com/users/7275142/alejandro-aristiz%c3%a1bal"}, "reply_to_user": {"reputation": 16229, "user_id": 525478, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3b6c0b47a0c430a0b141baee7ea845be?s=128&d=identicon&r=PG", "display_name": "Brad Werth", "link": "https://stackoverflow.com/users/525478/brad-werth"}, "edited": false, "score": 0, "creation_date": 1524520924, "post_id": 49990500, "comment_id": 86997705, "body": "@BradWerth gonna add it to the question for clarity"}, {"owner": {"reputation": 121, "user_id": 7275142, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w1fVJ.jpg?s=128&g=1", "display_name": "Alejandro Aristiz&#225;bal", "link": "https://stackoverflow.com/users/7275142/alejandro-aristiz%c3%a1bal"}, "reply_to_user": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 0, "creation_date": 1524521152, "post_id": 49990500, "comment_id": 86997792, "body": "@jvillian Now I can&#39;t start rails console :("}, {"owner": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 1, "creation_date": 1524521258, "post_id": 49990500, "comment_id": 86997826, "body": "Well, that&#39;s probably good new/bad news. It probably means you&#39;re now using your local gem (good news). It probably also means you need to do some mods to make the gem work locally (bad news). Can you add to your question the error stack trace?"}, {"owner": {"reputation": 121, "user_id": 7275142, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w1fVJ.jpg?s=128&g=1", "display_name": "Alejandro Aristiz&#225;bal", "link": "https://stackoverflow.com/users/7275142/alejandro-aristiz%c3%a1bal"}, "reply_to_user": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 1, "creation_date": 1524521536, "post_id": 49990500, "comment_id": 86997921, "body": "@jvillian I had to increase the number of inotify watchers to get the console working again, and I&#39;m no longer getting the <code>ArgumentError</code>. Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "is_accepted": true, "score": 2, "last_activity_date": 1524521694, "creation_date": 1524521694, "answer_id": 49990698, "question_id": 49990500, "link": "https://stackoverflow.com/questions/49990500/rails-not-using-modified-gem-instead-of-original/49990698#49990698", "title": "Rails not using modified gem instead of original", "body": "<p>My guess is that <code>spring</code> still has the gem from the original gem source loaded. </p>\n\n<p>To force <code>spring</code> to reload the gem (from your local source), do:</p>\n\n<pre><code>spring stop\n</code></pre>\n\n<p>in the console. Then restart your server and you should be using the gem from your local source.</p>\n"}], "owner": {"reputation": 121, "user_id": 7275142, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w1fVJ.jpg?s=128&g=1", "display_name": "Alejandro Aristiz&#225;bal", "link": "https://stackoverflow.com/users/7275142/alejandro-aristiz%c3%a1bal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 314, "favorite_count": 0, "accepted_answer_id": 49990698, "answer_count": 1, "score": 0, "last_activity_date": 1524521694, "creation_date": 1524520397, "last_edit_date": 1524521049, "question_id": 49990500, "link": "https://stackoverflow.com/questions/49990500/rails-not-using-modified-gem-instead-of-original", "title": "Rails not using modified gem instead of original", "body": "<p>this is what I believe a simple problem I need help with. I'm trying to modify a gem's method so that I can add another argument to it. For this, I've cloned the gem's repo to a local directory and changed the code I needed. Inside my app's Gemfile I'm doing this:</p>\n\n<p><code>gem 'recommendable', path: \"/home/aristizabal95/forked_gems/recommendable\"</code></p>\n\n<p>And running <code>bundle install</code> afterwards. Even though the bundler says it's using my code, when I run the tests I get this error:</p>\n\n<pre><code>ArgumentError: wrong number of arguments (given 4, expected 1..3)\n    from /var/lib/gems/2.3.0/gems/recommendable-2.2.0/lib/recommendable/rater/recommender.rb:21:in `recommended_for'\n</code></pre>\n\n<p>which indicates that the app is not running my version of the gem, but the original one. I have no idea why it's not working, and was unable to find any issue related to this.</p>\n\n<p>Thanks in advance</p>\n\n<p>EDIT:\nThis is what the Gemfile.lock looks like</p>\n\n<pre><code>PATH\n  remote: /home/aristizabal95/forked_gems/recommendable\n  specs:\n    recommendable (2.2.1)\n    activesupport (&gt;= 3.0.0)\n    hooks (&gt;= 0.2.1)\n    redis (&gt;= 2.2.0)\nGEM\n  recommendable!\n</code></pre>\n"}, {"tags": ["html", "ruby", "escaping"], "comments": [{"owner": {"reputation": 269, "user_id": 5677587, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S2Q4c.png?s=128&g=1", "display_name": "ragurney", "link": "https://stackoverflow.com/users/5677587/ragurney"}, "edited": false, "score": 1, "creation_date": 1524518238, "post_id": 49989752, "comment_id": 86996676, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/26846734/checking-if-a-string-escaped\">Checking if a string escaped</a>"}, {"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1524563148, "post_id": 49989752, "comment_id": 87012948, "body": "Calling a single method to ensure something is not hacky at all. It is the normal way to do things."}], "answers": [{"tags": [], "owner": {"reputation": 4670, "user_id": 2658159, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7ca457ff473ed766a9c140f9956c910a?s=128&d=identicon&r=PG&f=1", "display_name": "Aaron Thomas", "link": "https://stackoverflow.com/users/2658159/aaron-thomas"}, "is_accepted": true, "score": 1, "last_activity_date": 1524528415, "last_edit_date": 1524528415, "creation_date": 1524522868, "answer_id": 49990861, "question_id": 49989752, "link": "https://stackoverflow.com/questions/49989752/elegant-way-to-html-escape-string-that-may-already-have-been-escaped/49990861#49990861", "title": "Elegant way to html escape string that may already have been escaped", "body": "<p>Calling <code>CGI::unescapeHTML</code> prior to calling <code>GCI::escapeHTML</code> is the simplest and most straightforward way to accomplish this.</p>\n\n<p>For example:</p>\n\n<pre><code>require 'cgi'\n\ndef to_escapedHTML\n  CGI::escapeHTML(CGI::unescapeHTML(self))\nend\n\npp to_escapedHTML(\"queen&amp;#39;s\")\n</code></pre>\n"}], "owner": {"reputation": 1670, "user_id": 6388521, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh4.googleusercontent.com/-VdFWPJVSpRc/AAAAAAAAAAI/AAAAAAAAAFo/vCc8QOz6v9Y/photo.jpg?sz=128", "display_name": "Ruslan", "link": "https://stackoverflow.com/users/6388521/ruslan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 49990861, "answer_count": 1, "score": 3, "last_activity_date": 1524563079, "creation_date": 1524516699, "last_edit_date": 1524563079, "question_id": 49989752, "link": "https://stackoverflow.com/questions/49989752/elegant-way-to-html-escape-string-that-may-already-have-been-escaped", "title": "Elegant way to html escape string that may already have been escaped", "body": "<p>I have a string that may or may not be escaped for HTML. I want to ensure escaping.</p>\n\n<p>When the string is not escaped, <code>CGI.escapeHTML</code> works as expected:</p>\n\n<p><code>\"queen's\"</code> -> <code>\"queen&amp;#39;s\"</code></p>\n\n<p>However, when the string is pre-escaped, it does not give the correct result:</p>\n\n<p><code>\"queen&amp;#39;s\"</code> -> <code>\"queen&amp;amp;#39;s\"</code></p>\n\n<p>One solution is to call <code>CGI.unescapeHTML</code>  prior to calling <code>CGI.escapeHTML</code>. Any way to do this in a less hacky way?</p>\n"}, {"tags": ["ruby", "regex", "replace", "gsub"], "comments": [{"owner": {"reputation": 9030, "user_id": 5101476, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JCQrl.jpg?s=128&g=1", "display_name": "ice\u30c4", "link": "https://stackoverflow.com/users/5101476/ice%e3%83%84"}, "edited": false, "score": 4, "creation_date": 1524515937, "post_id": 49989555, "comment_id": 86995640, "body": "<code>name.gsub(&#47;[\\&#47;\\s]+&#47;,&#39;-&#39;) #=&gt; &quot;chard-pinot-noir&quot;</code>"}, {"owner": {"reputation": 858, "user_id": 5140076, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/d668775740ba65deae02791651c4dd49?s=128&d=identicon&r=PG&f=1", "display_name": "thesayhey", "link": "https://stackoverflow.com/users/5140076/thesayhey"}, "reply_to_user": {"reputation": 9030, "user_id": 5101476, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JCQrl.jpg?s=128&g=1", "display_name": "ice\u30c4", "link": "https://stackoverflow.com/users/5101476/ice%e3%83%84"}, "edited": false, "score": 0, "creation_date": 1524516048, "post_id": 49989555, "comment_id": 86995674, "body": "@SagarPandya thank you! the docs on regex are confusing. is the <code>+&#47;</code> regex for checking all forward slashes? put as answer and i can report as answered."}, {"owner": {"reputation": 9030, "user_id": 5101476, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JCQrl.jpg?s=128&g=1", "display_name": "ice\u30c4", "link": "https://stackoverflow.com/users/5101476/ice%e3%83%84"}, "edited": false, "score": 1, "creation_date": 1524516650, "post_id": 49989555, "comment_id": 86995931, "body": "<code>[\\&#47;\\s]+</code> checks for one or more of any of <code>&#47;</code> or whitespace characters. <a href=\"http://www.rubular.com/\" rel=\"nofollow noreferrer\">Rublar</a> has a nice cheatsheet if you want to play."}, {"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1524550650, "post_id": 49989555, "comment_id": 87005415, "body": "What is your question?"}], "answers": [{"tags": [], "owner": {"reputation": 301, "user_id": 6701820, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Q_9g0OuM9ZQ/AAAAAAAAAAI/AAAAAAAAAEw/ktX4E3hT93s/photo.jpg?sz=128", "display_name": "TheVinspro", "link": "https://stackoverflow.com/users/6701820/thevinspro"}, "is_accepted": true, "score": 1, "last_activity_date": 1524563077, "creation_date": 1524563077, "answer_id": 49998387, "question_id": 49989555, "link": "https://stackoverflow.com/questions/49989555/regex-with-ruby-gsub/49998387#49998387", "title": "Regex with Ruby gsub", "body": "<p>If you don't know much about <a href=\"https://ruby-doc.org/core-2.1.1/Regexp.html\" rel=\"nofollow noreferrer\">regex</a>, you can do this way.</p>\n\n<pre><code>name = \"chard / pinot noir\"\n(name.split() - [\"/\"]).join(\"-\")\n=&gt; \"chard-pinot-noir\"\n</code></pre>\n\n<p>I think the best way is use with <a href=\"https://ruby-doc.org/core-2.1.1/Regexp.html\" rel=\"nofollow noreferrer\">regex</a> as  <a href=\"https://stackoverflow.com/users/5101493/sagar-pandya\">@Sagar Pandya</a> described above. </p>\n\n<pre><code>name.gsub(/[\\/\\s]+/,'-')\n=&gt; \"chard-pinot-noir\"\n</code></pre>\n"}], "owner": {"reputation": 858, "user_id": 5140076, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/d668775740ba65deae02791651c4dd49?s=128&d=identicon&r=PG&f=1", "display_name": "thesayhey", "link": "https://stackoverflow.com/users/5140076/thesayhey"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "closed_date": 1524861678, "accepted_answer_id": 49998387, "answer_count": 1, "score": -2, "last_activity_date": 1524861704, "creation_date": 1524515778, "last_edit_date": 1524568319, "question_id": 49989555, "link": "https://stackoverflow.com/questions/49989555/regex-with-ruby-gsub", "closed_reason": "Duplicate", "title": "Regex with Ruby gsub", "body": "<p>My goal is to replace spaces and <code>\"/\"</code> with <code>'-'</code> from the input:</p>\n\n<pre><code>name = \"chard / pinot noir\"\n</code></pre>\n\n<p>to get:</p>\n\n<pre><code>\"chard-pinot-noir\"\n</code></pre>\n\n<p>My first attempt is:</p>\n\n<pre><code>name.gsub(/ \\/\\ /, '-') #=&gt; \"chart-pinot noir\"\n</code></pre>\n\n<p>My second attempt is:</p>\n\n<pre><code>name.gsub(/\\/\\s+/, '-') #=&gt; \"chard -pinot noir\"\n</code></pre>\n\n<p>My third attempt is:</p>\n\n<pre><code>name.gsub(/\\s+/, '-') #=&gt; \"chard-/-pinot-noir\"\n</code></pre>\n\n<p><a href=\"https://stackoverflow.com/questions/34395026/how-to-understand-gsub-or-the-regex?rq=1\">This article</a> helped. The first group checks for a forward slash <code>/</code>, and contains a break. The second portion replaces a forward slash with <code>'-'</code>. However, the space remains. I believe <code>/s</code> matches spaces, but I can't get it to work while simultaneously checking for forward slash.</p>\n\n<p>My question is how can I get the desired result, shown above, with varying strings using either regex or a ruby helpers. Is there a preferred way? Pro / Con ? </p>\n"}, {"tags": ["ruby", "rubygems", "gemspecs"], "answers": [{"tags": [], "owner": {"reputation": 1088, "user_id": 3236163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f4a825085dda7d9ea059838a3d6dcd7?s=128&d=identicon&r=PG", "display_name": "elyalvarado", "link": "https://stackoverflow.com/users/3236163/elyalvarado"}, "is_accepted": true, "score": 2, "last_activity_date": 1524534756, "creation_date": 1524534756, "answer_id": 49992322, "question_id": 49988990, "link": "https://stackoverflow.com/questions/49988990/should-the-gemspec-be-packaged-with-a-ruby-gem/49992322#49992322", "title": "Should the Gemspec be packaged with a Ruby Gem?", "body": "<p>There is no need to pack a Gemspec with a Ruby gem, in a survey of the gems installed in one of my gem homes I noticed that in fact most gems don't include the gemspec file:</p>\n\n<pre><code> ~/.rvm/gems/ruby-2.3.7/gems $ find . -name \\*.gemspec | wc -l\n      95\n ~/.rvm/gems/ruby-2.3.7@happy-backend/gems $ ls | wc -l\n     318\n</code></pre>\n\n<p>Why would you want to not pack it?</p>\n\n<ul>\n<li>It saves a few bytes in your GEM</li>\n</ul>\n\n<p>Why pack it?</p>\n\n<ul>\n<li>It allows for easy unpacking and repackaging of a gem</li>\n<li>Why not? the gem spec is uploaded to the gem server anyway, so there are no secrets there and if the 'user' really wants it its going to be on the <code>$GEM_HOME/specifications</code> folder</li>\n</ul>\n"}], "owner": {"reputation": 6391, "user_id": 2909897, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/LMSiW.jpg?s=128&g=1", "display_name": "mbigras", "link": "https://stackoverflow.com/users/2909897/mbigras"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 49992322, "answer_count": 1, "score": 0, "last_activity_date": 1524534756, "creation_date": 1524513239, "question_id": 49988990, "link": "https://stackoverflow.com/questions/49988990/should-the-gemspec-be-packaged-with-a-ruby-gem", "title": "Should the Gemspec be packaged with a Ruby Gem?", "body": "<p>I read that we <a href=\"https://github.com/bundler/bundler/pull/3207\" rel=\"nofollow noreferrer\">shouldn't package test files with a Ruby Gem</a>.</p>\n\n<p>Now I'm wondering, if we should package the Gemspec.</p>\n\n<p>For example, given the following Ruby Gem:</p>\n\n<pre><code>tree .\n.\n\u251c\u2500\u2500 LICENSE.txt\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 lib\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 simplegem.rb\n\u251c\u2500\u2500 simplegem.gemspec\n\u2514\u2500\u2500 test\n    \u251c\u2500\u2500 simplegem_test.rb\n    \u2514\u2500\u2500 thing_test.rb\n\n2 directories, 6 files\n</code></pre>\n\n<p>Should my <a href=\"http://guides.rubygems.org/specification-reference/\" rel=\"nofollow noreferrer\">Gem::Specification</a> look like:</p>\n\n<pre><code>$LOAD_PATH.unshift 'lib'\nrequire 'simplegem'\n\nGem::Specification.new do |s|\n  s.name        = 'simplegem'\n  s.version     = Simplegem::VERSION\n  s.licenses    = ['MIT']\n  s.summary     = 'This is a simple gem!'\n  s.description = 'Much longer explanation of the simple gem!'\n  s.authors     = ['...']\n  s.email       = '...'\n  s.files       = %w(simplegem.gemspec\n                     LICENSE.txt\n                     README.md\n                     lib/simplegem.rb)\n  s.homepage    = 'https://github.com/mbigras'\nend\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>$LOAD_PATH.unshift 'lib'\nrequire 'simplegem'\n\nGem::Specification.new do |s|\n  s.name        = 'simplegem'\n  s.version     = Simplegem::VERSION\n  s.licenses    = ['MIT']\n  s.summary     = 'This is a simple gem!'\n  s.description = 'Much longer explanation of the simple gem!'\n  s.authors     = ['...']\n  s.email       = '...'\n  s.files       = %w(LICENSE.txt\n                     README.md\n                     lib/simplegem.rb)\n  s.homepage    = 'https://github.com/mbigras'\nend\n</code></pre>\n\n<p>Notice how the first includes <code>simplegem.gemspec</code> in the <code>s.files</code> array and the second does not. </p>\n\n<ul>\n<li>Should the Gemspec be packaged with a Ruby Gem?</li>\n<li>Why or why not?</li>\n</ul>\n"}, {"tags": ["ruby", "rspec", "sinatra", "rack-test"], "answers": [{"tags": [], "owner": {"reputation": 7565, "user_id": 1021515, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Z9QcP.jpg?s=128&g=1", "display_name": "mwp", "link": "https://stackoverflow.com/users/1021515/mwp"}, "is_accepted": false, "score": 4, "last_activity_date": 1524515252, "creation_date": 1524515252, "answer_id": 49989446, "question_id": 49988893, "link": "https://stackoverflow.com/questions/49988893/how-to-send-custom-header-with-racktest/49989446#49989446", "title": "How to send custom header with rack::test?", "body": "<p>You have to use <code>Rack::Test::Methods#header</code> (which delegates to <a href=\"http://www.rubydoc.info/github/brynary/rack-test/Rack/Test/Session#header-instance_method\" rel=\"nofollow noreferrer\"><code>Rack::Test::Session#header</code>)</a>: </p>\n\n<pre><code>it '\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u0430\u044f - get \u0441 \u0442\u043e\u043a\u0435\u043d\u043e\u043c' do\n  header 'X-Auth', 'some key'\n  get '/offers'\n  $log.debug{ \"ENV was: '#{ last_request.env.keys }'\" }\nend\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 533, "user_id": 3311451, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/uISPr.jpg?s=128&g=1", "display_name": "Dimitri", "link": "https://stackoverflow.com/users/3311451/dimitri"}, "edited": false, "score": 0, "creation_date": 1524570394, "post_id": 49999978, "comment_id": 87017671, "body": "Also found that: <a href=\"https://stackoverflow.com/questions/25660827/accessing-headers-from-sinatra/35689150\" title=\"accessing headers from sinatra\">stackoverflow.com/questions/25660827/&hellip;</a>"}, {"owner": {"reputation": 640, "user_id": 2326613, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5f0821b3c32c0537c027a657ec7e977b?s=128&d=identicon&r=PG", "display_name": "JosephK", "link": "https://stackoverflow.com/users/2326613/josephk"}, "edited": false, "score": 1, "creation_date": 1565938595, "post_id": 49999978, "comment_id": 101507429, "body": "Your &quot;also correct&quot; version is the first answer posted anywhere I&#39;ve found (in hours) which Actually Sets the Headers.  Thanks So Much.  But adding another argument to the GET does not work, in my experience - just adds a headers-hash to params, leaving the headers unchanged."}], "tags": [], "owner": {"reputation": 533, "user_id": 3311451, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/uISPr.jpg?s=128&g=1", "display_name": "Dimitri", "link": "https://stackoverflow.com/users/3311451/dimitri"}, "is_accepted": false, "score": 6, "last_activity_date": 1524567499, "creation_date": 1524567499, "answer_id": 49999978, "question_id": 49988893, "link": "https://stackoverflow.com/questions/49988893/how-to-send-custom-header-with-racktest/49999978#49999978", "title": "How to send custom header with rack::test?", "body": "<p>This code is working:</p>\n\n<pre><code>get '/offers', nil, { 'X-Auth' =&gt; 'long key' }\n</code></pre>\n\n<p>And this also is correct:</p>\n\n<pre><code>header 'X-Auth', 'some key'\nget '/offers'\n</code></pre>\n\n<p>I changed the manner I look for that header in app:</p>\n\n<pre><code>request.get_header('HTTP_X_AUTH') || request.env['X-Auth']\n</code></pre>\n\n<p>The first - get_header was triggered when I call my app with curl, the last - request.env - when in tests.</p>\n"}], "owner": {"reputation": 533, "user_id": 3311451, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/uISPr.jpg?s=128&g=1", "display_name": "Dimitri", "link": "https://stackoverflow.com/users/3311451/dimitri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1493, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1524567499, "creation_date": 1524512873, "question_id": 49988893, "link": "https://stackoverflow.com/questions/49988893/how-to-send-custom-header-with-racktest", "title": "How to send custom header with rack::test?", "body": "<p>I spent about two days without success trying to send custom headers with Rack::Test. I just can't send any header into my app.\nI found a lot of examples in the net with the similar code -- method( address, body, headers ), but for me they don't work at all.</p>\n\n<p>ruby 2.5.1p57 (2018-03-29 revision 63029) [x86_64-linux]</p>\n\n<pre><code># grep rack  Gemfile.lock\n    rack (2.0.4)\n    rack-protection (2.0.1)\n      rack\n    rack-test (1.0.0)\n      rack (&gt;= 1.0, &lt; 3)\n      rack-protection (&gt;= 1.5.0)\n      rack (~&gt; 2.0)\n      rack-protection (= 2.0.1)\n  rack-test\n</code></pre>\n\n<p>The code in app (sinatra):</p>\n\n<pre><code>$log = Logger.new STDERR\nclass MyApi &lt; Sinatra::Application\n  before do\n    $log.debug{ \"Headers: #{ headers.keys.inspect }\" }\n  end\n  get '/offers' do\n    #... some code\n  end\n  post '/offers' do\n    # .. some another code\n  end\nend\n</code></pre>\n\n<p>spec/api_spec.rb</p>\n\n<pre><code>RSpec.describe MyApi, '/offers' do\n  include Rack::Test::Methods\n  def app\n    MyApi\n  end\n\n  context '\u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f' do\n    it '\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u0430\u044f - get \u0441 \u0442\u043e\u043a\u0435\u043d\u043e\u043c' do\n      get '/offers', nil, {\n        'X-Auth' =&gt; 'some key'\n      }\n      $log.debug{ \"ENV was: '#{ last_request.env.keys }'\" }\n    end\n    it '\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u0430\u044f - post \u0441 \u0442\u043e\u043a\u0435\u043d\u043e\u043c' do\n      post '/offers', '', {\n        'Content-Type' =&gt; 'application/json; charset: utf-8',\n        'X-Auth' =&gt; 'some long key'\n      }\n    end\n  end\nend\n</code></pre>\n\n<p>Output contains for both tests:</p>\n\n<pre><code>Headers: [\"Content-Type\"]\n...\nENV was: '[\"rack.version\", \"rack.input\", \"rack.errors\",\n\"rack.multithread\", \"rack.multiprocess\", \"rack.run_once\", \n\"REQUEST_METHOD\", \"SERVER_NAME\", \"SERVER_PORT\", \"QUERY_STRING\", \n\"PATH_INFO\", \"rack.url_scheme\", \"HTTPS\", \"SCRIPT_NAME\", \"CONTENT_LENGTH\", \n\"rack.test\", \"REMOTE_ADDR\", \"X-Auth\", \"HTTP_HOST\", \"HTTP_COOKIE\", \n\"sinatra.commonlogger\", \"rack.logger\", \"rack.request.query_string\", \n\"rack.request.query_hash\"]'\n</code></pre>\n"}, {"tags": ["ruby", "macos", "macports"], "comments": [{"owner": {"reputation": 1136, "user_id": 5215927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/w06Fv.jpg?s=128&g=1", "display_name": "mr_sudaca", "link": "https://stackoverflow.com/users/5215927/mr-sudaca"}, "edited": false, "score": 0, "creation_date": 1524511875, "post_id": 49987920, "comment_id": 86993643, "body": "Ruby comes bundled with osx. Have you tried using <code>RVM</code>?"}, {"owner": {"reputation": 38170, "user_id": 57135, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/S9roh.jpg?s=128&g=1", "display_name": "Joe", "link": "https://stackoverflow.com/users/57135/joe"}, "edited": false, "score": 0, "creation_date": 1524511988, "post_id": 49987920, "comment_id": 86993725, "body": "You do NOT want to change the default ruby.  use <code>rvm</code> or <code>rbenv</code> (I prefer the latter) to manage the version you use for project work"}, {"owner": {"reputation": 152277, "user_id": 438992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/QouOz.jpg?s=128&g=1", "display_name": "Dave Newton", "link": "https://stackoverflow.com/users/438992/dave-newton"}, "edited": false, "score": 0, "creation_date": 1524512751, "post_id": 49987920, "comment_id": 86994101, "body": "Personally I prefer asdf."}], "answers": [{"tags": [], "owner": {"reputation": 2691, "user_id": 2127896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65401a6614c12876941e574e447b5d13?s=128&d=identicon&r=PG", "display_name": "neverpanic", "link": "https://stackoverflow.com/users/2127896/neverpanic"}, "is_accepted": false, "score": 1, "last_activity_date": 1524593494, "creation_date": 1524593494, "answer_id": 50008307, "question_id": 49987920, "link": "https://stackoverflow.com/questions/49987920/ruby-on-mac-osx-sierra-via-mac-ports/50008307#50008307", "title": "Ruby on Mac OSX Sierra via Mac Ports", "body": "<p><code>/usr/bin</code> is Apple-land. You should not change it, and Apple has implemented a feature called \"System Integrity Protection\" (SIP) that actively prevents modification of files with this protection enabled, one of which is <code>/usr/bin/ruby</code>. There are ways to disable SIP, but there are better alternatives to change the default ruby.</p>\n\n<p>Instead, the general method to prefer specific versions of self-installed tools is to set <code>$PATH</code> so that a folder under your control comes before <code>/usr/bin</code>. MacPorts already does this by prepending <code>/opt/local/bin</code>. However, MacPorts does not, by default, create a <code>/opt/local/bin/ruby -&gt; ruby2.5</code> symlink, because you might have multiple versions of Ruby installed and it would not know which one you want to make the default.</p>\n\n<p>For this reason, MacPorts comes with a mechanism called <code>port select</code> (see <code>port help select</code>) that allows you to manage a <code>/opt/local/bin/ruby</code> symlink. In your case, <code>port select --list ruby</code> should show a list of choices, and <code>sudo port select --set ruby ruby25</code> should make ruby2.5 the default. Note that Shells usually cache the lookup from a command name to the path that provides it, so this will only be effective after opening a new shell, or running <code>hash -r</code> in the current one.</p>\n\n<p>In the specific case of Ruby, there are also tools available to manage different versions of Ruby side-by-side, such as rbenv and rvm.</p>\n"}], "owner": {"reputation": 1339, "user_id": 1046337, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/60a5cccad10cb8388a9c8ba270e142cc?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/1046337/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524593494, "creation_date": 1524508989, "question_id": 49987920, "link": "https://stackoverflow.com/questions/49987920/ruby-on-mac-osx-sierra-via-mac-ports", "title": "Ruby on Mac OSX Sierra via Mac Ports", "body": "<p>I'm on macOS Sierra. I installed ruby 2.5 via macports (/opt/local/bin/ruby2.5). However, I also have ruby 2.0 sitting in /usr/bin/ruby -- not sure where that comes from -- its not a macports package. How can I get my system to use the newer ruby 2.5 system wide? \nWhen I try to remove/rename /usr/bin/ruby I get \"Operation not permitted\" even as super user. </p>\n"}, {"tags": ["arrays", "ruby", "list"], "comments": [{"owner": {"reputation": 73209, "user_id": 290394, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d7908f05c89e965f6bc5308ad6f41256?s=128&d=identicon&r=PG", "display_name": "steenslag", "link": "https://stackoverflow.com/users/290394/steenslag"}, "edited": false, "score": 0, "creation_date": 1524515395, "post_id": 49987894, "comment_id": 86995411, "body": "The reason that this does not work is that <a href=\"https://ruby-doc.org/core-2.4.0/String.html#method-i-2B\" rel=\"nofollow noreferrer\">String#+</a> results in a new string. The old strings just keep sitting unaltered in the commands array. Choose <code>map</code> to store the new strings in a new array, or choose a method which mutates the strings, as the answers and comments indicate."}], "answers": [{"comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1524513207, "post_id": 49987936, "comment_id": 86994338, "body": "Or <code>String#replace</code> e.g. <code>commands.each {|c| c.replace(&quot;#{prefix}#{c}&quot;) }</code>"}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "reply_to_user": {"reputation": 73209, "user_id": 290394, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d7908f05c89e965f6bc5308ad6f41256?s=128&d=identicon&r=PG", "display_name": "steenslag", "link": "https://stackoverflow.com/users/290394/steenslag"}, "edited": false, "score": 1, "creation_date": 1524514539, "post_id": 49987936, "comment_id": 86995018, "body": "@steenslag that is much better although you could always <code>c.sub!(&#47;\\A&#47;,prefix)</code> :)"}, {"owner": {"reputation": 186, "user_id": 3564065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ee8dd47dce1b6e7278bde0b076a4e79?s=128&d=identicon&r=PG&f=1", "display_name": "Thirumal Sakthivel", "link": "https://stackoverflow.com/users/3564065/thirumal-sakthivel"}, "edited": false, "score": 0, "creation_date": 1524549865, "post_id": 49987936, "comment_id": 87005102, "body": "@Tearzz <code>commands.each { |command| command.insert(0, prefix) }</code>"}, {"owner": {"reputation": 301, "user_id": 6701820, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Q_9g0OuM9ZQ/AAAAAAAAAAI/AAAAAAAAAEw/ktX4E3hT93s/photo.jpg?sz=128", "display_name": "TheVinspro", "link": "https://stackoverflow.com/users/6701820/thevinspro"}, "edited": false, "score": 0, "creation_date": 1524566831, "post_id": 49987936, "comment_id": 87015363, "body": "commands_with_prefix = commands.map { |command| &quot;!&quot; &lt;&lt; command }    as + operator returns a new String each time while &lt;&lt; on the other hand concatenates to the given object."}, {"owner": {"reputation": 27144, "user_id": 3857758, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/58c4295826435f049b7fc32b98c240f9?s=128&d=identicon&r=PG&f=1", "display_name": "Ursus", "link": "https://stackoverflow.com/users/3857758/ursus"}, "edited": false, "score": 0, "creation_date": 1524566916, "post_id": 49987936, "comment_id": 87015427, "body": "Thanks to everyone :)"}], "tags": [], "owner": {"reputation": 27144, "user_id": 3857758, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/58c4295826435f049b7fc32b98c240f9?s=128&d=identicon&r=PG&f=1", "display_name": "Ursus", "link": "https://stackoverflow.com/users/3857758/ursus"}, "is_accepted": true, "score": 3, "last_activity_date": 1524509028, "creation_date": 1524509028, "answer_id": 49987936, "question_id": 49987894, "link": "https://stackoverflow.com/questions/49987894/replace-each-value-in-array-with-new-value-ruby/49987936#49987936", "title": "Replace each value in array with new value (Ruby)", "body": "<p>use <code>map</code></p>\n\n<pre><code>commands_with_prefix = commands.map { |command| prefix + command }\n</code></pre>\n\n<p>or <code>map!</code> to update the array in-place</p>\n\n<pre><code>commands.map! { |command| prefix + command }\n</code></pre>\n\n<p>another way, interpolation</p>\n\n<pre><code>commands.map! { |command| \"#{prefix}#{command}\" }\n</code></pre>\n"}], "owner": {"reputation": 301, "user_id": 7572104, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/i976n.png?s=128&g=1", "display_name": "Tearzz", "link": "https://stackoverflow.com/users/7572104/tearzz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 49987936, "answer_count": 1, "score": 0, "last_activity_date": 1527765394, "creation_date": 1524508895, "last_edit_date": 1527765394, "question_id": 49987894, "link": "https://stackoverflow.com/questions/49987894/replace-each-value-in-array-with-new-value-ruby", "title": "Replace each value in array with new value (Ruby)", "body": "<pre><code>prefix = \"!\"    \n\ncommands = [\n        \"command_1\",\n        \"command_2\"]\n\ncommands.each do |command|\n    command = prefix + command\nend\n</code></pre>\n\n<p>This is pretty straightforward. I want to change the strings <code>\"command_1\"</code> &amp; <code>\"command_2\"</code> to <code>\"!command_1\"</code> &amp; <code>\"!command_2\"</code>. How would I do that?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "heroku", "rails-admin"], "comments": [{"owner": {"reputation": 4690, "user_id": 1937435, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YyN37.jpg?s=128&g=1", "display_name": "Josh Brody", "link": "https://stackoverflow.com/users/1937435/josh-brody"}, "edited": false, "score": 0, "creation_date": 1524525819, "post_id": 49987793, "comment_id": 86999110, "body": "have you tried restarting your rails server?"}, {"owner": {"reputation": 288, "user_id": 5241456, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-dyuG5GGKgAc/AAAAAAAAAAI/AAAAAAAAAHw/r4oZO6Om9MA/photo.jpg?sz=128", "display_name": "Muhammad Rahmatullah", "link": "https://stackoverflow.com/users/5241456/muhammad-rahmatullah"}, "reply_to_user": {"reputation": 4690, "user_id": 1937435, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YyN37.jpg?s=128&g=1", "display_name": "Josh Brody", "link": "https://stackoverflow.com/users/1937435/josh-brody"}, "edited": false, "score": 0, "creation_date": 1524538237, "post_id": 49987793, "comment_id": 87001933, "body": "yes, i&#39;ve already done that."}, {"owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 0, "creation_date": 1524812739, "post_id": 49987793, "comment_id": 87130515, "body": "Please add ruby version and rails version to your question as well"}, {"owner": {"reputation": 288, "user_id": 5241456, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-dyuG5GGKgAc/AAAAAAAAAAI/AAAAAAAAAHw/r4oZO6Om9MA/photo.jpg?sz=128", "display_name": "Muhammad Rahmatullah", "link": "https://stackoverflow.com/users/5241456/muhammad-rahmatullah"}, "edited": false, "score": 0, "creation_date": 1524845139, "post_id": 49987793, "comment_id": 87149084, "body": "gem &#39;rails&#39;, &#39;~&gt; 5.1.5&#39; , ruby 2.3.3p222 (2016-11-21) [x86_64-linux-gnu]"}], "answers": [{"tags": [], "owner": {"reputation": 802, "user_id": 8728218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/376ec53188ea3ec0271198a862516657?s=128&d=identicon&r=PG&f=1", "display_name": "Dyaniyal Wilson", "link": "https://stackoverflow.com/users/8728218/dyaniyal-wilson"}, "is_accepted": false, "score": 1, "last_activity_date": 1524552910, "creation_date": 1524552910, "answer_id": 49995188, "question_id": 49987793, "link": "https://stackoverflow.com/questions/49987793/rails-admin-keep-giving-me-undefined-local-variable-or-method-rails-admin-when/49995188#49995188", "title": "rails_admin keep giving me undefined local variable or method `rails_admin&#39; when access dashboard", "body": "<p>try using href as below. I think it should work if other things are proper. </p>\n\n<pre><code>href=\"#{main_app.url_for(action: action.action_name, controller: 'rails_admin/main', \nmodel_name: abstract_model.try(:to_param). id: (object.try(:persisted?) &amp;&amp; object.try(:id) || nil))}\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 288, "user_id": 5241456, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-dyuG5GGKgAc/AAAAAAAAAAI/AAAAAAAAAHw/r4oZO6Om9MA/photo.jpg?sz=128", "display_name": "Muhammad Rahmatullah", "link": "https://stackoverflow.com/users/5241456/muhammad-rahmatullah"}, "edited": false, "score": 0, "creation_date": 1524758949, "post_id": 50002445, "comment_id": 87111313, "body": "i&#39;ve configured that file : <a href=\"https://gist.github.com/ba01ac3b089887c841b92729554dcf30.git\" rel=\"nofollow noreferrer\">gist.github.com/ba01ac3b089887c841b92729554dcf30.git</a>"}], "tags": [], "owner": {"reputation": 3312, "user_id": 412528, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/7a781dab51284428bf9a44f3e0c85b6a?s=128&d=identicon&r=PG", "display_name": "Guillermo Siliceo Trueba", "link": "https://stackoverflow.com/users/412528/guillermo-siliceo-trueba"}, "is_accepted": false, "score": 1, "last_activity_date": 1524575049, "creation_date": 1524575049, "answer_id": 50002445, "question_id": 49987793, "link": "https://stackoverflow.com/questions/49987793/rails-admin-keep-giving-me-undefined-local-variable-or-method-rails-admin-when/50002445#50002445", "title": "rails_admin keep giving me undefined local variable or method `rails_admin&#39; when access dashboard", "body": "<p>You need to add the dashboard to the list of actions on your initializers/rails_admin.rb like this</p>\n\n<pre><code>RailsAdmin.config do |config|\n  config.actions do\n    dashboard\n  end\nend\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": false, "score": 2, "last_activity_date": 1524917422, "creation_date": 1524917422, "answer_id": 50076411, "question_id": 49987793, "link": "https://stackoverflow.com/questions/49987793/rails-admin-keep-giving-me-undefined-local-variable-or-method-rails-admin-when/50076411#50076411", "title": "rails_admin keep giving me undefined local variable or method `rails_admin&#39; when access dashboard", "body": "<p>Make sure you follow the <a href=\"https://github.com/sferik/rails_admin\" rel=\"nofollow noreferrer\">setup instructions</a></p>\n\n<pre><code>rails g rails_admin:install\n</code></pre>\n\n<p>Also can you post the helper method code which is raising the error?</p>\n\n<p>Try changing this in your haml file</p>\n\n<pre><code>#change\nrails_admin.url \n#to \nrails_admin_url\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 86, "user_id": 9315970, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-CM162SiXKAk/AAAAAAAAAAI/AAAAAAAAAEQ/7Yu2Ntze5tQ/photo.jpg?sz=128", "display_name": "Radiet Billahirabba", "link": "https://stackoverflow.com/users/9315970/radiet-billahirabba"}, "is_accepted": true, "score": 2, "last_activity_date": 1525429713, "creation_date": 1525429713, "answer_id": 50172774, "question_id": 49987793, "link": "https://stackoverflow.com/questions/49987793/rails-admin-keep-giving-me-undefined-local-variable-or-method-rails-admin-when/50172774#50172774", "title": "rails_admin keep giving me undefined local variable or method `rails_admin&#39; when access dashboard", "body": "<p>have you tried to fix your route.rb</p>\n\n<p>you can use this configuration : </p>\n\n<pre><code>devise_for :admins\nmount RailsAdmin::Engine =&gt; '/admin', as: 'rails_admin'\n</code></pre>\n"}], "owner": {"reputation": 288, "user_id": 5241456, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-dyuG5GGKgAc/AAAAAAAAAAI/AAAAAAAAAHw/r4oZO6Om9MA/photo.jpg?sz=128", "display_name": "Muhammad Rahmatullah", "link": "https://stackoverflow.com/users/5241456/muhammad-rahmatullah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 631, "favorite_count": 1, "accepted_answer_id": 50172774, "answer_count": 4, "score": 5, "last_activity_date": 1525429713, "creation_date": 1524508450, "question_id": 49987793, "link": "https://stackoverflow.com/questions/49987793/rails-admin-keep-giving-me-undefined-local-variable-or-method-rails-admin-when", "title": "rails_admin keep giving me undefined local variable or method `rails_admin&#39; when access dashboard", "body": "<p>I've followed this:</p>\n\n<p><a href=\"https://github.com/sferik/rails_admin\" rel=\"noreferrer\">https://github.com/sferik/rails_admin</a></p>\n\n<p>And I think I've done everything needed, bundle install, rake db:migrate etc but I can't get rid of:</p>\n\n<p><code>undefined local variable or method \"rails_admin\" for #&lt;#&lt;Class:0x0055e4c3e49c30&gt;:0x0055e4c2e61db8&gt;</code></p>\n\n<p><a href=\"https://i.stack.imgur.com/inK0h.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/inK0h.png\" alt=\"enter image description here\"></a>\n`\nAny ideas?</p>\n"}, {"tags": ["ruby", "parsing"], "comments": [{"owner": {"reputation": 5134, "user_id": 1672197, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/i8HkV.png?s=128&g=1", "display_name": "orde", "link": "https://stackoverflow.com/users/1672197/orde"}, "edited": false, "score": 0, "creation_date": 1524507150, "post_id": 49987368, "comment_id": 86991138, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/5528281/ruby-parsing-a-text-file\">Ruby - parsing a text file</a>"}, {"owner": {"reputation": 4693, "user_id": 5501536, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/50b9ab14ab8699a3862c14ee48126abe?s=128&d=identicon&r=PG&f=1", "display_name": "chevybow", "link": "https://stackoverflow.com/users/5501536/chevybow"}, "edited": false, "score": 1, "creation_date": 1524507694, "post_id": 49987368, "comment_id": 86991388, "body": "What have you tried so far?"}, {"owner": {"reputation": 33, "user_id": 8852441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f047077c0e5dc338c20853e5c2132d0?s=128&d=identicon&r=PG&f=1", "display_name": "doe", "link": "https://stackoverflow.com/users/8852441/doe"}, "edited": false, "score": 0, "creation_date": 1524507865, "post_id": 49987368, "comment_id": 86991466, "body": "ty for the reply,already seen that thread, the answer is old and i wanted to know if there is a different and better approach."}, {"owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "edited": false, "score": 0, "creation_date": 1524510464, "post_id": 49987368, "comment_id": 86992816, "body": "What about <code>line.split</code> then check the 2nd element of the array against the 1st?"}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1524514000, "post_id": 49987368, "comment_id": 86994708, "body": "What is the code you are having trouble with? What trouble do you have with your code? Do you get an error message? What is the error message? Is the result you are getting not the result you are expecting? What result do you expect and why, what is the result you are getting and how do the two differ? Is the behavior you are observing not the desired behavior? What is the desired behavior and why, what is the observed behavior, and in what way do they differ? Please, provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1524514019, "post_id": 49987368, "comment_id": 86994719, "body": "Can you provide a <i>precise</i> specification of what it is that you want to happen, including any and all rules, exceptions from those rules, corner cases, special cases, boundary cases, and edge cases? Can you provide sample inputs and outputs demonstrating what you expect to happen, both in normal cases, and in all the exceptions, corner cases, special cases, boundary cases, and edge cases? Please, also make sure to provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1524514055, "post_id": 49987368, "comment_id": 86994743, "body": "&quot;How can i do this?&quot; \u2013 You do it by writing a program which does that. If you have a problem with your program, carefully read the documentation of all the methods, classes, modules, and libraries you are using, write tests for your programs, trace the execution with pen and paper, single-step it in a debugger, then sleep on it, start again from the beginning, sleep on it again, and <i>then and only then</i> narrow your problem down to a concise, focused, simple, short, reproducible <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> and ask a specific, focused, narrow question on <a href=\"https://stackoverflow.com\">Stack Overflow</a>."}, {"owner": {"reputation": 1436, "user_id": 2096740, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/67b4b0da1074e71906237509810c7eac?s=128&d=identicon&r=PG", "display_name": "arjun", "link": "https://stackoverflow.com/users/2096740/arjun"}, "edited": false, "score": 0, "creation_date": 1524565762, "post_id": 49987368, "comment_id": 87014653, "body": "Always write what code you had tried."}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 8852441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f047077c0e5dc338c20853e5c2132d0?s=128&d=identicon&r=PG&f=1", "display_name": "doe", "link": "https://stackoverflow.com/users/8852441/doe"}, "edited": false, "score": 0, "creation_date": 1524587822, "post_id": 49999392, "comment_id": 87030075, "body": "thankyou arjun, and if there are more complex lines,like email a@g.com, i should use regex to see that the text is correct,right?"}, {"owner": {"reputation": 1436, "user_id": 2096740, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/67b4b0da1074e71906237509810c7eac?s=128&d=identicon&r=PG", "display_name": "arjun", "link": "https://stackoverflow.com/users/2096740/arjun"}, "reply_to_user": {"reputation": 33, "user_id": 8852441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f047077c0e5dc338c20853e5c2132d0?s=128&d=identicon&r=PG&f=1", "display_name": "doe", "link": "https://stackoverflow.com/users/8852441/doe"}, "edited": false, "score": 0, "creation_date": 1524588490, "post_id": 49999392, "comment_id": 87030416, "body": "Yeah you can perform your checks the way you like after you get the hash. But if you have a choice on the format of the file, perhaps this is better suited as CSV or YML or even JSON"}, {"owner": {"reputation": 33, "user_id": 8852441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f047077c0e5dc338c20853e5c2132d0?s=128&d=identicon&r=PG&f=1", "display_name": "doe", "link": "https://stackoverflow.com/users/8852441/doe"}, "edited": false, "score": 0, "creation_date": 1524591019, "post_id": 49999392, "comment_id": 87031740, "body": "that will work, i will try to expand my exercise in this directions, ty again"}], "tags": [], "owner": {"reputation": 1436, "user_id": 2096740, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/67b4b0da1074e71906237509810c7eac?s=128&d=identicon&r=PG", "display_name": "arjun", "link": "https://stackoverflow.com/users/2096740/arjun"}, "is_accepted": true, "score": 0, "last_activity_date": 1524565721, "creation_date": 1524565721, "answer_id": 49999392, "question_id": 49987368, "link": "https://stackoverflow.com/questions/49987368/parsing-a-file-in-ruby/49999392#49999392", "title": "Parsing a file in ruby", "body": "<p>Based on the format of your file, you can check for the presence of integer in the line, and then perform your checks</p>\n\n<pre><code>@a={};File.foreach('f1.txt') do |f| # foreach ensures reading line by line without slurping the entire file into memory\n  # add first word as key = create array with rest of data and add note if it is number or stirng\n  @a[f.split.first] = [f.split.last, (f.scan(/\\d+/).empty?) ? \"string\" : \"number\"]\n  puts\nend\n\n=&gt; {\"Number\"=&gt;[\"1\", \"number\"], \"Date\"=&gt;[\"01/01/2001\", \"number\"], \"Name\"=&gt;[\"John\", \"string\"], \"Age\"=&gt;[\"20\", \"number\"], \"Job\"=&gt;[\"Programmer\", \"string\"]}\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 8852441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f047077c0e5dc338c20853e5c2132d0?s=128&d=identicon&r=PG&f=1", "display_name": "doe", "link": "https://stackoverflow.com/users/8852441/doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 49999392, "answer_count": 1, "score": 0, "last_activity_date": 1524565721, "creation_date": 1524506755, "question_id": 49987368, "link": "https://stackoverflow.com/questions/49987368/parsing-a-file-in-ruby", "title": "Parsing a file in ruby", "body": "<p>I am trying to parse a text file that is populated with names,age and other information about a person, like this:</p>\n\n<pre><code>Number 1\nDate 01/01/2001\nName John\nAge 20\nJob Programmer\n</code></pre>\n\n<p>So when the first string of the row is Name in the rest of the row i have a string, when the first string is Age i expect a number.\nWhat i want is to check that i have a match between the first string in the row and the rest of the row. So if i have Name 20 in the same row i should get an error message.\nHow can i do this?</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 26120, "user_id": 219883, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/c35b5b0f9e7cce48864f4f1545ead995?s=128&d=identicon&r=PG", "display_name": "Taryn East", "link": "https://stackoverflow.com/users/219883/taryn-east"}, "edited": false, "score": 1, "creation_date": 1524527836, "post_id": 49986700, "comment_id": 86999625, "body": "I&#39;m not sure what you want from us to help you... you want a table? create a migration. you want to store the response data in there? the table should probably have a json column - then you&#39;d create a model that matches that table and do <code>MyModel.create(data: response.body)</code> or something in your controller."}], "answers": [{"tags": [], "owner": {"reputation": 124, "user_id": 3541824, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/617205904/picture?type=large", "display_name": "danielavila", "link": "https://stackoverflow.com/users/3541824/danielavila"}, "is_accepted": true, "score": 0, "last_activity_date": 1524537710, "creation_date": 1524537710, "answer_id": 49992659, "question_id": 49986700, "link": "https://stackoverflow.com/questions/49986700/how-to-save-the-http-request-curl-in-rails/49992659#49992659", "title": "how to save the http.request curl in rails?", "body": "<p>If I understood correctly what you want is to make a HTTP request then parse the response and store it into a table (model) in your database. Well if that is the case:</p>\n\n<pre><code>require 'net/https'\nuri = URI.parse(\"http://example.com/path\")\n// You can change the request method to whatever method you want\nrequest = Net::HTTP::Post.new(uri.request_uri)\nrequest.body = { //json hear in case you need it }\nrequest.add_field 'token', 'XXXXX'\nresponse = http.request(request).body\njson_response = JSON.parse(response, symbolize_names: true)\n</code></pre>\n\n<p>You will have the response in <code>json_response</code>, then you only will have to store that information in the model you want:</p>\n\n<p><code>Model.create(attribute_1: json_response[:parameter_1], attribute_2: json_response[:parameter_2]...)</code></p>\n"}], "owner": {"reputation": 93, "user_id": 9447658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/737e381a3fe807cf38cc4cf88c67c14a?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastian Ruiz Perez", "link": "https://stackoverflow.com/users/9447658/sebastian-ruiz-perez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 49992659, "answer_count": 1, "score": -1, "last_activity_date": 1524537710, "creation_date": 1524504225, "question_id": 49986700, "link": "https://stackoverflow.com/questions/49986700/how-to-save-the-http-request-curl-in-rails", "title": "how to save the http.request curl in rails?", "body": "<p>I already managed to make a post request of curl in rails\nI print on the console the response.body</p>\n\n<pre><code>{\"access_token\":\"XXXXXXX\",\"public_key\":\"XXXXXX\",\"refresh_token\":\"XXXXXX\",\"live_mode\":false,\"user_id\":XXXX,\"token_type\":\"bearer\",\"expires_in\":15552000,\"scope\":\"offline_access read write\"}\n</code></pre>\n\n<p>now I want to gurantee that data in a table in rails</p>\n\n<p>How can you do that?</p>\n\n<pre><code>response = Net::HTTP.start(uri.hostname, uri.port, req_options) do |http|\n    http.request(request)\n  end\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 31555, "user_id": 677684, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/5a785c03c08d7de6a15aaea326835cd6?s=128&d=identicon&r=PG", "display_name": "Tilo", "link": "https://stackoverflow.com/users/677684/tilo"}, "edited": false, "score": 1, "creation_date": 1524504405, "post_id": 49986670, "comment_id": 86989750, "body": "the issue seems to be that <code>elements</code> changes from an Array to a Hash. Check your controller code.."}, {"owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "edited": false, "score": 1, "creation_date": 1524505178, "post_id": 49986670, "comment_id": 86990139, "body": "I tried to convert your hash and I find no problems, back and forth. As I understand your question. Stored the hash you posted into <code>hash_data</code>, then <code>puts json_data = hash_data.to_json puts JSON.parse(data_json)</code>"}, {"owner": {"reputation": 2205, "user_id": 6460122, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/WTsp7.jpg?s=128&g=1", "display_name": "ricks", "link": "https://stackoverflow.com/users/6460122/ricks"}, "reply_to_user": {"reputation": 31555, "user_id": 677684, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/5a785c03c08d7de6a15aaea326835cd6?s=128&d=identicon&r=PG", "display_name": "Tilo", "link": "https://stackoverflow.com/users/677684/tilo"}, "edited": false, "score": 0, "creation_date": 1524505197, "post_id": 49986670, "comment_id": 86990151, "body": "@Tilo all i am doing in my controller is converting it to_json and printing it and i am also printing what the ajax call is sending over, i&#39;m not sure if i should be converting the hash into json another way?"}, {"owner": {"reputation": 2205, "user_id": 6460122, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/WTsp7.jpg?s=128&g=1", "display_name": "ricks", "link": "https://stackoverflow.com/users/6460122/ricks"}, "reply_to_user": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "edited": false, "score": 0, "creation_date": 1524505813, "post_id": 49986670, "comment_id": 86990481, "body": "@iGian it was converting it correctly. My issue was on the javascript side! I had to use JSON.stringify before sending it over, thanks for the help guys."}, {"owner": {"reputation": 136, "user_id": 3540495, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ON2ijeeDNqw/AAAAAAAAAAI/AAAAAAAAAR8/9HRK2QEV9o4/photo.jpg?sz=128", "display_name": "ArMD", "link": "https://stackoverflow.com/users/3540495/armd"}, "edited": false, "score": 0, "creation_date": 1524505947, "post_id": 49986670, "comment_id": 86990551, "body": "Can you post your code on how you are calling to_json. It looks like the internal array is getting covered to a Hash"}], "answers": [{"tags": [], "owner": {"reputation": 2205, "user_id": 6460122, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/WTsp7.jpg?s=128&g=1", "display_name": "ricks", "link": "https://stackoverflow.com/users/6460122/ricks"}, "is_accepted": false, "score": 0, "last_activity_date": 1524505943, "creation_date": 1524505943, "answer_id": 49987161, "question_id": 49986670, "link": "https://stackoverflow.com/questions/49986670/ruby-how-can-i-convert-a-hash-to-json-array-without-turning-into-0/49987161#49987161", "title": "Ruby - How can i convert a Hash to Json array without &quot;[&quot; turning into &#39;&#39;{&quot;0&quot;:&quot;", "body": "<p>My issues ended up being on the Javascript side and not ruby</p>\n\n<pre><code>$.ajax({\nurl: \"/email_templates/create_email\",\ntype: \"POST\",\ndata: {\n\n    email:email, mjml: mjml\n},\nsuccess: function(resp) {\n\n},\nerror: function(resp) {\n    console.log('There was an error, please contact support.')\n},\n});\n</code></pre>\n\n<p>i was sending over <code>email:email</code> when i should've been doing <code>JSON.stringify(email)</code></p>\n"}], "owner": {"reputation": 2205, "user_id": 6460122, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/WTsp7.jpg?s=128&g=1", "display_name": "ricks", "link": "https://stackoverflow.com/users/6460122/ricks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524505943, "creation_date": 1524504094, "question_id": 49986670, "link": "https://stackoverflow.com/questions/49986670/ruby-how-can-i-convert-a-hash-to-json-array-without-turning-into-0", "title": "Ruby - How can i convert a Hash to Json array without &quot;[&quot; turning into &#39;&#39;{&quot;0&quot;:&quot;", "body": "<p>In javascript I have an <code>ajax</code> call sending json to my ruby controller </p>\n\n<pre><code>$.ajax({\nurl: \"/email_templates/create_email\",\ntype: \"POST\",\ndata: {\n\n    email: email, mjml: mjml\n},\nsuccess: function(resp) {\n\n},\nerror: function(resp) {\n    console.log('There was an error, please contact support.')\n},\n});\n</code></pre>\n\n<p>The Json that is being sent over looks like this:</p>\n\n<pre><code>{\"elements\":[{\"type\":\"text\",\"options\":{\"subSection1\":\"Text style\",\"font\":{\"size\":16,\"sizeOptions\":[9,10,11,12,13,14,16,18,24,30,36,48,60,62],\"family\":\"inherit\",\"familyOptions\":[\"inherit\",\"Georgia, serif\",\"'Palatino Linotype', 'Book Antiqua', Palatino, serif\",\"'Times New Roman', Times, serif\",\"Arial, Helvetica, sans-serif\",\"'Arial Black', Gadget, sans-serif\",\"'Comic Sans MS', cursive, sans-serif\",\"Impact, Charcoal, sans-serif\",\"'Lucida Sans Unicode', 'Lucida Grande', sans-serif\",\"Tahoma, Geneva, sans-serif\",\"'Trebuchet MS', Helvetica, sans-serif\",\"Verdana, Geneva, sans-serif\",\"'Courier New', Courier, monospace\",\"'Lucida Console', Monaco, monospace\"]},\"lineHeight\":\"s2\",\"backgroundColor\":\"#ffffff\",\"padding\":[15,15,15,15],\"text\":\"Lorem ipsum dolor sit amet, consectetur adipisci elit, sed eiusmod tempor incidunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur. Quis aute iure reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint obcaecat cupiditat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.\"},\"id\":\"id1524503670739RAND99067\",\"component\":\"textTemplate\"},{\"type\":\"button\",\"options\":{\"subSection1\":\"Button settings\",\"buttonText\":\"Click me\",\"linkTo\":{\"type\":\"none\",\"typeOptions\":[\"link\",\"email\",\"none\"],\"link\":\"\"},\"subSection2\":\"Border style\",\"border\":{\"size\":1,\"radius\":3,\"color\":\"#3498DB\",\"style\":\"solid\",\"styleOptions\":[\"dotted\",\"solid\",\"dashed\"]},\"subSection3\":\"Button style\",\"fullWidth\":\"false\",\"align\":\"center\",\"buttonBackgroundColor\":\"#3498DB\",\"backgroundColor\":\"#ffffff\",\"font\":{\"size\":16,\"sizeOptions\":[9,10,11,12,13,14,16,18,24,30,36,48,60,62],\"color\":\"#ffffff\",\"weight\":\"normal\",\"italic\":\"\",\"weightOptions\":[\"bold\",\"lighter\",\"inherit\",\"initial\",\"normal\",100,200,300,400,500,600,700,800,900],\"family\":\"inherit\",\"familyOptions\":[\"inherit\",\"Georgia, serif\",\"'Palatino Linotype', 'Book Antiqua', Palatino, serif\",\"'Times New Roman', Times, serif\",\"Arial, Helvetica, sans-serif\",\"'Arial Black', Gadget, sans-serif\",\"'Comic Sans MS', cursive, sans-serif\",\"Impact, Charcoal, sans-serif\",\"'Lucida Sans Unicode', 'Lucida Grande', sans-serif\",\"Tahoma, Geneva, sans-serif\",\"'Trebuchet MS', Helvetica, sans-serif\",\"Verdana, Geneva, sans-serif\",\"'Courier New', Courier, monospace\",\"'Lucida Console', Monaco, monospace\"]},\"innerPadding\":[12,20,12,20],\"margin\":[0,0,0,0],\"padding\":[15,15,15,15]},\"id\":\"id1524503666177RAND67491\",\"component\":\"buttonTemplate\"}],\"emailSettings\":{\"id\":\"id1524503660421RAND64452\",\"component\":\"emailSettingsTemplate\",\"options\":{\"width\":600,\"paddingTop\":50,\"paddingBottom\":50,\"backgroundColor\":\"#f4f5f4\"},\"type\":\"emailSettings\"},\"html\":\"\"}\n</code></pre>\n\n<p>and what im receiving in my controller with </p>\n\n<pre><code>def create\n\nbody_json = params[:email]\n\np body_json\n\nend\n</code></pre>\n\n<p>looks like:</p>\n\n<pre><code>{\"elements\"=&gt;{\"0\"=&gt;{\"type\"=&gt;\"text\", \"options\"=&gt;{\"subSection1\"=&gt;\"Text style\", \"font\"=&gt;{\"size\"=&gt;\"16\", \"sizeOptions\"=&gt;[\"9\", \"10\", \"11\", \"12\", \"13\", \"14\", \"16\", \"18\", \"24\", \"30\", \"36\", \"48\", \"60\", \"62\"], \"family\"=&gt;\"inherit\", \"familyOptions\"=&gt;[\"inherit\", \"Georgia, serif\", \"'Palatino Linotype', 'Book Antiqua', Palatino, serif\", \"'Times New Roman', Times, serif\", \"Arial, Helvetica, sans-serif\", \"'Arial Black', Gadget, sans-serif\", \"'Comic Sans MS', cursive, sans-serif\", \"Impact, Charcoal, sans-serif\", \"'Lucida Sans Unicode', 'Lucida Grande', sans-serif\", \"Tahoma, Geneva, sans-serif\", \"'Trebuchet MS', Helvetica, sans-serif\", \"Verdana, Geneva, sans-serif\", \"'Courier New', Courier, monospace\", \"'Lucida Console', Monaco, monospace\"]}, \"lineHeight\"=&gt;\"s2\", \"backgroundColor\"=&gt;\"#ffffff\", \"padding\"=&gt;[\"15\", \"15\", \"15\", \"15\"], \"text\"=&gt;\"Lorem ipsum dolor sit amet, consectetur adipisci elit, sed eiusmod tempor incidunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur. Quis aute iure reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint obcaecat cupiditat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.\"}, \"id\"=&gt;\"id1524503161899RAND77809\", \"component\"=&gt;\"textTemplate\"}, \"1\"=&gt;{\"type\"=&gt;\"button\", \"options\"=&gt;{\"subSection1\"=&gt;\"Button settings\", \"buttonText\"=&gt;\"Click me\", \"linkTo\"=&gt;{\"type\"=&gt;\"none\", \"typeOptions\"=&gt;[\"link\", \"email\", \"none\"], \"link\"=&gt;\"\"}, \"subSection2\"=&gt;\"Border style\", \"border\"=&gt;{\"size\"=&gt;\"1\", \"radius\"=&gt;\"3\", \"color\"=&gt;\"#3498DB\", \"style\"=&gt;\"solid\", \"styleOptions\"=&gt;[\"dotted\", \"solid\", \"dashed\"]}, \"subSection3\"=&gt;\"Button style\", \"fullWidth\"=&gt;\"false\", \"align\"=&gt;\"center\", \"buttonBackgroundColor\"=&gt;\"#3498DB\", \"backgroundColor\"=&gt;\"#ffffff\", \"font\"=&gt;{\"size\"=&gt;\"16\", \"sizeOptions\"=&gt;[\"9\", \"10\", \"11\", \"12\", \"13\", \"14\", \"16\", \"18\", \"24\", \"30\", \"36\", \"48\", \"60\", \"62\"], \"color\"=&gt;\"#ffffff\", \"weight\"=&gt;\"normal\", \"italic\"=&gt;\"\", \"weightOptions\"=&gt;[\"bold\", \"lighter\", \"inherit\", \"initial\", \"normal\", \"100\", \"200\", \"300\", \"400\", \"500\", \"600\", \"700\", \"800\", \"900\"], \"family\"=&gt;\"inherit\", \"familyOptions\"=&gt;[\"inherit\", \"Georgia, serif\", \"'Palatino Linotype', 'Book Antiqua', Palatino, serif\", \"'Times New Roman', Times, serif\", \"Arial, Helvetica, sans-serif\", \"'Arial Black', Gadget, sans-serif\", \"'Comic Sans MS', cursive, sans-serif\", \"Impact, Charcoal, sans-serif\", \"'Lucida Sans Unicode', 'Lucida Grande', sans-serif\", \"Tahoma, Geneva, sans-serif\", \"'Trebuchet MS', Helvetica, sans-serif\", \"Verdana, Geneva, sans-serif\", \"'Courier New', Courier, monospace\", \"'Lucida Console', Monaco, monospace\"]}, \"innerPadding\"=&gt;[\"12\", \"20\", \"12\", \"20\"], \"margin\"=&gt;[\"0\", \"0\", \"0\", \"0\"], \"padding\"=&gt;[\"15\", \"15\", \"15\", \"15\"]}, \"id\"=&gt;\"id1524503164308RAND72755\", \"component\"=&gt;\"buttonTemplate\"}}, \"emailSettings\"=&gt;{\"id\"=&gt;\"id1524503150293RAND50259\", \"component\"=&gt;\"emailSettingsTemplate\", \"options\"=&gt;{\"width\"=&gt;\"600\", \"paddingTop\"=&gt;\"50\", \"paddingBottom\"=&gt;\"50\", \"backgroundColor\"=&gt;\"#f4f5f4\"}, \"type\"=&gt;\"emailSettings\"}, \"html\"=&gt;\"\"}\n</code></pre>\n\n<p>So what i usually do in ruby to turn a hash to json is .to_json</p>\n\n<p>but thats giving me this output:</p>\n\n<pre><code>{\"elements\":{\"0\":{\"type\":\"text\",\"options\":{\"subSection1\":\"Text style\",\"font\":{\"size\":\"16\",\"sizeOptions\":[\"9\",\"10\",\"11\",\"12\",\"13\",\"14\",\"16\",\"18\",\"24\",\"30\",\"36\",\"48\",\"60\",\"62\"],\"family\":\"inherit\",\"familyOptions\":[\"inherit\",\"Georgia, serif\",\"'Palatino Linotype', 'Book Antiqua', Palatino, serif\",\"'Times New Roman', Times, serif\",\"Arial, Helvetica, sans-serif\",\"'Arial Black', Gadget, sans-serif\",\"'Comic Sans MS', cursive, sans-serif\",\"Impact, Charcoal, sans-serif\",\"'Lucida Sans Unicode', 'Lucida Grande', sans-serif\",\"Tahoma, Geneva, sans-serif\",\"'Trebuchet MS', Helvetica, sans-serif\",\"Verdana, Geneva, sans-serif\",\"'Courier New', Courier, monospace\",\"'Lucida Console', Monaco, monospace\"]},\"lineHeight\":\"s2\",\"backgroundColor\":\"#ffffff\",\"padding\":[\"15\",\"15\",\"15\",\"15\"],\"text\":\"Lorem ipsum dolor sit amet, consectetur adipisci elit, sed eiusmod tempor incidunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur. Quis aute iure reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint obcaecat cupiditat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.\"},\"id\":\"id1524503835438RAND4461\",\"component\":\"textTemplate\"},\"1\":{\"type\":\"button\",\"options\":{\"subSection1\":\"Button settings\",\"buttonText\":\"Click me\",\"linkTo\":{\"type\":\"none\",\"typeOptions\":[\"link\",\"email\",\"none\"],\"link\":\"\"},\"subSection2\":\"Border style\",\"border\":{\"size\":\"1\",\"radius\":\"3\",\"color\":\"#3498DB\",\"style\":\"solid\",\"styleOptions\":[\"dotted\",\"solid\",\"dashed\"]},\"subSection3\":\"Button style\",\"fullWidth\":\"false\",\"align\":\"center\",\"buttonBackgroundColor\":\"#3498DB\",\"backgroundColor\":\"#ffffff\",\"font\":{\"size\":\"16\",\"sizeOptions\":[\"9\",\"10\",\"11\",\"12\",\"13\",\"14\",\"16\",\"18\",\"24\",\"30\",\"36\",\"48\",\"60\",\"62\"],\"color\":\"#ffffff\",\"weight\":\"normal\",\"italic\":\"\",\"weightOptions\":[\"bold\",\"lighter\",\"inherit\",\"initial\",\"normal\",\"100\",\"200\",\"300\",\"400\",\"500\",\"600\",\"700\",\"800\",\"900\"],\"family\":\"inherit\",\"familyOptions\":[\"inherit\",\"Georgia, serif\",\"'Palatino Linotype', 'Book Antiqua', Palatino, serif\",\"'Times New Roman', Times, serif\",\"Arial, Helvetica, sans-serif\",\"'Arial Black', Gadget, sans-serif\",\"'Comic Sans MS', cursive, sans-serif\",\"Impact, Charcoal, sans-serif\",\"'Lucida Sans Unicode', 'Lucida Grande', sans-serif\",\"Tahoma, Geneva, sans-serif\",\"'Trebuchet MS', Helvetica, sans-serif\",\"Verdana, Geneva, sans-serif\",\"'Courier New', Courier, monospace\",\"'Lucida Console', Monaco, monospace\"]},\"innerPadding\":[\"12\",\"20\",\"12\",\"20\"],\"margin\":[\"0\",\"0\",\"0\",\"0\"],\"padding\":[\"15\",\"15\",\"15\",\"15\"]},\"id\":\"id1524503838073RAND14158\",\"component\":\"buttonTemplate\"}},\"emailSettings\":{\"id\":\"id1524503495697RAND55315\",\"component\":\"emailSettingsTemplate\",\"options\":{\"width\":\"600\",\"paddingTop\":\"50\",\"paddingBottom\":\"50\",\"backgroundColor\":\"#f4f5f4\"},\"type\":\"emailSettings\"},\"html\":\"\"}\n</code></pre>\n\n<p>Why is it changing the </p>\n\n<pre><code>{\"elements\":[{\"type\"\n</code></pre>\n\n<p>to </p>\n\n<pre><code>{\"elements\":{\"0\":{\"type\"\n</code></pre>\n\n<p>I need to save it to the DB exactly how im sending it from javascript but i cant seem to get it into the correct format. Could someone please help me and explain to me what i am doing wrong.</p>\n"}, {"tags": ["ruby", "mongodb", "ruby-on-rails-4", "mongoid"], "answers": [{"tags": [], "owner": {"reputation": 11736, "user_id": 610351, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f4ee98206d84b25a83228e285c678f0?s=128&d=identicon&r=PG", "display_name": "Geoffroy", "link": "https://stackoverflow.com/users/610351/geoffroy"}, "is_accepted": false, "score": 1, "last_activity_date": 1524557153, "creation_date": 1524557153, "answer_id": 49996457, "question_id": 49986591, "link": "https://stackoverflow.com/questions/49986591/mongoid-is-it-possible-to-override-updated-at-timestamp/49996457#49996457", "title": "Mongoid Is it possible to override updated_at timestamp", "body": "<p><code>updated_at</code> is updated by mongoid itself in a callback.</p>\n\n<p>You have two solution to work around that.</p>\n\n<p>The easiest solution would be to use <code>set</code> to change the value directly without firing any callback:</p>\n\n<pre><code>thisCampaign.set(channels: thisCampaign['channels'])\n</code></pre>\n\n<p>The more flexible solution would be to go down to the driver level. The basic idea is:</p>\n\n<pre><code>Campaign.collection.find(_id: data_hash[\"_id\"]).update_one({\n  '$set' =&gt; {\n    updated_at: yourDate\n  }\n})\n</code></pre>\n\n<p>Given your example, you would first need to get the full document</p>\n\n<pre><code>thisCampaign = Campaign.collection.find(_id: data_hash[\"_id\"]).first\nif thisCampaign\n  thisCampaign[\"channels\"].each do |chan|\n    if chan[\"updated_at\"] &lt; Date.new(2018,04,19)\n      data_hash[\"channels\"].each do |channel|\n        if chan[\"_id\"].to_s == channel[\"_id\"]\n          chan[\"updated_at\"] = Date.parse(channel[\"updated_at\"])\n        end\n      end\n    end\n  end\n  Campaign.collection.find(_id: data_hash[\"_id\"]).update_one({\n    '$set' =&gt; {channels: thisCampaign[\"channels\"]}\n  })\nend\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 6920732, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-EykuVKQAL90/AAAAAAAAAAI/AAAAAAAAEgk/W8FAaEw44aI/photo.jpg?sz=128", "display_name": "RayedB", "link": "https://stackoverflow.com/users/6920732/rayedb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 338, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1524557153, "creation_date": 1524503786, "question_id": 49986591, "link": "https://stackoverflow.com/questions/49986591/mongoid-is-it-possible-to-override-updated-at-timestamp", "title": "Mongoid Is it possible to override updated_at timestamp", "body": "<p>I am trying to manually edit the \"updated_at\" field through a rake task</p>\n\n<p>Here is what it looks like:</p>\n\n<pre><code>task :campaigns_updated_at_recovery =&gt; :environment do\n\nDir.foreach('db/raw-data/campaigns/') do |json|\n  next if json == '.' or json == '..'\n  file = File.read('db/raw-data/campaigns/'+json)\n  data_hash = JSON.parse(file)\n  #p data_hash[\"_id\"]\n  thisCampaign = Campaign.find(data_hash[\"_id\"])\n  thisCampaign[\"channels\"].each do |chan|\n    if chan[\"updated_at\"] &lt; Date.new(2018,04,19)\n      data_hash[\"channels\"].each do |channel|\n        if chan[\"_id\"].to_s == channel[\"_id\"]\n          chan[\"updated_at\"] = Date.parse(channel[\"updated_at\"])\n        end\n      end\n    end\n    thisCampaign.save\n  end\nend\n</code></pre>\n\n<p>However when I run this task, the updated_at date is either not changed or updated to today's date.\nWhat am I missing ?</p>\n\n<p><strong>I am using Mongoid and not ActiveRecord by the way</strong></p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1524500323, "post_id": 49985549, "comment_id": 86987643, "body": "Could you translate that error? It doesn&#39;t appear to be related to routing."}, {"owner": {"reputation": 1006, "user_id": 4594902, "user_type": "registered", "accept_rate": 65, "profile_image": "https://graph.facebook.com/686173344826419/picture?type=large", "display_name": "Ilja KO", "link": "https://stackoverflow.com/users/4594902/ilja-ko"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1524500507, "post_id": 49985549, "comment_id": 86987747, "body": "edited it @tadman"}, {"owner": {"reputation": 1006, "user_id": 4594902, "user_type": "registered", "accept_rate": 65, "profile_image": "https://graph.facebook.com/686173344826419/picture?type=large", "display_name": "Ilja KO", "link": "https://stackoverflow.com/users/4594902/ilja-ko"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1524500614, "post_id": 49985549, "comment_id": 86987803, "body": "also it only works when I dont add this line and leave it as it is. So no routing for me I guess...onto the next Webframework solution :D jk"}, {"owner": {"reputation": 61438, "user_id": 63034, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/ZXKMO.jpg?s=128&g=1", "display_name": "mikej", "link": "https://stackoverflow.com/users/63034/mikej"}, "edited": false, "score": 0, "creation_date": 1524501031, "post_id": 49985549, "comment_id": 86988030, "body": "Googling the English translation of the error message turns up a bunch of Stack Overflow questions suggesting that this is a Windows-specific issue and offering a few solutions. This one looks like a good starting point: <a href=\"https://stackoverflow.com/questions/12520456/execjsruntimeerror-on-windows-trying-to-follow-rubytutorial/14118913#14118913\" title=\"execjsruntimeerror on windows trying to follow rubytutorial\">stackoverflow.com/questions/12520456/&hellip;</a>"}, {"owner": {"reputation": 6942, "user_id": 4172515, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/BYWxd.jpg?s=128&g=1", "display_name": "fool-dev", "link": "https://stackoverflow.com/users/4172515/fool-dev"}, "edited": false, "score": 0, "creation_date": 1524501519, "post_id": 49985549, "comment_id": 86988266, "body": "Run <code>bundle install</code> then start the server again, just in case try to change <code>root to:  &quot;welcome#index&quot;</code>"}, {"owner": {"reputation": 6942, "user_id": 4172515, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/BYWxd.jpg?s=128&g=1", "display_name": "fool-dev", "link": "https://stackoverflow.com/users/4172515/fool-dev"}, "edited": false, "score": 0, "creation_date": 1524501664, "post_id": 49985549, "comment_id": 86988334, "body": "Also try to removing <code>require self</code> or <code>tree</code> from <code>application.js</code> then restart the server, it happaned many cases, just googling and apply this"}, {"owner": {"reputation": 1006, "user_id": 4594902, "user_type": "registered", "accept_rate": 65, "profile_image": "https://graph.facebook.com/686173344826419/picture?type=large", "display_name": "Ilja KO", "link": "https://stackoverflow.com/users/4594902/ilja-ko"}, "reply_to_user": {"reputation": 61438, "user_id": 63034, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/ZXKMO.jpg?s=128&g=1", "display_name": "mikej", "link": "https://stackoverflow.com/users/63034/mikej"}, "edited": false, "score": 0, "creation_date": 1524501710, "post_id": 49985549, "comment_id": 86988365, "body": "@mikej I did and it worked <i>shaking my head</i>"}, {"owner": {"reputation": 1006, "user_id": 4594902, "user_type": "registered", "accept_rate": 65, "profile_image": "https://graph.facebook.com/686173344826419/picture?type=large", "display_name": "Ilja KO", "link": "https://stackoverflow.com/users/4594902/ilja-ko"}, "reply_to_user": {"reputation": 6942, "user_id": 4172515, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/BYWxd.jpg?s=128&g=1", "display_name": "fool-dev", "link": "https://stackoverflow.com/users/4172515/fool-dev"}, "edited": false, "score": 0, "creation_date": 1524501768, "post_id": 49985549, "comment_id": 86988400, "body": "@fool-dev thank you for your help the remocing line did it. I updated and will report that this question is allready answered elsewhere"}, {"owner": {"reputation": 6942, "user_id": 4172515, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/BYWxd.jpg?s=128&g=1", "display_name": "fool-dev", "link": "https://stackoverflow.com/users/4172515/fool-dev"}, "edited": false, "score": 0, "creation_date": 1524501873, "post_id": 49985549, "comment_id": 86988455, "body": "Well Done :)  See this <a href=\"https://stackoverflow.com/help/mcve\">How to create a Minimal, Complete, and Verifiable example</a>"}], "owner": {"reputation": 1006, "user_id": 4594902, "user_type": "registered", "accept_rate": 65, "profile_image": "https://graph.facebook.com/686173344826419/picture?type=large", "display_name": "Ilja KO", "link": "https://stackoverflow.com/users/4594902/ilja-ko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 177, "favorite_count": 0, "closed_date": 1524501794, "answer_count": 0, "score": 1, "last_activity_date": 1524501607, "creation_date": 1524499945, "last_edit_date": 1524501607, "question_id": 49985549, "link": "https://stackoverflow.com/questions/49985549/hello-world-in-ruby-on-rails-getting-started-tutorial-not-working", "closed_reason": "Duplicate", "title": "Hello World in Ruby On Rails Getting Started Tutorial not working", "body": "<p>Hello I am new to Ruby on Rails. Here is my Setup on my Windows 10 machine</p>\n\n<pre><code>C:\\Users\\Jaiel&gt;ruby -v\nruby 2.3.3p222 (2016-11-21 revision 56859) [i386-mingw32]\n\nC:\\Users\\Jaiel&gt;sqlite3 --version\n3.8.7.2 2014-11-18 20:57:56 2ab564bf9655b7c7b97ab85cafc8a48329b27f93\n\nC:\\Users\\Jaiel&gt;rails --version\nRails 5.1.6\n</code></pre>\n\n<p>I am following the step by step tutorial form\n<a href=\"http://guides.rubyonrails.org/getting_started.html\" rel=\"nofollow noreferrer\">http://guides.rubyonrails.org/getting_started.html</a>\n but I get an Error</p>\n\n<p>I've run</p>\n\n<pre><code>C:\\Users\\Jaiel\\Desktop\\Test&gt;rails new blog\n</code></pre>\n\n<p>Then I ran</p>\n\n<pre><code>C:\\Users\\Jaiel\\Desktop\\Test&gt;cd blog\nC:\\Users\\Jaiel\\Desktop\\Test\\blog&gt;rails server\n</code></pre>\n\n<p>And opened </p>\n\n<pre><code>http://localhost:3000/ \n</code></pre>\n\n<p>and saw the \"Yay, You're on Rails\" Webpage</p>\n\n<p>Then Ive ran</p>\n\n<pre><code>C:\\Users\\Jaiel\\Desktop\\Test\\blog&gt;rails generate controller Welcome index\n  create  app/controllers/welcome_controller.rb\n   route  get 'welcome/index'\n  invoke  erb\n  create    app/views/welcome\n  create    app/views/welcome/index.html.erb\n  invoke  test_unit\n  create    test/controllers/welcome_controller_test.rb\n  invoke  helper\n  create    app/helpers/welcome_helper.rb\n  invoke    test_unit\n  invoke  assets\n  invoke    coffee\n  create      app/assets/javascripts/welcome.coffee\n  invoke    scss\n  create      app/assets/stylesheets/welcome.scss\n</code></pre>\n\n<p>I opened the </p>\n\n<pre><code>app/views/welcome/index.html.erb \n</code></pre>\n\n<p>file in my text editor. Deleted all of the existing code in the file, and replaced it with the following single line of code:</p>\n\n<pre><code>&lt;h1&gt;Hello, Rails!&lt;/h1&gt;\n</code></pre>\n\n<p>I then opened the file </p>\n\n<pre><code>config/routes.rb \n</code></pre>\n\n<p>in my editor and edited it to look like this:</p>\n\n<pre><code>Rails.application.routes.draw do\nget 'welcome/index'\nroot 'welcome#index'\n# For details on the DSL available within this file, see http://guides.rubyonrails.org/routing.html\nend\n</code></pre>\n\n<p>But now when I start the server</p>\n\n<pre><code>C:\\Users\\Jaiel\\Desktop\\Test\\blog&gt;rails server\n</code></pre>\n\n<p>and go to  </p>\n\n<pre><code>http://localhost:3000/\n</code></pre>\n\n<p>Now comes the Error:</p>\n\n<p>in the console and the error page it the says</p>\n\n<pre><code>Started GET \"/\" for 127.0.0.1 at 2018-04-23 18:05:56 +0200\nProcessing by WelcomeController#index as HTML\nRendering welcome/index.html.erb within layouts/application\nRendered welcome/index.html.erb within layouts/application (0.5ms)\nCompleted 500 Internal Server Error in 371ms\n\nActionView::Template::Error (TypeError: Das Objekt unterst\u00fctzt diese Eigenschaft oder Methode nicht.):\n4:     &lt;title&gt;Blog&lt;/title&gt;\n5:     &lt;%= csrf_meta_tags %&gt;\n6:\n7:     &lt;%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload' %&gt;\n8:     &lt;%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %&gt;\n9:   &lt;/head&gt;\n10:\n\napp/views/layouts/application.html.erb:7:in `_app_views_layouts_application_html_erb__839057971_94964316'\n</code></pre>\n\n<p>So line 7 gives the Error here :(</p>\n\n<p>The Error is translated from german to</p>\n\n<pre><code>(TypeError: Object doesn't support this property or method)\n</code></pre>\n\n<p>It is because of the line </p>\n\n<pre><code>root 'welcome#index'\n</code></pre>\n\n<p>that I added into</p>\n\n<pre><code>C:\\Users\\Jaiel\\Desktop\\Test\\blog\\config\\routes.rb\n</code></pre>\n\n<p>What is wrong here. Its the pofficial guide and the first Hello World Example but its already messed up...</p>\n\n<p><strong>Update:</strong> I removed the line</p>\n\n<p>//= require_tree .</p>\n\n<p>from</p>\n\n<pre><code>C:\\Users\\Jaiel\\Desktop\\Test\\blog\\app\\assets\\javascripts\\application.js\n</code></pre>\n\n<p>and it worked. But this is a ridiculous solution as stated here <a href=\"https://stackoverflow.com/questions/12520456/execjsruntimeerror-on-windows-trying-to-follow-rubytutorial/14118913#14118913\">ExecJS::RuntimeError on Windows trying to follow rubytutorial</a></p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-5"], "answers": [{"comments": [{"owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "edited": false, "score": 0, "creation_date": 1524497028, "post_id": 49984568, "comment_id": 86985623, "body": "I agree. Faster than me."}, {"owner": {"reputation": 4600, "user_id": 5961578, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/df7cbfdd2a92a7926af3bbb8648318aa?s=128&d=identicon&r=PG", "display_name": "moveson", "link": "https://stackoverflow.com/users/5961578/moveson"}, "edited": false, "score": 2, "creation_date": 1524499650, "post_id": 49984568, "comment_id": 86987196, "body": "Since we are using Rails, <code>if @product.variations.many?</code> is a bit more concise."}, {"owner": {"reputation": 301, "user_id": 6701820, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Q_9g0OuM9ZQ/AAAAAAAAAAI/AAAAAAAAAEw/ktX4E3hT93s/photo.jpg?sz=128", "display_name": "TheVinspro", "link": "https://stackoverflow.com/users/6701820/thevinspro"}, "edited": false, "score": 0, "creation_date": 1524567602, "post_id": 49984568, "comment_id": 87015864, "body": "@mikwat don&#39;t need run an extra query, you can loop like this.       <code>&lt;% (@product.variations || []).each do |v| %&gt;     ...  &lt;% end %&gt;</code>"}, {"owner": {"reputation": 523, "user_id": 2817111, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99961f704b8fb737c723a0b403887949?s=128&d=identicon&r=PG", "display_name": "mikwat", "link": "https://stackoverflow.com/users/2817111/mikwat"}, "reply_to_user": {"reputation": 301, "user_id": 6701820, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Q_9g0OuM9ZQ/AAAAAAAAAAI/AAAAAAAAAEw/ktX4E3hT93s/photo.jpg?sz=128", "display_name": "TheVinspro", "link": "https://stackoverflow.com/users/6701820/thevinspro"}, "edited": false, "score": 0, "creation_date": 1524589161, "post_id": 49984568, "comment_id": 87030823, "body": "@TheVinspro That won&#39;t work because the requirement is to only iterate over <code>variations</code> when there are <b>more than 1</b>."}], "tags": [], "owner": {"reputation": 523, "user_id": 2817111, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99961f704b8fb737c723a0b403887949?s=128&d=identicon&r=PG", "display_name": "mikwat", "link": "https://stackoverflow.com/users/2817111/mikwat"}, "is_accepted": true, "score": 2, "last_activity_date": 1524496870, "creation_date": 1524496870, "answer_id": 49984568, "question_id": 49984354, "link": "https://stackoverflow.com/questions/49984354/rails-5-if-statement-with-loop-index/49984568#49984568", "title": "Rails 5 if statement with loop index", "body": "<p>If I understand correctly, you only want to show the thumbnail slider when the number of variations are greater than 1 which can be accomplished by looking at <code>@product.variations.count</code>. I don't see any need to use the index.</p>\n\n<pre><code>&lt;% if @product.variations.count &gt; 1 %&gt;\n  &lt;% @product.variations.each do |v| %&gt;\n    ...\n  &lt;% end %&gt;\n&lt;% end %&gt;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 29, "user_id": 8360855, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sGW3Z.jpg?s=128&g=1", "display_name": "Kh\u1eafc To&#224;n \u0110\u1eb7ng", "link": "https://stackoverflow.com/users/8360855/kh%e1%ba%afc-to%c3%a0n-%c4%90%e1%ba%b7ng"}, "is_accepted": false, "score": 0, "last_activity_date": 1524497074, "creation_date": 1524497074, "answer_id": 49984638, "question_id": 49984354, "link": "https://stackoverflow.com/questions/49984354/rails-5-if-statement-with-loop-index/49984638#49984638", "title": "Rails 5 if statement with loop index", "body": "<p>You want to show the variations if the product has more than one variation? Try this. </p>\n\n<pre><code>&lt;% if @product.variations.count &gt; 1 %&gt;    \n      &lt;% @product.variations.each do |variation| %&gt;\n            &lt;% if variation.photo_one.present? %&gt;\n              &lt;div class=\"col-md-2\" style=\"padding: 0 7px\"&gt;\n                &lt;div class=\"btn-filter-wrap\"&gt;\n                  &lt;button class=\"btn-filter\"\n                    data-filter=\".id-&lt;%= variantion.id %&gt;\"\n                    style=\"background: url(&lt;%= (variation.photo_one_url(:thumb)) %&gt;) no-repeat center;\n                        background-size: contain;\n                        width: 100%;\n                        height: 130px\"&gt;\n                  &lt;/button&gt;\n                &lt;/div&gt;\n                &lt;div class=\"row\"&gt;\n                  &lt;div class=\"col-md-2\" style=\"width: 100%; text-align:center\"&gt;\n                    &lt;h5 style=\"font-weight: 800;\n                        text-transform: uppercase;\n                        color: #555555;\n                        line-height: 1.8\"&gt;&lt;%= variation.name %&gt;&lt;/h5&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;% end %&gt;\n        &lt;% end %&gt;\n      &lt;% end %&gt;\n</code></pre>\n"}], "owner": {"reputation": 2525, "user_id": 3200391, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/dc8c798b0aaf54577e388f7bc177093c?s=128&d=identicon&r=PG", "display_name": "Charles Smith", "link": "https://stackoverflow.com/users/3200391/charles-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 49984568, "answer_count": 2, "score": 0, "last_activity_date": 1524497074, "creation_date": 1524496143, "question_id": 49984354, "link": "https://stackoverflow.com/questions/49984354/rails-5-if-statement-with-loop-index", "title": "Rails 5 if statement with loop index", "body": "<p>I have a <code>product</code> model which has a <code>has_many</code> relation with my <code>variation</code> model. The variations are being looped into the products thumbnail slider and works great.  But, on the products that only have one variation, I don't want to show the thumbnail.</p>\n\n<p>I think I am understanding <code>with_index</code> correct and am attempting to use it to show the variation thumbnail, only if thumbnail is greater than 0, but I am not getting the expected results--the other variations thumbs are not showing; just the first one.</p>\n\n<pre><code>&lt;% @product.variations.each_with_index do |v, index| %&gt;\n  &lt;% if index &gt;= 1 %&gt;\n    &lt;% if v.photo_one.present? %&gt;\n      &lt;div class=\"col-md-2\" style=\"padding: 0 7px\"&gt;\n        &lt;div class=\"btn-filter-wrap\"&gt;\n          &lt;button class=\"btn-filter\"\n            data-filter=\".id-&lt;%= v.id %&gt;\"\n            style=\"background: url(&lt;%= (v.photo_one_url(:thumb)) %&gt;) no-repeat center;\n                background-size: contain;\n                width: 100%;\n                height: 130px\"&gt;\n          &lt;/button&gt;\n        &lt;/div&gt;\n        &lt;div class=\"row\"&gt;\n          &lt;div class=\"col-md-2\" style=\"width: 100%; text-align:center\"&gt;\n            &lt;h5 style=\"font-weight: 800;\n                text-transform: uppercase;\n                color: #555555;\n                line-height: 1.8\"&gt;&lt;%= v.name %&gt;&lt;/h5&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;% end %&gt;\n  &lt;% end %&gt;\n&lt;% end %&gt;\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 791, "user_id": 4424428, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/346d6b5a83ea67778742c4703a928b59?s=128&d=identicon&r=PG&f=1", "display_name": "16kb", "link": "https://stackoverflow.com/users/4424428/16kb"}, "edited": false, "score": 0, "creation_date": 1524494231, "post_id": 49983646, "comment_id": 86983714, "body": "Is your <code>OpeningHour</code> model not related to <code>Shop</code>?"}, {"owner": {"reputation": 32451, "user_id": 2516474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a2179a340c0e84edc285d432211145d?s=128&d=identicon&r=PG", "display_name": "SteveTurczyn", "link": "https://stackoverflow.com/users/2516474/steveturczyn"}, "edited": false, "score": 0, "creation_date": 1524494355, "post_id": 49983646, "comment_id": 86983796, "body": "How does your &#39;open&#39; method know which shop&#39;s times to use?"}, {"owner": {"reputation": 377, "user_id": 7079742, "user_type": "registered", "accept_rate": 35, "profile_image": "https://i.stack.imgur.com/1KL5C.jpg?s=128&g=1", "display_name": "Dev", "link": "https://stackoverflow.com/users/7079742/dev"}, "reply_to_user": {"reputation": 791, "user_id": 4424428, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/346d6b5a83ea67778742c4703a928b59?s=128&d=identicon&r=PG&f=1", "display_name": "16kb", "link": "https://stackoverflow.com/users/4424428/16kb"}, "edited": false, "score": 0, "creation_date": 1524494408, "post_id": 49983646, "comment_id": 86983837, "body": "Thanks for the reply @16kb I just added the associations of the both models to my original question"}, {"owner": {"reputation": 377, "user_id": 7079742, "user_type": "registered", "accept_rate": 35, "profile_image": "https://i.stack.imgur.com/1KL5C.jpg?s=128&g=1", "display_name": "Dev", "link": "https://stackoverflow.com/users/7079742/dev"}, "edited": false, "score": 0, "creation_date": 1524494492, "post_id": 49983646, "comment_id": 86983897, "body": "Thanks for the reply @ SteveTurczyn ! that is exactly what I&#39;m trying to figure out... and how to implement it according to the loop!"}], "answers": [{"comments": [{"owner": {"reputation": 1342, "user_id": 1143549, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45da1bf4376d6f184e41de57e03789b9?s=128&d=identicon&r=PG", "display_name": "Derek Wright", "link": "https://stackoverflow.com/users/1143549/derek-wright"}, "edited": false, "score": 0, "creation_date": 1524494984, "post_id": 49983837, "comment_id": 86984250, "body": "Beat me to it; Worth pointing out again to the author that these types of methods do NOT belong in controllers but in the models."}], "tags": [], "owner": {"reputation": 32451, "user_id": 2516474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a2179a340c0e84edc285d432211145d?s=128&d=identicon&r=PG", "display_name": "SteveTurczyn", "link": "https://stackoverflow.com/users/2516474/steveturczyn"}, "is_accepted": true, "score": 2, "last_activity_date": 1524494551, "creation_date": 1524494551, "answer_id": 49983837, "question_id": 49983646, "link": "https://stackoverflow.com/questions/49983646/rails-loop-through-objects-in-view/49983837#49983837", "title": "Rails loop through objects in view", "body": "<p>Assuming <code>opening_hours</code> belong to the <code>shop</code> model</p>\n\n<pre><code>class Shop\n  def open?\n    opening_hours.where(day: Time.zone.now.wday).where('? BETWEEN opens AND closes', Time.zone.now).any?\n  end\nend\n</code></pre>\n\n<p>Then in the view</p>\n\n<pre><code>&lt;% if shop.open? %&gt;\n    &lt;span style=\"color: black\"&gt;Open&lt;/span&gt;\n&lt;% else %&gt;\n    &lt;span style=\"color: lightgrey\"&gt;Close&lt;/span&gt;\n&lt;% end %&gt;\n</code></pre>\n"}], "owner": {"reputation": 377, "user_id": 7079742, "user_type": "registered", "accept_rate": 35, "profile_image": "https://i.stack.imgur.com/1KL5C.jpg?s=128&g=1", "display_name": "Dev", "link": "https://stackoverflow.com/users/7079742/dev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 49983837, "answer_count": 1, "score": 0, "last_activity_date": 1524494706, "creation_date": 1524493883, "last_edit_date": 1524494584, "question_id": 49983646, "link": "https://stackoverflow.com/questions/49983646/rails-loop-through-objects-in-view", "title": "Rails loop through objects in view", "body": "<p>I have the following associations:</p>\n\n<pre><code>class Shop &lt; ApplicationRecord\n  has_many :opening_hours\nend\n\nclass OpeningHour &lt; ApplicationRecord\n  belongs_to :shop\nend\n</code></pre>\n\n<p>I'm looping through shops inside a view like this:</p>\n\n<pre><code>&lt;% @shop.each do |shop|%&gt;\n  &lt;%= shop.street %&gt;\n  &lt;%= shop.city %&gt;\n&lt;% end %&gt;\n</code></pre>\n\n<p>I have an action inside a controller, from which I want to check if a shop is open or not:</p>\n\n<pre><code>def open\n  @open = OpeningHour.where(day: Time.zone.now.wday).where('? BETWEEN opens AND closes', Time.zone.now).any?\nend\n</code></pre>\n\n<p>I would like to show if the shop is open or not with something like this:</p>\n\n<pre><code>&lt;% if %&gt;\n  &lt;span style=\"color: black\"&gt;Open&lt;/span&gt;\n&lt;% else %&gt;\n  &lt;span style=\"color: lightgrey\"&gt;Close&lt;/span&gt;\n&lt;% end %&gt;\n</code></pre>\n\n<p>How can I add the above <code>if</code> and <code>else</code> to the loop in order to show if each shop is open or close?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "unit-testing", "tdd"], "comments": [{"owner": {"reputation": 3320, "user_id": 4950680, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C8cEh.jpg?s=128&g=1", "display_name": "Martin Zinovsky", "link": "https://stackoverflow.com/users/4950680/martin-zinovsky"}, "edited": false, "score": 0, "creation_date": 1524494027, "post_id": 49983543, "comment_id": 86983594, "body": "Check <code>users</code> table for uniq index on <code>email</code> column"}], "answers": [{"tags": [], "owner": {"reputation": 29, "user_id": 8360855, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sGW3Z.jpg?s=128&g=1", "display_name": "Kh\u1eafc To&#224;n \u0110\u1eb7ng", "link": "https://stackoverflow.com/users/8360855/kh%e1%ba%afc-to%c3%a0n-%c4%90%e1%ba%b7ng"}, "is_accepted": false, "score": 0, "last_activity_date": 1524494156, "creation_date": 1524494156, "answer_id": 49983719, "question_id": 49983543, "link": "https://stackoverflow.com/questions/49983543/uniqueness-validation-failure-even-though-email-validation-is-removed-from-user/49983719#49983719", "title": "Uniqueness validation failure even though :email validation is removed from User model?", "body": "<p>Look your message error: </p>\n\n<p><code>ActiveRecord::RecordNotUnique: SQLite3::ConstraintException: UNIQUE constraint failed: posts.id ...</code></p>\n\n<p>So I think hmm... maybe the post.id is duplicate with other one in your database. Please check again :)</p>\n"}], "owner": {"reputation": 61, "user_id": 8673819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dd353c8b167314cf53f95bd2bb9d2f52?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Agnus Lam", "link": "https://stackoverflow.com/users/8673819/christopher-agnus-lam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 96, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524494156, "creation_date": 1524493368, "question_id": 49983543, "link": "https://stackoverflow.com/questions/49983543/uniqueness-validation-failure-even-though-email-validation-is-removed-from-user", "title": "Uniqueness validation failure even though :email validation is removed from User model?", "body": "<p>I am having a trouble with getting my Rails test to pass. </p>\n\n<p>I am following the <em>Rails Crash Course: A No-Nonsense Guide to Rails Development</em> by Anthony Lewis and have double-checked &amp; compared the code from the textbook. This test aims to create a valid user, and check if the validations are working.</p>\n\n<p>So, the steps I took to reproduce the error:</p>\n\n<ol>\n<li>Open User.rb model, remove <code>uniqueness: true</code> line (to help diagnose problem).</li>\n<li>Run <code>rake test test/models/user_test.rb</code></li>\n</ol>\n\n<p>Which results in the following error:</p>\n\n<pre><code>  Error:\n        UserTest#test_saves_with_valid_attributes:\n        ActiveRecord::RecordNotUnique: SQLite3::ConstraintException: UNIQUE constraint failed: posts.id: INSERT INTO \"posts\" (\"title\", \"body\", \"url\", \"type\", \"created_at\", \"updated_at\", \"id\", \"user_id\") VALUES ('MyString', 'MyText', 'MyString', NULL, '2018-04-23 07:01:37.793314', '2018-04-23 07:01:37.793314', 980190962, 980190962)\n</code></pre>\n\n<p>Can someone explain why I still get an uniqueness validation error even though I removed <code>uniqueness:true</code> from <code>:email</code>?</p>\n\n<p>Here's what my User.rb looks like:</p>\n\n<pre><code>class User &lt; ApplicationRecord\n    has_many :subscriptions, foreign_key: :follower_id, dependent: :destroy\n\n    has_many :leaders, through: :subscriptions \n\n    has_many :reverse_subscriptions, foreign_key: :leader_id, \n    class_name: 'Subscription', dependent: :destroy\n\n    has_many :followers, through: :reverse_subscriptions\n\n    has_many :posts, dependent: :destroy\n    has_many :text_posts, dependent: :destroy\n    has_many :image_posts, dependent: :destroy\n\n    def following?(leader)\n        leaders.include? leader\n    end\n\n    def follow!(leader)\n        if leader != self &amp;&amp; !following?(leader)\n            leaders &lt;&lt; leader\n        end\n    end\n\n    has_secure_password\n\n    **validates :email, presence: true, uniqueness: true** \n\n    def timeline_user_ids\n        leader_ids + [id]\n    end\n\n\n\nend\n</code></pre>\n\n<p>What my user_test.rb contains: </p>\n\n<pre><code>require 'test_helper'\n\nclass UserTest &lt; ActiveSupport::TestCase\n  # test \"the truth\" do\n  #   assert true\n  # end\n\n  test \"saves with valid attributes\" do\n    user = User.new(\n      email: \"user@example.com\",\n      password: \"password\",\n      password_confirmation: \"password\"\n    )\n    assert user.save\n  end\nend\n</code></pre>\n\n<p>I have a feeling its something to do with the fixtures but the files are Rails 5.1 defaults.</p>\n"}, {"tags": ["ruby", "bash"], "comments": [{"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1524492037, "post_id": 49982847, "comment_id": 86982257, "body": "What is your question?"}, {"owner": {"reputation": 12542, "user_id": 156746, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/8TsPx.jpg?s=128&g=1", "display_name": "DiegoSalazar", "link": "https://stackoverflow.com/users/156746/diegosalazar"}, "edited": false, "score": 1, "creation_date": 1524495265, "post_id": 49982847, "comment_id": 86984444, "body": "You need to use double quotes when interpolating into a string: <code>exec(&quot;ls -l #{argv[1]}&quot;)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 1, "creation_date": 1524493255, "post_id": 49983076, "comment_id": 86983231, "body": "Nitpicking: <code>ARGV</code> is a global <i>constant</i>, not a variable."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1524495302, "post_id": 49983076, "comment_id": 86984479, "body": "Arguably, it&#39;s a variable that gets initialize very early (but is not hard-coded, as it can change from run to run.)"}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1524503436, "post_id": 49983076, "comment_id": 86989271, "body": "@axiac you gotta be kidding: <code>ARGV</code> is in <a href=\"http://ruby-doc.org/core-2.5.0/doc/globals_rdoc.html#label-Pre-defined+global+constants\" rel=\"nofollow noreferrer\">predefined <b>global constants</b> section</a>."}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1524503509, "post_id": 49983076, "comment_id": 86989311, "body": "@chepner not arguably at all: anything having a name starting with an uppercase is a constant in ruby, period."}, {"owner": {"reputation": 56328, "user_id": 4265352, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lzAUc5pYb24/AAAAAAAAAAI/AAAAAAAAAGQ/q3h7bZUnqrs/photo.jpg?sz=128", "display_name": "axiac", "link": "https://stackoverflow.com/users/4265352/axiac"}, "reply_to_user": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 1, "creation_date": 1524513787, "post_id": 49983076, "comment_id": 86994602, "body": "@mudasobwa you&#39;re right. It seems I missed the intermediate section headers. I corrected the answer."}], "tags": [], "owner": {"reputation": 56328, "user_id": 4265352, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lzAUc5pYb24/AAAAAAAAAAI/AAAAAAAAAGQ/q3h7bZUnqrs/photo.jpg?sz=128", "display_name": "axiac", "link": "https://stackoverflow.com/users/4265352/axiac"}, "is_accepted": false, "score": 0, "last_activity_date": 1524513760, "last_edit_date": 1524513760, "creation_date": 1524492020, "answer_id": 49983076, "question_id": 49982847, "link": "https://stackoverflow.com/questions/49982847/using-a-parameter-with-exec-in-ruby/49983076#49983076", "title": "Using a parameter with exec in Ruby", "body": "<p>There are several small issues in your code:</p>\n\n<ul>\n<li>variables are not interpolated in <a href=\"http://ruby-doc.org/core-2.5.0/doc/syntax/literals_rdoc.html#label-Strings\" rel=\"nofollow noreferrer\">single-quote strings</a>; this means your script always tries to execute <code>ls -l #{argv[1]}</code> (as it is written here).</li>\n<li>there is no variable, constant or method of class <code>Object</code> that is named <code>argv</code>; there is a <a href=\"http://ruby-doc.org/core-2.5.0/doc/globals_rdoc.html\" rel=\"nofollow noreferrer\">global constant named <code>ARGV</code></a> that contains the command line arguments.</li>\n<li><a href=\"http://ruby-doc.org/core-2.5.0/doc/globals_rdoc.html\" rel=\"nofollow noreferrer\"><code>ARGV</code></a> does not contain the script name (it is stored in a separate property) but only its positional parameters; consequently, the first argument in the command line is stored at index <code>0</code>, not <code>1</code>.</li>\n</ul>\n\n<p>Putting together all of the above, your script should be:</p>\n\n<pre><code>exec(\"ls -l #{ARGV[0]}\")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 205702, "user_id": 7552, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b60298053f87465641c1b1192338c8cd?s=128&d=identicon&r=PG", "display_name": "glenn jackman", "link": "https://stackoverflow.com/users/7552/glenn-jackman"}, "is_accepted": false, "score": 2, "last_activity_date": 1524492747, "creation_date": 1524492747, "answer_id": 49983327, "question_id": 49982847, "link": "https://stackoverflow.com/questions/49982847/using-a-parameter-with-exec-in-ruby/49983327#49983327", "title": "Using a parameter with exec in Ruby", "body": "<p>Unless you need your command to be executed by a shell (such as, you redirect to/from a file), you can pass a list of arguments to <code>exec</code>:</p>\n\n<pre><code>exec 'ls', '-l', ARGV[1]\n</code></pre>\n\n<p>You're aware that <code>exec</code> <strong>replaces</strong> the running ruby process? Do you want <code>system</code> instead?</p>\n\n<p><a href=\"https://ruby-doc.org/core-2.5.0/Process.html#method-c-exec\" rel=\"nofollow noreferrer\">https://ruby-doc.org/core-2.5.0/Process.html#method-c-exec</a><br>\n<a href=\"https://ruby-doc.org/core-2.5.0/Kernel.html#method-i-system\" rel=\"nofollow noreferrer\">https://ruby-doc.org/core-2.5.0/Kernel.html#method-i-system</a></p>\n"}], "owner": {"reputation": 23, "user_id": 9419695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93ef6e911a9ad5865c703f6d8df1c6ef?s=128&d=identicon&r=PG&f=1", "display_name": "M.use", "link": "https://stackoverflow.com/users/9419695/m-use"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 540, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1524513760, "creation_date": 1524491401, "question_id": 49982847, "link": "https://stackoverflow.com/questions/49982847/using-a-parameter-with-exec-in-ruby", "title": "Using a parameter with exec in Ruby", "body": "<p>I'm trying to execute the command exec when I give it a parameter by console, but I don\u00b4t know how to make it.</p>\n\n<pre><code>exec('ls -l #{argv[1]}')\n</code></pre>\n\n<p>Argv[1] is the parameter I pass by console but it doesn\u00b4t do anything.</p>\n"}, {"tags": ["ruby", "google-maps", "openstreetmap"], "answers": [{"tags": [], "owner": {"reputation": 17760, "user_id": 1340631, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/52d3234f3be58156770e8a91d575bfbd?s=128&d=identicon&r=PG", "display_name": "scai", "link": "https://stackoverflow.com/users/1340631/scai"}, "is_accepted": true, "score": 3, "last_activity_date": 1524491651, "creation_date": 1524491651, "answer_id": 49982934, "question_id": 49982626, "link": "https://stackoverflow.com/questions/49982626/validating-opening-hours-format/49982934#49982934", "title": "Validating opening hours format", "body": "<p>The example from your question is wrong, a semicolon is missing. The correct format is:</p>\n\n<p><code>Mo,Tu,We,Th,Fr,Sa 10:00-18:00; Su 12:00-17:00</code></p>\n\n<p>or in short:</p>\n\n<p><code>Mo-Sa 10:00-18:00; Su 12:00-17:00</code>.</p>\n\n<p>I don't think a regex can handle this complex <a href=\"https://wiki.openstreetmap.org/wiki/Key:opening_hours/specification\" rel=\"nofollow noreferrer\">format</a>. You will need a real parser. The OSM wiki lists several implementations:</p>\n\n<ul>\n<li><a href=\"https://wiki.openstreetmap.org/wiki/Key:opening_hours#Implementation\" rel=\"nofollow noreferrer\">Key:opening_hours#Implementation</a></li>\n<li><a href=\"https://wiki.openstreetmap.org/wiki/Key:opening_hours#Code\" rel=\"nofollow noreferrer\">Key:opening_hours#Code</a></li>\n</ul>\n"}], "owner": {"reputation": 171, "user_id": 7170147, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210646111689819/picture?type=large", "display_name": "Leti Esper&#243;n", "link": "https://stackoverflow.com/users/7170147/leti-esper%c3%b3n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 266, "favorite_count": 1, "accepted_answer_id": 49982934, "answer_count": 1, "score": 0, "last_activity_date": 1524491651, "creation_date": 1524490757, "question_id": 49982626, "link": "https://stackoverflow.com/questions/49982626/validating-opening-hours-format", "title": "Validating opening hours format", "body": "<p>I need to validate from my Ruby app the format of the <code>openingHours</code> field used by <code>Open Street Map</code>. \nI found this validator <a href=\"http://openingh.openstreetmap.de/evaluation_tool/\" rel=\"nofollow noreferrer\">http://openingh.openstreetmap.de/evaluation_tool/</a> but I was wondering if there was a gem, REST API or at least a known regex to validate the format expected by them.</p>\n\n<p>This is an example of the opening hours format: </p>\n\n<p><code>Mo, Tu, We, Th, Fr, Sa 10:00-18:00 Su 12:00-17:00</code></p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-4", "associations"], "comments": [{"owner": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 0, "creation_date": 1524491262, "post_id": 49982527, "comment_id": 86981672, "body": "How do you image rails is supposed to know when <code>purchases</code> refers to <code>games</code> and when <code>purchases</code> refers to <code>unlimited_games</code>?"}, {"owner": {"reputation": 2401, "user_id": 2873548, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b90a1fd45fc72bd55f8948b385d4626f?s=128&d=identicon&r=PG&f=1", "display_name": "anonn023432", "link": "https://stackoverflow.com/users/2873548/anonn023432"}, "reply_to_user": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 0, "creation_date": 1524491350, "post_id": 49982527, "comment_id": 86981733, "body": "I can differentiate it using different names when I want them specifically like <code>unlimited_games_purchases</code> or <code>games_purchases</code> but can I do <code>purchases</code> to get all of the <code>games</code> which includes both <code>games</code> and <code>unlimited_games</code>"}, {"owner": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 0, "creation_date": 1524491695, "post_id": 49982527, "comment_id": 86981999, "body": "And what would that look like, given that you&#39;ve defined <code>purchases</code> and then immediately redefined <code>purchases</code>?"}, {"owner": {"reputation": 2401, "user_id": 2873548, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b90a1fd45fc72bd55f8948b385d4626f?s=128&d=identicon&r=PG&f=1", "display_name": "anonn023432", "link": "https://stackoverflow.com/users/2873548/anonn023432"}, "reply_to_user": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 0, "creation_date": 1524492360, "post_id": 49982527, "comment_id": 86982501, "body": "I know that won&#39;t work, but that&#39;s exactly part I&#39;m unsure about. It&#39;s possible that there might be a way to include multiple associations to get the same <code>table</code>. I can&#39;t find a way to do it right now but I was hoping that this question would get me an answer for the same"}, {"owner": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 0, "creation_date": 1524494225, "post_id": 49982527, "comment_id": 86983711, "body": "What is the difference between <code>game</code> and <code>unlimited_game</code>?"}, {"owner": {"reputation": 2298, "user_id": 5883753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b32d66e6c723279fdfc2a90b269a070c?s=128&d=identicon&r=PG&f=1", "display_name": "fongfan999", "link": "https://stackoverflow.com/users/5883753/fongfan999"}, "edited": false, "score": 0, "creation_date": 1524494267, "post_id": 49982527, "comment_id": 86983733, "body": "Hi @annon, <code>Purchase</code> also belongs_to <code>unlimited_games</code>?"}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1524496083, "post_id": 49982527, "comment_id": 86985011, "body": "What is an <code>UnlimitedGame</code>? This seems like an issue with your design pattern rather than an issue with how to build this association."}, {"owner": {"reputation": 2401, "user_id": 2873548, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b90a1fd45fc72bd55f8948b385d4626f?s=128&d=identicon&r=PG&f=1", "display_name": "anonn023432", "link": "https://stackoverflow.com/users/2873548/anonn023432"}, "reply_to_user": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 0, "creation_date": 1524496222, "post_id": 49982527, "comment_id": 86985081, "body": "@jvillian They&#39;re just two different types of games but they&#39;ve separate models because they&#39;re optionally available to different user types"}, {"owner": {"reputation": 2401, "user_id": 2873548, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b90a1fd45fc72bd55f8948b385d4626f?s=128&d=identicon&r=PG&f=1", "display_name": "anonn023432", "link": "https://stackoverflow.com/users/2873548/anonn023432"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1524496359, "post_id": 49982527, "comment_id": 86985173, "body": "@engineersmnky I added the information for the new models"}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1524496608, "post_id": 49982527, "comment_id": 86985315, "body": "@anonn023432 my question was actually more directed at what differentiates an <code>UnlimitedGame</code> from a <code>Game</code> and why should they be separate models? If I am purchasing unlimited games from a <code>Seller</code> to me that means I have access to all of there games through a purchase. Since this clearly relates to a purchase and not the type of game I am purchasing it should be attributed to a <code>Purchase</code> in some fashion rather than to some different form of <code>Game</code> unless I misunderstand what an <code>UnlimitedGame</code> is."}, {"owner": {"reputation": 2401, "user_id": 2873548, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b90a1fd45fc72bd55f8948b385d4626f?s=128&d=identicon&r=PG&f=1", "display_name": "anonn023432", "link": "https://stackoverflow.com/users/2873548/anonn023432"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1524496730, "post_id": 49982527, "comment_id": 86985389, "body": "@engineersmnky sorry for the confusion. <code>UnlimitedGame</code> and <code>Game</code> are two different types of games. <code>Game</code> is created by the seller and all users can purchase it whereas <code>UnlimitedGame</code> is created by the <code>admins</code> and assigned to some <code>sellers</code>. A specific group of <code>Users</code> can then buy these <code>UnlimitedGame</code> type game."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1524496885, "post_id": 49982527, "comment_id": 86985512, "body": "seems that should just be a category of <code>Game</code> then all <code>Purchase</code>s are <code>Buyer</code> =&gt; <code>Purchase</code> =&gt; (<code>Game</code> =&gt; <code>Seller</code>) and the category of the <code>Game</code> is (&quot;Unlimited&quot;, or &quot;Seller Created&quot;) terminology TBD by you. It cleans up your relationships and will allow for extensibility if you decide to add a new <code>Game</code> type later"}, {"owner": {"reputation": 2401, "user_id": 2873548, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b90a1fd45fc72bd55f8948b385d4626f?s=128&d=identicon&r=PG&f=1", "display_name": "anonn023432", "link": "https://stackoverflow.com/users/2873548/anonn023432"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1524497068, "post_id": 49982527, "comment_id": 86985649, "body": "@engineersmnky the reasoning behind creating a separate model was that <code>Game</code> uses really old legacy code which is inefficient and it would take a long time to include <code>UnlimitedGame</code> to it. So, for now, we were going to create a different model then later merge it with <code>Game</code> after it&#39;s been fixed."}], "answers": [{"tags": [], "owner": {"reputation": 1088, "user_id": 3236163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f4a825085dda7d9ea059838a3d6dcd7?s=128&d=identicon&r=PG", "display_name": "elyalvarado", "link": "https://stackoverflow.com/users/3236163/elyalvarado"}, "is_accepted": false, "score": 0, "last_activity_date": 1524495417, "creation_date": 1524495417, "answer_id": 49984145, "question_id": 49982527, "link": "https://stackoverflow.com/questions/49982527/multiple-has-many-through-relationship-to-association/49984145#49984145", "title": "Multiple has_many: :through relationship to association", "body": "<p>Supussing <code>unlimited_games</code> is not a model on itself and instead is a scope on the <code>games</code> model, then you could do something like this in the <code>Seller</code> model:</p>\n\n<pre><code>def unlimited_game_purchases\n  purchases.merge(Game.unlimited)\nend\n</code></pre>\n\n<p>which uses <a href=\"http://api.rubyonrails.org/classes/ActiveRecord/SpawnMethods.html#method-i-merge\" rel=\"nofollow noreferrer\">merge</a> to merge the condition of both queries</p>\n\n<hr>\n\n<p>By the way, there is of course a way to create another association with the same model, if as you say the seller also has a <code>has_many :unlimited_games</code> already working, then your association will look like:</p>\n\n<pre><code>has_many :unlimited_game_purchases, trough: :unlimited_games, source: :game\n</code></pre>\n\n<p>You can choose the way you understand better</p>\n"}], "owner": {"reputation": 2401, "user_id": 2873548, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b90a1fd45fc72bd55f8948b385d4626f?s=128&d=identicon&r=PG&f=1", "display_name": "anonn023432", "link": "https://stackoverflow.com/users/2873548/anonn023432"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 41, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1524496608, "creation_date": 1524490503, "last_edit_date": 1524496608, "question_id": 49982527, "link": "https://stackoverflow.com/questions/49982527/multiple-has-many-through-relationship-to-association", "title": "Multiple has_many: :through relationship to association", "body": "<p>I have a model for <code>Sellers</code> and they own <code>games</code> and <code>unlimited_games</code> which can be bought by other <code>players</code>. I want to pull all the purchases for a specific <code>seller</code>. My model when I only had <code>games</code> was:</p>\n\n<pre><code>class Seller\n  has_many :purchases, through: :games, dependent: :destroy\nend\n\nclass Purchase\n  belongs_to :game\nend\n\nclass Game\n  has_many :purchases\n  belongs_to :coach\nend\n</code></pre>\n\n<h1>Updated Models</h1>\n\n<pre><code>def UnlimitedGame\n  has_many :purchases\n  belongs_to :coach\nend\n\ndef Purchase\n  belongs_to :game\n  belongs_to :unlimited_game\nend\n</code></pre>\n\n<p>And I could do a <code>@seller.purchases</code> to get all purchases for that seller. Now I want to extend the same feature to include all <code>unlimited_games</code></p>\n\n<p>So that doing <code>@seller.purchases</code> includes both <code>unlimited_games</code> and <code>games</code>. I tried doing:</p>\n\n<p><code>has_many :purchases, through: :games, dependent: :destroy, class_name: :purchases</code></p>\n\n<p><code>has_many :purchases, through: :unlimited_games, dependent: :destroy, class_name: :purchases</code></p>\n"}, {"tags": ["ruby", "azure", "azure-media-services"], "answers": [{"tags": [], "owner": {"reputation": 85, "user_id": 5304830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/776277bb66c26db5fe31e9285d60c9a2?s=128&d=identicon&r=PG&f=1", "display_name": "Sanjid", "link": "https://stackoverflow.com/users/5304830/sanjid"}, "is_accepted": false, "score": 2, "last_activity_date": 1524811108, "creation_date": 1524811108, "answer_id": 50056657, "question_id": 49982254, "link": "https://stackoverflow.com/questions/49982254/download-asset-file-from-asset-in-azure-media-service/50056657#50056657", "title": "Download asset file from asset in Azure media service", "body": "<p>You have to create a SAS <a href=\"https://docs.microsoft.com/en-us/rest/api/media/operations/locator#create_a_locator\" rel=\"nofollow noreferrer\">locator</a> for the parent asset which will return a SAS URL for the asset, something like:</p>\n\n<p><a href=\"https://[storageaccount].blob.core.windows.net/asset-[parentAssetId]?[queryparams]\" rel=\"nofollow noreferrer\">https://[storageaccount].blob.core.windows.net/asset-[parentAssetId]?[queryparams]</a></p>\n\n<p>Sending a GET request with the asset file name appended to the SAS URL will return the assetfile contents:</p>\n\n<p>GET <a href=\"https://[storageaccount].blob.core.windows.net/asset-[parentAssetId]/[\" rel=\"nofollow noreferrer\">https://[storageaccount].blob.core.windows.net/asset-[parentAssetId]/[</a><strong>assetFileName</strong>]?[queryparams]</p>\n\n<p><a href=\"https://docs.microsoft.com/en-us/azure/media-services/media-services-deliver-asset-download\" rel=\"nofollow noreferrer\">Here</a> is a .NET example. You can ignore the job reference bits and it should work with any asset.</p>\n\n<p>I also find it very helpful to use the <a href=\"https://github.com/Azure/Azure-Media-Services-Explorer\" rel=\"nofollow noreferrer\">Azure Media Services Explorer</a> along with Fiddler to figure out the REST requests needed for different workflows.</p>\n"}], "owner": {"reputation": 287, "user_id": 4892528, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/071cd4948003c3be5e43060053802d67?s=128&d=identicon&r=PG&f=1", "display_name": "Sheharose", "link": "https://stackoverflow.com/users/4892528/sheharose"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 678, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1524811108, "creation_date": 1524489753, "question_id": 49982254, "link": "https://stackoverflow.com/questions/49982254/download-asset-file-from-asset-in-azure-media-service", "title": "Download asset file from asset in Azure media service", "body": "<p>I have an issue. I have an asset in the azure media service. The asset contains an asset file. I would like to know how to download the asset file. I'm using httparty gem for this.</p>\n\n<pre><code>HTTParty.get(https://&lt;host&gt;.restv2.&lt;location&gt;.media.azure.net/api/Files('&lt;file_id&gt;'), headers: headers)\n</code></pre>\n\n<p>The headers have the authorization value. The above request gives the metadata of the asset file but I would like to download the asset file. Can anyone please help. Thanks. I have gone through the below documentation: <a href=\"https://docs.microsoft.com/en-us/rest/api/media/operations/assetfile\" rel=\"nofollow noreferrer\">https://docs.microsoft.com/en-us/rest/api/media/operations/assetfile</a></p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 0, "creation_date": 1524488909, "post_id": 49981786, "comment_id": 86979920, "body": "It should be either <code>current_client.role == &#39;admin&#39;</code> or <code>current_client.role == &#39;dev&#39;</code> so <code>current_client.role == &#39;admin&#39; || current_client.role == &#39;dev&#39;</code>"}, {"owner": {"reputation": 1543, "user_id": 5801853, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/e1b0fbad41fb9e1ee84161ebff1ddbbc?s=128&d=identicon&r=PG", "display_name": "yzalavin", "link": "https://stackoverflow.com/users/5801853/yzalavin"}, "edited": false, "score": 0, "creation_date": 1524489003, "post_id": 49981786, "comment_id": 86980007, "body": "Better, create respective methods to your model: <code>admin?</code>, <code>admin_or_dev?</code> etc.."}], "answers": [{"comments": [{"owner": {"reputation": 5746, "user_id": 4984564, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/9bc286af6678a63ceb881eaf9e966f5f?s=128&d=identicon&r=PG", "display_name": "DarkWiiPlayer", "link": "https://stackoverflow.com/users/4984564/darkwiiplayer"}, "edited": false, "score": 0, "creation_date": 1524490325, "post_id": 49981969, "comment_id": 86980979, "body": "I agree that this is the <i>Ruby way</i> of doing it, but I&#39;ve always thought it&#39;s kind of backwards."}], "tags": [], "owner": {"reputation": 476, "user_id": 2645167, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IEnRe.jpg?s=128&g=1", "display_name": "andriy-baran", "link": "https://stackoverflow.com/users/2645167/andriy-baran"}, "is_accepted": false, "score": 1, "last_activity_date": 1524488974, "creation_date": 1524488974, "answer_id": 49981969, "question_id": 49981786, "link": "https://stackoverflow.com/questions/49981786/can-i-put-multiple-value-in-a-or-condition/49981969#49981969", "title": "Can I put multiple value in a OR condition?", "body": "<pre><code>%w(admin dev).include?(current_client.role)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 703, "user_id": 3275627, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sFsXG.jpg?s=128&g=1", "display_name": "Jonathan Duarte", "link": "https://stackoverflow.com/users/3275627/jonathan-duarte"}, "is_accepted": false, "score": 1, "last_activity_date": 1524489314, "creation_date": 1524489314, "answer_id": 49982087, "question_id": 49981786, "link": "https://stackoverflow.com/questions/49981786/can-i-put-multiple-value-in-a-or-condition/49982087#49982087", "title": "Can I put multiple value in a OR condition?", "body": "<p>Please use an authorization gem, such as: <a href=\"https://github.com/CanCanCommunity/cancancan\" rel=\"nofollow noreferrer\">https://github.com/CanCanCommunity/cancancan</a></p>\n\n<p>Doing it manually is error prone and not easy to maintain.</p>\n\n<p>You'll just need to define your ability:</p>\n\n<p>and then in your code:</p>\n\n<pre><code>&lt;% if can? :update, @client_info %&gt;\n  &lt;%= link_to \"Mon compte\", client_edit_infos_path %&gt;\n&lt;% end %&gt;\n</code></pre>\n\n<p>Also, don't forget to <strong>set the same restriction in your controller actions</strong>! otherwise a user can bypass your view and trigger your action manually and have access to something they shouldn't.</p>\n"}, {"tags": [], "owner": {"reputation": 5746, "user_id": 4984564, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/9bc286af6678a63ceb881eaf9e966f5f?s=128&d=identicon&r=PG", "display_name": "DarkWiiPlayer", "link": "https://stackoverflow.com/users/4984564/darkwiiplayer"}, "is_accepted": false, "score": 0, "last_activity_date": 1524492486, "creation_date": 1524492486, "answer_id": 49983242, "question_id": 49981786, "link": "https://stackoverflow.com/questions/49981786/can-i-put-multiple-value-in-a-or-condition/49983242#49983242", "title": "Can I put multiple value in a OR condition?", "body": "<p>For an actual solution I recommend one of the other answers, but here's how it could work the way you originally intended (aka. what went wrong).</p>\n\n<p>The problem is the condition at the end of the line: <code>unless current_client.role == 'admin' || 'dev'</code></p>\n\n<p>What ruby does here is not what you think; <code>'admin' || 'dev'</code> is evaluated as <code>'admin'</code>, so the entire condition is equivalent to <code>unless current_client.role == 'admin'</code>.</p>\n\n<p>The way the <code>||</code> operator works is:</p>\n\n<ul>\n<li>If the first operand is truthy, it is the result of the operation.</li>\n<li>If the first operand is falsey, the second operand is the result of the operation.</li>\n</ul>\n\n<p>For example, <code>true || false</code> evaluates to true, <code>'hello' || 'world'</code> is <code>'hello'</code> and <code>nil || 'world'</code> evaluates to 'world'.</p>\n\n<p>The correct condition would be <code>unless current_client.role == 'admin' or current_client.role == 'dev'</code></p>\n\n<p><code>or</code> does the same as <code>||</code>, but with <a href=\"https://stackoverflow.com/questions/2083112/difference-between-or-and-in-ruby#2083118\">higher precedence</a>.</p>\n"}], "owner": {"reputation": 173, "user_id": 8718742, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/XBXjN.jpg?s=128&g=1", "display_name": "Enner31", "link": "https://stackoverflow.com/users/8718742/enner31"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "answer_count": 3, "score": -1, "last_activity_date": 1524493052, "creation_date": 1524488517, "last_edit_date": 1524493052, "question_id": 49981786, "link": "https://stackoverflow.com/questions/49981786/can-i-put-multiple-value-in-a-or-condition", "title": "Can I put multiple value in a OR condition?", "body": "<p>I have three roles in my app: <code>admin</code>, <code>dev</code>, and <code>client</code>. In my header, <code>dev</code> can access the same tabs as <code>admin</code>.</p>\n\n<p>I tried this:</p>\n\n<pre><code>li = link_to 'Mon compte', client_edit_infos_path unless current_client.role == 'admin' || 'dev'\n</code></pre>\n\n<p>It worked for <code>admin</code> and <code>dev</code> roles, but not for <code>client</code> role. </p>\n\n<p>Can someone tell me another way to authorize two roles and restrict one?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-4", "activerecord"], "comments": [{"owner": {"reputation": 196, "user_id": 2493590, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/63a284c798ef80209727d1b4d018fdb4?s=128&d=identicon&r=PG", "display_name": "dgolman", "link": "https://stackoverflow.com/users/2493590/dgolman"}, "edited": false, "score": 0, "creation_date": 1524490703, "post_id": 49980600, "comment_id": 86981257, "body": "Can you add the SQL output from the above query?"}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1524496327, "post_id": 49980600, "comment_id": 86985146, "body": "Since you are using rails 4 as @Ursus pointed out you will have to use raw SQL as <code>orders.where(&quot;orders.skip_reason IS NULL OR orders.skip_reason NOT IN (&#39;full&#39;,&#39;locked&#39;)&quot;)</code>. Rails 5 does offer an <code>or</code> and it would look something like <code>orders.where.not(skip_reason: [&quot;full&quot;, &quot;locked&quot;]).or(orders.where(skip_reason: nil))</code>"}], "answers": [{"comments": [{"owner": {"reputation": 2682, "user_id": 1384718, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/cm7bs.jpg?s=128&g=1", "display_name": "Bibek Sharma", "link": "https://stackoverflow.com/users/1384718/bibek-sharma"}, "edited": false, "score": 0, "creation_date": 1524486604, "post_id": 49980906, "comment_id": 86978299, "body": "Thanks,  but I may have other data in those cases."}], "tags": [], "owner": {"reputation": 27144, "user_id": 3857758, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/58c4295826435f049b7fc32b98c240f9?s=128&d=identicon&r=PG&f=1", "display_name": "Ursus", "link": "https://stackoverflow.com/users/3857758/ursus"}, "is_accepted": false, "score": 2, "last_activity_date": 1524485851, "creation_date": 1524485851, "answer_id": 49980906, "question_id": 49980600, "link": "https://stackoverflow.com/questions/49980600/rails-where-not-include-record-having-nil-attribute/49980906#49980906", "title": "Rails where.not, include record having nil attribute", "body": "<p>Tried this in rails 4 and it seems to work. Is that okay for you? Otherwise I think you should go with raw SQL for the where clause</p>\n\n<pre><code>orders.where(skip_reason: [nil, \"unavailable\"])\n</code></pre>\n"}], "owner": {"reputation": 2682, "user_id": 1384718, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/cm7bs.jpg?s=128&g=1", "display_name": "Bibek Sharma", "link": "https://stackoverflow.com/users/1384718/bibek-sharma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524485851, "creation_date": 1524484861, "question_id": 49980600, "link": "https://stackoverflow.com/questions/49980600/rails-where-not-include-record-having-nil-attribute", "title": "Rails where.not, include record having nil attribute", "body": "<p>I've a <code>Order</code> model having a attribute <code>skip_reason</code>. I want to list out all the order that has <code>skip_reason</code> other than <code>full</code> and <code>locked</code>.\nI'm using <code>where.not</code> but it do not return the orders having <code>nil</code> on the <code>skip_reason</code> column.</p>\n\n<p>I came up with the following condition, </p>\n\n<pre><code>&gt; orders.pluck(:skip_reason)\n=&gt; [\"locked\", nil, nil, \"unavailable\", nil, nil, \"locked\", nil, nil, \"full\"]\n\n&gt; orders.where.not(skip_reason: [\"full\", \"locked\"]).pluck(:skip_reason)\n=&gt; [\"unavailable\"]\n</code></pre>\n\n<p>So how can I list those orders that has <code>nil</code> value for <code>skip_reason</code> column? Any suggestion will be appreciated.</p>\n"}, {"tags": ["ruby", "libgosu"], "comments": [{"owner": {"reputation": 1436, "user_id": 2096740, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/67b4b0da1074e71906237509810c7eac?s=128&d=identicon&r=PG", "display_name": "arjun", "link": "https://stackoverflow.com/users/2096740/arjun"}, "edited": false, "score": 0, "creation_date": 1524487672, "post_id": 49980425, "comment_id": 86979048, "body": "The id parameter returns an integer. You can check what those are against a hash. You can refer here for all ids - <a href=\"https://github.com/gosu/gosu/blob/cdd0397092432f1058c6404c543a823579c1e311/Gosu/Buttons.hpp\" rel=\"nofollow noreferrer\">github.com/gosu/gosu/blob/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 703, "user_id": 3275627, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sFsXG.jpg?s=128&g=1", "display_name": "Jonathan Duarte", "link": "https://stackoverflow.com/users/3275627/jonathan-duarte"}, "is_accepted": false, "score": 0, "last_activity_date": 1524489908, "creation_date": 1524489908, "answer_id": 49982314, "question_id": 49980425, "link": "https://stackoverflow.com/questions/49980425/getting-input-from-libgosu-in-ruby/49982314#49982314", "title": "getting input from libgosu in ruby", "body": "<p>There's a method called <code>button_down(id)</code>, you need to override it.</p>\n\n<pre><code>class Window &lt; Gosu::Window\n   def button_down(id)\n     puts id\n   end\nend\n</code></pre>\n"}], "owner": {"reputation": 5, "user_id": 9479426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f31c25ec11847eac78578dd9d35304?s=128&d=identicon&r=PG&f=1", "display_name": "ader", "link": "https://stackoverflow.com/users/9479426/ader"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 93, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524489908, "creation_date": 1524484254, "question_id": 49980425, "link": "https://stackoverflow.com/questions/49980425/getting-input-from-libgosu-in-ruby", "title": "getting input from libgosu in ruby", "body": "<p>there's a method that you can check 'the key' user are pressing:</p>\n\n<pre><code>Gosu.button_down? id\n</code></pre>\n\n<p>the id parameter can be Gosu::KB_UP, Gosu::KB_1, Gosu::KB_F1...<br>\nbut is there any method that you can get id of the key the user are pressing?</p>\n"}, {"tags": ["ruby", "rubygems"], "owner": {"reputation": 21, "user_id": 9025927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22686915115a06f9da19a88dbbc599d2?s=128&d=identicon&r=PG&f=1", "display_name": "Vivek Mehtani", "link": "https://stackoverflow.com/users/9025927/vivek-mehtani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 95, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1524483135, "creation_date": 1524483135, "question_id": 49980087, "link": "https://stackoverflow.com/questions/49980087/rubygems-util-loaderror", "title": "rubygems/util (LoadError)", "body": "<p>While building SWIFT program on IOS jenkins agent, I am receiving rubygems/util load error from gems file.</p>\n\n<p>does it require any configuration to provide the rubygems/util module ?</p>\n\n<p>unicode-display_width-1.3.2/lib/unicode/display_width/index.rb:1:in `require': cannot load such file -- rubygems/util (LoadError)</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1524490036, "post_id": 49979474, "comment_id": 86980771, "body": "<code>ciphertext = cleartext * (symetricKey * symetricKey * 100)</code> is the actual line throwing the error because it is in only place where implicit conversion would be needed. <code>cleartext.to_i</code> would be explicit conversion because <code>to_i</code> is explicitly stating convert to integer"}], "answers": [{"comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 1, "creation_date": 1524489710, "post_id": 49979709, "comment_id": 86980525, "body": "additionally you can simplify this drastically using <code>symetricKey = symetricKey.gsub(&#47;[a-z]&#47;) { |letter| letter.ord - 96 }.to_i</code>"}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1524491211, "post_id": 49979709, "comment_id": 86981627, "body": "@engineersmnky Ah, that&#39;s amazing, I will update your suggestions now."}], "tags": [], "owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "is_accepted": true, "score": 2, "last_activity_date": 1524491271, "last_edit_date": 1524491271, "creation_date": 1524481929, "answer_id": 49979709, "question_id": 49979474, "link": "https://stackoverflow.com/questions/49979474/why-does-ruby-throw-an-error-when-i-try-to-convert-to-int/49979709#49979709", "title": "Why does ruby throw an error when i try to convert to int?", "body": "<p>You haven't assigned your result</p>\n\n<p><code>to_i</code> or <code>to_s</code> will return the result which you need to assign back into your variable as shown below. </p>\n\n<p>Assign this way</p>\n\n<pre><code>cleartext=cleartext.to_i\n\nciphertext=ciphertext.to_s\n\nsymetricKey=symetricKey.to_i\n</code></pre>\n\n<p>try this</p>\n\n<pre><code>print \"&gt;\"\ncleartext = gets.chomp\nprint \"&gt;\"\nsymetricKey = gets.chomp\nputs \"cleartext and symetricKey obtained. calculating result...\"\nSTDOUT.flush\nsymetricKey.gsub! 'a', '1'\nsymetricKey.gsub! 'b', '2'\nsymetricKey.gsub! 'c', '3'\nsymetricKey.gsub! 'd', '4'\nsymetricKey.gsub! 'e', '5'\nsymetricKey.gsub! 'f', '6'\nsymetricKey.gsub! 'g', '7'\nsymetricKey.gsub! 'h', '8'\nsymetricKey.gsub! 'i', '9'\nsymetricKey.gsub! 'j', '10'\nsymetricKey.gsub! 'k', '11'\nsymetricKey.gsub! 'l', '12'\nsymetricKey.gsub! 'm', '13'\nsymetricKey.gsub! 'n', '14'\nsymetricKey.gsub! 'o', '15'\nsymetricKey.gsub! 'p', '16'\nsymetricKey.gsub! 'q', '17'\nsymetricKey.gsub! 'r', '18'\nsymetricKey.gsub! 's', '19'\nsymetricKey.gsub! 't', '20'\nsymetricKey.gsub! 'u', '21'\nsymetricKey.gsub! 'v', '22'\nsymetricKey.gsub! 'w', '23'\nsymetricKey.gsub! 'x', '24'\nsymetricKey.gsub! 'y', '25'\nsymetricKey.gsub! 'z', '26'\nsymetricKey=symetricKey.to_i\ncleartext.gsub! 'a', '1'\ncleartext.gsub! 'b', '2'\ncleartext.gsub! 'c', '3'\ncleartext.gsub! 'd', '4'\ncleartext.gsub! 'e', '5'\ncleartext.gsub! 'f', '6'\ncleartext.gsub! 'g', '7'\ncleartext.gsub! 'h', '8'\ncleartext.gsub! 'i', '9'\ncleartext.gsub! 'j', '10'\ncleartext.gsub! 'k', '11'\ncleartext.gsub! 'l', '12'\ncleartext.gsub! 'm', '13'\ncleartext.gsub! 'n', '14'\ncleartext.gsub! 'o', '15'\ncleartext.gsub! 'p', '16'\ncleartext.gsub! 'q', '17'\ncleartext.gsub! 'r', '18'\ncleartext.gsub! 's', '19'\ncleartext.gsub! 't', '20'\ncleartext.gsub! 'u', '21'\ncleartext.gsub! 'v', '22'\ncleartext.gsub! 'w', '23'\ncleartext.gsub! 'x', '24'\ncleartext.gsub! 'y', '25'\ncleartext.gsub! 'z', '26'\ncleartext=cleartext.to_i\nciphertext = cleartext * (symetricKey * symetricKey * 100)\nciphertext=ciphertext.to_s\nciphertext.gsub! 'z', '26'\nciphertext.gsub! 'y', '25'\nciphertext.gsub! 'x', '24'\nciphertext.gsub! 'w', '23'\nciphertext.gsub! 'v', '22'\nciphertext.gsub! 'u', '21'\nciphertext.gsub! 't', '20'\nciphertext.gsub! 's', '19'\nciphertext.gsub! 'r', '18'\nciphertext.gsub! 'q', '17'\nciphertext.gsub! 'p', '16'\nciphertext.gsub! 'o', '15'\nciphertext.gsub! 'n', '14'\nciphertext.gsub! 'm', '13'\nciphertext.gsub! 'l', '12'\nciphertext.gsub! 'k', '11'\nciphertext.gsub! 'j', '10'\nciphertext.gsub! 'i', '9'\nciphertext.gsub! 'h', '8'\nciphertext.gsub! 'g', '7'\nciphertext.gsub! 'f', '6'\nciphertext.gsub! 'e', '5'\nciphertext.gsub! 'd', '4'\nciphertext.gsub! 'c', '3'\nciphertext.gsub! 'b', '2'\nciphertext.gsub! 'a', '1'\nputs (ciphertext)\n</code></pre>\n\n<p>Update: \nAs @engineersmnky mentioned</p>\n\n<pre><code>symetricKey = symetricKey.gsub(/[a-z]/) { |letter| letter.ord - 96 }.to_i\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 9497129, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bMm41bUdZik/AAAAAAAAAAI/AAAAAAAAAAQ/ZIGmfepMCAY/photo.jpg?sz=128", "display_name": "huw", "link": "https://stackoverflow.com/users/9497129/huw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 1, "accepted_answer_id": 49979709, "answer_count": 1, "score": 2, "last_activity_date": 1524491271, "creation_date": 1524481210, "question_id": 49979474, "link": "https://stackoverflow.com/questions/49979474/why-does-ruby-throw-an-error-when-i-try-to-convert-to-int", "title": "Why does ruby throw an error when i try to convert to int?", "body": "<p>I'm trying to make a simple encryption algorithm using ruby.</p>\n\n<p>When i convert to int using .to_i, ruby prints \"no implicit conversion of string into Integer(TypeError) from C:/Users/liam/Downloads/encryption.rb:60:in ''\".</p>\n\n<p>Line 60 is the following:</p>\n\n<pre><code>cleartext.to_i\n</code></pre>\n\n<p>and the rest of the code is:</p>\n\n<pre><code>print \"&gt;\"\ncleartext = gets.chomp\nprint \"&gt;\"\nsymetricKey = gets.chomp\nputs \"cleartext and symetricKey obtained. calculating result...\"\nSTDOUT.flush\nsymetricKey.gsub! 'a', '1'\nsymetricKey.gsub! 'b', '2'\nsymetricKey.gsub! 'c', '3'\nsymetricKey.gsub! 'd', '4'\nsymetricKey.gsub! 'e', '5'\nsymetricKey.gsub! 'f', '6'\nsymetricKey.gsub! 'g', '7'\nsymetricKey.gsub! 'h', '8'\nsymetricKey.gsub! 'i', '9'\nsymetricKey.gsub! 'j', '10'\nsymetricKey.gsub! 'k', '11'\nsymetricKey.gsub! 'l', '12'\nsymetricKey.gsub! 'm', '13'\nsymetricKey.gsub! 'n', '14'\nsymetricKey.gsub! 'o', '15'\nsymetricKey.gsub! 'p', '16'\nsymetricKey.gsub! 'q', '17'\nsymetricKey.gsub! 'r', '18'\nsymetricKey.gsub! 's', '19'\nsymetricKey.gsub! 't', '20'\nsymetricKey.gsub! 'u', '21'\nsymetricKey.gsub! 'v', '22'\nsymetricKey.gsub! 'w', '23'\nsymetricKey.gsub! 'x', '24'\nsymetricKey.gsub! 'y', '25'\nsymetricKey.gsub! 'z', '26'\nsymetricKey.to_i\ncleartext.gsub! 'a', '1'\ncleartext.gsub! 'b', '2'\ncleartext.gsub! 'c', '3'\ncleartext.gsub! 'd', '4'\ncleartext.gsub! 'e', '5'\ncleartext.gsub! 'f', '6'\ncleartext.gsub! 'g', '7'\ncleartext.gsub! 'h', '8'\ncleartext.gsub! 'i', '9'\ncleartext.gsub! 'j', '10'\ncleartext.gsub! 'k', '11'\ncleartext.gsub! 'l', '12'\ncleartext.gsub! 'm', '13'\ncleartext.gsub! 'n', '14'\ncleartext.gsub! 'o', '15'\ncleartext.gsub! 'p', '16'\ncleartext.gsub! 'q', '17'\ncleartext.gsub! 'r', '18'\ncleartext.gsub! 's', '19'\ncleartext.gsub! 't', '20'\ncleartext.gsub! 'u', '21'\ncleartext.gsub! 'v', '22'\ncleartext.gsub! 'w', '23'\ncleartext.gsub! 'x', '24'\ncleartext.gsub! 'y', '25'\ncleartext.gsub! 'z', '26'\ncleartext.to_i\nciphertext = cleartext * (symetricKey * symetricKey * 100)\nciphertext.to_s\nciphertext.gsub! 'z', '26'\nciphertext.gsub! 'y', '25'\nciphertext.gsub! 'x', '24'\nciphertext.gsub! 'w', '23'\nciphertext.gsub! 'v', '22'\nciphertext.gsub! 'u', '21'\nciphertext.gsub! 't', '20'\nciphertext.gsub! 's', '19'\nciphertext.gsub! 'r', '18'\nciphertext.gsub! 'q', '17'\nciphertext.gsub! 'p', '16'\nciphertext.gsub! 'o', '15'\nciphertext.gsub! 'n', '14'\nciphertext.gsub! 'm', '13'\nciphertext.gsub! 'l', '12'\nciphertext.gsub! 'k', '11'\nciphertext.gsub! 'j', '10'\nciphertext.gsub! 'i', '9'\nciphertext.gsub! 'h', '8'\nciphertext.gsub! 'g', '7'\nciphertext.gsub! 'f', '6'\nciphertext.gsub! 'e', '5'\nciphertext.gsub! 'd', '4'\nciphertext.gsub! 'c', '3'\nciphertext.gsub! 'b', '2'\nciphertext.gsub! 'a', '1'\nputs (ciphertext)\n</code></pre>\n"}, {"tags": ["javascript", "ruby"], "comments": [{"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1524476898, "post_id": 49977812, "comment_id": 86972070, "body": "What is your question?"}, {"owner": {"reputation": 1072, "user_id": 1566489, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/6584d3f0db98cba147f20ec853c48a3a?s=128&d=identicon&r=PG", "display_name": "Gregoire Mulliez", "link": "https://stackoverflow.com/users/1566489/gregoire-mulliez"}, "reply_to_user": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1524481994, "post_id": 49977812, "comment_id": 86975335, "body": "My question : what is the &quot;good&quot; way to share DateTime info between Javascript and rails, using this technic I lose the timezone shift"}], "answers": [{"comments": [{"owner": {"reputation": 1072, "user_id": 1566489, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/6584d3f0db98cba147f20ec853c48a3a?s=128&d=identicon&r=PG", "display_name": "Gregoire Mulliez", "link": "https://stackoverflow.com/users/1566489/gregoire-mulliez"}, "edited": false, "score": 0, "creation_date": 1524482039, "post_id": 49979516, "comment_id": 86975359, "body": "Thanks Stefan, it&#39;s exacly what I was looking for"}], "tags": [], "owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "is_accepted": true, "score": 1, "last_activity_date": 1524481317, "creation_date": 1524481317, "answer_id": 49979516, "question_id": 49977812, "link": "https://stackoverflow.com/questions/49977812/date-and-time-zone/49979516#49979516", "title": "Date and Time zone", "body": "<p><code>toISOString</code> is a good start because it gives you a <a href=\"http://en.wikipedia.org/wiki/ISO_8601\" rel=\"nofollow noreferrer\">ISO 8601</a> compliant string representation.</p>\n\n<p>Ruby can parse such string via <a href=\"http://ruby-doc.org/stdlib-2.5.0/libdoc/time/rdoc/Time.html#method-i-iso8601\" rel=\"nofollow noreferrer\"><code>Time.iso8601</code></a>:</p>\n\n<pre><code>Time.iso8601('2018-04-22T22:00:00.000Z')\n#=&gt; 2018-04-22 22:00:00 UTC\n</code></pre>\n\n<p>which can be converted to your system's timezone via <a href=\"http://ruby-doc.org/core-2.5.0/Time.html#method-i-localtime\" rel=\"nofollow noreferrer\"><code>localtime</code></a>:</p>\n\n<pre><code>Time.iso8601('2018-04-22T22:00:00.000Z').localtime\n#=&gt; 2018-04-23 00:00:00 +0200\n</code></pre>\n\n<p>Rails has more sophisticated timezone support:</p>\n\n<pre><code>Time.iso8601('2018-04-22T22:00:00.000Z').in_time_zone\n#=&gt; Mon, 23 Apr 2018 00:00:00 CEST +02:00\n\nTime.zone.iso8601('2018-04-22T22:00:00.000Z')\n#=&gt; Mon, 23 Apr 2018 00:00:00 CEST +02:00\n</code></pre>\n"}], "owner": {"reputation": 1072, "user_id": 1566489, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/6584d3f0db98cba147f20ec853c48a3a?s=128&d=identicon&r=PG", "display_name": "Gregoire Mulliez", "link": "https://stackoverflow.com/users/1566489/gregoire-mulliez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 49979516, "answer_count": 1, "score": -1, "last_activity_date": 1524481317, "creation_date": 1524476274, "last_edit_date": 1524477574, "question_id": 49977812, "link": "https://stackoverflow.com/questions/49977812/date-and-time-zone", "title": "Date and Time zone", "body": "<p>I am trying to share date/time between JavaScript and Ruby. I get buggy results because of timezone. I tried many combinations without success. I tried the following. Let us say I have a date in JavaScript:</p>\n\n<pre><code>planning_schedule.getState().min_date\nMon Apr 23 2018 00:00:00 GMT+0200 (CEST)\n</code></pre>\n\n<p>I need to share it with <code>wait</code>. So I tried:</p>\n\n<pre><code>planning_schedule.getState().min_date.toISOString()\n\"2018-04-22T22:00:00.000Z\"\n</code></pre>\n\n<p>or </p>\n\n<pre><code>planning_schedule.getState().min_date.toUTCString();\n\"Sun, 22 Apr 2018 22:00:00 GMT\"\n</code></pre>\n\n<p>In Rails, I do:</p>\n\n<pre><code>start_date = DateTime.strptime(params[:current_date1], '%Y-%m-%dT%H:%M:%S.%L%z')\nstart_week = start_date.at_beginning_of_week\nend_week = start_date.at_end_of_week\n</code></pre>\n\n<p>and I get as result:</p>\n\n<pre><code>start_date #=&gt; Sun, 22 Apr 2018 22:00:00 +0000 (should be monday 23)\nstart_week #=&gt; Mon, 16 Apr 2018 00:00:00 +0000 (so everything is shifted)\nend_week #=&gt; Sun, 22 Apr 2018 23:59:59 +0000\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "json", "ruby", "enums", "translate"], "answers": [{"tags": [], "owner": {"reputation": 19261, "user_id": 4758119, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/F4dJY.jpg?s=128&g=1", "display_name": "Deepak Mahakale", "link": "https://stackoverflow.com/users/4758119/deepak-mahakale"}, "is_accepted": false, "score": 0, "last_activity_date": 1524475423, "last_edit_date": 1524475423, "creation_date": 1524475041, "answer_id": 49977394, "question_id": 49977164, "link": "https://stackoverflow.com/questions/49977164/rails-translate-enum-in-an-array/49977394#49977394", "title": "Rails translate enum in an array", "body": "<p>You can just loop over all the enum attributes and get their values. Later you can merge and pass a new hash containing converted values</p>\n\n<pre><code>ENUM_COLUMNS = %i[way gender age] # Equivalent to [:way, :gender, :age]\n\ndef convert_enums\n  overrided_attributes = {}\n  ENUM_COLUMNS.each { |column| overrided_attributes[column.to_s] = self[column] }\n  attributes.merge(overrided_attributes)\nend\n</code></pre>\n\n<p>NOTE: </p>\n\n<p>While <code>infosheet.gender</code> returns you <code>male</code> or <code>female</code>\n<code>infosheet[:gender]</code> will return you the respective integer value <code>0</code> or <code>1</code> </p>\n"}, {"tags": [], "owner": {"reputation": 64, "user_id": 520817, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78cc3c9c597d8796f9059f696a4d8302?s=128&d=identicon&r=PG", "display_name": "Fusco", "link": "https://stackoverflow.com/users/520817/fusco"}, "is_accepted": false, "score": 0, "last_activity_date": 1524500895, "creation_date": 1524500895, "answer_id": 49985818, "question_id": 49977164, "link": "https://stackoverflow.com/questions/49977164/rails-translate-enum-in-an-array/49985818#49985818", "title": "Rails translate enum in an array", "body": "<p>You can test this if you use <a href=\"https://rubygems.org/gems/translate_enum\" rel=\"nofollow noreferrer\">translate enum</a> gem :</p>\n\n<pre><code>a = Infosheet.group(:gender).count\n{\u201cmale\u201d=&gt;30, \u201cfemale\u201d=&gt;6532}\n</code></pre>\n\n<p>Create a hash</p>\n\n<pre><code>r = Hash.new\n</code></pre>\n\n<p>And populate this with : </p>\n\n<pre><code>a.each {|s| puts r[Infosheet.translated_gender(s[0])]=s[1] } \nr\n</code></pre>\n\n<p>result  :</p>\n\n<pre><code> {\u201chomme\u201d=&gt;30, \u201cfemme\u201d=&gt;6532}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9250616"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 624, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1524500895, "creation_date": 1524474345, "question_id": 49977164, "link": "https://stackoverflow.com/questions/49977164/rails-translate-enum-in-an-array", "title": "Rails translate enum in an array", "body": "<p>I am currently working on statistics, so I get an array containing all my data. The problem is that this data contains enums and that I would like to translate them without overwriting the rest.</p>\n\n<p>Here is a given example that contains my array (it contains several hundred) :</p>\n\n<pre><code>#&lt;Infosheet id: 90, date: \"2018-04-22 00:00:00\", number: 7, way: \"home\", gender: \"man\", age: \"age1\", district: \"\", intercommunal: \"\", appointment: true, othertype: \"\", otherorientation: \"\", user_id: 3, created_at: \"2018-04-22 17:51:16\", updated_at: \"2018-04-22 17:51:16\", typerequest_id: 168, orientation_id: 188, info_number: nil, city_id: 105&gt;\n</code></pre>\n\n<p>I would like to translate the enums of \"way\" or \"gender\" or \"age\", while retaining the rest of the data, because currently, if I make a translation in the console, it crushes everything else.</p>\n\n<p>Do you know how to make that ?</p>\n\n<p>Thanks !</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 48049, "user_id": 6419007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/CwqtX.jpg?s=128&g=1", "display_name": "Eric Duminil", "link": "https://stackoverflow.com/users/6419007/eric-duminil"}, "edited": false, "score": 1, "creation_date": 1524474557, "post_id": 49976992, "comment_id": 86970521, "body": "Your data format looks a bit weird. It could be a plain array of strings. What did you try? Did you take a look at <a href=\"https://github.com/halostatue/\" rel=\"nofollow noreferrer\">github.com/halostatue</a> ?"}, {"owner": {"reputation": 11, "user_id": 9498053, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YDuAy.jpg?s=128&g=1", "display_name": "\u041c\u0430\u0440\u0430\u0442\u043e\u043d", "link": "https://stackoverflow.com/users/9498053/%d0%9c%d0%b0%d1%80%d0%b0%d1%82%d0%be%d0%bd"}, "edited": false, "score": 0, "creation_date": 1524474781, "post_id": 49976992, "comment_id": 86970664, "body": "Yes,i tried to use it, but  i don&#39;t know how to apply this with HEX"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1524475416, "post_id": 49976992, "comment_id": 86971061, "body": "That hex value, what &quot;encoding&quot; does it represent? RGB?"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1524475472, "post_id": 49976992, "comment_id": 86971089, "body": "Sorting is not a problem. You need to find out how to get the hue value from those strings. If those are rgb, then you could use rgb-&gt;hsv transformation."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 2, "creation_date": 1524475869, "post_id": 49976992, "comment_id": 86971342, "body": "You were recommended a color transformation lib a day ago. <a href=\"https://ru.stackoverflow.com/q/816924/178828\">ru.stackoverflow.com/q/816924/178828</a> Any progress there?"}, {"owner": {"reputation": 11, "user_id": 9498053, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YDuAy.jpg?s=128&g=1", "display_name": "\u041c\u0430\u0440\u0430\u0442\u043e\u043d", "link": "https://stackoverflow.com/users/9498053/%d0%9c%d0%b0%d1%80%d0%b0%d1%82%d0%be%d0%bd"}, "edited": false, "score": 0, "creation_date": 1524476073, "post_id": 49976992, "comment_id": 86971482, "body": "Yes, i tried it too, but i have started to study ruby,and i want to know other options"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 2, "creation_date": 1524476508, "post_id": 49976992, "comment_id": 86971770, "body": "@\u041c\u0430\u0440\u0430\u0442\u043e\u043d: you&#39;ll get better answers/help if you actually respond to questions in comments."}, {"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1524476990, "post_id": 49976992, "comment_id": 86972146, "body": "What is your question?"}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 1, "creation_date": 1524477199, "post_id": 49976992, "comment_id": 86972277, "body": "<i>&quot;I would like to sort them by Hue&quot;</i> \u2013 how do you determine the hue? Do you have a method for that or a 3rd party library?"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 1, "creation_date": 1524477251, "post_id": 49976992, "comment_id": 86972316, "body": "@Stefan: those strings might be in hsv/hsl (in which case, lexicographic sorting <i>also</i> sorts by hue). But we have no idea if it&#39;s the case."}, {"owner": {"reputation": 11, "user_id": 9498053, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YDuAy.jpg?s=128&g=1", "display_name": "\u041c\u0430\u0440\u0430\u0442\u043e\u043d", "link": "https://stackoverflow.com/users/9498053/%d0%9c%d0%b0%d1%80%d0%b0%d1%82%d0%be%d0%bd"}, "edited": false, "score": 0, "creation_date": 1524477578, "post_id": 49976992, "comment_id": 86972555, "body": "I dont have time to follow everything. At this lib, there is a transform into HSL. But i want to do this without this lib"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 4, "creation_date": 1524478648, "post_id": 49976992, "comment_id": 86973221, "body": "Oh, you don&#39;t have time. That&#39;s interesting. Well, have fun with investigating color transformation math. The conversion algorithm is easily googlable."}, {"owner": {"reputation": 11, "user_id": 9498053, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YDuAy.jpg?s=128&g=1", "display_name": "\u041c\u0430\u0440\u0430\u0442\u043e\u043d", "link": "https://stackoverflow.com/users/9498053/%d0%9c%d0%b0%d1%80%d0%b0%d1%82%d0%be%d0%bd"}, "edited": false, "score": 0, "creation_date": 1524478779, "post_id": 49976992, "comment_id": 86973293, "body": "I already did it,thx"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 9498053, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YDuAy.jpg?s=128&g=1", "display_name": "\u041c\u0430\u0440\u0430\u0442\u043e\u043d", "link": "https://stackoverflow.com/users/9498053/%d0%9c%d0%b0%d1%80%d0%b0%d1%82%d0%be%d0%bd"}, "edited": false, "score": 1, "creation_date": 1524475889, "post_id": 49977339, "comment_id": 86971353, "body": "Yeap,it works, and works also what you deleted)Thanks."}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 3, "creation_date": 1524479186, "post_id": 49977339, "comment_id": 86973541, "body": "This obviously does not work, since <code>&quot;c0&quot; &gt; &quot;C5&quot; &amp;&amp; &quot;c0&quot; &lt; &quot;c5&quot; #\u21d2\u00a0true</code>. You need at least <code>map(&amp;:downcase)</code> there."}, {"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "reply_to_user": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 2, "creation_date": 1524481157, "post_id": 49977339, "comment_id": 86974795, "body": "@mudasobwa Would you help giving another downvote? Mine alone does not seem to be sufficient."}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "reply_to_user": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1524501548, "post_id": 49977339, "comment_id": 86988284, "body": "@mudasobwa thanks, I&#39;ve updated my answer. good catch."}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 1, "creation_date": 1524583495, "post_id": 49977339, "comment_id": 87027274, "body": "hey guys thanks for the feedback, I updated my answer, please remove down votes if this solves the problem correctly. thanks."}, {"owner": {"reputation": 48049, "user_id": 6419007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/CwqtX.jpg?s=128&g=1", "display_name": "Eric Duminil", "link": "https://stackoverflow.com/users/6419007/eric-duminil"}, "edited": false, "score": 1, "creation_date": 1524597557, "post_id": 49977339, "comment_id": 87035212, "body": "@lacostenycoder: Much better. You should still test it though. I think your <code>hex_to_rgb</code> is broken when html input has a leading <code>#</code>."}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "reply_to_user": {"reputation": 48049, "user_id": 6419007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/CwqtX.jpg?s=128&g=1", "display_name": "Eric Duminil", "link": "https://stackoverflow.com/users/6419007/eric-duminil"}, "edited": false, "score": 0, "creation_date": 1524602793, "post_id": 49977339, "comment_id": 87037606, "body": "@EricDuminil I tested and got no error and it returned expected array when run with <code>hex_to_rgb(&#39;#07408e&#39;)</code> see <a href=\"http://rubyfiddle.com/riddles/baeb6\" rel=\"nofollow noreferrer\">rubyfiddle.com/riddles/baeb6</a>"}, {"owner": {"reputation": 48049, "user_id": 6419007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/CwqtX.jpg?s=128&g=1", "display_name": "Eric Duminil", "link": "https://stackoverflow.com/users/6419007/eric-duminil"}, "edited": false, "score": 1, "creation_date": 1524603238, "post_id": 49977339, "comment_id": 87037774, "body": "&quot;No exception&quot; doesn&#39;t mean &quot;no error&quot;.  <code>hex_to_rgb(&#39;#07408e&#39;)</code> returns <code>[0, 116, 8] </code> Which is clearly wrong : red channel should be <code>7</code>, not <code>0</code>. You could use another program (e.g. GIMP) to check if the RGB values and hue are correct."}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "reply_to_user": {"reputation": 48049, "user_id": 6419007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/CwqtX.jpg?s=128&g=1", "display_name": "Eric Duminil", "link": "https://stackoverflow.com/users/6419007/eric-duminil"}, "edited": false, "score": 0, "creation_date": 1524708066, "post_id": 49977339, "comment_id": 87083613, "body": "@EricDuminil updated again"}, {"owner": {"reputation": 48049, "user_id": 6419007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/CwqtX.jpg?s=128&g=1", "display_name": "Eric Duminil", "link": "https://stackoverflow.com/users/6419007/eric-duminil"}, "edited": false, "score": 0, "creation_date": 1524728290, "post_id": 49977339, "comment_id": 87090818, "body": "@lacostenycoder: A few notes : your code is mutating @hash. It&#39;s probably not the desired behaviour. You should mention which gem you&#39;re using. Please don&#39;t use <code>eval(curl)</code>, we shouldn&#39;t have to trust you and go look at the gist before running the code."}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "reply_to_user": {"reputation": 48049, "user_id": 6419007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/CwqtX.jpg?s=128&g=1", "display_name": "Eric Duminil", "link": "https://stackoverflow.com/users/6419007/eric-duminil"}, "edited": false, "score": 0, "creation_date": 1524747053, "post_id": 49977339, "comment_id": 87102899, "body": "@EricDuminil Not sure what you meant by mutating at hash. The only reason for the curl is because I didn&#39;t want to past a huge array into Stackoverflow which is all that code is doing.  I agree it&#39;s not best practice. What is in this case?  Thanks"}, {"owner": {"reputation": 48049, "user_id": 6419007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/CwqtX.jpg?s=128&g=1", "display_name": "Eric Duminil", "link": "https://stackoverflow.com/users/6419007/eric-duminil"}, "edited": false, "score": 0, "creation_date": 1524747297, "post_id": 49977339, "comment_id": 87103116, "body": "Compare <code>@shuffled</code> at the beginning and at the end of your script. It&#39;s been modified by <code>gsub!</code>."}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "reply_to_user": {"reputation": 48049, "user_id": 6419007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/CwqtX.jpg?s=128&g=1", "display_name": "Eric Duminil", "link": "https://stackoverflow.com/users/6419007/eric-duminil"}, "edited": false, "score": 0, "creation_date": 1524748632, "post_id": 49977339, "comment_id": 87104144, "body": "@EricDuminil good catch. fixed it. What about ideas on large array instead of curling?"}, {"owner": {"reputation": 48049, "user_id": 6419007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/CwqtX.jpg?s=128&g=1", "display_name": "Eric Duminil", "link": "https://stackoverflow.com/users/6419007/eric-duminil"}, "edited": false, "score": 0, "creation_date": 1524749472, "post_id": 49977339, "comment_id": 87104801, "body": "@lacostenycoder: It would be fine to have one huge line instead IMHO."}, {"owner": {"reputation": 48049, "user_id": 6419007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/CwqtX.jpg?s=128&g=1", "display_name": "Eric Duminil", "link": "https://stackoverflow.com/users/6419007/eric-duminil"}, "edited": false, "score": 1, "creation_date": 1524841214, "post_id": 49977339, "comment_id": 87146916, "body": "Finally, you don&#39;t need to show different updates for the code you&#39;ve written. There&#39;s an history link just for that purpose. Pick the best alternative and show it. SO can be frustrating sometimes, especially on low quality questions such as this one. Keep up the good work!"}, {"owner": {"reputation": 48049, "user_id": 6419007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/CwqtX.jpg?s=128&g=1", "display_name": "Eric Duminil", "link": "https://stackoverflow.com/users/6419007/eric-duminil"}, "reply_to_user": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 1, "creation_date": 1524841258, "post_id": 49977339, "comment_id": 87146948, "body": "@mudasobwa: This answer got much better."}, {"owner": {"reputation": 48049, "user_id": 6419007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/CwqtX.jpg?s=128&g=1", "display_name": "Eric Duminil", "link": "https://stackoverflow.com/users/6419007/eric-duminil"}, "reply_to_user": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 1, "creation_date": 1524841272, "post_id": 49977339, "comment_id": 87146958, "body": "@sawa: This answer got much better."}], "tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": true, "score": 0, "last_activity_date": 1524848669, "last_edit_date": 1524848669, "creation_date": 1524474879, "answer_id": 49977339, "question_id": 49976992, "link": "https://stackoverflow.com/questions/49976992/sort-hex-colors-by-hue/49977339#49977339", "title": "Sort (hex) colors by Hue", "body": "<p>In this updated example also we don't care about hash, we'll just deal with an arrays of hex colors:</p>\n\n<pre><code>require 'paint'\n\n#intantiate web_colors from gist and shuffle them\neval(`curl https://gist.githubusercontent.com/lacostenycoder/394341d3c63589a050d72b8d9ae529aa/raw/4a11cd6ca81e07a643e5f3481e38494ff3c9b973/web_colors_shuffle.rb`)\n\ndef hex_to_rgb(hex)\n  h = hex.gsub(\"#\",\"\")\n  /(?&lt;r&gt;..)(?&lt;g&gt;..)(?&lt;b&gt;..)/ =~ h\n  [r,g,b].map {|cs| cs.to_i(16)}\nend\n\ndef rgb_to_hsl(r,g,b, by_hue=false)\n  # normalize r, g and b\n  r /= 255.0\n  g /= 255.0\n  b /= 255.0\n\n  c_min = [r,g,b].min\n  c_max = [r,g,b].max\n\n  h = s = l = (c_min + c_max) / 2\n\n  d = (c_max - c_min)#.to_f\n\n  # compute hue\n  if c_max == c_min\n    h = s = 0.0 # achromatic i.e. ffffff or 000000\n  else\n    s = l &gt; 0.5 ? d / (2 - c_max - c_min) : d / (c_max + c_min);\n    h = (g - b) / d + ( g &lt; b ? 6 : 0) if c_max == r\n    h = (b - r) / d + 2 if c_max == g if c_max == g\n    h = (r - g) / d + 4 if c_max == b if c_max == b\n  end\n  h /= 6\n  by_hue ? h : [h, s, l]\nend\n\ndef sort_em(colors, by_hue=false)\n  colors.sort_by { |color| rgb_to_hsl(*hex_to_rgb(color), by_hue) }\nend\n\ndef puts_em(colors)\n  colors.each{|color| puts Paint[color, color]}\nend\n\n#shuffled web_colors sorted by hue\nputs \"\\nShuffled web_colors by hue \\n\\n\"\nputs_em(sort_em @shuffled, by_hue=true)\n\nputs \"Shuffled web_colors by HSL \\n\\n\"\n#shuffled web_colors sorted by HLS\nputs_em(@shuffled)\n\n# sample uniformly at random from RGB space\ncolors = 200.times.map {  (0..255).to_a.sample(3).map { |i| i.to_s(16).rjust(2, '0')}.join   }\n\nputs \"\\n Shuffled Random By Hue\\n\\n\"\nputs_em(sort_em colors, by_hue=true)\n\nputs \"\\nShuffled Random by HSL\\n\\n\"\nputs_em(sort_em colors)\n</code></pre>\n\n<p>You may need to first run <code>gem install paint</code> and you can <a href=\"https://gist.github.com/lacostenycoder/394341d3c63589a050d72b8d9ae529aa\" rel=\"nofollow noreferrer\">download gist</a> of this</p>\n"}], "owner": {"reputation": 11, "user_id": 9498053, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YDuAy.jpg?s=128&g=1", "display_name": "\u041c\u0430\u0440\u0430\u0442\u043e\u043d", "link": "https://stackoverflow.com/users/9498053/%d0%9c%d0%b0%d1%80%d0%b0%d1%82%d0%be%d0%bd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 411, "favorite_count": 0, "closed_date": 1524481237, "accepted_answer_id": 49977339, "answer_count": 1, "score": -8, "last_activity_date": 1524848669, "creation_date": 1524473763, "question_id": 49976992, "link": "https://stackoverflow.com/questions/49976992/sort-hex-colors-by-hue", "closed_reason": "Needs details or clarity", "title": "Sort (hex) colors by Hue", "body": "<p>I have a list of colors represented in hex. And I would like to sort them by Hue.Small example:</p>\n\n<pre><code>My_hash = {\"1\"=&gt;[\"#00050c\"], \n \"2\"=&gt;[\"#ffffff\"], \n \"3\"=&gt;[\"#d6e7ff\"],\n \"4\"=&gt;[\"#008000\"],\n \"5\"=&gt;[\"#0768ef\"],\n \"6\"=&gt;[\"#07408e\"],\n \"7\"=&gt;[\"#42AAFF\"],\n \"8\"=&gt;[\"#21406b\"],\n \"9\"=&gt;[\"#032656\"]}\nMy_hash.each_value {|value| puts value}\n</code></pre>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1524476835, "post_id": 49976851, "comment_id": 86972022, "body": "What is <code>constantize</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 3320, "user_id": 4950680, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C8cEh.jpg?s=128&g=1", "display_name": "Martin Zinovsky", "link": "https://stackoverflow.com/users/4950680/martin-zinovsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1524477172, "last_edit_date": 1524477172, "creation_date": 1524474310, "answer_id": 49977155, "question_id": 49976851, "link": "https://stackoverflow.com/questions/49976851/undefined-method-constantize-in-rake-task/49977155#49977155", "title": "undefined method constantize in rake task", "body": "<p>You can call <a href=\"https://apidock.com/rails/String/constantize\" rel=\"nofollow noreferrer\">String#constantize</a> only on strings but you are calling it on array <code>FACTORY</code>.</p>\n\n<p>Remove <code>FACTORY.constantize</code> and add <code>factory.constantize.public_send(:delete_all)</code></p>\n\n<p>Also make sure you have <a href=\"https://apidock.com/rails/ActiveSupport/Inflector\" rel=\"nofollow noreferrer\">ActiveSupport::Inflector</a> required</p>\n"}, {"tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": true, "score": 1, "last_activity_date": 1524474480, "creation_date": 1524474480, "answer_id": 49977210, "question_id": 49976851, "link": "https://stackoverflow.com/questions/49976851/undefined-method-constantize-in-rake-task/49977210#49977210", "title": "undefined method constantize in rake task", "body": "<p>In ruby uppercased variables are constants by default so you can't call <code>constantize</code> on it. In your case it's just an array so this should work:</p>\n\n<pre><code>FACTORY = %w(ProcessedTransaction Chargeback).freeze\nFACTORY.each do |factory|\n  factory.constantize.public_send(:delete_all)\nend\n</code></pre>\n"}], "owner": {"reputation": 7004, "user_id": 1103606, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/0d93cc650b93939ea91066fcb5aefae0?s=128&d=identicon&r=PG", "display_name": "Peter Penzov", "link": "https://stackoverflow.com/users/1103606/peter-penzov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 469, "favorite_count": 0, "accepted_answer_id": 49977210, "answer_count": 2, "score": 0, "last_activity_date": 1524477172, "creation_date": 1524473236, "question_id": 49976851, "link": "https://stackoverflow.com/questions/49976851/undefined-method-constantize-in-rake-task", "title": "undefined method constantize in rake task", "body": "<p>I'm trying to run this code\"</p>\n\n<pre><code>FACTORY = %w(ProcessedTransaction Chargeback).freeze\n FACTORY.constantize.each do |factory|\n   factory.public_send(:delete_all)\n   end\n end\n</code></pre>\n\n<p>But I get this error: <code>NoMethodError: undefined method</code>constantize' for #`</p>\n\n<p>Do you know how I can solve the issue?</p>\n"}, {"tags": ["sql", "ruby", "pg"], "comments": [{"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1524469196, "post_id": 49975189, "comment_id": 86967409, "body": "It&#39;s unclear why you need this.  There is no exact postgres method for what it sounds like you&#39;re trying to accomplish.  Can you give an example of the more complex query?  Are you testing Ruby or SQL code?  Either way you should write proper unit tests."}, {"owner": {"reputation": 1267, "user_id": 1718633, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/fabe1e6b28afc64cdbd3c071621a7565?s=128&d=identicon&r=PG", "display_name": "Rich_F", "link": "https://stackoverflow.com/users/1718633/rich-f"}, "reply_to_user": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1524476390, "post_id": 49975189, "comment_id": 86971700, "body": "Not Postgres.  PG.  PG is a gem.  Giving PG the base SQL, with parameters, I would like to somehow obtain the fully structured SQL passed to postgresql."}, {"owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "edited": false, "score": 1, "creation_date": 1524480092, "post_id": 49975189, "comment_id": 86974129, "body": "Maybe you are looking for explain method? For example: <code>User.where(&#39;id &gt;= :id1 AND id &lt;= :id2&#39;, id1: 1, id2:3).explain</code>"}, {"owner": {"reputation": 1267, "user_id": 1718633, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/fabe1e6b28afc64cdbd3c071621a7565?s=128&d=identicon&r=PG", "display_name": "Rich_F", "link": "https://stackoverflow.com/users/1718633/rich-f"}, "reply_to_user": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "edited": false, "score": 0, "creation_date": 1524480194, "post_id": 49975189, "comment_id": 86974185, "body": "@iGian Nope.  I know that in other packages, but nothing shows up in PG.  Have a look at the link I added under Note: above."}, {"owner": {"reputation": 12542, "user_id": 156746, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/8TsPx.jpg?s=128&g=1", "display_name": "DiegoSalazar", "link": "https://stackoverflow.com/users/156746/diegosalazar"}, "edited": false, "score": 2, "creation_date": 1524496274, "post_id": 49975189, "comment_id": 86985112, "body": "You your self are submitting the exact SQL statement that PG is receiving, what else do you want to see?"}, {"owner": {"reputation": 1088, "user_id": 3236163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f4a825085dda7d9ea059838a3d6dcd7?s=128&d=identicon&r=PG", "display_name": "elyalvarado", "link": "https://stackoverflow.com/users/3236163/elyalvarado"}, "edited": false, "score": 2, "creation_date": 1524496741, "post_id": 49975189, "comment_id": 86985397, "body": "There is no way because the <code>conn.exec_params</code> is a native C implementation, and the returned object <code>PG::Result</code> also has no way to show the SQL. If you really want to see the query that much you can turn on statement logging in your postgress configuration and have a look at it."}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "reply_to_user": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "edited": false, "score": 0, "creation_date": 1524502348, "post_id": 49975189, "comment_id": 86988751, "body": "@iGian <code>.explain</code> method is provided by ActiveRecord, not PG, although it&#39;s not a bad idea for this use case."}, {"owner": {"reputation": 1267, "user_id": 1718633, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/fabe1e6b28afc64cdbd3c071621a7565?s=128&d=identicon&r=PG", "display_name": "Rich_F", "link": "https://stackoverflow.com/users/1718633/rich-f"}, "reply_to_user": {"reputation": 12542, "user_id": 156746, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/8TsPx.jpg?s=128&g=1", "display_name": "DiegoSalazar", "link": "https://stackoverflow.com/users/156746/diegosalazar"}, "edited": false, "score": 0, "creation_date": 1524533158, "post_id": 49975189, "comment_id": 87000893, "body": "@DiegoSalazar I want to see how the query plays out, exactly how the .explain method delivers.  With complex queries and parameters that can get confusing, it would be nice to get the end resulting query exactly as it&#39;s perceived.  Even if <code>Postgresql</code> can return it and it&#39;s hidden in a <code>PG</code> method, it would be helpful."}], "answers": [{"comments": [{"owner": {"reputation": 1267, "user_id": 1718633, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/fabe1e6b28afc64cdbd3c071621a7565?s=128&d=identicon&r=PG", "display_name": "Rich_F", "link": "https://stackoverflow.com/users/1718633/rich-f"}, "edited": false, "score": 0, "creation_date": 1524533397, "post_id": 49984666, "comment_id": 87000936, "body": "Your idea about statement logging is probably where I want to go.  I thought <code>Postgresql</code> might have had some method to pass to <code>PG::Result</code> so it could be passed to me.  Quite often the case is that I get results, but I want to test the whole transaction, to make sure the results are just not blind results."}, {"owner": {"reputation": 1088, "user_id": 3236163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f4a825085dda7d9ea059838a3d6dcd7?s=128&d=identicon&r=PG", "display_name": "elyalvarado", "link": "https://stackoverflow.com/users/3236163/elyalvarado"}, "reply_to_user": {"reputation": 1267, "user_id": 1718633, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/fabe1e6b28afc64cdbd3c071621a7565?s=128&d=identicon&r=PG", "display_name": "Rich_F", "link": "https://stackoverflow.com/users/1718633/rich-f"}, "edited": false, "score": 0, "creation_date": 1524535003, "post_id": 49984666, "comment_id": 87001280, "body": "Glad my comment was helpful. I edited the answer to include what I wrote in the comment, so if that is the way you&#39;re going please accept the answer as correct."}, {"owner": {"reputation": 1267, "user_id": 1718633, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/fabe1e6b28afc64cdbd3c071621a7565?s=128&d=identicon&r=PG", "display_name": "Rich_F", "link": "https://stackoverflow.com/users/1718633/rich-f"}, "edited": false, "score": 0, "creation_date": 1524536117, "post_id": 49984666, "comment_id": 87001470, "body": "I&#39;m trying this, but not there yet."}, {"owner": {"reputation": 1267, "user_id": 1718633, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/fabe1e6b28afc64cdbd3c071621a7565?s=128&d=identicon&r=PG", "display_name": "Rich_F", "link": "https://stackoverflow.com/users/1718633/rich-f"}, "edited": false, "score": 0, "creation_date": 1524557820, "post_id": 49984666, "comment_id": 87009607, "body": "Indeed the log does contain not only the statement, but the details of the parameters.  All packaged together nice.  My guess was that <code>PG</code> would have had some kind of ability to pass this through."}], "tags": [], "owner": {"reputation": 1088, "user_id": 3236163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f4a825085dda7d9ea059838a3d6dcd7?s=128&d=identicon&r=PG", "display_name": "elyalvarado", "link": "https://stackoverflow.com/users/3236163/elyalvarado"}, "is_accepted": true, "score": 1, "last_activity_date": 1524534936, "last_edit_date": 1524534936, "creation_date": 1524497139, "answer_id": 49984666, "question_id": 49975189, "link": "https://stackoverflow.com/questions/49975189/ruby-pg-submitted-sql/49984666#49984666", "title": "Ruby PG Submitted SQL", "body": "<p>There is no way because the <code>conn.exec_params</code> is a native C implementation, and the returned object <code>PG::Resul</code>t also has no way to show the SQL. If you really want to see the query you can turn on statement logging in your postgress configuration and have a look at it</p>\n\n<p>You might however try to see if there is some information you might use in the error constants, but you'll have to force an error to get it (note that I changed the name of the table in the query to <code>alpha_non_existent</code> to force an error):</p>\n\n<pre><code>begin\n    resclose = conn.exec_params( %q{ SELECT * FROM alpha_non_existent WHERE pname ILIKE $1 ORDER BY id}, [submitted] )\nrescue PG::Error =&gt; err\n    p [\n        err.result.error_field( PG::Result::PG_DIAG_SEVERITY ),\n        err.result.error_field( PG::Result::PG_DIAG_SQLSTATE ),\n        err.result.error_field( PG::Result::PG_DIAG_MESSAGE_PRIMARY ),\n        err.result.error_field( PG::Result::PG_DIAG_MESSAGE_DETAIL ),\n        err.result.error_field( PG::Result::PG_DIAG_MESSAGE_HINT ),\n        err.result.error_field( PG::Result::PG_DIAG_STATEMENT_POSITION ),\n        err.result.error_field( PG::Result::PG_DIAG_INTERNAL_POSITION ),\n        err.result.error_field( PG::Result::PG_DIAG_INTERNAL_QUERY ),\n        err.result.error_field( PG::Result::PG_DIAG_CONTEXT ),\n        err.result.error_field( PG::Result::PG_DIAG_SOURCE_FILE ),\n        err.result.error_field( PG::Result::PG_DIAG_SOURCE_LINE ),\n        err.result.error_field( PG::Result::PG_DIAG_SOURCE_FUNCTION ),\n    ]\nend\n</code></pre>\n"}], "owner": {"reputation": 1267, "user_id": 1718633, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/fabe1e6b28afc64cdbd3c071621a7565?s=128&d=identicon&r=PG", "display_name": "Rich_F", "link": "https://stackoverflow.com/users/1718633/rich-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 1, "accepted_answer_id": 49984666, "answer_count": 1, "score": 0, "last_activity_date": 1524534936, "creation_date": 1524467041, "last_edit_date": 1524476509, "question_id": 49975189, "link": "https://stackoverflow.com/questions/49975189/ruby-pg-submitted-sql", "title": "Ruby PG Submitted SQL", "body": "<p>I'm looking for a <code>PG</code> method that returns the actual submitted SQL query to the database.  I have this <code>params</code> statement sent to the database:</p>\n\n<pre><code>resclose = conn.exec_params( %q{ SELECT * FROM alpha WHERE alpha.pname ILIKE $1 ORDER BY id}, [submitted] )\n</code></pre>\n\n<p>This is a simple query with one parameter called <code>submitted</code>. Some of my other statements are much more complex.  I'd like to test the actual <code>SQL</code> statement in a database client to see that I'm getting what I'm thinking I'm asking for.  </p>\n\n<p>Does <code>PG</code> have a method that I can use?  I can't seem to find anything that returns the actual query.   </p>\n\n<p>Note:  <code>PG</code> is a gem, not meant to be <code>postgresql</code>.  <a href=\"http://www.rubydoc.info/gems/pg/PG/Connection\" rel=\"nofollow noreferrer\">PG is here</a></p>\n"}, {"tags": ["ruby", "sockets", "tcpserver"], "comments": [{"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 1, "creation_date": 1524468988, "post_id": 49974407, "comment_id": 86967298, "body": "What is your question?"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8819420"}, "edited": false, "score": 0, "creation_date": 1524469678, "post_id": 49974934, "comment_id": 86967675, "body": "however,once I run the program again I get a address already in use error,even though I added a client.close in the do block.Any workaround?"}, {"owner": {"reputation": 5746, "user_id": 4984564, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/9bc286af6678a63ceb881eaf9e966f5f?s=128&d=identicon&r=PG", "display_name": "DarkWiiPlayer", "link": "https://stackoverflow.com/users/4984564/darkwiiplayer"}, "edited": false, "score": 0, "creation_date": 1524480196, "post_id": 49974934, "comment_id": 86974188, "body": "Depends. My guess is that the <code>client.close</code> isn&#39;t reached. Did you terminate the program early? (like by pressing Ctrl+C or from the main thread)"}, {"owner": {"reputation": 5746, "user_id": 4984564, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/9bc286af6678a63ceb881eaf9e966f5f?s=128&d=identicon&r=PG", "display_name": "DarkWiiPlayer", "link": "https://stackoverflow.com/users/4984564/darkwiiplayer"}, "edited": false, "score": 0, "creation_date": 1524480362, "post_id": 49974934, "comment_id": 86974288, "body": "If you need a way to send some sort of close signal to the thread, you could use a <a href=\"http://ruby-doc.org/stdlib-1.9.3/libdoc/thread/rdoc/Queue.html\" rel=\"nofollow noreferrer\">Queue</a>. Closing with Ctrl+C is handled as a normal exception in ruby, so you can just rescue that in your main thread and send a close signal to your background server before raising the exception further up."}, {"owner": {"reputation": 5746, "user_id": 4984564, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/9bc286af6678a63ceb881eaf9e966f5f?s=128&d=identicon&r=PG", "display_name": "DarkWiiPlayer", "link": "https://stackoverflow.com/users/4984564/darkwiiplayer"}, "edited": false, "score": 0, "creation_date": 1524481306, "post_id": 49974934, "comment_id": 86974899, "body": "@ShakshamJaiswal I did some testing; you can add an <code>ensure</code> block to the thread and it <i>should</i> always run, even if you kill the thread, so you can put your <code>client.close</code> there. EDIT: Updated the answer to reflect this"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8819420"}, "edited": false, "score": 0, "creation_date": 1524481430, "post_id": 49974934, "comment_id": 86974980, "body": "No I never terminate i.normally the program closes after reaching exit but the server still runs."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8819420"}, "edited": false, "score": 0, "creation_date": 1524481625, "post_id": 49974934, "comment_id": 86975116, "body": "I&#39;ve made an edit to question,can you look at it? It works when the data is received however server still continues running if no data is received,or if you suggest how to add a timeout scheme there? Like listen only for 10 seconds and then close if no data is received.That would be really helpful."}, {"owner": {"reputation": 5746, "user_id": 4984564, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/9bc286af6678a63ceb881eaf9e966f5f?s=128&d=identicon&r=PG", "display_name": "DarkWiiPlayer", "link": "https://stackoverflow.com/users/4984564/darkwiiplayer"}, "edited": false, "score": 0, "creation_date": 1524482102, "post_id": 49974934, "comment_id": 86975389, "body": "The problem might be that the main program reaches its end after spawning the thread. At that point it probably just closes the thread and ends. Try adding <code>websrv.join</code> at the end, which instructs the main thread to wait until the <code>websrv</code> has finished before continuing. But again, ensure should also work to, well, <i>ensure</i> that the connection is closed either way."}], "tags": [], "owner": {"reputation": 5746, "user_id": 4984564, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/9bc286af6678a63ceb881eaf9e966f5f?s=128&d=identicon&r=PG", "display_name": "DarkWiiPlayer", "link": "https://stackoverflow.com/users/4984564/darkwiiplayer"}, "is_accepted": true, "score": 0, "last_activity_date": 1524482324, "last_edit_date": 1524482324, "creation_date": 1524466065, "answer_id": 49974934, "question_id": 49974407, "link": "https://stackoverflow.com/questions/49974407/ruby-background-tcp-server/49974934#49974934", "title": "Ruby background TCP Server", "body": "<p>You can put your server in a new <a href=\"https://ruby-doc.org/core-2.5.0/Thread.html#method-c-new\" rel=\"nofollow noreferrer\">Thread</a> with</p>\n\n<pre><code>websrv = Thread.new do\n  &lt;your server logic&gt; # Main server loop, handle data, etc.\nensure\n  &lt;your cleanup code&gt; # Close connections, files, etc.\nend\n&lt;application code&gt;\nwebsrv.join # wait for web server to do its thing\n</code></pre>\n\n<p>Needless to say, in ruby you'd usually wrap that in some sort of BackgroundServer class, but the basic idea is the same.</p>\n\n<p>Note that rubys <em>threads</em> don't really execute in parallel; the interpreter just takes care of switching back and forth between them.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8819420"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 49974934, "answer_count": 1, "score": 1, "last_activity_date": 1524482324, "creation_date": 1524463622, "last_edit_date": 1524481589, "question_id": 49974407, "link": "https://stackoverflow.com/questions/49974407/ruby-background-tcp-server", "title": "Ruby background TCP Server", "body": "<p>I wish to create a TCPServer which listens in the background while the script continues it's normal execution.\nFor example-</p>\n\n<pre><code>server=TCPServer.open(srvhost,srvport)\n    client=server.accept \n    res=send_request_cgi({\n        'uri' =&gt; \"/\",\n        'method' =&gt; 'GET',\n        'vars_get' =&gt; \n            'cmd' =&gt; rand_text_alphanumeric(10)\n        }\n    })\n    print \"#{res.headers}\" \n    data=client.recv(1024)\n    puts data\n    client.close\n</code></pre>\n\n<p>This pauses the script at the listener.</p>\n\n<p>Objective-The server will always receive a response on srvport which it should print.</p>\n\n<p>Edit-</p>\n\n<pre><code>webserv=Thread.new do\n        server=TCPServer.new(srvhost,srvport)\n        client=server.accept \n        data=client.recv(1024)\n        if(data.empty?)\n                puts 'nope'\n                client.close\n                server.close\n                webserv.exit\n        end\n        puts data\n        client.write(cmd)\n        client.close\n        server.close\n        webserv.exit\n        end \n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "rspec", "capybara", "capybara-webkit"], "comments": [{"owner": {"reputation": 6942, "user_id": 4172515, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/BYWxd.jpg?s=128&g=1", "display_name": "fool-dev", "link": "https://stackoverflow.com/users/4172515/fool-dev"}, "edited": false, "score": 1, "creation_date": 1524464531, "post_id": 49974389, "comment_id": 86965010, "body": "See this <a href=\"https://stackoverflow.com/a/4983354/4172515\">stackoverflow.com/a/4983354/4172515</a> I think it would be helpful"}, {"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1524469019, "post_id": 49974389, "comment_id": 86967316, "body": "What is your question?"}], "answers": [{"tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": false, "score": 0, "last_activity_date": 1524471882, "creation_date": 1524471882, "answer_id": 49976487, "question_id": 49974389, "link": "https://stackoverflow.com/questions/49974389/i-want-to-assert-for-404-in-spec/49976487#49976487", "title": "I want to assert for 404 in spec", "body": "<p>Rails by default expects all routes to be defined in <code>config/routes.rb</code></p>\n\n<p>If you wanted to redirect all unknown routes in to some known endpoint you might add a line like this at the bottom of your routes file:</p>\n\n<pre><code>get '*path', to: 'home#index' #or whatever your default root path might be\n</code></pre>\n\n<p>There should be no need to test for 404 error as Rails will raise exception if your route is not found unless you handle it as shown above.</p>\n"}, {"tags": [], "owner": {"reputation": 117, "user_id": 2924562, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9CbKx.jpg?s=128&g=1", "display_name": "Am33d", "link": "https://stackoverflow.com/users/2924562/am33d"}, "is_accepted": true, "score": 0, "last_activity_date": 1524654363, "creation_date": 1524654363, "answer_id": 50020700, "question_id": 49974389, "link": "https://stackoverflow.com/questions/49974389/i-want-to-assert-for-404-in-spec/50020700#50020700", "title": "I want to assert for 404 in spec", "body": "<pre><code>Rails.application.config.action_dispatch.show_exceptions\n</code></pre>\n\n<p>This was the issue!</p>\n\n<p>It's value should be set as <strong>true</strong></p>\n\n<p>It can be done in two ways, either set it in test.rb file as:</p>\n\n<pre><code># Raise exceptions instead of rendering exception templates\n  config.action_dispatch.show_exceptions = true\n</code></pre>\n\n<p>or</p>\n\n<pre><code>  before(:all) do\n  Rails.application.config.action_dispatch.show_exceptions = true\n  end\n</code></pre>\n\n<p>Also, don't forget to check this: <em>config.consider_all_requests_local = false</em>, to display your custom error page (in your current environment).</p>\n"}], "owner": {"reputation": 117, "user_id": 2924562, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9CbKx.jpg?s=128&g=1", "display_name": "Am33d", "link": "https://stackoverflow.com/users/2924562/am33d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 813, "favorite_count": 0, "accepted_answer_id": 50020700, "answer_count": 2, "score": 3, "last_activity_date": 1524654363, "creation_date": 1524463545, "question_id": 49974389, "link": "https://stackoverflow.com/questions/49974389/i-want-to-assert-for-404-in-spec", "title": "I want to assert for 404 in spec", "body": "<p>I want to test my app which redirects to a custom 404, 500 error pages. I turned on <em>config.consider_all_requests_local = false</em> in the <em>test.rb</em> file to check for the error pages.\nNow everything works fine and I am able to fill in the fields and assert with capybara if the path exists in rake routes eg:</p>\n\n<pre><code>visit signin_path \n</code></pre>\n\n<p>the problem is if I give a wrong path like </p>\n\n<pre><code>visit signin_path + '/xyz' #xyz is incorrent\n</code></pre>\n\n<p>or</p>\n\n<pre><code>visit ('/wrongpage') \n</code></pre>\n\n<p>to check for redirection to my custom error page, the test case gives an exception and does not proceed to the expect statement. This is the error:</p>\n\n<pre><code>Failure/Error: visit ('/wrongpage')\n\nActionController::RoutingError:\n  No route matches [GET] \"/wrongpage\"\n\n#then stack trace is printed here\n</code></pre>\n\n<p>I  also tried checking for </p>\n\n<pre><code>expect(page).to raise_error(ActiveRecord::RecordNotFound)\n</code></pre>\n\n<p>when I try to fetch a record with invalid id (like id = 'xyz' instead of integer, which gives a 500 error), same problem is present here, the execution stops and does not proceeds to the expect statement.</p>\n\n<p>I also tried looking on the internet for answers but didn't get what I was looking for, this (<a href=\"https://stackoverflow.com/a/25469175/2924562\">https://stackoverflow.com/a/25469175/2924562</a>) was close but for </p>\n\n<pre><code>visit page_path\n</code></pre>\n\n<p>gives the following error:</p>\n\n<pre><code>    Failure/Error: visit page_path('wrongpage')\n\n NoMethodError:\n   undefined method `page_path' for ....\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "cucumber"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 8639017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1fd4c618831ac490b45d94865ab323b?s=128&d=identicon&r=PG&f=1", "display_name": "newplasticideas", "link": "https://stackoverflow.com/users/8639017/newplasticideas"}, "edited": false, "score": 0, "creation_date": 1524527726, "post_id": 49991283, "comment_id": 86999593, "body": "Sorry, I probably should have mentioned I&#39;m using Firefox, hence the geckodriver update. A geckodriver update didn&#39;t work, but I think I&#39;ll update chromedriver and see how the test behaves in Chrome. Thanks!"}], "tags": [], "owner": {"reputation": 16, "user_id": 2262308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59c98feaace98f4a7a684cf9137b7823?s=128&d=identicon&r=PG", "display_name": "dmurphy10", "link": "https://stackoverflow.com/users/2262308/dmurphy10"}, "is_accepted": false, "score": 0, "last_activity_date": 1524526043, "creation_date": 1524526043, "answer_id": 49991283, "question_id": 49972747, "link": "https://stackoverflow.com/questions/49972747/cucumber-test-fails-on-unscrollable-page/49991283#49991283", "title": "Cucumber test fails on unscrollable page", "body": "<p>This sounds like a bug that exists in an older version of chromedriver that is caused with newer/later versions of Chrome. The bug is the driver would lose the ability to scroll the tab in focus.</p>\n\n<p>I would recommend downloading the latest driver and replacing the one you are using. </p>\n\n<p><a href=\"https://sites.google.com/a/chromium.org/chromedriver/downloads\" rel=\"nofollow noreferrer\">https://sites.google.com/a/chromium.org/chromedriver/downloads</a></p>\n\n<p>Cheers.</p>\n"}], "owner": {"reputation": 11, "user_id": 8639017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1fd4c618831ac490b45d94865ab323b?s=128&d=identicon&r=PG&f=1", "display_name": "newplasticideas", "link": "https://stackoverflow.com/users/8639017/newplasticideas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 74, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524526043, "creation_date": 1524451653, "last_edit_date": 1524469122, "question_id": 49972747, "link": "https://stackoverflow.com/questions/49972747/cucumber-test-fails-on-unscrollable-page", "title": "Cucumber test fails on unscrollable page", "body": "<p>Here is a test (I've opened the inspector during the test and that's definitely the element hierarchy):</p>\n\n<pre><code>within('table.foo') do\n  find(\"tr#foo_#{ @foo.id }\").click\nend\n</code></pre>\n\n<p>Calling <code>find()</code> on the element returns:</p>\n\n<pre><code>could not be scrolled into view (Selenium::WebDriver::Error::WebDriverError)\n</code></pre>\n\n<p>I have a pretty good idea why--the page renders a single db entry created for the purpose of the test, and so the document doesn't extend past the window, making it unscrollable, which I think is what's throwing this error.</p>\n\n<p>I have tried updating geckodriver to no avail.</p>\n\n<p>Is there a method in cucumber that doesn't prompt scrolling? Would be better than a) testing in a really tiny window or b) creating more test data just to stretch the document.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-3"], "comments": [{"owner": {"reputation": 2412, "user_id": 1253504, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/1ba0b6bef219b34fa4f2d014046ff987?s=128&d=identicon&r=PG", "display_name": "kasperite", "link": "https://stackoverflow.com/users/1253504/kasperite"}, "edited": false, "score": 0, "creation_date": 1524456181, "post_id": 49972650, "comment_id": 86962364, "body": "is <code>Student::Import</code> a model?can you paste its content here?"}, {"owner": {"reputation": 45, "user_id": 9665462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f852aef06e7baec5b9604c3563a645ad?s=128&d=identicon&r=PG&f=1", "display_name": "krishna", "link": "https://stackoverflow.com/users/9665462/krishna"}, "reply_to_user": {"reputation": 2412, "user_id": 1253504, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/1ba0b6bef219b34fa4f2d014046ff987?s=128&d=identicon&r=PG", "display_name": "kasperite", "link": "https://stackoverflow.com/users/1253504/kasperite"}, "edited": false, "score": 0, "creation_date": 1524456431, "post_id": 49972650, "comment_id": 86962413, "body": "No, its not a model."}, {"owner": {"reputation": 2412, "user_id": 1253504, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/1ba0b6bef219b34fa4f2d014046ff987?s=128&d=identicon&r=PG", "display_name": "kasperite", "link": "https://stackoverflow.com/users/1253504/kasperite"}, "edited": false, "score": 0, "creation_date": 1524456569, "post_id": 49972650, "comment_id": 86962442, "body": "if it&#39;s outside <code>&#47;app</code> folder then you need to make sure it&#39;s loaded(check config files), I presume this file is in <code>&#47;lib</code>?"}, {"owner": {"reputation": 45, "user_id": 9665462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f852aef06e7baec5b9604c3563a645ad?s=128&d=identicon&r=PG&f=1", "display_name": "krishna", "link": "https://stackoverflow.com/users/9665462/krishna"}, "reply_to_user": {"reputation": 2412, "user_id": 1253504, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/1ba0b6bef219b34fa4f2d014046ff987?s=128&d=identicon&r=PG", "display_name": "kasperite", "link": "https://stackoverflow.com/users/1253504/kasperite"}, "edited": false, "score": 0, "creation_date": 1524456650, "post_id": 49972650, "comment_id": 86962462, "body": "which file? I have just dealt with controller and models, routes and appliction.rb files."}], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 9665462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f852aef06e7baec5b9604c3563a645ad?s=128&d=identicon&r=PG&f=1", "display_name": "krishna", "link": "https://stackoverflow.com/users/9665462/krishna"}, "edited": false, "score": 0, "creation_date": 1524492191, "post_id": 49983024, "comment_id": 86982375, "body": "I tried following for debugging: <code>all.each do |student|             csv &lt;&lt; student.attributes.values             puts student.attributes.values_at(*fields)           end</code> so it is giving me no output but if I do <code>puts student.attributes.values</code> it is giving me the correct output. So, I think there is some problem with the *fields"}, {"owner": {"reputation": 45, "user_id": 9665462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f852aef06e7baec5b9604c3563a645ad?s=128&d=identicon&r=PG&f=1", "display_name": "krishna", "link": "https://stackoverflow.com/users/9665462/krishna"}, "edited": false, "score": 0, "creation_date": 1524492932, "post_id": 49983024, "comment_id": 86982970, "body": "I fixed it. I put the column name different earlier by mistake"}, {"owner": {"reputation": 196, "user_id": 2493590, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/63a284c798ef80209727d1b4d018fdb4?s=128&d=identicon&r=PG", "display_name": "dgolman", "link": "https://stackoverflow.com/users/2493590/dgolman"}, "reply_to_user": {"reputation": 45, "user_id": 9665462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f852aef06e7baec5b9604c3563a645ad?s=128&d=identicon&r=PG&f=1", "display_name": "krishna", "link": "https://stackoverflow.com/users/9665462/krishna"}, "edited": false, "score": 0, "creation_date": 1524502150, "post_id": 49983024, "comment_id": 86988646, "body": "@krishna if you could post your final solution, I can update my answer. Otherwise, feel free just to mark this as correct."}], "tags": [], "owner": {"reputation": 196, "user_id": 2493590, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/63a284c798ef80209727d1b4d018fdb4?s=128&d=identicon&r=PG", "display_name": "dgolman", "link": "https://stackoverflow.com/users/2493590/dgolman"}, "is_accepted": true, "score": 0, "last_activity_date": 1524491888, "creation_date": 1524491888, "answer_id": 49983024, "question_id": 49972650, "link": "https://stackoverflow.com/questions/49972650/empty-csv-file-from-rails/49983024#49983024", "title": "Empty CSV file from rails", "body": "<p>Try </p>\n\n<pre><code>where.each do |student|\n  puts student #Debug\n  csv &lt;&lt; student.attributes.values_at(*fields)\nend\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 9665462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f852aef06e7baec5b9604c3563a645ad?s=128&d=identicon&r=PG&f=1", "display_name": "krishna", "link": "https://stackoverflow.com/users/9665462/krishna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 413, "favorite_count": 0, "accepted_answer_id": 49983024, "answer_count": 1, "score": 0, "last_activity_date": 1524491888, "creation_date": 1524450805, "last_edit_date": 1524490862, "question_id": 49972650, "link": "https://stackoverflow.com/questions/49972650/empty-csv-file-from-rails", "title": "Empty CSV file from rails", "body": "<p>I am new to ruby on rails and I am having trouble in exporting the data to csv. I have followed the following video:</p>\n\n<p><a href=\"https://medium.com/coderaga/rails-import-export-csv-data-without-gem-fbf2a36a84f6\" rel=\"nofollow noreferrer\">https://medium.com/coderaga/rails-import-export-csv-data-without-gem-fbf2a36a84f6</a></p>\n\n<p>I have put <strong>require 'csv'</strong> in application.rb file also.</p>\n\n<p>My student.rb model has:</p>\n\n<pre><code>def self.to_csv(fields = column_names, options = {})\n    CSV.generate(options) do |csv|\n      csv &lt;&lt; fields\n      all.each do |student|\n        csv &lt;&lt; student.attributes.values_at(*fields)\n      end\n    end\nend\n</code></pre>\n\n<p>My students_controller has following:</p>\n\n<pre><code>    def index\n    @students=Student.all\n    puts @students\n    respond_to do |format|\n      format.html\n      format.csv{send_data @students.to_csv(['UIN', 'Name' ,'Section', 'Attempts', 'Score'])}\n    end\n  end\n</code></pre>\n\n<p>I think the all.each statement is empty as when I am doing <code>puts student.attributes.values_at(*fields)</code>, there is nothing so that is why there is nothing being written. But I am not sure how can I fix it.</p>\n\n<pre><code>Student Load (0.3ms)  SELECT \"students\".* FROM \"students\"\n#&lt;Student:0x007f9a2386ddb8&gt;\n#&lt;Student:0x007f9a2386dc78&gt;\n#&lt;Student:0x007f9a2386db38&gt;\n  CACHE Student Load (0.0ms)  SELECT \"students\".* FROM \"students\"\n</code></pre>\n\n<p>Please help</p>\n"}, {"tags": ["ruby", "algorithm", "math"], "comments": [{"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1524461075, "post_id": 49971818, "comment_id": 86963635, "body": "You say, &quot;...such that it always preferences a mapping where all of a given key is &quot;used up.&quot; What do you mean by &quot;preferences&quot;? If there is no mapping where all keys used are &quot;used up&quot;, then what? You really have two questions. The first is to determine if there is such a &quot;used up&quot; mapping, and if so, what it is. The second is what to do if there is no &quot;used up&quot; mapping. I suggest you limit yourself to the first question, but wait, that was answered <a href=\"https://stackoverflow.com/questions/4632322/finding-all-possible-combinations-of-numbers-to-reach-a-given-sum\">here</a>."}], "answers": [{"comments": [{"owner": {"reputation": 3351, "user_id": 2731253, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bf88a5179da66f2e54012dd30b6f31cb?s=128&d=identicon&r=PG&f=1", "display_name": "james", "link": "https://stackoverflow.com/users/2731253/james"}, "edited": false, "score": 0, "creation_date": 1524511784, "post_id": 49972377, "comment_id": 86993580, "body": "oops you&#39;re right it won&#39;t work for 62, I forgot to check presence. have modified the code. i think it&#39;s what will work for my circumstances now, honestly i&#39;m not great at algorithms so it&#39;s hard for me to develop something else"}], "tags": [], "owner": {"reputation": 1617, "user_id": 3759505, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5f238c59fb11459edf83aa27b6adefbe?s=128&d=identicon&r=PG&f=1", "display_name": "hk6279", "link": "https://stackoverflow.com/users/3759505/hk6279"}, "is_accepted": false, "score": 1, "last_activity_date": 1524450343, "last_edit_date": 1524450343, "creation_date": 1524448044, "answer_id": 49972377, "question_id": 49971818, "link": "https://stackoverflow.com/questions/49971818/mapping-whole-numbers-to-constituent-numbers/49972377#49972377", "title": "Mapping whole numbers to constituent numbers", "body": "<p>Simple Answer: Your code will failure on some cases</p>\n\n<hr>\n\n<p>Take <code>amount_processed = 62</code> as an example. A proper solution is {20, 30, 7, 5}, but your code will return {20, 30, 10}</p>\n\n<p>The cause is your original code part will pick the array value if it is smaller then the <code>amount_processed</code> variables and results in picking unnecessary array value.</p>\n\n<hr>\n\n<p>Suggestion: Rethink your logic for the sub-set sum problem instead of reuse the original greedy algorithm</p>\n"}, {"comments": [{"owner": {"reputation": 3351, "user_id": 2731253, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bf88a5179da66f2e54012dd30b6f31cb?s=128&d=identicon&r=PG&f=1", "display_name": "james", "link": "https://stackoverflow.com/users/2731253/james"}, "edited": false, "score": 0, "creation_date": 1524509932, "post_id": 49974028, "comment_id": 86992527, "body": "thanks! this is a great solution and taught me about <code>combination</code> method on array. however it doesn&#39;t work for a situation where amount_processed does NOT add up fully to any combination of the array and a partial amount must be used, also I&#39;d like to find a solution that avoids going through every possible combination, since i worry about efficiency for much larger arrays"}, {"owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "reply_to_user": {"reputation": 3351, "user_id": 2731253, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bf88a5179da66f2e54012dd30b6f31cb?s=128&d=identicon&r=PG&f=1", "display_name": "james", "link": "https://stackoverflow.com/users/2731253/james"}, "edited": false, "score": 0, "creation_date": 1524572183, "post_id": 49974028, "comment_id": 87018860, "body": "Edited, for an error breaking loops. I don&#39;t know how big can be your array, but, you can always choose to stop earlier, for example when <code>(sum - amount_processed).abs &lt;= delta</code>. My code is just a suggestion, not a full solution."}], "tags": [], "owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "is_accepted": false, "score": -1, "last_activity_date": 1524571947, "last_edit_date": 1524571947, "creation_date": 1524461859, "answer_id": 49974028, "question_id": 49971818, "link": "https://stackoverflow.com/questions/49971818/mapping-whole-numbers-to-constituent-numbers/49974028#49974028", "title": "Mapping whole numbers to constituent numbers", "body": "<p>Maybe this is the logic you are looking for?\nIt goes trough all combinations if there is no match and returns an empty array</p>\n\n<pre><code>array = [20, 30, 10, 7, 8, 5]\namount_processed = 65\n\ngo = true\n(array.size + 1).times do |n|\n    combinations = array.combination(n).to_a\n    combinations.each do |combination|\n        sum = combination.inject(0){|sum,x| sum + x }\n        if sum == amount_processed\n            then\n                p combination\n                go = false\n        end\n        break if go == false\n    end\n    break if go == false\nend\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "edited": false, "score": 0, "creation_date": 1524464328, "post_id": 49974294, "comment_id": 86964924, "body": "this guess is really interesting I will dig deeper. I tried some values and it breaks with <code>@amount_processed = 50</code>. I did not check out why yet."}, {"owner": {"reputation": 1088, "user_id": 3236163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f4a825085dda7d9ea059838a3d6dcd7?s=128&d=identicon&r=PG", "display_name": "elyalvarado", "link": "https://stackoverflow.com/users/3236163/elyalvarado"}, "reply_to_user": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "edited": false, "score": 0, "creation_date": 1524464669, "post_id": 49974294, "comment_id": 86965082, "body": "Hey @iGian, that&#39;s right it breaks in some cases. I modified the script and tested with all values. It also now includes an additional value for non exact solution that minimizes the remaining value in the sum vs the amount processed"}, {"owner": {"reputation": 3351, "user_id": 2731253, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bf88a5179da66f2e54012dd30b6f31cb?s=128&d=identicon&r=PG&f=1", "display_name": "james", "link": "https://stackoverflow.com/users/2731253/james"}, "edited": false, "score": 0, "creation_date": 1524511846, "post_id": 49974294, "comment_id": 86993623, "body": "wow! ok to be totally honest this solution goes above my head. I think I found a workable solution and have updated my answer. will need some time to sit down and review your code in detail, because it&#39;s definitely much more of a solution than the hack that i put together!"}, {"owner": {"reputation": 1088, "user_id": 3236163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f4a825085dda7d9ea059838a3d6dcd7?s=128&d=identicon&r=PG", "display_name": "elyalvarado", "link": "https://stackoverflow.com/users/3236163/elyalvarado"}, "reply_to_user": {"reputation": 3351, "user_id": 2731253, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bf88a5179da66f2e54012dd30b6f31cb?s=128&d=identicon&r=PG&f=1", "display_name": "james", "link": "https://stackoverflow.com/users/2731253/james"}, "edited": false, "score": 1, "creation_date": 1524513811, "post_id": 49974294, "comment_id": 86994615, "body": "@james it only really make sense to start removing options from the combination when the array is big and the <code>amount_processed</code> requires also a large number of constituents. But in general, your problem is an NP problem which has no known algorithmic optimal solution, so the best you can do is run combinatorial code and try to see if a solution was found."}, {"owner": {"reputation": 3351, "user_id": 2731253, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bf88a5179da66f2e54012dd30b6f31cb?s=128&d=identicon&r=PG&f=1", "display_name": "james", "link": "https://stackoverflow.com/users/2731253/james"}, "edited": false, "score": 0, "creation_date": 1524514124, "post_id": 49974294, "comment_id": 86994783, "body": "what does NP stand for? thanks for all your insights!"}, {"owner": {"reputation": 1088, "user_id": 3236163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f4a825085dda7d9ea059838a3d6dcd7?s=128&d=identicon&r=PG", "display_name": "elyalvarado", "link": "https://stackoverflow.com/users/3236163/elyalvarado"}, "edited": false, "score": 1, "creation_date": 1524522011, "post_id": 49974294, "comment_id": 86998062, "body": "NP stands for &quot;nondeterministic polynomial time&quot;. You can check the <a href=\"https://en.wikipedia.org/wiki/P_versus_NP_problem\" rel=\"nofollow noreferrer\">wikipedia article for P vs NP</a> which will give you a better (and more correct) explanation that anything I can try to explain you in a comment. If you like my answer please up-vote."}], "tags": [], "owner": {"reputation": 1088, "user_id": 3236163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f4a825085dda7d9ea059838a3d6dcd7?s=128&d=identicon&r=PG", "display_name": "elyalvarado", "link": "https://stackoverflow.com/users/3236163/elyalvarado"}, "is_accepted": false, "score": 0, "last_activity_date": 1524464593, "last_edit_date": 1524464593, "creation_date": 1524463138, "answer_id": 49974294, "question_id": 49971818, "link": "https://stackoverflow.com/questions/49971818/mapping-whole-numbers-to-constituent-numbers/49974294#49974294", "title": "Mapping whole numbers to constituent numbers", "body": "<p>As @iGian pointed out in his answer its possible to find a solution by going trough all the combinations, but sometimes its possible to try to guesstimate the size of the resulting optimal array, so I created the following code which tries to do that in a very naive way:</p>\n\n<pre><code>@amount_processed = 62\n@iterations = 0\n\ndef found_solution given_array\n  puts \"Found a solution\"\n  puts given_array.inspect\n  puts given_array.sum == @amount_processed ? \"Exact solution\" : \"Aproximate solution\"\n  puts \"After #{@iterations} iterations\"\n  exit 0\nend\n\nhash = {}\nsolution = []\narray = [20, 30, 10, 7, 8, 5]\n\nfound_solution(array) if array.sum &lt;= @amount_processed\nfound_solution([array.min]) if array.min &gt;= @amount_processed\n\nmin_size_array = 0\narray.size.times do |i|\n  @iterations += 1\n  min_size_array = i\n  sum_of_maxs = array.max(min_size_array).sum\n  found_solution(array.max(min_size_array)) if sum_of_maxs == @amount_processed\n  break if array.max(min_size_array).sum &gt; @amount_processed\nend\n\nmax_value_array = array.max\nmax_size_array = min_size_array\n(min_size_array..array.size).each do |i|\n  @iterations += 1\n  sum_of_mins = array.min(i).sum\n  found_solution(array.min(i)) if sum_of_mins == @amount_processed\n  break if sum_of_mins &gt; @amount_processed\n  max_size_array = i\nend\n\nmax_value_in_array = array.max\n# Run through all the combinations within the given sizes until a solution is found, including iterations for \n# non exact solutions, which can at most be as much as 'max_value_in_array' away from the amount_processed\n(0..max_value_in_array).each do |difference_to_solution|\n  (min_size_array..max_size_array).each do |size|\n    array.combination(size).each do |current_combination|\n      @iterations += 1\n      if current_combination.sum == (@amount_processed - difference_to_solution)\n        found_solution(current_combination) unless difference_to_solution &gt; 0\n        # There is a difference, so we need to find the min_value that is not in the current_combination\n        # and add it to the approximate solution\n        duplicate_array = array.dup\n        current_combination.each do |x|\n          duplicate_array.slice!(duplicate_array.index(x))\n        end\n        min_value_not_in_current_combination = duplicate_array.min\n        found_solution(current_combination + [min_value_not_in_current_combination])\n      end\n    end\n  end\nend\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "edited": false, "score": 0, "creation_date": 1524571730, "post_id": 49991073, "comment_id": 87018540, "body": "Very smart! I played with your code and I had to stopped the execution trying <code>p solve([20, 30, 10, 7, 8, 5, 20, 30, 10, 7, 8, 5], 100)</code>, as the array grows it takes more time. Of course."}, {"owner": {"reputation": 7565, "user_id": 1021515, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Z9QcP.jpg?s=128&g=1", "display_name": "mwp", "link": "https://stackoverflow.com/users/1021515/mwp"}, "reply_to_user": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "edited": false, "score": 0, "creation_date": 1524595373, "post_id": 49991073, "comment_id": 87034037, "body": "@iGian Wow, yeah, it takes forever just to generate all the permutations."}], "tags": [], "owner": {"reputation": 7565, "user_id": 1021515, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Z9QcP.jpg?s=128&g=1", "display_name": "mwp", "link": "https://stackoverflow.com/users/1021515/mwp"}, "is_accepted": false, "score": 0, "last_activity_date": 1524524466, "creation_date": 1524524466, "answer_id": 49991073, "question_id": 49971818, "link": "https://stackoverflow.com/questions/49971818/mapping-whole-numbers-to-constituent-numbers/49991073#49991073", "title": "Mapping whole numbers to constituent numbers", "body": "<p>Your problem has some similarities to a <a href=\"https://en.wikipedia.org/wiki/Knapsack_problem\" rel=\"nofollow noreferrer\">Knapsack problem</a>, and as others have stated it may not have an optimal algorithmic solution. Your \"fit\" function has some extra requirements that seem to make it even more challenging. Processing the array elements in varying orders may produce more optimal solutions so I think you kind of have to try them all and pick the one that best meets your criteria.</p>\n\n<p>My solution tries all the permutations to brute force the best solution. It takes advantage of Ruby's hash identity (e.g. <code>{ 1=&gt;2, 2=&gt;3 }</code> is equal to <code>{ 2=&gt;3, 1=&gt;2 }</code>) to remove duplicate candidate solutions. I tried to align the fit function to your requirements. </p>\n\n<pre><code>def solve(*args)\n  best_fit(compute_solutions(*args))\nend\n\ndef best_fit(solutions)\n  # prefer unique solutions with no partial values\n  preferred_solutions, alternative_solutions =\n    solutions.uniq.partition { |solution| solution.all? { |k, v| k == v } }\n\n  if preferred_solutions.empty?\n    # prefer unique solutions with \"fullest\" partial values\n    preferred_solutions = alternative_solutions\n      .group_by { |solution| solution.detect { |k, v| v &lt; k and break k } }\n      .min_by(&amp;:first)\n      .last\n  end\n\n  # prefer shortest solution matching above criteria\n  preferred_solutions\n    .group_by(&amp;:length)\n    .min_by(&amp;:first)\n    .last\n    .first\nend\n\ndef compute_solutions(array, *args)\n  return enum_for(__callee__, array, *args).to_a unless block_given?\n\n  array.permutation do |permuted_array|\n    yield compute_solution(permuted_array, *args)\n  end\nend\n\ndef compute_solution(array, amount_processed)\n  return enum_for(__callee__, array, amount_processed).to_h unless block_given?\n\n  array.each do |amount|\n    break if amount_processed.zero?\n    value = [amount, amount_processed].min\n    yield [amount, value]\n    amount_processed -= value\n  end\nend\n\np solve([20, 30, 10, 7, 8, 5], 80) == { 20=&gt;20, 30=&gt;30, 10=&gt;10, 7=&gt;7, 8=&gt;8, 5=&gt;5 } # =&gt; true\np solve([20, 30, 10, 7, 8, 5], 79) == { 20=&gt;20, 30=&gt;30, 10=&gt;10, 7=&gt;7, 8=&gt;8, 5=&gt;4 } # =&gt; true\np solve([20, 30, 10, 7, 8, 5], 65) == { 20=&gt;20, 30=&gt;30, 10=&gt;10, 5=&gt;5 } # =&gt; true\np solve([20, 30, 10, 7, 8, 5], 62) == { 20=&gt;20, 30=&gt;30, 7=&gt;7, 5=&gt;5 } # =&gt; true\np solve([20, 30, 10, 7, 8, 5], 60) == { 20=&gt;20, 30=&gt;30, 10=&gt;10 } # =&gt; true\n</code></pre>\n"}], "owner": {"reputation": 3351, "user_id": 2731253, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bf88a5179da66f2e54012dd30b6f31cb?s=128&d=identicon&r=PG&f=1", "display_name": "james", "link": "https://stackoverflow.com/users/2731253/james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "answer_count": 4, "score": 0, "last_activity_date": 1524571947, "creation_date": 1524441300, "last_edit_date": 1524511737, "question_id": 49971818, "link": "https://stackoverflow.com/questions/49971818/mapping-whole-numbers-to-constituent-numbers", "title": "Mapping whole numbers to constituent numbers", "body": "<p>I have an array of numbers that represent number of times some processing needs to be done some entities:</p>\n\n<pre><code>array = [20, 30, 10, 7, 8, 5]\n</code></pre>\n\n<p>and a number that represents the total number of times processing was actually done:</p>\n\n<pre><code>amount_processed = 80\n</code></pre>\n\n<p>I'd like to build a hash whose keys are the numbers in the array and whose values represent the number of times that was successfully processed of the 80. For instance:</p>\n\n<pre><code>hash = {}\nindex = 0\nuntil amount_processed &lt;= 0 || index == array.count\n  mapped_amount = [array[index],amount_processed].min\n  hash[array[index]] = mapped_amount\n  amount_processed -= mapped_amount\n  index += 1\nend\n</code></pre>\n\n<p>The output in this case would be:</p>\n\n<pre><code>{20 =&gt; 20, 30 =&gt; 30, 10 =&gt; 10, 7 =&gt; 7, 8 =&gt; 8, 5 =&gt; 5}\n</code></pre>\n\n<p>If the <code>amount_processed = 65</code>, I would get: </p>\n\n<pre><code>{20 =&gt; 20, 30 =&gt; 30, 10 =&gt; 10, 7 =&gt; 5}\n</code></pre>\n\n<p>I want to map the <code>amount_processed</code> such that it always preferences a mapping where all of the given keys are used up. For example, for an <code>amount_processed = 65</code>, the output should be: </p>\n\n<pre><code>{20 =&gt; 20, 30 =&gt; 30, 10 =&gt; 10, 5 =&gt; 5} # skipped 7 and 8 entirely\n</code></pre>\n\n<p>Where there are different possible outputs, either is valid, I'm indifferent. I.e., if <code>amount_processed = 60</code>, EITHER of the 2 below would be valid</p>\n\n<pre><code>{20 =&gt; 20, 30 =&gt; 30, 10 =&gt; 10}\n{30 =&gt; 30, 10 =&gt; 10, 7 =&gt; 7, 8 =&gt; 8, 5 =&gt; 5}\n</code></pre>\n\n<p>My code to successfully achieve the above outcomes is below </p>\n\n<pre><code>hash = {}\nindex = 0\nsize = array.size\nuntil amount_processed &lt;= 0\n    if index == size * 2\n        hash[\"notes\"] = \"attempting to go beyond 2nd iteration, i.e., there is still amount_processed left but nothing more in the array to map it to\"\n        return hash\n    elsif index &gt;= size\n    # we've already looped through everything to find something that fully matches, and still have leftover amounts to be mapped, so now start over, and just go in order to fill in whatever's available\n    pseudo_index = index - size # allows us to map to original array once index is on second iteration\n    # was that particular one skipped or not\n    if hash[array[pseudo_index]].present?\n        # it wasn't skipped in earlier go around, so skip it NOW\n    else\n        mapped_amount = [array[pseudo_index],amount_processed].min\n        hash[array[pseudo_index]] = mapped_amount\n        amount_processed -= mapped_amount\n      end\n  else\n    if amount_processed &lt; array[index]\n      # we don't want a partial map, so just don't, unless it's last resort\n    else\n      mapped_amount = [array[index],amount_processed].min\n      hash[array[index]] = mapped_amount\n      amount_processed -= mapped_amount\n    end\n  end\n  index += 1\nend\nreturn hash\n</code></pre>\n\n<p>Will my code always work, for any <code>array/amount_processed</code> combo to create a hash that first matches as many arrays that are \"fully complete\" as and then creates matches that are not fully complete?</p>\n"}, {"tags": ["ruby", "amazon-s3", "aws-sdk", "aws-sdk-ruby", "fog-aws"], "comments": [{"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1524472350, "post_id": 49971790, "comment_id": 86969208, "body": "Can you use <code>wait_for</code> and set a longer timeout?  <a href=\"https://github.com/fog/fog#models\" rel=\"nofollow noreferrer\">github.com/fog/fog#models</a>"}, {"owner": {"reputation": 196, "user_id": 3347828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/drmQg.jpg?s=128&g=1", "display_name": "Will", "link": "https://stackoverflow.com/users/3347828/will"}, "reply_to_user": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1524515691, "post_id": 49971790, "comment_id": 86995528, "body": "It does not seem like I can. The chunk returned is a string type and I get a <code>NoMethodError</code> when performing <code>wait_for</code> on <code>bucket.files</code>. Also if I perform <code>wait_for</code> on the result of <code>get(&#39;file_name.tar.gz&#39;)</code> before the block definition, the script tries to download the entire file first."}], "owner": {"reputation": 196, "user_id": 3347828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/drmQg.jpg?s=128&g=1", "display_name": "Will", "link": "https://stackoverflow.com/users/3347828/will"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 584, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1524580702, "creation_date": 1524440973, "last_edit_date": 1524580702, "question_id": 49971790, "link": "https://stackoverflow.com/questions/49971790/aws-s3-ruby-stream-download-retry-connection-during-chunk-download", "title": "AWS S3 Ruby Stream Download: Retry connection during chunk download", "body": "<p>I was wondering if someone could help me with a streaming download issue I am having?</p>\n\n<p>Currently I have a large GZipped XML file stored in a s3 bucket that I need to download, decompress, and parse daily using ruby. Because of the size of the file I opted to download the large file in chunks and perform the necessary parsing on each of the chunks like so:</p>\n\n<pre><code>module S3Stream\n  def self.call(credentials)\n    Enumerator.new do |yielder|\n      connection = Fog::Storage.new(credentials)\n      bucket = connection.directories.new(key: 'bucket_name')\n\n      bucket.files.get('file_name.tar.gz') do |chunk, remaining_bytes, total_bytes|\n        yielder &lt;&lt; chunk\n      end\n    end\n  end\nend\n</code></pre>\n\n<p>Returning the Enumerator object allows me to process each part of the chunk later in the script (i.e. Unzip and parse the XML contained within)</p>\n\n<p>This all needs to run on a schedule, so I have a detached Heroku dyno running the ruby script for me (my Rails site is deployed to Heroku as well). It runs fine locally, but after about an hour on Heroku (sometimes less depending on the size of the dyno) the script fails with this error message:</p>\n\n<pre><code>Errno::ECONNRESET: Connection reset by peer\n</code></pre>\n\n<p>My issue is that when this fails in the middle of my stream, I am not sure how to retry the download starting at chunk where the connection got reset.</p>\n\n<p>Fog's stream downloading documentation is sparse, and switching to the AWS SDK for Ruby seems to give even less information to the block (i.e. no remaining or total bytes parameters).</p>\n\n<p>Any ideas? Thanks in advance!</p>\n\n<p><strong>UPDATE 1</strong></p>\n\n<p>My most recent attempt, involved keeping track of the byte location of the last chunk worked with (i.e. <code>total_bytes - remaining_bytes</code>) before the connection got reset. Fog allows you to set a custom header in the options parameter of the <code>get</code> method:</p>\n\n<pre><code>  bucket.files.get('file_name.tar.gz', header: {'Range' =&gt; \"bytes=#{@last_byte}-\"}) do |chunk, remaining_bytes, total_bytes|\n    yielder &lt;&lt; chunk\n  end\n</code></pre>\n\n<p>So when the stream got reset I would just try and pick off from where I left off in a new stream by using the HTTP Range header.</p>\n\n<p>However, Fog seemed to ignore this header and after some digging I found that it is not an accepted HTTP header attribute in the <code>fog-aws</code> gem: </p>\n\n<p><a href=\"https://github.com/fog/fog-aws/blob/ab8b720a277712b0d924be74c4db1502692efa44/lib/fog/aws/models/storage/file.rb#L12-L27\" rel=\"nofollow noreferrer\">https://github.com/fog/fog-aws/blob/ab8b720a277712b0d924be74c4db1502692efa44/lib/fog/aws/models/storage/file.rb#L12-L27</a></p>\n\n<p>Next, I will attempt to perform these same steps but with the <code>aws-sdk</code> gem, which looks like it supports the HTTP Range header</p>\n"}, {"tags": ["ruby", "oop"], "comments": [{"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 1, "creation_date": 1524440918, "post_id": 49971753, "comment_id": 86959411, "body": "In your example, <code>Board</code> never talks back to <code>Game</code>. What are you asking?"}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1524471033, "post_id": 49971753, "comment_id": 86968481, "body": "<i>&quot;Passing the Board class object into another classes&#39; initialize feels odd or wrong&quot;</i> \u2013 you pass an instance, not a class."}, {"owner": {"reputation": 1823, "user_id": 5065860, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/faadf161352c9fca88a34c8f05103185?s=128&d=identicon&r=PG&f=1", "display_name": "msmith1114", "link": "https://stackoverflow.com/users/5065860/msmith1114"}, "edited": false, "score": 0, "creation_date": 1524487960, "post_id": 49971753, "comment_id": 86979256, "body": "Sorry that&#39;s what I meant. However honestly in my example it probably makes more sense to call Board.new within&#39;s Game Initialize example as opposed to outside of it."}], "answers": [{"comments": [{"owner": {"reputation": 1823, "user_id": 5065860, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/faadf161352c9fca88a34c8f05103185?s=128&d=identicon&r=PG&f=1", "display_name": "msmith1114", "link": "https://stackoverflow.com/users/5065860/msmith1114"}, "edited": false, "score": 0, "creation_date": 1524488163, "post_id": 49971840, "comment_id": 86979401, "body": "Yeah I think you are correct, i&#39;ll probably change it to where <code>Board.new</code> is called on Game&#39;s initialize. Is that a normal thing to do I guess? It just feels odd...but makes sense"}, {"owner": {"reputation": 38092, "user_id": 18706, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cabf735ce7b8b4471ef46ea54f71832d?s=128&d=identicon&r=PG", "display_name": "mahemoff", "link": "https://stackoverflow.com/users/18706/mahemoff"}, "reply_to_user": {"reputation": 1823, "user_id": 5065860, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/faadf161352c9fca88a34c8f05103185?s=128&d=identicon&r=PG&f=1", "display_name": "msmith1114", "link": "https://stackoverflow.com/users/5065860/msmith1114"}, "edited": false, "score": 0, "creation_date": 1524609335, "post_id": 49971840, "comment_id": 87039662, "body": "It&#39;s fine. Very normal for an object to create an instance of another class especially when it&#39;s a child relationship. Always should be cautious to  introducing any class-class relationship, to justify its existence, but <i>some</i> relationships are essential."}], "tags": [], "owner": {"reputation": 38092, "user_id": 18706, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cabf735ce7b8b4471ef46ea54f71832d?s=128&d=identicon&r=PG", "display_name": "mahemoff", "link": "https://stackoverflow.com/users/18706/mahemoff"}, "is_accepted": true, "score": 2, "last_activity_date": 1524441550, "creation_date": 1524441550, "answer_id": 49971840, "question_id": 49971753, "link": "https://stackoverflow.com/questions/49971753/using-class-objects-in-other-classes/49971840#49971840", "title": "Using class objects in other classes", "body": "<p>The question of where to initialize objects is one experienced developers will argue about endlessly.</p>\n\n<p>Something to consider is lifecycle and \"ownership\". In this case, the board object may be considered to have a \"strong child relationship\" with the game, because it lives and dies with the game. From an external perspective, it's not even clear there needs to be a \"board\" at all - it could be entirely encapsulated by the game ... but the board is being used simply to \"de-compose\" the game into parts (other parts might include pieces on the board, or the score, for example).</p>\n\n<p>For that reason, there's a good arugment for creating the board inside the game constructor. The constructor could still contain a \"board spec\" object or board parameters if you wanted to give some flexibility (e.g. board_size), but the game itself can be completely responsible for creating and destroying the board.</p>\n\n<p>Others would still argue it's better to pass the board object in (as in your example) for the sake of simplicity and flexibility. See? There's never one answer. Your best bet as a student is experimenting with different models and learn about their strengths and weaknesses in practice. And familiairize yourself with <a href=\"https://en.wikipedia.org/wiki/You_aren%27t_gonna_need_it\" rel=\"nofollow noreferrer\">YAGNI</a> because thinking in practical terms is often the best way out of these academic debates.</p>\n"}], "owner": {"reputation": 1823, "user_id": 5065860, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/faadf161352c9fca88a34c8f05103185?s=128&d=identicon&r=PG&f=1", "display_name": "msmith1114", "link": "https://stackoverflow.com/users/5065860/msmith1114"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 49971840, "answer_count": 1, "score": 0, "last_activity_date": 1524463417, "creation_date": 1524440676, "last_edit_date": 1524463417, "question_id": 49971753, "link": "https://stackoverflow.com/questions/49971753/using-class-objects-in-other-classes", "title": "Using class objects in other classes", "body": "<p>I am doing a tic tac toe from <em>The Odin Project</em>. I have two classes: <code>Board</code> (which contains the board, which contains all the individual \"X\" and \"O\"), and <code>Game</code>, which starts the game, keeps track of which round, check wins/etc. I am not doing any A.I. stuff.</p>\n\n<p>I have my basic framework set up:</p>\n\n<pre><code>class Board\n  attr_accessor :board\n\n  def initialize\n    @board = Array.new(3, Array.new(3, 'X'))\n  end\n\n  def display_board\n    @board.each.with_index do |row, i|\n      row.each.with_index do |column, j|\n        print \"|#{i}#{j}|\"\n      end\n      puts\n    end\n  end\nend\n\nclass Game\n  def initialize(player1, player2, board)\n    @board = board\n    @player1 = player1\n    @player2 = player2\n  end\n\n  def check_board\n    if @board.board[0][0] &amp;&amp; @board.board[1][1] &amp;&amp; @board.board[2][2]\n      puts \"Winner!\"\n    end\n  end\nend\n\nboard = Board.new\ngame = Game.new('X', 'O', board)\ngame.check_board\n</code></pre>\n\n<p>The <code>Board</code> and <code>Game</code> need to talk to each other. Passing the <code>Board</code> class object into another classes' <code>initialize</code> feels odd or wrong. But I don't know if there is a better way to have classes talking to each other or one class having another class stored in it's variable.</p>\n\n<p>Is this the right way to go about this? What is the best way to keep classes separate but also talk to each other? Should I initialize both objects outside and let them talk to each other that way? Or initialize one in the other class, and let that class do all the heavy lifting?</p>\n"}, {"tags": ["ruby", "immutability"], "answers": [{"comments": [{"owner": {"reputation": 24197, "user_id": 378622, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/dc643a4278351110aac11e097854161f?s=128&d=identicon&r=PG", "display_name": "bgcode", "link": "https://stackoverflow.com/users/378622/bgcode"}, "edited": false, "score": 0, "creation_date": 1524439645, "post_id": 49971559, "comment_id": 86959165, "body": "Surprised there&#39;s not a method for just taking a key"}, {"owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "reply_to_user": {"reputation": 24197, "user_id": 378622, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/dc643a4278351110aac11e097854161f?s=128&d=identicon&r=PG", "display_name": "bgcode", "link": "https://stackoverflow.com/users/378622/bgcode"}, "edited": false, "score": 1, "creation_date": 1524441589, "post_id": 49971559, "comment_id": 86959531, "body": "What do you mean @babonk? similar to what <a href=\"http://api.rubyonrails.org/classes/Hash.html#method-i-except\" rel=\"nofollow noreferrer\">except</a> does?"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "reply_to_user": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 1, "creation_date": 1524442196, "post_id": 49971559, "comment_id": 86959638, "body": "@SebastianPalma, ah a Rails method."}], "tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": true, "score": 4, "last_activity_date": 1524438340, "creation_date": 1524438340, "answer_id": 49971559, "question_id": 49971541, "link": "https://stackoverflow.com/questions/49971541/immutable-alternative-to-delete-in-ruby/49971559#49971559", "title": "Immutable alternative to `delete` in Ruby", "body": "<p>Use <a href=\"http://ruby-doc.org/core-2.4.0/Hash.html#method-i-reject\" rel=\"nofollow noreferrer\">Hash#reject</a>.</p>\n\n<pre><code>hash.reject { |k,_| k == :a }\n  #=&gt; {}\nhash\n  #=&gt; {:a=&gt;1}\n</code></pre>\n\n<p>This of course does not depend on the hash having a single key-value pair.</p>\n"}], "owner": {"reputation": 24197, "user_id": 378622, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/dc643a4278351110aac11e097854161f?s=128&d=identicon&r=PG", "display_name": "bgcode", "link": "https://stackoverflow.com/users/378622/bgcode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 467, "favorite_count": 0, "accepted_answer_id": 49971559, "answer_count": 1, "score": 1, "last_activity_date": 1524460944, "creation_date": 1524438089, "last_edit_date": 1524460944, "question_id": 49971541, "link": "https://stackoverflow.com/questions/49971541/immutable-alternative-to-delete-in-ruby", "title": "Immutable alternative to `delete` in Ruby", "body": "<p>Is there a version of <code>Hash#delete</code> as below:</p>\n\n<pre><code>hash = {a: 1}\nhash.delete(:a) # =&gt; 1\nhash # =&gt; {}\n</code></pre>\n\n<p>that returns a hash without <code>:a</code>, without mutating the original hash so that it would have its original value?</p>\n"}, {"tags": ["ruby", "web-scraping"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 9683301, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "john zhang", "link": "https://stackoverflow.com/users/9683301/john-zhang"}, "edited": false, "score": 0, "creation_date": 1524440033, "post_id": 49971635, "comment_id": 86959248, "body": "When you say &quot;simple webscraping&quot; what do you mean by that? Wheres a good place to start?"}], "tags": [], "owner": {"reputation": 2946, "user_id": 1430057, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/Tbizp.jpg?s=128&g=1", "display_name": "Subash", "link": "https://stackoverflow.com/users/1430057/subash"}, "is_accepted": false, "score": 0, "last_activity_date": 1524440618, "last_edit_date": 1524440618, "creation_date": 1524439226, "answer_id": 49971635, "question_id": 49971488, "link": "https://stackoverflow.com/questions/49971488/how-to-get-tumblr-trending-through-ruby-api/49971635#49971635", "title": "How to get Tumblr trending through Ruby API?", "body": "<p>There is a ruby gem for the tumbler API</p>\n\n<p><a href=\"https://github.com/tumblr/tumblr_client\" rel=\"nofollow noreferrer\">https://github.com/tumblr/tumblr_client</a></p>\n\n<p>and you can find the Tumblr posts API documentation <a href=\"https://www.tumblr.com/docs/en/api/v2#posts\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>but I had a quick look and couldn't find a endpoint to fetch posts from trending page but have a look and maybe you can find a way to get it from there or if all else fails, you can even try some simple web-scraping.</p>\n\n<p>Web Scraping means going through a web page to fetch contents that you need, there should be examples on how to do it in ruby,</p>\n\n<p><a href=\"https://morph.io/\" rel=\"nofollow noreferrer\">https://morph.io/</a> seems like a good one but I haven't tried it out so I'm not sure how easy is it to use.</p>\n\n<p>These are some tutorials to help you get started using <code>nokogiri</code></p>\n\n<p><a href=\"https://www.distilled.net/resources/web-scraping-with-ruby-and-nokogiri-for-beginners/\" rel=\"nofollow noreferrer\">https://www.distilled.net/resources/web-scraping-with-ruby-and-nokogiri-for-beginners/</a>\n<a href=\"https://www.promptcloud.com/blog/web-scraping-using-ruby\" rel=\"nofollow noreferrer\">https://www.promptcloud.com/blog/web-scraping-using-ruby</a></p>\n"}], "owner": {"reputation": 21, "user_id": 9683301, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "john zhang", "link": "https://stackoverflow.com/users/9683301/john-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 154, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524440618, "creation_date": 1524437564, "question_id": 49971488, "link": "https://stackoverflow.com/questions/49971488/how-to-get-tumblr-trending-through-ruby-api", "title": "How to get Tumblr trending through Ruby API?", "body": "<p>This was asked but never ever answered. I'm using Ruby and I want to get the URLs/details of posts from the trending page \"<a href=\"https://www.tumblr.com/explore/trending\" rel=\"nofollow noreferrer\">https://www.tumblr.com/explore/trending</a>\"</p>\n"}]