[{"tags": ["ruby", "windows", "active-directory", "saml", "omniauth"], "answers": [{"tags": [], "owner": {"reputation": 1962, "user_id": 2945616, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/TL0yY.jpg?s=128&g=1", "display_name": "Atul Khanduri", "link": "https://stackoverflow.com/users/2945616/atul-khanduri"}, "is_accepted": true, "score": 0, "last_activity_date": 1535489215, "creation_date": 1535489215, "answer_id": 52065990, "question_id": 51974291, "link": "https://stackoverflow.com/questions/51974291/login-page-for-active-directory/52065990#52065990", "title": "Login page for Active Directory", "body": "<p>Atlast, we've used Active Directory Federation Services (ADFS) for setting up the IDP which provides the login page and authenticate the user by using the configured user credentials in Active Directory.</p>\n"}], "owner": {"reputation": 1962, "user_id": 2945616, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/TL0yY.jpg?s=128&g=1", "display_name": "Atul Khanduri", "link": "https://stackoverflow.com/users/2945616/atul-khanduri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 52065990, "answer_count": 1, "score": 0, "last_activity_date": 1535489215, "creation_date": 1534968134, "question_id": 51974291, "link": "https://stackoverflow.com/questions/51974291/login-page-for-active-directory", "title": "Login page for Active Directory", "body": "<p><strong>Requirement:</strong> I've a Ruby on Rails application named as \"RoR App\", for instance. Several different clients have their own Active Directory and when a user hits a particular URL in the \"RoR App\" then the control will be redirected to the client's login page where user will provide their AD credentials.</p>\n\n<p>Once authenticated, a callback will be called to the \"RoR App\" where a user's session be created.</p>\n\n<p><strong>Work Done:</strong> So far, I'm able to use <a href=\"https://github.com/omniauth/omniauth-saml\" rel=\"nofollow noreferrer\"><code>omniauth-saml</code></a> gem to redirect to some URL (will be client's login page later) when a user enters a particular URL in \"RoR App\" using SAML.</p>\n\n<p><strong>Questions:</strong></p>\n\n<p>For testing purpose, do I need to create a login page in some technology (RoR, PRP etc), which will work as client's (IDP) login page. And when the user provide their credentials then I've to write some code in backend to authenticate with active directory?</p>\n\n<p><strong>OR</strong></p>\n\n<p>Does AD or windows provides some self-managed login page which can be created (after some configuration) and performed authentication process itself?</p>\n\n<p><em>I'm new to Active Directory, so sorry it might be some obvious question.</em></p>\n"}, {"tags": ["ruby", "string", "date", "time", "format"], "comments": [{"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 1, "creation_date": 1534964566, "post_id": 51973285, "comment_id": 90897443, "body": "Ben, when you give an example make sure everything is a valid Ruby object (e.g.,  <code>&quot;2018-08-17&quot;</code> rather than <code>2018-08-17</code>, even though you state that the latter is a string) and assign a variable to each input object (I&#39;ve edited to add the variable <code>date_str</code>), so that readers can refer to such variables in answers and comments without having to define them. Keep in mind that readers will cut-and-paste your code, so you don&#39;t want them to have to add quotes, etc."}], "answers": [{"comments": [{"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 5, "creation_date": 1534965175, "post_id": 51973391, "comment_id": 90897715, "body": "You may wish to include <code>require &#39;date&#39;</code>, as this is pure Ruby. <code>strptime</code> is much preferrable to the lazy coder&#39;s fallback: <a href=\"http://ruby-doc.org/stdlib-2.5.1/libdoc/date/rdoc/Date.html#method-c-parse\" rel=\"nofollow noreferrer\">Date::parse</a>, as in <code>require &#39;date&#39;; Date.parse(&quot;Theresa May had a rough week&quot;) #=&gt; =&gt; #&lt;Date: 2018-05-01 ((2458240j,0s,0n),+0s,2299161j)&gt;</code>."}], "tags": [], "owner": {"reputation": 109029, "user_id": 2767755, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/BkC8q.jpg?s=128&g=1", "display_name": "Arup Rakshit", "link": "https://stackoverflow.com/users/2767755/arup-rakshit"}, "is_accepted": true, "score": 6, "last_activity_date": 1535007675, "last_edit_date": 1535007675, "creation_date": 1534963910, "answer_id": 51973391, "question_id": 51973285, "link": "https://stackoverflow.com/questions/51973285/format-date-in-ruby/51973391#51973391", "title": "Format Date in Ruby", "body": "<p>Use <a href=\"https://ruby-doc.org/stdlib-2.3.1/libdoc/date/rdoc/Date.html#method-c-strptime\" rel=\"nofollow noreferrer\"><code>::strptime</code></a> to convert the string to date object, and then convert it to string again with <a href=\"https://ruby-doc.org/stdlib-2.3.1/libdoc/date/rdoc/Date.html#method-i-strftime\" rel=\"nofollow noreferrer\"><code>#strftime</code></a> method.</p>\n\n<pre><code>require 'date'\nDate.strptime('2018-08-17', '%Y-%m-%d').strftime(\"%d/%m/%Y\")\n# =&gt; \"17/08/2018\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 197942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yqFWR.jpg?s=128&g=1", "display_name": "vishnugopal", "link": "https://stackoverflow.com/users/197942/vishnugopal"}, "is_accepted": false, "score": 0, "last_activity_date": 1535009787, "creation_date": 1535009787, "answer_id": 51980577, "question_id": 51973285, "link": "https://stackoverflow.com/questions/51973285/format-date-in-ruby/51980577#51980577", "title": "Format Date in Ruby", "body": "<p>Chronic (<a href=\"https://github.com/mojombo/chronic\" rel=\"nofollow noreferrer\">https://github.com/mojombo/chronic</a>) is a good gem for parsing date/time in any format, including human readable ones.</p>\n\n<pre><code>require 'chronic' \nChronic.parse(\"2018-08-17\")\n</code></pre>\n\n<p>The nice thing about Chronic is that you can parse even human readable times, like \"tomorrow\", or \"next month\".</p>\n\n<pre><code>Chronic.parse('tomorrow')\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 9922107, "user_type": "registered", "profile_image": "https://graph.facebook.com/1936279556385275/picture?type=large", "display_name": "Ben Harvie", "link": "https://stackoverflow.com/users/9922107/ben-harvie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 51973391, "answer_count": 2, "score": 0, "last_activity_date": 1535009787, "creation_date": 1534963473, "last_edit_date": 1535005994, "question_id": 51973285, "link": "https://stackoverflow.com/questions/51973285/format-date-in-ruby", "title": "Format Date in Ruby", "body": "<p>I have a date returned as a string:</p>\n\n<pre><code>date_str = \"2018-08-17\"\n</code></pre>\n\n<p>How would I format this in to another standard date format, eg. 17/08/2018 programatically without having to parse the string manually?</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 716, "user_id": 3507206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/848870b4043d5ca319aa3111cb55845b?s=128&d=identicon&r=PG", "display_name": "tejasbubane", "link": "https://stackoverflow.com/users/3507206/tejasbubane"}, "edited": false, "score": 0, "creation_date": 1534962362, "post_id": 51972718, "comment_id": 90896447, "body": "You need to make the <code>CommentController</code> inherit from <code>ApplicationController</code> and not <code>ActionController::Base</code> for that to work."}], "answers": [{"tags": [], "owner": {"reputation": 4690, "user_id": 1937435, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YyN37.jpg?s=128&g=1", "display_name": "Josh Brody", "link": "https://stackoverflow.com/users/1937435/josh-brody"}, "is_accepted": true, "score": 3, "last_activity_date": 1534962142, "creation_date": 1534962142, "answer_id": 51972975, "question_id": 51972718, "link": "https://stackoverflow.com/questions/51972718/rails-5-2-cannot-access-calling-controller-method-from-within-respond-to-block/51972975#51972975", "title": "Rails 5.2- Cannot access calling controller method from within respond_to block", "body": "<blockquote>\n  <p>My question is this: looking at the above code, is there a better, more flexible way to obtain the calling controller method?</p>\n</blockquote>\n\n<p><code>controller_name</code> will return <code>name.demodulize.sub(/Controller$/, '').underscore</code> which is probably want you want. I've never seen someone need to use caller_location. Similarly there's <code>action_name</code></p>\n\n<p>There's also <code>params[:controller]</code> and <code>params[:action]</code></p>\n"}], "owner": {"reputation": 933, "user_id": 1789778, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/4c34161514d6b9dbe70e566179f47e7f?s=128&d=identicon&r=PG", "display_name": "greyoxide", "link": "https://stackoverflow.com/users/1789778/greyoxide"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 51972975, "answer_count": 1, "score": 0, "last_activity_date": 1534962142, "creation_date": 1534961094, "question_id": 51972718, "link": "https://stackoverflow.com/questions/51972718/rails-5-2-cannot-access-calling-controller-method-from-within-respond-to-block", "title": "Rails 5.2- Cannot access calling controller method from within respond_to block", "body": "<p>I have this method in my application controller which renders the view template for the corresponding user type.</p>\n\n<pre><code>class ApplicationController &lt; ActionController::Base\n  def render_for_user\n    view = caller_locations.first.label\n    if current_user.blank?\n      render \"#{view}_guest\"\n    else\n      render \"#{view}_#{current_user.role.downcase}\"\n    end\n  end\nend\n</code></pre>\n\n<p>And I call this method in the following fashion:</p>\n\n<pre><code>Class CommentController &lt; ActionController::Base\n  def show\n    @comment = Comment.find(params[:id])\n    render_for_user\n  end\nend\n</code></pre>\n\n<p>Where I run into trouble, is calling this method from inside of a <code>respond_to</code> block. Here is an example:</p>\n\n<pre><code>Class CommentController &lt; ActionController::Base\n  def show\n    @comment = Comment.find(params[:id])\n    respond_to do |format|\n      format.js\n      format.html { render_for_user }\n    end\n  end\nend\n</code></pre>\n\n<p>Since the controller method in the application controller just fetches the name of the calling method one step up, it's defeated by the respond_to block.</p>\n\n<p>My question is this: looking at the above code, is there a better, more flexible way to obtain the calling controller method?</p>\n"}, {"tags": ["sql", "ruby", "algorithm"], "comments": [{"owner": {"reputation": 18079, "user_id": 503402, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/873ad707fb34aac8fbdfbfec676e02e9?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/503402/max"}, "edited": false, "score": 0, "creation_date": 1534972109, "post_id": 51972220, "comment_id": 90900737, "body": "I&#39;m not sure what you mean by &quot;I can&#39;t use native parser&quot;. What&#39;s to stop you from downloading a robust parsing gem (like <a href=\"https://github.com/cjheath/treetop\" rel=\"nofollow noreferrer\">Treetop</a>) and copying it to whatever env it&#39;s needed on?"}, {"owner": {"reputation": 419, "user_id": 10242281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff314354a9784604814f64f822c1589e?s=128&d=identicon&r=PG&f=1", "display_name": "Mich28 ", "link": "https://stackoverflow.com/users/10242281/mich28"}, "reply_to_user": {"reputation": 18079, "user_id": 503402, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/873ad707fb34aac8fbdfbfec676e02e9?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/503402/max"}, "edited": false, "score": 0, "creation_date": 1534975446, "post_id": 51972220, "comment_id": 90901986, "body": "Tx Max, I&#39;ll check Treetop ,   * I meant native MS SQL Parser in C#. D"}, {"owner": {"reputation": 419, "user_id": 10242281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff314354a9784604814f64f822c1589e?s=128&d=identicon&r=PG&f=1", "display_name": "Mich28 ", "link": "https://stackoverflow.com/users/10242281/mich28"}, "reply_to_user": {"reputation": 18079, "user_id": 503402, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/873ad707fb34aac8fbdfbfec676e02e9?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/503402/max"}, "edited": false, "score": 0, "creation_date": 1534976549, "post_id": 51972220, "comment_id": 90902302, "body": "Tx again Max, it&#39;s new universe for me, never worked with gems. Best.M"}, {"owner": {"reputation": 419, "user_id": 10242281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff314354a9784604814f64f822c1589e?s=128&d=identicon&r=PG&f=1", "display_name": "Mich28 ", "link": "https://stackoverflow.com/users/10242281/mich28"}, "reply_to_user": {"reputation": 18079, "user_id": 503402, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/873ad707fb34aac8fbdfbfec676e02e9?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/503402/max"}, "edited": false, "score": 0, "creation_date": 1534988649, "post_id": 51972220, "comment_id": 90904617, "body": "I&#39;ve checked github and other examples I found on <a href=\"http://thingsaaronmade.com/blog/a-quick-intro-to-writing-a-parser-using-treetop.html\" rel=\"nofollow noreferrer\">thingsaaronmade.com/blog/&hellip;</a>  . Too much pieces to get a clear picture, I still not sure if it will work for my case, if I need let say find all active  occurrences of sql commands (*disregarding comments) in   MS SQL sp. Will this work ? Tx"}, {"owner": {"reputation": 419, "user_id": 10242281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff314354a9784604814f64f822c1589e?s=128&d=identicon&r=PG&f=1", "display_name": "Mich28 ", "link": "https://stackoverflow.com/users/10242281/mich28"}, "reply_to_user": {"reputation": 18079, "user_id": 503402, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/873ad707fb34aac8fbdfbfec676e02e9?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/503402/max"}, "edited": false, "score": 0, "creation_date": 1534988904, "post_id": 51972220, "comment_id": 90904665, "body": "I can see it works only for S-Expressions, and SQL is sp is not one."}, {"owner": {"reputation": 419, "user_id": 10242281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff314354a9784604814f64f822c1589e?s=128&d=identicon&r=PG&f=1", "display_name": "Mich28 ", "link": "https://stackoverflow.com/users/10242281/mich28"}, "reply_to_user": {"reputation": 18079, "user_id": 503402, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/873ad707fb34aac8fbdfbfec676e02e9?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/503402/max"}, "edited": false, "score": 0, "creation_date": 1534993800, "post_id": 51972220, "comment_id": 90905490, "body": "Si, I see that this will be too much for my case,  Tx all for hlep"}], "owner": {"reputation": 419, "user_id": 10242281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff314354a9784604814f64f822c1589e?s=128&d=identicon&r=PG&f=1", "display_name": "Mich28 ", "link": "https://stackoverflow.com/users/10242281/mich28"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 29, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1534961175, "creation_date": 1534958911, "last_edit_date": 1534961175, "question_id": 51972220, "link": "https://stackoverflow.com/questions/51972220/ruby-or-tsql-how-to-find-match-matching-pairs-of-comments-block", "title": "Ruby or TSQL how to Find / Match matching pairs of comments block", "body": "<p>I work on task how to mark  comments in old code (SQL, BXML, Json) so later I can use this info for parsing.  This is not my own env, so can't use native parsers alas, so I come up with this matrix approach, like in pic, the only thing left is to find how better find those  Start-End comments blocks, I create a script to fill this table to use.  I just hope that somebody knows how do it easy and flex, same way when you stay on parenthesis in NotePad ++  you can see matching pair.</p>\n\n<p>I can use Ruby or SQL for that, I tried couple of paths but can't catch all cases yet. I plan to use offset index from start of the file, like Index = (line*100+pos) and then find next avail matching pair.<br>\nAppreciate your ideas</p>\n\n<pre><code>code line01\n/*  comment01  */\ncode \nline02\n  /*   comment02\n       comment03\n          /*   comment04  \n          */  \n   */\n</code></pre>\n\n<p>which can be presented in this matrix\n<a href=\"https://i.stack.imgur.com/moqTX.png\" rel=\"nofollow noreferrer\">ScreenShot of matrix</a>\n* same for paste/copy</p>\n\n<pre><code>Char    Flag    Line    Pos Index   LineCont\n/*  CommStart   2   1   201 /*  comment01  */\n*/  CommEnd 2   16  216 /*  comment01  */\n/*  CommStart   5   3   503   /*   comment02\n/*  CommStart   7   11  711           /*   comment04 \n*/  CommEnd 8   11  811 */\n*/  CommEnd 9   4   904 */\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "activerecord", "ruby-on-rails-5", "has-and-belongs-to-many"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "reply_to_user": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 0, "creation_date": 1535025400, "post_id": 51972186, "comment_id": 90919820, "body": "@JagdeepSingh The question is currently when modules and courses are being completed by one user. It&#39;s applying to all users, which is incorrect. So is there a way to sort of separate per user if something is complete or not?"}, {"owner": {"reputation": 32131, "user_id": 2346461, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/i3xAf.jpg?s=128&g=1", "display_name": "Pavan", "link": "https://stackoverflow.com/users/2346461/pavan"}, "edited": false, "score": 0, "creation_date": 1536758565, "post_id": 51972186, "comment_id": 91540312, "body": "What is the current problem you are facing? Do you still getting the same error?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "reply_to_user": {"reputation": 32131, "user_id": 2346461, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/i3xAf.jpg?s=128&g=1", "display_name": "Pavan", "link": "https://stackoverflow.com/users/2346461/pavan"}, "edited": false, "score": 0, "creation_date": 1536759173, "post_id": 51972186, "comment_id": 91540736, "body": "@Pavan So I&#39;ve currently tried to implement Jagdeep&#39;s solution so I can have users complete course modules (and only that user), however, whilst implementing it, the completing functionality are now failing and I can no longer complete modules."}, {"owner": {"reputation": 32131, "user_id": 2346461, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/i3xAf.jpg?s=128&g=1", "display_name": "Pavan", "link": "https://stackoverflow.com/users/2346461/pavan"}, "edited": false, "score": 0, "creation_date": 1536759316, "post_id": 51972186, "comment_id": 91540841, "body": "So, did it fail with that error you have mentioned in the question, right?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "reply_to_user": {"reputation": 32131, "user_id": 2346461, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/i3xAf.jpg?s=128&g=1", "display_name": "Pavan", "link": "https://stackoverflow.com/users/2346461/pavan"}, "edited": false, "score": 0, "creation_date": 1536759866, "post_id": 51972186, "comment_id": 91541205, "body": "Correct @Pavan but I&#39;m sure further errors will follow once this one has been fixed."}, {"owner": {"reputation": 32131, "user_id": 2346461, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/i3xAf.jpg?s=128&g=1", "display_name": "Pavan", "link": "https://stackoverflow.com/users/2346461/pavan"}, "edited": false, "score": 0, "creation_date": 1536759927, "post_id": 51972186, "comment_id": 91541247, "body": "Ok, Can update the question with show action of courses_controller?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "reply_to_user": {"reputation": 32131, "user_id": 2346461, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/i3xAf.jpg?s=128&g=1", "display_name": "Pavan", "link": "https://stackoverflow.com/users/2346461/pavan"}, "edited": false, "score": 0, "creation_date": 1536760159, "post_id": 51972186, "comment_id": 91541390, "body": "@Pavan Ok I&#39;ve updated the question."}, {"owner": {"reputation": 1233, "user_id": 7960859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tyaFp.png?s=128&g=1", "display_name": "obermillerk", "link": "https://stackoverflow.com/users/7960859/obermillerk"}, "edited": false, "score": 0, "creation_date": 1537362349, "post_id": 51972186, "comment_id": 91756863, "body": "You&#39;re getting undefined method errors, so you need to define that method in course module model. But that&#39;s not really the solution to what you want. The thing is, you really want to decouple the concept of completion from your course and course module models. A course cannot be completed itself, a user must complete a course. This means you need another relationship, as Jagdeep pointed out. So really what you need is a way to check if course module user or course user has completed the course/module, and then check those where applicable."}], "answers": [{"comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1535045535, "post_id": 51985777, "comment_id": 90932277, "body": "just from a naming standpoint I think <code>UserCourse</code> and <code>UserCourseModule</code> might make more sense and associating a <code>User</code> to the <code>UserCourseModules</code> through the <code>UserCourse</code> to make maintaining relational integrity easier."}, {"owner": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1535087677, "post_id": 51985777, "comment_id": 90944846, "body": "I don&#39;t know what naming conventions rails uses nowadays, earlier the join table was named alphabetically sorted e.g. <i>aaas_bbbs</i>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "edited": false, "score": 0, "creation_date": 1536756950, "post_id": 51985777, "comment_id": 91539114, "body": "@JagdeepSingh Ok so I&#39;ve given this a shot, I&#39;ve updated the question with the changes I have done so far."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "edited": false, "score": 0, "creation_date": 1536836757, "post_id": 51985777, "comment_id": 91571610, "body": "Hey @JagdeepSingh so I have the database and queries set up in using the rails console. However, how would I set these in the view? So when a user buys the course it assigns the course to the user and same goes when the module is ticked off in the browser."}], "tags": [], "owner": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "is_accepted": false, "score": 0, "last_activity_date": 1535027162, "creation_date": 1535027162, "answer_id": 51985777, "question_id": 51972186, "link": "https://stackoverflow.com/questions/51972186/complete-course-and-modules-using-rails-5-assign-to-user/51985777#51985777", "title": "Complete course and modules using Rails 5 assign to user", "body": "<p>You will need to create new tables <em>courses_users</em> and <em>course_modules_users</em> to distinguish between courses/course_modules of different users.</p>\n\n<p>Remove field <code>complete</code> from tables <em>courses</em> and <em>course_modules</em>. We don't want to mark a course/course_module as completed globally. See <a href=\"https://edgeguides.rubyonrails.org/active_record_migrations.html#writing-a-migration\" rel=\"nofollow noreferrer\">this</a> for how to use migrations to do that.</p>\n\n<p>Further, define <a href=\"https://guides.rubyonrails.org/association_basics.html#the-has-many-through-association\" rel=\"nofollow noreferrer\">has_many :through</a> associations between users and course/course_modules as below:</p>\n\n<pre><code>class User &lt; ApplicationRecord\n  has_many :courses_users\n  has_many :courses, through: :courses_users\n\n  has_many :course_modules_users\n  has_many :course_modules, through: :course_modules_users\nend\n\nclass Course &lt; ApplicationRecord\n  has_many :course_modules\nend\n\nclass CoursesUser &lt; ApplicationRecord\n  # Fields:\n  #   :course_id\n  #   :user_id\n  #   :complete\n\n  belongs_to :course\n  belongs_to :user\nend\n\nclass CourseModule &lt; ApplicationRecord\n  belongs_to :course\nend\n\nclass CourseModulesUser &lt; ApplicationRecord\n  # Fields:\n  #   :course_module_id\n  #   :user_id\n  #   :complete\n\n  belongs_to :course_module\n  belongs_to :user\nend\n</code></pre>\n\n<p>Now, the queries can be made this way:</p>\n\n<pre><code>Course.all\n =&gt; All courses\n\nCourse.find(1).course_modules\n =&gt; All course modules of a course\n\nuser = User.find(1)\ncourse = Course.find(1)\n\n# Assign `course` to `user`\nuser.courses_users.create(course_id: course.id)\n\nuser.courses\n =&gt; [course]\n\ncourse_module = CourseModule.find(1)\n\n# Assign `course_module` to `user`\nuser.course_modules_users.create(course_module_id: course_module.id)\n\nuser.course_modules\n =&gt; [course_module]\n</code></pre>\n\n<p>Now, to mark a course module complete for a user, do this:</p>\n\n<pre><code>class User &lt; ApplicationRecord\n  def mark_course_module_complete!(course_module)\n    self.course_modules_users\n        .where(course_module_id: course_module.id)\n        .first\n        .complete!\n  end\nend\n\nclass CourseModulesUser &lt; ApplicationRecord\n  def complete!\n    self.update_attribute(:complete, true)\n  end\nend\n\ncourse_module = CourseModule.find(1)\n\nuser.mark_course_module_complete!(course_module)\n</code></pre>\n\n<p>Similarly for courses:</p>\n\n<pre><code>class User &lt; ApplicationRecord\n  def mark_course_complete!(course)\n    self.courses_users\n        .where(course_id: course.id)\n        .first\n        .complete!\n  end\nend\n\nclass CoursesUser &lt; ApplicationRecord\n  def complete!\n    self.update_attribute(:complete, true)\n  end\nend\n</code></pre>\n\n<p>This should solve your <em>issue of marking courses and course modules as completed on user basis</em>.</p>\n\n<p>There are other things to consider to make it completely functional which i will leave for you to implement e.g. marking a user's course complete automatically when all course modules of a user are complete (Yes, you need to fix that again), marking a user's course incomplete if at least one of its course modules get incompleted, etc.</p>\n\n<p>SO is always open, if you get stuck again.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "edited": false, "score": 0, "creation_date": 1536764306, "post_id": 52297401, "comment_id": 91544105, "body": "If you take a look at Jagdeep&#39;s solution, you can see what we are trying to accomplish, but I just need to get the completes to work, I believe I have everything set up correctly in terms of the migrations, models etc."}, {"owner": {"reputation": 32131, "user_id": 2346461, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/i3xAf.jpg?s=128&g=1", "display_name": "Pavan", "link": "https://stackoverflow.com/users/2346461/pavan"}, "edited": false, "score": 0, "creation_date": 1536768283, "post_id": 52297401, "comment_id": 91546444, "body": "@B.J.B My answer is focused on the error. Did the error is fixed? I will try to more details later to help with your ultimate goal"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "edited": false, "score": 0, "creation_date": 1536769086, "post_id": 52297401, "comment_id": 91546851, "body": "I added the complete? method previously but I&#39;m unsure on where best to place it, I&#39;ll add the models in there current form your question, just so there easier to access."}, {"owner": {"reputation": 32131, "user_id": 2346461, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/i3xAf.jpg?s=128&g=1", "display_name": "Pavan", "link": "https://stackoverflow.com/users/2346461/pavan"}, "edited": false, "score": 0, "creation_date": 1536769567, "post_id": 52297401, "comment_id": 91547076, "body": "@B.J.B The best place to put <code>complete?</code> method would be the model."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "edited": false, "score": 0, "creation_date": 1536798563, "post_id": 52297401, "comment_id": 91557639, "body": "Of course but I need it to have it so only completed is showing for an individual user not all users, because the way I had this setup previously it was setting it for all users. That&#39;s why I created the new database tables, and associations that Jagdeep suggested."}, {"owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "edited": false, "score": 0, "creation_date": 1536943458, "post_id": 52297401, "comment_id": 91619317, "body": "Have you considered that model attributes should get an method assigned to them to check if they are present or not? This method is named <code>&lt;attribute_name&gt;?</code> and returns <code>true</code> or <code>false</code> based if they are present or not, with the exception of the value <code>0</code> that returns <code>false</code> whereas it would normally evaluate to <code>true</code>. See: <a href=\"https://api.rubyonrails.org/classes/ActiveRecord/Base.html#class-ActiveRecord::Base-label-Attribute+query+methods\" rel=\"nofollow noreferrer\">api.rubyonrails.org/classes/ActiveRecord/&hellip;</a>"}, {"owner": {"reputation": 32131, "user_id": 2346461, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/i3xAf.jpg?s=128&g=1", "display_name": "Pavan", "link": "https://stackoverflow.com/users/2346461/pavan"}, "reply_to_user": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "edited": false, "score": 0, "creation_date": 1536944128, "post_id": 52297401, "comment_id": 91619664, "body": "@JohanWentholt You are totally true about that. But, if that so, I wonder why the error has raised in the first place."}, {"owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "edited": false, "score": 1, "creation_date": 1536944502, "post_id": 52297401, "comment_id": 91619899, "body": "@Pavan I&#39;m with you on that. The question has quite a lot of edits. In my opinion the best approach is to create an <a href=\"https://stackoverflow.com/help/mcve\">mcve</a> that we can clone and install, to see the exact working code for ourself."}, {"owner": {"reputation": 1233, "user_id": 7960859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tyaFp.png?s=128&g=1", "display_name": "obermillerk", "link": "https://stackoverflow.com/users/7960859/obermillerk"}, "edited": false, "score": 0, "creation_date": 1537362831, "post_id": 52297401, "comment_id": 91757142, "body": "The error is because he moved the complete property to the course module user and course user models in order to allow for individual completion of modules as per Jagdeep&#39;s answer, which is the right thing to do. As I said in my comment above, he needs to check for the course user /course module user models completion to ensure that the rendered completion is user dependent."}], "tags": [], "owner": {"reputation": 32131, "user_id": 2346461, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/i3xAf.jpg?s=128&g=1", "display_name": "Pavan", "link": "https://stackoverflow.com/users/2346461/pavan"}, "is_accepted": false, "score": 1, "last_activity_date": 1536932486, "last_edit_date": 1536932486, "creation_date": 1536762019, "answer_id": 52297401, "question_id": 51972186, "link": "https://stackoverflow.com/questions/51972186/complete-course-and-modules-using-rails-5-assign-to-user/52297401#52297401", "title": "Complete course and modules using Rails 5 assign to user", "body": "<blockquote>\n  <p>Undefined method complete? for CourseModule:0x000..</p>\n</blockquote>\n\n<p>I will focus on the error and explain the reason for it. You are calling <code>complete?</code> on a <code>course_module</code> here <code>&lt;% if course_module.complete? %&gt;</code>. But you <strong>don't have a method</strong> called <code>complete?</code> in the <code>CourseModule</code> model. That explains why the error has triggered.</p>\n\n<p>You should define it in the <code>CourseModule</code> to avoid the error</p>\n\n<pre><code>class CourseModule &lt; ApplicationRecord\n\n def complete?\n   #your logic here\n end\nend\n</code></pre>\n\n<p><strong>Note:</strong></p>\n\n<p>If you are willing to try a different approach, I will recommend you to have a go with <a href=\"https://api.rubyonrails.org/v5.2.1/classes/ActiveRecord/Enum.html\" rel=\"nofollow noreferrer\"><em>enums</em></a>. <code>enums</code> are very powerful and serves with <strong>in-built methods</strong> which comes very handy.</p>\n\n<p>For example, you can change the <code>CourseModel</code> to below with <code>enums</code></p>\n\n<pre><code>class CourseModule &lt; ApplicationRecord\n  extend FriendlyId\n  friendly_id :title, use: :slugged\n\n  enum status: [ :completed, :not_completed ]\n  belongs_to :course\n  has_many :course_exercises\n  .......\nend\n</code></pre>\n\n<p>By this you can simply call <code>course_module.completed?</code> which returns <code>true</code> or <code>false</code> based on the <code>status</code> of the <code>course_module</code>. And to update a <code>course_module</code> status as <code>completed</code>, just call <code>course_module.completed!</code></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 266, "favorite_count": 0, "answer_count": 2, "score": 6, "last_activity_date": 1536932486, "creation_date": 1534958762, "last_edit_date": 1536760137, "question_id": 51972186, "link": "https://stackoverflow.com/questions/51972186/complete-course-and-modules-using-rails-5-assign-to-user", "title": "Complete course and modules using Rails 5 assign to user", "body": "<p><strong>Edit #2</strong></p>\n\n<p>Here is the courses controller</p>\n\n<pre><code>class CoursesController &lt; ApplicationController\n  layout proc { user_signed_in? ? \"dashboard\" : \"application\" }\n\n  before_action :set_course, only: [:show, :edit, :update, :destroy]\n  before_action :authenticate_user!, except: [:index, :show]\n  before_action :authorize_admin, except: [:index, :show, :complete]\n\n  def index\n    @courses = Course.all.order(created_at: :asc)\n  end\n\n  def show\n    course = Course.friendly.find(params[:id])\n    @course_modules = course.course_modules.order(created_at: :asc)\n  end\n\n  def new\n    @course = Course.new\n  end\n\n  def edit\n  end\n\n  def create\n    @course = Course.new(course_params)\n\n    respond_to do |format|\n      if @course.save\n        format.html { redirect_to courses_path, notice: 'Course was successfully created.' }\n        format.json { render :show, status: :created, location: courses_path }\n      else\n        format.html { render :new }\n        format.json { render json: @course.errors, status: :unprocessable_entity }\n      end\n    end\n  end\n\n  def update\n    respond_to do |format|\n      if @course.update(course_params)\n        format.html { redirect_to @course, notice: 'Course was successfully updated.' }\n        format.json { render :show, status: :ok, location: @course }\n      else\n        format.html { render :edit }\n        format.json { render json: @course.errors, status: :unprocessable_entity }\n      end\n    end\n  end\n\n  def destroy\n    @course.destroy\n    respond_to do |format|\n      format.html { redirect_to courses_url, notice: 'Course was successfully destroyed.' }\n      format.json { head :no_content }\n    end\n  end\n\n  private\n\n  def set_course\n    @course = Course.friendly.find(params[:id])\n  end\n\n  def course_params\n    params.require(:course).permit(:title, :summary, :description, :trailer, :price)\n  end\nend\n</code></pre>\n\n<p><strong>Edit #1</strong></p>\n\n<p>So going off Jagdeep's answer below I have now done the following:</p>\n\n<p>course.rb</p>\n\n<pre><code>class Course &lt; ApplicationRecord\n  extend FriendlyId\n  friendly_id :title, use: :slugged\n\n  has_many :course_modules\n\n  validates :title, :summary, :description, :trailer, :price, presence: true\n\n  def complete?\n    self.update_attribute(:complete, true)\n  end\nend\n</code></pre>\n\n<p>course_modules_user.rb</p>\n\n<pre><code>class CourseModulesUser &lt; ApplicationRecord\n  belongs_to :course_module\n  belongs_to :user\n\n  def complete!\n    self.update_attribute(:complete, true)\n  end\nend\n</code></pre>\n\n<p>courses_user.rb</p>\n\n<pre><code>class CoursesUser &lt; ApplicationRecord\n  belongs_to :course\n  belongs_to :user\nend\n</code></pre>\n\n<p>user.rb</p>\n\n<pre><code>class User &lt; ApplicationRecord\n  # Include default devise modules. Others available are:\n  # :confirmable, :lockable, :timeoutable and :omniauthable\n  devise :database_authenticatable, :registerable, :confirmable,\n         :recoverable, :rememberable, :trackable, :validatable\n\n  has_one_attached :avatar\n\n  has_many :courses_users\n  has_many :courses, through: :courses_users\n\n  has_many :course_modules_users\n  has_many :course_modules, through: :course_modules_users\n\n  def mark_course_module_complete!(course_module)\n    self.course_modules_users\n      .where(course_module_id: course_module.id)\n      .first\n      .complete!\n    end\n\n  def after_confirmation\n    welcome_email\n    super\n  end\n\n  protected\n\n  def welcome_email\n    UserMailer.welcome_email(self).deliver\n  end\nend\n</code></pre>\n\n<p>Migrations</p>\n\n<pre><code>class CreateCoursesUsers &lt; ActiveRecord::Migration[5.2]\n  def change\n    create_table :courses_users do |t|\n      t.integer :course_id\n      t.integer :user_id\n      t.boolean :complete\n\n      t.timestamps\n    end\n  end\nend\n\nclass CreateCourseModulesUsers &lt; ActiveRecord::Migration[5.2]\n  def change\n    create_table :course_modules_users do |t|\n      t.integer :course_module_id\n      t.integer :user_id\n      t.boolean :complete\n\n      t.timestamps\n    end\n  end\nend\n</code></pre>\n\n<p>However, I'm getting errors like this</p>\n\n<p><img src=\"https://i.gyazo.com/211a9d3e2c14744297422e1e4c45ab32.png\" alt=\"image\"></p>\n\n<p><strong>Original Question</strong></p>\n\n<p>So this is a continuation of a <a href=\"https://stackoverflow.com/questions/51969779/marking-a-course-as-complete-automatically-if-all-sub-modules-are-marked-as-comp\">previous question</a>, however, this will stray off from the topic of that so here is a new one.</p>\n\n<p>After this, I got roughly what I wanted to get working which is allowing people to mark off modules and make the course complete if all modules are complete. However, upon testing a new user the modules and courses are being marked as complete (obviously a new user isn't going to complete the course on sign-in, nor are any modules going to be complete) so I need for all users to be separate in terms of what is marked as complete and what isn't.</p>\n\n<p>Previously a user by the name of @engineersmnky mentioned HABTM relationship, however, I've not dealt with this previously.</p>\n\n<p>Here is how I have things setup thus far:</p>\n\n<p>user.rb</p>\n\n<pre><code>class User &lt; ApplicationRecord\n  # Include default devise modules. Others available are:\n  # :confirmable, :lockable, :timeoutable and :omniauthable\n  devise :database_authenticatable, :registerable, :confirmable,\n         :recoverable, :rememberable, :trackable, :validatable\n\n  has_one_attached :avatar\n\n  has_many :courses\n\n  def after_confirmation\n    welcome_email\n    super\n  end\n\n  protected\n\n  def welcome_email\n    UserMailer.welcome_email(self).deliver\n  end\nend\n</code></pre>\n\n<p>course.rb</p>\n\n<pre><code>class Course &lt; ApplicationRecord\n  extend FriendlyId\n  friendly_id :title, use: :slugged\n\n  has_many :users\n  has_many :course_modules\n\n  validates :title, :summary, :description, :trailer, :price, presence: true\n\n  def complete!\n    update_attribute(:complete, true)\n  end\nend\n</code></pre>\n\n<p>course_module.rb</p>\n\n<pre><code>class CourseModule &lt; ApplicationRecord\n  extend FriendlyId\n  friendly_id :title, use: :slugged\n\n  belongs_to :course\n  has_many :course_exercises\n\n  validates :title, :course_id, presence: true\n\n  scope :completed, -&gt; { where(complete: true) }\n  after_save :update_course, if: :complete?\n\n  private\n\n  def update_course\n    course.complete! if course.course_modules.all?(&amp;:complete?)\n  end\nend\n</code></pre>\n\n<p>if the course is complete conditional <code>courses/index.html.erb</code></p>\n\n<pre><code>&lt;% if course.complete? %&gt;\n  &lt;%= link_to \"Completed\", course, class: \"block text-lg w-full text-center text-white px-4 py-2 bg-green hover:bg-green-dark border-2 border-green-dark leading-none no-underline\" %&gt;\n&lt;% else %&gt;\n  &lt;%= link_to \"View Modules\", course, class: \"block text-lg w-full text-center text-grey-dark hover:text-darker px-4 py-2 border-2 border-grey leading-none no-underline hover:border-2 hover:border-grey-dark\" %&gt;\n&lt;% end %&gt;\n</code></pre>\n\n<p>if course module is complete conditional <code>courses/show.html.erb</code></p>\n\n<pre><code>&lt;% if course_module.complete? %&gt;\n  &lt;i class=\"fas fa-check text-green float-left mr-1\"&gt;&lt;/i&gt;\n  &lt;span class=\"text-xs mr-2\"&gt;Completed&lt;/span&gt;\n&lt;% else %&gt;\n  &lt;%= link_to complete_course_module_path(course_module), method: :put do %&gt;\n  &lt;i class=\"fas fa-check text-grey-darkest float-left mr-2\"&gt;&lt;/i&gt;\n&lt;% end %&gt;\n</code></pre>\n\n<p>Databases</p>\n\n<p>Course Modules</p>\n\n<p><img src=\"https://i.gyazo.com/168fdd65d55624fb87e1e339ae0884f3.png\" alt=\"database\"></p>\n\n<p>Courses</p>\n\n<p><img src=\"https://i.gyazo.com/79e1bc9c9a52d39e17047a97b963f2c6.png\" alt=\"courses\"></p>\n"}, {"tags": ["ruby-on-rails", "ruby", "design-patterns", "model"], "comments": [{"owner": {"reputation": 1597, "user_id": 717626, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/303d9f5c2135f14f277775052bcb131b?s=128&d=identicon&r=PG", "display_name": "Aaron Breckenridge", "link": "https://stackoverflow.com/users/717626/aaron-breckenridge"}, "edited": false, "score": 2, "creation_date": 1534959605, "post_id": 51971923, "comment_id": 90895204, "body": "Are you aware of <a href=\"https://api.rubyonrails.org/classes/ActiveRecord/NestedAttributes/ClassMethods.html\" rel=\"nofollow noreferrer\">nested attributes</a>?"}], "answers": [{"tags": [], "owner": {"reputation": 716, "user_id": 3507206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/848870b4043d5ca319aa3111cb55845b?s=128&d=identicon&r=PG", "display_name": "tejasbubane", "link": "https://stackoverflow.com/users/3507206/tejasbubane"}, "is_accepted": true, "score": 4, "last_activity_date": 1534960693, "creation_date": 1534960693, "answer_id": 51972630, "question_id": 51971923, "link": "https://stackoverflow.com/questions/51971923/where-to-put-create-model-and-association-logic-in-rails/51972630#51972630", "title": "Where to put create model and association logic in Rails?", "body": "<p>Your example does not seem very complex and can be done using <a href=\"https://api.rubyonrails.org/classes/ActiveRecord/NestedAttributes/ClassMethods.html\" rel=\"nofollow noreferrer\">nested attributes</a> as mentioned in the comment. For more complex stuff, there is nothing provided by the framework and you have to come up with your own abstraction. </p>\n\n<p>Have a look at <code>service objects</code>:</p>\n\n<ol>\n<li><a href=\"https://www.engineyard.com/blog/keeping-your-rails-controllers-dry-with-services\" rel=\"nofollow noreferrer\">https://www.engineyard.com/blog/keeping-your-rails-controllers-dry-with-services</a></li>\n<li><a href=\"https://medium.com/selleo/essential-rubyonrails-patterns-part-1-service-objects-1af9f9573ca1\" rel=\"nofollow noreferrer\">https://medium.com/selleo/essential-rubyonrails-patterns-part-1-service-objects-1af9f9573ca1</a></li>\n</ol>\n\n<p>Again since these are community abstractions, there is no standard way of implementing service objects - some people use classes with call method, some use modules, etc. How you use them depends on your definition of clean code.</p>\n"}], "owner": {"reputation": 2360, "user_id": 4541624, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/X0lol.jpg?s=128&g=1", "display_name": "Adam Thompson", "link": "https://stackoverflow.com/users/4541624/adam-thompson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 51972630, "answer_count": 1, "score": 1, "last_activity_date": 1541452241, "creation_date": 1534957653, "last_edit_date": 1541452241, "question_id": 51971923, "link": "https://stackoverflow.com/questions/51971923/where-to-put-create-model-and-association-logic-in-rails", "title": "Where to put create model and association logic in Rails?", "body": "<p>I have a model <code>A</code> with some association to <code>B</code> via a join table <code>AB</code>. In the <code>create</code> action for the <code>A</code> controller I create the join model if the optional params are present for the association, otherwise only <code>A</code> is created without the <code>AB</code> association.</p>\n\n<p>If I leave all the logic in the controller then the controller gets pretty fat and a pain to test and the logic cannot be re-used easily. If I try to move the logic to the model <code>A</code> then I just have a random method for <code>create_with_AB</code> or something similar. It doesn't feel right.</p>\n\n<p>It feels like there should be some layer in between? I'm not sure if there is a common pattern used to handle a situation like this?</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 7565, "user_id": 1021515, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Z9QcP.jpg?s=128&g=1", "display_name": "mwp", "link": "https://stackoverflow.com/users/1021515/mwp"}, "edited": false, "score": 1, "creation_date": 1534958921, "post_id": 51971914, "comment_id": 90894882, "body": "Please share what you&#39;ve tried, even if it&#39;s not working."}, {"owner": {"reputation": 323, "user_id": 2850, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vMuQR.jpg?s=128&g=1", "display_name": "Chris C", "link": "https://stackoverflow.com/users/2850/chris-c"}, "reply_to_user": {"reputation": 7565, "user_id": 1021515, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Z9QcP.jpg?s=128&g=1", "display_name": "mwp", "link": "https://stackoverflow.com/users/1021515/mwp"}, "edited": false, "score": 0, "creation_date": 1534960369, "post_id": 51971914, "comment_id": 90895564, "body": "@mwp I updated my question.  I could roll my own method that loops over the strings but what I&#39;m hoping for is a Ruby string method or idiom that I missed.  Thanks."}, {"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 1, "creation_date": 1534990218, "post_id": 51971914, "comment_id": 90904907, "body": "Your question is not necessarily clear. If <code>string_1</code> is <code>&quot;ab&quot;</code> and <code>string_2</code> is <code>&quot;bc&quot;</code>, then does that count as overlap to you? If yes, then you gave a bad example as your example may imply that the overlapping border can be only word boundaries. If no, then you have not explained why, nor have you illustrated that fact."}], "answers": [{"comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 2, "creation_date": 1534960334, "post_id": 51972044, "comment_id": 90895546, "body": "Unfortunately neither one of these really meets the requirements of determining if the end of <code>string_1</code> overlaps the beginning of <code>string_2</code>"}], "tags": [], "owner": {"reputation": 2349, "user_id": 243215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/23c2e153292ab0feb762cd2015800c3e?s=128&d=identicon&r=PG", "display_name": "M. Scott Ford", "link": "https://stackoverflow.com/users/243215/m-scott-ford"}, "is_accepted": false, "score": 0, "last_activity_date": 1534958551, "last_edit_date": 1534958551, "creation_date": 1534958131, "answer_id": 51972044, "question_id": 51971914, "link": "https://stackoverflow.com/questions/51971914/determine-if-the-end-of-a-string-overlaps-with-beginning-of-a-separate-string/51972044#51972044", "title": "Determine if the end of a string overlaps with beginning of a separate string", "body": "<p>Perhaps something like this would meet your needs?</p>\n\n<pre><code>string_1.split(' ') -  string_2.split(' ')\n=&gt; [\"People\", \"say\", \"is\", \"impossible,\"]\n</code></pre>\n\n<p>Or this is more convoluted, but would give you the exact overlap:</p>\n\n<pre><code>string_2.\n  chars.\n  each_with_index.\n  map { |_, i| string_1.match(string_2[0..i]) }.\n  select { |s| s }.\n  max { |x| x.length }.\n  to_s\n=&gt; \"but I\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1534969219, "post_id": 51972392, "comment_id": 90899471, "body": "I like the enum but how do you feel about <code>i = 0</code> and <code>i = rindex(other, i.pred)</code> and then <code>break i - length</code> this would allow for <code>def overlap(other); self[oindex(other)..-1] rescue nil; end;</code> which looks cleaner than the negation in my opinion"}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1534969598, "post_id": 51972392, "comment_id": 90899664, "body": "either that or simply <code>break i</code> which make sense too"}, {"owner": {"reputation": 7565, "user_id": 1021515, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Z9QcP.jpg?s=128&g=1", "display_name": "mwp", "link": "https://stackoverflow.com/users/1021515/mwp"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 1, "creation_date": 1534969719, "post_id": 51972392, "comment_id": 90899729, "body": "@engineersmnky Rewriting either solution to return the offset into self rather than the number of matching characters is left as a trivial exercise for the reader. ;)"}, {"owner": {"reputation": 7565, "user_id": 1021515, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Z9QcP.jpg?s=128&g=1", "display_name": "mwp", "link": "https://stackoverflow.com/users/1021515/mwp"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1534969800, "post_id": 51972392, "comment_id": 90899761, "body": "And you want to work left to right with String#index (not right to left with String#rindex) to check for longer matches first."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1534970171, "post_id": 51972392, "comment_id": 90899934, "body": "Since we are looking for a tail end overlap you want to start at the right. Using <code>index</code> you will iterate twice <code>29</code> and <code>34</code> (once for each <code>b</code> in the string) using <code>rindex</code> will immediately hit <code>34</code> (the right most <code>b</code>)"}, {"owner": {"reputation": 7565, "user_id": 1021515, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Z9QcP.jpg?s=128&g=1", "display_name": "mwp", "link": "https://stackoverflow.com/users/1021515/mwp"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1534970252, "post_id": 51972392, "comment_id": 90899979, "body": "@engineersmnky Yes, but consider the case where there is repetition in the overlapping strings. To check &quot;foofoofoo&quot; and &quot;foofoofoo&quot; for overlap, I don&#39;t want to start at the last &quot;f&quot;."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1534971117, "post_id": 51972392, "comment_id": 90900321, "body": "Fair enough I was assuming first overlap was sufficient <i>Hear Hear</i> :)"}], "tags": [], "owner": {"reputation": 7565, "user_id": 1021515, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Z9QcP.jpg?s=128&g=1", "display_name": "mwp", "link": "https://stackoverflow.com/users/1021515/mwp"}, "is_accepted": false, "score": 2, "last_activity_date": 1534967764, "last_edit_date": 1534967764, "creation_date": 1534959644, "answer_id": 51972392, "question_id": 51971914, "link": "https://stackoverflow.com/questions/51971914/determine-if-the-end-of-a-string-overlaps-with-beginning-of-a-separate-string/51972392#51972392", "title": "Determine if the end of a string overlaps with beginning of a separate string", "body": "<p>Here's a solution that works by comparing the end of string_1 to the start of string_2\u2014using the greatest common length as a starting point\u2014with at least one matching character. It returns the index (from the end of string_1 or the beginning of string_2) if any matching character(s) are found, which can be used to extract the matching portion. </p>\n\n<pre><code>class String\n  def oindex(other)\n    [length, other.length].min.downto(1).detect do |i|\n      end_with?(other[0, i])\n    end\n  end\nend\n\nstring_1 = 'People say nothing is impossible, but I'\nstring_2 = 'but I do nothing every day.'\n\nif (idx = string_1.oindex(string_2))\n  puts \"Last #{idx} characters match: #{string_1[-idx..-1]}\"\nend\n</code></pre>\n\n<p>Here's an alternative that finds all the indexes of the first character of the other string in the string, and uses those indexes as starting points to check for matches:</p>\n\n<pre><code>class String\n  def each_index(other)\n    return enum_for(__callee__, other) unless block_given?\n\n    i = -1\n    yield i while i = index(other, i.succ)\n  end\n\n  def oindex(other)\n    each_index(other.chr).detect do |i|\n      other.start_with?(self[i..-1]) and break length - i\n    end\n  end\nend\n</code></pre>\n\n<p>This should be more efficient than checking every index, especially on longer strings with shorter matches, but I haven't benchmarked it. </p>\n"}, {"comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 1, "creation_date": 1534966535, "post_id": 51973429, "comment_id": 90898319, "body": "For the second example why not just use the strings instead? e.g. <code>string_1[(0..string_1.length).detect { |idx| string_2.start_with?(string_1[idx..-1]) }..-1]</code>"}, {"owner": {"reputation": 79972, "user_id": 298607, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/DVW9g.jpg?s=128&g=1", "display_name": "dawg", "link": "https://stackoverflow.com/users/298607/dawg"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1534966853, "post_id": 51973429, "comment_id": 90898471, "body": "O perhaps premature optimization thinking the array might be faster than the string version. You are right tho. I will add that."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1534968017, "post_id": 51973429, "comment_id": 90898973, "body": "Yeah generally <code>String</code> mechanisms are faster than conversion"}, {"owner": {"reputation": 79972, "user_id": 298607, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/DVW9g.jpg?s=128&g=1", "display_name": "dawg", "link": "https://stackoverflow.com/users/298607/dawg"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1534974868, "post_id": 51973429, "comment_id": 90901788, "body": "<i>Yeah generally String mechanisms are faster than conversion</i>: but there are fewer actions under the array method vs the string method. One per word vs one per character."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1534974959, "post_id": 51973429, "comment_id": 90901820, "body": "I totally understand but in this case String benchmarks under the Array possibly due to the regex which is notoriously slow. Additionally words are semantic and the question does not state that &quot;ut I...&quot; should not also match"}, {"owner": {"reputation": 79972, "user_id": 298607, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/DVW9g.jpg?s=128&g=1", "display_name": "dawg", "link": "https://stackoverflow.com/users/298607/dawg"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1534975100, "post_id": 51973429, "comment_id": 90901876, "body": "@engineersmnky: Agreed."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1534985222, "post_id": 51973429, "comment_id": 90903976, "body": "<code>&quot;my oh my&quot;.split &#47;\\b&#47; #=&gt; [&quot;my&quot;, &quot; &quot;, &quot;oh&quot;, &quot; &quot;, &quot;my&quot;]</code>. Is that intended?"}, {"owner": {"reputation": 79972, "user_id": 298607, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/DVW9g.jpg?s=128&g=1", "display_name": "dawg", "link": "https://stackoverflow.com/users/298607/dawg"}, "reply_to_user": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1534987987, "post_id": 51973429, "comment_id": 90904492, "body": "@CarySwoveland: <i>Is that intended?</i> Yes, absolutely. Suppose you have <code>&#39;Word\\tword\\t\\tword       word word&#39;</code> using this method you can reassemble the original string including nonstandard spacing between the words. <code>string.split(\\b).join == string</code> even if there are tabs, spaces, multiple tabs and spaces in the string."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1534992821, "post_id": 51973429, "comment_id": 90905345, "body": "That&#39;s interesting. I&#39;ve tucked it away."}], "tags": [], "owner": {"reputation": 79972, "user_id": 298607, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/DVW9g.jpg?s=128&g=1", "display_name": "dawg", "link": "https://stackoverflow.com/users/298607/dawg"}, "is_accepted": false, "score": 2, "last_activity_date": 1534966899, "last_edit_date": 1534966899, "creation_date": 1534964116, "answer_id": 51973429, "question_id": 51971914, "link": "https://stackoverflow.com/questions/51971914/determine-if-the-end-of-a-string-overlaps-with-beginning-of-a-separate-string/51973429#51973429", "title": "Determine if the end of a string overlaps with beginning of a separate string", "body": "<p>You can use a simple loop and test at the end:</p>\n\n<pre><code>a=string_1.split(/\\b/)\nidx=0\n\nwhile (idx&lt;=a.length) do\n   break if string_2.start_with?(a[idx..-1].join)\n   idx+=1\nend\n\np a[idx..-1].join if idx&lt;a.length \n</code></pre>\n\n<p>Since this starts at <code>0</code>, the longest sub string overlap is found. </p>\n\n<p>You can use the same logic in a <a href=\"https://ruby-doc.org/core-2.5.1/Enumerable.html#method-i-detect\" rel=\"nofollow noreferrer\">.detect</a> block on the same array:</p>\n\n<pre><code>&gt; a[(0..a.length).detect { |idx| string_2.start_with?(a[idx..-1].join) }..-1].join\n=&gt; \"but I\"\n</code></pre>\n\n<p>Or, as pointed out in comments, you can use the strings vs the array</p>\n\n<pre><code>string_1[(0..string_1.length).detect { |idx| string_2.start_with?(string_1[idx..-1]) }..-1]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": false, "score": 1, "last_activity_date": 1535034348, "last_edit_date": 1535034348, "creation_date": 1534982215, "answer_id": 51976664, "question_id": 51971914, "link": "https://stackoverflow.com/questions/51971914/determine-if-the-end-of-a-string-overlaps-with-beginning-of-a-separate-string/51976664#51976664", "title": "Determine if the end of a string overlaps with beginning of a separate string", "body": "<p>Here are a couple of ways to do that. The first converts the two strings to arrays and then compares sequences from those arrays. The second operates on the two strings directly, comparing substrings.</p>\n\n<p><strong>#1 Convert strings to arrays and compare sequences from those arrays</strong></p>\n\n<p>Here's a simple alternative that requires the strings to be converted to arrays of words. It assumes all pairs of words are separated by one space.</p>\n\n<pre><code>def begins_with_ends?(end_str, begin_str)\n  end_arr = end_str.split\n  begin_arr = begin_str.split\n  !!begin_arr.each_index.find { |i| begin_arr[0,i+1] == end_arr[-1-i..-1] }\nend\n</code></pre>\n\n<p><code>!!obj</code> converts <code>obj</code> to <code>false</code> when it's \"falsy\" (<code>nil</code> or <code>false</code>) and to <code>true</code> when it's \"truthy\" (not \"falsy\"). For example, <code>!!3 #=&gt; true</code> and <code>!!nil #=&gt; false</code>.</p>\n\n<pre><code>end_str   = 'People say nothing is impossible, but I when I'\nbegin_str = 'but I when I do nothing every day.'\nbegins_with_ends?(end_str, begin_str)\n  #=&gt; true\n</code></pre>\n\n<p>Here the match is on the second word <code>\"I\"</code> in <code>begin_str</code>. Often, however, the last word of <code>end_str</code> only matches (at most) a single word in <code>begin_str</code></p>\n\n<p><strong>#2 Compare substrings</strong></p>\n\n<p>I've implemented the following algorithm.</p>\n\n<ol>\n<li>Set <code>start_search</code> to <code>0</code>.</li>\n<li>Attempt to match the last word of <code>end_str</code> (value of <code>target</code>) in <code>begin_str</code>, beginning at offset <code>start_search</code>. If no match is found return <code>false</code>; else let <code>idx</code> be the index of <code>start_str</code> where the last character of <code>target</code> appears.</li>\n<li>Return <code>true</code> if the string comprised of the first <code>idx</code> characters of <code>begin_str</code> equals the string comprised by the last <code>idx</code> characters of <code>end_str</code>;  else set <code>start_search = idx + 2</code> and repeat step 2.</li>\n</ol>\n\n<p></p>\n\n<pre><code>def begins_with_ends?(end_str, begin_str)\n  target = end_str[/[[:alnum:]]+\\z/]\n  start_idx = 0\n  loop do\n    idx = begin_str.index(/\\b#{target}\\b/, start_idx)\n    return false if idx.nil?\n    idx += target.size\n    return true if end_str[-idx..-1] == begin_str[0, idx]\n    start_idx = idx + 2\n  end\nend\n</code></pre>\n\n<p></p>\n\n<pre><code>begins_with_ends?(end_str, begin_str)\n  #=&gt; true\n</code></pre>\n\n<p>This approach recognizes different numbers of spaces between the same two words in both strings (in which case there is no match). </p>\n"}, {"comments": [{"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "reply_to_user": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1534993472, "post_id": 51977705, "comment_id": 90905441, "body": "@CarySwoveland Yes, that would be much better."}, {"owner": {"reputation": 323, "user_id": 2850, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vMuQR.jpg?s=128&g=1", "display_name": "Chris C", "link": "https://stackoverflow.com/users/2850/chris-c"}, "edited": false, "score": 0, "creation_date": 1535133861, "post_id": 51977705, "comment_id": 90970089, "body": "Thanks everyone who submitted solutions.  I like this solution because of it&#39;s simplicity once I figured out the Regex.  My Regex skills are weak at best.  Performance is fine for my needs but I wonder how it would preform on long strings?"}], "tags": [], "owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "is_accepted": true, "score": 5, "last_activity_date": 1534992750, "creation_date": 1534992750, "answer_id": 51977705, "question_id": 51971914, "link": "https://stackoverflow.com/questions/51971914/determine-if-the-end-of-a-string-overlaps-with-beginning-of-a-separate-string/51977705#51977705", "title": "Determine if the end of a string overlaps with beginning of a separate string", "body": "<p>Set <code>MARKER</code> to some string that never appears in your <code>string_1</code> and <code>string_2</code>. There are ways to do that dynamically, but I assume you can come up with some fixed such string in your case. I assume:</p>\n\n<pre><code>MARKER = \"@@@\"\n</code></pre>\n\n<p>to be safe for you case. Change it depending on your use case. Then,</p>\n\n<pre><code>string_1 = 'People say nothing is impossible, but I'\nstring_2 = 'but I do nothing every day.'\n(string_1 + MARKER + string_2).match?(/(.+)#{MARKER}\\1/) # =&gt; true\n\nstring_1 = 'People say nothing is impossible, but I'\nstring_2 = 'but you do nothing every day.'\n(string_1 + MARKER + string_2).match?(/(.+)#{MARKER}\\1/) # =&gt; false\n</code></pre>\n"}], "owner": {"reputation": 323, "user_id": 2850, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vMuQR.jpg?s=128&g=1", "display_name": "Chris C", "link": "https://stackoverflow.com/users/2850/chris-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 420, "favorite_count": 0, "accepted_answer_id": 51977705, "answer_count": 5, "score": 5, "last_activity_date": 1535034348, "creation_date": 1534957595, "last_edit_date": 1534990087, "question_id": 51971914, "link": "https://stackoverflow.com/questions/51971914/determine-if-the-end-of-a-string-overlaps-with-beginning-of-a-separate-string", "title": "Determine if the end of a string overlaps with beginning of a separate string", "body": "<p>I want to find if the ending of a string overlaps with the beginning of separate string.  For example if I have these two strings:</p>\n\n<pre><code>string_1 = 'People say nothing is impossible, but I'\nstring_2 = 'but I do nothing every day.'\n</code></pre>\n\n<p>How do I find that the <code>\"but I\"</code> part at the end of <code>string_1</code> is the same as the beginning of <code>string_2</code>?</p>\n\n<p>I could write a method to loop over the two strings, but I'm hoping for an answer that has a Ruby string method that I missed or a Ruby idiom.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "csv", "parsing", "error-handling"], "answers": [{"tags": [], "owner": {"reputation": 778, "user_id": 2125795, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7EreQ.jpg?s=128&g=1", "display_name": "Billy Kimble", "link": "https://stackoverflow.com/users/2125795/billy-kimble"}, "is_accepted": false, "score": 2, "last_activity_date": 1534966239, "creation_date": 1534966239, "answer_id": 51973918, "question_id": 51971826, "link": "https://stackoverflow.com/questions/51971826/csv-parsing-returns-unquoted-fields-do-not-allow-r-or-n-but-cant-find-error/51973918#51973918", "title": "CSV parsing returns &quot;Unquoted fields do not allow \\r or \\n&quot; but can&#39;t find error in source file?", "body": "<p>It looks like whats happening is that the input file's lines are terminated with \\n, except for lines 134 and 135, which are terminated with \\r\\n. CSV by default has its :row_sep set to :auto, which looks at the file to determine which separator is most appropriate, and it selected \"\\n\". Those extra carriage returns make it think that you have a multi line field which is not encapsulated by quotes.</p>\n\n<p>You can fix this by pre parsing the file before CSV gets to it, and removing the \\r:</p>\n\n<p>Change:</p>\n\n<pre><code>CSV.parse(response.body, skip_blanks: true, skip_lines: /(^\\s*#|^\\s*$|^contact=|^CONTACT=|^subdomain=)/) do |row|\n</code></pre>\n\n<p>to:</p>\n\n<pre><code>CSV.parse(response.body.tr(\"\\r\", ''), skip_blanks: true, skip_lines: /(^\\s*#|^\\s*$|^contact=|^CONTACT=|^subdomain=)/) do |row|\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 191, "user_id": 3391060, "user_type": "registered", "accept_rate": 91, "profile_image": "https://graph.facebook.com/58009291/picture?type=large", "display_name": "sulleh", "link": "https://stackoverflow.com/users/3391060/sulleh"}, "edited": false, "score": 0, "creation_date": 1535037277, "post_id": 51974034, "comment_id": 90927667, "body": "the <code>response.body.gsub!(&quot;\\r&quot;, &#39;&#39;)</code> solved it! I&#39;m curious, where is the location of outputfile.txt? apologies if that&#39;s a dumb question, but I have another issue that I suspect is the same problem - I&#39;m getting the error <code>Illegal quoting in line 540.</code> for techradar.com/ads.txt, and I think there are hidden / errant characters present here too, just not line breaks"}, {"owner": {"reputation": 672, "user_id": 8748686, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gPuB7.jpg?s=128&g=1", "display_name": "John Skiles Skinner", "link": "https://stackoverflow.com/users/8748686/john-skiles-skinner"}, "reply_to_user": {"reputation": 191, "user_id": 3391060, "user_type": "registered", "accept_rate": 91, "profile_image": "https://graph.facebook.com/58009291/picture?type=large", "display_name": "sulleh", "link": "https://stackoverflow.com/users/3391060/sulleh"}, "edited": false, "score": 0, "creation_date": 1535039957, "post_id": 51974034, "comment_id": 90929314, "body": "The other answer, by @bkimble, uses <code>tr()</code> rather than <code>gsub()</code>, which is probably a more efficient choice for a single character removal like this. The <code>outputfile.txt</code> would be created by that code in the Rails project root directory. The line number 540 that you are a seeing may be a little misleading, because some of the lines are being skipped before CSV assigns line numbers. The illegal quoting is actually on line 580: <code>tremorhub.com, q017o-78mlk, RESELLER, 1a4e959a1b50034a # Premium video demand aka &quot;Telaria&quot;\t#</code>"}, {"owner": {"reputation": 191, "user_id": 3391060, "user_type": "registered", "accept_rate": 91, "profile_image": "https://graph.facebook.com/58009291/picture?type=large", "display_name": "sulleh", "link": "https://stackoverflow.com/users/3391060/sulleh"}, "edited": false, "score": 0, "creation_date": 1535055342, "post_id": 51974034, "comment_id": 90936902, "body": "ok I&#39;ll make the changes to use <code>tr()</code> - to avoid the &quot;Telaria&quot; issue, would I control for quotes via regex?"}, {"owner": {"reputation": 672, "user_id": 8748686, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gPuB7.jpg?s=128&g=1", "display_name": "John Skiles Skinner", "link": "https://stackoverflow.com/users/8748686/john-skiles-skinner"}, "reply_to_user": {"reputation": 191, "user_id": 3391060, "user_type": "registered", "accept_rate": 91, "profile_image": "https://graph.facebook.com/58009291/picture?type=large", "display_name": "sulleh", "link": "https://stackoverflow.com/users/3391060/sulleh"}, "edited": false, "score": 1, "creation_date": 1535055939, "post_id": 51974034, "comment_id": 90937190, "body": "You could, I guess. You could also use <code>tr()</code> or <code>gsub()</code> to remove all quotation mark charters. Though either of these could be messy because quotation marks are also a legitimate delimiter in .csv files, just not used in this one. I notice that the quotes that are giving you trouble are in the text after the <code>#</code> that you are removing. But, you&#39;re removing it after CSV is parsing the lines. Consider removing it beforehand."}], "tags": [], "owner": {"reputation": 672, "user_id": 8748686, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gPuB7.jpg?s=128&g=1", "display_name": "John Skiles Skinner", "link": "https://stackoverflow.com/users/8748686/john-skiles-skinner"}, "is_accepted": true, "score": 6, "last_activity_date": 1534966777, "creation_date": 1534966777, "answer_id": 51974034, "question_id": 51971826, "link": "https://stackoverflow.com/questions/51971826/csv-parsing-returns-unquoted-fields-do-not-allow-r-or-n-but-cant-find-error/51974034#51974034", "title": "CSV parsing returns &quot;Unquoted fields do not allow \\r or \\n&quot; but can&#39;t find error in source file?", "body": "<p>There are inconsistent line endings in that text, and the CSV parser is stumbling over them. A very quick fix is to remove all <code>\\r</code> characters with:</p>\n\n<pre><code>response.body.gsub!(\"\\r\", '')\n</code></pre>\n\n<p>In case you are curious, one way to see the errant characters is the following code that writes the Ruby array notation of every character to a text file:</p>\n\n<pre><code>response = HTTParty.get(\"http://\" + \"weather.com/ads.txt\", limit: 100, follow_redirects: true, timeout: 10)\ncharacters = response.chars.inspect\noutput = File.open( \"outputfile.txt\",\"w\" )\noutput &lt;&lt; characters\noutput.close\n</code></pre>\n\n<p>Open up <code>outputfile.txt</code> and search for <code>\\r</code> characters. I find just a couple of them at line endings, though all other lines are ended with <code>\\n</code> alone.</p>\n"}], "owner": {"reputation": 191, "user_id": 3391060, "user_type": "registered", "accept_rate": 91, "profile_image": "https://graph.facebook.com/58009291/picture?type=large", "display_name": "sulleh", "link": "https://stackoverflow.com/users/3391060/sulleh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2498, "favorite_count": 1, "accepted_answer_id": 51974034, "answer_count": 2, "score": 2, "last_activity_date": 1534966777, "creation_date": 1534957258, "question_id": 51971826, "link": "https://stackoverflow.com/questions/51971826/csv-parsing-returns-unquoted-fields-do-not-allow-r-or-n-but-cant-find-error", "title": "CSV parsing returns &quot;Unquoted fields do not allow \\r or \\n&quot; but can&#39;t find error in source file?", "body": "<p>I'm using the built-in CSV function in Ruby for my Rails app.  I am calling a URL (via HTTParty) parsing it, and attempting to save the results to my database.  </p>\n\n<p>The problem is, I'm getting the error <code>Unquoted fields do not allow \\r or \\n</code> that indicates, normally, there is a problem with the input data, but in examining the data, I can't find any issues. </p>\n\n<p>Here's how I retrieve data: </p>\n\n<p><code>response = HTTParty.get(\"http://\" + \"weather.com/ads.txt\", limit: 100, follow_redirects: true, timeout: 10)</code> </p>\n\n<p>(This data is publicly available at the url weather.com/ads.txt)</p>\n\n<p>I then attempt to parse the data, with some regex applied to ignore everything after a <code>#</code>, ignore blank lines, etc. </p>\n\n<p><code>if response.code == 200 &amp;&amp; !response.body.match(/&lt;.*html&gt;/)\nactive_policies = []</code></p>\n\n<pre><code>CSV.parse(response.body, skip_blanks: true, skip_lines: /(^\\s*#|^\\s*$|^contact=|^CONTACT=|^subdomain=)/) do |row|\n    begin\n     #print out the individual ads.txt records \n     puts \"\"\n     print row[0].downcase.strip + \" \" + row[1].strip + \" \" + \n     row[2].split(\"#\").first.strip\n            active_policies.push(\n                publisher.policies.find_or_create_by(ad_partner: row[0].downcase.strip, external_seller_id: row[1].strip, seller_relationship: row[2].split(\"#\").first.strip) do |policy|\n                    policy.deactivated_at = nil\n                end \n                )\n\n                rescue =&gt; save\n                #Add error event to the new sync status model\n                puts \"we are in the loop\"\n                puts save.message, row.inspect, save.backtrace\n                    next\n                end\n                end\n            #else\n                #puts \"Too many policies.  Skipping \" + publisher.name\n            #end\n            #now we are going to run a check to see if we have any policies that are outdated, and if so, flag them as such.\n            deactivated_policies = publisher.policies.where.not(id: active_policies.map(&amp;:id)).where(deactivated_at: nil)\n            deactivated_policies.update_all(deactivated_at: Time.now)\n            deactivated_policies.each do |deactivated_policy|\n                puts \"Deactivating Policy for \" + deactivated_policy.publisher.name\n            end\n\n         elsif response.code == 404 \n            print \n            print response.code.to_s + \" GET, \"  + response.body.size.to_s + \" body, \"\n            puts response.headers.size.to_s + \" headers for \" + publisher.name\n\n         elsif response.code == 302\n            print response.code.to_s + \" GET, \"  + publisher.name\n         else \n            puts response.code.to_s +  \" GET ads txt not found on \" + publisher.name\n         end\n\n    publisher.update(last_scan: Time.now)\n\n    rescue =&gt; ex\n        puts ex.message, ex.backtrace, \"error pulling #{publisher.name} ...\" \n        #publisher.update_columns(active: \"false\")\n    end\nend`\n</code></pre>\n\n<p><strong>A couple of ideas I've had / results of investigation:</strong> </p>\n\n<ol>\n<li><p>I have tried going through this line by line, and I've identified that line 134 is what is breaking the scan.  I did this by doing a manual check like so: \n<code>CSV.parse(response.body.lines[140..400].join(\"\\n\"), skip_blanks: true, skip_lines: /(^\\s*#|^\\s*$|^contact=|^CONTACT=|^subdomain=)/)</code> but this doesn't help me, because even if I identify line 134 as the offending line, I don't know how to detect or deal with it. </p>\n\n<ol start=\"2\">\n<li><p>I noticed that the source file (at weather.com/ads.txt) has unusual characters, but even forcing it to utf-8 via <code>response.body.force_encoding(\"UTF-8\")</code> still throws the error.  </p></li>\n<li><p>I tried adding <code>next</code> to the rescue block, so even if it finds an error, it will move on to the next row in the csv, but that doesn't happen - it just errors out and stops parsing - so I get the first 130~ entries, but not the remaining ones. </p></li>\n<li><p>Similar to page type, I'm not sure if the page type being HTML and not a text file is creating a problem here.</p></li>\n</ol></li>\n</ol>\n\n<p>I would love to know how to detect and handle this error, so any thoughts here would be most welcome!</p>\n\n<p>For reference, <code>#PBS</code> is apparently the line 134 that is giving me trouble in the source file, but I don't know if I fully trust that this is the issue. </p>\n\n<pre><code>#canada\n\ngoogle.com, pub-0942427266003794, DIRECT, f08c47fec0942fa0\nindexexchange.com, 184315, DIRECT\nindexexchange.com, 184601, DIRECT\nindexexchange.com, 182960, DIRECT\nopenx.com, 539462051, DIRECT, 6a698e2ec38604c6\n\n#spain\n\n#PBS\ngoogle.com, pub-8750086020675820, DIRECT, f08c47fec0942fa0\ngoogle.com, pub-1072712229542583, DIRECT, f08c47fec0942fa0\nappnexus.com, 3872, DIRECT\nrubiconproject.com, 9778, DIRECT, 0bfd66d529a55807\nopenx.com, 539967419, DIRECT, 6a698e2ec38604c6\nopenx.com, 539726051, DIRECT, 6a698e2ec38604c6\ngoogle.com, pub-7442858011436823, DIRECT, f08c47fec0942fa0\n</code></pre>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 2, "creation_date": 1534963300, "post_id": 51971810, "comment_id": 90896844, "body": "Remember if you&#39;re really baffled to check in <code>irb</code> or something like it with <code>p a</code> and <code>p b</code> (equivalent to <code>puts a.inspect</code>) to see what&#39;s going on. In this case the differences would be obvious."}], "answers": [{"comments": [{"owner": {"reputation": 18079, "user_id": 503402, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/873ad707fb34aac8fbdfbfec676e02e9?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/503402/max"}, "edited": false, "score": 3, "creation_date": 1534972342, "post_id": 51972053, "comment_id": 90900828, "body": "This is parsed as <code>a=[1000, (b = 1000), (c = 1000), (d = 1000)]</code>. Assignment is an expression in Ruby, so you get the same result as <code>a=[1000,1000,1000,1000]</code> but with the side effects of assigning other variables"}], "tags": [], "owner": {"reputation": 9971, "user_id": 8255744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de22299534b5a8ed244ee8ff4aa6c481?s=128&d=identicon&r=PG&f=1", "display_name": "Simple Lime", "link": "https://stackoverflow.com/users/8255744/simple-lime"}, "is_accepted": false, "score": 6, "last_activity_date": 1534958188, "creation_date": 1534958188, "answer_id": 51972053, "question_id": 51971810, "link": "https://stackoverflow.com/questions/51971810/ruby-number-equal/51972053#51972053", "title": "Ruby number equal?", "body": "<p>In ruby you don't need the square brackets <code>[]</code> to create an array. So your variable creation line isn't doing what you think:</p>\n\n<pre><code>a=1000, b=1000, c=1000, d=1000\np a # [1000, 1000, 1000, 1000]\np b # 1000\np c # 1000\np d # 1000\n</code></pre>\n\n<p>So then, <code>a == b</code> is comparing the array <code>[1000, 1000, 1000, 1000] == 1000</code>, which is obviously false</p>\n"}, {"comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 1, "creation_date": 1534963338, "post_id": 51973026, "comment_id": 90896863, "body": "List and array form are a lot more slippery in Ruby than in other languages that have a clear distinction."}], "tags": [], "owner": {"reputation": 2125, "user_id": 1446543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/934816c610f53abdab5f26510478bc24?s=128&d=identicon&r=PG", "display_name": "ForeverZer0", "link": "https://stackoverflow.com/users/1446543/foreverzer0"}, "is_accepted": true, "score": 8, "last_activity_date": 1534973659, "last_edit_date": 1534973659, "creation_date": 1534962382, "answer_id": 51973026, "question_id": 51971810, "link": "https://stackoverflow.com/questions/51971810/ruby-number-equal/51973026#51973026", "title": "Ruby number equal?", "body": "<p>Ruby's shortcut for setting multiple variables on one line is a little different than C-esque languages.</p>\n\n<p>As pointed out in <a href=\"https://stackoverflow.com/questions/51971810/ruby-number-equal\">SimpleLime's Answer</a>, the syntax you are using actually creates an array of the <code>a</code> variable.</p>\n\n<p>As another pointed out in comment, the way your example is written would evaluate to the following:</p>\n\n<pre><code>a = [1000, (b = 1000), (c = 1000), (d = 1000)]\n</code></pre>\n\n<p>While <code>b</code>, <code>c</code>, and <code>d</code> set as expected, <code>a</code> does not. <code>a</code> is set to an array, while <code>b</code>, <code>c</code>, and <code>d</code> are set to <code>1000</code>, since <code>variable = value</code> is actually a method call that returns the given value.</p>\n\n<p>The Ruby syntax for what you really intended would look like this:</p>\n\n<pre><code>a, b, c, d = 1000, 1000, 1000, 1000\n</code></pre>\n\n<p>or what it actually evaluates to:</p>\n\n<pre><code>a, b, c, d = [1000, 1000, 1000, 1000]\n</code></pre>\n\n<p>You can also still do the other shortcut syntax that is pretty common if all the values are the same.</p>\n\n<pre><code>a = b = c = d = 1000\n</code></pre>\n\n<p>But beware of this syntax if not using \"value\" types, such as numerics or booleans, as all the objects will share the same reference.</p>\n"}], "owner": {"reputation": 312, "user_id": 5036568, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/98T6v.jpg?s=128&g=1", "display_name": "jacinzhang", "link": "https://stackoverflow.com/users/5036568/jacinzhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 51973026, "answer_count": 2, "score": 4, "last_activity_date": 1535017771, "creation_date": 1534957208, "question_id": 51971810, "link": "https://stackoverflow.com/questions/51971810/ruby-number-equal", "title": "Ruby number equal?", "body": "<p>Two number compare, like below:</p>\n\n<pre><code>#!/usr/bin/ruby\n\na=1000, b=1000, c=1000, d=1000\nputs a==b, c==d\n</code></pre>\n\n<p>but print: </p>\n\n<pre><code>false\ntrue\n</code></pre>\n\n<p>Why Ruby compare result like this?</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1534956506, "post_id": 51971592, "comment_id": 90893736, "body": "you mean <code>age_entry(*(1..8))</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 18079, "user_id": 503402, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/873ad707fb34aac8fbdfbfec676e02e9?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/503402/max"}, "edited": false, "score": 0, "creation_date": 1534972613, "post_id": 51971626, "comment_id": 90900915, "body": "Redefining the signature is the way to go, but if you&#39;re stuck with the second approach (for some reason), you can make it a little better with <code>method(__method__).arity</code> instead of the hard-coded 8."}], "tags": [], "owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "is_accepted": false, "score": 1, "last_activity_date": 1534956840, "last_edit_date": 1534956840, "creation_date": 1534956501, "answer_id": 51971626, "question_id": 51971592, "link": "https://stackoverflow.com/questions/51971592/how-to-use-value-of-a-string-to-refer-to-variables/51971626#51971626", "title": "How to use value of a string to refer to variables?", "body": "<p>You don\u2019t need any metaprogramming here. Just splat them:</p>\n\n<pre><code>ages = [age_1, age_2, age_3 ,..., age_8]\n#         \u21d3 HERE\nage_entry(*ages)\n</code></pre>\n\n<hr>\n\n<p>If you want to collect <code>age_(1..8)</code> into the array, assuming all local vars are defined, use <a href=\"https://ruby-doc.org/core/Kernel.html#method-i-binding\" rel=\"nofollow noreferrer\"><code>Kernel#binding</code></a>:</p>\n\n<pre><code>b = binding\nages = (1..8).map { |i| b.local_variable_get(\"age_#{i}\") }\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "reply_to_user": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1534959401, "post_id": 51971730, "comment_id": 90895103, "body": "@CarySwoveland I&#39;m just working with what was specified and the code there has these generic sequence-type variables, plus the question includes questions on adding up arbitrary numeric references to them. If these really are different, they should be labelled accordingly."}], "tags": [], "owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "is_accepted": false, "score": 3, "last_activity_date": 1534956931, "creation_date": 1534956931, "answer_id": 51971730, "question_id": 51971592, "link": "https://stackoverflow.com/questions/51971592/how-to-use-value-of-a-string-to-refer-to-variables/51971730#51971730", "title": "How to use value of a string to refer to variables?", "body": "<p>\"Some programmer\" should remember that you can pass in arrays. This sort of method signature is really obnoxious to work with for a multitude of reasons, some of them you've already discovered.</p>\n\n<p>One way to refactor this method and preserve functionality is to just take in <em>varargs</em>:</p>\n\n<pre><code>def age_entry(*ages)\nend\n</code></pre>\n\n<p>Now those values are put in an array for you but you can call the method the same way as before. As a plus you can specify more or fewer entries.</p>\n\n<p>Variables with names like <code>x1</code>, <code>x2</code> and so on are violations of the <a href=\"https://en.wikipedia.org/wiki/Zero_one_infinity_rule\" rel=\"nofollow noreferrer\">Zero, One or Infinity Rule</a> and are a sign you need to think about the problem differently.</p>\n"}, {"comments": [{"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1534972278, "post_id": 51973393, "comment_id": 90900804, "body": "This is the opposite of @mudasobwa&#39;s answer. He replaces the method&#39;s arguments with <code>*args</code> and then extracts the individual arguments as needed. I leave the individual arguments as is, and construct an array of their values."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1535057974, "post_id": 51973393, "comment_id": 90938093, "body": "well since you went all meta here why not <code>b = binding and b.local_variables.lazy.select(&amp;method(__method__).parameters&zwnj;&#8203;.map(&amp;:last).method(&zwnj;&#8203;:include?)).map(&amp;b.m&zwnj;&#8203;ethod(:local_variabl&zwnj;&#8203;e_get)).max</code> :)"}], "tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": false, "score": 1, "last_activity_date": 1534972123, "last_edit_date": 1534972123, "creation_date": 1534963919, "answer_id": 51973393, "question_id": 51971592, "link": "https://stackoverflow.com/questions/51971592/how-to-use-value-of-a-string-to-refer-to-variables/51973393#51973393", "title": "How to use value of a string to refer to variables?", "body": "<p>Suppose the method is as follows.</p>\n\n<pre><code>def oldest(age_bill, age_barb, age_trixie)\n  puts \"Barb is #{age_barb} years old\"\n  [age_bill, age_barb, age_trixie].max\nend\n\noldest(35, 97, 29)\n  #=&gt; 97\n</code></pre>\n\n<p>As well as the calculation in the penultimate line  (which the OP wishes to avoid), this method requires knowledge of an individual method argument (<code>age_barb</code>). The following is one way to accomplishing both requirements.</p>\n\n<pre><code>def oldest(age_bill, age_barb, age_trixie)\n  puts \"Barb is #{age_barb} years old\"\n  b = binding\n  args = method(__method__).parameters.map { |arg| b.local_variable_get(arg[1]) }\n  args.max\nend\n  #=&gt; 97\nBarb is 97 years old\n</code></pre>\n\n<p>Here</p>\n\n<pre><code>args\n  #=&gt; [35, 97, 29]\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 7919100, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-IHinH2h_t2U/AAAAAAAAAAI/AAAAAAAADIU/O-DG2I_d9RU/photo.jpg?sz=128", "display_name": "Damoon Imani", "link": "https://stackoverflow.com/users/7919100/damoon-imani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1534972123, "creation_date": 1534956380, "question_id": 51971592, "link": "https://stackoverflow.com/questions/51971592/how-to-use-value-of-a-string-to-refer-to-variables", "title": "How to use value of a string to refer to variables?", "body": "<p>Some programmer made a method that gets lots of arguements like this:</p>\n\n<pre><code>def age_entry(age_1, age_2, age_3, age_4, age_5, age_6, age_7, age_8)\nend\n</code></pre>\n\n<p>They could pass an array but simply they didn't. I love automation and hate to repeatedly add these variables to and array like this</p>\n\n<pre><code>ages = [age_1, age_2, age_3 ,..., age_8]\n</code></pre>\n\n<p>I would like to use metaprogramming or other ways to loop with a for or each methods to add them variables to an array like this:</p>\n\n<pre><code>(1..8).each do |index| do\n   ages &lt;&lt; \"age_\" + index #value of age_[index] get saved to ages\nend\n</code></pre>\n\n<p>P.S. I know I can use copy and paste but this is only for doing automation stuff with Ruby.</p>\n"}, {"tags": ["ruby", "selenium", "selenium-webdriver"], "comments": [{"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1534954516, "post_id": 51970990, "comment_id": 90892601, "body": "If you are ready to use ruby selenium binding use WATIR which sits in the top of selenium binding and also give the html to verify or HTML page."}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1534966113, "post_id": 51970990, "comment_id": 90898113, "body": "Place the HTML, Is your pop-up is the part of the web page ?"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 5389120, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1235e532f19e4b6f62a25f51a67cb5b4?s=128&d=identicon&r=PG&f=1", "display_name": "Pratapkumarv4", "link": "https://stackoverflow.com/users/5389120/pratapkumarv4"}, "edited": false, "score": 0, "creation_date": 1535036419, "post_id": 51971746, "comment_id": 90927085, "body": "Can please give it ruby with RSpec"}, {"owner": {"reputation": 10832, "user_id": 9800042, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nqmxr.jpg?s=128&g=1", "display_name": "Sers", "link": "https://stackoverflow.com/users/9800042/sers"}, "reply_to_user": {"reputation": 11, "user_id": 5389120, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1235e532f19e4b6f62a25f51a67cb5b4?s=128&d=identicon&r=PG&f=1", "display_name": "Pratapkumarv4", "link": "https://stackoverflow.com/users/5389120/pratapkumarv4"}, "edited": false, "score": 0, "creation_date": 1535038781, "post_id": 51971746, "comment_id": 90928649, "body": "I&#39;m not ruby guy but I&#39;ll try if have time. Hope you understood logic I tried to explain"}], "tags": [], "owner": {"reputation": 10832, "user_id": 9800042, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nqmxr.jpg?s=128&g=1", "display_name": "Sers", "link": "https://stackoverflow.com/users/9800042/sers"}, "is_accepted": false, "score": 0, "last_activity_date": 1534980202, "last_edit_date": 1534980202, "creation_date": 1534956964, "answer_id": 51971746, "question_id": 51970990, "link": "https://stackoverflow.com/questions/51970990/how-to-make-sure-only-one-checkbox-is-enabled-in-selenium/51971746#51971746", "title": "How to make sure only one checkbox is enabled in selenium", "body": "<p>Here's logic how you can verify that only one checkbox can be selected at a time using Java and TestNg assert:</p>\n\n<pre><code>List&lt;WebElement&gt; checkboxes = driver.findElements(By.cssSelector(\"input[type='checkbox']\"));\ncheckboxes.forEach(checkbox -&gt; {\n    checkbox.click();\n    for (WebElement element:driver.findElements(By.cssSelector(\"input[type='checkbox']\"))) {\n        if (element.equals(checkbox))\n            continue;\n        Assert.assertFalse(element.isSelected(), \"Other checkbox should be not checked\");\n    }\n});\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 739, "user_id": 5015695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60d2d919a3c7dd99b796db1982779e20?s=128&d=identicon&r=PG&f=1", "display_name": "irfan", "link": "https://stackoverflow.com/users/5015695/irfan"}, "is_accepted": false, "score": 1, "last_activity_date": 1535053471, "creation_date": 1535053471, "answer_id": 51993239, "question_id": 51970990, "link": "https://stackoverflow.com/questions/51970990/how-to-make-sure-only-one-checkbox-is-enabled-in-selenium/51993239#51993239", "title": "How to make sure only one checkbox is enabled in selenium", "body": "<p>use <code>isEnabled()</code>, which will check whether given WebElement is enabled or not :</p>\n\n<pre><code>boolean enabled = driver.findElement(By.xpath(\"//xpath of the checkbox\")).isEnabled();\n</code></pre>\n\n<p>if you want to check whether the checkbox is checked/selected or not, use <code>isSelected()</code> method as:</p>\n\n<pre><code>boolean checked = driver.findElement(By.xpath(\"//xpath of the checkbox\")).isSelected();\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 5389120, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1235e532f19e4b6f62a25f51a67cb5b4?s=128&d=identicon&r=PG&f=1", "display_name": "Pratapkumarv4", "link": "https://stackoverflow.com/users/5389120/pratapkumarv4"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1535053471, "creation_date": 1534954159, "question_id": 51970990, "link": "https://stackoverflow.com/questions/51970990/how-to-make-sure-only-one-checkbox-is-enabled-in-selenium", "title": "How to make sure only one checkbox is enabled in selenium", "body": "<p>I have scenario in my code\nOnce I click on  a checkbox in page,I will get a popup for it, which contains  some 5 checkboxes.</p>\n\n<p>Here,I am getting all the checkbox elements and putting in a list.</p>\n\n<p>But,I have to implement here, only one checkbox should be enabled.\nOnce I enable a check box ,i need to validate all other are disabled in that popup window.</p>\n\n<p>Please help me out on this.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "selenium", "cucumber", "capybara"], "answers": [{"tags": [], "owner": {"reputation": 42014, "user_id": 2709090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/238c2b7cde2c817fc9a5a2b8eaa2ffad?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Walpole", "link": "https://stackoverflow.com/users/2709090/thomas-walpole"}, "is_accepted": false, "score": 0, "last_activity_date": 1534955772, "last_edit_date": 1534955772, "creation_date": 1534954651, "answer_id": 51971131, "question_id": 51970510, "link": "https://stackoverflow.com/questions/51970510/how-to-read-or-get-the-request-payload-headers-in-the-browser-using-ruby/51971131#51971131", "title": "How to read or get the request payload headers in the browser using ruby", "body": "<p>tl;dr; You shouldn't be using Capybara to write API tests</p>\n\n<p>You're using the wrong tool for the job. Capybara is designed to test an application from the users perspective. Since a user doesn't really care about things like headers (just the affect they have in the browser) Capybara doesn't provide them. It's also why you had to go so far down in driver specific methods to get cookies - you really shouldn't be directly accessing those in Capybara driven tests either, just testing the behaviors the cookies control happen.</p>\n"}], "owner": {"reputation": 23, "user_id": 7404874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be058cc9362b60bfefe47001460eff0d?s=128&d=identicon&r=PG&f=1", "display_name": "Dhanabalan", "link": "https://stackoverflow.com/users/7404874/dhanabalan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 92, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1534955772, "creation_date": 1534952534, "question_id": 51970510, "link": "https://stackoverflow.com/questions/51970510/how-to-read-or-get-the-request-payload-headers-in-the-browser-using-ruby", "title": "How to read or get the request payload headers in the browser using ruby", "body": "<p>I managed to write a ruby script which uses capybara <code>(Capybara.current_session.driver.browser.manage.all_cookies)</code> to read the cookie from a browser. I could not find methods to read the complete request headers of a API. Like Method, Content-Type, Accept-language, CSRF etc.</p>\n\n<p>Can someone shed some lights please!</p>\n"}, {"tags": ["ruby", "ruby-on-rails-5"], "answers": [{"comments": [{"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 1, "creation_date": 1534951125, "post_id": 51969878, "comment_id": 90890580, "body": "It would be better to use a database query instead of <code>all?</code> but the direction is right."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "edited": false, "score": 0, "creation_date": 1534951376, "post_id": 51969878, "comment_id": 90890731, "body": "See edit #1 of the original question, just to make sure I&#39;m doing this correctly :)"}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1534956146, "post_id": 51969878, "comment_id": 90893542, "body": "@B.J.B you changed the question drastically with this &quot;update&quot;"}], "tags": [], "owner": {"reputation": 686, "user_id": 1491410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c938ed150a685b33d1b91266b382c8d?s=128&d=identicon&r=PG", "display_name": "elliotcm", "link": "https://stackoverflow.com/users/1491410/elliotcm"}, "is_accepted": false, "score": 2, "last_activity_date": 1534950460, "creation_date": 1534950460, "answer_id": 51969878, "question_id": 51969779, "link": "https://stackoverflow.com/questions/51969779/marking-a-course-as-complete-automatically-if-all-sub-modules-are-marked-as-comp/51969878#51969878", "title": "Marking a course as complete automatically if all sub modules are marked as complete rails 5", "body": "<p>You can do this in your controller or in an <code>after_save</code> in your model, but it'll look something like this:</p>\n\n<pre><code>course = course_module.course\ncourse.update(complete: true) if course.course_modules.all?(&amp;:complete?)\n</code></pre>\n\n<p>May require minor edits if the names don't quite match your schema.</p>\n"}, {"tags": [], "owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "is_accepted": false, "score": 1, "last_activity_date": 1534956297, "last_edit_date": 1534956297, "creation_date": 1534952910, "answer_id": 51970624, "question_id": 51969779, "link": "https://stackoverflow.com/questions/51969779/marking-a-course-as-complete-automatically-if-all-sub-modules-are-marked-as-comp/51970624#51970624", "title": "Marking a course as complete automatically if all sub modules are marked as complete rails 5", "body": "<p>Seems this logic would belong in the <code>CourseModule</code> not the <code>Course</code> since the <code>CourseModule</code> being completed is the trigger.</p>\n\n<p>Something akin to </p>\n\n<pre><code>class Course &lt; ApplicationRecord \n\n  def complete!\n    update_attribute(:complete,true) unless complete?\n  end\nend \n\nclass CourseModule &lt; ApplicationRecord\n  scope :completed, -&gt; {where(complete: true) }\n\n  after_save :update_course, if: :complete?\n\n  private\n    def update_course\n      course.complete! if course.course_modules.count == course.course_modules.completed.count\n    end\nend \n</code></pre>\n\n<p>If a <code>CourseModule</code> can become incomplete after being completed then you will have to change a bit of the logic here.  </p>\n"}, {"comments": [{"owner": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 0, "creation_date": 1534954087, "post_id": 51970794, "comment_id": 90892341, "body": "You have duplicate scopes with exact same criteria in model <code>CourseModule</code>."}, {"owner": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 0, "creation_date": 1534954660, "post_id": 51970794, "comment_id": 90892707, "body": "@BJB please see my edit. Hope it improves the code without adding any bugs. #NotTested"}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "reply_to_user": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 0, "creation_date": 1534956228, "post_id": 51970794, "comment_id": 90893582, "body": "@JagdeepSingh why would you not just post an answer?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "edited": false, "score": 0, "creation_date": 1534956259, "post_id": 51970794, "comment_id": 90893599, "body": "Yeah here&#39;s something I didn&#39;t think about. The course and modules are being marked as completed for all users, is there a way to do this by the user id?"}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1534956415, "post_id": 51970794, "comment_id": 90893689, "body": "@B.J.B you offered no insight into Course -&gt; User Relationships so we cannot assist with this without understanding that relationship as well"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1534956801, "post_id": 51970794, "comment_id": 90893874, "body": "@engineersmnky <a href=\"https://gyazo.com/e9d28bed78599d34695e79e4c5e4a917\" rel=\"nofollow noreferrer\">gyazo.com/e9d28bed78599d34695e79e4c5e4a917</a> <a href=\"https://gyazo.com/c91de147481d1ad803f5a2c632bdc049\" rel=\"nofollow noreferrer\">gyazo.com/c91de147481d1ad803f5a2c632bdc049</a> a course is able to has_many :users and a user has_many :courses"}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1534956965, "post_id": 51970794, "comment_id": 90893954, "body": "@B.J.B this should technically be a HABTM relationship in this case which will involve a join table. Also it means a <code>Course</code> can never be &quot;complete&quot; as completion is a state of the relationship not the <code>Course</code> itself. You will need to rethink your design a bit to make this work appropriately"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1534957359, "post_id": 51970794, "comment_id": 90894170, "body": "@engineersmnky So only the modules can be complete? Would it be worth creating a new question here to go about joining the table? Because I&#39;ve never dealt with a HABTM relationship before."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1534957483, "post_id": 51970794, "comment_id": 90894240, "body": "<i>So only the modules can be complete?</i> No nothing can be &quot;complete&quot;. <i>Would it be worth creating a new question here to go about joining the table?</i> Yes as this strays completely from the current question and to be honest the answers provided here will not really help you where you are going."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "is_accepted": false, "score": 0, "last_activity_date": 1534954616, "last_edit_date": 1534954616, "creation_date": 1534953457, "answer_id": 51970794, "question_id": 51969779, "link": "https://stackoverflow.com/questions/51969779/marking-a-course-as-complete-automatically-if-all-sub-modules-are-marked-as-comp/51970794#51970794", "title": "Marking a course as complete automatically if all sub modules are marked as complete rails 5", "body": "<p>So the answer to this question is a combination of both @elliotcm and @engineersmnky's answers.</p>\n\n<p>The final answer is this:</p>\n\n<p>course.rb</p>\n\n<pre><code>class Course &lt; ApplicationRecord\n  has_many :course_modules\n\n  def complete!\n    update_attribute(:complete, true)\n  end\nend\n</code></pre>\n\n<p>course_module.rb</p>\n\n<pre><code>class CourseModule &lt; ApplicationRecord\n  belongs_to :course\n\n  scope :completed, -&gt; { where(complete: true) }\n  scope :course_completed, -&gt; { where(complete: true) }\n\n  after_save :update_course, if: :complete?\n\n  private\n\n  def update_course\n    course.complete! if course.course_modules.all?(&amp;:complete?)\n  end\nend\n</code></pre>\n\n<p><strong>Thank you both for your help in this!</strong></p>\n\n<p><strong>Update</strong></p>\n\n<p>Above solution will run the callback on every save of <code>course_module</code> after it is complete. And will update the <code>course.complete</code> every time (if all its course modules are complete) even if it was already marked complete. Avoid all that by modifying the callbacks a bit:</p>\n\n<pre><code>class CourseModule &lt; ApplicationRecord\n  after_save :update_course, if: -&gt; { complete_changed? &amp;&amp; complete? }\n\n  private\n\n  def update_course\n    return if course.complete? || CourseModule.where(course_id: course_id, complete: false).exists?\n    course.complete!\n  end\nend\n</code></pre>\n\n<p><strong>Note:</strong> You also need to handle the case where a course_module get incompleted and so, its corresponding <code>course</code> also needs to be marked incomplete.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1534956297, "creation_date": 1534950129, "last_edit_date": 1534952899, "question_id": 51969779, "link": "https://stackoverflow.com/questions/51969779/marking-a-course-as-complete-automatically-if-all-sub-modules-are-marked-as-comp", "title": "Marking a course as complete automatically if all sub modules are marked as complete rails 5", "body": "<p><strong>Edit #1</strong></p>\n\n<p>Here is what I have now</p>\n\n<pre><code>&lt;% if course.complete? %&gt;\n  &lt;%= link_to \"Completed\", course, class: \"block text-lg w-full text-center text-white px-4 py-2 bg-green hover:bg-green-dark border-2 border-green-dark leading-none no-underline\" %&gt;\n&lt;% else %&gt;\n  &lt;%= link_to \"View Modules\", course, class: \"block text-lg w-full text-center text-grey-dark hover:text-darker px-4 py-2 border-2 border-grey leading-none no-underline hover:border-2 hover:border-grey-dark\" %&gt;\n&lt;% end %&gt;\n</code></pre>\n\n<p>course_module.rb</p>\n\n<pre><code>class CourseModule &lt; ApplicationRecord\n  extend FriendlyId\n  friendly_id :title, use: :slugged\n\n  belongs_to :course\n  has_many :course_exercises\n\n  validates :title, :course_id, presence: true\n\n  scope :completed, -&gt; { where(complete: true) }\n\n  after_save :course_completed\n\n  private\n\n  def course_completed\n    course = course_module.course\n    course.update(complete: true) if course.course_modules.all?(&amp;:complete?)\n  end\nend\n</code></pre>\n\n<p>The names match so no issues there, however, how would I go about calling the model method?</p>\n\n<p><strong>Original Question</strong></p>\n\n<p>Currently, I have courses and within the course I have modules both have complete columns which are a boolean, currently, students can complete modules by clicking on the tick like so</p>\n\n<p><img src=\"https://i.gyazo.com/8dc2ea81c1d09171473658d6e18d705f.png\" alt=\"image\"></p>\n\n<p>I have the courses database like so</p>\n\n<p><img src=\"https://i.gyazo.com/79e1bc9c9a52d39e17047a97b963f2c6.png\" alt=\"course\"></p>\n\n<p>and the modules table like so</p>\n\n<p><img src=\"https://i.gyazo.com/168fdd65d55624fb87e1e339ae0884f3.png\" alt=\"modules\"></p>\n\n<p>But I want the functionality to work so when the last module is marked as complete, the course itself gets marked as complete in the database, currently in the <code>course_modules_controller.rb</code> I have</p>\n\n<pre><code>def complete\n  @course_module = CourseModule.friendly.find(params[:id])\n  @course_module.complete = true\n  @course_module.save\n  redirect_to courses_path, notice: 'Module completed, congratulations!'\nend\n</code></pre>\n\n<p>This works for the modules, but I want to mark the course as complete if the last task has been marked as complete.</p>\n"}, {"tags": ["javascript", "ruby-on-rails", "ruby", "discourse"], "comments": [{"owner": {"reputation": 5312, "user_id": 6535997, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/10156345016155058/picture?type=large", "display_name": "Mark", "link": "https://stackoverflow.com/users/6535997/mark"}, "edited": false, "score": 2, "creation_date": 1534946355, "post_id": 51968414, "comment_id": 90887421, "body": "<a href=\"https://github.com/bokmann/font-awesome-rails\" rel=\"nofollow noreferrer\">github.com/bokmann/font-awesome-rails</a> is probably the easiest way"}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1534949128, "post_id": 51968414, "comment_id": 90889340, "body": "Whether you need only three of them, would not it be easier to just copy-paste emojis \ud83d\udcac \ud83d\udd0d \u2263 ?"}], "owner": {"reputation": 165, "user_id": 4613255, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ea7016902c524690bb7767ac68d7e15a?s=128&d=identicon&r=PG", "display_name": "mohammad mahmoodi", "link": "https://stackoverflow.com/users/4613255/mohammad-mahmoodi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 95, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1534945794, "creation_date": 1534945794, "question_id": 51968414, "link": "https://stackoverflow.com/questions/51968414/how-to-include-fontawesome-icons-in-discourse-posts", "title": "How to include fontawesome icons in discourse posts?", "body": "<p>I\u2019ve seen this in the past and would love to be able to include fontawesome icons on a regular basis. Can\u2019t find it! For right now if someone could help me with a hack I\u2019d be grateful. I want to embed the fa-comments, fa-search and fa-sandwich (or whatever it\u2019s called) in a post explaining discourse features.</p>\n\n<p>Down the road\u2026 perhaps there\u2019d even be appetite for a plugin to support fa tags as emoji? Came across this interesting page:</p>\n\n<p><a href=\"https://pypi.python.org/pypi/fontawesome-markdown\" rel=\"nofollow noreferrer\">https://pypi.python.org/pypi/fontawesome-markdown</a></p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-4", "devise"], "comments": [{"owner": {"reputation": 175, "user_id": 3528784, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/J1nEe.png?s=128&g=1", "display_name": "Mordred", "link": "https://stackoverflow.com/users/3528784/mordred"}, "reply_to_user": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 0, "creation_date": 1534944421, "post_id": 51967900, "comment_id": 90886092, "body": "Yes, I did, In a custom registrations_controller and also in applications_controller because I wasnt sure which one was actually controlling it."}, {"owner": {"reputation": 175, "user_id": 3528784, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/J1nEe.png?s=128&g=1", "display_name": "Mordred", "link": "https://stackoverflow.com/users/3528784/mordred"}, "reply_to_user": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 0, "creation_date": 1534944592, "post_id": 51967900, "comment_id": 90886217, "body": "Alright, I will do that and see if it works"}, {"owner": {"reputation": 175, "user_id": 3528784, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/J1nEe.png?s=128&g=1", "display_name": "Mordred", "link": "https://stackoverflow.com/users/3528784/mordred"}, "reply_to_user": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 0, "creation_date": 1534944780, "post_id": 51967900, "comment_id": 90886371, "body": "I have removed it, still the same error."}, {"owner": {"reputation": 175, "user_id": 3528784, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/J1nEe.png?s=128&g=1", "display_name": "Mordred", "link": "https://stackoverflow.com/users/3528784/mordred"}, "reply_to_user": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 0, "creation_date": 1534945005, "post_id": 51967900, "comment_id": 90886509, "body": "I have done that"}, {"owner": {"reputation": 9125, "user_id": 671422, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/85da2a1fa3e4017815ff5d3a3d70fabe?s=128&d=identicon&r=PG", "display_name": "Yule", "link": "https://stackoverflow.com/users/671422/yule"}, "edited": false, "score": 0, "creation_date": 1534945588, "post_id": 51967900, "comment_id": 90886916, "body": "change <code>dashboard_path</code> to <code>dashboards_path</code> ?"}, {"owner": {"reputation": 175, "user_id": 3528784, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/J1nEe.png?s=128&g=1", "display_name": "Mordred", "link": "https://stackoverflow.com/users/3528784/mordred"}, "reply_to_user": {"reputation": 9125, "user_id": 671422, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/85da2a1fa3e4017815ff5d3a3d70fabe?s=128&d=identicon&r=PG", "display_name": "Yule", "link": "https://stackoverflow.com/users/671422/yule"}, "edited": false, "score": 0, "creation_date": 1534945830, "post_id": 51967900, "comment_id": 90887083, "body": "Do you have any particular reason why? the path to <code>&#47;dashboard</code> is <code>dashboard_path</code> in my routes"}, {"owner": {"reputation": 5312, "user_id": 6535997, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/10156345016155058/picture?type=large", "display_name": "Mark", "link": "https://stackoverflow.com/users/6535997/mark"}, "edited": false, "score": 0, "creation_date": 1534945856, "post_id": 51967900, "comment_id": 90887099, "body": "If dashboard_path is a valid path, then it suggests you&#39;re not hitting this method. Try putting a binding.pry just before the dashboard_path and see if it gets hit or not"}, {"owner": {"reputation": 175, "user_id": 3528784, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/J1nEe.png?s=128&g=1", "display_name": "Mordred", "link": "https://stackoverflow.com/users/3528784/mordred"}, "edited": false, "score": 0, "creation_date": 1534946525, "post_id": 51967900, "comment_id": 90887517, "body": "I think after_sign_in_path would be executed after a successful sign in or sesssion creation. Sign in isnt sucessful, so it makes sense that it wont hit dashboard_path just yet"}, {"owner": {"reputation": 1597, "user_id": 717626, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/303d9f5c2135f14f277775052bcb131b?s=128&d=identicon&r=PG", "display_name": "Aaron Breckenridge", "link": "https://stackoverflow.com/users/717626/aaron-breckenridge"}, "edited": false, "score": 0, "creation_date": 1534960016, "post_id": 51967900, "comment_id": 90895396, "body": "It&#39;s trying to redirect to a route like <code>&#47;controllers&#47;:id</code>. <code>&#47;controllers&#47;...</code> doesn&#39;t sound like a valid destination. Any chance you have bad data in the <code>session[:return_to]</code>?"}, {"owner": {"reputation": 175, "user_id": 3528784, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/J1nEe.png?s=128&g=1", "display_name": "Mordred", "link": "https://stackoverflow.com/users/3528784/mordred"}, "edited": false, "score": 0, "creation_date": 1534960156, "post_id": 51967900, "comment_id": 90895468, "body": "Can you elaborate a little bit more? does this also mean the session won&#39;t be created at all?"}, {"owner": {"reputation": 4690, "user_id": 1937435, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YyN37.jpg?s=128&g=1", "display_name": "Josh Brody", "link": "https://stackoverflow.com/users/1937435/josh-brody"}, "edited": false, "score": 0, "creation_date": 1534985860, "post_id": 51967900, "comment_id": 90904076, "body": "what does your routes.rb look like?"}, {"owner": {"reputation": 1831, "user_id": 4160532, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Ey34JagqMzQ/AAAAAAAAAAI/AAAAAAAAABo/G70W8D2LXM4/photo.jpg?sz=128", "display_name": "Kedarnag Mukanahallipatna", "link": "https://stackoverflow.com/users/4160532/kedarnag-mukanahallipatna"}, "reply_to_user": {"reputation": 1597, "user_id": 717626, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/303d9f5c2135f14f277775052bcb131b?s=128&d=identicon&r=PG", "display_name": "Aaron Breckenridge", "link": "https://stackoverflow.com/users/717626/aaron-breckenridge"}, "edited": false, "score": 0, "creation_date": 1535012890, "post_id": 51967900, "comment_id": 90912471, "body": "Please share your <code>routes.rb</code>. Like @AaronBreckenridge mentioned after login, it&#39;s trying to redirect to a route with <code>:id</code>."}, {"owner": {"reputation": 175, "user_id": 3528784, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/J1nEe.png?s=128&g=1", "display_name": "Mordred", "link": "https://stackoverflow.com/users/3528784/mordred"}, "edited": false, "score": 0, "creation_date": 1535025069, "post_id": 51967900, "comment_id": 90919596, "body": "I just updated the question with my <code>routes.rb</code>"}, {"owner": {"reputation": 1890, "user_id": 1895126, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/e2c4ee577e92de928b58ad3b3180b1e7?s=128&d=identicon&r=PG", "display_name": "Elijah Murray", "link": "https://stackoverflow.com/users/1895126/elijah-murray"}, "edited": false, "score": 0, "creation_date": 1550252805, "post_id": 51967900, "comment_id": 96214789, "body": "Did you ever find the solution to this?"}], "owner": {"reputation": 175, "user_id": 3528784, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/J1nEe.png?s=128&g=1", "display_name": "Mordred", "link": "https://stackoverflow.com/users/3528784/mordred"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 219, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1535025018, "creation_date": 1534944132, "last_edit_date": 1535025018, "question_id": 51967900, "link": "https://stackoverflow.com/questions/51967900/url-generation-error-missing-required-keys-id-on-devise-login", "title": "Url Generation Error (Missing Required Keys :id) on devise login", "body": "<p>I have a rails 4 application, I have been working on it for quite a while and Register and Login worked until I added a few things and users cannot log in anymore and I can't figure out what it is I did and now I cannot start a session.\nThis is the exact error;</p>\n\n<pre><code>ActionController::UrlGenerationError in SessionsController#create\nNo route matches {:action=&gt;\"show\", :controller=&gt;\"controllers\"} missing required keys: [:id]\n</code></pre>\n\n<p>Before you point me to other questions like this, I have gone through every single on of them and none of them seem to be related to devise's session controller.\nHere is my full stack trace;</p>\n\n<pre><code>actionpack (4.2.10) lib/action_dispatch/journey/formatter.rb:46:in `generate'\nactionpack (4.2.10) lib/action_dispatch/routing/route_set.rb:721:in `generate'\nactionpack (4.2.10) lib/action_dispatch/routing/route_set.rb:752:in `generate'\nactionpack (4.2.10) lib/action_dispatch/routing/route_set.rb:799:in `url_for'\nactionpack (4.2.10) lib/action_dispatch/routing/route_set.rb:280:in `call'\nactionpack (4.2.10) lib/action_dispatch/routing/route_set.rb:223:in `call'\nactionpack (4.2.10) lib/action_dispatch/routing/route_set.rb:345:in `block (2 levels) in define_url_helper'\ndevise (4.4.3) app/controllers/devise/sessions_controller.rb:48:in `auth_options'\napp/controllers/sessions_controller.rb:7:in `create'\nactionpack (4.2.10) lib/action_controller/metal/implicit_render.rb:4:in `send_action'\nactionpack (4.2.10) lib/abstract_controller/base.rb:198:in `process_action'\nactionpack (4.2.10) lib/action_controller/metal/rendering.rb:10:in `process_action'\nactionpack (4.2.10) lib/abstract_controller/callbacks.rb:20:in `block in process_action'\nactivesupport (4.2.10) lib/active_support/callbacks.rb:117:in `call'\nactivesupport (4.2.10) lib/active_support/callbacks.rb:555:in `block (2 levels) in compile'\nactivesupport (4.2.10) lib/active_support/callbacks.rb:505:in `call'\nactivesupport (4.2.10) lib/active_support/callbacks.rb:92:in `__run_callbacks__'\nactivesupport (4.2.10) lib/active_support/callbacks.rb:778:in `_run_process_action_callbacks'\nactivesupport (4.2.10) lib/active_support/callbacks.rb:81:in `run_callbacks'\nactionpack (4.2.10) lib/abstract_controller/callbacks.rb:19:in `process_action'\nactionpack (4.2.10) lib/action_controller/metal/rescue.rb:29:in `process_action'\nactionpack (4.2.10) lib/action_controller/metal/instrumentation.rb:32:in `block in process_action'\nactivesupport (4.2.10) lib/active_support/notifications.rb:164:in `block in instrument'\nactivesupport (4.2.10) lib/active_support/notifications/instrumenter.rb:20:in `instrument'\nactivesupport (4.2.10) lib/active_support/notifications.rb:164:in `instrument'\nactionpack (4.2.10) lib/action_controller/metal/instrumentation.rb:30:in `process_action'\nactionpack (4.2.10) lib/action_controller/metal/params_wrapper.rb:250:in `process_action'\nactiverecord (4.2.10) lib/active_record/railties/controller_runtime.rb:18:in `process_action'\nactionpack (4.2.10) lib/abstract_controller/base.rb:137:in `process'\nactionview (4.2.10) lib/action_view/rendering.rb:30:in `process'\nactionpack (4.2.10) lib/action_controller/metal.rb:196:in `dispatch'\nactionpack (4.2.10) lib/action_controller/metal/rack_delegation.rb:13:in `dispatch'\nactionpack (4.2.10) lib/action_controller/metal.rb:237:in `block in action'\nactionpack (4.2.10) lib/action_dispatch/routing/route_set.rb:74:in `dispatch'\nactionpack (4.2.10) lib/action_dispatch/routing/route_set.rb:43:in `serve'\nactionpack (4.2.10) lib/action_dispatch/routing/mapper.rb:49:in `serve'\nactionpack (4.2.10) lib/action_dispatch/journey/router.rb:43:in `block in serve'\nactionpack (4.2.10) lib/action_dispatch/journey/router.rb:30:in `each'\nactionpack (4.2.10) lib/action_dispatch/journey/router.rb:30:in `serve'\nactionpack (4.2.10) lib/action_dispatch/routing/route_set.rb:817:in `call'\nwarden (1.2.7) lib/warden/manager.rb:36:in `block in call'\nwarden (1.2.7) lib/warden/manager.rb:35:in `catch'\nwarden (1.2.7) lib/warden/manager.rb:35:in `call'\nrack (1.6.10) lib/rack/etag.rb:24:in `call'\nrack (1.6.10) lib/rack/conditionalget.rb:38:in `call'\nrack (1.6.10) lib/rack/head.rb:13:in `call'\nactionpack (4.2.10) lib/action_dispatch/middleware/params_parser.rb:27:in `call'\nactionpack (4.2.10) lib/action_dispatch/middleware/flash.rb:260:in `call'\nrack (1.6.10) lib/rack/session/abstract/id.rb:225:in `context'\nrack (1.6.10) lib/rack/session/abstract/id.rb:220:in `call'\nactionpack (4.2.10) lib/action_dispatch/middleware/cookies.rb:560:in `call'\nactiverecord (4.2.10) lib/active_record/query_cache.rb:36:in `call'\nactiverecord (4.2.10) lib/active_record/connection_adapters/abstract/connection_pool.rb:653:in `call'\nactiverecord (4.2.10) lib/active_record/migration.rb:377:in `call'\nactionpack (4.2.10) lib/action_dispatch/middleware/callbacks.rb:29:in `block in call'\nactivesupport (4.2.10) lib/active_support/callbacks.rb:88:in `__run_callbacks__'\nactivesupport (4.2.10) lib/active_support/callbacks.rb:778:in `_run_call_callbacks'\nactivesupport (4.2.10) lib/active_support/callbacks.rb:81:in `run_callbacks'\nactionpack (4.2.10) lib/action_dispatch/middleware/callbacks.rb:27:in `call'\nactionpack (4.2.10) lib/action_dispatch/middleware/reloader.rb:73:in `call'\nactionpack (4.2.10) lib/action_dispatch/middleware/remote_ip.rb:78:in `call'\nactionpack (4.2.10) lib/action_dispatch/middleware/debug_exceptions.rb:17:in `call'\nactionpack (4.2.10) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'\nrailties (4.2.10) lib/rails/rack/logger.rb:38:in `call_app'\nrailties (4.2.10) lib/rails/rack/logger.rb:20:in `block in call'\nactivesupport (4.2.10) lib/active_support/tagged_logging.rb:68:in `block in tagged'\nactivesupport (4.2.10) lib/active_support/tagged_logging.rb:26:in `tagged'\nactivesupport (4.2.10) lib/active_support/tagged_logging.rb:68:in `tagged'\nrailties (4.2.10) lib/rails/rack/logger.rb:20:in `call'\nactionpack (4.2.10) lib/action_dispatch/middleware/request_id.rb:21:in `call'\nrack (1.6.10) lib/rack/methodoverride.rb:22:in `call'\nrack (1.6.10) lib/rack/runtime.rb:18:in `call'\nactivesupport (4.2.10) lib/active_support/cache/strategy/local_cache_middleware.rb:28:in `call'\nrack (1.6.10) lib/rack/lock.rb:17:in `call'\nactionpack (4.2.10) lib/action_dispatch/middleware/static.rb:120:in `call'\nrack (1.6.10) lib/rack/sendfile.rb:113:in `call'\nrailties (4.2.10) lib/rails/engine.rb:518:in `call'\nrailties (4.2.10) lib/rails/application.rb:165:in `call'\nrack (1.6.10) lib/rack/lock.rb:17:in `call'\nrack (1.6.10) lib/rack/content_length.rb:15:in `call'\nrack (1.6.10) lib/rack/handler/webrick.rb:88:in `service'\nC:/Ruby23-x64/lib/ruby/2.3.0/webrick/httpserver.rb:140:in `service'\nC:/Ruby23-x64/lib/ruby/2.3.0/webrick/httpserver.rb:96:in `run'\nC:/Ruby23-x64/lib/ruby/2.3.0/webrick/server.rb:296:in `block in start_thread'\n</code></pre>\n\n<p>Now I realize that the error is pointing me to my session controller, line 7, I also have no idea why. But here is my session controller's contents in case;</p>\n\n<pre><code>class SessionsController &lt; Devise::SessionsController\n    def new\n      super\n    end\n\n    def create\n      self.resource = warden.authenticate!(auth_options)\n      set_flash_message(:notice, :signed_in) if is_navigational_format?\n      sign_in(resource_name, resource)\n      if !session[:return_to].blank?\n        redirect_to session[:return_to]\n        session[:return_to] = nil\n      else\n        respond_with resource, :location =&gt; after_sign_in_path_for(resource)\n      end\n    end\n  end\n</code></pre>\n\n<p>Please note that I overrode (if there's any such word) my sessions controller in na attempt to try to fix the error, but I still come up with the same thing.\nPlease let me know if you need any more of my code to be able to point me in the right direction.</p>\n\n<p>I am also overriding after_sign_in_path_for in application_controller as someone suggested, but it is still the same error.\nThis is it</p>\n\n<pre><code>def after_sign_in_path_for(users)\n    flash[:notice] = nil\n    dashboard_path\n  end\n</code></pre>\n\n<p>Here is my <code>routes.rb</code> file as requested for.</p>\n\n<pre><code>Rails.application.routes.draw do\n  resources :confirmeds\n  resources :confirmings\n  resources :donates\n  resources :respondings\n  resources :confirmings\n  resources :controllers\n  resources :referrals\n\n\n\n\n  devise_for :users, controllers: { registrations: \"registrations\"}\n\n\n\n  resources :welcome\n\n  get '/dashboard' =&gt; 'welcome#dashboard'\n  post '/dashboard' =&gt; 'welcome#dashboard'\n\n  get '/registered' =&gt; 'welcome#registered'\n  post '/registered' =&gt; 'welcome#registered'\n\n  get '/error' =&gt; 'welcome#error'\n  post '/error' =&gt; 'welcome#error'\n\n  get '/error2' =&gt; 'welcome#error2'\n  post '/error2' =&gt; 'welcome#error2'\n\n  get '/level' =&gt; 'welcome#level'\n  post '/level' =&gt; 'welcome#level'\n\n  get '/referralid' =&gt; 'welcome#referralid'\n  post '/referralid' =&gt; 'welcome#referralid'\n\n  get '/report' =&gt; 'welcome#report'\n  post '/report' =&gt; 'welcome#report'\n\n  # The priority is based upon order of creation: first created -&gt; highest priority.\n  # See how all your routes lay out with \"rake routes\".\n\n  # You can have the root of your site routed with \"root\"\n   root 'welcome#index'\n\n  # Example of regular route:\n  #   get 'products/:id' =&gt; 'catalog#view'\n\n  # Example of named route that can be invoked with purchase_url(id: product.id)\n  #   get 'products/:id/purchase' =&gt; 'catalog#purchase', as: :purchase\n\n  # Example resource route (maps HTTP verbs to controller actions automatically):\n  #   resources :products\n\n  # Example resource route with options:\n  #   resources :products do\n  #     member do\n  #       get 'short'\n  #       post 'toggle'\n  #     end\n  #\n  #     collection do\n  #       get 'sold'\n  #     end\n  #   end\n\n  # Example resource route with sub-resources:\n  #   resources :products do\n  #     resources :comments, :sales\n  #     resource :seller\n  #   end\n\n  # Example resource route with more complex sub-resources:\n  #   resources :products do\n  #     resources :comments\n  #     resources :sales do\n  #       get 'recent', on: :collection\n  #     end\n  #   end\n\n  # Example resource route with concerns:\n  #   concern :toggleable do\n  #     post 'toggle'\n  #   end\n  #   resources :posts, concerns: :toggleable\n  #   resources :photos, concerns: :toggleable\n\n  # Example resource route within a namespace:\n  #   namespace :admin do\n  #     # Directs /admin/products/* to Admin::ProductsController\n  #     # (app/controllers/admin/products_controller.rb)\n  #     resources :products\n  #   end\nend\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "activerecord", "rails-i18n", "activemodel"], "answers": [{"tags": [], "owner": {"reputation": 1768, "user_id": 7672985, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a6233938657e3693fca648b313da8557?s=128&d=identicon&r=PG", "display_name": "Gabriel Mesquita", "link": "https://stackoverflow.com/users/7672985/gabriel-mesquita"}, "is_accepted": false, "score": 0, "last_activity_date": 1534944281, "creation_date": 1534944281, "answer_id": 51967951, "question_id": 51967652, "link": "https://stackoverflow.com/questions/51967652/how-to-translate-with-i18n-using-active-model-attributes-gem/51967951#51967951", "title": "How to translate with I18n using active_model_attributes gem?", "body": "<p>So after some research I found the answer to this problem.</p>\n\n<p>The problem is that I was dealing with ActiveModel and not ActiveRecord, and besides that my class is inside some modules. So to make it work I need to do the following changes:</p>\n\n<pre><code>activemodel:\n attributes:\n  module1/module2/module3/class_name:\n   attribute: 'attribute'\n</code></pre>\n\n<p>So when working with modules the definition is like this:</p>\n\n<pre><code>module1/module2/module3/class_name:\n</code></pre>\n\n<p>And when working with the active_model_attributes it is necessary to define under activemodel and not activerecord</p>\n"}], "owner": {"reputation": 1768, "user_id": 7672985, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a6233938657e3693fca648b313da8557?s=128&d=identicon&r=PG", "display_name": "Gabriel Mesquita", "link": "https://stackoverflow.com/users/7672985/gabriel-mesquita"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1534944351, "creation_date": 1534943299, "last_edit_date": 1534944351, "question_id": 51967652, "link": "https://stackoverflow.com/questions/51967652/how-to-translate-with-i18n-using-active-model-attributes-gem", "title": "How to translate with I18n using active_model_attributes gem?", "body": "<p>I am using the active_model_attributes gem to define attributes and use validations in classes that do not inherit from ActiveRecord.</p>\n\n<p>I am dealing with the errors when those validations fail. I am raising an exception when the model is not valid like this:</p>\n\n<pre><code>unless self.valid?\n  raise Lib::Commands::BaseException.new(self.errors.full_messages)\nend\n</code></pre>\n\n<p>After that I perform a rescue operation and call a Proc to redirect the user with the error message:</p>\n\n<pre><code>rescue ::Lib::Commands::BaseException =&gt; exception\n  error.call(params[:id], exception.message)\n</code></pre>\n\n<p>The problem is that I need to translate the model attributes name when displaying the error message to the user. I am following <a href=\"https://guides.rubyonrails.org/i18n.html\" rel=\"nofollow noreferrer\">this link</a> to organize my translation file like this:</p>\n\n<pre><code>activerecord:\n models:\n  model:\n   attributes:\n    attribute: '' \n</code></pre>\n\n<p>Any ideas? Thanks in advance.</p>\n"}, {"tags": ["ruby", "ruby-on-rails-5"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "edited": false, "score": 0, "creation_date": 1534942346, "post_id": 51967310, "comment_id": 90884625, "body": "Ohh I also tried <code>&lt;%= CourseModule.count(:complete) %&gt;</code> so I was close haha. Thank you."}, {"owner": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 0, "creation_date": 1534942505, "post_id": 51967310, "comment_id": 90884739, "body": "Yeah. Check the updated answer for a more usable approach."}], "tags": [], "owner": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "is_accepted": true, "score": 1, "last_activity_date": 1534942469, "last_edit_date": 1534942469, "creation_date": 1534942261, "answer_id": 51967310, "question_id": 51967250, "link": "https://stackoverflow.com/questions/51967250/get-complete-count-from-database-rails-5/51967310#51967310", "title": "Get complete count from database rails 5", "body": "<p>You can scope your collection with a <a href=\"https://apidock.com/rails/ActiveRecord/QueryMethods/where\" rel=\"nofollow noreferrer\"><code>where</code></a> query:</p>\n\n<pre><code>&lt;%= CourseModule.where(complete: true).count %&gt;\n</code></pre>\n\n<p>Or to use it at multiple places, define a <a href=\"https://guides.rubyonrails.org/active_record_querying.html#scopes\" rel=\"nofollow noreferrer\">scope</a> in your model <code>CourseModule</code> as below:</p>\n\n<pre><code>class CourseModule\n  scope :completed, -&gt; { where(complete: true) }\nend\n</code></pre>\n\n<p>and use it everywhere as follows:</p>\n\n<pre><code>CourseModule.completed\n # =&gt; ActiveRecord Relation of completed records\n\nCourseModule.completed.count\n # =&gt; Count of completed records\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 26, "favorite_count": 0, "accepted_answer_id": 51967310, "answer_count": 1, "score": 0, "last_activity_date": 1534942469, "creation_date": 1534942063, "question_id": 51967250, "link": "https://stackoverflow.com/questions/51967250/get-complete-count-from-database-rails-5", "title": "Get complete count from database rails 5", "body": "<p>I'm working on a dashboard where I want to get a count based on a boolean record because students can click whether they have completed a module or not, here is the boolean in the database.</p>\n\n<p><img src=\"https://i.gyazo.com/efe3fd347cf4cd379c77e954bae7fab4.png\" alt=\"database\"></p>\n\n<p>On the dashboard I have</p>\n\n<p><img src=\"https://i.gyazo.com/464c7555a6db925de513618823f3111f.png\" alt=\"dash\"></p>\n\n<p>I can get the full module count by doing this <code>&lt;%= CourseModule.count %&gt;</code> but I want to set the complete count only.</p>\n"}, {"tags": ["ruby", "httparty"], "answers": [{"comments": [{"owner": {"reputation": 855, "user_id": 3759265, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/19a877022888fb56ba9c69541a3f09db?s=128&d=identicon&r=PG&f=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/3759265/tom"}, "edited": false, "score": 0, "creation_date": 1534942197, "post_id": 51966854, "comment_id": 90884520, "body": "I got completely confused.  {&#39;X-Correlation-ID&#39;: uuid} worked.  Thnak you"}], "tags": [], "owner": {"reputation": 686, "user_id": 1491410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c938ed150a685b33d1b91266b382c8d?s=128&d=identicon&r=PG", "display_name": "elliotcm", "link": "https://stackoverflow.com/users/1491410/elliotcm"}, "is_accepted": true, "score": 2, "last_activity_date": 1534940708, "creation_date": 1534940708, "answer_id": 51966854, "question_id": 51966631, "link": "https://stackoverflow.com/questions/51966631/httparty-x-correlation-id/51966854#51966854", "title": "HTTParty X-Correlation_Id", "body": "<p>Pop it into your <code>headers</code> hash as another entry, the same way you've done for <code>'Content-Type'</code> and <code>'Authentication'</code>.</p>\n\n<p>Headers which start with <code>X</code> tend to be custom ones, and so you won't find something built in to most HTTP clients for it, but they all support arbitrary headers like this.</p>\n"}], "owner": {"reputation": 855, "user_id": 3759265, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/19a877022888fb56ba9c69541a3f09db?s=128&d=identicon&r=PG&f=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/3759265/tom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 0, "accepted_answer_id": 51966854, "answer_count": 1, "score": 0, "last_activity_date": 1534940708, "creation_date": 1534939986, "question_id": 51966631, "link": "https://stackoverflow.com/questions/51966631/httparty-x-correlation-id", "title": "HTTParty X-Correlation_Id", "body": "<p>I'm trying to figure out HTTParty.  I have an endpoint I need to post to.</p>\n\n<p>It won't let me post without setting an X-Correlation-Id according to the Swagger documentation.</p>\n\n<p>I can't see an option in HTTParty to do this.</p>\n\n<p>my current connection attempt is:</p>\n\n<pre><code>uuid =  SecureRandom.uuid\nurl = 'http://localhost:8720/v1/bla'\nconn = HTTParty.post(url, body: body.to_json, headers: {'Content-Type' =&gt; 'application/json','Authentication' =&gt; \"Token #{uuid}\"})\n</code></pre>\n\n<p>I keep get an error response from the API stating the X-Correlation-Id is a mandatory field.  Is there something obvious I'm missing? Thanks</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 6628353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d429befa71519d698078a86913d7515?s=128&d=identicon&r=PG&f=1", "display_name": "Stan Derksen", "link": "https://stackoverflow.com/users/6628353/stan-derksen"}, "edited": false, "score": 0, "creation_date": 1534940252, "post_id": 51966681, "comment_id": 90883273, "body": "thank you for your quick reply. The problem I have with adding an article_id in the operations table is that a single instance of Operation can belong to numerous articles. Having the article_id in the operations table is not feasable then (at least, I think)"}, {"owner": {"reputation": 5312, "user_id": 6535997, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/10156345016155058/picture?type=large", "display_name": "Mark", "link": "https://stackoverflow.com/users/6535997/mark"}, "reply_to_user": {"reputation": 53, "user_id": 6628353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d429befa71519d698078a86913d7515?s=128&d=identicon&r=PG&f=1", "display_name": "Stan Derksen", "link": "https://stackoverflow.com/users/6628353/stan-derksen"}, "edited": false, "score": 0, "creation_date": 1534940308, "post_id": 51966681, "comment_id": 90883309, "body": "Apologies I skimread your question - it looks like you want an article to belong_to an operation rather than having one? I&#39;ll update my answer"}, {"owner": {"reputation": 53, "user_id": 6628353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d429befa71519d698078a86913d7515?s=128&d=identicon&r=PG&f=1", "display_name": "Stan Derksen", "link": "https://stackoverflow.com/users/6628353/stan-derksen"}, "edited": false, "score": 0, "creation_date": 1534940365, "post_id": 51966681, "comment_id": 90883352, "body": "I think that is what I want, apologies, I&#39;m struggling with RoR associations still."}, {"owner": {"reputation": 53, "user_id": 6628353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d429befa71519d698078a86913d7515?s=128&d=identicon&r=PG&f=1", "display_name": "Stan Derksen", "link": "https://stackoverflow.com/users/6628353/stan-derksen"}, "edited": false, "score": 0, "creation_date": 1534940622, "post_id": 51966681, "comment_id": 90883516, "body": "Thanks a lot, it makes sense now. I can now access the operation via an article, exactly what I wanted, thanks! edit: can accept in 3 minutes"}, {"owner": {"reputation": 5312, "user_id": 6535997, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/10156345016155058/picture?type=large", "display_name": "Mark", "link": "https://stackoverflow.com/users/6535997/mark"}, "reply_to_user": {"reputation": 53, "user_id": 6628353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d429befa71519d698078a86913d7515?s=128&d=identicon&r=PG&f=1", "display_name": "Stan Derksen", "link": "https://stackoverflow.com/users/6628353/stan-derksen"}, "edited": false, "score": 0, "creation_date": 1534943455, "post_id": 51966681, "comment_id": 90885401, "body": "No worries! Happy to help :)"}], "tags": [], "owner": {"reputation": 5312, "user_id": 6535997, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/10156345016155058/picture?type=large", "display_name": "Mark", "link": "https://stackoverflow.com/users/6535997/mark"}, "is_accepted": true, "score": 2, "last_activity_date": 1534940536, "last_edit_date": 1534940536, "creation_date": 1534940113, "answer_id": 51966681, "question_id": 51966603, "link": "https://stackoverflow.com/questions/51966603/ruby-on-rails-5-one-to-many-association/51966681#51966681", "title": "Ruby on Rails 5 one to many association", "body": "<p>From the looks of it you need to establish a 'belongs_to' relationship between articles and operations.</p>\n\n<p>Change</p>\n\n<pre><code>has_one :operation\n</code></pre>\n\n<p>to</p>\n\n<pre><code>belongs_to :operation\n</code></pre>\n\n<p>And in your operation model:</p>\n\n<pre><code>has_many :articles\n</code></pre>\n\n<p>You'll need to give your articles an operation_id:</p>\n\n<pre><code>rails g migration addOperationIdToArticles operation_id:integer\nrake db:migrate\n</code></pre>\n\n<p>Then try the command again. At the moment no articles have an operation_id, so none will belong to any operations, however you can assign a relationship with:</p>\n\n<pre><code>article.update_attributes(operation_id: whatever)\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 6628353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d429befa71519d698078a86913d7515?s=128&d=identicon&r=PG&f=1", "display_name": "Stan Derksen", "link": "https://stackoverflow.com/users/6628353/stan-derksen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "accepted_answer_id": 51966681, "answer_count": 1, "score": 0, "last_activity_date": 1534942328, "creation_date": 1534939926, "last_edit_date": 1534942328, "question_id": 51966603, "link": "https://stackoverflow.com/questions/51966603/ruby-on-rails-5-one-to-many-association", "title": "Ruby on Rails 5 one to many association", "body": "<p>I'm struggling with a basic ruby on rails association. I have an Article which has an Operation. An operation can however belong to many instances of Article. In the Article class I have specified <code>has_one :operation</code>. The Articles table has a operation_id column of type integer. When I try to access the Operation on an instance of Article (article) in the tests: <code>puts article.operation</code> I get the following error:</p>\n\n<blockquote>\n  <p>ArticleTest#test_test: ActiveRecord::StatementInvalid:\n  SQLite3::SQLException: no such column: operations.article_id: SELECT \n  \"operations\".* FROM \"operations\" WHERE \"operations\".\"article_id\" = ?\n  LIMIT ?\n      test/models/article_test.rb:6:in block in </p>\n</blockquote>\n\n<p>From the error it becomes apparent that rails is looking in the operations table whereas it should look in the article table for the association.</p>\n\n<p>I have tried to add <code>belongs_to: article</code> in the Operations model but it does not change the error. I'm sure I'm missing something but I can't seem to figure it out using the documentation and similar topics.</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1534933445, "post_id": 51964661, "comment_id": 90879387, "body": "Presumably, looking at that code structure, all constants defined in <code>AddonBase</code> will have exactly one value? So would I be right in saying that the behaviour is fine, and really you just want to &quot;suppress&quot; the warning?"}, {"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1534933488, "post_id": 51964661, "comment_id": 90879408, "body": "i.e. Could you just do something like: <code>class AddonBase; FOO = &quot;bar&quot; unless defined?(FOO); ...</code>?"}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1534938439, "post_id": 51964661, "comment_id": 90882043, "body": "How is your <code>AddonBase</code> code related to the other examples? You don&#39;t define any constants there."}, {"owner": {"reputation": 5449, "user_id": 681520, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/701baebf68d1d7faa9f9def6a24fe356?s=128&d=identicon&r=PG", "display_name": "Kimmo Lehto", "link": "https://stackoverflow.com/users/681520/kimmo-lehto"}, "reply_to_user": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1534939469, "post_id": 51964661, "comment_id": 90882726, "body": "@TomLord no, the problem is just that different addons should be able to define something like their own <code>CONFIG_PATH=&quot;&#47;etc&#47;foo.conf&quot;</code>. Of course there could be instructions on how to define constants or to avoid them, but it would be super nice if this wasn&#39;t necessary and people could write them &quot;as expected&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 5449, "user_id": 681520, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/701baebf68d1d7faa9f9def6a24fe356?s=128&d=identicon&r=PG", "display_name": "Kimmo Lehto", "link": "https://stackoverflow.com/users/681520/kimmo-lehto"}, "edited": false, "score": 0, "creation_date": 1534940761, "post_id": 51964979, "comment_id": 90883606, "body": "Assigning the class to a constant through <code>const_set</code> does not seem to give it a name. <code>Addons.const_set(klassify(name), Class.new(AddonBase, &amp;block))</code>"}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "reply_to_user": {"reputation": 5449, "user_id": 681520, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/701baebf68d1d7faa9f9def6a24fe356?s=128&d=identicon&r=PG", "display_name": "Kimmo Lehto", "link": "https://stackoverflow.com/users/681520/kimmo-lehto"}, "edited": false, "score": 0, "creation_date": 1534941817, "post_id": 51964979, "comment_id": 90884276, "body": "Check <code>Addons::klassify(name).name</code> and you\u2019ll see it has a name."}, {"owner": {"reputation": 5449, "user_id": 681520, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/701baebf68d1d7faa9f9def6a24fe356?s=128&d=identicon&r=PG", "display_name": "Kimmo Lehto", "link": "https://stackoverflow.com/users/681520/kimmo-lehto"}, "edited": false, "score": 0, "creation_date": 1535022507, "post_id": 51964979, "comment_id": 90918048, "body": "Not during the definition though."}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "reply_to_user": {"reputation": 5449, "user_id": 681520, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/701baebf68d1d7faa9f9def6a24fe356?s=128&d=identicon&r=PG", "display_name": "Kimmo Lehto", "link": "https://stackoverflow.com/users/681520/kimmo-lehto"}, "edited": false, "score": 0, "creation_date": 1535022869, "post_id": 51964979, "comment_id": 90918267, "body": "During the definition, the constant is not yet declared. Ruby is the scripting language that is processed sequentially. 1) <code>Class.new</code> 2) <code>const_set</code>. One cannot expect everything is to be on hand at any time."}, {"owner": {"reputation": 5449, "user_id": 681520, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/701baebf68d1d7faa9f9def6a24fe356?s=128&d=identicon&r=PG", "display_name": "Kimmo Lehto", "link": "https://stackoverflow.com/users/681520/kimmo-lehto"}, "edited": false, "score": 0, "creation_date": 1535025015, "post_id": 51964979, "comment_id": 90919561, "body": "Yes, that&#39;s true, just clarifying that it does not solve the original problem, which is defining constants during <code>Class.new { block }</code>, but I marked this as the answer as it explains why it is not solvable."}], "tags": [], "owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "is_accepted": true, "score": 2, "last_activity_date": 1534934260, "creation_date": 1534934260, "answer_id": 51964979, "question_id": 51964661, "link": "https://stackoverflow.com/questions/51964661/how-to-namespace-constants-inside-anonymous-class-definitions/51964979#51964979", "title": "How to namespace constants inside anonymous class definitions?", "body": "<blockquote>\n  <p>When creating <strong>anonymous</strong> classes through Class.new, they don't seem to have their own <strong>namespace</strong> for constants</p>\n</blockquote>\n\n<p>Sure, by the definition of the word \u201canonymous.\u201d Compare two following snippets:</p>\n\n<pre><code>class C1; puts \"|#{name}|\"; end\n#\u21d2\u00a0|C1|\nC2 = Class.new { puts \"|#{name}|\" }\n#\u21d2\u00a0||\n</code></pre>\n\n<p>Unless assigned to the constant, the class has no name and hence all constants defined inside go to <code>Object</code> namespace. That said, the warning here is actually pointing out to error and <code>Object::FOO = \"bar\"</code> overrides <code>Object::FOO = \"foo\"</code> constant.</p>\n\n<p>That said, one cannot use constants in this scenario. Use class-level instance variables instead, or construct unique constant names manually (I would advise avoiding polluting <code>Object</code> class with a bunch of unrelated constants, though.)</p>\n"}, {"comments": [{"owner": {"reputation": 5449, "user_id": 681520, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/701baebf68d1d7faa9f9def6a24fe356?s=128&d=identicon&r=PG", "display_name": "Kimmo Lehto", "link": "https://stackoverflow.com/users/681520/kimmo-lehto"}, "edited": false, "score": 0, "creation_date": 1534939899, "post_id": 51965126, "comment_id": 90883027, "body": "Hmm, I could use a regexp to replace anything that looks like a constant assignment to use <code>const_set</code> or <code>self::</code>."}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "reply_to_user": {"reputation": 5449, "user_id": 681520, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/701baebf68d1d7faa9f9def6a24fe356?s=128&d=identicon&r=PG", "display_name": "Kimmo Lehto", "link": "https://stackoverflow.com/users/681520/kimmo-lehto"}, "edited": false, "score": 0, "creation_date": 1534947177, "post_id": 51965126, "comment_id": 90887962, "body": "@KimmoLehto regexp? Are you processing source code files / strings? Maybe you could provide a more complete example. I don&#39;t really understand what you are trying to do."}], "tags": [], "owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "is_accepted": false, "score": 2, "last_activity_date": 1534935583, "last_edit_date": 1534935583, "creation_date": 1534934763, "answer_id": 51965126, "question_id": 51964661, "link": "https://stackoverflow.com/questions/51964661/how-to-namespace-constants-inside-anonymous-class-definitions/51965126#51965126", "title": "How to namespace constants inside anonymous class definitions?", "body": "<blockquote>\n  <p>When creating anonymous classes through <code>Class.new</code>, they don't seem to have their own namespace for constants</p>\n</blockquote>\n\n<p>They do, you can use <a href=\"http://ruby-doc.org/core-2.5.1/Module.html#method-i-const_set\" rel=\"nofollow noreferrer\"><code>const_set</code></a> to define constants in anonymous classes:</p>\n\n<pre><code>klass1 = Class.new do\n  const_set(:FOO, 'foo')\nend\n\nklass2 = Class.new do\n  const_set(:FOO, 'bar')\nend\n\nklass1::FOO #=&gt; \"foo\"\nklass2::FOO #=&gt; \"bar\"\n</code></pre>\n\n<p>Or via <code>self::</code></p>\n\n<pre><code>klass1 = Class.new do\n  self::FOO = 'foo'\nend\n\nklass2 = Class.new do\n  self::FOO = 'bar'\nend\n\nklass1::FOO #=&gt; \"foo\"\nklass2::FOO #=&gt; \"bar\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5449, "user_id": 681520, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/701baebf68d1d7faa9f9def6a24fe356?s=128&d=identicon&r=PG", "display_name": "Kimmo Lehto", "link": "https://stackoverflow.com/users/681520/kimmo-lehto"}, "edited": false, "score": 0, "creation_date": 1534939691, "post_id": 51965367, "comment_id": 90882867, "body": "In that case I could just as well instruct the users to do <code>class FoofooAddon &lt; AddonBase</code> and write a <code>self.inherited</code> hook into <code>AddonBase</code>. That is probably what I will end up doing unless someone finds out a way to do that via the friendlier DSL syntax."}], "tags": [], "owner": {"reputation": 5966, "user_id": 2477691, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/DaiPF.jpg?s=128&g=1", "display_name": "chumakoff", "link": "https://stackoverflow.com/users/2477691/chumakoff"}, "is_accepted": false, "score": 1, "last_activity_date": 1534938938, "last_edit_date": 1534938938, "creation_date": 1534935576, "answer_id": 51965367, "question_id": 51964661, "link": "https://stackoverflow.com/questions/51964661/how-to-namespace-constants-inside-anonymous-class-definitions/51965367#51965367", "title": "How to namespace constants inside anonymous class definitions?", "body": "<p>Actually the problem is how to define a class using a proc including constant definitions. As has already been said it is not possible the way you did it, since the proc gets class_eval'd and that doesn't allow to define constants.  </p>\n\n<p>I suggest another approach. Can you use modules instead of procs to define new addons mixing a module into a class?</p>\n\n<p><strong>Example:</strong></p>\n\n<pre><code>module AddonModule\n  FOO = \"foo\"\nend\n\nklass = Class.new\nklass.include AddonModule\n\nklass::FOO # =&gt; \"foo\"\n</code></pre>\n\n<p><strong>Usage in your DSL:</strong></p>\n\n<pre><code>def self.addon(name, addon_module)\n  addon = Class.new(AddonBase)\n  addon.include addon_module\n\n  addons[name] = addon\nend\n</code></pre>\n"}], "owner": {"reputation": 5449, "user_id": 681520, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/701baebf68d1d7faa9f9def6a24fe356?s=128&d=identicon&r=PG", "display_name": "Kimmo Lehto", "link": "https://stackoverflow.com/users/681520/kimmo-lehto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 310, "favorite_count": 0, "accepted_answer_id": 51964979, "answer_count": 3, "score": 2, "last_activity_date": 1535005087, "creation_date": 1534932980, "last_edit_date": 1535005087, "question_id": 51964661, "link": "https://stackoverflow.com/questions/51964661/how-to-namespace-constants-inside-anonymous-class-definitions", "title": "How to namespace constants inside anonymous class definitions?", "body": "<p>When creating anonymous classes through <code>Class.new</code>, they don't seem to have their own namespace for constants:</p>\n\n<pre><code>klass1 = Class.new do\n  FOO = \"foo\"\nend\n\nklass2 = Class.new do\n  FOO = \"bar\"\nend\n</code></pre>\n\n<p>This gives <code>warning: already initialized constant FOO</code> and looks like it's right:</p>\n\n<pre><code>&gt; klass1.const_get(:FOO)\n\"bar\"\n&gt; klass2.const_get(:FOO)\n\"bar\"\n&gt; FOO\n\"bar\"\n</code></pre>\n\n<p>I was going to use this approach in a simple DSL for defining addons for an application, something like this:</p>\n\n<pre><code>class App\n  class AddonBase\n\n    attr_reader :session\n\n    def initialize(session)\n      @session = session\n    end\n  end\n\n  def self.addons\n    @addons ||= {}\n  end\n\n  def self.addon(name, &amp;block)\n    addons[name] = Class.new(AddonBase, &amp;block)\n  end\nend\n</code></pre>\n\n<p>This works fine for simple add-ons but if defining constants, they will be under <code>Object::</code> instead of becoming <code>addons[name]::CONSTANT</code>:</p>\n\n<pre><code>App.addon \"addon1\" do\n\n  PATH=\"/var/run/foo\"\n\n  def execute\n    File.touch(PATH)\n  end\nend\n\nApp.addon \"addon2\" do\n\n  PATH=\"/etc/app/config\"\n\n  def execute\n    File.unlink(PATH)\n  end\nend\n\n# warning: already initialized constant PATH\n</code></pre>\n\n<p>The constants could be anything and the add-ons could even define their own utility subclasses, so it's not just about replacing <code>PATH</code> with a function.</p>\n\n<p>Is there some way to work around this?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "webhooks", "xero-api", "xeroizer"], "answers": [{"comments": [{"owner": {"reputation": 1331, "user_id": 4189633, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VG5Vp.jpg?s=128&g=1", "display_name": "Vishal G", "link": "https://stackoverflow.com/users/4189633/vishal-g"}, "edited": false, "score": 0, "creation_date": 1534934123, "post_id": 51964736, "comment_id": 90879747, "body": "actually that&#39;s  not correct. that&#39;s the first thing that I have done here"}], "tags": [], "owner": {"reputation": 807, "user_id": 1688322, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/cZ6Ai.jpg?s=128&g=1", "display_name": "Robin van Dijk", "link": "https://stackoverflow.com/users/1688322/robin-van-dijk"}, "is_accepted": false, "score": 0, "last_activity_date": 1534933283, "creation_date": 1534933283, "answer_id": 51964736, "question_id": 51963263, "link": "https://stackoverflow.com/questions/51963263/xero-intent-to-receive-ruby/51964736#51964736", "title": "Xero - Intent To Receive Ruby", "body": "<p><code>data</code> should be a string.</p>\n\n<pre><code>digest = OpenSSL::Digest::Digest.new('sha256')\nhmac_digest = OpenSSL::HMAC.digest(digest, key, data['firstEventSequence'].to_s)\nBase64.encode64(hmac_digest).strip() =&gt; \"JvORQ/sWHvAXO/3nm9vG7+VgAqA93bTSMMIbVHIRgnM=\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1331, "user_id": 4189633, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VG5Vp.jpg?s=128&g=1", "display_name": "Vishal G", "link": "https://stackoverflow.com/users/4189633/vishal-g"}, "is_accepted": true, "score": 2, "last_activity_date": 1535010697, "creation_date": 1535010697, "answer_id": 51980814, "question_id": 51963263, "link": "https://stackoverflow.com/questions/51963263/xero-intent-to-receive-ruby/51980814#51980814", "title": "Xero - Intent To Receive Ruby", "body": "<p>After researching and debugging code finally find a way to do this </p>\n\n<pre><code>  def handle_hook\n    key = ENV['XERO_WEBHOOK_KEY']\n    payload = request.body.read\n    calculated_hmac = Base64.encode64(OpenSSL::HMAC.digest('sha256', key, payload))\n    if calculated_hmac.strip() == request.headers['x-xero-signature']\n      head :ok\n    else\n      head :unauthorized\n    end\n  end\n</code></pre>\n\n<p>Using Strip() is magical here</p>\n"}], "owner": {"reputation": 1331, "user_id": 4189633, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VG5Vp.jpg?s=128&g=1", "display_name": "Vishal G", "link": "https://stackoverflow.com/users/4189633/vishal-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "accepted_answer_id": 51980814, "answer_count": 2, "score": 0, "last_activity_date": 1535010697, "creation_date": 1534928497, "last_edit_date": 1534962339, "question_id": 51963263, "link": "https://stackoverflow.com/questions/51963263/xero-intent-to-receive-ruby", "title": "Xero - Intent To Receive Ruby", "body": "<p>This is the params coming from Xero </p>\n\n<pre><code>{\"events\"=&gt;nil,\n \"firstEventSequence\"=&gt;0,\n \"lastEventSequence\"=&gt;0,\n \"entropy\"=&gt;\"KFDXIMNLPDAMRBOEVAVF\",\n \"controller\"=&gt;\"admin/billing/webhooks\",\n \"action\"=&gt;\"handle_hook\",\n \"webhook\"=&gt;\n  {\"events\"=&gt;nil,\n   \"firstEventSequence\"=&gt;0,\n   \"lastEventSequence\"=&gt;0,\n   \"entropy\"=&gt;\"KFDXIMNLPDAMRBOEVAVF\"}}\n</code></pre>\n\n<p>I want to verify <code>Intent To Receive</code> <a href=\"https://developer.xero.com/documentation/webhooks/configuring-your-server#intent\" rel=\"nofollow noreferrer\">https://developer.xero.com/documentation/webhooks/configuring-your-server#intent</a></p>\n\n<pre><code>data = {\"events\"=&gt;nil, \"firstEventSequence\"=&gt;0, \"lastEventSequence\"=&gt;0, \"entropy\"=&gt;\"KFDXIMNLPDAMRBOEVAVF\"}\n\nKey = HRj6QPub9BNE4MWewrcLrkKFjpiikV1KrlMZCvDawyDR95MGkkuE2y1DXFP1tifsEWaJygLx6zG0r9rXVTflcg==\n</code></pre>\n\n<p>tried below</p>\n\n<pre><code>Base64.encode64(OpenSSL::HMAC.digest(OpenSSL::Digest::Digest.new('sha256'), key, data)).strip()\n\n*** TypeError Exception: no implicit conversion of ActionController::Parameters into String\n</code></pre>\n\n<p>OR</p>\n\n<pre><code>hash  = OpenSSL::HMAC.digest('sha256', key, data)\n*** TypeError Exception: no implicit conversion of ActionController::Parameters into String\n</code></pre>\n\n<p>How to achive this here?</p>\n\n<p><em>To ensure the requests you receive are coming from Xero you need to verify the signature provided in the x-xero-signature header. When creating or re-enabling a webhook subscription (or updating the subscription url) the user will be prompted to start an 'Intent To Receive' validation. This validation process will be a series of HTTPS POST requests to the url provided in the subscription.</em> </p>\n\n<p><strong>EDIT</strong>\nRails was converting blank array into nil, so I made payload by myself to look exactly the same according to documentation</p>\n\n<pre><code>data = params[:webhook]\n\npayload = {\n             \"events\": [],\n             \"lastEventSequence\": data[:lastEventSequence],\n             \"firstEventSequence\": data[:firstEventSequence],\n             \"entropy\": data[:entropy]\n          }\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "activerecord", "rails-console"], "comments": [{"owner": {"reputation": 48413, "user_id": 1279683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1veuT.jpg?s=128&g=1", "display_name": "Marek Lipka", "link": "https://stackoverflow.com/users/1279683/marek-lipka"}, "edited": false, "score": 1, "creation_date": 1534924393, "post_id": 51962102, "comment_id": 90874462, "body": "I don&#39;t understand. You want to re-create deleted record?"}, {"owner": {"reputation": 109029, "user_id": 2767755, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/BkC8q.jpg?s=128&g=1", "display_name": "Arup Rakshit", "link": "https://stackoverflow.com/users/2767755/arup-rakshit"}, "edited": false, "score": 0, "creation_date": 1534924511, "post_id": 51962102, "comment_id": 90874525, "body": "@user that is not the way to debug. You loose data already unless you have soft delete enabled by some gems. Next time, open rails console in sandbox mode. Like <code>rails c --sandbox</code> t avoid such disasters.."}, {"owner": {"reputation": 410, "user_id": 3714163, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8aba5b3335513a9788c2435b2a34c027?s=128&d=identicon&r=PG&f=1", "display_name": "Ninad Nehete", "link": "https://stackoverflow.com/users/3714163/ninad-nehete"}, "reply_to_user": {"reputation": 48413, "user_id": 1279683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1veuT.jpg?s=128&g=1", "display_name": "Marek Lipka", "link": "https://stackoverflow.com/users/1279683/marek-lipka"}, "edited": false, "score": 0, "creation_date": 1534926111, "post_id": 51962102, "comment_id": 90875371, "body": "@MarekLipka I don&#39;t have enough data locally, so I want to debug it on staging server. And so I don&#39;t want to delete the data permanently, just temporarily till I figure out what is slowing the query."}, {"owner": {"reputation": 4690, "user_id": 1937435, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YyN37.jpg?s=128&g=1", "display_name": "Josh Brody", "link": "https://stackoverflow.com/users/1937435/josh-brody"}, "edited": false, "score": 0, "creation_date": 1534926465, "post_id": 51962102, "comment_id": 90875540, "body": "pull your staging server into dev. it&#39;s good to have."}], "answers": [{"comments": [{"owner": {"reputation": 410, "user_id": 3714163, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8aba5b3335513a9788c2435b2a34c027?s=128&d=identicon&r=PG&f=1", "display_name": "Ninad Nehete", "link": "https://stackoverflow.com/users/3714163/ninad-nehete"}, "edited": false, "score": 0, "creation_date": 1534926878, "post_id": 51962225, "comment_id": 90875768, "body": "Perfect ! This is exactly what I was looking for : D Thanks mate."}], "tags": [], "owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "is_accepted": true, "score": 6, "last_activity_date": 1534924581, "creation_date": 1534924581, "answer_id": 51962225, "question_id": 51962102, "link": "https://stackoverflow.com/questions/51962102/how-to-save-an-active-record-object-when-its-association-has-been-deleted/51962225#51962225", "title": "How to save an active record object when its association has been deleted?", "body": "<p>The best approach would be to, one way or another, wrap the action in a <strong>database transaction</strong>. You can then <em>rollback</em> the transaction to restore all the data to its original state.</p>\n\n<p>To write this explicitly, you could do something like:</p>\n\n<pre><code>ActiveRecord::Base.transaction do\n  Company.find_by(name: 'ABC').destroy\n  # Any debugging can be done here, or above\n  raise ActiveRecord::Rollback\nend\n</code></pre>\n\n<p>In fact, rails actually provides a <a href=\"https://edgeguides.rubyonrails.org/command_line.html#rails-console\" rel=\"noreferrer\">debugging tool for precisely this use case</a>: You can make any changes to the database and have everything rolled back (inside a transaction, like above) by running:</p>\n\n<pre><code>rails console --sandbox\n</code></pre>\n"}], "owner": {"reputation": 410, "user_id": 3714163, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8aba5b3335513a9788c2435b2a34c027?s=128&d=identicon&r=PG&f=1", "display_name": "Ninad Nehete", "link": "https://stackoverflow.com/users/3714163/ninad-nehete"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 183, "favorite_count": 1, "accepted_answer_id": 51962225, "answer_count": 1, "score": 0, "last_activity_date": 1534926792, "creation_date": 1534924082, "last_edit_date": 1534926792, "question_id": 51962102, "link": "https://stackoverflow.com/questions/51962102/how-to-save-an-active-record-object-when-its-association-has-been-deleted", "title": "How to save an active record object when its association has been deleted?", "body": "<p>I have a model named Company along with many associations, and it's an association having many more. (with dependent destroy)</p>\n\n<pre><code>com = Company.find_by(name: 'ABC')\n</code></pre>\n\n<p>I then destroy the entry by</p>\n\n<pre><code>Company.find_by(name: 'ABC').destroy\n</code></pre>\n\n<p>Now '<code>com</code>' has the record, and when I perform <code>com.save</code> the object does not get stored along with its association.</p>\n\n<p><strong>Note</strong>\nI am trying to debug as to where my destroy query is taking time (it has hundreds of associations), so I don't want to lose the data, I want to save it in the console after debugging.</p>\n"}, {"tags": ["ruby", "logstash", "logstash-configuration"], "comments": [{"owner": {"reputation": 30418, "user_id": 823617, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DmWH1.png?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/823617/casper"}, "edited": false, "score": 0, "creation_date": 1534940378, "post_id": 51961534, "comment_id": 90883363, "body": "If you could post the actual content of the <code>event</code> hash it would help get better answers. Right now there&#39;s a lot to assume here."}, {"owner": {"reputation": 11, "user_id": 6823170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff182c06d768e86b8f2481a2c840431d?s=128&d=identicon&r=PG", "display_name": "Arnold Y.", "link": "https://stackoverflow.com/users/6823170/arnold-y"}, "reply_to_user": {"reputation": 30418, "user_id": 823617, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DmWH1.png?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/823617/casper"}, "edited": false, "score": 0, "creation_date": 1534945290, "post_id": 51961534, "comment_id": 90886711, "body": "@Casper hey i added the file. thanks for answering"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 6823170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff182c06d768e86b8f2481a2c840431d?s=128&d=identicon&r=PG", "display_name": "Arnold Y.", "link": "https://stackoverflow.com/users/6823170/arnold-y"}, "edited": false, "score": 0, "creation_date": 1534942997, "post_id": 51966338, "comment_id": 90885093, "body": "hi elliot,thanks for replying. my object is a field - string type.  do i need to use something else instead to_hash?"}], "tags": [], "owner": {"reputation": 686, "user_id": 1491410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c938ed150a685b33d1b91266b382c8d?s=128&d=identicon&r=PG", "display_name": "elliotcm", "link": "https://stackoverflow.com/users/1491410/elliotcm"}, "is_accepted": false, "score": 0, "last_activity_date": 1534939030, "creation_date": 1534939030, "answer_id": 51966338, "question_id": 51961534, "link": "https://stackoverflow.com/questions/51961534/logstash-remove-nested-fields-using-ruby-filtering/51966338#51966338", "title": "logstash remove nested fields using ruby filtering", "body": "<p>I'm going to assume the square brackets are part of the string you're trying to check for.  If so your issue is that you're not interpolating <code>k</code> into the string.</p>\n\n<p>It's gonna be a touch tricky because your code is already within a double-quoted string, but this should work:</p>\n\n<pre><code>k.start_with?(%{[kv.amp-1][#{k}]})\n</code></pre>\n\n<p>I'd also question whether you need the <code>to_hash</code> call, but that depends on exactly what kind of object <code>event</code> is.</p>\n"}], "owner": {"reputation": 11, "user_id": 6823170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff182c06d768e86b8f2481a2c840431d?s=128&d=identicon&r=PG", "display_name": "Arnold Y.", "link": "https://stackoverflow.com/users/6823170/arnold-y"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 885, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1534945258, "creation_date": 1534921941, "last_edit_date": 1534945258, "question_id": 51961534, "link": "https://stackoverflow.com/questions/51961534/logstash-remove-nested-fields-using-ruby-filtering", "title": "logstash remove nested fields using ruby filtering", "body": "<p>i have an index with a lot of spam fields (over 300). they are all nested and look like this:</p>\n\n<pre><code>kv.amp-1-234\nkv.amp-1-abc\nkv.amp-1-efg\n</code></pre>\n\n<p>so i wanted to do filtering and use remove_fields to get rid of them.\nwanted to use the prune filter but i can't - they don't support nested key removal. \nand i can't use \nfilter {\n  mutate {\n    remove_fields </p>\n\n<p>because it doesnt support regex.</p>\n\n<p>i saw that the only way is through ruby filtering:</p>\n\n<pre><code>  ruby {\n    code =&gt; \"\n    event.to_hash.keys.each { |k|\n    if k.start_with?('[kv.amp-1][k]')\n      event.remove(k)\n    end\n    }\n   \"\n   }\n</code></pre>\n\n<p>but it doens't work. i just need an example of deletion of nested keys using the ruby filter(no need for regex because start_with? is good enough)</p>\n\n<p>using <code>logstash 5.4.2</code></p>\n\n<p>the whole config file:</p>\n\n<pre><code>input {\n\n  kafka {\n    topics      =&gt; \"gelfEvents\"\n    bootstrap_servers =&gt; \"elk.sonic-dev.us-east-1:9092\"\n    group_id    =&gt; \"gelfEventsCG-elk\"\n    # client_id   =&gt; \"\"\n    tags        =&gt; [ \"gelf2kafka\" ]\n    codec       =&gt; json { charset =&gt; \"UTF-8\" }\n  }\n\n}\n\nfilter {\n  if \"gelf2kafka\" in [tags] {\n    mutate {\n      rename =&gt; { \"short_message\" =&gt; \"message\" }\n      rename =&gt; { \"host\" =&gt; \"[host][name]\" }\n\n    }\n    ruby {\n      code =&gt; \"event.to_hash.keys.each do |key| next unless key[0,1] == '_'; if key == '_' then event.remove(key); next; end; event.set(key[1..-1], event.remove(key)) end\"\n    }\n\n#trying stuff\n#   ruby {\n#    code =&gt; \"\n#    event.to_hash.keys.each { |k|\n#    if k.start_with?('[tags][k]')\n#      event.remove(k)\n#    end\n#    }\n#   \"\n#   }\n\n\n    date {\n      match =&gt; [ \"timestamp\", \"UNIX\" ]\n      remove_field =&gt; [ \"timestamp\" ]\n      # target =&gt; \"timestamp_new\"\n    }\n\n    translate {\n      field       =&gt; \"level\"\n      destination =&gt; \"level\"\n      exact       =&gt; true\n      regex       =&gt; false\n      override    =&gt; true\n      fallback    =&gt; \"no match for %{level}\"\n      dictionary  =&gt; [ \"6\", \"INFO\",\n                       \"4\", \"WARN\",\n                       \"3\", \"ERROR\",\n                       \"7\", \"DEBUG\" ]\n    }\n\n  }\n\n}\n\noutput {\n  if \"gelf2kafka\" in [tags] {\n#    stdout { codec =&gt; rubydebug }\n\n    elasticsearch {\n      # protocol        =&gt; \"http\"\n      hosts            =&gt; \"localhost\"\n      index           =&gt; \"logstash-gelf2kafka-%{+YYYY.MM.dd}\"\n      flush_size      =&gt; 100\n      idle_flush_time =&gt; 1\n    }\n\n\n\n    statsd {\n      host =&gt; \"localhost\"\n      namespace =&gt; \"logstash\"\n      sender =&gt; \"_all\" # \"%{host}\"\n      increment =&gt; \"LogsKafka2ElasticSearchAll.gelfEvents.LinesSent\"\n    }\n\n  }\n}\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "json", "ruby", "openstruct"], "comments": [{"owner": {"reputation": 47232, "user_id": 1772830, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Qtoqg.jpg?s=128&g=1", "display_name": "Andrey Deineko", "link": "https://stackoverflow.com/users/1772830/andrey-deineko"}, "edited": false, "score": 0, "creation_date": 1534921289, "post_id": 51961012, "comment_id": 90872968, "body": "I don&#39;t understand how <code>JSON.parse(openstruct_object.to_json)</code> gives you your output. The code is wrong, and the output is not what it should be"}, {"owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "edited": false, "score": 1, "creation_date": 1534932907, "post_id": 51961012, "comment_id": 90879082, "body": "<a href=\"https://gist.github.com/3limin4t0r/a29771d2f2d4d31e757cc7e9d5f1ee1f\" rel=\"nofollow noreferrer\">Here</a> is some brainstorming about your issue."}], "answers": [{"comments": [{"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 1, "creation_date": 1534920394, "post_id": 51961116, "comment_id": 90872532, "body": "Wow. I didn\u2019t know about <a href=\"https://ruby-doc.org/stdlib/libdoc/ostruct/rdoc/OpenStruct.html#method-i-marshal_dump\" rel=\"nofollow noreferrer\"><code>OpenStruct#marshal_dump</code></a>."}], "tags": [], "owner": {"reputation": 47232, "user_id": 1772830, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Qtoqg.jpg?s=128&g=1", "display_name": "Andrey Deineko", "link": "https://stackoverflow.com/users/1772830/andrey-deineko"}, "is_accepted": true, "score": 2, "last_activity_date": 1534920925, "last_edit_date": 1534920925, "creation_date": 1534920306, "answer_id": 51961116, "question_id": 51961012, "link": "https://stackoverflow.com/questions/51961012/how-to-convert-recursive-nested-openstruct-object-to-hash/51961116#51961116", "title": "How to convert recursive/nested OpenStruct Object to Hash", "body": "<p>Check out <a href=\"https://ruby-doc.org/stdlib-2.5.1/libdoc/ostruct/rdoc/OpenStruct.html\" rel=\"nofollow noreferrer\">docs</a>.</p>\n\n<p>You can use <a href=\"https://ruby-doc.org/stdlib-2.5.1/libdoc/ostruct/rdoc/OpenStruct.html#method-i-marshal_dump\" rel=\"nofollow noreferrer\"><code>OpenStruct#marshal_dump</code></a>:</p>\n\n<pre><code>openstruct_object.marshal_dump\n</code></pre>\n\n<p><a href=\"https://ruby-doc.org/stdlib-2.5.1/libdoc/ostruct/rdoc/OpenStruct.html#method-i-marshal_dump\" rel=\"nofollow noreferrer\"><code>OpenStruct#to_h</code></a> will work, too:</p>\n\n<pre><code>openstruct_object.to_h\n</code></pre>\n\n<p>You can convert your object to hash and then hash to JSON:</p>\n\n<pre><code>openstruct_object.to_h.to_json\n</code></pre>\n\n<p>But it looks like what you want is a Hash object, not JSON object.</p>\n"}, {"comments": [{"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 1, "creation_date": 1534928560, "post_id": 51962549, "comment_id": 90876676, "body": "<code>deep_to_h = -&gt;(hash) { hash.to_h.map { |k, v| [k, v.respond_to?(:to_h) ? deep_to_h.(v) : v] }.to_h }</code> and use it as <code>deep_to_h.(test_order)</code> makes the approach more generic."}, {"owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "reply_to_user": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1534932821, "post_id": 51962549, "comment_id": 90879038, "body": "@mudasobwa However if one of the values is an array it could also be an issue since <code>[1, 2, 3].to_h #=&gt; TypeError: wrong element type Integer at 0 (expected array)</code>."}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "reply_to_user": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "edited": false, "score": 0, "creation_date": 1534932985, "post_id": 51962549, "comment_id": 90879131, "body": "@JohanWentholt true that. One might explicitly exclude arrays then."}, {"owner": {"reputation": 2659, "user_id": 2534479, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/2472926967c5dbb6e31895a660a472ce?s=128&d=identicon&r=PG", "display_name": "aldrien.h", "link": "https://stackoverflow.com/users/2534479/aldrien-h"}, "edited": false, "score": 0, "creation_date": 1535097461, "post_id": 51962549, "comment_id": 90948886, "body": "@Andrey if i have &lt;OpenStruct id=505311428702, email=&quot;test@gmail.com&quot;, closed_at=&quot;&quot;, discount_codes=[#&lt;OpenStruct id=507328175, text=&quot;test&quot;&gt;]&gt; deep_openstruct_to_hash cannot convert (discount_codes) if value is Array, any idea? Thank you."}], "tags": [], "owner": {"reputation": 47232, "user_id": 1772830, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Qtoqg.jpg?s=128&g=1", "display_name": "Andrey Deineko", "link": "https://stackoverflow.com/users/1772830/andrey-deineko"}, "is_accepted": false, "score": 1, "last_activity_date": 1534926248, "last_edit_date": 1534926248, "creation_date": 1534925740, "answer_id": 51962549, "question_id": 51961012, "link": "https://stackoverflow.com/questions/51961012/how-to-convert-recursive-nested-openstruct-object-to-hash/51962549#51962549", "title": "How to convert recursive/nested OpenStruct Object to Hash", "body": "<p>To convert your deep openstruct to hash you could go with something along these lines:</p>\n\n<pre><code>def deep_openstruct_to_hash(object)\n  object.each_pair.with_object({}) do |(key, value), hash|\n    hash[key] = value.is_a?(OpenStruct) ? deep_openstruct_to_hash(value) : value\n  end\nend\n</code></pre>\n\n<p>Then:</p>\n\n<pre><code>openstruct_object = to_recursive_ostruct(test_order)\n#=&gt; #&lt;OpenStruct id=505311428702, email=\"test@gmail.com\", closed_at=\"\", discount_codes=#&lt;OpenStruct id=507328175, text=\"test\"&gt;&gt;\ndeep_openstruct_to_hash(openstruct_object)\n# {\n#   :id=&gt;505311428702,\n#   :email=&gt;\"test@gmail.com\",\n#   :closed_at=&gt;\"\",\n#   :discount_codes=&gt;{\n#     :id=&gt;507328175,\n#     :text=&gt;\"test\"\n#   }\n# }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2659, "user_id": 2534479, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/2472926967c5dbb6e31895a660a472ce?s=128&d=identicon&r=PG", "display_name": "aldrien.h", "link": "https://stackoverflow.com/users/2534479/aldrien-h"}, "is_accepted": false, "score": 0, "last_activity_date": 1535093597, "creation_date": 1535093597, "answer_id": 51998976, "question_id": 51961012, "link": "https://stackoverflow.com/questions/51961012/how-to-convert-recursive-nested-openstruct-object-to-hash/51998976#51998976", "title": "How to convert recursive/nested OpenStruct Object to Hash", "body": "<p>Thanks also to this <a href=\"https://gist.github.com/ashmoran/5950325\" rel=\"nofollow noreferrer\">gist</a>: \nCan converted array of hash as well.</p>\n\n<pre><code>def recursive_ostruct(object)\n  case object\n  when Hash\n    hash = {}; object.each{|k,v| hash[k] = recursive_ostruct(v)}\n    OpenStruct.new(hash)\n  when Array\n    object.map {|e| recursive_ostruct(e) }\n  else\n    object\n  end\nend\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 17523, "user_id": 518204, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/d3096adc28daa2f0b01cfbe5b90a37db?s=128&d=identicon&r=PG", "display_name": "Fabio", "link": "https://stackoverflow.com/users/518204/fabio"}, "edited": false, "score": 1, "creation_date": 1579191488, "post_id": 56581924, "comment_id": 105691204, "body": "Good, but it won&#39;t handle arrays"}], "tags": [], "owner": {"reputation": 2043, "user_id": 1892605, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f326e566d6d0d5c448e70a2e5e179b9d?s=128&d=identicon&r=PG", "display_name": "owyongsk", "link": "https://stackoverflow.com/users/1892605/owyongsk"}, "is_accepted": false, "score": 1, "last_activity_date": 1560433454, "creation_date": 1560433454, "answer_id": 56581924, "question_id": 51961012, "link": "https://stackoverflow.com/questions/51961012/how-to-convert-recursive-nested-openstruct-object-to-hash/56581924#56581924", "title": "How to convert recursive/nested OpenStruct Object to Hash", "body": "<p>On Ruby 2.4+, you can use <code>transform_values</code> together with a recursive function in a monkey patch.</p>\n\n<pre><code>class OpenStruct\n  def deep_to_h\n    to_h.transform_values do |v|\n      v.is_a?(OpenStruct) ? v.deep_to_h : v\n    end\n  end\nend\n</code></pre>\n\n<p>Or if you don't want to monkey patch</p>\n\n<pre><code>def deep_to_h(obj)\n  obj.to_h.transform_values do |v|\n    v.is_a?(OpenStruct) ? deep_to_h(v) : v\n  end\nend\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 96, "user_id": 4660791, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-BmCr1e2tSW8/AAAAAAAAAAI/AAAAAAAAAZ4/-JbQlIEKKn8/photo.jpg?sz=128", "display_name": "somesayinice", "link": "https://stackoverflow.com/users/4660791/somesayinice"}, "edited": false, "score": 0, "creation_date": 1613104147, "post_id": 62804063, "comment_id": 116979091, "body": "Thanks so much for this response. Really useful for parsing responses from apis."}], "tags": [], "owner": {"reputation": 146, "user_id": 11953383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0c65f9811fdbef29b287a705ee948f6?s=128&d=identicon&r=PG&f=1", "display_name": "Tayden", "link": "https://stackoverflow.com/users/11953383/tayden"}, "is_accepted": false, "score": 2, "last_activity_date": 1594677091, "last_edit_date": 1594677091, "creation_date": 1594244385, "answer_id": 62804063, "question_id": 51961012, "link": "https://stackoverflow.com/questions/51961012/how-to-convert-recursive-nested-openstruct-object-to-hash/62804063#62804063", "title": "How to convert recursive/nested OpenStruct Object to Hash", "body": "<p>Building on work done by @Andrey-Deineko, @owyongsk, @aldrien.h here is a converter that handles arrays. While the OP wasn't looking this in particular, others may find it helpful.</p>\n<pre class=\"lang-rb prettyprint-override\"><code>\ndef openstruct_to_h(object)\n   object.to_h.transform_values do |value|\n      value.is_a?(OpenStruct) ? openstruct_to_h(value) : value.is_a?(Array) ? value.map{|v| v.is_a?(String) ? v : openstruct_to_h(v) } : value\n   end\nend\n\n# Example usage\n\nopen_struct_object = OpenStruct.new(paramtest: &quot;ok&quot;, array_test: [OpenStruct.new(array_one: true), OpenStruct.new(array_two: false, nested_os: OpenStruct.new(works: 'maybe'))], os_test: OpenStruct.new(testy: &quot;yup&quot;)) \n\nopenstruct_to_h(open_struct_object)\n\n=&gt; {:paramtest=&gt;&quot;ok&quot;, :array_test=&gt;[{:array_one=&gt;true}, {:array_two=&gt;false, :nested_os=&gt;{:works=&gt;&quot;maybe&quot;}}], :os_test=&gt;{:testy=&gt;&quot;yup&quot;}}\n</code></pre>\n"}], "owner": {"reputation": 2659, "user_id": 2534479, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/2472926967c5dbb6e31895a660a472ce?s=128&d=identicon&r=PG", "display_name": "aldrien.h", "link": "https://stackoverflow.com/users/2534479/aldrien-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2888, "favorite_count": 0, "accepted_answer_id": 51961116, "answer_count": 5, "score": 4, "last_activity_date": 1594677091, "creation_date": 1534919782, "last_edit_date": 1534925501, "question_id": 51961012, "link": "https://stackoverflow.com/questions/51961012/how-to-convert-recursive-nested-openstruct-object-to-hash", "title": "How to convert recursive/nested OpenStruct Object to Hash", "body": "<p>I have an OpenStruct object and needs to convert to JSON data.</p>\n\n<p>Sample Hash (from RSPEC helper):</p>\n\n<pre><code>def test_order\n {\n   \"id\": 505311428702,\n   \"email\": \"test@gmail.com\",\n   \"closed_at\": \"\",\n   \"discount_codes\": {\n      \"id\": 507328175,\n      \"text\": \"test\"\n   }\n }\nend\n</code></pre>\n\n<p>I'm using, below function for recursive:</p>\n\n<pre><code>def to_recursive_ostruct(hash)\n  OpenStruct.new(hash.each_with_object({}) do |(key, val), memo|\n    memo[key] = val.is_a?(Hash) ? to_recursive_ostruct(val) : val\n  end)\nend\n</code></pre>\n\n<p>For ex to_recursive_ostruct(test_order), will return:</p>\n\n<pre><code>&lt;OpenStruct id=505311428702, email=\"test@gmail.com\", closed_at=\"\", ...&gt;\n</code></pre>\n\n<p>Once converted, using <strong>OpenStructObject.marshal_dump</strong>:</p>\n\n<pre><code>{\n:id=&gt;505311428702, :email=&gt;\"test@gmail.com\", :closed_at=&gt;\"\", \n\ndiscount_codes=&gt;#&lt;OpenStruct id=507328175, text= \"test\"&gt;}\n}\n</code></pre>\n\n<p><strong>OpenStructObject.marshal_dump</strong> gives me the right data in first level, </p>\n\n<p>I want also the nested data to beconverted.</p>\n\n<p>What I really need is like:</p>\n\n<pre><code>{:id=&gt;505311428702, :email=&gt;\"test@gmail.com\", :closed_at=&gt;\"\", :discount_codes=&gt;{:id=&gt;507328175, :text=&gt; \"test\"} }\n</code></pre>\n\n<p>Please help, thanks in advance.</p>\n"}, {"tags": ["ruby"], "answers": [{"comments": [{"owner": {"reputation": 5764, "user_id": 3033691, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/0d3286fd40aade0e7bf90d4d0eda0f29?s=128&d=identicon&r=PG&f=1", "display_name": "userMod2", "link": "https://stackoverflow.com/users/3033691/usermod2"}, "edited": false, "score": 0, "creation_date": 1534913066, "post_id": 51959797, "comment_id": 90870176, "body": "Had to use require like above - well, I used require &quot;./app/lib/simplex&quot;"}, {"owner": {"reputation": 3119, "user_id": 4842949, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0agpj31wtZ8/AAAAAAAAAAI/AAAAAAAAAAA/mSolbNN-zIY/photo.jpg?sz=128", "display_name": "Joseph Cho", "link": "https://stackoverflow.com/users/4842949/joseph-cho"}, "reply_to_user": {"reputation": 5764, "user_id": 3033691, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/0d3286fd40aade0e7bf90d4d0eda0f29?s=128&d=identicon&r=PG&f=1", "display_name": "userMod2", "link": "https://stackoverflow.com/users/3033691/usermod2"}, "edited": false, "score": 0, "creation_date": 1534914415, "post_id": 51959797, "comment_id": 90870496, "body": "Some people place their <code>lib</code> folder in rails root, but if yours is in the <code>app</code> directory that works too."}], "tags": [], "owner": {"reputation": 3119, "user_id": 4842949, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0agpj31wtZ8/AAAAAAAAAAI/AAAAAAAAAAA/mSolbNN-zIY/photo.jpg?sz=128", "display_name": "Joseph Cho", "link": "https://stackoverflow.com/users/4842949/joseph-cho"}, "is_accepted": true, "score": 2, "last_activity_date": 1534912735, "last_edit_date": 1534912735, "creation_date": 1534911399, "answer_id": 51959797, "question_id": 51959747, "link": "https://stackoverflow.com/questions/51959747/ruby-nameerror-uninitialized-constant/51959797#51959797", "title": "Ruby NameError: uninitialized constant", "body": "<p>At the top of your Rake file try adding <code>require \"#{Rails.root}/lib/simplex\"</code> to bring in your <code>Simplex</code> class. <code>Autoload</code> works like this:</p>\n\n<p><strong>mylibrary.rb</strong></p>\n\n<pre><code>puts \"I was loaded!\"\n\nclass MyLibrary\nend\n</code></pre>\n\n<p><strong>IRB</strong></p>\n\n<pre><code>irb(main):001:0&gt; require 'mylibrary'\nI was loaded!\n=&gt; true\n\nirb(main):001:0&gt; autoload :MyLibrary, 'mylibrary'\n=&gt; nil\nirb(main):002:0&gt; MyLibrary.new\nI was loaded!\n=&gt; #&lt;MyLibrary:0x0b1jef&gt;\n</code></pre>\n\n<p>I would highly recommend reading <a href=\"https://stackoverflow.com/questions/804297/when-to-use-require-load-or-autoload-in-ruby\">this article</a> on what the difference between <code>require</code> and <code>autoload</code> is. More importantly, <code>autoload</code> is in the process of being deprecated because of pitfalls regarding it's lazy loading.</p>\n"}], "owner": {"reputation": 5764, "user_id": 3033691, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/0d3286fd40aade0e7bf90d4d0eda0f29?s=128&d=identicon&r=PG&f=1", "display_name": "userMod2", "link": "https://stackoverflow.com/users/3033691/usermod2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2008, "favorite_count": 0, "accepted_answer_id": 51959797, "answer_count": 1, "score": 0, "last_activity_date": 1534912735, "creation_date": 1534910980, "question_id": 51959747, "link": "https://stackoverflow.com/questions/51959747/ruby-nameerror-uninitialized-constant", "title": "Ruby NameError: uninitialized constant", "body": "<p>Just started with Ruby - and already stuck :)</p>\n\n<p>I have a module like this:</p>\n\n<pre><code>module Simple\n  Env = AppEnv::Environment.new { |env, src|\n    env.test = src.test\n  }\n\n  class Application &lt; Rails::Application\n    config.autoload_paths += [\n      \"#{config.root}/app/lib/\"\n    ]\n  end\n\nend\n</code></pre>\n\n<p>Then a class named <code>simplex.rb</code> in the folder /app/lib</p>\n\n<pre><code>class Simplex\n\n    def initialize(some)\n        puts(some)\n    end\n\nend\n</code></pre>\n\n<p>Finally a rake task that looks like:</p>\n\n<pre><code>task(:simple =&gt; 'simple:default')\n\nnamespace(:simple) {\n\n  desc('Run simple, first task')\n  task(:default =&gt; :load) do\n    Simplex.new('okok')\n  end\n}\n</code></pre>\n\n<p>However I keep getting the error: <code>NameError: uninitialized constant Simplex</code></p>\n\n<p>I would have thought the autoload_paths would allow <code>Simplex</code> to be found.</p>\n\n<p>Any ideas what I'm doing wrong - seems really trival but I cant see what.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "rspec"], "comments": [{"owner": {"reputation": 2301, "user_id": 19317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47035e07012da3162b6e83650ee3abe0?s=128&d=identicon&r=PG", "display_name": "aridlehoover", "link": "https://stackoverflow.com/users/19317/aridlehoover"}, "edited": false, "score": 0, "creation_date": 1534915998, "post_id": 51959233, "comment_id": 90870916, "body": "FWIW, sorting this way pulls ALL link records into memory, then sorts them in an array. You&#39;d get much better performance if you let the database do the sorting for you: <code>Link.all.order(&#39;upvotes - downvotes DESC&#39;)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "is_accepted": true, "score": 0, "last_activity_date": 1534914873, "creation_date": 1534914873, "answer_id": 51960248, "question_id": 51959233, "link": "https://stackoverflow.com/questions/51959233/rails-rspec-feature-test-failing-due-to-nil-value-model-test-passing/51960248#51960248", "title": "Rails RSpec feature test failing due to nil value, model test passing", "body": "<p><code>default: 0</code> in the schema applies to the database column. This value is being assigned <em>upon the record is being saved to the database</em>.</p>\n\n<p>The method <code>score</code> in your model is called on unsaved <code>link</code>. Until saved, it does not magically have <code>upvotes</code> and <code>downvotes</code> columns initialized.</p>\n\n<p>You have two opportunities: either implement <a href=\"https://stackoverflow.com/questions/6422199/what-is-the-difference-between-after-create-and-after-save-and-when-to-use-w#6422221\"><code>after_create</code></a> callback in your model, initializing both <code>upvotes</code> and <code>downvotes</code> to zero values or simply:</p>\n\n<pre><code>def score\n  upvotes.to_i - downvotes.to_i\nend\n</code></pre>\n\n<p>Since <code>nil.to_i == 0</code>, you are all set and I believe test is to pass.</p>\n"}], "owner": {"reputation": 320, "user_id": 6501234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e980b8b7894381f8d85eb060b7b0cbf?s=128&d=identicon&r=PG", "display_name": "Corey Gibson", "link": "https://stackoverflow.com/users/6501234/corey-gibson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 343, "favorite_count": 0, "accepted_answer_id": 51960248, "answer_count": 1, "score": 1, "last_activity_date": 1534914873, "creation_date": 1534906150, "question_id": 51959233, "link": "https://stackoverflow.com/questions/51959233/rails-rspec-feature-test-failing-due-to-nil-value-model-test-passing", "title": "Rails RSpec feature test failing due to nil value, model test passing", "body": "<p>I am running into an issue with model tests and feature tests in rails 5.1.6. \nMy model schema looks like </p>\n\n<pre><code>create_table \"links\", force: :cascade do |t|\n  t.string \"link_title\"\n  t.string \"link_url\"\n  t.integer \"upvotes\", default: 0, null: false\n  t.integer \"downvotes\", default: 0, null: false\n  ...\nend\n</code></pre>\n\n<p>my link model file</p>\n\n<pre><code>class Link &lt; ApplicationRecord\n  def self.hottest_first\n    Link.all.sort_by(&amp;:score).reverse\n  end\n\n  def score\n    upvotes - downvotes\n  end\nend\n</code></pre>\n\n<p>and my controller looks like </p>\n\n<pre><code>class LinksController &lt; ApplicationController\n  def index\n     @links = Link.all.hottest_first\n  end\nend\n</code></pre>\n\n<p>When I run my test suite all other tests including model test pass, but this feature test fails.</p>\n\n<pre><code> RSpec.feature \"User submits a link\" do\n   scenario \"they see the page for the submitted link\" do\n   link_title = \"This Testing Rails book is awesome!\"\n   link_url = \"http://testingrailsbook.com\"\n\n   visit root_path\n   click_on \"Submit a new link\"\n   fill_in \"Link title\", with: link_title\n   fill_in \"Link url\", with: link_url\n   click_on 'Submit!'\n\n   expect(page).to have_link link_title, href: link_url\n end\n</code></pre>\n\n<p>and the error I get is </p>\n\n<pre><code> User submits a link they see the page for the submitted link\n    Failure/Error: upvotes - downvotes\n\n NoMethodError:\n   undefined method `-' for nil:NilClass\n # ./app/models/link.rb:18:in `score'\n # ./app/models/link.rb:6:in `sort_by'\n # ./app/models/link.rb:6:in `hottest_first'\n # ./app/controllers/links_controller.rb:3:in `index'\n</code></pre>\n\n<p>I have no idea why this would only fail this test but pass in my model tests or any other test that is looking at either my API or Index, All other tests pass, If I look at the console it shows that downvotes and upvotes are both equal to 0 and not nil. Any help would be great.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "factory-bot", "rspec-rails"], "comments": [{"owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 0, "creation_date": 1534902090, "post_id": 51958747, "comment_id": 90867942, "body": "What data type is the order_hash in your db?"}, {"owner": {"reputation": 2659, "user_id": 2534479, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/2472926967c5dbb6e31895a660a472ce?s=128&d=identicon&r=PG", "display_name": "aldrien.h", "link": "https://stackoverflow.com/users/2534479/aldrien-h"}, "reply_to_user": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 0, "creation_date": 1534904007, "post_id": 51958747, "comment_id": 90868331, "body": "@SebastianPalma :text"}, {"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1534932217, "post_id": 51958747, "comment_id": 90878724, "body": "It could be something in your test? Or something in the model (e.g. <code>before_save</code>, or an overridden <code>User#order_hash</code> method?) Or some module/base class/gem that alters the behaviour? Without a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> of the problem, I don&#39;t know what to suggest."}, {"owner": {"reputation": 2659, "user_id": 2534479, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/2472926967c5dbb6e31895a660a472ce?s=128&d=identicon&r=PG", "display_name": "aldrien.h", "link": "https://stackoverflow.com/users/2534479/aldrien-h"}, "reply_to_user": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1534984926, "post_id": 51958747, "comment_id": 90903921, "body": "@TomLord you&#39;re right, since I used OpenStruct to use data as (.id, .email etc) then when the code converts it to json, that&#39;s when the {&quot;table&quot; =&gt; {}} was generated. Still figuring out how to remove it."}, {"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1535021746, "post_id": 51958747, "comment_id": 90917630, "body": "@aldrien.h If you share the implementation - i.e. provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> - I&#39;d be happy to help. But without knowing what you&#39;ve done with <code>OpenStruct</code>, I can only make vague guesses to the solution."}, {"owner": {"reputation": 2659, "user_id": 2534479, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/2472926967c5dbb6e31895a660a472ce?s=128&d=identicon&r=PG", "display_name": "aldrien.h", "link": "https://stackoverflow.com/users/2534479/aldrien-h"}, "reply_to_user": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1535082175, "post_id": 51958747, "comment_id": 90943506, "body": "Hi @TomLord if i have something like,  {:id=&gt;1, :codes=&gt;[{&#39;test&#39;=&gt; 1}, {&#39;test&#39;=&gt;2}]} how can i convert it to OpenStuct Object, even hashes inside the Array. Thank you."}, {"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1535126432, "post_id": 51958747, "comment_id": 90966495, "body": "I don&#39;t know how that relates to your error, sorry. I need to see a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>.  How can I <i>reproduce</i> the error? Where does the <code>table</code> come from?"}], "owner": {"reputation": 2659, "user_id": 2534479, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/2472926967c5dbb6e31895a660a472ce?s=128&d=identicon&r=PG", "display_name": "aldrien.h", "link": "https://stackoverflow.com/users/2534479/aldrien-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 312, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1534901663, "creation_date": 1534901663, "question_id": 51958747, "link": "https://stackoverflow.com/questions/51958747/how-to-properly-set-hash-value-in-rspec-factorygirl", "title": "How to properly set hash value in Rspec FactoryGirl", "body": "<p>I'm doing a test using RSPEC.\nIn my model, i have </p>\n\n<pre><code>class User &lt; ActiveRecord::Base\n   serialize :order_hash\n   ....\nend\n</code></pre>\n\n<p>In my Factory, i have:</p>\n\n<pre><code>FactoryGirl.define do\n factory :user do\n   ....\n   order_hash { {\"id\"=&gt;389700649004, \"email\"=&gt;\"test@gmail.com\"} }\n end\nend\n</code></pre>\n\n<p>But my problem parsing/using the values after save is that it became:</p>\n\n<pre><code>User.first.order_hash returns:\n\n{\"table\"=&gt;{\"id\"=&gt;505311428702, \"email\"=&gt;\"croska2012@gmail.com\"}}\n\nWhat I need is: {\"id\"=&gt;505311428702, \"email\"=&gt;\"croska2012@gmail.com\"}\n</code></pre>\n\n<p>How can I save the values <strong>without</strong> <code>\"table\"=&gt;</code>, i need only the data hash as i set in Factory.\nI tried to add <code>.to_hash</code> but doesn't worked.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["ruby", "server", "openshift"], "comments": [{"owner": {"reputation": 2261, "user_id": 6758654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6b2a3b1b8096648e199c9d4fa351f47?s=128&d=identicon&r=PG&f=1", "display_name": "Will Gordon", "link": "https://stackoverflow.com/users/6758654/will-gordon"}, "edited": false, "score": 0, "creation_date": 1534900930, "post_id": 51958315, "comment_id": 90867746, "body": "You should be adding a <code>.s2i&#47;bin&#47;run</code> script that calls your ruby file as a daemon. Source: <a href=\"https://docs.openshift.com/online/creating_images/s2i.html#s2i-scripts\" rel=\"nofollow noreferrer\">docs.openshift.com/online/creating_images/s2i.html#s2i-scrip&zwnj;&#8203;ts</a>"}, {"owner": {"reputation": 54548, "user_id": 128141, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70dfb4afd84b106d0855184bf0ae4675?s=128&d=identicon&r=PG", "display_name": "Graham Dumpleton", "link": "https://stackoverflow.com/users/128141/graham-dumpleton"}, "reply_to_user": {"reputation": 2261, "user_id": 6758654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6b2a3b1b8096648e199c9d4fa351f47?s=128&d=identicon&r=PG&f=1", "display_name": "Will Gordon", "link": "https://stackoverflow.com/users/6758654/will-gordon"}, "edited": false, "score": 0, "creation_date": 1534901154, "post_id": 51958315, "comment_id": 90867793, "body": "Adding to what @WillGordon said, ensure that the last command in override executable <code>.s2i&#47;bin&#47;run</code> script uses <code>exec</code> to run the command. Also see details about overriding <code>run</code> script in <a href=\"https://www.openshift.com/deploying-to-openshift/\" rel=\"nofollow noreferrer\">openshift.com/deploying-to-openshift</a>"}, {"owner": {"reputation": 1825, "user_id": 2016305, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/lwFqE.jpg?s=128&g=1", "display_name": "vcapra1", "link": "https://stackoverflow.com/users/2016305/vcapra1"}, "edited": false, "score": 0, "creation_date": 1534980421, "post_id": 51958315, "comment_id": 90903122, "body": "Thanks! This worked (after I also wrote an assemble script to install the gems to the right location).  However, exec suppresses the output, and it doesn&#39;t write the daemon&#39;s output to the log.  Is there a way to fix this?"}], "owner": {"reputation": 1825, "user_id": 2016305, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/lwFqE.jpg?s=128&g=1", "display_name": "vcapra1", "link": "https://stackoverflow.com/users/2016305/vcapra1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1534897077, "creation_date": 1534897077, "question_id": 51958315, "link": "https://stackoverflow.com/questions/51958315/openshift-use-ruby-without-rack", "title": "OpenShift use Ruby without Rack", "body": "<p>I am making a API project on OpenShift, which has a Node.js server and Ruby backend.  I have set up a deployment for Node.js to handle API requests and a MongoDB deployment to store the data, but I'm having trouble with the Ruby backend.</p>\n\n<p>The Ruby backend is responsible for updating the database every so often and thus must run at a regular interval or constantly.  That's find, the issue is that OpenShift seems to want me to use Rack to start a web server, but that's not what I want.  I just want the Ruby to run as a daemon and scrape the web to update the API every, say, 15 minutes.</p>\n\n<p>How can I use Ruby without making a webserver- that is, get around the errors about not having Rack gem installed?</p>\n"}, {"tags": ["ruby", "random", "iterator"], "comments": [{"owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 1, "creation_date": 1534893560, "post_id": 51957702, "comment_id": 90866266, "body": "Doesn&#39;t <code>(0..99).step(rand(0..99)).to_a</code> work for you?. <code>(0..99)</code> gives you a &quot;sorted&quot; range, and the step is &quot;random&quot;, so the length of the result is &quot;uncertain&quot;."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1534904904, "post_id": 51957702, "comment_id": 90868494, "body": "Is the process as follows? Randomly pick a number between <code>0</code> and <code>99</code>. Suppose that number is <code>31</code>. Next pick a random number between <code>32</code> (or would that be <code>31</code>?) and <code>99</code>. Suppose that is <code>72</code>. Then pick a number between <code>73</code> (or <code>72</code>?) and <code>99</code>. Continue until <code>99</code> has been picked, then quit. Why do you wish to do that?"}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1534919560, "post_id": 51957702, "comment_id": 90872176, "body": "The process you have in mind would result in a heavily biased distribution. If you increment randomly on each step, you&#39;re much more likely to get higher numbers."}], "answers": [{"comments": [{"owner": {"reputation": 609, "user_id": 3891844, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/cf945cc749dae8c0d8e397df058acdde?s=128&d=identicon&r=PG", "display_name": "Nondv", "link": "https://stackoverflow.com/users/3891844/nondv"}, "reply_to_user": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 1, "creation_date": 1534964851, "post_id": 51957952, "comment_id": 90897565, "body": "@mudasobwa 1) &quot;here&#39;s slow yet simple one:&quot;, 2) &quot;or ...&quot;, 3) &quot;or ...&quot;."}], "tags": [], "owner": {"reputation": 609, "user_id": 3891844, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/cf945cc749dae8c0d8e397df058acdde?s=128&d=identicon&r=PG", "display_name": "Nondv", "link": "https://stackoverflow.com/users/3891844/nondv"}, "is_accepted": false, "score": 2, "last_activity_date": 1534893804, "creation_date": 1534893804, "answer_id": 51957952, "question_id": 51957702, "link": "https://stackoverflow.com/questions/51957702/ruby-using-each-or-step-step-forward-a-random-amount-for-each-iteration/51957952#51957952", "title": "Ruby: using `.each` or `.step`, step forward a random amount for each iteration", "body": "<p>There're many ways to achieve it.</p>\n\n<p>For example here's slow yet simple one:</p>\n\n<pre><code># given `array`\nrandom_indexes = (0...array.size).to_a.sample(rand(array.size))\nrandom_indexes.sort.each { |i| puts array[i] }\n</code></pre>\n\n<p>Or why don't you just:</p>\n\n<pre><code>array.each do |value|\n  next if rand(2).zero?\n  puts value\nend\n</code></pre>\n\n<p>Or you could use <code>Enumerator#next</code> random number of times.</p>\n"}, {"comments": [{"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 1, "creation_date": 1534920155, "post_id": 51959790, "comment_id": 90872447, "body": "Interesting approach. I&#39;d use <code>rand &lt; 0.5</code> or <code>rand &lt; 0.1</code> to adjust the probability, though."}], "tags": [], "owner": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "is_accepted": false, "score": 2, "last_activity_date": 1534911339, "creation_date": 1534911339, "answer_id": 51959790, "question_id": 51957702, "link": "https://stackoverflow.com/questions/51957702/ruby-using-each-or-step-step-forward-a-random-amount-for-each-iteration/51959790#51959790", "title": "Ruby: using `.each` or `.step`, step forward a random amount for each iteration", "body": "<p>Below example returns a sorted array with random entries from given range based on randomly picked <code>true</code> or <code>false</code> from array <code>[true, false]</code>:</p>\n\n<pre><code>(0..99).select { [true, false].sample }\n =&gt; [0, 3, 12, 13, 14, 17, 20, 24, 26, 28, 30, 32, 34, 35, 36, 38, 39, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 53, 54, 55, 56, 58, 59, 60, 61, 62, 65, 67, 69, 70, 71, 79, 81, 84, 86, 91, 93, 94, 95, 98, 99]\n</code></pre>\n\n<p>To reduce the chances of a bigger array being returned, you can modify your <code>true/false</code> array to include more falsey values:</p>\n\n<pre><code>(0..99).select { ([true] + [false] * 9).sample }\n =&gt; [21, 22, 28, 33, 37, 58, 59, 63, 77, 85, 86]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 2, "creation_date": 1534919912, "post_id": 51960298, "comment_id": 90872344, "body": "<code>(0..99).to_a.sample</code> \u2192 <code>rand(0..99)</code>"}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 2, "creation_date": 1534920003, "post_id": 51960298, "comment_id": 90872377, "body": "<code>\u03bb.(\u03bb.()).sort</code> I love that :-)"}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "reply_to_user": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1534920087, "post_id": 51960298, "comment_id": 90872407, "body": "@Stefan I started to type \u201cI wonder how would you beautify <code>\u03bb.(\u03bb.()).sort</code> then?\u201d :) It\u2019s cute, yes and looks so fashionable."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "reply_to_user": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 1, "creation_date": 1534942798, "post_id": 51960298, "comment_id": 90884942, "body": "@Stefan since we are going for brevity <code>rand(0..99)</code> \u2192 <code>rand(100)</code>"}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1534942902, "post_id": 51960298, "comment_id": 90885033, "body": "@engineersmnky the question says <i>&quot;Given (0..99)&quot;</i>, so I wanted to keep that, but yeah, that&#39;s another option."}], "tags": [], "owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "is_accepted": true, "score": 4, "last_activity_date": 1534919969, "last_edit_date": 1534919969, "creation_date": 1534915229, "answer_id": 51960298, "question_id": 51957702, "link": "https://stackoverflow.com/questions/51957702/ruby-using-each-or-step-step-forward-a-random-amount-for-each-iteration/51960298#51960298", "title": "Ruby: using `.each` or `.step`, step forward a random amount for each iteration", "body": "<p>Get a random value for the number of elements to pick, randomly get this number of elements, sort.</p>\n\n<pre><code>(0..99).to_a.sample((0..99).to_a.sample).sort\n#\u21d2 [7, 20, 22, 29, 45, 48, 57, 61, 62, 76, 80, 82]\n</code></pre>\n\n<p>Or, shorter (credits to @Stefan):</p>\n\n<pre><code>(0..99).to_a.sample(rand(0..99)).sort\n#\u21d2 [7, 20, 22, 29, 45, 48, 57, 61, 62, 76, 80, 82]\n</code></pre>\n\n<p>Or, in more functional manner:</p>\n\n<pre><code>\u03bb = (0..99).to_a.method(:sample)\n\u03bb.(\u03bb.()).sort\n</code></pre>\n\n<p>To feed exactly <code>N</code> numbers:</p>\n\n<pre><code>N = 10\n(0..99).to_a.sample(N).sort\n#\u21d2\u00a0[1, 5, 8, 12, 45, 54, 60, 65, 71, 91]\n</code></pre>\n"}], "owner": {"reputation": 500, "user_id": 2328064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5f548d374108dd390e07599328b4c56e?s=128&d=identicon&r=PG&f=1", "display_name": "joshfindit", "link": "https://stackoverflow.com/users/2328064/joshfindit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 51960298, "answer_count": 3, "score": 1, "last_activity_date": 1534919969, "creation_date": 1534891705, "question_id": 51957702, "link": "https://stackoverflow.com/questions/51957702/ruby-using-each-or-step-step-forward-a-random-amount-for-each-iteration", "title": "Ruby: using `.each` or `.step`, step forward a random amount for each iteration", "body": "<p><em>(Also open to other similar non-Rails methods)</em></p>\n\n<p>Given <code>(0..99)</code>, return entries that are randomly picked in-order.</p>\n\n<p>Example results:</p>\n\n<p><code>0, 5, 11, 13, 34..</code></p>\n\n<p><code>3, 12, 45, 67, 87</code></p>\n\n<p><code>0, 1, 2, 3, 4, 5..</code> (very unlikely, of course)</p>\n\n<p>Current thought:</p>\n\n<pre><code>(0..99).step(rand(0..99)).each do |subindex|\n  array.push(subindex)\nend\n</code></pre>\n\n<p>However, this sets a single random value for all the steps whereas I'm looking for each step to be random.</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 10018834, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0968d763da5efb7a151440c1393f14d6?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/10018834/alex"}, "edited": false, "score": 0, "creation_date": 1534893874, "post_id": 51957520, "comment_id": 90866328, "body": "I&#39;m having trouble removing the &quot;d-none&quot; class now. I&#39;m not sure if the javascript is receiving the drink value correctly."}, {"owner": {"reputation": 7241, "user_id": 1096110, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XGVpR.jpg?s=128&g=1", "display_name": "Flavio Wuensche", "link": "https://stackoverflow.com/users/1096110/flavio-wuensche"}, "reply_to_user": {"reputation": 33, "user_id": 10018834, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0968d763da5efb7a151440c1393f14d6?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/10018834/alex"}, "edited": false, "score": 0, "creation_date": 1534972097, "post_id": 51957520, "comment_id": 90900735, "body": "Can you add a line with <code>alert($(&quot;#extended_list&quot;).val())</code>? What does it say?"}, {"owner": {"reputation": 33, "user_id": 10018834, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0968d763da5efb7a151440c1393f14d6?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/10018834/alex"}, "edited": false, "score": 0, "creation_date": 1534972772, "post_id": 51957520, "comment_id": 90900979, "body": "I figured out the problem, the syntax should be  $(&quot;#js-coffee-type&quot;).removeClass(&quot;d-none&quot;); instead of  $(&quot;.js-coffee-type&quot;).removeClass(&quot;d-none&quot;);"}], "tags": [], "owner": {"reputation": 7241, "user_id": 1096110, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XGVpR.jpg?s=128&g=1", "display_name": "Flavio Wuensche", "link": "https://stackoverflow.com/users/1096110/flavio-wuensche"}, "is_accepted": true, "score": 1, "last_activity_date": 1534973134, "last_edit_date": 1534973134, "creation_date": 1534890396, "answer_id": 51957520, "question_id": 51956823, "link": "https://stackoverflow.com/questions/51956823/how-to-create-a-form-with-dependent-fields-ror/51957520#51957520", "title": "How to create a form with dependent fields? (RoR)", "body": "<p>First you need to wrap the fields you'd like to hide in a div. Add a distinct id to each of them.</p>\n\n<p>For example, if you want to hide coffee_type, you can add the id \"js-coffee-type\" to it.</p>\n\n<p>Also, add a class (for instance, <code>d-none</code>, as used by Bootstrap) so we can hide it using CSS.</p>\n\n<pre><code>    &lt;%= simple_form_for(@order) do |f| %&gt;\n      &lt;div class=\"field\"&gt;\n        Drink: &lt;%= f.select :drink, ['Coffee', 'Orange Juice', 'Tea'], id: 'extended_list' %&gt;&lt;br /&gt;\n      &lt;/div&gt;\n\n      &lt;div id=\"js-coffee-type\" class=\"d-none\"&gt;Coffee Type: &lt;%= f.select :coffee_type, ['Espresso', 'Cappuccino', 'Filter', 'Greek', 'Frappe', 'Latte'] %&gt;&lt;/div&gt;\n      &lt;div&gt;Sugar Amount: &lt;%= f.select :sugar_amount, ((1..5).map {|i| [i,i] } &lt;&lt; [\"None\",nil]) %&gt;&lt;/div&gt;\n      &lt;div&gt;Milk Amount: &lt;%= f.select :milk_amount, ((1..5).map {|i| [i,i] } &lt;&lt; [\"None\",nil]) %&gt;&lt;/div&gt;\n\n      &lt;%= f.button :submit, class: \"button is-info\" %&gt;\n    &lt;% end %&gt;\n</code></pre>\n\n<p>In the same file, you can write the CSS code that hides this field. </p>\n\n<pre><code>    &lt;style&gt;\n    .d-none { display: none; }\n    &lt;/style&gt;\n</code></pre>\n\n<p>Now you can write the JS code to toggle the class depending on the first field.</p>\n\n<pre><code>    &lt;script&gt;\n    $(\"#extended_list\").change(function() {\n      var drink = $(\"#extended_list\").val();\n\n      if (drink == \"Coffee\") {\n        $(\"#js-coffee-type\").removeClass(\"d-none\");\n      } else {\n        $(\"#js-coffee-type\").addClass(\"d-none\");\n      }\n    });\n    &lt;/script&gt;\n</code></pre>\n\n<p>These are not best practices but they should do the work.</p>\n"}], "owner": {"reputation": 33, "user_id": 10018834, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0968d763da5efb7a151440c1393f14d6?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/10018834/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 51957520, "answer_count": 1, "score": 0, "last_activity_date": 1534973134, "creation_date": 1534886234, "question_id": 51956823, "link": "https://stackoverflow.com/questions/51956823/how-to-create-a-form-with-dependent-fields-ror", "title": "How to create a form with dependent fields? (RoR)", "body": "<p>I am wondering how to create a form that displays field dependent on the fields selected beforehand. For example: if Coffee is selected as a drink, only then do I want to allow sugar and milk amounts to be input. </p>\n\n<p>Here is my form:</p>\n\n<pre><code>&lt;%= simple_form_for(@order) do |f| %&gt;\n    &lt;%= f.error_notification %&gt;\n    &lt;div class=\"field\"&gt;\n    Drink: &lt;%= f.select :drink, ['Coffee', 'Orange Juice', 'Tea'], id: 'extended_list' %&gt;&lt;br /&gt;\n    &lt;/div&gt;\n    Coffee Type: &lt;%= f.select :coffee_type, ['Espresso', 'Cappuccino', 'Filter', 'Greek', 'Frappe', 'Latte'] %&gt;&lt;br /&gt;\n\n    Sugar Amount: &lt;%= f.select :sugar_amount, ((1..5).map {|i| [i,i] } &lt;&lt; [\"None\",nil]) %&gt;&lt;br /&gt;\n\n    Milk Amount: &lt;%= f.select :milk_amount, ((1..5).map {|i| [i,i] } &lt;&lt; [\"None\",nil]) %&gt;&lt;br /&gt;\n    &lt;% end %&gt;\n      &lt;%= f.button :submit, class: \"button is-info\" %&gt;\n\n    &lt;% end %&gt;\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "web"], "comments": [{"owner": {"reputation": 4690, "user_id": 1937435, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YyN37.jpg?s=128&g=1", "display_name": "Josh Brody", "link": "https://stackoverflow.com/users/1937435/josh-brody"}, "edited": false, "score": 2, "creation_date": 1534883456, "post_id": 51956254, "comment_id": 90863151, "body": "are you certain that you won&#39;t create more than 100 (00-99) objects in a day?"}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1534883651, "post_id": 51956254, "comment_id": 90863229, "body": "Is this a pre-existing hard requirement? For example, is it the ID format required for some other system you&#39;re talking to? If not, there&#39;s probably a better way to handle whatever problem this is trying to solve. Like <a href=\"https://en.wikipedia.org/wiki/Universally_unique_identifier\" rel=\"nofollow noreferrer\">UUIDs</a>."}, {"owner": {"reputation": 614, "user_id": 4389250, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh4.googleusercontent.com/-F8rJHdQAUgY/AAAAAAAAAAI/AAAAAAAAAJQ/114BANdH3Hs/photo.jpg?sz=128", "display_name": "Sebastian Delgado", "link": "https://stackoverflow.com/users/4389250/sebastian-delgado"}, "reply_to_user": {"reputation": 4690, "user_id": 1937435, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YyN37.jpg?s=128&g=1", "display_name": "Josh Brody", "link": "https://stackoverflow.com/users/1937435/josh-brody"}, "edited": false, "score": 0, "creation_date": 1534883877, "post_id": 51956254, "comment_id": 90863312, "body": "@JoshBrody yes, that requirement was given by the stakeholders."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1534884044, "post_id": 51956254, "comment_id": 90863380, "body": "@SebastianDelgado Can you convince them otherwise? This is a poor engineering choice."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1534884124, "post_id": 51956254, "comment_id": 90863410, "body": "Also, which database are you using?"}, {"owner": {"reputation": 1389, "user_id": 4133078, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P24yz.jpg?s=128&g=1", "display_name": "Cody Gustafson", "link": "https://stackoverflow.com/users/4133078/cody-gustafson"}, "edited": false, "score": 1, "creation_date": 1534968906, "post_id": 51956254, "comment_id": 90899326, "body": "Since it looks like nobody pointed it out directly. If multiple people have the same initials they will share the max 100 updates per day. For all letters A-Z (26 letters) and the 100 updates maximum 26 * 26 * 100 = 67600 is the maximum number of writes when utilizing <i>all</i> the initials for a whole day. So since unique, that is the maximum number of writes throughout the whole system for a single day. Since there are only 676 unique pair of initials it would have to be a fairly small system for this to not turn into an issue for you."}, {"owner": {"reputation": 614, "user_id": 4389250, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh4.googleusercontent.com/-F8rJHdQAUgY/AAAAAAAAAAI/AAAAAAAAAJQ/114BANdH3Hs/photo.jpg?sz=128", "display_name": "Sebastian Delgado", "link": "https://stackoverflow.com/users/4389250/sebastian-delgado"}, "reply_to_user": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1535034870, "post_id": 51956254, "comment_id": 90926092, "body": "@Schwern, I&#39;m trying to persuade them NOT to do this the way they originally wanted it to be but they just keep insisting"}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "reply_to_user": {"reputation": 1389, "user_id": 4133078, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P24yz.jpg?s=128&g=1", "display_name": "Cody Gustafson", "link": "https://stackoverflow.com/users/4133078/cody-gustafson"}, "edited": false, "score": 0, "creation_date": 1535043549, "post_id": 51956254, "comment_id": 90931334, "body": "@CodyGustafson It&#39;s worse. According to the example there&#39;s only one daily counter shared between all records regardless of prefix. 100 new records per day."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1535043638, "post_id": 51956254, "comment_id": 90931383, "body": "@SebastianDelgado Good luck."}], "answers": [{"tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": true, "score": 1, "last_activity_date": 1534958059, "last_edit_date": 1534958059, "creation_date": 1534884588, "answer_id": 51956512, "question_id": 51956254, "link": "https://stackoverflow.com/questions/51956254/ruby-on-rails-how-to-reset-a-counter-every-day/51956512#51956512", "title": "Ruby on Rails, How to reset a counter every day?", "body": "<blockquote>\n  <p><em>Where the first 2 letters are the initials of a name, the next 2 are the current day, next 2 current month, next 2 current year, next 2 incremental number (from 0 to 99, reset daily).</em></p>\n</blockquote>\n\n<p><a href=\"https://stackoverflow.com/questions/51956254/ruby-on-rails-how-to-reset-a-counter-every-day#comment90863151_51956254\">As folks in the comments have pointed out</a>, this assumes there is a maximum of 100 entries per day, and it will have problems in 2100. One is more pressing than the other. Maybe if you go over 100 you can start using letters?</p>\n\n<blockquote>\n  <p><em>Also every reference HAS TO be unique.</em></p>\n</blockquote>\n\n<p>For globally unique identifiers <a href=\"https://en.wikipedia.org/wiki/Universally_unique_identifier#Version_2_(date-time_and_MAC_address,_DCE_security_version)\" rel=\"nofollow noreferrer\">UUID</a>s, Universally Unique IDentifiers, are generally the way to go. If you can change this requirement it would be both simpler (databases already support UUIDs), more robust (UUIDs aren't limited to 100 per day), and more secure (they don't leak information about the thing being identified).</p>\n\n<hr>\n\n<p>Assuming you can't change the requirement, the next number can be gotten by adding up the number of existing rows that day.</p>\n\n<pre><code>select count(id)\nfrom stuff\nwhere date(created_at) == date(NOW());\n</code></pre>\n\n<p>However there is a problem if two processes both insert a new record at the same time and get the same next number. Probably highly unlikely if you're expecting only 100 a day, but still possible.</p>\n\n<pre><code>Process 1                   Process 2                  Time\n\nselect count(id) ...                                   1\n                            select count(id) ...       2\ninsert into stuff ...                                  3\n                            insert into stuff...       4\n</code></pre>\n\n<p>A transaction won't save you. You could get an exclusive lock on the whole table, but that's dangerous and slow. Instead you can use <a href=\"https://github.com/ClosureTree/with_advisory_lock\" rel=\"nofollow noreferrer\">an advisory lock</a> for this one operation. Just make sure all code which writes new records uses this same advisory lock.</p>\n\n<pre><code>Stuff.with_advisory_lock(:new_stuff_record) do\n  ...\nend\n</code></pre>\n\n<hr>\n\n<p>Alternatively, store the daily ID in a column. Add a database trigger to add 1 on insert. Set it back to 0 with a scheduled job at midnight.</p>\n"}, {"comments": [{"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1534885693, "post_id": 51956722, "comment_id": 90864051, "body": "This is basically what I wrote. It&#39;s vulnerable to race conditions."}], "tags": [], "owner": {"reputation": 7241, "user_id": 1096110, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XGVpR.jpg?s=128&g=1", "display_name": "Flavio Wuensche", "link": "https://stackoverflow.com/users/1096110/flavio-wuensche"}, "is_accepted": false, "score": 1, "last_activity_date": 1534885758, "last_edit_date": 1534885758, "creation_date": 1534885656, "answer_id": 51956722, "question_id": 51956254, "link": "https://stackoverflow.com/questions/51956254/ruby-on-rails-how-to-reset-a-counter-every-day/51956722#51956722", "title": "Ruby on Rails, How to reset a counter every day?", "body": "<p>I will assume your class is named <code>Record</code> and it has an attribute called <code>reference_number</code>.</p>\n\n<p>If that is the case, you can use the following method to fetch the two last digits.</p>\n\n<pre><code>def fetch_following_two_last_digits\n  if Record.last.created_at &lt; Time.current.beginning_of_day\n    \"00\"\n  else\n    (Record.last.reference_number.last(2).to_i + 1).to_s\n  end\nend\n</code></pre>\n\n<p>Also assuming you never reach 100 records a day. Otherwise, you'd end up having three last digits.</p>\n"}], "owner": {"reputation": 614, "user_id": 4389250, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh4.googleusercontent.com/-F8rJHdQAUgY/AAAAAAAAAAI/AAAAAAAAAJQ/114BANdH3Hs/photo.jpg?sz=128", "display_name": "Sebastian Delgado", "link": "https://stackoverflow.com/users/4389250/sebastian-delgado"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 383, "favorite_count": 0, "accepted_answer_id": 51956512, "answer_count": 2, "score": -1, "last_activity_date": 1534958059, "creation_date": 1534883286, "question_id": 51956254, "link": "https://stackoverflow.com/questions/51956254/ruby-on-rails-how-to-reset-a-counter-every-day", "title": "Ruby on Rails, How to reset a counter every day?", "body": "<p>I need to save a reference number every time I save a record of a certain model, the reference should be composed of 10 numbers, the first 8 numbers are related to the creator id and date, but the last 2 digits should be an incremental number starting at 00 and ending at 99, this count should be reset every single day.</p>\n\n<p>For example:</p>\n\n<pre><code>Records created the same day:\nSD01011800\nGF01011801\nMT01011802\n...\nGH01011899\n------------------------------------------------------------------------------\nRecords created the next day:\nSD02011800\nGF02011801\nMT02011802\n...\nGH02011899\n</code></pre>\n\n<p>Where the first 2 letters are the initials of a name, the next 2 are the current day, next 2 current month, next 2 current year, next 2 incremental number (from 0 to 99, reset daily)</p>\n\n<p>Also every reference HAS TO be unique.\nI'm missing the last two digits part, any idea on how to grant this ?\nThanks for reading.</p>\n"}, {"tags": ["ruby", "file", "variables"], "comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 1, "creation_date": 1534882367, "post_id": 51956007, "comment_id": 90862595, "body": "What do you intend to do with them afterwards? You cannot dynamically create local variables but depending on your end goal there are lots of ways to implement this"}], "answers": [{"tags": [], "owner": {"reputation": 686, "user_id": 1491410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c938ed150a685b33d1b91266b382c8d?s=128&d=identicon&r=PG", "display_name": "elliotcm", "link": "https://stackoverflow.com/users/1491410/elliotcm"}, "is_accepted": false, "score": 0, "last_activity_date": 1534882772, "creation_date": 1534882772, "answer_id": 51956129, "question_id": 51956007, "link": "https://stackoverflow.com/questions/51956007/ruby-create-unknown-amount-of-variables-from-file/51956129#51956129", "title": "Ruby - create unknown amount of variables from file", "body": "<p>It feels like you really want an array here.  To that end you can read the file directly into an array, one entry per line:</p>\n\n<pre><code>array_of_lines = File.readlines(\"file.txt\")\narray_of_lines[0]\n=&gt; \"variable one\\n\"\narray_of_lines[1]\n=&gt; \"300\\n\"\n</code></pre>\n\n<p>etc</p>\n"}, {"comments": [{"owner": {"reputation": 161, "user_id": 6275391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66e37308ad810c080150eb2ae8bcb7dc?s=128&d=identicon&r=PG&f=1", "display_name": "Voidableryzer", "link": "https://stackoverflow.com/users/6275391/voidableryzer"}, "edited": false, "score": 0, "creation_date": 1534883745, "post_id": 51956180, "comment_id": 90863269, "body": "Thank you very much. I&#39;ve been struggling with this for a while now, finally, I&#39;ve got it. Once again, thanks."}, {"owner": {"reputation": 161, "user_id": 6275391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66e37308ad810c080150eb2ae8bcb7dc?s=128&d=identicon&r=PG&f=1", "display_name": "Voidableryzer", "link": "https://stackoverflow.com/users/6275391/voidableryzer"}, "edited": false, "score": 0, "creation_date": 1534884759, "post_id": 51956180, "comment_id": 90863680, "body": "Just wondering: how would I then be able to print every variable?"}, {"owner": {"reputation": 4690, "user_id": 1937435, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YyN37.jpg?s=128&g=1", "display_name": "Josh Brody", "link": "https://stackoverflow.com/users/1937435/josh-brody"}, "reply_to_user": {"reputation": 161, "user_id": 6275391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66e37308ad810c080150eb2ae8bcb7dc?s=128&d=identicon&r=PG&f=1", "display_name": "Voidableryzer", "link": "https://stackoverflow.com/users/6275391/voidableryzer"}, "edited": false, "score": 0, "creation_date": 1534908798, "post_id": 51956180, "comment_id": 90869291, "body": "@Voidableryzer <code>self.instance_variables</code> will list all instance variables as an array. you can loop through them and print the ones you want, a la <code>self.instance_variables.select { |var| var.index(&quot;var&quot;) }.each { |var| puts instance_variable_get(var) }</code>"}, {"owner": {"reputation": 161, "user_id": 6275391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66e37308ad810c080150eb2ae8bcb7dc?s=128&d=identicon&r=PG&f=1", "display_name": "Voidableryzer", "link": "https://stackoverflow.com/users/6275391/voidableryzer"}, "edited": false, "score": 0, "creation_date": 1534923086, "post_id": 51956180, "comment_id": 90873814, "body": "Ok, thanks for the help."}], "tags": [], "owner": {"reputation": 4690, "user_id": 1937435, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YyN37.jpg?s=128&g=1", "display_name": "Josh Brody", "link": "https://stackoverflow.com/users/1937435/josh-brody"}, "is_accepted": true, "score": 1, "last_activity_date": 1534882991, "creation_date": 1534882991, "answer_id": 51956180, "question_id": 51956007, "link": "https://stackoverflow.com/questions/51956007/ruby-create-unknown-amount-of-variables-from-file/51956180#51956180", "title": "Ruby - create unknown amount of variables from file", "body": "<p>This answers your question, but context is certainly required to do this in a way that actually matters to your application.</p>\n\n<p>This isn't necessarily the only way, or even the \"best\" way, but it's the most straightforward in my opinion:</p>\n\n<pre><code>File.read(\"file.txt\").split(\"\\n\").each_with_index do |line, index|\n  instance_variable_set(\"@var#{index}\", line) \nend\n\n@var0 #variable one\n@var1 #I'm variable 2\n</code></pre>\n\n<p>If you want to convert <code>False</code> and <code>300</code> from a string \u2014\u00a0which is how it's read from the file \u2014 to a ruby object, you'd have to do some manual parsing. Say,</p>\n\n<pre><code>def content_for_line(line)\n  if line == 'False'\n    return false\n  end\n  if line.to_s == line.to_i.to_s\n    return line.to_i \n  end\n  line\nend\n\n...\n\ninstance_variable_set(\"@var#{index}\", content_for_line(line)) \n</code></pre>\n\n<p>Maybe you only want to read the file as an array though.</p>\n\n<pre><code>array = File.read(\"file.txt\").split(\"\\n\")\n\narray[0] #variable one\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "is_accepted": false, "score": 0, "last_activity_date": 1534884085, "creation_date": 1534884085, "answer_id": 51956409, "question_id": 51956007, "link": "https://stackoverflow.com/questions/51956007/ruby-create-unknown-amount-of-variables-from-file/51956409#51956409", "title": "Ruby - create unknown amount of variables from file", "body": "<p>You could implement this as as class with built in parsing logic (I only handled the given example):</p>\n\n<pre><code>class VarGroup\n  attr_reader :vars\n  def initialize(file_name)\n    @vars = File.foreach(file_name).map do |l|\n      if l =~ /(True|False)/i\n        l.match?(/True/i)\n      else  \n        begin  \n          Integer(l)\n        rescue ArgumentError \n          l.strip\n        end  \n      end\n    end\n  end\n\n  def method_missing(method_name,*args,&amp;block)\n    if method_name =~ /var(\\d+)/ &amp;&amp; $1.to_i.nonzero? &amp;&amp; $1.to_i &lt;= vars.size\n      @vars[$1.to_i - 1] \n    else \n      super\n    end\n  end\nend \n</code></pre>\n\n<p>Then it can be called like </p>\n\n<pre><code>v = VarGroup.new('test.txt')\nv.vars \n#=&gt; [\"variable one\", \"I'm variable 2\", 300, false, \"I am variable 5\"]\n(1..6).each do |n|\n  p v.public_send(\"var#{n}\")\nend\n# \"variable one\"\n# \"I'm variable 2\"\n# 300\n# false\n# \"I am variable 5\"\n# undefined method `var6' for #&lt;VarGroup:0x000055a23e2f64e0&gt;\n</code></pre>\n"}], "owner": {"reputation": 161, "user_id": 6275391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66e37308ad810c080150eb2ae8bcb7dc?s=128&d=identicon&r=PG&f=1", "display_name": "Voidableryzer", "link": "https://stackoverflow.com/users/6275391/voidableryzer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "closed_date": 1534969453, "accepted_answer_id": 51956180, "answer_count": 3, "score": -1, "last_activity_date": 1534884085, "creation_date": 1534882161, "question_id": 51956007, "link": "https://stackoverflow.com/questions/51956007/ruby-create-unknown-amount-of-variables-from-file", "closed_reason": "Duplicate", "title": "Ruby - create unknown amount of variables from file", "body": "<p>This might be hard to explain, but I'll try.</p>\n\n<p>Let's say I have a text file containing:</p>\n\n<pre><code>variable one\nI'm variable 2\n300\nFalse\nI am variable 5\n</code></pre>\n\n<p>Let's assume that I have multiple files like this and I don't know what is in each file. I want to take each line in the file and put it into a variable.</p>\n\n<p>For example, this file would become these variables (which I can sort into strings, numbers and booleans with <code>if</code> statements):</p>\n\n<pre><code>var1 = \"variable one\"\nvar2 = \"I'm variable 2\"\nvar3 = 300\nvar4 = False\nvar5 = \"I am variable 5\"\n</code></pre>\n\n<p>I want to make sure that this can be applied to any file with any number of lines.</p>\n\n<p>Here's an example of what I hope the code would look like:</p>\n\n<pre><code>File.open(\"file.txt\").each do |line|\n  var.new = \"var\" + line.line_number #creates new variable named \"var\" and the line number\nvar = line\nend\n</code></pre>\n\n<p>I hope someone understands and knows how to do this because I'm completely stumped. I feel like there's some sort of really simple solution here that everybody commonly knows and I'm missing it or I just don't know it.</p>\n\n<p>Thanks, Reece</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 14010, "user_id": 3109182, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4b305f0077055b4fdcf715067775d5a?s=128&d=identicon&r=PG", "display_name": "Anthony", "link": "https://stackoverflow.com/users/3109182/anthony"}, "edited": false, "score": 2, "creation_date": 1534884341, "post_id": 51955974, "comment_id": 90863502, "body": "version of ruby?"}, {"owner": {"reputation": 409, "user_id": 8116088, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/118e7985cfe1aa9a8dcc0c149d22f6dc?s=128&d=identicon&r=PG&f=1", "display_name": "user8116088", "link": "https://stackoverflow.com/users/8116088/user8116088"}, "reply_to_user": {"reputation": 14010, "user_id": 3109182, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4b305f0077055b4fdcf715067775d5a?s=128&d=identicon&r=PG", "display_name": "Anthony", "link": "https://stackoverflow.com/users/3109182/anthony"}, "edited": false, "score": 0, "creation_date": 1534885617, "post_id": 51955974, "comment_id": 90864011, "body": "ruby 2.5.1p57 (2018-03-29 revision 63029) [x86_64-linux-gnu]"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1539301278, "post_id": 51955974, "comment_id": 92463021, "body": "Instead of allocating one string, try making a million, calling <code>GC.start</code>, and checking. The garbage collector might not do anything because there&#39;s not enough work to do."}], "answers": [{"comments": [{"owner": {"reputation": 409, "user_id": 8116088, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/118e7985cfe1aa9a8dcc0c149d22f6dc?s=128&d=identicon&r=PG&f=1", "display_name": "user8116088", "link": "https://stackoverflow.com/users/8116088/user8116088"}, "edited": false, "score": 0, "creation_date": 1540928467, "post_id": 52770269, "comment_id": 93041913, "body": "Sorry for the belated reply. thank you for the clarification. it is much appreciated"}], "tags": [], "owner": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "is_accepted": false, "score": 0, "last_activity_date": 1539301130, "creation_date": 1539301130, "answer_id": 52770269, "question_id": 51955974, "link": "https://stackoverflow.com/questions/51955974/does-file-realpath-leak-memory/52770269#52770269", "title": "Does File.realpath() leak memory?", "body": "<p>I tested using <code>ruby 2.5.1p57 (2018-03-29 revision 63029) [x86_64-darwin18]</code> and the file <code>./foo.txt</code> which is a symlink too <code>./foo</code>.</p>\n\n<p>If we cut your example down to the bare-minimum necessary, then the answer is no, there is no memory leak in <code>File.realpath</code>:</p>\n\n<pre><code>require 'memory_profiler'\nMemoryProfiler.report { puts File.realpath('./foo.txt') }.pretty_print\n&lt;snip&gt;\nRetained String Report\n-----------------------------------\n</code></pre>\n\n<p>The issues you're seeing come down to a combination of your calls to <code>GC.start</code>, <code>.freeze</code> and the way <code>MemoryProfiler</code> measures these things within a code block.</p>\n\n<p>As for why <code>puts string</code> and <code>puts File.realpath(string)</code> behave differently, <code>puts string</code> reads the value of <code>string</code> and prints it to the console; <code>puts File.realpath(string)</code> <em>creates</em> a new <code>String</code> object then prints it to the console.</p>\n"}], "owner": {"reputation": 409, "user_id": 8116088, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/118e7985cfe1aa9a8dcc0c149d22f6dc?s=128&d=identicon&r=PG&f=1", "display_name": "user8116088", "link": "https://stackoverflow.com/users/8116088/user8116088"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 165, "favorite_count": 0, "answer_count": 1, "score": 7, "last_activity_date": 1539301130, "creation_date": 1534882009, "question_id": 51955974, "link": "https://stackoverflow.com/questions/51955974/does-file-realpath-leak-memory", "title": "Does File.realpath() leak memory?", "body": "<p>I'm having trouble with File.realpath() leaving strings around that don't seem to get garbage collected. It looks to me like a memory leak, though I can't imagine such a thing actually being true for a core library method.</p>\n\n<p>Consider the following code:</p>\n\n<pre><code>def string_test(string)\n  puts string\nend\n\n\nGC.start\nreport = MemoryProfiler.report do\n   s = './foo.txt'.freeze\n   string_test(s)\n   s = nil\n   GC.start\nend\nreport.pretty_print\n</code></pre>\n\n<p>This yields (among other verbose output):</p>\n\n<pre><code>Total allocated: 0 bytes (0 objects)\nTotal retained:  0 bytes (0 objects)\n</code></pre>\n\n<p>So far so good, there seems to be no residual memory usage from calling the string_test() method. However, if I change the method to resolve the relative path as follows:</p>\n\n<pre><code>def string_test(string)\n  puts File.realpath(string)\nend\n</code></pre>\n\n<p>I get the following output from MemoryProfiler:</p>\n\n<pre><code>Total allocated: 128 bytes (2 objects)\nTotal retained:  88 bytes (1 objects)\n.\n.\n.\nRetained String Report\n-----------------------------------\n          1  \"/home/asdfjk/tmp/foo.txt\"\n          1  t:28 \n</code></pre>\n\n<p>foo.txt is a symbolic link to the actual file. I don't know if that's relevant or not. It seems File.realpath() is leaving a copy of the string around. Aggregate this over hundreds of thousands of files and it chews up a lot of memory. Can anyone help me understand what's going on here and possibly how to fix it? </p>\n\n<p>Another interesting tidbit is that in the first example (the one that doesn't leak), string s must be frozen, or the result is the same as the version including the call to File.realpath().</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "carrierwave"], "answers": [{"tags": [], "owner": {"reputation": 7241, "user_id": 1096110, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XGVpR.jpg?s=128&g=1", "display_name": "Flavio Wuensche", "link": "https://stackoverflow.com/users/1096110/flavio-wuensche"}, "is_accepted": false, "score": 0, "last_activity_date": 1534884334, "creation_date": 1534884334, "answer_id": 51956460, "question_id": 51955956, "link": "https://stackoverflow.com/questions/51955956/carrierwave-how-to-reprocess-original-files/51956460#51956460", "title": "Carrierwave how to reprocess original files", "body": "<p>In order to reprocess you are going to need to create versions. For CarrierWave, the original file will never be reprocessed, even though you added a global <code>resize_to_fit</code> transformation inside your FileUploader.</p>\n\n<p>To achieve what you are looking for, you can create a new version. I am naming it <code>large</code>.</p>\n\n<pre><code>class FileUploader &lt; CarrierWave::Uploader::Base\n  include CarrierWave::MiniMagick\n\n  # ...\n\n  version :large do \n    process resize_to_fit: [2000, 2000]\n  end\nend\n</code></pre>\n\n<p>You can now run your rake task. When you look into your S3 folder you will realize you have two files for each uploaded file. One which is the original and another one which is the <code>large</code> version.</p>\n"}], "owner": {"reputation": 20590, "user_id": 504963, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/xlYLo.jpg?s=128&g=1", "display_name": "Antarr Byrd", "link": "https://stackoverflow.com/users/504963/antarr-byrd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 530, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1534884334, "creation_date": 1534881946, "question_id": 51955956, "link": "https://stackoverflow.com/questions/51955956/carrierwave-how-to-reprocess-original-files", "title": "Carrierwave how to reprocess original files", "body": "<p>I've updated my carrierwave uploader to limit image sizes to 2000px. I'm not using any custom version. I want to reprocess all the images that have been previously uploaded. I tried using <code>.recreate_version!</code> but that doesn't seem to work. Is there something else I can do?</p>\n\n<h3>uploader</h3>\n\n<pre><code>class FileUploader &lt; CarrierWave::Uploader::Base\n  include CarrierWave::MiniMagick\n\n  delegate :extension_whitelist, to: :model\n\n  process resize_to_fit: [2000, 2000]\n\n  def filename\n    # CarrierWave has already defined @filename\n    @_filename ||= generate_random_filename\n  end\n\n  def generate_random_filename\n    return unless file = model.file&amp;.file\n\n    3.times do\n      name = \"#{SecureRandom.hex(6)}.#{file.extension}\"\n      return name unless Attachment.search(file_url_end: name).result.any?\n    end\n\n    fail \"couldn't find a unique filename!\"\n  end\n\n  def url(options = {})\n    mounted_on = model.send(:_mounter, mounted_as).uploader_options[:mount_on] || mounted_as\n\n    if model.attributes[mounted_on.to_s] =~ /https?:\\/\\/.+/\n      model.attributes[mounted_on.to_s]\n    else\n      super\n    end\n  end\nend\n</code></pre>\n\n<h3>Attachement</h3>\n\n<pre><code>class Attachment &lt; ApplicationRecord\n  has_paper_trail\n\n  belongs_to :owner, polymorphic: true\n\n  mount_uploader :file, FileUploader,\n    # `mount_on` is used to get around a paper_trail bug where it tries serializing the\n    # uploader object, instead of simply the URL itself.\n    # https://github.com/modernmsg/modernmsg/pull/2847#issuecomment-199378461\n    # http://stackoverflow.com/questions/9423279\n    mount_on: :file_url\n\n  # Stores the full URL in the database\n  def write_uploader(column, identifier)\n    if file._storage == CarrierWave::Storage::AWS\n      identifier = CarrierWave::Storage::AWSFile.new(file, file.send(:storage).connection, file.store_path).url\n    end\n\n    write_attribute(column, identifier)\n  end\n\n  PURPOSES = {\n    ...\n  }\n\n  MIN_WIDTHS = {\n    ...\n  }\n\n  validates_inclusion_of :purpose, allow_nil: true, in: -&gt; a { PURPOSES[a.owner.class] || [] }\n\n  # CarrierWave normally starts processing the file immediately as the attribute is set.\n  # That's a problem because `extension_whitelist` is determined by the association,\n  # which isn't set until after the attributes themselves are set.\n  # https://github.com/carrierwaveuploader/carrierwave/issues/361\n  # https://github.com/rails/rails/blob/v4.2.5.2/activerecord/lib/active_record/associations/has_many_association.rb#L34-L43\n  # rubocop:disable Style/TrivialAccessors\n  alias original_file= file=\n  def file=(file)\n    @file = file\n  end\n  before_validation :set_file\n  def set_file\n    self.original_file = @file if @file\n  end\n  # Then, for the remote URL option\n  alias original_remote_file_url= remote_file_url=\n  def remote_file_url=(url)\n    @remote_file_url = url\n  end\n  before_validation :set_remote_file_url\n  def set_remote_file_url\n    self.original_remote_file_url = @remote_file_url if @remote_file_url\n  end\n  # rubocop:enable Style/TrivialAccessors\n\n  # Don't accidentally override the file if other attributes are updated.\n  skip_callback :save, :before,  :write_file_identifier,         unless: :file_url_changed?\n  skip_callback :save, :after,   :store_file!,                   unless: :file_url_changed?\n  skip_callback :commit, :after, :remove_previously_stored_file, unless: -&gt;{ previous_changes.key? :file_url }\n\n  validates_presence_of :file\n\n  def extension_whitelist\n    images = %w[jpg jpeg gif png svg]\n    videos = %w[mov mp4]\n    promotional_materials = %w[pdf]\n\n    case owner\n    when Authentication, Property, Company\n      images + promotional_materials\n    when Ad\n      images + videos\n    when User, Profile, Player\n      images\n    end\n  end\n\n  validate :check_min_width\n  def check_min_width\n    if min_width &amp;&amp; file?\n      width, height = FastImage.size file.path\n      if width &lt; min_width\n        errors.add :purpose, \"min width for a #{purpose} image is #{min_width} pixels\"\n      end\n    end\n  end\n\n  def min_width\n    MIN_WIDTHS.dig owner.class, purpose\n  end\nend\n</code></pre>\n\n<h3>Rake task</h3>\n\n<pre><code># CarrierWave rake tasks\n#\n# Task:   reprocess\n# Desc:   Reprocess all images for the Attachment class\n# Usage:  rake carrierwave:reprocess\n\nnamespace :carrierwave do\n  desc 'Reprocess all images for the Attachment class'\n  task reprocess: :environment do\n    Attachment.all.each do |a|\n      a.file.recreate_versions!\n      a.save!\n    rescue\n      false\n    end\n  end\nend\n</code></pre>\n"}, {"tags": ["ruby", "block", "proc"], "answers": [{"tags": [], "owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "is_accepted": false, "score": 2, "last_activity_date": 1534882150, "creation_date": 1534882150, "answer_id": 51956004, "question_id": 51955924, "link": "https://stackoverflow.com/questions/51955924/can-i-use-shorthand-for-selecting-matches/51956004#51956004", "title": "Can I use &#39;&amp;&#39; shorthand for selecting matches?", "body": "<blockquote>\n  <p>[can I do this] without using a separate proc</p>\n</blockquote>\n\n<p>No. Primarily because neither <code>&amp;</code> nor symbols are methods or anything that can accept parameters. You must use the full form.</p>\n"}, {"comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 2, "creation_date": 1534883364, "post_id": 51956243, "comment_id": 90863100, "body": "yeah, <code>grep</code> is a great tool. I don&#39;t use it enough."}], "tags": [], "owner": {"reputation": 12629, "user_id": 4739257, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/MdhEs.jpg?s=128&g=1", "display_name": "Ilya", "link": "https://stackoverflow.com/users/4739257/ilya"}, "is_accepted": true, "score": 4, "last_activity_date": 1535955451, "last_edit_date": 1535955451, "creation_date": 1534883237, "answer_id": 51956243, "question_id": 51955924, "link": "https://stackoverflow.com/questions/51955924/can-i-use-shorthand-for-selecting-matches/51956243#51956243", "title": "Can I use &#39;&amp;&#39; shorthand for selecting matches?", "body": "<p>It seems like you can use <code>grep</code>:</p>\n\n<pre><code>[\"MA-1\", \"NY-2\", \"CT-2\", \"NJ-1\", \"NJ-2\", \"NJ-3\"].grep(/2/)\n#=&gt; [\"NY-2\", \"CT-2\", \"NJ-2\"]\n</code></pre>\n\n<p>Or with the custom proc:</p>\n\n<pre><code>my_proc = -&gt;(e) { e.match('2') }\n[\"MA-1\", \"NY-2\", \"CT-2\", \"NJ-1\", \"NJ-2\", \"NJ-3\"].select(&amp;my_proc)\n#=&gt; [\"NY-2\", \"CT-2\", \"NJ-2\"]\n</code></pre>\n\n<p>Or (credits to @engineersmnky):</p>\n\n<pre><code>select(&amp;/2/.method(:match))\n</code></pre>\n"}], "owner": {"reputation": 84135, "user_id": 631619, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/b6f3159af5195eddff62a2dd4f9ad969?s=128&d=identicon&r=PG", "display_name": "Michael Durrant", "link": "https://stackoverflow.com/users/631619/michael-durrant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 51956243, "answer_count": 2, "score": 0, "last_activity_date": 1535955451, "creation_date": 1534881811, "last_edit_date": 1535017650, "question_id": 51955924, "link": "https://stackoverflow.com/questions/51955924/can-i-use-shorthand-for-selecting-matches", "title": "Can I use &#39;&amp;&#39; shorthand for selecting matches?", "body": "<p>I have this code:</p>\n\n<pre><code>result=\n[\"MA-1\", \"NY-2\", \"CT-2\", \"NJ-1\", \"NJ-2\", \"NJ-3\"].select do |element|\n  element.match '2'\nend\n</code></pre>\n\n<p>Is there a way to use the <code>&amp;</code> shortcut without using a separate proc?</p>\n\n<p>I tried:</p>\n\n<pre><code>[\"MA-1\", \"NY-2\", \"CT-2\", \"NJ-1\", \"NJ-2\", \"NJ-3\"].select(&amp;:match('2'))\n</code></pre>\n\n<p>which raises a syntax error.</p>\n"}, {"tags": ["ruby"], "answers": [{"tags": [], "owner": {"reputation": 686, "user_id": 1491410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c938ed150a685b33d1b91266b382c8d?s=128&d=identicon&r=PG", "display_name": "elliotcm", "link": "https://stackoverflow.com/users/1491410/elliotcm"}, "is_accepted": true, "score": 4, "last_activity_date": 1534882307, "creation_date": 1534882307, "answer_id": 51956038, "question_id": 51955802, "link": "https://stackoverflow.com/questions/51955802/time-new-and-date-new-strftimea-returns-different-day-for-the-same-paramet/51956038#51956038", "title": "Time.new and Date.new .strftime(&quot;%A&quot;) returns different day for the same parameters", "body": "<p><code>Date</code> by default uses the Julian calendar.  When you're dealing with dates that far in the past you're going to get weird behaviour prior to calendar reform.</p>\n\n<pre><code>irb(main):013:0&gt; Time.new(1001,1,1).strftime(\"%A\")\n=&gt; \"Thursday\"\nirb(main):014:0&gt; Date.new(1001,1,1, Date::GREGORIAN).strftime(\"%A\")\n=&gt; \"Thursday\"\n</code></pre>\n\n<p>More detail here:\n<a href=\"https://gist.github.com/pixeltrix/e2298822dd89d854444b\" rel=\"noreferrer\">https://gist.github.com/pixeltrix/e2298822dd89d854444b</a></p>\n"}], "owner": {"reputation": 7909, "user_id": 6439240, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1ff73af17f0d84241181f067b95538d4?s=128&d=identicon&r=PG", "display_name": "wscourge", "link": "https://stackoverflow.com/users/6439240/wscourge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 29, "favorite_count": 0, "accepted_answer_id": 51956038, "answer_count": 1, "score": 0, "last_activity_date": 1534882307, "creation_date": 1534881285, "question_id": 51955802, "link": "https://stackoverflow.com/questions/51955802/time-new-and-date-new-strftimea-returns-different-day-for-the-same-paramet", "title": "Time.new and Date.new .strftime(&quot;%A&quot;) returns different day for the same parameters", "body": "<p>Solving <a href=\"https://www.codewars.com/kata/unlucky-days/train/ruby\" rel=\"nofollow noreferrer\">Unlucky Days</a>, I encountered, that:</p>\n\n<pre><code>require 'date'\nTime.new(1001,1,1).strftime(\"%A\") # =&gt; Thursday\nDate.new(1001,1,1).strftime(\"%A\") # =&gt; Wednesday\n</code></pre>\n\n<p>Is not the same day. The correct one (iGoogled) is the <code>Time</code> one.</p>\n\n<p>Why is that?</p>\n\n<p><a href=\"https://i.stack.imgur.com/CYuwI.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/CYuwI.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-5", "memorycache", "fragment-caching"], "answers": [{"tags": [], "owner": {"reputation": 9971, "user_id": 8255744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de22299534b5a8ed244ee8ff4aa6c481?s=128&d=identicon&r=PG&f=1", "display_name": "Simple Lime", "link": "https://stackoverflow.com/users/8255744/simple-lime"}, "is_accepted": false, "score": 2, "last_activity_date": 1534879645, "last_edit_date": 1534879645, "creation_date": 1534879023, "answer_id": 51955308, "question_id": 51954529, "link": "https://stackoverflow.com/questions/51954529/rails-5-2-1-model-fragment-caching/51955308#51955308", "title": "Rails 5.2.1 - Model &amp; Fragment Caching", "body": "<p>What seems to be going on here is that you're caching the relation <em>before</em> it loads the records, and so it still has to actually load them before it can be used (using my Ad model because it's there and convenient for testing in irb):</p>\n\n<pre><code>ads = Ad.all;nil # no query here, this is what I think you're caching\n# this next line is where the query is run, (this would be\n# equivalent to your render line)\nads.each { ... } \n#  Ad Load (0.1ms)  SELECT \"ads\".* FROM \"ads\"\n</code></pre>\n\n<p>instead you might try forcing active record to load the relation before you cache it and see if that helps. You can do this by using <a href=\"https://apidock.com/rails/ActiveRecord/Relation/load\" rel=\"nofollow noreferrer\"><code>load</code></a>:</p>\n\n<pre><code>ads = Ad.all.load;nil # query is now run here\n#  Ad Load (0.1ms)  SELECT \"ads\".* FROM \"ads\"\nads.each { ... } # and not run here\n</code></pre>\n\n<p>and together with caching enabled (all in a single rails console session, multiple sessions seems to forget the cache from the previous, but I've not configured caching so probably just an in-memory store of some kind)</p>\n\n<pre><code>ads = Rails.cache.fetch(\"test load\") { Ad.all.load };nil # query\n#  Ad Load (0.9ms)  SELECT \"ads\".* FROM \"ads\"\nads = Rails.cache.fetch(\"test load\") { Ad.all.load };nil # no query\nads.each {  } # no query\nads = Rails.cache.fetch(\"test without load\") { Ad.all };nil # no query\nads.each { };nil # query\n#  Ad Load (0.1ms)  SELECT \"ads\".* FROM \"ads\"\nads = Rails.cache.fetch(\"test without load\") { Ad.all };nil # no query\nads.each { };nil # query\n#  Ad Load (0.1ms)  SELECT \"ads\".* FROM \"ads\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 127, "user_id": 6003113, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/c7775e9f78b27b76ccee0f0efaf9fd95?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Smith", "link": "https://stackoverflow.com/users/6003113/alexander-smith"}, "is_accepted": true, "score": 0, "last_activity_date": 1534976227, "creation_date": 1534976227, "answer_id": 51975909, "question_id": 51954529, "link": "https://stackoverflow.com/questions/51954529/rails-5-2-1-model-fragment-caching/51975909#51975909", "title": "Rails 5.2.1 - Model &amp; Fragment Caching", "body": "<p>I was close before but now have successfully implemented caching. The above answer was appreciated but not what I was looking for, this is my current setup.</p>\n\n<p>I was calling the Language model query in a Helper module when I should have moved it to the model.</p>\n\n<p><strong>Model</strong></p>\n\n<pre><code>after_save :clear_cache\nafter_destroy :clear_cache\n\ndef clear_language_cache\n  Rails.cache.delete('Language.active.approved')\nend\n\ndef self.active_approved\n  Rails.cache.fetch('Language.active.approved') { is_active.is_approved.order(created_at: :desc).to_a }\nend\n</code></pre>\n\n<p><strong>Controller</strong></p>\n\n<pre><code>class LanguagesController &lt; ApplicationController\n  def index\n    @languages = Language.active_approved\n  end\nend\n</code></pre>\n\n<p><strong>Console</strong></p>\n\n<pre><code>Started GET \"/languages\" for 127.0.0.1 at 2018-08-22 18:13:21 -0400\nProcessing by LanguagesController#index as HTML\n  Rendering languages/index.html.erb within layouts/application\n  Rendered collection of languages/_language.html.erb [1 / 1 cache hits] (11.0ms)\n  Rendered languages/index.html.erb within layouts/application (15.9ms)\nCompleted 200 OK in 68ms (Views: 45.5ms | ActiveRecord: 5.8ms)\n</code></pre>\n"}], "owner": {"reputation": 127, "user_id": 6003113, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/c7775e9f78b27b76ccee0f0efaf9fd95?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Smith", "link": "https://stackoverflow.com/users/6003113/alexander-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 574, "favorite_count": 0, "accepted_answer_id": 51975909, "answer_count": 2, "score": 0, "last_activity_date": 1534976227, "creation_date": 1534875350, "question_id": 51954529, "link": "https://stackoverflow.com/questions/51954529/rails-5-2-1-model-fragment-caching", "title": "Rails 5.2.1 - Model &amp; Fragment Caching", "body": "<p>I am trying to setup Model and Fragment Caching in Rails 5.2.1</p>\n\n<p>I have had success with Fragment caching, but I am still seeing database queries after implementing model caching for my Model.</p>\n\n<p>I have enabled development caching</p>\n\n<pre><code>$ rails dev:cache\n</code></pre>\n\n<p><strong>Model Helper</strong></p>\n\n<pre><code>module LanguagesHelper\n  def approved_languages\n    Rails.cache.fetch(\"approved_languages\") { Languages.is_active.is_approved }\n  end\nend\n</code></pre>\n\n<p><strong>Controller</strong></p>\n\n<pre><code>class LanguagesController &lt; ApplicationController\n  include LanguagesHelper\n\n  def index\n    @languages = approved_languages\n  end\nend\n</code></pre>\n\n<p><strong>Views</strong></p>\n\n<p><em>app/views/languages/index.html.erb</em></p>\n\n<pre><code>&lt;%= render partial: 'languages/language', collection: @languages, cached: true %&gt;\n</code></pre>\n\n<p><em>app/views/languages/_language.html.erb</em></p>\n\n<pre><code>&lt;% cache language do %&gt;\n  &lt;%= language.name %&gt;\n&lt;% end %&gt;\n</code></pre>\n\n<p><strong>Console</strong></p>\n\n<pre><code>Started GET \"/languages\" for 127.0.0.1 at 2018-08-21 14:13:29 -0400\nProcessing by LanguagesController#index as HTML\n  Rendering languages/index.html.erb within layouts/application\n  Language Load (1.2ms)  SELECT \"languages\".* FROM \"languages\" WHERE \"languages\".\"deleted\" = $1 AND \"languages\".\"approved\" = $2  [[\"deleted\", false], [\"approved\", true]]\n  \u21b3 app/views/languages/index.html.erb:4\n  Rendered collection of languages/_language.html.erb [1 / 1 cache hits] (3.0ms)\n  Rendered languages/index.html.erb within layouts/application (10.9ms)\nCompleted 200 OK in 50ms (Views: 46.2ms | ActiveRecord: 1.2ms)\n</code></pre>\n\n<p>Why am I still seeing database queries with each request?</p>\n"}, {"tags": ["ruby", "hash", "nokogiri"], "comments": [{"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 1, "creation_date": 1534880416, "post_id": 51954343, "comment_id": 90861691, "body": "Two asides. 1: one of Ruby&#39;s conventions is to use <a href=\"https://en.wikipedia.org/wiki/Snake_case\" rel=\"nofollow noreferrer\">snake-case</a> for the naming of methods and variables (e.g., <code>all_hash</code> rather than <code>allHash</code>). You don&#39;t have to follow that convention but 99%+ of Rubiests do. 2: when you give an example, make it succinct but complete, with all elements valid Ruby objects (as you have), show the desired result as a Ruby object and assign a variable to each input object (e.g., <code>h = {  &quot;media&quot;=&gt;...}</code>) so that readers can refer to those variables in answers and comments without having to define them."}], "answers": [{"tags": [], "owner": {"reputation": 686, "user_id": 1491410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c938ed150a685b33d1b91266b382c8d?s=128&d=identicon&r=PG", "display_name": "elliotcm", "link": "https://stackoverflow.com/users/1491410/elliotcm"}, "is_accepted": true, "score": 2, "last_activity_date": 1534878091, "last_edit_date": 1534878091, "creation_date": 1534877789, "answer_id": 51955050, "question_id": 51954343, "link": "https://stackoverflow.com/questions/51954343/update-a-specific-hash-key-when-values-are-hashes/51955050#51955050", "title": "Update a Specific Hash Key when Values are Hashes", "body": "<p>Here's a bit of a simpler approach:</p>\n\n<pre><code>unique_id = 0\nhash = Hash.new {|h, k| h[k] = {id: (unique_id += 1), occurrences: 0} }\n\ndescendent_classes.each do |descendent_class|\n  hash[descendent_class][:occurrences] += 1\nend\n</code></pre>\n\n<p>Result (with <code>descendent_classes = [\"a\", \"a\", \"b\"]</code>):</p>\n\n<pre><code>irb(main):031:0&gt; hash\n=&gt; {\"a\"=&gt;{:id=&gt;1, :occurrences=&gt;2}, \"b\"=&gt;{:id=&gt;2, :occurrences=&gt;1}}\n</code></pre>\n"}], "owner": {"reputation": 47, "user_id": 10107914, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cf0f4c9f2a0ad737d8ce84d59c4fe86?s=128&d=identicon&r=PG&f=1", "display_name": "Chick Evans", "link": "https://stackoverflow.com/users/10107914/chick-evans"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 51955050, "answer_count": 1, "score": 0, "last_activity_date": 1534880144, "creation_date": 1534874557, "question_id": 51954343, "link": "https://stackoverflow.com/questions/51954343/update-a-specific-hash-key-when-values-are-hashes", "title": "Update a Specific Hash Key when Values are Hashes", "body": "<p>I am using Nokogiri to count the occurrences of different class attributes that appear on a website. To do this I am implementing a breadth-first search and every time I encounter a new class attribute I want to store it's class name as a key and the number of occurrences as a value (so a hash where the values are hashes). As an example: </p>\n\n<pre><code>{\"media\"=&gt;{:occurrences=&gt;1, :id =&gt; uniqueID},\n\"wrapper\"=&gt;{:occurrences=&gt;3, :id =&gt; uniqueID},\n\"container\"=&gt;{:occurrences=&gt;3, :id =&gt; uniqueID}}\n</code></pre>\n\n<p>And every that same class attribute is encountered I want to find that same hash and increment its occurrence key.</p>\n\n<pre><code>allHash = {}\nuniqueID = 0\nif allHash.key?(descendent[\"class\"]) \n   allHash.map do |key, v| #increment occurrences key if class is encountered during search\n     if key.to_s == descendent[\"class\"]\n         v[:occurrences] += 1 \n     end\n   end\nelse #make a new hash key if class name is not in hash\n  uniqueID += 1\n  allHash[descendent[\"class\"]] = {id: uniqueID, occurrences: 1}; \nend\n</code></pre>\n\n<p>So the final hash might change to this at the end of the search:</p>\n\n<pre><code>{\"media\"=&gt;{:occurrences=&gt;1, :id =&gt; uniqueID},\n\"wrapper\"=&gt;{:occurrences=&gt;5, :id =&gt; uniqueID},\n\"container\"=&gt;{:occurrences=&gt;10, :id =&gt; uniqueID}\n\"content\"=&gt;{:occurrences=&gt;1, :id =&gt; uniqueID}}\n</code></pre>\n\n<p>The code I have above fails to increment the occurrences however. How can I implement this?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "soap", "savon"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 7041298, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83923604bc270d86344e47184ca6e2fc?s=128&d=identicon&r=PG&f=1", "display_name": "Nikolay Terekhov", "link": "https://stackoverflow.com/users/7041298/nikolay-terekhov"}, "edited": false, "score": 2, "creation_date": 1535012643, "post_id": 51969157, "comment_id": 90912328, "body": "Indeed! As it turned out, the documentation that I was given to make my calls described the approach using Soap-UI without explicitly saying it. In Soap-UI, in the request form, there is a CID field that you have to associate with the file in attachments. But after that all it does is it places files in associated fields as a string (base64). So in the end it&#39;s just a basic SOAP request with a file sent as a string in the CID field... Thank you for your help! =)"}], "tags": [], "owner": {"reputation": 364, "user_id": 4136529, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Wvzv6m37XJg/AAAAAAAAAAI/AAAAAAAABGI/SHiJgtNb-Fs/photo.jpg?sz=128", "display_name": "Philippe B.", "link": "https://stackoverflow.com/users/4136529/philippe-b"}, "is_accepted": true, "score": 3, "last_activity_date": 1534948110, "creation_date": 1534948110, "answer_id": 51969157, "question_id": 51953531, "link": "https://stackoverflow.com/questions/51953531/sending-a-file-with-a-soap-request-in-ruby/51969157#51969157", "title": "Sending a file with a SOAP request in Ruby", "body": "<p>You should try to add your file in your xml request, transforming you file into a Base64 file.</p>\n\n<pre><code>file_data = Base64.encode64(File.binread(\"/path/to/your/file\"))\n</code></pre>\n\n<p>Integrate that <code>file_data</code> into your xml, and your full request will be something like this :</p>\n\n<pre><code>body = \"&lt;ws:action type=\\\"string\\\"&gt;ORDER_CREATE&lt;/ws:action&gt;&gt;\n    &lt;ws:document type=\\\"file\\\" extension=\\\"pdf\\\" prefix=\\\"\\\" suffix=\\\"\\\"&gt;\n       &lt;nir:data&gt;#{file_data}&lt;/nir:data&gt;\n    &lt;/ws:document&gt;\n    &lt;ws:document_name type=\\\"string\\\"&gt;pdf_file_name.pdf&lt;/ws:document_name&gt;\n    &lt;ws:get_proof type=\\\"string\\\"&gt;NO&lt;/ws:get_proof&gt;\n    &lt;ws:identifier type=\\\"indstringlist\\\" case-sensitive=\\\"?\\\"&gt;\n       &lt;nir:data key=\\\"LOGIN\\\"&gt;login&lt;/nir:data&gt;\n       &lt;nir:data key=\\\"PASSWORD\\\"&gt;password&lt;/nir:data&gt;\n    &lt;/ws:identifier&gt;\n    &lt;ws:mailing_type type=\\\"string\\\"&gt;UNIQUE&lt;/ws:mailing_type&gt;\n    &lt;ws:service_profile type=\\\"indstringlist\\\" case-sensitive=\\\"?\\\"&gt;\n       &lt;nir:data key=\\\"service_id\\\"&gt;MAIL&lt;/nir:data&gt;\n    &lt;/ws:service_profile&gt;\"\n</code></pre>\n\n<p>In your <code>client.call(:order_create, soap_header: soap_header, message: body)</code></p>\n\n<p>This should work I think !</p>\n"}], "owner": {"reputation": 43, "user_id": 7041298, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83923604bc270d86344e47184ca6e2fc?s=128&d=identicon&r=PG&f=1", "display_name": "Nikolay Terekhov", "link": "https://stackoverflow.com/users/7041298/nikolay-terekhov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 885, "favorite_count": 0, "accepted_answer_id": 51969157, "answer_count": 1, "score": 4, "last_activity_date": 1534948110, "creation_date": 1534870897, "question_id": 51953531, "link": "https://stackoverflow.com/questions/51953531/sending-a-file-with-a-soap-request-in-ruby", "title": "Sending a file with a SOAP request in Ruby", "body": "<p>I am trying to send a pdf file along with a SOAP request using the Savon gem.<br/>\nAll the similar questions I found are either 5+ years old (Savon v1) or without any answer.</p>\n\n<p>While testing the request in SoapUI I was able to successfully send a file with the following request + the file in attachments:</p>\n\n<pre><code>&lt;soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:ws=\"link\" xmlns:nir=\"link\"&gt;\n   &lt;soapenv:Header&gt;\n      &lt;ws:nvheader&gt;\n         &lt;ws:nvcommand&gt;\n            &lt;ws:nv_user&gt;nv_user&lt;/ws:nv_user&gt;\n            &lt;ws:nv_password&gt;nv_password&lt;/ws:nv_password&gt;\n         &lt;/ws:nvcommand&gt;\n      &lt;/ws:nvheader&gt;\n   &lt;/soapenv:Header&gt;\n   &lt;soapenv:Body&gt;\n      &lt;ws:order_create_IN&gt;\n         &lt;ws:action type=\"string\"&gt;ORDER_CREATE&lt;/ws:action&gt;&gt;\n         &lt;ws:document type=\"file\" extension=\"pdf\" prefix=\"\" suffix=\"\"&gt;\n            &lt;nir:data&gt;cid:pdf_file_name.pdf&lt;/nir:data&gt;\n         &lt;/ws:document&gt;\n         &lt;ws:document_name type=\"string\"&gt;df_file_name.pdf&lt;/ws:document_name&gt;\n         &lt;ws:get_proof type=\"string\"&gt;NO&lt;/ws:get_proof&gt;\n         &lt;ws:identifier type=\"indstringlist\" case-sensitive=\"?\"&gt;\n            &lt;nir:data key=\"LOGIN\"&gt;login&lt;/nir:data&gt;\n            &lt;nir:data key=\"PASSWORD\"&gt;password&lt;/nir:data&gt;\n         &lt;/ws:identifier&gt;\n         &lt;ws:mailing_type type=\"string\"&gt;UNIQUE&lt;/ws:mailing_type&gt;\n         &lt;ws:service_profile type=\"indstringlist\" case-sensitive=\"?\"&gt;\n            &lt;nir:data key=\"service_id\"&gt;MAIL&lt;/nir:data&gt;\n         &lt;/ws:service_profile&gt;\n      &lt;/ws:order_create_IN&gt;\n   &lt;/soapenv:Body&gt;\n&lt;/soapenv:Envelope&gt;\n</code></pre>\n\n<p>What I tried to make this request using Savon:<br/></p>\n\n<ul>\n<li>I got the latest version of the Savon gem from github to have the multipart request sending option <a href=\"https://github.com/savonrb/savon/pull/761\" rel=\"nofollow noreferrer\">https://github.com/savonrb/savon/pull/761</a>.<br/></li>\n<li>Tried to follow this example <a href=\"https://github.com/savonrb/savon/commit/4e7ae5e93926629422b0df4a7003f0ce18084a78#diff-1990cf76bd0d5d5049cfcdf1b090d316\" rel=\"nofollow noreferrer\" title=\"lib/savon/options.rb\">lib/savon/options.rb</a>.<br/></li>\n<li><p>My latest attempt looks like this:<br/></p>\n\n<pre><code>client = Savon.client(wsdl: \"wsdl_link\",\n              convert_request_keys_to: :none, logger: Rails.logger,\n              log_level: :debug,\n              log: true,\n              pretty_print_xml: true)\n\nsoap_header = { nvheader:\n                { nvcommand:\n                      { nv_user: ENV[\"postgreen_nv_user\"],\n                        nv_password: ENV[\"postgreen_nv_pwd\"] } } }\n\nbody = \"&lt;ws:action type=\\\"string\\\"&gt;ORDER_CREATE&lt;/ws:action&gt;&gt;\n        &lt;ws:document type=\\\"file\\\" extension=\\\"pdf\\\" prefix=\\\"\\\" suffix=\\\"\\\"&gt;\n           &lt;nir:data&gt;cid:pdf_file_name.pdf&lt;/nir:data&gt;\n        &lt;/ws:document&gt;\n        &lt;ws:document_name type=\\\"string\\\"&gt;pdf_file_name.pdf&lt;/ws:document_name&gt;\n        &lt;ws:get_proof type=\\\"string\\\"&gt;NO&lt;/ws:get_proof&gt;\n        &lt;ws:identifier type=\\\"indstringlist\\\" case-sensitive=\\\"?\\\"&gt;\n           &lt;nir:data key=\\\"LOGIN\\\"&gt;login&lt;/nir:data&gt;\n           &lt;nir:data key=\\\"PASSWORD\\\"&gt;password&lt;/nir:data&gt;\n        &lt;/ws:identifier&gt;\n        &lt;ws:mailing_type type=\\\"string\\\"&gt;UNIQUE&lt;/ws:mailing_type&gt;\n        &lt;ws:service_profile type=\\\"indstringlist\\\" case-sensitive=\\\"?\\\"&gt;\n           &lt;nir:data key=\\\"service_id\\\"&gt;MAIL&lt;/nir:data&gt;\n        &lt;/ws:service_profile&gt;\"\n\nresponse = client.call(:order_create,\n                   soap_header: soap_header,\n                   message: body,\n                   attachments: { 'pdf_file_name.pdf' =&gt; 'storage/pdf_file_name.pdf' })\n</code></pre></li>\n</ul>\n\n<p>If I send the request without the \"attachments\", I get a response (saying that there's no file).<br/>\nBut when I send the same request with a file, I get a generic error response as if it didn't understood the request at all.</p>\n\n<p>In the logs I have the following for the request without attachment:</p>\n\n<pre><code>SOAP request: Endpoint Link\nSOAPAction: \"order_create\"\nContent-Type: text/xml;charset=UTF-8\nContent-Length: 2092\n&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n...\n--- \"my xml message\" ---\n...\nHTTPI /peer POST request to rct.post-green.net (net_http)\nSOAP response (status 200)\ndate: Tue, 21 Aug 2018 12:18:54 GMT\nserver: NIRVA HTTP server\ncache-control: no-cache\ncontent-type: text/xml\nexpires: Wed, 26 Feb 1997 08:21:57 GMT\npragma: no-cache\nset-cookie: NvSessionId=; expires=Thu, 01-Jan-1970 00:00:00 GMT\nvary: Accept-Encoding\ncontent-length: 906\n...\n--- \"xml response message\" ---\n...\n</code></pre>\n\n<p>And this for the request with an attachment:</p>\n\n<pre><code>SOAP request: Endpoint Link\nSOAPAction: \"order_create\"\nContent-Type: multipart/related; boundary=\"--==_mimepart_5b7c03832ef1_24772b1c76b4a65010330\"; type=\"text/xml\"; start=\"&lt;soap-request-body@soap&gt;\"\nContent-Length: 207653\n&lt;?xml version=\"1.0\"?&gt;\n...\n--- \"Nothing there as if there's no message or it's too large to show\" ---\n...\nHTTPI /peer POST request to rct.post-green.net (net_http)\nSOAP response (status 500)\ndate: Tue, 21 Aug 2018 12:20:19 GMT\nserver: Apache\nlast-modified: Fri, 19 May 2017 12:14:25 GMT\netag: \"8df-54fdf7660c649\"\naccept-ranges: bytes\ncontent-length: 2271\nconnection: close\ncontent-type: text/html\n...\n--- \"html response message\" ---\n...\n</code></pre>\n\n<p>So in the end I'm kinda lost, I was trying different approaches for 2-3 days without any success now.<br/></p>\n\n<p>Does anybody has a solution for this? Maybe there is another method/gem to achieve this?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "jekyll"], "comments": [{"owner": {"reputation": 26589, "user_id": 1032785, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/30816b3d787c2bd9d6f036318304f225?s=128&d=identicon&r=PG", "display_name": "jordanm", "link": "https://stackoverflow.com/users/1032785/jordanm"}, "edited": false, "score": 1, "creation_date": 1534868970, "post_id": 51952185, "comment_id": 90856427, "body": "Looks like you are missing the <code>public_suffix</code> gem. How did you install jekyll?"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 10255604, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef3ec6f15fb16e7fb1d01e83353e80eb?s=128&d=identicon&r=PG", "display_name": "Omid Shahsavarzadeh", "link": "https://stackoverflow.com/users/10255604/omid-shahsavarzadeh"}, "edited": false, "score": 0, "creation_date": 1534942702, "post_id": 51953363, "comment_id": 90884879, "body": "i install <code>public_suffix</code> but problem is still unresolved. i thinking problem for init jekyll in current directory. i tested with <code>--force</code> switch but not worked."}], "tags": [], "owner": {"reputation": 41, "user_id": 10081856, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-dwWyrSYIvBk/AAAAAAAAAAI/AAAAAAAAA1M/uCQ080RLulU/photo.jpg?sz=128", "display_name": "Gabe Koss", "link": "https://stackoverflow.com/users/10081856/gabe-koss"}, "is_accepted": false, "score": 0, "last_activity_date": 1534870219, "creation_date": 1534870219, "answer_id": 51953363, "question_id": 51952185, "link": "https://stackoverflow.com/questions/51952185/error-when-creating-a-jekyll-project/51953363#51953363", "title": "Error when creating a Jekyll project", "body": "<p>Looks like you are missing the <code>public_suffix</code> gem. Try installing via <code>gem install public_suffix</code> or put it into your <code>Gemfile</code> and re-run <code>bundle install</code>.</p>\n"}], "owner": {"reputation": 1, "user_id": 10255604, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef3ec6f15fb16e7fb1d01e83353e80eb?s=128&d=identicon&r=PG", "display_name": "Omid Shahsavarzadeh", "link": "https://stackoverflow.com/users/10255604/omid-shahsavarzadeh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 230, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1534942999, "creation_date": 1534865792, "last_edit_date": 1534942999, "question_id": 51952185, "link": "https://stackoverflow.com/questions/51952185/error-when-creating-a-jekyll-project", "title": "Error when creating a Jekyll project", "body": "<p>When I run <code>jekyll new .</code> I have get this error: </p>\n\n<pre><code>Traceback (most recent call last):\n    11: from /usr/local/bin/jekyll:23:in `&lt;main&gt;'\n    10: from /usr/local/bin/jekyll:23:in `load'\n     9: from /var/lib/gems/2.5.0/gems/jekyll-3.8.3/exe/jekyll:8:in `&lt;top (required)&gt;'\n     8: from /usr/local/lib/site_ruby/2.5.0/rubygems/core_ext/kernel_require.rb:59:in `require'\n     7: from /usr/local/lib/site_ruby/2.5.0/rubygems/core_ext/kernel_require.rb:59:in `require'\n     6: from /var/lib/gems/2.5.0/gems/jekyll-3.8.3/lib/jekyll.rb:33:in `&lt;top (required)&gt;'\n     5: from /usr/local/lib/site_ruby/2.5.0/rubygems/core_ext/kernel_require.rb:59:in `require'\n     4: from /usr/local/lib/site_ruby/2.5.0/rubygems/core_ext/kernel_require.rb:59:in `require'\n     3: from /var/lib/gems/2.5.0/gems/addressable-2.5.2/lib/addressable/uri.rb:21:in `&lt;top (required)&gt;'\n     2: from /usr/local/lib/site_ruby/2.5.0/rubygems/core_ext/kernel_require.rb:39:in `require'\n     1: from /usr/local/lib/site_ruby/2.5.0/rubygems/core_ext/kernel_require.rb:135:in `rescue in require'\n/usr/local/lib/site_ruby/2.5.0/rubygems/core_ext/kernel_require.rb:135:in `require': cannot load such file -- public_suffix (LoadError)\n</code></pre>\n\n<p><strong>error just for <code>jekyll new .</code> and <code>jekyll new blog</code> worked successfuly\n( i tested <code>jekyll new . --force</code> but problem is unsolved</strong></p>\n\n<p>and my PATH is:</p>\n\n<pre><code>/home/shahrvand/.nvm/versions/node/v8.11.4/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/home/shahrvand/.gem/ruby/2.5.0\n</code></pre>\n\n<p>and my ruby version is:</p>\n\n<pre><code>ruby 2.5.1p57 (2018-03-29 revision 63029) [x86_64-linux-gnu]\ngem version : 2.7.7\njekyll 3.8.3\n</code></pre>\n\n<p>I'm using Ubuntu 18.04. What does this error mean?</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1534865886, "post_id": 51952182, "comment_id": 90854679, "body": "Please post the desired output as right now I am a bit confused"}, {"owner": {"reputation": 47, "user_id": 10107914, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cf0f4c9f2a0ad737d8ce84d59c4fe86?s=128&d=identicon&r=PG&f=1", "display_name": "Chick Evans", "link": "https://stackoverflow.com/users/10107914/chick-evans"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1534866041, "post_id": 51952182, "comment_id": 90854780, "body": "For example I would want the entire hash returned but with updated values: {0=&gt;{:occurrence=&gt;1, :className=&gt;&quot;class&quot;}, 3=&gt;{:occurrences=&gt;4, :className=&gt;&quot;hello&quot;}, 5=&gt;{:occurrences=&gt;4, :className=&gt;&quot;nah&quot;}}. If the value of the occurrences key is greater than two than I want to increment that value and still have the entire hash."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1534866258, "post_id": 51952182, "comment_id": 90854911, "body": "that output is the same as the input. I have added it to your question please update as needed"}, {"owner": {"reputation": 47232, "user_id": 1772830, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Qtoqg.jpg?s=128&g=1", "display_name": "Andrey Deineko", "link": "https://stackoverflow.com/users/1772830/andrey-deineko"}, "edited": false, "score": 1, "creation_date": 1534866337, "post_id": 51952182, "comment_id": 90854959, "body": "your input and output are identical"}, {"owner": {"reputation": 47, "user_id": 10107914, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cf0f4c9f2a0ad737d8ce84d59c4fe86?s=128&d=identicon&r=PG&f=1", "display_name": "Chick Evans", "link": "https://stackoverflow.com/users/10107914/chick-evans"}, "edited": false, "score": 0, "creation_date": 1534866623, "post_id": 51952182, "comment_id": 90855143, "body": "No the occurrences for the keys 3 and 5 have been incremented in the output. I apologize for the confusion. I want the entire hash still in tact but with slight modifications."}, {"owner": {"reputation": 47, "user_id": 10107914, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cf0f4c9f2a0ad737d8ce84d59c4fe86?s=128&d=identicon&r=PG&f=1", "display_name": "Chick Evans", "link": "https://stackoverflow.com/users/10107914/chick-evans"}, "edited": false, "score": 0, "creation_date": 1534866930, "post_id": 51952182, "comment_id": 90855331, "body": "That&#39;s not how it appears on my screen. Perhaps if I post it again: {0=&gt;{:occurrence=&gt;1, :className=&gt;&quot;class&quot;}, 3=&gt;{:occurrences=&gt;4, :className=&gt;&quot;hello&quot;}, 5=&gt;{:occurrences=&gt;4, :className=&gt;&quot;nah&quot;}}"}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1534868466, "post_id": 51952182, "comment_id": 90856203, "body": "@ChickEvans do your hashes really have keys <code>:occurrence</code> (singular) and <code>:occurrences</code> (plural) based on its value?"}, {"owner": {"reputation": 47, "user_id": 10107914, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cf0f4c9f2a0ad737d8ce84d59c4fe86?s=128&d=identicon&r=PG&f=1", "display_name": "Chick Evans", "link": "https://stackoverflow.com/users/10107914/chick-evans"}, "reply_to_user": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1534869521, "post_id": 51952182, "comment_id": 90856699, "body": "@Stefan No there should not be a difference. I&#39;ll correct that typo."}], "answers": [{"comments": [{"owner": {"reputation": 47, "user_id": 10107914, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cf0f4c9f2a0ad737d8ce84d59c4fe86?s=128&d=identicon&r=PG&f=1", "display_name": "Chick Evans", "link": "https://stackoverflow.com/users/10107914/chick-evans"}, "edited": false, "score": 0, "creation_date": 1534866785, "post_id": 51952266, "comment_id": 90855241, "body": "What is happening at the end with the [k, v]?"}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "reply_to_user": {"reputation": 47, "user_id": 10107914, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cf0f4c9f2a0ad737d8ce84d59c4fe86?s=128&d=identicon&r=PG&f=1", "display_name": "Chick Evans", "link": "https://stackoverflow.com/users/10107914/chick-evans"}, "edited": false, "score": 0, "creation_date": 1534866870, "post_id": 51952266, "comment_id": 90855299, "body": "@ChickEvans that&#39;s the block&#39;s return value, i.e. the new key-value pair."}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1534867086, "post_id": 51952266, "comment_id": 90855418, "body": "Either return a new hash or modify the existing one, but don&#39;t do both things."}, {"owner": {"reputation": 47, "user_id": 10107914, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cf0f4c9f2a0ad737d8ce84d59c4fe86?s=128&d=identicon&r=PG&f=1", "display_name": "Chick Evans", "link": "https://stackoverflow.com/users/10107914/chick-evans"}, "edited": false, "score": 0, "creation_date": 1534867269, "post_id": 51952266, "comment_id": 90855507, "body": "I intended to modify the existing one. Is there a benefit to returning a new one?"}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "reply_to_user": {"reputation": 47, "user_id": 10107914, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cf0f4c9f2a0ad737d8ce84d59c4fe86?s=128&d=identicon&r=PG&f=1", "display_name": "Chick Evans", "link": "https://stackoverflow.com/users/10107914/chick-evans"}, "edited": false, "score": 0, "creation_date": 1534867457, "post_id": 51952266, "comment_id": 90855617, "body": "@ChickEvans not necessarily, either one is fine, but returning a new hash <b>and</b> modifying the existing one can be a source of confusion and may result in hard to find bugs."}, {"owner": {"reputation": 47, "user_id": 10107914, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cf0f4c9f2a0ad737d8ce84d59c4fe86?s=128&d=identicon&r=PG&f=1", "display_name": "Chick Evans", "link": "https://stackoverflow.com/users/10107914/chick-evans"}, "edited": false, "score": 0, "creation_date": 1534873666, "post_id": 51952266, "comment_id": 90858618, "body": "Can I do this to update the v[:occurrences] of a specific key? Like this: new_h = h.map do |k, v| if k == 3 v[:occurrences] += 1 end [k, v] end.to_h."}], "tags": [], "owner": {"reputation": 3320, "user_id": 4950680, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C8cEh.jpg?s=128&g=1", "display_name": "Martin Zinovsky", "link": "https://stackoverflow.com/users/4950680/martin-zinovsky"}, "is_accepted": false, "score": 0, "last_activity_date": 1534866420, "last_edit_date": 1534866420, "creation_date": 1534866078, "answer_id": 51952266, "question_id": 51952182, "link": "https://stackoverflow.com/questions/51952182/update-a-hash-where-the-values-are-hashes/51952266#51952266", "title": "Update a Hash Where the Values are Hashes", "body": "<blockquote>\n  <p>For example I would want the entire hash returned but with updated\n  values: {0=>{:occurrence=>1, :className=>\"class\"},\n  3=>{:occurrences=>4, :className=>\"hello\"}, 5=>{:occurrences=>4,\n  :className=>\"nah\"}}. If the value of the occurrences key is greater\n  than two than I want to increment that value and still have the entire\n  hash.</p>\n</blockquote>\n\n<p>Here you go:</p>\n\n<pre><code>h = {0=&gt;{:occurrences=&gt;1, :className=&gt;\"class\"}, 3=&gt;{:occurrences=&gt;3, :className=&gt;\"hello\"}, 5=&gt;{:occurrences=&gt;3, :className=&gt;\"nah\"}}\n\nnew_h = h.map do |k, v| \n  if v[:occurrences] &gt; 2\n    v[:occurrences] += 1 \n  end\n\n  [k, v]\nend.to_h\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "is_accepted": false, "score": 1, "last_activity_date": 1534867322, "creation_date": 1534867322, "answer_id": 51952646, "question_id": 51952182, "link": "https://stackoverflow.com/questions/51952182/update-a-hash-where-the-values-are-hashes/51952646#51952646", "title": "Update a Hash Where the Values are Hashes", "body": "<p>Just out of curiosity:</p>\n\n<pre><code>input.map do |k, v|\n  [k, v[:occurrences].to_i &gt; 2 ? v.merge(occurrences: v[:occurrences] + 1) : v]\nend.to_h\n#\u21d2 {0=&gt;{:occurrence=&gt;1, :className=&gt;\"class\"},\n#   3=&gt;{:occurrences=&gt;4, :className=&gt;\"hello\"},\n#   5=&gt;{:occurrences=&gt;4, :className=&gt;\"nah\"}}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1534868235, "post_id": 51952774, "comment_id": 90856079, "body": "<code>to_i</code> in my answer is not that blind. The original input has both plural and singular names for that attribute (depending on whether it\u2019s greater than one or not.)"}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "reply_to_user": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 1, "creation_date": 1534868640, "post_id": 51952774, "comment_id": 90856276, "body": "@mudasobwa I assumed that was a typo. Otherwise we&#39;d have to transition from <code>occurrences: 0</code> to <code>occurrence: 1</code> to <code>occurrences: 2</code> ;-)"}], "tags": [], "owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "is_accepted": true, "score": 1, "last_activity_date": 1534867869, "creation_date": 1534867869, "answer_id": 51952774, "question_id": 51952182, "link": "https://stackoverflow.com/questions/51952182/update-a-hash-where-the-values-are-hashes/51952774#51952774", "title": "Update a Hash Where the Values are Hashes", "body": "<p>To update the existing hash you can simply call <a href=\"http://ruby-doc.org/core-2.5.1/Hash.html#method-i-each_value\" rel=\"nofollow noreferrer\"><code>each_value</code></a>. It passes each value in your hash to the block and within the block you can update the value (based on a condition):</p>\n\n<pre><code>h = {\n  0=&gt;{:occurrences=&gt;1, :className=&gt;\"class\"},\n  3=&gt;{:occurrences=&gt;3, :className=&gt;\"hello\"},\n  5=&gt;{:occurrences=&gt;3, :className=&gt;\"nah\"}\n}\n\nh.each_value { |v| v[:occurrences] += 1 if v[:occurrences] &gt; 2 }\n#=&gt; {\n#     0=&gt;{:occurrences=&gt;1, :className=&gt;\"class\"},\n#     3=&gt;{:occurrences=&gt;4, :className=&gt;\"hello\"},\n#     5=&gt;{:occurrences=&gt;4, :className=&gt;\"nah\"}\n#   }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": false, "score": 1, "last_activity_date": 1540590660, "creation_date": 1540590660, "answer_id": 53016711, "question_id": 51952182, "link": "https://stackoverflow.com/questions/51952182/update-a-hash-where-the-values-are-hashes/53016711#53016711", "title": "Update a Hash Where the Values are Hashes", "body": "<pre><code>h = { 0=&gt;{ :occurrences=&gt;1, :className=&gt;\"class\" },\n      3=&gt;{ :occurrences=&gt;3, :className=&gt;\"hello\" },\n      5=&gt;{ :occurrences=&gt;3, :className=&gt;\"nah\"   } }\n\nf = h.dup\n</code></pre>\n\n<p><strong>Non-destructive case</strong></p>\n\n<pre><code>h.transform_values do |g|\n  g[:occurrences] &gt; 2 ? g.merge(occurrences: g[:occurrences] + 1) : g\nend\n  #=&gt; { 0=&gt;{ :occurrences=&gt;1, :className=&gt;\"class\" }, \n  #     3=&gt;{ :occurrences=&gt;4, :className=&gt;\"hello\" },\n  #     5=&gt;{ :occurrences=&gt;4, :className=&gt;\"nah\"   } }\n\nh == f\n  #=&gt; true\n</code></pre>\n\n<p><strong>Destructive case</strong></p>\n\n<pre><code>g = h.transform_values! do |g|\n  g[:occurrences] &gt; 2 ? g.merge(occurrences: g[:occurrences] + 1) : g\nend\n  #=&gt; { 0=&gt;{ :occurrences=&gt;1, :className=&gt;\"class\" },\n  #     3=&gt;{ :occurrences=&gt;4, :className=&gt;\"hello\" },\n  #     5=&gt;{ :occurrences=&gt;4, :className=&gt;\"nah\"   } }\nh == g\n</code></pre>\n\n<p>See <a href=\"http://ruby-doc.org/core-2.5.1/Hash.html\" rel=\"nofollow noreferrer\">Hash#transform_values</a> and <a href=\"http://ruby-doc.org/core-2.5.1/Hash.html#method-i-transform_values-21\" rel=\"nofollow noreferrer\">Hash#transform_values!</a>, which made their debut in MRI v.2.4. Note that, in the destructive case, <code>merge!</code> is not needed.</p>\n"}], "owner": {"reputation": 47, "user_id": 10107914, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cf0f4c9f2a0ad737d8ce84d59c4fe86?s=128&d=identicon&r=PG&f=1", "display_name": "Chick Evans", "link": "https://stackoverflow.com/users/10107914/chick-evans"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 51952774, "answer_count": 4, "score": 0, "last_activity_date": 1540590660, "creation_date": 1534865782, "last_edit_date": 1534917921, "question_id": 51952182, "link": "https://stackoverflow.com/questions/51952182/update-a-hash-where-the-values-are-hashes", "title": "Update a Hash Where the Values are Hashes", "body": "<p>I have this hash where the keys are 0, 3, and 5 and the values are hashes.</p>\n\n<pre><code>{0=&gt;{:occurrences=&gt;1, :className=&gt;\"class\"},\n 3=&gt;{:occurrences=&gt;3, :className=&gt;\"hello\"},\n 5=&gt;{:occurrences=&gt;3, :className=&gt;\"nah\"}}\n</code></pre>\n\n<p>How can I implement something like this:</p>\n\n<pre><code>h.map { |key| \n  if key[:occurrences] &gt; 2\n    key[:occurrences] += 1 \n  end\n}\n</code></pre>\n\n<p>I know this syntax doesn't work. I want to increment the occurrence value when a condition is met and I am not sure how to access the key of a key but I would like the result to be: </p>\n\n<pre><code>{0=&gt;{:occurrences=&gt;1, :className=&gt;\"class\"}, \n 3=&gt;{:occurrences=&gt;4, :className=&gt;\"hello\"}, \n 5=&gt;{:occurrences=&gt;4, :className=&gt;\"nah\"}}\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "google-maps", "loops"], "answers": [{"comments": [{"owner": {"reputation": 283, "user_id": 4746788, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/90b80eeffa55eb3c779f5d0fca813aa1?s=128&d=identicon&r=PG&f=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/4746788/andy"}, "edited": false, "score": 0, "creation_date": 1534930066, "post_id": 51953432, "comment_id": 90877491, "body": "Cheers mate. That was the last thing I tried before going to bed last night. I can use document.getElementsByClassName(&#39;stravaMap&#39;) but it requires me to do [0] or [1] after the call to specify which row it should appear. I&#39;m not experienced with JS - could you possibly show me how such a loop would look like? Be happy to pay for your trouble."}], "tags": [], "owner": {"reputation": 41, "user_id": 10081856, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-dwWyrSYIvBk/AAAAAAAAAAI/AAAAAAAAA1M/uCQ080RLulU/photo.jpg?sz=128", "display_name": "Gabe Koss", "link": "https://stackoverflow.com/users/10081856/gabe-koss"}, "is_accepted": false, "score": 0, "last_activity_date": 1534870506, "creation_date": 1534870506, "answer_id": 51953432, "question_id": 51951983, "link": "https://stackoverflow.com/questions/51951983/include-google-maps-in-loop-to-show-several-maps/51953432#51953432", "title": "Include Google Maps in loop to show several maps", "body": "<p>Looks like you are creating elements with duplicate <code>id</code> attributes this could cause issues with your <code>document.getElementById('stravaMap')</code> call. </p>\n\n<p>I'm not sure if you could use a class to get the map in all elements otherwise you could add a custom id for each entry and then loop through them in the javascript to add to each individual run entry. </p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 7120684, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hlWgb.jpg?s=128&g=1", "display_name": "Phelim Dunleavy", "link": "https://stackoverflow.com/users/7120684/phelim-dunleavy"}, "is_accepted": false, "score": 1, "last_activity_date": 1536190159, "last_edit_date": 1536190159, "creation_date": 1536188991, "answer_id": 52194476, "question_id": 51951983, "link": "https://stackoverflow.com/questions/51951983/include-google-maps-in-loop-to-show-several-maps/52194476#52194476", "title": "Include Google Maps in loop to show several maps", "body": "<p>As Gabe alluded to above, this part of your code: <code>document.getElementById('stravaMap')</code>, will only grab the first element in the DOM that has the id <code>stravaMap</code>. If you want to grab all the elements in the DOM where you want to display a Map, then I suggest using <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Element/querySelectorAll\" rel=\"nofollow noreferrer\">querySelectorAll</a>. This will give you what is essentially an Array of all the elements with a certain class. You can then iterate over that array of elements, initialising a new Map for each element (each <code>td.map</code> in your case). I had a quick go at it here:</p>\n\n<pre><code>function initMap() {\n  mapElements = document.querySelectorAll('.map')\n\n  mapElements.forEach((element) =&gt; {\n    var map = new google.maps.Map(element, {\n      center: {\n          lat: 47.20604,\n          lng: 7.53621\n      },\n      zoom: 16,\n      disableDefaultUI: true\n    });\n\n    var encoded_data = 'k|b_Hc|~l@UI';\n\n    var decode = google.maps.geometry.encoding.decodePath(encoded_data);\n\n    var line = new google.maps.Polyline({\n      path: decode,\n      strokeColor: '#00008B',\n      strokeOpacity: 1.0,\n      strokeWeight: 4,\n      zIndex: 3\n    });\n\n    line.setMap(map);\n  }  \n})\n\ninitMap();\n</code></pre>\n"}], "owner": {"reputation": 283, "user_id": 4746788, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/90b80eeffa55eb3c779f5d0fca813aa1?s=128&d=identicon&r=PG&f=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/4746788/andy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1536190159, "creation_date": 1534865012, "question_id": 51951983, "link": "https://stackoverflow.com/questions/51951983/include-google-maps-in-loop-to-show-several-maps", "title": "Include Google Maps in loop to show several maps", "body": "<p>I have a Rails 5 application where I want to display several Google Maps maps inside a loop. For every row in the table, the same map has to appear. However, the map is only drawn once:</p>\n\n<p><a href=\"https://i.stack.imgur.com/GhDxx.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/GhDxx.png\" alt=\"All 3 rows should have the image\"></a></p>\n\n<p>Here is the view:</p>\n\n<pre><code>thead\n  tr\n    th Map\n    th Title\n    th Distance\n    th Duration\n    th Sport\ntbody\n  - @feed.each do |item|\n    tr\n      td.col-md-3\n        #stravaMap\n      td.col-md-2\n        = Date.parse(item['start_date'])\n      td.col-md-2\n        = item['name']\n      td.col-md-1\n        = item['distance'] / 1000\n      td.col-md-1\n        = item['type']\n</code></pre>\n\n<p>And here is the JS:</p>\n\n<pre><code>javascript:\n  function initMap() {\n\n  var map = new google.maps.Map(document.getElementById('stravaMap'), {\n      center: {\n          lat: 47.20604,\n          lng: 7.53621\n      },\n      zoom: 16,\n      disableDefaultUI: true\n  });\n\n  var encoded_data = 'k|b_Hc|~l@UI';\n\n  var decode = google.maps.geometry.encoding.decodePath(encoded_data);\n\n  var line = new google.maps.Polyline({\n      path: decode,\n      strokeColor: '#00008B',\n      strokeOpacity: 1.0,\n      strokeWeight: 4,\n      zIndex: 3\n  });\n\n  line.setMap(map);\n}\n\ninitMap();\n</code></pre>\n\n<p></p>\n\n<p>My understanding is that a new map would be drawn everytime I loop through but it's drawn once and then doesn't appear after first loop. </p>\n\n<p>Question: How do I make sure the Google Maps map is included in every row and not just the first? Thanks.</p>\n"}, {"tags": ["ruby", "gmail"], "comments": [{"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 1, "creation_date": 1534865062, "post_id": 51951698, "comment_id": 90854206, "body": "<a href=\"https://github.com/gmailgem/gmail/blob/c5e938942675fb3a3f71fa957e299a1cd1ee1577/lib/gmail/message.rb#L155\" rel=\"nofollow noreferrer\"><code>Message#remove_label</code></a> seems to be just right. Did you get an error?"}, {"owner": {"reputation": 11845, "user_id": 1536527, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/Sgr8O.png?s=128&g=1", "display_name": "ironsand", "link": "https://stackoverflow.com/users/1536527/ironsand"}, "reply_to_user": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1534869740, "post_id": 51951698, "comment_id": 90856830, "body": "I didn&#39;t tried the method. I should have tried it. Thanks!"}], "owner": {"reputation": 11845, "user_id": 1536527, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/Sgr8O.png?s=128&g=1", "display_name": "ironsand", "link": "https://stackoverflow.com/users/1536527/ironsand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1534864096, "creation_date": 1534864096, "question_id": 51951698, "link": "https://stackoverflow.com/questions/51951698/how-to-remove-a-label-from-a-mail-by-using-gmail-gem", "title": "How to remove a label from a mail by using gmail gem", "body": "<p>I'm using <code>gmail</code> gem and I want to remove a label from a email, but I couldn't find out how to remove the label.</p>\n\n<p>By this code I can remove label itself.</p>\n\n<pre><code>gmail.labels.delete(\"Urgent\")\n</code></pre>\n\n<p>But I want to remove a label from a email like this.</p>\n\n<pre><code>email.remove_label('Urgent')\n</code></pre>\n\n<p>How can I do it by using <code>gmail</code> gem?</p>\n\n<p><a href=\"https://github.com/gmailgem/gmail\" rel=\"nofollow noreferrer\">https://github.com/gmailgem/gmail</a></p>\n"}, {"tags": ["ruby-on-rails", "ruby", "blockchain"], "comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 1, "creation_date": 1534866045, "post_id": 51951397, "comment_id": 90854786, "body": "I am very unclear on your question here but a traditional rails &quot;Model&quot; is always a <code>Class</code> (it uses inheritance from the <code>ActiveRecord::Base</code> class) including a <code>Module</code> does not change this."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1534872121, "post_id": 51951397, "comment_id": 90857893, "body": "I think we need a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> here."}, {"owner": {"reputation": 6018, "user_id": 3073313, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d9a53be16eb996b521f1637d19005511?s=128&d=identicon&r=PG", "display_name": "Jay-Ar Polidario", "link": "https://stackoverflow.com/users/3073313/jay-ar-polidario"}, "edited": false, "score": 0, "creation_date": 1534879074, "post_id": 51951397, "comment_id": 90861140, "body": "@P. Maina, because you said &quot;the save method should be overridden to firstly save the appropriate properties in the blockchain and later proceed to do the normal activerecord save&quot;, I believe you would want to use <code>prepend</code> instead of <code>include</code>, because you want some code to be executed first before running normally, unlike if you use <code>include</code> it runs normally first then if the normal method has <code>super</code> on it, that&#39;s only the time when your &quot;included&quot; code gets called. Yours seemed to have worked because coincidentally I believe Rails has multiple ancestor classes that calls <code>super</code>."}, {"owner": {"reputation": 19, "user_id": 10255212, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c316d4d0ba444485f8546c2a56ad3cdb?s=128&d=identicon&r=PG&f=1", "display_name": "P. Maina", "link": "https://stackoverflow.com/users/10255212/p-maina"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1534888467, "post_id": 51951397, "comment_id": 90864976, "body": "@engineersmnky I have edited the question and tried to elaborate a bit more so as to give context. I hope that it is now comprehensive."}, {"owner": {"reputation": 19, "user_id": 10255212, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c316d4d0ba444485f8546c2a56ad3cdb?s=128&d=identicon&r=PG&f=1", "display_name": "P. Maina", "link": "https://stackoverflow.com/users/10255212/p-maina"}, "reply_to_user": {"reputation": 6018, "user_id": 3073313, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d9a53be16eb996b521f1637d19005511?s=128&d=identicon&r=PG", "display_name": "Jay-Ar Polidario", "link": "https://stackoverflow.com/users/3073313/jay-ar-polidario"}, "edited": false, "score": 0, "creation_date": 1534890791, "post_id": 51951397, "comment_id": 90865579, "body": "@Jay-ArPolidario Unfortunately even after prepending so that the module is the first in the ancestor chain, the error still comes up."}, {"owner": {"reputation": 6018, "user_id": 3073313, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d9a53be16eb996b521f1637d19005511?s=128&d=identicon&r=PG", "display_name": "Jay-Ar Polidario", "link": "https://stackoverflow.com/users/3073313/jay-ar-polidario"}, "edited": false, "score": 0, "creation_date": 1534891216, "post_id": 51951397, "comment_id": 90865690, "body": "@P.Maina yes, I didn&#39;t really expect it to be solved with using <code>prepend</code>(though it might solve future bugs that you&#39;ve yet to encounter). Unfortunately, I&#39;m not sure why you said the model gets overwritten or something. I&#39;ll try to reproduce if I get the same problem."}, {"owner": {"reputation": 6018, "user_id": 3073313, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d9a53be16eb996b521f1637d19005511?s=128&d=identicon&r=PG", "display_name": "Jay-Ar Polidario", "link": "https://stackoverflow.com/users/3073313/jay-ar-polidario"}, "edited": false, "score": 0, "creation_date": 1534892559, "post_id": 51951397, "comment_id": 90866039, "body": "I copied your code in a fresh Rails 5.2.1 project, and created a <code>Listing</code> model with attributes <code>parcel_no</code>, <code>description</code>, and <code>address</code>. I commented out anything that has something to do with <code>Ethereum</code> above. Then, I did <code>listing = Listing.new</code> in rails console was raising an error <code>NameError undefined local variable or method &#39;blockchain_attributes&#39; for Listing</code>, and so I fixed that error by changing <code>define_method :blockchain_attributes</code> into <code>define_singleton_method :blockchain_attributes</code>. After this, I did <code>listing.save</code>, and then however it works: <code>puts Listing.count</code> is showing <code>1</code>."}, {"owner": {"reputation": 6018, "user_id": 3073313, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d9a53be16eb996b521f1637d19005511?s=128&d=identicon&r=PG", "display_name": "Jay-Ar Polidario", "link": "https://stackoverflow.com/users/3073313/jay-ar-polidario"}, "edited": false, "score": 0, "creation_date": 1534892735, "post_id": 51951397, "comment_id": 90866076, "body": "@P.Maina Unfortunately, I couldn&#39;t reproduce your problem. My current guess is that it&#39;s either Rails-version-related, or that the code I commented which is those that relate to <code>Ethereum::Contract</code> has something to do with it, or that you have some &quot;other&quot; code that had affected the Model (perhaps via <code>autoload</code>-ing? or something). Oh by the way, I tested this on  ruby 2.5.1."}, {"owner": {"reputation": 5966, "user_id": 2477691, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/DaiPF.jpg?s=128&g=1", "display_name": "chumakoff", "link": "https://stackoverflow.com/users/2477691/chumakoff"}, "edited": false, "score": 0, "creation_date": 1534937165, "post_id": 51951397, "comment_id": 90881347, "body": "Make sure there is no other <code>Listing</code> class defined in the project."}, {"owner": {"reputation": 19, "user_id": 10255212, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c316d4d0ba444485f8546c2a56ad3cdb?s=128&d=identicon&r=PG&f=1", "display_name": "P. Maina", "link": "https://stackoverflow.com/users/10255212/p-maina"}, "reply_to_user": {"reputation": 6018, "user_id": 3073313, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d9a53be16eb996b521f1637d19005511?s=128&d=identicon&r=PG", "display_name": "Jay-Ar Polidario", "link": "https://stackoverflow.com/users/3073313/jay-ar-polidario"}, "edited": false, "score": 0, "creation_date": 1534957915, "post_id": 51951397, "comment_id": 90894441, "body": "Thanks @Jay-ArPolidario and @chumakoff. I have found the solution and it has to do with each of the things you&#39;ve mentioned. What was happening was that ethereum gem was creating a new class dynamically called Listing through the line <code>Ethereum::Contract.create()</code> and as a result when i call <code>Listing.count</code> it assumes the class method call was meant for the new dynamically created class and not activerecord model."}, {"owner": {"reputation": 6018, "user_id": 3073313, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d9a53be16eb996b521f1637d19005511?s=128&d=identicon&r=PG", "display_name": "Jay-Ar Polidario", "link": "https://stackoverflow.com/users/3073313/jay-ar-polidario"}, "edited": false, "score": 0, "creation_date": 1534959930, "post_id": 51951397, "comment_id": 90895347, "body": "@P.Maina no prob! Good job! :)"}], "owner": {"reputation": 19, "user_id": 10255212, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c316d4d0ba444485f8546c2a56ad3cdb?s=128&d=identicon&r=PG&f=1", "display_name": "P. Maina", "link": "https://stackoverflow.com/users/10255212/p-maina"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 77, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1534888299, "creation_date": 1534863092, "last_edit_date": 1534888299, "question_id": 51951397, "link": "https://stackoverflow.com/questions/51951397/why-does-including-a-module-in-an-active-record-model-cause-the-model-to-be-rede", "title": "Why does including a module in an active record model cause the model to be redefined as a normal ruby class?", "body": "<p>I have an Active Record model (Listing) that should store some properties in the database while some other properties will be stored in a blockchain (ethereum). </p>\n\n<p>Ideally when a developer does <code>model_record.save</code>, the active record save method should be overridden to firstly save the appropriate properties in the blockchain and later proceed to do the normal activerecord save. This procedure applies to most other methods like <code>.update</code>, <code>.destroy</code>, <code>.create</code>.</p>\n\n<p>The following has been achieved by adding a macros level declaration in the model to distinguish the blockchain properties from the normal active record columns</p>\n\n<pre><code>class Listing &lt; ApplicationRecord\n   include BlockchainRecord\n\n   self.table_name = \"listings\"\n   blockchain_properties :parcel_no,\n                         :description\nend\n</code></pre>\n\n<p>A module <code>BlockchainRecord</code> has also been included inside the model and includes methods like the ones shown below</p>\n\n<pre><code>module BlockchainRecord\n\n  extend ActiveSupport::Concern\n  ...............\n\n\n  class_methods do\n    def blockchain_properties(*props)\n      @@blockchain_attributes = props\n\n\n      define_method :blockchain_attributes do\n        props\n      end\n\n      props.each do |prop|\n        define_method prop do\n          if self.instance_variable_defined?(\"@#{prop}\")\n            self.instance_variable_get(\"@#{prop}\") \n          else\n            if self.address\n              val = self.contract.call.send(\"#{prop}\") \n              self.instance_variable_set(\"@#{prop}\", val)\n              val\n            else\n              nil\n            end\n          end\n        end\n\n        # Setter methods\n        define_method \"#{prop}=\" do |arg|\n          self.instance_variable_set(\"@#{prop}\", arg)\n        end\n      end\n    end\n\n    def new(props = {})\n      model_record = super(props.except(blockchain_attributes))\n\n      blockchainProps = props.slice(*blockchain_attributes)\n      blockchainProps.each do |k, v|\n        model_record.send(\"#{k}=\", v)\n      end\n\n      return model_record\n    end\n  end\n\n  def save\n    if self.address\n      blockchain_attributes.each do |prop|\n        self.contract.transact_and_wait.send(\"set_#{prop}\", self.send(\"#{prop}\")) \n        sleep(2)\n      end\n      super\n    else\n      # in case we call Class.new then Object.save\n      contract = Ethereum::Contract.create(file: self.class.contract_file_path)\n      key = Eth::Key.new(priv: ENV[\"PRIVATE_KEY\"])\n      contract.key = key\n      self.address = contract.deploy_and_wait(*(self.attributes.slice(*blockchain_attributes).values))\n      super\n    end\n  end\n\nend\n</code></pre>\n\n<p>The problem occurs when one finishes saving an activerecord object, then later tries something like <code>Model.count</code> or <code>Model.all</code>. </p>\n\n<p>For example if i did, \n<code>l = Listing.new(parcel_no: 1234, description: \"...\", registration_section: \"...\")</code> then saved the record <code>l.save</code>, that would store the blockchain properties (parcel_no and description) correctly and later call the <code>.save</code> provided by ActiveRecord to save the rest of the attributes to the database. </p>\n\n<p>However, when i make a subsequent call like <code>Listing.count</code>, that fails with the following error message <strong>NoMethodError: undefined method count for Listing:Class</strong>, and when i check the ancestors of <code>Listing</code> i get <code>[Listing, ActiveSupport::ToJsonWithActiveSupportEncoder, Object, PP::ObjectMixin, MakeMakefile, ActiveSupport::Dependencies::Loadable, JSON::Ext::Generator::GeneratorMethods::Object, ActiveSupport::Tryable, Kernel, BasicObject]</code> which just means it no longer inherits from active record base</p>\n\n<p>Why does the overriding of this activerecord .save method in the module cause <code>Listing</code> model to no longer inherit from ActiveRecord::Base and how can that be fixed ?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "httparty"], "answers": [{"comments": [{"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 1, "creation_date": 1534863052, "post_id": 51951136, "comment_id": 90852887, "body": "Or, something along the lines of <code>HTTParty.post(&quot;url&quot;, :headers =&gt; auth, ...)</code> (assuming <code>auth</code> is in the correct format)."}], "tags": [], "owner": {"reputation": 686, "user_id": 1491410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c938ed150a685b33d1b91266b382c8d?s=128&d=identicon&r=PG", "display_name": "elliotcm", "link": "https://stackoverflow.com/users/1491410/elliotcm"}, "is_accepted": true, "score": 2, "last_activity_date": 1534862302, "creation_date": 1534862302, "answer_id": 51951136, "question_id": 51951062, "link": "https://stackoverflow.com/questions/51951062/nomethoderror-undefined-method-strip-for-hash-while-using-httparty/51951136#51951136", "title": "NoMethodError: undefined method `strip&#39; for hash while using httparty", "body": "<p>You're passing in a hash where it's expecting a string.</p>\n\n<p>You want something like:</p>\n\n<pre><code>def auth\n  @token\nend\n</code></pre>\n"}], "owner": {"reputation": 1059, "user_id": 3576036, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/f1fb048a732909f50ff2e2a267119640?s=128&d=identicon&r=PG&f=1", "display_name": "user3576036", "link": "https://stackoverflow.com/users/3576036/user3576036"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1769, "favorite_count": 0, "accepted_answer_id": 51951136, "answer_count": 1, "score": 0, "last_activity_date": 1534862302, "creation_date": 1534862072, "question_id": 51951062, "link": "https://stackoverflow.com/questions/51951062/nomethoderror-undefined-method-strip-for-hash-while-using-httparty", "title": "NoMethodError: undefined method `strip&#39; for hash while using httparty", "body": "<p>I am trying to create content by using api post request and I am using httparty gem.</p>\n\n<pre><code>  def initialize(token)\n    @token = \"Bearer kdkdkfvl\"\n  end\n\n  def auth\n    { AUTHORIZATION: @token }\n  end\n\nresponse = HTTParty.post(\"url\", :headers =&gt; { \"Authorization\" =&gt; auth}, :body =&gt; article)\n</code></pre>\n\n<p>When I run the code I am getting </p>\n\n<p><code>NoMethodError: undefined method</code>strip' for #\n`\nI am stuck here. Need some help</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 2, "creation_date": 1534861910, "post_id": 51950735, "comment_id": 90852160, "body": "<code>Die.new.roll == 2</code> (or 1, 3, 4, 5, 6). <code>2.output</code> is undefined."}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 1, "creation_date": 1534863293, "post_id": 51950735, "comment_id": 90853033, "body": "(1) Note that <code>rand(7)</code> might return <code>0</code>"}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 1, "creation_date": 1534863386, "post_id": 51950735, "comment_id": 90853101, "body": "(2) Instead of duplicating the code, you could (should) just call <code>roll</code> from within <code>initialize</code>."}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 1, "creation_date": 1534863481, "post_id": 51950735, "comment_id": 90853175, "body": "(3) the empty parentheses are superfluous, just write <code>def initialize</code>, <code>def roll</code> etc."}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 1, "creation_date": 1534879903, "post_id": 51950735, "comment_id": 90861477, "body": "Did you actually read the error message? What object does the error message say has no method named <code>output</code>? What does the error message say the class of that object is? What is the class you defined the method <code>output</code> in? Is that the same class as the error message says? If no, what does that tell you?"}], "answers": [{"comments": [{"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1534863866, "post_id": 51950808, "comment_id": 90853441, "body": "Or implement <code>to_s</code> and call <code>puts Die.new</code> instead of having the object <code>puts</code> itself."}, {"owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "reply_to_user": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1534877023, "post_id": 51950808, "comment_id": 90860231, "body": "I agree @Stefan. Also, get rid of <code>output</code> and use <code>attr_reader :number</code> instead. Call <code>roll</code> from within <code>initialize</code>, as you already ponited out."}], "tags": [], "owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "is_accepted": true, "score": 7, "last_activity_date": 1534861570, "last_edit_date": 1534861570, "creation_date": 1534861244, "answer_id": 51950808, "question_id": 51950735, "link": "https://stackoverflow.com/questions/51950735/nomethoderror-when-there-is-a-method/51950808#51950808", "title": "NoMethodError when there is a method", "body": "<p>You must call like this:</p>\n\n<pre><code>die = Die.new\ndie.output # =&gt; 1\ndie.roll\ndie.output # =&gt; 3\n</code></pre>\n\n<p>First you need to instantiate the object (<code>Die.new</code>) into a variable (<code>die</code>).\nThen call your method on it.</p>\n\n<p>Note: better to use <code>rand(1..6)</code></p>\n\n<p>Without using a variable, the better you can do is:</p>\n\n<pre><code>Die.new.output # =&gt; 3\n</code></pre>\n\n<p>It is not possible chain methods as you did (or follow the answer by <a href=\"https://stackoverflow.com/a/51950886/5239030\">Martin Zinovsky</a>)</p>\n"}, {"comments": [{"owner": {"reputation": 7224, "user_id": 448934, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TXtux.jpg?s=128&g=1", "display_name": "Pascal", "link": "https://stackoverflow.com/users/448934/pascal"}, "edited": false, "score": 0, "creation_date": 1534861942, "post_id": 51950886, "comment_id": 90852188, "body": "Chaining does not make much sense when hald of the methods are not chainable, IMHO."}], "tags": [], "owner": {"reputation": 3320, "user_id": 4950680, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C8cEh.jpg?s=128&g=1", "display_name": "Martin Zinovsky", "link": "https://stackoverflow.com/users/4950680/martin-zinovsky"}, "is_accepted": false, "score": 4, "last_activity_date": 1534861497, "creation_date": 1534861497, "answer_id": 51950886, "question_id": 51950735, "link": "https://stackoverflow.com/questions/51950735/nomethoderror-when-there-is-a-method/51950886#51950886", "title": "NoMethodError when there is a method", "body": "<p>If you want to chain method you should return instance in the end:</p>\n\n<pre><code>class Die\n  def initialize\n    @number = rand(7)\n  end\n\n  def output\n    puts @number\n  end\n\n  def roll\n    @number = rand(7)\n    self # Here\n  end\nend\n\nDie.new.roll.output\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 9157595, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae376cca5c655fda1aa4f08c6cdfff37?s=128&d=identicon&r=PG&f=1", "display_name": "Jraokmepala", "link": "https://stackoverflow.com/users/9157595/jraokmepala"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 51950808, "answer_count": 2, "score": 2, "last_activity_date": 1534861570, "creation_date": 1534861037, "question_id": 51950735, "link": "https://stackoverflow.com/questions/51950735/nomethoderror-when-there-is-a-method", "title": "NoMethodError when there is a method", "body": "<p>I am creating a Die class that has a function to output the number of the die. It has been named both printout and output, but the function continues to fail because of a NoMethodError. This is my code:</p>\n\n<pre><code>class Die\n\n  def initialize()\n    @number = rand(7)\n  end\n\n  def output()\n    puts @number\n  end\n\n  def roll()\n    @number = rand(7)\n  end\n\nend\n\nDie.new.roll.output\n</code></pre>\n\n<p>Here is my error when I run the code:</p>\n\n<blockquote>\n  <p>undefined method `output' for 2:Integer (NoMethodError)</p>\n</blockquote>\n\n<p>Any ideas?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-5"], "comments": [{"owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "edited": false, "score": 0, "creation_date": 1534861023, "post_id": 51950694, "comment_id": 90851553, "body": "can you please provide the view, which contains a link to show action?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "reply_to_user": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "edited": false, "score": 0, "creation_date": 1534861446, "post_id": 51950694, "comment_id": 90851858, "body": "See edit #1 @IgorDrozdov"}, {"owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "edited": false, "score": 0, "creation_date": 1534861722, "post_id": 51950694, "comment_id": 90852033, "body": "so you&#39;re trying to type the url in browser and then you get this error message?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "reply_to_user": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "edited": false, "score": 0, "creation_date": 1534861856, "post_id": 51950694, "comment_id": 90852125, "body": "So I&#39;m going to the order <a href=\"http://localhost:3000/orders/1\" rel=\"nofollow noreferrer\">localhost:3000/orders/1</a> and getting the error"}], "answers": [{"tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": true, "score": 0, "last_activity_date": 1534862067, "creation_date": 1534862067, "answer_id": 51951059, "question_id": 51950694, "link": "https://stackoverflow.com/questions/51950694/actioncontrollerunknownformat-rails-5-controller/51951059#51951059", "title": "ActionController::UnknownFormat rails 5 controller", "body": "<p>Since <code>html</code> format is the default format in <code>Rails</code>, you need to provide <code>pdf</code> format explicitly in your url or the link builder:</p>\n\n<pre><code>localhost:3000/orders/1.pdf\n</code></pre>\n\n<p>Otherwise, it tries to load it as <code>localhost:3000/orders/1.html</code>, but you haven't <code>format.html</code> handler defined in your controller.</p>\n\n<p>When you implement a link in your application, follow the example in <a href=\"https://github.com/excid3/receipts#rendering-the-receipt-pdf-in-your-controller\" rel=\"nofollow noreferrer\">docs</a>:</p>\n\n<pre><code>&lt;%= link_to \"Download Receipt\", charge_path(@charge, format: :pdf) %&gt;\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 567, "favorite_count": 0, "accepted_answer_id": 51951059, "answer_count": 1, "score": 0, "last_activity_date": 1534862080, "creation_date": 1534860874, "last_edit_date": 1534862080, "question_id": 51950694, "link": "https://stackoverflow.com/questions/51950694/actioncontrollerunknownformat-rails-5-controller", "title": "ActionController::UnknownFormat rails 5 controller", "body": "<p><strong>Edit #1</strong></p>\n\n<p>View for orders/show, I haven't added the invoice yet, but the view should work with or without the link to the invoice, right?</p>\n\n<pre><code>&lt;section class=\"pt-4 px-8 animated\"&gt;\n  &lt;section class=\"flex flex-wrap justify-between\"&gt;\n    &lt;h3 class=\"font-normal text-grey-dark mb-4 py-2\"&gt;Order Information&lt;/h3&gt;\n    &lt;%= render 'layouts/dashboard/account' %&gt;\n  &lt;/section&gt;\n\n  &lt;h2 class=\"text-grey-darkest text-lg no-underline py-4\"&gt;\n    Course: &lt;%= @order.course.title %&gt;\n  &lt;/h2&gt;\n\n  &lt;section class=\"py-2\"&gt;\n    &lt;p class=\"text-grey-darkest text-md pb-4\"&gt;&lt;%= @order.course.description %&gt;&lt;/p&gt;\n\n  &lt;p class=\"text-grey-darkest text-md\"&gt;\n    &lt;b&gt;Course Price:&lt;/b&gt;\n    \u00a3&lt;%= @order.course.price %&gt;\n  &lt;/p&gt;\n\n  &lt;p class=\"text-grey-darkest text-md\"&gt;\n    &lt;b&gt;Total Price:&lt;/b&gt;\n    \u00a3&lt;%= @order.amount %&gt;\n  &lt;/p&gt;\n  &lt;/section&gt;\n\n  &lt;section class=\"text-grey-darkest pt-4\"&gt;\n    &lt;h4 class=\"pb-2\"&gt;User details&lt;/h4&gt;\n    &lt;p&gt;Name: &lt;%= current_user.full_name %&gt;&lt;/p&gt;\n    &lt;p&gt;Email: &lt;%= current_user.email %&gt;&lt;/p&gt;\n  &lt;/section&gt;\n&lt;/section&gt;\n</code></pre>\n\n<p><strong>Original question</strong></p>\n\n<p>I'm getting an <code>ActionController::UnknownFormat</code> error in my controller</p>\n\n<pre><code>class OrdersController &lt; ApplicationController\n  layout proc { user_signed_in? ? \"dashboard\" : \"application\" }\n\n  before_action :authenticate_user!\n\n  def index\n    @orders = Order.includes(:course).all\n  end\n\n  def show\n    @order = Order.find(params[:id])\n\n    respond_to do |format|\n      format.pdf {\n        send_data @order.receipt.render,\n        filename: \"#{@order.created_at.strftime(\"%Y-%m-%d\")}-aurameir-courses-receipt.pdf\",\n        type: \"application/pdf\",\n        disposition: :inline\n      }\n    end\n  end\n\n  def create\n  end\n\n  def destroy\n  end\nend\n</code></pre>\n\n<p>I am using the <a href=\"https://github.com/excid3/receipts\" rel=\"nofollow noreferrer\">https://github.com/excid3/receipts</a> gem which uses <code>prawn</code> but I'm unsure as to why the error is there.</p>\n"}, {"tags": ["ruby", "regex", "string"], "comments": [{"owner": {"reputation": 481662, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1534860433, "post_id": 51950510, "comment_id": 90851156, "body": "You may use something like <code>text = text.gsub(&#47;pattern1&#47;) { |m| m.gsub(&#47;pattern2&#47;, &#39;replacement&#39;) } </code>"}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1534860884, "post_id": 51950510, "comment_id": 90851441, "body": "<i>Sidenote:</i> <code>&amp;:gsub(&#47;^[=_*]+|[=_*]+$&#47;, &quot;&quot;)</code> is not a valid ruby and should raise an exception."}, {"owner": {"reputation": 187, "user_id": 5468196, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/95f27a4f05a6dcaf98394e1d08b8f7a0?s=128&d=identicon&r=PG&f=1", "display_name": "Jan Parzyd\u0142o", "link": "https://stackoverflow.com/users/5468196/jan-parzyd%c5%82o"}, "reply_to_user": {"reputation": 481662, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1534861523, "post_id": 51950510, "comment_id": 90851900, "body": "@WiktorStribi\u017cew It seems to work, thanks! Will do some testing now to make sure."}, {"owner": {"reputation": 187, "user_id": 5468196, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/95f27a4f05a6dcaf98394e1d08b8f7a0?s=128&d=identicon&r=PG&f=1", "display_name": "Jan Parzyd\u0142o", "link": "https://stackoverflow.com/users/5468196/jan-parzyd%c5%82o"}, "reply_to_user": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1534861623, "post_id": 51950510, "comment_id": 90851969, "body": "@mudasobwa correct. I had that line split into two separate mappings in IRB, but tried to make the transcribed method as short as possible. Thanks!"}], "owner": {"reputation": 187, "user_id": 5468196, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/95f27a4f05a6dcaf98394e1d08b8f7a0?s=128&d=identicon&r=PG&f=1", "display_name": "Jan Parzyd\u0142o", "link": "https://stackoverflow.com/users/5468196/jan-parzyd%c5%82o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 28, "favorite_count": 0, "closed_date": 1534861584, "answer_count": 0, "score": 0, "last_activity_date": 1534860237, "creation_date": 1534860237, "question_id": 51950510, "link": "https://stackoverflow.com/questions/51950510/ruby-how-to-modify-part-of-a-string-using-aliasing", "closed_reason": "Duplicate", "title": "Ruby: how to modify part of a string using aliasing", "body": "<p>I have a document and I'm storing it as a single string. I need to extract certain chunks of text from the document and within those chunks (but never outside of them!) modify lines matched by another regexp. To be specific, my goal is to replace empty lines within chunks matched by <code>E_DISCLAIMER</code> with some arbitrary string. Is it possible to obtain a reference to a substring so that I can apply <code>String#gsub</code> only to that range within a string?</p>\n\n<p>This is what I've been able to come up so far:</p>\n\n<pre><code>def disambiguate_blanks(text)\n    # 1. scan for blocks between separators\n    # 2. match blocks against document to get starting index\n    # 3. extract matched blocks using start + length\n    # 4. tag blank lines in blocks by appending a special string\n    matchdata = text.scan(E_DISCLAIMER)\n    blocks = matchdata.map(&amp;:join).map(&amp;:gsub(/^[=_*]+|[=_*]+$/, \"\"))\n    matched_blocks = blocks.reduce(Hash.new) { |h, b| \n        h[b] = text.index(b)\n        h\n    }\n    extracted_blocks = []\n    matched_blocks.each { |block, start| \n        eb = text[start..start + block.size]\n        extracted_blocks &lt;&lt; eb\n    }\n    extracted_blocks.each { |eb|\n        eb.gsub!(/(^)(\\n)/, '\\1::EMPTY::\\2') \n    }\n    return text\nend\n</code></pre>\n\n<p>The idea is to have the changes applied in the last block also apply to <code>text</code>. Currently it is not the case, as <code>String#[]</code> returns a new string.</p>\n"}, {"tags": ["ruby", "xml", "ruby-on-rails-4", "xpath", "nokogiri"], "answers": [{"tags": [], "owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "is_accepted": false, "score": 0, "last_activity_date": 1534859757, "creation_date": 1534859757, "answer_id": 51950365, "question_id": 51950160, "link": "https://stackoverflow.com/questions/51950160/cherry-pick-xml-nodes-in-specific-order-using-nokogiri/51950365#51950365", "title": "Cherry pick XML nodes in specific order using Nokogiri", "body": "<p>Nokogiri returns an <code>Enumerable</code>, you might sort it as you need:</p>\n\n<pre><code>fruit_basket = %w[Orange Apple Cherry]\n\ndoc.\n  xpath('//fruit').\n  sort_by do |e| # HERE\n    fruit_basket.index(e.xpath('name').text) || Float::INFINITY\n  end.\n  each { |e| puts e.text }\n\n#\u21d2\u00a0Orange\n#  2018-08-20\n#  Apple\n#  2018-08-21\n#  Cherry\n#  2018-08-29\n#  Banana\n#  2018-08-29\n</code></pre>\n\n<p>Whether you need to skip fruits not listed, filter it upfront:</p>\n\n<pre><code>doc.\n  xpath('//fruit').\n  select do |e| # HERE\n    fruit_basket.index(e.xpath('name').text)\n  end.\n  sort_by do |e|\n    fruit_basket.index(e.xpath('name').text)\n  end.\n  each { |e| puts e.text }\n</code></pre>\n"}], "owner": {"reputation": 1198, "user_id": 1296209, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/dbc5bd9dcaa6aa58aea8ab62ce510b4c?s=128&d=identicon&r=PG", "display_name": "webaholik", "link": "https://stackoverflow.com/users/1296209/webaholik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1534914230, "creation_date": 1534859082, "last_edit_date": 1534914230, "question_id": 51950160, "link": "https://stackoverflow.com/questions/51950160/cherry-pick-xml-nodes-in-specific-order-using-nokogiri", "title": "Cherry pick XML nodes in specific order using Nokogiri", "body": "<p><strong>I need to import the fruit nodes in a specific order (Orange, Apple, Cherry), not alphabetical or numerical:</strong></p>\n\n<pre><code>&lt;fruits&gt;\n  &lt;fruit&gt;\n    &lt;name&gt;Apple&lt;/name&gt;\n    &lt;expiration&gt;2018-08-21&lt;/expiration&gt;\n  &lt;/fruit&gt;\n  &lt;fruit&gt;\n    &lt;name&gt;Banana&lt;/name&gt;\n    &lt;expiration&gt;2018-08-29&lt;/expiration&gt;\n  &lt;/fruit&gt;\n  &lt;fruit&gt;\n    &lt;name&gt;Cherry&lt;/name&gt;\n    &lt;expiration&gt;2018-08-29&lt;/expiration&gt;\n  &lt;/fruit&gt;\n  &lt;fruit&gt;\n    &lt;name&gt;Orange&lt;/name&gt;\n    &lt;expiration&gt;2018-08-20&lt;/expiration&gt;\n  &lt;/fruit&gt;\n&lt;/fruits&gt;\n</code></pre>\n\n<p>Prior to the new sorting requirement, we enumerated through the nodes like this, and it worked great:</p>\n\n<pre><code>doc.css('fruit').each do |fruit|\n  Pantry.create({name:fruit.css('name').first.text,\n                 expiration: fruit.css('expiration').text})\nend\n</code></pre>\n\n<p>I attempted using <code>xpath</code>, based on <a href=\"https://stackoverflow.com/a/1475286/1296209\">this answer</a> but it only returns the <code>name</code> subnode, not the parent <code>fruit</code> node, resulting in the <code>expiration</code> subnode not being accessible:</p>\n\n<pre><code>fruit_basket = %w[Orange Apple Cherry]\nfruit_basket.each do |temp_fruit|  \n  fruit = doc.xpath(\"//name[contains(text(), '#{temp_fruit}')]\")\n  Pantry.create({name:fruit.css('name').text,\n                 expiration: fruit.css('expiration').text})\nend\n</code></pre>\n\n<p><strong>What's the proper way (nokogiri-way?) to enumerate through the fruit nodes in the order of my a <code>fruit_basket</code> array, ignoring fruit nodes that are not in the <code>fruit_basket</code>?</strong></p>\n"}, {"tags": ["ruby-on-rails", "ruby", "arithmetic-expressions"], "comments": [{"owner": {"reputation": 48635, "user_id": 6742, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/xPawo.png?s=128&g=1", "display_name": "David Aldridge", "link": "https://stackoverflow.com/users/6742/david-aldridge"}, "edited": false, "score": 1, "creation_date": 1534858956, "post_id": 51949722, "comment_id": 90850103, "body": "In Ruby the fix for this is to use the BigDecimal class for storing numerics. <a href=\"https://ruby-doc.org/stdlib-2.1.1/libdoc/bigdecimal/rdoc/BigDecimal.html\" rel=\"nofollow noreferrer\">ruby-doc.org/stdlib-2.1.1/libdoc/bigdecimal/rdoc/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1046, "user_id": 10019394, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mPHEq.jpg?s=128&g=1", "display_name": "AdaRaider", "link": "https://stackoverflow.com/users/10019394/adaraider"}, "is_accepted": true, "score": 3, "last_activity_date": 1534859020, "last_edit_date": 1534859020, "creation_date": 1534858014, "answer_id": 51949815, "question_id": 51949722, "link": "https://stackoverflow.com/questions/51949722/multiplication-behavior-in-ruby-is-different-than-normal-arithmetic-behaviors/51949815#51949815", "title": "multiplication behavior in ruby is different than normal arithmetic behaviors", "body": "<p>The simple answer is that there is no floating point number equal to exactly 85.2. </p>\n\n<p>One way to understand this is because floating point numbers are basically represented using scientific notation in base 2. </p>\n\n<p>This video does a really good job of explaining.</p>\n\n<p><strong>Floating Point Numbers - Computerphile</strong></p>\n\n<p><a href=\"https://www.youtube.com/watch?v=PZRI1IfStY0\" rel=\"nofollow noreferrer\">https://www.youtube.com/watch?v=PZRI1IfStY0</a></p>\n"}], "owner": {"reputation": 129, "user_id": 7875419, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-asXuMMvRSMM/AAAAAAAAAAI/AAAAAAAAAIw/yd4Rk4_G9T4/photo.jpg?sz=128", "display_name": "Hansa Tharuka", "link": "https://stackoverflow.com/users/7875419/hansa-tharuka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "closed_date": 1534860827, "accepted_answer_id": 51949815, "answer_count": 1, "score": 0, "last_activity_date": 1534859020, "creation_date": 1534857718, "question_id": 51949722, "link": "https://stackoverflow.com/questions/51949722/multiplication-behavior-in-ruby-is-different-than-normal-arithmetic-behaviors", "closed_reason": "Duplicate", "title": "multiplication behavior in ruby is different than normal arithmetic behaviors", "body": "<p>Regarding multiplication,</p>\n\n<pre><code>puts 8.52*10; #multi\n</code></pre>\n\n<p>the answer is 85.199999 it is not 85.2. why does it happen.</p>\n"}, {"tags": ["ruby", "ruby-on-rails-5", "stripe-payments"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "edited": false, "score": 0, "creation_date": 1534865911, "post_id": 51948499, "comment_id": 90854698, "body": "The charge id is getting saved but nothing regarding the order <a href=\"https://gyazo.com/2fb070b7aab949a1f2b1a1b072d05e21\" rel=\"nofollow noreferrer\">gyazo.com/2fb070b7aab949a1f2b1a1b072d05e21</a> so the last 4 digits etc"}, {"owner": {"reputation": 446, "user_id": 8356015, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PaYtW.jpg?s=128&g=1", "display_name": "Ravi Teja Dandu", "link": "https://stackoverflow.com/users/8356015/ravi-teja-dandu"}, "edited": false, "score": 0, "creation_date": 1534918959, "post_id": 51948499, "comment_id": 90871946, "body": "As mentioned in the answer, all the information is within the stripe_charge object. For example, you can get the last 4 digits by calling <code>stripe_charge.source.last4</code>"}], "tags": [], "owner": {"reputation": 446, "user_id": 8356015, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PaYtW.jpg?s=128&g=1", "display_name": "Ravi Teja Dandu", "link": "https://stackoverflow.com/users/8356015/ravi-teja-dandu"}, "is_accepted": false, "score": 0, "last_activity_date": 1534854434, "last_edit_date": 1534854434, "creation_date": 1534853810, "answer_id": 51948499, "question_id": 51948116, "link": "https://stackoverflow.com/questions/51948116/get-stripe-charge-information-rails-5-create-order/51948499#51948499", "title": "Get Stripe charge information rails 5 create order", "body": "<p>I guess you are not storing the Stripe Charge ID anywhere on successful payment.</p>\n\n<p>My suggestion, store the charge ID in your Order record</p>\n\n<pre><code>if charge.paid\n  Order.create(\n    course_id: @course.id,\n    user_id: @user.id,\n    amount: @course.price,\n    stripe_charge_id: charge.id\n  )\nend\n</code></pre>\n\n<p>In your receipt method you can fetch the stripe charge as follows:</p>\n\n<pre><code>def receipt\n  stripe_charge = Stripe::Charge.retrieve(stripe_charge_id)\n  ...\n\nend\n</code></pre>\n\n<p>The stripe_charge objects contains all the information and you can use whatever data you need.</p>\n\n<p>Hope this helped.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "edited": false, "score": 0, "creation_date": 1534865874, "post_id": 51948623, "comment_id": 90854670, "body": "It&#39;s not getting saved to the database <a href=\"https://gyazo.com/2fb070b7aab949a1f2b1a1b072d05e21\" rel=\"nofollow noreferrer\">gyazo.com/2fb070b7aab949a1f2b1a1b072d05e21</a>"}, {"owner": {"reputation": 32451, "user_id": 2516474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a2179a340c0e84edc285d432211145d?s=128&d=identicon&r=PG", "display_name": "SteveTurczyn", "link": "https://stackoverflow.com/users/2516474/steveturczyn"}, "edited": false, "score": 0, "creation_date": 1534868779, "post_id": 51948623, "comment_id": 90856332, "body": "Sorry, I thought it was obvious what to do.  See my edited answer."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "edited": false, "score": 0, "creation_date": 1534869513, "post_id": 51948623, "comment_id": 90856694, "body": "Ah ok, that makes sense. Didn&#39;t clock on right away, thank you!"}], "tags": [], "owner": {"reputation": 32451, "user_id": 2516474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a2179a340c0e84edc285d432211145d?s=128&d=identicon&r=PG", "display_name": "SteveTurczyn", "link": "https://stackoverflow.com/users/2516474/steveturczyn"}, "is_accepted": true, "score": 1, "last_activity_date": 1534868738, "last_edit_date": 1534868738, "creation_date": 1534854205, "answer_id": 51948623, "question_id": 51948116, "link": "https://stackoverflow.com/questions/51948116/get-stripe-charge-information-rails-5-create-order/51948623#51948623", "title": "Get Stripe charge information rails 5 create order", "body": "<p>All the information you need is in the <code>charge</code> object you created.</p>\n\n<pre><code>  if charge.paid\n    Order.create(\n      course_id: @course.id,\n      user_id: @user.id,\n      amount: @course.price, \n      card_last4: charge.source.last4,\n      card_type: charge.source.brand,\n      card_exp_month: charge.source.exp_month,\n      card_exp_year: charge.source.exp_year\n    )\n  end\n</code></pre>\n\n<p>See <a href=\"https://stripe.com/docs/api/ruby#charge_object\" rel=\"nofollow noreferrer\">https://stripe.com/docs/api/ruby#charge_object</a> for all the information available to you about a charge.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 401, "favorite_count": 0, "accepted_answer_id": 51948623, "answer_count": 2, "score": 2, "last_activity_date": 1534868738, "creation_date": 1534852531, "question_id": 51948116, "link": "https://stackoverflow.com/questions/51948116/get-stripe-charge-information-rails-5-create-order", "title": "Get Stripe charge information rails 5 create order", "body": "<p>So I'm implementing Stripe and users are able to purchase successfully, however, I would like to get the charge information, last 4 card numbers, card type etc so I can generate receipts using <a href=\"https://github.com/excid3/receipts\" rel=\"nofollow noreferrer\">https://github.com/excid3/receipts</a>.</p>\n\n<p>Here is what I have so far:</p>\n\n<p>PaymentsController</p>\n\n<pre><code>class PaymentsController &lt; ApplicationController\n  before_action :authenticate_user!\n\n  def create\n    token = params[:stripeToken]\n    @course = Course.find(params[:course_id])\n    @user = current_user\n\n    begin\n      charge = Stripe::Charge.create(\n        amount: (@course.price*100).to_i,\n        currency: \"gbp\",\n        source: token,\n        description: params[:stripeEmail],\n        receipt_email: params[:stripeEmail]\n      )\n\n      if charge.paid\n        Order.create(\n          course_id: @course.id,\n          user_id: @user.id,\n          Amount: @course.price\n        )\n      end\n\n    flash[:success] = \"Your payment was processed successfully\"\n\n    rescue Stripe::CardError =&gt; e\n      body = e.json_body\n      err = body[:error]\n      flash[:error] = \"Unfortunately, there was an error processing your payment: #{err[:message]}\"\n    end\n\n    redirect_to course_path(@course)\n  end\nend\n</code></pre>\n\n<p>OrdersController</p>\n\n<pre><code>class OrdersController &lt; ApplicationController\n  layout proc { user_signed_in? ? \"dashboard\" : \"application\" }\n\n  before_action :authenticate_user!\n\n  def index\n    @orders = Order.includes(:course).all\n  end\n\n  def show\n    @order = Order.find(params[:id])\n\n    respond_to do |format|\n      format.pdf {\n        send_data @order.receipt.render,\n        filename: \"#{@order.created_at.strftime(\"%Y-%m-%d\")}-aurameir-courses-receipt.pdf\",\n        type: \"application/pdf\",\n        disposition: :inline\n      }\n    end\n  end\n\n  def create\n  end\n\n  def destroy\n  end\nend\n</code></pre>\n\n<p>Order.rb</p>\n\n<pre><code>class Order &lt; ApplicationRecord\n  belongs_to :course\n  belongs_to :user\n\n  validates :stripe_id, uniqueness: true\n\n  def receipt\n    Receipts::Receipt.new(\n      id: id,\n      subheading: \"RECEIPT FOR CHARGE #%{id}\",\n      product: \"####\",\n      company: {\n        name: \"####\",\n        address: \"####\",\n        email: \"####\",\n        logo: \"####\"\n      },\n      line_items: [\n        [\"Date\",           created_at.to_s],\n        [\"Account Billed\", \"#{user.full_name} (#{user.email})\"],\n        [\"Product\",        \"####\"],\n        [\"Amount\",         \"\u00a3#{amount / 100}.00\"],\n        [\"Charged to\",     \"#{card_type} (**** **** **** #{card_last4})\"],\n        [\"Transaction ID\", uuid]\n      ],\n      font: {\n        normal: Rails.root.join('app/assets/fonts-converted/font-files/AvenirBook.ttf')\n      }\n    )\n  end\nend\n</code></pre>\n\n<p>schema.rb</p>\n\n<pre><code>create_table \"orders\", force: :cascade do |t|\n    t.integer \"user_id\"\n    t.integer \"course_id\"\n    t.integer \"stripe_id\"\n    t.integer \"amount\"\n    t.string \"card_last4\"\n    t.string \"card_type\"\n    t.integer \"card_exp_month\"\n    t.integer \"card_exp_year\"\n    t.string \"uuid\"\n    t.index [\"course_id\"], name: \"index_orders_on_course_id\"\n    t.index [\"user_id\"], name: \"index_orders_on_user_id\"\n  end\n</code></pre>\n\n<p>How would I go about getting the charge information?</p>\n"}, {"tags": ["ruby", "rom-rb"], "comments": [{"owner": {"reputation": 3320, "user_id": 4950680, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C8cEh.jpg?s=128&g=1", "display_name": "Martin Zinovsky", "link": "https://stackoverflow.com/users/4950680/martin-zinovsky"}, "edited": false, "score": 0, "creation_date": 1534870509, "post_id": 51947597, "comment_id": 90857187, "body": "Did you try changeset? <code>users.changeset(:create, name: &#39;Bob&#39;).commit</code>"}, {"owner": {"reputation": 1266, "user_id": 6022100, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/dc0adea29934c8ee1c31f96bf85a7fbc?s=128&d=identicon&r=PG", "display_name": "rwold", "link": "https://stackoverflow.com/users/6022100/rwold"}, "reply_to_user": {"reputation": 3320, "user_id": 4950680, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C8cEh.jpg?s=128&g=1", "display_name": "Martin Zinovsky", "link": "https://stackoverflow.com/users/4950680/martin-zinovsky"}, "edited": false, "score": 0, "creation_date": 1534870757, "post_id": 51947597, "comment_id": 90857300, "body": "Thanks for replying. No- I\u2019m completely new to ROM, but as far as I can figure out from the docs changesets are an abstraction built on top of commands, and I was deliberately going for the simplest possible thing. I\u2019ll try it and see if it works."}, {"owner": {"reputation": 1266, "user_id": 6022100, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/dc0adea29934c8ee1c31f96bf85a7fbc?s=128&d=identicon&r=PG", "display_name": "rwold", "link": "https://stackoverflow.com/users/6022100/rwold"}, "reply_to_user": {"reputation": 3320, "user_id": 4950680, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C8cEh.jpg?s=128&g=1", "display_name": "Martin Zinovsky", "link": "https://stackoverflow.com/users/4950680/martin-zinovsky"}, "edited": false, "score": 0, "creation_date": 1534871070, "post_id": 51947597, "comment_id": 90857453, "body": "Tried it, got the same error."}], "answers": [{"comments": [{"owner": {"reputation": 1266, "user_id": 6022100, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/dc0adea29934c8ee1c31f96bf85a7fbc?s=128&d=identicon&r=PG", "display_name": "rwold", "link": "https://stackoverflow.com/users/6022100/rwold"}, "edited": false, "score": 0, "creation_date": 1534893468, "post_id": 51957709, "comment_id": 90866244, "body": "Yes, this works fine, thanks. I was trying to get it working with sqlite though. FYI ROM Version 4.2.1 ROM Version 2.5.0 Sequel Version 5.11.0 SQLite3 Gem Version 1.3.13 Strangely, if I take your script and replace the config with <code>ROM.container(:sql, &#39;sqlite::&#47;&#47;my-db-file.db&#39;)</code> (note: no db/ path) then I get the desired output, but it doesn&#39;t seem to create the db file. Also FWIW, I did check the schema created by the migration using the sqlite cli and it seemed fine."}, {"owner": {"reputation": 1266, "user_id": 6022100, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/dc0adea29934c8ee1c31f96bf85a7fbc?s=128&d=identicon&r=PG", "display_name": "rwold", "link": "https://stackoverflow.com/users/6022100/rwold"}, "edited": false, "score": 0, "creation_date": 1534893929, "post_id": 51957709, "comment_id": 90866337, "body": "Incidentally, trying to separate the creation of a persistent db from the script that accesses that db is why I went for a migration rather than this version (which is by far the most common in the documentation). So if you know of a more idiomatic way of achieving that I&#39;d be grateful."}, {"owner": {"reputation": 196, "user_id": 90891, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ff5f14eeb2483e7a6c750b631ae655a5?s=128&d=identicon&r=PG", "display_name": "Zerodestiny", "link": "https://stackoverflow.com/users/90891/zerodestiny"}, "reply_to_user": {"reputation": 1266, "user_id": 6022100, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/dc0adea29934c8ee1c31f96bf85a7fbc?s=128&d=identicon&r=PG", "display_name": "rwold", "link": "https://stackoverflow.com/users/6022100/rwold"}, "edited": false, "score": 0, "creation_date": 1534897019, "post_id": 51957709, "comment_id": 90867003, "body": "If you&#39;re getting the desired output then the database is being created otherwise ROM should choke on the initial connection. Keep in mind that the path will be relative to the current working directory. Also the container definition should be <code>ROM.container(:sql, &#39;sqlite:&#47;&#47;my-db-file.db&#39;)</code>"}, {"owner": {"reputation": 196, "user_id": 90891, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ff5f14eeb2483e7a6c750b631ae655a5?s=128&d=identicon&r=PG", "display_name": "Zerodestiny", "link": "https://stackoverflow.com/users/90891/zerodestiny"}, "reply_to_user": {"reputation": 1266, "user_id": 6022100, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/dc0adea29934c8ee1c31f96bf85a7fbc?s=128&d=identicon&r=PG", "display_name": "rwold", "link": "https://stackoverflow.com/users/6022100/rwold"}, "edited": false, "score": 0, "creation_date": 1534900105, "post_id": 51957709, "comment_id": 90867575, "body": "I updated my answer to more thoroughly answer the question but I just wanted to say that your migration scripts would work just fine and once you start registering your relations everything will work as expected."}, {"owner": {"reputation": 1266, "user_id": 6022100, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/dc0adea29934c8ee1c31f96bf85a7fbc?s=128&d=identicon&r=PG", "display_name": "rwold", "link": "https://stackoverflow.com/users/6022100/rwold"}, "edited": false, "score": 0, "creation_date": 1534920690, "post_id": 51957709, "comment_id": 90872683, "body": "Ah, good catch on the stupid typo in the comment, thanks. Now that creates the file, and I can only run that amended version of your script once because the users table already exists. I guess my remaining issue though is that if it were either a DB issue or a registration issue, I shouldn&#39;t be able to successfully read the empty table in my original script."}, {"owner": {"reputation": 1266, "user_id": 6022100, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/dc0adea29934c8ee1c31f96bf85a7fbc?s=128&d=identicon&r=PG", "display_name": "rwold", "link": "https://stackoverflow.com/users/6022100/rwold"}, "edited": false, "score": 0, "creation_date": 1534920854, "post_id": 51957709, "comment_id": 90872758, "body": "Just seen your update to the post- will have a play. Thanks."}], "tags": [], "owner": {"reputation": 196, "user_id": 90891, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ff5f14eeb2483e7a6c750b631ae655a5?s=128&d=identicon&r=PG", "display_name": "Zerodestiny", "link": "https://stackoverflow.com/users/90891/zerodestiny"}, "is_accepted": true, "score": 2, "last_activity_date": 1534899816, "last_edit_date": 1534899816, "creation_date": 1534891726, "answer_id": 51957709, "question_id": 51947597, "link": "https://stackoverflow.com/questions/51947597/null-validation-failed-when-attribute-supplied-rom-rb/51957709#51957709", "title": "null validation failed when attribute supplied rom-rb", "body": "<p><strong>NOTE:</strong> <em>I revised my answer after some testing and learning about ops gem versions</em></p>\n\n<p>The reason you're getting a <code>NULL CONSTRAINT</code> error is because ROM does not\nhave a schema loaded for the the users table.</p>\n\n<p>When you defined the container below</p>\n\n<pre><code>rom = ROM.container(:sql, 'sqlite://db/my-db-file.db') do |config|\n  class Users &lt; ROM::Relation[:sql]\n    schema(infer: true)\n  end\n\n  config.relation(:users)\nend\n</code></pre>\n\n<p>you defined two things, a relation class bound to a constant called <code>Users</code> and an auto generated relation with the same name but is actually registered inside the ROM container. Effectively the <code>Users</code> constant relation is being ignored. The reason this is important is because the auto generated relation isn't automatically inferring the schema from the database so when you go to write data out, the schema forces all of the unknown keys to be removed causing the error. All you're sending to the db is <code>{}</code>.</p>\n\n<p>To fix the error just tell the relation to infer the schema - an example can be seen below.</p>\n\n<pre><code>require 'rom'\nrequire 'rom/sql'\nrequire 'sqlite3'\n\nputs \"ROM Version #{ROM::Core::VERSION}\" # 4.2.1\nputs \"ROM Version #{ROM::SQL::VERSION}\" # 2.5.0\nputs \"Sequel Version #{Sequel::VERSION}\" # 5.11.0\nputs \"SQLite3 Gem Version #{SQLite3::VERSION}\" # 1.3.13\n\nopts = {\n  adapter: :sqlite,\n  database: 'c:/mydb.db'\n}\n\nrom = ROM.container(:sql, opts) do |c|\n  # Just another way to write the same users table\n  # c.gateways[:default].create_table(:users) do\n  #   column :id,   :integer, primary_key: true\n  #   column :name, :string, null: false\n  #   column :age,  :integer\n  #   column :is_admin, :bool\n  # end\n\n  c.gateways[:default].create_table :users do\n    primary_key :id\n    column :name, String, null: false\n    column :age, Integer\n    column :is_admin, TrueClass\n  end\n\n  c.relation(:users) do\n    schema(infer: true)\n  end\nend\n\nusers = rom.relations[:users]\nputs users.to_a.inspect # =&gt; []\n\ncreate_user = users.command(:create)\ncreate_user.call(name: 'Rob', age: 30, is_admin: true)\nputs users.to_a.inspect # never reached\n\n# Uncomment if you want to see the users schema\n# puts users.dataset.db.schema(:users)\n</code></pre>\n\n<p>If you want to use standalone relation classes instead of the container config dsl then I suggest reading up on the <a href=\"http://rom-rb.org/4.0/learn/advanced/explicit-setup/#auto-registration\" rel=\"nofollow noreferrer\">Auto Registration system</a>.</p>\n\n<p><strong>DATABASE CREATION ISSUE</strong></p>\n\n<p>There is a whole host of things that could be going on which could prevent a sqlite database from being created.</p>\n\n<ul>\n<li>It could be a permissions issue</li>\n<li>The directory structure might not exist</li>\n<li>Sqlite might not be compiled to handle URI's (only matters if you are using <code>file://</code> in your paths) <a href=\"https://www.sqlite.org/uri.html\" rel=\"nofollow noreferrer\"><em>[see sqlite docs]</em></a></li>\n</ul>\n\n<p>My advice here is when working with sqlite and ROM, use the opts hash example from the script above and try and use a relative path from the current working directory. That seems to always work.</p>\n"}], "owner": {"reputation": 1266, "user_id": 6022100, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/dc0adea29934c8ee1c31f96bf85a7fbc?s=128&d=identicon&r=PG", "display_name": "rwold", "link": "https://stackoverflow.com/users/6022100/rwold"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 0, "accepted_answer_id": 51957709, "answer_count": 1, "score": 1, "last_activity_date": 1534899816, "creation_date": 1534850522, "question_id": 51947597, "link": "https://stackoverflow.com/questions/51947597/null-validation-failed-when-attribute-supplied-rom-rb", "title": "null validation failed when attribute supplied rom-rb", "body": "<p>I'm trying to get to grips with the rom-rb persistence library, using sqlite3.</p>\n\n<p>I ran the following migration, which includes a <code>NOT NULL</code> constraint:</p>\n\n<pre><code>ROM::SQL.migration do\n  change do\n    create_table :users do\n      primary_key :id\n      column :name, String, null: false\n      column :age, Integer\n      column :is_admin, TrueClass\n    end\n  end\nend\n</code></pre>\n\n<p>Here's my simple <code>app.rb</code>:</p>\n\n<pre><code>require 'rom'\n\nrom = ROM.container(:sql, 'sqlite://db/my-db-file.db') do |config|\n  class Users &lt; ROM::Relation[:sql]\n    schema(infer: true)\n  end\n\n  config.relation(:users)\nend\n\nusers = rom.relations[:users]\nputs users.to_a.inspect # =&gt; []\n\ncreate_user = users.command(:create)\ncreate_user.call( name: 'Rob', age: 30, is_admin: true )\nputs users.to_a.inspect # never reached\n</code></pre>\n\n<p>Trying to run this script produced the following output:</p>\n\n<pre><code>Roberts-MacBook-Pro:my-rom-demo Rob$ ruby app.rb \n[]\n/Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/sqlite3-1.3.13/lib/sqlite3/statement.rb:108:in `step': SQLite3::ConstraintException: NOT NULL constraint failed: users.name (ROM::SQL::NotNullConstraintError)\n    from /Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/sqlite3-1.3.13/lib/sqlite3/statement.rb:108:in `block in each'\n    from /Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/sqlite3-1.3.13/lib/sqlite3/statement.rb:107:in `loop'\n    from /Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/sqlite3-1.3.13/lib/sqlite3/statement.rb:107:in `each'\n    from /Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/sqlite3-1.3.13/lib/sqlite3/database.rb:156:in `to_a'\n    from /Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/sqlite3-1.3.13/lib/sqlite3/database.rb:156:in `block in execute'\n    from /Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/sqlite3-1.3.13/lib/sqlite3/database.rb:95:in `prepare'\n    from /Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/sqlite3-1.3.13/lib/sqlite3/database.rb:137:in `execute'\n    from /Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/sequel-5.11.0/lib/sequel/adapters/sqlite.rb:189:in `block (2 levels) in _execute'\n    from /Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/sequel-5.11.0/lib/sequel/database/logging.rb:38:in `log_connection_yield'\n    from /Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/sequel-5.11.0/lib/sequel/adapters/sqlite.rb:189:in `block in _execute'\n    from /Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/sequel-5.11.0/lib/sequel/database/connecting.rb:253:in `block in synchronize'\n    from /Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/sequel-5.11.0/lib/sequel/connection_pool/threaded.rb:91:in `hold'\n    from /Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/sequel-5.11.0/lib/sequel/database/connecting.rb:253:in `synchronize'\n    from /Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/sequel-5.11.0/lib/sequel/adapters/sqlite.rb:180:in `_execute'\n    from /Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/sequel-5.11.0/lib/sequel/adapters/sqlite.rb:146:in `execute_insert'\n    from /Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/sequel-5.11.0/lib/sequel/dataset/actions.rb:1099:in `execute_insert'\n    from /Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/sequel-5.11.0/lib/sequel/dataset/actions.rb:399:in `insert'\n    from /Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/rom-sql-2.5.0/lib/rom/sql/relation/writing.rb:39:in `insert'\n    from /Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/rom-sql-2.5.0/lib/rom/sql/commands/create.rb:46:in `block in insert'\n    from /Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/rom-sql-2.5.0/lib/rom/sql/commands/create.rb:46:in `map'\n    from /Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/rom-sql-2.5.0/lib/rom/sql/commands/create.rb:46:in `insert'\n    from /Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/rom-sql-2.5.0/lib/rom/sql/commands/create.rb:31:in `execute'\n    from /Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/rom-core-4.2.1/lib/rom/command.rb:280:in `call'\n    from /Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/rom-sql-2.5.0/lib/rom/sql/commands/error_wrapper.rb:16:in `call'\n    from /Rob.rvm/gems/ruby-2.4.0@learn-rails/gems/rom-core-4.2.1/lib/rom/commands/composite.rb:17:in `call'\n    from app.rb:15:in `&lt;main&gt;'\n</code></pre>\n\n<p>Why does it think my <code>name</code> attribute is null when I'm providing it?</p>\n"}, {"tags": ["ruby", "string", "split", "quoting"], "comments": [{"owner": {"reputation": 4052, "user_id": 476979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e55df1cc7d5fdb4ae9bc2afcb9afe7e4?s=128&d=identicon&r=PG", "display_name": "matthewd", "link": "https://stackoverflow.com/users/476979/matthewd"}, "edited": false, "score": 2, "creation_date": 1534848784, "post_id": 51946795, "comment_id": 90843477, "body": "Why do you want the quotes to remain? <i>That</i> seems to defeat the point of using Shellwords."}, {"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 2, "creation_date": 1534849794, "post_id": 51946795, "comment_id": 90844104, "body": "This screams &quot;XY problem&quot; to me. What&#39;s wrong with the result of <code>Shellwords.split(string) #=&gt; [&quot;this&quot;, &quot;contains&quot;, &quot;a quoted&quot;, &quot;string&quot;]</code> ? What are you trying to do with that array, which makes preserving the original quotes necessary?"}, {"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1534849859, "post_id": 51946795, "comment_id": 90844148, "body": "For instance, what would you expect the result to be of <code>method(&#39;this contains &quot;\\&quot;a quoted\\&quot;&quot; string&#39;)</code>?"}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1534850162, "post_id": 51946795, "comment_id": 90844331, "body": "<code>Shellwords.split(string).map { |s| s[&#47;[^\\\\]\\s&#47;] ? [&#39;&quot;&#39;, s, &#39;&quot;&#39;].join : s }</code>"}, {"owner": {"reputation": 1584, "user_id": 601976, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/de088f705937dd429b9470ab9b9bbd8b?s=128&d=identicon&r=PG", "display_name": "RoUS", "link": "https://stackoverflow.com/users/601976/rous"}, "edited": false, "score": 0, "creation_date": 1535395898, "post_id": 51946795, "comment_id": 91041634, "body": "I want the quotes to be retained so that, for instance, I can write a command line back out to a shell script.  It&#39;s rather more complicated that that; I&#39;m parsing <code>dhcpd</code> config files, which have very rigid definitions for syntax.  I&#39;ll check out the last suggestion shortly."}, {"owner": {"reputation": 1584, "user_id": 601976, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/de088f705937dd429b9470ab9b9bbd8b?s=128&d=identicon&r=PG", "display_name": "RoUS", "link": "https://stackoverflow.com/users/601976/rous"}, "edited": false, "score": 0, "creation_date": 1535396164, "post_id": 51946795, "comment_id": 91041742, "body": "<code>&#39;this contains &quot;a quoted&quot; string&#39;.shellsplit.map(&amp;:shellescape)</code> <i>almost</i> does it: <code>=&gt; [&quot;this&quot;, &quot;contains&quot;, &quot;a\\\\ quoted&quot;, &quot;string&quot;]</code> -- but not quite."}], "owner": {"reputation": 1584, "user_id": 601976, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/de088f705937dd429b9470ab9b9bbd8b?s=128&d=identicon&r=PG", "display_name": "RoUS", "link": "https://stackoverflow.com/users/601976/rous"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 80, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1534847797, "creation_date": 1534847797, "question_id": 51946795, "link": "https://stackoverflow.com/questions/51946795/ruby-shellwords-retaining-quotes-on-split", "title": "Ruby shellwords retaining quotes on split", "body": "<p>Given arbitrary strings that I need to split into tokens, I'm using <a href=\"https://ruby-doc.org/stdlib-2.3.0/libdoc/shellwords/rdoc/Shellwords.html\" rel=\"nofollow noreferrer\"><code>Shellwords</code></a> to retain quoted tokens intact.  However, in the process the quotation marks (or apostrophes) are lost.  What I'm looking for is something like this:</p>\n\n<pre><code>#method('this contains \"a quoted\" string')\n=&gt; [\"this\", \"contains\", \"\\\"a quoted\\\"\", \"string\"]\n</code></pre>\n\n<p><code>#shellescape</code> doesn't seem to help because it returns something essentially unsplittable.</p>\n\n<p>How can I retain the quotation marks (or apostrophes) as part of the token?  Do I need to pre-process the string somehow?  (Which kinda defeat the purpose of using <code>Shellwords</code>, ISTM.)</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["arrays", "ruby", "hash", "duplicates"], "answers": [{"comments": [{"owner": {"reputation": 39, "user_id": 2955918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69e157a96796f5b05d6ef071d9bd03e9?s=128&d=identicon&r=PG&f=1", "display_name": "twenty20", "link": "https://stackoverflow.com/users/2955918/twenty20"}, "edited": false, "score": 0, "creation_date": 1534853174, "post_id": 51947131, "comment_id": 90846118, "body": "Thankyou for the answer. ( invalid ruby object - yes, my bad, i used =&gt; instead of : in error )"}], "tags": [], "owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "is_accepted": true, "score": 2, "last_activity_date": 1534848963, "creation_date": 1534848963, "answer_id": 51947131, "question_id": 51946594, "link": "https://stackoverflow.com/questions/51946594/ruby-array-of-hashes-deduplicate-keys-preserve-values-in-array-where-keys-de/51947131#51947131", "title": "Ruby - array of hashes, deduplicate keys, preserve values in array where keys deduped", "body": "<p>Your input is not a valid ruby object in the first place.</p>\n\n<pre><code>arr = [ {a: 1}, \n        {a: 2}, \n        {b: 3}, \n        {b: 4},\n        {b: 10},\n        {c: 12}, \n        {c: 16},\n        {d: 7}  ]\n\narr.\n  map(&amp;:flatten).\n  group_by(&amp;:shift).\n  each { |_, v| v.flatten! }\n#\u21d2 {:a=&gt;[1, 2], :b=&gt;[3, 4, 10], :c=&gt;[12, 16], :d=&gt;[7]}\n</code></pre>\n\n<hr>\n\n<p>To get exactly what you wanted:</p>\n\n<pre><code>arr.\n  map(&amp;:flatten).\n  group_by(&amp;:shift).\n  map { |k, v| v.flatten! &amp;&amp; { k =&gt; v.size == 1 ? v.first : v } }\n\n#\u21d2 [{:a=&gt;[1, 2]}, {:b=&gt;[3, 4, 10]}, {:c=&gt;[12, 16]}, {:d=&gt;7}]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "is_accepted": false, "score": 0, "last_activity_date": 1534861692, "last_edit_date": 1534861692, "creation_date": 1534857710, "answer_id": 51949718, "question_id": 51946594, "link": "https://stackoverflow.com/questions/51946594/ruby-array-of-hashes-deduplicate-keys-preserve-values-in-array-where-keys-de/51949718#51949718", "title": "Ruby - array of hashes, deduplicate keys, preserve values in array where keys deduped", "body": "<p>You could also reduce each hash into an new hash and merge as you go like this:</p>\n\n<pre><code>arr.reduce({}) do |memo,h| \n  memo.merge!(h) {|_,o,n| Array(o) &lt;&lt; n}\nend\n#=&gt; {:a=&gt;[1, 2], :b=&gt;[3, 4, 10], :c=&gt;[12, 16], :d=&gt;7}\n</code></pre>\n\n<p>Then an <code>Array</code> value is only created if a second value is added. </p>\n\n<p>Your intended result is very unconventional but you can achieve your desired result by appending <code>.map {|k,v| {k=&gt; v}}</code> to the above resulting in:</p>\n\n<pre><code>arr.reduce({}) do |memo,h| \n  memo.merge!(h) {|_,o,n| Array(o) &lt;&lt; n}\nend.map {|k,v| {k=&gt; v}}\n#=&gt; [{:a=&gt;[1, 2]}, {:b=&gt;[3, 4, 10]}, {:c=&gt;[12, 16]}, {:d=&gt;7}]\n</code></pre>\n\n<p>Normally you would want what @mudasobwa's original methodology returns which is a single hash of <code>key =&gt; Array</code> for all elements which makes it far easier to loop through. You could also obtain this same result with </p>\n\n<pre><code>arr.each_with_object(Hash.new {|h,k| h[k] = []}) do |h,obj|\n  h.each {|k,v| obj[k] &lt;&lt; v}\nend\n#=&gt; {:a=&gt;[1, 2], :b=&gt;[3, 4, 10], :c=&gt;[12, 16], :d=&gt;[7]}\n</code></pre>\n\n<p>Another way to get your current desired result: </p>\n\n<pre><code>arr.reduce([]) do |memo,h|\n  key,value = h.first\n  if r = memo.detect {|nh| nh.key?(key)}\n    r[key] = [*r[key],value]\n  else  \n    memo &lt;&lt; h \n  end\n  memo\nend\n#=&gt; [{:a=&gt;[1, 2]}, {:b=&gt;[3, 4, 10]}, {:c=&gt;[12, 16]}, {:d=&gt;7}]\n</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 2955918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69e157a96796f5b05d6ef071d9bd03e9?s=128&d=identicon&r=PG&f=1", "display_name": "twenty20", "link": "https://stackoverflow.com/users/2955918/twenty20"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 51947131, "answer_count": 2, "score": -4, "last_activity_date": 1534861692, "creation_date": 1534847057, "question_id": 51946594, "link": "https://stackoverflow.com/questions/51946594/ruby-array-of-hashes-deduplicate-keys-preserve-values-in-array-where-keys-de", "title": "Ruby - array of hashes, deduplicate keys, preserve values in array where keys deduped", "body": "<p>how to get from arr to arr_result ?</p>\n\n<pre><code>arr = [ {a =&gt; 1}, \n        {a =&gt; 2}, \n        {b =&gt; 3}, \n        {b =&gt; 4},\n        {b =&gt; 10},\n        {c =&gt; 12}, \n        {c =&gt; 16},\n        {d =&gt; 7}  ]\n\narr_result = [ {a =&gt; [1,2] }, \n               {b =&gt; [3,4,10] },\n               {c =&gt; [12,16] },\n               {d =&gt; 7  } ]\n</code></pre>\n\n<p>Deduplicate the keys, and preserve the values of those keys, in arrays, where dedup occurs. Preserve keys/values where deduplication doesnt occur, ( as seen with { d => 7 } in the example )</p>\n"}, {"tags": ["c#", "ruby", "openssl", "3des", "ecb"], "comments": [{"owner": {"reputation": 1081, "user_id": 1288687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7217dd12520210182c093856f60cd376?s=128&d=identicon&r=PG", "display_name": "knugie", "link": "https://stackoverflow.com/users/1288687/knugie"}, "edited": false, "score": 0, "creation_date": 1534973803, "post_id": 51946119, "comment_id": 90901396, "body": "Could you provide both common inputs and different outputs for both methods to help understand what is the expected behaviour? From what I see in the code, PKCS7 is not configured in the Ruby version of your implementation, maybe try specifying padding."}, {"owner": {"reputation": 414, "user_id": 2279377, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c07fb6fadc6a7b844fc0786be159af6f?s=128&d=identicon&r=PG", "display_name": "Rajat Suneja", "link": "https://stackoverflow.com/users/2279377/rajat-suneja"}, "reply_to_user": {"reputation": 1081, "user_id": 1288687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7217dd12520210182c093856f60cd376?s=128&d=identicon&r=PG", "display_name": "knugie", "link": "https://stackoverflow.com/users/1288687/knugie"}, "edited": false, "score": 0, "creation_date": 1535011010, "post_id": 51946119, "comment_id": 90911419, "body": "Common Input - &quot;Hello&quot; C# Output - &quot;7dFl8i/7XvA=&quot; Ruby Output - &quot;yI4i1E49dAQ=&quot;"}, {"owner": {"reputation": 1081, "user_id": 1288687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7217dd12520210182c093856f60cd376?s=128&d=identicon&r=PG", "display_name": "knugie", "link": "https://stackoverflow.com/users/1288687/knugie"}, "edited": false, "score": 0, "creation_date": 1535013917, "post_id": 51946119, "comment_id": 90913016, "body": "Hm, I get <code>&quot;tTTahnSXXW8=&quot;</code> when running your code with <code>data = &quot;Hello&quot;</code> and <code>secret = &quot;******************&quot;</code>. Have you maybe used another secret? Also,  Ruby uses PKCS7 padding by default, so your issue should not be related to that."}, {"owner": {"reputation": 414, "user_id": 2279377, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c07fb6fadc6a7b844fc0786be159af6f?s=128&d=identicon&r=PG", "display_name": "Rajat Suneja", "link": "https://stackoverflow.com/users/2279377/rajat-suneja"}, "reply_to_user": {"reputation": 1081, "user_id": 1288687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7217dd12520210182c093856f60cd376?s=128&d=identicon&r=PG", "display_name": "knugie", "link": "https://stackoverflow.com/users/1288687/knugie"}, "edited": false, "score": 0, "creation_date": 1535015460, "post_id": 51946119, "comment_id": 90913963, "body": "Sorry, correction - Common Input - &quot;Hello&quot; C# Output - &quot;w4yjgRJriP4=&quot; Ruby Output - &quot;tTTahnSXXW8=&quot; . And I know that the C# output is correct."}, {"owner": {"reputation": 1081, "user_id": 1288687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7217dd12520210182c093856f60cd376?s=128&d=identicon&r=PG", "display_name": "knugie", "link": "https://stackoverflow.com/users/1288687/knugie"}, "edited": false, "score": 0, "creation_date": 1535097719, "post_id": 51946119, "comment_id": 90949026, "body": "Ok, I think all configuration looks right. So you will need to do some debugging. I got curious in  <code>Digest::MD5.hexdigest(secret)</code> (<code>&quot;28306617aacbf026bf9a4e0783b50ff9&quot;</code>) vs. <code>hashmd5.ComputeHash(UTF8Encoding.UTF8.GetBytes(secKey))</code> (Could you post this line&#39;s return value here?)"}, {"owner": {"reputation": 1081, "user_id": 1288687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7217dd12520210182c093856f60cd376?s=128&d=identicon&r=PG", "display_name": "knugie", "link": "https://stackoverflow.com/users/1288687/knugie"}, "edited": false, "score": 0, "creation_date": 1535098486, "post_id": 51946119, "comment_id": 90949390, "body": "Ok, I got the C# value... <code>Digest::MD5.hexdigest(secret)</code> is <code>&quot;28306617aacbf026bf9a4e0783b50ff9&quot;</code> (which gives you <code>[50, 56, 51, 48, 54, 54, 49, 55, 97, 97, 99, 98, 102, 48, 50, 54, 98, 102, 57, 97, 52, 101, 48, 55, 56, 51, 98, 53, 48, 102, 102, 57]</code> when calling <code>.bytes.to_a</code>) but <code>hashmd5.ComputeHash(UTF8Encoding.UTF8.GetBytes(secKey))</code> gives you <code>{ 40, 48, 102, 23, 170, 203, 240, 38, 191, 154, 78, 7, 131, 181, 15, 249 }</code>. That looks very different to me. It&#39;s probably worth digging deeper here."}, {"owner": {"reputation": 414, "user_id": 2279377, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c07fb6fadc6a7b844fc0786be159af6f?s=128&d=identicon&r=PG", "display_name": "Rajat Suneja", "link": "https://stackoverflow.com/users/2279377/rajat-suneja"}, "reply_to_user": {"reputation": 1081, "user_id": 1288687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7217dd12520210182c093856f60cd376?s=128&d=identicon&r=PG", "display_name": "knugie", "link": "https://stackoverflow.com/users/1288687/knugie"}, "edited": false, "score": 0, "creation_date": 1535104463, "post_id": 51946119, "comment_id": 90952859, "body": "You are correct about the RUBY Values, but the interesting thing is, doing a BitConverter.ToString on hashmd5.ComputeHash(UTF8Encoding.UTF8.GetBytes(secKey)) gives me - &quot;28-30-66-17-AA-CB-F0-26-BF-9A-4E-07-83-B5-0F-F9&quot; which is same as given by Digest::MD5.hexdigest(secret) in RUBY"}, {"owner": {"reputation": 1081, "user_id": 1288687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7217dd12520210182c093856f60cd376?s=128&d=identicon&r=PG", "display_name": "knugie", "link": "https://stackoverflow.com/users/1288687/knugie"}, "edited": false, "score": 0, "creation_date": 1535205668, "post_id": 51946119, "comment_id": 90986185, "body": "Hm, that&#39;s confusing. I&#39;m afraid I won&#39;t be able to figure this out. Hopefully someone else will be able to help you."}], "owner": {"reputation": 414, "user_id": 2279377, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c07fb6fadc6a7b844fc0786be159af6f?s=128&d=identicon&r=PG", "display_name": "Rajat Suneja", "link": "https://stackoverflow.com/users/2279377/rajat-suneja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 208, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1534880392, "creation_date": 1534845408, "last_edit_date": 1534880392, "question_id": 51946119, "link": "https://stackoverflow.com/questions/51946119/triple-des-ecb-encryption-ruby", "title": "TRIPLE DES ECB Encryption RUBY", "body": "<p>I have a sample code in .NET C# which I need to convert to RUBY.</p>\n\n<pre><code> public static string Encrypt(string pstrText)\n        {\n            byte[] keyArray;\n            byte[] toEncryptArray = UTF8Encoding.UTF8.GetBytes(pstrText);\n                MD5CryptoServiceProvider hashmd5 = new MD5CryptoServiceProvider();\n                keyArray = hashmd5.ComputeHash(UTF8Encoding.UTF8.GetBytes(secKey));\n                hashmd5.Clear();\n            TripleDESCryptoServiceProvider tdes = new TripleDESCryptoServiceProvider();\n            tdes.Key = keyArray;\n            tdes.Mode = CipherMode.ECB;\n            tdes.Padding = PaddingMode.PKCS7;\n            ICryptoTransform cTransform = tdes.CreateEncryptor();\n            byte[] resultArray =cTransform.TransformFinalBlock(toEncryptArray, 0, toEncryptArray.Length);\n            tdes.Clear();\n            return Convert.ToBase64String(resultArray, 0, resultArray.Length);\n        }\n</code></pre>\n\n<p>I have tried using OPENSSL:CIPHER and got thus far -</p>\n\n<pre><code>def encrypt data\nsecret = \"******************\"\nmd5 = Digest::MD5.hexdigest(secret)\ndes = OpenSSL::Cipher::Cipher.new 'DES-EDE3'\ndes.encrypt\ndes.key = md5\nupdate_value = des.update(data)\nup_final = update_value + des.final\nputs Base64.encode64(up_final).gsub(/\\n/, \"\")\nend\n</code></pre>\n\n<p>The results in C# and RUBY do not match. Where am I going wrong?</p>\n"}, {"tags": ["ruby", "vagrant", "virtual-machine"], "answers": [{"tags": [], "owner": {"reputation": 446, "user_id": 8356015, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PaYtW.jpg?s=128&g=1", "display_name": "Ravi Teja Dandu", "link": "https://stackoverflow.com/users/8356015/ravi-teja-dandu"}, "is_accepted": false, "score": 0, "last_activity_date": 1534846244, "last_edit_date": 1534846244, "creation_date": 1534845706, "answer_id": 51946205, "question_id": 51945925, "link": "https://stackoverflow.com/questions/51945925/provisioning-a-vagrantfile-using-json/51946205#51946205", "title": "Provisioning a vagrantfile using json", "body": "<p>If your Vagrantfile is same as pasted above, it looks like this:</p>\n\n<pre><code>require 'json'\nfilej = File.read('info.json')\njinfo = JSON.parse(filej)\nvagrant.configure(\"2\") do |config|\n\n  jinfo.each do |key, value|\n    p key\n    p value\n\n    config.vm.define jinfo['name'] do |js|\n      js.vm.box = jinfo['box']\n      js.vm.network 'private_network', ip: js['ip_addr']\n      js.vm.provider \"virtualbox\" do |vb|\n        vb.cpus = jinfo['vcpu']\n        vb.memory = jinfo['ram']\n      end\n    end\n  end\nend\n</code></pre>\n\n<p><code>jinfo</code> is actually an array and not a hash. You are trying to loop through each key value pair of the json instead of looping through each value. Try this:</p>\n\n<pre><code>require 'json'\nfilej = File.read('info.json')\njinfos = JSON.parse(filej)\nvagrant.configure(\"2\") do |config|\n\n  jinfos.each do |jinfo|\n    p jinfo\n\n    config.vm.define jinfo['name'] do |js|\n      js.vm.box = jinfo['box']\n      js.vm.network 'private_network', ip: js['ip_addr']\n      js.vm.provider \"virtualbox\" do |vb|\n        vb.cpus = jinfo['vcpu']\n        vb.memory = jinfo['ram']\n      end\n    end\n  end\nend\n</code></pre>\n\n<p>I changed the variable names slightly. You can remove the print part altogether and try.</p>\n\n<p>Hope this helped.</p>\n"}], "owner": {"reputation": 1, "user_id": 10175809, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-IwgenzZpPmw/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7oHZMfIDEA1Op1dAPzNpgEj3Fa_Hg/mo/photo.jpg?sz=128", "display_name": "Kai Attewell", "link": "https://stackoverflow.com/users/10175809/kai-attewell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 168, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1534863895, "creation_date": 1534844741, "last_edit_date": 1534863895, "question_id": 51945925, "link": "https://stackoverflow.com/questions/51945925/provisioning-a-vagrantfile-using-json", "title": "Provisioning a vagrantfile using json", "body": "<p>Hey so i want to provision my vagrantfile using json, i have done this with yaml before and tried to follow the syntax alongside a little research on json. I have included print commands to confirm that the values from my json are readable but im struggling in understanding how to put them into my code as values? so my question is how do i call these values within a vagrant file?</p>\n\n<pre><code>require 'json'\nfilej = File.read('info.json')\njinfo = JSON.parse(filej)\nvagrant.configure(\"2\") do |config|\n\n  jinfo.each do |key, value|\n    p key\n    p value\n\n    config.vm.define jinfo['name'] do |js|\n      js.vm.box = jinfo['box']\n      js.vm.network 'private_network', ip: js['ip_addr']\n      js.vm.provider \"virtualbox\" do |vb|\n        vb.cpus = jinfo['vcpu']\n        vb.memory = jinfo['ram']\n      end\n    end\n  end\nend \n</code></pre>\n\n<p>and my json is as follows </p>\n\n<pre><code>[\n  {\n    \"name\": \"jenkins\",\n    \"box\": \"centos/7\",\n    \"ram\": 4096,\n    \"vcpu\": 2,\n    \"ip_addr\": \"192.168.33.11\"\n  },\n  {\n    \"name\": \"server\",\n    \"box\": \"centos/7\",\n    \"ram\": 4096,\n    \"vcpu\": 2,\n    \"ip_addr\": \"192.168.33.10\"\n  }\n]\n</code></pre>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 1436, "user_id": 2096740, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/67b4b0da1074e71906237509810c7eac?s=128&d=identicon&r=PG", "display_name": "arjun", "link": "https://stackoverflow.com/users/2096740/arjun"}, "edited": false, "score": 0, "creation_date": 1534843196, "post_id": 51945362, "comment_id": 90840248, "body": "I believe flowRegion is part of SVG 1.2, not SVG 1.1 which the gem produces."}, {"owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "reply_to_user": {"reputation": 1436, "user_id": 2096740, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/67b4b0da1074e71906237509810c7eac?s=128&d=identicon&r=PG", "display_name": "arjun", "link": "https://stackoverflow.com/users/2096740/arjun"}, "edited": false, "score": 0, "creation_date": 1534844499, "post_id": 51945362, "comment_id": 90840996, "body": "I&#39;m going to export SVG, created with another tool, to eps. Then I will try to embed that eps into pdf with prawn."}], "owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 26, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1534842877, "creation_date": 1534842877, "question_id": 51945362, "link": "https://stackoverflow.com/questions/51945362/how-do-i-produce-mixed-case-svg-elements-like-flowregion-in-victor", "title": "How do I produce mixed case SVG elements like flowRegion in victor", "body": "<p>I am using gem <a href=\"https://github.com/DannyBen/victor\" rel=\"nofollow noreferrer\">https://github.com/DannyBen/victor</a> to generate SVG in ruby. My goal is to reproduce simple Inkscape SVG that flows text into an irregular path. The gem author claims that he has implemented all SVG methods, but I can not find the way to produce mixed case elements like flowRegion. Please help.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "highcharts"], "comments": [{"owner": {"reputation": 2125, "user_id": 1446543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/934816c610f53abdab5f26510478bc24?s=128&d=identicon&r=PG", "display_name": "ForeverZer0", "link": "https://stackoverflow.com/users/1446543/foreverzer0"}, "edited": false, "score": 1, "creation_date": 1534841590, "post_id": 51944713, "comment_id": 90839414, "body": "Do you have a question?"}, {"owner": {"reputation": 37, "user_id": 9527948, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BGxba.jpg?s=128&g=1", "display_name": "Qumber Ali", "link": "https://stackoverflow.com/users/9527948/qumber-ali"}, "reply_to_user": {"reputation": 2125, "user_id": 1446543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/934816c610f53abdab5f26510478bc24?s=128&d=identicon&r=PG", "display_name": "ForeverZer0", "link": "https://stackoverflow.com/users/1446543/foreverzer0"}, "edited": false, "score": 0, "creation_date": 1534843844, "post_id": 51944713, "comment_id": 90840606, "body": "yes dear  how can I show the first point and in equal alignment."}, {"owner": {"reputation": 2125, "user_id": 1446543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/934816c610f53abdab5f26510478bc24?s=128&d=identicon&r=PG", "display_name": "ForeverZer0", "link": "https://stackoverflow.com/users/1446543/foreverzer0"}, "edited": false, "score": 0, "creation_date": 1534843938, "post_id": 51944713, "comment_id": 90840661, "body": "Probably by giving proper coordinates, but can&#39;t help with that since you have no code to show how they are being plotted, hun."}, {"owner": {"reputation": 37, "user_id": 9527948, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BGxba.jpg?s=128&g=1", "display_name": "Qumber Ali", "link": "https://stackoverflow.com/users/9527948/qumber-ali"}, "reply_to_user": {"reputation": 2125, "user_id": 1446543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/934816c610f53abdab5f26510478bc24?s=128&d=identicon&r=PG", "display_name": "ForeverZer0", "link": "https://stackoverflow.com/users/1446543/foreverzer0"}, "edited": false, "score": 0, "creation_date": 1534844870, "post_id": 51944713, "comment_id": 90841210, "body": "ok I can edit my question with little code"}, {"owner": {"reputation": 37, "user_id": 9527948, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BGxba.jpg?s=128&g=1", "display_name": "Qumber Ali", "link": "https://stackoverflow.com/users/9527948/qumber-ali"}, "reply_to_user": {"reputation": 2125, "user_id": 1446543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/934816c610f53abdab5f26510478bc24?s=128&d=identicon&r=PG", "display_name": "ForeverZer0", "link": "https://stackoverflow.com/users/1446543/foreverzer0"}, "edited": false, "score": 0, "creation_date": 1534845018, "post_id": 51944713, "comment_id": 90841296, "body": "Please check I have updated my question with code @ForeverZer0"}, {"owner": {"reputation": 25325, "user_id": 8951377, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2MYqI.jpg?s=128&g=1", "display_name": "ppotaczek", "link": "https://stackoverflow.com/users/8951377/ppotaczek"}, "edited": false, "score": 0, "creation_date": 1534847124, "post_id": 51944713, "comment_id": 90842449, "body": "Hi Qumber Ali, why do you use two xAxis? Everything looks much better with one xAxis: <a href=\"http://jsfiddle.net/BlackLabel/xov9pd67/\" rel=\"nofollow noreferrer\">jsfiddle.net/BlackLabel/xov9pd67</a>"}, {"owner": {"reputation": 37, "user_id": 9527948, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BGxba.jpg?s=128&g=1", "display_name": "Qumber Ali", "link": "https://stackoverflow.com/users/9527948/qumber-ali"}, "edited": false, "score": 0, "creation_date": 1534847409, "post_id": 51944713, "comment_id": 90842647, "body": "Because I&#39;m using prior periods so i need data of this month and also the data of same month of last year. that&#39;s why i need t x axis"}], "answers": [{"tags": [], "owner": {"reputation": 25325, "user_id": 8951377, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2MYqI.jpg?s=128&g=1", "display_name": "ppotaczek", "link": "https://stackoverflow.com/users/8951377/ppotaczek"}, "is_accepted": true, "score": 0, "last_activity_date": 1534852610, "creation_date": 1534852610, "answer_id": 51948137, "question_id": 51944713, "link": "https://stackoverflow.com/questions/51944713/highcharts-tick-point-and-x-axis-point-is-far-from-each-other/51948137#51948137", "title": "Highcharts: Tick point and x axis point is far from each other", "body": "<p>Column series causes another way of rendering xAxis. You need to set <strong>pointPlacement</strong> on the column series to <strong>on</strong>.</p>\n\n<pre><code>series: [{\n    field_name: \"ordered_revenue\",\n    type: \"spline\",\n    name: \"Grouped ordered_revenue\",\n    connectNulls: true,\n    data: [\n        [1531681200000, 566.76],\n        [1531767600000, 604.26],\n        [1531854000000, 742.78],\n        [1531940400000, 545.55],\n        [1532026800000, 252.16],\n        [1532113200000, 468.67],\n        [1532199600000, 426.68]\n    ]\n}, {\n    field_name: \"ordered_revenue\",\n    type: \"column\",\n    pointPlacement: 'on',\n    name: \"Grouped ordered_revenue Prior Priod\",\n    connectNulls: true,\n    xAxis: 1,\n    data: [\n        [1531681200000, 510.61],\n        [1531767600000, 346.74],\n        [1531854000000, 327.57],\n        [1531940400000, 269.34],\n        [1532026800000, 372.34],\n        [1532113200000, 231.38],\n        [1532199600000, 442.09]\n    ]\n}]\n</code></pre>\n\n<p>API Reference: <a href=\"https://api.highcharts.com/highcharts/series.column.pointPlacement\" rel=\"nofollow noreferrer\">https://api.highcharts.com/highcharts/series.column.pointPlacement</a></p>\n\n<p>Live demo: <a href=\"http://jsfiddle.net/BlackLabel/qp3wcgxo/\" rel=\"nofollow noreferrer\">http://jsfiddle.net/BlackLabel/qp3wcgxo/</a></p>\n"}], "owner": {"reputation": 37, "user_id": 9527948, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BGxba.jpg?s=128&g=1", "display_name": "Qumber Ali", "link": "https://stackoverflow.com/users/9527948/qumber-ali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 51948137, "answer_count": 1, "score": -1, "last_activity_date": 1534852610, "creation_date": 1534840507, "last_edit_date": 1534844983, "question_id": 51944713, "link": "https://stackoverflow.com/questions/51944713/highcharts-tick-point-and-x-axis-point-is-far-from-each-other", "title": "Highcharts: Tick point and x axis point is far from each other", "body": "<p>One issue is that the first point of line is at 15th jul but 15th july is not showing on x axis, it shows when you hover on it, and the first point of column is on 8th july. \nSecond issue is both points (of bar and line) have distance, it should be align opposite to each other.<br>\n<a href=\"https://i.stack.imgur.com/10kQw.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/10kQw.png\" alt=\"enter image description here\"></a></p>\n\n<pre><code>$('#container').highcharts({\n\n    chart: {\n        renderTo: 'container'\n    },\n    xAxis: [{\n        type: 'datetime'\n    }, {\n        type: 'datetime'\n\n    }],\n    series: [{field_name: \"ordered_revenue\",   type: \"spline\",   name: \"Grouped ordered_revenue\",   connectNulls: true,   data:     [[1531681200000, 566.76],\n[1531767600000, 604.26],\n[1531854000000, 742.78],\n[1531940400000, 545.55],\n[1532026800000, 252.16],\n[1532113200000, 468.67],\n[1532199600000, 426.68]]},  {field_name: \"ordered_revenue\",   type: \"column\",   name: \"Grouped ordered_revenue Prior Priod\",   connectNulls: true,   xAxis: 1,   data:     [[1531681200000, 510.61],\n[1531767600000, 346.74],\n[1531854000000, 327.57],\n[1531940400000, 269.34],\n[1532026800000, 372.34],\n[1532113200000, 231.38],\n[1532199600000, 442.09]]}]\n\n});\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "wordpress", "integration"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 10131105, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155784755496947/picture?type=large", "display_name": "Juliette Chevalier", "link": "https://stackoverflow.com/users/10131105/juliette-chevalier"}, "edited": false, "score": 0, "creation_date": 1534840009, "post_id": 51944467, "comment_id": 90838642, "body": "Thank you for your answer! Where can I find that file within WordPress?"}, {"owner": {"reputation": 301, "user_id": 1970118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a493fbbd59bf4d36f9cb93c37ec00675?s=128&d=identicon&r=PG", "display_name": "girishso", "link": "https://stackoverflow.com/users/1970118/girishso"}, "reply_to_user": {"reputation": 43, "user_id": 10131105, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155784755496947/picture?type=large", "display_name": "Juliette Chevalier", "link": "https://stackoverflow.com/users/10131105/juliette-chevalier"}, "edited": false, "score": 0, "creation_date": 1534846421, "post_id": 51944467, "comment_id": 90842087, "body": "&gt; Where can I find that file within WordPress?"}, {"owner": {"reputation": 301, "user_id": 1970118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a493fbbd59bf4d36f9cb93c37ec00675?s=128&d=identicon&r=PG", "display_name": "girishso", "link": "https://stackoverflow.com/users/1970118/girishso"}, "reply_to_user": {"reputation": 43, "user_id": 10131105, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155784755496947/picture?type=large", "display_name": "Juliette Chevalier", "link": "https://stackoverflow.com/users/10131105/juliette-chevalier"}, "edited": false, "score": 0, "creation_date": 1534846783, "post_id": 51944467, "comment_id": 90842271, "body": "&gt; Where can I find that file within WordPress?  No idea about wordpress.  Are you hosting Wordpress yourself? If not, other option can be adding a CNAME record to your DNS settings, then you can have subdomain rails-app.client.com point to the rails app."}], "tags": [], "owner": {"reputation": 301, "user_id": 1970118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a493fbbd59bf4d36f9cb93c37ec00675?s=128&d=identicon&r=PG", "display_name": "girishso", "link": "https://stackoverflow.com/users/1970118/girishso"}, "is_accepted": false, "score": 2, "last_activity_date": 1534839534, "creation_date": 1534839534, "answer_id": 51944467, "question_id": 51944416, "link": "https://stackoverflow.com/questions/51944416/integrating-a-rails-app-into-wordpress/51944467#51944467", "title": "Integrating a rails app into WordPress", "body": "<p>In your Apache/Nginx conf, you can add a virtual host with server_name <code>www.client.com/rails-app</code> pointing to your rails-app.</p>\n"}], "owner": {"reputation": 43, "user_id": 10131105, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155784755496947/picture?type=large", "display_name": "Juliette Chevalier", "link": "https://stackoverflow.com/users/10131105/juliette-chevalier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1534839571, "creation_date": 1534839327, "last_edit_date": 1534839571, "question_id": 51944416, "link": "https://stackoverflow.com/questions/51944416/integrating-a-rails-app-into-wordpress", "title": "Integrating a rails app into WordPress", "body": "<p>I have a client with a WordPress static website who wants to integrate the Rails app we have created into their platform so that when they click on a button, they reach the Rails app and the domain looks something like <code>www.client.com/rails-app</code>. I've looked at some plug-ins to integrate it inside the WordPress but most of them seem really outdated. Does anyone have any suggestions on how to do this? </p>\n\n<p>Thank you !! :) </p>\n"}, {"tags": ["ruby", "logstash", "protocol-buffers"], "comments": [{"owner": {"reputation": 3657, "user_id": 523725, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/d9018c516ed0a5ea4aaf4ffbeb9dd2fe?s=128&d=identicon&r=PG", "display_name": "Lobo", "link": "https://stackoverflow.com/users/523725/lobo"}, "edited": false, "score": 2, "creation_date": 1555512437, "post_id": 51943740, "comment_id": 98139445, "body": "Any news on this?"}], "owner": {"reputation": 25, "user_id": 5614517, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed2fbbeaa091893b3c7f12c366d87636?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.sun", "link": "https://stackoverflow.com/users/5614517/mr-sun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 218, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1534836821, "creation_date": 1534836821, "question_id": 51943740, "link": "https://stackoverflow.com/questions/51943740/google-protobuf-undefined-method-msgclass-for-nilnilclass", "title": "Google Protobuf undefined method msgclass&#39; for nil:NilClass", "body": "<p>I use google protobuf in the logstash input,Start error when running logstash\u3002</p>\n\n<blockquote>\n  <p>./bin/logstash -f logstash.conf -r</p>\n</blockquote>\n\n<p>the error is:</p>\n\n<pre><code>[ERROR][logstash.agent ] Failed to execute action {:action=&gt;LogStash::PipelineAction::Create/pipeline_id:main, :exceptio n=&gt;\"NoMethodError\", :message=&gt;\"undefined method msgclass' for nil:NilClass\", :backtrace=&gt;[\"/home/logstash/vendor/bundle/jruby/2.3.0/gems/logstash-codec-pr otobuf-1.1.0/lib/logstash/codecs/protobuf.rb:101:inregister'\", \"/home/logstash/logstash-core/lib/logstash/codecs/base.rb:20:in initialize'\", \"/home/logs tash/logstash-core/lib/logstash/plugins/plugin_factory.rb:97:inplugin'\", \"/home/logstash/logstash-core/lib/logstash/pipeline.rb:110:in plugin'\", \"(eval) :8:in'\", \"org/jruby/RubyKernel.java:994:in eval'\", \"/home/logstash/logstash-core/lib/logstash/pipeline.rb:82:ininitialize'\", \"/home/logstash/log stash-core/lib/logstash/pipeline.rb:167:in initialize'\", \"/home/logstash/logstash-core/lib/logstash/pipeline_action/create.rb:40:inexecute'\", \"/home/log stash/logstash-core/lib/logstash/agent.rb:305:in `block in converge_state'\"]}\n</code></pre>\n\n<p>logstash.conf is setting:</p>\n\n<pre><code>input {\n  beats {\n    port =&gt; 5044\n    ssl =&gt; false\n    codec =&gt; protobuf {\n      class_name =&gt; [\"Elk.ElkData\"]\n      include_path =&gt; [\"/home/logstash/test_code/elk.pb.rb\"]\n      protobuf_version =&gt; 3\n    }\n    type =&gt; \"protobuf\"\n  }\n}\n\noutput {\n  stdout { codec =&gt; rubydebug }\n}\n</code></pre>\n\n<p>the <strong>'register'</strong> in the 'logstash/vendor/bundle/jruby/2.3.0/gems/logstash-codec-protobuf-1.1.0/lib/logstash/codecs/protobuf.rb' is:</p>\n\n<pre><code>def register\n  @metainfo_messageclasses = {}\n  @metainfo_enumclasses = {}\n  @metainfo_pb2_enumlist = []\n  include_path.each { |path| load_protobuf_definition(path) }\n  if @protobuf_version == 3\n    @pb_builder = Google::Protobuf::DescriptorPool.generated_pool.lookup(class_name).msgclass\n  else\n    @pb_builder = pb2_create_instance(class_name)\n  end\nend\n</code></pre>\n\n<p><em>Google::Protobuf::DescriptorPool.generated_pool.lookup(class_name).msgclass</em> </p>\n\n<p>logstash version is 6.3.0, protoc version is 3.6.1, ruby-protoc version is 1.6.1,\nElk community question connection is as follows\uff1a\n<a href=\"https://discuss.elastic.co/t/logstash-uses-protobuf-running-error-nomethoderror-message-undefined-method-msgclass-for-nil-nilclass/144806?u=sun_changlong\" rel=\"nofollow noreferrer\">https://discuss.elastic.co/t/logstash-uses-protobuf-running-error-nomethoderror-message-undefined-method-msgclass-for-nil-nilclass/144806?u=sun_changlong</a></p>\n\n<p>Is it my environmental factor or the protobuf version? Can be used in the protobuf 2 environment.<em>Welcome to leave valuable suggestions</em></p>\n"}, {"tags": ["ruby-on-rails", "ruby", "facebook-graph-api", "instagram-api"], "answers": [{"tags": [], "owner": {"reputation": 1405, "user_id": 7023415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a7f3b4db177eeb60558058e587628f7?s=128&d=identicon&r=PG&f=1", "display_name": "Leo", "link": "https://stackoverflow.com/users/7023415/leo"}, "is_accepted": true, "score": 0, "last_activity_date": 1534834787, "creation_date": 1534834787, "answer_id": 51943234, "question_id": 51943114, "link": "https://stackoverflow.com/questions/51943114/instagram-webhook-for-ruby-on-rails/51943234#51943234", "title": "Instagram Webhook for Ruby on Rails", "body": "<p><a href=\"https://github.com/rest-client/rest-client\" rel=\"nofollow noreferrer\">RestClient</a></p>\n\n<pre><code>require 'rest-client'\n\nresponse = RestClient.post('/instagram')\nresponse.body\n</code></pre>\n\n<p><a href=\"https://ruby-doc.org/stdlib-2.4.2/libdoc/net/http/rdoc/Net/HTTP.html\" rel=\"nofollow noreferrer\">Net::HTTP</a></p>\n\n<pre><code>require 'net/http'\n\nresponse = Net::HTTP.post_form(URI('/instagram'))\nresponse.body\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 8303813, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab27f70b32dc43b21081b545c79b2565?s=128&d=identicon&r=PG&f=1", "display_name": "Subramaniam Chintamani", "link": "https://stackoverflow.com/users/8303813/subramaniam-chintamani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "closed_date": 1534836799, "accepted_answer_id": 51943234, "answer_count": 1, "score": -1, "last_activity_date": 1534834787, "creation_date": 1534834260, "question_id": 51943114, "link": "https://stackoverflow.com/questions/51943114/instagram-webhook-for-ruby-on-rails", "closed_reason": "Duplicate", "title": "Instagram Webhook for Ruby on Rails", "body": "<p>The documentation for webhook is in javascript and i am looking for rails code.</p>\n\n<pre><code>app.post('/instagram', function(req, res) {\n  console.log('Instagram request body:');\n  console.log(req.body);\n  // Process the Instagram updates here\n  received_updates.unshift(req.body);\n  res.sendStatus(200);\n});\n</code></pre>\n\n<p>'req.body', How do i type that in the rails controller?</p>\n\n<p>Here is the link to the entire sample project for webhook.\n<a href=\"https://github.com/fbsamples/graph-api-webhooks-samples/blob/master/heroku/index.js\" rel=\"nofollow noreferrer\">https://github.com/fbsamples/graph-api-webhooks-samples/blob/master/heroku/index.js</a> </p>\n\n<p>I am trying to get the comments in Instagram Media posts.</p>\n"}, {"tags": ["ruby", "docker"], "answers": [{"comments": [{"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 1, "creation_date": 1534830392, "post_id": 51941205, "comment_id": 90834066, "body": "As an additional possibility, in some languages, <code>&#47;[^]&#47;</code> is idiom for Ruby&#39;s <code>&#47;.&#47;m</code> (&quot;match every character except nothing&quot; = &quot;match every character, even newline&quot;). E.g. JavaScript will accept it (even though there is <code>&#47;.&#47;s</code> that matches Ruby&#39;s <code>&#47;.&#47;m</code> semantics)."}, {"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 2, "creation_date": 1534830885, "post_id": 51941205, "comment_id": 90834231, "body": "I think it was <code>&#47;[\\^]+&#47;</code> in the end: OP seems to be using <a href=\"https://github.com/agross/therightstuff.de/blob/93a61318c785ae6ed02c89d865812ee7ecd51642/tools/Ruby/lib/ruby/1.8/jcode.rb#L153\" rel=\"nofollow noreferrer\">this <code>jcode.rb</code></a>, which uses its own <code>_regex_quote</code> function which presumably works well to quote regexps <i>when out of character class</i>, but does not do the right thing inside a character class, like in the linked line, where the quoting requirements are quite different."}, {"owner": {"reputation": 31, "user_id": 9568742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfd25aaef2899697e11ada459bbbdcbe?s=128&d=identicon&r=PG&f=1", "display_name": "Ma.K", "link": "https://stackoverflow.com/users/9568742/ma-k"}, "edited": false, "score": 1, "creation_date": 1534832416, "post_id": 51941205, "comment_id": 90834805, "body": "@user2864740 Thanks for your explanation, it really help me understand the problem. Sorry, I forgot to add the regular expression parts of jcode.rb and del_mark.rb source code,  now I added that, looks like the problem come from there."}, {"owner": {"reputation": 31, "user_id": 9568742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfd25aaef2899697e11ada459bbbdcbe?s=128&d=identicon&r=PG&f=1", "display_name": "Ma.K", "link": "https://stackoverflow.com/users/9568742/ma-k"}, "reply_to_user": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 0, "creation_date": 1534833124, "post_id": 51941205, "comment_id": 90835151, "body": "@Amadan Thank you very much. I&#39;m thinking about what  your said now."}, {"owner": {"reputation": 31, "user_id": 9568742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfd25aaef2899697e11ada459bbbdcbe?s=128&d=identicon&r=PG&f=1", "display_name": "Ma.K", "link": "https://stackoverflow.com/users/9568742/ma-k"}, "edited": false, "score": 1, "creation_date": 1534918251, "post_id": 51941205, "comment_id": 90871680, "body": "@user2864740 Thank your help, follow your instructions, I fix the problem, really appreciate it."}, {"owner": {"reputation": 31, "user_id": 9568742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfd25aaef2899697e11ada459bbbdcbe?s=128&d=identicon&r=PG&f=1", "display_name": "Ma.K", "link": "https://stackoverflow.com/users/9568742/ma-k"}, "reply_to_user": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 1, "creation_date": 1534918268, "post_id": 51941205, "comment_id": 90871686, "body": "@Amadan Thank your help, follow your instructions, I fix the problem, really appreciate it."}], "tags": [], "owner": {"reputation": 53905, "user_id": 2864740, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e7a05a144f218bde07b659bc98e1ca7d?s=128&d=identicon&r=PG&f=1", "display_name": "user2864740", "link": "https://stackoverflow.com/users/2864740/user2864740"}, "is_accepted": true, "score": 3, "last_activity_date": 1534873795, "last_edit_date": 1534873795, "creation_date": 1534822438, "answer_id": 51941205, "question_id": 51941153, "link": "https://stackoverflow.com/questions/51941153/premature-end-of-regular-expression/51941205#51941205", "title": "Premature end of regular expression: /[^]+/", "body": "<p>Don't use <code>/[^]+/</code> as a regular expression: it's invalid.</p>\n\n<p>The Ruby 1.8.x<sup>1</sup> regular expression engine treats <code>[</code> as the <em>start of a character class</em> and thinks that the <code>]</code> and <code>+</code> are characters <em>inside</em> the character class - a treated-as-literal-character <code>]</code> is allowed to follow a <code>^</code>-negation without escape<sup>1</sup>.</p>\n\n<p>Thus the character class is not closed - and a \"premature end\" [of regular expression] error is raised.</p>\n\n<p>The warning above that provides an <em>indicator</em>: \"warning: character class has ]' <em>without</em> escape\" indicating that the <code>]</code> did <em>not</em> close the character class, for the reason stated above.</p>\n\n<p><sup>1</sup> This is \"old Ruby\" rules. Ruby 2+ (maybe even 1.9+?) has <em>different</em> regex rules and raises a \"empty char-class\" error, which is less-magical and less confusing. Now might be a good time to update the Ruby version used..</p>\n\n<hr>\n\n<p>Perhaps a character negation was not desired (<code>/[+^]/</code> or <code>/[\\^]+/</code>)? Or perhaps there were meant to be other characters inside the character class (<code>/[^f]+/</code>)? Or perhaps it was mean to match any single character except a bracket and plus (<code>/[^]+]/</code>; or <code>/[^\\]+]/</code> in Ruby 2+)? Or..</p>\n\n<p>It really depends what the <em>actual</em> intent of the regular expression is.. just have to write it in a valid format.</p>\n"}], "owner": {"reputation": 31, "user_id": 9568742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfd25aaef2899697e11ada459bbbdcbe?s=128&d=identicon&r=PG&f=1", "display_name": "Ma.K", "link": "https://stackoverflow.com/users/9568742/ma-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 336, "favorite_count": 0, "accepted_answer_id": 51941205, "answer_count": 1, "score": 0, "last_activity_date": 1534873795, "creation_date": 1534821948, "last_edit_date": 1534832184, "question_id": 51941153, "link": "https://stackoverflow.com/questions/51941153/premature-end-of-regular-expression", "title": "Premature end of regular expression: /[^]+/", "body": "<p>I am trying to use the NLP tool [hyponymy extraction tool] to deal with some Japanese text files. by the way, I run it on a docker container.</p>\n\n<ul>\n<li>docker OS images: Ubuntu 18.04 </li>\n<li>docker version: 18.06.0-ce</li>\n<li>ruby version: 1.8.7-p375</li>\n<li>rbenv version: 1.1.1-39-g59785f6</li>\n</ul>\n\n<p>jcode.rb</p>\n\n<pre><code>11:def _regex_quote(str)\nstr.gsub(/(\\\\[\\[\\]\\-\\\\])|\\\\(.)|([\\[\\]\\\\])/) do\n  $1 || $2 || '\\\\' + $3\nend\nend\n private :_regex_quote\n151:def delete!(del)\nreturn nil if del == \"\"\nself.gsub!(DeletePatternCache[del] ||= /[#{_regex_quote(del)}]+/, '')\nend\n</code></pre>\n\n<p>del_mark.rb</p>\n\n<pre><code>103:REG_PAREN = /[#{Regexp.quote((PAREN.keys+PAREN.values).join(''))}]/\n    REG_BPAREN = /^([#{Regexp.quote(PAREN.keys.join(''))}])/\n    (main.opts).on('-p','--end-paren','\u5148\u982d\u3068\u672b\u5c3e\u306e\u62ec\u5f27\u306e\u307f\u53d6\u308a\u9664\u304f'){|d|\n      options[:pat] = Array.new if options[:pat] == FULL_SET\n      options[:pat].push(REG_BPAREN)\n    }\n    (main.opts).on('-P','--only-paren','\u62ec\u5f27\u306e\u307f_\u306b\u7f6e\u304d\u63db\u3048'){|d| \n      options[:pat] = Array.new if options[:pat] == FULL_SET\n      PAREN_OUT= '_'\n      options[:pat].push(REG_PAREN)\n   }\n   #(main.opts).on('-d','--date'){\n   #options[:pat].push(REG_DATE)\n   #}\n  (main.opts).on('-r','--remove'){\n    options[:remove]=true\n  }\n\n    main.option\n130:(ARGV+[$stdin]).each{|file|\n    fi = file\n    if file != $stdin\n      fi = open(file)\n    end\n    main.input = fi \n    #puts \"F:#{file}\";\n   138: main.exec{|line|\n      unless line \n        main.is_line_write = false\n        next\n      end\n  163:line.each_char{|char|\n  #puts \"C:#{char}\"\n  165:options[:pat].each{|pat|\n        if pat == REG_BOU || pat == REG_BPAREN\n        elsif pat == REG_PAREN\n          char =char.sub(REG_PAREN,PAREN_OUT)\n        else \n          reg = check_reg(char,pat)\n          if reg\n       # line.delete\n       173:line.delete!(\"#{char}\")\n      # line.delete!(\"#{char[0,1]}\\s?\")\n      # line = line[0..nchar-1] + line[nchar+char.size..line.size-1]\n      # line.delete!(Regexp.quote(char))\n        line.gsub!(reg,'')\n        flag = true\n        break\n      end\n    end\n</code></pre>\n\n<p>Cut.rb</p>\n\n<pre><code>if @is_data_array\n    cd = Array.new\n    @column.each{|c|\n      cd.push(data[c])\n    }\n    func.call(cd)\n  else\n158: @column.each{|c|\n      #puts \"LINE:#{c},#{data[c]}\";\n  160: ret = @negrect_pattern == nil || !(data[c] =~ @negrect_pattern ) ? func.call(data[c]) : negrect(data[c]){|d| func.call(d)} \n      unless ret # if ret is nil\n        is_write = false\n        next\n      end\n      data[c] = ret\n    }\n  endenter code here\n</code></pre>\n\n<p>After I start the tool, an error messages come out:</p>\n\n<pre><code>/root/.rbenv/versions/1.8.7-p375/lib/ruby/1.8/jcode.rb:153: warning: character class has `]' without escape\n/root/.rbenv/versions/1.8.7-p375/lib/ruby/1.8/jcode.rb:153:in `delete!': premature end of regular expression: /[^]+/ (RegexpError)\nfrom /ex-hyponymy-1.0/script/lib/del_mark.rb:173\nfrom /ex-hyponymy-1.0/script/lib/del_mark.rb:165:in `each'\nfrom /ex-hyponymy-1.0/script/lib/del_mark.rb:165\nfrom /root/.rbenv/versions/1.8.7-p375/lib/ruby/1.8/jcode.rb:212:in `each_char'\nfrom /root/.rbenv/versions/1.8.7-p375/lib/ruby/1.8/jcode.rb:211:in `scan'\nfrom /root/.rbenv/versions/1.8.7-p375/lib/ruby/1.8/jcode.rb:211:in `each_char'\nfrom /ex-hyponymy-1.0/script/lib/del_mark.rb:163\nfrom /ex-hyponymy-1.0/script/lib/Cut.rb:160:in `call'\nfrom /ex-hyponymy-1.0/script/lib/Cut.rb:160:in `exec'\nfrom /ex-hyponymy-1.0/script/lib/Cut.rb:158:in `each'\nfrom /ex-hyponymy-1.0/script/lib/Cut.rb:158:in `exec'\nfrom /ex-hyponymy-1.0/script/lib/del_mark.rb:138\nfrom /ex-hyponymy-1.0/script/lib/del_mark.rb:130:in `each'\nfrom /ex-hyponymy-1.0/script/lib/del_mark.rb:130\n</code></pre>\n\n<p>I do not understand the point. I wish someone can help me.</p>\n"}, {"tags": ["javascript", "ruby-on-rails", "ruby", "api", "ruby-on-rails-5"], "comments": [{"owner": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 0, "creation_date": 1534813703, "post_id": 51940272, "comment_id": 90830466, "body": "<i>But when term = params[:search] comes up as nil unless I reload page, the params stay in the browser and then intended result happens.</i> - can you say more about this, please."}, {"owner": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 0, "creation_date": 1534819889, "post_id": 51940272, "comment_id": 90831590, "body": "Try replacing <code>window.history.pushState()</code> with <code>window.location = window.location.href + &#39;?search=&#39; + term;</code>"}], "answers": [{"comments": [{"owner": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 0, "creation_date": 1534819955, "post_id": 51940673, "comment_id": 90831602, "body": "How does <code>format.js</code> fix <code>nil</code> value of <code>params[:search]</code>?"}, {"owner": {"reputation": 533, "user_id": 1478095, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/7326ae0deb2809921bcd3b7348cf441e?s=128&d=identicon&r=PG", "display_name": "crazy_phage", "link": "https://stackoverflow.com/users/1478095/crazy-phage"}, "reply_to_user": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 0, "creation_date": 1534821473, "post_id": 51940673, "comment_id": 90831906, "body": "@JagdeepSingh I read the problem again, and I found your might have two problems in this simple action. Use Unobtrusive JavaScript can help your walkthrough the Rails Ajax part."}, {"owner": {"reputation": 27, "user_id": 3499671, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uos2y.png?s=128&g=1", "display_name": "Jumping Jack", "link": "https://stackoverflow.com/users/3499671/jumping-jack"}, "reply_to_user": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 0, "creation_date": 1535325524, "post_id": 51940673, "comment_id": 91012349, "body": "@JagdeepSingh I was able to resolve the <code>nil</code> issue by creating a custom action in my controller and it was able to get the search query from <code>params[:search]</code>. Thanks for introducing me to the concept of unobtrusive JS and the <code>respond_to</code> method. I was able to get rid of the <code>appendParamToUrl</code> function I had in my table.js file as suggested. Thanks everyone for getting me through this issue."}], "tags": [], "owner": {"reputation": 533, "user_id": 1478095, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/7326ae0deb2809921bcd3b7348cf441e?s=128&d=identicon&r=PG", "display_name": "crazy_phage", "link": "https://stackoverflow.com/users/1478095/crazy-phage"}, "is_accepted": true, "score": 0, "last_activity_date": 1534821362, "last_edit_date": 1534821362, "creation_date": 1534817435, "answer_id": 51940673, "question_id": 51940272, "link": "https://stackoverflow.com/questions/51940272/retrieve-user-input-from-browser-to-use-in-controller-for-a-third-party-query-st/51940673#51940673", "title": "Retrieve user input from browser to use in controller for a third party query string rails", "body": "<p>The problem is you are trying to retrieve <code>term = params[:search]</code> in your controller which will get value from the <code>form_tag</code> part since this is a remote form, you need to setup something like below:</p>\n\n<pre><code>respond_to do |format|\n  format.js {}\nend\n</code></pre>\n\n<p>And you can append desired data to your table in this <code>home.js.erb</code> file now. You don't need to write a JavaScript function like <code>appendParamToUrl</code>.    </p>\n\n<p>See <a href=\"https://guides.rubyonrails.org/working_with_javascript_in_rails.html#unobtrusive-javascript\" rel=\"nofollow noreferrer\">2 Unobtrusive JavaScript</a></p>\n\n<p>---UPDATE---\n<code>&lt;%= text_field_tag :search, params[:search] %&gt;</code> This line will get the value in url when page load, so the first time, params[:search] is nil. And when you hit the submit button, the server will get confused, because you have two params[:search], one is in url, and another is text_field_tag.<br>\nYou need to determine which one you need to get first.<br>\nHow about change search to query in url then you can inspect both param[:query] and param[:search] in your controller, I am sure one of them has a non-nil value.</p>\n"}], "owner": {"reputation": 27, "user_id": 3499671, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uos2y.png?s=128&g=1", "display_name": "Jumping Jack", "link": "https://stackoverflow.com/users/3499671/jumping-jack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 51940673, "answer_count": 1, "score": 0, "last_activity_date": 1534821362, "creation_date": 1534813320, "question_id": 51940272, "link": "https://stackoverflow.com/questions/51940272/retrieve-user-input-from-browser-to-use-in-controller-for-a-third-party-query-st", "title": "Retrieve user input from browser to use in controller for a third party query string rails", "body": "<p>I'm simply trying to get a users input into my rails controller from my <code>form_tag</code>. </p>\n\n<p>the general idea is a user enters some text in the <code>text_field_tag</code></p>\n\n<p><strong><em>app/views/pages/home.html.erb</em></strong></p>\n\n<pre><code>&lt;div&gt;\n   &lt;%= form_tag root_path, method: :get, remote: true do %&gt;\n      &lt;%= text_field_tag :search, params[:search] %&gt;\n      &lt;%= submit_tag 'Search', name: nil, class: 'submit' %&gt;\n   &lt;% end %&gt;\n&lt;/div&gt;\n</code></pre>\n\n<p>I have some JavaScript in place to take the params and append them to the current\nurl in the browser.</p>\n\n<p><strong><em>/main/app/assets/javascript/table.js</em></strong></p>\n\n<pre><code>function appendParamToUrl() {\n   var pages = '';\n   var term = $('#search').val();\n   window.history.pushState( pages, 'url', '?search=' + term );\n}\n</code></pre>\n\n<p>I then try to retrieve those params from the rails controller to add to a query string to make an api call to a third party.</p>\n\n<pre><code>def home\n        term = params[:search]\n        @stats = HTTParty.get(\"https://api.ritekit.com/v1/stats/history/#{term}?tags=&amp;client_id=81c7fa4e99adc98e9455c86ee38a4c1bbe3f97328732\")\n        gon.queries = @stats\nend\n</code></pre>\n\n<p>Rails console show the correct params</p>\n\n<pre><code>Started GET \"/?utf8=%E2%9C%93&amp;search=trump\" for 148.75.220.61 at 2018-08-21 00:28:49 +0000\nCannot render console from 148.75.220.61! Allowed networks: 127.0.0.1, ::1, 127.0.0.0/127.255.255.255\nProcessing by PagesController#home as JS\n  Parameters: {\"utf8\"=&gt;\"\u2713\", \"search\"=&gt;\"trump\"}\n  User Load (0.6ms)  SELECT  \"users\".* FROM \"users\" WHERE \"users\".\"id\" = $1 ORDER BY \"users\".\"id\" ASC LIMIT $2  [[\"id\", 1], [\"LIMIT\", 1]]\n  Rendering pages/home.html.erb within layouts/application\n  Rendered pages/home.html.erb within layouts/application (1.2ms)\n  Rendered shared/_nav.html.erb (0.8ms)\nCompleted 200 OK in 1182ms (Views: 71.4ms | ActiveRecord: 0.6ms)\n</code></pre>\n\n<p>But when <code>term = params[:search]</code> comes up as <code>nil</code> unless I reload page, the params stay in the browser and then intended result happens. The data retrieved is used to populate a datatable I have setup.</p>\n\n<p>any help would be greatly appreciated.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "regex"], "comments": [{"owner": {"reputation": 5292, "user_id": 2727267, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0e7c773908a4f6095f63cb9553bbc7af?s=128&d=identicon&r=PG", "display_name": "Beartech", "link": "https://stackoverflow.com/users/2727267/beartech"}, "edited": false, "score": 0, "creation_date": 1534816476, "post_id": 51940041, "comment_id": 90830942, "body": "A regex has to be evaluated. Where is the evaluation happening? Imagine you put that regex directly into application.rb, would it do anything? Also This would only be evaluated when Rails is first run, at least in production. Can you explain why you want a regex? What are you trying to accomplish?"}, {"owner": {"reputation": 314, "user_id": 6637390, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/fDP1p.jpg?s=128&g=1", "display_name": "rail_engine", "link": "https://stackoverflow.com/users/6637390/rail-engine"}, "reply_to_user": {"reputation": 5292, "user_id": 2727267, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0e7c773908a4f6095f63cb9553bbc7af?s=128&d=identicon&r=PG", "display_name": "Beartech", "link": "https://stackoverflow.com/users/2727267/beartech"}, "edited": false, "score": 0, "creation_date": 1534820814, "post_id": 51940041, "comment_id": 90831765, "body": "@Beartech thanks for the reply the situation is that i am using cors and i have subdomain coz i am using multitenancy (apartment gem) so in the configuration, for different environments, I need to pass subdomain as the wild card"}], "answers": [{"tags": [], "owner": {"reputation": 1405, "user_id": 7023415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a7f3b4db177eeb60558058e587628f7?s=128&d=identicon&r=PG&f=1", "display_name": "Leo", "link": "https://stackoverflow.com/users/7023415/leo"}, "is_accepted": false, "score": 1, "last_activity_date": 1534829285, "creation_date": 1534829285, "answer_id": 51942103, "question_id": 51940041, "link": "https://stackoverflow.com/questions/51940041/use-regex-in-application-yml/51942103#51942103", "title": "Use Regex in application.yml", "body": "<p><code>ENV['origin']</code> look like you want to use an environment variable. So, ENV would better than YML for that.</p>\n\n<pre><code>#Gemfile\ngem 'dotenv-rails'\n\n#.env\norigin = '^(.*\\.|)example\\.com$/'\n\n#application.rb\n...\norigins ENV['origin']\n...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 50175, "user_id": 1307905, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a38a4f5f180194ac457cdc057f1be6e3?s=128&d=identicon&r=PG", "display_name": "Anthon", "link": "https://stackoverflow.com/users/1307905/anthon"}, "edited": false, "score": 0, "creation_date": 1534883029, "post_id": 51951905, "comment_id": 90862948, "body": "&quot;YAML can handle transformation...&quot; No YAML cannot do so. Your ruby parser can instantiate ruby objects or function based on the <code>!ruby&#47;...</code> tag and hand the tagged node as parameter to the object or function instantiation possible resulting in a transformed node. That is 99% ruby, 1% parser and 0% YAML, as the latter doesn&#39;t know anything about what could happen by a tagged object (a  tag <code>!ruby</code> only appears, once, as an example of how a node  <i>could</i> be mapped to a native data structure, in the specification.)"}, {"owner": {"reputation": 50175, "user_id": 1307905, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a38a4f5f180194ac457cdc057f1be6e3?s=128&d=identicon&r=PG", "display_name": "Anthon", "link": "https://stackoverflow.com/users/1307905/anthon"}, "edited": false, "score": 0, "creation_date": 1534883512, "post_id": 51951905, "comment_id": 90863174, "body": "With Python (with which YAML parser I am more familiar) you can essentially always thinly wrap something (regex or else), in such a way that your wrapper gets the information from the parser if a node is tagged <code>!wrapper</code> and then hand it to wrapped function in any specific way the function expects. I assume you can do the same in Ruby. I"}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "reply_to_user": {"reputation": 50175, "user_id": 1307905, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a38a4f5f180194ac457cdc057f1be6e3?s=128&d=identicon&r=PG", "display_name": "Anthon", "link": "https://stackoverflow.com/users/1307905/anthon"}, "edited": false, "score": 0, "creation_date": 1534883733, "post_id": 51951905, "comment_id": 90863263, "body": "@Anthon unfortunately I am far less familiar with <code>python</code> but if you were to provide some kind of an example I am certain i could implement the same in <code>ruby</code> however I feel this sufficiently answers the question posed (<i>&quot;is there a way I can write regex in aplication.yml&quot;</i>)"}], "tags": [], "owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "is_accepted": false, "score": 1, "last_activity_date": 1534884374, "last_edit_date": 1534884374, "creation_date": 1534864767, "answer_id": 51951905, "question_id": 51940041, "link": "https://stackoverflow.com/questions/51940041/use-regex-in-application-yml/51951905#51951905", "title": "Use Regex in application.yml", "body": "<p><code>Psych</code> (&lt;= 1.9 <code>Syck</code>) ruby's native <code>YAML</code> parser can handle transformation of certain ruby objects given they are notated correctly e.g. </p>\n\n<pre><code>origin: !ruby/regexp /^(.*\\\\.|)example\\\\.com$/ \n</code></pre>\n\n<p>converts to a true <code>Regexp</code> on load. </p>\n\n<pre><code>require 'yaml'\n\nyml = &lt;&lt;-YML\n  origin: !ruby/regexp /^(.*\\\\.|)example\\\\.com$/\nYML\n\nh = YAML.load(yml)\n#=&gt; {\"origin\"=&gt;/^(.*\\.|)example\\.com$/}\n\n'test.example.com'.match?(h[\"origin\"])\n#=&gt; true\n</code></pre>\n\n<p>In order to determine the appropriate syntax one can use <code>YAML.dump</code> e.g. </p>\n\n<pre><code>YAML.dump(/^(.*\\.|)example\\.com$/)\n#=&gt; \"--- !ruby/regexp /^(.*\\\\.|)example\\\\.com$/\\n...\\n\"\n</code></pre>\n\n<p><strong>Please note this only works for certain objects that can be appropriately converted to and from <code>YAML</code> values</strong></p>\n\n<p>Additionally the <code>Regexp</code> class can convert strings into <code>Regexp</code> objects so the following will also work</p>\n\n<pre><code>require 'yaml'\n\n# note we omit the forward slashes \nyml = &lt;&lt;-YML\n  origin: ^(.*\\\\.|)example\\\\.com$\nYML\n\nh = YAML.load(yml)\n#=&gt; {\"origin\"=&gt;\"^(.*\\\\.|)example\\\\.com$\"\n\n'test.example.com'.match?(Regexp.new(h[\"origin\"])) \n#=&gt; true\n</code></pre>\n"}], "owner": {"reputation": 314, "user_id": 6637390, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/fDP1p.jpg?s=128&g=1", "display_name": "rail_engine", "link": "https://stackoverflow.com/users/6637390/rail-engine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3319, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1534884374, "creation_date": 1534810768, "question_id": 51940041, "link": "https://stackoverflow.com/questions/51940041/use-regex-in-application-yml", "title": "Use Regex in application.yml", "body": "<p>is there a way I can write regex in <strong>aplication.yml</strong></p>\n\n<pre><code>origin: '^(.*\\.|)example\\.com$/'\n</code></pre>\n\n<p>~> something like this\nand call it in config <strong>application.rb</strong></p>\n\n<pre><code>Rails.application.config.middleware.insert_before 0, Rack::Cors do\n        allow do\n            origins ENV['origin']\n            debugger\n            resource '*',\n                     headers: :any,\n                     methods: [:get, :post, :put, :patch, :delete, :options, :head]\n        end\n    end\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "search", "model-view-controller", "parameters"], "answers": [{"comments": [{"owner": {"reputation": 1512, "user_id": 5513336, "user_type": "registered", "accept_rate": 16, "profile_image": "https://i.stack.imgur.com/bc7pn.jpg?s=128&g=1", "display_name": "Leia_Organa", "link": "https://stackoverflow.com/users/5513336/leia-organa"}, "edited": false, "score": 0, "creation_date": 1534814268, "post_id": 51939987, "comment_id": 90830573, "body": "Thanks for the comment! I&#39;m actually trying to do just what you suggested...I&#39;m trying to reference the author&#39;s name directly through the Book&#39;s association with author_id. Any suggestions for doing it through that?"}, {"owner": {"reputation": 61, "user_id": 6026888, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wElia.jpg?s=128&g=1", "display_name": "Harry Tucker", "link": "https://stackoverflow.com/users/6026888/harry-tucker"}, "reply_to_user": {"reputation": 1512, "user_id": 5513336, "user_type": "registered", "accept_rate": 16, "profile_image": "https://i.stack.imgur.com/bc7pn.jpg?s=128&g=1", "display_name": "Leia_Organa", "link": "https://stackoverflow.com/users/5513336/leia-organa"}, "edited": false, "score": 0, "creation_date": 1534889680, "post_id": 51939987, "comment_id": 90865336, "body": "When trying to access data from a related table, you need to use a join query between the two tables in order to find the right records. This answer here (<a href=\"https://stackoverflow.com/a/22970800/6026888\">stackoverflow.com/a/22970800/6026888</a>) shows a join query being used in a simple example. This essentially makes a theoretical table where books and author information is stored, and you can search through that to return books based on the author."}], "tags": [], "owner": {"reputation": 61, "user_id": 6026888, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wElia.jpg?s=128&g=1", "display_name": "Harry Tucker", "link": "https://stackoverflow.com/users/6026888/harry-tucker"}, "is_accepted": false, "score": 0, "last_activity_date": 1534813263, "last_edit_date": 1534813263, "creation_date": 1534810234, "answer_id": 51939987, "question_id": 51939922, "link": "https://stackoverflow.com/questions/51939922/rails-search-by-params-not-working-issue-with-associations/51939987#51939987", "title": "Rails: Search by params not working -- issue with associations?", "body": "<p>Take a look at your search method in <code>models/book.rb</code>:</p>\n\n<pre><code>def self.search(search)\n    where(\"book.author.name LIKE ?\", \"%#{search}%\") \nend\n</code></pre>\n\n<p>Since you're searching the book model, you've got the column name wrong, you're after <code>book.author_name</code>, not <code>book.author.name</code>.</p>\n\n<p>Try the following:</p>\n\n<pre><code>def self.search(search)\n    where(\"book.author_name LIKE ?\", \"%#{search}%\") \nend\n</code></pre>\n\n<p>You may also want to consider having a look at your database design as you store the author's name in multiple tables. It'd be a good idea to normalise your database design further by just referencing the author ID in the book model, then keeping the author name in the author model.</p>\n"}, {"tags": [], "owner": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "is_accepted": false, "score": 0, "last_activity_date": 1534820968, "creation_date": 1534820968, "answer_id": 51941039, "question_id": 51939922, "link": "https://stackoverflow.com/questions/51939922/rails-search-by-params-not-working-issue-with-associations/51941039#51941039", "title": "Rails: Search by params not working -- issue with associations?", "body": "<p>There are a couple of issues that I found in your code. May be, fixing them would solve the error for you.</p>\n\n<h3>Association in model Book</h3>\n\n<p>You have a correctly defined association in model <code>Author</code> that is has many books. The inverse of it should be defined as <a href=\"https://guides.rubyonrails.org/association_basics.html#belongs-to-association-reference\" rel=\"nofollow noreferrer\"><code>belongs_to</code></a>, and not <code>has_one</code>. Change it to following:</p>\n\n<pre><code>class Book &lt; ApplicationRecord\n  belongs_to :author\nend\n</code></pre>\n\n<h3>Redundant/Unused column in books table</h3>\n\n<p>As per your database schema, you have a column <em>author_name</em> in <em>books</em> table. But, instead of fetching its value directly, you have defined your own getter method <code>author_name</code>, which returns <code>author.name</code>. So, if you really want to have the column there in <em>books</em> table, remove the custom method <code>author_name</code> from model.</p>\n\n<pre><code>class Book &lt; ApplicationRecord\n  # def author_name\n  #   self.author.name\n  # end\nend\n</code></pre>\n\n<h3>Searching</h3>\n\n<p>The error you see is because there is no table <em>book</em> (singular). Change your <code>search</code> method to as below and it should work:</p>\n\n<pre><code>def self.search(search)\n  where(\"author_name LIKE ?\", \"%#{search}%\") \nend\n</code></pre>\n\n<p><strong>Note:</strong> This solution assumes you kept the column <em>author_name</em> intentionally in table <em>books</em>. I will recommend dropping the column <em>author_name</em> though and search for <em>name</em> in associated <code>authors</code> table.</p>\n"}, {"tags": [], "owner": {"reputation": 446, "user_id": 8356015, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PaYtW.jpg?s=128&g=1", "display_name": "Ravi Teja Dandu", "link": "https://stackoverflow.com/users/8356015/ravi-teja-dandu"}, "is_accepted": false, "score": 0, "last_activity_date": 1534835655, "creation_date": 1534835655, "answer_id": 51943436, "question_id": 51939922, "link": "https://stackoverflow.com/questions/51939922/rails-search-by-params-not-working-issue-with-associations/51943436#51943436", "title": "Rails: Search by params not working -- issue with associations?", "body": "<p>Couple of changes in your code:</p>\n\n<p><strong>1. Relation inside Book model</strong></p>\n\n<p>It should be <code>belongs_to :author</code> instead of <code>has_one :author</code> .</p>\n\n<p><strong>2. Modify search block</strong></p>\n\n<p>Remove the redundant author_name method from the Book model.</p>\n\n<p>The search part can be done in two ways:</p>\n\n<ul>\n<li>With author_name column inside books table.</li>\n<li>Without author_name column inside books table since it is already present in the author record.</li>\n</ul>\n\n<p>For first case simple modify you search method as follow:</p>\n\n<pre><code>def self.search(search)\n  where(\"author_name LIKE ?\", \"%#{search}%\") \nend\n</code></pre>\n\n<p>Better to add an index on author_name.</p>\n\n<p>For second case, remove the author_name column from books table and modify the code as follows:</p>\n\n<pre><code>def self.search(search)\n  author_ids = Author.where(\"name LIKE ?\", \"%#{search}%\").ids\n  where(author_id: author_ids)\nend\n</code></pre>\n\n<p>Again, better to add an index on author_name inside authors table.</p>\n\n<p>Another suggestion, do case insensitive search to improve searches as follows:</p>\n\n<pre><code>where(\"lower(author_name) LIKE ?\", \"%#{search.downcase}%\")\n</code></pre>\n\n<p>Hope this helps.</p>\n"}], "owner": {"reputation": 1512, "user_id": 5513336, "user_type": "registered", "accept_rate": 16, "profile_image": "https://i.stack.imgur.com/bc7pn.jpg?s=128&g=1", "display_name": "Leia_Organa", "link": "https://stackoverflow.com/users/5513336/leia-organa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 219, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1534835655, "creation_date": 1534809639, "last_edit_date": 1534820299, "question_id": 51939922, "link": "https://stackoverflow.com/questions/51939922/rails-search-by-params-not-working-issue-with-associations", "title": "Rails: Search by params not working -- issue with associations?", "body": "<p>I am building a Rails application which allows users to search for Books by Author's name. I am having some problems building the search function, but to my knowledge, I felt that I was doing things exactly right?</p>\n\n<p>Here is what I am starting with:\nschema.rb</p>\n\n<pre><code>ActiveRecord::Schema.define do\n  create_table \"books\", force: :cascade do |t|\n    t.string   \"title\"\n    t.integer  \"author_id\"\n    t.string   \"author_name\"\n    t.index [\"title\"], name: \"index_books_on_title\", unique: true\n  end\n\n  create_table \"authors\", force: :cascade do |t|\n    t.string   \"name\"\n    t.string   \"bio\"\n  end\nend\n</code></pre>\n\n<p>Here are my sample data in seeds.rb</p>\n\n<pre><code>books = [\n          {title:\"Ruby Programming\", author_id: 1, author_name: \"John Smith\"},\n          {title:\"Java Programming\", author_id: 2 , author_name: \"Jane Adams\"},\n          {title:\"PHP Programming\", author_id: 3, author_name: \"Mike Jones\"},\n          {title:\"Python Programming\", author_id: 1, author_name: \"John Smith\"}\n        ]\n\nauthors = [\n            {name:\"John Smith\", bio: \"John Smith loves Ruby and Python\"},\n            {name:\"Jane Adams\", bio: \"Jane Adams loves Java\"},\n            {name:\"Mike Jones\", bio: \"Mike Jones loves PHP\"}\n          ]\n</code></pre>\n\n<p>Here is my books_controller.rb</p>\n\n<pre><code>class BooksController &lt; ApplicationController\n  def index\n    @books = Books.all\n    if params[:search]\n      @books = Book.search(params[:search]).order(\"created_at DESC\")\n    else\n      @books = Book.all.order(\"created_at DESC\")\n    end\n  end    \nend\n</code></pre>\n\n<p>Here is my models/book.rb. Here is where I'm defining the search function.</p>\n\n<pre><code>class Book &lt; ApplicationRecord\n  has_one :author\n\n  def author_name\n    self.author.name\n  end\n\n  def self.search(search)\n    where(\"book.author.name LIKE ?\", \"%#{search}%\") \n  end\nend\n</code></pre>\n\n<p>And here is my models/author.rb</p>\n\n<pre><code>class Author &lt; ApplicationRecord\n  has_many :books\nend\n</code></pre>\n\n<p>Here is where the user is able to search for books by author name, in views/books/index.html.erb</p>\n\n<pre><code>&lt;h3&gt; Search by author &lt;/h3&gt;\n\n&lt;%= form_tag(books_path, :method =&gt; \"get\") do %&gt;\n  &lt;%= text_field_tag :search, params[:search], placeholder: \"Search by Author\" %&gt;\n  &lt;%= submit_tag \"Search\", :name =&gt; nil %&gt;\n&lt;% end %&gt;\n\n&lt;ul&gt;\n  &lt;% @books.each do |book| %&gt;\n    &lt;li&gt;\n     &lt;%= link_to book.title book_path(book) %&gt;          \n    &lt;/li&gt;\n  &lt;% end %&gt;\n&lt;/ul&gt;\n</code></pre>\n\n<p>However, when I type in an author (using the example \"John Smith\"), I keep on getting an error:</p>\n\n<pre><code>SQLite3::SQLException: no such column: book.author.name: SELECT \"books\".* FROM \"books\" WHERE (book.author.name LIKE '%John Smith%') ORDER BY created_at DESC\n</code></pre>\n\n<p>I suspect that in models/book.rb, I am not defining the search function correctly. Does anyone have any suggestion for what might be incorrect?</p>\n"}, {"tags": ["ruby", "nokogiri"], "comments": [{"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 3, "creation_date": 1534810426, "post_id": 51939914, "comment_id": 90829909, "body": "Instead of an array of hashes, have you considered constructing a hash <code>h</code> whose keys are  the (unique) id&#39;s and whose values are hashes such as <code>{ occurrence: 1, className: node[&quot;class&quot;] }</code>? That way, for each new <code>id</code> (say<code>3</code>), you could execute <code>h.key?(3)</code>. If <code>false</code>, add a new key/value pair, <code>h[3] = { occurrences: 3, className: ??? }</code>. if <code>true</code>, <code>update: h[3][:occurrence] += 1</code>."}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "reply_to_user": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 1, "creation_date": 1534811518, "post_id": 51939914, "comment_id": 90830110, "body": "@CarySwoveland And then mangle it into an array-of-hashes at the end if that&#39;s the structure that&#39;s really needed."}, {"owner": {"reputation": 47, "user_id": 10107914, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cf0f4c9f2a0ad737d8ce84d59c4fe86?s=128&d=identicon&r=PG&f=1", "display_name": "Chick Evans", "link": "https://stackoverflow.com/users/10107914/chick-evans"}, "reply_to_user": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1534814695, "post_id": 51939914, "comment_id": 90830657, "body": "@CarySwoveland Ah yes I see. This is a good implementation thank you."}, {"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 0, "creation_date": 1534815832, "post_id": 51939914, "comment_id": 90830829, "body": "Also, are you implementing your own BFS? Because you don&#39;t have to - let Nokogiri worry about searching. <code>doc.css(&#39;[class]&#39;.each do |element_with_class| ... end</code>. Also, you&#39;ll have much better luck with classes themselves being IDs for the hash - that way you can very quickly find if you have it already or not."}, {"owner": {"reputation": 121, "user_id": 7761730, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/116db9689fd5a178db1890da61b26269?s=128&d=identicon&r=PG&f=1", "display_name": "Harish", "link": "https://stackoverflow.com/users/7761730/harish"}, "edited": false, "score": 0, "creation_date": 1534834256, "post_id": 51939914, "comment_id": 90835705, "body": "If you have declaring an empty array you can use <code>push</code> operation to add new hash to it. <code>hashArray.push(new_hash)</code>"}, {"owner": {"reputation": 47, "user_id": 10107914, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cf0f4c9f2a0ad737d8ce84d59c4fe86?s=128&d=identicon&r=PG&f=1", "display_name": "Chick Evans", "link": "https://stackoverflow.com/users/10107914/chick-evans"}, "reply_to_user": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1534864889, "post_id": 51939914, "comment_id": 90854096, "body": "@CarySwoveland How can you update the hash conditionally? Like say: h.map{|key| if key[:occurrence] &gt; 2 then key[:occurrence] += 1 end}. I know this syntax doesn&#39;t work."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1534871052, "post_id": 51939914, "comment_id": 90857444, "body": "<code>h.map { |key|  ...</code> will only allow you to modify the values of existing keys. When you identify an attribute <code>att</code> from a website it may or may not be a key of <code>h</code>. That&#39;s when you execute <code>if h.key?(att) h[att] += 1 else h[k] = {occurrences: 1, className: ??? }; end</code>. Note that in my comment above I wrote <code>h[k] = {occurrences: 3, className: ??? }</code>. That (which I copied and pasted) was in error in that <code>occurrences</code> should be initialized to <code>1</code> for new keys."}], "answers": [{"tags": [], "owner": {"reputation": 1081, "user_id": 1288687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7217dd12520210182c093856f60cd376?s=128&d=identicon&r=PG", "display_name": "knugie", "link": "https://stackoverflow.com/users/1288687/knugie"}, "is_accepted": false, "score": 0, "last_activity_date": 1535237596, "last_edit_date": 1535237596, "creation_date": 1534891708, "answer_id": 51957704, "question_id": 51939914, "link": "https://stackoverflow.com/questions/51939914/adding-hashes-dynamically-to-an-empty-array/51957704#51957704", "title": "Adding Hashes Dynamically to an Empty Array", "body": "<p>I see that both ids and classNames are unique, if you use <code>classNames</code> as identifier, you might not need to add an additional <code>id</code>. Here is an approach that should work like you described:</p>\n\n<pre><code># Initialise a Hash which values default to 0 (instead of nil)\noccurrences = Hash.new(0)\n\n# Example:\n# occurrences['foo'] # =&gt; 0\n# occurrences        # =&gt; {}\n\n\n# For all relevant nodes, count occurrences of their class names\noccurrences[node[\"class\"]] += 1\n\n# Example:\n# occurrences['bar'] += 1 # =&gt; 1\n# occurrences['bar'] += 1 # =&gt; 2\n# occurrences['foo'] += 1 # =&gt; 1\n# occurrences             # =&gt; {\"bar\"=&gt;2, \"foo\"=&gt;1}\n\n\n# Add ids and format array, where ids are the index of the element\noccurrences.map.with_index do |list, id|\n  {id: id, occurence: list.last, className: list.first}\nend\n\n# Example:\n# =&gt; [{:id=&gt;0, :occurence=&gt;2, :className=&gt;\"bar\"}, {:id=&gt;1, :occurence=&gt;1, :className=&gt;\"foo\"}]\n</code></pre>\n\n<p>I hope you find that helpful.</p>\n"}], "owner": {"reputation": 47, "user_id": 10107914, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cf0f4c9f2a0ad737d8ce84d59c4fe86?s=128&d=identicon&r=PG&f=1", "display_name": "Chick Evans", "link": "https://stackoverflow.com/users/10107914/chick-evans"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1535237596, "creation_date": 1534809569, "question_id": 51939914, "link": "https://stackoverflow.com/questions/51939914/adding-hashes-dynamically-to-an-empty-array", "title": "Adding Hashes Dynamically to an Empty Array", "body": "<p>I want to use Nokogiri to count the occurrences of different class attributes that appear on a website. To do this I am implementing a breadth-first search and every time I encounter a new class attribute I want to store it in a hash with a unique ID. And every that same class attribute is encountered I want to find that same hash and increment its occurrence key. </p>\n\n<p>I am attempting to store all these hashes in an array: </p>\n\n<pre><code>hashArray = []\n\nnew hash = {\n  id: uniqueID,\n  occurrence: 1,\n  className: node[\"class\"]\n}\n</code></pre>\n\n<p>Ideally, I would have something like this at some point:</p>\n\n<pre><code>  array = [\n  {id: 1, occurrences: 3, className: 'wrapper'},\n  {id: 2, occurrences: 5, className: 'media'}\n  ]\n</code></pre>\n\n<p>How can I initialize a new hash to add to the array everytime my search encounters a new class? </p>\n\n<p>I tried this:</p>\n\n<pre><code>hashArray &lt;&lt; {id: uniqueID, occurrence: 1, className: node[\"class\"]}\n</code></pre>\n\n<p>but this method leads to the array only holding one hash at a time.</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 0, "creation_date": 1534810817, "post_id": 51939845, "comment_id": 90829989, "body": "Is your <code>p</code> variable a Hash object?"}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 2, "creation_date": 1534811640, "post_id": 51939845, "comment_id": 90830131, "body": "<code>{&#39;x&#39;: 1534804991, &#39;y&#39;: 0.1}</code> isn&#39;t JSON, JSON would use double quotes on the keys. Do you have JSON or a JavaScript object literal that may or may not be valid JSON?"}, {"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 2, "creation_date": 1534819083, "post_id": 51939845, "comment_id": 90831445, "body": "This looks like an XY-problem."}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 1, "creation_date": 1534832524, "post_id": 51939845, "comment_id": 90834838, "body": "How does your JSON file look like, exactly? And why do you want to change it? What are you trying to achieve?"}], "answers": [{"comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 1, "creation_date": 1534873853, "post_id": 51939977, "comment_id": 90858712, "body": "the transformation is unnecessary <code>:&#39;x&#39; == :x #=&gt; true</code> so <code>{&#39;x&#39;: 1534804991, &#39;y&#39;: 0.1} == {x: 1534804991, y: 0.1}</code> is also <code>true</code>. Now if the original <code>Hash</code> was <code>{&#39;x&#39; =&gt; 1534804991, &#39;y&#39; =&gt; 0.1}</code> then the transformation would be required"}], "tags": [], "owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "is_accepted": false, "score": 3, "last_activity_date": 1534810798, "last_edit_date": 1534810798, "creation_date": 1534810157, "answer_id": 51939977, "question_id": 51939845, "link": "https://stackoverflow.com/questions/51939845/replacing-text-with-ruby/51939977#51939977", "title": "Replacing text with Ruby", "body": "<p>I guess the point on what you want is transforming - or getting a new representation of your hash - with its keys as symbols rather than as String as you currently show in your input example.</p>\n\n<p>For doing that transform_keys would work:</p>\n\n<pre><code>hash = {'x': 1534804991, 'y': 0.1}\np hash.transform_keys(&amp;:to_sym) # {:x=&gt;1534804991, :y=&gt;0.1}\n</code></pre>\n\n<p>If your Ruby version doesn't support transform_keys, you can use each_with_object, or any of the \"old\" ways:</p>\n\n<pre><code>hash.each_with_object({}) { |(k, v), h| h[k] = v }\n</code></pre>\n\n<p>In order to change to value of a key in a hash, you must access its elements (key, value), and over there, do the manipulation or the assignation (to a new object).</p>\n"}, {"tags": [], "owner": {"reputation": 856, "user_id": 2131983, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3sKfa.jpg?s=128&g=1", "display_name": "khiav reoy", "link": "https://stackoverflow.com/users/2131983/khiav-reoy"}, "is_accepted": false, "score": 0, "last_activity_date": 1534866889, "creation_date": 1534866889, "answer_id": 51952520, "question_id": 51939845, "link": "https://stackoverflow.com/questions/51939845/replacing-text-with-ruby/51952520#51952520", "title": "Replacing text with Ruby", "body": "<p>I guest what you meant is:</p>\n\n<pre><code>p = File.read('xxx.json')\n# =&gt; \"{'x': 1534804991, 'y': 0.1}\" \n\nputs p\n# =&gt; {'x': 1534804991, 'y': 0.1}\n</code></pre>\n\n<p>If so, using <code>gsub</code> like the following would work.</p>\n\n<pre><code>puts p.gsub(/'(\\w+)': /, ':\\1=&gt;')\n# =&gt; {:x=&gt;1534804991, :y=&gt;0.1}\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 5098362, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc5949c03dd28cec347b620758353c93?s=128&d=identicon&r=PG&f=1", "display_name": "Rahul Aich", "link": "https://stackoverflow.com/users/5098362/rahul-aich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1534866889, "creation_date": 1534808878, "last_edit_date": 1534819052, "question_id": 51939845, "link": "https://stackoverflow.com/questions/51939845/replacing-text-with-ruby", "title": "Replacing text with Ruby", "body": "<p>I am trying to replace a pattern in my json file with Ruby. Input file has:</p>\n\n<pre><code>p={'x': 1534804991, 'y': 0.1}\n</code></pre>\n\n<p>I want the output:</p>\n\n<pre><code>p={:x=&gt;1534804991, :y=&gt;0.1}\n</code></pre>\n\n<p>I tried using <code>gsub</code></p>\n\n<pre><code>p.gsub(''x'',':x=&gt;')\np.gsub(\"'x'\",\":x=&gt;\")\np.sub!(\\w/x\\w/, \":x=&gt;\")\n</code></pre>\n\n<p>but it did not work.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "sqlite", "rake", "database-schema"], "comments": [{"owner": {"reputation": 7994, "user_id": 1625339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b8ba46f911517c8b2ccc39e0be9050c0?s=128&d=identicon&r=PG", "display_name": "Aetherus", "link": "https://stackoverflow.com/users/1625339/aetherus"}, "edited": false, "score": 0, "creation_date": 1534806771, "post_id": 51939580, "comment_id": 90829213, "body": "Try deleting the file <code>db&#47;development.sqlite3</code> while the application is not running, then run <code>rake db:migrate</code>."}, {"owner": {"reputation": 1, "user_id": 10252133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f3668bc58513ff82d940d9725ff92f86?s=128&d=identicon&r=PG&f=1", "display_name": "Deaddorks", "link": "https://stackoverflow.com/users/10252133/deaddorks"}, "reply_to_user": {"reputation": 7994, "user_id": 1625339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b8ba46f911517c8b2ccc39e0be9050c0?s=128&d=identicon&r=PG", "display_name": "Aetherus", "link": "https://stackoverflow.com/users/1625339/aetherus"}, "edited": false, "score": 0, "creation_date": 1534808116, "post_id": 51939580, "comment_id": 90829458, "body": "Well, it was refreshing to finally see a different error for once, but it still failed  --- CantOpenException: unable to open database file"}, {"owner": {"reputation": 1, "user_id": 10252133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f3668bc58513ff82d940d9725ff92f86?s=128&d=identicon&r=PG&f=1", "display_name": "Deaddorks", "link": "https://stackoverflow.com/users/10252133/deaddorks"}, "reply_to_user": {"reputation": 7994, "user_id": 1625339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b8ba46f911517c8b2ccc39e0be9050c0?s=128&d=identicon&r=PG", "display_name": "Aetherus", "link": "https://stackoverflow.com/users/1625339/aetherus"}, "edited": false, "score": 0, "creation_date": 1534808306, "post_id": 51939580, "comment_id": 90829491, "body": "Now I closed the server and tried to run it, and its giving me the same thing as before ;("}, {"owner": {"reputation": 1, "user_id": 10252133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f3668bc58513ff82d940d9725ff92f86?s=128&d=identicon&r=PG&f=1", "display_name": "Deaddorks", "link": "https://stackoverflow.com/users/10252133/deaddorks"}, "reply_to_user": {"reputation": 7994, "user_id": 1625339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b8ba46f911517c8b2ccc39e0be9050c0?s=128&d=identicon&r=PG", "display_name": "Aetherus", "link": "https://stackoverflow.com/users/1625339/aetherus"}, "edited": false, "score": 0, "creation_date": 1534809093, "post_id": 51939580, "comment_id": 90829654, "body": "Unfortunately, I think it probably has something to do with going over the network (I tried making it locally on my laptop and it worked). I was doing it this way before, and it worked just fine, but obviously when I changed some of my pc components out, it no longer wants to work for some reason. This makes no sense, because the share drive lets me access the files, delete the files, create new ones and everything."}], "owner": {"reputation": 1, "user_id": 10252133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f3668bc58513ff82d940d9725ff92f86?s=128&d=identicon&r=PG&f=1", "display_name": "Deaddorks", "link": "https://stackoverflow.com/users/10252133/deaddorks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 446, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1534806407, "creation_date": 1534806407, "question_id": 51939580, "link": "https://stackoverflow.com/questions/51939580/rails-fails-to-do-dbmigrate-database-is-locked-no-schema-migrations-table", "title": "Rails fails to do db:migrate, database is locked &amp; no schema migrations table", "body": "<p>So I played around with rails a few weeks ago, and then I came back yesterday for some more dabbling, and tada, nothing works.\nFor some reason, I keep getting this issue.  </p>\n\n<p>I've tried everything I can think of:</p>\n\n<ul>\n<li>Deleting and remaking the project</li>\n<li>Uninstalling gems</li>\n<li>Creating the project in RubyMine</li>\n<li>Creating the project on the command line</li>\n<li>Running db:migrate while the server is running (passenger)</li>\n<li>Running db:migrate while the server is not running</li>\n<li>Recreating the project and running db:migrate before running the server at all</li>\n</ul>\n\n<p>I am very frustrated and sad at this point, because I am on the verge of giving up on rails because of this, I just can not find a solution.</p>\n\n<p>My setup is I have a windows PC with my rails app in a share drive that I access on my laptop, which is running ubuntu.\nI thought there might be something wrong here, but when I run the server, it works just fine, I can create controllers and views and play around with them in chrome, but anything to do with the database is just absolutely f***ed and I can't understand why what-so-ever.<br>\nHere is the stack trace I get when I run db:migrate --trace:</p>\n\n<hr>\n\n<pre><code>rake db:migrate --trace\n** Invoke db:migrate (first_time)\n** Invoke db:load_config (first_time)\n** Invoke environment (first_time)\n** Execute environment\n** Execute db:load_config\n** Execute db:migrate\nrake aborted!\nActiveRecord::StatementInvalid: SQLite3::BusyException: database is locked: CREATE TABLE \"schema_migrations\" (\"version\" varchar NOT NULL PRIMARY KEY)\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/sqlite3-1.3.13/lib/sqlite3/statement.rb:108:in 'step'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/sqlite3-1.3.13/lib/sqlite3/statement.rb:108:in 'block in each'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/sqlite3-1.3.13/lib/sqlite3/statement.rb:107:in 'loop'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/sqlite3-1.3.13/lib/sqlite3/statement.rb:107:in 'each'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/sqlite3-1.3.13/lib/sqlite3/database.rb:152:in 'map'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/sqlite3-1.3.13/lib/sqlite3/database.rb:152:in 'block in execute'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/sqlite3-1.3.13/lib/sqlite3/database.rb:95:in 'prepare'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/sqlite3-1.3.13/lib/sqlite3/database.rb:137:in 'execute'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/connection_adapters/sqlite3_adapter.rb:255:in 'block (2 levels) in execute'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activesupport-5.2.1/lib/active_support/dependencies/interlock.rb:48:in 'block in permit_concurrent_loads'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activesupport-5.2.1/lib/active_support/concurrency/share_lock.rb:187:in 'yield_shares'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activesupport-5.2.1/lib/active_support/dependencies/interlock.rb:47:in 'permit_concurrent_loads'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/connection_adapters/sqlite3_adapter.rb:254:in 'block in execute'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/connection_adapters/abstract_adapter.rb:579:in 'block (2 levels) in log'\n/home/kalin/.rvm/rubies/ruby-2.5.1/lib/ruby/2.5.0/monitor.rb:226:in 'mon_synchronize'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/connection_adapters/abstract_adapter.rb:578:in 'block in log'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activesupport-5.2.1/lib/active_support/notifications/instrumenter.rb:23:in 'instrument'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/connection_adapters/abstract_adapter.rb:569:in 'log'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/connection_adapters/sqlite3_adapter.rb:253:in 'execute'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/connection_adapters/abstract/schema_statements.rb:311:in 'create_table'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/schema_migration.rb:29:in 'create_table'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/migration.rb:1187:in 'initialize'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/migration.rb:1036:in 'new'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/migration.rb:1036:in 'up'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/migration.rb:1011:in 'migrate'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/tasks/database_tasks.rb:172:in 'migrate'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/railties/databases.rake:60:in 'block (2 levels) in &lt;main&gt;'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/task.rb:271:in 'block in execute'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/task.rb:271:in 'each'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/task.rb:271:in 'execute'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/task.rb:213:in 'block in invoke_with_call_chain'\n/home/kalin/.rvm/rubies/ruby-2.5.1/lib/ruby/2.5.0/monitor.rb:226:in 'mon_synchronize'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/task.rb:193:in 'invoke_with_call_chain'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/task.rb:182:in 'invoke'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/application.rb:160:in 'invoke_task'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/application.rb:116:in 'block (2 levels) in top_level'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/application.rb:116:in 'each'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/application.rb:116:in 'block in top_level'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/application.rb:125:in 'run_with_threads'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/application.rb:110:in 'top_level'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/application.rb:83:in 'block in run'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/application.rb:186:in 'standard_exception_handling'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/application.rb:80:in 'run'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/exe/rake:27:in '&lt;top (required)&gt;'\n/home/kalin/.rvm/gems/ruby-2.5.1/bin/rake:23:in 'load'\n/home/kalin/.rvm/gems/ruby-2.5.1/bin/rake:23:in '&lt;main&gt;'\n/home/kalin/.rvm/gems/ruby-2.5.1/bin/ruby_executable_hooks:15:in 'eval'\n/home/kalin/.rvm/gems/ruby-2.5.1/bin/ruby_executable_hooks:15:in '&lt;main&gt;'\n\nCaused by:\nSQLite3::BusyException: database is locked\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/sqlite3-1.3.13/lib/sqlite3/statement.rb:108:in 'step'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/sqlite3-1.3.13/lib/sqlite3/statement.rb:108:in 'block in each'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/sqlite3-1.3.13/lib/sqlite3/statement.rb:107:in 'loop'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/sqlite3-1.3.13/lib/sqlite3/statement.rb:107:in 'each'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/sqlite3-1.3.13/lib/sqlite3/database.rb:152:in 'map'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/sqlite3-1.3.13/lib/sqlite3/database.rb:152:in 'block in execute'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/sqlite3-1.3.13/lib/sqlite3/database.rb:95:in 'prepare'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/sqlite3-1.3.13/lib/sqlite3/database.rb:137:in 'execute'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/connection_adapters/sqlite3_adapter.rb:255:in 'block (2 levels) in execute'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activesupport-5.2.1/lib/active_support/dependencies/interlock.rb:48:in 'block in permit_concurrent_loads'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activesupport-5.2.1/lib/active_support/concurrency/share_lock.rb:187:in 'yield_shares'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activesupport-5.2.1/lib/active_support/dependencies/interlock.rb:47:in 'permit_concurrent_loads'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/connection_adapters/sqlite3_adapter.rb:254:in 'block in execute'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/connection_adapters/abstract_adapter.rb:579:in 'block (2 levels) in log'\n/home/kalin/.rvm/rubies/ruby-2.5.1/lib/ruby/2.5.0/monitor.rb:226:in 'mon_synchronize'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/connection_adapters/abstract_adapter.rb:578:in 'block in log'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activesupport-5.2.1/lib/active_support/notifications/instrumenter.rb:23:in 'instrument'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/connection_adapters/abstract_adapter.rb:569:in 'log'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/connection_adapters/sqlite3_adapter.rb:253:in 'execute'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/connection_adapters/abstract/schema_statements.rb:311:in 'create_table'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/schema_migration.rb:29:in 'create_table'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/migration.rb:1187:in 'initialize'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/migration.rb:1036:in 'new'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/migration.rb:1036:in 'up'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/migration.rb:1011:in 'migrate'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/tasks/database_tasks.rb:172:in 'migrate'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/railties/databases.rake:60:in 'block (2 levels) in &lt;main&gt;'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/task.rb:271:in 'block in execute'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/task.rb:271:in 'each'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/task.rb:271:in 'execute'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/task.rb:213:in 'block in invoke_with_call_chain'\n/home/kalin/.rvm/rubies/ruby-2.5.1/lib/ruby/2.5.0/monitor.rb:226:in 'mon_synchronize'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/task.rb:193:in 'invoke_with_call_chain'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/task.rb:182:in 'invoke'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/application.rb:160:in 'invoke_task'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/application.rb:116:in 'block (2 levels) in top_level'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/application.rb:116:in 'each'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/application.rb:116:in 'block in top_level'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/application.rb:125:in 'run_with_threads'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/application.rb:110:in 'top_level'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/application.rb:83:in 'block in run'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/application.rb:186:in 'standard_exception_handling'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/lib/rake/application.rb:80:in 'run'\n/home/kalin/.rvm/gems/ruby-2.5.1/gems/rake-12.3.1/exe/rake:27:in '&lt;top (required)&gt;'\n/home/kalin/.rvm/gems/ruby-2.5.1/bin/rake:23:in 'load'\n/home/kalin/.rvm/gems/ruby-2.5.1/bin/rake:23:in '&lt;main&gt;'\n/home/kalin/.rvm/gems/ruby-2.5.1/bin/ruby_executable_hooks:15:in 'eval'\n/home/kalin/.rvm/gems/ruby-2.5.1/bin/ruby_executable_hooks:15:in '&lt;main&gt;'\nTasks: TOP =&gt; db:migrate\n</code></pre>\n"}, {"tags": ["ruby", "openssl", "rsa"], "answers": [{"comments": [{"owner": {"reputation": 65, "user_id": 10247375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca0584a0b95d7cb3d870bc3ac07fe115?s=128&d=identicon&r=PG&f=1", "display_name": "JamieCoder", "link": "https://stackoverflow.com/users/10247375/jamiecoder"}, "edited": false, "score": 0, "creation_date": 1534950588, "post_id": 51961557, "comment_id": 90890244, "body": "Thanks for the clear answer, and for the links to the <code>_pss</code> Ruby methods. Does that mean BoringSSL (a fork of OpenSSL by Google and the lib I mistakingly linked to thinking it was OpenSSL) does things a bit different? Because from <a href=\"https://commondatastorage.googleapis.com/chromium-boringssl-docs/rsa.h.html#RSA_private_encrypt\" rel=\"nofollow noreferrer\">their docs</a>, RSA-PSS is able to be used for encryption with a private key/decryption with a public key, and not just for <code>sign</code>/<code>verify</code> (so BoringSSL supports RSA-PSS for <code>verify_restore</code>). Is this a missing feature in OpenSSL compared to BoringSSL?"}, {"owner": {"reputation": 14334, "user_id": 1380680, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/TRgwX.png?s=128&g=1", "display_name": "Reinier Torenbeek", "link": "https://stackoverflow.com/users/1380680/reinier-torenbeek"}, "reply_to_user": {"reputation": 65, "user_id": 10247375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca0584a0b95d7cb3d870bc3ac07fe115?s=128&d=identicon&r=PG&f=1", "display_name": "JamieCoder", "link": "https://stackoverflow.com/users/10247375/jamiecoder"}, "edited": false, "score": 0, "creation_date": 1534956353, "post_id": 51961557, "comment_id": 90893658, "body": "No, RSA-PSS is a scheme to use for signing and verification purposes only -- by design.The name already says it: PSS stands for Probabilistic <i>Signature</i> Scheme. The documentation you refer to seems somewhat misleading, depending how you interpret it."}, {"owner": {"reputation": 14334, "user_id": 1380680, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/TRgwX.png?s=128&g=1", "display_name": "Reinier Torenbeek", "link": "https://stackoverflow.com/users/1380680/reinier-torenbeek"}, "reply_to_user": {"reputation": 65, "user_id": 10247375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca0584a0b95d7cb3d870bc3ac07fe115?s=128&d=identicon&r=PG&f=1", "display_name": "JamieCoder", "link": "https://stackoverflow.com/users/10247375/jamiecoder"}, "edited": false, "score": 0, "creation_date": 1534957334, "post_id": 51961557, "comment_id": 90894155, "body": "This answer might be interesting for you to read: <a href=\"https://security.stackexchange.com/questions/183179/what-is-rsa-oaep-rsa-pss-in-simple-terms\">What is RSA OAEP &amp; RSA PSS in simple terms</a>."}, {"owner": {"reputation": 65, "user_id": 10247375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca0584a0b95d7cb3d870bc3ac07fe115?s=128&d=identicon&r=PG&f=1", "display_name": "JamieCoder", "link": "https://stackoverflow.com/users/10247375/jamiecoder"}, "edited": false, "score": 0, "creation_date": 1534959911, "post_id": 51961557, "comment_id": 90895335, "body": "Thanks for the link. So in that case shouldn&#39;t RSA-PSS padding theoretically be available for <code>EVP_PKEY_verify_recover</code>, and as such also in <code>OpenSSL::PKey::RSA#public_decrypt</code>, or even a new <code>OpenSSL::PKey::RSA#public_decrypt_pss</code> method, if it was updated to utilize the <code>EVP</code> interface? (Since most implementations of <code>private_encrypt</code>/<code>public_decrypt</code> use the <code>RSA_sign</code>/<code>RSA_verify_recover</code> functions under the hood.) If that&#39;s incorrect, then why <i>can&#39;t</i> RSA-PSS support the <code>verify_recover</code> op?"}, {"owner": {"reputation": 14334, "user_id": 1380680, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/TRgwX.png?s=128&g=1", "display_name": "Reinier Torenbeek", "link": "https://stackoverflow.com/users/1380680/reinier-torenbeek"}, "reply_to_user": {"reputation": 65, "user_id": 10247375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca0584a0b95d7cb3d870bc3ac07fe115?s=128&d=identicon&r=PG&f=1", "display_name": "JamieCoder", "link": "https://stackoverflow.com/users/10247375/jamiecoder"}, "edited": false, "score": 1, "creation_date": 1534961241, "post_id": 51961557, "comment_id": 90895943, "body": "The RSA-PSS scheme itself does not have message digest recovery so you will find no implementation of <code>{RSA|EVP_PKEY}_verify_recover()</code> that will give it. See also <a href=\"https://security.stackexchange.com/questions/87235/rsa-vs-dsa-digital-signature-message-digest-recovery\">RSA vs DSA Digital Signature Message Digest Recovery</a>"}, {"owner": {"reputation": 65, "user_id": 10247375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca0584a0b95d7cb3d870bc3ac07fe115?s=128&d=identicon&r=PG&f=1", "display_name": "JamieCoder", "link": "https://stackoverflow.com/users/10247375/jamiecoder"}, "edited": false, "score": 0, "creation_date": 1534962027, "post_id": 51961557, "comment_id": 90896298, "body": "Thanks so much for the clarification and for the link. I think BoringSSL&#39;s docs really confused me, since they make it sound like RSA-PSS does somehow support recovery, but I couldn&#39;t find a clear answer anywhere online."}], "tags": [], "owner": {"reputation": 14334, "user_id": 1380680, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/TRgwX.png?s=128&g=1", "display_name": "Reinier Torenbeek", "link": "https://stackoverflow.com/users/1380680/reinier-torenbeek"}, "is_accepted": true, "score": 3, "last_activity_date": 1534923367, "last_edit_date": 1534923367, "creation_date": 1534922044, "answer_id": 51961557, "question_id": 51938473, "link": "https://stackoverflow.com/questions/51938473/how-do-i-use-pkcs1-pss-padding-with-rubys-rsa-implementation/51961557#51961557", "title": "How do I use PKCS1_PSS_PADDING with Ruby&#39;s RSA implementation?", "body": "<p>The documentation that you refer to mentions that </p>\n\n<blockquote>\n  <p><code>RSA_PKCS1_PSS_PADDING</code> can only be used via the EVP interface.</p>\n</blockquote>\n\n<p>The Ruby functions that you invoke use the <a href=\"https://www.openssl.org/docs/man1.0.2/crypto/RSA_private_encrypt.html\" rel=\"nofollow noreferrer\"><code>RSA_private_encrypt()</code></a> function under the hood, which is not the EVP interface. As a result, OpenSSL emits an error. You can see it happen in the OpenSSL source code <a href=\"https://github.com/openssl/openssl/blob/OpenSSL_1_1_0/crypto/rsa/rsa_ossl.c#L262\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>However, Ruby's <a href=\"http://ruby-doc.org/stdlib-2.5.0/libdoc/openssl/rdoc/OpenSSL/PKey/RSA.html\" rel=\"nofollow noreferrer\"><code>OpenSSL::PKey::RSA</code> class</a> exposes two methods specifically for signing and verifying with the RSA-PSS scheme, called <code>sign_pss()</code> and <code>verify_pss()</code>. Their documentation comes with coding examples showing you how to use them.</p>\n\n<p>RSA-PSS can only be used for signature generation (and verification), <a href=\"https://crypto.stackexchange.com/questions/15997/is-rsa-encryption-with-a-private-key-the-same-as-signature-generation\">which is not the same as RSA encryption with a private key (and decryption with a public key)</a>.</p>\n"}], "owner": {"reputation": 65, "user_id": 10247375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca0584a0b95d7cb3d870bc3ac07fe115?s=128&d=identicon&r=PG&f=1", "display_name": "JamieCoder", "link": "https://stackoverflow.com/users/10247375/jamiecoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1297, "favorite_count": 0, "accepted_answer_id": 51961557, "answer_count": 1, "score": 2, "last_activity_date": 1534923367, "creation_date": 1534799036, "last_edit_date": 1534860825, "question_id": 51938473, "link": "https://stackoverflow.com/questions/51938473/how-do-i-use-pkcs1-pss-padding-with-rubys-rsa-implementation", "title": "How do I use PKCS1_PSS_PADDING with Ruby&#39;s RSA implementation?", "body": "<p>According to the <a href=\"https://commondatastorage.googleapis.com/chromium-boringssl-docs/rsa.h.html#RSA_private_encrypt\" rel=\"nofollow noreferrer\">docs for OpenSSL</a>, <code>RSA_PKCS1_PSS_PADDING</code> is supposed to be available for use with OpenSSL's <code>RSA_private_encrypt</code> function, which is what Ruby uses internally for <code>OpenSSL::PKey::RSA#private_encrypt</code>.</p>\n\n<p>Relevant quote from the linked docs for OpenSSL's <code>RSA_private_encrypt</code>:</p>\n\n<blockquote>\n  <p>The padding argument must be one of the <code>RSA_*_PADDING</code> values. If in doubt, <code>RSA_PKCS1_PADDING</code> is the most common but <code>RSA_PKCS1_PSS_PADDING</code> is preferred for new protocols.</p>\n</blockquote>\n\n<p>Is there anyway I can use PSS padding for the private key encryption? I'd prefer to use PSS over Ruby's default padding (OpenSSL docs say it's preferable), but it seems like PSS is not widely implemented, unless I'm misunderstanding things.</p>\n\n<p>I have Ruby 2.5 and OpenSSL 1.0.2 installed.</p>\n\n<pre><code>require 'openssl'\n\npadding = 6 # OpenSSL's raw constant for RSA_PKCS1_PSS_PADDING since Ruby doesn't define it\npriv = OpenSSL::PKey::RSA.new 2048\npub = priv.public_key\n\ndata = 'foo-bar-baz'\nenc = priv.private_encrypt data, padding\ndec = pub.public_decrypt enc, padding\n\nputs dec == data\n</code></pre>\n\n<p>Running this throws an error: <code>unknown padding type</code>, even though I thought OpenSSL supports the <code>RSA_PKCS1_PSS_PADDING</code> padding type.</p>\n\n<p>Does Ruby 2.5 not support <code>RSA_PKCS1_PSS_PADDING</code> for some reason?</p>\n"}, {"tags": ["html", "ruby-on-rails", "ruby", "forms", "filter"], "comments": [{"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1534797692, "post_id": 51938109, "comment_id": 90826556, "body": "What would you <i>like</i> the <i>&quot;correct&quot;</i>  behaviour to be when the URL is entered with no parameters? This is not a trick question; the behaviour can be anything (sensible), but I don&#39;t know how to answer your question without knowing the desired behaviour."}, {"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1534797804, "post_id": 51938109, "comment_id": 90826597, "body": "For example, it could be: A meaningful error message (not just &quot;whoops, something went wrong!&quot;); or redirect to another page; or default to a certain <code>semester_id</code> (based on what logic?); or <i>show all</i> - i.e. don&#39;t filter by semester; ..."}, {"owner": {"reputation": 1479, "user_id": 2506819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b60435154915157dfd7ebfc04164930?s=128&d=identicon&r=PG", "display_name": "fanta", "link": "https://stackoverflow.com/users/2506819/fanta"}, "edited": false, "score": 0, "creation_date": 1534797817, "post_id": 51938109, "comment_id": 90826599, "body": "use <code>dig</code> like <code>params.dig(:semester, :semester_id)</code>. But <code>nil.to_i</code> gives you <code>0</code>, not sure if you want that. Filtering in the Controller is something I would not recommend, perhaps create a new class called <code>GradeFilter</code>, or give it a proper name. And perhaps build your query depending on wether the param is present or not, like <code>@betterFilteredLinks = Link.order(:semester_id)</code>, <code>@betterFilteredLinks.where(semester_id: semester_id) if semester_id</code>, you first have to set <code>semester_id</code> in your class(you could use <code>dig)</code>, or pass <code>params[:semester]</code> to your new class, well, there are many ways."}, {"owner": {"reputation": 45, "user_id": 8141112, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ofXCTtOHrCA/AAAAAAAAAAI/AAAAAAAAABc/A1ig14nBu2M/photo.jpg?sz=128", "display_name": "Divepit", "link": "https://stackoverflow.com/users/8141112/divepit"}, "reply_to_user": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1534798160, "post_id": 51938109, "comment_id": 90826719, "body": "@TomLord oh yes, the correct behaviour with no filter selected should just be that nothing is displayed on the site. The sections on the page will generate based on what filter combination has been chosen. Eg someone choses semester 1 so only the sections with semester_id 1 will be displayed. Therefore if no filter is applied, the page will only display the header."}, {"owner": {"reputation": 45, "user_id": 8141112, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ofXCTtOHrCA/AAAAAAAAAAI/AAAAAAAAABc/A1ig14nBu2M/photo.jpg?sz=128", "display_name": "Divepit", "link": "https://stackoverflow.com/users/8141112/divepit"}, "reply_to_user": {"reputation": 1479, "user_id": 2506819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b60435154915157dfd7ebfc04164930?s=128&d=identicon&r=PG", "display_name": "fanta", "link": "https://stackoverflow.com/users/2506819/fanta"}, "edited": false, "score": 0, "creation_date": 1534798555, "post_id": 51938109, "comment_id": 90826860, "body": "@fanta building the query depending on whether the param is present or not is exactly what I want to do! I just didn\u2019t know how to put that in words like this! Thanks! :) I\u2019m going to try dig tomorrow and report back!"}], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 8141112, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ofXCTtOHrCA/AAAAAAAAAAI/AAAAAAAAABc/A1ig14nBu2M/photo.jpg?sz=128", "display_name": "Divepit", "link": "https://stackoverflow.com/users/8141112/divepit"}, "edited": false, "score": 0, "creation_date": 1534798401, "post_id": 51938292, "comment_id": 90826795, "body": "I will try this tomorrow morning and come back with a result! I believe this is what I was looking for. The issue is that if the params are not set (because the page has been loaded but no filter has been applied yet) rails will spit an error because I\u2019m trying to set params[nil][nil] essentially."}, {"owner": {"reputation": 45, "user_id": 8141112, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ofXCTtOHrCA/AAAAAAAAAAI/AAAAAAAAABc/A1ig14nBu2M/photo.jpg?sz=128", "display_name": "Divepit", "link": "https://stackoverflow.com/users/8141112/divepit"}, "edited": false, "score": 0, "creation_date": 1534828197, "post_id": 51938292, "comment_id": 90833354, "body": "I did a little different approach and in the view added the line   <code>if !params[:semester].nil?</code>  before generating the sections. This worked as well. Is there a safety issue with this?"}, {"owner": {"reputation": 374, "user_id": 9290107, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-uaazeTb-DBE/AAAAAAAAAAI/AAAAAAAAAC0/bKKxFLCNxYk/photo.jpg?sz=128", "display_name": "Eric Nordelo Galiano", "link": "https://stackoverflow.com/users/9290107/eric-nordelo-galiano"}, "reply_to_user": {"reputation": 45, "user_id": 8141112, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ofXCTtOHrCA/AAAAAAAAAAI/AAAAAAAAABc/A1ig14nBu2M/photo.jpg?sz=128", "display_name": "Divepit", "link": "https://stackoverflow.com/users/8141112/divepit"}, "edited": false, "score": 0, "creation_date": 1534879497, "post_id": 51938292, "comment_id": 90861305, "body": "Well, what if the params[:semester] is not nil but has an incorrect value?, you could need to do a few more things with the params that only check nullity, and keep this logic in the controller is a good practice keeping the MVC separation consistentily..."}, {"owner": {"reputation": 45, "user_id": 8141112, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ofXCTtOHrCA/AAAAAAAAAAI/AAAAAAAAABc/A1ig14nBu2M/photo.jpg?sz=128", "display_name": "Divepit", "link": "https://stackoverflow.com/users/8141112/divepit"}, "edited": false, "score": 0, "creation_date": 1534880020, "post_id": 51938292, "comment_id": 90861522, "body": "that\u2019s a good point! Thanks for the thought, I really appreciate your help! :)"}], "tags": [], "owner": {"reputation": 374, "user_id": 9290107, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-uaazeTb-DBE/AAAAAAAAAAI/AAAAAAAAAC0/bKKxFLCNxYk/photo.jpg?sz=128", "display_name": "Eric Nordelo Galiano", "link": "https://stackoverflow.com/users/9290107/eric-nordelo-galiano"}, "is_accepted": true, "score": 1, "last_activity_date": 1534798127, "creation_date": 1534798127, "answer_id": 51938292, "question_id": 51938109, "link": "https://stackoverflow.com/questions/51938109/how-to-deal-with-params-from-form-being-nil-nomethoderror/51938292#51938292", "title": "How to deal with params from form being nil? (NoMethodError)", "body": "<p>I don't understand your question quite well, but if what you need is to provide default behavior to nil or incorrect params ( what you should validate too), you can use a private method in the controller, create an object from params info and set this object in the action with a before_action... Something like this:</p>\n\n<pre><code>private\ndef set_full_params_data\n  @full_params = {}\n  params[:semester].nil? ?  @full_params[:semester_id] = DEFAULT_ID : \n                            @full_params[:semester_id] = params[:semester]\n                            [:semester_id]\n  ... etc\nend\n</code></pre>\n\n<p>And add the </p>\n\n<pre><code>before_action :set_full_params_data, only: [:action_name]\n</code></pre>\n\n<p>and in the action use @full_params instead params.</p>\n"}], "owner": {"reputation": 45, "user_id": 8141112, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ofXCTtOHrCA/AAAAAAAAAAI/AAAAAAAAABc/A1ig14nBu2M/photo.jpg?sz=128", "display_name": "Divepit", "link": "https://stackoverflow.com/users/8141112/divepit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 1, "accepted_answer_id": 51938292, "answer_count": 1, "score": 0, "last_activity_date": 1534798127, "creation_date": 1534797062, "question_id": 51938109, "link": "https://stackoverflow.com/questions/51938109/how-to-deal-with-params-from-form-being-nil-nomethoderror", "title": "How to deal with params from form being nil? (NoMethodError)", "body": "<p>So at the top of my view I created a little form which will let the user choose a semester and a field:</p>\n\n<pre><code>&lt;%= form_tag '', :method =&gt; :get do %&gt;\n          &lt;%= collection_select(:semester, :semester_id, Semester.all, :id, :name, prompt: true) %&gt;\n          &lt;%= collection_select(:field, :field_id, Field.all, :id, :name, prompt: true) %&gt;\n          &lt;%= submit_tag 'Filter' %&gt;\n          &lt;% end %&gt;\n</code></pre>\n\n<p>and then the page will generate based on this \"filter\" to display the subjects with different links. Now for this I am using the following declaration in the Controller:</p>\n\n<pre><code>@betterFilteredLinks = Link.where(\"semester_id = #{params[:semester][:semester_id].to_i} AND field_id = #{params[:semester][:semester_id].to_i}\")\n</code></pre>\n\n<p>Which is working all fine if I load the page with the filter applied like this:</p>\n\n<pre><code>http://0.0.0.0:3000/?utf8=\u2713&amp;semester%5Bsemester_id%5D=2&amp;field%5Bfield_id%5D=1&amp;commit=Filter\n</code></pre>\n\n<p>However if I only load <a href=\"http://0.0.0.0:3000/\" rel=\"nofollow noreferrer\">http://0.0.0.0:3000/</a> it will (naturally) set the params of the filter to <code>nil</code> and the page will display an error.</p>\n\n<p>I can't think of a solution to this and I'm not sure where to look. I read that I'm not supposed to set default values for the params? Would that even be possible?</p>\n\n<p>Is there a different way to solve this than entering the view with the params already predefined? I believe I might be doing something fundamentally wrong here but I just learned about the forms and params today..</p>\n\n<p>Thanks in advance :)</p>\n"}, {"tags": ["ruby", "ruby-on-rails-4"], "comments": [{"owner": {"reputation": 15, "user_id": 3829444, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/286dee723030ba9791c5c78cbfad4bd7?s=128&d=identicon&r=PG&f=1", "display_name": "user3829444", "link": "https://stackoverflow.com/users/3829444/user3829444"}, "reply_to_user": {"reputation": 30418, "user_id": 823617, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DmWH1.png?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/823617/casper"}, "edited": false, "score": 0, "creation_date": 1534796576, "post_id": 51937928, "comment_id": 90826105, "body": "I should clarify. The code is able to survive, but item.status is not being set to the rescued value. Instead it is receiving nil."}], "answers": [{"tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": true, "score": 0, "last_activity_date": 1534796839, "creation_date": 1534796839, "answer_id": 51938066, "question_id": 51937928, "link": "https://stackoverflow.com/questions/51937928/rescue-inside-do-loops-and-conditionals-ruby/51938066#51938066", "title": "rescue inside do loops and conditionals ruby", "body": "<p>The problem is that when an exception is raised, the execution jumps into rescue section, so all the necessary code is skipped. Try to put <code>begin...rescue...end</code> block inside the loop:</p>\n\n<pre><code>@acceptrecent = Accept.where(\"buyer_id = ? OR localbid = ?\", current_user, current_user).order(created_at: :desc).limit(5)\n@offersrecent = Offer.where(buyer_id:current_user, offerstat: true).order(updated_at: :desc).limit(20)\n@buyer = Buyer.find(current_user)\n@acceptrecent.each do |item|\n  unless item.processed.present?\n    tracker =\n      begin\n        item.cart ? USPS::Request::TrackingFieldLookup.new(item.cart.track_number,1).send! : TrackDefault.new\n      rescue USPS::Error =&gt; _\n        TrackDefault.new\n      end\n\n    item.status = tracker.status\n    item.save\n  end\nend\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 3829444, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/286dee723030ba9791c5c78cbfad4bd7?s=128&d=identicon&r=PG&f=1", "display_name": "user3829444", "link": "https://stackoverflow.com/users/3829444/user3829444"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 51938066, "answer_count": 1, "score": -1, "last_activity_date": 1534796839, "creation_date": 1534796153, "last_edit_date": 1534796509, "question_id": 51937928, "link": "https://stackoverflow.com/questions/51937928/rescue-inside-do-loops-and-conditionals-ruby", "title": "rescue inside do loops and conditionals ruby", "body": "<p>I have the following body of code that is in theory supposed to rescue the error inside of the nested conditional block. However; it is not working. I tried moving the rescue and begin statements inside of both blocks but neither is working.</p>\n\n<pre><code>begin\n  @acceptrecent = Accept.where(\"buyer_id = ? OR localbid = ?\", current_user, current_user).order(created_at: :desc).limit(5)\n  @offersrecent = Offer.where(buyer_id:current_user, offerstat: true).order(updated_at: :desc).limit(20)\n  @buyer = Buyer.find(current_user)\n  @acceptrecent.each do |item|\n    unless item.processed.present?\n      item.cart.nil? ? tracker = TrackDefault.new : tracker = USPS::Request::TrackingFieldLookup.new(item.cart.track_number,1).send!\n      item.status = tracker.status\n      item.save\n    end\n  end\nrescue USPS::Error =&gt; err\n  tracker = TrackDefault.new\nend\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "require"], "answers": [{"tags": [], "owner": {"reputation": 3119, "user_id": 4842949, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0agpj31wtZ8/AAAAAAAAAAI/AAAAAAAAAAA/mSolbNN-zIY/photo.jpg?sz=128", "display_name": "Joseph Cho", "link": "https://stackoverflow.com/users/4842949/joseph-cho"}, "is_accepted": true, "score": 0, "last_activity_date": 1534799594, "last_edit_date": 1534799594, "creation_date": 1534798113, "answer_id": 51938287, "question_id": 51937744, "link": "https://stackoverflow.com/questions/51937744/what-is-the-difference-between-rails-application-config-autoload-paths-and-stand/51938287#51938287", "title": "What is the difference between Rails.application.config.autoload_paths and standard Ruby require/require_relative?", "body": "<p>There's a number of things that could be going on here.</p>\n\n<p>1.If a file is following the path: <code>lib/foo/bar.rb</code> the class needs to be defined like:</p>\n\n<pre><code>class Foo::Bar\nend\n</code></pre>\n\n<p>2.Autoload also lazy loads files, which means your models are only loaded when you call them. <a href=\"https://stackoverflow.com/questions/804297/when-to-use-require-load-or-autoload-in-ruby\">For example</a>:</p>\n\n<pre><code>puts \"I was loaded!\"\n\nclass MyLibrary\nend\n\nirb(main):001:0&gt; require 'mylibrary'\nI was loaded!\n=&gt; true\n\nirb(main):001:0&gt; autoload :MyLibrary, 'mylibrary'\n=&gt; nil\nirb(main):002:0&gt; MyLibrary.new\nI was loaded!\n=&gt; #&lt;MyLibrary:0x0b1jef&gt;\n</code></pre>\n\n<p>As for the actual usage of <code>autoload</code>, it's recommended to start using <code>require</code> instead. In theory <code>autoload</code> sounds nice but it can cause problems when certain classes are dependent on other modules. Because of this <a href=\"https://bugs.ruby-lang.org/issues/5653\" rel=\"nofollow noreferrer\">autoload is in the process of being deprecated</a>.</p>\n"}], "owner": {"reputation": 5850, "user_id": 4501354, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/1230cfcc7f68488ad19d0022cf7b1a93?s=128&d=identicon&r=PG&f=1", "display_name": "Donato", "link": "https://stackoverflow.com/users/4501354/donato"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 51938287, "answer_count": 1, "score": 0, "last_activity_date": 1534799594, "creation_date": 1534795120, "last_edit_date": 1534797230, "question_id": 51937744, "link": "https://stackoverflow.com/questions/51937744/what-is-the-difference-between-rails-application-config-autoload-paths-and-stand", "title": "What is the difference between Rails.application.config.autoload_paths and standard Ruby require/require_relative?", "body": "<p>I see that the following configuration in application.rb:</p>\n\n<pre><code>config.autoload_paths += %W(#{config.root}/app/models/custom_pack/base)\nconfig.autoload_paths += Dir[\"#{config.root}/app/models/custom_pack/custom_container/**/\"]\nconfig.autoload_paths += Dir[\"#{config.root}/app/models/custom_pack/helpers/**/\"]\nconfig.autoload_paths += Dir[\"#{config.root}/app/models/custom_pack/extensions/**/\"]\n</code></pre>\n\n<p>is in the autoload_paths:</p>\n\n<pre><code>Rails.application.config.autoload_paths.grep /custom/\n =&gt; [\"/Users/dviglione/projects/core/app/models/custom_pack/base\", \"/Users/dviglione/projects/core/app/models/custom_pack/custom_container/\", \"/Users/dviglione/projects/core/app/models/custom_pack/helpers/\", \"/Users/dviglione/projects/core/app/models/custom_pack/extensions/\"]\n</code></pre>\n\n<p>But these files are not being loaded. Because I get an error:</p>\n\n<pre><code> `method_missing': undefined method `create_element' for #&lt;MyElement:0x007f82eca39898&gt; \n</code></pre>\n\n<p>That create_element method is defined in one of the files that should have been loaded.</p>\n\n<p>However, when I use require/require_relative, it does work:</p>\n\n<pre><code># /initializers/my_initializer.rb\nrequire \"custom_pack/base\"\n\n# models/custom_pack/base.rb    \nrequire_relative 'custom_container/base'\nrequire_relative 'custom_container/parent'\nrequire_relative 'custom_container/child'\n\nDir[File.join(File.expand_path(\"../helpers\", __FILE__), \"*_helper.rb\")].each { |file| require file }\nDir[File.join(File.expand_path(\"../extensions\", __FILE__), \"*_adapter.rb\")].each { |file| require file }\n</code></pre>\n\n<p>From what I read from the documentation, when you use require 'erb', Ruby looks for the file in the directories listed in $LOAD_PATH. That is, Ruby iterates over all its directories and for each one of them checks whether they have a file called \"erb.rb\". If it finds any of them, the interpreter loads it and ends the search. Otherwise, it tries again in the next directory of the list. If the list gets exhausted, LoadError is raised. For autoloading, the idea is that when a constant like Post is hit and missing, if there's a post.rb file for example in app/models Rails is going to find it, evaluate it, and have Post defined as a side-effect. Rails has a collection of directories similar to $LOAD_PATH in which to look up post.rb. That collection is called autoload_paths.</p>\n\n<p>So why does require/require_relative work, but autoload_paths does not?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "forms", "select", "model-view-controller"], "comments": [{"owner": {"reputation": 484, "user_id": 5949678, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Yn9j3.jpg?s=128&g=1", "display_name": "Divya Sharma", "link": "https://stackoverflow.com/users/5949678/divya-sharma"}, "edited": false, "score": 0, "creation_date": 1535031854, "post_id": 51937533, "comment_id": 90924026, "body": "I think as you have has_one :author association in Book Model, so there is no need of additional field &quot;author_name&quot; attribute as when you create book by selecting any specific author id it will  get associated with author so you can make use of either @book.author.name or can make use of delegate in Book model. Instead of adding an extra attribute have you tried this approach"}], "answers": [{"comments": [{"owner": {"reputation": 1512, "user_id": 5513336, "user_type": "registered", "accept_rate": 16, "profile_image": "https://i.stack.imgur.com/bc7pn.jpg?s=128&g=1", "display_name": "Leia_Organa", "link": "https://stackoverflow.com/users/5513336/leia-organa"}, "edited": false, "score": 0, "creation_date": 1534795900, "post_id": 51937689, "comment_id": 90825834, "body": "Thank you for the reply. I tried this, but now all I am getting is: Title: Ruby Programming Author: 1  So now it&#39;s just displaying the ID."}, {"owner": {"reputation": 374, "user_id": 9290107, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-uaazeTb-DBE/AAAAAAAAAAI/AAAAAAAAAC0/bKKxFLCNxYk/photo.jpg?sz=128", "display_name": "Eric Nordelo Galiano", "link": "https://stackoverflow.com/users/9290107/eric-nordelo-galiano"}, "reply_to_user": {"reputation": 1512, "user_id": 5513336, "user_type": "registered", "accept_rate": 16, "profile_image": "https://i.stack.imgur.com/bc7pn.jpg?s=128&g=1", "display_name": "Leia_Organa", "link": "https://stackoverflow.com/users/5513336/leia-organa"}, "edited": false, "score": 0, "creation_date": 1534796177, "post_id": 51937689, "comment_id": 90825945, "body": "Where are you getting that ?"}, {"owner": {"reputation": 374, "user_id": 9290107, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-uaazeTb-DBE/AAAAAAAAAAI/AAAAAAAAAC0/bKKxFLCNxYk/photo.jpg?sz=128", "display_name": "Eric Nordelo Galiano", "link": "https://stackoverflow.com/users/9290107/eric-nordelo-galiano"}, "reply_to_user": {"reputation": 1512, "user_id": 5513336, "user_type": "registered", "accept_rate": 16, "profile_image": "https://i.stack.imgur.com/bc7pn.jpg?s=128&g=1", "display_name": "Leia_Organa", "link": "https://stackoverflow.com/users/5513336/leia-organa"}, "edited": false, "score": 0, "creation_date": 1534796710, "post_id": 51937689, "comment_id": 90826159, "body": "OK, another thing, if you have the author_id in the book table, you must use belongs_to instead of has_one in book model..."}, {"owner": {"reputation": 1512, "user_id": 5513336, "user_type": "registered", "accept_rate": 16, "profile_image": "https://i.stack.imgur.com/bc7pn.jpg?s=128&g=1", "display_name": "Leia_Organa", "link": "https://stackoverflow.com/users/5513336/leia-organa"}, "edited": false, "score": 1, "creation_date": 1534803360, "post_id": 51937689, "comment_id": 90828426, "body": "Thanks, I finally got it to work thanks to your suggestions!"}, {"owner": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 0, "creation_date": 1534821742, "post_id": 51937689, "comment_id": 90831959, "body": "Or do <code>delegate :name, to: :author, prefix: true, allow_nil: true</code>"}], "tags": [], "owner": {"reputation": 374, "user_id": 9290107, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-uaazeTb-DBE/AAAAAAAAAAI/AAAAAAAAAC0/bKKxFLCNxYk/photo.jpg?sz=128", "display_name": "Eric Nordelo Galiano", "link": "https://stackoverflow.com/users/9290107/eric-nordelo-galiano"}, "is_accepted": false, "score": 0, "last_activity_date": 1534799569, "last_edit_date": 1534799569, "creation_date": 1534794869, "answer_id": 51937689, "question_id": 51937533, "link": "https://stackoverflow.com/questions/51937533/rails-created-params-not-saving-correctly/51937689#51937689", "title": "Rails: Created params not saving correctly", "body": "<p>You are not generating the right way the author_name field of the book, but you don't need it at all, if you have the relationship and the author table has a name field, you can always use book_instance.author.name, or you can generate in the book model a method author_name which returns this.</p>\n\n<p>So, remove the author_name field from book table with a migration, remove it from strong params in controller, and add the next method to the book model:</p>\n\n<pre><code>def author_name\n  self.author.name\nend\n</code></pre>\n\n<p>This should work</p>\n"}, {"tags": [], "owner": {"reputation": 446, "user_id": 8356015, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PaYtW.jpg?s=128&g=1", "display_name": "Ravi Teja Dandu", "link": "https://stackoverflow.com/users/8356015/ravi-teja-dandu"}, "is_accepted": false, "score": 0, "last_activity_date": 1534836550, "creation_date": 1534836550, "answer_id": 51943656, "question_id": 51937533, "link": "https://stackoverflow.com/questions/51937533/rails-created-params-not-saving-correctly/51943656#51943656", "title": "Rails: Created params not saving correctly", "body": "<p>Two ways you can fix this:</p>\n\n<pre><code>before_create :set_author_name\n</code></pre>\n\n<p>OR</p>\n\n<pre><code>before_validation(on: :create) do\n  set_author_name\nend\n</code></pre>\n\n<p>And define the method as follows inside book model:</p>\n\n<pre><code>def set_author_name\n  self.author_name = self.author.name\nend\n</code></pre>\n\n<p>Another point, it should be <code>belongs_to :author</code> instead of <code>has_one :author</code> in your Book model.</p>\n\n<p>Hope this helps.</p>\n"}], "owner": {"reputation": 1512, "user_id": 5513336, "user_type": "registered", "accept_rate": 16, "profile_image": "https://i.stack.imgur.com/bc7pn.jpg?s=128&g=1", "display_name": "Leia_Organa", "link": "https://stackoverflow.com/users/5513336/leia-organa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1534836550, "creation_date": 1534794159, "question_id": 51937533, "link": "https://stackoverflow.com/questions/51937533/rails-created-params-not-saving-correctly", "title": "Rails: Created params not saving correctly", "body": "<p>I'm practicing building a Rails application. I am trying to build an application that uses authors and books. The purpose of the app is to have a display page for Books, a display page for Authors, and some links that connect the two. I almost have it ready. My only issue is, whenever I try to save the name of the author, it is being saved as a link to the author's page.</p>\n\n<p>Here is what I am starting with:\nschema.rb</p>\n\n<pre><code>ActiveRecord::Schema.define do\n\n  create_table \"books\", force: :cascade do |t|\n    t.string   \"title\"\n    t.integer  \"author_id\"\n    t.string   \"author_name\"\n    t.index [\"title\"], name: \"index_books_on_title\", unique: true\n  end\n\n  create_table \"authors\", force: :cascade do |t|\n    t.string   \"name\"\n    t.string   \"bio\"\n  end\n\nend\n</code></pre>\n\n<p>Here are my sample data in seeds.rb</p>\n\n<pre><code>books = [\n  {title:\"Ruby Programming\", author_id: 1, author_name: \"John Smith\"},\n{title:\"Java Programming\", author_id: 2 , author_name: \"Jane Adams\"},\n{title:\"PHP Programming\", author_id: 3, author_name: \"Mike Jones\"},\n{title:\"Python Programming\", author_id: 1, author_name: \"John Smith\"}\n]\n\nauthors = [\n  {name:\"John Smith\", bio: \"John Smith loves Ruby and Python\"},\n  {name:\"Jane Adams\", bio: \"Jane Adams loves Java\"},\n  {name:\"Mike Jones\", bio: \"Mike Jones loves PHP\"}\n]\n</code></pre>\n\n<p>Here is my books_controller.rb</p>\n\n<pre><code>class BooksController &lt; ApplicationController\n  def index\n    @books = Books.all\n    if params[:search]\n      @books = Book.search(params[:search]).order(\"created_at DESC\")\n    else\n      @books = Book.all.order(\"created_at DESC\")\n    end\n\n  end\n\n  def show\n    @book = Book.find(params[:id])\n  end\n\n  def new\n    @book = Book.new\n  end\n\n  def create\n    @book = Book.new(book_params)\n\n    if(@book.save)\n      redirect_to @book\n    else\n      render 'already_exists'\n    end\n  end\n\n  private def book_params\n    params.require(:book).permit(:id, :title, :author_id, :author_name)\n  end\n\nend\n</code></pre>\n\n<p>Here is my author_controller.rb</p>\n\n<pre><code>class AuthorsController &lt; ApplicationController\n  def index\n    @authors = Author.all\n  end\n\n  def show\n    @author = Author.find(params[:id])\n  end\n\nend\n</code></pre>\n\n<p>Here is my models/book.rb</p>\n\n<pre><code>class Book &lt; ApplicationRecord\n    has_one :author\n    validates :title, presence:true, length: {minimum:1}\nend\n</code></pre>\n\n<p>And here is my models/author.rb</p>\n\n<pre><code>class Superpower &lt; ApplicationRecord\n    has_many :books\nend\n</code></pre>\n\n<p>So, I am trying to make it so that users can create a new book with one of the selected authors. After creating the book, they will be redirected back to a new page that will display the book's title and the author's name (which will link back to the the author's page with their bio).</p>\n\n<p>Here is views/books/new.html.erb</p>\n\n<pre><code>&lt;h1&gt; Add Book &lt;/h1&gt;\n\n&lt;%= form_for :book, url: books_path do |f| %&gt;\n\n    &lt;p&gt;\n    &lt;%= f.label :title %&gt; &lt;br&gt;\n    &lt;%= f.text_field :title %&gt;\n    &lt;/p&gt;\n\n    &lt;p&gt;\n    &lt;%= f.label :author_id, \"Author\" %&gt; &lt;br&gt;\n    &lt;%= collection_select(:book, :author_id, Author.all, :id, :name, {:prompt =&gt; 'Please select'}, class: 'form-control' ) %&gt;\n    &lt;/p&gt;\n\n    &lt;p&gt;\n    &lt;%= f.submit %&gt;\n    &lt;p&gt;\n    &lt;% end %&gt;\n</code></pre>\n\n<p>Here is views/book/show.html.erb</p>\n\n<pre><code>&lt;h2&gt; Title: &lt;%= @book.title %&gt; &lt;/h2&gt;\n\n&lt;h2&gt; Author: &lt;%= link_to @book.author_name, author_path(@book.author_id) %&gt; &lt;/h2&gt;\n\n&lt;p&gt; &lt;%= link_to \"Go back to Books\", root_path %&gt; &lt;/p&gt;\n</code></pre>\n\n<p>But instead of displaying this:</p>\n\n<pre><code>Title: Ruby Programming\nAuthor: John Smith\n</code></pre>\n\n<p>I get this:</p>\n\n<pre><code>Title: Ruby Programming\nAuthor: authors/1\n</code></pre>\n\n<p>I suspect that this has something to do with my form for selecting authors, but I don't know why the \"author_name\" isn't saving as the author_name string, but as the direct link to the author's page. This error is messing up other parts of my application and i've been puzzling over it for a few days now. Can anyone assist?</p>\n"}, {"tags": ["ruby", "dns", "udp", "getaddrinfo"], "comments": [{"owner": {"reputation": 30418, "user_id": 823617, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DmWH1.png?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/823617/casper"}, "edited": false, "score": 1, "creation_date": 1534793328, "post_id": 51937235, "comment_id": 90824702, "body": "Someone else with a similar issue 4 years ago: <a href=\"https://bugs.ruby-lang.org/issues/9925\" rel=\"nofollow noreferrer\">bugs.ruby-lang.org/issues/9925</a>"}], "answers": [{"comments": [{"owner": {"reputation": 25294, "user_id": 61072, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/tYo7v.png?s=128&g=1", "display_name": "esilver", "link": "https://stackoverflow.com/users/61072/esilver"}, "edited": false, "score": 0, "creation_date": 1535028914, "post_id": 51937739, "comment_id": 90922005, "body": "FWIW, AWS has instructions specifically on how to install a DNS cache to avoid DNS resolution failures and service these requests locally: <a href=\"https://aws.amazon.com/premiumsupport/knowledge-center/dns-resolution-failures-ec2-linux/\" rel=\"nofollow noreferrer\">aws.amazon.com/premiumsupport/knowledge-center/&hellip;</a>"}], "tags": [], "owner": {"reputation": 7502, "user_id": 6368697, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yq4cG.jpg?s=128&g=1", "display_name": "Patrick Mevzek", "link": "https://stackoverflow.com/users/6368697/patrick-mevzek"}, "is_accepted": true, "score": 1, "last_activity_date": 1535030853, "last_edit_date": 1535030853, "creation_date": 1534795098, "answer_id": 51937739, "question_id": 51937235, "link": "https://stackoverflow.com/questions/51937235/why-does-udpsocket-send-always-call-getaddrinfo-in-ruby/51937739#51937739", "title": "Why does UDPSocket.send always call getaddrinfo in Ruby?", "body": "<p><code>getaddrinfo</code> does not return data about the TTL... because it may not have it at all in fact, as the resolution may not necessarily be done over the DNS (could be <code>hosts</code> file, LDAP, etc. see <code>/etc/nsswitch.conf</code>)</p>\n\n<p>From its manual here is the structure returned:</p>\n\n<blockquote>\n<pre><code>int getaddrinfo(const char *hostname, const char *servname, const struct addrinfo *hints, struct addrinfo **res);\n\n struct addrinfo {\n         int ai_flags;           /* input flags */\n         int ai_family;          /* protocol family for socket */\n         int ai_socktype;        /* socket type */\n         int ai_protocol;        /* protocol for socket */\n         socklen_t ai_addrlen;   /* length of socket-address */\n         struct sockaddr *ai_addr; /* socket-address for socket */\n         char *ai_canonname;     /* canonical name for service location */\n         struct addrinfo *ai_next; /* pointer to next in list */\n };\n</code></pre>\n  \n  <p>After a successful call to getaddrinfo(), *res is a pointer to a linked list of one or more addrinfo structures.</p>\n</blockquote>\n\n<p>So it is up to the thing \"behind\" <code>getaddrinfo</code> to do some caching or not, because <code>getaddrinfo</code> may have used the DNS to retrieve data, or not.</p>\n\n<p>Some specific API for DNS, like <code>getdnsapi</code> will give back to the caller some information on the TTL, see <a href=\"https://getdnsapi.net/documentation/spec/\" rel=\"nofollow noreferrer\">https://getdnsapi.net/documentation/spec/</a> and example 6.2</p>\n\n<blockquote>\n  <p>6\u00b72 Get IPv4 and IPv6 Addresses for a Domain Name</p>\n  \n  <p>This example is similar to the previous one, except that it retrieves more  information than just the addresses, so it traverses the replies_tree. In this case, it gets both the addresses and their TTLs.</p>\n</blockquote>\n\n<p>Without any cache layer anywhere, since UDP is stateless, any new <code>send</code> must trigger resolution in some way or form.</p>\n\n<p>You said:</p>\n\n<blockquote>\n  <p>\"modified this code to use the internal IP address, not the DNS name\" </p>\n</blockquote>\n\n<p>You should instead install a local (on the box) recursive caching nameserver, such as <code>unbound</code>. All your local applications will benefit from it, and a faster DNS resolution (depending on how <code>/etc/nsswitch.conf</code>, <code>/etc/resolv.conf</code> and <code>/etc/hosts</code> are setup also).</p>\n\n<p>For the associated bug report hinted by @Casper it seems at its core more an issue about  IPv6 vs IPv4 which could be solved either by adjusting <code>/etc/gai.conf</code> or equivalent or doing some more clever programming around opening the connection, with the so called \"happy eyeball algorithm\" where you try to resolve both <code>A</code> and <code>AAAA</code> at the same time which means two parallel DNS queries (because you can not combine them into one per the protocol) and try to use the fastest one coming back, with a slight preference for <code>AAAA</code> if you want to be in the modern camp so you would fire the <code>A</code> one only some given amount of milliseconds after the <code>AAAA</code> to catch the case where you do not get a reply at all for <code>AAAA</code> or a negative one. See <a href=\"https://tools.ietf.org/html/rfc6555\" rel=\"nofollow noreferrer\">RFC6555</a> for details.</p>\n"}], "owner": {"reputation": 25294, "user_id": 61072, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/tYo7v.png?s=128&g=1", "display_name": "esilver", "link": "https://stackoverflow.com/users/61072/esilver"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 0, "accepted_answer_id": 51937739, "answer_count": 1, "score": 3, "last_activity_date": 1535030853, "creation_date": 1534792878, "question_id": 51937235, "link": "https://stackoverflow.com/questions/51937235/why-does-udpsocket-send-always-call-getaddrinfo-in-ruby", "title": "Why does UDPSocket.send always call getaddrinfo in Ruby?", "body": "<p>I just solved a latency issue in our infrastructure that was triggered because this code snippet here triggered a call to <code>getaddrinfo</code> on every run of the code:</p>\n\n<pre><code>sock = UDPSocket.open\nsock.send(\"#{key}|#{value}\", 0,\n          GRAPHITE_SERVER,\n          STATSD_PORT)\nsock.close\n</code></pre>\n\n<p>Because we use <a href=\"https://github.com/etsy/statsd\" rel=\"nofollow noreferrer\">statsd and graphite</a> for high-volume event and stats monitoring, we were effectively triggering numerous calls <code>getaddrinfo</code> on every API call, and potentially tens of thousands every minute. </p>\n\n<p>I modified this code to use the internal IP address, not the DNS name, of our graphite server, and was able to resolve the latency issue (presumably because the internal AWS VPC DNS server was not equipped to handle such a high volume of requests).</p>\n\n<p>Now that my issue is resolved, I would love to know why the UDP implementation in Ruby is not using a cached IP address value (presumably based on the TTL of the domain name entry). <a href=\"https://github.com/ruby/ruby/blob/96db72ce38b27799dd8e80ca00696e41234db6ba/ext/socket/udpsocket.c#L212\" rel=\"nofollow noreferrer\">Here is the relevant line</a> and the function in full, you can see the call to <a href=\"https://github.com/ruby/ruby/blob/8099b9279b7401fa393385611a4c159900582105/ext/socket/raddrinfo.c#L547\" rel=\"nofollow noreferrer\"><code>rsock_addrinfo</code></a> just at the end:</p>\n\n<pre><code>static VALUE\nudp_send(int argc, VALUE *argv, VALUE sock)\n{\n    VALUE flags, host, port;\n    struct udp_send_arg arg;\n    VALUE ret;\n\n    if (argc == 2 || argc == 3) {\n    return rsock_bsock_send(argc, argv, sock);\n    }\n    rb_scan_args(argc, argv, \"4\", &amp;arg.sarg.mesg, &amp;flags, &amp;host, &amp;port);\n\n    StringValue(arg.sarg.mesg);\n    GetOpenFile(sock, arg.fptr);\n    arg.sarg.fd = arg.fptr-&gt;fd;\n    arg.sarg.flags = NUM2INT(flags);\n    arg.res = rsock_addrinfo(host, port, rsock_fd_family(arg.fptr-&gt;fd), SOCK_DGRAM, 0);\n    ret = rb_ensure(udp_send_internal, (VALUE)&amp;arg,\n            rsock_freeaddrinfo, (VALUE)arg.res);\n    if (!ret) rsock_sys_fail_host_port(\"sendto(2)\", host, port);\n    return ret;\n}\n</code></pre>\n\n<p>I assume this decision is intentional and would love to learn more about the reasons why.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "regex", "validation", "ruby-on-rails-5"], "answers": [{"comments": [{"owner": {"reputation": 564, "user_id": 651314, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/c3925ca02512cb9e6517b27861797afd?s=128&d=identicon&r=PG&f=1", "display_name": "Kobius", "link": "https://stackoverflow.com/users/651314/kobius"}, "edited": false, "score": 0, "creation_date": 1534793125, "post_id": 51937085, "comment_id": 90824604, "body": "This looks great! Can I ask, if I needed to extend this to allow lowercase letters only, would I simply remove the &quot;A-Z&quot;?"}, {"owner": {"reputation": 481662, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "reply_to_user": {"reputation": 564, "user_id": 651314, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/c3925ca02512cb9e6517b27861797afd?s=128&d=identicon&r=PG&f=1", "display_name": "Kobius", "link": "https://stackoverflow.com/users/651314/kobius"}, "edited": false, "score": 0, "creation_date": 1534793153, "post_id": 51937085, "comment_id": 90824615, "body": "@Kobius Yes, that is all you need to do then."}, {"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1534793193, "post_id": 51937085, "comment_id": 90824631, "body": "This answer is great, but I have to add... It might be far more sensible/*useful*/pragmatic to define a custom validation class and perform each of these checks as smaller, simpler methods."}, {"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1534793229, "post_id": 51937085, "comment_id": 90824646, "body": "For instance, it may be desirable to display a different error message for each failing condition, in order to explain <i>why</i> validation has failed. Not to mention how it would be much easier to alter this code, if you&#39;re not super comfortable with regex, if the check isn&#39;t all performed in one go like this."}, {"owner": {"reputation": 481662, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "reply_to_user": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1534793426, "post_id": 51937085, "comment_id": 90824737, "body": "@TomLord I was just answerinhg the question. I think that comment should go below the original question."}, {"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1534793464, "post_id": 51937085, "comment_id": 90824754, "body": "Also, a minor point: This regex disallows underscores followed by a period, or a period followed by an underscore. (e.g. <code>foo._bar</code> and <code>foo_.bar</code> are both disallowed.) This may well be desirable, but was not specified in the original question."}, {"owner": {"reputation": 564, "user_id": 651314, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/c3925ca02512cb9e6517b27861797afd?s=128&d=identicon&r=PG&f=1", "display_name": "Kobius", "link": "https://stackoverflow.com/users/651314/kobius"}, "reply_to_user": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1534793856, "post_id": 51937085, "comment_id": 90824928, "body": "@TomLord curious, what&#39;s the best practice for setting this up as a validation class?"}, {"owner": {"reputation": 481662, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "reply_to_user": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1534793868, "post_id": 51937085, "comment_id": 90824935, "body": "@TomLord Yes, that is expected behavior in 96% of questions of this kind."}], "tags": [], "owner": {"reputation": 481662, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 4, "last_activity_date": 1534792135, "creation_date": 1534792135, "answer_id": 51937085, "question_id": 51937037, "link": "https://stackoverflow.com/questions/51937037/rails-usernames-that-cannot-start-or-end-with-characters/51937085#51937085", "title": "Rails - Usernames that cannot start or end with characters", "body": "<p>You may use</p>\n\n<pre><code>/\\A(?=.{3,28}\\z)[a-zA-Z0-9]+(?:[._][a-zA-Z0-9]+)*\\z/\n</code></pre>\n\n<p>See the <a href=\"http://rubular.com/r/ASdmzBCNfA\" rel=\"nofollow noreferrer\">Rubular demo</a>.</p>\n\n<p><strong>Details</strong></p>\n\n<ul>\n<li><code>\\A</code> - start of string</li>\n<li><code>(?=.{3,28}\\z)</code> - 3 to 28 chars other than line break chars up to the end of the string are allowed/required</li>\n<li><code>[a-zA-Z0-9]+</code> - one or more ASCII letters / digits</li>\n<li><code>(?:[._][a-zA-Z0-9]+)*</code> - 0+ sequences of:\n\n<ul>\n<li><code>[._]</code> - a <code>.</code> or <code>_</code></li>\n<li><code>[a-zA-Z0-9]+</code> - one or more ASCII letters / digits</li>\n</ul></li>\n<li><code>\\z</code>  - end of string.</li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 76, "user_id": 2417177, "user_type": "registered", "profile_image": "https://graph.facebook.com/1433785509/picture?type=large", "display_name": "Martin Neiiendam", "link": "https://stackoverflow.com/users/2417177/martin-neiiendam"}, "edited": false, "score": 0, "creation_date": 1534806262, "post_id": 51937776, "comment_id": 90829108, "body": "This also makes it easier to write the relevant test cases. Here, test coverage will actually show you if you&#39;ve hit all cases."}, {"owner": {"reputation": 564, "user_id": 651314, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/c3925ca02512cb9e6517b27861797afd?s=128&d=identicon&r=PG&f=1", "display_name": "Kobius", "link": "https://stackoverflow.com/users/651314/kobius"}, "edited": false, "score": 0, "creation_date": 1534816379, "post_id": 51937776, "comment_id": 90830928, "body": "Really appreciate this - huge eye-opener for me. Will definitely give us more flexibility when it comes to testing, and great to see both methods alongside each other to compare."}], "tags": [], "owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "is_accepted": false, "score": 2, "last_activity_date": 1534795735, "last_edit_date": 1534795735, "creation_date": 1534795322, "answer_id": 51937776, "question_id": 51937037, "link": "https://stackoverflow.com/questions/51937037/rails-usernames-that-cannot-start-or-end-with-characters/51937776#51937776", "title": "Rails - Usernames that cannot start or end with characters", "body": "<p>Although totally possible, as Wiktor's answer shows, my recommendation would be to <strong>not</strong> define this in a single regular expression, since:</p>\n\n<ul>\n<li>The solution is quite confusing to understand, unless you know regular expressions quite well.</li>\n<li>Similarly, the solution is quite difficult to <em>update with new requirements</em>, unless you understand regular expressions quite well.</li>\n<li>By performing this entire check in one go, if a validation fails then you'll inevitably end up with one generic error message, e.g. <code>\"Invalid Format\"</code>, which does not explain <em>why</em> it's invalid. The exercise is then left to the user to re-read the nontrivial format rules and understand why.</li>\n</ul>\n\n<p>Instead, I would recommend defining a <a href=\"https://guides.rubyonrails.org/active_record_validations.html#custom-validators\" rel=\"nofollow noreferrer\">custom validation class</a>, which can perform each of these checks separately (via easy to understand methods), and add a different error message upon each check failing.</p>\n\n<p>Something along the lines of:</p>\n\n<pre><code># app/models/user.rb\nclass User &lt; ApplicationRecord\n  validates :username, presence: true, username: true\nend\n\n# app/validators/username_validator.rb\nclass UsernameValidator &lt; ActiveModel::EachValidator\n  def validate(record, attribute, value)\n    validate_length(record, attribute, value)\n    validate_allowed_chars(record, attribute, value)\n    validate_sequential_chars(record, attribute, value)\n    validate_first_and_last_chars(record, attribute, value)\n  end\n\nprivate\n\n  def validate_length(record, attribute, value)\n    unless value.length &gt;= 3 &amp;&amp; value.length &lt;= 28\n      record.errors[attribute] &lt;&lt; \"must be between 3 and 28 characters long\"\n    end\n  end\n\n  def validate_allowed_chars(record, attribute, value)\n    unless value =~ /\\A[._a-zA-Z0-9]*\\z/\n      record.errors[attribute] &lt;&lt; \"must only contain periods, underscores, a-z, A-Z or 0-9\"\n    end\n  end\n\n  def validate_sequential_chars(record, attribute, value)\n    if value =~ /[._]{2}/\n      record.errors[attribute] &lt;&lt; \"cannot contain two consecutive periods or underscores\"\n    end\n  end\n\n  def validate_first_and_last_chars(record, attribute, value)\n    if value =~ /\\A[._]/ || value =~ /[._]\\z/\n      record.errors[attribute] &lt;&lt; \"cannot start/end with a period or underscore\"\n    end\n  end\nend\n</code></pre>\n\n<p>So for instance, you asked above: \"What if I needed to extend this to allow lowercase letters only?\" I think it's now quite obvious how the code could be updated to accommodate such behaviour, but to be clear - all you'd need to do is:</p>\n\n<pre><code>def validate_allowed_chars(record, attribute, value)\n  unless value =~ /\\A[._a-z0-9]*\\z/\n    record.errors[attribute] &lt;&lt; \"must only contain periods, underscores, a-z or 0-9\"\n  end\nend\n</code></pre>\n\n<p>You could also now, quite easily, write <strong>tests</strong> for these validation checks, and assert that the correct validation is being performed by <em>verifying against the contents of the error message</em>; something that is not possible when all validation failures result in the same error,</p>\n\n<p>Another benefit to this approach is that the code can easily be shared (perhaps with some slight behavioural differences). You could perform the same validation on multiple attributes, or multiple models, perhaps with different allowed lengths or formats.</p>\n"}], "owner": {"reputation": 564, "user_id": 651314, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/c3925ca02512cb9e6517b27861797afd?s=128&d=identicon&r=PG&f=1", "display_name": "Kobius", "link": "https://stackoverflow.com/users/651314/kobius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 1, "accepted_answer_id": 51937085, "answer_count": 2, "score": 2, "last_activity_date": 1534795735, "creation_date": 1534791926, "question_id": 51937037, "link": "https://stackoverflow.com/questions/51937037/rails-usernames-that-cannot-start-or-end-with-characters", "title": "Rails - Usernames that cannot start or end with characters", "body": "<p>Originally asked this question about Regex for Usernames: <a href=\"https://stackoverflow.com/questions/51814037/usernames-that-cannot-start-or-end-with-characters\">Usernames that cannot start or end with characters</a></p>\n\n<p>How can I achieve this with correct syntax for Ruby on Rails?</p>\n\n<p>Here's my current User.rb validation:</p>\n\n<pre><code>validates_format_of :username, with: /\\A[\\w\\._]{3,28}\\z/i\n</code></pre>\n\n<p>This validation allows underscores and periods, but the goal is to not allow them at the start or end of a username.</p>\n\n<p>I'm trying to achieve these rules with Rails regex:</p>\n\n<ul>\n<li>Can contain lowercase and uppercase letters and numbers</li>\n<li>Can contain underscores and periods</li>\n<li>Cannot contain 2 underscores in a row</li>\n<li>Cannot contain 2 periods in a row</li>\n<li><strong>Cannot begin or end with an underscore or period</strong></li>\n<li>Cannot contain letters with accents</li>\n<li>Must be between 3 and 28 letters in length</li>\n</ul>\n\n<p>Valid:</p>\n\n<pre><code>Spicy_Pizza\n97Indigos\nInfinity.Beyond\n</code></pre>\n\n<p>Invalid:</p>\n\n<pre><code>_yahoo\npowerup.\nun__real\nno..way\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "queue", "resque"], "comments": [{"owner": {"reputation": 2072, "user_id": 3389795, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LiAJt.jpg?s=128&g=1", "display_name": "Shiko", "link": "https://stackoverflow.com/users/3389795/shiko"}, "edited": false, "score": 0, "creation_date": 1534806473, "post_id": 51936886, "comment_id": 90829150, "body": "How did you run the app? you need to start the worker  <b>$ QUEUE= my_worker_queue rake resque:work</b>"}, {"owner": {"reputation": 59, "user_id": 9824506, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-qVytqo64a4U/AAAAAAAAAAI/AAAAAAAAAWU/q8K_lR7dq5k/photo.jpg?sz=128", "display_name": "Raynor", "link": "https://stackoverflow.com/users/9824506/raynor"}, "reply_to_user": {"reputation": 2072, "user_id": 3389795, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LiAJt.jpg?s=128&g=1", "display_name": "Shiko", "link": "https://stackoverflow.com/users/3389795/shiko"}, "edited": false, "score": 0, "creation_date": 1534855981, "post_id": 51936886, "comment_id": 90847969, "body": "I start it by starting the rails server and posting to a table, which is supposed to enqueue a worker with Resque.enqueue"}], "answers": [{"tags": [], "owner": {"reputation": 686, "user_id": 1491410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c938ed150a685b33d1b91266b382c8d?s=128&d=identicon&r=PG", "display_name": "elliotcm", "link": "https://stackoverflow.com/users/1491410/elliotcm"}, "is_accepted": true, "score": 1, "last_activity_date": 1534939504, "creation_date": 1534939504, "answer_id": 51966485, "question_id": 51936886, "link": "https://stackoverflow.com/questions/51936886/resque-jobs-must-be-placed-onto-a-queue-no-queue-could-be-inferred-for-class-w/51966485#51966485", "title": "Resque: Jobs must be placed onto a queue. No queue could be inferred for class Worker", "body": "<p>Resque requires you to set the class-level instance variable with the queue name.  That's what your <code>self.queue</code> method does, but it'll only do it if you actually call it.</p>\n\n<p>The easier option is to remove the <code>self.queue</code> method and put <code>@queue = :my_worker_queue</code> at the top of the class itself.</p>\n\n<p>So it would be something like</p>\n\n<pre><code>class Worker\n  @queue = :my_worker_queue\n\n  def self.perform\n    # do your stuff\n  end\nend\n</code></pre>\n\n<p>More information:\n<a href=\"http://tutorials.jumpstartlab.com/topics/performance/background_jobs.html\" rel=\"nofollow noreferrer\">http://tutorials.jumpstartlab.com/topics/performance/background_jobs.html</a></p>\n"}], "owner": {"reputation": 59, "user_id": 9824506, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-qVytqo64a4U/AAAAAAAAAAI/AAAAAAAAAWU/q8K_lR7dq5k/photo.jpg?sz=128", "display_name": "Raynor", "link": "https://stackoverflow.com/users/9824506/raynor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 825, "favorite_count": 0, "accepted_answer_id": 51966485, "answer_count": 1, "score": 0, "last_activity_date": 1534939504, "creation_date": 1534791121, "question_id": 51936886, "link": "https://stackoverflow.com/questions/51936886/resque-jobs-must-be-placed-onto-a-queue-no-queue-could-be-inferred-for-class-w", "title": "Resque: Jobs must be placed onto a queue. No queue could be inferred for class Worker", "body": "<p>I'm working on a rails app which involves using Resque. I have my queue defined in the worker class.</p>\n\n<pre><code>def self.queue\n  @queue = :my_worker_queue\nend\n</code></pre>\n\n<p>However I'm still getting</p>\n\n<blockquote>\n  <p>Jobs must be placed onto a queue. No queue could be inferred for class Worker</p>\n</blockquote>\n\n<p>Any ideas about how a queue should be defined? Thanks!</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-4"], "comments": [{"owner": {"reputation": 34222, "user_id": 881559, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/K8wbX.png?s=128&g=1", "display_name": "Abram", "link": "https://stackoverflow.com/users/881559/abram"}, "edited": false, "score": 0, "creation_date": 1534782820, "post_id": 51934968, "comment_id": 90820089, "body": "See comments on answer to see why I&#39;m closing."}], "answers": [{"comments": [{"owner": {"reputation": 34222, "user_id": 881559, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/K8wbX.png?s=128&g=1", "display_name": "Abram", "link": "https://stackoverflow.com/users/881559/abram"}, "edited": false, "score": 0, "creation_date": 1534782724, "post_id": 51934992, "comment_id": 90820036, "body": "Ah, I feel like a dumbass now, thanks. I&#39;m going to remove this question since it really doesn&#39;t solve any problems other than reminding me how to write basic ruby array creators."}, {"owner": {"reputation": 34222, "user_id": 881559, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/K8wbX.png?s=128&g=1", "display_name": "Abram", "link": "https://stackoverflow.com/users/881559/abram"}, "edited": false, "score": 0, "creation_date": 1534782769, "post_id": 51934992, "comment_id": 90820061, "body": "Oops I can&#39;t delete it, I guess I&#39;ll just vote to close."}, {"owner": {"reputation": 9971, "user_id": 8255744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de22299534b5a8ed244ee8ff4aa6c481?s=128&d=identicon&r=PG&f=1", "display_name": "Simple Lime", "link": "https://stackoverflow.com/users/8255744/simple-lime"}, "reply_to_user": {"reputation": 34222, "user_id": 881559, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/K8wbX.png?s=128&g=1", "display_name": "Abram", "link": "https://stackoverflow.com/users/881559/abram"}, "edited": false, "score": 1, "creation_date": 1534782874, "post_id": 51934992, "comment_id": 90820115, "body": "yeah usually I just leave a comment and VTC as a typo for questions like this, but honestly this specific error (commas in <code>%w()</code> has come up a ton (especially recently)) so the &quot;resolved in a way unlikely to help future readers&quot; part of that clause doesn&#39;t seem to be fitting, so decided to go with an actual answer this time"}], "tags": [], "owner": {"reputation": 9971, "user_id": 8255744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de22299534b5a8ed244ee8ff4aa6c481?s=128&d=identicon&r=PG&f=1", "display_name": "Simple Lime", "link": "https://stackoverflow.com/users/8255744/simple-lime"}, "is_accepted": false, "score": 4, "last_activity_date": 1534782569, "creation_date": 1534782569, "answer_id": 51934992, "question_id": 51934968, "link": "https://stackoverflow.com/questions/51934968/sanitizehelper-removes-permitted-tags/51934992#51934992", "title": "SanitizeHelper removes permitted tags", "body": "<p>When using the special array creators (such as <code>%w()</code> you don't want to use commas:</p>\n\n<pre><code>%w(p, strong, em, a, blockquote, img, ol, ul, li)\n# =&gt; [\"p,\", \"strong,\", \"em,\", \"a,\", \"blockquote,\", \"img,\", \"ol,\", \"ul,\", \"li\"]\n</code></pre>\n\n<p>Remove those and things should start working for you. (You'll note that <code>li</code> worked, because as the last element, it didn't contain a trailing comma)</p>\n"}], "owner": {"reputation": 34222, "user_id": 881559, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/K8wbX.png?s=128&g=1", "display_name": "Abram", "link": "https://stackoverflow.com/users/881559/abram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "closed_date": 1534784745, "answer_count": 1, "score": 0, "last_activity_date": 1534783837, "creation_date": 1534782465, "last_edit_date": 1534783837, "question_id": 51934968, "link": "https://stackoverflow.com/questions/51934968/sanitizehelper-removes-permitted-tags", "closed_reason": "Not suitable for this site", "title": "SanitizeHelper removes permitted tags", "body": "<p>Here is a sample comment I'm trying to sanitize:</p>\n\n<p><code>\"&lt;p&gt;&lt;strong&gt;hello&lt;/strong&gt;&lt;em&gt;&lt;/em&gt; &lt;em&gt;there&lt;/em&gt; &lt;a href=\\\"https://google.com\\\" title=\\\"Test\\\" target=\\\"_blank\\\"&gt;whats&lt;/a&gt; up?&lt;/p&gt;&lt;p&gt;&lt;ul&gt;&lt;li&gt;this&amp;nbsp;&lt;/li&gt;&lt;li&gt;is a&lt;/li&gt;&lt;li&gt;list&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;and then there was more&lt;/p&gt;&lt;p&gt;&lt;ol&gt;&lt;li&gt;do this&lt;/li&gt;&lt;li&gt;do that&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;&lt;img src=\\\"https://google.com\\\" alt=\\\"\\\"&gt;&lt;br&gt;&lt;/p&gt;&lt;/p&gt;&lt;/p&gt;\"\n</code></p>\n\n<p>I tried sanitizing with this command:</p>\n\n<p><code>sanitize comment.text, tags: %w(p, strong, em, a, blockquote, img, ol, ul, li), attributes: %w(href, target, title)</code></p>\n\n<p>Output is:</p>\n\n<p><code>\"hello there whats up?&lt;li&gt;this\u00a0&lt;/li&gt;&lt;li&gt;is a&lt;/li&gt;&lt;li&gt;list&lt;/li&gt;and then there was more&lt;li&gt;do this&lt;/li&gt;&lt;li&gt;do that&lt;/li&gt;\"</code></p>\n\n<p>As you can see the <code>li</code> elements aren't nested in their respective ordered and unordered lists, and all the other tags I tried to permit are removed too.</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 1081, "user_id": 1288687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7217dd12520210182c093856f60cd376?s=128&d=identicon&r=PG", "display_name": "knugie", "link": "https://stackoverflow.com/users/1288687/knugie"}, "edited": false, "score": 0, "creation_date": 1534781740, "post_id": 51934670, "comment_id": 90819559, "body": "<code>access_control</code> looks suspicious to me... could check file permissions and more of your console output here?"}], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 10105345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/927d1524156d75dbceefd4b9884e473f?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/10105345/john"}, "edited": false, "score": 0, "creation_date": 1534783171, "post_id": 51934996, "comment_id": 90820267, "body": "So running <code>rails</code> just gives me a command not found, but yes, it is Ruby on Rails. What&#39;s going on here?  Regarding your second paragraph, do I take this to mean &quot;forget about it&quot;?"}, {"owner": {"reputation": 4052, "user_id": 476979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e55df1cc7d5fdb4ae9bc2afcb9afe7e4?s=128&d=identicon&r=PG", "display_name": "matthewd", "link": "https://stackoverflow.com/users/476979/matthewd"}, "reply_to_user": {"reputation": 37, "user_id": 10105345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/927d1524156d75dbceefd4b9884e473f?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/10105345/john"}, "edited": false, "score": 0, "creation_date": 1534784191, "post_id": 51934996, "comment_id": 90820760, "body": "You could try <code>bundle exec rails [..]</code>, but it sound like you may not have Rails installed? Try <code>bundle install</code> first. The second point is more &quot;check this is how the thing you&#39;re trying to load is intended to be run/used&quot;."}], "tags": [], "owner": {"reputation": 4052, "user_id": 476979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e55df1cc7d5fdb4ae9bc2afcb9afe7e4?s=128&d=identicon&r=PG", "display_name": "matthewd", "link": "https://stackoverflow.com/users/476979/matthewd"}, "is_accepted": false, "score": 0, "last_activity_date": 1534782575, "creation_date": 1534782575, "answer_id": 51934996, "question_id": 51934670, "link": "https://stackoverflow.com/questions/51934670/loaderror-for-custom-ruby-module/51934996#51934996", "title": "LoadError for custom Ruby module", "body": "<p>It sounds like you have a Ruby on Rails application.</p>\n\n<p>Given that, you probably don't want to run any contained script directly with <code>ruby</code>. <em>If</em> it's designed to be executed directly, try running it with <code>rails runner path/to/file.rb</code> (from inside the directory that contains <code>app/</code>, <code>lib/</code>, <code>config/</code>, etc).</p>\n\n<p>If it's inside <code>app/</code> or <code>lib/</code>, though, it's more likely intended to be loaded as a library from some other script elsewhere in the application... those would both be unusual places to keep a stand-alone executable.</p>\n"}], "owner": {"reputation": 37, "user_id": 10105345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/927d1524156d75dbceefd4b9884e473f?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/10105345/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 28, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1534782575, "creation_date": 1534781376, "question_id": 51934670, "link": "https://stackoverflow.com/questions/51934670/loaderror-for-custom-ruby-module", "title": "LoadError for custom Ruby module", "body": "<p>I am new to Ruby. I am dealing with a codebase of the following nature.</p>\n\n<p>I have a <code>main/</code> directory containing my entire codebase, and inside it I have files like:\n<code>main/lib/foo/test1.rb</code> and\n<code>main/app/bar/test2.rb</code></p>\n\n<p>Inside <code>main/app/bar/test2.rb</code> there is the line: <code>require 'test1'</code></p>\n\n<p>However, if I am in the <code>main/</code> directory and I run <code>ruby main/app/bar/test2.rb</code> I get the following error: <code>require': cannot load such file -- access_control (LoadError)</code></p>\n\n<p>Now, upon Googling, I think this has something to do with <code>/config/application.rb</code> and adding the line: <code>config.autoload_paths += Dir[\"#{config.root}/lib\", \"#{config.root}/lib/**/\"</code>. I do this, but it doesn't seem to make any difference.</p>\n\n<p>Presumably my production environment knows where to look in the <code>require 'test1.rb'</code> statement, while my environment does not. How can I fix this?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["ruby", "rspec"], "comments": [{"owner": {"reputation": 21010, "user_id": 2019247, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/MnZYd.jpg?s=128&g=1", "display_name": "31piy", "link": "https://stackoverflow.com/users/2019247/31piy"}, "edited": false, "score": 0, "creation_date": 1534778700, "post_id": 51933941, "comment_id": 90817935, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/6002839/initialize-two-variables-on-same-line\">Initialize two variables on same line</a>"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1534779297, "post_id": 51933941, "comment_id": 90818274, "body": "Which comma are you asking about, the first line or the second?"}, {"owner": {"reputation": 71, "user_id": 6732285, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cddb17da90c633af1aaf471016e3717e?s=128&d=identicon&r=PG&f=1", "display_name": "FuriousD", "link": "https://stackoverflow.com/users/6732285/furiousd"}, "edited": false, "score": 0, "creation_date": 1534779751, "post_id": 51933941, "comment_id": 90818508, "body": "On the second line."}], "answers": [{"comments": [{"owner": {"reputation": 71, "user_id": 6732285, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cddb17da90c633af1aaf471016e3717e?s=128&d=identicon&r=PG&f=1", "display_name": "FuriousD", "link": "https://stackoverflow.com/users/6732285/furiousd"}, "edited": false, "score": 0, "creation_date": 1534779687, "post_id": 51934181, "comment_id": 90818471, "body": "So in this case it would show the contents of the result variable.  Thanks."}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1534836229, "post_id": 51934181, "comment_id": 90836647, "body": "The documentation might be easier to read than the source code: <a href=\"https://relishapp.com/rspec/rspec-expectations/docs/customized-message\" rel=\"nofollow noreferrer\">relishapp.com/rspec/rspec-expectations/docs/customized-messa&zwnj;&#8203;ge</a> ;-)"}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1534841726, "post_id": 51934181, "comment_id": 90839485, "body": "@SergioTulentsev although relying on implementation rather than documented features can result in unreliable code ;-)"}], "tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": true, "score": 7, "last_activity_date": 1534836898, "last_edit_date": 1534836898, "creation_date": 1534779509, "answer_id": 51934181, "question_id": 51933941, "link": "https://stackoverflow.com/questions/51933941/what-does-a-comma-do-in-rspecs-expect-command/51934181#51934181", "title": "What does a comma do in RSpec&#39;s expect command?", "body": "<p>It's not so common, but <code>to</code> method can accept an additional argument, which is a message displayed, when the example is failed. Have a look at the <a href=\"https://github.com/rspec/rspec-expectations/blob/add9b271ecb1d65f7da5bc8a9dd8c64d81d92303/lib/rspec/expectations/handler.rb#L48\" rel=\"nofollow noreferrer\">source code</a>.</p>\n\n<p>Thus, a custom message can be provided with extra information, how to handle the failed spec:</p>\n\n<pre><code>expect(exit_code).to(eq(0), \"spec failed, because exit_code is 0, please handle it\")\n</code></pre>\n\n<p>The second argument, can be also a <code>proc</code>:</p>\n\n<pre><code>expect(exit_code).to(eq(0), -&gt; { \"expected zero, got: #{exit_code}\" })\n</code></pre>\n\n<p>Following @Stefan's comment, here's the <a href=\"http://relishapp.com/rspec/rspec-expectations/docs/customized-message\" rel=\"nofollow noreferrer\">documentation</a> about customizing failure messages.</p>\n"}], "owner": {"reputation": 71, "user_id": 6732285, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cddb17da90c633af1aaf471016e3717e?s=128&d=identicon&r=PG&f=1", "display_name": "FuriousD", "link": "https://stackoverflow.com/users/6732285/furiousd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 51934181, "answer_count": 1, "score": 3, "last_activity_date": 1534836898, "creation_date": 1534778590, "last_edit_date": 1534835988, "question_id": 51933941, "link": "https://stackoverflow.com/questions/51933941/what-does-a-comma-do-in-rspecs-expect-command", "title": "What does a comma do in RSpec&#39;s expect command?", "body": "<p>Given this code:</p>\n\n<pre><code>expect(exit_code).to eq(0), result\n</code></pre>\n\n<p>I understand what <code>expect(exit_code).to eq(0)</code> is supposed to do, but I don't understand what the comma or <code>result</code> variable are doing.  Could someone shed some light on that for me?</p>\n"}, {"tags": ["arrays", "ruby"], "comments": [{"owner": {"reputation": 9030, "user_id": 5101476, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JCQrl.jpg?s=128&g=1", "display_name": "ice\u30c4", "link": "https://stackoverflow.com/users/5101476/ice%e3%83%84"}, "edited": false, "score": 0, "creation_date": 1534778710, "post_id": 51933778, "comment_id": 90817940, "body": "I don&#39;t think your method works."}, {"owner": {"reputation": 3112, "user_id": 1863795, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c7feb49632e346fb86c4d13c503c2c73?s=128&d=identicon&r=PG", "display_name": "mylescc", "link": "https://stackoverflow.com/users/1863795/mylescc"}, "reply_to_user": {"reputation": 9030, "user_id": 5101476, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JCQrl.jpg?s=128&g=1", "display_name": "ice\u30c4", "link": "https://stackoverflow.com/users/5101476/ice%e3%83%84"}, "edited": false, "score": 0, "creation_date": 1534778984, "post_id": 51933778, "comment_id": 90818099, "body": "@SagarPandya can you explain why? Seems to work for the specs I&#39;ve written so far. Igor Drozdov&#39;s answer is a much better solution though."}, {"owner": {"reputation": 9030, "user_id": 5101476, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JCQrl.jpg?s=128&g=1", "display_name": "ice\u30c4", "link": "https://stackoverflow.com/users/5101476/ice%e3%83%84"}, "edited": false, "score": 0, "creation_date": 1534779236, "post_id": 51933778, "comment_id": 90818241, "body": "In your example using array <code>[[1,2,3],[2,4,5]]</code> I&#39;m getting <code>values #=&gt; []</code>"}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 1, "creation_date": 1534779330, "post_id": 51933778, "comment_id": 90818291, "body": "@mylescc (1) you never add anything to the <code>values</code> array (2) <code>ids</code> \u2013 being a local variable in the block&#39;s scope \u2013 will always be <code>nil</code> at the beginning of each iteration. Maybe your actual code looks different."}, {"owner": {"reputation": 3112, "user_id": 1863795, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c7feb49632e346fb86c4d13c503c2c73?s=128&d=identicon&r=PG", "display_name": "mylescc", "link": "https://stackoverflow.com/users/1863795/mylescc"}, "edited": false, "score": 0, "creation_date": 1534779429, "post_id": 51933778, "comment_id": 90818335, "body": "Ah sorry, my bad. I copied from my codebase but forgot to change all the variable names. I&#39;ll update my example. Thanks!"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1534782662, "post_id": 51933778, "comment_id": 90820014, "body": "Though the use of <code>reduce</code> is preferred, one could use recursion: <code>def recurse(arr); arr.size == 1 ? arr.first: arr.first &amp; recurse(arr.drop(1)); end; recurse([a,b,c]) #=&gt; [2]</code>."}], "answers": [{"comments": [{"owner": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 7, "creation_date": 1534778384, "post_id": 51933863, "comment_id": 90817735, "body": "OR <code>[[1,2,3], [2,4,5], [2,6,7]].reduce(:&amp;)</code>"}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1534779645, "post_id": 51933863, "comment_id": 90818455, "body": "Looking at the source code for <code>&amp;</code> it seems as if it <a href=\"https://github.com/ruby/ruby/blob/e82226953f5f2a30f19cbeb7149dd08001836ce4/array.c#L4228\" rel=\"nofollow noreferrer\">returns early</a> for <code>[1, 2, 3] &amp; []</code> but not for <code>[] &amp; [1, 2, 3]</code>. Is there an optimization missing?"}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "reply_to_user": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 1, "creation_date": 1534787995, "post_id": 51933863, "comment_id": 90822377, "body": "@Stefan: Looks that way. By the way, <a href=\"https://github.com/jruby/jruby/blob/master/core/src/main/java/org/jruby/RubyArray.java#L3459-L3461\" rel=\"nofollow noreferrer\">JRuby has the early return for both</a> while <a href=\"https://github.com/rubinius/rubinius/blob/master/core/array.rb#L364-L373\" rel=\"nofollow noreferrer\">Rubinius has it for neither</a>."}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "reply_to_user": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 1, "creation_date": 1534790223, "post_id": 51933863, "comment_id": 90823386, "body": "@J&#246;rgWMittag indeed, I&#39;ve opened a <a href=\"https://github.com/ruby/ruby/pull/1938\" rel=\"nofollow noreferrer\">pull request</a>"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "reply_to_user": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1534801582, "post_id": 51933863, "comment_id": 90827913, "body": "@Stefan, if <code>reduce</code> should short-circuit when its receiver is an array of arrays and its argument is <code>:&amp;</code>, then presumably it should do the same (for the same receiver) when its argument is <code>:-</code>. If the receiver were an array of numbers, should it short-circuit when its argument is <code>:*</code> or <code>:&#47;</code>? Perhaps we could come up with other examples. Could that be why <code>reduce</code> does not short-circuit at all?"}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "reply_to_user": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 1, "creation_date": 1534832066, "post_id": 51933863, "comment_id": 90834679, "body": "@CarySwoveland I don&#39;t think <code>reduce</code> should make any such assumptions. And it&#39;s hard (if not impossible) to short-circuit a method chain. IMO array manipulation methods that can work on an arbitrary number of arrays (like intersection and concatenation) should be (optimized) class methods, or at least there should be a class method variant, e.g. <code>Array.concat(a1, a2, ...)</code>."}], "tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": true, "score": 10, "last_activity_date": 1534778534, "last_edit_date": 1534778534, "creation_date": 1534778336, "answer_id": 51933863, "question_id": 51933778, "link": "https://stackoverflow.com/questions/51933778/finding-the-common-value-in-n-number-of-arrays/51933863#51933863", "title": "Finding the common value in N number of arrays", "body": "<blockquote>\n  <p>However, this isn't possible if you don't know the number of arrays.</p>\n</blockquote>\n\n<p>Actually, <a href=\"https://ruby-doc.org/core-2.1.0/Enumerable.html#method-i-reduce\" rel=\"noreferrer\">Enumerable#reduce</a> can help with it:</p>\n\n<pre><code>[[1,2,3], [2,4,5], [2,6,7]].reduce(&amp;:&amp;) # =&gt; [2]\n</code></pre>\n\n<p><code>&amp;:&amp;</code> looks interesting, but it's just:</p>\n\n<pre><code>[[1,2,3], [2,4,5], [2,6,7]].reduce { |memo, el| memo &amp; el } # =&gt; [2]\n</code></pre>\n\n<p>Or it's also possible to do it as @Jagdeep suggested:</p>\n\n<pre><code>[[1,2,3], [2,4,5], [2,6,7]].reduce(:&amp;) # =&gt; [2]\n</code></pre>\n"}], "owner": {"reputation": 3112, "user_id": 1863795, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c7feb49632e346fb86c4d13c503c2c73?s=128&d=identicon&r=PG", "display_name": "mylescc", "link": "https://stackoverflow.com/users/1863795/mylescc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 51933863, "answer_count": 1, "score": 3, "last_activity_date": 1534779441, "creation_date": 1534778081, "last_edit_date": 1534779441, "question_id": 51933778, "link": "https://stackoverflow.com/questions/51933778/finding-the-common-value-in-n-number-of-arrays", "title": "Finding the common value in N number of arrays", "body": "<p>I have <code>n</code> number of arrays and I want to work out if there is a common value in these arrays. If I knew the number of arrays I could do something like:</p>\n\n<pre><code>a = [1,2,3]\nb = [2,4,5]\nc = [2,6,7]\n\nx = a &amp; b &amp; c\n\nx == [2]\n</code></pre>\n\n<p>However, this isn't possible if you don't know the number of arrays. So far I've come up with this:</p>\n\n<pre><code>array_of_integers = [[1,2,3],[2,4,5]....]\nvalues = []\narray_of_integers.each_with_index do |array, index|\n  values = if index.zero?\n          array\n        else\n          values &amp; array\n        end\nend\n# `values` will be an array of common values\n</code></pre>\n\n<p>However, this doesn't seem very efficient. Is there a better way?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-4"], "comments": [{"owner": {"reputation": 6039, "user_id": 2137458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cfca832ee746f3e3d9971148f52dc64?s=128&d=identicon&r=PG", "display_name": "NM Pennypacker", "link": "https://stackoverflow.com/users/2137458/nm-pennypacker"}, "edited": false, "score": 0, "creation_date": 1534776955, "post_id": 51933244, "comment_id": 90816860, "body": "Can you show us your <code>template_params</code> method?"}, {"owner": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 0, "creation_date": 1534777722, "post_id": 51933244, "comment_id": 90817333, "body": "See <code>@template.errors.messages</code> to find out what is wrong with the record."}, {"owner": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 0, "creation_date": 1534777812, "post_id": 51933244, "comment_id": 90817393, "body": "<code>activerecord.errors.models.exercise.attributes.source_id.tak&zwnj;&#8203;en</code> means there is some kind of uniqueness validation on <code>source_id</code> in your model for <code>@template</code>. Can you include the model code and also any before filters and methods used inside your controller action for creating template?"}, {"owner": {"reputation": 83, "user_id": 5197870, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/02b1021f20ad57d24620f0210d01a4b4?s=128&d=identicon&r=PG&f=1", "display_name": "Rick Grimes", "link": "https://stackoverflow.com/users/5197870/rick-grimes"}, "reply_to_user": {"reputation": 6039, "user_id": 2137458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cfca832ee746f3e3d9971148f52dc64?s=128&d=identicon&r=PG", "display_name": "NM Pennypacker", "link": "https://stackoverflow.com/users/2137458/nm-pennypacker"}, "edited": false, "score": 0, "creation_date": 1534780049, "post_id": 51933244, "comment_id": 90818672, "body": "@NMPennypacker edited my question"}, {"owner": {"reputation": 9921, "user_id": 488195, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/aa1e7477ba2f6c0ec47ed521f1cf1676?s=128&d=identicon&r=PG", "display_name": "dgilperez", "link": "https://stackoverflow.com/users/488195/dgilperez"}, "edited": false, "score": 0, "creation_date": 1535126722, "post_id": 51933244, "comment_id": 90966645, "body": "We also need the content of <code>Exercise</code>, that&#39;s probably where the validation is. Can you also post the content of <code>min_no_of_exercises</code>?"}], "owner": {"reputation": 83, "user_id": 5197870, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/02b1021f20ad57d24620f0210d01a4b4?s=128&d=identicon&r=PG&f=1", "display_name": "Rick Grimes", "link": "https://stackoverflow.com/users/5197870/rick-grimes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 72, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1534778234, "creation_date": 1534776241, "last_edit_date": 1534778234, "question_id": 51933244, "link": "https://stackoverflow.com/questions/51933244/error-when-trying-to-save-record-in-ruby-rails", "title": "Error when trying to save record in ruby rails", "body": "<p>I have a form where a user can add different exercises to a program. This form contains two submit buttons:</p>\n\n<ol>\n<li>for saving the program and assign it to another user</li>\n<li>to save the program as a template, so it can be used later\nagain</li>\n</ol>\n\n<p>The <strong>first action</strong> worked fine before after I extended the second submit button. Sometimes it works (after clearing the cache e.g.), sometimes not and it throws an error like this:</p>\n\n<pre><code>activerecord.errors.models.exercise.attributes.source_id.taken\n</code></pre>\n\n<p>I have not found what .taken exactly means, but in my opinion Rails think that it must be unique? But that is not the case.</p>\n\n<p><strong>Second submit:</strong> when I try to save the program as a template I am getting an error</p>\n\n<pre><code>translation missing: de.activerecord.errors.messages.record_invalid\n</code></pre>\n\n<p>when I try to save the template:</p>\n\n<pre><code>  if params[:Template]\n   @template = ProgramTemplate.new(template_params(:create))              \n    if @template.save!\n      flash[:success] = {'title' =&gt; I18n.t('alerts.6C.success.title'), 'text' =&gt; I18n.t('alerts.6C.success.message')}\n      render :new                \n    else\n</code></pre>\n\n<p>After this I checked how @template looks like with inspect where everything looks fine. When I run @template.invalid?(:name) it says true, but the .inspect shows me that the name is really stored as a String.</p>\n\n<p>My <strong>template_params</strong>:</p>\n\n<pre><code>  def template_params(method = :update)\n   nested_attributes = [:source_id, :series, :repetitions, :break, :sort_order]\n   nested_attributes += [:id, :_destroy] if method == :update\n\n   params.require(:program).permit(:account_id, :description, :account_patient_id, :name, :goal, :frequency, :duration, exercises_attributes: nested_attributes)\n  end\n</code></pre>\n\n<p><strong>Model code of @template:</strong></p>\n\n<pre><code>class ProgramTemplate &lt; ActiveRecord::Base\n  #belongs_to :patient\n  #belongs_to :program\n  belongs_to :account\n  #belongs_to :account_patient\n\n  has_many :exercises, dependent: :destroy\n  accepts_nested_attributes_for :exercises, allow_destroy: true\n  #has_many :program_sessions, dependent: :destroy\n\n  # accepts_nested_attributes_for :exercises, reject_if: lambda { |e| e[:published].blank? }, allow_destroy: true\n\n  validates :name, presence: true\n  validate :min_no_of_exercises\n</code></pre>\n"}, {"tags": ["ruby", "ruby-on-rails-5", "stripe-payments"], "answers": [{"comments": [{"owner": {"reputation": 1105, "user_id": 391122, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/63c655bc5282d3f343574aef29de460a?s=128&d=identicon&r=PG", "display_name": "Jared", "link": "https://stackoverflow.com/users/391122/jared"}, "edited": false, "score": 1, "creation_date": 1534774345, "post_id": 51932630, "comment_id": 90815255, "body": "You could also do it as <code>current_user.orders.where(course: course).exists?</code> if you want it to read a little more ruby-ish"}], "tags": [], "owner": {"reputation": 61438, "user_id": 63034, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/ZXKMO.jpg?s=128&g=1", "display_name": "mikej", "link": "https://stackoverflow.com/users/63034/mikej"}, "is_accepted": true, "score": 0, "last_activity_date": 1535014953, "last_edit_date": 1535014953, "creation_date": 1534774242, "answer_id": 51932630, "question_id": 51932437, "link": "https://stackoverflow.com/questions/51932437/only-show-button-if-purchased-stripe/51932630#51932630", "title": "Only show button if purchased Stripe", "body": "<p>This line:</p>\n\n<pre><code>if Order.exists?\n</code></pre>\n\n<p>will check if <em>any</em> order exists. i.e. it will be true as long as there is at least one record in the orders table. However, you want to check for a <em>specific</em> order i.e. has the current user ordered a particular course. So you can replace this with:</p>\n\n<pre><code>if Order.exists?(user: current_user, course: course)\n</code></pre>\n\n<p>However this will run a separate query to check for the existence of an order for each course. Once you have more than a couple of courses this will become inefficient. So it would best to run a single query to find all the course IDs ordered by the current user and to then check against that list.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8331511"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 28, "favorite_count": 0, "accepted_answer_id": 51932630, "answer_count": 1, "score": 0, "last_activity_date": 1535014953, "creation_date": 1534773705, "last_edit_date": 1534774213, "question_id": 51932437, "link": "https://stackoverflow.com/questions/51932437/only-show-button-if-purchased-stripe", "title": "Only show button if purchased Stripe", "body": "<p>So I'm trying to have my app where when a user purchases a course they see a view modules button because when they purchase the course an order gets created so I'm checking whether an order exists.</p>\n\n<p>However, currently when a course gets purchased the view modules get shown on all courses but I want it to only show on the course that is purchased.</p>\n\n<p>Here is what I have so far:</p>\n\n<p>schema.rb</p>\n\n<pre><code>  create_table \"courses\", force: :cascade do |t|\n    t.string \"title\"\n    t.text \"summary\"\n    t.text \"description\"\n    t.string \"trailer\"\n    t.integer \"price\"\n    t.datetime \"created_at\", null: false\n    t.datetime \"updated_at\", null: false\n    t.string \"slug\"\n    t.index [\"slug\"], name: \"index_courses_on_slug\", unique: true\n  end\n\n  create_table \"orders\", force: :cascade do |t|\n    t.integer \"user_id\"\n    t.integer \"course_id\"\n    t.float \"total\"\n    t.index [\"course_id\"], name: \"index_orders_on_course_id\"\n    t.index [\"user_id\"], name: \"index_orders_on_user_id\"\n  end\n</code></pre>\n\n<p>Not purchased</p>\n\n<p><img src=\"https://i.gyazo.com/e3d548e380740b3f663abf845b67ce7b.png\" alt=\"image\"></p>\n\n<p>Purchased</p>\n\n<p><img src=\"https://i.gyazo.com/9c4904ced2b1fa61ff544876994115a5.png\" alt=\"image #2\"></p>\n\n<p>email marketing has been purchased but they are both showing the \"view modules\" button.</p>\n\n<p>Here's how I'm doing the buttons</p>\n\n<pre><code>&lt;section class=\"flex justify-between px-6 py-4\"&gt;\n    &lt;% if user_signed_in? %&gt;\n      &lt;% if current_user.isAdmin? %&gt;\n        &lt;%= link_to \"Edit\", edit_course_path(course), class: \"inline-block text-lg w-full text-center text-grey-dark hover:text-darker px-4 py-2 border-2 border-grey leading-none no-underline hover:border-2 hover:border-grey-dark\" %&gt;\n      &lt;% else %&gt;\n        &lt;% if Order.exists? %&gt;\n          &lt;%= link_to \"View Modules\", course, class: \"block text-lg w-full text-center text-grey-dark hover:text-darker px-4 py-2 border-2 border-grey leading-none no-underline hover:border-2 hover:border-grey-dark\" %&gt;\n        &lt;% else %&gt;\n          &lt;%= form_with(url: '/payments/create') do |f| %&gt;\n            &lt;script\n              src=\"https://checkout.stripe.com/checkout.js\" class=\"stripe-button\"\n              data-key=\"&lt;%= Rails.configuration.stripe[:publishable_key] %&gt;\"\n              data-image=\"https://s3.eu-west-2.amazonaws.com/aurameir-courses/aurameir-logo.png\"\n              data-name=\"&lt;%= course.title %&gt;\"\n              data-description=\"&lt;%= course.summary %&gt;\"\n              data-amount=\"&lt;%= course.price*100 %&gt;\"\n              data-label=\"Buy Now\"\n              &gt;\n            &lt;/script&gt;\n            &lt;%= hidden_field_tag(:course_id, course.id) %&gt;\n\n            &lt;%= f.submit \"Buy now\", class: \"bg-blue hover:bg-blue-dark w-full text-white font-semibold py-3 px-4 border-2 rounded-sm border-blue-dark shadow outline-none\" %&gt;\n          &lt;% end %&gt;\n        &lt;% end %&gt;\n      &lt;% end %&gt;\n    &lt;% else %&gt;\n      &lt;%= link_to \"View\", course, class: \"block text-lg text-grey-dark hover:text-darker px-4 py-2 border-2 border-grey leading-none no-underline hover:border-2 hover:border-grey-dark\" %&gt;\n      &lt;span class=\"inline-block bg-green font-bold text-xl text-white border-2 border-green-dark px-4 py-2 leading-none shadow\"&gt;\u00a3&lt;%= course.price %&gt;&lt;/span&gt;\n    &lt;% end %&gt;\n  &lt;/section&gt;\n&lt;/section&gt;\n</code></pre>\n"}, {"tags": ["ruby", "regex", "tasker"], "comments": [{"owner": {"reputation": 481662, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1534766439, "post_id": 51930269, "comment_id": 90810235, "body": "<code>s[&#47;key.*?([0-9]+)&#47;, 1]</code> or <code>s[&#47;key.*?\\K[0-9]+&#47;]</code> will do."}, {"owner": {"reputation": 10920, "user_id": 3390419, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/cXKh9.jpg?s=128&g=1", "display_name": "Paolo", "link": "https://stackoverflow.com/users/3390419/paolo"}, "edited": false, "score": 0, "creation_date": 1534766498, "post_id": 51930269, "comment_id": 90810271, "body": "Or <code>(?&lt;=key)\\D+\\K\\d+</code>."}], "owner": {"reputation": 109, "user_id": 4663915, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/vu13m.png?s=128&g=1", "display_name": "Fingalzzz", "link": "https://stackoverflow.com/users/4663915/fingalzzz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 29, "favorite_count": 0, "closed_date": 1534766399, "answer_count": 0, "score": 0, "last_activity_date": 1534766320, "creation_date": 1534766320, "question_id": 51930269, "link": "https://stackoverflow.com/questions/51930269/fixed-length-look-behind-in-regex", "closed_reason": "Duplicate", "title": "fixed length look-behind in RegEx", "body": "<p>I'm trying to extract a number from a string. The string is randomized but must contain one keyword, let's say 'key', and a number. I want to extract the first number behind the keyword.</p>\n\n<p>Below is a sample string:</p>\n\n<p><code>123samples45have'key'andnumber678and90</code></p>\n\n<p>So in this sample string, number <code>678</code> is required.</p>\n\n<p>I write the expression like <code>(?&lt;=key.*?)[0-9]+</code>, but it appears Ruby only support fixed length look-behind. Is there any other solution could solve this?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "rails-activestorage"], "comments": [{"owner": {"reputation": 502, "user_id": 6393321, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/K8qTA.jpg?s=128&g=1", "display_name": "Rigo", "link": "https://stackoverflow.com/users/6393321/rigo"}, "edited": false, "score": 0, "creation_date": 1534847550, "post_id": 51930154, "comment_id": 90842735, "body": "Is attachments connected to a model?"}, {"owner": {"reputation": 5, "user_id": 7359456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9b1fc140fdb379a4fb90abfa0fe5b04?s=128&d=identicon&r=PG&f=1", "display_name": "Bal&#225;zs Kosk&#243;ci", "link": "https://stackoverflow.com/users/7359456/bal%c3%a1zs-kosk%c3%b3ci"}, "reply_to_user": {"reputation": 502, "user_id": 6393321, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/K8qTA.jpg?s=128&g=1", "display_name": "Rigo", "link": "https://stackoverflow.com/users/6393321/rigo"}, "edited": false, "score": 0, "creation_date": 1534858913, "post_id": 51930154, "comment_id": 90850075, "body": "Here is an example: <code>class Post &lt; ApplicationRecord   has_many_attached :images end</code>"}], "answers": [{"tags": [], "owner": {"reputation": 5, "user_id": 7359456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9b1fc140fdb379a4fb90abfa0fe5b04?s=128&d=identicon&r=PG&f=1", "display_name": "Bal&#225;zs Kosk&#243;ci", "link": "https://stackoverflow.com/users/7359456/bal%c3%a1zs-kosk%c3%b3ci"}, "is_accepted": true, "score": 0, "last_activity_date": 1535019026, "creation_date": 1535019026, "answer_id": 51983365, "question_id": 51930154, "link": "https://stackoverflow.com/questions/51930154/deleting-a-single-activestorage-attachment-out-of-a-collection-via-an-api-call/51983365#51983365", "title": "Deleting a single ActiveStorage attachment out of a collection via an API call", "body": "<p>In the end, I managed to serialize the attached images (option(1) above) using the <code>jsonapi-rb</code> gem.</p>\n\n<p>In the controller, I <code>include: :images</code> and pass in the attachment type using the <code>expose</code> option:</p>\n\n<pre><code>class PostsController &lt; ApplicationController\n...\n  def show\n    respond_to do |format|\n      format.html\n      format.json { render jsonapi: @post, include: :images, expose: {attachment_type: \"images\"} }\n    end\n  end\nend\n</code></pre>\n\n<p>ActiveSupport gives you the <code>post.images_attachments</code> method for free:</p>\n\n<pre><code>class SerializablePost &lt; JSONAPI::Serializable::Resource\n  type 'posts'\n  ...\n  has_many :images do\n    @object.images_attachments\n  end\nend\n</code></pre>\n\n<p>I created an attachment serializer:</p>\n\n<pre><code>class SerializableAttachment &lt; JSONAPI::Serializable::Resource\n  include Rails.application.routes.url_helpers\n\n  type do\n    @attachment_type\n  end\n  attribute :id\n  attribute :url do \n    url_for(@object)\n  end\nend\n</code></pre>\n\n<p>I needed to tell jsonapi to use this serializer for all attachments:</p>\n\n<pre><code>class ApplicationController &lt; ActionController::Base\n...\n  def jsonapi_class\n    super.merge(\n      'ActiveStorage::Attachment': SerializableAttachment\n    )\n  end\nend\n</code></pre>\n\n<p>Now I can implement <code>DELETE /attachments/:id</code>.</p>\n"}], "owner": {"reputation": 5, "user_id": 7359456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9b1fc140fdb379a4fb90abfa0fe5b04?s=128&d=identicon&r=PG&f=1", "display_name": "Bal&#225;zs Kosk&#243;ci", "link": "https://stackoverflow.com/users/7359456/bal%c3%a1zs-kosk%c3%b3ci"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 248, "favorite_count": 0, "accepted_answer_id": 51983365, "answer_count": 1, "score": 0, "last_activity_date": 1535020626, "creation_date": 1534765823, "last_edit_date": 1535020626, "question_id": 51930154, "link": "https://stackoverflow.com/questions/51930154/deleting-a-single-activestorage-attachment-out-of-a-collection-via-an-api-call", "title": "Deleting a single ActiveStorage attachment out of a collection via an API call", "body": "<p>EDIT: <strong>TLDR</strong>: This boils down to serializing the attachments. See my response.</p>\n\n<p>I can see two ways to achieve this:</p>\n\n<p>(1) Serialize the attachments (with <code>id</code> and <code>url</code> attributes), thus providing an <code>id</code> to the FE that they can use to <code>DELETE /attachments/:id</code> which would then call <code>ActiveStorage::Attachment.find(:id).purge</code>. The problem is with serializing as attachments do not have built-in models. I tried creating an <code>ActiveStorageAttachment</code> model for the <code>active_storage_attachments</code> table but  could not get the url for the attachment as the <code>Rails.application.routes.url_helpers.url_for(@object)</code> requires an <code>ActiveStorage::Attachment</code> object not an <code>ActiveStorageAttachment</code> object.</p>\n\n<p>(2) Another option would be to have a <code>DELETE /attachments/:attachment_url</code> endpoint. For this to work, I'd need to get the <code>ActiveStorage::Attachment</code> object based on the url, in order to call <code>purge</code> on it. Not sure if that is possible?</p>\n\n<p>I'd much prefer the first solution, it feels cleaner and more adaptable. Any help with either approach would be much appreciated!</p>\n"}, {"tags": ["python", "ruby", "rabbitmq"], "comments": [{"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 2, "creation_date": 1534760343, "post_id": 51928575, "comment_id": 90806753, "body": "It would probably help to see the code in question."}, {"owner": {"reputation": 7224, "user_id": 448934, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TXtux.jpg?s=128&g=1", "display_name": "Pascal", "link": "https://stackoverflow.com/users/448934/pascal"}, "edited": false, "score": 1, "creation_date": 1534768058, "post_id": 51928575, "comment_id": 90811235, "body": "How do you publish and consume? Exclusive consumer? Fan-Out? Does your Python script die?"}, {"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1534773430, "post_id": 51928575, "comment_id": 90814672, "body": "<a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>, please. It&#39;s almost impossible to answer a question like this without seeing the code."}], "answers": [{"tags": [], "owner": {"reputation": 1687, "user_id": 584653, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/39c5327f358a9cfb75c913ccd8201696?s=128&d=identicon&r=PG", "display_name": "Simmo", "link": "https://stackoverflow.com/users/584653/simmo"}, "is_accepted": false, "score": 0, "last_activity_date": 1534773586, "creation_date": 1534773586, "answer_id": 51932396, "question_id": 51928575, "link": "https://stackoverflow.com/questions/51928575/every-other-message-missing-with-rabbit-mq/51932396#51932396", "title": "Every other message missing with Rabbit MQ", "body": "<p>The answer, as hinted at by Pascal, was that it needed to be set to 'Fan-Out'. Thanks for the tip.</p>\n"}], "owner": {"reputation": 1687, "user_id": 584653, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/39c5327f358a9cfb75c913ccd8201696?s=128&d=identicon&r=PG", "display_name": "Simmo", "link": "https://stackoverflow.com/users/584653/simmo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 140, "favorite_count": 2, "answer_count": 1, "score": 1, "last_activity_date": 1534773586, "creation_date": 1534760123, "question_id": 51928575, "link": "https://stackoverflow.com/questions/51928575/every-other-message-missing-with-rabbit-mq", "title": "Every other message missing with Rabbit MQ", "body": "<p>We have a RabbitMQ server running under Docker. We both publish and receive messages from code in both Ruby and Python, all of which is almost exactly straight from the online tutorial examples. After a short number of messages, the Python version starts to only receives every other message. The Ruby script continues to receive all of them.</p>\n\n<p>While not exactly RabbitMQ experts, we've checked the code and it's so close the official tutorials that it's hard to see that we're making any big mistakes. Plus it works initially anyway.</p>\n\n<p>Is there anything that could be causing this odd behaviour?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-4"], "comments": [{"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1534760113, "post_id": 51928407, "comment_id": 90806633, "body": "Have you tried suggested <i>\u201c<code>sqlite3</code> is missing. Try &#39;brew install sqlite3&#39;\u201d</i>?"}, {"owner": {"reputation": 7004, "user_id": 1103606, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/0d93cc650b93939ea91066fcb5aefae0?s=128&d=identicon&r=PG", "display_name": "Peter Penzov", "link": "https://stackoverflow.com/users/1103606/peter-penzov"}, "reply_to_user": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1534760225, "post_id": 51928407, "comment_id": 90806686, "body": "I get Warning: sqlite 3.24.0 is already installed and up-to-date. I need to install older version 1.3.13"}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1534760299, "post_id": 51928407, "comment_id": 90806724, "body": "Check the documentation on <code>brew</code> for how to install the specific version of the package? I do not use non-robust operating systems, like MacOS, sorry."}, {"owner": {"reputation": 6039, "user_id": 2137458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cfca832ee746f3e3d9971148f52dc64?s=128&d=identicon&r=PG", "display_name": "NM Pennypacker", "link": "https://stackoverflow.com/users/2137458/nm-pennypacker"}, "edited": false, "score": 0, "creation_date": 1534766191, "post_id": 51928407, "comment_id": 90810075, "body": "Try <code>brew unlink sqlite3 &amp;&amp; brew link sqlite3</code>"}], "answers": [{"tags": [], "owner": {"reputation": 973, "user_id": 9989384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/530602201f9551563176b0b648b7d50b?s=128&d=identicon&r=PG&f=1", "display_name": "Cryptex Technologies", "link": "https://stackoverflow.com/users/9989384/cryptex-technologies"}, "is_accepted": false, "score": 6, "last_activity_date": 1534772863, "creation_date": 1534772863, "answer_id": 51932169, "question_id": 51928407, "link": "https://stackoverflow.com/questions/51928407/failed-to-build-sqlite3-native-extension/51932169#51932169", "title": "Failed to build sqlite3 native extension", "body": "<p>Please try to run the following commands:</p>\n\n<p>For MAC Users,</p>\n\n<pre><code>gem install sqlite3 -- --with-sqlite3-lib=/usr/lib\n</code></pre>\n\n<p>And if you are using ubuntu,</p>\n\n<pre><code>sudo apt-get install sqlite3\nsudo apt-get install libsqlite3-dev\nsudo gem install sqlite3-ruby\n</code></pre>\n\n<p>Hope this will solve your problem.</p>\n"}], "owner": {"reputation": 7004, "user_id": 1103606, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/0d93cc650b93939ea91066fcb5aefae0?s=128&d=identicon&r=PG", "display_name": "Peter Penzov", "link": "https://stackoverflow.com/users/1103606/peter-penzov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1643, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1534772863, "creation_date": 1534759603, "question_id": 51928407, "link": "https://stackoverflow.com/questions/51928407/failed-to-build-sqlite3-native-extension", "title": "Failed to build sqlite3 native extension", "body": "<p>I need to install older version of sqllite3:</p>\n\n<p>I tried:</p>\n\n<pre><code>gem install sqlite3 -v '1.3.13'\n</code></pre>\n\n<p>But I get:</p>\n\n<pre><code>EMP-SOF-LT075:admin_pci test$ sudo gem install sqlite3 -v '1.3.13'\nBuilding native extensions.  This could take a while...\nERROR:  Error installing sqlite3:\n    ERROR: Failed to build gem native extension.\n\n    current directory: /Library/Ruby/Gems/2.3.0/gems/sqlite3-1.3.13/ext/sqlite3\n/System/Library/Frameworks/Ruby.framework/Versions/2.3/usr/bin/ruby -r ./siteconf20180820-14374-qv6ltl.rb extconf.rb\nchecking for sqlite3.h... yes\nchecking for pthread_create() in -lpthread... yes\nchecking for sqlite3_libversion_number() in -lsqlite3... no\nsqlite3 is missing. Try 'brew install sqlite3',\n'yum install sqlite-devel' or 'apt-get install libsqlite3-dev'\nand check your shared library search path (the\nlocation where your sqlite3 shared library is located).\n*** extconf.rb failed ***\nCould not create Makefile due to some reason, probably lack of necessary\nlibraries and/or headers.  Check the mkmf.log file for more details.  You may\nneed configuration options.\n\nProvided configuration options:\n    --with-opt-dir\n    --without-opt-dir\n    --with-opt-include\n    --without-opt-include=${opt-dir}/include\n    --with-opt-lib\n    --without-opt-lib=${opt-dir}/lib\n    --with-make-prog\n    --without-make-prog\n    --srcdir=.\n    --curdir\n    --ruby=/System/Library/Frameworks/Ruby.framework/Versions/2.3/usr/bin/$(RUBY_BASE_NAME)\n    --with-sqlite3-config\n    --without-sqlite3-config\n    --with-pkg-config\n    --without-pkg-config\n    --with-sqlite3-dir\n    --without-sqlite3-dir\n    --with-sqlite3-include\n    --without-sqlite3-include=${sqlite3-dir}/include\n    --with-sqlite3-lib\n    --without-sqlite3-lib=${sqlite3-dir}/lib\n    --with-pthreadlib\n    --without-pthreadlib\n    --with-sqlite3lib\n    --without-sqlite3lib\n\nTo see why this extension failed to compile, please check the mkmf.log which can be found here:\n\n  /Library/Ruby/Gems/2.3.0/extensions/universal-darwin-17/2.3.0/sqlite3-1.3.13/mkmf.log\n\nextconf failed, exit code 1\n\nGem files will remain installed in /Library/Ruby/Gems/2.3.0/gems/sqlite3-1.3.13 for inspection.\nResults logged to /Library/Ruby/Gems/2.3.0/extensions/universal-darwin-17/2.3.0/sqlite3-1.3.13/gem_make.out\nEMP-SOF-LT075:admin_pci plamen$ \n</code></pre>\n\n<p>Is there any solution to this problem?</p>\n"}, {"tags": ["ruby", "nokogiri", "cdata"], "answers": [{"tags": [], "owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "is_accepted": false, "score": 0, "last_activity_date": 1534756708, "creation_date": 1534756708, "answer_id": 51927606, "question_id": 51926973, "link": "https://stackoverflow.com/questions/51926973/how-can-i-keep-cdata-while-updating-the-content-of-an-xml-node/51927606#51927606", "title": "How can I keep CDATA while updating the content of an xml node?", "body": "<p>Your <code>Nokogiri::XML::Element#content=</code> will replace the content of <code>Test</code> with a text node (and destroy whatever content used to be there). You need to access your CDATA, then run <code>content=</code> on <em>that</em>. For example:</p>\n\n<pre><code>doc.xpath('//Test').each do |test|\n  cdata = test.children.find(&amp;:cdata?)\n  cdata.content = 'new string' if cdata\nend\n</code></pre>\n\n<p>(It would be more straightforward if you could tell XPath to directly select the CDATA node, but I don't know that it can do that.)</p>\n"}], "owner": {"reputation": 23, "user_id": 8232312, "user_type": "registered", "profile_image": "https://graph.facebook.com/1581540751917387/picture?type=large", "display_name": "Bapta Arjun", "link": "https://stackoverflow.com/users/8232312/bapta-arjun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 121, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1534756708, "creation_date": 1534754337, "question_id": 51926973, "link": "https://stackoverflow.com/questions/51926973/how-can-i-keep-cdata-while-updating-the-content-of-an-xml-node", "title": "How can I keep CDATA while updating the content of an xml node?", "body": "<p>In a Ruby script, I want to update the CDATA content while keeping the format as CDATA.</p>\n\n<pre><code>doc = Nokogiri::XML(File.open('text.xml'))\ndoc.xpath('//Test').each do |test|\n  test.content = 'new string'\nend\n</code></pre>\n\n<p>This is my test.xml file</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;Test&gt;&lt;![CDATA[&lt;p&gt;Some content&lt;/p&gt;]]&gt;&lt;/Test&gt;\n</code></pre>\n\n<p>Problem is, in my doc <code>CDATA</code> converts to <code>Text</code>. Is there any way I can keep <code>CDATA</code> property?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["ruby", "unicode", "hex"], "answers": [{"comments": [{"owner": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 3, "creation_date": 1534748762, "post_id": 51925450, "comment_id": 90800517, "body": "So, you knew the answer at the time of asking this question!!"}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "reply_to_user": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 7, "creation_date": 1534750800, "post_id": 51925450, "comment_id": 90801568, "body": "@JagdeepSingh SO <a href=\"https://stackoverflow.com/help/self-answer\">explicitly encourages</a> posting questions with answers for the sake of knowledge base quality improvement."}, {"owner": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 1, "creation_date": 1534751775, "post_id": 51925450, "comment_id": 90802051, "body": "Yeah, I have no issue with that. Was just confirming. :)"}], "tags": [], "owner": {"reputation": 7685, "user_id": 517868, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/771951f55ed37335f238e1a80dfda9cd?s=128&d=identicon&r=PG", "display_name": "Juanito Fatas", "link": "https://stackoverflow.com/users/517868/juanito-fatas"}, "is_accepted": false, "score": 6, "last_activity_date": 1534748011, "creation_date": 1534748011, "answer_id": 51925450, "question_id": 51925449, "link": "https://stackoverflow.com/questions/51925449/get-unicode-by-hex-string-in-ruby/51925450#51925450", "title": "Get unicode by hex string in Ruby", "body": "<p>You could do that by using <a href=\"https://ruby-doc.org/core-2.5.1/Array.html#method-i-pack\" rel=\"noreferrer\"><code>Array#pack</code></a>:</p>\n\n<p><code>[\"1F60d\".to_i(16)].pack(\"U*\")</code></p>\n"}, {"comments": [{"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1534749453, "post_id": 51925742, "comment_id": 90800842, "body": "It won\u2019t work with dynamic strings."}], "tags": [], "owner": {"reputation": 2125, "user_id": 1446543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/934816c610f53abdab5f26510478bc24?s=128&d=identicon&r=PG", "display_name": "ForeverZer0", "link": "https://stackoverflow.com/users/1446543/foreverzer0"}, "is_accepted": false, "score": 0, "last_activity_date": 1534749432, "creation_date": 1534749432, "answer_id": 51925742, "question_id": 51925449, "link": "https://stackoverflow.com/questions/51925449/get-unicode-by-hex-string-in-ruby/51925742#51925742", "title": "Get unicode by hex string in Ruby", "body": "<p>You can use the <code>\\u{HEX}</code> to accomplish the same.</p>\n\n<pre><code>puts \"\\u{1F60d}\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "is_accepted": false, "score": 4, "last_activity_date": 1534755694, "last_edit_date": 1534755694, "creation_date": 1534751732, "answer_id": 51926311, "question_id": 51925449, "link": "https://stackoverflow.com/questions/51925449/get-unicode-by-hex-string-in-ruby/51926311#51926311", "title": "Get unicode by hex string in Ruby", "body": "<p>Convert the string to an integer (e.g. via <a href=\"http://ruby-doc.org/core-2.5.1/String.html#method-i-hex\" rel=\"nofollow noreferrer\"><code>hex</code></a>) and the integer to a character via <a href=\"http://ruby-doc.org/core-2.5.1/Integer.html#method-i-chr\" rel=\"nofollow noreferrer\"><code>chr</code></a>:</p>\n\n<pre><code>'1f60d'.hex.chr('UTF-8')\n#=&gt; \"\ud83d\ude0d\"\n</code></pre>\n"}], "owner": {"reputation": 7685, "user_id": 517868, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/771951f55ed37335f238e1a80dfda9cd?s=128&d=identicon&r=PG", "display_name": "Juanito Fatas", "link": "https://stackoverflow.com/users/517868/juanito-fatas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 618, "favorite_count": 3, "closed_date": 1534829751, "answer_count": 3, "score": 8, "last_activity_date": 1534755694, "creation_date": 1534748011, "last_edit_date": 1534752890, "question_id": 51925449, "link": "https://stackoverflow.com/questions/51925449/get-unicode-by-hex-string-in-ruby", "closed_reason": "Duplicate", "title": "Get unicode by hex string in Ruby", "body": "<p>Given a hex code, for example: <code>1f60d</code>, how do I find the corresponding unicode (code point) <code>\ud83d\ude0d</code>?</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1534783302, "post_id": 51924810, "comment_id": 90820337, "body": "Do you literally want empty hashes, and for &quot;nat&quot; to be discarded? If not, please edit your question so that <code>user_data</code> and <code>item_date</code> are complete and correct for the contents of the file in your example."}], "answers": [{"comments": [{"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1534747990, "post_id": 51925043, "comment_id": 90800177, "body": "What if there are 42 columns in the CSV?"}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1534748099, "post_id": 51925043, "comment_id": 90800235, "body": "One does not need to reimplement the parser. One needs to implement a splitter only, you might check my answer for clarity."}], "tags": [], "owner": {"reputation": 1456, "user_id": 2295410, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/PYmkM.png?s=128&g=1", "display_name": "Alex.U", "link": "https://stackoverflow.com/users/2295410/alex-u"}, "is_accepted": false, "score": 1, "last_activity_date": 1534747550, "last_edit_date": 1534747550, "creation_date": 1534746004, "answer_id": 51925043, "question_id": 51924810, "link": "https://stackoverflow.com/questions/51924810/ruby-how-to-parse-csv-file-with-multiple-row-data-type/51925043#51925043", "title": "Ruby, how to parse csv file with multiple row data type", "body": "<p>Ruby CSV doesn't have that functionality, you'd need to implement that logic yourself as CSV is just raw data, it has no way to tell what is a header and what isn't.</p>\n\n<p>In your case, I see you have an empty row before the next 'section', that should make your logic easier. A good place to put this logic is extending the <code>CSV</code> to support your multiple headers, something like</p>\n\n<pre><code>class CSV\n  def parse_with_multiple_headers\n    ...\n  end\nend\n</code></pre>\n\n<p>Also for ease of parsing I'd remove <code>User Data</code> and <code>Item Data</code> and only leave the headers:</p>\n\n<pre><code>name,age,gender\njhon,15,male\nnat,14,female\n,,,\nid,name,\n1,book,\n</code></pre>\n\n<p>EDIT</p>\n\n<p>This is a small program that would do what you want. There's a huge room for improvement, but you get the point:</p>\n\n<pre><code>require 'csv'\n\ndef is_empty(row)\n  row[\"name\"] == nil &amp;&amp; row[\"age\"] == nil &amp;&amp; row[\"gender\"] == nil ? true : false\nend\n\ndef csv_multiple_headers(data)\n  users, items, p_users = [], [], true\n  data.each do |row|\n    # control write to\n    if is_empty(row) \n      p_users = false\n      next\n    end\n\n    # skip next header row\n    row[\"name\"] == \"id\" ? next : nil\n\n    if p_users\n      users.push({\"name\": row['name'],\"age\": row['age'],\"gender\": row['gender']})\n    else\n      items.push({\"id\": row[\"name\"], \"name\": row[\"age\"]})\n    end\n\n  end\n  puts users\n  puts items\nend\n\nsrc = \"name,age,gender\njhon,15,male\nnat,14,female\n,,,\nid,name,\n1,book,\n\"\n\ncsv = CSV.parse(src, :headers =&gt; true)\ncsv_multiple_headers(csv)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 25, "user_id": 9929746, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-gNo8C0Ca5uY/AAAAAAAAAAI/AAAAAAAAACI/-pqfbcNOls0/photo.jpg?sz=128", "display_name": "M Umar Ramadhana", "link": "https://stackoverflow.com/users/9929746/m-umar-ramadhana"}, "edited": false, "score": 0, "creation_date": 1534753839, "post_id": 51925416, "comment_id": 90803165, "body": "i see this is an interesting solution. will check this out. so basically we don&#39;t need the csv library again."}, {"owner": {"reputation": 1456, "user_id": 2295410, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/PYmkM.png?s=128&g=1", "display_name": "Alex.U", "link": "https://stackoverflow.com/users/2295410/alex-u"}, "reply_to_user": {"reputation": 25, "user_id": 9929746, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-gNo8C0Ca5uY/AAAAAAAAAAI/AAAAAAAAACI/-pqfbcNOls0/photo.jpg?sz=128", "display_name": "M Umar Ramadhana", "link": "https://stackoverflow.com/users/9929746/m-umar-ramadhana"}, "edited": false, "score": 0, "creation_date": 1534753957, "post_id": 51925416, "comment_id": 90803237, "body": "you still need Ruby&#39;s CSV @MUmarRamadhana"}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "reply_to_user": {"reputation": 25, "user_id": 9929746, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-gNo8C0Ca5uY/AAAAAAAAAAI/AAAAAAAAACI/-pqfbcNOls0/photo.jpg?sz=128", "display_name": "M Umar Ramadhana", "link": "https://stackoverflow.com/users/9929746/m-umar-ramadhana"}, "edited": false, "score": 0, "creation_date": 1534754143, "post_id": 51925416, "comment_id": 90803331, "body": "@MUmarRamadhana yes, you might safely get rid of ruby CSV in approximately 100% of CSV parsing code. Instead of <code>CSV.parse(v)</code> you might easily <code>split</code> the strings by commas yourself."}, {"owner": {"reputation": 1456, "user_id": 2295410, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/PYmkM.png?s=128&g=1", "display_name": "Alex.U", "link": "https://stackoverflow.com/users/2295410/alex-u"}, "edited": false, "score": 0, "creation_date": 1534755577, "post_id": 51925416, "comment_id": 90804136, "body": "code golfing much. Change the specs and you need to rewrite mostly everything. Whereas a parser is more robust to changes as it represents the domain logic. Just saying. Nothing against the code."}, {"owner": {"reputation": 25, "user_id": 9929746, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-gNo8C0Ca5uY/AAAAAAAAAAI/AAAAAAAAACI/-pqfbcNOls0/photo.jpg?sz=128", "display_name": "M Umar Ramadhana", "link": "https://stackoverflow.com/users/9929746/m-umar-ramadhana"}, "edited": false, "score": 0, "creation_date": 1534908900, "post_id": 51925416, "comment_id": 90869308, "body": "Ya so i keep using the parser as it is easier, and some of my data also contain coma in its characters which will break the specs. Thanks for the solution"}], "tags": [], "owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "is_accepted": true, "score": 1, "last_activity_date": 1534759166, "last_edit_date": 1534759166, "creation_date": 1534747871, "answer_id": 51925416, "question_id": 51924810, "link": "https://stackoverflow.com/questions/51924810/ruby-how-to-parse-csv-file-with-multiple-row-data-type/51925416#51925416", "title": "Ruby, how to parse csv file with multiple row data type", "body": "<pre><code>input = 'User Data,,\nname,age,gender\njhon,15,male\nnat,14,female\n,,,\nItem Data,,\nid,name,\n1,book,'\n</code></pre>\n\n<p>Just split it manually and then proceed:    </p>\n\n<pre><code>input.\n  split(/#{$/},,,#{$/}/).          # split into multiple CSVs\n  map do |csv|\n    head, *csv = csv.split($/)     # extract CSV titles\n    {head[/.*?(?=,)/].downcase.gsub(' ', '_') =&gt; csv.join($/)} \n  end.\n  reduce(&amp;:merge).                  # make one hash\n  map { |k, v| [k, CSV.parse(v)] }. # proceed with prepared CSVs\n  to_h\n#\u21d2 {\"user_data\"=&gt;\n#     [[\"name\", \"age\", \"gender\"],\n#      [\"jhon\", \"15\", \"male\"],\n#      [\"nat\", \"14\", \"female\"]],\n#   \"item_data\"=&gt;\n#     [[\"id\", \"name\", nil],\n#      [\"1\", \"book\", nil]]}\n</code></pre>\n\n<hr>\n\n<p>To get an array of hashes:</p>\n\n<pre><code>_.transform_values do |v|\n  v[1..-1].map { |row| v.first.zip(row).to_h }\nend\n#\u21d2\u00a0{\"user_data\"=&gt;[\n#     {\"name\"=&gt;\"jhon\", \"age\"=&gt;\"15\", \"gender\"=&gt;\"male\"},\n#     {\"name\"=&gt;\"nat\", \"age\"=&gt;\"14\", \"gender\"=&gt;\"female\"}],\n#   \"item_data\"=&gt;[\n#     {\"id\"=&gt;\"1\", \"name\"=&gt;\"book\", nil=&gt;nil}]}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1534754289, "post_id": 51926888, "comment_id": 90803409, "body": "How is it different from what I have posted 1 hour ago (save for it uses hardcoded values and does not work with 3+ CSVs in the file)?"}, {"owner": {"reputation": 145, "user_id": 840568, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4df253f32069e5cdf3b65782e267ff5?s=128&d=identicon&r=PG", "display_name": "sfate", "link": "https://stackoverflow.com/users/840568/sfate"}, "reply_to_user": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1534756146, "post_id": 51926888, "comment_id": 90804448, "body": "Take a look on output - topic starter requested collection and not array of arrays in result."}], "tags": [], "owner": {"reputation": 145, "user_id": 840568, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4df253f32069e5cdf3b65782e267ff5?s=128&d=identicon&r=PG", "display_name": "sfate", "link": "https://stackoverflow.com/users/840568/sfate"}, "is_accepted": false, "score": 0, "last_activity_date": 1534754068, "creation_date": 1534754068, "answer_id": 51926888, "question_id": 51924810, "link": "https://stackoverflow.com/questions/51924810/ruby-how-to-parse-csv-file-with-multiple-row-data-type/51926888#51926888", "title": "Ruby, how to parse csv file with multiple row data type", "body": "<p>This should work for the following structure with any new headers and values:</p>\n\n\n\n<pre><code>require 'csv'\n\ninput = 'User Data,,\nname,age,gender\njhon,15,male\nnat,14,female\n,,,\nItem Data,,\nid,name,\n1,book,'\n\noutput_array = input.split(/,,,/).map do |named_csv|\n  name, csv = named_csv.split(/,,/).map(&amp;:strip)\n  rows = CSV.parse(csv)\n  header = rows.shift\n\n  rows_collection = rows.map { |row| header.zip(row).to_h }\n\n  [name, rows_collection]\nend\n\noutput_hash = output_array.to_h\nuser_data = output_hash.fetch('User Data')\nitem_data = output_hash.fetch('Item Data')\n\nputs 'user_data: ' + user_data.to_s\nputs 'item_data: ' + item_data.to_s\n\noutput&gt; user_data: [{\"name\"=&gt;\"jhon\", \"age\"=&gt;\"15\", \"gender\"=&gt;\"male\"}, {\"name\"=&gt;\"nat\", \"age\"=&gt;\"14\", \"gender\"=&gt;\"female\"}]\noutput&gt; item_data: [{\"id\"=&gt;\"1\", \"name\"=&gt;\"book\", nil=&gt;nil}]\n</code></pre>\n\n<p>To avoid <code>nil</code> values you can add <code>compact</code> method call before <code>zip</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": false, "score": 0, "last_activity_date": 1534822404, "last_edit_date": 1534822404, "creation_date": 1534797901, "answer_id": 51938252, "question_id": 51924810, "link": "https://stackoverflow.com/questions/51924810/ruby-how-to-parse-csv-file-with-multiple-row-data-type/51938252#51938252", "title": "Ruby, how to parse csv file with multiple row data type", "body": "<p><strong>Data</strong></p>\n\n<p>Here is the data from the question, but is rearranged somewhat (for a reason that will be made clear).</p>\n\n<pre><code>data =&lt;&lt;_\ninput = 'Item Data,,\nid,name,\n1,book,'\n,,,\nUser Data,,\nname,age,gender\njhon,15,male\nnat,14,female\n_\n</code></pre>\n\n<p>Let's write it to file.</p>\n\n<pre><code>FNAME = 'temp.csv'\nFile.write(FNAME, data)\n  #=&gt; 98\n</code></pre>\n\n<p>We need to specify the order of blocks of data in the file so that the variables <code>user_data</code> and <code>item_data</code> are assigned correctly.</p>\n\n<pre><code>order = ['user data', 'item data']\n</code></pre>\n\n<p><strong>Step 1: Clean and organize the data</strong></p>\n\n<p>The file is a bit of a <a href=\"https://dictionary.cambridge.org/dictionary/english/a-dog-s-breakfast\" rel=\"nofollow noreferrer\">dog's breakfast</a>. It needs cleaning and reordering. This should be viewed as a separate first step. The goal here is to construct an array of stings that are in the form that allows us to use <code>CSV</code> methods to construct the (array of) arrays of hashes of interest.</p>\n\n<pre><code>csv_data = File.read(FNAME).\n  gsub(/\\Ainput =\\s+\\'|\\,+\\'?$/, '').\n  split(/(?&lt;=\\n)\\n/).\n  sort_by { |s| order.index(s.downcase[/\\A.+?$/]) }.\n  map { |s| s.sub(/\\A.+?\\n/, '') }\n    #=&gt; [\"name,age,gender\\njhon,15,male\\nnat,14,female\\n\",\n    #    \"id,name\\n1,book\\n\"]\n</code></pre>\n\n<p><strong>Step 2: Use CSV methods to obtain the desired result</strong></p>\n\n<p>We may now use <a href=\"http://ruby-doc.org/stdlib-2.5.1/libdoc/csv/rdoc/CSV.html\" rel=\"nofollow noreferrer\">CSV methods</a> to obtain the desired result.</p>\n\n<pre><code>require 'csv'\n\nuser_data, item_data =\n  csv_data.map { |s| CSV.parse(s, headers: true, converters: :numeric,\n    header_converters: :symbol).map { |row| row.to_a.to_h } }\n  #=&gt; [[{:name=&gt;\"jhon\", :age=&gt;15, :gender=&gt;\"male\"},\n  #     {:name=&gt;\"nat\", :age=&gt;14, :gender=&gt;\"female\"}],\n  #    [{:id=&gt;1, :name=&gt;\"book\"}]]\n\nuser_data\n  #=&gt; [{:name=&gt;\"jhon\", :age=&gt;15, :gender=&gt;\"male\"},\n  #    {:name=&gt;\"nat\", :age=&gt;14, :gender=&gt;\"female\"}]\nitem_data\n  #=&gt; [{:id=&gt;1, :name=&gt;\"book\"}]]\n</code></pre>\n\n<p><strong>The steps for cleaning and organizing the data</strong></p>\n\n<p>Three regular expressions will be used for this task.</p>\n\n<pre><code>r1 = /\n     \\A               # match the beginning of the string\n     input[ ]=[ ]+\\' # match 'input =', then &gt;= 1 spaces then a single quote\n     |                # or\n     \\,+              # match &gt;= 1 commas\n     \\'?              # optionally match a single quote\n     $                # match the end of the line\n     /x               # free-spacing regex definition mode\n\nr2 = /\n     (?&lt;=\\n) # match a newline in a positive lookbehind\n     \\n      # match a newline\n     /x\n\nr3 = /\n     \\A   # match the beginning of the string\n     .+?  # match &gt; 0 characters, lazily\n     \\n   # match newline\n     /x\n\na = File.read(FNAME)\n  #=&gt; \"input = 'Item Data,,\\n...female\\n\"\nb = a.gsub(r1, '')\n  #=&gt; \"Item Data\\nid,name\\n1,book\\n\\nUser Data\\n\n  #    name,age,gender\\njhon,15,male\\nnat,14,female\\n\"\n</code></pre>\n\n<p>(I've arbitrarily broken the above return value (string) to improve readability.)</p>\n\n<pre><code>c = b.split(r2)\n  #=&gt; [\"Item Data\\nid,name\\n1,book\\n\",\n  #    \"User Data\\nname,age,gender\\njhon,15,male\\nnat,14,female\\n\"]\nd = c.sort_by { |s| order.index(s.downcase[r3].chomp) }\n  #=&gt; [\"User Data\\nname,age,gender\\njhon,15,male\\nnat,14,female\\n\",\n  #    \"Item Data\\nid,name\\n1,book\\n\"]\ncsv_data = d.map { |s| s.sub(r3, '') }\n  #=&gt; [\"name,age,gender\\njhon,15,male\\nnat,14,female\\n\",\n  #    \"id,name\\n1,book\\n\"]\n</code></pre>\n\n<p><strong>Steps used to construct the arrays of hashes</strong></p>\n\n<pre><code>enum = csv_data.map\n  #=&gt; #&lt;Enumerator: [\"name,age,gender\\njhon,15,male\\nnat,14,female\\n\",\n  #                  \"id,name\\n1,book\\n\"]:map&gt;\n</code></pre>\n\n<p>The first element of <code>enum</code> is generated and passed to the block, and the block variable<code>s</code> is assigned its value.</p>\n\n<pre><code>s = enum.next\n  #=&gt; \"name,age,gender\\njhon,15,male\\nnat,14,female\\n\"\n</code></pre>\n\n<p>The block calculations are now performed.</p>\n\n<pre><code>csv_tbl = CSV.parse(s, headers: true, converters: :numeric,\n                       header_converters: :symbol)\n  #=&gt; #&lt;CSV::Table mode:col_or_row row_count:3&gt;\n</code></pre>\n\n<p>In the following I've added a <code>puts</code> statement to display the values of intermediate calculatons.</p>\n\n<pre><code>user_data = csv_tbl.map do |row|\n  puts \"row=#{row.inspect}, row.to_a=#{row.to_a}\"\n  row.to_a.to_h\nend\n  #=&gt; [{:name=&gt;\"jhon\", :age=&gt;15, :gender=&gt;\"male\"},\n  #    {:name=&gt;\"nat\", :age=&gt;14, :gender=&gt;\"female\"}]\n</code></pre>\n\n<p>The following is printed. (I've added newlines to avoid the need for the reader to scroll horizontally.)</p>\n\n<pre><code>row=#&lt;CSV::Row name:\"jhon\" age:15 gender:\"male\"&gt;,\n  row.to_a=[[:name, \"jhon\"], [:age, 15], [:gender, \"male\"]]\nrow=#&lt;CSV::Row name:\"nat\" age:14 gender:\"female\"&gt;,\n  row.to_a=[[:name, \"nat\"], [:age, 14], [:gender, \"female\"]]\n</code></pre>\n\n<p>Next, the calculation of <code>item</code> begins as follows.</p>\n\n<pre><code>s = enum_outer.next\n  #=&gt; \"id,name\\n1,book\\n\"\n</code></pre>\n\n<p>The remaining calculations are similar to those for computing <code>user_data</code>.</p>\n\n<p><strong>Advantages of two-step approach</strong></p>\n\n<p>One important reason for doing this in two steps is to simplify debugging. The initial testing of the first step is visual and can be done line-by-line. The second step is straightward once the data is in the appropriate format.</p>\n\n<p>Also, should the format of the file change in future, only the first step must be revised.</p>\n"}], "owner": {"reputation": 25, "user_id": 9929746, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-gNo8C0Ca5uY/AAAAAAAAAAI/AAAAAAAAACI/-pqfbcNOls0/photo.jpg?sz=128", "display_name": "M Umar Ramadhana", "link": "https://stackoverflow.com/users/9929746/m-umar-ramadhana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1049, "favorite_count": 0, "accepted_answer_id": 51925416, "answer_count": 4, "score": 0, "last_activity_date": 1534822404, "creation_date": 1534744498, "question_id": 51924810, "link": "https://stackoverflow.com/questions/51924810/ruby-how-to-parse-csv-file-with-multiple-row-data-type", "title": "Ruby, how to parse csv file with multiple row data type", "body": "<p>so given this csv file</p>\n\n<pre><code>User Data,,\nname,age,gender\njhon,15,male\nnat,14,female\n,,,\nItem Data,,\nid,name,\n1,book,\n</code></pre>\n\n<p>what i want is it will looks like</p>\n\n<pre><code>user_data=[{name: 'jhon', age: '15', gender: 'male'},{}]\nitem_data=[{id: 1, name: 'book'},{}]\n</code></pre>\n\n<p>how do i do that on ruby, as far as i know is using <code>CSV</code> library. but it parse only the first row to be detected as header. but in this case i have 2 kind of header which is <code>user data</code> and <code>item data</code>. im using ruby on rails to input the csv file to databases using rake task</p>\n"}, {"tags": ["arrays", "ruby", "multidimensional-array"], "comments": [{"owner": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 0, "creation_date": 1534740578, "post_id": 51924291, "comment_id": 90798024, "body": "Another way: <code>n.times.map { |_| [] }</code>"}, {"owner": {"reputation": 7994, "user_id": 1625339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b8ba46f911517c8b2ccc39e0be9050c0?s=128&d=identicon&r=PG", "display_name": "Aetherus", "link": "https://stackoverflow.com/users/1625339/aetherus"}, "edited": false, "score": 7, "creation_date": 1534740598, "post_id": 51924291, "comment_id": 90798027, "body": "Slightly more succinct: <code>Array.new(n){[]}</code>"}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 3, "creation_date": 1534740782, "post_id": 51924291, "comment_id": 90798058, "body": "Smells like <i>XY problem</i>. Maybe you need <a href=\"https://ruby-doc.org/stdlib/libdoc/matrix/rdoc/Matrix.html\" rel=\"nofollow noreferrer\"><code>Matrix</code></a>?"}, {"owner": {"reputation": 11741, "user_id": 1934428, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/072774c5d4204a1c2385560e6114a887?s=128&d=identicon&r=PG", "display_name": "user1934428", "link": "https://stackoverflow.com/users/1934428/user1934428"}, "edited": false, "score": 4, "creation_date": 1534744838, "post_id": 51924291, "comment_id": 90799112, "body": "@Neddy: Note also that if you have subarrays - empty or not - the &quot;parent&quot; array is not empty."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "reply_to_user": {"reputation": 7994, "user_id": 1625339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b8ba46f911517c8b2ccc39e0be9050c0?s=128&d=identicon&r=PG", "display_name": "Aetherus", "link": "https://stackoverflow.com/users/1625339/aetherus"}, "edited": false, "score": 0, "creation_date": 1534746034, "post_id": 51924291, "comment_id": 90799424, "body": "As indicated by @Aetherus&#39;s comment, if a block makes no use of values passed to it there is no need to define block variables."}, {"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 3, "creation_date": 1534753046, "post_id": 51924291, "comment_id": 90802719, "body": "&quot;an empty array of empty sub arrays&quot; is a self-contradiction. An empty array contains nothing."}, {"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1534753202, "post_id": 51924291, "comment_id": 90802800, "body": "You have not made clear at all whether &quot;an array with all the sub arrays being the same object&quot; is wanted or not."}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "reply_to_user": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1534759267, "post_id": 51924291, "comment_id": 90806177, "body": "@sawa doesn&#39;t <i>&quot;But&quot;</i> imply that it is unwanted?"}, {"owner": {"reputation": 37, "user_id": 7630072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d37e29689b9b8c49a9f7aad08371a220?s=128&d=identicon&r=PG&f=1", "display_name": "Neddy", "link": "https://stackoverflow.com/users/7630072/neddy"}, "reply_to_user": {"reputation": 7994, "user_id": 1625339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b8ba46f911517c8b2ccc39e0be9050c0?s=128&d=identicon&r=PG", "display_name": "Aetherus", "link": "https://stackoverflow.com/users/1625339/aetherus"}, "edited": false, "score": 0, "creation_date": 1534765402, "post_id": 51924291, "comment_id": 90809681, "body": "Thanks for the comments, I&#39;ve modified the question for clarity. @Aetherus Thanks for the useful comment."}, {"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "reply_to_user": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1534818493, "post_id": 51924291, "comment_id": 90831318, "body": "@Stefan It may very weakly imply that, but too weak to be sure."}], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 7630072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d37e29689b9b8c49a9f7aad08371a220?s=128&d=identicon&r=PG&f=1", "display_name": "Neddy", "link": "https://stackoverflow.com/users/7630072/neddy"}, "edited": false, "score": 0, "creation_date": 1534896132, "post_id": 51934811, "comment_id": 90866836, "body": "This is what I am going with, I wasn&#39;t sure if there was a more correct way to do this, but it appears not. Thank you!"}], "tags": [], "owner": {"reputation": 1081, "user_id": 1288687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7217dd12520210182c093856f60cd376?s=128&d=identicon&r=PG", "display_name": "knugie", "link": "https://stackoverflow.com/users/1288687/knugie"}, "is_accepted": true, "score": 1, "last_activity_date": 1534781886, "creation_date": 1534781886, "answer_id": 51934811, "question_id": 51924291, "link": "https://stackoverflow.com/questions/51924291/create-array-of-empty-subarrays-in-ruby/51934811#51934811", "title": "Create array of empty subarrays in Ruby", "body": "<p><code>Array.new(n){ [] }</code>is totally fine! The block ensures that a new instance of Array is created n times. As you pointed out, you would otherwise reference the same object (instance of Array) n times.</p>\n"}, {"comments": [{"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1534832291, "post_id": 51937698, "comment_id": 90834766, "body": "Why use <code>map</code> when you can simply pass a block to <code>new</code> as shown in the beginning?"}, {"owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "reply_to_user": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1534839847, "post_id": 51937698, "comment_id": 90838560, "body": "@Stefan Ooops! Edit. Thanks. But I&#39;m still not sure about what&#39;s the OP issue."}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 1, "creation_date": 1534840473, "post_id": 51937698, "comment_id": 90838876, "body": "The original question was <i>&quot;is there a better way than Array.new(n){ |_| [] }&quot;</i>, so the OP probably just wanted to know if there is a shorthand syntax to create an array of empty arrays."}], "tags": [], "owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "is_accepted": false, "score": 3, "last_activity_date": 1534839767, "last_edit_date": 1534839767, "creation_date": 1534794904, "answer_id": 51937698, "question_id": 51924291, "link": "https://stackoverflow.com/questions/51924291/create-array-of-empty-subarrays-in-ruby/51937698#51937698", "title": "Create array of empty subarrays in Ruby", "body": "<p>All the proposed method to get this array <code>[[], [], [],...]</code> works fine:</p>\n\n<pre><code>Array.new(n, []) # the best, 20 times faster\nArray.new(n){ [] }\nn.times.map { [] }\n</code></pre>\n\n<p>The first is the fastest, so the best, but works strangely (see next).</p>\n\n<blockquote>\n  <p>it created an array with all the sub arrays being the same object</p>\n</blockquote>\n\n<p>If i get the point, you mean that whit the methods described happens what follows:</p>\n\n<pre><code>a = Array.new(5, [])\np a # =&gt; [[], [], [], [], [], [], [], [], [], []]\np a.map { |e| e.object_id} # =&gt; [70189488740180, 70189488740180, 70189488740180, 70189488740180, 70189488740180]]\n</code></pre>\n\n<p>The object is the same, so if you try to fill subarrays with values, all of the subarrays assume the same value (replication):</p>\n\n<pre><code>a[0][0] = 10\np a # =&gt; [[10], [10], [10], [10], [10]]\n</code></pre>\n\n<p>To avoid this don't pass a default value, but map to empty array instead:</p>\n\n<pre><code>a = Array.new(5).map{ |e| [] }\np a # =&gt; [[], [], [], [], []]\n</code></pre>\n\n<p>Or pass the block</p>\n\n<pre><code>a = Array.new(5){ [] }\na = 5.times.map { [] }\n</code></pre>\n\n<p>Now each subarray is an independent object:</p>\n\n<pre><code>p a.map { |e| e.object_id} # =&gt; [70253023825640, 70253023825620, 70253023825600, 70253023825580, 70253023825560]\n</code></pre>\n\n<p>And if you insert some values there is no replication:</p>\n\n<pre><code>a[0][0] = 10\na[1][0] = 20\np a # =&gt; [[10], [20], [], [], []]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 1, "creation_date": 1534832202, "post_id": 51942392, "comment_id": 90834728, "body": "The assignment in <code>x = []</code> is superfluous, you just need <code>arr.map!{ [] }</code>. Which is merely <code>Array.new(n) { [] }</code> on two lines."}], "tags": [], "owner": {"reputation": 973, "user_id": 9989384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/530602201f9551563176b0b648b7d50b?s=128&d=identicon&r=PG&f=1", "display_name": "Cryptex Technologies", "link": "https://stackoverflow.com/users/9989384/cryptex-technologies"}, "is_accepted": false, "score": 0, "last_activity_date": 1534830833, "creation_date": 1534830833, "answer_id": 51942392, "question_id": 51924291, "link": "https://stackoverflow.com/questions/51924291/create-array-of-empty-subarrays-in-ruby/51942392#51942392", "title": "Create array of empty subarrays in Ruby", "body": "<p>Please try this. It work for me.</p>\n\n<pre><code>  n = 15\n  arr = Array.new(n)\n  arr.map!{ |x| x = [] }\n</code></pre>\n\n<p>Now, putting value in the array.</p>\n\n<pre><code>arr[0][0] = 10 \narr[5][0] = 50\np arr # =&gt; [[10], [], [], [], [], [50], [], [], [], [], [], [], [], [], []]\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 7630072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d37e29689b9b8c49a9f7aad08371a220?s=128&d=identicon&r=PG&f=1", "display_name": "Neddy", "link": "https://stackoverflow.com/users/7630072/neddy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 885, "favorite_count": 2, "accepted_answer_id": 51934811, "answer_count": 3, "score": 3, "last_activity_date": 1534839767, "creation_date": 1534740225, "last_edit_date": 1534818769, "question_id": 51924291, "link": "https://stackoverflow.com/questions/51924291/create-array-of-empty-subarrays-in-ruby", "title": "Create array of empty subarrays in Ruby", "body": "<p>I want to create an array of <code>n</code> number of distinct empty subarrays.</p>\n\n<p>Is this the best way?</p>\n\n<pre><code>Array.new(n){ [] }\n</code></pre>\n\n<p>It was as follows, but I modified after reading comments:</p>\n\n<pre><code>Array.new(n){ |_| [] }\n</code></pre>\n\n<p>I tried:  </p>\n\n<pre><code>Array.new(n, [])\n</code></pre>\n\n<p>but it creates an array with all the subarrays being the same object, which I do not want.</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 5242, "user_id": 3083848, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/JMddU.jpg?s=128&g=1", "display_name": "Emu", "link": "https://stackoverflow.com/users/3083848/emu"}, "edited": false, "score": 1, "creation_date": 1534739917, "post_id": 51924181, "comment_id": 90797875, "body": "You don&#39;t have any post in your database I guess (means <code>@posts</code> variable has no object). Otherwise, for each post <code>Hello or something else</code> will print in the html."}, {"owner": {"reputation": 1831, "user_id": 4160532, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Ey34JagqMzQ/AAAAAAAAAAI/AAAAAAAAABo/G70W8D2LXM4/photo.jpg?sz=128", "display_name": "Kedarnag Mukanahallipatna", "link": "https://stackoverflow.com/users/4160532/kedarnag-mukanahallipatna"}, "edited": false, "score": 0, "creation_date": 1534740338, "post_id": 51924181, "comment_id": 90797969, "body": "That was my mistake, to say it should be enclosed within &lt;%= %&gt;. I assumed something else. Thank you."}, {"owner": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 0, "creation_date": 1534740359, "post_id": 51924181, "comment_id": 90797976, "body": "What does your actual code contains: &#39;Hello or ...&#39; OR something else?"}, {"owner": {"reputation": 1, "user_id": 6673665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa9e61f72a1d7ce49c2ce2f8eff69c6b?s=128&d=identicon&r=PG&f=1", "display_name": "Emin", "link": "https://stackoverflow.com/users/6673665/emin"}, "reply_to_user": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 0, "creation_date": 1534809670, "post_id": 51924181, "comment_id": 90829781, "body": "@JagdeepSingh, I just wondered why it doesn&#39;t print as I am following tutorial step by step( No code yet ). Thank you for the response."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 6673665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa9e61f72a1d7ce49c2ce2f8eff69c6b?s=128&d=identicon&r=PG&f=1", "display_name": "Emin", "link": "https://stackoverflow.com/users/6673665/emin"}, "edited": false, "score": 0, "creation_date": 1534809531, "post_id": 51924307, "comment_id": 90829759, "body": "Thank you for the detailed response, @Emu! Much appreciated! Now, I have to learn how to create a post!"}], "tags": [], "owner": {"reputation": 5242, "user_id": 3083848, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/JMddU.jpg?s=128&g=1", "display_name": "Emu", "link": "https://stackoverflow.com/users/3083848/emu"}, "is_accepted": false, "score": 0, "last_activity_date": 1534740431, "creation_date": 1534740431, "answer_id": 51924307, "question_id": 51924181, "link": "https://stackoverflow.com/questions/51924181/ruby-block-printing-displaying-issue/51924307#51924307", "title": "Ruby block printing/displaying issue", "body": "<p>You don't have any <strong>post</strong> in your database I guess (means <code>@posts</code> variable has no object). Otherwise, for each post <strong>Hello or something else</strong> will print in the html.</p>\n\n<p>when you want to print something in <code>.erb</code>, you will have to enclose it within <code>&lt;%= %&gt;</code> only when you want to show something fetch from the database/from the controller instance variable/from the helper file. </p>\n\n<p>If you loop through like below code then you will get the difference:</p>\n\n<pre><code>&lt;% 5.times do |t| %&gt;\n  Hello or something else\n&lt;% end %&gt;\n</code></pre>\n\n<p>It'll print <code>Hello or something else</code> five times in the html. </p>\n\n<p>Let's say, Your <strong>Post</strong> table in database contains some data. SO, we can do that like below:</p>\n\n<pre><code>&lt;% @posts.each do |post| %&gt;\n  &lt;%= post.title %&gt; # I assumed your post model contains a title attribute\n&lt;% end %&gt;\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 6673665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa9e61f72a1d7ce49c2ce2f8eff69c6b?s=128&d=identicon&r=PG&f=1", "display_name": "Emin", "link": "https://stackoverflow.com/users/6673665/emin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1534740431, "creation_date": 1534739409, "last_edit_date": 1534740396, "question_id": 51924181, "link": "https://stackoverflow.com/questions/51924181/ruby-block-printing-displaying-issue", "title": "Ruby block printing/displaying issue", "body": "<p>I am a newbie. The tutorial I am following says anything entered between blocks will be printed/displayed. However, I have not been able to do it.</p>\n\n<p><a href=\"https://www.youtube.com/watch?v=0OzDgi0zqJU\" rel=\"nofollow noreferrer\">https://www.youtube.com/watch?v=0OzDgi0zqJU</a></p>\n\n<p>at 3:49, he prints out hello or any word between the block. What am I doing wrong that it does not print out anything I enter between block. </p>\n\n<pre><code>&lt;h1&gt;All Posts&lt;/h1&gt;\n\n&lt;% @posts.each do |post|  %&gt; \n  Hello or something else \n&lt;% end %&gt;\n</code></pre>\n\n<p>RESULT: ALL POSTS</p>\n"}, {"tags": ["arrays", "ruby"], "comments": [{"owner": {"reputation": 1518, "user_id": 10000141, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ac09f6a889c1f8aa3cc060d30be17b7?s=128&d=identicon&r=PG&f=1", "display_name": "Joel", "link": "https://stackoverflow.com/users/10000141/joel"}, "edited": false, "score": 3, "creation_date": 1534732118, "post_id": 51923433, "comment_id": 90796443, "body": "Welcome to SO. We are <b>not</b> a free coding service. Please include code you&#39;ve attempted in your problem so we can adequately help you."}, {"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1534732502, "post_id": 51923433, "comment_id": 90796518, "body": "What are lemons and pears? Are they objects referred to with such local variables? Are they some sort of strings or symbols that are spelled like that? Are they instances of particular classes with some sort of names like that? Or something else?"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1534734072, "post_id": 51923433, "comment_id": 90796810, "body": "<code>[:pears, :pears, :lemons, :figs, :pears, :figs, :lemons, :figs, :apples, :pears, :pears].each_with_object(Hash.new(0)) { |fruit, counts| counts[fruit] += 1 }.values_at(:pears, :lemons) == [5, 2] #=&gt; true</code>. This uses a <i>counting hash</i>, <a href=\"http://ruby-doc.org/core-2.5.1/Hash.html#method-c-new\" rel=\"nofollow noreferrer\">Hash::new</a> with a default value of zero."}, {"owner": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 0, "creation_date": 1534737031, "post_id": 51923433, "comment_id": 90797353, "body": "You have no ruby array. Can&#39;t proceed."}], "answers": [{"tags": [], "owner": {"reputation": 1223, "user_id": 3422357, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/F984j.jpg?s=128&g=1", "display_name": "Vishal Taj PM", "link": "https://stackoverflow.com/users/3422357/vishal-taj-pm"}, "is_accepted": true, "score": 1, "last_activity_date": 1534735700, "creation_date": 1534735700, "answer_id": 51923813, "question_id": 51923433, "link": "https://stackoverflow.com/questions/51923433/check-for-specific-combinations-of-values-in-an-array/51923813#51923813", "title": "Check for specific combinations of values in an array", "body": "<p>You can use <strong>Array</strong> <code>count</code> method to get the count of a particular element in an array.</p>\n\n<pre><code>fruits = [:pears, :pears, :lemons, :figs, :pears, :figs, :lemons, :figs, :apples, :pears, :pears]\n\nputs fruits.count(:pears) == 5 &amp;&amp; fruits.count(:lemons) == 2 # will return true if the pears is 5 and lemons is 2 in fruit array\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "is_accepted": false, "score": 0, "last_activity_date": 1534738166, "creation_date": 1534738166, "answer_id": 51924040, "question_id": 51923433, "link": "https://stackoverflow.com/questions/51923433/check-for-specific-combinations-of-values-in-an-array/51924040#51924040", "title": "Check for specific combinations of values in an array", "body": "<p>If you want to slightly improve the performance compared to straightforward subsequent calls to <code>count</code>, you might use <code>Enumerable#each_with_object</code>:</p>\n\n<pre><code># Thanks Vishal for the input data prepared\nfruits = [\n  :pears, :pears, :lemons, :figs, :pears, :figs, \n  :lemons, :figs, :apples, :pears, :pears]\n\nfruits.each_with_object(Hash.new(0)) { |f, acc| acc[f] += 1 }\n#\u21d2\u00a0{:pears=&gt;5, :lemons=&gt;2, :figs=&gt;3, :apples=&gt;1}      \nend\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 10211272, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-bl8V6WaNb9g/AAAAAAAAAAI/AAAAAAAAAOE/bmoTQapqqCg/photo.jpg?sz=128", "display_name": "Penguin", "link": "https://stackoverflow.com/users/10211272/penguin"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39, "favorite_count": 0, "closed_date": 1534738139, "accepted_answer_id": 51923813, "answer_count": 2, "score": -3, "last_activity_date": 1534738166, "creation_date": 1534731725, "last_edit_date": 1534737067, "question_id": 51923433, "link": "https://stackoverflow.com/questions/51923433/check-for-specific-combinations-of-values-in-an-array", "closed_reason": "Not suitable for this site", "title": "Check for specific combinations of values in an array", "body": "<p>I have an array containing both lemons and pears. I want to check if there are exactly five pears and two lemons in that array without creating a separate array for the two. How could I do that?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "model-view-controller", "model", "routes"], "answers": [{"comments": [{"owner": {"reputation": 5242, "user_id": 3083848, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/JMddU.jpg?s=128&g=1", "display_name": "Emu", "link": "https://stackoverflow.com/users/3083848/emu"}, "edited": false, "score": 0, "creation_date": 1534740891, "post_id": 51923497, "comment_id": 90798074, "body": "A suggestion: Your association is okay but it&#39;s not database friendly. As you see that, the <code>Like</code> model is used for both <code>Comment</code> and <code>Article</code>, thus you need to define a Polymorphic association between the three models. It&#39;s more like Rails. :)"}, {"owner": {"reputation": 123, "user_id": 7520018, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7df75ba5ed2ce3e4cc3c94d3593113f?s=128&d=identicon&r=PG&f=1", "display_name": "ptent", "link": "https://stackoverflow.com/users/7520018/ptent"}, "reply_to_user": {"reputation": 5242, "user_id": 3083848, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/JMddU.jpg?s=128&g=1", "display_name": "Emu", "link": "https://stackoverflow.com/users/3083848/emu"}, "edited": false, "score": 0, "creation_date": 1534742214, "post_id": 51923497, "comment_id": 90798402, "body": "Thank you @Emu, I will read up on it. Is there any clear example of how I can make this a Polymorphic association without breaking it?"}, {"owner": {"reputation": 5242, "user_id": 3083848, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/JMddU.jpg?s=128&g=1", "display_name": "Emu", "link": "https://stackoverflow.com/users/3083848/emu"}, "edited": false, "score": 0, "creation_date": 1534742352, "post_id": 51923497, "comment_id": 90798441, "body": "Rails guides is the best place: <a href=\"https://guides.rubyonrails.org/association_basics.html#polymorphic-associations\" rel=\"nofollow noreferrer\">guides.rubyonrails.org/&hellip;</a> or, you can google it if you&#39;re still not convinced. (Rails Casts has videos too)"}], "tags": [], "owner": {"reputation": 123, "user_id": 7520018, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7df75ba5ed2ce3e4cc3c94d3593113f?s=128&d=identicon&r=PG&f=1", "display_name": "ptent", "link": "https://stackoverflow.com/users/7520018/ptent"}, "is_accepted": true, "score": 0, "last_activity_date": 1534732436, "creation_date": 1534732436, "answer_id": 51923497, "question_id": 51923385, "link": "https://stackoverflow.com/questions/51923385/rails-5-adding-likes-to-articles-and-comments/51923497#51923497", "title": "Rails 5 adding Likes to Articles and Comments", "body": "<p>I just figured it out, actually. </p>\n\n<pre><code>class Like &lt; ApplicationRecord\n  belongs_to :user\n  belongs_to :article\n  # belongs_to :comment\nend\n</code></pre>\n\n<p>Commenting the above out, it allows the @article \"like\" to save without a comment being referenced. Article likes are saved properly. However, article.likes.count still increments whenever an article.comment is liked. This means article.likes is always >= article.comments.likes; which is completely fine.</p>\n\n<p>I just changed the @article.likes to:</p>\n\n<pre><code>  &lt;%= \"#{@article.likes.where(comment_id: nil).count}\" %&gt;\n</code></pre>\n\n<p>Filtering out all the strictly article.likes. The comment.likes still work perfectly.</p>\n"}], "owner": {"reputation": 123, "user_id": 7520018, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7df75ba5ed2ce3e4cc3c94d3593113f?s=128&d=identicon&r=PG&f=1", "display_name": "ptent", "link": "https://stackoverflow.com/users/7520018/ptent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 597, "favorite_count": 0, "accepted_answer_id": 51923497, "answer_count": 1, "score": 0, "last_activity_date": 1534732650, "creation_date": 1534731281, "last_edit_date": 1534732650, "question_id": 51923385, "link": "https://stackoverflow.com/questions/51923385/rails-5-adding-likes-to-articles-and-comments", "title": "Rails 5 adding Likes to Articles and Comments", "body": "<p>Rails 5, I am trying to add Likes from scratch without a gem dependency. I am so close to having it down but am being completely stumped by what's happening when Comments get involved. </p>\n\n<p>Storing and saving article.likes worked perfectly. Then I got the comment.likes to work. Now, when I like a Comment, they individually store a new Like (great!), except now Article is not properly saving any likes, and even weirder: article.likes.count gives a TOTAL sum of all it's comments' likes.. I am sure this is an easy fix but I am just totally missing it and I've tried everything. I've gone down some deep rabbit holes for this.</p>\n\n<p>I think the problem lies in routing, or how the models relate.</p>\n\n<p>Articles have many Comments, and both of them have many Likes.\nHere are the models starting with like.rb:</p>\n\n<pre><code> class Like &lt; ApplicationRecord\n   belongs_to :user\n   belongs_to :article\n   belongs_to :comment\n\n   # Make sure that one user can only have one like per post or comment\n   validates :user_id, uniqueness: { scope: [:article_id, :comment_id] }\n\n end\n</code></pre>\n\n<p>article.rb</p>\n\n<pre><code>class Article &lt; ApplicationRecord\n\n  belongs_to :user\n\n  ...\n\n  # destroy associated comments on article deletion\n  has_many :comments, dependent: :destroy\n\n  has_many :likes, dependent: :destroy\n\nend\n</code></pre>\n\n<p>comment.rb</p>\n\n<pre><code>class Comment &lt; ApplicationRecord\n  belongs_to :article\n  belongs_to :user\n\n  ...\n\n  has_many :likes, dependent: :destroy\n\nend\n</code></pre>\n\n<p>routes.rb</p>\n\n<pre><code>  ...\n  resources :articles, :path =&gt; 'blog' do\n    resources :likes, only: [:create, :destroy]\n\n    resources :comments do\n      resources :likes, only: [:create, :destroy]\n    end\n\n  end\n</code></pre>\n\n<p>the meaty likes_controller.rb. Mind the #{}, EVERYTHING checks out the way it should, so why does the comment.likes.create save correctly, but the article.likes.create does not?? Help, please.</p>\n\n<pre><code>class LikesController &lt; ApplicationController\n  before_action :get_signed_in_user\n  before_action :comment_or_article\n\n  def create\n    if @comment_like\n      like_resource(comment)\n    else\n      like_resource(article)\n    end\n  end\n\n  def destroy\n    if @comment_like\n      comment.likes.where(user: current_user).destroy_all\n    else\n      article.likes.where(user: current_user).destroy_all\n    end\n    flash[:success] = \"Unliked! :(\"\n    redirect_to article_redirect(article)\n  end\n\n  private\n  def like_resource(obj)\n    if obj.likes.where(user: current_user.id).present?\n      flash[:error] = \"You've already upvoted this! + #{like_params} + #{@comment_like} + #{obj}\"\n    if @comment_like\n      if obj.likes.create(user: current_user, article: @article)\n        flash[:success] = \"Upvoted Comment! + #{like_params} + #{@comment_like} + #{obj}\"\n      else\n          flash[:error] = \"An error prevented you from upvoting.\"\n      end\n    elsif obj.likes.create(user: current_user)\n      flash[:success] = \"Upvoted Blog! + #{like_params} + #{@comment_like} + #{obj}\"\n    else\n      flash[:error] = \"An error prevented you from upvoting.\"\n    end\n    redirect_to article_path(article)\n  end\n\n  def get_signed_in_user\n    unless user_signed_in?\n      flash[:error] = \"Sign in to upvote!\"\n      redirect_back(fallback_location: articles_path)\n    end\n  end\n\n  # decide what we are liking\n  def comment_or_article\n    if comment\n      @comment_like = true\n    else\n      @comment_like = false\n    end\n  end\n\n  def article\n    @article = Article.find(params[:article_id])\n  end\n\n  def comment\n    unless params[:comment_id].nil?\n      @comment = article.comments.find(params[:comment_id])\n    end\n  end\n\n  def like_params\n    params.permit( :article_id, :comment_id).merge(user_id: current_user.id)\n  end\nend\n</code></pre>\n\n<p>Finally the like buttons in my articles/show.html.erb:</p>\n\n<pre><code>&lt;%= link_to \"Like\", article_likes_path(@article), method: :post %&gt;\n&lt;%= \"#{@article.likes.count}\" %&gt;\n\n... # inside loop to show comments:\n&lt;%= link_to \"Like\", article_comment_likes_path(@article, comment), method: :post %&gt;\n&lt;%= \"#{comment.likes.count}\" %&gt;\n</code></pre>\n\n<p>TLDR: \nComment likes work fine, save fine, count individually fine.\nArticle likes do not save, but article.likes.count === article.comments.likes.count. Why?\nI want article.likes to be completely unique, like it's own comments are.</p>\n\n<p>Thank you in advance.</p>\n\n<p>EDIT: took out <code>belongs_to :comments</code> in like.rb and refactored like_controller.rb main function to</p>\n\n<pre><code> private\n  def like_resource(obj)\n    if obj.likes.where(user: current_user.id).present?\n      flash[:error] = \"You've already upvoted this!\"\n    elsif obj.likes.create(user: current_user, article: @article)\n      flash[:success] = \"Upvoted!\"\n    else\n      flash[:error] = \"An error prevented you from upvoting.\"\n    end\n    redirect_to article_path(article)\n  end\n</code></pre>\n\n<p>Always supplying the @article helps when liking a comment. An Article like would not need a comment_id to save.</p>\n\n<p>Sorry for the long post, hopes this helps someone.</p>\n"}, {"tags": ["ruby", "heroku", "rubygems"], "comments": [{"owner": {"reputation": 1223, "user_id": 3422357, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/F984j.jpg?s=128&g=1", "display_name": "Vishal Taj PM", "link": "https://stackoverflow.com/users/3422357/vishal-taj-pm"}, "edited": false, "score": 1, "creation_date": 1534750544, "post_id": 51923032, "comment_id": 90801445, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/26760586/heroku-error-pushing-rails-app-to-heroku-heroku-cant-find-rails-app\">Heroku: Error pushing Rails app to Heroku, Heroku can&#39;t find Rails app</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1223, "user_id": 3422357, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/F984j.jpg?s=128&g=1", "display_name": "Vishal Taj PM", "link": "https://stackoverflow.com/users/3422357/vishal-taj-pm"}, "is_accepted": false, "score": 1, "last_activity_date": 1534750921, "creation_date": 1534750921, "answer_id": 51926108, "question_id": 51923032, "link": "https://stackoverflow.com/questions/51923032/error-with-ruby-while-pushing-heroku-app/51926108#51926108", "title": "Error with ruby while pushing Heroku app", "body": "<p>Heroku does not support your specified ruby version <code>2.1.5</code>.</p>\n\n<p>with reference to Heroku Dev Docs</p>\n\n<p><a href=\"https://devcenter.heroku.com/articles/ruby-support#supported-runtimes\" rel=\"nofollow noreferrer\">[Heroku Dev] Supported ruby version</a></p>\n\n<p>you can update <strong>ruby version</strong> in your <strong>Gem List</strong></p>\n"}], "owner": {"reputation": 843, "user_id": 6035021, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/10154093675323304/picture?type=large", "display_name": "Austin Berenyi", "link": "https://stackoverflow.com/users/6035021/austin-berenyi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1534750921, "creation_date": 1534727132, "question_id": 51923032, "link": "https://stackoverflow.com/questions/51923032/error-with-ruby-while-pushing-heroku-app", "title": "Error with ruby while pushing Heroku app", "body": "<p>I'm attempting to set up an app on Heroku to help me to a token swap for the Spotify SDK. I'm following the documentation on Heroku but I keep getting this error no matter what I do. When I follow the same process with their example <code>node-js-getting-started</code> app everything works fine. No errors. I copy the same process but use the <code>SpotifyTokenSwap</code> repo instead. Ruby ruby 2.1.5p273 is installed. I just verified this.</p>\n\n<p>Can anyone tell what's going on?</p>\n\n<pre><code>$ git push heroku master\n\nCounting objects: 58, done.\nDelta compression using up to 8 threads.\nCompressing objects: 100% (55/55), done.\nWriting objects: 100% (58/58), 9.20 KiB | 3.07 MiB/s, done.\nTotal 58 (delta 24), reused 0 (delta 0)\nremote: Compressing source files... done.\nremote: Building source:\nremote: \nremote: -----&gt; Ruby app detected\nremote: -----&gt; Compiling Ruby/Rack\nremote:        Command: 'set -o pipefail; curl -L --fail --retry 5 --retry-delay 1 --connect-timeout 3 --max-time 30 https://s3-external-1.amazonaws.com/heroku-buildpack-ruby/heroku-16/ruby-2.1.5.tgz -s -o - | tar zxf - ' failed on attempt 1 of 3.\nremote:        Command: 'set -o pipefail; curl -L --fail --retry 5 --retry-delay 1 --connect-timeout 3 --max-time 30 https://s3-external-1.amazonaws.com/heroku-buildpack-ruby/heroku-16/ruby-2.1.5.tgz -s -o - | tar zxf - ' failed on attempt 2 of 3.\nremote: \nremote:  !\nremote:  !     An error occurred while installing ruby-2.1.5\nremote:  !     \nremote:  !     Heroku recommends you use the latest supported Ruby version listed here:\nremote:  !     https://devcenter.heroku.com/articles/ruby-support#supported-runtimes\nremote:  !     \nremote:  !     For more information on syntax for declaring a Ruby version see:\nremote:  !     https://devcenter.heroku.com/articles/ruby-versions\nremote:  !     \nremote:  !     \nremote:  !     Debug InformationCommand: 'set -o pipefail; curl -L --fail --retry 5 --retry-delay 1 --connect-timeout 3 --max-time 30 https://s3-external-1.amazonaws.com/heroku-buildpack-ruby/heroku-16/ruby-2.1.5.tgz -s -o - | tar zxf - ' failed unexpectedly:\nremote:  !     \nremote:  !     gzip: stdin: unexpected end of file\nremote:  !     tar: Child returned status 1\nremote:  !     tar: Error is not recoverable: exiting now\nremote:  !\nremote:  !     Push rejected, failed to compile Ruby app.\nremote: \nremote:  !     Push failed\nremote: Verifying deploy...\nremote: \nremote: !   Push rejected to guarded-tor-50875.\nremote: \nTo https://git.heroku.com/guarded-tor-50875.git\n ! [remote rejected] master -&gt; master (pre-receive hook declined)\nerror: failed to push some refs to 'https://git.heroku.com/guarded-tor-50875.git'\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "stripe-payments"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 10127510, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-NlVyYVA6iaw/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7oKShDsVTkKs4la14OYOMc4CcUBTQ/mo/photo.jpg?sz=128", "display_name": "Charles Villanueva", "link": "https://stackoverflow.com/users/10127510/charles-villanueva"}, "edited": false, "score": 0, "creation_date": 1537486596, "post_id": 51923394, "comment_id": 91812848, "body": "thanks for your response @Kedarnag Mukanahallipatna...I was able to solve it after a couple of hours after posting it.."}], "tags": [], "owner": {"reputation": 1831, "user_id": 4160532, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Ey34JagqMzQ/AAAAAAAAAAI/AAAAAAAAABo/G70W8D2LXM4/photo.jpg?sz=128", "display_name": "Kedarnag Mukanahallipatna", "link": "https://stackoverflow.com/users/4160532/kedarnag-mukanahallipatna"}, "is_accepted": false, "score": 0, "last_activity_date": 1534731418, "creation_date": 1534731418, "answer_id": 51923394, "question_id": 51922366, "link": "https://stackoverflow.com/questions/51922366/no-attached-payment-source-error-when-creating-stripe-customer/51923394#51923394", "title": "No attached payment source error when creating Stripe customer", "body": "<p>The problem with your request is, when you're creating a customer, you're sending in the wrong parameters. </p>\n\n<p>It should be </p>\n\n<p><code>Stripe::Customer.create(description: email, plan: plan_id, source: stripe_card_token)</code></p>\n\n<p>Check <a href=\"https://stripe.com/docs/api/ruby#create_customer\" rel=\"nofollow noreferrer\">here</a></p>\n"}], "owner": {"reputation": 11, "user_id": 10127510, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-NlVyYVA6iaw/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7oKShDsVTkKs4la14OYOMc4CcUBTQ/mo/photo.jpg?sz=128", "display_name": "Charles Villanueva", "link": "https://stackoverflow.com/users/10127510/charles-villanueva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1089, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1534737266, "creation_date": 1534718159, "last_edit_date": 1534737266, "question_id": 51922366, "link": "https://stackoverflow.com/questions/51922366/no-attached-payment-source-error-when-creating-stripe-customer", "title": "No attached payment source error when creating Stripe customer", "body": "<p>I am trying to follow some tutorials here, have encountered some errors. Hope someone could help me on this.</p>\n\n<pre><code>Stripe::InvalidRequestError in Users::RegistrationsController#create\n\nThis customer has no attached payment source\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>attr_accessor :stripe_card_token\n\ndef save_with_payment\n  if valid?\n    customer = Stripe::Customer.create(description: email, plan: plan_id, card: stripe_card_token)\n    self.stripe_customer_token = customer.id\n    save!\n  end\nend\n</code></pre>\n"}, {"tags": ["ruby", "encryption", "cryptography", "rsa"], "answers": [{"comments": [{"owner": {"reputation": 65, "user_id": 10247375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca0584a0b95d7cb3d870bc3ac07fe115?s=128&d=identicon&r=PG&f=1", "display_name": "JamieCoder", "link": "https://stackoverflow.com/users/10247375/jamiecoder"}, "edited": false, "score": 0, "creation_date": 1534775104, "post_id": 51922844, "comment_id": 90815718, "body": "Are you saying that encryption with the private key isn&#39;t actually encryption, it&#39;s signing, and that&#39;s why <code>PKCS1_OAEP_PADDING</code> isn&#39;t available? How can you recover the plaintext through public key decryption if it&#39;s a signature? And why is it bad?"}, {"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "reply_to_user": {"reputation": 65, "user_id": 10247375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca0584a0b95d7cb3d870bc3ac07fe115?s=128&d=identicon&r=PG&f=1", "display_name": "JamieCoder", "link": "https://stackoverflow.com/users/10247375/jamiecoder"}, "edited": false, "score": 0, "creation_date": 1534775740, "post_id": 51922844, "comment_id": 90816137, "body": "Yes, I&#39;m saying exactly that. And not just here, but also <a href=\"https://crypto.stackexchange.com/a/15998/1172\">on the crypto site</a>. The recovery of plaintext is not possible <i>unless</i> a scheme with message recovery is used. Message recovery is not bad in itself; using the wrong padding mechanism for signature generation <i>is</i> however bad. OAEP was not designed for signature generation. A lot of the security of RSA is derived from the padding; RSA without padding is not even remotely secure (if messages can have any value)."}, {"owner": {"reputation": 65, "user_id": 10247375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca0584a0b95d7cb3d870bc3ac07fe115?s=128&d=identicon&r=PG&f=1", "display_name": "JamieCoder", "link": "https://stackoverflow.com/users/10247375/jamiecoder"}, "edited": false, "score": 0, "creation_date": 1534776204, "post_id": 51922844, "comment_id": 90816424, "body": "Okay, thanks for the clarification. I did not know that. Is RSA private key encryption using <code>PKCS1_PADDING</code> insecure as well, or is that OK?"}, {"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "reply_to_user": {"reputation": 65, "user_id": 10247375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca0584a0b95d7cb3d870bc3ac07fe115?s=128&d=identicon&r=PG&f=1", "display_name": "JamieCoder", "link": "https://stackoverflow.com/users/10247375/jamiecoder"}, "edited": false, "score": 0, "creation_date": 1534776801, "post_id": 51922844, "comment_id": 90816755, "body": "There is no such as PKCS#1 padding. <a href=\"https://tools.ietf.org/html/rfc3447\" rel=\"nofollow noreferrer\">PKCS#1 is a standard</a> that defines methods of using RSA. It is the first standard of RSA laboratories, started by Rivest, Shamir and Adleman - the RSA in RSA. It defines multiple padding methods including RSAES-PKCS1-v1_5 (for encryption) and RSASSA-PKCS1-v1_5 (for signature schemes with appendix). Now that &quot;appendix&quot; is the message itself, indicating that you require the full message to perform signature verification. Using RSAES-PKCS1-v1_5 padding for signature generation is not a good idea either."}, {"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "reply_to_user": {"reputation": 65, "user_id": 10247375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca0584a0b95d7cb3d870bc3ac07fe115?s=128&d=identicon&r=PG&f=1", "display_name": "JamieCoder", "link": "https://stackoverflow.com/users/10247375/jamiecoder"}, "edited": false, "score": 0, "creation_date": 1534776957, "post_id": 51922844, "comment_id": 90816865, "body": "Actually, PSS and OAEP are also defined in PKCS#1 as you may have seen. If you specify PKCS#1 for encryption then you&#39;d expect RSAES-PKCS1-v1_5 to be used, but some libraries will actually partly use RSASSA-PKCS1-v1_5 to support some weird SSL signature scheme that uses both MD5 and SHA1 concatenated together."}, {"owner": {"reputation": 65, "user_id": 10247375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca0584a0b95d7cb3d870bc3ac07fe115?s=128&d=identicon&r=PG&f=1", "display_name": "JamieCoder", "link": "https://stackoverflow.com/users/10247375/jamiecoder"}, "edited": false, "score": 0, "creation_date": 1534778676, "post_id": 51922844, "comment_id": 90817917, "body": "You&#39;re right, Ruby seems to use <code>RSAES-PKCS1-v1_5</code> for <a href=\"https://www.openssl.org/docs/manmaster/man3/RSA_private_encrypt.html\" rel=\"nofollow noreferrer\">private key encryption</a>, and that&#39;s what I have been (incorrectly) referring to as <code>PKCS1</code>. Thanks for those links and the clarification. Could I ask why private key encryption with <code>RSAES-PKCS1-v1_5</code> padding is insecure? Does it somehow compromise the private key/leak information?"}, {"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "reply_to_user": {"reputation": 65, "user_id": 10247375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca0584a0b95d7cb3d870bc3ac07fe115?s=128&d=identicon&r=PG&f=1", "display_name": "JamieCoder", "link": "https://stackoverflow.com/users/10247375/jamiecoder"}, "edited": false, "score": 0, "creation_date": 1534780252, "post_id": 51922844, "comment_id": 90818794, "body": "I&#39;m not sure. It certainly hasn&#39;t been proven to be secure, and there must be a reason why PSS exists, right? Both actually rely on the same construction called MGF(1). But besides that <i>I would not trust the implementation to be secure</i>, even if it would allow the private key. Note that the public key that is normally used for encryption <i>does not need to be protected against leakage</i>. Besides that, RSA modular exponentiation is often performed using RSA CRT parameters, something not even present in RSA public keys."}], "tags": [], "owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "is_accepted": true, "score": 2, "last_activity_date": 1534781571, "last_edit_date": 1534781571, "creation_date": 1534724697, "answer_id": 51922844, "question_id": 51922290, "link": "https://stackoverflow.com/questions/51922290/why-cant-i-use-rsa-oaep-padding-when-encrypting-with-a-private-key/51922844#51922844", "title": "Why can&#39;t I use RSA OAEP padding when encrypting with a private key?", "body": "<p>Yes, this is a bad thing to do; signature generation is only proven to be secure when using a padding scheme that is targeting signature generation. And actually PKCS#1 v1.5 padding for signature generation and encryption is <em>different</em> even if they are often given the same name.</p>\n\n<p>What you seem to be looking for is a signature scheme with (partial) message recovery. Those aren't used that often anymore. One reason for that is because ECDSA signatures are much smaller than RSA signatures (twice the ECC key size, which would be about 64 bytes for a very secure 256 bit curve).</p>\n\n<hr>\n\n<p>There are a few signature generation methods giving message recovery specified <a href=\"https://crypto.stackexchange.com/a/11748/1172\">here</a> (ISO 9796). Those are a bit old and dangerous, especially if an attacker can somehow influence the input message. Generally they do suffice though. For  a really secure scheme there is [PSS giving message recovery, officially known as EMSR-PSS, specified <a href=\"https://pdfs.semanticscholar.org/b459/5fffe0562776a2830c7b525ba9f641110d7a.pdf\" rel=\"nofollow noreferrer\">in section 1.3 of the paper: PSS: Provably secure encoding method for digital signatures by Bellare and Rogaway</a>.</p>\n\n<p>Unfortunately, those are not directly available to Ruby it seems so you may have to implement or link to the padding schemes. That said, as OAEP is not available either, that's hardly disqualifying them. Generally I'd just opt for ECDSA though and combine the message with the smaller signature format.</p>\n\n<hr>\n\n<p>Note that private key operations are rather different than RSA public key operations. They generally rely on CRT parameters to be present. Furthermore, and probably more importantly, they need to have been designed <em>to protect the private key</em> against attacks such as side channel attacks. Just using a private key instead of a public key is not a good idea.</p>\n\n<p>For a discussion of using OAEP for signature generation see the discussion <a href=\"https://crypto.stackexchange.com/questions/29354/why-not-use-oaep-for-signatures\">here</a>. For info about if RSA encryption with a private key equals signature generation, see my own self-answered Q/A <a href=\"https://crypto.stackexchange.com/q/15997/1172\">here</a>.</p>\n"}], "owner": {"reputation": 65, "user_id": 10247375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca0584a0b95d7cb3d870bc3ac07fe115?s=128&d=identicon&r=PG&f=1", "display_name": "JamieCoder", "link": "https://stackoverflow.com/users/10247375/jamiecoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1458, "favorite_count": 0, "accepted_answer_id": 51922844, "answer_count": 1, "score": 4, "last_activity_date": 1534781571, "creation_date": 1534717317, "question_id": 51922290, "link": "https://stackoverflow.com/questions/51922290/why-cant-i-use-rsa-oaep-padding-when-encrypting-with-a-private-key", "title": "Why can&#39;t I use RSA OAEP padding when encrypting with a private key?", "body": "<p>I'm generating a license key payload that is encrypted with RSA using the private key, which is then decrypted using the public key to utilize the license payload in my user-facing software. I'm encrypting instead of signing so I only need to deliver a single string to my user, rather than delivering a key and a signature.</p>\n\n<p>But I'm having trouble using OAEP padding with private key encryption:</p>\n\n<pre><code>require 'openssl'\n\npadding = OpenSSL::PKey::RSA::PKCS1_OAEP_PADDING\npriv = OpenSSL::PKey::RSA.new 2048\npub = priv.public_key\n\n# FIXME: Why can't I use OAEP padding with private key encryption?\ndata = 'customer:foo@example.com;allowances:25;users:5;locked:true;'\nenc = priv.private_encrypt data, padding\ndec = pub.public_decrypt enc, padding\n\nputs dec == data\n</code></pre>\n\n<p>Repl: <a href=\"https://repl.it/repls/LavishEarnestWifi\" rel=\"nofollow noreferrer\">https://repl.it/repls/LavishEarnestWifi</a>.</p>\n\n<p>Running this throws an error: <code>unknown padding type</code>. Encrypting with the public key allows me to use OAEP, but not the private key. Using PKCS1 padding works, however. I thought using PKCS1 was insecure and OAEP was recommended? I'd like to be able to encrypt the same payload and get different license keys, like I would be able to with OAEP padding.</p>\n\n<p>What am I doing wrong? Is this a bad idea?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "rspec", "mocking"], "answers": [{"tags": [], "owner": {"reputation": 9921, "user_id": 488195, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/aa1e7477ba2f6c0ec47ed521f1cf1676?s=128&d=identicon&r=PG", "display_name": "dgilperez", "link": "https://stackoverflow.com/users/488195/dgilperez"}, "is_accepted": false, "score": 0, "last_activity_date": 1534718529, "creation_date": 1534718529, "answer_id": 51922391, "question_id": 51921964, "link": "https://stackoverflow.com/questions/51921964/how-do-i-expect-a-chain-of-methods-using-rspec-where-the-first-method-takes-a/51922391#51922391", "title": "How do I &#39;expect&#39; a chain of methods using Rspec where the first method takes a parameter?", "body": "<p>I think you need to refactor the chain in two lines like this:</p>\n\n<pre><code>model    = double(\"Contentful::Model\", fields: { promotion_type: \"Promotion 1\" }) \ncampaign = double\n\nallow(Contentful::PartnerCampaign).to receive(:find_by).with(vanityUrl: 'test_promo_path').and_return(campaign)\nallow(campaign).to receive_message_chain(:load, :first).and_return(model)\n</code></pre>\n\n<p>Then you can write your spec that will pass that attribute to <code>find_by</code> and check the chain. </p>\n"}, {"tags": [], "owner": {"reputation": 2301, "user_id": 19317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47035e07012da3162b6e83650ee3abe0?s=128&d=identicon&r=PG", "display_name": "aridlehoover", "link": "https://stackoverflow.com/users/19317/aridlehoover"}, "is_accepted": true, "score": 4, "last_activity_date": 1534739921, "last_edit_date": 1534739921, "creation_date": 1534718554, "answer_id": 51922393, "question_id": 51921964, "link": "https://stackoverflow.com/questions/51921964/how-do-i-expect-a-chain-of-methods-using-rspec-where-the-first-method-takes-a/51922393#51922393", "title": "How do I &#39;expect&#39; a chain of methods using Rspec where the first method takes a parameter?", "body": "<p>Generally speaking, I prefer not to use stub chains, as they are often a sign that you are violating the <a href=\"https://en.wikipedia.org/wiki/Law_of_Demeter\" rel=\"nofollow noreferrer\">Law of Demeter</a>. But, if I had to, this is how I would mock that sequence:</p>\n\n<pre><code>let(:vanity_url) { 'https://vanity.url' }\nlet(:partner_campaigns) { double('partner_campaigns') }\nlet(:loaded_partner_campaigns) { double('loaded_partner_campaigns') }\n\nlet(:partner_campaign) do\n  double(\"Contentful::Model\", fields {:promotion_type =&gt; \"Promotion 1\"}\nend\n\nbefore do\n  allow(Contentful::PartnerCampaign)\n    .to receive(:find_by)\n    .with(vanity_url: vanity_url)\n    .and_return(partner_campaigns)\n\n  allow(partner_campaigns)\n    .to receive(:load)\n    .and_return(loaded_partner_campaigns)\n\n  allow(loaded_partner_campaigns)\n    .to receive(:first)\n    .and_return(partner_campaign)\nend\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6018, "user_id": 3073313, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d9a53be16eb996b521f1637d19005511?s=128&d=identicon&r=PG", "display_name": "Jay-Ar Polidario", "link": "https://stackoverflow.com/users/3073313/jay-ar-polidario"}, "is_accepted": false, "score": 0, "last_activity_date": 1534719811, "last_edit_date": 1534719811, "creation_date": 1534719356, "answer_id": 51922460, "question_id": 51921964, "link": "https://stackoverflow.com/questions/51921964/how-do-i-expect-a-chain-of-methods-using-rspec-where-the-first-method-takes-a/51922460#51922460", "title": "How do I &#39;expect&#39; a chain of methods using Rspec where the first method takes a parameter?", "body": "<p>This is what I would do. Notice that I split the \"mocking\" part and the \"expecting\" part, because usually I'll have some other <code>it</code> examples down below (of which then I'll need those <code>it</code> examples to also have the same \"mocked\" logic), and because I prefer them to have separate concerns: that is anything inside the <code>it</code> example should just normally focus on \"expecting\", and so any mocks or other logic, I normally put them outside the <code>it</code>.</p>\n\n<pre><code>let(:expected_referral_source) { 'test_promo_path' }\nlet(:contentful_model_double) { instance_double(Contentful::Model, promotion_type: 'Promotion 1') }\n\nbefore(:each) do\n  # mock return values chain\n  # note that you are not \"expecting\" anything yet here\n  # you're just basically saying that: if Contentful::PartnerCampaign.find_by(vanityUrl: expected_referral_source).load.first is called, that it should return contentful_model_double\n  allow(Contentful::PartnerCampaign).to receive(:find_by).with(vanityUrl: expected_referral_source) do\n    double.tap do |find_by_returned_object|\n      allow(find_by_returned_object).to receive(:load) do\n        double.tap do |load_returned_object|\n          allow(load_returned_object).to receive(:first).and_return(contentful_model_double)\n        end\n      end\n    end\n  end\nend\n\nit 'calls Contentful::PartnerCampaign.find_by(vanityUrl: referral_source).load.first' do\n  expect(Contentful::PartnerCampaign).to receive(:find_by).once do |argument|\n    expect(argument).to eq({ vanityUrl: expected_referral_source})\n\n    double.tap do |find_by_returned_object|\n      expect(find_by_returned_object).to receive(:load).once do\n        double.tap do |load_returned_object|\n          expect(load_returned_object).to receive(:first).once\n        end\n      end\n    end\n  end\nend\n\nit 'does something...' do\n  # ...\nend\n\nit 'does some other thing...' do\n  # ...\nend\n</code></pre>\n\n<p><em>If you do not know about ruby's <code>tap</code> method, feel free to <a href=\"https://medium.com/aviabird/ruby-tap-that-method-90c8a801fd6a\" rel=\"nofollow noreferrer\">check this out</a></em></p>\n"}], "owner": {"reputation": 373, "user_id": 3995544, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/d35faf71dd9f28f9d98fb18df1b673fa?s=128&d=identicon&r=PG&f=1", "display_name": "wheresmyspaceship", "link": "https://stackoverflow.com/users/3995544/wheresmyspaceship"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2581, "favorite_count": 0, "accepted_answer_id": 51922393, "answer_count": 3, "score": 2, "last_activity_date": 1534739921, "creation_date": 1534713951, "last_edit_date": 1534716756, "question_id": 51921964, "link": "https://stackoverflow.com/questions/51921964/how-do-i-expect-a-chain-of-methods-using-rspec-where-the-first-method-takes-a", "title": "How do I &#39;expect&#39; a chain of methods using Rspec where the first method takes a parameter?", "body": "<p>I have a method call in a ruby model that looks like the following:</p>\n\n<pre><code>Contentful::PartnerCampaign.find_by(vanityUrl: referral_source).load.first\n</code></pre>\n\n<p>Within the models spec.rb file, I'm trying to mock that call and get a value by passing in a param. But I'm having trouble figuring out the correct way of calling it. </p>\n\n<p>At the top of my spec.rb file I have:</p>\n\n<pre><code> let(:first_double) { \n   double(\"Contentful::Model\", fields {:promotion_type =&gt; \"Promotion 1\"}) \n }\n</code></pre>\n\n<p>Within the describe block I've tried the following:  </p>\n\n<pre><code>expect(Contentful::PartnerCampaign).to receive_message_chain(:find_by, :load, :first).\n                                       and_return(first_double)\n\nexpect(Contentful::PartnerCampaign).to receive_message_chain(:find_by, :load, :first).with(vanityUrl: 'test_promo_path').\n                                       and_return(first_double)\n\nexpect(Contentful::PartnerCampaign).to receive_message_chain(:find_by =&gt; vanityUrl: 'test_promo_path', :load, :first).\n                                       and_return(first_double)\n</code></pre>\n\n<p>As you can probably guess, none of these are working. Does anyone know the correct way to do this sort of thing? Is it even possible?</p>\n"}, {"tags": ["ruby"], "answers": [{"comments": [{"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1534738362, "post_id": 51921981, "comment_id": 90797564, "body": "It\u2019s worth it to mention that \u201cit is setting variable as a reference\u201d wording in OP is wrong and confusing."}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "reply_to_user": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 1, "creation_date": 1534741115, "post_id": 51921981, "comment_id": 90798144, "body": "@mudasobwa I saw that as a confusing and &quot;not their best ever&quot; use of English so going down that rabbit hole would be a distraction."}, {"owner": {"reputation": 71, "user_id": 4322140, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-9o8AjQzR8-Q/AAAAAAAAAAI/AAAAAAAAADA/IPvnh3tsZGA/photo.jpg?sz=128", "display_name": "John C.", "link": "https://stackoverflow.com/users/4322140/john-c"}, "edited": false, "score": 0, "creation_date": 1534871276, "post_id": 51921981, "comment_id": 90857553, "body": "You are right about variable as a reference. I got it from here: <a href=\"https://stackoverflow.com/questions/39203911/how-to-pass-by-reference-in-ruby\" title=\"how to pass by reference in ruby\">stackoverflow.com/questions/39203911/&hellip;</a>. It is clear that the example, where I took this from, had nothing to do with pass by reference."}, {"owner": {"reputation": 71, "user_id": 4322140, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-9o8AjQzR8-Q/AAAAAAAAAAI/AAAAAAAAADA/IPvnh3tsZGA/photo.jpg?sz=128", "display_name": "John C.", "link": "https://stackoverflow.com/users/4322140/john-c"}, "edited": false, "score": 1, "creation_date": 1534871375, "post_id": 51921981, "comment_id": 90857608, "body": "I removed the confusing lines at the end. Thanks for the answer!"}], "tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": true, "score": 8, "last_activity_date": 1534731091, "last_edit_date": 1534731091, "creation_date": 1534714103, "answer_id": 51921981, "question_id": 51921909, "link": "https://stackoverflow.com/questions/51921909/what-is-the-colon-operator-doing-in-this-example/51921981#51921981", "title": "What is the colon &#39;operator&#39; doing in this example?", "body": "<p>The colon isn't an operator inside <code>bar</code>, it is simply a <code>Symbol</code> literal that uses string interpolation to build the <code>Symbol</code>. Some <code>Symbol</code>s need to be quoted to avoid syntax issues, for example:</p>\n\n<pre><code>:'a+b'\n</code></pre>\n\n<p>You can also use double quotes with this syntax and those quotes behave just like double quotes for strings so they support string interpolation. So this:</p>\n\n<pre><code>:\"#{b}bar\"\n</code></pre>\n\n<p>is equivalent to:</p>\n\n<pre><code>\"#{b}bar\".to_sym\n</code></pre>\n\n<p>or</p>\n\n<pre><code>(b.to_s + 'bar').to_sym\n</code></pre>\n\n<p>If you <code>#inspect</code> your value you'll get a better idea of what it contains:</p>\n\n<pre><code>puts c.inspect\n# :foobar\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 4322140, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-9o8AjQzR8-Q/AAAAAAAAAAI/AAAAAAAAADA/IPvnh3tsZGA/photo.jpg?sz=128", "display_name": "John C.", "link": "https://stackoverflow.com/users/4322140/john-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 51921981, "answer_count": 1, "score": 0, "last_activity_date": 1534871334, "creation_date": 1534713429, "last_edit_date": 1534871334, "question_id": 51921909, "link": "https://stackoverflow.com/questions/51921909/what-is-the-colon-operator-doing-in-this-example", "title": "What is the colon &#39;operator&#39; doing in this example?", "body": "<p>I saw this example in an answer elsewhere and with the following it outputs <code>foobar</code>: </p>\n\n<pre><code>a = :foo\n\ndef bar(b)\n  :\"#{b}bar\"\nend\n\nc = bar(a)\n\nc       \n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "view"], "comments": [{"owner": {"reputation": 109029, "user_id": 2767755, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/BkC8q.jpg?s=128&g=1", "display_name": "Arup Rakshit", "link": "https://stackoverflow.com/users/2767755/arup-rakshit"}, "edited": false, "score": 0, "creation_date": 1534707489, "post_id": 51921196, "comment_id": 90792113, "body": "What is not working here?"}, {"owner": {"reputation": 167, "user_id": 8822004, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/14817b9fd120e863b345040744dfce5e?s=128&d=identicon&r=PG&f=1", "display_name": "geekydude703", "link": "https://stackoverflow.com/users/8822004/geekydude703"}, "reply_to_user": {"reputation": 109029, "user_id": 2767755, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/BkC8q.jpg?s=128&g=1", "display_name": "Arup Rakshit", "link": "https://stackoverflow.com/users/2767755/arup-rakshit"}, "edited": false, "score": 0, "creation_date": 1534707686, "post_id": 51921196, "comment_id": 90792158, "body": "@ArupRakshit - I updated the description to include the error above. Thanks!"}, {"owner": {"reputation": 109029, "user_id": 2767755, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/BkC8q.jpg?s=128&g=1", "display_name": "Arup Rakshit", "link": "https://stackoverflow.com/users/2767755/arup-rakshit"}, "edited": false, "score": 0, "creation_date": 1534707713, "post_id": 51921196, "comment_id": 90792164, "body": "You are using Rails?"}, {"owner": {"reputation": 167, "user_id": 8822004, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/14817b9fd120e863b345040744dfce5e?s=128&d=identicon&r=PG&f=1", "display_name": "geekydude703", "link": "https://stackoverflow.com/users/8822004/geekydude703"}, "reply_to_user": {"reputation": 109029, "user_id": 2767755, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/BkC8q.jpg?s=128&g=1", "display_name": "Arup Rakshit", "link": "https://stackoverflow.com/users/2767755/arup-rakshit"}, "edited": false, "score": 0, "creation_date": 1534707740, "post_id": 51921196, "comment_id": 90792175, "body": "Yes I think so."}, {"owner": {"reputation": 109029, "user_id": 2767755, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/BkC8q.jpg?s=128&g=1", "display_name": "Arup Rakshit", "link": "https://stackoverflow.com/users/2767755/arup-rakshit"}, "edited": false, "score": 0, "creation_date": 1534707836, "post_id": 51921196, "comment_id": 90792193, "body": "can you add the full error stack from log? I don&#39;t see any wrong code."}, {"owner": {"reputation": 167, "user_id": 8822004, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/14817b9fd120e863b345040744dfce5e?s=128&d=identicon&r=PG&f=1", "display_name": "geekydude703", "link": "https://stackoverflow.com/users/8822004/geekydude703"}, "reply_to_user": {"reputation": 109029, "user_id": 2767755, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/BkC8q.jpg?s=128&g=1", "display_name": "Arup Rakshit", "link": "https://stackoverflow.com/users/2767755/arup-rakshit"}, "edited": false, "score": 0, "creation_date": 1534708067, "post_id": 51921196, "comment_id": 90792256, "body": "@ArupRakshit - above is the whole log showing in the browser"}, {"owner": {"reputation": 109029, "user_id": 2767755, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/BkC8q.jpg?s=128&g=1", "display_name": "Arup Rakshit", "link": "https://stackoverflow.com/users/2767755/arup-rakshit"}, "edited": false, "score": 0, "creation_date": 1534709074, "post_id": 51921196, "comment_id": 90792475, "body": "The view should have the <code>request</code> object access."}, {"owner": {"reputation": 316, "user_id": 7495784, "user_type": "registered", "profile_image": "https://graph.facebook.com/10211983730091551/picture?type=large", "display_name": "Diego Patricio Aguilef S&#225;nchez", "link": "https://stackoverflow.com/users/7495784/diego-patricio-aguilef-s%c3%a1nchez"}, "edited": false, "score": 0, "creation_date": 1534817223, "post_id": 51921196, "comment_id": 90831078, "body": "Why do not you better use controller_name or action_name instead of path_info? These variables return the name of the controller and action respectively, which could be used for what you want"}], "answers": [{"tags": [], "owner": {"reputation": 3119, "user_id": 4842949, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0agpj31wtZ8/AAAAAAAAAAI/AAAAAAAAAAA/mSolbNN-zIY/photo.jpg?sz=128", "display_name": "Joseph Cho", "link": "https://stackoverflow.com/users/4842949/joseph-cho"}, "is_accepted": false, "score": 0, "last_activity_date": 1534780672, "last_edit_date": 1534780672, "creation_date": 1534773294, "answer_id": 51932309, "question_id": 51921196, "link": "https://stackoverflow.com/questions/51921196/how-to-render-different-divs-using-conditional-in-a-html-erb-file/51932309#51932309", "title": "How to render different divs using conditional in a html.erb file", "body": "<p>In your controller method that calls <code>something.html.erb</code> you need to make <code>request</code> an object. We'll need to see your controller code, but try something like below:</p>\n\n<pre><code>def something\n  @request = request\nend\n</code></pre>\n\n<p>From there you can access it in your erb like:</p>\n\n<pre><code>&lt;% if @request.path_info.include?('abc') %&gt;\n</code></pre>\n"}], "owner": {"reputation": 167, "user_id": 8822004, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/14817b9fd120e863b345040744dfce5e?s=128&d=identicon&r=PG&f=1", "display_name": "geekydude703", "link": "https://stackoverflow.com/users/8822004/geekydude703"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 234, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1534780672, "creation_date": 1534707371, "last_edit_date": 1534737522, "question_id": 51921196, "link": "https://stackoverflow.com/questions/51921196/how-to-render-different-divs-using-conditional-in-a-html-erb-file", "title": "How to render different divs using conditional in a html.erb file", "body": "<p>I am trying to render different divs in a <code>.html.erb</code> file if the url contains certain strings:</p>\n\n<pre><code>&lt;% if request.path_info.include?('abc') %&gt;\n  &lt;div&gt;ABC&lt;/div&gt;\n&lt;% elsif request.path_info.include?('xyz')  %&gt;\n  &lt;div&gt;XYZ&lt;/div&gt;\n&lt;% end %&gt;\n</code></pre>\n\n<p>I found the following code. I tried that solution but it still doesn't work. Any help would be greatly appreciated! </p>\n\n<p><a href=\"https://stackoverflow.com/questions/40480223/if-url-contains-string?noredirect=1&amp;lq=1\">If URL contains string?</a></p>\n\n<pre><code>The error that is giving me as is follows:\n\nShowing /Users/etc/...../something.html.erb where line #28 raised:\n\nundefined local variable or method `request' for #&lt;#\n&lt;Class:&gt;:&gt;\nDid you mean?  require\nExtracted source (around line #14):\n12\n13\n14\n15\n16\n17\n\n      &lt;/div&gt;\n\n      &lt;% if request.path_info.include?('abc') %&gt;\n        &lt;div&gt;ABC&lt;/div&gt;\n      &lt;% elsif request.path_info.include?('xyz')  %&gt;\n        &lt;div&gt;XYZ&lt;/div&gt;\n\nRails.root: /Users/etc/....something\n</code></pre>\n"}, {"tags": ["html", "ruby-on-rails", "ruby", "input", "strong-parameters"], "comments": [{"owner": {"reputation": 5292, "user_id": 2727267, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0e7c773908a4f6095f63cb9553bbc7af?s=128&d=identicon&r=PG", "display_name": "Beartech", "link": "https://stackoverflow.com/users/2727267/beartech"}, "edited": false, "score": 1, "creation_date": 1534701577, "post_id": 51920361, "comment_id": 90790581, "body": "If you use the <code>erb</code> version, then in the browser right-click -&gt; inspect element. You should see what name it is generating. You can then use that manually."}], "answers": [{"comments": [{"owner": {"reputation": 5292, "user_id": 2727267, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0e7c773908a4f6095f63cb9553bbc7af?s=128&d=identicon&r=PG", "display_name": "Beartech", "link": "https://stackoverflow.com/users/2727267/beartech"}, "edited": false, "score": 0, "creation_date": 1534702817, "post_id": 51920490, "comment_id": 90790906, "body": "Also if you want to show the custom styling you are looking for, I might be able to show you how you can make that happen using the <code>file_field</code> method."}], "tags": [], "owner": {"reputation": 5292, "user_id": 2727267, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0e7c773908a4f6095f63cb9553bbc7af?s=128&d=identicon&r=PG", "display_name": "Beartech", "link": "https://stackoverflow.com/users/2727267/beartech"}, "is_accepted": true, "score": 1, "last_activity_date": 1534703201, "last_edit_date": 1534703201, "creation_date": 1534702173, "answer_id": 51920490, "question_id": 51920361, "link": "https://stackoverflow.com/questions/51920361/how-can-i-include-an-html-input-in-rails-strong-params/51920490#51920490", "title": "How can I include an HTML input in rails strong params?", "body": "<p>Something like this:</p>\n\n<pre><code>&lt;input multiple=\"multiple\" name=\"post[images][]\" id=\"posts_images\" type=\"file\"&gt;\n</code></pre>\n\n<p>This should generate the correct JSON params that your controller is expecting. It can get confusing with the multiple levels of hash/array. That's why I use the <code>inspect element</code> in the browser as mentioned in my comment above to see what Rails is generating, then I can build custom styled elements to suit my needs.</p>\n\n<p>One way to remember it is: You are <code>require</code>-ing <code>post</code>, and then looking for a hash with a key of <code>images</code> and a value of type <code>array</code>. That way it's easier to know where to use singular vs plural, what is the key, etc. So mapping it out syntactically would be:</p>\n\n<pre><code>&lt;model name&gt;[&lt;key defined in strong params&gt;][]\n</code></pre>\n\n<p>in the <code>.erb</code> version if you look at the top of your form, think about what the value of <code>f</code> is in the <code>... do |f|</code>. That's where it gets the controller name of <code>post</code> (singular) and then you are giving it the method name <code>:images</code> (plural) in the <code>file_field</code>. According to the Rails Docs you could use the singular <code>:image</code> but the plural seems more correct to me.</p>\n"}], "owner": {"reputation": 955, "user_id": 3739453, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ad500b31d2ce042c4f2c5b6e361a129b?s=128&d=identicon&r=PG&f=1", "display_name": "Joe Morano", "link": "https://stackoverflow.com/users/3739453/joe-morano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 224, "favorite_count": 0, "accepted_answer_id": 51920490, "answer_count": 1, "score": 0, "last_activity_date": 1534703201, "creation_date": 1534701232, "question_id": 51920361, "link": "https://stackoverflow.com/questions/51920361/how-can-i-include-an-html-input-in-rails-strong-params", "title": "How can I include an HTML input in rails strong params?", "body": "<p>I'm trying to create instances of a model \"Post\" with strong params that look like this:</p>\n\n<pre><code>  private\n\n    def post_params\n      params.require(:post).permit(:name, {images: []})\n    end\n</code></pre>\n\n<p>In my form, this is how I upload files to <code>post_params[\"images\"]</code>, and therefore to <code>post.images</code>:</p>\n\n<pre><code>&lt;%= f.file_field :images, multiple: true %&gt;\n</code></pre>\n\n<p>But I want to apply custom styling to the upload button, so I build one using HTML. But I can't figure out what <code>name</code> attribute to give the input so that it's included in <code>post_params</code>. Here's what I've tried:</p>\n\n<pre><code>&lt;input name=\"images\" type=\"file\" multiple=\"true\"/&gt;\n&lt;input name=\"post[images]\" type=\"file\" multiple=\"true\"/&gt;\n&lt;input name=\"post['images']\" type=\"file\" multiple=\"true\"/&gt;\n&lt;input name=\":images\" type=\"file\" multiple=\"true\"/&gt;\n</code></pre>\n\n<p>But they all just go to <code>params[\"post\"][\"images\"]</code>, not <code>strong_params</code>.</p>\n\n<p><strong>What name can I give an HTML input so it's included in strong params?</strong></p>\n"}]