[{"tags": ["ruby"], "comments": [{"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1567054506, "post_id": 57700992, "comment_id": 101849564, "body": "&quot;Please help!&quot; is not a precise enough error description for us to help you. <i>What</i> doesn&#39;t work? <i>How</i> doesn&#39;t it work? What trouble do you have with your code? Do you get an error message? What is the error message? Is the result you are getting not the result you are expecting? What result do you expect and why, what is the result you are getting and how do the two differ? Is the behavior you are observing not the desired behavior? What is the desired behavior and why, what is the observed behavior, and in what way do they differ?"}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1567054584, "post_id": 57700992, "comment_id": 101849585, "body": "Also, please make sure that you post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. Does it really require over 50 lines to create a <i>minimal</i> code example that accurately reproduces your problem? Unfortunately, you didn&#39;t actually state what your problem is, but I would guess that it does not require more than three lines to reproduce."}], "owner": {"reputation": 53, "user_id": 11919877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af8a23b540e00ccda6f53f7e941a357f?s=128&d=identicon&r=PG&f=1", "display_name": "M_com", "link": "https://stackoverflow.com/users/11919877/m-com"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1567061571, "creation_date": 1567033225, "last_edit_date": 1567061571, "question_id": 57700992, "link": "https://stackoverflow.com/questions/57700992/find-all-to-find-if-the-user-input-matches-any-of-the-values-written-in-an-arr", "title": ".find_all to find if the user input matches any of the values (written in an array)", "body": "<p>So the question is asking me to write a code that will search the hash key for any values that matches a number (the number is input by the user). </p>\n\n<p>The first hash is made up of two key while the value is an array. And the second hash is made up of 5 keys while the value is an array. </p>\n\n<p>My question is mainly regarding <code>.find_all</code>. \nI am basically asked to search the hash to see if the number the user wants to investigate is in the hash. \nPlease help!</p>\n\n<pre><code>puts \"give me a number you want information about:\"\nnumber_info= gets.chomp \nputs \"Using only the first hash:\"\nif first_hash[random_numbers].find_all { |e| e== number_info }\nputs \"the number #{number_info} shows up #{random_numbers.count(e)} \ntime(s) in the randomly generated numbers\"\nelsif first_hash[user_input].find_all { |e| e==number_info }\nputs \"the number #{number_info} was provided #{user_input.count(e)} \ntime(s)by the user\"\nelsif first_hash[random_numbers].find_all { |e| e!= number_info }\nputs \"the number #{number_info} does not show up in the randomly \ngenerated numbers\"\nelsif first_hash [user_input].find_all { |e| e!=number_info }\nputs \"the number #{number_info} was not provided by the user \nearlier\"\nend \n</code></pre>\n\n<p>these are the hashes in case you get confused...</p>\n\n<pre><code>rand_1= rand(12..21)\nrand_2= rand(12..21)\nrand_3= rand(12..21)\nrand_4= rand(12..21)\nrand_5= rand(12..21)\n\n\nputs \"Please provide five integer values between 12 and 21, both \ninclusive:\nwhat's number 1?\" \nnumber_1 =gets.chomp\n\nputs \"What's number 2?\"\nnumber_2 =gets.chomp\n\nputs \"What's number 3?\"\nnumber_3 =gets.chomp\n\nputs \"what's number 4?\"\nnumber_4 =gets.chomp\n\nputs \"What's number 5?\"\nnumber_5 =gets.chomp\n</code></pre>\n\n<p><strong>first hash</strong></p>\n\n<pre><code>first_hash={\n  random_numbers: [rand_1, rand_2, rand_3, rand_4, rand_5],\n  user_input: [number_1, number_2, number_3, number_4, number_5]\n\n}\n\nuser_input= [number_1, number_2, number_3, number_4, number_5]\nrandom_numbers= [rand_1, rand_2, rand_3, rand_4, rand_5]\n</code></pre>\n\n<p><strong>second hash</strong> </p>\n\n<pre><code>second_hash= {\n  number_1: [user_input.count(number_1), \n    random_numbers.count(number_1)], \n\n  number_2: \n[user_input.count(number_2),random_numbers.count(number_2)],\n\n  number_3: [user_input.count(number_3), \n  random_numbers.count(number_3)],\n\n  number_4: \n[user_input.count(number_4),random_numbers.count(number_4)],\n\n  number_5: [user_input.count(number_5), \nrandom_numbers.count(number_5)]\n}\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "rspec", "request", "httparty"], "comments": [{"owner": {"reputation": 160, "user_id": 7485031, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uxqNL.jpg?s=128&g=1", "display_name": "Ali Ilman", "link": "https://stackoverflow.com/users/7485031/ali-ilman"}, "edited": false, "score": 1, "creation_date": 1567039439, "post_id": 57700877, "comment_id": 101846865, "body": "Are you trying to use development (<a href=\"http://localhost:3100\" rel=\"nofollow noreferrer\">localhost:3100</a>) and production(<a href=\"https://example.com\" rel=\"nofollow noreferrer\">example.com</a>) as a base URL for the spec or for the code in the controller? You can use <code>request.base_url</code> for the latter. For the former, perhaps this may help you? \ud83d\ude04<a href=\"https://stackoverflow.com/a/29037481/7485031\">stackoverflow.com/a/29037481/7485031</a>"}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 10131105, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155784755496947/picture?type=large", "display_name": "Juliette Chevalier", "link": "https://stackoverflow.com/users/10131105/juliette-chevalier"}, "edited": false, "score": 1, "creation_date": 1567112327, "post_id": 57701971, "comment_id": 101877032, "body": "I had to pass in <code>Rails.env.test</code> rather than <code>Rails.env.development</code> since I was using the links for testing. It should have worked except for other configuration I had.. Great idea, though. Thanks for the help!"}, {"owner": {"reputation": 79, "user_id": 10205816, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-svvoh8gZUAg/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pNpm_q05CLjKxkTdXEkQf6KGSXHw/mo/photo.jpg?sz=128", "display_name": "Gotenks-J", "link": "https://stackoverflow.com/users/10205816/gotenks-j"}, "reply_to_user": {"reputation": 43, "user_id": 10131105, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155784755496947/picture?type=large", "display_name": "Juliette Chevalier", "link": "https://stackoverflow.com/users/10131105/juliette-chevalier"}, "edited": false, "score": 0, "creation_date": 1573606683, "post_id": 57701971, "comment_id": 103933824, "body": "Would you mind accepting this answer if it was helpful and got you to your end goal? Thanks!"}], "tags": [], "owner": {"reputation": 79, "user_id": 10205816, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-svvoh8gZUAg/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pNpm_q05CLjKxkTdXEkQf6KGSXHw/mo/photo.jpg?sz=128", "display_name": "Gotenks-J", "link": "https://stackoverflow.com/users/10205816/gotenks-j"}, "is_accepted": false, "score": 2, "last_activity_date": 1567043481, "creation_date": 1567043481, "answer_id": 57701971, "question_id": 57700877, "link": "https://stackoverflow.com/questions/57700877/how-to-retreive-host-url-in-development-and-production-in-rails-rspec/57701971#57701971", "title": "How to retreive host url in development and production in Rails/Rspec?", "body": "<p>Try this, nice and simple:</p>\n\n<pre><code>url = Rails.env.development? ? \"localhost:3100/senders\" : \"example.com/senders\"\n\nHTTParty.post(url, query: {email: user.email})\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 43, "user_id": 10131105, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155784755496947/picture?type=large", "display_name": "Juliette Chevalier", "link": "https://stackoverflow.com/users/10131105/juliette-chevalier"}, "edited": false, "score": 0, "creation_date": 1567112244, "post_id": 57702309, "comment_id": 101877000, "body": "This was exactly what I needed! Thank you, worked like a charm \ud83d\udca5"}], "tags": [], "owner": {"reputation": 794, "user_id": 1741393, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5qZCT.jpg?s=128&g=1", "display_name": "Joe Edgar", "link": "https://stackoverflow.com/users/1741393/joe-edgar"}, "is_accepted": true, "score": 2, "last_activity_date": 1567046735, "creation_date": 1567046735, "answer_id": 57702309, "question_id": 57700877, "link": "https://stackoverflow.com/questions/57700877/how-to-retreive-host-url-in-development-and-production-in-rails-rspec/57702309#57702309", "title": "How to retreive host url in development and production in Rails/Rspec?", "body": "<p>An option that I have used in the past is to use the <a href=\"https://github.com/railsconfig/config\" rel=\"nofollow noreferrer\">config</a> gem.</p>\n\n<p>You can create variables for different environments and then just call that variable.</p>\n\n<p>For example, you can have a <code>config/settings/development.yml</code> that defines the url one way:</p>\n\n<p><code>base_url: \"http://localhost:3100/senders\"</code></p>\n\n<p>And a <code>config/settings/production.yml</code> file that defines it another:</p>\n\n<p><code>base_url: \"https://example.com/senders\"</code></p>\n\n<p>Then call it with <code>Settings.base_url</code></p>\n\n<p>It automatically resolves the environment and populates the correct settings for that environment.</p>\n"}], "owner": {"reputation": 43, "user_id": 10131105, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155784755496947/picture?type=large", "display_name": "Juliette Chevalier", "link": "https://stackoverflow.com/users/10131105/juliette-chevalier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 976, "favorite_count": 0, "accepted_answer_id": 57702309, "answer_count": 2, "score": 1, "last_activity_date": 1567046735, "creation_date": 1567032135, "question_id": 57700877, "link": "https://stackoverflow.com/questions/57700877/how-to-retreive-host-url-in-development-and-production-in-rails-rspec", "title": "How to retreive host url in development and production in Rails/Rspec?", "body": "<p>I'm creating tests for my <code>senders_controller</code> and am trying to retrieve my base url to be able to call an HTTParty request. I basically need the same method to be able to retrieve me one of these two links depending on the environment:</p>\n\n<ul>\n<li>in development: <code>http://localhost:3100/senders</code></li>\n<li>in production: <code>https://example.com/senders</code></li>\n</ul>\n\n<p>My tests work in my <code>spec/senders_controller.rb</code> like this:</p>\n\n<pre><code>HTTParty.post(\"http://localhost:3100/senders\", query: {email: user.email})\n</code></pre>\n\n<p>But I want that link to also work in production, which is why I'm looking for a dynamic way to get the base url in both development and production.</p>\n\n<p>Any ideas? </p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 2, "creation_date": 1567029745, "post_id": 57700136, "comment_id": 101845071, "body": "Ruby 1.8.7 is super old and really obsolete, so if you have any way of upgrading that would help a lot as a ton of new things have happened to Ruby since then, including, most critically, proper UTF-8 support."}, {"owner": {"reputation": 112, "user_id": 8960404, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e860c98445150d786e5d506e27e2672a?s=128&d=identicon&r=PG&f=1", "display_name": "jayreed1", "link": "https://stackoverflow.com/users/8960404/jayreed1"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1567031616, "post_id": 57700136, "comment_id": 101845457, "body": "Unfotunately, I&#39;m stuck on 1.8.7 for this particular project. Worse still, I can&#39;t use gems. : /"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1567032269, "post_id": 57700136, "comment_id": 101845593, "body": "That sounds like the opposite of fun. Hope you survive this!"}], "answers": [{"comments": [{"owner": {"reputation": 112, "user_id": 8960404, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e860c98445150d786e5d506e27e2672a?s=128&d=identicon&r=PG&f=1", "display_name": "jayreed1", "link": "https://stackoverflow.com/users/8960404/jayreed1"}, "edited": false, "score": 2, "creation_date": 1567031749, "post_id": 57700549, "comment_id": 101845479, "body": "This is fantastic! It works in 1.8.7 even. Thank you! I&#39;m using this to add a log line instead of typing the class and method manually."}, {"owner": {"reputation": 112, "user_id": 8960404, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e860c98445150d786e5d506e27e2672a?s=128&d=identicon&r=PG&f=1", "display_name": "jayreed1", "link": "https://stackoverflow.com/users/8960404/jayreed1"}, "edited": false, "score": 0, "creation_date": 1567033570, "post_id": 57700549, "comment_id": 101845853, "body": "I&#39;ve upvoted your answer. I can&#39;t find where to mark it as accepted. Maybe that&#39;s because of my fairly minuscule reputation?"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 1, "creation_date": 1567033752, "post_id": 57700549, "comment_id": 101845877, "body": "Why <code>UnboundMethod#owner</code> rather than <a href=\"https://ruby-doc.org/core-2.6.3/Method.html#method-i-owner\" rel=\"nofollow noreferrer\">Method#owner</a>, considering that <code>test_func</code> is bound to <code>Child.new</code>? jayreed1, do you need the class where it was defined programmatically or just to see it, for debugging, say. If the latter, look at the return value for <code>...method(:some_method)</code> and you will see that it is there--you don&#39;t have to tack on <code>.owner</code>."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1567035104, "post_id": 57700549, "comment_id": 101846133, "body": "...For example, <code>22.method(:zero?) #=&gt; #&lt;Method: Integer(Numeric)#zero?&gt;</code>, showing that <code>Integer#zero?</code>is defined in <code>Numeric</code>, whereas <code>22.method(:+) #=&gt; #&lt;Method: Integer#+&gt;</code> tells us that <code>Integer#+</code> is defined in <code>Integer</code> (as <code>#&lt;Method: Integer#+&gt;</code> is interpreted as <code>#&lt;Method: Integer(Integer)#+&gt;)</code>."}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 1, "creation_date": 1567065491, "post_id": 57700549, "comment_id": 101853696, "body": "Or <code>Child.instance_method(:test_func).owner</code>, so you don&#39;t have to create an instance."}], "tags": [], "owner": {"reputation": 3902, "user_id": 10608621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d59df09a85d05117c63706f66811b70c?s=128&d=identicon&r=PG", "display_name": "mechnicov", "link": "https://stackoverflow.com/users/10608621/mechnicov"}, "is_accepted": true, "score": 6, "last_activity_date": 1567034551, "last_edit_date": 1567034551, "creation_date": 1567029587, "answer_id": 57700549, "question_id": 57700136, "link": "https://stackoverflow.com/questions/57700136/ruby-get-defining-class-name/57700549#57700549", "title": "Ruby -- Get defining class name", "body": "<p>You asked <code>self.class</code> of <code>Child</code> object and you got it.</p>\n\n<p>You need use <a href=\"https://ruby-doc.org/core/Method.html#method-i-owner\" rel=\"nofollow noreferrer\"><code>Method#owner</code></a> to return the class or module that defines the method.</p>\n\n<pre><code>class Super\n  def test_func\n    puts \"#{method(__method__).owner}, #{ __method__}\"\n  end\nend\n\nclass Child &lt; Super\n  def test_func2\n     self.test_func\n  end\nend\n\nChild.new.test_func\n# will print: Super, test_func\n</code></pre>\n\n<p>or just</p>\n\n<pre><code>Child.new.method(:test_func).owner\n#=&gt; Super\n</code></pre>\n"}], "owner": {"reputation": 112, "user_id": 8960404, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e860c98445150d786e5d506e27e2672a?s=128&d=identicon&r=PG&f=1", "display_name": "jayreed1", "link": "https://stackoverflow.com/users/8960404/jayreed1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 57700549, "answer_count": 1, "score": 1, "last_activity_date": 1567034551, "creation_date": 1567026979, "last_edit_date": 1592644375, "question_id": 57700136, "link": "https://stackoverflow.com/questions/57700136/ruby-get-defining-class-name", "title": "Ruby -- Get defining class name", "body": "<p>How can one get the class a method was defined in?</p>\n<p>I've found how to look up descendents and ansestors: <a href=\"https://stackoverflow.com/questions/2393697/look-up-all-descendants-of-a-class-in-ruby\">Look up all descendants of a class in Ruby</a></p>\n<p>But that doesn't necessarily get me <em>the defining class</em> (last defining class really).</p>\n<p>I've found how to get the calling class:\n<a href=\"https://stackoverflow.com/questions/21126628/ruby-inheritance-get-caller-class-name\">Ruby Inheritance Get Caller Class Name</a></p>\n<p>But I want the opposite. I would like how to get the defining class.</p>\n<p>I've also tried <code>Module.nesting</code>. That gets me what I want in this case, but I worry it will be inconsistent and not acceptable in a larger codebase of which I don't have ultimate control.</p>\n<pre><code>puts RUBY_VERSION\n\n\n# Test class vs super.\nclass Super\n    def test_func\n      puts &quot;#{self.class}, #{ __method__}&quot;\n    end\nend\n\nclass Child &lt; Super\n  def test_func2\n     self.test_func\n  end\nend\n\nChild.new.test_func\n</code></pre>\n<p>I had hoped for:</p>\n<blockquote>\n<p>1.8.7</p>\n<p>Super, test_func</p>\n</blockquote>\n<p>But got:</p>\n<blockquote>\n<p>1.8.7</p>\n<p>Child, test_func</p>\n</blockquote>\n"}, {"tags": ["ruby-on-rails", "ruby"], "answers": [{"tags": [], "owner": {"reputation": 380, "user_id": 223467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/359b7a7fc263382baee62d91c1e4c25e?s=128&d=identicon&r=PG", "display_name": "mekdigital", "link": "https://stackoverflow.com/users/223467/mekdigital"}, "is_accepted": false, "score": 3, "last_activity_date": 1567029804, "creation_date": 1567029804, "answer_id": 57700576, "question_id": 57700117, "link": "https://stackoverflow.com/questions/57700117/what-are-some-ways-i-can-reduce-the-bulk-of-a-new-ruby-on-rails-autogenerated-ap/57700576#57700576", "title": "What are some ways I can reduce the bulk of a new ruby on rails autogenerated application?", "body": "<p>I don't think you should be concerned about too many files in your first push to GitHub, as anyone using rails would know exactly what the massive framework looks like.</p>\n\n<ol>\n<li>you could do the first push and commit with only the auto-generated code, so all the following commits will be solely about your code;</li>\n<li>you could delete javascript files, helpers, tests (!) that might be automatically scaffolded if you are planning to leave them empty;</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "is_accepted": true, "score": 2, "last_activity_date": 1567058142, "creation_date": 1567058142, "answer_id": 57703795, "question_id": 57700117, "link": "https://stackoverflow.com/questions/57700117/what-are-some-ways-i-can-reduce-the-bulk-of-a-new-ruby-on-rails-autogenerated-ap/57703795#57703795", "title": "What are some ways I can reduce the bulk of a new ruby on rails autogenerated application?", "body": "<p>I believe your concerns are not so much about the bulk of the code but the bulk of the <em>review</em>. But, there is no need to review that code, unless the reviewer does not trust Rails, in which case, he has a <a href=\"https://github.com/rails/rails\" rel=\"nofollow noreferrer\">metric sh*t-ton more code</a> to review anyway.</p>\n\n<p>What you <em>should</em> do is:</p>\n\n<ul>\n<li><em>Do not</em> change any of the auto-generated files. Just run the generator and directly commit.</li>\n<li><em>Clearly document</em> the exact version and command line arguments of the generator in your commit message.</li>\n</ul>\n\n<p>That way, instead of reviewing all the code you committed, the reviewer can instead <em>run the generator himself</em> on his local machine and <em>compare the output to your commit</em>. Now, the task has become much simpler, because the reviewer only needs to review</p>\n\n<ul>\n<li>the <em>difference</em> between the two (which should be zero) and</li>\n<li>the <em>command line arguments</em> to the generator (which is just a couple of characters).</li>\n</ul>\n\n<p>In other words, this shifts the burden of trust from yourself to the Rails maintainers, and hopefully, the reviewer trusts them.</p>\n\n<p>Note: this is the same procedure you would follow when you do a mass reformatting of the entire codebase, or when you perform complex refactorings with the help of automated tools. You document the <em>tool</em> and then the reviewer can review <em>how you invoke the tool</em> instead of reviewing the commit.</p>\n"}], "owner": {"reputation": 405, "user_id": 5356423, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WIfv6.jpg?s=128&g=1", "display_name": "airvine", "link": "https://stackoverflow.com/users/5356423/airvine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 57703795, "answer_count": 2, "score": 1, "last_activity_date": 1567092775, "creation_date": 1567026860, "last_edit_date": 1567092775, "question_id": 57700117, "link": "https://stackoverflow.com/questions/57700117/what-are-some-ways-i-can-reduce-the-bulk-of-a-new-ruby-on-rails-autogenerated-ap", "title": "What are some ways I can reduce the bulk of a new ruby on rails autogenerated application?", "body": "<p>I am new to using ruby on rails and I am starting with the default auto-generated ruby on rails application. I am afraid to enter my first code review with too many files being pushed to github. Are there any best practices for reducing the bulk, size, or amount of files in a default ruby on rails project without losing functionality? Does it heavily depend on the application?</p>\n"}, {"tags": ["ruby", "ip-address"], "owner": {"reputation": 51, "user_id": 10240644, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b391a1c425655faa66aab948dc0d7fdd?s=128&d=identicon&r=PG&f=1", "display_name": "James Kelly", "link": "https://stackoverflow.com/users/10240644/james-kelly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 116, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1567030103, "creation_date": 1567025637, "question_id": 57699919, "link": "https://stackoverflow.com/questions/57699919/given-a-list-of-cidr-blocks-how-to-efficiently-find-which-block-an-ip-address-b", "title": "Given a list of CIDR blocks, how to efficiently find which block an IP address belongs to in Ruby?", "body": "<p>I have a list of 200k+ IP addresses (e.g. 198.161.1.1), and another list of 4k+ CIDR blocks (e.g. 198.161.0.0/16).</p>\n\n<p>I need to try to match each IP in the input list to its associated CIDR block, if it exists.</p>\n\n<p>I'm aware Ruby's <code>IPAddr</code> class can easily determine if a given IP is in a block like so:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>require 'ipaddr'\n\nip = IPAddr.new('198.161.1.1')\nblock = IPAddr.new('198.161.0.0/16')\nblock.include?(ip)\n</code></pre>\n\n<p>However, doing a linear search of the list of CIDR blocks for 200k+ IP's takes a long time. </p>\n\n<p>My first thought was to sort the data and attempt to do a binary search on the CIDR block list. However, I can't seem to find a way to get this to work with any standard libraries in Ruby. I found a gem called <a href=\"https://github.com/take-five/segment_tree\" rel=\"nofollow noreferrer\">Segment Tree</a> which at first seemed like a perfect fit for this task, but I found that it returned inaccurate results (would return <code>nil</code> for IP's which I know for a fact have a matching CIDR block).</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "devise"], "answers": [{"tags": [], "owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "is_accepted": false, "score": 1, "last_activity_date": 1567026635, "creation_date": 1567026635, "answer_id": 57700075, "question_id": 57699401, "link": "https://stackoverflow.com/questions/57699401/problem-with-logging-out-of-the-application/57700075#57700075", "title": "Problem with logging out of the application", "body": "<p>You use <code>current_user.id</code> in the query. Once you logout <code>current_user</code> is nil, so you can't call <code>id</code> on it.</p>\n\n<p>You have several options:</p>\n\n<ul>\n<li>restrict access to expenses for only logged in users</li>\n<li>call current user conditionally: <code>user_id = current_user&amp;.id</code></li>\n<li>provide a default guest user:</li>\n</ul>\n\n<pre><code>def current_user_with_default\n  current_user || GuestUser.new\nend\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 11894529, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60ca75247fa48fd4cf47cbfdedb71ab4?s=128&d=identicon&r=PG&f=1", "display_name": "green", "link": "https://stackoverflow.com/users/11894529/green"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1567026702, "creation_date": 1567022818, "last_edit_date": 1567026702, "question_id": 57699401, "link": "https://stackoverflow.com/questions/57699401/problem-with-logging-out-of-the-application", "title": "Problem with logging out of the application", "body": "<p>I'm having problems with logging out of the application. When I click \"Logout\" I get the error \"undefined method` id 'for nil: NilClass. \" When logging in everything works. The error is displayed on line 9.</p>\n\n<pre><code> @search = Expense.where(:user_id =&gt; current_user.id).search(params[ :q ])\n</code></pre>\n\n<p>Please help.</p>\n\n<p>expenses_controller.rb</p>\n\n<pre><code>\nclass ExpensesController &lt; ApplicationController\n    before_action :user_id, only: [:show, :edit, :update, :destroy]\n\n    # GET /expense  expense\n    # GET /expense.json\n\n\n    def index\n      @search = Expense.where(:user_id =&gt; current_user.id).search(params[ :q ])\n      @expense = @search .result \n      @search.build_condition\n    end\n\n    # GET /expense/1\n    # GET /expense/1.json\n    def show\n\n    end\n\n    # GET /expense/new\n    def new\n      @expense = Expense.new\n    end\n\n    # GET /expense/1/edit\n    def edit\n    end\n\n    # POST /expense\n    # POST /expense.json\n    def create\n      @expense = Expense.new(expense_params)\n      @expense.user_id = current_user.id if current_user\n      respond_to do |format|\n        if @expense.save\n          format.html { redirect_to @expense, notice: 'zosta\u0142y zapisane.' }\n          format.json { render :show, status: :created, location: @expense }\n        else\n          format.html { render :new }\n          format.json { render json: @expense.errors, status: :unprocessable_entity }\n        end\n      end\n    end\n\n    # PATCH/PUT /expense/1\n    # PATCH/PUT /expense/1.json\n    def update\n      respond_to do |format|\n        if @expense.update(expense_params)\n          format.html { redirect_to @expense, notice: 'expense was successfully updated.' }\n          format.json { render :show, status: :ok, location: @expense }\n        else\n          format.html { render :edit }\n          format.json { render json: @expense.errors, status: :unprocessable_entity }\n        end\n      end\n    end\n\n    # DELETE /expense/1\n    # DELETE /expense/1.json\n    def destroy\n      @expense.destroy\n      respond_to do |format|\n        format.html { redirect_to @expense, notice: 'Zakupy zosta\u0142y usuni\u0119te.' }\n        format.json { head :no_content }\n      end\n    end\n\n    private\n      # Use callbacks to share common setup or constraints between actions.\n      def set_expense\n        @expense = Expense.find(params[:id])\n      end\n\n      # Never trust parameters from the scary internet, only allow the white list through.\n     def expense_params\n        params.require(:expense).permit(:date, :price, :category, :where)\n     end\n      end\n</code></pre>\n\n<p>schema</p>\n\n<pre><code>ActiveRecord::Schema.define(version: 2019_08_26_203551) do\n\n  create_table \"expenses\", force: :cascade do |t|\n    t.date \"date\"\n    t.decimal \"price\"\n    t.string \"category\"\n    t.string \"where\"\n    t.datetime \"created_at\", null: false\n    t.datetime \"updated_at\", null: false\n    t.integer \"user_id\"\n    t.index [\"user_id\"], name: \"index_expenses_on_user_id\"\n  end\n\n  create_table \"searches\", force: :cascade do |t|\n    t.date \"min_date\"\n    t.date \"max_date\"\n    t.string \"category\"\n    t.decimal \"min_price\"\n    t.decimal \"max_price\"\n    t.string \"where\"\n    t.datetime \"created_at\", null: false\n    t.datetime \"updated_at\", null: false\n  end\n\n  create_table \"users\", force: :cascade do |t|\n    t.string \"email\", default: \"\", null: false\n    t.string \"encrypted_password\", default: \"\", null: false\n    t.string \"reset_password_token\"\n    t.datetime \"reset_password_sent_at\"\n    t.datetime \"remember_created_at\"\n    t.datetime \"created_at\", null: false\n    t.datetime \"updated_at\", null: false\n    t.index [\"email\"], name: \"index_users_on_email\", unique: true\n    t.index [\"reset_password_token\"], name: \"index_users_on_reset_password_token\", unique: true\n  end\n\nend\n</code></pre>\n\n<p>routes</p>\n\n<pre><code>Rails.application.routes.draw do\n  devise_for :users\n\n  root 'expenses#index'\n  get 'search/search'\n  get 'expenses/search'\n  resources :expenses\nend\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-5"], "comments": [{"owner": {"reputation": 553, "user_id": 4742218, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh4.googleusercontent.com/-0wBoIjPuArI/AAAAAAAAAAI/AAAAAAAAAF8/gmwCNq5bAX8/photo.jpg?sz=128", "display_name": "noname", "link": "https://stackoverflow.com/users/4742218/noname"}, "edited": false, "score": 0, "creation_date": 1567023380, "post_id": 57699340, "comment_id": 101842879, "body": "you are talking about <code>Walmart</code> class but using <code>Object</code> which probably does not exist in that module."}], "answers": [{"comments": [{"owner": {"reputation": 2960, "user_id": 7426461, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/Ldwxy.jpg?s=128&g=1", "display_name": "Cannon Moyer", "link": "https://stackoverflow.com/users/7426461/cannon-moyer"}, "edited": false, "score": 0, "creation_date": 1567023701, "post_id": 57699383, "comment_id": 101842994, "body": "How does this work? Can you explain? This looks like a function call on <code>Marketplaces</code> but that would make no sense. It does however work. Thanks"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 2960, "user_id": 7426461, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/Ldwxy.jpg?s=128&g=1", "display_name": "Cannon Moyer", "link": "https://stackoverflow.com/users/7426461/cannon-moyer"}, "edited": false, "score": 1, "creation_date": 1567023981, "post_id": 57699383, "comment_id": 101843091, "body": "@CannonMoyer: Why would it make less sense than calling <code>const_get</code> on Object? Same thing happens here."}, {"owner": {"reputation": 2960, "user_id": 7426461, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/Ldwxy.jpg?s=128&g=1", "display_name": "Cannon Moyer", "link": "https://stackoverflow.com/users/7426461/cannon-moyer"}, "edited": false, "score": 0, "creation_date": 1567024378, "post_id": 57699383, "comment_id": 101843248, "body": "I guess what confuses me about this is that <code>Marketplaces.const_get</code> looks like nothing more than a class method so the syntax is rather confusing. I don&#39;t quite understand how <code>Marketplaces.const_get(&quot;Walmart&quot;)</code> returns <code>Marketplaces::Walmart</code>. It would seem to me that it would return <code>::Walmart</code> but again that wouldn&#39;t make sense at all."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 2960, "user_id": 7426461, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/Ldwxy.jpg?s=128&g=1", "display_name": "Cannon Moyer", "link": "https://stackoverflow.com/users/7426461/cannon-moyer"}, "edited": false, "score": 1, "creation_date": 1567024558, "post_id": 57699383, "comment_id": 101843317, "body": "@CannonMoyer: because Walmart is a constant which belongs to Marketplaces (is nested in it). &quot;Marketplaces.const_get looks like nothing more than a class method&quot; - that&#39;s precisely what it is. Well, actually it&#39;s a <a href=\"https://ruby-doc.org/core-2.6.3/Module.html#method-i-const_get\" rel=\"nofollow noreferrer\">module method</a>, so it should not be surprising that a module has this method."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 2960, "user_id": 7426461, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/Ldwxy.jpg?s=128&g=1", "display_name": "Cannon Moyer", "link": "https://stackoverflow.com/users/7426461/cannon-moyer"}, "edited": false, "score": 0, "creation_date": 1567024754, "post_id": 57699383, "comment_id": 101843393, "body": "@CannonMoyer: don&#39;t worry, it will click one day. In the meanwhile, maybe grab a copy of &quot;programming ruby&quot;"}, {"owner": {"reputation": 2960, "user_id": 7426461, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/Ldwxy.jpg?s=128&g=1", "display_name": "Cannon Moyer", "link": "https://stackoverflow.com/users/7426461/cannon-moyer"}, "edited": false, "score": 0, "creation_date": 1567081841, "post_id": 57699383, "comment_id": 101862533, "body": "I&#39;ll do that. Thanks for the help!"}], "tags": [], "owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "is_accepted": true, "score": 3, "last_activity_date": 1567022713, "creation_date": 1567022713, "answer_id": 57699383, "question_id": 57699340, "link": "https://stackoverflow.com/questions/57699340/reference-constant-as-string/57699383#57699383", "title": "Reference Constant as String", "body": "<p>Why did you add the <code>::Object</code>? You don't need it.</p>\n\n<pre><code>OrderSyncers::Marketplaces.const_get(\"Walmart\").new\n</code></pre>\n"}], "owner": {"reputation": 2960, "user_id": 7426461, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/Ldwxy.jpg?s=128&g=1", "display_name": "Cannon Moyer", "link": "https://stackoverflow.com/users/7426461/cannon-moyer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 57699383, "answer_count": 1, "score": 1, "last_activity_date": 1567022713, "creation_date": 1567022505, "question_id": 57699340, "link": "https://stackoverflow.com/questions/57699340/reference-constant-as-string", "title": "Reference Constant as String", "body": "<p>In my <code>/lib</code> directory in Rails 5, I have a class that is within the namespace of a Ruby module. </p>\n\n<p>I can reference the class with the following code:</p>\n\n<pre><code>OrderSyncers::Marketplaces::Walmart.new\n</code></pre>\n\n<p>In my Rails model I have a marketplace column that contains a marketplace name such as \"Walmart\". I am trying to reference the <code>Walmart</code> class. Note: the <code>Walmart</code> class is a subclass of <code>OrderSyncers::OrderSync.new</code>.</p>\n\n<p>In ruby I can successfully call a class with the following code:</p>\n\n<pre><code>Object.cont_get(\"Test\").new\n</code></pre>\n\n<p>However, when I try to reference that class name within the namespace reference, I get an error.</p>\n\n<pre><code>OrderSyncers::Marketplaces::Object.const_get(\"Walmart\").new\n</code></pre>\n\n<p>Error:</p>\n\n<pre><code>NameError (uninitialized constant OrderSyncers::Marketplaces::Object)\n</code></pre>\n\n<p>The reason I am wanting to use <code>Object.const_get(\"string\")</code> is so that I can use the fields I have in my database to initialize the correct subclass of <code>OrderSyncers::OrderSync</code>.</p>\n"}, {"tags": ["ruby", "vagrant", "chef-infra", "erb", "chef-solo"], "answers": [{"tags": [], "owner": {"reputation": 817, "user_id": 4812174, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/6a27ab3f6ed18e7c52f9d7bca090959e?s=128&d=identicon&r=PG&f=1", "display_name": "InquisitiveGirl", "link": "https://stackoverflow.com/users/4812174/inquisitivegirl"}, "is_accepted": true, "score": 2, "last_activity_date": 1567095885, "creation_date": 1567095885, "answer_id": 57714299, "question_id": 57699274, "link": "https://stackoverflow.com/questions/57699274/undefined-method-poise-service-user-for-cookbook-newrelic-infra/57714299#57714299", "title": "undefined method `poise_service_user&#39; for cookbook: newrelic-infra", "body": "<p>I raised an issue in GitHub and looks like the poise-service cookbook is no longer maintained and the owner archived it few hours ago.</p>\n"}], "owner": {"reputation": 817, "user_id": 4812174, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/6a27ab3f6ed18e7c52f9d7bca090959e?s=128&d=identicon&r=PG&f=1", "display_name": "InquisitiveGirl", "link": "https://stackoverflow.com/users/4812174/inquisitivegirl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 354, "favorite_count": 0, "accepted_answer_id": 57714299, "answer_count": 1, "score": 3, "last_activity_date": 1567095885, "creation_date": 1567022203, "question_id": 57699274, "link": "https://stackoverflow.com/questions/57699274/undefined-method-poise-service-user-for-cookbook-newrelic-infra", "title": "undefined method `poise_service_user&#39; for cookbook: newrelic-infra", "body": "<p>I am trying to setup <a href=\"https://supermarket.chef.io/cookbooks/newrelic-infra\" rel=\"nofollow noreferrer\">newrelic infra chef</a> cookbook for my project using chef solo. Following the guidelines listed in their docs: <a href=\"https://docs.newrelic.com/docs/infrastructure/new-relic-infrastructure/config-management-tools/configure-new-relic-infrastructure-using-chef\" rel=\"nofollow noreferrer\">Configure New Relic Infrastructure using Chef</a></p>\n\n<p><strong>Goal:</strong></p>\n\n<p>Start the newrelic-infra service in the ubuntu box. </p>\n\n<p>The steps mentioned are the following:</p>\n\n<p>The New Relic cookbook is available from the public Chef Supermarket  . \nTo install and configure New Relic Infrastructure using Chef:</p>\n\n<ol>\n<li>Add the newrelic-infra dependency in your own Chef metadata.rb or Berksfile - <strong>Done</strong></li>\n</ol>\n\n<p>metadata.rb</p>\n\n<pre><code>depends 'newrelic-infra'\n</code></pre>\n\n<ol start=\"2\">\n<li>Set the New Relic license key attribute. For example, add the following to your recipes/default.rb: - <strong>Done</strong></li>\n</ol>\n\n<p>newrelic-infra/attributes/default.rb</p>\n\n<pre><code># New Relic infrastructure agent configuration options\ndefault['newrelic_infra']['config'].tap do |conf|\n  # Account license key\n  conf['license_key'] = 'added my license key here'\n</code></pre>\n\n<ol start=\"3\">\n<li>Include the default New Relic recipe by using include_recipe \u2018newrelic-infra::default' or by adding the recipe to your run list. - <strong>Done</strong></li>\n</ol>\n\n<p><strong>Dependencies for new relic infra cookbook are poise-service and poise-archive v1.5.0 :</strong>\nso I have added all three cookbooks to the runlist. The vagrant file looks like this:</p>\n\n<pre><code>Vagrant.configure('2') do |config|\nconfig.vm.box = 'bento/ubuntu-18.04'\n...\n...\nconfig.vm.provision 'shell', inline: &lt;&lt;~SHELL\nwget -q -O /tmp/chefdk.deb  https://packages.chef.io/files/stable/chefdk/3.2.30/ubuntu/18.04/chefdk_3.2.30-1_amd64.deb\napt-get -q install -y /tmp/chefdk.deb\nmkdir /tmp/cookbooks\n  ...\nrsync -av  /vagrant/infrastructure-agent-chef/ /tmp/cookbooks/newrelic-infra/\ngit clone https://github.com/poise/poise-service.git /tmp/cookbooks/poise-service\ncd /tmp/cookbooks/poise-service &amp;&amp; git checkout v1.5.0\ngit clone https://github.com/poise/poise-archive.git /tmp/cookbooks/poise-archive\ncd /tmp/cookbooks/poise-archive &amp;&amp; git checkout v1.5.0\necho '{\"run_list\":[\"recipe[newrelic-infra]\", \"recipe[poise-service]\", \"recipe[poise-archive]\"]}' &gt; /tmp/runlist.json\nchef-solo -j /tmp/runlist.json --recipe-url /tmp/random.tar.gz \nSHELL\nend\n</code></pre>\n\n<p>finally when I run newrelic-infra service using vagrant up I see the following error:</p>\n\n<pre><code>default: Starting Chef Client, version 14.4.56 default: resolving cookbooks for run list: [\"newrelic-infra\", \"poise-service\", \"poise-archive\"] default: Synchronizing Cookbooks: default: - newrelic-infra (0.11.0) default: - poise-service (0.0.0) default: default: - poise-archive (0.0.0) default: Installing Cookbook Gems: default: Compiling Cookbooks... default: default: ================================================================================ default: Recipe Compile Error in /etc/chef/local-mode-cache/cache/cookbooks/newrelic-infra/recipes/default.rb default: ================================================================================ default: default: default: NoMethodError default: ------------- default: undefined method poise_service_user' for cookbook: newrelic-infra, recipe: agent_linux :Chef::Recipe\ndefault:\ndefault:\ndefault: Cookbook Trace:\ndefault: ---------------\ndefault: /etc/chef/local-mode-cache/cache/cookbooks/newrelic-infra/recipes/agent_linux.rb:17:in from_file' default: default: /etc/chef/local-mode-cache/cache/cookbooks/newrelic-infra/recipes/default.rb:11:in from_file'\ndefault:\ndefault: Relevant File Content:\ndefault: ----------------------\ndefault: /etc/chef/local-mode-cache/cache/cookbooks/newrelic-infra/recipes/agent_linux.rb:\ndefault:\ndefault: 10: #\ndefault: 11: node.default['newrelic_infra']['agent']['flags']['config'] = ::File.join(\ndefault: 12: node['newrelic_infra']['agent']['directory']['path'],\ndefault: 13: node['newrelic_infra']['agent']['config']['file']\ndefault: 14: )\ndefault: 15:\ndefault: 16: # Setup a service account\ndefault: 17&gt;&gt; poise_service_user node['newrelic_infra']['user']['name'] do\ndefault: 18: group node['newrelic_infra']['group']['name']\ndefault: 19: only_if { node['newrelic_infra']['features']['manage_service_account'] }\ndefault: 20: end\ndefault: 21:\ndefault: 22: # Based on the Ohai attribute platform_family either an APT or YUM repository\ndefault: 23: # will be created. The respective Chef resources are built using metaprogramming,\ndefault: 24: # so that the configuration can be extended via attributes without having to\ndefault: 25: # release a new version of the cookbook. Attributes that cannot be passed to the resource\ndefault: 26: # are logged out as warnings in order to prevent potential failes from typos,\ndefault:\ndefault: System Info:\ndefault: ------------\ndefault: chef_version=14.4.56\ndefault: platform=ubuntu\ndefault: platform_version=18.04\ndefault: ruby=ruby 2.5.1p57 (2018-03-29 revision 63029) [x86_64-linux]\ndefault: program_name=/usr/bin/chef-solo\ndefault: executable=/opt/chefdk/bin/chef-solo\ndefault:\ndefault:\ndefault: Running handlers:`\n</code></pre>\n\n<p>I spent hours looking into the cookbook source in GitHub but no luck yet, Anyone have idea or troubleshooting tips? I am pretty new to Chef or ruby so I would really appreciate any suggestions.</p>\n\n<p>Thanks!</p>\n\n<p>Helpful links:</p>\n\n<ul>\n<li><a href=\"https://github.com/newrelic/infrastructure-agent-chef\" rel=\"nofollow noreferrer\">https://github.com/newrelic/infrastructure-agent-chef</a></li>\n<li><a href=\"https://github.com/poise/poise-service\" rel=\"nofollow noreferrer\">https://github.com/poise/poise-service</a></li>\n<li><a href=\"https://github.com/poise/poise-archive\" rel=\"nofollow noreferrer\">https://github.com/poise/poise-archive</a></li>\n</ul>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 2251, "user_id": 9785060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IUduC.png?s=128&g=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/9785060/viktor"}, "edited": false, "score": 1, "creation_date": 1567020899, "post_id": 57698750, "comment_id": 101841906, "body": "You probably don&#39;t want to delete the user each time he logs out. That would require the user to register/signup each time he wants to visit the website again after logging out. If you&#39;re new to rails I suggest you look for resources online which explain how to create a login/logout system with sessions. My recommendation is Michael Hartl&#39;s &#39;Ruby on Rails tutorial&#39;, but most resources out there will do. Attempting to reinvent the wheel for things like this will just lead to wasted time and frustration."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 1, "creation_date": 1567021565, "post_id": 57698750, "comment_id": 101842147, "body": "You may want to look at pre-existing solutions like <a href=\"https://github.com/plataformatec/devise\" rel=\"nofollow noreferrer\">Devise</a> before rolling your own. Even if you don&#39;t use them, you can get ideas on how to implement your own."}], "answers": [{"tags": [], "owner": {"reputation": 79, "user_id": 10205816, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-svvoh8gZUAg/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pNpm_q05CLjKxkTdXEkQf6KGSXHw/mo/photo.jpg?sz=128", "display_name": "Gotenks-J", "link": "https://stackoverflow.com/users/10205816/gotenks-j"}, "is_accepted": true, "score": 1, "last_activity_date": 1567043261, "creation_date": 1567043261, "answer_id": 57701956, "question_id": 57698750, "link": "https://stackoverflow.com/questions/57698750/session-destroy-in-controller/57701956#57701956", "title": "session.destroy in controller", "body": "<p>First, don't <code>destroy</code> your user. It deletes it from the database, you want them to be able to login again without creating a new user right?</p>\n\n<p>You need to update your <code>routes.rb</code> file to be:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>Rails.application.routes.draw do\n  # Fubyonrails.org/routing.html\n  root :to =&gt; 'static#welcome'\n  resources :users, only: [:new, :create, :show]\n  resources :sessions, :only =&gt; [:new, :create, :destroy] # changed to sessions\n  resources :studios \n  get 'logout' =&gt; 'sessions#destroy'\nend\n</code></pre>\n\n<p>If you don't already, you need to define a SessionsController.</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>class SessionsController &lt; ApplicationController\n\n  def destroy\n    # insert logic that actually logs them out, the below may already be enough \n    # for this purpose though\n    redirect_to root_url, notice: \"Logged Out Successfully\"\n  end\n\nend\n</code></pre>\n\n<p>When the user clicks \"Logout\" it gets routed to the <code>SessionsController#destroy</code> action which redirects them to the root URL (<code>'static#welcome'</code>)</p>\n\n<p>There is more to it then that (i.e. the views and all that jazz) but this should be helpful enough</p>\n"}], "owner": {"reputation": 77, "user_id": 11871896, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cUszr.jpg?s=128&g=1", "display_name": "code prodigy", "link": "https://stackoverflow.com/users/11871896/code-prodigy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "accepted_answer_id": 57701956, "answer_count": 1, "score": 0, "last_activity_date": 1567043261, "creation_date": 1567019571, "last_edit_date": 1567032134, "question_id": 57698750, "link": "https://stackoverflow.com/questions/57698750/session-destroy-in-controller", "title": "session.destroy in controller", "body": "<p>I am trying to create a log out for my app and in my controller this piece of code is not working. Any solution would be helpful.</p>\n\n<pre><code>def destroy\n  @user = user.find(params[:id])\n  @user.destroy\nend \n</code></pre>\n\n<p>This is my destroy method in my sessions controller(the fact that i am destroying my user in my sessions controller might be the problem)</p>\n\n<pre><code>class UsersController &lt; ApplicationController\n\n    def new\n    end\n\n    def create\n      @user = User.create(password: params[:password],\n                          email: params[:email],\n                          firstname: params[:firstname], \n                          lastname: params[:lastname])\n      redirect_to user_path(@user)\n    end\n\n    def show\n        @user = User.find(params[:id])\n    end\nend\n</code></pre>\n\n<p>routes.rb:</p>\n\n<pre><code>Rails.application.routes.draw do\n  # Fubyonrails.org/routing.html\n  root :to =&gt; 'static#welcome'\n  resources :users, only: [:new, :create, :show]\n  resources :session, :only =&gt; [:new, :create, :destroy]\n  resources :studios \nend\n</code></pre>\n\n<p>Routes file</p>\n\n<blockquote>\n  <p>uninitialized constant SessionController</p>\n</blockquote>\n\n<p>is the error im getting</p>\n"}, {"tags": ["ruby", "redis"], "comments": [{"owner": {"reputation": 7374, "user_id": 593425, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ad54f71e8e63bf711680cf8f5f1e53c1?s=128&d=identicon&r=PG", "display_name": "Guy Korland", "link": "https://stackoverflow.com/users/593425/guy-korland"}, "edited": false, "score": 0, "creation_date": 1567019416, "post_id": 57698512, "comment_id": 101841356, "body": "Did you consider using RedisJSON.io?"}, {"owner": {"reputation": 91121, "user_id": 179125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5594142dcc49a24b1902ec8059181f8d?s=128&d=identicon&r=PG&f=1", "display_name": "Jordan Running", "link": "https://stackoverflow.com/users/179125/jordan-running"}, "edited": false, "score": 5, "creation_date": 1567025125, "post_id": 57698512, "comment_id": 101843530, "body": "That&#39;s not JSON. It looks like a Ruby hash inside of an array that was na&#239;vely converted to a string instead of encoded as JSON before being put into the database. The culprit is whatever code is writing to Redis, not the code that&#39;s reading from it."}], "answers": [{"tags": [], "owner": {"reputation": 1997, "user_id": 1771976, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sxpaV.jpg?s=128&g=1", "display_name": "lastcanal", "link": "https://stackoverflow.com/users/1771976/lastcanal"}, "is_accepted": false, "score": 2, "last_activity_date": 1567462596, "creation_date": 1567462596, "answer_id": 57763141, "question_id": 57698512, "link": "https://stackoverflow.com/questions/57698512/json-parsing-a-redis-get-return/57763141#57763141", "title": "JSON Parsing a Redis.get return", "body": "<p>You need to first serialize your ruby object into JSON before storing it in redis. </p>\n\n<p>In this case you would need to call <code>$redis.set('data', JSON.dump(data))</code> instead of what is currently being called, which is <code>$redis.set('data', data.to_s)</code>. The <code>.to_s</code> gets called on whatever object is passed into redis' <code>set</code> method. </p>\n\n<p>If you really need to parse the data you have already stored then you can use ruby's <code>eval</code>, although you should not use this in production!</p>\n\n<pre><code>$ data = eval($redis.get('data'))\n=&gt; [{\"login\"=&gt;\"name\", \"id\"=&gt;1574}]\n$ $redis.set('data', JSON.dump(data))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 15713372, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AOh14GhxkIhHiCW6g9eI6GuUWUQx6bAJ1JEi7t99eVkI=k-s128", "display_name": "\ucd5c\uaddc\uc5f0", "link": "https://stackoverflow.com/users/15713372/%ec%b5%9c%ea%b7%9c%ec%97%b0"}, "is_accepted": false, "score": 0, "last_activity_date": 1619008509, "last_edit_date": 1619008509, "creation_date": 1618974043, "answer_id": 67188753, "question_id": 57698512, "link": "https://stackoverflow.com/questions/57698512/json-parsing-a-redis-get-return/67188753#67188753", "title": "JSON Parsing a Redis.get return", "body": "<pre><code>&quot;[{\\&quot;login\\&quot;=&gt;\\&quot;name\\&quot;, \\&quot;id\\&quot;=&gt;1574}]&quot;\n</code></pre>\n<p>is not json string</p>\n<hr />\n<p>If you want to deserialize string then you write this.</p>\n<pre><code>&quot;[{\\&quot;login\\&quot;:\\&quot;name\\&quot;, \\&quot;id\\&quot;:1574}]&quot;\n</code></pre>\n<p><code>=&gt;</code> is changed to <code>:</code></p>\n<p>So, you need to modify the creation JSON string.</p>\n"}], "owner": {"reputation": 6503, "user_id": 5650878, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/xh7BI.png?s=128&g=1", "display_name": "Bitwise", "link": "https://stackoverflow.com/users/5650878/bitwise"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 248, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1619008509, "creation_date": 1567018431, "question_id": 57698512, "link": "https://stackoverflow.com/questions/57698512/json-parsing-a-redis-get-return", "title": "JSON Parsing a Redis.get return", "body": "<p>I'm storing some data in Redis and when I retrieve this data I'm having trouble parsing it.</p>\n\n<p>When I run this:</p>\n\n<p><code>$redis.get(\"data\")</code> I get this: <code>\"[{\\\"login\\\"=&gt;\\\"name\\\", \\\"id\\\"=&gt;1574}]\"</code></p>\n\n<p>When I try to use JSON.parse against the return body I get this error:</p>\n\n<p><code>JSON::ParserError: 409: unexpected token at '{\"login\"=&gt;\"name\", \"id\"=&gt;1574}]'</code></p>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "answers": [{"tags": [], "owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "is_accepted": false, "score": 0, "last_activity_date": 1567018224, "creation_date": 1567018224, "answer_id": 57698470, "question_id": 57698177, "link": "https://stackoverflow.com/questions/57698177/refactor-controller-code-for-list-sorting-methods/57698470#57698470", "title": "Refactor Controller Code for LIst Sorting Methods", "body": "<p>There may be a more minimal form of this, but this general-purpose method might be the basis for a start. This uses the array modifier where chunks of the array can be given the <code>reverse</code> treatment to swap their order:</p>\n\n<pre><code>def swap(list, el, dir)\n  index = list.index(el)\n  list = list.dup\n\n  case (dir)\n  when :up\n    # Do simple bounds checking here\n    unless (index &gt; 0)\n      return list\n    end\n\n    # Offset the swap\n    index -= 1\n\n  when :down\n    unless (index + 1 &lt; list.length)\n      return list\n    end\n  end\n\n  # Reverse the elements at the target location\n  list[index, 2] = list[index, 2].reverse\n\n  list\nend\n</code></pre>\n\n<p>You'll want to keep your <code>render</code> and <code>redirect_to</code> calls out of your <code>swap</code> method so it does <em>one thing and one thing only</em>. You're over-complicating the method by making it do a bunch of things at once and this makes it hard to test.</p>\n\n<p>This one here can be demonstrated easily:</p>\n\n<pre><code>list = %w[ a b c d e f ]\n\np swap(list, 'a', :down) # =&gt; [\"b\", \"a\", \"c\", \"d\", \"e\", \"f\"]\np swap(list, 'a', :up)   # =&gt; [\"a\", \"b\", \"c\", \"d\", \"e\", \"f\"]\np swap(list, 'c', :down) # =&gt; [\"a\", \"b\", \"d\", \"c\", \"e\", \"f\"]\np swap(list, 'c', :up)   # =&gt; [\"a\", \"c\", \"b\", \"d\", \"e\", \"f\"]\np swap(list, 'f', :down) # =&gt; [\"a\", \"b\", \"c\", \"d\", \"e\", \"f\"]\np swap(list, 'f', :up)   # =&gt; [\"a\", \"b\", \"c\", \"d\", \"f\", \"e\"]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 63, "user_id": 11969530, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-4Kx3JSCfqDI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdqIkKVY6QAVC8hy_9W18rqmcs_7A/photo.jpg?sz=128", "display_name": "Daniele Deltodesco", "link": "https://stackoverflow.com/users/11969530/daniele-deltodesco"}, "edited": false, "score": 0, "creation_date": 1567254677, "post_id": 57700133, "comment_id": 101915110, "body": "Thanks for the response and suggestions. I had trouble using the act_as_list gem as I am using HABTM relationships between the models which doesn&#39;t seem to be compatible.  Your code is great, only part I don&#39;t understand is this: &#39;sort &gt; ?&#39; in the ternary operator. What is the use of the ? in this case?  Also my update method currently is accepting params which it is receiving from a form for editing the text. Can I still use the same update method when only wanting to update the sort column?  Thanks!"}], "tags": [], "owner": {"reputation": 91121, "user_id": 179125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5594142dcc49a24b1902ec8059181f8d?s=128&d=identicon&r=PG&f=1", "display_name": "Jordan Running", "link": "https://stackoverflow.com/users/179125/jordan-running"}, "is_accepted": false, "score": 4, "last_activity_date": 1567027471, "last_edit_date": 1567027471, "creation_date": 1567026961, "answer_id": 57700133, "question_id": 57698177, "link": "https://stackoverflow.com/questions/57698177/refactor-controller-code-for-list-sorting-methods/57700133#57700133", "title": "Refactor Controller Code for LIst Sorting Methods", "body": "<p>The easiest way to do this is to use the <a href=\"https://github.com/swanandp/acts_as_list\" rel=\"nofollow noreferrer\">acts_as_list</a> gem, which is mature, well-tested, and designed for this exact purpose.</p>\n\n<p>That said, I think you're probably overthinking this slightly. You don't need to do all of that math, nor do you need to fetch all of the other Dishes in the Section. All you need to do is fetch the Dish with the next higher/lower <code>sort</code> and swap the two Dishes' <code>sort</code>s:</p>\n\n<pre><code>def up\n  swap!(:up, @dish, @section)\nend\n\ndef down\n  swap!(:down, @dish, @section)\nend\n\ndef swap!(direction, dish, section)\n  condition = direction == :up ? 'sort &gt; ?' : 'sort &lt; ?'\n  asc_or_desc = direction == :up ? :desc : :asc\n  next_dish = section.dishes\n    .where(condition, dish.sort)\n    .order(sort: asc_or_desc)\n    .first\n\n  return false if next_dish.nil?\n\n  Dish.transaction do\n    next_dish.update!(sort: dish.sort)\n    dish.update!(sort: next_dish.sort)\n  end\nend\n</code></pre>\n\n<p>On the topic of organizing your code, the code <code>redirect_to</code> and <code>render</code> code should go in your controller method (e.g. <code>update</code>), not <code>swap</code>. And for that matter, all of the code above probably belongs in your model, not your controller:</p>\n\n<pre><code>class Dish &lt; ApplicationRecord\n  # ...\n\n  def move_up!(section)\n    swap!(:up, section)\n  end\n\n  def move_down!(section)\n    swap!(:down, section)\n  end\n\n  def swap!(direction, section)\n    condition = direction == :up ? 'sort &gt; ?' : 'sort &lt; ?'\n    asc_or_desc = direction == :up ? :desc : :asc\n    next_dish = section.dishes\n      .where(condition, sort)\n      .order(sort: asc_or_desc)\n      .first\n\n    return false if next_dish.nil?\n\n    transaction do\n      next_dish.update!(sort: sort)\n      update!(sort: next_dish.sort)\n    end\n  end\nend\n</code></pre>\n\n<p>Then in your controller method you would just call e.g. <code>@dish.move_up!(@section)</code>.</p>\n"}], "owner": {"reputation": 63, "user_id": 11969530, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-4Kx3JSCfqDI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdqIkKVY6QAVC8hy_9W18rqmcs_7A/photo.jpg?sz=128", "display_name": "Daniele Deltodesco", "link": "https://stackoverflow.com/users/11969530/daniele-deltodesco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1567027471, "creation_date": 1567016784, "last_edit_date": 1567017479, "question_id": 57698177, "link": "https://stackoverflow.com/questions/57698177/refactor-controller-code-for-list-sorting-methods", "title": "Refactor Controller Code for LIst Sorting Methods", "body": "<p>List sorting using sort column. Function is working well, however I feel like there must be a way to refactor this code, as the only difference is the operators for some variable assignments!</p>\n\n<p>Methods used to be separate so managed to reduce the code slightly, but not enough!</p>\n\n<p>One method will move the item up in the list, and the down method will move the list item down one. Swap method is to switch the positions in the list.</p>\n\n<p>I have the order set in the model scope</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>  def up\n    return false if @dish == @section.dishes.first\n    swap('up', @dish, @section)\n  end\n\n  def down\n    return false if @dish == @section.dishes.last\n    swap('down', @dish, @section)\n  end\n\n  def swap(direction, dish, section)\n    dish_i = 0\n    section.dishes.each_with_index do |d, i|\n      dish_i = i - 1 if dish == d &amp;&amp; direction == 'up'\n      dish_i = i + 1 if dish == d &amp;&amp; direction == 'down'\n    end\n    dish2 = section.dishes[dish_i]\n    if direction == 'up'\n      dish2.sort += 1\n      dish.sort -= 1\n    elsif direction == 'down'\n      dish2.sort -= 1\n      dish.sort += 1\n    end\n    if @dish.save &amp;&amp; dish2.save\n      redirect_to menu_path(params[:menu_id])\n    else\n      render :show\n    end\n  end\n</code></pre>\n\n<p>would like to reduce the code as a lot of the logic is the same</p>\n"}, {"tags": ["ruby"], "answers": [{"tags": [], "owner": {"reputation": 43, "user_id": 2707413, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe1ee9bd374d2a0eb0265298d8a9e05d?s=128&d=identicon&r=PG", "display_name": "yuntan_t", "link": "https://stackoverflow.com/users/2707413/yuntan-t"}, "is_accepted": true, "score": 0, "last_activity_date": 1567164498, "creation_date": 1567164498, "answer_id": 57725901, "question_id": 57698145, "link": "https://stackoverflow.com/questions/57698145/ruby-net-http-how-to-fix-eoferror-on-https-post-request/57725901#57725901", "title": "ruby net/http: How to fix EOFError on HTTPS POST request", "body": "<p>Due to my wrong guess.</p>\n\n<p><code>Net::HTTP.new</code> does not take any block, so the code below</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>Net::HTTP.new uri.host, uri.port do |http|\n  http.use_ssl = true\nend.start ...\n</code></pre>\n\n<p>should be</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>(Net::HTTP.new uri.host, uri.port).tap do |http|\n  http.use_ssl = true\nend.start ...\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 2707413, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe1ee9bd374d2a0eb0265298d8a9e05d?s=128&d=identicon&r=PG", "display_name": "yuntan_t", "link": "https://stackoverflow.com/users/2707413/yuntan-t"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 343, "favorite_count": 0, "accepted_answer_id": 57725901, "answer_count": 1, "score": 1, "last_activity_date": 1567164498, "creation_date": 1567016669, "last_edit_date": 1567016985, "question_id": 57698145, "link": "https://stackoverflow.com/questions/57698145/ruby-net-http-how-to-fix-eoferror-on-https-post-request", "title": "ruby net/http: How to fix EOFError on HTTPS POST request", "body": "<p>I'm writing a script to get data from GitHub v4 API. But my Ruby script fails on <code>EOFError</code>. How to avoid <code>EOFError</code>?</p>\n\n<p>The following code fails on <code>end of file reached (EOFError)</code>. I run the script 10 times, but no one suceeded.</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>require 'net/http'\nrequire 'uri'\n\nuri = URI.parse 'https://api.github.com/graphql'\nheader = {\n  'Authorization' =&gt; 'bearer MY_GITHUB_TOKEN',\n}\n\nNet::HTTP.new uri.host, uri.port do |http|\n  http.use_ssl = true\nend.start do |http|\n  req = Net::HTTP::Post.new uri.path, header\n  req.body = \" \\\n { \\\n   \\\"query\\\": \\\"query { viewer { login }}\\\" \\\n } \\\n\"\n  http.request req do |res|\n    p res.code\n    p res.message\n    p res.body\n    p res.read_body\n    res.read_body do |body|\n      p body\n    end\n  end\nend\n</code></pre>\n\n<p>I'm using Ruby <code>ruby 2.6.3p62 (2019-04-16 revision 67580) [x86_64-linux]\n</code> compiled by rbenv-build. I got following stack trace.</p>\n\n<pre><code>Traceback (most recent call last):\n        11: from tmp.rb:20:in `&lt;main&gt;'\n        10: from /home/yuntan/.rbenv/versions/2.6.3/lib/ruby/2.6.0/net/http.rb:920:in `start'\n         9: from tmp.rb:31:in `block in &lt;main&gt;'\n         8: from /home/yuntan/.rbenv/versions/2.6.3/lib/ruby/2.6.0/net/http.rb:1479:in `request'\n         7: from /home/yuntan/.rbenv/versions/2.6.3/lib/ruby/2.6.0/net/http.rb:1506:in `transport_request'\n         6: from /home/yuntan/.rbenv/versions/2.6.3/lib/ruby/2.6.0/net/http.rb:1506:in `catch'\n         5: from /home/yuntan/.rbenv/versions/2.6.3/lib/ruby/2.6.0/net/http.rb:1509:in `block in transport_request'\n         4: from /home/yuntan/.rbenv/versions/2.6.3/lib/ruby/2.6.0/net/http/response.rb:29:in `read_new'\n         3: from /home/yuntan/.rbenv/versions/2.6.3/lib/ruby/2.6.0/net/http/response.rb:40:in `read_status_line'\n         2: from /home/yuntan/.rbenv/versions/2.6.3/lib/ruby/2.6.0/net/protocol.rb:201:in `readline'\n         1: from /home/yuntan/.rbenv/versions/2.6.3/lib/ruby/2.6.0/net/protocol.rb:191:in `readuntil'\n/home/yuntan/.rbenv/versions/2.6.3/lib/ruby/2.6.0/net/protocol.rb:225:in `rbuf_fill': end of file reached (EOFError)\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "testing", "rspec"], "comments": [{"owner": {"reputation": 3090, "user_id": 4454732, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh3.googleusercontent.com/-8OrTJkCtkn4/AAAAAAAAAAI/AAAAAAAAA4s/7jp2lrThK2k/photo.jpg?sz=128", "display_name": "David Hempy", "link": "https://stackoverflow.com/users/4454732/david-hempy"}, "edited": false, "score": 0, "creation_date": 1567018859, "post_id": 57697436, "comment_id": 101841106, "body": "Move your action (fetch_cfm_data) to after the expect line,"}], "answers": [{"comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 1, "creation_date": 1567014449, "post_id": 57697451, "comment_id": 101839443, "body": "Or you can use a <code>spy</code> and use <code>expect(spy).to have_received(message)</code> <a href=\"https://relishapp.com/rspec/rspec-mocks/docs/basics/spies\" rel=\"nofollow noreferrer\">Spies</a>"}], "tags": [], "owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "is_accepted": true, "score": 5, "last_activity_date": 1567013581, "creation_date": 1567013581, "answer_id": 57697451, "question_id": 57697436, "link": "https://stackoverflow.com/questions/57697436/expect-object-to-receive-message-not-working-as-expected/57697451#57697451", "title": "Expect &quot;Object&quot; to receive message not working as expected", "body": "<p>You need to first set expectations, and then call the method under test:</p>\n\n<pre><code>  expect(GoogleCalendarApi::V1::Client).to receive(:get_cfm)\n  fetch_cfm_data\n</code></pre>\n\n<p>See more in <a href=\"https://relishapp.com/rspec/rspec-mocks/v/3-8/docs/basics/expecting-messages\" rel=\"noreferrer\"><code>rspec-mocks</code> docs</a>.</p>\n"}], "owner": {"reputation": 6503, "user_id": 5650878, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/xh7BI.png?s=128&g=1", "display_name": "Bitwise", "link": "https://stackoverflow.com/users/5650878/bitwise"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 57697451, "answer_count": 1, "score": 3, "last_activity_date": 1567013598, "creation_date": 1567013506, "last_edit_date": 1567013598, "question_id": 57697436, "link": "https://stackoverflow.com/questions/57697436/expect-object-to-receive-message-not-working-as-expected", "title": "Expect &quot;Object&quot; to receive message not working as expected", "body": "<p>I have this spec:</p>\n\n<pre><code>it 'makes a request to google if redis is empty' do\n  fetch_cfm_data\n\n  expect(GoogleCalendarApi::V1::Client).to receive(:get_cfm)\nend\n</code></pre>\n\n<p>I've debugged the messages being called during this process of my test and <code>GoogleCalendarApi::V1::Client.get_cfm</code> is certainly being called because I can pry inside of that method during the test run. Why does my test return this failure?</p>\n\n<pre><code>Failure/Error: expect(GoogleCalendarApi::V1::Client).to receive(:get_cfm)\n\n       (GoogleCalendarApi::V1::Client (class)).get_cfm(*(any args))\n           expected: 1 time with any arguments\n           received: 0 times with any arguments\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-5"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 2, "creation_date": 1567012770, "post_id": 57697246, "comment_id": 101838753, "body": "Does <code>Order</code> have a <code>has_many :items</code> relationship or not?"}, {"owner": {"reputation": 335, "user_id": 2579077, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Rz1o3.jpg?s=128&g=1", "display_name": "sam", "link": "https://stackoverflow.com/users/2579077/sam"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1567013382, "post_id": 57697246, "comment_id": 101839014, "body": "I don&#39;t have that relationship in my orders, &quot;items&quot;, should I have &quot;has _many  :order_items&quot; since I don&#39;t have an &quot;items&quot; table, only reference I have for &quot;items&quot; is on the routes. ( I am a newbie here)"}, {"owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "edited": false, "score": 0, "creation_date": 1567013451, "post_id": 57697246, "comment_id": 101839040, "body": "Could you add your <code>Order</code> class to to the question? We don&#39;t need all of it, only the class definition and associations."}, {"owner": {"reputation": 13359, "user_id": 1779477, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/f62e1d28063f41fd9728d811fea3a84c?s=128&d=identicon&r=PG&f=1", "display_name": "idmean", "link": "https://stackoverflow.com/users/1779477/idmean"}, "edited": false, "score": 0, "creation_date": 1567013505, "post_id": 57697246, "comment_id": 101839065, "body": "What is \u201corder\u201d? What does \u201corder.inspect\u201d show?"}, {"owner": {"reputation": 335, "user_id": 2579077, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Rz1o3.jpg?s=128&g=1", "display_name": "sam", "link": "https://stackoverflow.com/users/2579077/sam"}, "edited": false, "score": 0, "creation_date": 1567014045, "post_id": 57697246, "comment_id": 101839274, "body": "It shows this  &quot;Order(id: integer, sub_total: decimal, created_at: datetime, updated_at: datetime, token: string)&quot;"}], "answers": [{"tags": [], "owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "is_accepted": true, "score": 3, "last_activity_date": 1567016122, "last_edit_date": 1567016122, "creation_date": 1567015774, "answer_id": 57697954, "question_id": 57697246, "link": "https://stackoverflow.com/questions/57697246/i-need-a-fresh-pair-of-airs-for-this-error-here-undefined-method-items-for/57697954#57697954", "title": "I need a fresh pair of airs for this error here: &quot;undefined method `items&#39; for #&lt;Order:0x00007f93d361b390&gt;&quot;", "body": "<p>The tutorial probably added the needed associations between the first and second video (<a href=\"https://www.youtube.com/watch?v=TwoafJC7vlw&amp;list=PLebos0ZZRqzeT7XBTYwL9JGN1PwoZVB9p&amp;index=1&amp;t=36m20s\" rel=\"nofollow noreferrer\">like mentioned in part 1 timestamp 36:20</a>).</p>\n\n<p>With your current code I would assume they are as follows:</p>\n\n<pre><code>class Order &lt; ApplicationRecord\n  has_many :items, class_name: 'OrderItem'\n  # ...\nend\n\nclass OrderItem &lt; ApplicationRecord\n  belongs_to :order\n  # ...\nend\n</code></pre>\n\n<p>For this to work the <code>order_items</code> table must have an <code>order_id</code> column (with the same type as the <code>id</code> column of the <code>orders</code> table).</p>\n\n<p>For more info about associations check out the <a href=\"https://guides.rubyonrails.org/association_basics.html\" rel=\"nofollow noreferrer\">Active Record Associations</a> guide.</p>\n"}], "owner": {"reputation": 335, "user_id": 2579077, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Rz1o3.jpg?s=128&g=1", "display_name": "sam", "link": "https://stackoverflow.com/users/2579077/sam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 57697954, "answer_count": 1, "score": 1, "last_activity_date": 1567016122, "creation_date": 1567012603, "last_edit_date": 1567013969, "question_id": 57697246, "link": "https://stackoverflow.com/questions/57697246/i-need-a-fresh-pair-of-airs-for-this-error-here-undefined-method-items-for", "title": "I need a fresh pair of airs for this error here: &quot;undefined method `items&#39; for #&lt;Order:0x00007f93d361b390&gt;&quot;", "body": "<p>I am learning Ruby and building a shopping cart site, for book. </p>\n\n<p>I am trying to create my orders. Was following the tutorial below.</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>https://www.youtube.com/watch?v=orDmqI-dlCo&amp;list=PLebos0ZZRqzeT7XBTYwL9JGN1PwoZVB9p&amp;index=4</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>The Error happens when I click on Add order to basket, the problem is that \"items\" is only referrenced on the routes and not on the tables, I have order_items table in my schema, I must be tired, but if you can help will appreciate. </p>\n\n<pre><code>book = Book.find(book_id)\n\norder_item = order.items.find_or_create_by(\n  book_id: book_id\n)\n</code></pre>\n\n<p>Order Items Controller</p>\n\n<pre><code>class OrderItemsController &lt; ApplicationController\n  def create\n    current_bag.add_item(\n      book_id: params[:book_id],\n      quantity: params[:quantity]\n    )\n\n    redirect_to bag_path\n  end\nend\n</code></pre>\n\n<p>Shopping Bag Controller</p>\n\n<pre><code>class ShoppingBag\n  def initialize(token:)\n    @token = token\n  end\n\n  def order\n    @order ||= Order.find_or_create_by(token: @token) do | order|\n      order.sub_total = 0\n    end\n  end\n\n  def add_item(book_id:, quantity: 1)\n    book = Book.find(book_id)\n\n    order_item = order.items.find_or_create_by(\n      book_id: book_id\n    )\n\n    order_item.price = book.price\n    order_item.quantity = quantity\n\n    order_item.save\n  end\nend\n</code></pre>\n\n<p>Routes</p>\n\n<pre><code>Rails.application.routes.draw do\n  root \"books#index\"\n\n  resources :line_items\n  get '/bag', to: 'order_items#index'\n  resources :order_items, path: '/bag/items'\n\n  # resources :locations\n  resources :books\n\n  devise_for :users, controllers: {registrations: \"registrations\"}\n  resources :pricing, only: [:index]\n  resources :subscriptions\n  # For details on the DSL available within this file, see http://guides.rubyonrails.org/routing.html\nend\n</code></pre>\n\n<p>My Order.rb file</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>class Order &lt; ApplicationRecord\r\n\r\nend</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 16672, "user_id": 22237, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/hkobD.png?s=128&g=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/22237/kris"}, "edited": false, "score": 5, "creation_date": 1567011544, "post_id": 57696714, "comment_id": 101838227, "body": "You need to call <code>super</code> in the child class to call the <code>run</code> method in the parent."}], "owner": {"reputation": 2111, "user_id": 2251303, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/6bbbc78a70fcb3621e68d4b2630d8900?s=128&d=identicon&r=PG", "display_name": "new2cpp", "link": "https://stackoverflow.com/users/2251303/new2cpp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 26, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1567010146, "creation_date": 1567010146, "question_id": 57696714, "link": "https://stackoverflow.com/questions/57696714/ror-how-to-catch-general-error-in-parent-class", "title": "RoR How to catch general error in parent class?", "body": "<pre><code>class ParentClass\n  def run\n  rescue StandardError =&gt; e\n    p 'catch in parent class'\n  end\nend\n\nclass ChildClass &lt; ParentClass\n  def run\n  rescue ArgumentError =&gt; e\n    p 'catch in child class'\n  end\nend\n</code></pre>\n\n<p>Kindly review above code, I have a series of children classes. </p>\n\n<pre><code>instance = ChildClass.new\ninstance.run\n</code></pre>\n\n<p>when instance run and meet <code>ArgumentError</code>, ChildClass will handle it. If not, since the parent class will catch all general <code>StandardError</code>, any error not caught in ChildClass, will be caught in parent class eventually.</p>\n\n<p>How to implement the above logic?</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 2007, "user_id": 716039, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76b302eed6a8add5db6b3f2e1c7c9942?s=128&d=identicon&r=PG", "display_name": "dinjas", "link": "https://stackoverflow.com/users/716039/dinjas"}, "edited": false, "score": 0, "creation_date": 1567005757, "post_id": 57695435, "comment_id": 101835442, "body": "You&#39;ll want to render or redirect in the controller, where <code>@order</code> is getting set."}, {"owner": {"reputation": 11, "user_id": 11406245, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16fc1b844539d3afeb0d3afa7d35c912?s=128&d=identicon&r=PG&f=1", "display_name": "gina", "link": "https://stackoverflow.com/users/11406245/gina"}, "reply_to_user": {"reputation": 2007, "user_id": 716039, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76b302eed6a8add5db6b3f2e1c7c9942?s=128&d=identicon&r=PG", "display_name": "dinjas", "link": "https://stackoverflow.com/users/716039/dinjas"}, "edited": false, "score": 0, "creation_date": 1567005906, "post_id": 57695435, "comment_id": 101835532, "body": "@dinjas hi i&#39;ve updated my cotroller"}, {"owner": {"reputation": 11, "user_id": 11406245, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16fc1b844539d3afeb0d3afa7d35c912?s=128&d=identicon&r=PG&f=1", "display_name": "gina", "link": "https://stackoverflow.com/users/11406245/gina"}, "reply_to_user": {"reputation": 2007, "user_id": 716039, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76b302eed6a8add5db6b3f2e1c7c9942?s=128&d=identicon&r=PG", "display_name": "dinjas", "link": "https://stackoverflow.com/users/716039/dinjas"}, "edited": false, "score": 0, "creation_date": 1567089126, "post_id": 57695435, "comment_id": 101867129, "body": "hi @dinjas thank you for you answer, that&#39;s really helpful! what if i want to render on the same page, if there&#39;s anything i can do with that?"}, {"owner": {"reputation": 2007, "user_id": 716039, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76b302eed6a8add5db6b3f2e1c7c9942?s=128&d=identicon&r=PG", "display_name": "dinjas", "link": "https://stackoverflow.com/users/716039/dinjas"}, "edited": false, "score": 0, "creation_date": 1567094238, "post_id": 57695435, "comment_id": 101869838, "body": "I am not sure what you mean by &quot;render on the same page&quot;. You could add a condition, <code>&lt;% if @order.nil? %&gt;...&lt;% elsif @order.cancelled? %&gt;...</code>. Is that what you mean?"}], "answers": [{"tags": [], "owner": {"reputation": 2007, "user_id": 716039, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76b302eed6a8add5db6b3f2e1c7c9942?s=128&d=identicon&r=PG", "display_name": "dinjas", "link": "https://stackoverflow.com/users/716039/dinjas"}, "is_accepted": false, "score": 1, "last_activity_date": 1567009380, "creation_date": 1567009380, "answer_id": 57696577, "question_id": 57695435, "link": "https://stackoverflow.com/questions/57695435/redirect-or-render-the-page-if-order-is-nil/57696577#57696577", "title": "redirect or render the page if order is nil", "body": "<p>I'm not completely sure what you're trying to do, but...</p>\n\n<p>If you're wanting to render the <code>cancel</code> view when <code>@order</code> is present, and <code>redirect</code> otherwise, your controller action would look something like this:</p>\n\n<pre><code>def cancel\n  @order = Order.find_by(shopify_id: params[:id])\n\n  unless @order\n    flash[:alert] = 'Order not found'\n    redirect_to root_path # or wherever you want them to go if order doesn't exist\n  end\n\n  # render will happen automatically, is default behavior\nend\n</code></pre>\n\n<p>If you want to render a different view (with the same URL) if the order isn't found, you could do something like this:</p>\n\n<pre><code>def cancel\n  @order = Order.find_by(shopify_id: params[:id])\n\n  unless @order\n    flash.now[:alert] = 'Order not found'\n    render :new # render the new view with the cancel url\n  end\nend\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 11406245, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16fc1b844539d3afeb0d3afa7d35c912?s=128&d=identicon&r=PG&f=1", "display_name": "gina", "link": "https://stackoverflow.com/users/11406245/gina"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567009380, "creation_date": 1567004987, "last_edit_date": 1567005879, "question_id": 57695435, "link": "https://stackoverflow.com/questions/57695435/redirect-or-render-the-page-if-order-is-nil", "title": "redirect or render the page if order is nil", "body": "<p>I am trying to render if the order is not found. The page is not redirect and I get the error:</p>\n\n<blockquote>\n  <p>order not found, undefined method `shopify_name' for nil:NilClass.</p>\n</blockquote>\n\n<p>My view:</p>\n\n<pre><code>&lt;h1&gt;Cancel Your Order Here&lt;/h1&gt;\n\n &lt;h3 style=\"color: white;\"&gt;YOUR ORDER NUMBER IS &lt;%= @order.shopify_name %&gt;&lt;/h3&gt;\n        &lt;div id=\"multiple-file-preview\"&gt;\n          &lt;div class=\"card-body\"&gt;\n            &lt;% if @order.cancelled? %&gt;\n              &lt;h5&gt;YOUR ORDER HAS BEEN CANCELLED SUCCESSFULLY!&lt;/b&gt; &lt;br&gt;&lt;br&gt;Please contact our customer service for further information on &lt;b&gt;info@mrswordsmith.com&lt;/b&gt;&lt;/h5&gt;\n            &lt;% elsif @order.scheduled? %&gt;\n              &lt;%= link_to('Cancel',\n                order_path(@order.shopify_id), class: 'btn btn-danger',\n                  data: {\n                    disable_with: \"Order Cancelled\"\n                  }, method: :delete)\n                %&gt;\n            &lt;% else %&gt;\n              &lt;h5&gt;As you are attempting to cancel outside of the 2 hour cancellation window, please contact our customer support team&lt;/b&gt;&lt;/h5&gt;\n            &lt;% end %&gt;\n\n</code></pre>\n\n<p>my order controller</p>\n\n<pre><code> def cancel\n\n     @order = Order.where(shopify_id: params[:id]).first\n\n\n\n  end\n</code></pre>\n\n<p>When I attempted to change the order number in the url, it gave me an error saying:</p>\n\n<blockquote>\n  <p>`shopify_name' for nil:NilClass. i was wondering how to render on the\n  same page</p>\n</blockquote>\n"}, {"tags": ["ruby-on-rails", "ruby", "activemodel", "counter-cache"], "comments": [{"owner": {"reputation": 13378, "user_id": 1430810, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v669u.jpg?s=128&g=1", "display_name": "arieljuod", "link": "https://stackoverflow.com/users/1430810/arieljuod"}, "edited": false, "score": 0, "creation_date": 1567006703, "post_id": 57695349, "comment_id": 101836016, "body": "<code>destroy_all</code> invokes all callbacks (including updating counter cache columns), <code>delete_all</code> does not trigger any callback, you have to update the value of the counter cache column manually at the end though"}], "answers": [{"tags": [], "owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "is_accepted": true, "score": 0, "last_activity_date": 1567008901, "last_edit_date": 1567008901, "creation_date": 1567006724, "answer_id": 57695920, "question_id": 57695349, "link": "https://stackoverflow.com/questions/57695349/how-trigger-counter-cache-after-destroy-all/57695920#57695920", "title": "How trigger counter cache after destroy_all", "body": "<p>You can use <a href=\"https://api.rubyonrails.org/classes/ActiveRecord/Associations/CollectionProxy.html#method-i-delete_all\" rel=\"nofollow noreferrer\"><code>delete_all</code></a> which doesn't instantiate objects. Meaning callbacks aren't called. Then reset the cache with <a href=\"https://api.rubyonrails.org/classes/ActiveRecord/CounterCache/ClassMethods.html#method-i-reset_counters\" rel=\"nofollow noreferrer\"><code>reset_counters</code></a>.</p>\n\n<pre><code>ResearchParticipant.from_research(@research_id).delete_all\nResearch.reset_counters(@research_id, :research_participants)\n# assuming Research has_many :research_participants, counter_cache: :total_participants\n</code></pre>\n\n<p>If you depend on callbacks that must be triggered this might not be an option.</p>\n"}], "owner": {"reputation": 27, "user_id": 9502649, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a2ab484896b7d1f001b27e6f72245b2?s=128&d=identicon&r=PG&f=1", "display_name": "Eduardo", "link": "https://stackoverflow.com/users/9502649/eduardo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "accepted_answer_id": 57695920, "answer_count": 1, "score": 0, "last_activity_date": 1567008901, "creation_date": 1567004664, "question_id": 57695349, "link": "https://stackoverflow.com/questions/57695349/how-trigger-counter-cache-after-destroy-all", "title": "How trigger counter cache after destroy_all", "body": "<p>I have to destroy a big list of data, and update my counter cache, but when I user destroy_all counter cache is called at every delete. Is there any way to update my counter only after the destroy_all?</p>\n\n<p>I already tried ActiveModel Callbacks, but they are the same as destroy_all, called one time for each record.</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>  belongs_to :research, counter_cache: :total_participants\n</code></pre>\n\n<pre class=\"lang-rb prettyprint-override\"><code>  ResearchParticipant.from_research(@research_id).destroy_all\n</code></pre>\n"}, {"tags": ["ruby", "request", "net-http"], "answers": [{"comments": [{"owner": {"reputation": 2181, "user_id": 5598574, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/aUJPQ.jpg?s=128&g=1", "display_name": "Hairi", "link": "https://stackoverflow.com/users/5598574/hairi"}, "edited": false, "score": 0, "creation_date": 1567090626, "post_id": 57695153, "comment_id": 101867998, "body": "I changed the request headers litle bit. Still getting the warning:  <code>accept-encoding: gzip accept: text&#47;html,application&#47;xhtml+xml,application&#47;xml;q=0.9,image&#47;&zwnj;&#8203;webp,image&#47;apng,*&#47;*;&zwnj;&#8203;q=0.8,application&#47;si&zwnj;&#8203;gned-exchange;v=b3 user-agent: Mozilla&#47;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#47;537.36 (KHTML, like Gecko) Chrome&#47;76.0.3809.100 Safari&#47;537.3</code>"}], "tags": [], "owner": {"reputation": 2262, "user_id": 4101569, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15c4c64e58bc5cdeec8e7ce067131a54?s=128&d=identicon&r=PG", "display_name": "katafrakt", "link": "https://stackoverflow.com/users/4101569/katafrakt"}, "is_accepted": false, "score": 1, "last_activity_date": 1567003996, "creation_date": 1567003996, "answer_id": 57695153, "question_id": 57695029, "link": "https://stackoverflow.com/questions/57695029/ruby-nethttp-get-request-gives-different-response-than-with-browser/57695153#57695153", "title": "Ruby Net:Http get request gives different response than with Browser", "body": "<p>You were detected as a crawler (correctly, by the way). Note that those requests (from browser and the script) are not just the same. The browser sends some headers, such as accepted language, user agent etc. You can peek into it using web inspector tool in the browser. On the other side, in your script you only set <code>Accept</code> header (and to JSON, suspicious on its own, as browser would never do that). And you do not send any user agent. It's easy to see that this is an automates request, not natural traffic from the browser.</p>\n"}], "owner": {"reputation": 2181, "user_id": 5598574, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/aUJPQ.jpg?s=128&g=1", "display_name": "Hairi", "link": "https://stackoverflow.com/users/5598574/hairi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567003996, "creation_date": 1567003608, "question_id": 57695029, "link": "https://stackoverflow.com/questions/57695029/ruby-nethttp-get-request-gives-different-response-than-with-browser", "title": "Ruby Net:Http get request gives different response than with Browser", "body": "<p>I am trying to fetch from API server using <code>Net::HTTP</code>.</p>\n\n<pre><code>puts \"#{uri}\".green\nresponse = Net::HTTP.new('glassdoor.com').start { |http|\n  # always proxy via your.proxy.addr:8080\n  response =  http.get(uri,  {'Accept' =&gt; 'application/json'})\n  puts \"Res val: #{response.body}\".blue\n}\n</code></pre>\n\n<p>I got the <code>uri</code> from the console and pasted in the browser, and I received the JSON response. </p>\n\n<p>But using the Ruby <code>Net::HTTP</code> get I receive some security message:</p>\n\n<p><a href=\"https://i.stack.imgur.com/MXCbN.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/MXCbN.png\" alt=\"enter image description here\"></a></p>\n\n<p>Why the difference? The browser and the Ruby script are behind the same public IP. </p>\n"}, {"tags": ["ruby", "metaprogramming", "metaclass"], "comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1567000450, "post_id": 57693798, "comment_id": 101832233, "body": "I think (and someone correct me if I am wrong) the metaclass idiom is more like a module extension than an inheritance pattern e.g. <code>module One; def one; end; end</code> then <code>class Two; extend One; end</code> in this case <code>One</code> does not have a method <code>one</code> however via extension <code>Two</code> does. Thus <code>One.one #=&gt; NoMethodError</code> however <code>Two.one</code> works fine"}], "answers": [{"tags": [], "owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "is_accepted": false, "score": 0, "last_activity_date": 1567003659, "creation_date": 1567003659, "answer_id": 57695041, "question_id": 57693798, "link": "https://stackoverflow.com/questions/57693798/calling-singleton-class-methods-inside-open-singleton-class/57695041#57695041", "title": "Calling Singleton Class Methods Inside Open Singleton Class", "body": "<p>You made the wrong assumption about where the method belongs to, in the first place. The call to the instance method <code>one</code> from inside class context should not succeed. In your first snippet, you try to call method <code>one</code> from the singleton class of the singleton class of <code>One</code> (because it\u2019s called from <code>singleton_class</code> context).</p>\n\n<p>Example with normal class / instance methods to clarify:</p>\n\n<pre><code>class One\n  def self.one()\n    puts :class\n  end\n  def one\n    puts :instance\n  end\n  one()\nend\n#\u21d2 class\n</code></pre>\n\n<p>So, the expected behavior would be <em>to raise</em> <code>NameError</code>. Now the answer is simple: it raises <code>NameError</code> because this method does not exist.</p>\n"}, {"tags": [], "owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "is_accepted": false, "score": 2, "last_activity_date": 1567003739, "creation_date": 1567003739, "answer_id": 57695073, "question_id": 57693798, "link": "https://stackoverflow.com/questions/57693798/calling-singleton-class-methods-inside-open-singleton-class/57695073#57695073", "title": "Calling Singleton Class Methods Inside Open Singleton Class", "body": "<p>Your example is more confusing than it needs to be. It doesn't require a singleton class at all:</p>\n\n<pre><code>class Foo\n  def bar; end\n\n  bar # NameError\nend\n\nFoo.new.bar\n</code></pre>\n\n<p>Here, we have a class <code>Foo</code> with an instance method <code>bar</code>. A singleton class is still just a class, so this is actually the exact same example as yours.</p>\n\n<p><code>def</code> without an explicit definee defines an instance method of the closest lexically enclosing class definition, in this case <code>Foo</code>. A message send without an explicit receiver like <code>bar</code> sends the message to <code>self</code>. Inside the class definition body, <code>self</code> is the class itself.</p>\n\n<p>So, <code>def bar</code> defines an <em>instance method</em> in <code>Foo</code>, i.e. a method you can call on <em>instances</em> of <code>Foo</code>.</p>\n\n<p><code>bar</code> inside the class definition body sends a message to <code>self</code>, which is <code>Foo</code>. Since <code>Foo</code> is not an instance of itself, it does not have a method named <code>bar</code>, ergo, the method call fails.</p>\n\n<p>This works exactly the same with a singleton class, since it is still just a class.</p>\n"}], "owner": {"reputation": 995, "user_id": 1369906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fb52edeb9aeefc46f043311e6602a29?s=128&d=identicon&r=PG", "display_name": "Nomas Prime", "link": "https://stackoverflow.com/users/1369906/nomas-prime"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 1, "answer_count": 2, "score": 4, "last_activity_date": 1567003739, "creation_date": 1566999506, "last_edit_date": 1566999902, "question_id": 57693798, "link": "https://stackoverflow.com/questions/57693798/calling-singleton-class-methods-inside-open-singleton-class", "title": "Calling Singleton Class Methods Inside Open Singleton Class", "body": "<p>I'm trying to understand why I can't call methods defined on the singleton class from within the open class but I can from the actual class.</p>\n\n<p>Can someone explain why the first example fails and the second one doesn't?</p>\n\n<pre><code>class One\n  class &lt;&lt; self\n    def one; end\n    one\n  end\nend\n\nNameError (undefined local variable or method 'one' for #&lt;Class:One&gt;)\n\nclass Two\n  class &lt;&lt; self\n    def one; end\n  end\n\n  self.one\nend\n\n=&gt; nil\n</code></pre>\n"}, {"tags": ["ruby", "irb", "ruby-2.6"], "comments": [{"owner": {"reputation": 6122, "user_id": 946500, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fqdcn.jpg?s=128&g=1", "display_name": "Pavel Oganesyan", "link": "https://stackoverflow.com/users/946500/pavel-oganesyan"}, "edited": false, "score": 0, "creation_date": 1566996307, "post_id": 57692562, "comment_id": 101829635, "body": "<a href=\"https://stackoverflow.com/questions/4678732/how-to-suppress-rails-console-irb-outputs\" title=\"how to suppress rails console irb outputs\">stackoverflow.com/questions/4678732/&hellip;</a>"}, {"owner": {"reputation": 63078, "user_id": 220147, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b3881a28fe402dd2d1de44717486cae8?s=128&d=identicon&r=PG", "display_name": "Michael Kohl", "link": "https://stackoverflow.com/users/220147/michael-kohl"}, "edited": false, "score": 0, "creation_date": 1566998610, "post_id": 57692562, "comment_id": 101831038, "body": "Pry suppresses output when adding a <code>;</code> and generally offers some nice additions over <code>irb</code>."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1567001526, "post_id": 57692562, "comment_id": 101832899, "body": "You could also do this <code>out = $stdout and $stdout = File.open(File::NULL,&#39;w&#39;)</code> then when you are done just set <code>$stdout = out</code> to reset the output stream. This is essentially like piping to &quot;/dev/null&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 5060, "user_id": 10522579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7GQ6a.jpg?s=128&g=1", "display_name": "ray", "link": "https://stackoverflow.com/users/10522579/ray"}, "edited": false, "score": 0, "creation_date": 1566999416, "post_id": 57693036, "comment_id": 101831568, "body": "This will be applied for all possibilities"}, {"owner": {"reputation": 63, "user_id": 6941553, "user_type": "registered", "profile_image": "https://graph.facebook.com/1264893356888672/picture?type=large", "display_name": "Girish Bhanarkar", "link": "https://stackoverflow.com/users/6941553/girish-bhanarkar"}, "reply_to_user": {"reputation": 5060, "user_id": 10522579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7GQ6a.jpg?s=128&g=1", "display_name": "ray", "link": "https://stackoverflow.com/users/10522579/ray"}, "edited": false, "score": 0, "creation_date": 1567061190, "post_id": 57693036, "comment_id": 101851634, "body": "Not sure but I think it will."}, {"owner": {"reputation": 10377, "user_id": 2832282, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/ZJ4WG.jpg?s=128&g=1", "display_name": "Cyril Duchon-Doris", "link": "https://stackoverflow.com/users/2832282/cyril-duchon-doris"}, "edited": false, "score": 0, "creation_date": 1590621872, "post_id": 57693036, "comment_id": 109752770, "body": "this does not work ? I have edited my question to give an example of what happened in RUby 2.3 before I upgraded to Ruby 2.6"}], "tags": [], "owner": {"reputation": 63, "user_id": 6941553, "user_type": "registered", "profile_image": "https://graph.facebook.com/1264893356888672/picture?type=large", "display_name": "Girish Bhanarkar", "link": "https://stackoverflow.com/users/6941553/girish-bhanarkar"}, "is_accepted": false, "score": 4, "last_activity_date": 1566997195, "creation_date": 1566997195, "answer_id": 57693036, "question_id": 57692562, "link": "https://stackoverflow.com/questions/57692562/hide-the-output-of-a-command-using-ruby-2-6/57693036#57693036", "title": "Hide the output of a command using Ruby 2.6", "body": "<p>Run the below command in IRB terminal.</p>\n\n<pre><code>irb_context.echo = false\n</code></pre>\n"}], "owner": {"reputation": 10377, "user_id": 2832282, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/ZJ4WG.jpg?s=128&g=1", "display_name": "Cyril Duchon-Doris", "link": "https://stackoverflow.com/users/2832282/cyril-duchon-doris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1590621728, "creation_date": 1566995687, "last_edit_date": 1590621728, "question_id": 57692562, "link": "https://stackoverflow.com/questions/57692562/hide-the-output-of-a-command-using-ruby-2-6", "title": "Hide the output of a command using Ruby 2.6", "body": "<p>I am not sure this is a bug or a new feature of Ruby 2.6, but since performing the upgrade 2.3 --> 2.6, my IRB terminal does not behave as usual and cannot hide outputs anymore. Previously when I typed a semicolon, it would wait until receiving the next instruction without semicolon to run all the code and hide values with semicolons</p>\n\n<pre><code>2.6.3 :008 &gt; 1 + 1\n =&gt; 2\n2.6.3 :009 &gt; 1 + 1;\n =&gt; 2 \n2.6.3 :010 &gt; (1 + 1);\n =&gt; 2\n2.6.3 :011 &gt; very_large_inspect_result;\n =&gt; [console keeps printing for ages)\n</code></pre>\n\n<p>Using <code>ruby-2.6.3 [ x86_64 ]</code> and the IRB terminal from <code>rails-5.1.6</code></p>\n\n<p>What can I do to hide the output from commands ? The goal is to avoid printing huge strings of <code>inspect</code> when returning a very large collection</p>\n\n<p>EDIT : I could systematically add a 0 or something after the semicolons, but it feels cheap</p>\n\n<pre><code>2.6.3 :010 &gt; (1 + 1); 0\n =&gt; 0\n</code></pre>\n\n<p>EDIT2 : what happened previously in Ruby 2.3.x : </p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>irb(main):001:0&gt; puts 1;\nirb(main):002:0* puts 2;\nirb(main):003:0* puts 3\n1\n2\n3\n=&gt; nil\n</code></pre>\n"}, {"tags": ["ruby", "csv"], "comments": [{"owner": {"reputation": 2251, "user_id": 9785060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IUduC.png?s=128&g=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/9785060/viktor"}, "edited": false, "score": 0, "creation_date": 1566995179, "post_id": 57692113, "comment_id": 101828947, "body": "Are there rows with the same ID from multiple files? Can a row from file 1 have the same ID as a row from file 2 but different values in other columns ?"}, {"owner": {"reputation": 1306, "user_id": 608359, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/c0a271650b730177f18910b6503f07c3?s=128&d=identicon&r=PG", "display_name": "Douglas Lovell", "link": "https://stackoverflow.com/users/608359/douglas-lovell"}, "edited": false, "score": 0, "creation_date": 1566995268, "post_id": 57692113, "comment_id": 101829011, "body": "What do you use to decide which record to keep given matching date and id? Given the count and price values for Google US Rally on 8/27 in files two and three, for example, do you also preserve the higher count and price value, or do you overwrite such that last file processed wins? Do you need to apply the files in sequence, so that you treat matched date / id as an update, or is there some other rule?"}, {"owner": {"reputation": 3959, "user_id": 1381266, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/7ac54c032c1dd24a5e6c737d06b83a03?s=128&d=identicon&r=PG", "display_name": "Galet", "link": "https://stackoverflow.com/users/1381266/galet"}, "reply_to_user": {"reputation": 2251, "user_id": 9785060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IUduC.png?s=128&g=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/9785060/viktor"}, "edited": false, "score": 0, "creation_date": 1566995358, "post_id": 57692113, "comment_id": 101829063, "body": "@\u0412\u0438\u043a\u0442\u043e\u0440 Yes for both questions."}, {"owner": {"reputation": 2251, "user_id": 9785060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IUduC.png?s=128&g=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/9785060/viktor"}, "edited": false, "score": 0, "creation_date": 1566995481, "post_id": 57692113, "comment_id": 101829139, "body": "So you want to merge 3 csv-s and only remove those rows that have all columns equal ?"}, {"owner": {"reputation": 3959, "user_id": 1381266, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/7ac54c032c1dd24a5e6c737d06b83a03?s=128&d=identicon&r=PG", "display_name": "Galet", "link": "https://stackoverflow.com/users/1381266/galet"}, "reply_to_user": {"reputation": 1306, "user_id": 608359, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/c0a271650b730177f18910b6503f07c3?s=128&d=identicon&r=PG", "display_name": "Douglas Lovell", "link": "https://stackoverflow.com/users/608359/douglas-lovell"}, "edited": false, "score": 0, "creation_date": 1566995493, "post_id": 57692113, "comment_id": 101829149, "body": "@DouglasLovell I want to overwirte such that last file processed wins. Yes I need to apply the file in sequence using the filename."}, {"owner": {"reputation": 3959, "user_id": 1381266, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/7ac54c032c1dd24a5e6c737d06b83a03?s=128&d=identicon&r=PG", "display_name": "Galet", "link": "https://stackoverflow.com/users/1381266/galet"}, "reply_to_user": {"reputation": 2251, "user_id": 9785060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IUduC.png?s=128&g=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/9785060/viktor"}, "edited": false, "score": 0, "creation_date": 1566995607, "post_id": 57692113, "comment_id": 101829214, "body": "@\u0412\u0438\u043a\u0442\u043e\u0440 3 csv-s is sample merge. Originally I want to merge more than 100 files. Not all columns equal. Only ID and Name"}, {"owner": {"reputation": 2251, "user_id": 9785060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IUduC.png?s=128&g=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/9785060/viktor"}, "edited": false, "score": 0, "creation_date": 1566996755, "post_id": 57692113, "comment_id": 101829895, "body": "You don&#39;t have to overwrite files, just iterate over them in reverse order and don&#39;t add any new entries if a same id/name pair exists. Can you provide a download link to the the 3 csv sample files in your question?"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 1, "creation_date": 1567003047, "post_id": 57692113, "comment_id": 101833880, "body": "Please clarify your question by editing it rather than expecting readers to figure out what you are trying to do by studying the comments."}], "answers": [{"comments": [{"owner": {"reputation": 3959, "user_id": 1381266, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/7ac54c032c1dd24a5e6c737d06b83a03?s=128&d=identicon&r=PG", "display_name": "Galet", "link": "https://stackoverflow.com/users/1381266/galet"}, "edited": false, "score": 0, "creation_date": 1568970194, "post_id": 57698445, "comment_id": 102452679, "body": "I am processing more files using the above approach. Some files have columns order changed. How can I make it work if columns order changed too?"}, {"owner": {"reputation": 3959, "user_id": 1381266, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/7ac54c032c1dd24a5e6c737d06b83a03?s=128&d=identicon&r=PG", "display_name": "Galet", "link": "https://stackoverflow.com/users/1381266/galet"}, "edited": false, "score": 0, "creation_date": 1568976813, "post_id": 57698445, "comment_id": 102456185, "body": "I found it. Here is the one &quot;end.values.each { |row| csv_out &lt;&lt; row.values_at(*(csv_out.headers)) }&quot; which do what i need"}], "tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": true, "score": 1, "last_activity_date": 1567058649, "last_edit_date": 1567058649, "creation_date": 1567018108, "answer_id": 57698445, "question_id": 57692113, "link": "https://stackoverflow.com/questions/57692113/how-to-merge-multiple-csv-files-into-one-with-unique-columns-in-rails/57698445#57698445", "title": "How to merge multiple csv files into one with unique columns in Rails", "body": "<p><strong>Code</strong></p>\n\n<pre><code>require 'csv'\n\ndef doit(*csv_input_files, csv_output_file)\n  CSV.open(csv_output_file, \"wb\", headers: true) do |csv_out|\n    csv_out &lt;&lt; CSV.open(csv_input_files.first, &amp;:readline)\n    csv_input_files.each_with_object({}) do |f,h|\n      CSV.read(f, headers: true).each do |csv|\n        h[[csv['Date'], csv['ID']]] = csv\n      end\n    end.values.each { |row| csv_out &lt;&lt; row }\n  end\nend\n</code></pre>\n\n<p><strong>Example</strong></p>\n\n<pre><code>F1   = 'f1.csv'\nF2   = 'f2.csv'\nF3   = 'f3.csv'\n</code></pre>\n\n<h1><p></p></h1>\n\n<pre><code>File.write(F1, &lt;&lt;~END)\nDate,ID,Name,Count,Price\n2019-08-25,110146,Amazon In-App,1,23\n2019-08-25,121615,Google US Rally,0,0\n2019-08-25,208442,Google Rewarded US,47,12\n2019-08-26,110146,Amazon In-App,10,40\n2019-08-26,121615,Google US Rally,0,0\n2019-08-26,208442,Google Rewarded US,0,0\nEND\n  #=&gt; 260\n</code></pre>\n\n<h1><p></p></h1>\n\n<pre><code>File.write(F2, &lt;&lt;~END)\nDate,ID,Name,Count,Price\n2019-08-26,110146,Amazon In-App,30,90\n2019-08-26,121615,Google US Rally,5,25\n2019-08-26,208442,Google Rewarded US,15,45\n2019-08-27,110146,Amazon In-App,5,15\n2019-08-27,121615,Google US Rally,10,40\n2019-08-27,208442,Google Rewarded US,0,0\nEND\n  #=&gt; 263\n</code></pre>\n\n<h1><p></p></h1>\n\n<pre><code>File.write(F3, &lt;&lt;~END)\nDate,ID,Name,Count,Price\n2019-08-27,110146,Amazon In-App,30,70\n2019-08-27,121615,Google US Rally,12,50\n2019-08-27,208442,Google Rewarded US,15,45\n2019-08-28,110146,Amazon In-App,15,55\n2019-08-28,121615,Google US Rally,20,60\n2019-08-28,208442,Google Rewarded US,0,0\nEND\n  #=&gt; 265\n</code></pre>\n\n<h1><p></p></h1>\n\n<pre><code>Fout = 'fout.csv'\n</code></pre>\n\n<h1><p></p></h1>\n\n<pre><code>doit(F1, F2, F3, Fout)\n</code></pre>\n\n<h1><p></p></h1>\n\n<pre><code>puts File.read(Fout)\nDate,ID,Name,Count,Price\n2019-08-25,110146,Amazon In-App,1,23\n2019-08-25,121615,Google US Rally,0,0\n2019-08-25,208442,Google Rewarded US,47,12\n2019-08-26,110146,Amazon In-App,30,90\n2019-08-26,121615,Google US Rally,5,25\n2019-08-26,208442,Google Rewarded US,15,45\n2019-08-27,110146,Amazon In-App,30,70\n2019-08-27,121615,Google US Rally,12,50\n2019-08-27,208442,Google Rewarded US,15,45\n2019-08-28,110146,Amazon In-App,15,55\n2019-08-28,121615,Google US Rally,20,60\n2019-08-28,208442,Google Rewarded US,0,0\n</code></pre>\n\n<p>See <a href=\"https://ruby-doc.org/stdlib-2.6.3/libdoc/csv/rdoc/CSV.html#method-c-open\" rel=\"nofollow noreferrer\">CSV::open</a>, <a href=\"https://ruby-doc.org/stdlib-2.6.3/libdoc/csv/rdoc/CSV.html#method-c-read\" rel=\"nofollow noreferrer\">CSV::read</a>, <a href=\"https://ruby-doc.org/core-2.6.3/File.html#method-c-new\" rel=\"nofollow noreferrer\">File::new</a>, <a href=\"https://ruby-doc.org/core-2.6.3/IO.html#method-i-gets\" rel=\"nofollow noreferrer\">IO#gets</a> and <a href=\"https://ruby-doc.org/core-2.6.3/Hash.html#method-i-values\" rel=\"nofollow noreferrer\">Hash#values</a>. <a href=\"https://technicalpickles.com/posts/parsing-csv-with-ruby\" rel=\"nofollow noreferrer\">This article</a> on working with CSV files may be of interest.</p>\n"}], "owner": {"reputation": 3959, "user_id": 1381266, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/7ac54c032c1dd24a5e6c737d06b83a03?s=128&d=identicon&r=PG", "display_name": "Galet", "link": "https://stackoverflow.com/users/1381266/galet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 57698445, "answer_count": 1, "score": 0, "last_activity_date": 1567058649, "creation_date": 1566994262, "last_edit_date": 1566994987, "question_id": 57692113, "link": "https://stackoverflow.com/questions/57692113/how-to-merge-multiple-csv-files-into-one-with-unique-columns-in-rails", "title": "How to merge multiple csv files into one with unique columns in Rails", "body": "<p>I have multiple csv files in S3, I want to merge those files into one with removal of duplicates based on columns.</p>\n\n<p>file1:</p>\n\n<pre><code>Date            ID     Name                 Count  Price\n2019-08-25    110146  Amazon In-App           1    23\n2019-08-25    121615  Google US Rally         0    0\n2019-08-25    208442  Google Rewarded US      47   12\n2019-08-26    110146  Amazon In-App           10   40\n2019-08-26    121615  Google US Rally         0    0\n2019-08-26    208442  Google Rewarded US      0   0\n</code></pre>\n\n<p>file2:</p>\n\n<pre><code>Date            ID     Name                 Count  Price\n2019-08-26    110146  Amazon In-App           30    90\n2019-08-26    121615  Google US Rally         5    25\n2019-08-26    208442  Google Rewarded US      15   45\n2019-08-27    110146  Amazon In-App           5    15\n2019-08-27    121615  Google US Rally         10    40\n2019-08-27    208442  Google Rewarded US      0   0\n</code></pre>\n\n<p>file3:</p>\n\n<pre><code>Date            ID     Name                 Count  Price\n2019-08-27    110146  Amazon In-App           30    70\n2019-08-27    121615  Google US Rally         12    50\n2019-08-27    208442  Google Rewarded US      15   45\n2019-08-28    110146  Amazon In-App           15    55\n2019-08-28    121615  Google US Rally         20    60\n2019-08-28    208442  Google Rewarded US      0   0\n</code></pre>\n\n<p>Below are the sample files. I want to merge the above files with unique columns such as ID and Name.</p>\n\n<p>My Expected Output:</p>\n\n<p>final_output_file:</p>\n\n<pre><code>Date            ID     Name                 Count  Price\n2019-08-25    110146  Amazon In-App           1    23\n2019-08-25    121615  Google US Rally         0    0\n2019-08-25    208442  Google Rewarded US      47   12\n2019-08-26    110146  Amazon In-App           30    90\n2019-08-26    121615  Google US Rally         5    25\n2019-08-26    208442  Google Rewarded US      15   45\n2019-08-27    110146  Amazon In-App           30    70\n2019-08-27    121615  Google US Rally         12    50\n2019-08-27    208442  Google Rewarded US      15   45\n2019-08-28    110146  Amazon In-App           15    55\n2019-08-28    121615  Google US Rally         20    60\n2019-08-28    208442  Google Rewarded US      0   0\n</code></pre>\n\n<p>How to achieve it using ruby?</p>\n\n<p>I have tried the following approach and matches all columns and it doesn't satisfy my need.</p>\n\n<pre><code>require 'set'\nunique = Set.new\nDir.glob('revenue_report_*.csv') do |f|\n  File.foreach(f) { |l| unique &lt;&lt; l }\nend\nFile.write('unique.csv', unique.sort.join)\n</code></pre>\n"}, {"tags": ["ruby"], "answers": [{"tags": [], "owner": {"reputation": 299, "user_id": 3251036, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b88d9e964e6d6500c8d511cde831486?s=128&d=identicon&r=PG&f=1", "display_name": "sammygadd", "link": "https://stackoverflow.com/users/3251036/sammygadd"}, "is_accepted": false, "score": 0, "last_activity_date": 1566995423, "creation_date": 1566995423, "answer_id": 57692485, "question_id": 57692064, "link": "https://stackoverflow.com/questions/57692064/keep-score-method-for-tic-tac-toe-is-not-updating-score-variables-properly/57692485#57692485", "title": "Keep Score method for tic tac toe is not updating score variables properly", "body": "<p>When you pass in <code>player_score</code> and <code>computer_score</code> into the <code>game_score</code> method, then you get new variables that are scoped to that method. They are not the same as your global variables that you declare at the top.<br>\nMay I suggest that you try to write some classes that encapsulates the proper abstractions (like game, board, score etc). I think that would make it easier to figure out how you should save your state.</p>\n"}], "owner": {"reputation": 1, "user_id": 11989046, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mDnCzfOVqbpOugUGneDPLBP52Gn2qa0G6uXxLFV=k-s128", "display_name": "Matt", "link": "https://stackoverflow.com/users/11989046/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 31, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1566995423, "creation_date": 1566994068, "question_id": 57692064, "link": "https://stackoverflow.com/questions/57692064/keep-score-method-for-tic-tac-toe-is-not-updating-score-variables-properly", "title": "Keep Score method for tic tac toe is not updating score variables properly", "body": "<p>I am currently adding a 'keep score' method to the below tic tac toe game. The method game_score works insofar as it increments after the game, but always resets back to 0. </p>\n\n<p>I think the problem is something very simple, and there are similar questions already answered but I couldn't apply them to my code. </p>\n\n<p>I would appreciate any help.</p>\n\n<p>Thanks.</p>\n\n<pre><code>INITIAL_MARKER = ' '\nPLAYER_MARKER = 'X'\nCOMPUTER_MARKER = 'O'\nplayer_score = 0\ncomputer_score = 0\n\ndef prompt(msg)\n  puts \"=&gt;#{msg}\"\nend  \n\ndef display_board(brd)\n  system 'clear'\n  puts \"You're a #{PLAYER_MARKER} Computer is #{COMPUTER_MARKER}\"\n  puts \"\"\n  puts\"     |     |\"\n  puts\"  #{brd[1]}  |  #{brd[2]}  |    #{brd[3]}\"\n  puts\"     |     |\"\n  puts\"-----+-----+-----\"\n  puts\"     |     |\"\n  puts\"  #{brd[4]}  |  #{brd[5]}  |    #{brd[6]}\"\n  puts\"     |     |\"\n  puts\"-----+-----+-----\"\n  puts\"     |     |\"\n  puts\"  #{brd[7]}  |  #{brd[8]}  |    #{brd[9]}\"   \n  puts\"     |     |\"\nend\n\ndef initialize_board\n   new_board = {}\n   (1..9).each {|num| new_board[num] = INITIAL_MARKER}\n   new_board\nend\n\ndef empty_squares(brd)\n  brd.keys.select{|num| brd[num] == INITIAL_MARKER}\nend\n\ndef player_places_piece!(brd)\n  square = INITIAL_MARKER\n  loop do\n    prompt (\"Choose a square (#{empty_squares(brd).join(',')})\")\n    square = gets.chomp.to_i\n    break if empty_squares(brd).include?(square)\n     prompt \"Sorry, that's not a valid choice.\"\n    end\n    brd[square] = PLAYER_MARKER\n  end\n\ndef computer_places_piece(brd)\n  square = empty_squares(brd).sample\n  brd[square] = COMPUTER_MARKER\nend\n\ndef board_full(brd)\n  empty_squares(brd).empty?\nend\n\ndef someone_won?(brd)\n  !!detect_winner(brd)\nend\n\ndef detect_winner(brd)\n\n  #computer_score =\n  winning_lines = [[1,2,3],[4,5,6],[7,8,9]] +\n                  [[1,4,7],[2,5,8],[3,6,9]] +\n                  [[1,5,9],[3,5,7]]\n  winning_lines.each do |line|\n    if brd[line[0]] == PLAYER_MARKER &amp;&amp; \n       brd[line[1]] == PLAYER_MARKER &amp;&amp;\n       brd[line[2]] == PLAYER_MARKER \n        return 'Player'\n        player_score += 1\n\n    elsif \n       brd[line[0]] ==  COMPUTER_MARKER &amp;&amp; \n       brd[line[1]] == COMPUTER_MARKER &amp;&amp;\n       brd[line[2]] == COMPUTER_MARKER \n        return 'Computer'\n        computer_score += 1\n    else\n\n    end\n  end\n  nil\nend \n\ndef game_score (player_score, computer_score, board)\n  player_score += 1 if detect_winner(board) == 'Player'\n  computer_score += 1 if detect_winner(board) == 'Computer'\n  prompt(\"Player Score is: #{player_score}\")\n  prompt(\"Computer Score is: #{computer_score}\")\nend\n\n\nloop do \n  board = initialize_board\n\n  loop do\n    display_board(board)\n\n    player_places_piece!(board)\n    break if someone_won?(board) || board_full(board)\n    display_board(board)\n\n    computer_places_piece(board)\n    display_board(board)\n    break if someone_won?(board) || board_full(board)\n  end\n\n  if someone_won?(board)\n    prompt \"#{detect_winner(board)} won!\"\n\n\n\n    #player_score += 1 if detect_winner(board)== 'Player'\n    #computer_score += 1 if detect_winner(board)== 'Computer'\n    #display(\"Player Score: #{player_score}\")\n    #display(\"Computer Score: #{computer_score}\")\n\n  else\n    prompt \"It's a tie!\"\n  end\n\n game_score(player_score, computer_score, board) \n binding pry\n  prompt(\"would you like to play again?\")\n  input = gets.chomp\n  break unless input == 'y'\nend\nprompt(\"bye\")\n</code></pre>\n"}, {"tags": ["regex", "ruby", "gsub", "string-substitution"], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 9653283, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68f3f081f3771f67f15c33996611befb?s=128&d=identicon&r=PG&f=1", "display_name": "Banjo", "link": "https://stackoverflow.com/users/9653283/banjo"}, "edited": false, "score": 1, "creation_date": 1566994552, "post_id": 57691787, "comment_id": 101828572, "body": "Thanks @Wiktor Stribi\u017cew   Could you please elaborate &quot;(?=\\|)&quot;. Why is it not added to the match value"}, {"owner": {"reputation": 481662, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "reply_to_user": {"reputation": 81, "user_id": 9653283, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68f3f081f3771f67f15c33996611befb?s=128&d=identicon&r=PG&f=1", "display_name": "Banjo", "link": "https://stackoverflow.com/users/9653283/banjo"}, "edited": false, "score": 0, "creation_date": 1567064221, "post_id": 57691787, "comment_id": 101853048, "body": "@Navi <i>it is not added to the match value since it is a positive lookahead that does not consume text</i> -  &quot;<i>lookaround actually matches characters, but then gives up the match, returning only the result: match or no match. That is why they are called &quot;assertions&quot;. They do not consume characters in the string, but only assert whether a match is possible or not.</i>&quot;, see more about <a href=\"https://www.regular-expressions.info/lookaround.html\" rel=\"nofollow noreferrer\">lookaheads</a>."}], "tags": [], "owner": {"reputation": 481662, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 2, "last_activity_date": 1566993119, "creation_date": 1566993119, "answer_id": 57691787, "question_id": 57691698, "link": "https://stackoverflow.com/questions/57691698/how-to-use-ruby-gsub-with-regex-to-do-partial-string-substitution/57691787#57691787", "title": "How to use Ruby gsub with regex to do partial string substitution", "body": "<p>You may replace the first occurrence of 8 digits inside pipes if a string starts with <code>H</code> using</p>\n\n<pre><code>s = \"H||CUSTCHQH2H||PHPCCIPHP|1010032000|28092017|25001853||||\"\np s.gsub(/\\A(H.*?\\|)[0-9]{8}(?=\\|)/, '\\100000000')\n# or\np s.gsub(/\\AH.*?\\|\\K[0-9]{8}(?=\\|)/, '00000000')\n</code></pre>\n\n<p>See the <a href=\"https://ideone.com/UNuvPB\" rel=\"nofollow noreferrer\">Ruby demo</a>. Here, the value is replaced with 8 zeros.</p>\n\n<p><strong>Pattern details</strong></p>\n\n<ul>\n<li><code>\\A</code> - start of string (<code>^</code> is the start of a line in Ruby)</li>\n<li><code>(H.*?\\|)</code> - Capturing group 1 (you do not need it when using the variation with <code>\\K</code>): <code>H</code> and then any 0+ chars as few as possible</li>\n<li><code>\\K</code> - match reset operator that discards the text matched so far</li>\n<li><code>[0-9]{8}</code> - eight digits</li>\n<li><code>(?=\\|)</code> - the next char must be <code>|</code>, but it is not added to the match value since it is a positive lookahead that does not consume text.</li>\n</ul>\n\n<p>The <code>\\1</code> in the first <code>gsub</code> is a <em>replacement backreference</em> to the value in Group 1.</p>\n"}], "owner": {"reputation": 81, "user_id": 9653283, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68f3f081f3771f67f15c33996611befb?s=128&d=identicon&r=PG&f=1", "display_name": "Banjo", "link": "https://stackoverflow.com/users/9653283/banjo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 57691787, "answer_count": 1, "score": 1, "last_activity_date": 1566993119, "creation_date": 1566992810, "question_id": 57691698, "link": "https://stackoverflow.com/questions/57691698/how-to-use-ruby-gsub-with-regex-to-do-partial-string-substitution", "title": "How to use Ruby gsub with regex to do partial string substitution", "body": "<p>I have a pipe delimited file which has a line </p>\n\n<pre><code>H||CUSTCHQH2H||PHPCCIPHP|1010032000|28092017|25001853||||\n</code></pre>\n\n<p>I want to substitute the date (28092017) with a regex \"[0-9]{8}\" if the first character is \"H\"</p>\n\n<p>I tried the following example to test my understanding where Im trying to subtitute \"a\" with \"i\".</p>\n\n<pre><code>str = \"|123||a|\"\nstr.gsub /\\|(.*?)\\|(.*?)\\|(.*?)\\|/, \"\\|\\\\1\\|\\|\\\\1\\|i\\|\"\n\n</code></pre>\n\n<p>But this is giving o/p as \n<code>\n\"|123||123|i|\"\n</code></p>\n\n<p>Any clue how this can be achieved?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "devise"], "answers": [{"comments": [{"owner": {"reputation": 34, "user_id": 2226653, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/78cf12ddf9d6ac72738374643c135e14?s=128&d=identicon&r=PG", "display_name": "JohnSmith1976", "link": "https://stackoverflow.com/users/2226653/johnsmith1976"}, "edited": false, "score": 0, "creation_date": 1567000856, "post_id": 57693989, "comment_id": 101832467, "body": "interesting approach. However, since the user isn&#39;t loaded by me, but rather by the devise gem it&#39;s not easy to  set <code>@user.virtual_attribute_name_here = &quot;Some thing&quot;</code>. If I found that the <code>@user</code> (or <code>resource</code> as devise calls it) is being set in the same method across devise controllers I could override it, but I&#39;m having a hard time determining where devise loads the user."}, {"owner": {"reputation": 3997, "user_id": 3998420, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/55ea542584d3fd2a430c3d409bdafc95?s=128&d=identicon&r=PG&f=1", "display_name": "bkunzi01", "link": "https://stackoverflow.com/users/3998420/bkunzi01"}, "reply_to_user": {"reputation": 34, "user_id": 2226653, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/78cf12ddf9d6ac72738374643c135e14?s=128&d=identicon&r=PG", "display_name": "JohnSmith1976", "link": "https://stackoverflow.com/users/2226653/johnsmith1976"}, "edited": false, "score": 0, "creation_date": 1567002983, "post_id": 57693989, "comment_id": 101833836, "body": "If you&#39;re worried about the user that&#39;s set by Devise then just use that for the virtual attribute by doing current_user.virtual_attribute_name_here = &quot;Some thing&quot;    Once you&#39;ve edited the Devise controller to go through your controller you can set the User however you like and dont need to reconfigure all devise controllers that may touch it."}, {"owner": {"reputation": 34, "user_id": 2226653, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/78cf12ddf9d6ac72738374643c135e14?s=128&d=identicon&r=PG", "display_name": "JohnSmith1976", "link": "https://stackoverflow.com/users/2226653/johnsmith1976"}, "edited": false, "score": 1, "creation_date": 1567003905, "post_id": 57693989, "comment_id": 101834355, "body": "Thanks for you input @bkunzi01. You&#39;re right, I just need to find a place to inject myself in the process and set a virtual attribute for <code>current_user</code>. But where to do that? It&#39;s not that obvious because the user is loaded somewhere in the middle. I can&#39;t override the initial method (like <code>create</code> or <code>update</code>) and then call <code>super</code> (as exemplified in the bottom of my question). Because at that point the user is not loaded yet. So I need to inject myself somewhere after the initial controller method, but before the model gets involved."}], "tags": [], "owner": {"reputation": 3997, "user_id": 3998420, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/55ea542584d3fd2a430c3d409bdafc95?s=128&d=identicon&r=PG&f=1", "display_name": "bkunzi01", "link": "https://stackoverflow.com/users/3998420/bkunzi01"}, "is_accepted": false, "score": 1, "last_activity_date": 1567000091, "creation_date": 1567000091, "answer_id": 57693989, "question_id": 57691246, "link": "https://stackoverflow.com/questions/57691246/pass-a-variable-from-controller-to-model-without-using-instance-variables-or-arg/57693989#57693989", "title": "Pass a variable from controller to model without using instance variables or arguments?", "body": "<p>The cleanest way to pass something from your controller to your model is by adding a virtual attribute to your model class:</p>\n\n<p>In your models/User.rb file near the top put:</p>\n\n<pre><code>attr_accessor :virtual_attribute_name_here\n</code></pre>\n\n<p>Then, in your controller you can set that attribute to whatever you like as though it was an Active Record attribute:</p>\n\n<pre><code>@user.virtual_attribute_name_here = \"Some thing\"\n</code></pre>\n\n<p>Then in your model you can access it in your method as:</p>\n\n<pre><code> def send_devise_notification(notification, *args)\n   if self.virtual_attribute_name_here == 'Some thing'\n     # I do lots of crazy stuff here...\n   end\n end\n</code></pre>\n"}], "owner": {"reputation": 34, "user_id": 2226653, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/78cf12ddf9d6ac72738374643c135e14?s=128&d=identicon&r=PG", "display_name": "JohnSmith1976", "link": "https://stackoverflow.com/users/2226653/johnsmith1976"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567000091, "creation_date": 1566991306, "question_id": 57691246, "link": "https://stackoverflow.com/questions/57691246/pass-a-variable-from-controller-to-model-without-using-instance-variables-or-arg", "title": "Pass a variable from controller to model without using instance variables or arguments?", "body": "<p>I have overridden the Devise method <code>send_devise_notification</code> to be able to send out emails my own way:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>class User\n  include Mongoid::Document\n  devise :confirmable, :database_authenticatable, :registerable,\n         :recoverable, :rememberable, :trackable, :validatable, :lockable\n\n  protected\n\n    def send_devise_notification(notification, *args)\n      # I do lots of crazy stuff here...\n    end\nend\n</code></pre>\n\n<p>My problem is that I need to pass a variable from my devise controllers to this method in my user model.</p>\n\n<p>If I wanted to share this variable with another method in my controller I would simply set an instance variable:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>class ConfirmationsController &lt; Devise::ConfirmationsController\n\n  def create\n    @foo = \"bar\"\n    super\n  end\nend\n</code></pre>\n\n<p>But since instance variables are not passed from my controller to my model this approach will not work.</p>\n\n<p>And since the <code>send_devise_notification</code> method is called from all sorts of places by the devise gem I think it could become very complicated to pass it along through arguments.</p>\n\n<p>So how do I pass my variable from controller to model?</p>\n"}, {"tags": ["ruby", "bash"], "answers": [{"comments": [{"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 2, "creation_date": 1566992356, "post_id": 57691449, "comment_id": 101827315, "body": "You need to accept the correct answer instead of posting the same in the first place."}], "tags": [], "owner": {"reputation": 322, "user_id": 11202401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65f1bc1618a8c991d151d6cf49252e3b?s=128&d=identicon&r=PG&f=1", "display_name": "nt95", "link": "https://stackoverflow.com/users/11202401/nt95"}, "is_accepted": true, "score": -2, "last_activity_date": 1596126218, "last_edit_date": 1596126218, "creation_date": 1566991999, "answer_id": 57691449, "question_id": 57691185, "link": "https://stackoverflow.com/questions/57691185/pass-variable-from-bash-script-to-ruby-script/57691449#57691449", "title": "Pass variable from bash script to ruby script", "body": "<p>I needed to pass the variables in as:</p>\n<pre><code>ruby ./myScript.rb ${var1} ${var2} ${var3} ${var4}\n</code></pre>\n<p>using quotations did not work for me</p>\n"}, {"tags": [], "owner": {"reputation": 3558, "user_id": 2559490, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/20wjg.jpg?s=128&g=1", "display_name": "Hardik", "link": "https://stackoverflow.com/users/2559490/hardik"}, "is_accepted": false, "score": -2, "last_activity_date": 1566992640, "last_edit_date": 1566992640, "creation_date": 1566992017, "answer_id": 57691454, "question_id": 57691185, "link": "https://stackoverflow.com/questions/57691185/pass-variable-from-bash-script-to-ruby-script/57691454#57691454", "title": "Pass variable from bash script to ruby script", "body": "<p>try this</p>\n\n<p><code>ruby ./myScript.rb \"$var1\" \"$var2\" \"$var3\" \"$var4\"</code></p>\n\n<p>Passing as <code>var1</code> doesn't pass the variable value, to pass value stored in variable we use <code>$</code> in bash.</p>\n"}], "owner": {"reputation": 322, "user_id": 11202401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65f1bc1618a8c991d151d6cf49252e3b?s=128&d=identicon&r=PG&f=1", "display_name": "nt95", "link": "https://stackoverflow.com/users/11202401/nt95"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 0, "accepted_answer_id": 57691449, "answer_count": 2, "score": 2, "last_activity_date": 1596126218, "creation_date": 1566991153, "question_id": 57691185, "link": "https://stackoverflow.com/questions/57691185/pass-variable-from-bash-script-to-ruby-script", "title": "Pass variable from bash script to ruby script", "body": "<p>I have a bash script that executes a ruby script. It passes in 4 variables to the ruby script. However, the ruby script is not accessing these variables but instead using the variable name as if it was the value.</p>\n\n<p>In my bash script I define 4 variables eg </p>\n\n<pre><code>var1 = \"some string\"\nvar2 = \"another string\"\nvar3 = \"string 3\"\nvar4 = \"string 4\"\n</code></pre>\n\n<p>and call the ruby script with </p>\n\n<pre><code>ruby ./myScript.rb var1 var2 var3 var4\n</code></pre>\n\n<p>in ruby script I access as ARGV[0], ARGV[1], ARGV[2], ARGV[3]\nhowever, the ruby script does not get \"some string\" but instead \"var1\" etc</p>\n\n<p>how can I pass these variables correctly?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "activerecord"], "answers": [{"comments": [{"owner": {"reputation": 279, "user_id": 3531954, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35bf3b3f78e7d5c3006f57cfaa279460?s=128&d=identicon&r=PG&f=1", "display_name": "Lasse Kliemann", "link": "https://stackoverflow.com/users/3531954/lasse-kliemann"}, "edited": false, "score": 0, "creation_date": 1566991572, "post_id": 57690341, "comment_id": 101826883, "body": "I see. What may be confusing, so I point it out here: <i>validation</i> does indeed seem to happen based on the values returned by the getters. If I add <code>validates &quot;name&quot;, presence: true</code>, then <code>User.create().valid?</code> will still be true; it becomes false when I remove the custom getter."}, {"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "reply_to_user": {"reputation": 279, "user_id": 3531954, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35bf3b3f78e7d5c3006f57cfaa279460?s=128&d=identicon&r=PG&f=1", "display_name": "Lasse Kliemann", "link": "https://stackoverflow.com/users/3531954/lasse-kliemann"}, "edited": false, "score": 1, "creation_date": 1566991631, "post_id": 57690341, "comment_id": 101826904, "body": "Well, yes. <code>valid?</code> is a Ruby function, operating on a Ruby object, without touching SQL. <code>find</code> is just a bit of magic to translate your Ruby requests to SQL ones, and SQL results to Ruby ones - the search itself happens outside Ruby."}], "tags": [], "owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "is_accepted": false, "score": 2, "last_activity_date": 1566988191, "creation_date": 1566988191, "answer_id": 57690341, "question_id": 57690307, "link": "https://stackoverflow.com/questions/57690307/activerecord-find-by-oblivious-to-custom-getter/57690341#57690341", "title": "ActiveRecord: find_by oblivious to custom getter", "body": "<p>ActiveRecord is an interface to a <em>database</em> - all queries are converted to SQL. <code>User.find_by(\"name\" =&gt; \"foo\")</code> executes <code>SELECT * FROM users WHERE name = 'foo'</code>, then wraps results in a Ruby <code>User</code> object.</p>\n\n<p>Your database is not aware of getters. To use a getter, you have to have a Ruby object first - which means you would need to retrieve <em>all</em> objects from your table, then use <code>.select</code> to filter the results in Ruby.</p>\n"}, {"comments": [{"owner": {"reputation": 279, "user_id": 3531954, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35bf3b3f78e7d5c3006f57cfaa279460?s=128&d=identicon&r=PG&f=1", "display_name": "Lasse Kliemann", "link": "https://stackoverflow.com/users/3531954/lasse-kliemann"}, "edited": false, "score": 0, "creation_date": 1566988970, "post_id": 57690383, "comment_id": 101825555, "body": "Thanks. In my real application, the situation is more complicated. The &quot;default&quot; value depends on <code>id</code>, say it should be <code>&quot;default#{id}&quot;</code>. Can you give an example how to do this properly?"}, {"owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "reply_to_user": {"reputation": 279, "user_id": 3531954, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35bf3b3f78e7d5c3006f57cfaa279460?s=128&d=identicon&r=PG&f=1", "display_name": "Lasse Kliemann", "link": "https://stackoverflow.com/users/3531954/lasse-kliemann"}, "edited": false, "score": 0, "creation_date": 1566989581, "post_id": 57690383, "comment_id": 101825865, "body": "In this case I&#39;d suggest to find by id and <code>null</code> <code>name</code> value and then use app-level default (getter) - <code>User.where(id: id, name: nil)</code>. Or to set defualts in setters, similarly to a technique described here: <a href=\"https://blog.arkency.com/2016/01/drop-this-before-validation-and-use-method/\" rel=\"nofollow noreferrer\">blog.arkency.com/2016/01/&hellip;</a>"}], "tags": [], "owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "is_accepted": false, "score": 2, "last_activity_date": 1566988295, "creation_date": 1566988295, "answer_id": 57690383, "question_id": 57690307, "link": "https://stackoverflow.com/questions/57690307/activerecord-find-by-oblivious-to-custom-getter/57690383#57690383", "title": "ActiveRecord: find_by oblivious to custom getter", "body": "<p>In addition to Amandan answer.</p>\n\n<p>If you want to have defaults that are used by ActiveRecord finders, you need to set a default value on DB column:</p>\n\n<pre><code>ActiveRecord::Schema.define do\n  create_table(:users) { |t| t.string \"name\", default: 'default' }\nend\n</code></pre>\n"}], "owner": {"reputation": 279, "user_id": 3531954, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35bf3b3f78e7d5c3006f57cfaa279460?s=128&d=identicon&r=PG&f=1", "display_name": "Lasse Kliemann", "link": "https://stackoverflow.com/users/3531954/lasse-kliemann"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1566988826, "creation_date": 1566988071, "last_edit_date": 1566988826, "question_id": 57690307, "link": "https://stackoverflow.com/questions/57690307/activerecord-find-by-oblivious-to-custom-getter", "title": "ActiveRecord: find_by oblivious to custom getter", "body": "<p>ActiveRecord's <code>find_by</code> method seems to be oblivious to custom getters. That is, <code>find_by</code> seems to look at values actually stored in the database and not at what the getters return. Example:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>ActiveRecord::Base.establish_connection(\"sqlite3::memory:\")\n\nActiveRecord::Schema.define do\n  create_table(:users) { |t| t.string \"name\" }\nend\n\nclass User &lt; ActiveRecord::Base\n  def name; self[\"name\"] || \"default\" end\nend\n\nUser.create({ \"name\" =&gt; \"foo\" })\nUser.create()\n\np User.find_by(\"name\" =&gt; \"foo\")\np User.find_by(\"name\" =&gt; \"default\")\np User.last.name\n</code></pre>\n\n<p>This prints:</p>\n\n<pre><code>#&lt;User id: 1, name: \"foo\"&gt;\nnil\n\"default\"\n</code></pre>\n\n<p>I would have expected the second line not to be <code>nil</code>, but instead to show the second record added. What I am seeing may be the expected behavior of <code>find_by</code> (I don't know). However, what method could I use instead of <code>find_by</code>, which will use the value returned by the getters?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "bundler"], "comments": [{"owner": {"reputation": 3558, "user_id": 2559490, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/20wjg.jpg?s=128&g=1", "display_name": "Hardik", "link": "https://stackoverflow.com/users/2559490/hardik"}, "edited": false, "score": 0, "creation_date": 1566988997, "post_id": 57690272, "comment_id": 101825570, "body": "1. is it getting installed as a dependancy of any other gem? 2. if you remove it totally from Gem file and do bundle, is it still getting installed?"}, {"owner": {"reputation": 273, "user_id": 6547385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/10153614401007371/picture?type=large", "display_name": "Lee Eather", "link": "https://stackoverflow.com/users/6547385/lee-eather"}, "reply_to_user": {"reputation": 3558, "user_id": 2559490, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/20wjg.jpg?s=128&g=1", "display_name": "Hardik", "link": "https://stackoverflow.com/users/2559490/hardik"}, "edited": false, "score": 0, "creation_date": 1566997135, "post_id": 57690272, "comment_id": 101830121, "body": "Yes. It is a dependency on rails-html-sanitizer gem and has something to do with nokogiri too I think."}, {"owner": {"reputation": 273, "user_id": 6547385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/10153614401007371/picture?type=large", "display_name": "Lee Eather", "link": "https://stackoverflow.com/users/6547385/lee-eather"}, "reply_to_user": {"reputation": 3558, "user_id": 2559490, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/20wjg.jpg?s=128&g=1", "display_name": "Hardik", "link": "https://stackoverflow.com/users/2559490/hardik"}, "edited": false, "score": 0, "creation_date": 1566997890, "post_id": 57690272, "comment_id": 101830576, "body": "Yes, it is not in gemfile at all except in the <code>nonbundled</code> group. It is also dependant on the rgroove <code>sanitze</code> gem."}], "answers": [{"comments": [{"owner": {"reputation": 273, "user_id": 6547385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/10153614401007371/picture?type=large", "display_name": "Lee Eather", "link": "https://stackoverflow.com/users/6547385/lee-eather"}, "edited": false, "score": 0, "creation_date": 1567076063, "post_id": 57703482, "comment_id": 101859290, "body": "I wanted to get around, that. You know of a way besides bundle? I&#39;ll have a look."}], "tags": [], "owner": {"reputation": 3558, "user_id": 2559490, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/20wjg.jpg?s=128&g=1", "display_name": "Hardik", "link": "https://stackoverflow.com/users/2559490/hardik"}, "is_accepted": true, "score": 1, "last_activity_date": 1567056254, "creation_date": 1567056254, "answer_id": 57703482, "question_id": 57690272, "link": "https://stackoverflow.com/questions/57690272/bundler-not-ignoring-the-gems-in-the-group-i-pass-the-without-option-to/57703482#57703482", "title": "Bundler not ignoring the gems in the group I pass the --without option to", "body": "<p>You mentioned in comment that <code>nokogumbo</code> is a dependency of another gem. Because of that it is getting installed.</p>\n\n<p>if you use <code>--without</code> argument while doing bundle install, and if the gem which was supposed to be skipped is present as a dependancy in another Gem it will be installed.</p>\n\n<p><a href=\"https://bundler.io/man/bundle-install.1.html#INSTALLING-GROUPS\" rel=\"nofollow noreferrer\">reference for above</a></p>\n"}], "owner": {"reputation": 273, "user_id": 6547385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://graph.facebook.com/10153614401007371/picture?type=large", "display_name": "Lee Eather", "link": "https://stackoverflow.com/users/6547385/lee-eather"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 57703482, "answer_count": 1, "score": 1, "last_activity_date": 1567056254, "creation_date": 1566987951, "question_id": 57690272, "link": "https://stackoverflow.com/questions/57690272/bundler-not-ignoring-the-gems-in-the-group-i-pass-the-without-option-to", "title": "Bundler not ignoring the gems in the group I pass the --without option to", "body": "<p>I am trying to bundle install without rubygems bringing in <code>nokogumbo</code> and running it in the install.</p>\n\n<p>In my gemfile, I have</p>\n\n<pre><code>...\ngroup :nonbundled do\n  gem 'nokogumbo', '1.4.13'\nend\n...\n</code></pre>\n\n<p>run <code>bundle install --without nonbundled</code> still searching for gem</p>\n\n<pre><code>...    \nUsing jquery-ui-rails 6.0.1\nUsing jwt 1.5.6\nUsing koala 3.0.0\nUsing mini_magick 4.5.1\nUsing ruby-progressbar 1.8.1\nUsing minitest-reporters 1.1.9\nUsing multi_xml 0.6.0\nFetching nokogumbo 1.4.13\nInstalling nokogumbo 1.4.13 with native extensions\nGem::Ext::BuildError: ERROR: Failed to build gem native extension.\n...\n</code></pre>\n\n<p>What is going on here?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 703, "user_id": 3744443, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/31cd958c40afab1804323dc579eeb4c5?s=128&d=identicon&r=PG&f=1", "display_name": "fidato", "link": "https://stackoverflow.com/users/3744443/fidato"}, "edited": false, "score": 0, "creation_date": 1566988263, "post_id": 57689691, "comment_id": 101825143, "body": "Have a look - <a href=\"https://karolgalanciak.com/blog/2017/12/26/the-aesthetics-of-ruby-kernel-number-itself-method/\" rel=\"nofollow noreferrer\">karolgalanciak.com/blog/2017/12/26/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 16672, "user_id": 22237, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/hkobD.png?s=128&g=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/22237/kris"}, "edited": false, "score": 0, "creation_date": 1566986969, "post_id": 57689784, "comment_id": 101824453, "body": "Never knew that, how confusing."}, {"owner": {"reputation": 5449, "user_id": 681520, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/701baebf68d1d7faa9f9def6a24fe356?s=128&d=identicon&r=PG", "display_name": "Kimmo Lehto", "link": "https://stackoverflow.com/users/681520/kimmo-lehto"}, "edited": false, "score": 0, "creation_date": 1566988429, "post_id": 57689784, "comment_id": 101825232, "body": "It&#39;s extra confusing when used with for example openstruct. <code>OpenStruct.new(foo: &#39;bar&#39;).each { |k, v| puts &quot;#{k} = #{v}&quot; }</code> does nothing, because <code>.each</code> returns nil, the correct method is <code>each_pair</code>. Took a while to realize what was wrong."}, {"owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "edited": false, "score": 1, "creation_date": 1566988681, "post_id": 57689784, "comment_id": 101825366, "body": "Yeah, it&#39;s also confusing when you call <code>find</code> with a block on AR relation thinking it&#39;s an array."}], "tags": [], "owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "is_accepted": true, "score": 3, "last_activity_date": 1566986452, "creation_date": 1566986452, "answer_id": 57689784, "question_id": 57689691, "link": "https://stackoverflow.com/questions/57689691/why-does-itself-take-a-block/57689784#57689784", "title": "Why does #itself take a block?", "body": "<p>I guess you can pass a block to any ruby method and it's silently ignored if not used:</p>\n\n<pre><code>1.to_s{ raise \"1\"}\n# =&gt; \"1\"\n1.to_f{ raise \"1\"}\n# =&gt; 1.0\n1.nil?{ raise \"1\"}\n#=&gt; false\n</code></pre>\n"}], "owner": {"reputation": 16672, "user_id": 22237, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/hkobD.png?s=128&g=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/22237/kris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 57689784, "answer_count": 1, "score": 2, "last_activity_date": 1566987117, "creation_date": 1566986157, "last_edit_date": 1566987117, "question_id": 57689691, "link": "https://stackoverflow.com/questions/57689691/why-does-itself-take-a-block", "title": "Why does #itself take a block?", "body": "<p>When passing a block to <code>itself</code>, unlike <code>tap</code> and <code>yield_self</code>, it does not seem to be executed, so what is it used for?</p>\n\n<pre><code>'a'.itself { |it| raise }\n</code></pre>\n\n<p>Nothing is raised.</p>\n\n<ul>\n<li>Ruby 2.6</li>\n</ul>\n"}, {"tags": ["ruby", "ruby-on-rails-5", "localhost", "stripe-payments"], "comments": [{"owner": {"reputation": 3422, "user_id": 1737658, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dcUX4.jpg?s=128&g=1", "display_name": "Paul Asjes", "link": "https://stackoverflow.com/users/1737658/paul-asjes"}, "edited": false, "score": 0, "creation_date": 1566985237, "post_id": 57689129, "comment_id": 101823429, "body": "What does your Stripe initialization code look like? Are you perhaps grabbing your secret key from an environment variable that only exists on your iMac?"}, {"owner": {"reputation": 19, "user_id": 6347632, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b1c7582c845f7b91f174ab7f07f7467?s=128&d=identicon&r=PG&f=1", "display_name": "Quentin Bushkas", "link": "https://stackoverflow.com/users/6347632/quentin-bushkas"}, "reply_to_user": {"reputation": 3422, "user_id": 1737658, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dcUX4.jpg?s=128&g=1", "display_name": "Paul Asjes", "link": "https://stackoverflow.com/users/1737658/paul-asjes"}, "edited": false, "score": 0, "creation_date": 1566986829, "post_id": 57689129, "comment_id": 101824359, "body": "The code is stored in cloud and so everything is the same - stripe.rb is pulling the keys from secrets.yml"}, {"owner": {"reputation": 19, "user_id": 6347632, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b1c7582c845f7b91f174ab7f07f7467?s=128&d=identicon&r=PG&f=1", "display_name": "Quentin Bushkas", "link": "https://stackoverflow.com/users/6347632/quentin-bushkas"}, "reply_to_user": {"reputation": 3422, "user_id": 1737658, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dcUX4.jpg?s=128&g=1", "display_name": "Paul Asjes", "link": "https://stackoverflow.com/users/1737658/paul-asjes"}, "edited": false, "score": 0, "creation_date": 1566989760, "post_id": 57689129, "comment_id": 101825960, "body": "Should say I added stripe.rb content to the question"}], "owner": {"reputation": 19, "user_id": 6347632, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b1c7582c845f7b91f174ab7f07f7467?s=128&d=identicon&r=PG&f=1", "display_name": "Quentin Bushkas", "link": "https://stackoverflow.com/users/6347632/quentin-bushkas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 34, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1566988712, "creation_date": 1566984404, "last_edit_date": 1566988712, "question_id": 57689129, "link": "https://stackoverflow.com/questions/57689129/stripe-fails-on-macbook-localhost-but-works-on-imac-localhost", "title": "Stripe fails on macbook localhost but works on iMac localhost", "body": "<p>I have integrated Stripe into my Ruby Application. When testing on LocalHost on my iMac everything works fine. </p>\n\n<p>The deployment in production works fine</p>\n\n<p>When testing on my MacBook Pro it errors out on submission. The MacBook and iMac are using the same operating systems. iMac late 2014, MacBook late 2016.</p>\n\n<p>This is my first stripe integration and I am stumped.</p>\n\n<p>There are no differences in code, and so I am considering that the environment is not initialising, but I don't know what the issue is.</p>\n\n<p>The error is as follows:</p>\n\n<p>\"No API key provided. Set your API key using \"Stripe.api_key = \"</p>\n\n<p>Showing the following code as the culprit - But remember this works well on two other installations and so I can't see it being the code at fault (But I am happy to be wrong if you all have other ideas!)</p>\n\n<pre><code>  Stripe::Customer.retrieve(stripe_id)\nelse\n  stripe_customer = Stripe::Customer.create({\n    email: email,\n    })\n</code></pre>\n\n<p>This is the config file</p>\n\n<p><strong>stripe.rb</strong></p>\n\n<pre><code>Rails.configuration.stripe = {\n  :publishable_key =&gt; ENV[\"STRIPE_TEST_PUBLISHABLE_KEY\"],\n  :secret_key =&gt; ENV[\"STRIPE_TEST_SECRET_KEY\"]\n  }\n\nStripe.api_key = Rails.configuration.stripe[:secret_key]\n\nStripeEvent.configure do |events|\n  events.subscribe \"charge.succeeded\", Webhooks::ChargeSucceeded.new\n  events.subscribe \"customer.subscription.deleted\",     \nWebhooks::CustomerSubscriptionDeleted.new\nend\n</code></pre>\n"}, {"tags": ["ruby", "rspec"], "comments": [{"owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "edited": false, "score": 0, "creation_date": 1566982876, "post_id": 57688486, "comment_id": 101822156, "body": "Could you provice a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">MVCE</a>, ie an example without rspec involved?"}, {"owner": {"reputation": 855, "user_id": 3759265, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/19a877022888fb56ba9c69541a3f09db?s=128&d=identicon&r=PG&f=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/3759265/tom"}, "reply_to_user": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "edited": false, "score": 0, "creation_date": 1566983046, "post_id": 57688486, "comment_id": 101822246, "body": "Edited, is that OK?"}, {"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 1, "creation_date": 1566983208, "post_id": 57688486, "comment_id": 101822341, "body": "I thought you were asking about the RSpec test. Now after the edit I have no idea what you are asking - the code correctly retries twice then exits."}, {"owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "edited": false, "score": 1, "creation_date": 1566983245, "post_id": 57688486, "comment_id": 101822365, "body": "edited version works correctly on my machine"}, {"owner": {"reputation": 16672, "user_id": 22237, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/hkobD.png?s=128&g=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/22237/kris"}, "edited": false, "score": 0, "creation_date": 1566983467, "post_id": 57688486, "comment_id": 101822486, "body": "Works for me, Ruby 2.5.5."}, {"owner": {"reputation": 855, "user_id": 3759265, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/19a877022888fb56ba9c69541a3f09db?s=128&d=identicon&r=PG&f=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/3759265/tom"}, "edited": false, "score": 0, "creation_date": 1566983878, "post_id": 57688486, "comment_id": 101822709, "body": "unusually, I wasn&#39;t getting the puts in console even though the statement was false."}], "answers": [{"tags": [], "owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "is_accepted": false, "score": 2, "last_activity_date": 1566983451, "last_edit_date": 1566983451, "creation_date": 1566983047, "answer_id": 57688714, "question_id": 57688486, "link": "https://stackoverflow.com/questions/57688486/rescue-retry-ruby/57688714#57688714", "title": "rescue retry Ruby", "body": "<p>RSpec works by throwing <code>RSpec::Expectations::ExpectationNotMetError</code> when an <code>expect</code> fails. You are catching it with your unlimited <code>rescue</code>, so RSpec never sees it, which makes your test pass. Never ever use unlimited <code>rescue</code>. Always use a typed rescue, with the most general type being <code>StandardError</code> (not <code>Exception</code>!) -  but make it as tight and specific as possible.</p>\n\n<p>If you <em>meant</em> to catch <code>ExpectationNotMetError</code> and retry twice, then let it happen afterwards, you need to reraise it (using plain <code>raise</code>) for RSpec to see it, otherwise Ruby considers it to be handled and execution continues normally (and RSpec doesn't see it). You should still rescue it specifically, just to be safe from other possible errors you could do in the rescued block.</p>\n\n<hr>\n\n<p>*) unless you <em>know</em> that <em>exactly one</em> thing can go wrong (and even then triple-check).</p>\n"}], "owner": {"reputation": 855, "user_id": 3759265, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/19a877022888fb56ba9c69541a3f09db?s=128&d=identicon&r=PG&f=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/3759265/tom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566983451, "creation_date": 1566982321, "last_edit_date": 1566983034, "question_id": 57688486, "link": "https://stackoverflow.com/questions/57688486/rescue-retry-ruby", "title": "rescue retry Ruby", "body": "<p>Returning to Ruby after a long break, I'm trying to run a rescue retry block with an RSpec assertion with Capybara / Cucumber.  I have the following which is purposely designed to fail to test my retry.  It doesn't appear to be running the retry, I have gotten confused:</p>\n\n<pre><code>  begin\n    retries ||= 2\n    a = 1\n    a.eql? 2 # false\n    raise\n  rescue\n    puts 'Retrying assertion for failed step'\n    retries -= 1\n    if retries &gt; 0\n      sleep 0.5 # allows render of screen content\n      retry\n    end\n  end\n</code></pre>\n\n<p>I do suspect I've written something wrong here. Is this the case?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "activerecord"], "comments": [{"owner": {"reputation": 48413, "user_id": 1279683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1veuT.jpg?s=128&g=1", "display_name": "Marek Lipka", "link": "https://stackoverflow.com/users/1279683/marek-lipka"}, "edited": false, "score": 0, "creation_date": 1566977190, "post_id": 57686990, "comment_id": 101819192, "body": "Do you have <code>mysql2</code> gem in <code>Gemfile</code>?"}, {"owner": {"reputation": 47, "user_id": 11286717, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OysRu6ppb0U/AAAAAAAAAAI/AAAAAAAAAAk/c8eR1BlDQ8s/photo.jpg?sz=128", "display_name": "Mr.Movies Tamil", "link": "https://stackoverflow.com/users/11286717/mr-movies-tamil"}, "reply_to_user": {"reputation": 48413, "user_id": 1279683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1veuT.jpg?s=128&g=1", "display_name": "Marek Lipka", "link": "https://stackoverflow.com/users/1279683/marek-lipka"}, "edited": false, "score": 0, "creation_date": 1566977326, "post_id": 57686990, "comment_id": 101819253, "body": "yes I included mysql2 in my gemfile"}, {"owner": {"reputation": 2251, "user_id": 9785060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IUduC.png?s=128&g=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/9785060/viktor"}, "edited": false, "score": 0, "creation_date": 1566978261, "post_id": 57686990, "comment_id": 101819674, "body": "Did you run <code>bundle install</code> after that ?"}, {"owner": {"reputation": 47, "user_id": 11286717, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OysRu6ppb0U/AAAAAAAAAAI/AAAAAAAAAAk/c8eR1BlDQ8s/photo.jpg?sz=128", "display_name": "Mr.Movies Tamil", "link": "https://stackoverflow.com/users/11286717/mr-movies-tamil"}, "edited": false, "score": 0, "creation_date": 1566980885, "post_id": 57686990, "comment_id": 101821023, "body": "I did it.  Here is what in my gemfile and database.yml file"}, {"owner": {"reputation": 553, "user_id": 4742218, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh4.googleusercontent.com/-0wBoIjPuArI/AAAAAAAAAAI/AAAAAAAAAF8/gmwCNq5bAX8/photo.jpg?sz=128", "display_name": "noname", "link": "https://stackoverflow.com/users/4742218/noname"}, "edited": false, "score": 0, "creation_date": 1566983598, "post_id": 57686990, "comment_id": 101822548, "body": "I would suggest to read <code>https:&#47;&#47;www.rubydoc.info&#47;gems&#47;mysql2&#47;0.5.2</code> it worked form if I followed each step"}], "answers": [{"tags": [], "owner": {"reputation": 47, "user_id": 11286717, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OysRu6ppb0U/AAAAAAAAAAI/AAAAAAAAAAk/c8eR1BlDQ8s/photo.jpg?sz=128", "display_name": "Mr.Movies Tamil", "link": "https://stackoverflow.com/users/11286717/mr-movies-tamil"}, "is_accepted": false, "score": 1, "last_activity_date": 1566995481, "creation_date": 1566995481, "answer_id": 57692501, "question_id": 57686990, "link": "https://stackoverflow.com/questions/57686990/establish-connection-database-configuration-specifies-nonexistent-mysql2-adapt/57692501#57692501", "title": "establish_connection&#39;: database configuration specifies nonexistent mysql2 adapter (ActiveRecord::AdapterNotFound)", "body": "<p>The problem is solved. gem install mysql adapter is the problem here u need to uninstall it and remove a file it created in config/initializers/abstract.rb file</p>\n"}, {"comments": [{"owner": {"reputation": 3809, "user_id": 518500, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/853a5fb8148dc8e1678c983f0a4cbaf5?s=128&d=identicon&r=PG", "display_name": "codingbunny", "link": "https://stackoverflow.com/users/518500/codingbunny"}, "edited": false, "score": 1, "creation_date": 1615382084, "post_id": 63728176, "comment_id": 117672466, "body": "This actually solved the problem for me in addition to having the file around. Seems to be an issue with a fairly modern rspec setup and Rails 3.2. For some reason the load order is completely different under RSpec there and breaks the Rails stack."}], "tags": [], "owner": {"reputation": 45, "user_id": 9943328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/971e5236ed4b4554c86600b34fa4ab55?s=128&d=identicon&r=PG&f=1", "display_name": "syamphanindra", "link": "https://stackoverflow.com/users/9943328/syamphanindra"}, "is_accepted": false, "score": 1, "last_activity_date": 1599151507, "creation_date": 1599151507, "answer_id": 63728176, "question_id": 57686990, "link": "https://stackoverflow.com/questions/57686990/establish-connection-database-configuration-specifies-nonexistent-mysql2-adapt/63728176#63728176", "title": "establish_connection&#39;: database configuration specifies nonexistent mysql2 adapter (ActiveRecord::AdapterNotFound)", "body": "<p>I also faced the issue. Please follow below\nadd following line in your envrionment.rb file.\n<code>require File.expand_path('../initializers/abstract_mysql2_adapter', __FILE__)</code></p>\n"}], "owner": {"reputation": 47, "user_id": 11286717, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OysRu6ppb0U/AAAAAAAAAAI/AAAAAAAAAAk/c8eR1BlDQ8s/photo.jpg?sz=128", "display_name": "Mr.Movies Tamil", "link": "https://stackoverflow.com/users/11286717/mr-movies-tamil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 222, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1599151507, "creation_date": 1566977068, "last_edit_date": 1566986346, "question_id": 57686990, "link": "https://stackoverflow.com/questions/57686990/establish-connection-database-configuration-specifies-nonexistent-mysql2-adapt", "title": "establish_connection&#39;: database configuration specifies nonexistent mysql2 adapter (ActiveRecord::AdapterNotFound)", "body": "<p>I changed my database from <code>sqlite3</code> to <code>mysql</code> after doing all the migrations. When I connect to the rails server an error occurs.</p>\n\n<p>I tried all the solutions I could find but none works. When I try to run the server with <code>rails server</code> I get:</p>\n\n<pre><code>&gt; establish_connection': database configuration specifies nonexistent\n&gt; mysql2 adapter (ActiveRecord::AdapterNotFound)\n</code></pre>\n\n<p>I am new to rails I dont know what causes this. May be due to shifting of database or anyother thing. </p>\n\n<p>I searched in the internet for a day and still no solution to this.</p>\n\n<p>Why this happens and anyone can suggest it. Whether i need to add other gems. I am using sql5.5 and also reinstalled it. I removed all the dependent files while uninstalling. </p>\n\n<p>Database.yml file : contains all the required things</p>\n\n<pre><code>            development:\n              adapter: mysql2\n              database: User_development\n              encoding: utf8\n              reconnect: false \n              host: 127.0.0.1  \n              username: root\n              password:\n              pool: 5\n              timeout: 5000\n\n            test:\n              adapter: mysql2\n              database: User_test\n              encoding: utf8\n              reconnect: false \n              host: localhost \n              username: root\n              password:\n              pool: 5\n              timeout: 5000\n              socket: /tmp/mysql.sock\n\n\n            production:\n              adapter: mysql2\n              database: User_production\n              encoding: utf8\n              reconnect: false \n              host: localhost \n              username: root\n              password:\n              pool: 5\n              timeout: 5000\n              socket: /tmp/mysql.sock\n\n            GEM FILE: it contains all the required  gems\n\n            source 'https://rubygems.org'\n\n              gem 'rails', '3.2.22'\n              gem 'rails_12factor'\n              gem 'test-unit'\n              gem 'bootstrap-sass', '2.1'\n              gem 'bcrypt-ruby', '3.0.1'\n              gem 'faker', '1.0.1'\n              gem 'will_paginate', '3.0.3'  \n              gem 'yaml_db'\n              gem 'mysql2', '~&gt; 0.3.0'\n\n              group :development, :test do\n                 #gem 'sqlite3', '1.3.13'\n\n\n                gem 'rspec-rails', '2.11.0'\n                 gem 'guard-rspec', '1.2.1'\n              end\n\n              group :development do\n                gem 'annotate', '2.5.0'\n              end\n\n\n              group :assets do\n                gem 'sass-rails',   '3.2.5'\n                gem 'coffee-rails', '3.2.2'\n                gem 'uglifier', '1.2.3'\n              end\n\n              gem 'jquery-rails', '2.0.2'\n\n              group :test do\n                gem 'capybara', '1.1.2'\n                gem 'rb-fsevent', '0.9.1', :require =&gt; false\n                gem 'growl', '1.0.3'\n                gem 'factory_girl_rails', '4.1.0'\n              end\n\n              group :production do\n                gem 'pg', '0.12.1'\n              end\n</code></pre>\n\n<p>Do I have to do anything else after the migration?</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "answers": [{"tags": [], "owner": {"reputation": 1175, "user_id": 2861567, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GRa02.jpg?s=128&g=1", "display_name": "quyetdc", "link": "https://stackoverflow.com/users/2861567/quyetdc"}, "is_accepted": true, "score": 3, "last_activity_date": 1566978098, "creation_date": 1566978098, "answer_id": 57687283, "question_id": 57686959, "link": "https://stackoverflow.com/questions/57686959/sessiondestroy-not-being-applied/57687283#57687283", "title": "session#destroy not being applied", "body": "<p>By default when using <code>resources :sessions, only: [:new, :create, :destroy]</code>, it will create route like <code>DELETE /sessions/:id</code> and trigger the <code>destroy</code> action of your controller.</p>\n\n<p>Here, in your html</p>\n\n<pre><code>&lt;%= link_to \"Log Out\", session_path, method: :delete %&gt;\n</code></pre>\n\n<p>This does not generate the correct url for Rails router to trigger your desired action (cause you don't pass any <code>params[:id]</code> as defined by routes)</p>\n\n<p>You can update your <code>routes.rb</code> like</p>\n\n<pre><code>resources :sessions, only: [:new, :create]\n\ndelete '/users/session', to: \"sessions#destroy\", as: :sign_out\n</code></pre>\n\n<p>And then, in your view</p>\n\n<pre><code>&lt;%= link_to \"Log Out\", sign_out_path, method: :delete %&gt;\n</code></pre>\n"}], "owner": {"reputation": 77, "user_id": 11871896, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cUszr.jpg?s=128&g=1", "display_name": "code prodigy", "link": "https://stackoverflow.com/users/11871896/code-prodigy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "accepted_answer_id": 57687283, "answer_count": 1, "score": 1, "last_activity_date": 1566978098, "creation_date": 1566976939, "last_edit_date": 1566978035, "question_id": 57686959, "link": "https://stackoverflow.com/questions/57686959/sessiondestroy-not-being-applied", "title": "session#destroy not being applied", "body": "<p>I want to start this by saying i am not using devise.\nMy problem is that i am making the authentication part of my website and I am running into a routing error.</p>\n\n<p>I have tried many stack overflow solutions that have just not seemed to work for me.</p>\n\n<p>This is my <code>new.html.erb</code> page where i am trying to destroy a user:</p>\n\n<pre><code>&lt;h1&gt; Hey, &lt;%= @user.firstname %&gt;! &lt;/h1&gt;\n&lt;h3&gt;&lt;a href=\"http://localhost:3000\"&gt;Home&lt;/a&gt;&lt;/h3&gt;\n&lt;%= link_to \"Log Out\", session_path, method: :delete %&gt;\n&lt;%= stylesheet_link_tag 'users', media: 'all', 'data-turbolinks-track' =&gt; true %&gt;\n</code></pre>\n\n<p>This is my <code>routes.rb</code> file:</p>\n\n<pre><code>Rails.application.routes.draw do\n  # Fubyonrails.org/routing.html\n  root :to =&gt; 'static#welcome'\n  resources :users, only: [:new, :create, :show]\n  resources :sessions, only: [:new, :create, :destroy]\n  resources :studios\nend\n</code></pre>\n\n<p>This is my <code>session_controller.rb</code> file:    </p>\n\n<pre><code>class SessionsController &lt; ApplicationController\n  def new; end\n\n  def create\n    @user = User.find_by(username: params[:username])\n    if @user&amp;.authenticate(params[:password])\n      session[:id] = @user.id\n      redirect_to @user\n    else\n      render new_user_path\n    end\n  end\n\n  def destroy\n    raise params.inspect\n    session.delete(:id)\n    redirect_to root_url\n  end\nend\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "activerecord"], "comments": [{"owner": {"reputation": 6165, "user_id": 2697183, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65255fe741b95ba0c641d96ea6750ea9?s=128&d=identicon&r=PG&f=1", "display_name": "AbM", "link": "https://stackoverflow.com/users/2697183/abm"}, "edited": false, "score": 3, "creation_date": 1566976798, "post_id": 57686765, "comment_id": 101819000, "body": "The generated code is correct. The <code>belongs_to :product</code> will look for the foreign key <code>product_id</code> under <code>order_items</code>, the <code>has_one :product</code> will look for the <code>order_item_id</code> under <code>products</code>. <a href=\"https://guides.rubyonrails.org/association_basics.html#the-types-of-associations\" rel=\"nofollow noreferrer\">More info here</a>"}, {"owner": {"reputation": 1368, "user_id": 3540782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/967473dab4dfed2eb086618cbd7bb3cb?s=128&d=identicon&r=PG&f=1", "display_name": "mrateb", "link": "https://stackoverflow.com/users/3540782/mrateb"}, "reply_to_user": {"reputation": 6165, "user_id": 2697183, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65255fe741b95ba0c641d96ea6750ea9?s=128&d=identicon&r=PG&f=1", "display_name": "AbM", "link": "https://stackoverflow.com/users/2697183/abm"}, "edited": false, "score": 0, "creation_date": 1567244822, "post_id": 57686765, "comment_id": 101912889, "body": "Semantically this is very weird though. Can&#39;t quite accept that order_item &quot;belongs to&quot; product. It &quot;has one&quot; product to me makes much more sense. Can I find any explanations on this any where?"}], "owner": {"reputation": 1368, "user_id": 3540782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/967473dab4dfed2eb086618cbd7bb3cb?s=128&d=identicon&r=PG&f=1", "display_name": "mrateb", "link": "https://stackoverflow.com/users/3540782/mrateb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 55, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1566976595, "creation_date": 1566976197, "last_edit_date": 1566976595, "question_id": 57686765, "link": "https://stackoverflow.com/questions/57686765/rails-generate-model-refrences-but-not-belongs-to", "title": "Rails generate model refrences but not belongs_to", "body": "<p>So I have a Ruby-on-Rails application that should have the following models: <code>Order</code>, <code>OrderItem</code>, and <code>Product</code></p>\n\n<p>I wanted to generate the <code>OrderItem</code> model, for this I used: </p>\n\n<pre><code>rails g model OrderItem order:references product:references quantity:integer selling_price:decimal\n</code></pre>\n\n<p>The result model is:</p>\n\n<pre><code>class OrderItem &lt; ApplicationRecord\n  belongs_to :order\n  belongs_to :product\nend\n</code></pre>\n\n<p>Technically, the <code>OrderItem</code> correctly belongs_to <code>Order</code> this is correct. Technically however it does not \"belong to\" but at most <code>has_one :product</code>. Changing this by correcting the generated model is of course easy. Been wondering if there's a correct Ruby way for generating a has_one relation though. Was using references in this case wrong, and there's a correct way to do this?</p>\n"}, {"tags": ["arrays", "ruby"], "answers": [{"tags": [], "owner": {"reputation": 53136, "user_id": 28376, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ec1383b240b5ba15ffb9743fceb3c0e?s=128&d=identicon&r=PG", "display_name": "philnash", "link": "https://stackoverflow.com/users/28376/philnash"}, "is_accepted": false, "score": 0, "last_activity_date": 1566974049, "creation_date": 1566974049, "answer_id": 57686297, "question_id": 57686260, "link": "https://stackoverflow.com/questions/57686260/getting-array-values-ruby/57686297#57686297", "title": "getting array values ruby", "body": "<p>Looks like you should be able to select the first reservation from that array and then call on the <code>payment_id</code>. Like:</p>\n\n<pre><code>r.first.payment_id\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 358, "user_id": 8708097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/APLHT.jpg?s=128&g=1", "display_name": "Saif chaudhry", "link": "https://stackoverflow.com/users/8708097/saif-chaudhry"}, "is_accepted": false, "score": 0, "last_activity_date": 1566974693, "creation_date": 1566974693, "answer_id": 57686417, "question_id": 57686260, "link": "https://stackoverflow.com/questions/57686260/getting-array-values-ruby/57686417#57686417", "title": "getting array values ruby", "body": "<p>To get all payment_id's you can do </p>\n\n<pre><code>r.map(&amp;:payment_id)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5060, "user_id": 10522579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7GQ6a.jpg?s=128&g=1", "display_name": "ray", "link": "https://stackoverflow.com/users/10522579/ray"}, "is_accepted": true, "score": 2, "last_activity_date": 1566974710, "creation_date": 1566974710, "answer_id": 57686419, "question_id": 57686260, "link": "https://stackoverflow.com/questions/57686260/getting-array-values-ruby/57686419#57686419", "title": "getting array values ruby", "body": "<p>If you have number of records in array, you can get <code>payment_id</code> in form of array as below,</p>\n\n<pre><code>r.map(&amp;:payment_id)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 63, "user_id": 6941553, "user_type": "registered", "profile_image": "https://graph.facebook.com/1264893356888672/picture?type=large", "display_name": "Girish Bhanarkar", "link": "https://stackoverflow.com/users/6941553/girish-bhanarkar"}, "is_accepted": false, "score": 0, "last_activity_date": 1566977440, "creation_date": 1566977440, "answer_id": 57687087, "question_id": 57686260, "link": "https://stackoverflow.com/questions/57686260/getting-array-values-ruby/57687087#57687087", "title": "getting array values ruby", "body": "<p>You can also use the collect method</p>\n\n<pre><code>r.collect(&amp;:name)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7223, "user_id": 1652451, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zwK34.jpg?s=128&g=1", "display_name": "PbxMan", "link": "https://stackoverflow.com/users/1652451/pbxman"}, "edited": false, "score": 1, "creation_date": 1567005892, "post_id": 57690055, "comment_id": 101835525, "body": "Even though your answer can be right is considered a low quality post because you should write an explanation such is &quot;In ruby the way to retrieve...&quot; which can be applied in the specific case in question  or to all cases. Also links to documentation help."}, {"owner": {"reputation": 144, "user_id": 5713303, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QqzJQ.png?s=128&g=1", "display_name": "Dhanashri Joshi", "link": "https://stackoverflow.com/users/5713303/dhanashri-joshi"}, "reply_to_user": {"reputation": 7223, "user_id": 1652451, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zwK34.jpg?s=128&g=1", "display_name": "PbxMan", "link": "https://stackoverflow.com/users/1652451/pbxman"}, "edited": false, "score": 0, "creation_date": 1567018960, "post_id": 57690055, "comment_id": 101841147, "body": "Noted with Thanks \ud83d\udc4d."}], "tags": [], "owner": {"reputation": 144, "user_id": 5713303, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QqzJQ.png?s=128&g=1", "display_name": "Dhanashri Joshi", "link": "https://stackoverflow.com/users/5713303/dhanashri-joshi"}, "is_accepted": false, "score": 0, "last_activity_date": 1567056057, "last_edit_date": 1567056057, "creation_date": 1566987285, "answer_id": 57690055, "question_id": 57686260, "link": "https://stackoverflow.com/questions/57686260/getting-array-values-ruby/57690055#57690055", "title": "getting array values ruby", "body": "<p>You can pluck payment ids (from the required set of data) with the following :</p>\n\n<pre><code>Reservation.pluck(:payment_id)\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 11158233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/027c3f0611bcb9f8f4e0f499ddb6fed9?s=128&d=identicon&r=PG&f=1", "display_name": "exception", "link": "https://stackoverflow.com/users/11158233/exception"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 57686419, "answer_count": 5, "score": 0, "last_activity_date": 1567056057, "creation_date": 1566973843, "last_edit_date": 1566974807, "question_id": 57686260, "link": "https://stackoverflow.com/questions/57686260/getting-array-values-ruby", "title": "getting array values ruby", "body": "<p>I have an array which is result of a query.</p>\n\n<pre><code>r = [\n  #&lt;Reservation id: 27, schedule_id: 1, name: \"test user\", gender: \"no_answer\",\n    reservation_num: 1, zip: \"\", prefecture: \"\", address: \"\", street: \"\",\n    tel: \"\", note: \"\", satisfied: true, canceled: false, seq: 27,\n    created_at: \"2019-08-28 06:04:30\", updated_at: \"2019-08-28 06:04:30\",\n    created_by: 2, updated_by: 2, from_partner: false, no_counting: false,\n    reservation_time: nil, one_day_payment: nil, payment_id: 123456&gt;\n]\n</code></pre>\n\n<p>I want to get the payment_id but don't understand how should I write.</p>\n"}, {"tags": ["ruby", "ruby-on-rails-5"], "comments": [{"owner": {"reputation": 299, "user_id": 3251036, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b88d9e964e6d6500c8d511cde831486?s=128&d=identicon&r=PG&f=1", "display_name": "sammygadd", "link": "https://stackoverflow.com/users/3251036/sammygadd"}, "edited": false, "score": 0, "creation_date": 1566975546, "post_id": 57686066, "comment_id": 101818456, "body": "How does your controller action look? Do you redirect back and the button is still &quot;follow&quot; instead of &quot;unfollow&quot;?"}, {"owner": {"reputation": 65, "user_id": 11850228, "user_type": "registered", "profile_image": "https://graph.facebook.com/938857089785122/picture?type=large", "display_name": "Dutavi", "link": "https://stackoverflow.com/users/11850228/dutavi"}, "reply_to_user": {"reputation": 299, "user_id": 3251036, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b88d9e964e6d6500c8d511cde831486?s=128&d=identicon&r=PG&f=1", "display_name": "sammygadd", "link": "https://stackoverflow.com/users/3251036/sammygadd"}, "edited": false, "score": 0, "creation_date": 1566976149, "post_id": 57686066, "comment_id": 101818714, "body": "I have added it above so please check it out for me"}, {"owner": {"reputation": 299, "user_id": 3251036, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b88d9e964e6d6500c8d511cde831486?s=128&d=identicon&r=PG&f=1", "display_name": "sammygadd", "link": "https://stackoverflow.com/users/3251036/sammygadd"}, "edited": false, "score": 0, "creation_date": 1566977914, "post_id": 57686066, "comment_id": 101819505, "body": "Looking a the documentation for <code>form_for</code> it looks like the method should be specified directly in the options hash (rather than nesting it under the html key). Try changing that and make sure you end up in the <code>destroy</code>action. byebug/binding.pry etc is your friend :)"}, {"owner": {"reputation": 2174, "user_id": 3448554, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/j7RcG.jpg?s=128&g=1", "display_name": "Kelsey Hannan", "link": "https://stackoverflow.com/users/3448554/kelsey-hannan"}, "edited": false, "score": 1, "creation_date": 1566981331, "post_id": 57686066, "comment_id": 101821264, "body": "params[:id] and params[:follower_id] caught me as potentially a place where you&#39;re screwing up.  Would be helpful if you posted your schema too."}, {"owner": {"reputation": 65, "user_id": 11850228, "user_type": "registered", "profile_image": "https://graph.facebook.com/938857089785122/picture?type=large", "display_name": "Dutavi", "link": "https://stackoverflow.com/users/11850228/dutavi"}, "edited": false, "score": 0, "creation_date": 1566986188, "post_id": 57686066, "comment_id": 101823976, "body": "I have added the Schema.rb above  !"}], "owner": {"reputation": 65, "user_id": 11850228, "user_type": "registered", "profile_image": "https://graph.facebook.com/938857089785122/picture?type=large", "display_name": "Dutavi", "link": "https://stackoverflow.com/users/11850228/dutavi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 53, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1566986134, "creation_date": 1566972720, "last_edit_date": 1566986134, "question_id": 57686066, "link": "https://stackoverflow.com/questions/57686066/follow-user-in-rails5-error-unique-constraint-failed-relationships-follower-i", "title": "Follow user in rails5 - Error UNIQUE constraint failed: relationships.follower_id, relationships.followed_id", "body": "<blockquote>\n  <p>I want after the user press follow, that follow button will become unfollow. </p>\n</blockquote>\n\n<p>model user:</p>\n\n<pre><code> def followed(other_user)\n    following &lt;&lt; other_user\n  end\n\n  def unfollow(other_user)\n    following.delete(other_user)\n  end\n\n  def following?(other_user)\n    following.include?(other_user)\n  end\nhas_many :following, through: :active_relationships, source: :followed\nhas_many :followers, through: :passive_relationships, source: :follower\n</code></pre>\n\n<p>model Relationship:</p>\n\n<pre><code> belongs_to :follower, class_name: \"User\"\n belongs_to :followed, class_name: \"User\"\n validates :follower_id, :followed_id, presence: true\n</code></pre>\n\n<p>View users:</p>\n\n<p>_follow.html.erb</p>\n\n<pre><code>&lt;%= form_for(current_user.active_relationships.build) do |f| %&gt;\n  &lt;div&gt;&lt;%= hidden_field_tag :followed_id, @user.id %&gt;&lt;/div&gt;\n  &lt;%= f.submit \"Follow\", class: \"btn btn-primary\" %&gt;\n&lt;% end %\n</code></pre>\n\n<p>_unfollow.html</p>\n\n<pre><code>&lt;%= form_for(current_user.active_relationships.find_by(followed_id: @user.id),\n             html: { method: :delete }) do |f| %&gt;\n  &lt;%= f.submit \"Unfollow\", class: \"btn\" %&gt;\n&lt;% end %&gt;\n</code></pre>\n\n<p>shared:</p>\n\n<p>_follow_form.html.erb</p>\n\n<pre><code>&lt;% unless current_user?(@user) %&gt;\n  &lt;div id=\"follow_form\"&gt;\n  &lt;% if current_user.following?(@user) %&gt;\n    &lt;%= render 'unfollow' %&gt;\n  &lt;% else %&gt;\n    &lt;%= render 'follow' %&gt;\n  &lt;% end %&gt;\n  &lt;/div&gt;\n&lt;% end %&gt;\n</code></pre>\n\n<p>_stats.html.erb</p>\n\n<pre><code>&lt;% @user ||= current_user %&gt;\n&lt;div class=\"stats\"&gt;\n  &lt;a href=\"&lt;%= following_user_path(@user) %&gt;\"&gt;\n    &lt;strong id=\"following\" class=\"stat\"&gt;\n      &lt;%= @user.following.count %&gt;\n    &lt;/strong&gt;\n    following\n  &lt;/a&gt;\n  &lt;a href=\"&lt;%= followers_user_path(@user) %&gt;\"&gt;\n    &lt;strong id=\"followers\" class=\"stat\"&gt;\n      &lt;%= @user.followers.count %&gt;\n    &lt;/strong&gt;\n    followers\n  &lt;/a&gt;\n&lt;/div\n</code></pre>\n\n<p>relationship_controller.tb</p>\n\n<pre><code>class RelationshipsController &lt; ApplicationController\n  before_action :authenticate_user!\n\n  def create\n    user = User.find(params[:followed_id])\n    current_user.followed(user)\n    redirect_to user\n  end\n\n  def destroy\n    user = Relationship.find(params[:id]).followed\n    current_user.unfollow(user)\n  end\nend\n</code></pre>\n\n<p>db/schema.rb</p>\n\n<pre><code>create_table \"relationships\", force: :cascade do |t|\n    t.integer \"follower_id\"\n    t.integer \"followed_id\"\n    t.datetime \"created_at\", precision: 6, null: false\n    t.datetime \"updated_at\", precision: 6, null: false\n    t.index [\"followed_id\"], name: \"index_relationships_on_followed_id\"\n    t.index [\"follower_id\", \"followed_id\"], name: \"index_relationships_on_follower_id_and_followed_id\", unique: true\n    t.index [\"follower_id\"], name: \"index_relationships_on_follower_id\"\n  end\n</code></pre>\n\n<p>after I clicked the tracking button, the number of followers will increase by 1 but when I press it again, the following error is displayed:</p>\n\n<blockquote>\n  <p>---> Error: UNIQUE constraint failed: relationships.follower_id, relationships.followed_id</p>\n</blockquote>\n"}, {"tags": ["ruby-on-rails", "ruby", "nested-attributes"], "comments": [{"owner": {"reputation": 1397, "user_id": 4940278, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/06NHi.jpg?s=128&g=1", "display_name": "Luna Lovegood", "link": "https://stackoverflow.com/users/4940278/luna-lovegood"}, "edited": false, "score": 0, "creation_date": 1566972975, "post_id": 57686030, "comment_id": 101817449, "body": "The error says that there is no role associated with that particular user. Check the data in  your database"}, {"owner": {"reputation": 25, "user_id": 11986017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d94891fad2fcdb9df6edec1e2d3e82a?s=128&d=identicon&r=PG&f=1", "display_name": "bottles", "link": "https://stackoverflow.com/users/11986017/bottles"}, "reply_to_user": {"reputation": 1397, "user_id": 4940278, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/06NHi.jpg?s=128&g=1", "display_name": "Luna Lovegood", "link": "https://stackoverflow.com/users/4940278/luna-lovegood"}, "edited": false, "score": 0, "creation_date": 1566973786, "post_id": 57686030, "comment_id": 101817735, "body": "@Surya i have edited my question to include the db. Actually, i think i have that association.maybe you could roll throufh it once again please."}, {"owner": {"reputation": 358, "user_id": 8708097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/APLHT.jpg?s=128&g=1", "display_name": "Saif chaudhry", "link": "https://stackoverflow.com/users/8708097/saif-chaudhry"}, "edited": false, "score": 1, "creation_date": 1566975058, "post_id": 57686030, "comment_id": 101818244, "body": "I think it should be @user.roles.first.name because roles belongs to user not account."}, {"owner": {"reputation": 25, "user_id": 11986017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d94891fad2fcdb9df6edec1e2d3e82a?s=128&d=identicon&r=PG&f=1", "display_name": "bottles", "link": "https://stackoverflow.com/users/11986017/bottles"}, "reply_to_user": {"reputation": 358, "user_id": 8708097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/APLHT.jpg?s=128&g=1", "display_name": "Saif chaudhry", "link": "https://stackoverflow.com/users/8708097/saif-chaudhry"}, "edited": false, "score": 0, "creation_date": 1566975708, "post_id": 57686030, "comment_id": 101818530, "body": "@Saifchaudhry already tried that but it shows same error"}, {"owner": {"reputation": 25, "user_id": 11986017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d94891fad2fcdb9df6edec1e2d3e82a?s=128&d=identicon&r=PG&f=1", "display_name": "bottles", "link": "https://stackoverflow.com/users/11986017/bottles"}, "edited": false, "score": 0, "creation_date": 1566976489, "post_id": 57686030, "comment_id": 101818860, "body": "i added a role to a user using the rails console and wrote @user.roles.first.name it worked. But it doesn&#39;t For a user without a role, It returns that error stated in the question.(Undefined method <code>name</code> for nil:NilClass"}, {"owner": {"reputation": 358, "user_id": 8708097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/APLHT.jpg?s=128&g=1", "display_name": "Saif chaudhry", "link": "https://stackoverflow.com/users/8708097/saif-chaudhry"}, "edited": false, "score": 0, "creation_date": 1566983476, "post_id": 57686030, "comment_id": 101822495, "body": "For a user without role you can use @user.roles.try(:first).try(:name)"}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 11986017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d94891fad2fcdb9df6edec1e2d3e82a?s=128&d=identicon&r=PG&f=1", "display_name": "bottles", "link": "https://stackoverflow.com/users/11986017/bottles"}, "edited": false, "score": 0, "creation_date": 1567076225, "post_id": 57688201, "comment_id": 101859401, "body": "Though the collection shows to either select Admin or User as role, but  when submited user role is stil Nil."}, {"owner": {"reputation": 303, "user_id": 9479253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cd34f4996365a59ad414df6950d6d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ashok Damaniya", "link": "https://stackoverflow.com/users/9479253/ashok-damaniya"}, "reply_to_user": {"reputation": 25, "user_id": 11986017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d94891fad2fcdb9df6edec1e2d3e82a?s=128&d=identicon&r=PG&f=1", "display_name": "bottles", "link": "https://stackoverflow.com/users/11986017/bottles"}, "edited": false, "score": 0, "creation_date": 1567152961, "post_id": 57688201, "comment_id": 101886629, "body": "try this out @user&amp;.roles&amp;.first&amp;.name || &#39;user&#39;"}, {"owner": {"reputation": 25, "user_id": 11986017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d94891fad2fcdb9df6edec1e2d3e82a?s=128&d=identicon&r=PG&f=1", "display_name": "bottles", "link": "https://stackoverflow.com/users/11986017/bottles"}, "edited": false, "score": 0, "creation_date": 1567173943, "post_id": 57688201, "comment_id": 101896721, "body": "Did that, the matter is, it just output that u have make some execution but it does not make any commit or sql insection."}, {"owner": {"reputation": 25, "user_id": 11986017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d94891fad2fcdb9df6edec1e2d3e82a?s=128&d=identicon&r=PG&f=1", "display_name": "bottles", "link": "https://stackoverflow.com/users/11986017/bottles"}, "edited": false, "score": 0, "creation_date": 1567175219, "post_id": 57688201, "comment_id": 101897432, "body": "Ok, got this work with the rails console $ d=User.find(1)    $  d&amp;.roles&amp;.first&amp;.name || d&amp;.add_role(&#39;user&#39;)"}, {"owner": {"reputation": 303, "user_id": 9479253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cd34f4996365a59ad414df6950d6d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ashok Damaniya", "link": "https://stackoverflow.com/users/9479253/ashok-damaniya"}, "reply_to_user": {"reputation": 25, "user_id": 11986017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d94891fad2fcdb9df6edec1e2d3e82a?s=128&d=identicon&r=PG&f=1", "display_name": "bottles", "link": "https://stackoverflow.com/users/11986017/bottles"}, "edited": false, "score": 0, "creation_date": 1567226586, "post_id": 57688201, "comment_id": 101909956, "body": "glad you got your issue resolved, but as you comment , @user&amp;.roles&amp;.first&amp;.name || &#39;user&#39; will only print the out put won&#39;t add role to the user."}], "tags": [], "owner": {"reputation": 303, "user_id": 9479253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cd34f4996365a59ad414df6950d6d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ashok Damaniya", "link": "https://stackoverflow.com/users/9479253/ashok-damaniya"}, "is_accepted": false, "score": 0, "last_activity_date": 1566981400, "creation_date": 1566981400, "answer_id": 57688201, "question_id": 57686030, "link": "https://stackoverflow.com/questions/57686030/undefined-method-name-for-nilnilclass/57688201#57688201", "title": "undefined method `name&#39; for nil:NilClass:", "body": "<p>you can use safe navigation if roles are not present for user then it will handle the case with below code</p>\n\n<pre><code>@user&amp;.roles&amp;.first&amp;.name || ''\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 11986017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d94891fad2fcdb9df6edec1e2d3e82a?s=128&d=identicon&r=PG&f=1", "display_name": "bottles", "link": "https://stackoverflow.com/users/11986017/bottles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 91, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566981400, "creation_date": 1566972582, "last_edit_date": 1592644375, "question_id": 57686030, "link": "https://stackoverflow.com/questions/57686030/undefined-method-name-for-nilnilclass", "title": "undefined method `name&#39; for nil:NilClass:", "body": "<p>Using ruby 2.6 &amp; rails 5.2\nAnd also using rolify gem.</p>\n<p>I passed in a nested attribute in my Users edit view for roles to be selectable(editable).But Instead, I am geting</p>\n<pre class=\"lang-rb prettyprint-override\"><code>undefined method `name' for nil:NilClass\nIn my edit view.\n</code></pre>\n<p>I am using this code snippet in my users edit views</p>\n<pre class=\"lang-rb prettyprint-override\"><code>&lt;%= form_for(@user, url: account_user_path(@user), html: {class: 'form-horizontal'}) do |f| %&gt;\n&lt;%= select_tag &quot;user[role]&quot;, options_for_select(@choices, @user.account.roles.first.name), class:'form-control'%&gt;\nend\n</code></pre>\n<p>I have in my controllers..</p>\n<h3>users_controller</h3>\n<pre class=\"lang-rb prettyprint-override\"><code>class UsersController &lt; ApplicationController\nbefore_action :set_user, only: [:show, :edit, :update,:destroy] \n\n........\ndef edit\n  set_choices\nend\n\ndef set_choices\n  @choices = []\n  @choices &lt;&lt; [&quot;Admin&quot;, 'admin']\n  @choices &lt;&lt; [&quot;User&quot;, 'user']\nend\n\n......\nprivate\n\ndef user_params\nparams.require(:user).permit(:name, :email, :role)\nend\n\n</code></pre>\n<h2>Database</h2>\n<h3>RolifyCreateRoles</h3>\n<pre class=\"lang-rb prettyprint-override\"><code>\nclass RolifyCreateRoles &lt; ActiveRecord::Migration\n  def change\n    create_table(:roles) do |t|\n      t.string :name\n      t.references :resource, :polymorphic =&gt; true\n\n      t.timestamps\n    end\n\n    create_table(:users_roles, :id =&gt; false) do |t|\n      t.references :user\n      t.references :role\n    end\n\n    add_index(:roles, :name)\n    add_index(:roles, [ :name, :resource_type, :resource_id ])\n    add_index(:users_roles, [ :user_id, :role_id ])\n  end\nend\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 6207, "user_id": 5117953, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/Ca0RW.jpg?s=128&g=1", "display_name": "Vishal", "link": "https://stackoverflow.com/users/5117953/vishal"}, "edited": false, "score": 0, "creation_date": 1566966309, "post_id": 57685000, "comment_id": 101815679, "body": "What is data type of gas?"}, {"owner": {"reputation": 349, "user_id": 3848768, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/sE6KE.jpg?s=128&g=1", "display_name": "Modi Ranga Nayakulu", "link": "https://stackoverflow.com/users/3848768/modi-ranga-nayakulu"}, "edited": false, "score": 1, "creation_date": 1567008197, "post_id": 57685000, "comment_id": 101836838, "body": "are you using PostgreSQL and <b>hstore</b> datatype?"}, {"owner": {"reputation": 235, "user_id": 11876193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69e8d60ef1c541d619b23743be3ba1e4?s=128&d=identicon&r=PG&f=1", "display_name": "YLim", "link": "https://stackoverflow.com/users/11876193/ylim"}, "edited": false, "score": 0, "creation_date": 1567034470, "post_id": 57685000, "comment_id": 101846023, "body": "I am using SQL."}], "owner": {"reputation": 235, "user_id": 11876193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69e8d60ef1c541d619b23743be3ba1e4?s=128&d=identicon&r=PG&f=1", "display_name": "YLim", "link": "https://stackoverflow.com/users/11876193/ylim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 32, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1566965797, "creation_date": 1566965797, "question_id": 57685000, "link": "https://stackoverflow.com/questions/57685000/how-to-use-hash-in-search-rails", "title": "How to use hash in search? rails", "body": "<p>In one of gas views, the user chooses one of the gases key as shown below. So for example, the user can choose Carbon Dioxide [CO2]. Then, if the user wants to search for the gas, they go the search page. However, user usually don't write the name and just write the element, so in the search model below, I tried to only compare the value and the searched input, but I t didn't work. Is there something I can do?</p>\n\n<p>gas and search has different controller.\ngas controller</p>\n\n<pre><code>@Gases = {'Carbon Dioxide [CO2]' =&gt; \"CO2\", .......}\n</code></pre>\n\n<p>gas view</p>\n\n<pre><code>&lt;%= f.select :gas, @Gases.keys%&gt;\n\n</code></pre>\n\n<p>I tried this but it doesn't work\nSearch model</p>\n\n<pre><code>sensors = sensors.where(\"lower(gas.value(key)) LIKE lower(?)\", \"%#{gas}%\")\n\n</code></pre>\n"}, {"tags": ["ruby", "api", "plaid"], "answers": [{"tags": [], "owner": {"reputation": 512, "user_id": 1344643, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/a704ac9164ba2b46c8109fcf598e326e?s=128&d=identicon&r=PG", "display_name": "ed_is_my_name", "link": "https://stackoverflow.com/users/1344643/ed-is-my-name"}, "is_accepted": false, "score": 1, "last_activity_date": 1567129219, "creation_date": 1567129219, "answer_id": 57719501, "question_id": 57684362, "link": "https://stackoverflow.com/questions/57684362/how-can-i-resolve-the-following-plaid-api-error-internal-error-occurred/57719501#57719501", "title": "How can I resolve the following Plaid API error: &quot;Internal Error Occurred&quot;?", "body": "<p>I found the problem.  The web page that displays the internal error Error, has a response which indicates that my client_id has used too many requests in the 'development' server.  Changing 'development' to 'sandbox' on line 9 fixed the problem for me.</p>\n"}], "owner": {"reputation": 512, "user_id": 1344643, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/a704ac9164ba2b46c8109fcf598e326e?s=128&d=identicon&r=PG", "display_name": "ed_is_my_name", "link": "https://stackoverflow.com/users/1344643/ed-is-my-name"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2364, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1619025303, "creation_date": 1566959889, "question_id": 57684362, "link": "https://stackoverflow.com/questions/57684362/how-can-i-resolve-the-following-plaid-api-error-internal-error-occurred", "title": "How can I resolve the following Plaid API error: &quot;Internal Error Occurred&quot;?", "body": "<p>I'm trying to create a ruby script to download transactions from my bank account using the Plaid API.  I'm using the example app.rb script provided from the plaid GitHub site.  When I run the script, it starts a Sinatra server so I can select and enter my bank account's login credentials.  After adding the 'correct' creds, the web page says <em>\"Internal Error has Occurred - We have been notified of the problem\"</em></p>\n\n<p>My suspicion is that my script edits are wrong.  Does anyone have experience with this?</p>\n\n<p>Here is the portion of the script code getting hit:</p>\n\n<pre><code>1 require 'base64'\n2 require 'date'\n3 require 'json'\n4 require 'plaid'\n5 require 'sinatra'\n6 \n7 set :public_folder, File.dirname(__FILE__) + '/static'\n8 \n9 client = Plaid::Client.new(env: 'development',#ENV['PLAID_ENV'],\n10.client_id: 'myClientIDHere',#ENV['PLAID_CLIENT_ID'],\n11 secret: 'mySecretHere',#ENV['PLAID_SECRET'],\n12 public_key: 'myPublicKeyHere)#ENV['PLAID_PUBLIC_KEY'])\n13 access_token = nil\n14 \n15 get '/' do\n16   erb :index\n17 end\n18 \n19 # Exchange token flow - exchange a Link public_token for\n20 # an API access_token\n21 # https://plaid.com/docs/#exchange-token-flow\n22 post '/get_access_token' do\n23   exchange_token_response =\n24     client.item.public_token.exchange(params['public_token'])\n25   access_token = exchange_token_response['access_token']\n26   pretty_print_response(exchange_token_response)\n27 \n28   content_type :json\n29   exchange_token_response.to_json\n30 end\n</code></pre>\n"}, {"tags": ["regex", "ruby", "jekyll", "liquid"], "comments": [{"owner": {"reputation": 481662, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1566976169, "post_id": 57684073, "comment_id": 101818722, "body": "Any regex with <code>.*</code> or <code>.*?</code> or <code>\\G</code> is wrong because the start and end delimiter are identical here (<code>&quot;</code>) and it is not possible to do this replacement without a callback. More, it looks like HTML, do not parse HTML with regex, parse with the DOM parser and use regex against plain text values."}, {"owner": {"reputation": 4946, "user_id": 2656614, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/rJz0Z.png?s=128&g=1", "display_name": "Addison", "link": "https://stackoverflow.com/users/2656614/addison"}, "reply_to_user": {"reputation": 481662, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1566976375, "post_id": 57684073, "comment_id": 101818815, "body": "@WiktorStribi\u017cew - It can be done, provided that there aren&#39;t any escaped <code>&quot;</code> symbols. If there&#39;s an example for which my regex breaks, I&#39;d like to see it, so I can fix it."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 11986599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e0b4a60c686cdf004cd6f958849910f?s=128&d=identicon&r=PG&f=1", "display_name": "hoylehoyle", "link": "https://stackoverflow.com/users/11986599/hoylehoyle"}, "edited": false, "score": 1, "creation_date": 1567007624, "post_id": 57684996, "comment_id": 101836514, "body": "Thank you very much Emma for your help! This worked for my particular case. I have much to learn and am excited to begin my regex journey. Have a great day."}], "tags": [], "owner": {"reputation": 1, "user_id": 6553328, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/omcAX.jpg?s=128&g=1", "display_name": "Emma", "link": "https://stackoverflow.com/users/6553328/emma"}, "is_accepted": true, "score": 0, "last_activity_date": 1566966100, "last_edit_date": 1592644375, "creation_date": 1566965771, "answer_id": 57684996, "question_id": 57684073, "link": "https://stackoverflow.com/questions/57684073/how-do-i-use-a-regular-expression-to-select-liquid-tags-within-quotation-marks/57684996#57684996", "title": "How do I use a regular expression to select liquid tags within quotation marks, but not necessarily following/followed by quotation marks", "body": "<p>I'm guessing that maybe you might be trying to write an expression similar to:</p>\n<pre><code>(?=.*&quot;)-%|(?=.*&quot;)%-\n</code></pre>\n<p>and replace it with <code>%</code>.</p>\n<h3><a href=\"https://regex101.com/r/fIAULy/1/\" rel=\"nofollow noreferrer\">Demo</a></h3>\n<p><code>(?=.*&quot;)</code> will check for at least a <code>&quot;</code> in the line, which you can change that.</p>\n"}, {"comments": [{"owner": {"reputation": 481662, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1566976721, "post_id": 57685185, "comment_id": 101818963, "body": "See the <a href=\"https://regex101.com/r/ulrE2a/1\" rel=\"nofollow noreferrer\">most common scenario breaking the regex</a>. Do not try to fix it with regex, it makes no sense, one must use a DOM parser for such delimited text manipulation."}], "tags": [], "owner": {"reputation": 4946, "user_id": 2656614, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/rJz0Z.png?s=128&g=1", "display_name": "Addison", "link": "https://stackoverflow.com/users/2656614/addison"}, "is_accepted": false, "score": 0, "last_activity_date": 1566978012, "last_edit_date": 1566978012, "creation_date": 1566967349, "answer_id": 57685185, "question_id": 57684073, "link": "https://stackoverflow.com/questions/57684073/how-do-i-use-a-regular-expression-to-select-liquid-tags-within-quotation-marks/57685185#57685185", "title": "How do I use a regular expression to select liquid tags within quotation marks, but not necessarily following/followed by quotation marks", "body": "<p>Took a while, but here is a perfect regex for your problem:</p>\n\n<p>Find:</p>\n\n<pre><code>((?&lt;pad&gt;\\A[^\"]*\"[^\"]*?|\\G[^\"{}]*|\\G\"[^\"]*\")(((?&lt;start&gt;\\{%)-(?&lt;content&gt;[^\"]*?)-(?&lt;end&gt;%\\}))|(?&lt;pad2&gt;[^\"{}%]*)))\n</code></pre>\n\n<p>Replace:</p>\n\n<pre><code>${pad}${pad2}${start}${content}${end}\n</code></pre>\n\n<p>Explanation:</p>\n\n<p>This regex will search from the start of the string for a quote (<code>\"</code>). Upon finding one, it will search for tags, and save them in groups (without the <code>-</code> symbols), and substitute them in. It will keep doing this until it finds another quote.</p>\n\n<p>When it finds an ending quote, it will ignore everything until the next starting quote, upon which it starts the pattern again.</p>\n\n<p><a href=\"https://regex101.com/r/S0XL06/2\" rel=\"nofollow noreferrer\">Try it online!</a></p>\n"}], "owner": {"reputation": 11, "user_id": 11986599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e0b4a60c686cdf004cd6f958849910f?s=128&d=identicon&r=PG&f=1", "display_name": "hoylehoyle", "link": "https://stackoverflow.com/users/11986599/hoylehoyle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 1, "closed_date": 1566982584, "accepted_answer_id": 57684996, "answer_count": 2, "score": 0, "last_activity_date": 1567007524, "creation_date": 1566956726, "last_edit_date": 1567007524, "question_id": 57684073, "link": "https://stackoverflow.com/questions/57684073/how-do-i-use-a-regular-expression-to-select-liquid-tags-within-quotation-marks", "closed_reason": "Needs more focus", "title": "How do I use a regular expression to select liquid tags within quotation marks, but not necessarily following/followed by quotation marks", "body": "<p>I'd like to select all occurrences of the following liquid tags:</p>\n\n<pre><code>{%-\n\n-%}\n</code></pre>\n\n<p>when they occur within quotation marks but not necessarily immediately following or followed by quotation marks.</p>\n\n<p>Attempted several, think I am getting closer with:  <code>(?&lt;=\")({%-)(?=\")</code></p>\n\n<p>Very new to regex - I appreciate your help.</p>\n\n<p>Example of what I am attempting to do: </p>\n\n<pre><code>{%- assign foo = true -%}\n\n&lt;span class=\"{%- if foo == true -%} blue{%- else -%} red{%- endif -%}\"&gt;item&lt;/span&gt;\n</code></pre>\n\n<p>then use regex to replace {%- and -%} only if within/next to <code>\"</code>:</p>\n\n<pre><code>{%- assign foo = true -%}   (no replacement)\n\n&lt;span class=\"{% if foo == true %} blue{% else %} red{% endif %}\"&gt;item&lt;/span&gt;  (replaced)\n\n</code></pre>\n\n<p>Thank you very much for your expertise and assistance.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-5", "puma"], "comments": [{"owner": {"reputation": 557, "user_id": 3498996, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/4BYXX.jpg?s=128&g=1", "display_name": "shawnngtq", "link": "https://stackoverflow.com/users/3498996/shawnngtq"}, "reply_to_user": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "edited": false, "score": 0, "creation_date": 1566973584, "post_id": 57683787, "comment_id": 101817660, "body": "@anothermh when I run <code>.&#47;bin&#47;spring stop</code>, it returns <code>Spring is not running</code>"}], "answers": [{"tags": [], "owner": {"reputation": 1288, "user_id": 2257509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b36b7bfc3240c8f5b9e3e3f3acccdfb?s=128&d=identicon&r=PG", "display_name": "YoMan78", "link": "https://stackoverflow.com/users/2257509/yoman78"}, "is_accepted": false, "score": 1, "last_activity_date": 1580919412, "creation_date": 1580919412, "answer_id": 60079899, "question_id": 57683787, "link": "https://stackoverflow.com/questions/57683787/initialize-getaddrinfo-temporary-failure-in-name-resolution-socketerror/60079899#60079899", "title": "`initialize&#39;: getaddrinfo: Temporary failure in name resolution (SocketError)", "body": "<p>I had to use bundle exec puma -b 'tcp://0.0.0.0:8080' -b to avoid this issue launching in AWS</p>\n"}], "owner": {"reputation": 557, "user_id": 3498996, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/4BYXX.jpg?s=128&g=1", "display_name": "shawnngtq", "link": "https://stackoverflow.com/users/3498996/shawnngtq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 554, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1580919412, "creation_date": 1566953681, "question_id": 57683787, "link": "https://stackoverflow.com/questions/57683787/initialize-getaddrinfo-temporary-failure-in-name-resolution-socketerror", "title": "`initialize&#39;: getaddrinfo: Temporary failure in name resolution (SocketError)", "body": "<p>I am unable to <code>rails s</code> all of a sudden. I did not update my ruby or gems.</p>\n\n<p>Here is the error log I'm seeing:</p>\n\n<pre><code>=&gt; Booting Puma\n=&gt; Rails 5.2.3 application starting in development \n=&gt; Run `rails server -h` for more startup options\nPuma starting in single mode...\n* Version 3.12.1 (ruby 2.5.1-p57), codename: Llamas in Pajamas\n* Min threads: 5, max threads: 5\n* Environment: development\nExiting\nTraceback (most recent call last):\n    41: from bin/rails:3:in `&lt;main&gt;'\n    40: from bin/rails:3:in `load'\n    39: from /home/username/Documents/heroku/appname/bin/spring:15:in `&lt;top (required)&gt;'\n    38: from /home/username/.rbenv/versions/2.5.1/lib/ruby/site_ruby/2.5.0/rubygems/core_ext/kernel_require.rb:70:in `require'\n    37: from /home/username/.rbenv/versions/2.5.1/lib/ruby/site_ruby/2.5.0/rubygems/core_ext/kernel_require.rb:70:in `require'\n    36: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/spring-2.0.2/lib/spring/binstub.rb:31:in `&lt;top (required)&gt;'\n    35: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/spring-2.0.2/lib/spring/binstub.rb:31:in `load'\n    34: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/spring-2.0.2/bin/spring:49:in `&lt;top (required)&gt;'\n    33: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/spring-2.0.2/lib/spring/client.rb:30:in `run'\n    32: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/spring-2.0.2/lib/spring/client/command.rb:7:in `call'\n    31: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/spring-2.0.2/lib/spring/client/rails.rb:28:in `call'\n    30: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/spring-2.0.2/lib/spring/client/rails.rb:28:in `load'\n    29: from /home/username/Documents/heroku/appname/bin/rails:9:in `&lt;top (required)&gt;'\n    28: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/activesupport-5.2.3/lib/active_support/dependencies.rb:291:in `require'\n    27: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/activesupport-5.2.3/lib/active_support/dependencies.rb:257:in `load_dependency'\n    26: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/activesupport-5.2.3/lib/active_support/dependencies.rb:291:in `block in require'\n    25: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/bootsnap-1.4.4/lib/bootsnap/load_path_cache/core_ext/kernel_require.rb:30:in `require'\n    24: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/bootsnap-1.4.4/lib/bootsnap/load_path_cache/core_ext/kernel_require.rb:21:in `require_with_bootsnap_lfi'\n    23: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/bootsnap-1.4.4/lib/bootsnap/load_path_cache/loaded_features_index.rb:92:in `register'\n    22: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/bootsnap-1.4.4/lib/bootsnap/load_path_cache/core_ext/kernel_require.rb:22:in `block in require_with_bootsnap_lfi'\n    21: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/bootsnap-1.4.4/lib/bootsnap/load_path_cache/core_ext/kernel_require.rb:22:in `require'\n    20: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/railties-5.2.3/lib/rails/commands.rb:18:in `&lt;top (required)&gt;'\n    19: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/railties-5.2.3/lib/rails/command.rb:46:in `invoke'\n    18: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/railties-5.2.3/lib/rails/command/base.rb:65:in `perform'\n    17: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/thor-0.20.3/lib/thor.rb:387:in `dispatch'\n    16: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/thor-0.20.3/lib/thor/invocation.rb:126:in `invoke_command'\n    15: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/thor-0.20.3/lib/thor/command.rb:27:in `run'\n    14: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/railties-5.2.3/lib/rails/commands/server/server_command.rb:142:in `perform'\n    13: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/railties-5.2.3/lib/rails/commands/server/server_command.rb:142:in `tap'\n    12: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/railties-5.2.3/lib/rails/commands/server/server_command.rb:147:in `block in perform'\n    11: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/railties-5.2.3/lib/rails/commands/server/server_command.rb:53:in `start'\n    10: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/rack-2.0.7/lib/rack/server.rb:297:in `start'\n     9: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/puma-3.12.1/lib/rack/handler/puma.rb:73:in `run'\n     8: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/puma-3.12.1/lib/puma/launcher.rb:186:in `run'\n     7: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/puma-3.12.1/lib/puma/single.rb:98:in `run'\n     6: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/puma-3.12.1/lib/puma/runner.rb:153:in `load_and_bind'\n     5: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/puma-3.12.1/lib/puma/binder.rb:90:in `parse'\n     4: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/puma-3.12.1/lib/puma/binder.rb:90:in `each'\n     3: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/puma-3.12.1/lib/puma/binder.rb:106:in `block in parse'\n     2: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/puma-3.12.1/lib/puma/binder.rb:273:in `add_tcp_listener'\n     1: from /home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/puma-3.12.1/lib/puma/binder.rb:273:in `new'\n/home/username/.rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/puma-3.12.1/lib/puma/binder.rb:273:in `initialize': getaddrinfo: Temporary failure in name resolution (SocketError)\n</code></pre>\n\n<p>Here is the github ticket: <a href=\"https://github.com/puma/puma/issues/1909\" rel=\"nofollow noreferrer\">https://github.com/puma/puma/issues/1909</a></p>\n\n<p>Please advise. Thanks.</p>\n"}, {"tags": ["ruby", "winapi", "dll"], "comments": [{"owner": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "edited": false, "score": 0, "creation_date": 1566949231, "post_id": 57683185, "comment_id": 101812997, "body": "this is well known error code <code>HRESULT_FROM_WIN32(ERROR_FILE_NOT_FOUND)</code> - <i>The system cannot find the file specified.</i> so <code>MFPCreateMediaPlayer</code> can not found <code>File.dirname(__FILE__) + filename</code>"}, {"owner": {"reputation": 33, "user_id": 11638381, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-bOZ1UHAugf8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfHL80uQQI1X8wj2zIeCjNjfH_Jpw/mo/photo.jpg?sz=128", "display_name": "Shronk", "link": "https://stackoverflow.com/users/11638381/shronk"}, "reply_to_user": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "edited": false, "score": 0, "creation_date": 1566956733, "post_id": 57683185, "comment_id": 101814079, "body": "@RbMm The error code for that appears to be 0x80030002, not 0x80070002"}, {"owner": {"reputation": 4915, "user_id": 11128312, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ufn85.jpg?s=128&g=1", "display_name": "Strive Sun", "link": "https://stackoverflow.com/users/11128312/strive-sun"}, "edited": false, "score": 0, "creation_date": 1566961102, "post_id": 57683185, "comment_id": 101814774, "body": "error 0x80030002 means %1 could not be found,  I have found the <a href=\"https://windows-hexerror.linestarve.com/0x80030002\" rel=\"nofollow noreferrer\">link</a> that may help you. I hope it will be useful to you."}, {"owner": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "edited": false, "score": 0, "creation_date": 1566974806, "post_id": 57683185, "comment_id": 101818122, "body": "but you wrote in question - <i>0x80070002</i>. so where you typo ? but anyway - different only on <code>FACILITY_STORAGE</code> (3) vs <code>FACILITY_WIN32</code> (7) - the error code in low 16 bytes - this is 2 - <code>ERROR_FILE_NOT_FOUND</code>. read about <a href=\"https://docs.microsoft.com/en-us/office/client-developer/outlook/mapi/hresult\" rel=\"nofollow noreferrer\"><code>HRESULT</code></a> and look <i>winerror.h</i>"}, {"owner": {"reputation": 33, "user_id": 11638381, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-bOZ1UHAugf8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfHL80uQQI1X8wj2zIeCjNjfH_Jpw/mo/photo.jpg?sz=128", "display_name": "Shronk", "link": "https://stackoverflow.com/users/11638381/shronk"}, "edited": false, "score": 0, "creation_date": 1567197506, "post_id": 57683185, "comment_id": 101905885, "body": "I tried hardcoding the exact path to the movie file, and it still returned the error however, so I&#39;m honestly not sure what the issue is at this point?"}, {"owner": {"reputation": 4915, "user_id": 11128312, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ufn85.jpg?s=128&g=1", "display_name": "Strive Sun", "link": "https://stackoverflow.com/users/11128312/strive-sun"}, "edited": false, "score": 0, "creation_date": 1567497558, "post_id": 57683185, "comment_id": 101969984, "body": "@Shronk Ruby is my weakness, so I try to build a project in C++, and I refer to <a href=\"https://docs.microsoft.com/en-us/windows/win32/medfound/getting-started-with-mfplay#playing-a-media-file\" rel=\"nofollow noreferrer\">this</a>.I was able to compile and play video files successfully."}, {"owner": {"reputation": 4915, "user_id": 11128312, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ufn85.jpg?s=128&g=1", "display_name": "Strive Sun", "link": "https://stackoverflow.com/users/11128312/strive-sun"}, "edited": false, "score": 0, "creation_date": 1567497567, "post_id": 57683185, "comment_id": 101969989, "body": "@Shronk <a href=\"https://social.microsoft.com/Forums/en-US/9a5d9557-5047-4af8-847e-6b4d3d6d0deb/error-quot0x80030002-1-could-not-be-foundquot-happens-on-microsoft-forms-20-frmae?forum=Offtopic\" rel=\"nofollow noreferrer\">This case</a> also involves 0x80030002, Although it&#39;s different from your environment, I search other posts quickly. Many of them are frameworks that don&#39;t match. To be honest, I can&#39;t confirm whether the errors are related to frameworks, but this is a direction."}], "owner": {"reputation": 33, "user_id": 11638381, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-bOZ1UHAugf8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfHL80uQQI1X8wj2zIeCjNjfH_Jpw/mo/photo.jpg?sz=128", "display_name": "Shronk", "link": "https://stackoverflow.com/users/11638381/shronk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1566947149, "creation_date": 1566947149, "question_id": 57683185, "link": "https://stackoverflow.com/questions/57683185/mfpcreatemediaplayer-returning-uknown-undocumented-error-code-0x80070002-on-call", "title": "MFPCreateMediaPlayer returning uknown/undocumented error code 0x80070002 on call", "body": "<p>In RPG Maker VX Ace, I'm attempting to write my own video player script out of complete boredom, however, I've run into a bit of a snag. When the game tries to call MFPCreateMediaPlayer from my script, it results in an error code(0x80070002 which doesn't exist in the full list of error codes documented <a href=\"https://www.megos.ch/files/content/diverses/doserrors.txt\" rel=\"nofollow noreferrer\">here.</a></p>\n\n<p>My current code in-script is</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>module Graphics\n  MFPCreateMediaPlayer = Win32API.new(\"Mfplay\", \"MFPCreateMediaPlayer\", \"pilplp\", \"i\")\n  GetActiveWindow = Win32API.new(\"User32\", \"GetActiveWindow\", [], \"L\")\n  CreateWindowExA = Win32API.new(\"User32\", \"CreateWindowExA\", \"lppliiiillpp\", \"l\")\n  GetWindowLongA = Win32API.new(\"User32\", \"GetWindowLongA\", \"li\", \"l\")\n  class &lt;&lt; self\n    def play_movie(filename)\n      @vp ||= {:buffer =&gt; [].pack('x') * 256}\n      p MFPCreateMediaPlayer.call(File.dirname(__FILE__) + filename, 1, 0, nil, GetActiveWindow.call(), nil)\n    end\n  end\nend\n</code></pre>\n\n<p>If there are any ideas as to what this means, it would be <em>incredibly</em> appreciated.</p>\n\n<p>thank you!</p>\n"}, {"tags": ["ruby", "ssl", "rubygems", "bundler"], "comments": [{"owner": {"reputation": 121, "user_id": 13433846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9da2a7fab85a5f5b50b711169eccc5d9?s=128&d=identicon&r=PG&f=1", "display_name": "godsim", "link": "https://stackoverflow.com/users/13433846/godsim"}, "edited": false, "score": 0, "creation_date": 1598009459, "post_id": 57682965, "comment_id": 112325422, "body": "Did you ever find a solution for your problem? I&#39;m currently having the same issue while behind a company proxy with self-signed certs.  See <a href=\"https://stackoverflow.com/questions/63507203\">stackoverflow.com/questions/63507203</a>"}, {"owner": {"reputation": 170, "user_id": 5389125, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MOQuJ.png?s=128&g=1", "display_name": "Rossman", "link": "https://stackoverflow.com/users/5389125/rossman"}, "reply_to_user": {"reputation": 121, "user_id": 13433846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9da2a7fab85a5f5b50b711169eccc5d9?s=128&d=identicon&r=PG&f=1", "display_name": "godsim", "link": "https://stackoverflow.com/users/13433846/godsim"}, "edited": false, "score": 0, "creation_date": 1598295138, "post_id": 57682965, "comment_id": 112406827, "body": "@godsim I did figure out how to configure it but it wasn&#39;t pretty.  I don&#39;t remember exactly what I did at this point, but I believe I had to install CAs in two different places and maybe some other things.  If you want I can go back and look at what I did and post it here."}, {"owner": {"reputation": 121, "user_id": 13433846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9da2a7fab85a5f5b50b711169eccc5d9?s=128&d=identicon&r=PG&f=1", "display_name": "godsim", "link": "https://stackoverflow.com/users/13433846/godsim"}, "edited": false, "score": 0, "creation_date": 1598425876, "post_id": 57682965, "comment_id": 112451207, "body": "Hi, since I&#39;m still stuck with this problem, any help from you would be much appreciated! =)"}], "owner": {"reputation": 170, "user_id": 5389125, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MOQuJ.png?s=128&g=1", "display_name": "Rossman", "link": "https://stackoverflow.com/users/5389125/rossman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 433, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1598003047, "creation_date": 1566944904, "question_id": 57682965, "link": "https://stackoverflow.com/questions/57682965/how-do-i-add-a-certificate-authority-to-bundler", "title": "How do I add a Certificate Authority to bundler?", "body": "<p>I setup a gem repository on a server and am serving it out of HTTPS using a self signed certificate.  I then added the certificate to my ruby installation using the <a href=\"https://bundler.io/v2.0/guides/rubygems_tls_ssl_troubleshooting_guide.html#updating-ca-certificates\" rel=\"nofollow noreferrer\">instructions from the bundler website</a>.  After doing so, I am able to install gems from my repository and from rubygems.org using the \"gem\" command.</p>\n\n<p>However, when I use bundler, I get the following SSL error:</p>\n\n<blockquote>\n  <p>Could not verify the SSL certificate for\n  <a href=\"https://test.server.com:8808/quick/Marshal.4.8/test_gem-0.1.0.gemspec.rz\" rel=\"nofollow noreferrer\">https://test.server.com:8808/quick/Marshal.4.8/test_gem-0.1.0.gemspec.rz</a>.\n  There is a chance you are experiencing a man-in-the-middle attack, but\n  most likely your system doesn't have the CA certificates needed for\n  verification. For information about OpenSSL certificates, see\n  [BITLY URL to <a href=\"http://railsapps.github.io/openssl-certificate-verify-failed.html]\" rel=\"nofollow noreferrer\">http://railsapps.github.io/openssl-certificate-verify-failed.html]</a>. To connect without using SSL, edit your\n  Gemfile sources and change 'https' to 'http'.</p>\n</blockquote>\n\n<p>In the <a href=\"https://bundler.io/v1.16/bundle_config.html\" rel=\"nofollow noreferrer\">bundler configuration documentation</a> I found the \"ssl_ca_cert\" configuration item.  However, this configuration item seems to replace whatever CAs bundler is originally using so I can't simply set this to my servers certificate.  Doing so makes it so bundler reports the same error when trying to download gems from rubygems.org.</p>\n\n<p>The documentation says you can set this to a directory.  However, it doesn't look like bundler will traverse down subdirectories looking for CAs.  In version of ruby I'm using, it looks like the gem CAs are stored in subdirectories of the \"rubygems/ssl_certs\" directory therefore setting the ssl_ca_cert option to the \"rubygems/ssl_certs\" directory doesn't help.</p>\n\n<p>How can I add my certificate to bundler so it can verify my repository site AND be able to download gems from rubygems.org?</p>\n\n<p>FYI, I'm using the following:</p>\n\n<ul>\n<li>RHEL 7</li>\n<li>MRI 2.5.1</li>\n<li>Bundler 1.16.2</li>\n</ul>\n"}, {"tags": ["ruby", "class", "methods", "controller", "dry"], "comments": [{"owner": {"reputation": 25637, "user_id": 6243352, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/715f60f9edc65642a6805752cfeebb27?s=128&d=identicon&r=PG&f=1", "display_name": "ggorlen", "link": "https://stackoverflow.com/users/6243352/ggorlen"}, "edited": false, "score": 0, "creation_date": 1566943655, "post_id": 57682761, "comment_id": 101811984, "body": "Welcome to SO! Seems pretty DRY to me too &#175;\\_(\u30c4)_/&#175;. <code>create</code> and <code>update</code> are pretty similar, but I think it&#39;d be a bit premature and obfuscative to dump them into a helper with tons of params and a tiny body. I&#39;d say head to Code Review but <a href=\"https://codereview.stackexchange.com/help/on-topic\">you have to be the author of the code</a> for that to work."}, {"owner": {"reputation": 52, "user_id": 11846872, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oFe1g.png?s=128&g=1", "display_name": "coolnuhman", "link": "https://stackoverflow.com/users/11846872/coolnuhman"}, "reply_to_user": {"reputation": 25637, "user_id": 6243352, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/715f60f9edc65642a6805752cfeebb27?s=128&d=identicon&r=PG&f=1", "display_name": "ggorlen", "link": "https://stackoverflow.com/users/6243352/ggorlen"}, "edited": false, "score": 0, "creation_date": 1567045578, "post_id": 57682761, "comment_id": 101847914, "body": "I appreciate the response @ggorlen. I will run it by my TA tomorrow."}], "answers": [{"comments": [{"owner": {"reputation": 52, "user_id": 11846872, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oFe1g.png?s=128&g=1", "display_name": "coolnuhman", "link": "https://stackoverflow.com/users/11846872/coolnuhman"}, "edited": false, "score": 0, "creation_date": 1567045734, "post_id": 57686067, "comment_id": 101847940, "body": "Thanks @BobRhodes. I am going to try to implement some of your suggestions."}], "tags": [], "owner": {"reputation": 5580, "user_id": 490454, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RqygM.jpg?s=128&g=1", "display_name": "BobRodes", "link": "https://stackoverflow.com/users/490454/bobrodes"}, "is_accepted": false, "score": 0, "last_activity_date": 1566974562, "last_edit_date": 1566974562, "creation_date": 1566972721, "answer_id": 57686067, "question_id": 57682761, "link": "https://stackoverflow.com/questions/57682761/how-do-i-refactor-this-block-of-code-to-make-it-dry/57686067#57686067", "title": "How do I refactor this block of code to make it dry", "body": "<p>I have to guess a bit about what's in your <code>ApplicationController</code> and <code>User</code> classes. But the obviously repeated code is <code>@user = User.find(params[:id])</code>. Your <code>show</code> and <code>edit</code> methods both just run this line. So, they do exactly the same thing, which they oughtn't to do. One method for one thing. </p>\n\n<p>Also, once you resolve <code>show</code> and <code>edit</code> into a single method, your <code>create</code>, <code>update</code> and <code>destroy</code> methods should call it instead of repeating the line.</p>\n\n<p>Next, I wouldn't use <code>new</code> as a method name, since it is already used by <code>BasicObject::new</code>. I tested a few things and it gets pretty unclear:</p>\n\n<pre><code>class Test\n  attr_reader :test\n  def initialize\n    @test = 'test'\n  end\nend\n\nclass Test2\n  attr_reader :test2\n  def new\n    p 'test2new'\n    @test2 = Test.new\n  end\nend\n\ntestx = Test2.new\np testx.new.test\np testx.test2.test\n\n=&gt; \"test2new\"\n=&gt; \"test\"\n=&gt; \"test\" \n</code></pre>\n\n<p>It takes extra effort to see when you're calling your own <code>new</code> method and when you're calling <code>BasicObject::new</code>. So, I'd change that to <code>new_user</code> or something, if you even need it at all \u2014 I don't see why you need both it and your <code>create</code> method. (If you don't need it, get rid of it.)</p>\n\n<p>Finally, <code>@user = User.find(params[:id])</code> doesn't imply either showing or editing, so understanding what you're trying to do and coming up with a name that reflects it (e.g. <code>set_user_id</code>) is something that ought to be done as well.</p>\n"}, {"comments": [{"owner": {"reputation": 52, "user_id": 11846872, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oFe1g.png?s=128&g=1", "display_name": "coolnuhman", "link": "https://stackoverflow.com/users/11846872/coolnuhman"}, "edited": false, "score": 0, "creation_date": 1567045881, "post_id": 57690683, "comment_id": 101847968, "body": "Thanks for the response. I will see if I can do something similar to what you suggested. @mariotux"}], "tags": [], "owner": {"reputation": 36, "user_id": 1753044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8970202d04b38247284101875ac06ed6?s=128&d=identicon&r=PG", "display_name": "mariotux", "link": "https://stackoverflow.com/users/1753044/mariotux"}, "is_accepted": false, "score": 1, "last_activity_date": 1566989274, "creation_date": 1566989274, "answer_id": 57690683, "question_id": 57682761, "link": "https://stackoverflow.com/questions/57682761/how-do-i-refactor-this-block-of-code-to-make-it-dry/57690683#57690683", "title": "How do I refactor this block of code to make it dry", "body": "<p>IMHO you can do something like that.</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>class UsersController &lt; ApplicationController\n  include ExceptionHandling\n  before_action :load_user, only: [:show, :edit, :update, :destroy]\n  after_action :slack_notify_channel, only: [:create, :update, :destroy]\n\n  def index\n    @users = User.all\n  end\n\n  def new\n    @user = User.new\n  end\n\n  def create\n    @user = User.create!(user_params)\n    respond_to do |format|\n      format.html { redirect_to @user, notice: 'User was successfully created.' }\n      format.json { render :show, status: :created, location: @user }\n    end\n  end\n\n  def update\n    @user.update!(user_params)\n    respond_to do |format|\n      format.html { redirect_to @user, notice: 'User was successfully updated.' }\n      format.json { render :show, status: :ok, location: @user }\n    end\n  end\n\n  def destroy\n    @user.destroy!\n    respond_to do |format|\n      format.html { redirect_to users_url, notice: 'User was successfully destroyed.' }\n      format.json { head :no_content }\n    end\n  end\n\n  private\n\n  def load_user\n    @user = User.find(params[:id])\n  end\n\n  def slack_notify_channel\n    Slack.notify_channel\n  end\n\n  def user_params\n    params.require(:user).permit(:username, :email)\n  end\nend\n\n</code></pre>\n\n<p>I would recommend you to create a concern to manage exceptions and render each specific error by exception. Then you can avoid having two ways in each action to render a good and bad case.</p>\n"}], "owner": {"reputation": 52, "user_id": 11846872, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oFe1g.png?s=128&g=1", "display_name": "coolnuhman", "link": "https://stackoverflow.com/users/11846872/coolnuhman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1566989274, "creation_date": 1566943207, "last_edit_date": 1566949996, "question_id": 57682761, "link": "https://stackoverflow.com/questions/57682761/how-do-i-refactor-this-block-of-code-to-make-it-dry", "title": "How do I refactor this block of code to make it dry", "body": "<p>How do I go about making this code block dry?\nI understand that dry means dont repeat yourself but I don't see any obvious opportunity for refactoring. </p>\n\n<p>Index, show, edit, and create seem like basic/necessary methods. They appear to be pretty dry to me.</p>\n\n<p>The methods after I am not sure about. </p>\n\n<p>I haven't tried anything other than googling so far. </p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>class UsersController &lt; ApplicationController\n\n  def index\n    @users = User.all\n  end\n\n  def show\n    @user = User.find(params[:id])\n  end\n\n  def new\n    @user = User.new\n  end\n\n  def edit\n    @user = User.find(params[:id])\n  end\n\n  def create\n    @user = User.new(user_params)\n\n    respond_to do |format|\n      if @user.save\n        format.html { redirect_to @user, notice: 'User was successfully created.' }\n        format.json { render :show, status: :created, location: @user }\n      else\n        format.html { render :new }\n        format.json { render json: @user.errors, status: :unprocessable_entity }\n      end\n    end\n\n    Slack.notify_channel \n  end\n\n  def update\n    @user = User.find(params[:id])\n\n    respond_to do |format|\n      if @user.update(user_params)\n        format.html { redirect_to @user, notice: 'User was successfully updated.' }\n        format.json { render :show, status: :ok, location: @user }\n      else\n        format.html { render :edit }\n        format.json { render json: @user.errors, status: :unprocessable_entity }\n      end\n    end\n\n    Slack.notify_channel\n  end\n\n  def destroy\n    @user = User.find(params[:id])\n\n    @user.destroy\n    respond_to do |format|\n      format.html { redirect_to users_url, notice: 'User was successfully destroyed.' }\n      format.json { head :no_content }\n    end\n\n    Slack.notify_channel\n  end\n\n  private\n    def user_params\n      params.require(:user).permit(:username, :email)\n    end\nend\n</code></pre>\n\n<p>There is no rails backend attached to this code snippet. I am assuming it is just theoretical - wanting us to refactor the code to make it shorter.</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "answers": [{"tags": [], "owner": {"reputation": 3926, "user_id": 2190621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c464f439212bca87517b234f7c9bd3e?s=128&d=identicon&r=PG&f=1", "display_name": "demir", "link": "https://stackoverflow.com/users/2190621/demir"}, "is_accepted": true, "score": 2, "last_activity_date": 1566976608, "last_edit_date": 1566976608, "creation_date": 1566942238, "answer_id": 57682610, "question_id": 57682556, "link": "https://stackoverflow.com/questions/57682556/activerecordrecordinvalid-validation-failed-account-must-exist/57682610#57682610", "title": "ActiveRecord::RecordInvalid Validation failed: Account must exist", "body": "<p>With <strong>Rails 5</strong>, <code>belongs_to</code> association is required by default. So you should make the account optional.</p>\n\n<pre><code>belongs_to :account, optional: true\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 12437774, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GDxm2.jpg?s=128&g=1", "display_name": "kam kara", "link": "https://stackoverflow.com/users/12437774/kam-kara"}, "is_accepted": false, "score": 0, "last_activity_date": 1578503237, "creation_date": 1578503237, "answer_id": 59650677, "question_id": 57682556, "link": "https://stackoverflow.com/questions/57682556/activerecordrecordinvalid-validation-failed-account-must-exist/59650677#59650677", "title": "ActiveRecord::RecordInvalid Validation failed: Account must exist", "body": "<p>Thank you @demir for that answer, I had been dealing with this problem for 3 days.\nNow, I would like to share the way I did to debug this problem.\nStep 1:\ncreate a user in the console to undertand the problem:</p>\n\n<pre><code>@u=User.new(\"id\"=&gt;\"2030\",\"username\"=&gt;\"kam corner\",\"email\"=&gt; \"corner@gmail.com\",\"contact\"=&gt; \"78542036\",\"status\"=&gt; \"1\",\"password\"=&gt; \"corneroftiassale\",\"password_confirmation\"=&gt; \"corneroftiassale\")\n</code></pre>\n\n<p>=> #</p>\n\n<p><em>Note: i save the new user on variable @u, because i want to user after to save</em></p>\n\n<p>2:<code>irb(main):004:0&gt; @u.save!\n</code></p>\n\n<p>importat: see the errors message.\non my use case,i get:</p>\n\n<p>`User Exists (1.6ms)  SELECT  1 AS one FROM \"users\" WHERE \"users\".\"email\" = $1 LIMIT $2  [[\"email\", \"corner@gmail.com\"], [\"LIMIT\", 1]]\n   (0.4ms)  ROLLBACK\nTraceback (most recent call last):\n        1: from (irb):8\nActiveRecord::RecordInvalid (Validation failed: Level must exist)</p>\n\n<p>` \nstep 3: get the error message to debug:</p>\n\n<pre><code>irb(main):009:0&gt; @u.save.errors\n</code></pre>\n\n<p>for see the errors\nand  @u.errors.details\n=> {:level=>[{:error=>:blank}]}</p>\n\n<p>summary:\ntry to create the new user on console,  use the SAVE! method, when you get errors,\ntry the @VARIABLE_USE__TO_CREATE_USER.errors.details.\nagaint thank you @demir</p>\n"}], "owner": {"reputation": 25, "user_id": 11986017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d94891fad2fcdb9df6edec1e2d3e82a?s=128&d=identicon&r=PG&f=1", "display_name": "bottles", "link": "https://stackoverflow.com/users/11986017/bottles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 529, "favorite_count": 0, "accepted_answer_id": 57682610, "answer_count": 2, "score": 2, "last_activity_date": 1578503237, "creation_date": 1566941814, "last_edit_date": 1592644375, "question_id": 57682556, "link": "https://stackoverflow.com/questions/57682556/activerecordrecordinvalid-validation-failed-account-must-exist", "title": "ActiveRecord::RecordInvalid Validation failed: Account must exist", "body": "<p>Using ruby 2.6 &amp; rails 5.2\nUser creation in rails console raises</p>\n<pre class=\"lang-rb prettyprint-override\"><code>ActiveRecord::RecordInvalid (Validation failed: Account must exist)\n</code></pre>\n<p>I just generated Devise User, so there is no user_controller for now</p>\n<h1>models</h1>\n<h3>user.rb</h3>\n<pre class=\"lang-rb prettyprint-override\"><code>class User &lt; ApplicationRecord\n   belongs_to :account\nend\n</code></pre>\n<h3>account.rb</h3>\n<pre class=\"lang-rb prettyprint-override\"><code>class Account &lt; ApplicationRecord\n    has_many :users\nend\n</code></pre>\n<h1>controllers</h1>\n<h3>accounts_controller.rb</h3>\n<pre class=\"lang-rb prettyprint-override\"><code>class AccountsController &lt; ApplicationContoller\n     def new                     \n       redirect_to root_path       \n       unless current_user.account.nil?\n       @account = Account.new       \n    end\n     def create                   \n      @account = Account.new(account_params)          \n      if @account.save            \n      current_user.account = @account                     \n      current_user.save\n      redirect_to root_path, success: &quot;Your account has been created!&quot;               \n  else                         \n      render :new                  \n    end                        \n  end\n........\nend\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "rubygems", "ruby-on-rails-5"], "comments": [{"owner": {"reputation": 56502, "user_id": 271475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b00f41e5f2a69734051f2a78f4f3785?s=128&d=identicon&r=PG", "display_name": "Chris Heald", "link": "https://stackoverflow.com/users/271475/chris-heald"}, "edited": false, "score": 0, "creation_date": 1566941574, "post_id": 57681966, "comment_id": 101811455, "body": "Try using <code>DEBUG_RESOLVER=1 bundle --verbose</code> to see what it&#39;s trying to resolve and where it&#39;s getting stuck."}, {"owner": {"reputation": 3995, "user_id": 1297248, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/TiaMw.jpg?s=128&g=1", "display_name": "Batman", "link": "https://stackoverflow.com/users/1297248/batman"}, "reply_to_user": {"reputation": 56502, "user_id": 271475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b00f41e5f2a69734051f2a78f4f3785?s=128&d=identicon&r=PG", "display_name": "Chris Heald", "link": "https://stackoverflow.com/users/271475/chris-heald"}, "edited": false, "score": 0, "creation_date": 1566944971, "post_id": 57681966, "comment_id": 101812277, "body": "Not sure what&#39;s happening: <a href=\"https://pastebin.com/EhG9VVas\" rel=\"nofollow noreferrer\">pastebin.com/EhG9VVas</a>"}, {"owner": {"reputation": 579, "user_id": 4251975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e702c6ee92d30ba83aea6f0b064a084?s=128&d=identicon&r=PG", "display_name": "Yurii", "link": "https://stackoverflow.com/users/4251975/yurii"}, "edited": false, "score": 0, "creation_date": 1566945307, "post_id": 57681966, "comment_id": 101812360, "body": "Do you have <code>Gemfile.lock</code> within the project?"}, {"owner": {"reputation": 3995, "user_id": 1297248, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/TiaMw.jpg?s=128&g=1", "display_name": "Batman", "link": "https://stackoverflow.com/users/1297248/batman"}, "edited": false, "score": 0, "creation_date": 1566945522, "post_id": 57681966, "comment_id": 101812409, "body": "I&#39;ve removed it."}], "owner": {"reputation": 3995, "user_id": 1297248, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/TiaMw.jpg?s=128&g=1", "display_name": "Batman", "link": "https://stackoverflow.com/users/1297248/batman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 399, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1566944982, "creation_date": 1566938412, "last_edit_date": 1566944982, "question_id": 57681966, "link": "https://stackoverflow.com/questions/57681966/ruby-on-rails-stuck-on-resolving-gems", "title": "Ruby on Rails Stuck on Resolving Gems", "body": "<p>Trying to revive an old project and I'm just seeing: </p>\n\n<pre><code> bundle install\nThe git source `git://github.com/galetahub/ckeditor.git` uses the `git` protocol, which transmits data without encryption. Disable this warning with `bundle config git.allow_insecure true`, or switch to the `https` protocol to keep your data secure.\nFetching https://github.com/stripe/stripe-ruby\nFetching git://github.com/galetahub/ckeditor.git\nFetching gem metadata from https://rubygems.org/........\nFetching gem metadata from https://rubygems.org/.\nResolving dependencies......................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................\n</code></pre>\n\n<p>Gem File: </p>\n\n<pre><code>source \"https://rubygems.org\"\n\ngem 'rails'\ngem 'bcrypt'\ngem 'carrierwave'\ngem 'mini_magick'\ngem 'fog'\ngem 'will_paginate'\ngem 'bootstrap-will_paginate'\ngem 'bootstrap-sass'\ngem 'sass-rails'\ngem 'uglifier'\ngem 'coffee-rails'\ngem 'jquery-rails'\ngem 'jbuilder'\ngem 'sdoc'\ngem 'google-analytics-rails'\ngem 'slack-notifier'\n\n# Installed by Kessy\ngem 'momentjs-rails'\ngem 'bootstrap3-datetimepicker-rails'\ngem 'hirb' # Better irb console output\ngem 'devise'\ngem 'omniauth-facebook'\ngem 'omniauth-google-oauth2'\ngem 'figaro'\ngem 'rails_admin'\ngem 'simple_form'\ngem 'paperclip'\ngem 'countries'\ngem 'delayed_paperclip'\ngem 'aws-sdk', '~&gt; 3.0', '&gt;= 3.0.1'\ngem 's3_direct_upload'\ngem 'faker'\ngem 'populator'\ngem 'friendly_id'\ngem 'select2-rails'\ngem 'best_in_place'\ngem 'decent_exposure'\ngem 'geocoder'\ngem 'squeel'\ngem 'gmaps4rails'\ngem 'stripe', git: 'https://github.com/stripe/stripe-ruby'\ngem 'pghero'\ngem 'modernizr-rails'\ngem 'pundit'\ngem 'jquery-fileupload-rails'\ngem 'gritter'\ngem 'high_voltage'\ngem 'ckeditor', github: 'galetahub/ckeditor'\ngem 'jquery-datatables-rails'\ngem 'active_model_serializers'\ngem 'delayed_job_active_record'\ngem 'daemons'\ngem 'money'\ngem 'money-rails'\ngem 'formvalidation-rails'\ngem 'date_validator'\ngem 'autoprefixer-rails'\ngem 'has_secure_token'\ngem 'bootstrap_tokenfield_rails'\ngem 'country_select'\ngem 'seedbank'\ngem 'sidekiq'\ngem 'sinatra', require: false\ngem 'slim'\ngem 'newrelic_rpm'\ngem 'rollbar'\ngem 'oj'\ngem 'pgbackups-archive'\n\ngroup :development, :test do\n  gem 'byebug'\n  gem 'web-console'\n  gem 'spring'\n  gem 'pry'\n\n  # Added by Kessy\n  gem 'pry-rails'\n  gem 'awesome_print'\n  gem 'rails-dev-boost'\n  gem 'better_errors'\n  gem 'binding_of_caller'\n  gem 'meta_request'\n  gem 'quiet_assets'\n  gem 'bullet'\n  gem 'brakeman'\nend\n\ngroup :test do\n  gem 'minitest-reporters'\n  gem 'mini_backtrace'\n  gem 'guard-minitest'\nend\n\ngroup :production do\n  gem 'pg'\n  gem 'rails_12factor'\n  gem 'puma'\nend\n\n# Docs say place at\ngem 'rack-mini-profiler'\n</code></pre>\n\n<p>I'm using Ubuntu 18.04 and Ruby 2.5.1</p>\n\n<p>Pastebin: <a href=\"https://pastebin.com/EhG9VVas\" rel=\"nofollow noreferrer\">https://pastebin.com/EhG9VVas</a></p>\n"}, {"tags": ["javascript", "ruby-on-rails", "ruby", "ajax"], "answers": [{"tags": [], "owner": {"reputation": 579, "user_id": 4251975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e702c6ee92d30ba83aea6f0b064a084?s=128&d=identicon&r=PG", "display_name": "Yurii", "link": "https://stackoverflow.com/users/4251975/yurii"}, "is_accepted": false, "score": 0, "last_activity_date": 1566936687, "creation_date": 1566936687, "answer_id": 57681643, "question_id": 57681422, "link": "https://stackoverflow.com/questions/57681422/rails-update-view-multiple-times-in-1-action/57681643#57681643", "title": "Rails: Update view multiple times in 1 action", "body": "<p>Take a look at <a href=\"https://guides.rubyonrails.org/action_cable_overview.html\" rel=\"nofollow noreferrer\">Action Cable</a>. It allows you to broadcast function execution status to the user. And put mentioned function into background job (it allows you to send messages).</p>\n\n<p>Also, when going to production consider using <a href=\"https://github.com/anycable/anycable\" rel=\"nofollow noreferrer\">AnyCable</a> instead</p>\n"}, {"tags": [], "owner": {"reputation": 71, "user_id": 11980111, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28c5a7835deed750926bee8784616855?s=128&d=identicon&r=PG&f=1", "display_name": "robi932", "link": "https://stackoverflow.com/users/11980111/robi932"}, "is_accepted": false, "score": 0, "last_activity_date": 1566937867, "creation_date": 1566937867, "answer_id": 57681856, "question_id": 57681422, "link": "https://stackoverflow.com/questions/57681422/rails-update-view-multiple-times-in-1-action/57681856#57681856", "title": "Rails: Update view multiple times in 1 action", "body": "<p>You could try to render flash messages(although I'm not really sure it will work).</p>\n\n<p>Usually this is done via websockets or ajax.\nWith websockets you would have an openconnection where you would send events from the be and listen to them from the fe. As MrSnax said, you could use actioncable, This is the best approach, but it is a little more complicated and harder to set up.</p>\n\n<p>The second approach would be with pooling. Make ajax request every 1,2,3...n seconds, what you find fit for your usecase and call a your js when you receive something different from the server.</p>\n"}], "owner": {"reputation": 45, "user_id": 11467874, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zouoo.png?s=128&g=1", "display_name": "Portabello", "link": "https://stackoverflow.com/users/11467874/portabello"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 93, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1566937867, "creation_date": 1566935755, "question_id": 57681422, "link": "https://stackoverflow.com/questions/57681422/rails-update-view-multiple-times-in-1-action", "title": "Rails: Update view multiple times in 1 action", "body": "<p>I am working on a Ruby on Rails (5.2) project. I'm going to be a bit vague on the specifics, as i'm looking for more of a theoretical answer, or suggestion on how to approach this issue rather than a specific solution. In this project I have a button that will initiate a controller action. There is also a field in this same view that displays a 'status' that I want to modify. </p>\n\n<p>Ideally, once the button is clicked, the controller action below is called. ( Assume that the code executed takes time (~10 secs) and cannot be placed in a background job. ) At different points in the functions execution I want to modify a DOM element in the view.</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>class x_Controller &lt; ApplicationController\n    def function_x\n        ...\n        # execute some code\n        ...\n        ( call JS function here w/ msg = 'step 1')\n        ...\n        # execute some code\n        ...\n        ( call JS function here w/ msg = 'step 2')\n        ...\n        # execute some code\n        ...\n        ( call JS function here w/ msg = 'step 3')\n    end\nend\n</code></pre>\n\n<p>The JS function that I want to call just modifies a DOM element.</p>\n\n<pre><code>function start_loading_bar(msg) {\n  $('.progress-message').text(msg + \"...\")\n  $('#progress').fadeIn()\n}\n</code></pre>\n\n<p>From the user's perspective, once the button is clicked, a status bar will pop up at the bottom. At different points of the execution, the message that the status bar displays will change from 'step 1' to 'step 2' to 'step 3' without any additional input from the user.</p>\n\n<p>I have tried multiple approaches to this problem. </p>\n\n<p>Initially I just bound the function to an onclick of the button, however, this method doesnt allow me to modify it after, since the onclick is just triggered once at the start.</p>\n\n<p>Next I tried making a partial that holds the DOM element I want to modify and rendering it with different parameters in the controller action. However you cant have multiple redirect_to / render in a single action and I encountered an error. </p>\n\n<p>I want to know if this is at all possible to do? am I approaching this problem correctly? am I overlooking a better implementation?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-6"], "comments": [{"owner": {"reputation": 2388, "user_id": 3655580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58695ea14f641ae7e2f15b34434fd6a0?s=128&d=identicon&r=PG&f=1", "display_name": "edariedl", "link": "https://stackoverflow.com/users/3655580/edariedl"}, "edited": false, "score": 0, "creation_date": 1566931705, "post_id": 57680527, "comment_id": 101807845, "body": "Do you use Turbolinks?"}, {"owner": {"reputation": 27, "user_id": 11755946, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ewSLsasxQA8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd5dQ4UosDDZNpo96ga7LfQIpiFmA/photo.jpg?sz=128", "display_name": "\u0412\u0438\u043a\u0442\u043e\u0440", "link": "https://stackoverflow.com/users/11755946/%d0%92%d0%b8%d0%ba%d1%82%d0%be%d1%80"}, "reply_to_user": {"reputation": 2388, "user_id": 3655580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58695ea14f641ae7e2f15b34434fd6a0?s=128&d=identicon&r=PG&f=1", "display_name": "edariedl", "link": "https://stackoverflow.com/users/3655580/edariedl"}, "edited": false, "score": 0, "creation_date": 1566931782, "post_id": 57680527, "comment_id": 101807873, "body": "No. i&#39;m use api only mode"}, {"owner": {"reputation": 2388, "user_id": 3655580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58695ea14f641ae7e2f15b34434fd6a0?s=128&d=identicon&r=PG&f=1", "display_name": "edariedl", "link": "https://stackoverflow.com/users/3655580/edariedl"}, "edited": false, "score": 0, "creation_date": 1566932068, "post_id": 57680527, "comment_id": 101808001, "body": "and you call it via javascript? I am not sure, if browser updates displayed cookies (at least safari doesn&#39;t) if they are changed via AJAX, but if you reload the page, browser will show the cookies."}, {"owner": {"reputation": 27, "user_id": 11755946, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ewSLsasxQA8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd5dQ4UosDDZNpo96ga7LfQIpiFmA/photo.jpg?sz=128", "display_name": "\u0412\u0438\u043a\u0442\u043e\u0440", "link": "https://stackoverflow.com/users/11755946/%d0%92%d0%b8%d0%ba%d1%82%d0%be%d1%80"}, "reply_to_user": {"reputation": 2388, "user_id": 3655580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58695ea14f641ae7e2f15b34434fd6a0?s=128&d=identicon&r=PG&f=1", "display_name": "edariedl", "link": "https://stackoverflow.com/users/3655580/edariedl"}, "edited": false, "score": 0, "creation_date": 1566932285, "post_id": 57680527, "comment_id": 101808106, "body": "no. i&#39;m call it via http request with reload"}, {"owner": {"reputation": 2388, "user_id": 3655580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58695ea14f641ae7e2f15b34434fd6a0?s=128&d=identicon&r=PG&f=1", "display_name": "edariedl", "link": "https://stackoverflow.com/users/3655580/edariedl"}, "edited": false, "score": 0, "creation_date": 1566932575, "post_id": 57680527, "comment_id": 101808230, "body": "can you post your code, how you call the rails API?"}, {"owner": {"reputation": 27, "user_id": 11755946, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ewSLsasxQA8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd5dQ4UosDDZNpo96ga7LfQIpiFmA/photo.jpg?sz=128", "display_name": "\u0412\u0438\u043a\u0442\u043e\u0440", "link": "https://stackoverflow.com/users/11755946/%d0%92%d0%b8%d0%ba%d1%82%d0%be%d1%80"}, "reply_to_user": {"reputation": 2388, "user_id": 3655580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58695ea14f641ae7e2f15b34434fd6a0?s=128&d=identicon&r=PG&f=1", "display_name": "edariedl", "link": "https://stackoverflow.com/users/3655580/edariedl"}, "edited": false, "score": 0, "creation_date": 1566932807, "post_id": 57680527, "comment_id": 101808332, "body": "i&#39;m call rails api in browser, GET request without js, through address bar. code updated in question"}, {"owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 0, "creation_date": 1566935339, "post_id": 57680527, "comment_id": 101809297, "body": "Cookies are a concept in the context of browsers. Enabling Rails&#39; API mode removes the necessary <code>ActionDispatch::Cookies</code> and <code>ActionDispatch::Session::CookieStore</code> middlewares from the application."}, {"owner": {"reputation": 27, "user_id": 11755946, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ewSLsasxQA8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd5dQ4UosDDZNpo96ga7LfQIpiFmA/photo.jpg?sz=128", "display_name": "\u0412\u0438\u043a\u0442\u043e\u0440", "link": "https://stackoverflow.com/users/11755946/%d0%92%d0%b8%d0%ba%d1%82%d0%be%d1%80"}, "edited": false, "score": 0, "creation_date": 1566935604, "post_id": 57680527, "comment_id": 101809395, "body": "These modules  is Included, thx for answers"}, {"owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 0, "creation_date": 1566935680, "post_id": 57680527, "comment_id": 101809419, "body": "That is not how you add middlewares to the rack stack..."}], "answers": [{"tags": [], "owner": {"reputation": 3922, "user_id": 3399504, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rRGvW.png?s=128&g=1", "display_name": "ErvalhouS", "link": "https://stackoverflow.com/users/3399504/ervalhous"}, "is_accepted": true, "score": 4, "last_activity_date": 1566935398, "creation_date": 1566935398, "answer_id": 57681360, "question_id": 57680527, "link": "https://stackoverflow.com/questions/57680527/cookies-not-saved-in-rails-6/57681360#57681360", "title": "Cookies not saved in rails 6", "body": "<p>When you use your Rails application on api mode some middlewares that are needed to make cookies work are not included by default. To enable them maintaining api mode, edit your  <code>config/application.rb</code> by adding:</p>\n\n<pre><code># Stuff you application needs\nclass Application &lt; Rails::Application\n  config.middleware.use ActionDispatch::Cookies\n  config.middleware.use ActionDispatch::Session::CookieStore, key: '_namespace_key'\n# Maybe more stuff...\nend\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 11755946, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ewSLsasxQA8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd5dQ4UosDDZNpo96ga7LfQIpiFmA/photo.jpg?sz=128", "display_name": "\u0412\u0438\u043a\u0442\u043e\u0440", "link": "https://stackoverflow.com/users/11755946/%d0%92%d0%b8%d0%ba%d1%82%d0%be%d1%80"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1468, "favorite_count": 0, "closed_date": 1566935626, "accepted_answer_id": 57681360, "answer_count": 1, "score": 0, "last_activity_date": 1566935474, "creation_date": 1566931274, "last_edit_date": 1566935474, "question_id": 57680527, "link": "https://stackoverflow.com/questions/57680527/cookies-not-saved-in-rails-6", "closed_reason": "Duplicate", "title": "Cookies not saved in rails 6", "body": "<p>I am using rails 6.0 in a new project and after that cookies are not set</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code> Include ActionDispatch::Cookies \n Include ActionDispatch::Session::CookieStore \n  before_action :cookie_set\n  def cookie_set\n    cookies[:test] = {value: 'testset'}\n  end\n</code></pre>\n\n<p>browser cookie is empty</p>\n"}, {"tags": ["ruby"], "answers": [{"tags": [], "owner": {"reputation": 3926, "user_id": 2190621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c464f439212bca87517b234f7c9bd3e?s=128&d=identicon&r=PG&f=1", "display_name": "demir", "link": "https://stackoverflow.com/users/2190621/demir"}, "is_accepted": true, "score": 1, "last_activity_date": 1566931087, "creation_date": 1566931087, "answer_id": 57680495, "question_id": 57680398, "link": "https://stackoverflow.com/questions/57680398/how-i-can-solve-this-issue-undefined-method-for-class/57680495#57680495", "title": "How i can solve this issue ? undefined method for class", "body": "<p><code>attr_reader</code> creates only the get method for <code>balance</code>. You need both get and set method for <code>balance</code>. Because you set <code>balance</code> in the initialize method. So, you should use <strong>attr_accessor</strong> instead of <code>attr_reader</code>.</p>\n\n<pre><code>attr_accessor :balance\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 5529550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/803959e478dcc97792ebc00298a46dfa?s=128&d=identicon&r=PG&f=1", "display_name": "Vadym", "link": "https://stackoverflow.com/users/5529550/vadym"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 57680495, "answer_count": 1, "score": 1, "last_activity_date": 1566931087, "creation_date": 1566930528, "question_id": 57680398, "link": "https://stackoverflow.com/questions/57680398/how-i-can-solve-this-issue-undefined-method-for-class", "title": "How i can solve this issue ? undefined method for class", "body": "<p>Have a problem, when run a code allways have error.\nExpect: for the user add win or reduce his balance. </p>\n\n<pre><code>undefined method `balance=' for #&lt;Dice:0x0000563d4d4dfd88 @name=\"foo\", @balance=600, @bet=300&gt;\nDid you mean?  balance\n(repl):22:in `increase_decrease_cash'\n(repl):62:in `&lt;class:Game&gt;'\n(repl):29:in `&lt;main&gt;'\n</code></pre>\n\n<p>This error always comes out, retried everything I could guess, but nothing came of it and I don\u2019t understand how it can be googled</p>\n\n<pre><code>class Dice\n  attr_accessor :name, :bet\n  attr_reader :balance\n  def initialize(name, balance, bet)\n    @name = name\n    @balance = balance\n    @bet = bet\n  end\n\n  def self.roll\n    @roll_dice = rand(1..2)\n  end\n\n  def self.check_bet\n    if @player.bet &gt; @player.balance\n      puts \"Enter number from 1 to #{@player.balance}\"\n    end\n  end\n\n  def self.increase_decrease_cash\n    if @roll == @my_number\n      @player.balance += @player.bet\n    else\n      @player.balance -= @player.bet\n    end\n  end\nend\n\nclass Game &lt; Dice\n  @player = Dice.new(\"foo\", 600, 0)\n  puts \"Hello #{@player.name} your balance is: #{@player.balance}\"\n  puts \"Bones throwing count times\"\n  a = 2 #gets.chomp.to_i\n\n  while a &gt; 0 do\n    puts \"\"\n    puts \"Enter your bet !!!\"\n\n    # PLAYER BET\n    @player.bet = 300 #gets.chomp.to_i\n    check_bet\n    puts \"Respected #{@player.name} your bet is: #{@player.bet}\"\n    puts \"Now select number 1-2\"\n\n    # BONES ROLL\n    @my_number = roll # gets.chomp.to_i\n    puts \"###################\"\n    puts \"Now we throw bones\"\n    @roll = roll\n    puts \"Nuber is #{roll}\"\n\n    if @roll == @my_number\n      puts \"Your win, you get #{@player.bet}\"\n      else\n      puts \"You lose #{@player.bet}\"\n    end\n\n    p \"$$$$\"\n    p @player.balance\n    p \"$$$$\"\n    a -= 1\n    increase_decrease_cash\n  end\nend\n</code></pre>\n\n<p>This error always comes out, retried everything I could guess, but nothing came of it and I don\u2019t understand how it can be googled</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "sidekiq"], "answers": [{"tags": [], "owner": {"reputation": 56502, "user_id": 271475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b00f41e5f2a69734051f2a78f4f3785?s=128&d=identicon&r=PG", "display_name": "Chris Heald", "link": "https://stackoverflow.com/users/271475/chris-heald"}, "is_accepted": false, "score": 3, "last_activity_date": 1566928793, "creation_date": 1566928793, "answer_id": 57680009, "question_id": 57679589, "link": "https://stackoverflow.com/questions/57679589/is-it-possible-a-single-sidekiq-process-running-in-multiple-cores/57680009#57680009", "title": "Is it possible a single Sidekiq Process running in multiple cores?", "body": "<p>I suspect that this is reporting issue caused by some quirk of htop + your CPU scheduler; MRI should only be able to use 1 core's <em>worth</em> of CPU due to the GIL, but the CPU scheduler need not necessarily constrain that to a single logical core; the execution may be spread across multiple cores as the scheduler sees fit.</p>\n\n<p>You can observe this trivially:</p>\n\n<pre><code>ruby -e \"while(1) do end\" &amp;; PID=$!; watch -n 1 ps --pid $PID -o psr; kill $PID\n</code></pre>\n\n<p>As you watch this, you'll see the CPU core the process is running on change over time, though the usage remains at a constant 100%.</p>\n\n<p>To see this in htop:</p>\n\n<pre><code>ruby -e \"4.times.map{Thread.new{while(1) do end}}.map(&amp;:join)\" &amp;; PID=$!; htop -p $PID ; kill $PID\n</code></pre>\n\n<p>You'll notice that in htop, even though your Sidekiq processes are reporting using 50% of a CPU, htop's overall CPU display is showing those cores at only ~30% utilization (at numbers that sum to ~100%!)</p>\n"}], "owner": {"reputation": 11, "user_id": 9346573, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92a80e4183eb041b02c059c6edab53c0?s=128&d=identicon&r=PG&f=1", "display_name": "gkalil", "link": "https://stackoverflow.com/users/9346573/gkalil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1567111996, "creation_date": 1566926808, "last_edit_date": 1567111996, "question_id": 57679589, "link": "https://stackoverflow.com/questions/57679589/is-it-possible-a-single-sidekiq-process-running-in-multiple-cores", "title": "Is it possible a single Sidekiq Process running in multiple cores?", "body": "<p>I'm using Sidekiq in an MRI/YARV Ruby 2.4.6. I expected that each Sidekiq process would be limited to one core, according to the MRI GIL limitation. But it seems that the threads are running in different cores, even with just one Sidekiq process started.</p>\n\n<p>Here is an htop screenshot right after running: bundle exec sidekiq -c 3 -L sidekiq.log -r ./worker.rb</p>\n\n<p><a href=\"https://user-images.githubusercontent.com/4698528/63443969-1c012700-c40c-11e9-85ee-9c4298c98c89.png\" rel=\"nofollow noreferrer\">https://user-images.githubusercontent.com/4698528/63443969-1c012700-c40c-11e9-85ee-9c4298c98c89.png</a></p>\n\n<p>*3 cores are being used</p>\n\n<p>I read that MRI can make use of OS pthreads to run a process in different cores. Is this what is happening? Does this changes common strategies like running multiple Sidekiq processes to use all the processor capacity?</p>\n\n<ul>\n<li>ruby: 2.4.6</li>\n<li>sidekiq: 5.2.7</li>\n<li>os: ubuntu 18.04.3 server running in vbox over a ubuntu 18.04.3 host</li>\n</ul>\n"}, {"tags": ["ruby-on-rails", "ruby", "curl"], "answers": [{"comments": [{"owner": {"reputation": 487, "user_id": 7847797, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh5.googleusercontent.com/-k7pSuJNJeV4/AAAAAAAAAAI/AAAAAAAAApY/6cIE0jxiCM8/photo.jpg?sz=128", "display_name": "jacques Mesnet", "link": "https://stackoverflow.com/users/7847797/jacques-mesnet"}, "edited": false, "score": 0, "creation_date": 1566984105, "post_id": 57687054, "comment_id": 101822852, "body": "That was a stupid error, thanks a lot for your time @dlmb !!"}], "tags": [], "owner": {"reputation": 70, "user_id": 2900550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5bbbfd80f036231249683a2a45291d46?s=128&d=identicon&r=PG&f=1", "display_name": "dlmb", "link": "https://stackoverflow.com/users/2900550/dlmb"}, "is_accepted": true, "score": 1, "last_activity_date": 1566977299, "creation_date": 1566977299, "answer_id": 57687054, "question_id": 57679307, "link": "https://stackoverflow.com/questions/57679307/request-with-curl/57687054#57687054", "title": "Request with -curl", "body": "<p>You're sending the first request to <code>https://api.monkey-locky.com</code> but the URL in the second request is <code>https://api.monkeylocky.com</code> (no dash)</p>\n"}], "owner": {"reputation": 487, "user_id": 7847797, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh5.googleusercontent.com/-k7pSuJNJeV4/AAAAAAAAAAI/AAAAAAAAApY/6cIE0jxiCM8/photo.jpg?sz=128", "display_name": "jacques Mesnet", "link": "https://stackoverflow.com/users/7847797/jacques-mesnet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 57687054, "answer_count": 1, "score": 0, "last_activity_date": 1566977299, "creation_date": 1566925377, "question_id": 57679307, "link": "https://stackoverflow.com/questions/57679307/request-with-curl", "title": "Request with -curl", "body": "<p>I would like to run a curl command to request data from an API, but I'm not sure of how to do it. To transform curl request into ruby code, I'm using <a href=\"https://jhawthorn.github.io/curl-to-ruby/\" rel=\"nofollow noreferrer\">curl to ruby</a>, which is great by the way. </p>\n\n<p>Following the doc API, I have this :</p>\n\n<p>Step 1 (Get your token) : </p>\n\n<pre><code>curl -X POST https://api.monkey-locky.com/login_check -d _username={usr}\n-d _password={pwd}\n</code></pre>\n\n<p>I have translated this by : </p>\n\n<pre><code>require 'net/http'\nrequire 'uri'\n\nuri = URI.parse(\"https://api.monkey-locky.com/login_check\")\nrequest = Net::HTTP::Post.new(uri)\nrequest.set_form_data(\n  \"_password\" =&gt; \"my_secret_pass\",\n  \"_username\" =&gt; \"my@mail.co\",\n)\n\nreq_options = {\n  use_ssl: uri.scheme == \"https\",\n}\n\nresponse = Net::HTTP.start(uri.hostname, uri.port, req_options) do |http|\n  http.request(request)\nend\n\nprint response.body\n</code></pre>\n\n<p>This request give me an Token to use the API.</p>\n\n<p>Step 2 (Verify if the token is working) : </p>\n\n<pre><code>curl -H \"Authorization: Bearer [TOKEN]\" https://api.monkeylocky.com/bookings\n</code></pre>\n\n<p>I have translated this by : </p>\n\n<pre><code>require 'net/http'\nrequire 'uri'\n\nuri = URI.parse(\"https://api.monkeylocky.com/bookings\")\nrequest = Net::HTTP::Get.new(uri)\nrequest[\"Authorization\"] = \"Bearer [TOKEN]\"\n\nreq_options = {\n  use_ssl: uri.scheme == \"https\",\n}\n\nresponse = Net::HTTP.start(uri.hostname, uri.port, req_options) do |http|\n  http.request(request)\nend\n</code></pre>\n\n<p>But this script is rendering an error like this :</p>\n\n<blockquote>\n  <p>`rescue in block in connect': Failed to open TCP connection to\n  api.monkeylocky.com:443 (getaddrinfo: nodename nor servname provided,\n  or not known) (SocketError)</p>\n</blockquote>\n\n<p>I'm not very comfortable with CURL, I'm just starting to use these request. So I'm not sure of what I'm doing right now. Any suggestion about that ?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "session"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 2, "creation_date": 1566924593, "post_id": 57679005, "comment_id": 101805052, "body": "Rails encrypts the session as a client cookie, so there&#39;s no risk of tampering. You can store it in the Rails session and be assured it&#39;s not vulnerable or exposed to the user. Doing server-side opens up a whole bunch of other problems, like how do you deal in multi-server environments?"}, {"owner": {"reputation": 11573, "user_id": 473792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/bwv8P.jpg?s=128&g=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/473792/kevin"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1566930849, "post_id": 57679005, "comment_id": 101807551, "body": "Hmmm... Looking into it, I&#39;m a little wary of <a href=\"https://guides.rubyonrails.org/security.html#replay-attacks-for-cookiestore-sessions\" rel=\"nofollow noreferrer\">cookie replay attacks</a>. A malicious user could obtain a cookie from another user and use that to steal that user&#39;s sensitive information. Encrypted cookies don&#39;t let users easily lie to the server, but is this attack that I&#39;m thinking about plausible?"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1566938786, "post_id": 57679005, "comment_id": 101810568, "body": "If someone&#39;s stealing cookies from someone else then you have bigger problems. Think about your threat models. Are you protecting against the NSA or about Billy in Accounting who&#39;s trying to cheat his time-cards?"}], "owner": {"reputation": 11573, "user_id": 473792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/bwv8P.jpg?s=128&g=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/473792/kevin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 30, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1581425535, "creation_date": 1566923834, "last_edit_date": 1581425535, "question_id": 57679005, "link": "https://stackoverflow.com/questions/57679005/is-there-a-canonical-pattern-for-caching-something-related-to-a-session-on-the-s", "title": "Is there a canonical pattern for caching something related to a session on the server?", "body": "<p>In my Rails app, once per user session, I need to have my server send a request to one of our other services to get some data about the user. I only want to make this request once per session because pinging another service every time the user makes a request will significantly slow down our response time. However, I can't store this information in a cookie client-side. This information has some security implications - if the user has the ability to lie to our server about what this piece of information is, they can gain access to data they're not authorized to see.</p>\n\n<p>So what is the best way to cache or store a piece of data associated with a session on the Rails server?</p>\n\n<p>I'm considering using <a href=\"https://guides.rubyonrails.org/caching_with_rails.html#low-level-caching\" rel=\"nofollow noreferrer\">Rails low-level caching</a>, and I think it might even be correct:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>Rails.cache.fetch(session.id, expires_in: 12.hours) do\n  OtherServiceAPI.get_sensitive_data(user.id)\nend\n</code></pre>\n\n<p>I know that Rails often has one canonical way of doing things, though, so I want to be sure there's not a built-in, officially preferred way to associate a piece of data with a session. <a href=\"https://stackoverflow.com/questions/48362296/can-i-use-rails-cache-to-store-short-lived-session-data\">This question</a> makes it look like there are potential pitfalls using the approach I'm considering as well, although it looks like those concerns may have been made obsolete in newer versions of Rails.</p>\n\n<p>Is there a canonical pattern for what I'm trying to do? Or is the approach I'm considering idiomatic enough?</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 25637, "user_id": 6243352, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/715f60f9edc65642a6805752cfeebb27?s=128&d=identicon&r=PG&f=1", "display_name": "ggorlen", "link": "https://stackoverflow.com/users/6243352/ggorlen"}, "edited": false, "score": 1, "creation_date": 1566923344, "post_id": 57678836, "comment_id": 101804511, "body": "Where does <code>&quot;baz&quot;</code> come from? Can you add an <code>if !v.nil?</code> check?"}, {"owner": {"reputation": 73209, "user_id": 290394, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d7908f05c89e965f6bc5308ad6f41256?s=128&d=identicon&r=PG", "display_name": "steenslag", "link": "https://stackoverflow.com/users/290394/steenslag"}, "edited": false, "score": 1, "creation_date": 1566933349, "post_id": 57678836, "comment_id": 101808535, "body": "Note it is more idiomatic to capitalize classes: <code>S = Struct.new :topic_version</code>"}], "answers": [{"tags": [], "owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "is_accepted": true, "score": 1, "last_activity_date": 1566923456, "creation_date": 1566923456, "answer_id": 57678913, "question_id": 57678836, "link": "https://stackoverflow.com/questions/57678836/iterate-nested-hash-to-get-an-array-of-strings/57678913#57678913", "title": "Iterate nested hash to get an array of strings", "body": "<p>The lazy way here is to use the conditional navigation operator, or in other words:</p>\n\n<pre><code>v&amp;.topic_version\n</code></pre>\n\n<p>Where that returns <code>nil</code> if <code>v</code> is <code>nil</code>.</p>\n\n<p>That's just scratching the surface, though. When you see the pattern:</p>\n\n<pre><code>x = [ ]\ny.each do |z|\n  x &lt;&lt; z.a\nend\n</code></pre>\n\n<p>What you really want is:</p>\n\n<pre><code>x = y.map(&amp;:a)\n</code></pre>\n\n<p>Where <code>map</code> helps transform values in one array to values in another using a 1:1 <em>mapping</em>.</p>\n\n<p>To build up to a solution here first strip out the <code>values</code> from the Hash, then pull the <code>:services</code> key in that nested Hash, then call <code>topic_version</code> on all non-<code>nil</code> entries. Since those can return <code>nil</code>, strip out <code>nil</code> with <code>compact</code> at the end.</p>\n\n<p>In other words:</p>\n\n<pre><code>h.values.map do |v|\n  v[:services]\nend.flat_map do |v|\n  v.compact.map(&amp;:topic_version)\nend.compact\n</code></pre>\n\n<p>Now if you want them unique, add <code>.uniq</code> at the end.</p>\n\n<p>The <code>flat_map</code> here is a way of combining multiple result arrays into a singular final result.</p>\n"}], "owner": {"reputation": 149, "user_id": 11153862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/683c2a17a27dcfd4dabc675f6cf0dff2?s=128&d=identicon&r=PG&f=1", "display_name": "Emily Tui Ch", "link": "https://stackoverflow.com/users/11153862/emily-tui-ch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 57678913, "answer_count": 1, "score": 1, "last_activity_date": 1566935047, "creation_date": 1566923108, "last_edit_date": 1566935047, "question_id": 57678836, "link": "https://stackoverflow.com/questions/57678836/iterate-nested-hash-to-get-an-array-of-strings", "title": "Iterate nested hash to get an array of strings", "body": "<p>I have a nested hash like this:</p>\n\n<pre><code>s = Struct.new :topic_version\n\ns_blank = s.new\ns_bar = s.new \"bar\"\ns_foo = s.new \"foo\"\n\nh = {\n  :aa=&gt;{:services=&gt;[nil, s_blank, s_bar]},\n  :ab=&gt;{:services=&gt;[s_blank, nil, s_bar, s_bar]},\n  :ac=&gt;{:services=&gt;[nil, s_foo, s_blank]}\n} \n</code></pre>\n\n<p>And I'd like to get an array of string values eg. <code>[\"bar\", baz\"]</code></p>\n\n<p>My attempt is:</p>\n\n<pre><code>@topic_version_collection = []\nh.each do |key, value| \n  value[:services].each do |v|\n    @topic_version_collection &lt;&lt; v.topic_version\n  end\nend\n</code></pre>\n\n<p>And it works if there aren't any <code>nil</code> values in the array.</p>\n\n<p>But how can I make it work with nils?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "activerecord"], "comments": [{"owner": {"reputation": 7224, "user_id": 448934, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TXtux.jpg?s=128&g=1", "display_name": "Pascal", "link": "https://stackoverflow.com/users/448934/pascal"}, "reply_to_user": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "edited": false, "score": 0, "creation_date": 1566922483, "post_id": 57678293, "comment_id": 101804144, "body": "@anothe no, will not &quot;return&quot; true if no record found. i&#39;d add parens though."}], "answers": [{"comments": [{"owner": {"reputation": 40732, "user_id": 984621, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/817afccebcbe3a4983a5e8c584f30373?s=128&d=identicon&r=PG", "display_name": "user984621", "link": "https://stackoverflow.com/users/984621/user984621"}, "edited": false, "score": 0, "creation_date": 1566926498, "post_id": 57678713, "comment_id": 101805794, "body": "Hi @Pascal, thank you for the answer. Because the <code>Car</code> model has too many attributes, I converted them with <code>car.attributes.except!(&quot;id&quot;)</code> and it works like a charm. However, is there a way to automatically update also models with the <code>has_many</code> relations?"}, {"owner": {"reputation": 7224, "user_id": 448934, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TXtux.jpg?s=128&g=1", "display_name": "Pascal", "link": "https://stackoverflow.com/users/448934/pascal"}, "reply_to_user": {"reputation": 40732, "user_id": 984621, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/817afccebcbe3a4983a5e8c584f30373?s=128&d=identicon&r=PG", "display_name": "user984621", "link": "https://stackoverflow.com/users/984621/user984621"}, "edited": false, "score": 0, "creation_date": 1566930932, "post_id": 57678713, "comment_id": 101807581, "body": "Can you give more details about the relations you&#39;d want to update?"}, {"owner": {"reputation": 40732, "user_id": 984621, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/817afccebcbe3a4983a5e8c584f30373?s=128&d=identicon&r=PG", "display_name": "user984621", "link": "https://stackoverflow.com/users/984621/user984621"}, "edited": false, "score": 0, "creation_date": 1566935176, "post_id": 57678713, "comment_id": 101809238, "body": "All of them are <code>Car</code> -&gt; has_many -&gt; <code>car_metadata</code> and so on."}], "tags": [], "owner": {"reputation": 7224, "user_id": 448934, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TXtux.jpg?s=128&g=1", "display_name": "Pascal", "link": "https://stackoverflow.com/users/448934/pascal"}, "is_accepted": false, "score": 1, "last_activity_date": 1566930862, "last_edit_date": 1566930862, "creation_date": 1566922612, "answer_id": 57678713, "question_id": 57678293, "link": "https://stackoverflow.com/questions/57678293/rails-how-to-update-existing-record-in-database-with-a-newly-created-object/57678713#57678713", "title": "Rails - how to update existing record in database with a newly created object", "body": "<p>You need to update the existing car with just the attributes, you can not pass in a full model.</p>\n\n<p>Build the attributes, then create or update depending on whether a car exists already:</p>\n\n<pre><code>attributes = {}\nattributes[:color] = ...\nattributes[:brand] = ...\nattributes[:tender_load_id] = ...\n\n\nif (car = Car.where(\"cars.tender_load_id ILIKE ?\", \"%#{attributes[:tender_load_id]}%\").first)\n  car.update(attributes)\nelse\n  Car.create!(attributes)\nend\n</code></pre>\n\n<p>Note 1: It seems there can be multiple cars with the same <code>tender_load_id</code>. This means that the query for existing car will return an arbitrary record. Perhaps you want to add an <code>order</code> to that query.</p>\n\n<p>Note 2: The way you query seems brittle. Isn't there a better ID in the CSV?</p>\n\n<p>Note 3: attributes ending in <code>_id</code> are usually foreign keys. So perhaps find a better name for this attribute.</p>\n"}], "owner": {"reputation": 40732, "user_id": 984621, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/817afccebcbe3a4983a5e8c584f30373?s=128&d=identicon&r=PG", "display_name": "user984621", "link": "https://stackoverflow.com/users/984621/user984621"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566930862, "creation_date": 1566920973, "question_id": 57678293, "link": "https://stackoverflow.com/questions/57678293/rails-how-to-update-existing-record-in-database-with-a-newly-created-object", "title": "Rails - how to update existing record in database with a newly created object", "body": "<p>I am fetching data from CSV files and saving them to the database. Here's the simplified code structure (it's a rake task):</p>\n\n<pre><code>... loading CSV tools...\ncar = Car.new\ncar.tender_load_id = data.element[8]\ncar.brand = data.element[2]\ncar.color = 'green'\n...\ncar.build_car_metadata(mbol: help_var[:mbol], ...)\ncar.first_registration = data.element[21]\n\ncar.skip_registration_code_validation = true # for not creating registration_code\n\nif existing_car = Car.where(\"cars.tender_load_id ILIKE ?\", \"%#{car.tender_load_id}%\").first\n  # car already exists =&gt; update\n  existing_car.update(car)\n  puts \"Car exists, updating car with ID #{existing_car.id}.\"\nelse\n  car.save!            \nend\n</code></pre>\n\n<p>When I run this take task, I get the following error message:</p>\n\n<pre><code>NoMethodError: undefined method `reject' for #&lt;Car:0x007fa3e2063a78&gt;\n</code></pre>\n\n<p>and it points out to this line:</p>\n\n<pre><code>existing_car.update(car)\n</code></pre>\n\n<p>How do I make this work? I unfortunately cannot place the <code>if-else</code> part on the beginning of the rake task, the structure needs to be like this.</p>\n\n<p>Thank you in advance.</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "owner": {"reputation": 196, "user_id": 5204300, "user_type": "registered", "accept_rate": 54, "profile_image": "https://lh4.googleusercontent.com/-6SGS9rCE-sw/AAAAAAAAAAI/AAAAAAAAABE/LsnpNPIvZO0/photo.jpg?sz=128", "display_name": "Carlos G&#243;mez", "link": "https://stackoverflow.com/users/5204300/carlos-g%c3%b3mez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1566918033, "creation_date": 1566916639, "question_id": 57677066, "link": "https://stackoverflow.com/questions/57677066/scope-nested-associations-in-controller-on-rails-5", "title": "Scope nested associations in controller on Rails 5", "body": "<p>I am trying to 'fix' Unscoped Find warnings from brakeman in Rails 5.</p>\n\n<p>the thing is that I have nested relationships and I realized after run brakeman that I can access to any object in database that is unscoped.</p>\n\n<p>I have this relationships in my models:</p>\n\n<pre><code>class Medic &lt; ApplicationRecord\n  has_many :patients, dependent: :destroy\n  validates_associated :patients\nend\n\nclass Patient &lt; ApplicationRecord\n  belongs_to :medic\n  has_many :consultations, dependent: :destroy\n  accepts_nested_attributes_for :consultations\n  validates_associated :consultations\nend\n\nclass Consultation &lt; ApplicationRecord\n  belongs_to :patient\n  has_many :prescriptions, dependent: :destroy\n  accepts_nested_attributes_for :prescriptions\n  validates_associated :prescriptions\nend\n</code></pre>\n\n<p>so, when I try to scope in a callback in controllers, by this way:</p>\n\n<h3>controllers/patients_controller.rb</h3>\n\n<pre><code>  private\n    def set_patient\n      @patient = current_medic.patients.find(params[:id]) # this scope works\n    end\n</code></pre>\n\n<h3>controllers/consultations_controller.rb</h3>\n\n<pre><code>  before_action :set_patient\n  before_action :set_consultation, only: [:show, :edit, :update, :destroy]\n  ...code...\n  private\n    def set_consultation\n      @consultation = @patient.consultations.find(params[:id])\n    end\n\n    def set_patient\n      @patient = current_medic.patients.find_by_id(params[:patient_id])\n    end\n</code></pre>\n\n<p><strong>@consultation = @patient.consultations.find(params[:id])</strong> this scope don't work \"<em>undefined method `consultations' for nil:NilClass</em>\" only work if I do Consultation.find(params[:id]), but in this way anyone can access to any consultation if put X id as parameter /consultations/3 despite that this consultation do not belong to any patient associated to the user</p>\n\n<h3>controllers/prescriptions_controller.rb</h3>\n\n<pre><code>  before_action :set_consultation\n  before_action :set_prescription, only: [:show, :edit, :update, :destroy]\n  ...code...\n  private\n  def set_prescription\n    @prescription = Prescription.find(params[:id]) # the same here, object consultation is 'nil' @consultation.prescriptions.find(params[:id]) won't work\n  end\n\n  def set_consultation\n    @consultation = Consultation.find_by_id(params[:consultation_id])\n  end\n</code></pre>\n\n<p>my tests are failing in show, edit, update and destroy. For example.</p>\n\n<h3>consultations_controller_test.rb with minitest</h3>\n\n<pre><code>  test \"should show consultation\" do\n    get consultation_url(id: @consultation.id)\n    assert_response :success # expected response 2XX but get error 500\n  end\n</code></pre>\n\n<h3>My routes file:</h3>\n\n<pre><code>Rails.application.routes.draw do\n  devise_for :medics\n\n  resources :patients, shallow: true do\n    resources :consultations\n  end\n\n  resources :consultations, shallow: true do\n    resources :prescriptions\n  end\nend\n</code></pre>\n\n<p>How can I scope this nested relationships?</p>\n"}, {"tags": ["ruby", "chef-infra", "chef-recipe"], "comments": [{"owner": {"reputation": 6316, "user_id": 1184717, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/7f8710cd5754a79df5dc5cd3d5308da2?s=128&d=identicon&r=PG", "display_name": "Mr.", "link": "https://stackoverflow.com/users/1184717/mr"}, "edited": false, "score": 0, "creation_date": 1566920129, "post_id": 57676810, "comment_id": 101803033, "body": "does it work for you when you change <code>node.run_state</code> with <code>node.default</code>?"}, {"owner": {"reputation": 1, "user_id": 11984307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74389632b6d5ae335cec72a71e2ea567?s=128&d=identicon&r=PG&f=1", "display_name": "malkaven", "link": "https://stackoverflow.com/users/11984307/malkaven"}, "reply_to_user": {"reputation": 6316, "user_id": 1184717, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/7f8710cd5754a79df5dc5cd3d5308da2?s=128&d=identicon&r=PG", "display_name": "Mr.", "link": "https://stackoverflow.com/users/1184717/mr"}, "edited": false, "score": 0, "creation_date": 1566921327, "post_id": 57676810, "comment_id": 101803616, "body": "No, I get an invalid username/password error.  This makes sense since variables get defined during runtime.  I&#39;m using the CyberArk cookbook in my recipe:  <a href=\"https://supermarket.chef.io/cookbooks/cyberark\" rel=\"nofollow noreferrer\">supermarket.chef.io/cookbooks/cyberark</a> The sample file resource provided on the supermarket site works for me.  I only have issues when I try using the variable in the user/password properties."}, {"owner": {"reputation": 1, "user_id": 11984307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74389632b6d5ae335cec72a71e2ea567?s=128&d=identicon&r=PG&f=1", "display_name": "malkaven", "link": "https://stackoverflow.com/users/11984307/malkaven"}, "reply_to_user": {"reputation": 6316, "user_id": 1184717, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/7f8710cd5754a79df5dc5cd3d5308da2?s=128&d=identicon&r=PG", "display_name": "Mr.", "link": "https://stackoverflow.com/users/1184717/mr"}, "edited": false, "score": 0, "creation_date": 1567682541, "post_id": 57676810, "comment_id": 102040356, "body": "This appears to be a bug.  The user and password properties in execute and powershell_script (more than likely all resources that accept these properties but I haven&#39;t tested others) resources do not honor the lazy evaluation and end it compiling a node.run_state variable which is causing my NoMethodError/compile error.  I&#39;ve been able to call the node.run_state variable in other properties such as command, owner, code, and content in various resources."}, {"owner": {"reputation": 1, "user_id": 11984307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74389632b6d5ae335cec72a71e2ea567?s=128&d=identicon&r=PG&f=1", "display_name": "malkaven", "link": "https://stackoverflow.com/users/11984307/malkaven"}, "reply_to_user": {"reputation": 6316, "user_id": 1184717, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/7f8710cd5754a79df5dc5cd3d5308da2?s=128&d=identicon&r=PG", "display_name": "Mr.", "link": "https://stackoverflow.com/users/1184717/mr"}, "edited": false, "score": 0, "creation_date": 1571826262, "post_id": 57676810, "comment_id": 103366780, "body": "Just an FYI to anyone that comes across this.  The lazy operator does not work for the user / password properties as there is a script called eager that compile those properties.  I have to create a custom resource since they are inherently lazy."}], "owner": {"reputation": 1, "user_id": 11984307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74389632b6d5ae335cec72a71e2ea567?s=128&d=identicon&r=PG&f=1", "display_name": "malkaven", "link": "https://stackoverflow.com/users/11984307/malkaven"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 88, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1566925580, "creation_date": 1566915802, "last_edit_date": 1566925580, "question_id": 57676810, "link": "https://stackoverflow.com/questions/57676810/how-do-you-use-lazy-in-the-user-and-password-properties-of-a-resource", "title": "How do you use lazy in the user and password properties of a resource", "body": "<p>I'm trying to use a variable that is created at runtime for the user and password properties of a execute resource.  Ultimately I'm just trying to create a directory as a specific user.</p>\n\n<p>The command works if I comment out the user and password properties.  It will create a folder with the usernmae variable.  Whenever I add back the user and password properties I get the no method error.  I can echo the variables and they are both correct so i'm assuming it's my syntax?</p>\n\n<pre><code> execute \"mkdir\" do\n    command lazy { \"mkdir c:\\\\temp\\\\#{node.run_state['cred1']['UserName']}\" }\n    user lazy { \"#{node.run_state['cred1']['UserName']}\" }\n    password lazy { \"#{node.run_state['cred1']['Content']}\" }\n end\n\nFATAL: NoMethodError: undefined method `[]' for nil:NilClass\n</code></pre>\n"}, {"tags": ["ruby", "kubernetes", "fluentd"], "comments": [{"owner": {"reputation": 3491, "user_id": 8891738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ghlwL.jpg?s=128&g=1", "display_name": "Daein Park", "link": "https://stackoverflow.com/users/8891738/daein-park"}, "edited": false, "score": 0, "creation_date": 1566914270, "post_id": 57675795, "comment_id": 101799686, "body": "This issue has been reported <a href=\"https://github.com/fluent/fluent-bit/issues/1278#issuecomment-508283873\" rel=\"nofollow noreferrer\">here</a>, it will release the fixed version in future."}, {"owner": {"reputation": 53, "user_id": 1388749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a72fde5e568193de203c41d27c7e1207?s=128&d=identicon&r=PG", "display_name": "Siddhant", "link": "https://stackoverflow.com/users/1388749/siddhant"}, "reply_to_user": {"reputation": 3491, "user_id": 8891738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ghlwL.jpg?s=128&g=1", "display_name": "Daein Park", "link": "https://stackoverflow.com/users/8891738/daein-park"}, "edited": false, "score": 0, "creation_date": 1566972844, "post_id": 57675795, "comment_id": 101817401, "body": "@DaeinPark looks like that issue is for FluentBit and not Fluentd."}, {"owner": {"reputation": 4349, "user_id": 5030709, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/tbBL9.jpg?s=128&g=1", "display_name": "Imran", "link": "https://stackoverflow.com/users/5030709/imran"}, "edited": false, "score": 0, "creation_date": 1567039356, "post_id": 57675795, "comment_id": 101846850, "body": "The output you have pasted is looks like internal record after <code>source</code> parsing using <code>regexp</code>, it still did not go through your <code>filter</code> yet. Once it goes through your <code>filter</code> above, it should parse the <code>log</code> field correct lyas json. I just tested above config with final <code>match</code> to <code>stdout</code> and it prints the json fine. What is your final <code>match</code> after the <code>filter</code> and why do you think it&#39;s failing?"}, {"owner": {"reputation": 53, "user_id": 1388749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a72fde5e568193de203c41d27c7e1207?s=128&d=identicon&r=PG", "display_name": "Siddhant", "link": "https://stackoverflow.com/users/1388749/siddhant"}, "edited": false, "score": 0, "creation_date": 1567056352, "post_id": 57675795, "comment_id": 101849998, "body": "Yes, it&#39;s the record after the <code>source</code> parsing. The filter seems to give an error <code>dump an error event: error_class=Fluent::Plugin::Parser::ParserError error=&quot;pattern not match with data &#39;{\\\\\\&quot;test\\\\\\&quot;:123}\\\\n\\&quot;,\\&quot;stream\\&quot;:\\&quot;stderr\\&quot;,\\&quot;time\\&quot;:\\&quot;20&zwnj;&#8203;19-08-27T11:14:15.23&zwnj;&#8203;908372Z\\&quot;}&#39;</code>&quot;.  As for the <code>match</code> section, it is using <code>fluent-plugin-out-http</code> to make http calls. I don&#39;t think there&#39;s an issue with that."}], "owner": {"reputation": 53, "user_id": 1388749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a72fde5e568193de203c41d27c7e1207?s=128&d=identicon&r=PG", "display_name": "Siddhant", "link": "https://stackoverflow.com/users/1388749/siddhant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2052, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1566912658, "creation_date": 1566912658, "question_id": 57675795, "link": "https://stackoverflow.com/questions/57675795/parsing-log-containing-json-in-fluentd", "title": "Parsing log containing JSON in Fluentd", "body": "<p>I'm using Fluentd to tail container logs in k8s. I'm using the <code>in_tail</code> input plugin to tail container logs, parsing using the <code>regexp</code> parse plugin to extract the relevant log. The log is a json that has to be extracted and sent to the output plugin. I'm doing the extraction using the <code>filter_parser</code> plugin using a <code>json</code> parser.</p>\n\n<pre><code>    &lt;source&gt;\n      @type tail\n      tag proxy.*\n      ...\n      read_from_head true\n      &lt;parse&gt;\n       @type regexp\n       expression \\[proxy\\]\\[(?&lt;type&gt;(record|replay))\\](?&lt;log&gt;.*)\n      &lt;/parse&gt;\n    &lt;/source&gt;\n\n    &lt;filter proxy.**&gt;\n      @type parser\n      key_name log\n      &lt;parse&gt;\n        @type json\n      &lt;/parse&gt;\n    &lt;/filter&gt;\n</code></pre>\n\n<p>Example log line:</p>\n\n<pre><code>[proxy][record]{\"test\":123}\n</code></pre>\n\n<p>This seems to produce a record as:</p>\n\n<pre><code>record={\"type\"=&gt;\"record\", \"log\"=&gt;\"{\\\\\\\"test\\\\\\\":123}\"}\n</code></pre>\n\n<p>When running the setup with the config, it looks like the value in the <code>log</code> regex group is being escaped (twice?); due to which the json parser in the filter section fails to parse it. </p>\n\n<p>I suspect it has something to do with how the <code>regexp</code> plugin and/or the <code>in_tail</code> has been written. It might be picking that <code>log</code> value as a string and escaping it before passing it on. </p>\n\n<p>Or is my regex missing something?</p>\n\n<p>Does anyone know why this is happening and what the solution might be? </p>\n"}, {"tags": ["javascript", "ruby"], "comments": [{"owner": {"reputation": 11, "user_id": 11962982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d010a2f51e8441767fabc3c482d096f6?s=128&d=identicon&r=PG&f=1", "display_name": "DevMoreira", "link": "https://stackoverflow.com/users/11962982/devmoreira"}, "edited": false, "score": 0, "creation_date": 1566912295, "post_id": 57675655, "comment_id": 101798448, "body": "that drag-drop-area exists inside a partial"}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 11962982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d010a2f51e8441767fabc3c482d096f6?s=128&d=identicon&r=PG&f=1", "display_name": "DevMoreira", "link": "https://stackoverflow.com/users/11962982/devmoreira"}, "is_accepted": false, "score": 1, "last_activity_date": 1567081073, "creation_date": 1567081073, "answer_id": 57710038, "question_id": 57675655, "link": "https://stackoverflow.com/questions/57675655/uppy-doesnt-appear-on-the-screen-in-rails-app/57710038#57710038", "title": "Uppy doesn&#39;t appear on the screen in rails app", "body": "<p>I just found the answer. It happens that you actually need to use a bundler in order to make the 'require' works in the browser. This is not explicit in uppy's documentation, but I guess I should already know it. Thanks!</p>\n"}], "owner": {"reputation": 11, "user_id": 11962982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d010a2f51e8441767fabc3c482d096f6?s=128&d=identicon&r=PG&f=1", "display_name": "DevMoreira", "link": "https://stackoverflow.com/users/11962982/devmoreira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567081073, "creation_date": 1566912153, "last_edit_date": 1566912601, "question_id": 57675655, "link": "https://stackoverflow.com/questions/57675655/uppy-doesnt-appear-on-the-screen-in-rails-app", "title": "Uppy doesn&#39;t appear on the screen in rails app", "body": "<p>I'm trying to do a very simple app just to test the Uppy file uploader. I've followed the Uppy's documentation, but it just worked with the library links (CDN).</p>\n\n<p>I've already tried <code>npm install @uppy/core</code> (and the same command for the additional plugins). I've already tried to put the code inside my coffee file (I'm using ruby on rails). And other things too, but no results.</p>\n\n<p>Here's my code: </p>\n\n<pre><code>import '@uppy/core/dist/style.css'\nimport '@uppy/dashboard/dist/style.css'\n\nUppy = require('uppy/lib/core')\n\nDashboard = require('uppy/lib/plugins/Dashboard')\n\nuppy = Uppy({ autoProceed: false })\n\nuppy.use(Dashboard, { target: '#drag-drop-area', inline: true })\n</code></pre>\n\n<p>This is actually throwing no errors, just doesn't appear on the screen.</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 2, "creation_date": 1566911329, "post_id": 57675367, "comment_id": 101797857, "body": "Seems like there&#39;s whitespace around <code>=</code> but not in your regex."}], "answers": [{"comments": [{"owner": {"reputation": 91121, "user_id": 179125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5594142dcc49a24b1902ec8059181f8d?s=128&d=identicon&r=PG&f=1", "display_name": "Jordan Running", "link": "https://stackoverflow.com/users/179125/jordan-running"}, "edited": false, "score": 2, "creation_date": 1566924696, "post_id": 57678403, "comment_id": 101805095, "body": "It may be worth clarifying that <code>\\s</code> in Ruby is <a href=\"https://ruby-doc.org/core-2.6.3/Regexp.html#class-Regexp-label-Character+Classes\" rel=\"nofollow noreferrer\">equivalent to</a> <code>[ \\t\\r\\n\\f\\v]</code>."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "reply_to_user": {"reputation": 91121, "user_id": 179125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5594142dcc49a24b1902ec8059181f8d?s=128&d=identicon&r=PG&f=1", "display_name": "Jordan Running", "link": "https://stackoverflow.com/users/179125/jordan-running"}, "edited": false, "score": 0, "creation_date": 1566932343, "post_id": 57678403, "comment_id": 101808134, "body": "@Jordan, that&#39;s a very nice way of explaining it. I just need an mnemonic device to remember it."}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1566972381, "post_id": 57678403, "comment_id": 101817262, "body": "Alternatively: <code>filtered_data[&#47;secondaryPort\\s*=\\s*(\\d+)&#47;, 1] = &#39;7555&#39;</code> assuming that there&#39;s at most one match in the string."}], "tags": [], "owner": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "is_accepted": false, "score": 1, "last_activity_date": 1566921407, "creation_date": 1566921407, "answer_id": 57678403, "question_id": 57675367, "link": "https://stackoverflow.com/questions/57675367/require-solution-for-string-replacement/57678403#57678403", "title": "require solution for string replacement", "body": "<p>Make sure you account for the spaces around the equals sign in your string:</p>\n\n<pre><code>filtered_data = 'secondaryPort = 7504'\n=&gt; 'secondaryPort = 7504'\n\n# with literal spaces\nfiltered_data.gsub(/secondaryPort = \\d+/, 'secondaryPort = 7555')\n=&gt; 'secondaryPort = 7555'\n\n# with regex character class for literal space\nfiltered_data.gsub(/secondaryPort\\s{1}=\\s{1}\\d+/, 'secondaryPort = 7555')\n=&gt; 'secondaryPort = 7555'\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11887793, "user_type": "registered", "profile_image": "https://graph.facebook.com/2102345339870657/picture?type=large", "display_name": "Rupesh Nayak", "link": "https://stackoverflow.com/users/11887793/rupesh-nayak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566940614, "creation_date": 1566911159, "last_edit_date": 1566940614, "question_id": 57675367, "link": "https://stackoverflow.com/questions/57675367/require-solution-for-string-replacement", "title": "require solution for string replacement", "body": "<p>I have a code where I have to replace a string with another string.</p>\n\n<p>My file contains </p>\n\n<pre><code>secondaryPort = 7504\n</code></pre>\n\n<p>The code below</p>\n\n<pre><code>filtered_data =\n  filtered_data.gsub(\n    /secondaryPort=\\d+/,\n    'secondaryPort=' + node['server']['secondaryPort']\n  )\n</code></pre>\n\n<p>should replace my file with</p>\n\n<pre><code>secondaryPort = 7555 \n</code></pre>\n\n<p>but it fails to do so.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "stripe-payments"], "comments": [{"owner": {"reputation": 5312, "user_id": 6535997, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/10156345016155058/picture?type=large", "display_name": "Mark", "link": "https://stackoverflow.com/users/6535997/mark"}, "edited": false, "score": 0, "creation_date": 1566910165, "post_id": 57674988, "comment_id": 101797173, "body": "The error message means either <code>Rails.application.credentials.stripe</code> is nil or <code>Rails.application.credentials.stripe[Rails.env.to_sym]</code> is nil"}, {"owner": {"reputation": 5312, "user_id": 6535997, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/10156345016155058/picture?type=large", "display_name": "Mark", "link": "https://stackoverflow.com/users/6535997/mark"}, "edited": false, "score": 0, "creation_date": 1566910191, "post_id": 57674988, "comment_id": 101797188, "body": "Try them both in the Rails console and ensure they both return values, when you find the one that doesn&#39;t you know what to fix"}, {"owner": {"reputation": 1, "user_id": 11149206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5d44909bbb5f0184767df1a35d6e358?s=128&d=identicon&r=PG&f=1", "display_name": "asamyo", "link": "https://stackoverflow.com/users/11149206/asamyo"}, "reply_to_user": {"reputation": 5312, "user_id": 6535997, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/10156345016155058/picture?type=large", "display_name": "Mark", "link": "https://stackoverflow.com/users/6535997/mark"}, "edited": false, "score": 0, "creation_date": 1566910299, "post_id": 57674988, "comment_id": 101797258, "body": "Sorry newbie here, how do I check it in the Rails console?"}, {"owner": {"reputation": 1, "user_id": 11149206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5d44909bbb5f0184767df1a35d6e358?s=128&d=identicon&r=PG&f=1", "display_name": "asamyo", "link": "https://stackoverflow.com/users/11149206/asamyo"}, "reply_to_user": {"reputation": 5312, "user_id": 6535997, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/10156345016155058/picture?type=large", "display_name": "Mark", "link": "https://stackoverflow.com/users/6535997/mark"}, "edited": false, "score": 0, "creation_date": 1566910796, "post_id": 57674988, "comment_id": 101797568, "body": "Ok I&#39;ve done rails c and added both <code>Rails.application.credentials.stripe</code> and <code>Rails.application.credentials.stripe[Rails.env.to_sym]</code> and neither of them are coming up with anything."}, {"owner": {"reputation": 5312, "user_id": 6535997, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/10156345016155058/picture?type=large", "display_name": "Mark", "link": "https://stackoverflow.com/users/6535997/mark"}, "edited": false, "score": 0, "creation_date": 1566913820, "post_id": 57674988, "comment_id": 101799417, "body": "That means your secret keys aren&#39;t being saved, try following the config steps in <a href=\"https://dev.to/ksushiva/integrate-stripe-in-your-ruby-on-rails-app-3dc4\" rel=\"nofollow noreferrer\">dev.to/ksushiva/integrate-stripe-in-your-ruby-on-rails-app-3&zwnj;&#8203;dc4</a>"}, {"owner": {"reputation": 1, "user_id": 11149206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5d44909bbb5f0184767df1a35d6e358?s=128&d=identicon&r=PG&f=1", "display_name": "asamyo", "link": "https://stackoverflow.com/users/11149206/asamyo"}, "reply_to_user": {"reputation": 5312, "user_id": 6535997, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/10156345016155058/picture?type=large", "display_name": "Mark", "link": "https://stackoverflow.com/users/6535997/mark"}, "edited": false, "score": 0, "creation_date": 1566993658, "post_id": 57674988, "comment_id": 101828065, "body": "I&#39;ve tried following the link you sent but I&#39;m still getting the same error. I won&#39;t allow me to restart the server now either."}, {"owner": {"reputation": 1, "user_id": 11149206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5d44909bbb5f0184767df1a35d6e358?s=128&d=identicon&r=PG&f=1", "display_name": "asamyo", "link": "https://stackoverflow.com/users/11149206/asamyo"}, "reply_to_user": {"reputation": 5312, "user_id": 6535997, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/10156345016155058/picture?type=large", "display_name": "Mark", "link": "https://stackoverflow.com/users/6535997/mark"}, "edited": false, "score": 0, "creation_date": 1566994092, "post_id": 57674988, "comment_id": 101828323, "body": "<code>Rails.configuration.stripe = {   :public_key =&gt; Rails.application.credentials.stripe[:stripe_public_key],   :secret_key =&gt; Rails.application.credentials.stripe[:stripe_secret_key] }  Stripe.api_key = Rails.application.credentials.stripe[:stripe_secret_key] </code>"}, {"owner": {"reputation": 1, "user_id": 11149206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5d44909bbb5f0184767df1a35d6e358?s=128&d=identicon&r=PG&f=1", "display_name": "asamyo", "link": "https://stackoverflow.com/users/11149206/asamyo"}, "reply_to_user": {"reputation": 5312, "user_id": 6535997, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/10156345016155058/picture?type=large", "display_name": "Mark", "link": "https://stackoverflow.com/users/6535997/mark"}, "edited": false, "score": 0, "creation_date": 1566994132, "post_id": 57674988, "comment_id": 101828351, "body": "This is what I have in my initializers/stripe.rb"}], "answers": [{"tags": [], "owner": {"reputation": 303, "user_id": 9479253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cd34f4996365a59ad414df6950d6d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ashok Damaniya", "link": "https://stackoverflow.com/users/9479253/ashok-damaniya"}, "is_accepted": false, "score": 0, "last_activity_date": 1566912726, "creation_date": 1566912726, "answer_id": 57675817, "question_id": 57674988, "link": "https://stackoverflow.com/questions/57674988/stripe-integration-not-being-recognised-in-rails-project/57675817#57675817", "title": "Stripe Integration not being recognised in Rails project", "body": "<pre><code>Rails.application.credentials.dig(:stripe, Rails.env.to_sym, :stripe_secret_key)\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11149206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5d44909bbb5f0184767df1a35d6e358?s=128&d=identicon&r=PG&f=1", "display_name": "asamyo", "link": "https://stackoverflow.com/users/11149206/asamyo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 68, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566912726, "creation_date": 1566909801, "last_edit_date": 1566910037, "question_id": 57674988, "link": "https://stackoverflow.com/questions/57674988/stripe-integration-not-being-recognised-in-rails-project", "title": "Stripe Integration not being recognised in Rails project", "body": "<p>I'm trying to integrate Stripe into my project but seem to be getting an </p>\n\n<blockquote>\n  <p>NoMethodError in Orders#new undefined method `[ ]' for nil:NilClass\"\n  error.</p>\n</blockquote>\n\n<p>I can't work out how to resolve this. Can anyone help?</p>\n\n<p>This is my Stripe script in new.html.erb</p>\n\n<pre><code>&lt;script&gt;\n  var stripe = Stripe(\"&lt;%= Rails.application.credentials.stripe[Rails.env.to_sym][:stripe_secret_key] %&gt;\")\n\n  var elements = stripe.elements()\n  var card = elements.create(\"card\")\n  card.mount(\"#card\")\n&lt;/script&gt;\n</code></pre>\n\n<p>This is what my credentials code looks like</p>\n\n<pre><code>stripe:\n  development:\n    stripe_public_key: xxxxxxxxxxxxxxxxxx\n    stripe_secret_key: xxxxxxxxxxxxxxxxxx\n\n  test:\n    stripe_public_key: xxxxxxxxxxxxxxxxxx\n    stripe_secret_key: xxxxxxxxxxxxxxxxxx\n\n  production:\n    stripe_public_key: xxxxxxxxxxxxxxxxxx\n    stripe_secret_key: xxxxxxxxxxxxxxxxxx\n</code></pre>\n"}, {"tags": ["ruby", "ruby-on-rails"], "migrated_from": {"other_site": {"markdown_extensions": ["Prettify"], "launch_date": 1250553600, "open_beta_date": 1247529600, "site_state": "normal", "high_resolution_icon_url": "https://cdn.sstatic.net/Sites/superuser/Img/apple-touch-icon@2.png", "twitter_account": "super_user", "favicon_url": "https://cdn.sstatic.net/Sites/superuser/Img/favicon.ico", "icon_url": "https://cdn.sstatic.net/Sites/superuser/Img/apple-touch-icon.png", "audience": "computer enthusiasts and power users", "site_url": "https://superuser.com", "api_site_parameter": "superuser", "logo_url": "https://cdn.sstatic.net/Sites/superuser/Img/logo.png", "name": "Super User", "site_type": "main_site"}, "on_date": 1566911914, "question_id": 1475781}, "owner": {"reputation": 98, "user_id": 7619689, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b637d6a56c98bf91900dc00f985c0633?s=128&d=identicon&r=PG&f=1", "display_name": "Tunnelblick", "link": "https://stackoverflow.com/users/7619689/tunnelblick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1566911914, "creation_date": 1566907682, "question_id": 57675586, "link": "https://stackoverflow.com/questions/57675586/ror-app-devise-seg-fault-after-any-route", "title": "RoR app: (Devise) seg fault after any route", "body": "<p>I'm trying to set up the development environment for an internal RoR project.\nUnfortunately there is no docu on this and the co-worker mainting this project is on vacation. (Quite a bad combo)</p>\n\n<pre><code>Processing by Devise::SessionsController#new as HTML\n   (0.2ms)  SELECT `roles`.`name` FROM `roles` WHERE 1=0\n  \u21b3 app/models/user.rb:236\n  CACHE  (0.0ms)  SELECT `roles`.`name` FROM `roles` WHERE 1=0\n  \u21b3 app/models/user.rb:236\n  CACHE  (0.0ms)  SELECT `roles`.`name` FROM `roles` WHERE 1=0\n  \u21b3 app/models/user.rb:236\n  Navitem Load (0.4ms)  SELECT  `navitems`.* FROM `navitems` WHERE `navitems`.`url` = '/ideas' LIMIT 1\n  \u21b3 app/models/idea.rb:59\n  Navitem Load (0.4ms)  SELECT  `navitems`.* FROM `navitems` WHERE `navitems`.`url` = '/contacts' LIMIT 1\n  \u21b3 app/models/contact.rb:44\n  CACHE Navitem Load (0.0ms)  SELECT  `navitems`.* FROM `navitems` WHERE `navitems`.`url` = '/contacts' LIMIT 1  [[\"url\", \"/contacts\"], [\"LIMIT\", 1]]\n  \u21b3 app/models/contact.rb:44\n  PageSearchIndex Load (1.6ms)  SELECT `page_search_indices`.* FROM `page_search_indices`\n  \u21b3 app/controllers/application_controller.rb:94\n  Rendering devise/sessions/new.html.slim within layouts/devise\n  Rendered devise/shared/_links.html.slim (3.6ms)\n  Rendered devise/sessions/new.html.slim within layouts/devise (21.0ms)\nAborted (core dumped)\n</code></pre>\n\n<p>I've had to set up <code>elasticsearch</code> and <code>yarn</code> for this to work.</p>\n\n<p>The database has been created (<code>rake db:create</code>), the migration files were executed (<code>rake db:migrate</code>) and the initial data was seeded (<code>rake db:seed</code>).</p>\n\n<p>But I'm currently running permanently in a segfault after executing any route on this development server (<code>rails s -e development -b 0.0.0.0</code>).</p>\n\n<p>So I've already tried to break on all exceptions which occur during the runtime but no exception was thrown before and I just ran into the segfault again, which also makes sense.</p>\n\n<p>Due to my C / C++ experience I do know how I would treat this problem on of these problems but regarding thsis rails app I'm quite overasked with this problem.</p>\n\n<hr>\n\n<p><strong>I am not seeking for a copy &amp; paste solution</strong> which cannot exist due to the complex application setup <strong>but</strong> any <strong>help which supports me troubleshooting this problem</strong> in the context of this rails application.</p>\n\n<p>Thanks for your help and support!</p>\n\n<hr>\n\n<p>The Gemfile (maybe it helps):</p>\n\n<pre><code>ruby \"2.5.3\"\nsource \"https://rubygems.org\"\n\ngem \"rails\", \"5.2.3\"\ngem \"json\"\ngem \"jquery-fileupload-rails\"\ngem \"seedbed\"\ngem \"mysql2\"\ngem \"bootsnap\", \"&gt;= 1.1.0\", require: false\ngem \"sassc-rails\", \"~&gt; 2.1\"\ngem \"coffee-rails\"\ngem \"mini_racer\", platforms: :ruby\n\ngem \"uglifier\"\ngem \"rubyzip\", \"&gt;= 1.0.0\"\n\ngroup :development do\n  gem \"pry\"\n  gem \"pry-rails\"\n  gem \"awesome_print\"\n  gem \"guard\"\n  gem \"terminal-notifier-guard\"\n  gem \"letter_opener_web\"\n  #  gem \"quiet_assets\"\nend\n\ngroup :development, :test do\n  gem \"rspec-rails\"\n  gem \"capybara\"\n  gem \"faker\"\n  gem \"factory_bot\"\n  gem \"rubocop-rails\"\n  gem \"rubocop-performance\"\n  gem \"dotenv-rails\"\nend\n\ngem \"simplecov\", require: false, group: :test\n\ngroup :development, :staging do\n  gem \"better_errors\"\n  gem \"binding_of_caller\"\nend\n\ngem \"bootstrap\"\ngem \"haml-rails\"\ngem \"slim-rails\"\ngem \"redcarpet\"\n\n# Still Master branch because of rails 5.2\ngem \"activerecord-sqlserver-adapter\", git: \"https://github.com/rails-sqlserver/activerecord-sqlserver-adapter.git\", tag: \"v5.2.0.rc1\"\n\n# To use ActiveModel has_secure_password\n# gem \"bcrypt-ruby\", \"~&gt; 3.0.0\"\n\n# To use Jbuilder templates for JSON\n# gem \"jbuilder\"\n\n# Deploy with Capistrano\ngem \"capistrano\"\ngem \"capistrano-bundler\"\ngem \"capistrano-rails\"\ngem \"capistrano-rvm\"\ngem \"capistrano-yarn\"\n# To use debugger\n# gem \"ruby-debug\"\n\n# auth\ngem \"devise\"\ngem \"devise-i18n\"\ngem \"cancancan\"\n\ngem \"friendly_id\"\n\ngem \"audited\"\n\ngem \"ancestry\"\n# gem \"aasm\"\n\n# gem \"less-rails\"\n\n# switch to active storage\ngem \"image_processing\"\ngem \"mini_magick\"\n\n# search\ngem \"elasticsearch-rails\"\ngem \"elasticsearch-model\"\n\n# pagination\ngem \"kaminari\"\n\ngem \"wicked\"\n\ngem \"uuid\"\n\ngem \"whenever\"\n\ngem \"icalendar\"\n\n\ngem \"paperclip\"\ngem \"remotipart\"\n######################################\n# admin\n######################################\ngem \"rails_admin\", \"~&gt; 1.0\"\n\ngem \"ckeditor\", \"~&gt; 4.2.4\"\n\ngem \"active_storage_drag_and_drop\"\n\ngem \"rails_admin_nestable\", git: \"https://github.com/dalpo/rails_admin_nestable.git\"\ngem \"paper_trail\"\ngem \"rails_admin_toggleable\"\n\ngem \"font_awesome5_rails\"\ngem \"select2-rails\"\n\ngem \"webpacker\", \"~&gt; 4.x\"\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "activerecord", "ruby-on-rails-5"], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 6657680, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5aDZn.jpg?s=128&g=1", "display_name": "Rich Starkie", "link": "https://stackoverflow.com/users/6657680/rich-starkie"}, "edited": false, "score": 0, "creation_date": 1566908898, "post_id": 57674443, "comment_id": 101796382, "body": "I&#39;m getting an error ....  <code>PG::UndefinedTable: ERROR:  missing FROM-clause entry for table &quot;artists&quot; LINE 1: ....&quot;shelf_id&quot; = $1 ORDER BY releases.release_title, artists.ar...                                                              ^ : SELECT  &quot;releases&quot;.* FROM &quot;releases&quot; WHERE &quot;releases&quot;.&quot;shelf_id&quot; = $1 ORDER BY releases.release_title, artists.artist_name LIMIT $2 OFFSET $3</code>"}, {"owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "reply_to_user": {"reputation": 45, "user_id": 6657680, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5aDZn.jpg?s=128&g=1", "display_name": "Rich Starkie", "link": "https://stackoverflow.com/users/6657680/rich-starkie"}, "edited": false, "score": 0, "creation_date": 1566909241, "post_id": 57674443, "comment_id": 101796596, "body": "Can you add the models you&#39;re using to see their relationships? It&#39;s clear you need to add artists to the joins clause, but I don&#39;t see how they&#39;re related."}, {"owner": {"reputation": 45, "user_id": 6657680, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5aDZn.jpg?s=128&g=1", "display_name": "Rich Starkie", "link": "https://stackoverflow.com/users/6657680/rich-starkie"}, "edited": false, "score": 0, "creation_date": 1566909399, "post_id": 57674443, "comment_id": 101796694, "body": "will add to main post"}, {"owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "reply_to_user": {"reputation": 45, "user_id": 6657680, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5aDZn.jpg?s=128&g=1", "display_name": "Rich Starkie", "link": "https://stackoverflow.com/users/6657680/rich-starkie"}, "edited": false, "score": 0, "creation_date": 1566910459, "post_id": 57674443, "comment_id": 101797370, "body": "See the updated answer. <code>joins</code> is right after you&#39;re getting the relases, and the relationship is belongs_to, so <code>artist</code> is in its singular way."}, {"owner": {"reputation": 45, "user_id": 6657680, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5aDZn.jpg?s=128&g=1", "display_name": "Rich Starkie", "link": "https://stackoverflow.com/users/6657680/rich-starkie"}, "edited": false, "score": 0, "creation_date": 1566910594, "post_id": 57674443, "comment_id": 101797455, "body": "same error <code>PG::UndefinedColumn: ERROR:  column artists.name does not exist LINE 1: ...elf_id&quot; = $1 ORDER BY releases.release_title ASC, artists.na...                                                              ^ : SELECT  &quot;releases&quot;.* FROM &quot;releases&quot; INNER JOIN &quot;artists&quot; ON &quot;artists&quot;.&quot;artist_discogs_id&quot; = &quot;releases&quot;.&quot;artist_id&quot; WHERE &quot;releases&quot;.&quot;shelf_id&quot; = $1 ORDER BY releases.release_title ASC, artists.name ASC LIMIT $2 OFFSET $3</code>"}, {"owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "reply_to_user": {"reputation": 45, "user_id": 6657680, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5aDZn.jpg?s=128&g=1", "display_name": "Rich Starkie", "link": "https://stackoverflow.com/users/6657680/rich-starkie"}, "edited": false, "score": 0, "creation_date": 1566911008, "post_id": 57674443, "comment_id": 101797692, "body": "Isn&#39;t the same error, are you sure the artists table has a name column, can you add your db/schema.rb file?"}, {"owner": {"reputation": 45, "user_id": 6657680, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5aDZn.jpg?s=128&g=1", "display_name": "Rich Starkie", "link": "https://stackoverflow.com/users/6657680/rich-starkie"}, "edited": false, "score": 0, "creation_date": 1566911114, "post_id": 57674443, "comment_id": 101797749, "body": "its <code>artist_name</code> but I was changing the field name"}], "tags": [], "owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "is_accepted": true, "score": 1, "last_activity_date": 1566911366, "last_edit_date": 1566911366, "creation_date": 1566908024, "answer_id": 57674443, "question_id": 57674338, "link": "https://stackoverflow.com/questions/57674338/multi-table-sorting/57674443#57674443", "title": "Multi-Table Sorting", "body": "<p>You can do it specifying the <code>name</code> column is in the artists table:</p>\n\n<pre><code>Shelf\n  .find(@shelf.shelf_discogs_id)\n  .releases\n  .joins(:artist)\n  .order('releases.release_title ASC, artists.artist_name ASC')\n  .page(params[:page])\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 45, "user_id": 6657680, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5aDZn.jpg?s=128&g=1", "display_name": "Rich Starkie", "link": "https://stackoverflow.com/users/6657680/rich-starkie"}, "edited": false, "score": 0, "creation_date": 1566909283, "post_id": 57674457, "comment_id": 101796620, "body": "Different Error to the other suggestion .. <code>Can&#39;t join &#39;Release&#39; to association named &#39;artists&#39;; perhaps you misspelled it?</code> but the <code>has_many</code> and <code>belongs_to</code> are written and work"}, {"owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "reply_to_user": {"reputation": 45, "user_id": 6657680, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5aDZn.jpg?s=128&g=1", "display_name": "Rich Starkie", "link": "https://stackoverflow.com/users/6657680/rich-starkie"}, "edited": false, "score": 0, "creation_date": 1566910643, "post_id": 57674457, "comment_id": 101797482, "body": "fixed <code>artists</code> -&gt; <code>artist</code> (good that you shown relationships)"}, {"owner": {"reputation": 45, "user_id": 6657680, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5aDZn.jpg?s=128&g=1", "display_name": "Rich Starkie", "link": "https://stackoverflow.com/users/6657680/rich-starkie"}, "edited": false, "score": 0, "creation_date": 1566911668, "post_id": 57674457, "comment_id": 101798084, "body": "Works, but i&#39;m choosing the other answer, as correct as it only uses one query Thanks for helping :D"}, {"owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "reply_to_user": {"reputation": 45, "user_id": 6657680, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5aDZn.jpg?s=128&g=1", "display_name": "Rich Starkie", "link": "https://stackoverflow.com/users/6657680/rich-starkie"}, "edited": false, "score": 0, "creation_date": 1566911833, "post_id": 57674457, "comment_id": 101798183, "body": "The other one uses 2 queries as well (first finding a shelf, then fetching releases)"}], "tags": [], "owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "is_accepted": false, "score": 1, "last_activity_date": 1566910623, "last_edit_date": 1566910623, "creation_date": 1566908054, "answer_id": 57674457, "question_id": 57674338, "link": "https://stackoverflow.com/questions/57674338/multi-table-sorting/57674457#57674457", "title": "Multi-Table Sorting", "body": "<p>I'd try</p>\n\n<pre><code>Shelf.find(@shelf.shelf_discogs_id).releases.joins(:artists).order('releases.release_title ASC, artists.name ASC')\n</code></pre>\n\n<p>You perform 2 queries - first you find a shelf with</p>\n\n<pre><code>shelf = Shelf.find(@shelf.shelf_discogs_id)\n</code></pre>\n\n<p>then all the releases for this shelf with </p>\n\n<pre><code>shelf.releases.joins(:artist).order('releases.release_title ASC, artists.name ASC')\n</code></pre>\n\n<p>you don't need the <code>join</code> in the first query, because <code>artists</code> are not used there</p>\n"}], "owner": {"reputation": 45, "user_id": 6657680, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5aDZn.jpg?s=128&g=1", "display_name": "Rich Starkie", "link": "https://stackoverflow.com/users/6657680/rich-starkie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 57674443, "answer_count": 2, "score": 2, "last_activity_date": 1566911366, "creation_date": 1566907599, "last_edit_date": 1566909482, "question_id": 57674338, "link": "https://stackoverflow.com/questions/57674338/multi-table-sorting", "title": "Multi-Table Sorting", "body": "<p>I'd like to be able to sort on a field that is in a linked table, Artist Name then by Release Title when viewing the albums in a category.</p>\n\n<p>Database:</p>\n\n<p>In the Categories table, artists are linked by ID</p>\n\n<p>In the <code>Category#Show</code>, I have <code>@releases = Shelf.joins(:artists).find(@shelf.shelf_discogs_id).releases.order('release_title ASC').page(params[:page])</code></p>\n\n<p>The above code works to sort by the Release Title, however, I can\u2019t find a way to make it sort by the Artist Name, which is part of the Artists table.</p>\n\n<p>The <code>joins(:artists)</code> does add the correct line in the console to link correctly (from what I can tell)</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>SELECT  \"shelves\".*\nFROM \"shelves\"\n  INNER JOIN \"releases\"\n    ON \"releases\".\"shelf_id\" = \"shelves\".\"shelf_discogs_id\"\n  INNER JOIN \"artists\"\n    ON \"artists\".\"artist_discogs_id\" = \"releases\".\"artist_id\"\nWHERE \"shelves\".\"shelf_discogs_id\" = $1\nLIMIT $2\n</code></pre>\n\n<p>Model for Releases</p>\n\n<pre><code>class Release &lt; ApplicationRecord\n\n  belongs_to :shelf\n  belongs_to :artist\n  belongs_to :record_label\n  belongs_to :record_location\n  has_many :tracks\n\nend\n</code></pre>\n\n<p>Model for Artists</p>\n\n<pre><code>class Artist &lt; ApplicationRecord\n\n  has_many :releases\n  has_many :tracks\n  has_many :shelves, through: :releases\n\nend\n</code></pre>\n\n<p>Any ideas how I can achieve what I\u2019m looking to do?\nThanks</p>\n"}, {"tags": ["ruby", "path"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1566923038, "post_id": 57672533, "comment_id": 101804381, "body": "<code>php.ini</code> has zero impact on Ruby. Are you running this in a regular shell or some other way?"}, {"owner": {"reputation": 1, "user_id": 11983170, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAqxhagwNcJTZblptPK337ugdpt7Lg4b9PDUIrK=k-s128", "display_name": "\u5b8b\u9e4f\u98de", "link": "https://stackoverflow.com/users/11983170/%e5%ae%8b%e9%b9%8f%e9%a3%9e"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1566956862, "post_id": 57672533, "comment_id": 101814102, "body": "There&#39;s no problem with regular shells. My current approach is to call this ruby script in PHP code.<code>$exec = &quot;ruby ..&#47;ruby&#47;ShowCert.rb&quot; . &#39; &#39; . $this-&gt;appid . &#39; &#39; . $this-&gt;password;         $result = system($exec,$return_status);</code>"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1567011235, "post_id": 57672533, "comment_id": 101838118, "body": "Maybe your PHP shell environment is mangled and you need to set <code>HOME</code> in there. Normally you can pick which environment variables are exported, but <code>HOME</code> should be by default."}, {"owner": {"reputation": 1, "user_id": 11983170, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAqxhagwNcJTZblptPK337ugdpt7Lg4b9PDUIrK=k-s128", "display_name": "\u5b8b\u9e4f\u98de", "link": "https://stackoverflow.com/users/11983170/%e5%ae%8b%e9%b9%8f%e9%a3%9e"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1567062776, "post_id": 57672533, "comment_id": 101852369, "body": "Maybe you&#39;re right. Anyway, thank you."}], "owner": {"reputation": 1, "user_id": 11983170, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAqxhagwNcJTZblptPK337ugdpt7Lg4b9PDUIrK=k-s128", "display_name": "\u5b8b\u9e4f\u98de", "link": "https://stackoverflow.com/users/11983170/%e5%ae%8b%e9%b9%8f%e9%a3%9e"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1566901892, "creation_date": 1566901110, "last_edit_date": 1566901892, "question_id": 57672533, "link": "https://stackoverflow.com/questions/57672533/ruby-couldt-find-the-environment-variable-home", "title": "Ruby could&#39;t find the environment variable HOME", "body": "<p>I had some problems running fastlane. </p>\n\n<pre><code>/Library/Ruby/Gems/2.3.0/gems/fastlane-2.129.0/spaceship/lib/spaceship/client.rb:279:in `home': couldn't find HOME\nenvironment -- expanding `~' (ArgumentError)\nfrom /Library/Ruby/Gems/2.3.0/gems/fastlane-2.129.0/spaceship/lib/spaceship/client.rb:279:in `fastlane_user_dir'\nfrom /Library/Ruby/Gems/2.3.0/gems/fastlane-2.129.0/spaceship/lib/spaceship/client.rb:290:in `persistent_cookie_path'\nfrom /Library/Ruby/Gems/2.3.0/gems/fastlane-2.129.0/spaceship/lib/spaceship/client.rb:567:in `load_session_from_file'\nfrom /Library/Ruby/Gems/2.3.0/gems/fastlane-2.129.0/spaceship/lib/spaceship/client.rb:412:in `send_shared_login_request'\nfrom /Library/Ruby/Gems/2.3.0/gems/fastlane-2.129.0/spaceship/lib/spaceship/portal/portal_client.rb:28:in\n`send_login_request'\nfrom /Library/Ruby/Gems/2.3.0/gems/fastlane-2.129.0/spaceship/lib/spaceship/client.rb:771:in `do_login'\nfrom /Library/Ruby/Gems/2.3.0/gems/fastlane-2.129.0/spaceship/lib/spaceship/client.rb:385:in `login'\nfrom /Library/Ruby/Gems/2.3.0/gems/fastlane-2.129.0/spaceship/lib/spaceship/client.rb:347:in `login'\nfrom /Library/Ruby/Gems/2.3.0/gems/fastlane-2.129.0/spaceship/lib/spaceship/portal/spaceship.rb:25:in `login'\nfrom ../ruby/ShowCert.rb:31:in `loginPortal'\nfrom ../ruby/ShowCert.rb:46:in `selectTunc'\n</code></pre>\n\n<p>My computer system is <code>OS 10.13.6</code>. <code>HOME=/Users/ergeng</code> has been added to the environment variable, and <code>/Users/ergeng</code> is also displayed when <code>echo ~</code>. Php.ini has also been set up, but still not. </p>\n\n<p>So I can't do anything about it now.</p>\n\n<pre><code>path = File.expand_path(File.join(Dir.home, \".fastlane\"))\n</code></pre>\n"}, {"tags": ["ruby", "rvm"], "comments": [{"owner": {"reputation": 703, "user_id": 3744443, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/31cd958c40afab1804323dc579eeb4c5?s=128&d=identicon&r=PG&f=1", "display_name": "fidato", "link": "https://stackoverflow.com/users/3744443/fidato"}, "edited": false, "score": 0, "creation_date": 1566899484, "post_id": 57671885, "comment_id": 101791255, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/23350388/cant-install-gems-because-undefined-method-invoke-with-build-args-for-nilni\">Can&#39;t install gems because &quot;undefined method `invoke_with_build_args&#39; for nil:NilClass&quot;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 2101449, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JyaXf.jpg?s=128&g=1", "display_name": "Mirza Sehovic", "link": "https://stackoverflow.com/users/2101449/mirza-sehovic"}, "edited": false, "score": 0, "creation_date": 1566907234, "post_id": 57673151, "comment_id": 101795434, "body": "As I said in description, I&#39;m not able to do <code>gem install</code> of anything including bundler"}], "tags": [], "owner": {"reputation": 358, "user_id": 8708097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/APLHT.jpg?s=128&g=1", "display_name": "Saif chaudhry", "link": "https://stackoverflow.com/users/8708097/saif-chaudhry"}, "is_accepted": false, "score": -3, "last_activity_date": 1566903268, "creation_date": 1566903268, "answer_id": 57673151, "question_id": 57671885, "link": "https://stackoverflow.com/questions/57671885/how-to-fix-cannot-load-such-file-socket-error-on-gem-install/57673151#57673151", "title": "How to fix &#39;cannot load such file -- socket&#39; error on gem install", "body": "<p>Try this:</p>\n\n<p><code>1. gem install bundler\n 2. bundle install</code></p>\n"}], "owner": {"reputation": 11, "user_id": 2101449, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JyaXf.jpg?s=128&g=1", "display_name": "Mirza Sehovic", "link": "https://stackoverflow.com/users/2101449/mirza-sehovic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 353, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1566903268, "creation_date": 1566899061, "last_edit_date": 1566899421, "question_id": 57671885, "link": "https://stackoverflow.com/questions/57671885/how-to-fix-cannot-load-such-file-socket-error-on-gem-install", "title": "How to fix &#39;cannot load such file -- socket&#39; error on gem install", "body": "<p>I'm not able to do <code>gem install</code> of any gem. When I try I get following error message</p>\n\n<pre><code>ERROR:  Loading command: install (LoadError)\n    cannot load such file -- socket\nERROR:  While executing gem ... (NoMethodError)\n    undefined method `invoke_with_build_args' for nil:NilClass\n</code></pre>\n\n<p>I use MacOS and <code>rvm</code> for versioning. Also, of note is that reinstall of ruby with openssl didn't work (which is referred as a solution for this problem on some answers on the internet).</p>\n"}, {"tags": ["ruby", "shell", "github", "file-io", "wget"], "comments": [{"owner": {"reputation": 703, "user_id": 3744443, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/31cd958c40afab1804323dc579eeb4c5?s=128&d=identicon&r=PG&f=1", "display_name": "fidato", "link": "https://stackoverflow.com/users/3744443/fidato"}, "edited": false, "score": 1, "creation_date": 1566898236, "post_id": 57671513, "comment_id": 101790566, "body": "Checkout <a href=\"https://serverfault.com/questions/226386/wget-a-script-and-run-it\" title=\"wget a script and run it\">serverfault.com/questions/226386/wget-a-script-and-run-it</a>"}, {"owner": {"reputation": 703, "user_id": 3744443, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/31cd958c40afab1804323dc579eeb4c5?s=128&d=identicon&r=PG&f=1", "display_name": "fidato", "link": "https://stackoverflow.com/users/3744443/fidato"}, "edited": false, "score": 1, "creation_date": 1566898257, "post_id": 57671513, "comment_id": 101790576, "body": "You may directly achieve it through <code>wget -O - https:&#47;&#47;gist.githubusercontent.com&#47;JackDrogon&#47;53678a54a326b9&zwnj;&#8203;aaf4102180eeb58cab&#47;r&zwnj;&#8203;aw&#47;91cf80f71b1358355&zwnj;&#8203;db87fb6036e7f10e49d8&zwnj;&#8203;3a6&#47;office-thinner.r&zwnj;&#8203;b | bash</code>"}], "answers": [{"comments": [{"owner": {"reputation": 479, "user_id": 1381143, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b8887aa2d3547314fc09745d1b91fae?s=128&d=identicon&r=PG", "display_name": "Jagdish Adusumalli", "link": "https://stackoverflow.com/users/1381143/jagdish-adusumalli"}, "edited": false, "score": 0, "creation_date": 1567005103, "post_id": 57675225, "comment_id": 101835042, "body": "The problem when i tried your solution is that my command requires sudo privileges and with that the prompt for password does not halt the shell and throws out an error.        <code>[1]  + 370 done                    wget -O -  |            371 suspended (tty output)  sudo ruby          ~     \u27262 \u279c fg     [1]  + 370 done       wget -O -  |            371 continued  sudo ruby     zsh: can&#39;t set tty pgrp: operation not permitted.</code>      Any idea how to force the halt at password prompt?"}, {"owner": {"reputation": 3580, "user_id": 1680728, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/844cd73e8700d810d7cc207cba7da3bd?s=128&d=identicon&r=PG&f=1", "display_name": "Felix", "link": "https://stackoverflow.com/users/1680728/felix"}, "reply_to_user": {"reputation": 479, "user_id": 1381143, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b8887aa2d3547314fc09745d1b91fae?s=128&d=identicon&r=PG", "display_name": "Jagdish Adusumalli", "link": "https://stackoverflow.com/users/1381143/jagdish-adusumalli"}, "edited": false, "score": 0, "creation_date": 1567054309, "post_id": 57675225, "comment_id": 101849510, "body": "@JagdishAdusumalli Simplest solution is to run the first shell as sudo already (<code>sudo -i</code>)."}], "tags": [], "owner": {"reputation": 3580, "user_id": 1680728, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/844cd73e8700d810d7cc207cba7da3bd?s=128&d=identicon&r=PG&f=1", "display_name": "Felix", "link": "https://stackoverflow.com/users/1680728/felix"}, "is_accepted": false, "score": 1, "last_activity_date": 1566910646, "creation_date": 1566910646, "answer_id": 57675225, "question_id": 57671513, "link": "https://stackoverflow.com/questions/57671513/how-to-locally-execute-a-ruby-script-hosted-on-github-in-single-cli-command/57675225#57675225", "title": "How to locally execute a ruby script hosted on github in single CLI command", "body": "<p>Either you go the full \"bash run\" and pipe the script into bash (or the shell of your choice), which will then also take into account all the stuff that happens when your shell executes (e.g. if you are using <code>[rvm][1]</code> it will make <code>ruby</code> being your selected ruby):</p>\n\n<pre><code>wget -O - https://gist.github.com/JackDrogon/53678a54a326b9aaf4102180eeb58cab | bash\n</code></pre>\n\n<p>Or, you give the script to the ruby interpreter yourself:</p>\n\n<pre><code>wget -O - https://gist.github.com/JackDrogon/53678a54a326b9aaf4102180eeb58cab | ruby\n</code></pre>\n\n<p>or</p>\n\n<pre><code>wget -O - https://gist.github.com/JackDrogon/53678a54a326b9aaf4102180eeb58cab | /usr/bin/ruby2.5 --verbose\n</code></pre>\n\n<p>In the later case you can also use options to ruby (e.g. switch on the JIT compiler, verbosity settings, etc.</p>\n\n<p>In the first case, your shell will most likely only execute the script if it has the magical shebang at top (e.g. <code>#/usr/bin/env ruby</code>). In the second case, ruby will take whatever comes.</p>\n"}], "owner": {"reputation": 479, "user_id": 1381143, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b8887aa2d3547314fc09745d1b91fae?s=128&d=identicon&r=PG", "display_name": "Jagdish Adusumalli", "link": "https://stackoverflow.com/users/1381143/jagdish-adusumalli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566910646, "creation_date": 1566897773, "last_edit_date": 1566900579, "question_id": 57671513, "link": "https://stackoverflow.com/questions/57671513/how-to-locally-execute-a-ruby-script-hosted-on-github-in-single-cli-command", "title": "How to locally execute a ruby script hosted on github in single CLI command", "body": "<p>Want to execute <a href=\"https://gist.github.com/JackDrogon/53678a54a326b9aaf4102180eeb58cab\" rel=\"nofollow noreferrer\">this script</a> \non my laptop which has ruby already installed\nso I first download the script office-thinner.rb and then run\nsudo ruby office-thinner.rb</p>\n\n<p>How can I avoid the 1st step of downloading of the file every time and in single command get the script and execute it?</p>\n\n<p>Can wget, filestream and linux piping do the magic?</p>\n"}, {"tags": ["arrays", "ruby"], "comments": [{"owner": {"reputation": 703, "user_id": 3744443, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/31cd958c40afab1804323dc579eeb4c5?s=128&d=identicon&r=PG&f=1", "display_name": "fidato", "link": "https://stackoverflow.com/users/3744443/fidato"}, "edited": false, "score": 0, "creation_date": 1566897839, "post_id": 57671487, "comment_id": 101790359, "body": "It would be great if you can paste ruby code here."}], "answers": [{"comments": [{"owner": {"reputation": 10688, "user_id": 790884, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/27659e10cd4f89b49d677aacc2ebc064?s=128&d=identicon&r=PG", "display_name": "Thomas Edwards", "link": "https://stackoverflow.com/users/790884/thomas-edwards"}, "edited": false, "score": 0, "creation_date": 1566898014, "post_id": 57671515, "comment_id": 101790461, "body": "Thanks for this \u2013 my conditions get quite complex, so my line length would become horrible to read quite quickly. But perfectly valid answer!"}, {"owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "reply_to_user": {"reputation": 10688, "user_id": 790884, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/27659e10cd4f89b49d677aacc2ebc064?s=128&d=identicon&r=PG", "display_name": "Thomas Edwards", "link": "https://stackoverflow.com/users/790884/thomas-edwards"}, "edited": false, "score": 1, "creation_date": 1566898169, "post_id": 57671515, "comment_id": 101790534, "body": "You can move it to a separate method/labdas (or set of lambdas/methods)"}], "tags": [], "owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "is_accepted": false, "score": 0, "last_activity_date": 1566898207, "last_edit_date": 1566898207, "creation_date": 1566897799, "answer_id": 57671515, "question_id": 57671487, "link": "https://stackoverflow.com/questions/57671487/how-to-reject-or-select-based-on-more-than-one-condition-in-ruby/57671515#57671515", "title": "How to reject or select based on more than one condition in Ruby", "body": "<p>You can use logical \"and\" (<code>&amp;&amp;</code>) to concatenate conditions</p>\n\n<pre><code>pages.select! do |page|\n  page['content'] &amp;&amp; page['content']['score'] &amp;&amp; page['content']['score'] &gt; 75\nend\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 48413, "user_id": 1279683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1veuT.jpg?s=128&g=1", "display_name": "Marek Lipka", "link": "https://stackoverflow.com/users/1279683/marek-lipka"}, "edited": false, "score": 0, "creation_date": 1566898160, "post_id": 57671572, "comment_id": 101790529, "body": "Keep in mind though that <code>dig</code> was introduced in Ruby 2.4, if I remember correctly, so you can&#39;t use this approach in earlier versions."}, {"owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "reply_to_user": {"reputation": 48413, "user_id": 1279683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1veuT.jpg?s=128&g=1", "display_name": "Marek Lipka", "link": "https://stackoverflow.com/users/1279683/marek-lipka"}, "edited": false, "score": 1, "creation_date": 1566900375, "post_id": 57671572, "comment_id": 101791760, "body": "Thanks @MarekLipka, I hope he doesn&#39;t have problems using dig, I can&#39;t think in a cleaner example without using that method."}, {"owner": {"reputation": 91121, "user_id": 179125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5594142dcc49a24b1902ec8059181f8d?s=128&d=identicon&r=PG&f=1", "display_name": "Jordan Running", "link": "https://stackoverflow.com/users/179125/jordan-running"}, "edited": false, "score": 1, "creation_date": 1566925023, "post_id": 57671572, "comment_id": 101805208, "body": "This is a good answer, but: &quot;<code>next</code> in an enumerator returns the next object, and move the internal position forward. When the position reached at the end, StopIteration is raised.&quot; I think you&#39;re conflating <a href=\"https://ruby-doc.org/core-2.6/doc/syntax/control_expressions_rdoc.html#label-next+Statement\" rel=\"nofollow noreferrer\"><code>next</code> keyword</a> with the  <a href=\"https://ruby-doc.org/core-2.6.3/Enumerator.html#method-i-next\" rel=\"nofollow noreferrer\"><code>Enumerator#next</code> method</a>. Your code users the former, but your description concerns the latter."}, {"owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "reply_to_user": {"reputation": 91121, "user_id": 179125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5594142dcc49a24b1902ec8059181f8d?s=128&d=identicon&r=PG&f=1", "display_name": "Jordan Running", "link": "https://stackoverflow.com/users/179125/jordan-running"}, "edited": false, "score": 0, "creation_date": 1566925943, "post_id": 57671572, "comment_id": 101805586, "body": "Oh, yes @JordanRunning, sorry for that. I&#39;ve updated that part, thanks!"}], "tags": [], "owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "is_accepted": true, "score": 4, "last_activity_date": 1566925990, "last_edit_date": 1566925990, "creation_date": 1566897991, "answer_id": 57671572, "question_id": 57671487, "link": "https://stackoverflow.com/questions/57671487/how-to-reject-or-select-based-on-more-than-one-condition-in-ruby/57671572#57671572", "title": "How to reject or select based on more than one condition in Ruby", "body": "<p>You can use <code>dig</code>, which can access to nested keys in a hash, it returns nil if it can't access to at least one of them, then use the safe operator to do the comparison:</p>\n\n<pre><code>p pages.select { |page| page.dig('content', 'score')&amp;.&gt; 75 }\n#\u00a0[{\"id\"=&gt;100, \"content\"=&gt;{\"score\"=&gt;100}}]\n</code></pre>\n\n<p>Notice this \"filter\" is done in one step, so you don't need to mutate your object.</p>\n\n<p>For your <em>make-belive</em> approach, you need to replace the <code>return</code>s with <code>next</code>:</p>\n\n<pre><code>pages = pages.select do |page|\n  next unless page['content']\n  next unless page['content']['score']\n  page['content']['score'] &gt; 75\nend\n\np pages # [{\"id\"=&gt;100, \"content\"=&gt;{\"score\"=&gt;100}}]\n</code></pre>\n\n<p>There <code>next</code> is used to skip the rest of the current iteration.</p>\n\n<hr>\n\n<p>You can save one line in that example, if you use fetch and pass as the default value an empty hash:</p>\n\n<pre><code>pages.select do |page|\n  next unless page.fetch('content', {})['score']\n\n  page['content']['score'] &gt; 75\nend\n</code></pre>\n\n<p>Same way you can do just <code>page.fetch('content', {}).fetch('score', 0) &gt; 75</code> (but better don't).</p>\n"}, {"tags": [], "owner": {"reputation": 48413, "user_id": 1279683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1veuT.jpg?s=128&g=1", "display_name": "Marek Lipka", "link": "https://stackoverflow.com/users/1279683/marek-lipka"}, "is_accepted": false, "score": 1, "last_activity_date": 1566898090, "creation_date": 1566898090, "answer_id": 57671606, "question_id": 57671487, "link": "https://stackoverflow.com/questions/57671487/how-to-reject-or-select-based-on-more-than-one-condition-in-ruby/57671606#57671606", "title": "How to reject or select based on more than one condition in Ruby", "body": "<p>You can actually achieve this using <code>lambda</code>, where <code>return</code> means what you expect it to mean:</p>\n\n<pre><code>l = lambda do |page|\n  return false if !page['content'] || !page['content']['score']\n\n  page['content']['score'] &gt; 75\nend\n\npages.select(&amp;l)\n# =&gt; [{\"id\"=&gt;100, \"content\"=&gt;{\"score\"=&gt;100}}]\n</code></pre>\n\n<p>but I guess it's not very practical.</p>\n"}], "owner": {"reputation": 10688, "user_id": 790884, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/27659e10cd4f89b49d677aacc2ebc064?s=128&d=identicon&r=PG", "display_name": "Thomas Edwards", "link": "https://stackoverflow.com/users/790884/thomas-edwards"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 57671572, "answer_count": 3, "score": 2, "last_activity_date": 1566925990, "creation_date": 1566897703, "last_edit_date": 1566898310, "question_id": 57671487, "link": "https://stackoverflow.com/questions/57671487/how-to-reject-or-select-based-on-more-than-one-condition-in-ruby", "title": "How to reject or select based on more than one condition in Ruby", "body": "<p>An API I\u2019m using returns different content depending on circumstances.</p>\n\n<p>Here\u2019s a snippet of what the API might return:</p>\n\n<pre><code>pages = [\n  {\n    'id' =&gt; 100,\n    'content' =&gt; {\n      'score' =&gt; 100\n    },\n  },\n  {\n    'id' =&gt; 101,\n    'content' =&gt; {\n      'total' =&gt; 50\n    },\n  },\n  {\n    'id' =&gt; 102,\n  },\n]\n</code></pre>\n\n<p><code>content</code> is optional, and can contain different items.</p>\n\n<p>I would like to return a list of pages where the <code>score</code> is more than 75.</p>\n\n<p>So far this is as small as I can make it:</p>\n\n<pre><code>pages.select! do |page|\n  page['content']\nend\npages.select! do |page|\n  page['content']['score']\nend\npages.select! do |page|\n  page['content']['score'] &gt; 75\nend\n</code></pre>\n\n<p>If I was using JavaScript, I would do this:</p>\n\n<pre><code>pages.select(page =&gt; {\n    if (!page['content'] || !page['content']['score']) {\n        return false\n    }\n    return page['content']['score'] &gt; 75\n})\n</code></pre>\n\n<p>Or perhaps if I was using PHP, I would <code>array_filter</code> in a similar way.</p>\n\n<p>However, trying to do the same thing in Ruby throws this error:</p>\n\n<pre><code>LocalJumpError: unexpected return\n</code></pre>\n\n<p>I understand <a href=\"https://stackoverflow.com/questions/17800629/unexpected-return-localjumperror\">why you cannot do that</a>. I just want to find a simple way to achieve this in Ruby.</p>\n\n<hr>\n\n<p>Here\u2019s my make-believe Ruby I want to magically work:</p>\n\n<pre><code>pages = pages.select do |page|\n  return unless page['content']\n  return unless page['content']['score']\n  page['content']['score'] &gt; 75\nend\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "graphql"], "comments": [{"owner": {"reputation": 21, "user_id": 11982737, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9b75e03d369308206d01742b381e57a?s=128&d=identicon&r=PG&f=1", "display_name": "mimina", "link": "https://stackoverflow.com/users/11982737/mimina"}, "reply_to_user": {"reputation": 2251, "user_id": 9785060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IUduC.png?s=128&g=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/9785060/viktor"}, "edited": false, "score": 0, "creation_date": 1566898947, "post_id": 57670994, "comment_id": 101790968, "body": "I just want to know how context look like in this situation?"}], "answers": [{"tags": [], "owner": {"reputation": 438, "user_id": 6172474, "user_type": "registered", "profile_image": "https://graph.facebook.com/632556816897172/picture?type=large", "display_name": "Ph\u01b0\u1edbc H\u1eefu L\u01b0u", "link": "https://stackoverflow.com/users/6172474/ph%c6%b0%e1%bb%9bc-h%e1%bb%afu-l%c6%b0u"}, "is_accepted": false, "score": 4, "last_activity_date": 1570054025, "last_edit_date": 1570054025, "creation_date": 1566916194, "answer_id": 57676932, "question_id": 57670994, "link": "https://stackoverflow.com/questions/57670994/understanding-context-in-graphql-ruby-on-rails/57676932#57676932", "title": "Understanding &#39;context&#39; in GraphQL - Ruby on Rails", "body": "<p>You can provide application-specific values to GraphQL as context:. This is available in many places:</p>\n\n<ul>\n<li>resolve functions</li>\n<li>Schema#resolve_type hook</li>\n<li>ID generation &amp; fetching</li>\n</ul>\n\n<p>Common uses for context: include the current user or auth token. To provide a context: value, pass a hash to Schema#execute:</p>\n\n<pre><code>    # graphql_controller.rb\n\n    context = {\n      current_user: session[:current_user],\n      current_organization: session[:current_organization],\n    }\n\n    MySchema.execute(query_string, context: context)\n\n</code></pre>\n\n<p>Then, you can access those values during execution:</p>\n\n<pre><code>\n    field :post, Post, null: true do\n      argument :id, ID, required: true\n    end\n\n    def post(id:)\n      context[:current_user] # =&gt; #&lt;User id=123 ... &gt;\n      # ...\n    end\n\n</code></pre>\n\n<p>Note that context is not the hash that you passed it. It's an instance of <code>{{ \"GraphQL::Query::Context\" | api_doc }}</code>, but it delegates <code>#[]</code>, <code>#[]=</code>, and a few other methods to the hash you provide.</p>\n"}], "owner": {"reputation": 21, "user_id": 11982737, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9b75e03d369308206d01742b381e57a?s=128&d=identicon&r=PG&f=1", "display_name": "mimina", "link": "https://stackoverflow.com/users/11982737/mimina"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1393, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1570054025, "creation_date": 1566895999, "question_id": 57670994, "link": "https://stackoverflow.com/questions/57670994/understanding-context-in-graphql-ruby-on-rails", "title": "Understanding &#39;context&#39; in GraphQL - Ruby on Rails", "body": "<p>I am reading GraphQL mutation part, and I do not understand what is <code>context</code> in this part, and what <code>context[:current_user]</code> returns</p>\n\n<p>This is the sample code:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>class Mutations::PromoteEmployee &lt; Mutations::BaseMutation\n  def ready?(**args)\n    # Called with mutation args.\n    # Use keyword args such as employee_id: or **args to collect them\n    if !context[:current_user].admin?\n      raise GraphQL::ExecutionError, \"Only admins can run this mutation\"\n    else\n      # Return true to continue the mutation:\n      true\n    end\n  end\n\n  # ...\nend\n</code></pre>\n\n<p>This is guides link: <a href=\"https://graphql-ruby.org/mutations/mutation_authorization.html\" rel=\"nofollow noreferrer\">https://graphql-ruby.org/mutations/mutation_authorization.html</a></p>\n"}, {"tags": ["regex", "ruby", "fluentd"], "comments": [{"owner": {"reputation": 91443, "user_id": 5424988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b4f91c20dcd87cbd58dd351455198c?s=128&d=identicon&r=PG&f=1", "display_name": "The fourth bird", "link": "https://stackoverflow.com/users/5424988/the-fourth-bird"}, "edited": false, "score": 0, "creation_date": 1566895818, "post_id": 57670874, "comment_id": 101789216, "body": "Try <code>(?&lt;=\\[)\\d+(?=\\])</code> <a href=\"https://regex101.com/r/HfGtlN/1\" rel=\"nofollow noreferrer\">regex101.com/r/HfGtlN/1</a>"}, {"owner": {"reputation": 481662, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "reply_to_user": {"reputation": 91443, "user_id": 5424988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b4f91c20dcd87cbd58dd351455198c?s=128&d=identicon&r=PG&f=1", "display_name": "The fourth bird", "link": "https://stackoverflow.com/users/5424988/the-fourth-bird"}, "edited": false, "score": 0, "creation_date": 1566897590, "post_id": 57670874, "comment_id": 101790192, "body": "Here is a <a href=\"https://stackoverflow.com/a/57671253/3832970\">bunch of solutions</a> with an improved @Thefourthbird&#39;s suggestion, too."}, {"owner": {"reputation": 95, "user_id": 11248253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa713fba0822736af43bb47a260bbff0?s=128&d=identicon&r=PG&f=1", "display_name": "Charith_32", "link": "https://stackoverflow.com/users/11248253/charith-32"}, "reply_to_user": {"reputation": 481662, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1566899113, "post_id": 57670874, "comment_id": 101791047, "body": "@Wiktor I am using this in fluentd to separate logs. I can only use just the regex expression. Can you  give me a solution?"}, {"owner": {"reputation": 481662, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1566900103, "post_id": 57670874, "comment_id": 101791597, "body": "Use <code>\\[(?&lt;val&gt;\\d+)\\]</code>, the value you need is in Group &quot;val&quot;."}, {"owner": {"reputation": 95, "user_id": 11248253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa713fba0822736af43bb47a260bbff0?s=128&d=identicon&r=PG&f=1", "display_name": "Charith_32", "link": "https://stackoverflow.com/users/11248253/charith-32"}, "reply_to_user": {"reputation": 481662, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1566900295, "post_id": 57670874, "comment_id": 101791712, "body": "@Wiktor this is what I needed, Can you please explain this a bit!"}], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 11248253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa713fba0822736af43bb47a260bbff0?s=128&d=identicon&r=PG&f=1", "display_name": "Charith_32", "link": "https://stackoverflow.com/users/11248253/charith-32"}, "edited": false, "score": 0, "creation_date": 1566899642, "post_id": 57670958, "comment_id": 101791340, "body": "Is there a way that I can get <b>2</b> as the full match. I want this to be used in fluentd, It only takes the full match!"}], "tags": [], "owner": {"reputation": 5312, "user_id": 6535997, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/10156345016155058/picture?type=large", "display_name": "Mark", "link": "https://stackoverflow.com/users/6535997/mark"}, "is_accepted": false, "score": 0, "last_activity_date": 1566895888, "creation_date": 1566895888, "answer_id": 57670958, "question_id": 57670874, "link": "https://stackoverflow.com/questions/57670874/get-the-second-match-by-regex/57670958#57670958", "title": "Get the second match by regex", "body": "<p>From <a href=\"https://stackoverflow.com/questions/28780476/extract-string-between-square-brackets-at-second-occurrence\">extract string between square brackets at second occurrence</a></p>\n\n<pre><code>/\\[[^\\]]*\\][^[]*\\[([^\\]]*)\\]/\n</code></pre>\n\n<p>You can use this, and need the second capture group.</p>\n"}, {"tags": [], "owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "is_accepted": false, "score": 0, "last_activity_date": 1566895963, "creation_date": 1566895963, "answer_id": 57670980, "question_id": 57670874, "link": "https://stackoverflow.com/questions/57670874/get-the-second-match-by-regex/57670980#57670980", "title": "Get the second match by regex", "body": "<p>If you know that it's always the second match, you can use <code>scan</code> and take the second result:</p>\n\n<pre><code>\"[2019-07-29 09:48:11,928] @hr.com [2] [AM] WARN\".scan(/\\[([^\\]]*)\\]/)[1].first\n# =&gt; \"2\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 481662, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 3, "last_activity_date": 1566900331, "last_edit_date": 1566900331, "creation_date": 1566896924, "answer_id": 57671253, "question_id": 57670874, "link": "https://stackoverflow.com/questions/57670874/get-the-second-match-by-regex/57671253#57671253", "title": "Get the second match by regex", "body": "<p>To get a substring between <code>[</code> and <code>]</code> (square brackets) excluding the brackets you may use <code>/\\[([^\\]\\[]*)\\]/</code> regex:</p>\n\n<ul>\n<li><code>\\[</code> - a <code>[</code> char</li>\n<li><code>([^\\]\\[]*)</code> - Capturing group 1: any 0+ chars other than <code>[</code> and <code>]</code></li>\n<li><code>\\]</code> - a <code>]</code> char.</li>\n</ul>\n\n<p>To get the <em>second</em> match, you may use</p>\n\n<pre><code>str = '[2019-07-29 09:48:11,928] @hr.com [2] [AM] WARN'\np str[/\\[[^\\]\\[]*\\].*?\\[([^\\]\\[]*)\\]/m, 1]\n</code></pre>\n\n<p>See <a href=\"https://ideone.com/8SvMKo\" rel=\"nofollow noreferrer\">this Ruby demo</a>. Here, </p>\n\n<ul>\n<li><code>\\[[^\\]\\[]*\\]</code> - finds the first <code>[...]</code> substring</li>\n<li><code>.*?</code> - matches any 0+ chars as few as possible</li>\n<li><code>\\[([^\\]\\[]*)\\]</code> - finds the second <code>[...]</code> substring and captures the inner contents, returned with the help of the second argument, <code>1</code>.</li>\n</ul>\n\n<p>To get Nth match, you may also consider using</p>\n\n<pre><code>str = '[2019-07-29 09:48:11,928] @hr.com [2] [AM] WARN'\nresult = ''\ncnt = 0\nstr.scan(/\\[([^\\]\\[]*)\\]/) { |match| result = match[0]; cnt +=1; break if cnt &gt;= 2}\nputs result #=&gt; 2\n</code></pre>\n\n<p>See the <a href=\"https://ideone.com/G6FZ61\" rel=\"nofollow noreferrer\">Ruby demo</a></p>\n\n<p><strong>Note</strong> that if there are fewer matches than you expect, this solution will return the last matched substring.</p>\n\n<p>Another solution that is not generic and only suits this concrete case: extract the first occurrence of an int number inside square brackets:</p>\n\n<pre><code>s = \"[2019-07-29 09:48:11,928] @hr.com [2] [AM] WARN\"\nputs s[/\\[(\\d+)\\]/, 1] # =&gt; 2\n</code></pre>\n\n<p>See the <a href=\"https://ideone.com/GFXaNF\" rel=\"nofollow noreferrer\">Ruby demo</a>.</p>\n\n<p>To use the regex in Fluentd, use</p>\n\n<pre><code>\\[(?&lt;val&gt;\\d+)\\]\n</code></pre>\n\n<p>and the value you need is in the <code>val</code> named group. <code>\\[</code> matches <code>[</code>, <code>(?&lt;val&gt;\\d+)</code> is a <em>named capturing group</em> matching 1+ digits and <code>]</code> matches a <code>]</code>.</p>\n\n<p><a href=\"http://fluentular.herokuapp.com\" rel=\"nofollow noreferrer\">Fluentular</a> shows:</p>\n\n<blockquote>\n  <p>Copy and paste to <code>fluent.conf</code> or <code>td-agent.conf</code></p>\n\n<pre>\n     \n      type tail \n      path /var/log/foo/bar.log \n      pos_file /var/log/td-agent/foo-bar.log.pos \n      tag foo.bar \n      format /\\[(?\\d+)\\]/ \n    \n</pre>\n  \n  <p><strong>Records</strong></p>\n\n<pre>\n Key    Value\n val    2\n</pre>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": false, "score": 0, "last_activity_date": 1571556242, "creation_date": 1571556242, "answer_id": 58470884, "question_id": 57670874, "link": "https://stackoverflow.com/questions/57670874/get-the-second-match-by-regex/58470884#58470884", "title": "Get the second match by regex", "body": "<pre><code>def nth_match(str, n)\n  str[/(?:[^\\[]*\\[){#{n}}([^\\]]*)\\]/, 1]\nend\n</code></pre>\n\n<h1><p></p></h1>\n\n<pre><code>str = \"Little [Miss] Muffet [sat] on a [tuffet] eating [pie].\"\n\nnth_match(str, 1)  #=&gt; \"Miss\" \nnth_match(str, 2)  #=&gt; \"sat\" \nnth_match(str, 3)  #=&gt; \"tuffet\" \nnth_match(str, 4)  #=&gt; \"pie\" \nnth_match(str, 5)  #=&gt; nil \n</code></pre>\n\n<p>We could write the regular expression in free-spacing mode to document it.</p>\n\n<pre><code>/\n(?:       # begin a non-capture group\n  [^\\[]*  # match zero or more characters other than '['\n  \\[      # match '['\n){#{n}}   # end non-capture group and execute it n times\n(         # start capture group 1,\n  [^\\]]*  # match zero or more characters other than ']' \n)         # end capture group 1\n\\]        # match ']'\n/x        # free-spacing regex definition mode\n\n/(?:[^\\[]*\\[){#{n}}([^\\]]*)\\]/\n</code></pre>\n"}], "owner": {"reputation": 95, "user_id": 11248253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa713fba0822736af43bb47a260bbff0?s=128&d=identicon&r=PG&f=1", "display_name": "Charith_32", "link": "https://stackoverflow.com/users/11248253/charith-32"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1023, "favorite_count": 2, "accepted_answer_id": 57671253, "answer_count": 4, "score": 4, "last_activity_date": 1571556242, "creation_date": 1566895661, "last_edit_date": 1566900130, "question_id": 57670874, "link": "https://stackoverflow.com/questions/57670874/get-the-second-match-by-regex", "title": "Get the second match by regex", "body": "<p>I want to get the second occurrence of the matching pattern (inside the brackets) by using a regex.\nHere is the text </p>\n\n<pre><code>[2019-07-29 09:48:11,928] @hr.com [2] [AM] WARN\n</code></pre>\n\n<p>I want to extract <strong>2</strong> from this text.I tried using</p>\n\n<pre><code>(?&lt;Ten ID&gt;((^)*((?&lt;=\\[).+?(?=\\]))))\n</code></pre>\n\n<p>But it matches <strong>2019-07-29 09:48:11</strong>,<strong>928</strong> , <strong>2</strong> , <strong>AM</strong>.\nHow to get only <strong>2</strong> ?</p>\n"}, {"tags": ["ruby", "yard"], "answers": [{"tags": [], "owner": {"reputation": 98, "user_id": 13601915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acbfb07b1e84fc2cd245da80c6064b2b?s=128&d=identicon&r=PG&f=1", "display_name": "ret394", "link": "https://stackoverflow.com/users/13601915/ret394"}, "is_accepted": true, "score": 3, "last_activity_date": 1618775317, "last_edit_date": 1618775317, "creation_date": 1600902342, "answer_id": 64037436, "question_id": 57670571, "link": "https://stackoverflow.com/questions/57670571/how-to-document-an-inherited-constructor-using-yard/64037436#64037436", "title": "How to document an inherited constructor using Yard", "body": "<p>Try using this with yard. And ruby version 2.6</p>\n<pre><code>class Foo\n  def initialize(data)\n  end\nend\n\nclass Bar &lt; Foo\n  # @overload initialize(data)\n  # @param [String] data list\n  # def initialize()\n  # end\nend\n</code></pre>\n<p>And check the generated <code>class_list.html</code> file.</p>\n<p>Tested it on a Linux distro.</p>\n<hr />\n<p>If there's any other technical issue, or you need a customized Ruby documentation solution as a temporary measure.</p>\n"}], "owner": {"reputation": 5449, "user_id": 681520, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/701baebf68d1d7faa9f9def6a24fe356?s=128&d=identicon&r=PG", "display_name": "Kimmo Lehto", "link": "https://stackoverflow.com/users/681520/kimmo-lehto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "accepted_answer_id": 64037436, "answer_count": 1, "score": 4, "last_activity_date": 1618775317, "creation_date": 1566894430, "last_edit_date": 1601045389, "question_id": 57670571, "link": "https://stackoverflow.com/questions/57670571/how-to-document-an-inherited-constructor-using-yard", "title": "How to document an inherited constructor using Yard", "body": "<p>Having classes, such as:</p>\n<pre><code>class Foo\n  def initialize(data)\n  end\nend\n\nclass Bar &lt; Foo\nend\n</code></pre>\n<p>Each subclass that inherits from <code>Foo</code> has its own unique attributes, passed in via the <code>data</code> options hash.</p>\n<p>The yard output for <code>Bar</code> states:</p>\n<pre class=\"lang-none prettyprint-override\"><code>Constructor Details\nThis class inherits a constructor from Foo\n</code></pre>\n<p>I haven't been able to figure out how to document the options for <code>Bar#initialize</code>.</p>\n<p>Attempts include:</p>\n<pre><code>class Bar &lt; Foo\n  # @overload initialize(data)\n  #   @param data [Hash]\n  #   @option data [String] :baz Value for baz attribute\nend\n</code></pre>\n<p>(does nothing)</p>\n<pre><code>class Bar &lt; Foo\n  # @param data [Hash]\n  # @option data [String] :baz Value for baz attribute\n  # @!parse def initialize(data); end\nend\n</code></pre>\n<p>(creates an undocumented constructor with &quot;view source&quot; showing the fake method)</p>\n<pre><code>class Bar &lt; Foo\n  # @!parse\n  #   @param data [Hash]\n  #   @option data [String] :baz Baz attr\n  #   def initialize(data); end\nend\n</code></pre>\n<p>(does nothing, result is the same as with <code>@overload</code> above)</p>\n<p>How can I document the options for the subclasses using YARD?</p>\n"}, {"tags": ["ruby-on-rails", "regex", "ruby", "ip"], "answers": [{"comments": [{"owner": {"reputation": 1456, "user_id": 2247949, "user_type": "registered", "accept_rate": 21, "profile_image": "https://i.stack.imgur.com/Q2cWr.jpg?s=128&g=1", "display_name": "SST", "link": "https://stackoverflow.com/users/2247949/sst"}, "edited": false, "score": 0, "creation_date": 1566903583, "post_id": 57671608, "comment_id": 101793386, "body": "Getting &quot;Regexp anchor characters are not allowed in routing requirements&quot; while running."}, {"owner": {"reputation": 1322, "user_id": 11801415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/639b82f4bb7b8d9545d0fbc725cfcd36?s=128&d=identicon&r=PG&f=1", "display_name": "Lyzard Kyng", "link": "https://stackoverflow.com/users/11801415/lyzard-kyng"}, "reply_to_user": {"reputation": 1456, "user_id": 2247949, "user_type": "registered", "accept_rate": 21, "profile_image": "https://i.stack.imgur.com/Q2cWr.jpg?s=128&g=1", "display_name": "SST", "link": "https://stackoverflow.com/users/2247949/sst"}, "edited": false, "score": 0, "creation_date": 1566909306, "post_id": 57671608, "comment_id": 101796634, "body": "Oh yes, routes <code>:constraints</code> takes regular expressions with the restriction that regexp anchors can&#39;t be used. Answer has been edited."}], "tags": [], "owner": {"reputation": 1322, "user_id": 11801415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/639b82f4bb7b8d9545d0fbc725cfcd36?s=128&d=identicon&r=PG&f=1", "display_name": "Lyzard Kyng", "link": "https://stackoverflow.com/users/11801415/lyzard-kyng"}, "is_accepted": false, "score": 2, "last_activity_date": 1566909219, "last_edit_date": 1566909219, "creation_date": 1566898102, "answer_id": 57671608, "question_id": 57669943, "link": "https://stackoverflow.com/questions/57669943/how-to-form-a-regex-for-accepting-only-ipv4-or-ipv6-specific-ip-value-in-the-pat/57671608#57671608", "title": "How to form a regex for accepting only IPv4 or IPv6 specific IP value in the path param", "body": "<p>I'm using these:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code># IPv4\n/(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)/\n# IPv6\n/(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/\n\n</code></pre>\n"}], "owner": {"reputation": 1456, "user_id": 2247949, "user_type": "registered", "accept_rate": 21, "profile_image": "https://i.stack.imgur.com/Q2cWr.jpg?s=128&g=1", "display_name": "SST", "link": "https://stackoverflow.com/users/2247949/sst"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566909219, "creation_date": 1566892007, "last_edit_date": 1566892563, "question_id": 57669943, "link": "https://stackoverflow.com/questions/57669943/how-to-form-a-regex-for-accepting-only-ipv4-or-ipv6-specific-ip-value-in-the-pat", "title": "How to form a regex for accepting only IPv4 or IPv6 specific IP value in the path param", "body": "<p>How to form a regex for accepting only IPv4 or IPv6 specific IP value in the path param. Right now it accepts a generic string as given below in <code>config/routes.rb</code></p>\n\n<pre><code>get \"ip/:id\", to: \"ip#show\", constraints: { id: /[^\\/]+/ }\n</code></pre>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 2251, "user_id": 9785060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IUduC.png?s=128&g=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/9785060/viktor"}, "edited": false, "score": 1, "creation_date": 1566891672, "post_id": 57669607, "comment_id": 101787237, "body": "You want to use <code>print</code>, not <code>puts</code>"}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 1, "creation_date": 1566893600, "post_id": 57669607, "comment_id": 101788109, "body": "You should use <code>||</code> instead of <code>or</code>. The latter is a control flow operator and probably not what you want."}], "answers": [{"comments": [{"owner": {"reputation": 2251, "user_id": 9785060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IUduC.png?s=128&g=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/9785060/viktor"}, "edited": false, "score": 0, "creation_date": 1566891873, "post_id": 57669708, "comment_id": 101787323, "body": "This doesn&#39;t even print anything. You&#39;re just making a string"}, {"owner": {"reputation": 175, "user_id": 11659763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7059fcac02dc17ae08896bbaf20cfa02?s=128&d=identicon&r=PG", "display_name": "user11659763", "link": "https://stackoverflow.com/users/11659763/user11659763"}, "reply_to_user": {"reputation": 2251, "user_id": 9785060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IUduC.png?s=128&g=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/9785060/viktor"}, "edited": false, "score": 0, "creation_date": 1566895145, "post_id": 57669708, "comment_id": 101788859, "body": "I know ^^ I adapted to its use of the function : <code>puts print_silly_name</code>"}], "tags": [], "owner": {"reputation": 175, "user_id": 11659763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7059fcac02dc17ae08896bbaf20cfa02?s=128&d=identicon&r=PG", "display_name": "user11659763", "link": "https://stackoverflow.com/users/11659763/user11659763"}, "is_accepted": false, "score": 0, "last_activity_date": 1566895159, "last_edit_date": 1566895159, "creation_date": 1566891035, "answer_id": 57669708, "question_id": 57669607, "link": "https://stackoverflow.com/questions/57669607/print-loop-results-on-the-same-line-instead-of-a-new-line-for-each-iteration/57669708#57669708", "title": "Print loop results on the same line instead of a new line for each iteration", "body": "<p>Your question isn't really clear but I guess you wan't something like that :</p>\n\n<pre><code>def print_silly_name\n  puts Array.new(60, 'silly').join(' ')\nend\n\ndef main\n  name = read_string('Please enter your name: ')\n  if ( name == \"benyamin\") || ( name == \"jack\" )\n    puts  \" #{name} that is a nice name\"\n  else \n    print_silly_name\n  end\nend\n\nmain\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 358, "user_id": 8708097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/APLHT.jpg?s=128&g=1", "display_name": "Saif chaudhry", "link": "https://stackoverflow.com/users/8708097/saif-chaudhry"}, "is_accepted": false, "score": -2, "last_activity_date": 1566892225, "creation_date": 1566892225, "answer_id": 57669989, "question_id": 57669607, "link": "https://stackoverflow.com/questions/57669607/print-loop-results-on-the-same-line-instead-of-a-new-line-for-each-iteration/57669989#57669989", "title": "Print loop results on the same line instead of a new line for each iteration", "body": "<p>Use this to print silly 60 times</p>\n\n<p><code>def print_silly_name ()\n    puts \"silly \"* 60\n end</code></p>\n"}, {"tags": [], "owner": {"reputation": 2251, "user_id": 9785060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IUduC.png?s=128&g=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/9785060/viktor"}, "is_accepted": false, "score": 0, "last_activity_date": 1566895560, "last_edit_date": 1566895560, "creation_date": 1566895258, "answer_id": 57670776, "question_id": 57669607, "link": "https://stackoverflow.com/questions/57669607/print-loop-results-on-the-same-line-instead-of-a-new-line-for-each-iteration/57670776#57670776", "title": "Print loop results on the same line instead of a new line for each iteration", "body": "<p>Looking at your code, you have a few issues there:</p>\n\n<ol>\n<li>The main one you mentioned in your question and title is that the name you print comes in a new row for each iteration of the loop. That's because you're using <code>puts</code> but should be using <code>print</code> in your case. <a href=\"https://stackoverflow.com/questions/5018633/what-is-the-difference-between-print-and-puts\">You can read more about that here</a></li>\n</ol>\n\n<p>2.You're calling the <code>#read_string</code> method which isn't defined anywhere in your code. What you want to do is either replace it with <code>gets.chomp</code> <a href=\"https://stackoverflow.com/questions/23193813/how-does-gets-and-gets-chomp-in-ruby-work\">More about gets here</a> or define your <code>#read_string</code> method like this:</p>\n\n<pre><code>def read_string\n  gets.chomp\nend\n</code></pre>\n\n<p>3.As Stefan mentioned, you're using <code>or</code> which probably isn't what you're looking for here (<a href=\"https://stackoverflow.com/questions/2083112/difference-between-or-and-in-ruby\">More about that here</a>) You're better off using the <code>||</code> operator in your case.</p>\n\n<p>Fixing these mistakes brings us to a working version of your code:</p>\n\n<pre><code>def print_silly_name_60_times\n  60.times do\n    print \"silly \"\n  end\nend\n\ndef main\n  name = gets.chomp\n  if ( name == \"benyamin\") || ( name == \"jack\" )\n    puts  \" #{name} that is a nice name.\"\n  else\n    print_silly_name_60_times\n  end\nend\n\nmain\n</code></pre>\n\n<p>After cleaning up a few things and making it a bit more compact, we get:</p>\n\n<pre><code>def print_silly_name_60_times\n  60.times{print \"silly \"}\nend\n\ndef main\n  name = gets.chomp\n  %w(benyamin jack).include?(name) ? (puts  \" #{name} that is a nice name.\") : print_silly_name_60_times\nend\n\nmain\n</code></pre>\n"}], "owner": {"reputation": 5, "user_id": 11982323, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAd4uIHZyE2DjvKzlUJgAcMKULdtfnWaiT7DJsq=k-s128", "display_name": "jack", "link": "https://stackoverflow.com/users/11982323/jack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 95, "favorite_count": 0, "answer_count": 3, "score": -1, "last_activity_date": 1566907609, "creation_date": 1566890656, "last_edit_date": 1566907609, "question_id": 57669607, "link": "https://stackoverflow.com/questions/57669607/print-loop-results-on-the-same-line-instead-of-a-new-line-for-each-iteration", "title": "Print loop results on the same line instead of a new line for each iteration", "body": "<p>I want my code to print <code>silly</code> only on one line but instead it prints it like this:</p>\n\n<pre><code>silly\nsilly\nsilly\n</code></pre>\n\n<p>I want this:</p>\n\n<pre><code>silly silly silly \n</code></pre>\n\n<p>This is my code:</p>\n\n<pre><code>    def print_silly_name ()\n       i = 0\n       while ( i &lt; 60 )\n         puts \"silly\"\n         i += 1 \n       end\n    end\n\n    def main\n      name = read_string('Please enter your name: ')\n      if ( name == \"benyamin\") or ( name == \"jack\" )\n        puts  \" #{name} that is a nice name\"\n      else \n        puts print_silly_name\n      end\n    end\n\n    main\n</code></pre>\n"}, {"tags": ["ruby", "multithreading"], "answers": [{"comments": [{"owner": {"reputation": 15911, "user_id": 445908, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/MwXTa.jpg?s=128&g=1", "display_name": "Siwei", "link": "https://stackoverflow.com/users/445908/siwei"}, "edited": false, "score": 0, "creation_date": 1566889835, "post_id": 57669325, "comment_id": 101786401, "body": "In other language such as Java/PHP,  do they act like Ruby? ( child thread terminated when the main thread exits )"}, {"owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "reply_to_user": {"reputation": 15911, "user_id": 445908, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/MwXTa.jpg?s=128&g=1", "display_name": "Siwei", "link": "https://stackoverflow.com/users/445908/siwei"}, "edited": false, "score": 0, "creation_date": 1566890039, "post_id": 57669325, "comment_id": 101786486, "body": "Yes, I believe it&#39;s the default behaviour: <a href=\"https://stackoverflow.com/questions/11875956/when-the-main-thread-exits-do-other-threads-also-exit\" title=\"when the main thread exits do other threads also exit\">stackoverflow.com/questions/11875956/&hellip;</a> <a href=\"https://stackoverflow.com/questions/4691533/java-wait-for-thread-to-finish\" title=\"java wait for thread to finish\">stackoverflow.com/questions/4691533/&hellip;</a>. You need to call <code>join</code> to wait for a thread."}, {"owner": {"reputation": 15911, "user_id": 445908, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/MwXTa.jpg?s=128&g=1", "display_name": "Siwei", "link": "https://stackoverflow.com/users/445908/siwei"}, "edited": false, "score": 0, "creation_date": 1566893713, "post_id": 57669325, "comment_id": 101788157, "body": "yeah, sure!  I found it seems that in Java, &quot;child thread&quot; will run when main thread terminates. in C/C++, it acts the same with Ruby.  I am not sure. so I will give enough test when I have time.  thank you very much!"}], "tags": [], "owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "is_accepted": true, "score": 2, "last_activity_date": 1566889588, "creation_date": 1566889588, "answer_id": 57669325, "question_id": 57669252, "link": "https://stackoverflow.com/questions/57669252/is-it-ok-that-child-thread-terminated-when-main-thread-exit-in-ruby/57669325#57669325", "title": "Is it OK that child thread terminated when main thread exit in Ruby?", "body": "<p>When the main thread exits, the process terminates and it stops all the other running threads. To avoid that, you can call <a href=\"https://ruby-doc.org/core-2.5.0/Thread.html#method-i-join\" rel=\"nofollow noreferrer\"><code>Thread#join</code></a> that waits for the other thread.</p>\n\n<pre><code>thread = Thread.new {\n  (1..10).each do |e| \n    `curl http://localhost/#{e}`\n  end \n}\n\nthread.join\n</code></pre>\n\n<p>Webservers processes most probably won't exit, but they may finish serving a request before the thread ends fetching the URL. It may be better to use a <a href=\"https://www.ruby-toolbox.com/categories/Background_Jobs\" rel=\"nofollow noreferrer\">background processing tool</a> to handle that case.</p>\n"}], "owner": {"reputation": 15911, "user_id": 445908, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/MwXTa.jpg?s=128&g=1", "display_name": "Siwei", "link": "https://stackoverflow.com/users/445908/siwei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 57669325, "answer_count": 1, "score": 1, "last_activity_date": 1566894995, "creation_date": 1566889275, "last_edit_date": 1566894995, "question_id": 57669252, "link": "https://stackoverflow.com/questions/57669252/is-it-ok-that-child-thread-terminated-when-main-thread-exit-in-ruby", "title": "Is it OK that child thread terminated when main thread exit in Ruby?", "body": "<p>Given a file looks like below: </p>\n\n<pre><code>Thread.new {\n  (1..10).each do |e| \n    `curl http://localhost/#{e}`\n  end \n}\n\nsleep 0.03\nputs \"--- done\"\n</code></pre>\n\n<p>When running this file, I found the \"child thread\" exits when it only sent 4-5 HTTP requests.</p>\n\n<p>My question is: is this because the \"ruby intepreter\" exited? (so all the ruby threads terminated?) </p>\n\n<p>How could I keep the \"child thread\" running when the \"main thread\" terminated? </p>\n\n<p>If I run this code in ruby webservers such as thin, puma, does this problem exist? </p>\n\n<p>Thank you.</p>\n"}, {"tags": ["ruby", "rubygems", "rvm"], "comments": [{"owner": {"reputation": 703, "user_id": 3744443, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/31cd958c40afab1804323dc579eeb4c5?s=128&d=identicon&r=PG&f=1", "display_name": "fidato", "link": "https://stackoverflow.com/users/3744443/fidato"}, "edited": false, "score": 0, "creation_date": 1566883716, "post_id": 57668118, "comment_id": 101784286, "body": "May be premission issue, please run chmod to the path and install gem again."}, {"owner": {"reputation": 313, "user_id": 4056267, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K1jA0.jpg?s=128&g=1", "display_name": "Dana Scheider", "link": "https://stackoverflow.com/users/4056267/dana-scheider"}, "reply_to_user": {"reputation": 703, "user_id": 3744443, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/31cd958c40afab1804323dc579eeb4c5?s=128&d=identicon&r=PG&f=1", "display_name": "fidato", "link": "https://stackoverflow.com/users/3744443/fidato"}, "edited": false, "score": 0, "creation_date": 1566886459, "post_id": 57668118, "comment_id": 101785082, "body": "@fidato The <code>gem install</code> command would run as my user, correct? That&#39;s the same user that owns that path. Was that what you were suggesting I change, or am I missing something?"}, {"owner": {"reputation": 703, "user_id": 3744443, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/31cd958c40afab1804323dc579eeb4c5?s=128&d=identicon&r=PG&f=1", "display_name": "fidato", "link": "https://stackoverflow.com/users/3744443/fidato"}, "edited": false, "score": 0, "creation_date": 1566887516, "post_id": 57668118, "comment_id": 101785452, "body": "You may run <code>chmod -R 777 &#47;Users&#47;danascheider&#47;.rvm&#47;gems</code> and execute it again."}, {"owner": {"reputation": 313, "user_id": 4056267, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K1jA0.jpg?s=128&g=1", "display_name": "Dana Scheider", "link": "https://stackoverflow.com/users/4056267/dana-scheider"}, "reply_to_user": {"reputation": 703, "user_id": 3744443, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/31cd958c40afab1804323dc579eeb4c5?s=128&d=identicon&r=PG&f=1", "display_name": "fidato", "link": "https://stackoverflow.com/users/3744443/fidato"}, "edited": false, "score": 0, "creation_date": 1567407298, "post_id": 57668118, "comment_id": 101941846, "body": "Hm, thanks for the suggestion, but that didn&#39;t do it."}], "owner": {"reputation": 313, "user_id": 4056267, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K1jA0.jpg?s=128&g=1", "display_name": "Dana Scheider", "link": "https://stackoverflow.com/users/4056267/dana-scheider"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 339, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1566883409, "creation_date": 1566883409, "question_id": 57668118, "link": "https://stackoverflow.com/questions/57668118/installing-into-parent-path-not-allowed-when-installing-locally-built-ruby-gem", "title": "Installing into parent path not allowed when installing locally built Ruby gem", "body": "<p>I've written a Ruby gem that I'd like to install locally. I'm using Rubygems 3.0.6 and RVM on OS X Mojave. This is a closed source gem and I'd rather not go to the trouble of publishing it to the company gemservers. I'm able to install other (published) gems just fine using both <code>bundle install</code> and <code>gem install</code>.</p>\n\n<p>The gem is all built (using <code>gem build</code>) and the code works, but when I run:</p>\n\n<pre><code>gem install influx_trello_utility-0.1.0.gem\n</code></pre>\n\n<p>I get an error:</p>\n\n<pre><code>ERROR:  While executing gem ... (Gem::Package::PathError)\n    installing into parent path /bin/[ of /Users/danascheider/.rvm/gems/ruby-2.6.3@influx_trello_utility/gems/influx_trello_utility-0.1.0 is not allowed\n</code></pre>\n\n<p>Any help with this would be much appreciated. I'm not sure what additional information would be useful, but I'm happy to answer any questions you may have. Thanks!</p>\n"}, {"tags": ["ruby", "algorithm"], "comments": [{"owner": {"reputation": 25637, "user_id": 6243352, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/715f60f9edc65642a6805752cfeebb27?s=128&d=identicon&r=PG&f=1", "display_name": "ggorlen", "link": "https://stackoverflow.com/users/6243352/ggorlen"}, "edited": false, "score": 2, "creation_date": 1566881307, "post_id": 57667782, "comment_id": 101783720, "body": "Welcome to SO! What happens on a string like <code>&quot;aba&quot;</code>? Do we get <code>&quot;b&quot;</code> or <code>&quot;aba&quot;</code>?"}, {"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 0, "creation_date": 1566882012, "post_id": 57667782, "comment_id": 101783899, "body": "It is much easier to write code when you don&#39;t have to break your brain trying to remember what is in which variable. <code>idx1</code> being a character and <code>idx2</code> being an index is <i>not ideal</i>. You are also printing two characters per loop iteration, which can&#39;t be right (imagine nothing needs to be removed - you&#39;d be printing double the characters in the string). And finally, you&#39;re printing when two characters are <i>the same</i>, not when they are different."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 11981738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d8431db13d033e09c117fcd1992b3f6?s=128&d=identicon&r=PG&f=1", "display_name": "kenyounot", "link": "https://stackoverflow.com/users/11981738/kenyounot"}, "edited": false, "score": 0, "creation_date": 1566881882, "post_id": 57667854, "comment_id": 101783868, "body": "Can you explain how to do this with a simple iterator, I don&#39;t really know how to use hashes, yet. Thanks. To answer ggorlens question and just so everyone is on the same page lets say the string characters are always given in alphabetical order, eg. &quot;aabbcdd&quot; would be reduced to &quot;c&quot;, thank you."}, {"owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 0, "creation_date": 1566881890, "post_id": 57667854, "comment_id": 101783871, "body": "I like that your first solution works because newer versions of Ruby remember the order in which the keys were added. The <code>(&#39;&#39;)</code> argument to <code>join</code> is not needed afaik."}, {"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 0, "creation_date": 1566882117, "post_id": 57667854, "comment_id": 101783922, "body": "Hashes are pretty much same as arrays, except they are indexed by almost anything, not by successive integers like arrays. This is a good opportunity to learn about hashes! :) However, if the characters are sorted as you suggest, the regexp solution  (second one) is the one you need. I will add a third one that doesn&#39;t use regexp."}, {"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "reply_to_user": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 0, "creation_date": 1566882204, "post_id": 57667854, "comment_id": 101783941, "body": "@spickermann I think you are right - JS defaults to commas, Ruby to nothing, and it&#39;s a bit of a pain in the behind to remember :P"}], "tags": [], "owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "is_accepted": false, "score": 5, "last_activity_date": 1566882445, "last_edit_date": 1566882445, "creation_date": 1566881661, "answer_id": 57667854, "question_id": 57667782, "link": "https://stackoverflow.com/questions/57667782/given-a-string-how-do-i-compare-the-characters-to-see-if-there-are-duplicates/57667854#57667854", "title": "Given a string, how do I compare the characters to see if there are duplicates?", "body": "<p>To only keep the unique characters (ggorlen's answer is \"b\"): count all characters, find only those that appear once. We rely on Ruby's Hash producing keys in insertion order.</p>\n\n<pre><code>def keep_unique_chars(str)\n  str.each_char.\n      with_object(Hash.new(0)) { |element, counts| counts[element] += 1 }.\n      select { |_, count| count == 1 }.\n      keys.\n      join\nend\n</code></pre>\n\n<p>To remove adjacent dupes only (ggorlen's answer is \"aba\"): a regular expression replacing adjacent repetitions is probably the go-to method.</p>\n\n<pre><code>def remove_adjacent_dupes(str)\n  str.gsub(/(.)\\1+/, '')\nend\n</code></pre>\n\n<p>Without regular expressions, we can use <code>slice_when</code> to cut the array when the character changes, then drop the groups that are too long. One might think a <code>flatten</code> would be required before <code>join</code>, but <code>join</code> doesn't care:</p>\n\n<pre><code>def remove_adjacent_dupes_without_regexp(str)\n  str.each_char.\n      slice_when { |prev, curr| prev != curr }.\n      select { |group| group.size == 1 }.\n      join\nend\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 1, "creation_date": 1566884020, "post_id": 57668077, "comment_id": 101784357, "body": "OP wants to remove anything repeating, not just extra copies. Note OP&#39;s example: <code>&quot;ttyyzx&quot;</code> needs to become <code>&quot;zx&quot;</code>, not <code>&quot;tyzx&quot;</code> as your code makes it."}, {"owner": {"reputation": 11741, "user_id": 1934428, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/072774c5d4204a1c2385560e6114a887?s=128&d=identicon&r=PG", "display_name": "user1934428", "link": "https://stackoverflow.com/users/1934428/user1934428"}, "reply_to_user": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 0, "creation_date": 1566885862, "post_id": 57668077, "comment_id": 101784900, "body": "@Amadan : Oops, you are right! I didn&#39;t get this correctly."}, {"owner": {"reputation": 11741, "user_id": 1934428, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/072774c5d4204a1c2385560e6114a887?s=128&d=identicon&r=PG", "display_name": "user1934428", "link": "https://stackoverflow.com/users/1934428/user1934428"}, "reply_to_user": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 0, "creation_date": 1566886297, "post_id": 57668077, "comment_id": 101785029, "body": "@Amadan : I have updated my answer. Would you kindly review it for correctness?"}, {"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 1, "creation_date": 1566886494, "post_id": 57668077, "comment_id": 101785092, "body": "Since OP stipulates that the letters are sorted already, <code>sort</code> is unnecessary. If it was not the case, then <code>sort</code> would have changed the order of the letters in the string. And <code>gsub(&#47;(.)\\1+&#47;,&#39;&#39;)</code> part is correct, as I wrote it in my answer over an hour ago :P"}, {"owner": {"reputation": 11741, "user_id": 1934428, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/072774c5d4204a1c2385560e6114a887?s=128&d=identicon&r=PG", "display_name": "user1934428", "link": "https://stackoverflow.com/users/1934428/user1934428"}, "reply_to_user": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 0, "creation_date": 1566890453, "post_id": 57668077, "comment_id": 101786705, "body": "Sorry, I didn&#39;t realize your answer :-("}, {"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 0, "creation_date": 1566890557, "post_id": 57668077, "comment_id": 101786746, "body": "(: No worries :)"}], "tags": [], "owner": {"reputation": 11741, "user_id": 1934428, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/072774c5d4204a1c2385560e6114a887?s=128&d=identicon&r=PG", "display_name": "user1934428", "link": "https://stackoverflow.com/users/1934428/user1934428"}, "is_accepted": false, "score": 0, "last_activity_date": 1566886262, "last_edit_date": 1566886262, "creation_date": 1566883150, "answer_id": 57668077, "question_id": 57667782, "link": "https://stackoverflow.com/questions/57667782/given-a-string-how-do-i-compare-the-characters-to-see-if-there-are-duplicates/57668077#57668077", "title": "Given a string, how do I compare the characters to see if there are duplicates?", "body": "<p>If speed is not an issue,</p>\n\n<pre><code>require 'set'\n...\nSet.new((\"xxyz\").split(\"\")).to_a.join # =&gt; xyz\n</code></pre>\n\n<p>Making it a <code>Set</code> removes duplicates.</p>\n\n<p><strong>UPDATE</strong>: As @Amadan pointed out in his comment, the OP does not want to remove duplicates and keep just a single copy, but remove all characters completely which occur more than once. So here is a new approach, again compact, but not fast:</p>\n\n<pre><code>\"xxyz\".split('').sort.join.gsub(/(.)\\1+/,'')\n</code></pre>\n\n<p>The idea is to sort the the letters; hence, identical letters will be joined together. The regexp <code>/(.)\\1+/</code> describes a repetition of a letter.</p>\n"}, {"comments": [{"owner": {"reputation": 13, "user_id": 11981738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d8431db13d033e09c117fcd1992b3f6?s=128&d=identicon&r=PG&f=1", "display_name": "kenyounot", "link": "https://stackoverflow.com/users/11981738/kenyounot"}, "edited": false, "score": 1, "creation_date": 1566925452, "post_id": 57669341, "comment_id": 101805375, "body": "This is exactly how I was trying to attempt it, thank you!"}, {"owner": {"reputation": 2251, "user_id": 9785060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IUduC.png?s=128&g=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/9785060/viktor"}, "reply_to_user": {"reputation": 13, "user_id": 11981738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d8431db13d033e09c117fcd1992b3f6?s=128&d=identicon&r=PG&f=1", "display_name": "kenyounot", "link": "https://stackoverflow.com/users/11981738/kenyounot"}, "edited": false, "score": 0, "creation_date": 1566989485, "post_id": 57669341, "comment_id": 101825821, "body": "You&#39;re welcome! Keep in mind, naming strings <code>string</code> or arrays <code>array</code> isn&#39;t the best way to go.The only reason I did it here it to make it a bit clearer what&#39;s going on."}], "tags": [], "owner": {"reputation": 2251, "user_id": 9785060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IUduC.png?s=128&g=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/9785060/viktor"}, "is_accepted": true, "score": 0, "last_activity_date": 1566889646, "creation_date": 1566889646, "answer_id": 57669341, "question_id": 57667782, "link": "https://stackoverflow.com/questions/57667782/given-a-string-how-do-i-compare-the-characters-to-see-if-there-are-duplicates/57669341#57669341", "title": "Given a string, how do I compare the characters to see if there are duplicates?", "body": "<p>While amadan's and user's solution definitely solve the problem I felt like writing a solution closer to the OP's attempt:</p>\n\n<pre><code>def clean(string)\nreturn string if string.length == 1\n\narray = string.split('')\narray.select.with_index do |value, index|\narray[index - 1] != value &amp;&amp; array[index + 1] != value\nend.join\nend\n</code></pre>\n\n<p>Here are a few examples:</p>\n\n<pre><code>puts clean(\"aaaaabccccdeeeeeefgggg\")\n#-&gt; bdf\nputs clean(\"m\")\n#-&gt; m\nputs clean(\"ttyyzx\")\n#-&gt; zx\nputs clean(\"aab\")\n#-&gt; b\n</code></pre>\n\n<p>The method makes use of the fact that the characters are sorted and in case there are duplicates, they are either before or after the character that's being checked by the select method. The method is slower than the solutions posted above, but as OP mentioned he does not yet work with hashes yet I though this might be useful.</p>\n"}], "owner": {"reputation": 13, "user_id": 11981738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d8431db13d033e09c117fcd1992b3f6?s=128&d=identicon&r=PG&f=1", "display_name": "kenyounot", "link": "https://stackoverflow.com/users/11981738/kenyounot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 57669341, "answer_count": 3, "score": 1, "last_activity_date": 1566925312, "creation_date": 1566881014, "last_edit_date": 1566925312, "question_id": 57667782, "link": "https://stackoverflow.com/questions/57667782/given-a-string-how-do-i-compare-the-characters-to-see-if-there-are-duplicates", "title": "Given a string, how do I compare the characters to see if there are duplicates?", "body": "<p>I'm trying to compare characters in a given string to see if there are duplicates, and if there are I was to remove the two characters to reduce the string to as small at possible. eg. <code>(\"ttyyzx\")</code> would equal to <code>(\"zx\")</code></p>\n\n<p>I've tried converting the characters in an array and then using an <code>#each_with_index</code> to iterate over the characters. </p>\n\n<pre><code>arr = (\"xxyz\").split(\"\")\n\n  arr.each_with_index do |idx1, idx2|\n    if idx1[idx2] == idx1[idx2 + 1]\n      p idx1[idx2]\n      p idx1[idx2 + 1]\n    end\n  end\n</code></pre>\n\n<p>At this point I just wan to be able to print the next character in the array within the loop so I know I can move on to the next step, but no matter what code I use it will only print out the first character <code>\"x\"</code>.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "rspec", "mocking", "rspec-rails"], "comments": [{"owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 0, "creation_date": 1566880667, "post_id": 57667537, "comment_id": 101783599, "body": "It is unclear from your question where <code>user</code> was defined. But I guess <code>user</code> is the instance of the user that was created in the database before the test starts. Whereas the code later loads another instance (of the same user) from the database. That means the method in question is indeed not called on that <code>user</code> instance but on another instance of the same record that was loaded in your controller. I guess that method is calling a mailer, why don&#39;t you mock the mailer?"}, {"owner": {"reputation": 1928, "user_id": 3280050, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0f86ec29ab3a8f7f841f471d582a933?s=128&d=identicon&r=PG", "display_name": "truongnm", "link": "https://stackoverflow.com/users/3280050/truongnm"}, "reply_to_user": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 0, "creation_date": 1566892148, "post_id": 57667537, "comment_id": 101787433, "body": "Thanks for your reply. Yes you&#39;re right, instance from rspec and instance from controller are different. I could make it work by using <code>expect_any_instance_of(User)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 1928, "user_id": 3280050, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0f86ec29ab3a8f7f841f471d582a933?s=128&d=identicon&r=PG", "display_name": "truongnm", "link": "https://stackoverflow.com/users/3280050/truongnm"}, "edited": false, "score": 0, "creation_date": 1566888559, "post_id": 57667944, "comment_id": 101785837, "body": "Wow thanks so much for point out the different between these two. I thought they are the same @@"}], "tags": [], "owner": {"reputation": 8462, "user_id": 405865, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e29f04f339715955060858e0e65e1311?s=128&d=identicon&r=PG", "display_name": "fphilipe", "link": "https://stackoverflow.com/users/405865/fphilipe"}, "is_accepted": false, "score": 1, "last_activity_date": 1566882230, "creation_date": 1566882230, "answer_id": 57667944, "question_id": 57667537, "link": "https://stackoverflow.com/questions/57667537/rspec-test-call-method-send-reconfirmation-instruction/57667944#57667944", "title": "Rspec test call method send reconfirmation instruction", "body": "<p>The line where you're checking that the user has received the message should read:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>expect(user).to have_received(:send_reconfirmation_instructions).once\n</code></pre>\n\n<p>instead of:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>expect(user).to receive(:send_reconfirmation_instructions).once\n</code></pre>\n\n<p>The former where you say <code>expect(obj).to have_received(:msg)</code> requires you to assert that the message was called, as you intended to do.</p>\n\n<p>The latter, on the other hand, where you say <code>expect(obj).to receive(:msg)</code> is a way to set up the expectation before the action, i.e. in lieu of the <code>allow(obj).to receive(:msg)</code> without requiring to assert that it was called after the action. After the spec ran, it will automatically assert whether it was called.</p>\n\n<p>This explains the error you're getting when specifying</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>expect(user).to receive(:send_reconfirmation_instructions).once\n</code></pre>\n\n<p>as no code after that line sends that message to <code>user</code>, which gets verified after the spec.</p>\n"}], "owner": {"reputation": 1928, "user_id": 3280050, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0f86ec29ab3a8f7f841f471d582a933?s=128&d=identicon&r=PG", "display_name": "truongnm", "link": "https://stackoverflow.com/users/3280050/truongnm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 204, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1566892361, "creation_date": 1566878624, "last_edit_date": 1566892361, "question_id": 57667537, "link": "https://stackoverflow.com/questions/57667537/rspec-test-call-method-send-reconfirmation-instruction", "title": "Rspec test call method send reconfirmation instruction", "body": "<p>I\u2019m using Rspec to test the case when user change password, mail will be sent. And I want to check that only 1 mail is sent. I don't want use <code>Action::Mailer.deliveries</code> to check, instead I want to check that whether method is called and how much.</p>\n\n<p>On searching I found <code>Test Spy</code> from rspec mock:\n<a href=\"https://github.com/rspec/rspec-mocks#test-spies\" rel=\"nofollow noreferrer\">https://github.com/rspec/rspec-mocks#test-spies</a></p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>describe 'PUT /email' do\n  include_context 'a user has signed in', { email: 'old-email@example.com', password: 'correct_password' }\n\n  context  'correct new email, correct password' do\n    before do\n      allow(user).to receive(:send_reconfirmation_instructions)\n    end\n\n    it do\n      should == 302\n      expect(user.reload.unconfirmed_email).to eq 'new-email@example.com'\n      expect(user).to receive(:send_reconfirmation_instructions).once\n    end\n  end\nend\n</code></pre>\n\n<p>But I got error:</p>\n\n<pre><code>  Failure/Error: expect(user).to receive(:send_reconfirmation_instructions)\n\n   (#&lt;User id: 1269, email: \u201cold-email@example.com\u201d, created_at: \u201c2019-08-27 03:54:33\", updated_at: \u201c2019-08-27 03:54:33\u201d...\u201c&gt;).send_reconfirmation_instructions(*(any args))\n       expected: 1 time with any arguments\n       received: 0 times with any arguments\n</code></pre>\n\n<p><code>send_reconfirmation_instructions</code> this function is from devise: <a href=\"https://github.com/plataformatec/devise/blob/master/lib/devise/models/confirmable.rb#L124-L130\" rel=\"nofollow noreferrer\">https://github.com/plataformatec/devise/blob/master/lib/devise/models/confirmable.rb#L124-L130</a></p>\n\n<p>I did <code>binding.pry</code> and I\u2019m sure that the test jump inside this function but rspec still failed.</p>\n\n<p>Edit:\nI could make it kind of work by writing like this:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>describe 'PUT /email' do\n  include_context 'a user has signed in', { email: 'old-email@example.com', password: 'correct_password' }\n\n  context  'correct new email, correct password' do\n    before do\n      expect_any_instance_of(User).to receive(:send_reconfirmation_instructions).once\n    end\n\n    it do\n      should == 302\n      expect(user.reload.unconfirmed_email).to eq 'new-email@example.com'\n      # expect(user).to receive(:send_reconfirmation_instructions).once\n    end\n  end\nend\n</code></pre>\n\n<p>However I got another error:</p>\n\n<pre><code>Failure/Error: \n(#&lt;User user_id: 1418, email: \u201cold-email@example.com\u201d...\u201c&gt;).send_reconfirmation_instructions(#&lt;User user_id: 1418, email: \u201cold-email@example.com\u201d ...\u201c&gt;)\n                expected: 1 time with any arguments\n                received: 2 times with arguments: (#&lt;User user_id: 1418, email: \u201cold-email@example.com\u201d, id: 1323...\u201c&gt;)\n</code></pre>\n"}, {"tags": ["json", "ruby"], "comments": [{"owner": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "edited": false, "score": 0, "creation_date": 1566871995, "post_id": 57666770, "comment_id": 101782223, "body": "I&#39;m voting to close this question as off-topic because this is not a question."}, {"owner": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "edited": false, "score": 0, "creation_date": 1566873797, "post_id": 57666770, "comment_id": 101782537, "body": "I suggest reading <a href=\"https://stackoverflow.com/help/how-to-ask\">this</a>, <a href=\"https://stackoverflow.com/help/dont-ask\">this</a>, and most importantly <a href=\"https://stackoverflow.com/conduct\">this</a>."}], "answers": [{"comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1566874135, "post_id": 57667067, "comment_id": 101782597, "body": "Check out Dry::Struct. I&#39;m 90% sure sure you can achieve the same effect, but with code that is clean and doesn&#39;t contain unnecessary hardcoded details. The cost is it&#39;s another dependency."}, {"owner": {"reputation": 488, "user_id": 1354646, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/72518208c012174999ffacad9d83631d?s=128&d=identicon&r=PG", "display_name": "Rob Carpenter", "link": "https://stackoverflow.com/users/1354646/rob-carpenter"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1566942476, "post_id": 57667067, "comment_id": 101811700, "body": "Could you elaborate on what isn&#39;t &#39;clean&#39; about the code? The hardcoded details are absolutely necessary, I&#39;m dealing with text and trying to determine what type of object to create based on text. Known keys are the only thing to, well, key off of. I&#39;ll check out dry struct but the thought of adding another dependency makes me cringe."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1566946892, "post_id": 57667067, "comment_id": 101812635, "body": "&quot;The hardcoded details are absolutely necessary&quot; - no, they aren&#39;t, actually. Your collections are homogeneous. Accounts array contains only accounts. And an account has many transactions (again, without any accounts mixed in). If you <i>really want</i> do use the same class to deserialize both types, then you&#39;ll have to do some kind of switching on properties, yes. But why not use separate classes?"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1566947036, "post_id": 57667067, "comment_id": 101812658, "body": "Your data is not of completely arbitrary shape. You <i>know</i> you have a top-level array <code>accounts</code>. Why not leverage the fact/knowledge?"}, {"owner": {"reputation": 488, "user_id": 1354646, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/72518208c012174999ffacad9d83631d?s=128&d=identicon&r=PG", "display_name": "Rob Carpenter", "link": "https://stackoverflow.com/users/1354646/rob-carpenter"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1567088785, "post_id": 57667067, "comment_id": 101866919, "body": "Your suggestion doesn&#39;t account for the way the object_class property works. You can only pass it one class, not multiple."}, {"owner": {"reputation": 488, "user_id": 1354646, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/72518208c012174999ffacad9d83631d?s=128&d=identicon&r=PG", "display_name": "Rob Carpenter", "link": "https://stackoverflow.com/users/1354646/rob-carpenter"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1567089273, "post_id": 57667067, "comment_id": 101867209, "body": "There actually are separate classes being used here if you look more closely. The top level Collection class is responsible for creating instances of the Account and Transaction class."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1567092624, "post_id": 57667067, "comment_id": 101869079, "body": "My suggestion does not involve <code>object_class</code> at all."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1567097052, "post_id": 57667067, "comment_id": 101871127, "body": "&quot;There actually are separate classes&quot; - nominally there are, but they aren&#39;t doing anything for you. All of the logic is still contained within the Collection. It knows how to tell transaction and account apart, for example. And none of your classes give any info about what the <i>actual</i> content of transaction/account could look like. So I&#39;m not sure why you&#39;d prefer this to OpenStruct. I see only drawbacks."}, {"owner": {"reputation": 488, "user_id": 1354646, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/72518208c012174999ffacad9d83631d?s=128&d=identicon&r=PG", "display_name": "Rob Carpenter", "link": "https://stackoverflow.com/users/1354646/rob-carpenter"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1567189081, "post_id": 57667067, "comment_id": 101903193, "body": "They are doing something for me, I didn&#39;t post the entire class written for production here, just a sample. The classes have helper functions that aren&#39;t shown here. They are demonstrated by the helper functions on the Collection so I didn&#39;t think it was necessary to post all the code. OpenStruct wouldn&#39;t give me that. I tried to determine if dry-struct would but their docs are not very friendly. I think you only see drawbacks because you&#39;re limiting your sight to my small example and don&#39;t see the full use case clearly."}, {"owner": {"reputation": 488, "user_id": 1354646, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/72518208c012174999ffacad9d83631d?s=128&d=identicon&r=PG", "display_name": "Rob Carpenter", "link": "https://stackoverflow.com/users/1354646/rob-carpenter"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1567189919, "post_id": 57667067, "comment_id": 101903463, "body": "I&#39;m struggling with your suggestion because you&#39;re tossing out a poorly documented library and telling me you&#39;re only 90% sure it can do what I want. I&#39;m less sure after reading their docs. I&#39;m not above being proven wrong though, but write some code if you want me to take your suggestion seriously. As for now I&#39;m 100% my solution works and I&#39;m happy with it."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1567190664, "post_id": 57667067, "comment_id": 101903669, "body": "I agree, dry-rb docs have room for improvement. I&#39;ll try to throw something together later today, but no promises :)"}], "tags": [], "owner": {"reputation": 488, "user_id": 1354646, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/72518208c012174999ffacad9d83631d?s=128&d=identicon&r=PG", "display_name": "Rob Carpenter", "link": "https://stackoverflow.com/users/1354646/rob-carpenter"}, "is_accepted": true, "score": 0, "last_activity_date": 1566873760, "creation_date": 1566873760, "answer_id": 57667067, "question_id": 57666770, "link": "https://stackoverflow.com/questions/57666770/deserializing-json-to-a-custom-object-not-using-openstruct-in-ruby/57667067#57667067", "title": "Deserializing JSON to a custom object NOT USING OpenStruct in Ruby", "body": "<p>I scoured SO looking for an answer and everyone used OpenStruct if anything to achieve deserialization into an object. However the JSON.parse function has an <code>object_class</code> property that I was determined could do what I wanted, and in the end... I was right. Using this syntax:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>tc = JSON.parse(data.to_json, object_class: TransactionDetail::Collection, create_additions: true)\n</code></pre>\n\n<p>you can turn a data object (test data from an actual Wells Fargo API response):</p>\n\n<pre><code>data = {\n  \"accounts\": [\n    {\n      \"bank_id\": \"091000019\",\n      \"account_number\": \"23784275367\",\n      \"account_type\": \"DEMAND_DEPOSIT\",\n      \"account_name\": \"QUALITY LIFE MUSSMAN CO\",\n      \"currency_code\": \"USD\",\n      \"transaction_count\": 5,\n      \"transactions\": [\n        {\n          \"posting_date\": \"2019-06-04\",\n          \"value_date\": \"2019-06-04\",\n          \"transaction_datetime\": \"2019-06-04 03:12:00Z\",\n          \"debit_credit_indicator\": \"DEBIT\",\n          \"transaction_type\": \"CHECK\",\n          \"bai_type_code\": \"045\",\n          \"transaction_description\": \"BANK ORIGINATED DEBIT FR 0000007186 THE SHERWIN-WILLIAMS COMPANY SUB ACCT 000004944938950\",\n          \"transaction_amount\": 224.43,\n          \"zero_day_float\": 0,\n          \"one_day_float\": 0,\n          \"two_date_float\": 0,\n          \"check_number\": \"0000\",\n          \"bank_reference\": \"082300000022\",\n          \"transaction_status\": \"POSTED\"\n        },\n        {\n          \"posting_date\": \"2019-06-04\",\n          \"value_date\": \"2019-06-04\",\n          \"transaction_datetime\": \"2019-06-04 02:12:00Z\",\n          \"debit_credit_indicator\": \"DEBIT\",\n          \"transaction_type\": \"CHECK\",\n          \"bai_type_code\": \"045\",\n          \"transaction_description\": \"BANK ORIGINATED DEBIT FR 0000007186 THE SHERWIN-WILLIAMS COMPANY SUB ACCT 000004944938950\",\n          \"transaction_amount\": 224.43,\n          \"zero_day_float\": 0,\n          \"one_day_float\": 0,\n          \"two_date_float\": 0,\n          \"check_number\": \"0000\",\n          \"bank_reference\": \"082300000022\",\n          \"transaction_status\": \"POSTED\"\n        },\n        {\n          \"posting_date\": \"2019-06-04\",\n          \"value_date\": \"2019-06-04\",\n          \"transaction_datetime\": \"2019-06-04 01:12:00Z\",\n          \"debit_credit_indicator\": \"DEBIT\",\n          \"transaction_type\": \"CHECK\",\n          \"bai_type_code\": \"045\",\n          \"transaction_description\": \"BANK ORIGINATED DEBIT FR 0000007186 THE SHERWIN-WILLIAMS COMPANY SUB ACCT 000004944938950\",\n          \"transaction_amount\": 224.43,\n          \"zero_day_float\": 0,\n          \"one_day_float\": 0,\n          \"two_date_float\": 0,\n          \"check_number\": \"0000\",\n          \"bank_reference\": \"082300000022\",\n          \"transaction_status\": \"POSTED\"\n        },\n        {\n          \"posting_date\": \"2019-06-03\",\n          \"value_date\": \"2019-06-03\",\n          \"transaction_datetime\": \"2019-06-03 16:18:20Z\",\n          \"debit_credit_indicator\": \"DEBIT\",\n          \"transaction_type\": \"CHECK\",\n          \"bai_type_code\": \"045\",\n          \"transaction_description\": \"BANK ORIGINATED DEBIT FR 0000007186 THE SHERWIN-WILLIAMS COMPANY SUB ACCT 000004944938950\",\n          \"transaction_amount\": 224.43,\n          \"zero_day_float\": 0,\n          \"one_day_float\": 0,\n          \"two_date_float\": 0,\n          \"check_number\": \"0000\",\n          \"bank_reference\": \"082300000022\",\n          \"transaction_status\": \"POSTED\"\n        },\n        {\n          \"posting_date\": \"2019-06-02\",\n          \"value_date\": \"2019-06-02\",\n          \"transaction_datetime\": \"2019-06-02 16:18:20Z\",\n          \"debit_credit_indicator\": \"DEBIT\",\n          \"transaction_type\": \"CHECK\",\n          \"bai_type_code\": \"045\",\n          \"transaction_description\": \"BANK ORIGINATED DEBIT FR 0000007186 THE SHERWIN-WILLIAMS COMPANY SUB ACCT 000004944938950\",\n          \"transaction_amount\": 244.55,\n          \"zero_day_float\": 0,\n          \"one_day_float\": 0,\n          \"two_date_float\": 0,\n          \"check_number\": \"0000\",\n          \"bank_reference\": \"082300000022\",\n          \"transaction_status\": \"POSTED\"\n        }\n      ]\n    }\n  ]\n}\n</code></pre>\n\n<p>into the following custom object, with nested custom objects.</p>\n\n<pre><code>&gt; tc\n#&lt;TransactionDetail::Collection:0x00007fa690053708 @data={\n\"json_class\"=&gt;\"TransactionDetail::Collection\", \n:accounts=&gt;{23784275367=&gt;\n#&lt;TransactionDetail::Account:0x00007fa690053f50 \n@json_class=\"TransactionDetail::Collection\", \n@bank_id=\"091000019\", @account_number=\"23784275367\", \n@account_type=\"DEMAND_DEPOSIT\", @account_name=\"QUALITY LIFE MUSSMAN CO\", \n@currency_code=\"USD\", @transaction_count=10, @transactions=[\n#&lt;TransactionDetail::Transaction:0x00007fa69004b918 \n@json_class=\"TransactionDetail::Collection\", @posting_date=\"2019-06-04\", \n@value_date=\"2019-06-04\", @transaction_datetime=\"2019-06-04 03:12:00Z\", \n@debit_credit_indicator=\"DEBIT\", @transaction_type=\"CHECK\", \n@bai_type_code=\"045\", @transaction_description=\"BANK ORIGINATED DEBIT FR 0000007186 THE SHERWIN-WILLIAMS COMPANY SUB ACCT 000004944938950\", \n@transaction_amount=224.43, @zero_day_float=0, @one_day_float=0, \n@two_date_float=0, @check_number=\"0000\", \n@bank_reference=\"082300000022\", @transaction_status=\"POSTED\"&gt;, \n#&lt;TransactionDetail::Transaction:0x00007fa690049ca8 \n@json_class=\"TransactionDetail::Collection\", @posting_date=\"2019-06-04\", \n@value_date=\"2019-06-04\", @transaction_datetime=\"2019-06-04 02:12:00Z\", \n@debit_credit_indicator=\"DEBIT\", @transaction_type=\"CHECK\", \n@bai_type_code=\"045\", @transaction_description=\"BANK ORIGINATED DEBIT FR 0000007186 THE SHERWIN-WILLIAMS COMPANY SUB ACCT 000004944938950\", \n@transaction_amount=224.43, @zero_day_float=0, @one_day_float=0, \n@two_date_float=0, @check_number=\"0000\", \n@bank_reference=\"082300000022\", @transaction_status=\"POSTED\"&gt;, \n#&lt;TransactionDetail::Transaction:0x00007fa69004f298 \n@json_class=\"TransactionDetail::Collection\", @posting_date=\"2019-06-04\", \n@value_date=\"2019-06-04\", @transaction_datetime=\"2019-06-04 01:12:00Z\", \n@debit_credit_indicator=\"DEBIT\", @transaction_type=\"CHECK\", \n@bai_type_code=\"045\", @transaction_description=\"BANK ORIGINATED DEBIT FR 0000007186 THE SHERWIN-WILLIAMS COMPANY SUB ACCT 000004944938950\", \n@transaction_amount=224.43, @zero_day_float=0, @one_day_float=0, \n@two_date_float=0, @check_number=\"0000\", \n@bank_reference=\"082300000022\", @transaction_status=\"POSTED\"&gt;, \n#&lt;TransactionDetail::Transaction:0x00007fa69004e028 \n@json_class=\"TransactionDetail::Collection\", @posting_date=\"2019-06-03\", \n@value_date=\"2019-06-03\", @transaction_datetime=\"2019-06-03 16:18:20Z\", \n@debit_credit_indicator=\"DEBIT\", @transaction_type=\"CHECK\", \n@bai_type_code=\"045\", @transaction_description=\"BANK ORIGINATED DEBIT FR 0000007186 THE SHERWIN-WILLIAMS COMPANY SUB ACCT 000004944938950\", @transaction_amount=224.43, \n@zero_day_float=0, @one_day_float=0, @two_date_float=0, \n@check_number=\"0000\", @bank_reference=\"082300000022\", \n@transaction_status=\"POSTED\"&gt;, \n#&lt;TransactionDetail::Transaction:0x00007fa69004cde0 \n@json_class=\"TransactionDetail::Collection\", @posting_date=\"2019-06-02\", \n@value_date=\"2019-06-02\", @transaction_datetime=\"2019-06-02 16:18:20Z\", \n@debit_credit_indicator=\"DEBIT\", @transaction_type=\"CHECK\", \n@bai_type_code=\"045\", @transaction_description=\"BANK ORIGINATED DEBIT FR 0000007186 THE SHERWIN-WILLIAMS COMPANY SUB ACCT 000004944938950\", \n@transaction_amount=244.55, @zero_day_float=0, @one_day_float=0, \n@two_date_float=0, @check_number=\"0000\", \n@bank_reference=\"082300000022\", @transaction_status=\"POSTED\"&gt;]&gt;}, :account_array=&gt;[23784275367]}&gt;\n</code></pre>\n\n<p>Here is how I went about deserializing. Below is my <code>object_class</code> that I pass to the parser.</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>require 'json'\nrequire 'active_support/core_ext/object/try'\nrequire 'forwardable'\n\nmodule TransactionDetail\n\n  def initialize_instance_variables(o)\n    o.data.each do |key, value|\n      instance_variable_set(\"@#{key}\", value)\n      self.class.send(:attr_reader, key)\n    end\n  end\n\n  class Collection\n    extend Forwardable\n\n    def_delegators :@data, :account, :list_accounts, :transactions\n    attr_accessor :data\n\n    def initialize(o = nil)\n      @data = {\n        JSON.create_id =&gt; self.class.name\n      }\n      if o != nil &amp;&amp; o.kind_of?(TransactionDetail::Collection)\n        @data[:accounts] = {}\n        @data[:account_array] = []\n        o.data['accounts'].each do |a|\n          @data[:account_array] &lt;&lt; a.account_number.to_i\n          @data[:accounts][a.account_number.to_i] = a\n        end\n      end\n    end\n\n    def json_creatable?\n      true\n    end\n\n    def [](index)\n     @data[index]\n    end\n\n    def []=(index, new_value)\n      @data[index] = new_value\n    end\n\n    def self.json_create(o)\n      if o.data.key? 'bank_id'\n        return TransactionDetail::Account.new(o)\n      end\n      if o.data.key? 'transaction_amount'\n        return TransactionDetail::Transaction.new(o)\n      end\n      new(o)\n    end\n\n    def list_accounts\n      @data[:account_array]\n    end\n\n    def account(account_number)\n      @data[:accounts][account_number]\n    end\n\n    def transactions(account_number)\n      @data[:accounts][account_number].transactions\n    end\n  end\n\n  class Account\n    include TransactionDetail\n    def initialize(o)\n      initialize_instance_variables(o)\n    end\n  end\n\n  class Transaction\n    include TransactionDetail\n    def initialize(o)\n      initialize_instance_variables(o)\n    end\n  end\nend\n</code></pre>\n\n<p>The <code>object_class</code> property is pretty poorly documented, but works well. The source code for the pure ruby version of the JSON parser was what led to the breakthrough in how to use this property. </p>\n\n<p>The trick is understanding that the <code>object_class</code> merely tells the parser what to do when it \"runs into\" an object while parsing your JSON structure. Otherwise it will happily parse strings and bools and types that it knows how to handle. If you have a specific object in mind that you want to return you have to tell the parser what to do in the <code>json_create</code> function. If you set all the required properties: </p>\n\n<p>1) object_class must be initialized with a hash that holds <code>JSON.create_id =&gt; self.class.name</code> (its the first thing the parser looks for and then instantiates an empty instance of this class to begin building on) This is shown in my Collection class's initialize method.</p>\n\n<p>2) Must pass both the <code>object_class</code> and <code>create_additions: true</code> the the <code>JSON.parse</code> method.</p>\n\n<p>3) Not 100% sure on this one but I believe you need <code>json_creatable?</code> to return true in your <code>object_class</code></p>\n\n<p>With all this set when the parser sees an object in the JSON structure it hands off the parsing job to your <code>json_create</code> function and walks the nested structure. </p>\n\n<p>In my <code>json_create</code> method I pick out certain keys that I know will be in the JSON response and if I detect those I build the appropriate object and return it to the parser. The parser know where that object is in the nested structure and neatly places it there. The final step is to return the <code>object_class</code> itself, accomplished by the <code>new(o)</code> line. You can do some final reorganizing in your <code>object_class</code> initialize method as I've done, for example I gave all the accounts a Hash lookup by account number and added an array that has only account numbers.</p>\n"}], "owner": {"reputation": 488, "user_id": 1354646, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/72518208c012174999ffacad9d83631d?s=128&d=identicon&r=PG", "display_name": "Rob Carpenter", "link": "https://stackoverflow.com/users/1354646/rob-carpenter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 287, "favorite_count": 0, "accepted_answer_id": 57667067, "answer_count": 1, "score": -1, "last_activity_date": 1566873760, "creation_date": 1566870568, "last_edit_date": 1566873714, "question_id": 57666770, "link": "https://stackoverflow.com/questions/57666770/deserializing-json-to-a-custom-object-not-using-openstruct-in-ruby", "title": "Deserializing JSON to a custom object NOT USING OpenStruct in Ruby", "body": "<p>How can I deserialize an JSON object that looks like this (test data from a real Wells Fargo API response):</p>\n\n<pre><code>data = {\n  \"accounts\": [\n    {\n      \"bank_id\": \"091000019\",\n      \"account_number\": \"23784275367\",\n      \"account_type\": \"DEMAND_DEPOSIT\",\n      \"account_name\": \"QUALITY LIFE MUSSMAN CO\",\n      \"currency_code\": \"USD\",\n      \"transaction_count\": 5,\n      \"transactions\": [\n        {\n          \"posting_date\": \"2019-06-04\",\n          \"value_date\": \"2019-06-04\",\n          \"transaction_datetime\": \"2019-06-04 03:12:00Z\",\n          \"debit_credit_indicator\": \"DEBIT\",\n          \"transaction_type\": \"CHECK\",\n          \"bai_type_code\": \"045\",\n          \"transaction_description\": \"BANK ORIGINATED DEBIT FR 0000007186 THE SHERWIN-WILLIAMS COMPANY SUB ACCT 000004944938950\",\n          \"transaction_amount\": 224.43,\n          \"zero_day_float\": 0,\n          \"one_day_float\": 0,\n          \"two_date_float\": 0,\n          \"check_number\": \"0000\",\n          \"bank_reference\": \"082300000022\",\n          \"transaction_status\": \"POSTED\"\n        },\n        {\n          \"posting_date\": \"2019-06-04\",\n          \"value_date\": \"2019-06-04\",\n          \"transaction_datetime\": \"2019-06-04 02:12:00Z\",\n          \"debit_credit_indicator\": \"DEBIT\",\n          \"transaction_type\": \"CHECK\",\n          \"bai_type_code\": \"045\",\n          \"transaction_description\": \"BANK ORIGINATED DEBIT FR 0000007186 THE SHERWIN-WILLIAMS COMPANY SUB ACCT 000004944938950\",\n          \"transaction_amount\": 224.43,\n          \"zero_day_float\": 0,\n          \"one_day_float\": 0,\n          \"two_date_float\": 0,\n          \"check_number\": \"0000\",\n          \"bank_reference\": \"082300000022\",\n          \"transaction_status\": \"POSTED\"\n        },\n        {\n          \"posting_date\": \"2019-06-04\",\n          \"value_date\": \"2019-06-04\",\n          \"transaction_datetime\": \"2019-06-04 01:12:00Z\",\n          \"debit_credit_indicator\": \"DEBIT\",\n          \"transaction_type\": \"CHECK\",\n          \"bai_type_code\": \"045\",\n          \"transaction_description\": \"BANK ORIGINATED DEBIT FR 0000007186 THE SHERWIN-WILLIAMS COMPANY SUB ACCT 000004944938950\",\n          \"transaction_amount\": 224.43,\n          \"zero_day_float\": 0,\n          \"one_day_float\": 0,\n          \"two_date_float\": 0,\n          \"check_number\": \"0000\",\n          \"bank_reference\": \"082300000022\",\n          \"transaction_status\": \"POSTED\"\n        },\n        {\n          \"posting_date\": \"2019-06-03\",\n          \"value_date\": \"2019-06-03\",\n          \"transaction_datetime\": \"2019-06-03 16:18:20Z\",\n          \"debit_credit_indicator\": \"DEBIT\",\n          \"transaction_type\": \"CHECK\",\n          \"bai_type_code\": \"045\",\n          \"transaction_description\": \"BANK ORIGINATED DEBIT FR 0000007186 THE SHERWIN-WILLIAMS COMPANY SUB ACCT 000004944938950\",\n          \"transaction_amount\": 224.43,\n          \"zero_day_float\": 0,\n          \"one_day_float\": 0,\n          \"two_date_float\": 0,\n          \"check_number\": \"0000\",\n          \"bank_reference\": \"082300000022\",\n          \"transaction_status\": \"POSTED\"\n        },\n        {\n          \"posting_date\": \"2019-06-02\",\n          \"value_date\": \"2019-06-02\",\n          \"transaction_datetime\": \"2019-06-02 16:18:20Z\",\n          \"debit_credit_indicator\": \"DEBIT\",\n          \"transaction_type\": \"CHECK\",\n          \"bai_type_code\": \"045\",\n          \"transaction_description\": \"BANK ORIGINATED DEBIT FR 0000007186 THE SHERWIN-WILLIAMS COMPANY SUB ACCT 000004944938950\",\n          \"transaction_amount\": 244.55,\n          \"zero_day_float\": 0,\n          \"one_day_float\": 0,\n          \"two_date_float\": 0,\n          \"check_number\": \"0000\",\n          \"bank_reference\": \"082300000022\",\n          \"transaction_status\": \"POSTED\"\n        }\n      ]\n    }\n  ]\n}\n</code></pre>\n\n<p>into a CUSTOM ruby object with other custom nested objects (Accounts, and Transactions)? I've seen a lot of people using OpenStruct but I don't want to use OpenStruct. I want to build the object myself and pass it using <code>object_class</code> to the JSON parser.</p>\n\n<p>This SO post started me down a path:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/36983364/ruby-how-can-i-save-an-instance-of-a-class-with-json\">Ruby how can I save an instance of a class with JSON?</a></p>\n\n<p>But I don't want to have to create the object first then convert it to JSON just to parse it. I want to go from JSON straight to custom object. Has anyone figured out how to do this without using OpenStruct?</p>\n"}, {"tags": ["ruby", "return", "implicit"], "comments": [{"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 1, "creation_date": 1566883036, "post_id": 57666765, "comment_id": 101784141, "body": "&quot;I thought that when using Ruby, the <b>last line</b> of an expression is implicitly returned&quot; \u2013 Hint #1: what is the last line of the method? &quot;The if-statement on <b>line 5</b>&quot; \u2013 Hint #2: is line 5 the last line?"}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 1, "creation_date": 1566887388, "post_id": 57666765, "comment_id": 101785401, "body": "In Ruby, you rarely have to traverse an array using indices, explicit counter variables and low-level loops. There&#39;s almost always a more succinct way given Ruby&#39;s rich <a href=\"https://ruby-doc.org/core-2.6.3/Enumerable.html\" rel=\"nofollow noreferrer\"><code>Enumerable</code></a> module. For example, your above code could be rewritten as: <code>ings.find { |ing| cheese_types.include?(ing) }</code> \u2013 and it works without an explicit <code>return</code>."}], "answers": [{"comments": [{"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 1, "creation_date": 1566886272, "post_id": 57666816, "comment_id": 101785021, "body": "<i>&quot;the last line&quot;</i> can be quite misleading. Better think of <i>&quot;the last expression evaluated&quot;</i>."}], "tags": [], "owner": {"reputation": 2397, "user_id": 9038475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b7f74f49de917e716f4d679473e70f4?s=128&d=identicon&r=PG&f=1", "display_name": "Geshode", "link": "https://stackoverflow.com/users/9038475/geshode"}, "is_accepted": false, "score": 3, "last_activity_date": 1566896404, "last_edit_date": 1566896404, "creation_date": 1566871045, "answer_id": 57666816, "question_id": 57666765, "link": "https://stackoverflow.com/questions/57666765/why-is-this-value-not-being-implicitly-returned-in-ruby/57666816#57666816", "title": "Why is this value not being implicitly returned in Ruby?", "body": "<p>In your function, you have <code>nil</code> as the last line, so unless you leave the function before this point by using <code>return</code>, you will always end at <code>nil</code> and thus always return <code>nil</code>, since Ruby implicitly returns the last expression evaluated, as you said yourself.</p>\n\n<p>In short, you have to use <code>return</code>, because line 5 is not the last line of the function, and without it, it will run all the way through to <code>nil</code>. And thus will return it.</p>\n"}], "owner": {"reputation": 37, "user_id": 11140764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b5432a55031ff9995eaa0e8fcf0f7ef?s=128&d=identicon&r=PG&f=1", "display_name": "DevKLiD", "link": "https://stackoverflow.com/users/11140764/devklid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566896404, "creation_date": 1566870467, "question_id": 57666765, "link": "https://stackoverflow.com/questions/57666765/why-is-this-value-not-being-implicitly-returned-in-ruby", "title": "Why is this value not being implicitly returned in Ruby?", "body": "<p>I thought that when using Ruby, the last line of an expression is implicitly returned without having to use the 'return' keyword.  However, in my code below, the correct value is only returned if I use the return keyword.</p>\n\n<pre><code>def find_the_cheese(ings)\n  cheese_types = [\"cheddar\", \"gouda\", \"camembert\"]\n  i = 0\n  while i &lt; ings.length do\n    if cheese_types.include?(ings[i])\n      ings[i]  #=&gt; only works if 'return' keyword is in front of it\n    end\n    i += 1\n  end\n  nil\nend\n\nfind_the_cheese([\"water\", \"gouda\", \"crackers\"])\n</code></pre>\n\n<p>The if-statement on line 5 is supposed to evaluate to true, and therefore it should return the value of ings[i], which is \"gouda\".  However, if I don't write \"return\" in front of the value, the whole thing evaluates to nil.  But if I write \"return\" then it gives the correct answer.\nThere have been other times when using ruby that I have left out the return keyword and it returned the value I expected, so how come sometimes it works and other times it doesn't?</p>\n"}, {"tags": ["ruby", "tcp"], "comments": [{"owner": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "edited": false, "score": 0, "creation_date": 1566921539, "post_id": 57666592, "comment_id": 101803729, "body": "Without knowing what library you&#39;re using it&#39;s impossible to say."}], "owner": {"reputation": 11, "user_id": 11981181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/234032de3189de7cddc613aaddc0ed34?s=128&d=identicon&r=PG&f=1", "display_name": "StephenPierce", "link": "https://stackoverflow.com/users/11981181/stephenpierce"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 29, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1566868643, "creation_date": 1566868643, "question_id": 57666592, "link": "https://stackoverflow.com/questions/57666592/how-can-i-set-socket-options-on-a-nethttp-object", "title": "How can I set socket options on a Net::HTTP object?", "body": "<p>I want to turn on TCP keepalives on an HTTP session.</p>\n\n<p>I'm running ruby 2.6.3 on Linux, and http-3.3.0 gem is installed.</p>\n\n<p>I can set the socket options on a socket object like this:</p>\n\n<pre><code>s = TCPSocket.new('127.0.0.1', 80)\ns.setsockopt(Socket::SOL_SOCKET, Socket::SO_KEEPALIVE, true)\ns.setsockopt(Socket::SOL_TCP, Socket::TCP_KEEPIDLE, 5)\ns.setsockopt(Socket::SOL_TCP, Socket::TCP_KEEPINTVL, 20)\ns.setsockopt(Socket::SOL_TCP, Socket::TCP_KEEPCNT, 5)\n</code></pre>\n\n<p>However, I am using a library that uses HTTP like this:</p>\n\n<pre><code>client = HTTP::Client.new(follow: follow_option)\n</code></pre>\n\n<p>And I get back the <code>client</code> object. So, I'd like to be able to set the socket option using the <code>client</code> variable. I figure I need to get the underlying <code>socket</code> object from <code>client</code>, but I do not know how.</p>\n"}, {"tags": ["regex", "ruby"], "comments": [{"owner": {"reputation": 481662, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1566857153, "post_id": 57665485, "comment_id": 101779674, "body": "<code>finding_doc.to_s[&#47;#{finding_start}(.*?)#{finding_stop}&#47;m, 1]</code>"}, {"owner": {"reputation": 3425, "user_id": 1493116, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/9371f372f90b7c283579b097c67b9cd2?s=128&d=identicon&r=PG", "display_name": "LewlSauce", "link": "https://stackoverflow.com/users/1493116/lewlsauce"}, "reply_to_user": {"reputation": 481662, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1566858703, "post_id": 57665485, "comment_id": 101780030, "body": "Getting the same <code>nil</code> response, @WiktorStribi\u017cew. Doesn&#39;t make sense to me because <code>finding_start</code> occurs before <code>finding_stop</code> so I have no idea why that&#39;s happening."}], "owner": {"reputation": 3425, "user_id": 1493116, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/9371f372f90b7c283579b097c67b9cd2?s=128&d=identicon&r=PG", "display_name": "LewlSauce", "link": "https://stackoverflow.com/users/1493116/lewlsauce"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 24, "favorite_count": 0, "closed_date": 1566857178, "answer_count": 0, "score": 1, "last_activity_date": 1566859292, "creation_date": 1566857085, "last_edit_date": 1566859292, "question_id": 57665485, "link": "https://stackoverflow.com/questions/57665485/using-regex-to-find-data-in-between-certain-data", "closed_reason": "Duplicate", "title": "Using regex to find data in between certain data", "body": "<p>I am having an extremely difficult time trying to understand why my regex is failing me at the moment. In ruby, I have a string that includes both a start and stop point, but yet I cannot grab the data in between them using regex.</p>\n\n<pre><code>finding_doc.to_s.include? finding_start\n#\u00a0=&gt; true\nfinding_doc.to_s.include? finding_stop\n# =&gt; true\nfinding_doc.to_s[/(#{finding_start})(.*?)(#{finding_stop})/m]\n#\u00a0=&gt; nil\n</code></pre>\n\n<p>Is there any additional arguments to regex that I can provide for it to actually work? I've always seen this work for me up until now. If it has <em>both</em> the starting and ending points, shouldn't it be able to grab everything in between them?</p>\n\n<p>It should be noted that <code>finding_start</code> appears before <code>finding_stop</code> in the <code>finding_doc</code> variable, as shown below:</p>\n\n<pre><code>[11] pry(#&lt;RailsAppTest&gt;)&gt; finding_doc.to_s.index(finding_start)\n=&gt; 81252\n[12] pry(#&lt;RailsAppTest&gt;)&gt; finding_doc.to_s.index(finding_stop)\n=&gt; 192451\n\n</code></pre>\n\n<p>I should also note that the contents within <code>finding_start</code> and <code>finding_stop</code> contains a bunch of XML, so I'm not sure if any of this would have to do with anything.</p>\n\n<p><strong>Solution Attempt #1</strong> </p>\n\n<pre><code>[9] pry(#&lt;RailsAppTest&gt;)&gt; finding_doc.to_s[/#{finding_start}(.*?)#{finding_stop}/m, 1]\n=&gt; nil\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "postgresql", "activerecord", "postgresql-9.5"], "comments": [{"owner": {"reputation": 13378, "user_id": 1430810, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v669u.jpg?s=128&g=1", "display_name": "arieljuod", "link": "https://stackoverflow.com/users/1430810/arieljuod"}, "edited": false, "score": 1, "creation_date": 1566873514, "post_id": 57664877, "comment_id": 101782487, "body": "Does it crash always at the same record? are you sure all records are valid to be imported?"}, {"owner": {"reputation": 3807, "user_id": 2043592, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/zCbuL.jpg?s=128&g=1", "display_name": "xploshioOn", "link": "https://stackoverflow.com/users/2043592/xploshioon"}, "edited": false, "score": 0, "creation_date": 1566875205, "post_id": 57664877, "comment_id": 101782758, "body": "have you tried with simple creation instead of import? something like <code>users.each_slice(500) {|batch| User.create(batch)}</code>"}], "owner": {"reputation": 143, "user_id": 2351980, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/HLah7.jpg?s=128&g=1", "display_name": "O\u011fuz &#199;i&#231;ek", "link": "https://stackoverflow.com/users/2351980/o%c4%9fuz-%c3%87i%c3%a7ek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1566853200, "creation_date": 1566853200, "question_id": 57664877, "link": "https://stackoverflow.com/questions/57664877/getting-postgresql-error-when-importing-data", "title": "Getting postgresql error when importing data", "body": "<p>I am using <code>Ruby on Rails 5.1.7</code> and <code>Postgresql 9.5</code> on my <code>ubuntu</code> server.\nI am importing a <code>hash</code> (with 10k records) to the database via <code>rails-import</code> gem. But the system shuts down the process just before the end of the process. When I check the database, I see that it saves the data until it shuts down the process.</p>\n\n<p>My code :</p>\n\n<pre><code>// users is a hash  \nUser.import users, batch_size: 500\n</code></pre>\n\n<p>The error i get : </p>\n\n<pre><code>WARN: /home/rails/.rvm/gems/ruby-2.6.3/gems/activerecord-5.1.7/lib/active_record/connection_adapters/postgresql_adapter.rb:624:in `async_exec'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activerecord-5.1.7/lib/active_record/connection_adapters/postgresql_adapter.rb:624:in `block (2 levels) in exec_no_cache'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activesupport-5.1.7/lib/active_support/dependencies/interlock.rb:46:in `block in permit_concurrent_loads'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activesupport-5.1.7/lib/active_support/concurrency/share_lock.rb:185:in `yield_shares'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activesupport-5.1.7/lib/active_support/dependencies/interlock.rb:45:in `permit_concurrent_loads'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activerecord-5.1.7/lib/active_record/connection_adapters/postgresql_adapter.rb:623:in `block in exec_no_cache'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activerecord-5.1.7/lib/active_record/connection_adapters/abstract_adapter.rb:613:in `block (2 levels) in log'\n/home/rails/.rvm/rubies/ruby-2.6.3/lib/ruby/2.6.0/monitor.rb:230:in `mon_synchronize'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activerecord-5.1.7/lib/active_record/connection_adapters/abstract_adapter.rb:612:in `block in log'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activesupport-5.1.7/lib/active_support/notifications/instrumenter.rb:21:in `instrument'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activerecord-5.1.7/lib/active_record/connection_adapters/abstract_adapter.rb:604:in `log'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activerecord-5.1.7/lib/active_record/connection_adapters/postgresql_adapter.rb:622:in `exec_no_cache'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activerecord-5.1.7/lib/active_record/connection_adapters/postgresql_adapter.rb:609:in `execute_and_clear'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activerecord-5.1.7/lib/active_record/connection_adapters/postgresql/database_statements.rb:79:in `exec_query'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activerecord-5.1.7/lib/active_record/connection_adapters/abstract/database_statements.rb:371:in `select'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activerecord-5.1.7/lib/active_record/connection_adapters/abstract/database_statements.rb:42:in `select_all'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activerecord-5.1.7/lib/active_record/connection_adapters/abstract/query_cache.rb:95:in `block in select_all'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activerecord-5.1.7/lib/active_record/connection_adapters/abstract/query_cache.rb:118:in `block in cache_sql'\n/home/rails/.rvm/rubies/ruby-2.6.3/lib/ruby/2.6.0/monitor.rb:230:in `mon_synchronize'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activerecord-5.1.7/lib/active_record/connection_adapters/abstract/query_cache.rb:104:in `cache_sql'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activerecord-5.1.7/lib/active_record/connection_adapters/abstract/query_cache.rb:95:in `select_all'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activerecord-5.1.7/lib/active_record/connection_adapters/abstract/database_statements.rb:66:in `select_rows'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activerecord-5.1.7/lib/active_record/connection_adapters/abstract/database_statements.rb:60:in `select_values'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activerecord-import-1.0.2/lib/activerecord-import/adapters/postgresql_adapter.rb:29:in `insert_many'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activerecord-import-1.0.2/lib/activerecord-import/import.rb:807:in `block in import_without_validations_or_callbacks'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activerecord-import-1.0.2/lib/activerecord-import/import.rb:805:in `each'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activerecord-import-1.0.2/lib/activerecord-import/import.rb:805:in `each_slice'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activerecord-import-1.0.2/lib/activerecord-import/import.rb:805:in `import_without_validations_or_callbacks'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activerecord-import-1.0.2/lib/activerecord-import/import.rb:753:in `import_with_validations'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activerecord-import-1.0.2/lib/activerecord-import/import.rb:695:in `import_helper'\n/home/rails/.rvm/gems/ruby-2.6.3/gems/activerecord-import-1.0.2/lib/activerecord-import/import.rb:531:in `bulk_import'\n</code></pre>\n\n<p>How can I solve this issue? Thoughts?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "unit-testing", "testing", "rspec"], "comments": [{"owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 0, "creation_date": 1566850288, "post_id": 57664277, "comment_id": 101777512, "body": "What library do you use to make the request? Please share the code that actually makes the HTTP request and the method that you want to test."}, {"owner": {"reputation": 11, "user_id": 11980468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0c6d0c9136d4668b630698933897510?s=128&d=identicon&r=PG&f=1", "display_name": "john", "link": "https://stackoverflow.com/users/11980468/john"}, "reply_to_user": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 0, "creation_date": 1566851020, "post_id": 57664277, "comment_id": 101777772, "body": "<a href=\"https://github.com/gimite/google-drive-ruby\" rel=\"nofollow noreferrer\">github.com/gimite/google-drive-ruby</a>  Would stubbing out the MyObject.new method to return nil be sufficient since the internal methods of MyObject don&#39;t actually have anything to do with the google sheet? What would this look like?"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 11980468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0c6d0c9136d4668b630698933897510?s=128&d=identicon&r=PG&f=1", "display_name": "john", "link": "https://stackoverflow.com/users/11980468/john"}, "edited": false, "score": 0, "creation_date": 1566860439, "post_id": 57664720, "comment_id": 101780389, "body": "Thank you. So to clarify, could you provide where I can find exmaples of what I need? I&#39;m not particularly familiar with this at all. E.g. for 2), Do I literally just write at the top of my code:  ``` MyObject.any_instance.stub(:initialize).to return nil ``` ?"}, {"owner": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "reply_to_user": {"reputation": 11, "user_id": 11980468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0c6d0c9136d4668b630698933897510?s=128&d=identicon&r=PG&f=1", "display_name": "john", "link": "https://stackoverflow.com/users/11980468/john"}, "edited": false, "score": 0, "creation_date": 1566871394, "post_id": 57664720, "comment_id": 101782122, "body": "If I had to break it down in simpler terms: do not stub <code>initialize</code> or <code>new</code>. Figure out which line inside <code>initialize</code> is triggering the HTTP request. Stub this to return some canned result. You need to do this stub <i>before you instantiate <code>MyObject</code></i>.  It could be in the <code>let</code> block or in a <code>before(:each)</code> block."}, {"owner": {"reputation": 3090, "user_id": 4454732, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh3.googleusercontent.com/-8OrTJkCtkn4/AAAAAAAAAAI/AAAAAAAAA4s/7jp2lrThK2k/photo.jpg?sz=128", "display_name": "David Hempy", "link": "https://stackoverflow.com/users/4454732/david-hempy"}, "edited": false, "score": 0, "creation_date": 1566998400, "post_id": 57664720, "comment_id": 101830908, "body": "Given what we know, I think the second part of option 1 is the way to go. That is, mock the call to GoogleDrive.auth (or whatever the method is) to return true or a canned token, or whatever."}], "tags": [], "owner": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "is_accepted": false, "score": 1, "last_activity_date": 1566852253, "creation_date": 1566852253, "answer_id": 57664720, "question_id": 57664277, "link": "https://stackoverflow.com/questions/57664277/testing-methods-of-class-when-instantiation-creates-http-request/57664720#57664720", "title": "Testing methods of class when instantiation creates HTTP request", "body": "<p>I can tell you 3 different ways to do this:</p>\n\n<ol>\n<li><p>Stub out the HTTP request. This can either be done using a gem like <a href=\"https://github.com/bblimke/webmock\" rel=\"nofollow noreferrer\">webmock</a> (which works more 'behind the scenes') or by stubbing the google drive method (e.g. in pseudocode <code>allow(GoogleDrive).to receive(:some_method).and_return \"fake response\"</code>). This is the way I would recommend since it stubs out the <em>least</em> amount of code. It only stubs what's really necessary. For example, imagine you had some <em>other</em> code in your <code>initialize</code> method that you <em>didn't</em> want to stub out.</p></li>\n<li><p>Stub out <code>initialize</code>. To respond to your question:</p>\n\n<blockquote>\n  <p>Would stubbing out the MyObject.new method to return nil be sufficient since the internal methods of MyObject don't actually have anything to do with the google sheet?</p>\n</blockquote>\n\n<p>Stubbing out <code>MyObject.new</code> to return nil would break your code. <code>.new</code> is expected to return an instance. It's <em><code>initialize</code></em> which sets up the initial state for that instance. <code>initialize</code> works by side effects only. So if you stub it out, it would be the same as having no <code>initialize</code> method at all:</p>\n\n<pre><code>MyObject.any_instance.stub(:initialize)\n</code></pre></li>\n<li><p>Instead of testing <code>MyObject</code> directly, create a new class that inherits from it and overrides the <code>initialize</code> definition:</p>\n\n<pre><code>class MyObjectDouble &lt; MyObject\n  def initialize; end\nend\n</code></pre>\n\n<p>Now if you call <code>MyObjectDouble.new</code>, it will run an <em>empty</em> <code>initialize</code> block, but still have the rest of <code>MyObject</code> methods available. </p>\n\n<p>Note that you can do this without defining another constant, if you use an <em>anonymous class</em>:</p>\n\n<pre><code>@MyObjectDouble = Class.new(MyObject) do\n  def initialize; end\nend\n# =&gt; &lt;Class:0x00007fb5842b6b28&gt;\n\n@MyObjectDouble.new.class\n# =&gt; &lt;Class:0x00007fb5842b6b28&gt;\n</code></pre></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 1244, "user_id": 1042324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0bf7d96c6cd1ad77fd77a1331b264819?s=128&d=identicon&r=PG", "display_name": "daniloisr", "link": "https://stackoverflow.com/users/1042324/daniloisr"}, "edited": false, "score": 1, "creation_date": 1566854950, "post_id": 57665072, "comment_id": 101778976, "body": "Good point. And my 2&#162;, if google drive is used extensively by <code>MyObject</code>, it can be a dependency inject, so you can pass a mock when testing."}], "tags": [], "owner": {"reputation": 420, "user_id": 1201862, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2XMCc.jpg?s=128&g=1", "display_name": "Gustavo Toro", "link": "https://stackoverflow.com/users/1201862/gustavo-toro"}, "is_accepted": false, "score": 1, "last_activity_date": 1566854433, "last_edit_date": 1566854433, "creation_date": 1566854398, "answer_id": 57665072, "question_id": 57664277, "link": "https://stackoverflow.com/questions/57664277/testing-methods-of-class-when-instantiation-creates-http-request/57665072#57665072", "title": "Testing methods of class when instantiation creates HTTP request", "body": "<blockquote>\n  <p>The problem is, the very act of instantiating MyObject creates an HTTP request. The following methods that I actually want to test do not create HTTP requests</p>\n</blockquote>\n\n<p>If this is true, you shouldn't be making a HTTP call in <code>initialize</code> method of the class. Just make this call in another method of the object and test it accordingly.</p>\n\n<pre><code>class MyClass\n  def initialize\n    @attr = attr\n    @external = HTTParty #It could be any gem...\n  end\nend\n</code></pre>\n\n<p>.\n.\n.</p>\n\n<pre><code>class MyClass\n  def initialize\n    @attr = attr\n  end\n\n  def call\n    @external = HTTParty #It could be any gem...\n  end\nend\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 11980468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0c6d0c9136d4668b630698933897510?s=128&d=identicon&r=PG&f=1", "display_name": "john", "link": "https://stackoverflow.com/users/11980468/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1566854433, "creation_date": 1566849794, "question_id": 57664277, "link": "https://stackoverflow.com/questions/57664277/testing-methods-of-class-when-instantiation-creates-http-request", "title": "Testing methods of class when instantiation creates HTTP request", "body": "<p>I have some tests for an object that look like as follows:</p>\n\n<pre><code>let(:bot) { MyObject.new('/some/config/file.json') }\n</code></pre>\n\n<p>The problem is, the very act of instantiating MyObject creates an HTTP request. The following methods that I actually want to test do not create HTTP requests at all. E.g:</p>\n\n<pre><code>it \"should parse Jira ticket key answers correctly\" do                                                  \n  expect(bot.offline_method(good_answer) == correct_outcome).to eq(true)\n  expect(bot.offline_method(bad_answer) == correct_outcome).to eq(false)\nend\n</code></pre>\n\n<p>How can I stub out the instantiation of MyObject.new itself?</p>\n\n<p>For additional context, the MyObject.new instantiates a session using the google drive gem.</p>\n\n<p>If I open an interactive Ruby environment and instantiate the bot as follows, it tells me the output is thus:</p>\n\n<pre><code>bot = MyObject.new('/some/config/file.json')\n=&gt; #&lt;Object:0x007f6d07a10b50 @session=#&lt;GoogleDrive::Session:0xabcdef1234567&gt;, @MyObject_spreadsheet_responses_1=#&lt;GoogleDrive::Worksheet spreadsheet_id=\"123456789abcdefghjijklmnopqrstuvwxyz\", gid=\"123456789\", title=\"title of first google sheet\"&gt;, @MyObject_spreadsheet_responses_2=#&lt;GoogleDrive::Worksheet spreadsheet_id=\"123456789abcdefghjijklmnopqrstuvwxyz\", gid=\"1687481303\", title=\"second_spreadsheet_title\"&gt;&gt;\n</code></pre>\n\n<p>So how exactly do I stub</p>\n\n<pre><code>let(:bot) { MyObject.new('/some/config/file.json') }\n</code></pre>\n\n<p>??</p>\n\n<p>I know I want something like:</p>\n\n<pre><code>allow_any_instance_of(MyObject.new).to return {\n#&lt;Object:0x007f6d07a10b50 @session=#&lt;GoogleDrive::Session:0xabcdef1234567&gt;, @MyObject_spreadsheet_responses_1=#&lt;GoogleDrive::Worksheet spreadsheet_id=\"123456789abcdefghjijklmnopqrstuvwxyz\", gid=\"123456789\", title=\"title of first google sheet\"&gt;, @MyObject_spreadsheet_responses_2=#&lt;GoogleDrive::Worksheet spreadsheet_id=\"123456789abcdefghjijklmnopqrstuvwxyz\", gid=\"1687481303\", title=\"second_spreadsheet_title\"&gt;&gt;\n}\n</code></pre>\n\n<p>But I really have no clue what the exact syntax is I want or how to find it.</p>\n\n<p>Thank you for any help!</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 1, "creation_date": 1566843419, "post_id": 57662903, "comment_id": 101774814, "body": "Please check tags before you link them. <a href=\"https://stackoverflow.com/questions/tagged/otp\">otp</a> has nothing to do with this question; removed."}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1566843855, "post_id": 57662903, "comment_id": 101774997, "body": "<a href=\"https://github.com/mdp/rotp#preventing-reuse-of-time-based-otps\" rel=\"nofollow noreferrer\"><code>ROTP</code></a> surely supports it, but your thin wrapper does not. You need to add the additional column to your table and manage it manually."}, {"owner": {"reputation": 43, "user_id": 9975038, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-F_AVW5wnFKU/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq3wWb5JVciYVrQD_ZBr2sZ1SlQkJg/mo/photo.jpg?sz=128", "display_name": "Sibgha Samdani", "link": "https://stackoverflow.com/users/9975038/sibgha-samdani"}, "reply_to_user": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1567197519, "post_id": 57662903, "comment_id": 101905888, "body": "Thanks @AlekseiMatiushkin"}], "owner": {"reputation": 43, "user_id": 9975038, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-F_AVW5wnFKU/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq3wWb5JVciYVrQD_ZBr2sZ1SlQkJg/mo/photo.jpg?sz=128", "display_name": "Sibgha Samdani", "link": "https://stackoverflow.com/users/9975038/sibgha-samdani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 42, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1566843394, "creation_date": 1566843253, "last_edit_date": 1566843394, "question_id": 57662903, "link": "https://stackoverflow.com/questions/57662903/can-we-define-a-custom-validity-period-for-active-model-otp", "title": "Can we define a custom validity period for active_model_otp?", "body": "<p>I am using <a href=\"https://github.com/heapsource/active_model_otp\" rel=\"nofollow noreferrer\">https://github.com/heapsource/active_model_otp</a> for two way authentication during signup. The otp code would be sent to the user email address which he will enter in the first step and after entering the otp code he can set the password and continue.</p>\n\n<p>Flow:</p>\n\n<p>User Name, Email -> OTP code -> Password, Confirm Password</p>\n\n<p>The current validity time of otp code is 30 seconds. </p>\n\n<p>Can we increase this duration through this gem or any other way of doing it?</p>\n"}, {"tags": ["ruby", "watir", "page-object-gem"], "comments": [{"owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 0, "creation_date": 1566840569, "post_id": 57662276, "comment_id": 101773695, "body": "Is that the whole &quot;runnable&quot; file?"}, {"owner": {"reputation": 307, "user_id": 2775990, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/q0b2b.jpg?s=128&g=1", "display_name": "spectator", "link": "https://stackoverflow.com/users/2775990/spectator"}, "reply_to_user": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 1, "creation_date": 1566840837, "post_id": 57662276, "comment_id": 101773805, "body": "you can call <code>get_table_data</code> method to run it"}], "answers": [{"comments": [{"owner": {"reputation": 307, "user_id": 2775990, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/q0b2b.jpg?s=128&g=1", "display_name": "spectator", "link": "https://stackoverflow.com/users/2775990/spectator"}, "edited": false, "score": 0, "creation_date": 1566909724, "post_id": 57662913, "comment_id": 101796863, "body": "Hi Justin, It is working fine for tables which has matching headers but I have a table which is like above one so how can I ignore first <b>tr</b> in the table and transpose from next"}, {"owner": {"reputation": 307, "user_id": 2775990, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/q0b2b.jpg?s=128&g=1", "display_name": "spectator", "link": "https://stackoverflow.com/users/2775990/spectator"}, "edited": false, "score": 0, "creation_date": 1566913043, "post_id": 57662913, "comment_id": 101798920, "body": "Am getting the following error as it is considering first data as header: <code>element size differs (6 should be 3) (IndexError)</code>"}, {"owner": {"reputation": 44680, "user_id": 1200545, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbbfea5f6583c16f96fc11ef821cfeee?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Ko", "link": "https://stackoverflow.com/users/1200545/justin-ko"}, "reply_to_user": {"reputation": 307, "user_id": 2775990, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/q0b2b.jpg?s=128&g=1", "display_name": "spectator", "link": "https://stackoverflow.com/users/2775990/spectator"}, "edited": false, "score": 1, "creation_date": 1566920958, "post_id": 57662913, "comment_id": 101803463, "body": "<code>#strings</code> is returning an Array where each item represents a row. Assuming you do not need that row for anything, you could discard it by changing <code>customers_element.strings.transpose</code> to <code>customers_element.strings[1..-1].transpose</code>."}], "tags": [], "owner": {"reputation": 44680, "user_id": 1200545, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbbfea5f6583c16f96fc11ef821cfeee?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Ko", "link": "https://stackoverflow.com/users/1200545/justin-ko"}, "is_accepted": true, "score": 3, "last_activity_date": 1566843303, "creation_date": 1566843303, "answer_id": 57662913, "question_id": 57662276, "link": "https://stackoverflow.com/questions/57662276/how-to-combine-a-table-headers-and-rows-in-to-a-map-using-ruby/57662913#57662913", "title": "how to combine a table headers and rows in to a map using ruby?", "body": "<p>The problem is that <code>rows</code> is actually the individual data cells rather than the column of data. When you zip it with the <code>headers</code>, you have a mismatch on the size/data.</p>\n\n<p>I think the simplist solution is to use Watir's <code>Table#strings</code> method to convert the table data to an Array of row data, which can be transposed to get the column data:</p>\n\n<pre><code>def get_table_data\n  data = {}\n  customers_element.strings.transpose.each { |col| data[col.shift.to_sym] = col }\n  data\nend\n</code></pre>\n"}], "owner": {"reputation": 307, "user_id": 2775990, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/q0b2b.jpg?s=128&g=1", "display_name": "spectator", "link": "https://stackoverflow.com/users/2775990/spectator"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 320, "favorite_count": 1, "accepted_answer_id": 57662913, "answer_count": 1, "score": 2, "last_activity_date": 1566913144, "creation_date": 1566840039, "last_edit_date": 1566913144, "question_id": 57662276, "link": "https://stackoverflow.com/questions/57662276/how-to-combine-a-table-headers-and-rows-in-to-a-map-using-ruby", "title": "how to combine a table headers and rows in to a map using ruby?", "body": "<p>While using the pageobject gem am able to get the a headers and rows of a table but am unable to convert it into a hash using the below code am able to get only first row mapped to headers but I need complete table rows mapped to the header.</p>\n\n<p>Here is the link for the table data: <a href=\"https://www.w3schools.com/html/html_tables.asp\" rel=\"nofollow noreferrer\">https://www.w3schools.com/html/html_tables.asp</a></p>\n\n<p>I have tried the below code:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>class WbPage\n  include PageObject\n\n  page_url 'https://www.w3schools.com/html/html_tables.asp'\n\n  table(:customers, id: 'customers')\n\n  def get_table_data\n    headers = customers_element.ths.collect { |th| th.inner_html }\n    rows = customers_element.tds.collect { |td| td.inner_html }\n    data = {}\n    headers.zip(rows) { |header,row| data[header.to_sym] = row }\n    puts data\n  end\n\nend\n</code></pre>\n\n<p>am getting the below output for the above code:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>{:Company=&gt;\"Alfreds Futterkiste\", :Contact=&gt;\"Maria Anders\", :Country=&gt;\"Germany\"}\n</code></pre>\n\n<p>But I need to get like this:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>{:Company =&gt; \"Alfreds Futterkiste\", \"Centro comercial Moctezuma\", \"Ernst Handel\", \"Island Trading\", \"Laughing Bacchus Winecellars\", \"Giovanni Rovelli\"\n:Contact =&gt; \"Maria Anders\", \"Francisco Chang\", \"Roland Mendel\", \"Helen Bennett\", \"Yoshi Tannamuri\", \"Magazzini Alimentari Riuniti\"\n:Contry =&gt; \"Germany\", \"Mexico\", \"Austria\", \"UK\", \"Canada\", \"Italy\"}\n</code></pre>\n\n<p>What if I have the table like this</p>\n\n<pre><code>--------------------------------------------------\n Location     |       Time     |           Miles   &lt;-- First tr with headers (I need to ignore it)\n--------------------------------------------------\nFuel | Inspection | State | Zone | ETA | ETD |     &lt;-- Second tr with headers (from here i need the data)\n--------------------------------------------------\nF | I | Omaha | Nebraska | 27 08:00 | 27 08:30 | \nF | I | Omaha | Nebraska | 27 08:00 | 27 08:30 |\nF | I | Omaha | Nebraska | 27 08:00 | 27 08:30 |\nF | I | Omaha | Nebraska | 27 08:00 | 27 08:30 |\nF | I | Omaha | Nebraska | 27 08:00 | 27 08:30 |\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "testing", "curl", "rspec"], "comments": [{"owner": {"reputation": 703, "user_id": 3744443, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/31cd958c40afab1804323dc579eeb4c5?s=128&d=identicon&r=PG&f=1", "display_name": "fidato", "link": "https://stackoverflow.com/users/3744443/fidato"}, "edited": false, "score": 0, "creation_date": 1566840330, "post_id": 57662275, "comment_id": 101773598, "body": "Are you able to add your controller code here?"}, {"owner": {"reputation": 851, "user_id": 7034540, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209364272256116/picture?type=large", "display_name": "aRtoo", "link": "https://stackoverflow.com/users/7034540/artoo"}, "reply_to_user": {"reputation": 703, "user_id": 3744443, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/31cd958c40afab1804323dc579eeb4c5?s=128&d=identicon&r=PG&f=1", "display_name": "fidato", "link": "https://stackoverflow.com/users/3744443/fidato"}, "edited": false, "score": 0, "creation_date": 1566840588, "post_id": 57662275, "comment_id": 101773704, "body": "@fidato I just added it. it doenst have a code though."}, {"owner": {"reputation": 851, "user_id": 7034540, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209364272256116/picture?type=large", "display_name": "aRtoo", "link": "https://stackoverflow.com/users/7034540/artoo"}, "reply_to_user": {"reputation": 703, "user_id": 3744443, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/31cd958c40afab1804323dc579eeb4c5?s=128&d=identicon&r=PG&f=1", "display_name": "fidato", "link": "https://stackoverflow.com/users/3744443/fidato"}, "edited": false, "score": 0, "creation_date": 1566840749, "post_id": 57662275, "comment_id": 101773771, "body": "@fidato I added another error"}, {"owner": {"reputation": 703, "user_id": 3744443, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/31cd958c40afab1804323dc579eeb4c5?s=128&d=identicon&r=PG&f=1", "display_name": "fidato", "link": "https://stackoverflow.com/users/3744443/fidato"}, "edited": false, "score": 1, "creation_date": 1566840971, "post_id": 57662275, "comment_id": 101773870, "body": "Please add <code>require &quot;spec_helper&quot;</code> in spec file and try again."}, {"owner": {"reputation": 851, "user_id": 7034540, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209364272256116/picture?type=large", "display_name": "aRtoo", "link": "https://stackoverflow.com/users/7034540/artoo"}, "reply_to_user": {"reputation": 703, "user_id": 3744443, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/31cd958c40afab1804323dc579eeb4c5?s=128&d=identicon&r=PG&f=1", "display_name": "fidato", "link": "https://stackoverflow.com/users/3744443/fidato"}, "edited": false, "score": 0, "creation_date": 1566841066, "post_id": 57662275, "comment_id": 101773909, "body": "@fidato I still get an error."}, {"owner": {"reputation": 703, "user_id": 3744443, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/31cd958c40afab1804323dc579eeb4c5?s=128&d=identicon&r=PG&f=1", "display_name": "fidato", "link": "https://stackoverflow.com/users/3744443/fidato"}, "edited": false, "score": 1, "creation_date": 1566841133, "post_id": 57662275, "comment_id": 101773949, "body": "refer - <a href=\"https://stackoverflow.com/questions/25800122/error-when-trying-to-run-rspec-require-cannot-load-such-file-rails-helper\" title=\"error when trying to run rspec require cannot load such file rails helper\">stackoverflow.com/questions/25800122/&hellip;</a>"}, {"owner": {"reputation": 851, "user_id": 7034540, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209364272256116/picture?type=large", "display_name": "aRtoo", "link": "https://stackoverflow.com/users/7034540/artoo"}, "reply_to_user": {"reputation": 703, "user_id": 3744443, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/31cd958c40afab1804323dc579eeb4c5?s=128&d=identicon&r=PG&f=1", "display_name": "fidato", "link": "https://stackoverflow.com/users/3744443/fidato"}, "edited": false, "score": 0, "creation_date": 1566841325, "post_id": 57662275, "comment_id": 101774023, "body": "Im getting somewhere. lols. I still have an error though. <code>ununitialized constant spree</code>"}, {"owner": {"reputation": 416, "user_id": 7821606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4Z8Ad.png?s=128&g=1", "display_name": "morissetcl", "link": "https://stackoverflow.com/users/7821606/morissetcl"}, "edited": false, "score": 0, "creation_date": 1566890782, "post_id": 57662275, "comment_id": 101786853, "body": "It sounds really weird that your test load in 18sec..it&#39;s really slow, maybe you should have an issue with your configuration. What documentation do you use for setup Rspec ?"}, {"owner": {"reputation": 851, "user_id": 7034540, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209364272256116/picture?type=large", "display_name": "aRtoo", "link": "https://stackoverflow.com/users/7034540/artoo"}, "reply_to_user": {"reputation": 416, "user_id": 7821606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4Z8Ad.png?s=128&g=1", "display_name": "morissetcl", "link": "https://stackoverflow.com/users/7821606/morissetcl"}, "edited": false, "score": 0, "creation_date": 1566916295, "post_id": 57662275, "comment_id": 101800862, "body": "@morissetcl we&#39;re are using this. <a href=\"https://relishapp.com/rspec/rspec-rails\" rel=\"nofollow noreferrer\">relishapp.com/rspec/rspec-rails</a> is there another documentation better than this?"}], "owner": {"reputation": 851, "user_id": 7034540, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209364272256116/picture?type=large", "display_name": "aRtoo", "link": "https://stackoverflow.com/users/7034540/artoo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 119, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1566890761, "creation_date": 1566840037, "last_edit_date": 1566840566, "question_id": 57662275, "link": "https://stackoverflow.com/questions/57662275/ruby-on-rails-rspec-test-failing-because-of-routes", "title": "Ruby on Rails RSpec test failing because of routes", "body": "<p>I have been trying to test my index route using RSpec.</p>\n\n<p>I have this code but the error doesn't make sense because I have this route I tried it on the browser and curl, I'm still getting a response.</p>\n\n<pre><code>require 'rails_helper'\n\nRSpec.describe Spree::Admin::OfficeAddressesController, type: :controller do\n\n  describe \"GET index\" do\n    it \"render view index template\" do\n      get :index, params: {use_route: 'spree/admin/office_addresses'}\n      # expect(response).to render_template('index')\n      expect(response).to eq(200)\n    end\n  end\n\nend\n</code></pre>\n\n<p>error msg:</p>\n\n<pre><code>\nFailures:\n\n  1) Spree::Admin::OfficeAddressesController GET index render view index template\n     Failure/Error: get :index, params: {use_route: 'spree/admin/office_addresses'}\n\n     ActionController::UrlGenerationError:\n       No route matches {:action=&gt;\"index\", :controller=&gt;\"spree/admin/office_addresses\", :params=&gt;{:use_route=&gt;\"spree/admin/office_addresses\"}}\n     # ./spec/controllers/office_addresses_controller_spec.rb:8:in `block (3 levels) in &lt;top (required)&gt;'\n\nFinished in 18.54 seconds (files took 7.55 seconds to load)\n1 example, 1 failure\n\nFailed examples:\n\nrspec ./spec/controllers/office_addresses_controller_spec.rb:7 # Spree::Admin::OfficeAddressesController GET index render view index template\n</code></pre>\n\n<p>I have tried this SO answers still no luck</p>\n\n<p><a href=\"https://stackoverflow.com/questions/32320214/actioncontrollerurlgenerationerror-no-route-matches\">link1</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/19027199/rspec-controllers-in-and-out-of-namespace-with-same-name\">link2</a></p>\n\n<p>I tried it with curl I get a <code>200</code> ok response.</p>\n\n<p>here are my routes</p>\n\n<pre><code>bin/rake routes | grep office_addresses\n\nadmin_office_addresses GET   \n/admin/office_addresses(.:format) \nspree/admin/office_addresses#index\n</code></pre>\n\n<pre><code>rails -v\nRails 4.2.6\n</code></pre>\n\n<pre><code>ruby -v\nruby 2.3.6\n</code></pre>\n\n<p>Curl Response:</p>\n\n<pre><code>curl --verbose localhost:3000/spree/admin/office_addresses | grep HTTP\n\n* TCP_NODELAY set\n* Connected to localhost (::1) port 3000 (#0)\n&gt; GET /spree/admin/office_addresses HTTP/1.1\n&gt; Host: localhost:3000\n&gt; User-Agent: curl/7.61.0\n&gt; Accept: */*\n\n&lt; HTTP/1.1 200 OK\n\n&lt; X-Frame-Options: SAMEORIGIN\n&lt; X-XSS-Protection: 1; mode=block\n&lt; X-Content-Type-Options: nosniff\n&lt; Content-Type: text/html; charset=utf-8\n&lt; Cache-Control: max-age=0, private, must-revalidate\n&lt; X-Runtime: 1.124812\n&lt; Vary: Origin\n&lt; X-Rack-CORS: miss; no-origin\n&lt; Content-Length: 29482\n</code></pre>\n\n<p>This is my first time to use Rspec btw and the documentation is nevermind... </p>\n\n<p>Controller:</p>\n\n<pre><code># frozen_string_literal: true\n\nmodule Spree\n  module Admin\n    class OfficeAddressesController &lt; ResourceController\n      def index\n        # @ = .all\n      end\n\n    end\n  end\nend\n\n</code></pre>\n\n<p><strong>UPDATE</strong>\nIf I require the controller I have this error.</p>\n\n<pre><code>An error occurred while loading ./spec/controllers/office_addresses_controller_spec.rb.\nFailure/Error: require 'spree/admin/office_addresses_controller'\n\nLoadError:\n  cannot load such file -- spree/admin/office_addresses_controller\n# ./spec/controllers/office_addresses_controller_spec.rb:1:in `require'\n# ./spec/controllers/office_addresses_controller_spec.rb:1:in `&lt;top (required)&gt;'\nNo examples found.\n\n\nFinished in 0.00022 seconds (files took 0.34632 seconds to load)\n0 examples, 0 failures, 1 error occurred outside of examples\n</code></pre>\n"}, {"tags": ["ruby", "multithreading", "concurrency", "thread-safety"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 3, "creation_date": 1566837683, "post_id": 57660980, "comment_id": 101772584, "body": "<code>||=</code> is not thread safe unless you have a Mutex involved to lock it. It&#39;s not an atomic operation, it&#39;s three ops (read, test, set) where there&#39;s lots of room for threading issues."}, {"owner": {"reputation": 955, "user_id": 182365, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8ed8f5c8da8ca1279b3b09df4b90a590?s=128&d=identicon&r=PG", "display_name": "Jason Keene", "link": "https://stackoverflow.com/users/182365/jason-keene"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1566849400, "post_id": 57660980, "comment_id": 101777155, "body": "@tadman that was my suspicion. I was working on an experiment to try and demonstrate these sort of interleavings. I do not know how to encourage the thread scheduler to preempt at a high rate however."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1566852637, "post_id": 57660980, "comment_id": 101778304, "body": "If you need to do this it&#39;s time for <a href=\"https://ruby-doc.org/core-2.5.0/Mutex.html\" rel=\"nofollow noreferrer\"><code>Mutex#synchronize</code></a>."}], "answers": [{"comments": [{"owner": {"reputation": 955, "user_id": 182365, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8ed8f5c8da8ca1279b3b09df4b90a590?s=128&d=identicon&r=PG", "display_name": "Jason Keene", "link": "https://stackoverflow.com/users/182365/jason-keene"}, "edited": false, "score": 0, "creation_date": 1566859830, "post_id": 57664871, "comment_id": 101780257, "body": "Thanks @Max. I was doing something very similar in my experimentation. Indeed my suspicions were warranted."}], "tags": [], "owner": {"reputation": 18079, "user_id": 503402, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/873ad707fb34aac8fbdfbfec676e02e9?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/503402/max"}, "is_accepted": true, "score": 0, "last_activity_date": 1566853155, "creation_date": 1566853155, "answer_id": 57664871, "question_id": 57660980, "link": "https://stackoverflow.com/questions/57660980/ruby-thread-safe-thread-creation/57664871#57664871", "title": "Ruby thread safe thread creation", "body": "<p>You need a mutex. Essentially the only thing the GIL protects you from is accessing uninitialized memory. If something in Ruby <em>could</em> be well-defined without being atomic, you should not assume it is atomic.</p>\n\n<p>A simple example to show that your example ordering is possible. I get the \"double set\" message every time I run it:</p>\n\n<pre><code>$global = nil\n$thread = nil\n\nthreads = []\n\nthreads = Array.new(1000) do\n  Thread.new do\n    sleep 1\n    $thread ||= Thread.new do\n      if $global\n        warn \"double set!\"\n      else\n        $global = true\n      end\n    end\n  end\nend\n\nthreads.each(&amp;:join)\n</code></pre>\n"}], "owner": {"reputation": 955, "user_id": 182365, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8ed8f5c8da8ca1279b3b09df4b90a590?s=128&d=identicon&r=PG", "display_name": "Jason Keene", "link": "https://stackoverflow.com/users/182365/jason-keene"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 57664871, "answer_count": 1, "score": 2, "last_activity_date": 1566853155, "creation_date": 1566833900, "question_id": 57660980, "link": "https://stackoverflow.com/questions/57660980/ruby-thread-safe-thread-creation", "title": "Ruby thread safe thread creation", "body": "<p>I came across this bit of code today:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>@thread ||= Thread.new do\n  # this thread should only spin up once\nend\n</code></pre>\n\n<p>It is being called by multiple threads. I was worried that if multiple threads are calling this code that you could have multiple threads created since <code>@thread</code> access is not synchronized. However, I was told that this could not happen because of the Global Interpreter Lock. I did a little bit of reading about threads in Ruby and it seems like individual threads that are running Ruby code can get preempted by other threads. If this is the case, couldn't you have an interleaving like this:</p>\n\n<pre><code>Thread A             Thread B\n========             ========\nRead from @thread    .\nThread.New           .\n[Thread A preempted] .\n.                    Read from @thread\n.                    Thread.New\n.                    Write to @thread\nWrite to @thread\n</code></pre>\n\n<p>Additionally, since access to @thread is not synchronized are writes to <code>@thread</code> guaranteed to be visible to all other threads? The memory models of other languages I've used in the past do not guarantee visibility of writes to memory unless you synchronize access to that memory using atomics, mutexes, etc.</p>\n\n<p>I'm still learning Ruby and realize I have a long way to go to understanding concurrency in Ruby. Any help on this would be super appreciated!</p>\n"}, {"tags": ["sql", "ruby-on-rails", "ruby", "activerecord"], "answers": [{"comments": [{"owner": {"reputation": 2390, "user_id": 4812050, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/hzLjT.jpg?s=128&g=1", "display_name": "Cruz Nunez", "link": "https://stackoverflow.com/users/4812050/cruz-nunez"}, "edited": false, "score": 0, "creation_date": 1567179076, "post_id": 57678965, "comment_id": 101899463, "body": "Although this might work, I couldn&#39;t find a way to implement this in rails to generate that query"}, {"owner": {"reputation": 21, "user_id": 8733878, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210081546626351/picture?type=large", "display_name": "Rafael Shintani", "link": "https://stackoverflow.com/users/8733878/rafael-shintani"}, "reply_to_user": {"reputation": 2390, "user_id": 4812050, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/hzLjT.jpg?s=128&g=1", "display_name": "Cruz Nunez", "link": "https://stackoverflow.com/users/4812050/cruz-nunez"}, "edited": false, "score": 0, "creation_date": 1567535659, "post_id": 57678965, "comment_id": 101989134, "body": "Apparently Rails ActiveRecord does not support EXCEPT queries. You could subtract queries in Rails tho.   q1 = TextMessage.all   q2 = TextMessage.includes(:histories).where(customer_service_acti&zwnj;&#8203;ons:{name: &#39;close&#39;})  result = q1 - q2 that may work"}], "tags": [], "owner": {"reputation": 21, "user_id": 8733878, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210081546626351/picture?type=large", "display_name": "Rafael Shintani", "link": "https://stackoverflow.com/users/8733878/rafael-shintani"}, "is_accepted": false, "score": 1, "last_activity_date": 1567535978, "last_edit_date": 1567535978, "creation_date": 1566923680, "answer_id": 57678965, "question_id": 57660657, "link": "https://stackoverflow.com/questions/57660657/rails-left-joins-eliminate-all-if-associations-if-condition-met/57678965#57678965", "title": "Rails left_joins eliminate all if associations if condition met", "body": "<p>Maybe using EXCEPT?</p>\n\n<pre><code>(SELECT * \nFROM \"text_messages\"\nLEFT OUTER JOIN \"customer_service_actions\" \nON \"customer_service_actions\".\"id\" = \"customer_service_histories\".\"customer_service_action_id\")\nEXCEPT\n(SELECT * \nFROM \"text_messages\"\nLEFT OUTER JOIN \"customer_service_actions\" \nON \"customer_service_actions\".\"id\" = \"customer_service_histories\".\"customer_service_action_id\"\nWHERE \"customer_service_actions\".\"name\" LIKE 'close')\n</code></pre>\n\n<p>Edit: Apparently Rails ActiveRecord does not support EXCEPT queries. You could subtract queries in Rails tho. </p>\n\n<pre><code>q1 = TextMessage.all \nq2 = TextMessage.includes(:histories).where(customer_service_actions:{name: 'close'}) \nresult = q1 - q2 \n</code></pre>\n\n<p>that may work </p>\n"}, {"tags": [], "owner": {"reputation": 2390, "user_id": 4812050, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/hzLjT.jpg?s=128&g=1", "display_name": "Cruz Nunez", "link": "https://stackoverflow.com/users/4812050/cruz-nunez"}, "is_accepted": true, "score": 0, "last_activity_date": 1567174694, "creation_date": 1567174694, "answer_id": 57728485, "question_id": 57660657, "link": "https://stackoverflow.com/questions/57660657/rails-left-joins-eliminate-all-if-associations-if-condition-met/57728485#57728485", "title": "Rails left_joins eliminate all if associations if condition met", "body": "<p>I've got something working but it's unsatisfactory.</p>\n\n<pre><code>class TextMessage\n  def self.search(query)\n    return latest_messages.active unless query.present?\n\n    # more code\n  end\n\n  scope :latest_messages, -&gt; {\n    where(\"text_messages.created_at = (SELECT MAX(text_messages.created_at) FROM text_messages WHERE text_messages.phone_id = phones.id)\")\n  }\n\n  scope :active, -&gt; {\n    where(\n      &lt;&lt;~SQL.squish\n        text_messages.id NOT IN (\n          SELECT text_messages.id\n          FROM text_messages\n          INNER JOIN customer_service_histories\n            ON customer_service_histories.item_id = text_messages.id\n            AND customer_service_histories.item_type = 'TextMessage'\n          INNER JOIN customer_service_actions\n            ON customer_service_actions.id = customer_service_histories.customer_service_action_id\n          WHERE customer_service_actions.name = 'close'\n        )\n      SQL\n    )\n  }\n</code></pre>\n\n<p>This produces the SQL</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>SQL (1.9ms)  \nSELECT  DISTINCT \"text_messages\".\"id\", \n  customer_service_histories.customer_service_action_id AS alias_0, \n  text_messages.created_at AS alias_1 \nFROM \"text_messages\" \nINNER JOIN \"phones\" \n  ON \"phones\".\"id\" = \"text_messages\".\"phone_id\" \nINNER JOIN \"customers\" \n  ON \"customers\".\"id\" = \"phones\".\"customer_id\" \n  AND \"customers\".\"company_id\" = $1 \nLEFT OUTER JOIN \"customer_service_histories\" \n  ON \"customer_service_histories\".\"item_id\" = \"text_messages\".\"id\" \n  AND \"customer_service_histories\".\"item_type\" = $2 \nLEFT OUTER JOIN \"customer_service_actions\" \n  ON \"customer_service_actions\".\"id\" = \"customer_service_histories\".\"customer_service_action_id\" \nWHERE (\n  text_messages.created_at = (\n    SELECT MAX(text_messages.created_at) \n    FROM text_messages \n    WHERE text_messages.phone_id = phones.id\n  )\n) \nAND (\n  text_messages.id NOT IN (\n    SELECT text_messages.id\n    FROM text_messages\n    INNER JOIN customer_service_histories\n      ON customer_service_histories.item_id = text_messages.id\n      AND customer_service_histories.item_type = 'TextMessage'\n    INNER JOIN customer_service_actions\n      ON customer_service_actions.id = customer_service_histories.customer_service_action_id\n    WHERE customer_service_actions.name = 'close'\n  )\n) \nORDER BY \n  customer_service_histories.customer_service_action_id DESC, \n  text_messages.created_at DESC \nLIMIT $3 OFFSET $4  \n[[\"company_id\", 1], [\"item_type\", \"TextMessage\"], [\"LIMIT\", 10], [\"OFFSET\", 0]]\n</code></pre>\n\n<p>This is correct SQL but it uses SQL as strings. Ideally what I want is</p>\n\n<ol>\n<li>Load the correct data</li>\n<li>Use the correct SQL</li>\n<li>Use Rails syntax instead of SQL in strings</li>\n<li>Have to ability to chain these scopes together</li>\n</ol>\n\n<p>Something like this</p>\n\n<pre><code>class TextMessage\n  def self.search(query)\n    return latest_messages.active unless query.present?\n\n    # more code\n  end\n\n\n  scope :latest_messages, -&gt; {\n    where(\"text_messages.created_at = (SELECT MAX(text_messages.created_at) FROM text_messages WHERE text_messages.phone_id = phones.id)\")\n  }\n\n  scope :active, -&gt; {\n    where.not(id: TextMessage.select(:id)\n                             .joins(histories: :action)\n                             .where(customer_service_actions: { name: 'close' })\n             )\n  }\n\n  # more code\nend\n</code></pre>\n\n<p>Using this Rails code loads the correct data but for some reason causes too much SQL</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>SQL (1.2ms)  \nSELECT  DISTINCT \"text_messages\".\"id\", customer_service_histories.customer_service_action_id AS alias_0, text_messages.created_at AS alias_1 \nFROM \"text_messages\" INNER JOIN \"phones\" ON \"phones\".\"id\" = \"text_messages\".\"phone_id\" \nINNER JOIN \"customers\" ON \"customers\".\"id\" = \"phones\".\"customer_id\" AND \"customers\".\"company_id\" = $1 \nLEFT OUTER JOIN \"customer_service_histories\" ON \"customer_service_histories\".\"item_id\" = \"text_messages\".\"id\" AND \"customer_service_histories\".\"item_type\" = $2 \nLEFT OUTER JOIN \"customer_service_actions\" ON \"customer_service_actions\".\"id\" = \"customer_service_histories\".\"customer_service_action_id\" \nWHERE (\n  text_messages.created_at = (                         -- first condition\n    SELECT MAX(text_messages.created_at) \n    FROM text_messages \n    WHERE text_messages.phone_id = phones.id\n  )\n) \nAND (\n  text_messages.id NOT IN (\n    SELECT \"text_messages\".\"id\" \n    FROM \"text_messages\" \n    INNER JOIN \"customer_service_histories\" ON \"customer_service_histories\".\"item_id\" = \"text_messages\".\"id\" AND \"customer_service_histories\".\"item_type\" = 'TextMessage' \n    INNER JOIN \"customer_service_actions\" ON \"customer_service_actions\".\"id\" = \"customer_service_histories\".\"customer_service_action_id\" \n    WHERE (\n      text_messages.created_at = (                     -- repeated first condition\n        SELECT MAX(text_messages.created_at) \n        FROM text_messages \n        WHERE text_messages.phone_id = phones.id\n      )\n    ) \n    AND \"customer_service_actions\".\"name\" = 'close'    -- second condition\n  )\n) \nORDER BY \n  customer_service_histories.customer_service_action_id DESC, \n  text_messages.created_at DESC \nLIMIT $3 OFFSET $4  \n[[\"company_id\", 1], [\"item_type\", \"TextMessage\"], [\"LIMIT\", 10], [\"OFFSET\", 0]]\n</code></pre>\n\n<p>The <code>created_at</code> condition is repeated and then is paired with the <code>actions.name</code> condition. I tried many different combination of things to try to get it to work with more concise ruby syntax but I wan't satisfied with the SQL output. </p>\n\n<p>I did find a way to use the ruby syntax and get the SQL I wanted, but I had to have both <code>where()</code> functions in the same scope. </p>\n\n<pre><code>class TextMessage\n  def self.search(query)\n    return latest_messages unless query.present?\n\n    # more code\n  end\n\n  scope :latest_messages, -&gt; {\n    where(\"text_messages.created_at = (SELECT MAX(text_messages.created_at) FROM text_messages WHERE text_messages.phone_id = phones.id)\")\n    .where('text_messages.id NOT IN (?)', TextMessage.active_ids)\n  }\n\n  scope :active_ids, -&gt; {\n    TextMessage.select(:id).joins(histories: :action).where.not(\n      customer_service_actions: { name: 'close' }\n    )\n  }\n\n  # more code\nend\n</code></pre>\n\n<p>I tried to put them in different scopes</p>\n\n<pre><code>  def self.search(query)\n    return latest_messages.active unless query.present?\n\n    # more code\n  end\n\n  scope :latest_messages, -&gt; {\n    where(\"text_messages.created_at = (SELECT MAX(text_messages.created_at) FROM text_messages WHERE text_messages.phone_id = phones.id)\")\n  }\n\n  scope :active, -&gt; {\n    where('text_messages.id NOT IN (?)', TextMessage.active_ids)\n  )\n\n  scope :active_ids, -&gt; {\n    TextMessage.select(:id).joins(histories: :action).where.not(\n      customer_service_actions: { name: 'close' }\n    )\n  }\n</code></pre>\n\n<p>But that caused more join clauses in the subquery</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>SQL (1.7ms)  \nSELECT  DISTINCT \"text_messages\".\"id\", \n  customer_service_histories.customer_service_action_id AS alias_0, \n  text_messages.created_at AS alias_1 \nFROM \"text_messages\" \nINNER JOIN \"phones\" \n  ON \"phones\".\"id\" = \"text_messages\".\"phone_id\" \nINNER JOIN \"customers\" \n  ON \"customers\".\"id\" = \"phones\".\"customer_id\" \n  AND \"customers\".\"company_id\" = $1 \nLEFT OUTER JOIN \"customer_service_histories\" \n  ON \"customer_service_histories\".\"item_id\" = \"text_messages\".\"id\" \n  AND \"customer_service_histories\".\"item_type\" = $2 \nLEFT OUTER JOIN \"customer_service_actions\" \n  ON \"customer_service_actions\".\"id\" = \"customer_service_histories\".\"customer_service_action_id\" \nWHERE (\n  text_messages.created_at = (                      -- first condition\n    SELECT MAX(text_messages.created_at) \n    FROM text_messages \n    WHERE text_messages.phone_id = phones.id\n  )\n) \nAND (\n  \"text_messages\".\"id\" NOT IN (\n    SELECT \"text_messages\".\"id\" \n    FROM \"text_messages\" \n    INNER JOIN \"phones\"                             -- unnecessary joins on phones \n      ON \"phones\".\"id\" = \"text_messages\".\"phone_id\" \n    INNER JOIN \"customers\"                          -- unnecessary joins on customers\n      ON \"customers\".\"id\" = \"phones\".\"customer_id\" \n      AND \"customers\".\"company_id\" = $3 \n    INNER JOIN \"customer_service_histories\" \n      ON \"customer_service_histories\".\"item_id\" = \"text_messages\".\"id\" \n      AND \"customer_service_histories\".\"item_type\" = $4 \n    INNER JOIN \"customer_service_actions\" \n      ON \"customer_service_actions\".\"id\" = \"customer_service_histories\".\"customer_service_action_id\" \n    WHERE (\n      text_messages.created_at = (                  -- repeated first condition\n        SELECT MAX(text_messages.created_at) \n        FROM text_messages \n        WHERE text_messages.phone_id = phones.id\n      )\n    ) \n    AND \"customer_service_actions\".\"name\" = $5      -- second condition\n  )\n) \nORDER BY \n  customer_service_histories.customer_service_action_id DESC, \n  text_messages.created_at \nDESC LIMIT $6 OFFSET $7  \n[[\"company_id\", 1], [\"item_type\", \"TextMessage\"], [\"company_id\", 1], [\"item_type\", \"TextMessage\"], [\"name\", \"close\"], [\"LIMIT\", 10], [\"OFFSET\", 0]]\n</code></pre>\n\n<p>Maybe there's something in rails that I didn't try, but I feel like I tried a lot of combinations. </p>\n\n<p><strong>String advantages</strong></p>\n\n<p>Anyways, I did benchmark testing by running the queries 1,000 times and found that the string queries were up to 25% faster than the ruby equivalents. In addition, they don't add any unnecessary joins or conditions, which is less work for the database server. I think I'm going to stick with the strings.</p>\n"}], "owner": {"reputation": 2390, "user_id": 4812050, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/hzLjT.jpg?s=128&g=1", "display_name": "Cruz Nunez", "link": "https://stackoverflow.com/users/4812050/cruz-nunez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 57728485, "answer_count": 2, "score": 1, "last_activity_date": 1567535978, "creation_date": 1566832534, "last_edit_date": 1566841081, "question_id": 57660657, "link": "https://stackoverflow.com/questions/57660657/rails-left-joins-eliminate-all-if-associations-if-condition-met", "title": "Rails left_joins eliminate all if associations if condition met", "body": "<p>I have a <code>TextMessage</code> model, which has many histories</p>\n\n<pre><code>class TextMessage &lt; ApplicationRecord\n\n  has_many :histories, class_name: :CustomerServiceHistory, as: :item\n\n  scope :latest_messages, -&gt; {\n      includes(histories: :action, phone: :customer)\n      .where(\"customer_service_actions.name != 'close' OR customer_service_actions.name IS NULL\")\n      .where(\"text_messages.created_at = (SELECT MAX(text_messages.created_at) FROM text_messages WHERE text_messages.phone_id = phones.id)\")\n  }\nend\n</code></pre>\n\n<p>A <code>CustomerServiceHistory</code> belongs to an item (which can be a text message or email). Users can either \"read\" or \"close\" an item. To do that, the <code>CustomerServiceHistory</code> belongs to a user and action (read or close).</p>\n\n<pre><code>class CustomerServiceHistory &lt; ApplicationRecord\n  belongs_to :action, class_name: :CustomerServiceAction,\n                      foreign_key: :customer_service_action_id\n  belongs_to :item, polymorphic: true\n  belongs_to :user\nend\n</code></pre>\n\n<p>I have an index page where I want to load all text messages except those that have been closed. This is where the <code>latest_messages</code> from <code>TextMessage</code> comes in.</p>\n\n<pre><code>.where(\"customer_service_actions.name != 'close' OR customer_service_actions.name IS NULL\")\n</code></pre>\n\n<p>The <code>where(\"customer_service_actions.name != 'close'...</code> will load the text messages that don't have a \"close\" action associated with them.</p>\n\n<p>The <code>... OR customer_service_actions.name IS NULL</code> will load the text messages that don't have any customer_service_actions yet, and are considered \"unread\" to users. </p>\n\n<p>The problem is when a text message has been \"read\" and then \"closed\" by a user, that text message now has two history records on it. </p>\n\n<p>The where clause stops working because it's able to filter out the relationship between this text message and it's 'close' action <em>but not</em> its associations with its 'read' actions. </p>\n\n<p>Also, many users can read a text message. There could be 100 users who read that text message. I want the text message to not load when there is just one \"close\" action on this text message, regardless of how many \"read\" actions there are.</p>\n\n<p>Is this possible to do with just SQL?</p>\n\n<p>Here is my SQL output.</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>SQL (1.0ms)  \nSELECT  DISTINCT \"text_messages\".\"id\", \n  customer_service_histories.customer_service_action_id AS alias_0, \n  text_messages.created_at AS alias_1 \nFROM \"text_messages\" \nLEFT OUTER JOIN \"customer_service_histories\" \n  ON \"customer_service_histories\".\"item_id\" = \"text_messages\".\"id\" \n  AND \"customer_service_histories\".\"item_type\" = $1 \nLEFT OUTER JOIN \"customer_service_actions\" \n  ON \"customer_service_actions\".\"id\" = \"customer_service_histories\".\"customer_service_action_id\" \nLEFT OUTER JOIN \"phones\" \n  ON \"phones\".\"id\" = \"text_messages\".\"phone_id\" \nLEFT OUTER JOIN \"customers\" \n  ON \"customers\".\"id\" = \"phones\".\"customer_id\" \n  AND \"customers\".\"company_id\" = $2 \nWHERE (\n  customer_service_actions.name != 'close' \n  OR customer_service_actions.name IS NULL\n) \nAND (\n  text_messages.created_at = (\n    SELECT MAX(text_messages.created_at) \n    FROM text_messages \n    WHERE text_messages.phone_id = phones.id\n  )\n) \nORDER BY \n  customer_service_histories.customer_service_action_id DESC, \n  text_messages.created_at \nDESC LIMIT $3 OFFSET $4  \n[[\"item_type\", \"TextMessage\"], [\"company_id\", 1], [\"LIMIT\", 10], [\"OFFSET\", 0]]\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "model", "ruby-on-rails-5"], "comments": [{"owner": {"reputation": 553, "user_id": 4742218, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh4.googleusercontent.com/-0wBoIjPuArI/AAAAAAAAAAI/AAAAAAAAAF8/gmwCNq5bAX8/photo.jpg?sz=128", "display_name": "noname", "link": "https://stackoverflow.com/users/4742218/noname"}, "edited": false, "score": 0, "creation_date": 1566831337, "post_id": 57660232, "comment_id": 101769911, "body": "<code>has_one :wahatever_in_here if conditions</code>"}, {"owner": {"reputation": 119, "user_id": 8319323, "user_type": "registered", "profile_image": "https://graph.facebook.com/1344036448998167/picture?type=large", "display_name": "Anatolii Stupin", "link": "https://stackoverflow.com/users/8319323/anatolii-stupin"}, "reply_to_user": {"reputation": 553, "user_id": 4742218, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh4.googleusercontent.com/-0wBoIjPuArI/AAAAAAAAAAI/AAAAAAAAAF8/gmwCNq5bAX8/photo.jpg?sz=128", "display_name": "noname", "link": "https://stackoverflow.com/users/4742218/noname"}, "edited": false, "score": 0, "creation_date": 1566831497, "post_id": 57660232, "comment_id": 101769987, "body": "@noname can you provide example? pls"}, {"owner": {"reputation": 553, "user_id": 4742218, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh4.googleusercontent.com/-0wBoIjPuArI/AAAAAAAAAAI/AAAAAAAAAF8/gmwCNq5bAX8/photo.jpg?sz=128", "display_name": "noname", "link": "https://stackoverflow.com/users/4742218/noname"}, "edited": false, "score": 0, "creation_date": 1566831670, "post_id": 57660232, "comment_id": 101770060, "body": "<code>has_one :vactation, class_name: &#39;Events::Vacations&#39; unless vaction.last_developer_vaction?</code> something like that, just answering question (How to add has_one through relation with condition?), not sure if code work, but you should get an idea"}, {"owner": {"reputation": 119, "user_id": 8319323, "user_type": "registered", "profile_image": "https://graph.facebook.com/1344036448998167/picture?type=large", "display_name": "Anatolii Stupin", "link": "https://stackoverflow.com/users/8319323/anatolii-stupin"}, "reply_to_user": {"reputation": 553, "user_id": 4742218, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh4.googleusercontent.com/-0wBoIjPuArI/AAAAAAAAAAI/AAAAAAAAAF8/gmwCNq5bAX8/photo.jpg?sz=128", "display_name": "noname", "link": "https://stackoverflow.com/users/4742218/noname"}, "edited": false, "score": 0, "creation_date": 1566831926, "post_id": 57660232, "comment_id": 101770174, "body": "@noname I dont understand with your idea how last vacation of a developer will automatically add to person_project obj when obj created with a developer or obj dev attribute was updated"}, {"owner": {"reputation": 553, "user_id": 4742218, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh4.googleusercontent.com/-0wBoIjPuArI/AAAAAAAAAAI/AAAAAAAAAF8/gmwCNq5bAX8/photo.jpg?sz=128", "display_name": "noname", "link": "https://stackoverflow.com/users/4742218/noname"}, "edited": false, "score": 0, "creation_date": 1566832062, "post_id": 57660232, "comment_id": 101770247, "body": "I just give you idea how to put condition into your model, now your job is to figured out the right condition. I will not give you the entire script."}, {"owner": {"reputation": 119, "user_id": 8319323, "user_type": "registered", "profile_image": "https://graph.facebook.com/1344036448998167/picture?type=large", "display_name": "Anatolii Stupin", "link": "https://stackoverflow.com/users/8319323/anatolii-stupin"}, "reply_to_user": {"reputation": 553, "user_id": 4742218, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh4.googleusercontent.com/-0wBoIjPuArI/AAAAAAAAAAI/AAAAAAAAAF8/gmwCNq5bAX8/photo.jpg?sz=128", "display_name": "noname", "link": "https://stackoverflow.com/users/4742218/noname"}, "edited": false, "score": 0, "creation_date": 1566832875, "post_id": 57660232, "comment_id": 101770617, "body": "@noname right condition based on your idea will not give the result that I asked as I understand"}, {"owner": {"reputation": 339, "user_id": 3705088, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/760511451f02c9b65551b912054e8d81?s=128&d=identicon&r=PG&f=1", "display_name": "Doughtz", "link": "https://stackoverflow.com/users/3705088/doughtz"}, "edited": false, "score": 0, "creation_date": 1566833594, "post_id": 57660232, "comment_id": 101770944, "body": "Is there a possibility that the developer will not have had any vacations? Or do you not need to factor that into it? And is there also a DeveloperVacation model?"}, {"owner": {"reputation": 119, "user_id": 8319323, "user_type": "registered", "profile_image": "https://graph.facebook.com/1344036448998167/picture?type=large", "display_name": "Anatolii Stupin", "link": "https://stackoverflow.com/users/8319323/anatolii-stupin"}, "reply_to_user": {"reputation": 339, "user_id": 3705088, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/760511451f02c9b65551b912054e8d81?s=128&d=identicon&r=PG&f=1", "display_name": "Doughtz", "link": "https://stackoverflow.com/users/3705088/doughtz"}, "edited": false, "score": 0, "creation_date": 1566834156, "post_id": 57660232, "comment_id": 101771194, "body": "@Doughtz, yes, developer can have no one vacation, in this case attribute developer_vacation in person_project object must be empty.  about vacation model - it is <code>Events::Vacation</code> model as I mentioned in question post"}], "answers": [{"tags": [], "owner": {"reputation": 13378, "user_id": 1430810, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v669u.jpg?s=128&g=1", "display_name": "arieljuod", "link": "https://stackoverflow.com/users/1430810/arieljuod"}, "is_accepted": false, "score": 0, "last_activity_date": 1566842642, "creation_date": 1566842642, "answer_id": 57662785, "question_id": 57660232, "link": "https://stackoverflow.com/questions/57660232/how-to-add-has-one-through-relation-with-condition/57662785#57662785", "title": "How to add has_one through relation with condition?", "body": "<p>Try adding a scope <a href=\"https://guides.rubyonrails.org/association_basics.html#scopes-for-has-one\" rel=\"nofollow noreferrer\">https://guides.rubyonrails.org/association_basics.html#scopes-for-has-one</a></p>\n\n<p>Something like:</p>\n\n<pre><code>has_one :developer_vacation, -&gt; { order(id: :desc) }, through: ..., class_name: ...\n</code></pre>\n\n<p>I'm not sure, I guess activerecord gets the first one of the scope, it's not clear on the documentation.</p>\n"}], "owner": {"reputation": 119, "user_id": 8319323, "user_type": "registered", "profile_image": "https://graph.facebook.com/1344036448998167/picture?type=large", "display_name": "Anatolii Stupin", "link": "https://stackoverflow.com/users/8319323/anatolii-stupin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 42, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1566842642, "creation_date": 1566830899, "last_edit_date": 1566831565, "question_id": 57660232, "link": "https://stackoverflow.com/questions/57660232/how-to-add-has-one-through-relation-with-condition", "title": "How to add has_one through relation with condition?", "body": "<p>I have a model named PersonProject. This model include next attributes: project_manager, developer, project and developer_vacation. Here is the model code:</p>\n\n<pre><code>class PersonProject &lt; ApplicationRecord\n    belongs_to :project_manager, -&gt; { left_joins(:roles).where(\"roles.name = 'PM'\") }, :class_name =&gt; 'User'\n    belongs_to :developer, -&gt; { left_joins(:roles).where(\"roles.name = 'Developer'\") }, :class_name =&gt; 'User'\n    belongs_to :project\nend\n</code></pre>\n\n<p>Part of User model code for vacations:</p>\n\n<pre><code>class User &lt; ApplicationRecord\n  has_many :vacations, class_name: 'Events::Vacation', inverse_of: :user, dependent: :destroy\nend\n</code></pre>\n\n<p>When creating PersonProject object and add or change developer, I need to automatically add a developer_vacation that must be the last vacation of a developer (developer_instance.vacations.last).</p>\n\n<p>How can I do it?\nThank you in advance.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "activerecord", "rake"], "owner": {"reputation": 4304, "user_id": 1190586, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/fab048d6c3f7059f681e8e9595f05127?s=128&d=identicon&r=PG", "display_name": "fraxture", "link": "https://stackoverflow.com/users/1190586/fraxture"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 42, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1566850293, "creation_date": 1566829167, "last_edit_date": 1566850293, "question_id": 57659742, "link": "https://stackoverflow.com/questions/57659742/can-you-create-item-list-from-active-record-and-use-it-as-a-dependency-for-task", "title": "Can you create item list from active record and use it as a dependency for task?", "body": "<p>Can you create a set of items using active record that serves as a dependency for a task?</p>\n\n<p>What I'm getting at is something like this is example from <a href=\"http://www.virtuouscode.com/2014/04/22/rake-part-2-file-lists/\" rel=\"nofollow noreferrer\">this post</a> by Avid Grimm, except that the <code>source_files</code> variable (or an equivalent) would be populated instead by an Active Record query on a model in a Rails app:</p>\n\n<pre><code>source_files = Rake::FileList.new(\"**/*.md\", \"**/*.markdown\") do |fl|\n  fl.exclude(\"~*\")\n  fl.exclude(/^scratch\\//)\n  fl.exclude do |f|\n    `git ls-files #{f}`.empty?\n  end\nend\n\ntask :default =&gt; :html\ntask :html =&gt; source_files.ext(\".html\")\n\nrule \".html\" =&gt; \".md\" do |t|\n  sh \"pandoc -o #{t.name} #{t.source}\"\nend\n\nrule \".html\" =&gt; \".markdown\" do |t|\n  sh \"pandoc -o #{t.name} #{t.source}\"\nend\n</code></pre>\n\n<p>So what I'm thinking of would be something like this:</p>\n\n<pre><code>items = App::SomeModel.where(...)\n\ntask :some_task =&gt; items\n\nrule /&lt;some-regex-pattern&gt;/ do |t|\n  # does some based on each item in items\nend\n</code></pre>\n\n<p>This seems possible, and seems as though it would appropriately take advantage of Rake's logic, but the barrier I am hitting is that I don't see a good way of populating the <code>item</code> list. I can't seem to call Active Record models in the context of rake task except by using the <code>:environment</code> dependency for a task, but I don't think I can't populate <code>items</code> with a task... </p>\n\n<p>Does anyone know how to go about this? Or is there another better, more idiomatic, way to go about this?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "jwt"], "comments": [{"owner": {"reputation": 553, "user_id": 4742218, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh4.googleusercontent.com/-0wBoIjPuArI/AAAAAAAAAAI/AAAAAAAAAF8/gmwCNq5bAX8/photo.jpg?sz=128", "display_name": "noname", "link": "https://stackoverflow.com/users/4742218/noname"}, "edited": false, "score": 0, "creation_date": 1566830647, "post_id": 57659589, "comment_id": 101769574, "body": "Is that all code you have? I run this on my environment and works fine. So please give more code/context."}, {"owner": {"reputation": 21, "user_id": 7368543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95b4a1a95c925efa2d2fd4ebe2bb15f9?s=128&d=identicon&r=PG&f=1", "display_name": "sahu", "link": "https://stackoverflow.com/users/7368543/sahu"}, "reply_to_user": {"reputation": 553, "user_id": 4742218, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh4.googleusercontent.com/-0wBoIjPuArI/AAAAAAAAAAI/AAAAAAAAAF8/gmwCNq5bAX8/photo.jpg?sz=128", "display_name": "noname", "link": "https://stackoverflow.com/users/4742218/noname"}, "edited": false, "score": 0, "creation_date": 1566840824, "post_id": 57659589, "comment_id": 101773800, "body": "Do you have the same versions which I have? like rails, ruby, and JwT"}, {"owner": {"reputation": 553, "user_id": 4742218, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh4.googleusercontent.com/-0wBoIjPuArI/AAAAAAAAAAI/AAAAAAAAAF8/gmwCNq5bAX8/photo.jpg?sz=128", "display_name": "noname", "link": "https://stackoverflow.com/users/4742218/noname"}, "edited": false, "score": 0, "creation_date": 1566860907, "post_id": 57659589, "comment_id": 101780484, "body": "yes, that why I ask you about more details"}, {"owner": {"reputation": 21, "user_id": 7368543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95b4a1a95c925efa2d2fd4ebe2bb15f9?s=128&d=identicon&r=PG&f=1", "display_name": "sahu", "link": "https://stackoverflow.com/users/7368543/sahu"}, "reply_to_user": {"reputation": 553, "user_id": 4742218, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh4.googleusercontent.com/-0wBoIjPuArI/AAAAAAAAAAI/AAAAAAAAAF8/gmwCNq5bAX8/photo.jpg?sz=128", "display_name": "noname", "link": "https://stackoverflow.com/users/4742218/noname"}, "edited": false, "score": 0, "creation_date": 1566884555, "post_id": 57659589, "comment_id": 101784521, "body": "Thanks for the response.  I am using  - Rails - 5.0.7.2                    - Ruby - 2.5.3                    - JwT - 2.2.1 as I mentioned the above and what are the more details you need?"}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 7368543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95b4a1a95c925efa2d2fd4ebe2bb15f9?s=128&d=identicon&r=PG&f=1", "display_name": "sahu", "link": "https://stackoverflow.com/users/7368543/sahu"}, "edited": false, "score": 0, "creation_date": 1566896847, "post_id": 57670976, "comment_id": 101789828, "body": "You can place intuit-oauth gem before JWT gem. will give you the solution."}], "tags": [], "owner": {"reputation": 21, "user_id": 7368543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95b4a1a95c925efa2d2fd4ebe2bb15f9?s=128&d=identicon&r=PG&f=1", "display_name": "sahu", "link": "https://stackoverflow.com/users/7368543/sahu"}, "is_accepted": false, "score": 1, "last_activity_date": 1566895945, "creation_date": 1566895945, "answer_id": 57670976, "question_id": 57659589, "link": "https://stackoverflow.com/questions/57659589/nomethoderror-undefined-method-encode-for-jsonwebtokenmodule/57670976#57670976", "title": "NoMethodError (undefined method `encode&#39; for JsonWebToken:Module)", "body": "<p>Finally, I found the problem.\nBefore upgrading my rails version I have <strong>JWT</strong> Gem and After I Upgrade my rails version. I added a new gem <strong>intuit-oauth</strong>. This gem has a dependency on json_web_token gem. So after I installed <strong>intuit-oauth</strong> gem, It automatically installed <strong>json_web_token</strong> gem. Due to this gem, the <strong>JWT</strong> object was changed. like when I click on access <strong>JWT</strong> in the console. It returns as <strong>JsonWebToken</strong> object. Maybe this gem overrides <strong>JWT</strong> gem. So for a temporary solution, I removed <strong>intuit-oauth</strong> gem. and it works fine. Thank you.</p>\n"}], "owner": {"reputation": 21, "user_id": 7368543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95b4a1a95c925efa2d2fd4ebe2bb15f9?s=128&d=identicon&r=PG&f=1", "display_name": "sahu", "link": "https://stackoverflow.com/users/7368543/sahu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566895945, "creation_date": 1566828602, "last_edit_date": 1566831682, "question_id": 57659589, "link": "https://stackoverflow.com/questions/57659589/nomethoderror-undefined-method-encode-for-jsonwebtokenmodule", "title": "NoMethodError (undefined method `encode&#39; for JsonWebToken:Module)", "body": "<p>I am facing a problem with JWT gem file after I upgrade my rails version from 4.2 to 5.0.</p>\n\n<p>Can anybody please help me.</p>\n\n<p>I am using Rails - 5.0.7.2\nRuby - 2.5.3\nJwT - 2.2.1</p>\n\n<pre><code>require 'jwt'\n\npayload = { data: 'test' }\n\ntoken = JWT.encode payload, nil, 'none'\n\nTraceback (most recent call last):\n8: from bin/rails:11:in &lt;main&gt;' 7: from bin/rails:11:in require'\n6: from /home/sahu/.rvm/gems/ruby-2.5.3/gems/railties-5.0.7.2/lib/rails/commands.rb:18:in &lt;top (required)&gt;' 5: from /home/sahu/.rvm/gems/ruby-2.5.3/gems/railties-5.0.7.2/lib/rails/commands/commands_tasks.rb:49:in run_command!'\n4: from /home/sahu/.rvm/gems/ruby-2.5.3/gems/railties-5.0.7.2/lib/rails/commands/commands_tasks.rb:78:in console' 3: from /home/sahu/.rvm/gems/ruby-2.5.3/gems/railties-5.0.7.2/lib/rails/commands/console_helper.rb:9:in start'\n2: from /home/sahu/.rvm/gems/ruby-2.5.3/gems/railties-5.0.7.2/lib/rails/commands/console.rb:65:in start' 1: from (irb):3 NoMethodError (undefined method encode' for JsonWebToken:Module)\n</code></pre>\n\n<p>I tried by downgrade the Jwt gem version but still facing same issue.</p>\n\n<p>and also getting warnings like below - </p>\n\n<pre><code>/home/sahu/.rvm/gems/ruby-2.5.3/gems/json_web_token-0.3.5/lib/json_web_token.rb:36: warning: already initialized constant JWT\n/home/sahu/.rvm/gems/ruby-2.5.3/gems/jwt-2.2.1/lib/jwt/base64.rb:5: warning: previous definition of JWT was here\n</code></pre>\n"}, {"tags": ["ruby", "selenium-webdriver", "cucumber", "jenkins-plugins", "watir"], "comments": [{"owner": {"reputation": 14662, "user_id": 3092298, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/70530902b2446a5eccb717b2d21506fb?s=128&d=identicon&r=PG&f=1", "display_name": "Greg Burghardt", "link": "https://stackoverflow.com/users/3092298/greg-burghardt"}, "edited": false, "score": 0, "creation_date": 1566824278, "post_id": 57658109, "comment_id": 101766215, "body": "I&#39;m wondering if the <code>embed</code> method call is to blame. It might need to be <code>embed(image, &#39;image&#47;png&#39;)</code>. I bet it will add the <code>data:image</code> and mime type for you automatically.&quot;"}, {"owner": {"reputation": 313, "user_id": 2695818, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/71321de399d47802a3bc1636d4addc64?s=128&d=identicon&r=PG&f=1", "display_name": "yudi2312", "link": "https://stackoverflow.com/users/2695818/yudi2312"}, "reply_to_user": {"reputation": 14662, "user_id": 3092298, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/70530902b2446a5eccb717b2d21506fb?s=128&d=identicon&r=PG&f=1", "display_name": "Greg Burghardt", "link": "https://stackoverflow.com/users/3092298/greg-burghardt"}, "edited": false, "score": 0, "creation_date": 1566825001, "post_id": 57658109, "comment_id": 101766586, "body": "@GregBurghardt You&#39;re right, I don&#39;t need to add <code>data:image</code> but still it didn&#39;t help. Also, this code work flawlessly when I run it locally."}, {"owner": {"reputation": 1853, "user_id": 8099744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/789f02ce08565883147629e6065606e6?s=128&d=identicon&r=PG&f=1", "display_name": "Sureshmani", "link": "https://stackoverflow.com/users/8099744/sureshmani"}, "edited": false, "score": 0, "creation_date": 1566830682, "post_id": 57658109, "comment_id": 101769596, "body": "I would check where the images are getting saved and check what is the broken link looks like ( view page source)"}, {"owner": {"reputation": 6589, "user_id": 409820, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b01ab32f3a9016b9e2ade35f3aeb4023?s=128&d=identicon&r=PG", "display_name": "Chuck van der Linden", "link": "https://stackoverflow.com/users/409820/chuck-van-der-linden"}, "edited": false, "score": 0, "creation_date": 1566880876, "post_id": 57658109, "comment_id": 101783639, "body": "you may need to modify the jenkins job to save out the screenshot artifacts at the end of the run."}, {"owner": {"reputation": 313, "user_id": 2695818, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/71321de399d47802a3bc1636d4addc64?s=128&d=identicon&r=PG&f=1", "display_name": "yudi2312", "link": "https://stackoverflow.com/users/2695818/yudi2312"}, "reply_to_user": {"reputation": 1853, "user_id": 8099744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/789f02ce08565883147629e6065606e6?s=128&d=identicon&r=PG&f=1", "display_name": "Sureshmani", "link": "https://stackoverflow.com/users/8099744/sureshmani"}, "edited": false, "score": 0, "creation_date": 1566881697, "post_id": 57658109, "comment_id": 101783826, "body": "@Sureshmani when I try to access the .png file in embeddings folder, I get an alert <code>Paint cannot read this file. This is not a valid bitmap file, or it&#39;s format is not currently supported</code>"}, {"owner": {"reputation": 313, "user_id": 2695818, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/71321de399d47802a3bc1636d4addc64?s=128&d=identicon&r=PG&f=1", "display_name": "yudi2312", "link": "https://stackoverflow.com/users/2695818/yudi2312"}, "reply_to_user": {"reputation": 6589, "user_id": 409820, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b01ab32f3a9016b9e2ade35f3aeb4023?s=128&d=identicon&r=PG", "display_name": "Chuck van der Linden", "link": "https://stackoverflow.com/users/409820/chuck-van-der-linden"}, "edited": false, "score": 0, "creation_date": 1566881818, "post_id": 57658109, "comment_id": 101783851, "body": "@ChuckvanderLinden those artifacts are there but unable to view them."}], "answers": [{"tags": [], "owner": {"reputation": 1106, "user_id": 782713, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/20b309cdcea1aa280b617c318af99274?s=128&d=identicon&r=PG", "display_name": "Gijs Paulides", "link": "https://stackoverflow.com/users/782713/gijs-paulides"}, "is_accepted": true, "score": 2, "last_activity_date": 1571736523, "last_edit_date": 1571736523, "creation_date": 1566892999, "answer_id": 57670199, "question_id": 57658109, "link": "https://stackoverflow.com/questions/57658109/cucumber-report-plugin-showing-base64-encoded-image-as-broken-link/57670199#57670199", "title": "Cucumber Report Plugin showing base64 encoded image as broken link", "body": "<p>I believe your code should be as follows:</p>\n\n<pre><code>image = @browser.driver.screenshot_as(:base64)\nembed(image, 'image/png;base64')\n</code></pre>\n\n<p>Some other examples:</p>\n\n<pre><code>Given(\"you have attached 3 files\") do\n  require 'base64'\n  an_image_in_text = 'features/upload-files/base64image.txt'\n  content = File.read(an_image_in_text)\n  embed(content, 'image/png;base64')\n\n  content02 = File.read('my_html_file.html')\n  embed(content02, 'text/html;base64')\n\n  image = File.open('my_image.png', 'rb') do |img|\n      Base64.strict_encode64(img.read)\n    end\n  embed(image, 'image/png;base64')\nend\n</code></pre>\n\n<p><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Complete_list_of_MIME_types\" rel=\"nofollow noreferrer\">More about mime types</a></p>\n\n<p>Hope it helps!</p>\n"}], "owner": {"reputation": 313, "user_id": 2695818, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/71321de399d47802a3bc1636d4addc64?s=128&d=identicon&r=PG&f=1", "display_name": "yudi2312", "link": "https://stackoverflow.com/users/2695818/yudi2312"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 998, "favorite_count": 0, "accepted_answer_id": 57670199, "answer_count": 1, "score": 0, "last_activity_date": 1573753549, "creation_date": 1566823242, "last_edit_date": 1566825632, "question_id": 57658109, "link": "https://stackoverflow.com/questions/57658109/cucumber-report-plugin-showing-base64-encoded-image-as-broken-link", "title": "Cucumber Report Plugin showing base64 encoded image as broken link", "body": "<p>I've an automation suite using Ruby-Cucumber-Watir and I'm trying to execute it from Jenkins on a windows server. Everything is working fine except that the screenshots encoded as base64 are appearing as broken links in Jenkins Cucumber Report. </p>\n\n<p>Cucumber reports plugin - 4.9.0</p>\n\n<p>ruby - 2.6.0p0</p>\n\n<p>Cucumber - 3.1.2</p>\n\n<p>Watir - 6.16.5</p>\n\n<p>Screenshot are displayed correctly when I embed them as a PNG file instead of base64 encoded image. </p>\n\n<p>Below is the code to capture screenshot:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>image = @browser.driver.screenshot_as(:base64)\nembed(\"data:image/png;base64,#{image}\", 'image/png')\n</code></pre>\n\n<p>And I've below in my cucumber.yml file to generate JSON file for cucumber-report plugin:</p>\n\n<pre><code>-f pretty -f json -o results/temp/JSON/results.json\n\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/FzRN0.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/FzRN0.png\" alt=\"This is how it appears\"></a>\nAnd it works fine when I save the file and then embed it as below:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>@browser.screenshot.save 'screenshot.png'\nembed 'screenshot.png', 'image/png'\n</code></pre>\n\n<p>Please not that the code using Base64 works fine when I run it locally. All images are displayed properly in the HTML Report built using <code>report_builder</code> gem.</p>\n"}, {"tags": ["arrays", "ruby", "splat"], "comments": [{"owner": {"reputation": 703, "user_id": 3744443, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/31cd958c40afab1804323dc579eeb4c5?s=128&d=identicon&r=PG&f=1", "display_name": "fidato", "link": "https://stackoverflow.com/users/3744443/fidato"}, "edited": false, "score": 0, "creation_date": 1566817787, "post_id": 57656731, "comment_id": 101763089, "body": "You may use it as num1, num2 = [23, 232]"}, {"owner": {"reputation": 191, "user_id": 10954216, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-j_TFpY8G5D0/AAAAAAAAAAI/AAAAAAAAAMs/8IoTuWwmZbw/photo.jpg?sz=128", "display_name": "Lakhani Aliraza", "link": "https://stackoverflow.com/users/10954216/lakhani-aliraza"}, "reply_to_user": {"reputation": 703, "user_id": 3744443, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/31cd958c40afab1804323dc579eeb4c5?s=128&d=identicon&r=PG&f=1", "display_name": "fidato", "link": "https://stackoverflow.com/users/3744443/fidato"}, "edited": false, "score": 0, "creation_date": 1566818305, "post_id": 57656731, "comment_id": 101763348, "body": "Hey,Thanks for your answer but what if there would have been 100 values in an array"}], "answers": [{"comments": [{"owner": {"reputation": 191, "user_id": 10954216, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-j_TFpY8G5D0/AAAAAAAAAAI/AAAAAAAAAMs/8IoTuWwmZbw/photo.jpg?sz=128", "display_name": "Lakhani Aliraza", "link": "https://stackoverflow.com/users/10954216/lakhani-aliraza"}, "edited": false, "score": 0, "creation_date": 1566818439, "post_id": 57656794, "comment_id": 101763418, "body": "Hey mrzasa,Thanks a lot, Today came to knew *(splat) best use case."}], "tags": [], "owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "is_accepted": true, "score": 5, "last_activity_date": 1566817900, "creation_date": 1566817900, "answer_id": 57656794, "question_id": 57656731, "link": "https://stackoverflow.com/questions/57656731/how-to-convert-45-32-56-or-45-32-56-to-42-32-56/57656794#57656794", "title": "How to convert [45,32,56] or &quot;45,32,56&quot; to 42,32,56?", "body": "<p>Use splat operator (<code>*</code> before the argument) to <a href=\"https://docs.ruby-lang.org/en/2.0.0/syntax/calling_methods_rdoc.html#label-Array+to+Arguments+Conversion\" rel=\"noreferrer\">convert array to arguments</a>:</p>\n\n<pre><code>a={1=&gt;32, 23=&gt;23, 24=&gt;232, 56=&gt;123} \n# =&gt; {1=&gt;32, 23=&gt;23, 24=&gt;232, 56=&gt;123}\nkeys=[23,56]\n# =&gt; [23, 56]\na.values_at(*keys)\n#=&gt; [23, 123]\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://medium.com/@sologoubalex/parameter-with-splat-operator-in-ruby-part-1-2-a1c2176215a5\" rel=\"noreferrer\">https://medium.com/@sologoubalex/parameter-with-splat-operator-in-ruby-part-1-2-a1c2176215a5</a></li>\n</ul>\n"}], "owner": {"reputation": 191, "user_id": 10954216, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-j_TFpY8G5D0/AAAAAAAAAAI/AAAAAAAAAMs/8IoTuWwmZbw/photo.jpg?sz=128", "display_name": "Lakhani Aliraza", "link": "https://stackoverflow.com/users/10954216/lakhani-aliraza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 1, "closed_date": 1566828915, "accepted_answer_id": 57656794, "answer_count": 1, "score": 3, "last_activity_date": 1566818032, "creation_date": 1566817672, "last_edit_date": 1566818032, "question_id": 57656731, "link": "https://stackoverflow.com/questions/57656731/how-to-convert-45-32-56-or-45-32-56-to-42-32-56", "closed_reason": "Duplicate", "title": "How to convert [45,32,56] or &quot;45,32,56&quot; to 42,32,56?", "body": "<p>I have a hash from which I want to get specific keys </p>\n\n<pre><code>a={1=&gt;32, 23=&gt;23, 24=&gt;232, 56=&gt;123} \nkeys=[23,56]\n</code></pre>\n\n<p>To get values of this keys from a{}, I'm using function </p>\n\n<pre><code>a.values_at 23,56 # =&gt; [23, 232]`\n</code></pre>\n\n<p>Problem is how do I convert <code>[23,56....]</code> to <code>23,56</code></p>\n"}, {"tags": ["ruby", "elasticsearch", "logstash"], "comments": [{"owner": {"reputation": 2135, "user_id": 903885, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b0d210e3f23561ab4d5ccb8bdc151c7b?s=128&d=identicon&r=PG", "display_name": "Hasan Can Saral", "link": "https://stackoverflow.com/users/903885/hasan-can-saral"}, "reply_to_user": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1566809482, "post_id": 57654456, "comment_id": 101759060, "body": "@AlekseiMatiushkin Isn&#39;t <code>&quot;key&quot;</code> required?"}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1566810086, "post_id": 57654456, "comment_id": 101759398, "body": "Oh, sorry, I misread how the data is organized. This should do: <code>event.get(&#39;arrayKey&#39;).reject { |h| h[&quot;key&quot;].nil? }</code>"}, {"owner": {"reputation": 2135, "user_id": 903885, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b0d210e3f23561ab4d5ccb8bdc151c7b?s=128&d=identicon&r=PG", "display_name": "Hasan Can Saral", "link": "https://stackoverflow.com/users/903885/hasan-can-saral"}, "reply_to_user": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1566811354, "post_id": 57654456, "comment_id": 101760027, "body": "This didn&#39;t help. Should I maybe set the property of the <code>event</code>? I still have the null values."}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1566811581, "post_id": 57654456, "comment_id": 101760146, "body": "Try <code>event.get(&#39;arrayKey&#39;).reject { |h| h[&quot;key&quot;] == &quot;null&quot; }</code>. I am not familiar with <a href=\"https://stackoverflow.com/questions/tagged/logstash\">logstash</a> syntax, but this way is surely correct."}], "answers": [{"comments": [{"owner": {"reputation": 12074, "user_id": 1985406, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f441bc8d508101ba0a1eac95d6cd52c6?s=128&d=identicon&r=PG", "display_name": "Jordan Kasper", "link": "https://stackoverflow.com/users/1985406/jordan-kasper"}, "edited": false, "score": 2, "creation_date": 1566854226, "post_id": 57660399, "comment_id": 101778747, "body": "Can you please explain your answer? Code-only answers can often be difficult to interpret."}], "tags": [], "owner": {"reputation": 1603, "user_id": 11792977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1e1f56c1d04601beedb913988c13993?s=128&d=identicon&r=PG&f=1", "display_name": "Badger", "link": "https://stackoverflow.com/users/11792977/badger"}, "is_accepted": true, "score": 0, "last_activity_date": 1566910591, "last_edit_date": 1566910591, "creation_date": 1566831515, "answer_id": 57660399, "question_id": 57654456, "link": "https://stackoverflow.com/questions/57654456/logstash-filter-out-values-with-null-values-for-a-key-in-a-nested-json-array/57660399#57660399", "title": "Logstash filter out values with null values for a key in a nested json array", "body": "<p>As Aleksei pointed out, you can create a copy of the array that does not contain entries where [key] is null using reject. You have to use event.set to overwrite the inital value of [arrayKey]</p>\n\n<pre><code>    ruby {\n        code =&gt; '\n            a = event.get(\"arrayKey\")\n            if a\n                event.set(\"arrayKey\", a.reject { |x| x[\"key\"] == nil })\n            end\n        '\n    }\n</code></pre>\n"}], "owner": {"reputation": 2135, "user_id": 903885, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b0d210e3f23561ab4d5ccb8bdc151c7b?s=128&d=identicon&r=PG", "display_name": "Hasan Can Saral", "link": "https://stackoverflow.com/users/903885/hasan-can-saral"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 57660399, "answer_count": 1, "score": 1, "last_activity_date": 1566910591, "creation_date": 1566808652, "question_id": 57654456, "link": "https://stackoverflow.com/questions/57654456/logstash-filter-out-values-with-null-values-for-a-key-in-a-nested-json-array", "title": "Logstash filter out values with null values for a key in a nested json array", "body": "<p>I have quite an extensive Logstash pipeline ending in a Json as such:</p>\n\n<pre><code>{\n    \"keyA\": 1,\n    \"keyB\": \"sample\",\n    \"arrayKey\": [\n        {\n            \"key\": \"data\"\n        },\n        {\n            \"key\": null\n        }\n    ]\n}\n</code></pre>\n\n<p>What I want to achieve is to filter <code>\"arrayKey\"</code> and remove objects within with value for <code>\"key\"</code> is <code>null</code>.</p>\n\n<p>Tried this to no luck:</p>\n\n<pre><code>filter {\n    ruby {\n      code =&gt; \"\n        event.get('arrayKey').each do |key|\n          [key].delete_if do |keyCandidate|\n            if [keyCandidate][key] != nil\n              true\n            end\n          end\n        end\n      \"\n    }\n}\n</code></pre>\n\n<p>This gives no implicit converter found from |hash|:|Int| error. How do I achieve this? Is there and easier way to do this?</p>\n"}, {"tags": ["ruby"], "answers": [{"comments": [{"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 1, "creation_date": 1566809962, "post_id": 57654616, "comment_id": 101759337, "body": "Slightly incorrect. <code>1 + age *= 2</code> is definitely what sees a parser (MRI <code>parse.y:new_op_assign</code>). The parser just happens to generate the same bytecode as <code>1 + age = age * 2</code>. +1 for the rest."}, {"owner": {"reputation": 559, "user_id": 450216, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1db845bc44e084526fd8a2b58a312cf?s=128&d=identicon&r=PG", "display_name": "No Ordinary Love", "link": "https://stackoverflow.com/users/450216/no-ordinary-love"}, "edited": false, "score": 0, "creation_date": 1566809980, "post_id": 57654616, "comment_id": 101759348, "body": "Yeah that official one also lists the binary operators as having higher precedence than the compound assignment operators. Ruby will forever amaze me."}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "reply_to_user": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 0, "creation_date": 1566810236, "post_id": 57654616, "comment_id": 101759467, "body": "@Amadan well, correct. I meant \u201cthe <i>thing</i> that in MRI does a real execution.\u201d"}, {"owner": {"reputation": 559, "user_id": 450216, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1db845bc44e084526fd8a2b58a312cf?s=128&d=identicon&r=PG", "display_name": "No Ordinary Love", "link": "https://stackoverflow.com/users/450216/no-ordinary-love"}, "edited": false, "score": 0, "creation_date": 1566810343, "post_id": 57654616, "comment_id": 101759513, "body": "@AlekseiMatiushkin Ok given that the syntactic sugar expands to <code>1 + age = age * 2</code>. How does it get parenthesized and evaluated then?"}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 3, "creation_date": 1566810470, "post_id": 57654616, "comment_id": 101759564, "body": "As it\u2019s clearly stated in my answer, Ruby attempts <code>(1 + age) = ...</code>, fails to parse the syntactically correct expression (LHO is invalid,) and then tries <code>1 + (age = ...)</code> successfully."}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1566812838, "post_id": 57654616, "comment_id": 101760789, "body": "&quot;The code <code>1 + age *= 2</code> cannot be parenthesized in any way, because it\u2019s not what sees a parser; it\u2019s <i>syntactic sugar</i> for&quot; \u2013 Do you have any source for that statement? Preferably from the ISO Ruby Language Specification, the Ruby Spec, or <i>The Ruby Programming Language</i> book? I mean, how is the parser supposed to desugar the expression without parsing it? The parser <i>must</i> parse <code>a *= b</code> because how else would it know to desugar it to <code>a = a * b</code> and not say <code>a = a + b</code> without parsing it? Also, if the compound assignment operators are never parsed, then why are they documented in the \u2026"}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1566812911, "post_id": 57654616, "comment_id": 101760831, "body": "\u2026 operator precedence table?"}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 1, "creation_date": 1566812964, "post_id": 57654616, "comment_id": 101760866, "body": "&quot;I am not sure what \u201cmany Ruby documentations\u201d you mentioned, here is the <a href=\"https://ruby-doc.org/core/doc/syntax/precedence_rdoc.html\" rel=\"nofollow noreferrer\">official one</a>.&quot; \u2013 That just shows the exact same thing the OP has been saying: that compound assignment has lower precedence than arithmetic, which is precisely the point of this question."}, {"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "reply_to_user": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1566812989, "post_id": 57654616, "comment_id": 101760881, "body": "@J&#246;rgWMittag He clarified a couple of comments up that he actually meant VM (&quot;the <i>thing</i> that in MRI does a real execution&quot;), not parser. Though I&#39;d prefer it be changed in the answer :)"}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1566813065, "post_id": 57654616, "comment_id": 101760923, "body": "&quot;Also, Ruby parser does it\u2019s best to understand and successfully parse the input; when it sees a syntax error, it tries another way.&quot; \u2013 Do you have any source for that statement? Preferably from the ISO Ruby Language Specification, the Ruby Spec, or <i>The Ruby Programming Language</i> book? This is the first time I ever hear about this rule. The only language I know which has some kind of rule like that, is ECMAScript&#39;s <i>Automatic Semicolon Insertion</i> rule, which indeed requires that the code without the semicolon be syntactically illegal."}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "reply_to_user": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 0, "creation_date": 1566813155, "post_id": 57654616, "comment_id": 101760975, "body": "@Amadan: Then I am even more confused, since the question is about the syntax and grammar, not the semantics, so the evaluator is <i>completely and utterly irrelevant</i> to the question. The VM doesn&#39;t even know about Ruby at all, it only knows about YARV bytecode which is a different language than Ruby."}, {"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "reply_to_user": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 1, "creation_date": 1566814808, "post_id": 57654616, "comment_id": 101761719, "body": "@J&#246;rgWMittag: You&#39;re quite right, I retract my +1. Ruby uses Bison, a LALR(1) parser - it can&#39;t do what Aleksei says it does."}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1566815466, "post_id": 57654616, "comment_id": 101762029, "body": "If I am not mistaken <a href=\"https://github.com/ruby/ruby/blob/trunk/parse.y#L9026\" rel=\"nofollow noreferrer\">this branch of the code</a> hets executed when it sees <code>+</code>. That in turn routes to <a href=\"https://github.com/ruby/ruby/blob/trunk/parse.y#L7875\" rel=\"nofollow noreferrer\"><code>dispatch2</code></a> which ecaluates RHO first."}, {"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 0, "creation_date": 1566818165, "post_id": 57654616, "comment_id": 101763261, "body": "That cannot happen, the branch you linked to is Ripper-only."}], "tags": [], "owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "is_accepted": false, "score": 5, "last_activity_date": 1566878347, "last_edit_date": 1566878347, "creation_date": 1566809332, "answer_id": 57654616, "question_id": 57654434, "link": "https://stackoverflow.com/questions/57654434/why-is-a-statement-like-1-n-3-allowed-in-ruby/57654616#57654616", "title": "Why is a statement like 1 + n *= 3 allowed in Ruby?", "body": "<p><strong>NB This answer should not be marked as solving the issue. See the answer by @Amadan for the correct explanation.</strong> </p>\n\n<p>I am not sure what \u201cmany Ruby documentations\u201d you mentioned, here is the <a href=\"https://ruby-doc.org/core/doc/syntax/precedence_rdoc.html\" rel=\"nofollow noreferrer\">official one</a>.</p>\n\n<p>Ruby parser does its best to understand and successfully parse the input; when it sees a syntax error, it tries another way. That said, syntax errors have greater precedence compared to <em>all</em> operator precedence rules.</p>\n\n<p>Since LHO must be variable, it starts with <em>an assignment</em>. Here is the case when the parsing <em>can</em> be done with a default precedence order and <code>+</code> is done before <code>*=</code>:</p>\n\n<pre><code>age = 2\nage *= age + 1\n#\u21d2 6\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 1, "creation_date": 1566813283, "post_id": 57655323, "comment_id": 101761033, "body": "&quot;Ruby has 3 phases before your code is actually executed.  &gt; Parse -&gt; Tokenize -&gt; Compile&quot; \u2013 Like every other parser in the history of computing, tokenization (aka lexical analysis aka scanning) happens <i>before</i> parsing (aka syntactic analysis), with the exception of scannerless parsers that don&#39;t do tokenization / lexing / scanning at all."}], "tags": [], "owner": {"reputation": 14827, "user_id": 645886, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2abb0123e9484284a9cb2d36aa9854b3?s=128&d=identicon&r=PG&f=1", "display_name": "Surya", "link": "https://stackoverflow.com/users/645886/surya"}, "is_accepted": false, "score": 4, "last_activity_date": 1566813586, "last_edit_date": 1566813586, "creation_date": 1566812182, "answer_id": 57655323, "question_id": 57654434, "link": "https://stackoverflow.com/questions/57654434/why-is-a-statement-like-1-n-3-allowed-in-ruby/57655323#57655323", "title": "Why is a statement like 1 + n *= 3 allowed in Ruby?", "body": "<p>Ruby has 3 phases before your code is actually executed.</p>\n\n<blockquote>\n  <p>Tokenize -> Parse -> Compile</p>\n</blockquote>\n\n<p>Let's look at the AST(Abstract Syntax Tree) Ruby generates which is the parse phase.</p>\n\n<pre><code># @ NODE_SCOPE (line: 1, location: (1,0)-(1,12))\n# | # new scope\n# | # format: [nd_tbl]: local table, [nd_args]: arguments, [nd_body]: body\n# +- nd_tbl (local table): :age\n# +- nd_args (arguments):\n# |   (null node)\n# +- nd_body (body):\n#     @ NODE_OPCALL (line: 1, location: (1,0)-(1,12))*\n#     | # method invocation\n#     | # format: [nd_recv] [nd_mid] [nd_args]\n#     | # example: foo + bar\n#     +- nd_mid (method id): :+\n#     +- nd_recv (receiver):\n#     |   @ NODE_LIT (line: 1, location: (1,0)-(1,1))\n#     |   | # literal\n#     |   | # format: [nd_lit]\n#     |   | # example: 1, /foo/\n#     |   +- nd_lit (literal): 1\n#     +- nd_args (arguments):\n#         @ NODE_ARRAY (line: 1, location: (1,4)-(1,12))\n#         | # array constructor\n#         | # format: [ [nd_head], [nd_next].. ] (length: [nd_alen])\n#         | # example: [1, 2, 3]\n#         +- nd_alen (length): 1\n#         +- nd_head (element):\n#         |   @ NODE_DASGN_CURR (line: 1, location: (1,4)-(1,12))\n#         |   | # dynamic variable assignment (in current scope)\n#         |   | # format: [nd_vid](current dvar) = [nd_value]\n#         |   | # example: 1.times { x = foo }\n#         |   +- nd_vid (local variable): :age\n#         |   +- nd_value (rvalue):\n#         |       @ NODE_CALL (line: 1, location: (1,4)-(1,12))\n#         |       | # method invocation\n#         |       | # format: [nd_recv].[nd_mid]([nd_args])\n#         |       | # example: obj.foo(1)\n#         |       +- nd_mid (method id): :*\n#         |       +- nd_recv (receiver):\n#         |       |   @ NODE_DVAR (line: 1, location: (1,4)-(1,7))\n#         |       |   | # dynamic variable reference\n#         |       |   | # format: [nd_vid](dvar)\n#         |       |   | # example: 1.times { x = 1; x }\n#         |       |   +- nd_vid (local variable): :age\n#         |       +- nd_args (arguments):\n#         |           @ NODE_ARRAY (line: 1, location: (1,11)-(1,12))\n#         |           | # array constructor\n#         |           | # format: [ [nd_head], [nd_next].. ] (length: [nd_alen])\n#         |           | # example: [1, 2, 3]\n#         |           +- nd_alen (length): 1\n#         |           +- nd_head (element):\n#         |           |   @ NODE_LIT (line: 1, location: (1,11)-(1,12))\n#         |           |   | # literal\n#         |           |   | # format: [nd_lit]\n#         |           |   | # example: 1, /foo/\n#         |           |   +- nd_lit (literal): 2\n#         |           +- nd_next (next element):\n#         |               (null node)\n#         +- nd_next (next element):\n#             (null node)\n</code></pre>\n\n<p>As you can see <code>#     +- nd_mid (method id): :+</code> where <code>1</code> is treated as the receiver and everything on the right as arguments. Now, it goes further and does its best to evaluate the arguments. </p>\n\n<p>To further support Aleksei's great answer. The <code>@ NODE_DASGN_CURR (line: 1, location: (1,4)-(1,12))</code> is the assignment on <code>age</code> as a local variable as it decodes it as <code>age = age * 2</code>, which is why <code>+- nd_mid (method id): :*</code> is treated as the operation on <code>age</code> as the receiver and <code>2</code> as its argument.</p>\n\n<p>Now when it goes on to compile it tries as operation: <code>age * 2</code> where <code>age</code> is nil because it already parsed it as a local variable with no pre-assigned value, raises exception <code>undefined method '*' for nil:NilClass (NoMethodError)</code>.</p>\n\n<p>It works the way it did is cause any operation on the receiver must have an evaluated argument from the RHO.</p>\n"}, {"comments": [{"owner": {"reputation": 32193, "user_id": 2908724, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/1xBJR.png?s=128&g=1", "display_name": "bishop", "link": "https://stackoverflow.com/users/2908724/bishop"}, "edited": false, "score": 0, "creation_date": 1566843497, "post_id": 57657188, "comment_id": 101774849, "body": "See also <a href=\"https://www.gnu.org/software/bison/manual/html_node/LR-Table-Construction.html#LR-Table-Construction\" rel=\"nofollow noreferrer\">gnu.org/software/bison/manual/html_node/&hellip;</a>"}, {"owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "edited": false, "score": 0, "creation_date": 1566986186, "post_id": 57657188, "comment_id": 101823973, "body": "<a href=\"https://meta.stackexchange.com/questions/137120/tldr-summaries-at-the-top-of-question\">Shouldn&#39;t the TL;DR be at the top of the answer?</a>"}], "tags": [], "owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "is_accepted": true, "score": 24, "last_activity_date": 1566819355, "creation_date": 1566819355, "answer_id": 57657188, "question_id": 57654434, "link": "https://stackoverflow.com/questions/57654434/why-is-a-statement-like-1-n-3-allowed-in-ruby/57657188#57657188", "title": "Why is a statement like 1 + n *= 3 allowed in Ruby?", "body": "<p>Checking <code>ruby -y</code> output, you can see exactly what is happening. Given the source of <code>1 + age *= 2</code>, the output suggests this happens (simplified):</p>\n\n<p><code>tINTEGER</code> found, recognised as <code>simple_numeric</code>, which is a <code>numeric</code>, which is a <code>literal</code>, which is a <code>primary</code>. Knowing that <code>+</code> comes next, <code>primary</code> is recognised as <code>arg</code>.</p>\n\n<p><code>+</code> found. Can't deal yet.</p>\n\n<p><code>tIDENTIFIER</code> found. Knowing that next token is <code>tOP_ASGN</code> (operator-assignment), <code>tIDENTIFIER</code> is recognised as <code>user_variable</code>, and then as <code>var_lhs</code>.</p>\n\n<p><code>tOP_ASGN</code> found. Can't deal yet.</p>\n\n<p><code>tINTEGER</code> found. Same as last one, it is ultimately recognised as <code>primary</code>. Knowing that next token is <code>\\n</code>, <code>primary</code> is recognised as <code>arg</code>.</p>\n\n<p>At this moment we have <code>arg + var_lhs tOP_ASGN arg</code> on stack. In this context, we recognise the last <code>arg</code> as <code>arg_rhs</code>. We can now pop <code>var_lhs tOP_ASGN arg_rhs</code> from stack and recognise it as <code>arg</code>, with stack ending up as <code>arg + arg</code>, which can be reduced to <code>arg</code>.</p>\n\n<p><code>arg</code> is then recognised as <code>expr</code>, <code>stmt</code>, <code>top_stmt</code>, <code>top_stmts</code>. <code>\\n</code> is recognised as <code>term</code>, then <code>terms</code>, then <code>opt_terms</code>. <code>top_stmts opt_terms</code> are recognised as <code>top_compstmt</code>, and ultimately <code>program</code>.</p>\n\n<hr>\n\n<p>On the other hand, given the source <code>1 + age * 2</code>, this happens:</p>\n\n<p><code>tINTEGER</code> found, recognised as <code>simple_numeric</code>, which is a <code>numeric</code>, which is a <code>literal</code>, which is a <code>primary</code>. Knowing that <code>+</code> comes next, <code>primary</code> is recognised as <code>arg</code>.</p>\n\n<p><code>+</code> found. Can't deal yet.</p>\n\n<p><code>tIDENTIFIER</code> found. Knowing that next token is <code>*</code>, <code>tIDENTIFIER</code> is recognised as <code>user_variable</code>, then <code>var_ref</code>, then <code>primary</code>, and <code>arg</code>. </p>\n\n<p><code>*</code> found. Can't deal yet.</p>\n\n<p><code>tINTEGER</code> found. Same as last one, it is ultimately recognised as <code>primary</code>. Knowing that next token is <code>\\n</code>, <code>primary</code> is recognised as <code>arg</code>.</p>\n\n<p>The stack is now <code>arg + arg * arg</code>. <code>arg * arg</code> can be reduced to <code>arg</code>, and the resultant <code>arg + arg</code> can also be reduced to <code>arg</code>.</p>\n\n<p><code>arg</code> is then recognised as <code>expr</code>, <code>stmt</code>, <code>top_stmt</code>, <code>top_stmts</code>. <code>\\n</code> is recognised as <code>term</code>, then <code>terms</code>, then <code>opt_terms</code>. <code>top_stmts opt_terms</code> are recognised as <code>top_compstmt</code>, and ultimately <code>program</code>.</p>\n\n<hr>\n\n<p>What's the critical difference? In the first piece of code, <code>age</code> (a <code>tIDENTIFIER</code>) is recognised as <code>var_lhs</code> (left-hand-side of assignment), but in the second one, it's <code>var_ref</code> (a variable reference). Why? Because Bison is a LALR(1) parser, meaning that it has one-token look-ahead. So <code>age</code> is <code>var_lhs</code> because Ruby saw <code>tOP_ASGN</code> coming up; and it was <code>var_ref</code> when it saw <code>*</code>. This comes about because Ruby knows (using the huge <a href=\"https://www.cs.uic.edu/~spopuri/cparser.html#bison-tables\" rel=\"noreferrer\">state transition table</a> that Bison generates) that one specific production is impossible. Specifically, at this time, the stack is <code>arg + tIDENTIFIER</code>, and next token is <code>*=</code>. If <code>tIDENTIFIER</code> is recognised as <code>var_ref</code> (which leads up to <code>arg</code>), and <code>arg + arg</code> reduced to <code>arg</code>, then there is no rule that starts with <code>arg tOP_ASGN</code>; thus, <code>tIDENTIFIER</code> cannot be allowed to become <code>var_ref</code>, and we look at the next matching rule (the <code>var_lhs</code> one).</p>\n\n<p>So Aleksei is partly right in that there is <em>some</em> truth to \"when it sees a syntax error, it tries another way\", but it is limited to one token into future, and the \"attempt\" is just a lookup in the state table. Ruby is incapable of complex repair strategies we humans use to understand sentences like <a href=\"https://en.wikipedia.org/wiki/Garden-path_sentence\" rel=\"noreferrer\">\"the horse raced past the barn fell\"</a>, where we happily parse till the last word, then reevaluate the whole sentence when the first parse turns out impossible.</p>\n\n<p>tl;dr: The precedence table is not exactly correct. There is no place in Ruby source where it exists; rather, it is the result of the interplay of various parsing rules. Many of the precedence rules break in when left-hand-side of an assignment is introduced.</p>\n"}, {"tags": [], "owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "is_accepted": false, "score": 9, "last_activity_date": 1566871111, "last_edit_date": 1566871111, "creation_date": 1566824525, "answer_id": 57658440, "question_id": 57654434, "link": "https://stackoverflow.com/questions/57654434/why-is-a-statement-like-1-n-3-allowed-in-ruby/57658440#57658440", "title": "Why is a statement like 1 + n *= 3 allowed in Ruby?", "body": "<p>The simplified answer is. You can only assign a value to a variable, not to an expression. Therefore the order is <code>1 + (age *= 2)</code>. The precedence only comes into play if multiple options are possible. For example <code>age *= 2 + 1</code> can be seen as <code>(age *= 2) + 1</code> or <code>age *= (2 + 1)</code>, since multiple options are possible and the <code>+</code> has a higher precedence than <code>*=</code>, <code>age *= (2 + 1)</code> is used.</p>\n"}], "owner": {"reputation": 559, "user_id": 450216, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1db845bc44e084526fd8a2b58a312cf?s=128&d=identicon&r=PG", "display_name": "No Ordinary Love", "link": "https://stackoverflow.com/users/450216/no-ordinary-love"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1870, "favorite_count": 1, "accepted_answer_id": 57657188, "answer_count": 4, "score": 23, "last_activity_date": 1566878347, "creation_date": 1566808562, "question_id": 57654434, "link": "https://stackoverflow.com/questions/57654434/why-is-a-statement-like-1-n-3-allowed-in-ruby", "title": "Why is a statement like 1 + n *= 3 allowed in Ruby?", "body": "<p>The precedence tables in many Ruby documentations out there list binary arithmetic operations as having higher precedence than their corresponding compound assignment operators. This leads me to believe that code like this shouldn't be valid Ruby code, yet it is.</p>\n\n<pre><code>1 + age *= 2\n</code></pre>\n\n<p>If the precedence rules were correct, I'd expect that the above code would be parenthesized like this:</p>\n\n<pre><code>((1 + age) *= 2) #ERROR: Doesn't compile\n</code></pre>\n\n<p>But it doesn't.</p>\n\n<p>So what gives?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "google-app-engine", "google-cloud-platform", "bundler"], "comments": [{"owner": {"reputation": 24560, "user_id": 4880924, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d40e83be235d4f70428da0d42e12d427?s=128&d=identicon&r=PG&f=1", "display_name": "BKSpurgeon", "link": "https://stackoverflow.com/users/4880924/bkspurgeon"}, "edited": false, "score": 0, "creation_date": 1566817549, "post_id": 57653432, "comment_id": 101762963, "body": "Surely there&#39;s a front end that allows you to manually cut and paste that variable? Heroku allows you to do it, so likely there&#39;s a way in Google as well. I can&#39;t help you on the actual error you are facing though."}], "answers": [{"tags": [], "owner": {"reputation": 649, "user_id": 9054282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f34fa84b9c668d632da5c4c3937325bd?s=128&d=identicon&r=PG", "display_name": "Harif Velarde", "link": "https://stackoverflow.com/users/9054282/harif-velarde"}, "is_accepted": false, "score": 2, "last_activity_date": 1566847850, "creation_date": 1566847850, "answer_id": 57663875, "question_id": 57653432, "link": "https://stackoverflow.com/questions/57653432/secure-configuration-in-rails-6-app-on-app-engine-standard-ruby-2-5/57663875#57663875", "title": "Secure configuration in Rails 6 app on App Engine Standard Ruby 2.5", "body": "<p>According to the documentation [1], the only alternative to declare environment variables in App Engine standard is through the app.yaml file.</p>\n\n<p>Nevertheless, this tutorial use Cloud Build to add environmental variables to Node JS project[2] maybe this option could apply for Ruby too.</p>\n\n<p>Another options for setting environment variables not using only app.yaml are available on Node JS [3] and Python [4].</p>\n\n<p>[1] <a href=\"https://cloud.google.com/appengine/docs/standard/ruby/configuring-your-app-with-app-yaml\" rel=\"nofollow noreferrer\">https://cloud.google.com/appengine/docs/standard/ruby/configuring-your-app-with-app-yaml</a></p>\n\n<p>[2] <a href=\"https://medium.com/@brian.young.pro/how-to-add-environmental-variables-to-google-app-engine-node-js-using-cloud-build-5ce31ee63d7\" rel=\"nofollow noreferrer\">https://medium.com/@brian.young.pro/how-to-add-environmental-variables-to-google-app-engine-node-js-using-cloud-build-5ce31ee63d7</a></p>\n\n<p>[3] <a href=\"https://cloud.google.com/appengine/docs/standard/nodejs/configuring-your-app-with-app-yaml\" rel=\"nofollow noreferrer\">https://cloud.google.com/appengine/docs/standard/nodejs/configuring-your-app-with-app-yaml</a></p>\n\n<p>[4] <a href=\"https://cloud.google.com/python/setup\" rel=\"nofollow noreferrer\">https://cloud.google.com/python/setup</a></p>\n"}, {"comments": [{"owner": {"reputation": 1049, "user_id": 204000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fd982df89c3c697c487514796393bc5?s=128&d=identicon&r=PG", "display_name": "Casper Fabricius", "link": "https://stackoverflow.com/users/204000/casper-fabricius"}, "edited": false, "score": 0, "creation_date": 1567071901, "post_id": 57687687, "comment_id": 101856982, "body": "Thanks, I can confirm that this fixes the issue for me."}, {"owner": {"reputation": 769, "user_id": 782004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0MtM7.jpg?s=128&g=1", "display_name": "Daniel Azuma", "link": "https://stackoverflow.com/users/782004/daniel-azuma"}, "edited": false, "score": 1, "creation_date": 1567093960, "post_id": 57687687, "comment_id": 101869732, "body": "rcloadenv 0.2.1 has just been released, and should resolve the permission issue. Sorry about that."}], "tags": [], "owner": {"reputation": 1040, "user_id": 11135159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fcb3b536ae330b4e19e8359824aef583?s=128&d=identicon&r=PG&f=1", "display_name": "Pawel Czuczwara", "link": "https://stackoverflow.com/users/11135159/pawel-czuczwara"}, "is_accepted": true, "score": 4, "last_activity_date": 1566979595, "creation_date": 1566979595, "answer_id": 57687687, "question_id": 57653432, "link": "https://stackoverflow.com/questions/57653432/secure-configuration-in-rails-6-app-on-app-engine-standard-ruby-2-5/57687687#57687687", "title": "Secure configuration in Rails 6 app on App Engine Standard Ruby 2.5", "body": "<p>It is permission error to read the file in the gem release 0.2.0 itself.\nWorkaround is to install rcloadenv directly from GitHub, you can do it by replacing gem in gemfile with this line:</p>\n\n<pre><code>gem \"rcloadenv\", git: 'https://github.com/GoogleCloudPlatform/rcloadenv', branch: 'master', glob: 'ruby/*.gemspec'\n</code></pre>\n\n<p>Workaround using metadata will not work in AppEngine Standard.</p>\n"}], "owner": {"reputation": 1049, "user_id": 204000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fd982df89c3c697c487514796393bc5?s=128&d=identicon&r=PG", "display_name": "Casper Fabricius", "link": "https://stackoverflow.com/users/204000/casper-fabricius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 517, "favorite_count": 0, "accepted_answer_id": 57687687, "answer_count": 2, "score": 4, "last_activity_date": 1566979595, "creation_date": 1566804145, "question_id": 57653432, "link": "https://stackoverflow.com/questions/57653432/secure-configuration-in-rails-6-app-on-app-engine-standard-ruby-2-5", "title": "Secure configuration in Rails 6 app on App Engine Standard Ruby 2.5", "body": "<p>I'm deploying a vanilla Rails 6 app to the App Engine Standard Ruby 2.5 runtime on Google Cloud.</p>\n\n<p>I'm having trouble figuring out how successfully provide the RAILS_MASTER_KEY environment variable so Rails can decrypt my encrypted credentials for connecting the the database etc.</p>\n\n<p>I don't want to put the RAILS_MASTER_KEY in app.yaml, and I don't want to have to include the master.key file in every deploy. As you may know, the RAILS_MASTER_KEY environment variable must be set before Rails is started, so loading it from inside my app is not an option.</p>\n\n<p>In my Rails apps on App Engine Flex, I've been using Runtime Config and the rcloadenv gem by having this in my app.yaml:\nentrypoint:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>bundle exec rcloadenv secrets -- bin/rails s\n</code></pre>\n\n<p>But when I do the same on App Engine Standard, I get the this error:</p>\n\n<pre><code>A 2019-08-23T11:47:45.986319Z   /srv/vendor/bundle/ruby/2.5.0/bin/rcloadenv:23:in `load' \nA 2019-08-23T11:47:45.986308Z LoadError: cannot load such file -- /srv/vendor/bundle/ruby/2.5.0/gems/rcloadenv-0.2.0/bin/rcloadenv \nA 2019-08-23T11:47:45.986247Z bundler: failed to load command: rcloadenv (/srv/vendor/bundle/ruby/2.5.0/bin/rcloadenv) \n</code></pre>\n\n<p>I see that the getting started document recommends using Metadata server and the google-cloud-env gem, but I don't see anything built into that gem to make it load the metadata as environment variables.</p>\n\n<p>Any pointers on how I, on App Engine Standard for Ruby 2.5:</p>\n\n<p>1) Can get the rcloadenv gem to work?</p>\n\n<p>2) Or can get the google-cloud-env gem to load metadata into environment variables?</p>\n\n<p>3) Or can safely store and access the RAILS_MASTER_KEY in another way that Rails 6 supports?</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 2, "creation_date": 1566800610, "post_id": 57652654, "comment_id": 101755504, "body": "When <code>do_something_private</code> is invoked <code>self</code> is <code>MyClass</code>, but there is no (class) method <code>MyClass::do_something_private</code>, hence the error message."}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 2, "creation_date": 1566800615, "post_id": 57652654, "comment_id": 101755507, "body": "Your <code>do_something_private</code> is an instance method."}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 4, "creation_date": 1566800674, "post_id": 57652654, "comment_id": 101755530, "body": "<i>\u201cwhat is the right way to define private methods which could be called from inside of class methods?\u201d</i> one cannot call instance methods from class methods for the obvious reason, despite whether they are private, public, or whatever."}, {"owner": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "edited": false, "score": 0, "creation_date": 1566801781, "post_id": 57652654, "comment_id": 101755886, "body": "This isn&#39;t really a &quot;singleton method&quot;, it&#39;s a class method. Yes, instance methods on the class&#39; singleton class are the same as class methods, but these are not usually referred to as &quot;singleton methods&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 6, "creation_date": 1566802366, "post_id": 57652770, "comment_id": 101756086, "body": "Note that <code>private</code> doesn&#39;t do anything for class methods, it only makes instance methods private. You need <code>private_class_method def self.do_something_private ...</code> instead."}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 2, "creation_date": 1566808103, "post_id": 57652770, "comment_id": 101758445, "body": "Or you can define the class method as an instance method within <code>class &lt;&lt; self</code> where <code>private</code> works as expected."}], "tags": [], "owner": {"reputation": 14827, "user_id": 645886, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2abb0123e9484284a9cb2d36aa9854b3?s=128&d=identicon&r=PG&f=1", "display_name": "Surya", "link": "https://stackoverflow.com/users/645886/surya"}, "is_accepted": false, "score": 3, "last_activity_date": 1566802966, "last_edit_date": 1566802966, "creation_date": 1566800901, "answer_id": 57652770, "question_id": 57652654, "link": "https://stackoverflow.com/questions/57652654/accessing-private-methods-inside-a-singleton-class-methods-in-ruby/57652770#57652770", "title": "Accessing private methods inside a singleton class methods in Ruby", "body": "<p>That's because <code>do_something_private</code> is defined as the instance method of <code>MyClass</code>. Change it to the class method:</p>\n\n<pre><code>def self.do_something_private\n  # do something private\nend\n</code></pre>\n\n<p>Worth reading the note from <a href=\"https://stackoverflow.com/users/240443/amadan\">@Amadan</a> in <a href=\"https://stackoverflow.com/questions/57652654/accessing-private-methods-inside-a-singleton-class-methods-in-ruby/57652770?noredirect=1#comment101756086_57652770\">comments</a>: </p>\n\n<blockquote>\n  <p>Note that private doesn't do anything for class methods, it only makes instance methods private. You need private_class_method def self.do_something_private ... instead.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 358, "user_id": 8708097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/APLHT.jpg?s=128&g=1", "display_name": "Saif chaudhry", "link": "https://stackoverflow.com/users/8708097/saif-chaudhry"}, "is_accepted": false, "score": -1, "last_activity_date": 1566804117, "last_edit_date": 1566804117, "creation_date": 1566802579, "answer_id": 57653095, "question_id": 57652654, "link": "https://stackoverflow.com/questions/57652654/accessing-private-methods-inside-a-singleton-class-methods-in-ruby/57653095#57653095", "title": "Accessing private methods inside a singleton class methods in Ruby", "body": "<p>The issue here is that you're calling an instance method from a class method. If you add <code>self</code> to your private method it will become a class method and can be called by the Class name.\nTry \n<code>self.do_something_private</code></p>\n"}], "owner": {"reputation": 109, "user_id": 3663572, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ddcc1fca9bf99f35cdf4b293b8342e94?s=128&d=identicon&r=PG&f=1", "display_name": "fahimali", "link": "https://stackoverflow.com/users/3663572/fahimali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 251, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1566805213, "creation_date": 1566800169, "last_edit_date": 1566800584, "question_id": 57652654, "link": "https://stackoverflow.com/questions/57652654/accessing-private-methods-inside-a-singleton-class-methods-in-ruby", "title": "Accessing private methods inside a singleton class methods in Ruby", "body": "<p>If I have a ruby class similar to this:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>class MyClass\n  def self.singleton_method\n    do_something_private\n  end\n\n  private\n\n  def do_something_private\n    puts \"doing something private\"\n  end\nend\n\n</code></pre>\n\n<p>And I call <code>MyClass.singleton_method</code></p>\n\n<p>Then I get this error:</p>\n\n<pre><code>NoMethodError (undefined method `do_something_private' for MyClass:Class):\n</code></pre>\n\n<p>How can we resolve the error and what is the right way to define private methods which could be called from inside of class methods?</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 14827, "user_id": 645886, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2abb0123e9484284a9cb2d36aa9854b3?s=128&d=identicon&r=PG&f=1", "display_name": "Surya", "link": "https://stackoverflow.com/users/645886/surya"}, "edited": false, "score": 0, "creation_date": 1566799482, "post_id": 57652441, "comment_id": 101755151, "body": "<code># frozen-string-literal: true</code> is just a normal Ruby comment. Read this for <code># frozen_string_literal: true</code> - <a href=\"https://stackoverflow.com/a/37799399/645886\">stackoverflow.com/a/37799399/645886</a>"}], "answers": [{"tags": [], "owner": {"reputation": 53136, "user_id": 28376, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ec1383b240b5ba15ffb9743fceb3c0e?s=128&d=identicon&r=PG", "display_name": "philnash", "link": "https://stackoverflow.com/users/28376/philnash"}, "is_accepted": false, "score": 2, "last_activity_date": 1566801361, "creation_date": 1566801361, "answer_id": 57652866, "question_id": 57652441, "link": "https://stackoverflow.com/questions/57652441/ruby-frozen-string-comment-syntax-difference/57652866#57652866", "title": "Ruby frozen string comment syntax difference", "body": "<p>The answer you link to never uses the magic comment <code># frozen-string-literal: true</code> only <code># frozen_string_literal: true</code>. The difference is that only the latter will work.</p>\n\n<p>The other way to enable frozen string literals is to run the application with the <code>--enable=frozen-string-literal</code> flag.</p>\n"}], "owner": {"reputation": 7685, "user_id": 517868, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/771951f55ed37335f238e1a80dfda9cd?s=128&d=identicon&r=PG", "display_name": "Juanito Fatas", "link": "https://stackoverflow.com/users/517868/juanito-fatas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1566801361, "creation_date": 1566798817, "question_id": 57652441, "link": "https://stackoverflow.com/questions/57652441/ruby-frozen-string-comment-syntax-difference", "title": "Ruby frozen string comment syntax difference", "body": "<p>There are two ways of enabling all strings in a file to be implicitly frozen<sup><a href=\"https://stackoverflow.com/a/37799399/517868\">1</a></sup>.</p>\n\n<pre><code># frozen-string-literal: true\n# frozen_string_literal: true\n</code></pre>\n\n<p>Is there a difference between these two syntaxes?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["ruby", "email", "templates", "mailer"], "comments": [{"owner": {"reputation": 7994, "user_id": 1625339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b8ba46f911517c8b2ccc39e0be9050c0?s=128&d=identicon&r=PG", "display_name": "Aetherus", "link": "https://stackoverflow.com/users/1625339/aetherus"}, "edited": false, "score": 0, "creation_date": 1566798740, "post_id": 57652206, "comment_id": 101754911, "body": "Is it <code>Comment_added.html.rb</code> or <code>comment_added.html.rb</code> (note the case of the first letter)?"}, {"owner": {"reputation": 11, "user_id": 11610879, "user_type": "registered", "profile_image": "https://graph.facebook.com/10157386290179059/picture?type=large", "display_name": "Eric", "link": "https://stackoverflow.com/users/11610879/eric"}, "reply_to_user": {"reputation": 7994, "user_id": 1625339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b8ba46f911517c8b2ccc39e0be9050c0?s=128&d=identicon&r=PG", "display_name": "Aetherus", "link": "https://stackoverflow.com/users/1625339/aetherus"}, "edited": false, "score": 0, "creation_date": 1566799301, "post_id": 57652206, "comment_id": 101755097, "body": "It&#39;s lowercase, not sure why it capitalized it here."}, {"owner": {"reputation": 7994, "user_id": 1625339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b8ba46f911517c8b2ccc39e0be9050c0?s=128&d=identicon&r=PG", "display_name": "Aetherus", "link": "https://stackoverflow.com/users/1625339/aetherus"}, "edited": false, "score": 0, "creation_date": 1566799754, "post_id": 57652206, "comment_id": 101755243, "body": "There should be 2 template files: <code>app&#47;views&#47;notification_mailer&#47;comment_added.html.erb</code> and <code>app&#47;views&#47;notification_mailer&#47;comment_added.text.erb</code>. Do they exist?"}, {"owner": {"reputation": 11, "user_id": 11610879, "user_type": "registered", "profile_image": "https://graph.facebook.com/10157386290179059/picture?type=large", "display_name": "Eric", "link": "https://stackoverflow.com/users/11610879/eric"}, "reply_to_user": {"reputation": 7994, "user_id": 1625339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b8ba46f911517c8b2ccc39e0be9050c0?s=128&d=identicon&r=PG", "display_name": "Aetherus", "link": "https://stackoverflow.com/users/1625339/aetherus"}, "edited": false, "score": 0, "creation_date": 1566799919, "post_id": 57652206, "comment_id": 101755289, "body": "yes I have the text version as well.: comment_added.text.erb"}, {"owner": {"reputation": 7994, "user_id": 1625339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b8ba46f911517c8b2ccc39e0be9050c0?s=128&d=identicon&r=PG", "display_name": "Aetherus", "link": "https://stackoverflow.com/users/1625339/aetherus"}, "edited": false, "score": 0, "creation_date": 1566800577, "post_id": 57652206, "comment_id": 101755489, "body": "Is <code>app&#47;views&#47;layouts&#47;mailer.html.erb</code> there?"}, {"owner": {"reputation": 11, "user_id": 11610879, "user_type": "registered", "profile_image": "https://graph.facebook.com/10157386290179059/picture?type=large", "display_name": "Eric", "link": "https://stackoverflow.com/users/11610879/eric"}, "reply_to_user": {"reputation": 7994, "user_id": 1625339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b8ba46f911517c8b2ccc39e0be9050c0?s=128&d=identicon&r=PG", "display_name": "Aetherus", "link": "https://stackoverflow.com/users/1625339/aetherus"}, "edited": false, "score": 0, "creation_date": 1566804205, "post_id": 57652206, "comment_id": 101756814, "body": "this is the mailer.html.erb:  &lt;!DOCTYPE html&gt; &lt;html&gt;   &lt;head&gt;     &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;     &lt;style&gt;       /* Email styles need to be inline */     &lt;/style&gt;   &lt;/head&gt;    &lt;body&gt;     &lt;%= yield %&gt;   &lt;/body&gt; &lt;/html&gt;"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 11610879, "user_type": "registered", "profile_image": "https://graph.facebook.com/10157386290179059/picture?type=large", "display_name": "Eric", "link": "https://stackoverflow.com/users/11610879/eric"}, "edited": false, "score": 0, "creation_date": 1566804325, "post_id": 57653130, "comment_id": 101756848, "body": "I misstyped, it actually is comment_added.html.erb, however, it is not in views/notification_mailer, it&#39;s just under app/mailers"}, {"owner": {"reputation": 358, "user_id": 8708097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/APLHT.jpg?s=128&g=1", "display_name": "Saif chaudhry", "link": "https://stackoverflow.com/users/8708097/saif-chaudhry"}, "reply_to_user": {"reputation": 11, "user_id": 11610879, "user_type": "registered", "profile_image": "https://graph.facebook.com/10157386290179059/picture?type=large", "display_name": "Eric", "link": "https://stackoverflow.com/users/11610879/eric"}, "edited": false, "score": 0, "creation_date": 1566804837, "post_id": 57653130, "comment_id": 101757039, "body": "That&#39;s the issue it&#39;s finding it under app/views/notification_mailer/"}, {"owner": {"reputation": 11, "user_id": 11610879, "user_type": "registered", "profile_image": "https://graph.facebook.com/10157386290179059/picture?type=large", "display_name": "Eric", "link": "https://stackoverflow.com/users/11610879/eric"}, "edited": false, "score": 0, "creation_date": 1566847686, "post_id": 57653130, "comment_id": 101776428, "body": "So would I just need to change the folder for comment_added.html.erb and comment_added.text.erb to app/views/notification_mailer/ from apps/mailers?"}], "tags": [], "owner": {"reputation": 358, "user_id": 8708097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/APLHT.jpg?s=128&g=1", "display_name": "Saif chaudhry", "link": "https://stackoverflow.com/users/8708097/saif-chaudhry"}, "is_accepted": false, "score": 0, "last_activity_date": 1566802778, "creation_date": 1566802778, "answer_id": 57653130, "question_id": 57652206, "link": "https://stackoverflow.com/questions/57652206/trying-to-set-up-a-ruby-mailer-and-i-am-receiving-actionviewmissingtemplate/57653130#57653130", "title": "Trying to set up a Ruby Mailer and I am receiving: ActionView::MissingTemplate", "body": "<p>I guess the issue is in the name of <code>comment_added.html.rb</code> it should be <code>comment_added.html.erb</code>\nAlso you should make sure it's under this directory app/views/notification_mailer/</p>\n"}], "owner": {"reputation": 11, "user_id": 11610879, "user_type": "registered", "profile_image": "https://graph.facebook.com/10157386290179059/picture?type=large", "display_name": "Eric", "link": "https://stackoverflow.com/users/11610879/eric"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 74, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1566804345, "creation_date": 1566797295, "last_edit_date": 1566804345, "question_id": 57652206, "link": "https://stackoverflow.com/questions/57652206/trying-to-set-up-a-ruby-mailer-and-i-am-receiving-actionviewmissingtemplate", "title": "Trying to set up a Ruby Mailer and I am receiving: ActionView::MissingTemplate", "body": "<p>I am attempting to add a mail function to my yelp clone to notify users when a comment by another use has been left on a restaurant location they have created. When I try to force an email in my rails console, I receive this error: <code>ActionView::MissingTemplate</code></p>\n\n<p>This is for Ruby Rails 5 which has a mailer built in. I've attempted to add a Doctype template to my Mailer code and this still errors in this way.</p>\n\n<p><strong>This is my NotificationMailer.rb:</strong></p>\n\n<pre><code>class NotificationMailer &lt; ApplicationMailer\n  default from: \"no-reply@nomsterapp.com\"\n\n  def comment_added\n    mail(to: \"*****@yahoo.com\",\n      subject: \"A comment has been added to your place\")\n  end\nend\n</code></pre>\n\n<p><strong>This is the ApplicationMailer.rb:</strong></p>\n\n<pre><code>class ApplicationMailer &lt; ActionMailer::Base\n  default from: 'from@example.com'\n  layout 'mailer'\nend\n\nclass UserMailer &lt; ApplicationMailer\nend\n</code></pre>\n\n<p><strong>This is the comment_added.html.erb:</strong></p>\n\n<pre><code>&lt;p&gt;Hey There!&lt;/p&gt;\n&lt;p&gt;\n   Congrats! &lt;b&gt;A comment has been added on Nomster&lt;/b&gt;\n&lt;/p&gt;\n\nAloha,&lt;br /&gt;\nEric\n</code></pre>\n\n<pre><code>I should be able to input in the console NotificationMailer.comment_added.deliver and it send me an email. But the console kicks this error back to me:\n\nNotificationMailer#comment_added: processed outbound mail in 574.8ms\nTraceback (most recent call last):\n        2: from (irb):6\n        1: from app/mailers/notification_mailer.rb:14:in `comment_added'\nActionView::MissingTemplate (Missing template notification_mailer/comment_added with \"mailer\". Searched in:)\n  * \"notification_mailer\"\n</code></pre>\n"}, {"tags": ["ruby", "ajax", "ruby-on-rails-5"], "comments": [{"owner": {"reputation": 7994, "user_id": 1625339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b8ba46f911517c8b2ccc39e0be9050c0?s=128&d=identicon&r=PG", "display_name": "Aetherus", "link": "https://stackoverflow.com/users/1625339/aetherus"}, "edited": false, "score": 0, "creation_date": 1566796739, "post_id": 57651686, "comment_id": 101754356, "body": "I can&#39;t see the text field labeled <code>Term</code> in your <code>_form.html.erb</code>. What should it do?"}, {"owner": {"reputation": 65, "user_id": 11850228, "user_type": "registered", "profile_image": "https://graph.facebook.com/938857089785122/picture?type=large", "display_name": "Dutavi", "link": "https://stackoverflow.com/users/11850228/dutavi"}, "reply_to_user": {"reputation": 7994, "user_id": 1625339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b8ba46f911517c8b2ccc39e0be9050c0?s=128&d=identicon&r=PG", "display_name": "Aetherus", "link": "https://stackoverflow.com/users/1625339/aetherus"}, "edited": false, "score": 0, "creation_date": 1566799234, "post_id": 57651686, "comment_id": 101755072, "body": "sorry i added the above ..."}, {"owner": {"reputation": 7994, "user_id": 1625339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b8ba46f911517c8b2ccc39e0be9050c0?s=128&d=identicon&r=PG", "display_name": "Aetherus", "link": "https://stackoverflow.com/users/1625339/aetherus"}, "edited": false, "score": 1, "creation_date": 1566800293, "post_id": 57651686, "comment_id": 101755404, "body": "Do you want to let the users submit one term at a time, or do you want them to submit a batch of terms? If you want them to submit a batch, do you want them to see the terms they just typed in, or all the terms they&#39;ve ever submitted, or both?"}, {"owner": {"reputation": 65, "user_id": 11850228, "user_type": "registered", "profile_image": "https://graph.facebook.com/938857089785122/picture?type=large", "display_name": "Dutavi", "link": "https://stackoverflow.com/users/11850228/dutavi"}, "reply_to_user": {"reputation": 7994, "user_id": 1625339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b8ba46f911517c8b2ccc39e0be9050c0?s=128&d=identicon&r=PG", "display_name": "Aetherus", "link": "https://stackoverflow.com/users/1625339/aetherus"}, "edited": false, "score": 0, "creation_date": 1566800656, "post_id": 57651686, "comment_id": 101755525, "body": "yes i  want them to submit a batch of terms? and i want them to submit a batch,  both."}, {"owner": {"reputation": 65, "user_id": 11850228, "user_type": "registered", "profile_image": "https://graph.facebook.com/938857089785122/picture?type=large", "display_name": "Dutavi", "link": "https://stackoverflow.com/users/11850228/dutavi"}, "reply_to_user": {"reputation": 7994, "user_id": 1625339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b8ba46f911517c8b2ccc39e0be9050c0?s=128&d=identicon&r=PG", "display_name": "Aetherus", "link": "https://stackoverflow.com/users/1625339/aetherus"}, "edited": false, "score": 0, "creation_date": 1566869565, "post_id": 57651686, "comment_id": 101781829, "body": "I&#39;m still waiting for your answer ..."}], "owner": {"reputation": 65, "user_id": 11850228, "user_type": "registered", "profile_image": "https://graph.facebook.com/938857089785122/picture?type=large", "display_name": "Dutavi", "link": "https://stackoverflow.com/users/11850228/dutavi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 52, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1566799185, "creation_date": 1566793005, "last_edit_date": 1566799185, "question_id": 57651686, "link": "https://stackoverflow.com/questions/57651686/i-have-an-issue-related-to-ajax", "title": "I have an issue related to AJAX", "body": "<blockquote>\n  <p>I need to get the value after it is created, just below the section \"NEW\"</p>\n</blockquote>\n\n<p>Below is the image I intended to do, and after the data was created I wanted it right there</p>\n\n<p><a href=\"https://i.stack.imgur.com/Gq0xz.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Gq0xz.png\" alt=\"uesiton\"></a></p>\n\n<p>phrases_term_controller.rb</p>\n\n<pre><code>\nclass PhrasesTermsController &lt; ApplicationController\n  before_action :authenticate_user!\n  before_action :set_term\n\n  def new\n    @phrases_term = PhrasesTerm.new\n  end\n\n  def create\n    @phrases_term = @term.phrases_terms.new(phrases_term_params)\n    if @phrases_term.save\n      redirect_to term_phrases_term_path(@term, @phrases_term), notice: \"Phrases_Term was successfully created\"\n    else\n      render \"new\"\n    end\n  end\n\n  def show\n    @phrases_term = PhrasesTerm.find(params[:id])\n  end\n\n  private\n\n  def phrases_term_params\n    params.require(:phrases_term).permit(:term_id, :phrase_id)\n  end\n\n  def set_term\n    @term = Term.find(params[:term_id])\n  end\nend\n\n</code></pre>\n\n<p>View\nphrases_term</p>\n\n<p>new.html.erb</p>\n\n<pre><code>&lt;h1&gt;&lt;%= I18n.t(\"pages.phrases_term.new.title\") %&gt;&lt;/h1&gt;\n&lt;%= render 'form', phrases_term: @phrases_term %&gt;\n</code></pre>\n\n<p>_form.html.erb</p>\n\n<pre><code>&lt;%= form_with scope: :phrases_term, url: term_phrases_terms_path, local: true do |form| %&gt;\n  &lt;% if phrases_term.errors.any? %&gt;\n    &lt;div id=\"error_explanation\"&gt;\n      &lt;h2&gt;&lt;%= pluralize(phrases_term.errors.count, \"error\") %&gt; prohibited this phrase from being saved:&lt;/h2&gt;\n\n      &lt;ul&gt;\n      &lt;% phrases_term.errors.full_messages.each do |message| %&gt;\n        &lt;li&gt;&lt;%= message %&gt;&lt;/li&gt;\n      &lt;% end %&gt;\n      &lt;/ul&gt;\n    &lt;/div&gt;\n  &lt;% end %&gt;\n\n   &lt;div class=\"field\"&gt;\n    &lt;%= form.label :term_id %&gt; :\n    &lt;%= form.number_field :id %&gt;\n  &lt;/div&gt;\n\n  &lt;div class=\"dropdown\"&gt;\n    &lt;button class=\"dropbtn\"&gt;Phrase&lt;/button&gt;\n    &lt;div class=\"dropdown-content\"&gt;\n        &lt;a&gt;&lt;%= form.select :phrase_id, Phrase.all.collect { |p| [ p.id ] }, include_blank: true %&gt;&lt;/a&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n\n  &lt;div class=\"actions\"&gt;\n    &lt;%= form.submit %&gt;\n  &lt;/div&gt;\n&lt;% end %&gt;\n</code></pre>\n\n<p>Term:</p>\n\n<p>_form.html.erb</p>\n\n<pre><code>&lt;%= form_with(model: term, local: true) do |form| %&gt;\n  &lt;% if term.errors.any? %&gt;\n    &lt;div id=\"error_explanation\"&gt;\n      &lt;h2&gt;&lt;%= pluralize(term.errors.count, \"error\") %&gt; prohibited this term from being saved:&lt;/h2&gt;\n\n      &lt;ul&gt;\n      &lt;% term.errors.full_messages.each do |message| %&gt;\n        &lt;li&gt;&lt;%= message %&gt;&lt;/li&gt;\n      &lt;% end %&gt;\n      &lt;/ul&gt;\n    &lt;/div&gt;\n  &lt;% end %&gt;\n\n  &lt;div class=\"field\"&gt;\n    &lt;%= form.label :word %&gt;\n    &lt;%= form.text_field :word %&gt;\n  &lt;/div&gt;\n\n  &lt;div class=\"field\"&gt;\n    &lt;%= form.label :meaning %&gt;\n    &lt;%= form.text_field :meaning %&gt;\n  &lt;/div&gt;\n\n  &lt;div class=\"field\"&gt;\n    &lt;%= form.label :reading %&gt;\n    &lt;%= form.text_field :reading %&gt;\n  &lt;/div&gt;\n\n  &lt;div class=\"actions\"&gt;\n    &lt;%= form.submit %&gt;\n  &lt;/div&gt;\n&lt;% end %&gt;\n</code></pre>\n\n<p>I am not sure I have provided all the necessary information, if I want to add some more information, please comment below. ---Thank You.----</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 1066, "user_id": 6204421, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/0yeJN.jpg?s=128&g=1", "display_name": "Santosh Aryal", "link": "https://stackoverflow.com/users/6204421/santosh-aryal"}, "edited": false, "score": 0, "creation_date": 1566793150, "post_id": 57651665, "comment_id": 101753623, "body": "Do like this ..  str.gsub(&quot;var=p&quot;, p)"}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "reply_to_user": {"reputation": 1066, "user_id": 6204421, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/0yeJN.jpg?s=128&g=1", "display_name": "Santosh Aryal", "link": "https://stackoverflow.com/users/6204421/santosh-aryal"}, "edited": false, "score": 0, "creation_date": 1566793234, "post_id": 57651665, "comment_id": 101753638, "body": "I don&#39;t know whether it&#39;s p or a or b or z. That&#39;s why I am trying to write this code <code>p str.gsub(&#47;var=(.)&#47;,&quot;\\\\1&quot;)</code>"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1566798934, "post_id": 57651665, "comment_id": 101754979, "body": "Is <code>p</code> equal to <code>&#39;a&#39;</code>, <code>&#39;b&#39;</code> or <code>&#39;z&#39;</code> literally? If not, what might be its value? Any single lowercase letter? Any string?"}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "reply_to_user": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1566802107, "post_id": 57651665, "comment_id": 101755995, "body": "@CarySwoveland Variable name is not only p,it could be a or anything else."}], "answers": [{"comments": [{"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1566793540, "post_id": 57651697, "comment_id": 101753706, "body": "Awesome Dude! Thanks a lot. but I don&#39;t know why you introduced <code>|m|</code> inside the block because you are not using the variable m."}, {"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "reply_to_user": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1566793585, "post_id": 57651697, "comment_id": 101753716, "body": "Eh good point. Fingers on autopilot, no better reason. :P Removed now."}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1566794121, "post_id": 57651697, "comment_id": 101753824, "body": "Hi, you used <code>binding.local_variable_get($1)</code> but actually I have to get it from instance variable. What modification should I do so that it would work? I tried with <code>binding.instance_variable_get($1) </code> but it says <code>instance_variable_get&#39;: &#39;p&#39; is not allowed as an instance variable name (NameError)</code>"}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1566794670, "post_id": 57651697, "comment_id": 101753927, "body": "<code>str.gsub(&#47;var=(\\w+)&#47;) { instance_variable_get(&quot;@#{$1}&quot;) }</code>. There is zero sense to call <code>instance_variable_whatever</code> on <code>binding</code> because <code>binding</code> has no anything <code>instance</code>-like."}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 1, "creation_date": 1566794775, "post_id": 57651697, "comment_id": 101753956, "body": "<i>Sidenote:</i> I surely upvoted it because it solves the issue, but I have to notice this is <b>extremely</b> error-prone and should be avoided at any cost. The code relying on such tricks is unsupportable and in general <i>very</i> low quality."}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "reply_to_user": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1566794949, "post_id": 57651697, "comment_id": 101753999, "body": "@AlekseiMatiushkin <code>str.gsub(&#47;var=(\\w+)&#47;) { instance_variable_get(&quot;@#{$1}&quot;) }</code> This perfectly solves my problem, thank you very much!"}, {"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "reply_to_user": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 1, "creation_date": 1566795087, "post_id": 57651697, "comment_id": 101754032, "body": "@AlekseiMatiushkin: Absolutely agreed, I noted twice throughout the answer (and here for the third time) that this is not the way to do it in practice."}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1566795272, "post_id": 57651697, "comment_id": 101754062, "body": "@Amadan Thanks for such a detailed answer. That explains me clearly! Thanks."}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 1, "creation_date": 1566795443, "post_id": 57651697, "comment_id": 101754084, "body": "Btw, <a href=\"https://ruby-doc.org/core-2.6.3/Object.html#method-i-instance_variable_get\" rel=\"nofollow noreferrer\"><code>Object#instance_variable_get</code></a> is public."}, {"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "reply_to_user": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1566795576, "post_id": 57651697, "comment_id": 101754116, "body": "@AlekseiMatiushkin: Wow, I was sure it wasn&#39;t. Who knows why. Thanks!"}], "tags": [], "owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "is_accepted": true, "score": 5, "last_activity_date": 1566795619, "last_edit_date": 1566795619, "creation_date": 1566793156, "answer_id": 57651697, "question_id": 57651665, "link": "https://stackoverflow.com/questions/57651665/substitute-the-variable-inside-a-string/57651697#57651697", "title": "substitute the variable inside a string", "body": "<p>If you really have to, you can get to a local variable by name using <code>Binding#local_variable_get</code>:</p>\n\n<pre><code>p=\"23232\"\nstr=\"policy var=p saved\"\n\nstr.gsub(/var=(\\w+)/) { binding.local_variable_get($1) }\n</code></pre>\n\n<p>However, I would strongly suggest that instead of a local variable, you use a hash:</p>\n\n<pre><code>vars = { \"p\" =&gt; \"23232\" }\nstr=\"policy var=p saved\"\n\nstr.gsub(/var=(\\w+)/) { vars[$1] }\n</code></pre>\n\n<p>EDIT: Local variables are very different from instance variables. There are multiple approaches possible.</p>\n\n<p>Getting the instance variable directly is the worst one, as you may be skipping logic that would be implemented in an accessor. Note that instance variables' names start with <code>@</code>.</p>\n\n<p>A better approach is to invoke the accessor, but this again will need <code>send</code>. </p>\n\n<pre><code>class Foo\n  attr_accessor :bar\n  def initialize(bar)\n    @bar = bar\n  end\nend\n\nfoo = Foo.new(\"baz\")\nstr = \"policy var=bar saved\"\n\n# by direct access\nstr.gsub(/var=(\\w+)/) { foo.instance_variable_get(\"@\" + $1) }\n# by invoking the accessor\nstr.gsub(/var=(\\w+)/) { foo.send($1) }\n</code></pre>\n\n<p>The best approach is, again, use a hash and index values by a key, not multiple instance variables. I am answering for educational purposes, but please, please, in real code, do this instead:</p>\n\n<pre><code>class Foo\n  def initialize()\n    @vars = { \"bar\" =&gt; \"baz\" }\n  end\n\n  def replace_by_hash(str)\n    str.gsub(/var=(\\w+)/) { @vars[$1] }\n  end\nend\n\nfoo = Foo.new\nstr = \"policy var=bar saved\"\n\nfoo.replace_by_hash(str)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1566804455, "post_id": 57653163, "comment_id": 101756898, "body": "You can&#39;t change the string!"}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1566810659, "post_id": 57653163, "comment_id": 101759671, "body": "How can you change the string?"}, {"owner": {"reputation": 358, "user_id": 8708097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/APLHT.jpg?s=128&g=1", "display_name": "Saif chaudhry", "link": "https://stackoverflow.com/users/8708097/saif-chaudhry"}, "edited": false, "score": 0, "creation_date": 1566813083, "post_id": 57653163, "comment_id": 101760933, "body": "Didn&#39;t get your question?  Doing this will change the var str as well."}], "tags": [], "owner": {"reputation": 358, "user_id": 8708097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/APLHT.jpg?s=128&g=1", "display_name": "Saif chaudhry", "link": "https://stackoverflow.com/users/8708097/saif-chaudhry"}, "is_accepted": false, "score": 0, "last_activity_date": 1566802959, "creation_date": 1566802959, "answer_id": 57653163, "question_id": 57651665, "link": "https://stackoverflow.com/questions/57651665/substitute-the-variable-inside-a-string/57653163#57653163", "title": "substitute the variable inside a string", "body": "<p>Simplest way to do it\n<code>p=\"23232\"\nstr=\"policy var=#{p} saved\"\n\"policy var=23232 saved\"</code></p>\n"}, {"comments": [{"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1566810258, "post_id": 57653394, "comment_id": 101759478, "body": "Oh, that&#39;s amazing too!"}], "tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": false, "score": 1, "last_activity_date": 1566803981, "creation_date": 1566803981, "answer_id": 57653394, "question_id": 57651665, "link": "https://stackoverflow.com/questions/57651665/substitute-the-variable-inside-a-string/57653394#57653394", "title": "substitute the variable inside a string", "body": "<pre><code>p=\"23232\"\nstr=\"policy var=p saved\"\n\nstr.gsub(/var=(.)/) { instance_eval($1) }\n  #=&gt; \"policy 23232 saved\"\n</code></pre>\n"}], "owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 57651697, "answer_count": 3, "score": 1, "last_activity_date": 1566803981, "creation_date": 1566792699, "question_id": 57651665, "link": "https://stackoverflow.com/questions/57651665/substitute-the-variable-inside-a-string", "title": "substitute the variable inside a string", "body": "<p>I have a string like this</p>\n\n<pre><code>p=\"23232\"\nstr=\"policy var=p saved\" #It could be p or a or b, any variable.\n</code></pre>\n\n<p>I want to substitute the value of p in the place of var=p but I found a way to replace p in the place of var=p.</p>\n\n<pre><code>p=\"23232\"\nstr=\"policy var=p saved\"\n\np str.gsub(/var=(.)/,\"\\\\1\")\n</code></pre>\n\n<p>This code is replacing var=p with p but I want to substitute the value of p in the place of var=p like</p>\n\n<p>output</p>\n\n<pre><code>policy 23232 saved\n</code></pre>\n\n<p>I know this can be accomplished by giving block to gsub but I don't know how.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "stripe-payments"], "comments": [{"owner": {"reputation": 1266, "user_id": 7619578, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c4b8b0d6308975901d498601dc6ffc7f?s=128&d=identicon&r=PG&f=1", "display_name": "Int&#39;l Man Of Coding Mystery", "link": "https://stackoverflow.com/users/7619578/intl-man-of-coding-mystery"}, "edited": false, "score": 1, "creation_date": 1566811946, "post_id": 57651634, "comment_id": 101760308, "body": "Found this in their docs about how to uplaod a file to handle identity verification. <a href=\"https://stripe.com/docs/connect/identity-verification-api#uploading-a-file\" rel=\"nofollow noreferrer\">stripe.com/docs/connect/&hellip;</a>"}, {"owner": {"reputation": 1320, "user_id": 4531923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/749da210afda1b309680b354f019849e?s=128&d=identicon&r=PG", "display_name": "Vincent Rolea", "link": "https://stackoverflow.com/users/4531923/vincent-rolea"}, "edited": false, "score": 2, "creation_date": 1566826272, "post_id": 57651634, "comment_id": 101767279, "body": "You need to authenticate to Stripe API using your secret key and you don&#39;t want to store it in your frontend code, this is why it is needed to do it through your server"}, {"owner": {"reputation": 351, "user_id": 2009652, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ab04284dee660708ce5c727fdf1f6958?s=128&d=identicon&r=PG", "display_name": "calyxofheld", "link": "https://stackoverflow.com/users/2009652/calyxofheld"}, "edited": false, "score": 0, "creation_date": 1566827494, "post_id": 57651634, "comment_id": 101767910, "body": "Thanks for the replies! What I&#39;m looking for is a hand-holding sort of answer about structure. &quot;You need to do this in your model, this in your controller, and this in your view.&quot; The code that I provided is from the Stripe docs, and I already know how to authenticate with my secret key."}, {"owner": {"reputation": 351, "user_id": 2009652, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ab04284dee660708ce5c727fdf1f6958?s=128&d=identicon&r=PG", "display_name": "calyxofheld", "link": "https://stackoverflow.com/users/2009652/calyxofheld"}, "reply_to_user": {"reputation": 1320, "user_id": 4531923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/749da210afda1b309680b354f019849e?s=128&d=identicon&r=PG", "display_name": "Vincent Rolea", "link": "https://stackoverflow.com/users/4531923/vincent-rolea"}, "edited": false, "score": 0, "creation_date": 1567052693, "post_id": 57651634, "comment_id": 101849191, "body": "@VincentRolea I already authenticated to stripe with my secret key.  when you say that i don&#39;t want to store it in my frontend code, does that mean i DON&#39;T want to write it to <code>Tempfile</code>?"}, {"owner": {"reputation": 3630, "user_id": 4799659, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153200714295120/picture?type=large", "display_name": "fylooi", "link": "https://stackoverflow.com/users/4799659/fylooi"}, "edited": false, "score": 1, "creation_date": 1567061944, "post_id": 57651634, "comment_id": 101851991, "body": "Not saving the file to disk means you need to receive the whole file then send it to a third party API in the same controller action. This doubles the processing time for this request. And if something fails, you have no way to retry the post to Stripe."}, {"owner": {"reputation": 3630, "user_id": 4799659, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153200714295120/picture?type=large", "display_name": "fylooi", "link": "https://stackoverflow.com/users/4799659/fylooi"}, "edited": false, "score": 4, "creation_date": 1567066198, "post_id": 57651634, "comment_id": 101854130, "body": "But if you really want to do it, you should be able to pass <code>params[:file]</code> directly to <code>Stripe::File.create(file: params[:file])</code> in your controller."}], "answers": [{"comments": [{"owner": {"reputation": 351, "user_id": 2009652, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ab04284dee660708ce5c727fdf1f6958?s=128&d=identicon&r=PG", "display_name": "calyxofheld", "link": "https://stackoverflow.com/users/2009652/calyxofheld"}, "edited": false, "score": 0, "creation_date": 1567472176, "post_id": 57760126, "comment_id": 101963523, "body": "Thanks Vincent! I did end up trying to do something a little bit like what you are suggesting, but it still does not work. The file does not upload to Stripe when submitted through a form, but it does upload when done manually through my console. I&#39;ve updated my question with new code."}, {"owner": {"reputation": 1320, "user_id": 4531923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/749da210afda1b309680b354f019849e?s=128&d=identicon&r=PG", "display_name": "Vincent Rolea", "link": "https://stackoverflow.com/users/4531923/vincent-rolea"}, "reply_to_user": {"reputation": 351, "user_id": 2009652, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ab04284dee660708ce5c727fdf1f6958?s=128&d=identicon&r=PG", "display_name": "calyxofheld", "link": "https://stackoverflow.com/users/2009652/calyxofheld"}, "edited": false, "score": 1, "creation_date": 1567500339, "post_id": 57760126, "comment_id": 101971356, "body": "Do you have any error rails-side? Could you check the Stripe logs as well so we can see what goes wrong?"}, {"owner": {"reputation": 351, "user_id": 2009652, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ab04284dee660708ce5c727fdf1f6958?s=128&d=identicon&r=PG", "display_name": "calyxofheld", "link": "https://stackoverflow.com/users/2009652/calyxofheld"}, "edited": false, "score": 0, "creation_date": 1567707145, "post_id": 57760126, "comment_id": 102053264, "body": "I don&#39;t have any errors that I can see rails-side. Thanks for reminding me about Stripe logs! Very helpful. I see from these logs that the requests are not going through at all. Hm.."}], "tags": [], "owner": {"reputation": 1320, "user_id": 4531923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/749da210afda1b309680b354f019849e?s=128&d=identicon&r=PG", "display_name": "Vincent Rolea", "link": "https://stackoverflow.com/users/4531923/vincent-rolea"}, "is_accepted": true, "score": 2, "last_activity_date": 1567441627, "last_edit_date": 1567441627, "creation_date": 1567441156, "answer_id": 57760126, "question_id": 57651634, "link": "https://stackoverflow.com/questions/57651634/is-it-possible-to-read-a-file-without-saving-it-in-rails/57760126#57760126", "title": "is it possible to read a file without saving it in Rails?", "body": "<p>You need to authenticate to the API in order to submit files to Stripe, and it can only happen server-side, since you don't want to store your credentials in your frontend code. </p>\n\n<p>In order to submit a file without saving it, a solution would be to have a controller action taking the submitted file, upload it to the Stripe server and redirecting to whatever route you need:</p>\n\n<pre><code># Init Stripe client\n\nStripe.api_key = STRIPE_SECRET_KEY\n\n# Controller\n\ndef stripe_file_upload \n  file = params[:file]\n  Stripe::File.create({\n    file: file.tempfile,\n    purpose: 'dispute_evidence'\n  })\n  redirect_to my_custom_path\nend\n\n# View\n\n&lt;h1&gt;My Form&lt;/h1&gt;\n\n&lt;%= form_tag stripe_file_upload_path, multipart: true do %&gt;\n  &lt;%= file_field_tag :file, class: \"file-input\" %&gt;\n  &lt;%= submit_tag %&gt;\n&lt;% end %&gt;\n</code></pre>\n"}], "owner": {"reputation": 351, "user_id": 2009652, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ab04284dee660708ce5c727fdf1f6958?s=128&d=identicon&r=PG", "display_name": "calyxofheld", "link": "https://stackoverflow.com/users/2009652/calyxofheld"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 471, "favorite_count": 0, "accepted_answer_id": 57760126, "answer_count": 1, "score": 2, "last_activity_date": 1567478640, "creation_date": 1566792392, "last_edit_date": 1567478640, "question_id": 57651634, "link": "https://stackoverflow.com/questions/57651634/is-it-possible-to-read-a-file-without-saving-it-in-rails", "title": "is it possible to read a file without saving it in Rails?", "body": "<p>I need to submit a file via a multipart API POST request to <code>https://files.stripe.com/v1/files</code>, but I do not want this file to be saved to my own database. </p>\n\n<p><a href=\"https://www.rubydoc.info/gems/stripe/Stripe/File\" rel=\"nofollow noreferrer\">This class</a> in the stripe gem implies that I would write some code that looks like:</p>\n\n<pre><code>Stripe::File.create({\n file: File.new(\"/path/to/a/file.jpg\"),\n purpose: 'dispute_evidence',\n})\n</code></pre>\n\n<p>But for some reason, doing this through params isn't working. My form does this:</p>\n\n<pre><code>&lt;%= form_for :user, url: :stripe_file_upload, multipart: true do |f| %&gt;\n &lt;%= f.label :drivers_license_front, \"Front of driver's license\" %&gt;\n &lt;%= f.file_field :drivers_license_front %&gt;\n\n &lt;%= f.submit \"Upload\", data: { disable: true } %&gt;\n&lt;% end %&gt;\n</code></pre>\n\n<p>And then the controller action does this:</p>\n\n<pre><code>def stripe_file_upload\n file = params[:user][:drivers_license_front]\n Stripe::File.create(\n  { purpose: 'identity_document',\n   file: file.tempfile },\n  { stripe_account: current_user.stripe_user_id }\n )\n puts \"file uploaded\"\n redirect_to whatever_path\nend\n</code></pre>\n\n<p>In case it's helpful, my params output looks like this:</p>\n\n<pre><code>Parameters: {\"utf8\"=&gt;\"\u2713\", \"authenticity_token\"=&gt;\"NGcXcLnY6mGGyR0SDJNj3UGSzaGrie5TrCv0vGEeasXFhXFtU6eHK10Sbr3MW5Pnax3YjDiNfo9LUi9DEwMA2g==\", \"user\"=&gt;{\"drivers_license_front\"=&gt;#&lt;ActionDispatch::Http::UploadedFile:0x007fb8801431e8 @tempfile=#&lt;Tempfile:/var/folders/0p/3xq9qs1x6mv555tnlt6v9_p80000gn/T/RackMultipart20190902-38824-u77acs.png&gt;, @original_filename=\"is.png\", @content_type=\"image/png\", @headers=\"Content-Disposition: form-data; name=\\\"user[drivers_license_front]\\\"; filename=\\\"is.png\\\"\\r\\nContent-Type: image/png\\r\\n\"&gt;}, \"commit\"=&gt;\"Upload\"}\n</code></pre>\n\n<p>The terminal output from this puts the \"file uploaded\" message, but then if I go check the list of files I've uploaded to Stripe, the image is absent. I have the Stripe API key sent in my config, so I leave that part out from the code sample. </p>\n\n<p>Weirdly, I can open a url like in <a href=\"https://github.com/stripe/stripe-ruby/issues/710#issuecomment-444870324\" rel=\"nofollow noreferrer\">this example</a>, and submit to Stripe in my console. This works perfectly. The API returns the appropriate JSON response, and the image shows up in the call to <code>Stripe::File.list</code>.</p>\n\n<p>Why does it work in console, but not through params? What am I doing wrong?</p>\n"}, {"tags": ["javascript", "ruby"], "answers": [{"tags": [], "owner": {"reputation": 35558, "user_id": 3794812, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e0edf514cf8b70557fab4557205a956?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas Tower", "link": "https://stackoverflow.com/users/3794812/nicholas-tower"}, "is_accepted": true, "score": 1, "last_activity_date": 1566788139, "creation_date": 1566788139, "answer_id": 57651274, "question_id": 57651221, "link": "https://stackoverflow.com/questions/57651221/how-to-convert-this-function-from-ruby-to-javascript-so-it-will-look-the-same/57651274#57651274", "title": "How to convert this function from Ruby to JavaScript so it will look the same", "body": "<p>There isn't as nice a way to make a range of numbers from 1 to n, but here's one option: </p>\n\n<pre><code>Array.from({ length: num }, (_, i) =&gt; i + 1)\n</code></pre>\n\n<p>After that, instead of <code>.select</code> you'll use <code>.filter</code>, and then <code>.reduce</code> exists in both languages.</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>function findSum(num) {\r\n  return Array.from({ length: num }, (_, i) =&gt; i + 1)\r\n    .filter(n =&gt; n % 3 === 0 || n % 5 === 0)\r\n    .reduce((sum, n) =&gt; sum += n)\r\n}\r\n\r\nconsole.log(findSum(5))\r\nconsole.log(findSum(10))\r\nconsole.log(findSum(15))</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}], "owner": {"reputation": 216, "user_id": 11973242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57477d3180bb77297623c047603036f3?s=128&d=identicon&r=PG&f=1", "display_name": "Commando", "link": "https://stackoverflow.com/users/11973242/commando"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35, "favorite_count": 0, "accepted_answer_id": 57651274, "answer_count": 1, "score": -2, "last_activity_date": 1566788139, "creation_date": 1566787533, "question_id": 57651221, "link": "https://stackoverflow.com/questions/57651221/how-to-convert-this-function-from-ruby-to-javascript-so-it-will-look-the-same", "title": "How to convert this function from Ruby to JavaScript so it will look the same", "body": "<p>I wrote a simple function in Ruby that accepts a number and returns the sum of all multiples of 3 and 5 upto (and including) that number.</p>\n\n<p>For example:\nfindSum(5) returns 8 (because 3 + 5), </p>\n\n<p>findSum(10) returns 33 (because 3 + 5 + 6 + 9 + 10).</p>\n\n<p>findSum(15) returns 60 and so on:</p>\n\n<pre><code>def findSum(num)\n  (1..num).select { |n| n % 3 == 0 || n % 5 == 0 }.reduce { |sum, n| sum += n }\nend\n</code></pre>\n\n<p>Do you have any idea how to \"copy\" and \"convert\" that Ruby function into a JavaScript function so it will LOOK almost the same?</p>\n\n<p>I know JavaScript can solve it in many different ways, but for now as a beginner I may NOT understand most of them anyway, I just need to see the most similar way of coding that same function above in JavaScript.</p>\n"}]