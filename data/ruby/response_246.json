[{"tags": ["ruby-on-rails", "ruby"], "answers": [{"tags": [], "owner": {"reputation": 803, "user_id": 7654691, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8Gni.jpg?s=128&g=1", "display_name": "R. Sierra", "link": "https://stackoverflow.com/users/7654691/r-sierra"}, "is_accepted": true, "score": 1, "last_activity_date": 1569460122, "creation_date": 1569460122, "answer_id": 58108281, "question_id": 58107746, "link": "https://stackoverflow.com/questions/58107746/get-errors-when-creating-associations/58108281#58108281", "title": "Get errors when creating associations", "body": "<p>The validation is defined in <code>AppSetting</code> so it will add the errors to the class instance. Try this on the rails console:</p>\n\n<pre><code>s = AppSetting.new(id_monitoring_system: 'foo')\ns.valid?\n =&gt; false\ns.errors.full_messages # should output something like\n =&gt; ['id_monitoring_system must be an integer'\n</code></pre>\n\n<p>Depending on how you defined the association between <code>Event</code> and <code>AppSetting</code> in the <code>Event</code> class it may trigger a validation error. I would expect to have the association defined like so:</p>\n\n<pre><code>class Event &lt; ActiveRecord::Base\n  has_one :app_setting, required: true\n</code></pre>\n\n<p>That way when doing:</p>\n\n<pre><code>@event.build_app_setting(id_monitoring_system: 'foo')\n@event.save\n</code></pre>\n\n<p>It will cause <code>AppSetting</code> to fail the numericality validation and in turn <code>Event</code> will fail cause the association is required. But the error shown in <code>@event</code> will be <code>can't be blank</code>. To show the <code>AppSetting</code> validation error, you should add it to the parent class errors instance</p>\n\n<pre><code>if @event.save\n  render json: {status: 'created', message: 'Event save'}\nelse\n  @event.errors.add(:base, @event.app_setting.errors.full_messages)\n  render json: {status: false, errors: @event.errors.full_messages}\nend\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 11793890, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-uchYQCNY_YE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdwkDkJxzVzyJON_DoXWJWczDWLRQ/photo.jpg?sz=128", "display_name": "Jos&#233; Alejandro Cort&#233;s Segura", "link": "https://stackoverflow.com/users/11793890/jos%c3%a9-alejandro-cort%c3%a9s-segura"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 31, "favorite_count": 0, "accepted_answer_id": 58108281, "answer_count": 1, "score": 1, "last_activity_date": 1569460122, "creation_date": 1569454181, "question_id": 58107746, "link": "https://stackoverflow.com/questions/58107746/get-errors-when-creating-associations", "title": "Get errors when creating associations", "body": "<p>I have this validation in my <code>app_setting</code> model:</p>\n\n<pre><code>    class AppSetting &lt; ActiveRecord::Base\n      belongs_to :event\n      validates :id_monitoring_system, numericality: { only_integer: true }, allow_blank: true\n    end\n</code></pre>\n\n<p>I have a controller where I create events:</p>\n\n<pre><code>  def create\n    @event = Event.new(event_params)\n\n    unless params[:app_setting].nil?\n      app_setting = JSON.parse(params[:app_setting])\n      @event.build_app_setting(app_setting)\n    end\n\n    if @event.save\n      render json: {status: 'created', message: 'Event save'}\n    else\n      render json: {status: false, errors: @event.errors.full_messages}\n    end\n  end\n</code></pre>\n\n<p>I want to get the <code>app_setting</code> validation errors by the <code>id_monitoring_system</code> attribute and show them in my view</p>\n\n<p>when the attribute is not an integer the association is not created and does not show me the errors</p>\n\n<p>I tried:</p>\n\n<pre><code>    begin\n      unless params[:app_setting].nil?\n        app_setting = JSON.parse(params[:app_setting])\n        @event.create_app_setting!(app_setting)\n      end\n    rescue ActiveRecord::RecordInvalid =&gt; e\n      errors.add(:base, 'id_monitoring_system is integer')\n    end\n</code></pre>\n\n<p>But that doesn't work, how could I solve it?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "redmine", "redmine-plugins"], "owner": {"reputation": 409, "user_id": 3926428, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/af847b8b45e56cfef52f120a5b4cbc7e?s=128&d=identicon&r=PG&f=1", "display_name": "ylima", "link": "https://stackoverflow.com/users/3926428/ylima"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 52, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1569450756, "creation_date": 1569450756, "question_id": 58107359, "link": "https://stackoverflow.com/questions/58107359/how-to-solve-nameerror-for-queryassociationcolumn-on-redmine-plugin", "title": "How to solve NameError for QueryAssociationColumn on Redmine Plugin?", "body": "<p>I'm new to Ruby and Rails and was trying to create a simple patch plugin that includes another plugin's extra property as a column available when listing issues.</p>\n\n<p>Based on what I've read so far I wrote a new file at <code>lib/issue_query_patch.rb</code> containing:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>require_dependency 'issue_query'\n\nmodule IssueQueryPatch\n  def self.included(base) # :nodoc:\n    base.send(:include, InstanceMethods)\n\n    base.class_eval do\n      alias_method_chain :available_columns, :story_points\n    end\n  end\n\n  module InstanceMethods\n\n    # Adds the story points column to default the redmine issue query\n    def available_columns_with_story_points\n      columns = available_columns_without_story_points\n      columns &lt;&lt; get_story_points_column\n      return columns\n    end\n\n    def get_story_points_column\n      return @story_points_column if @story_points_column\n\n      @story_points_column = QueryAssociationColumn.new(:agile_data, :story_points, :caption =&gt; :label_agile_story_points)\n      @story_points_column\n    end\n  end\nend\n\nIssueQuery.send(:include, IssueQueryPatch)\n</code></pre>\n\n<p>But when I try to list my issues I get:</p>\n\n<blockquote>\n  <p>NameError (uninitialized constant IssueQueryPatch::InstanceMethods::QueryAssociationColumn):</p>\n</blockquote>\n\n<p>A similar approach using <code>QueryColumn</code> does not raise a NameError.</p>\n\n<p>Since both classes are declared at <code>app/models/query.rb</code> I'm clueless to why this is happening.</p>\n\n<p>How can I get rid of this error?</p>\n"}, {"tags": ["ruby-on-rails", "arrays", "ruby", "csv"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 11649729, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22c4d07a017ea932d8aeecc37a2de50b?s=128&d=identicon&r=PG&f=1", "display_name": "jennasaurusrex", "link": "https://stackoverflow.com/users/11649729/jennasaurusrex"}, "edited": false, "score": 0, "creation_date": 1569453296, "post_id": 58107581, "comment_id": 102605711, "body": "Thanks! I feel so stupid that I overlooked this, haha. My next question is that when I do this,  I get this error:  no implicit conversion of String into Integer  for this line:   puts &quot;first contact is #{c[&#39;last_name&#39;]}, second contact is #{contact_table[i + 1][&#39;last_name&#39;]}&quot;. Any ideas? I&#39;m still a bit lost."}, {"owner": {"reputation": 23, "user_id": 11649729, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22c4d07a017ea932d8aeecc37a2de50b?s=128&d=identicon&r=PG&f=1", "display_name": "jennasaurusrex", "link": "https://stackoverflow.com/users/11649729/jennasaurusrex"}, "edited": false, "score": 0, "creation_date": 1569454179, "post_id": 58107581, "comment_id": 102605879, "body": "I believed at first it was the latter. but now I can&#39;t even get <code>c[&#39;last_name&#39;]</code> to print out anything without raising that error. I&#39;ll update the question with a sample of the .csv."}, {"owner": {"reputation": 23, "user_id": 11649729, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22c4d07a017ea932d8aeecc37a2de50b?s=128&d=identicon&r=PG&f=1", "display_name": "jennasaurusrex", "link": "https://stackoverflow.com/users/11649729/jennasaurusrex"}, "edited": false, "score": 0, "creation_date": 1569454518, "post_id": 58107581, "comment_id": 102605939, "body": "Oh my gosh! I deleted <code>headers: true</code> by accident. Lol, I&#39;m sorry. I&#39;m so frazzled. However, I added in your code and now have a &quot;undefined method `[]&#39; for nil:NilClass&quot; error instead. My code looks like this:  <code>@contact_table.each_with_index do |c, i|   puts &quot;last names are #{c[&#39;last_name&#39;]}&quot;   puts &quot;next last name is #{@contact_table[i + 1][&#39;last_name&#39;]}&quot; end </code>"}], "tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": false, "score": 3, "last_activity_date": 1569463679, "last_edit_date": 1569463679, "creation_date": 1569452519, "answer_id": 58107581, "question_id": 58107288, "link": "https://stackoverflow.com/questions/58107288/iterating-through-csvrows/58107581#58107581", "title": "Iterating through CSV::Rows", "body": "<p><code>@contact_table</code> should be a <code>CSV::Table</code> which is a collection of <code>CSV::Row</code>s so in this:</p>\n\n<pre><code>@contact_table.each_with_index do |c, i|\n  ...\nend\n</code></pre>\n\n<p><code>c</code> is a <code>CSV::Row</code>. That's why <code>c['last_name']</code> works. The problem is that here:</p>\n\n<pre><code>c[i + 1]['last_name']\n</code></pre>\n\n<p>you're looking at <code>c</code> (a single row) instead of <code>@contact_table</code>, if you said:</p>\n\n<pre><code>@contact_table[i + 1]['last_name']\n</code></pre>\n\n<p>then you'd get the next last name or, when <code>c</code> is the last row, an exception because <code>@contact_table[i+1]</code> will be <code>nil</code>.</p>\n\n<p>Also, inside the iteration, <code>c</code> is the <em>current</em> (or <code>(i+1)</code>th) row and won't always be the first.</p>\n"}, {"tags": [], "owner": {"reputation": 1073, "user_id": 4024628, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Xc5J8.jpg?s=128&g=1", "display_name": "Allison", "link": "https://stackoverflow.com/users/4024628/allison"}, "is_accepted": false, "score": 1, "last_activity_date": 1569469112, "creation_date": 1569469112, "answer_id": 58109238, "question_id": 58107288, "link": "https://stackoverflow.com/questions/58107288/iterating-through-csvrows/58109238#58109238", "title": "Iterating through CSV::Rows", "body": "<p>What is your use case for this? Seems like a school project? </p>\n\n<p>I recommend <a href=\"https://ruby-doc.org/stdlib-2.6.1/libdoc/csv/rdoc/CSV.html#method-c-foreach\" rel=\"nofollow noreferrer\">for_each</a> instead of parse (see <a href=\"https://dalibornasevic.com/posts/68-processing-large-csv-files-with-ruby\" rel=\"nofollow noreferrer\">this comparison</a>). I would probably use a <a href=\"https://ruby-doc.org/stdlib-2.6.4/libdoc/set/rdoc/Set.html\" rel=\"nofollow noreferrer\">Set</a> for this. </p>\n\n<ul>\n<li>Create a Set outside of the scope of parsing the file (i.e., above the parsing code). Let's call it <code>rows</code>.</li>\n<li>Call <code>rows.include?(row)</code> during each iteration while parsing the file\n\n<ul>\n<li>If <code>true</code>, then you know you have a duplicate</li>\n<li>If false, then call <code>rows.add(row)</code> to add the new row to the set</li>\n</ul></li>\n</ul>\n\n<p>You could also just fill your set with an individual value from a column that must be distinct (e.g., <code>row.field(:some_column_name)</code>), such as email or phone number, and do the same inclusion check for that.</p>\n\n<p>(If this is for a real app, please don't do this. Use model <a href=\"https://guides.rubyonrails.org/active_record_validations.html\" rel=\"nofollow noreferrer\">validations</a> instead.)</p>\n"}, {"tags": [], "owner": {"reputation": 2251, "user_id": 9785060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IUduC.png?s=128&g=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/9785060/viktor"}, "is_accepted": false, "score": 0, "last_activity_date": 1569488355, "creation_date": 1569488355, "answer_id": 58113135, "question_id": 58107288, "link": "https://stackoverflow.com/questions/58107288/iterating-through-csvrows/58113135#58113135", "title": "Iterating through CSV::Rows", "body": "<p>I would use <a href=\"https://ruby-doc.org/stdlib-2.6.1/libdoc/csv/rdoc/CSV.html#method-c-read\" rel=\"nofollow noreferrer\"><code>#read</code></a> instead of <a href=\"https://ruby-doc.org/stdlib-2.6.1/libdoc/csv/rdoc/CSV.html#method-c-parse\" rel=\"nofollow noreferrer\"><code>#parse</code></a> and do something like this:</p>\n\n<pre><code>require 'csv'\nLASTNAME_INDEX = 2\ndata = CSV.read('data.csv')\n\ndata[1..-1].each_with_index do |row, index|\n  puts \"Contact number #{index + 1} has the following last name : #{row[LASTNAME_INDEX]}\"\nend\n\n#~&gt; Contact number 1 has the following last name : Canter\n#~&gt; Contact number 2 has the following last name : McArthur\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 11649729, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22c4d07a017ea932d8aeecc37a2de50b?s=128&d=identicon&r=PG&f=1", "display_name": "jennasaurusrex", "link": "https://stackoverflow.com/users/11649729/jennasaurusrex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 715, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1569488355, "creation_date": 1569450145, "last_edit_date": 1569454215, "question_id": 58107288, "link": "https://stackoverflow.com/questions/58107288/iterating-through-csvrows", "title": "Iterating through CSV::Rows", "body": "<p>I'm going to preface that I'm still learning ruby.</p>\n\n<p>I'm writing a script to parse a .csv and identify possible duplicate records in the data-set.</p>\n\n<p>I have a .csv file with headers, so I'm parsing the data so that I can access each row using a header title as such:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>@contact_table = CSV.parse(File.read(\"app/data/file.csv\"), headers: true)\n\n# Prints all last names in table\nputs contact_table['last_name']\n</code></pre>\n\n<p>I'm trying to iterate over each row in the table and identify if the last name I'm currently iterating over is similar to the next last name, but I'm having trouble doing this. I guess the way I'm handling it is as if it's an array, but I checked the type and it's a CSV::Row. </p>\n\n<p>example (this doesn't work):</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>@contact_table.each_with_index do |c, i|\n  puts \"first contact is #{c['last_name']}, second contact is #{c[i + 1]['last_name']}\"\nend\n</code></pre>\n\n<p>I realized this doesn't work like this because the table isn't an array, it's a CSV::Row like I previously mentioned. Is there any method that can achieve this? I'm really blanking right now.</p>\n\n<p>My csv looks something like this:</p>\n\n<pre><code>id,first_name,last_name,company,email,address1,address2,zip,city,state_long,state,phone\n1,Donalt,Canter,Gottlieb Group,dcanter0@nydailynews.com,9 Homewood Alley,,50335,Des Moines,Iowa,IA,515-601-4495\n2,Daphene,McArthur,\"West, Schimmel and Rath\",dmcarthur1@twitter.com,43 Grover Parkway,,30311,Atlanta,Georgia,GA,770-271-7837\n</code></pre>\n"}, {"tags": ["ruby", "coinbase-api"], "comments": [{"owner": {"reputation": 1400, "user_id": 6775560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a58c4e4004e0b4aa7d08a1d7cdd0b14?s=128&d=identicon&r=PG", "display_name": "Rodrigo Mata", "link": "https://stackoverflow.com/users/6775560/rodrigo-mata"}, "edited": false, "score": 0, "creation_date": 1592344726, "post_id": 58106602, "comment_id": 110391960, "body": "Did you find a solution?"}, {"owner": {"reputation": 614, "user_id": 7594860, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XyeJ0.png?s=128&g=1", "display_name": "ekr990011", "link": "https://stackoverflow.com/users/7594860/ekr990011"}, "reply_to_user": {"reputation": 1400, "user_id": 6775560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a58c4e4004e0b4aa7d08a1d7cdd0b14?s=128&d=identicon&r=PG", "display_name": "Rodrigo Mata", "link": "https://stackoverflow.com/users/6775560/rodrigo-mata"}, "edited": false, "score": 1, "creation_date": 1592432685, "post_id": 58106602, "comment_id": 110427619, "body": "Nope never did just decided not to use."}], "answers": [{"tags": [], "owner": {"reputation": 614, "user_id": 7594860, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XyeJ0.png?s=128&g=1", "display_name": "ekr990011", "link": "https://stackoverflow.com/users/7594860/ekr990011"}, "is_accepted": true, "score": 0, "last_activity_date": 1604786113, "creation_date": 1604786113, "answer_id": 64732815, "question_id": 58106602, "link": "https://stackoverflow.com/questions/58106602/coinbase-api-4-2-1-account-request-method-missing-parameter-type/64732815#64732815", "title": "Coinbase API 4.2.1 Account Request Method, Missing parameter: `type`", "body": "<p>They have actually deprecated this gem.</p>\n<p><a href=\"https://github.com/coinbase/coinbase-ruby/issues/124\" rel=\"nofollow noreferrer\">https://github.com/coinbase/coinbase-ruby/issues/124</a></p>\n"}], "owner": {"reputation": 614, "user_id": 7594860, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XyeJ0.png?s=128&g=1", "display_name": "ekr990011", "link": "https://stackoverflow.com/users/7594860/ekr990011"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 1, "accepted_answer_id": 64732815, "answer_count": 1, "score": 0, "last_activity_date": 1604786113, "creation_date": 1569446003, "last_edit_date": 1569446942, "question_id": 58106602, "link": "https://stackoverflow.com/questions/58106602/coinbase-api-4-2-1-account-request-method-missing-parameter-type", "title": "Coinbase API 4.2.1 Account Request Method, Missing parameter: `type`", "body": "<p>I am using the ruby gem that they have:\n<a href=\"https://github.com/coinbase/coinbase-ruby/tree/4.2.1\" rel=\"nofollow noreferrer\">https://github.com/coinbase/coinbase-ruby/tree/4.2.1</a></p>\n\n<p>This is the error I get after successfully using my api key to get get my primary account but then attempt to request a payment with it:</p>\n\n<pre><code>account.request(to: 'example@example.com', amount: '0.00001', currency: 'BTC')\nTraceback (most recent call last):\n       10: from /usr/share/rvm/rubies/ruby-2.6.4/bin/irb:23:in `&lt;main&gt;'\n        9: from /usr/share/rvm/rubies/ruby-2.6.4/bin/irb:23:in `load'\n        8: from /usr/share/rvm/rubies/ruby-2.6.4/lib/ruby/gems/2.6.0/gems/irb-1.0.0/exe/irb:11:in `&lt;top (required)&gt;'\n        7: from (irb):13\n        6: from (irb):13:in `rescue in irb_binding'\n        5: from /home/doom/.rvm/gems/ruby-2.6.4/gems/coinbase-4.2.1/lib/coinbase/wallet/models/account.rb:79:in `request'\n        4: from /home/doom/.rvm/gems/ruby-2.6.4/gems/coinbase-4.2.1/lib/coinbase/wallet/api_client.rb:302:in `request'\n        3: from /home/doom/.rvm/gems/ruby-2.6.4/gems/coinbase-4.2.1/lib/coinbase/wallet/api_client.rb:687:in `post'\n        2: from /home/doom/.rvm/gems/ruby-2.6.4/gems/coinbase-4.2.1/lib/coinbase/wallet/adapters/net_http.rb:36:in `http_verb'\n        1: from /home/doom/.rvm/gems/ruby-2.6.4/gems/coinbase-4.2.1/lib/coinbase/wallet/api_errors.rb:28:in `check_response_status'\nCoinbase::Wallet::ParamRequiredError (Missing parameter: `type`)\n</code></pre>\n\n<p>I have gone through byebug and when I get through the <code>gems/coinbase-4.2.1/lib/coinbase/wallet/api_client.rb:302:in</code>request'` method:</p>\n\n<pre><code>  def request(account_id, params = {})\n    [ :to, :amount, :currency ].each do |param|\n      raise APIError, \"Missing parameter: #{param}\" unless params.include? param\n    end\n    params['type'] = 'request'\n\n    out = nil\n    post(\"/v2/accounts/#{account_id}/transactions\", params) do |resp|\n      out = Request.new(self, resp.data)\n      yield(out, resp) if block_given?\n    end\n    out\n  end\n</code></pre>\n\n<p>I have the 'type' param added into my request. So I am unsure where this error is coming from and what I can do to move forward. Any insight would be appreciated.</p>\n\n<p>EDIT:\nA log out of me checking with byebug:</p>\n\n<pre><code>byebug; account.request(to: 'example@example.com', amount: '0.00001', currency: 'BTC')\n\n[74, 83] in /home/doom/.rvm/gems/ruby-2.6.4/gems/coinbase-4.2.1/lib/coinbase/wallet/models/account.rb\n   74:           yield(data, resp) if block_given?\n   75:         end\n   76:       end\n   77: \n   78:       def request(params = {})\n=&gt; 79:         @client.request(self['id'], params) do |data, resp|\n   80:           yield(data, resp) if block_given?\n   81:         end\n   82:       end\n   83: \n(byebug) step\n\n[291, 300] in /home/doom/.rvm/gems/ruby-2.6.4/gems/coinbase-4.2.1/lib/coinbase/wallet/api_client.rb\n   291:         end\n   292:         out\n   293:       end\n   294: \n   295:       def request(account_id, params = {})\n=&gt; 296:         [ :to, :amount, :currency ].each do |param|\n   297:           raise APIError, \"Missing parameter: #{param}\" unless params.include? param\n   298:         end\n   299:         params['type'] = 'request'\n   300: \n(byebug) eval params\n{:to=&gt;\"example@example.com\", :amount=&gt;\"0.00001\", :currency=&gt;\"BTC\"}\n(byebug) step\n\n[292, 301] in /home/doom/.rvm/gems/ruby-2.6.4/gems/coinbase-4.2.1/lib/coinbase/wallet/api_client.rb\n   292:         out\n   293:       end\n   294: \n   295:       def request(account_id, params = {})\n   296:         [ :to, :amount, :currency ].each do |param|\n=&gt; 297:           raise APIError, \"Missing parameter: #{param}\" unless params.include? param\n   298:         end\n   299:         params['type'] = 'request'\n   300: \n   301:         out = nil\n(byebug) \n\n[292, 301] in /home/doom/.rvm/gems/ruby-2.6.4/gems/coinbase-4.2.1/lib/coinbase/wallet/api_client.rb\n   292:         out\n   293:       end\n   294: \n   295:       def request(account_id, params = {})\n   296:         [ :to, :amount, :currency ].each do |param|\n=&gt; 297:           raise APIError, \"Missing parameter: #{param}\" unless params.include? param\n   298:         end\n   299:         params['type'] = 'request'\n   300: \n   301:         out = nil\n(byebug) \n\n[292, 301] in /home/doom/.rvm/gems/ruby-2.6.4/gems/coinbase-4.2.1/lib/coinbase/wallet/api_client.rb\n   292:         out\n   293:       end\n   294: \n   295:       def request(account_id, params = {})\n   296:         [ :to, :amount, :currency ].each do |param|\n=&gt; 297:           raise APIError, \"Missing parameter: #{param}\" unless params.include? param\n   298:         end\n   299:         params['type'] = 'request'\n   300: \n   301:         out = nil\n(byebug) \n\n[294, 303] in /home/doom/.rvm/gems/ruby-2.6.4/gems/coinbase-4.2.1/lib/coinbase/wallet/api_client.rb\n   294: \n   295:       def request(account_id, params = {})\n   296:         [ :to, :amount, :currency ].each do |param|\n   297:           raise APIError, \"Missing parameter: #{param}\" unless params.include? param\n   298:         end\n=&gt; 299:         params['type'] = 'request'\n   300: \n   301:         out = nil\n   302:         post(\"/v2/accounts/#{account_id}/transactions\", params) do |resp|\n   303:           out = Request.new(self, resp.data)\n(byebug) \n\n[296, 305] in /home/doom/.rvm/gems/ruby-2.6.4/gems/coinbase-4.2.1/lib/coinbase/wallet/api_client.rb\n   296:         [ :to, :amount, :currency ].each do |param|\n   297:           raise APIError, \"Missing parameter: #{param}\" unless params.include? param\n   298:         end\n   299:         params['type'] = 'request'\n   300: \n=&gt; 301:         post(\"/v2/accounts/#{account_id}/transactions\", params) do |resp|\n   303:           out = Request.new(self, resp.data)\n   304:           yield(out, resp) if block_given?\n   305:         end\n(byebug) eval params\n{:to=&gt;\"example@example.com\", :amount=&gt;\"0.00001\", :currency=&gt;\"BTC\", \"type\"=&gt;\"request\"}   out = nil\n   302:         post(\"/v2/accounts/#{account_id}/transactions\", params) do |resp|\n   303:           out = Request.new(self, resp.data)\n   304:           yield(out, resp) if block_given?\n   305:         end\n(byebug) eval params\n{:to=&gt;\"example@example.com\", :amount=&gt;\"0.00001\", :currency=&gt;\"BTC\", \"type\"=&gt;\"request\"}\n</code></pre>\n"}, {"tags": ["ruby", "sinatra"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1569444060, "post_id": 58106248, "comment_id": 102603285, "body": "Can you define &quot;errors in the browser&quot; better?"}, {"owner": {"reputation": 29, "user_id": 11700023, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f097ce507d0f4576425922c138cd1fdb?s=128&d=identicon&r=PG&f=1", "display_name": "Jessie Scinor", "link": "https://stackoverflow.com/users/11700023/jessie-scinor"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1569444124, "post_id": 58106248, "comment_id": 102603306, "body": "LoadError: cannot load such file -- aes"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1569444180, "post_id": 58106248, "comment_id": 102603324, "body": "You may need to use <code>gem &#39;aes&#39;</code> first."}, {"owner": {"reputation": 29, "user_id": 11700023, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f097ce507d0f4576425922c138cd1fdb?s=128&d=identicon&r=PG&f=1", "display_name": "Jessie Scinor", "link": "https://stackoverflow.com/users/11700023/jessie-scinor"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1569444333, "post_id": 58106248, "comment_id": 102603374, "body": "Placed <b>gem &#39;aes&#39;</b> on first line - 2 errors disappeared, 12 errors still exist"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1569444372, "post_id": 58106248, "comment_id": 102603387, "body": "Problem #1 solved. You&#39;ll need to describe the other problems in another question if you can, preferably with a lot more specificity, like the exact errors you&#39;re getting."}, {"owner": {"reputation": 29, "user_id": 11700023, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f097ce507d0f4576425922c138cd1fdb?s=128&d=identicon&r=PG&f=1", "display_name": "Jessie Scinor", "link": "https://stackoverflow.com/users/11700023/jessie-scinor"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1569444464, "post_id": 58106248, "comment_id": 102603416, "body": "No, <b>cannot load such file -- aes</b> still exists"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1569444710, "post_id": 58106248, "comment_id": 102603501, "body": "The code I&#39;ve put in my answer with <code>Gemfile</code> works on my machine with Ruby 2.6.3 and should work on yours."}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1569447643, "post_id": 58106248, "comment_id": 102604422, "body": "&quot;all time I see errors in browser&quot; is not a precise enough error description for us to help you. <i>What</i> doesn&#39;t work? <i>How</i> doesn&#39;t it work? What trouble do you have with your code? What is the error message? Is the result you are getting not the result you are expecting? What result do you expect and why, what is the result you are getting and how do the two differ? Is the behavior you are observing not the desired behavior? What is the desired behavior and why, what is the observed behavior, and in what way do they differ?"}, {"owner": {"reputation": 29, "user_id": 11700023, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f097ce507d0f4576425922c138cd1fdb?s=128&d=identicon&r=PG&f=1", "display_name": "Jessie Scinor", "link": "https://stackoverflow.com/users/11700023/jessie-scinor"}, "reply_to_user": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1569499655, "post_id": 58106248, "comment_id": 102622022, "body": "@J&#246;rgWMittag nice catch"}], "answers": [{"comments": [{"owner": {"reputation": 29, "user_id": 11700023, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f097ce507d0f4576425922c138cd1fdb?s=128&d=identicon&r=PG&f=1", "display_name": "Jessie Scinor", "link": "https://stackoverflow.com/users/11700023/jessie-scinor"}, "edited": false, "score": 1, "creation_date": 1569444751, "post_id": 58106324, "comment_id": 102603519, "body": "Thank you very much, I changed it, didn&#39;t help, then restarted server - voila))"}, {"owner": {"reputation": 40236, "user_id": 923315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/j6lLI.jpg?s=128&g=1", "display_name": "peter", "link": "https://stackoverflow.com/users/923315/peter"}, "reply_to_user": {"reputation": 29, "user_id": 11700023, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f097ce507d0f4576425922c138cd1fdb?s=128&d=identicon&r=PG&f=1", "display_name": "Jessie Scinor", "link": "https://stackoverflow.com/users/11700023/jessie-scinor"}, "edited": false, "score": 0, "creation_date": 1569447199, "post_id": 58106324, "comment_id": 102604283, "body": "@JessieScinor use rerun to automatically restart your Sinatra server when you change some sourcecode <a href=\"https://rubygems.org/gems/rerun/versions/0.11.0\" rel=\"nofollow noreferrer\">rubygems.org/gems/rerun/versions/0.11.0</a>"}, {"owner": {"reputation": 29, "user_id": 11700023, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f097ce507d0f4576425922c138cd1fdb?s=128&d=identicon&r=PG&f=1", "display_name": "Jessie Scinor", "link": "https://stackoverflow.com/users/11700023/jessie-scinor"}, "reply_to_user": {"reputation": 40236, "user_id": 923315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/j6lLI.jpg?s=128&g=1", "display_name": "peter", "link": "https://stackoverflow.com/users/923315/peter"}, "edited": false, "score": 0, "creation_date": 1569499629, "post_id": 58106324, "comment_id": 102622010, "body": "@peter I used shotgun for auto reloading"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1569522435, "post_id": 58106324, "comment_id": 102634003, "body": "Most auto-reloaders only watch for changes in particular files, and things like <code>Gemfile</code> require hard stopping and starting since it changes the fundamentals."}, {"owner": {"reputation": 40236, "user_id": 923315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/j6lLI.jpg?s=128&g=1", "display_name": "peter", "link": "https://stackoverflow.com/users/923315/peter"}, "edited": false, "score": 0, "creation_date": 1569527250, "post_id": 58106324, "comment_id": 102636145, "body": "rerun is configurable for the extensions it needs to watch, used to use sinatra/reloader but it has issues when using active record and daemons"}], "tags": [], "owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "is_accepted": true, "score": 1, "last_activity_date": 1569444440, "creation_date": 1569444440, "answer_id": 58106324, "question_id": 58106248, "link": "https://stackoverflow.com/questions/58106248/how-to-encode-string-in-sinatra-using-aes/58106324#58106324", "title": "How to encode string in sinatra using AES?", "body": "<p>When using Ruby gems you need to declare them up-front. The easiest way is:</p>\n\n<pre><code>gem 'aes'\nrequire 'aes'\n</code></pre>\n\n<p>You can also use <a href=\"https://bundler.io\" rel=\"nofollow noreferrer\">Bundler</a> and declare them in a <code>Gemfile</code> like:</p>\n\n<pre><code>source 'https://rubygems.org/'\n\ngem 'aes'\n</code></pre>\n\n<p>Then in your code:</p>\n\n<pre><code>require 'bundler/setup'\n\nrequire 'aes'\n</code></pre>\n\n<p>Where <code>Gemfile</code> describes all your dependencies so you can easily reinstall them if necessary.</p>\n\n<p>Once you've created the <code>Gemfile</code> you can do <code>bundle install</code>. If that has issues you'll be alerted. <code>bundle check</code> can verify everything's set up properly.</p>\n"}], "owner": {"reputation": 29, "user_id": 11700023, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f097ce507d0f4576425922c138cd1fdb?s=128&d=identicon&r=PG&f=1", "display_name": "Jessie Scinor", "link": "https://stackoverflow.com/users/11700023/jessie-scinor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 58106324, "answer_count": 1, "score": 0, "last_activity_date": 1569444440, "creation_date": 1569444026, "last_edit_date": 1569444077, "question_id": 58106248, "link": "https://stackoverflow.com/questions/58106248/how-to-encode-string-in-sinatra-using-aes", "title": "How to encode string in sinatra using AES?", "body": "<p>Spent a lot of my time searching a way of ecrypting string in my app, but didn't find a right solution to use it in Sinatra. For example, I tried to 'require aes' gem (<a href=\"https://github.com/chicks/aes\" rel=\"nofollow noreferrer\">https://github.com/chicks/aes</a>) also gibberish (<a href=\"https://github.com/defunkt/gibberish/blob/master/lib/gibberish.rb\" rel=\"nofollow noreferrer\">https://github.com/defunkt/gibberish/blob/master/lib/gibberish.rb</a>) gem but all time I see errors in browser.</p>\n\n<p>I try to encrypt message field in my app: </p>\n\n<pre><code>require 'aes'\n\nget '/auth/signup' do\n  user = User.new(url: Helpers.random, message: AES.encrypt(\"A super secret message\", 'Here we go!'))\n  user.save\nend\n</code></pre>\n\n<p>Please, help me how to solve this?!</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-5"], "comments": [{"owner": {"reputation": 759, "user_id": 4352003, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I0GKg.jpg?s=128&g=1", "display_name": "Yury Matusevich", "link": "https://stackoverflow.com/users/4352003/yury-matusevich"}, "edited": false, "score": 0, "creation_date": 1569443523, "post_id": 58105932, "comment_id": 102603090, "body": "please add code from favorites controller and link/form you click."}, {"owner": {"reputation": 2060, "user_id": 3944700, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4df64cd1de5941fb49263a19d80f1482?s=128&d=identicon&r=PG&f=1", "display_name": "hashrocket", "link": "https://stackoverflow.com/users/3944700/hashrocket"}, "edited": false, "score": 0, "creation_date": 1569457882, "post_id": 58105932, "comment_id": 102606508, "body": "Can you show your favorites controller?"}], "answers": [{"comments": [{"owner": {"reputation": 193, "user_id": 11020140, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbcae66fef24695f210144e178acd7d6?s=128&d=identicon&r=PG&f=1", "display_name": "hannah", "link": "https://stackoverflow.com/users/11020140/hannah"}, "edited": false, "score": 0, "creation_date": 1569447180, "post_id": 58106163, "comment_id": 102604276, "body": "I actually do have the class"}, {"owner": {"reputation": 303, "user_id": 9479253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cd34f4996365a59ad414df6950d6d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ashok Damaniya", "link": "https://stackoverflow.com/users/9479253/ashok-damaniya"}, "reply_to_user": {"reputation": 193, "user_id": 11020140, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbcae66fef24695f210144e178acd7d6?s=128&d=identicon&r=PG&f=1", "display_name": "hannah", "link": "https://stackoverflow.com/users/11020140/hannah"}, "edited": false, "score": 0, "creation_date": 1569474160, "post_id": 58106163, "comment_id": 102609593, "body": "can you provide your file favorites_controller.rb location and the controllers def @hannah"}, {"owner": {"reputation": 943, "user_id": 546950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60de781d84a6767b10c5040c54180433?s=128&d=identicon&r=PG", "display_name": "robertoplancarte", "link": "https://stackoverflow.com/users/546950/robertoplancarte"}, "edited": false, "score": 0, "creation_date": 1569513033, "post_id": 58106163, "comment_id": 102629712, "body": "try getting the FavoritesController to load in the rails console. Just run <code>rails console</code> and inside do <code>FavoritesController</code> if you get an <code>uninitialized constant FavoritesController</code> error then go back and make sure the spelling is right in file name and the class definition. The file must be <code>app&#47;controllers&#47;favorites_controller.rb</code> so that the class inside is autoloaded"}], "tags": [], "owner": {"reputation": 943, "user_id": 546950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60de781d84a6767b10c5040c54180433?s=128&d=identicon&r=PG", "display_name": "robertoplancarte", "link": "https://stackoverflow.com/users/546950/robertoplancarte"}, "is_accepted": false, "score": 0, "last_activity_date": 1569443966, "last_edit_date": 1569443966, "creation_date": 1569443633, "answer_id": 58106163, "question_id": 58105932, "link": "https://stackoverflow.com/questions/58105932/i-am-getting-an-routing-error-message-from-an-application-i-am-creating/58106163#58106163", "title": "I am getting an routing error message from an application I am creating", "body": "<p>It looks like you haven't created the <code>FavoritesController</code> class. Create <code>app/controllers/favorites_controller.rb</code> and define the controller with an index action. Assuming you have a Favorite model class you can do this:</p>\n\n<pre><code>class FavoritesController &lt; ApplicationController\n  def index\n    @favorites = Favorite.all #uses Favorite model\n  end\nend\n</code></pre>\n\n<p>After that you could get an error from the view if you don't have a view set up for the index action in <code>/app/views/favorites/index.html.erb</code> you could just create that file and it will have access to <code>@favorites</code> from the controller. </p>\n\n<p>You could generate all of this running this generator in your console:</p>\n\n<pre><code>rails generate controller Favorites index\n</code></pre>\n\n<p>And changing the generated route.</p>\n"}, {"tags": [], "owner": {"reputation": 151, "user_id": 11964190, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTnbD.png?s=128&g=1", "display_name": "zakariah1", "link": "https://stackoverflow.com/users/11964190/zakariah1"}, "is_accepted": false, "score": 0, "last_activity_date": 1569522025, "creation_date": 1569522025, "answer_id": 58122637, "question_id": 58105932, "link": "https://stackoverflow.com/questions/58105932/i-am-getting-an-routing-error-message-from-an-application-i-am-creating/58122637#58122637", "title": "I am getting an routing error message from an application I am creating", "body": "<p>Assuming that you have a controller, does the error go away if you add the following to your routes file?  Would it be possible for you to run \"rake routes\" and post the output?</p>\n\n<pre><code>resources: favorites\n</code></pre>\n"}], "owner": {"reputation": 193, "user_id": 11020140, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbcae66fef24695f210144e178acd7d6?s=128&d=identicon&r=PG&f=1", "display_name": "hannah", "link": "https://stackoverflow.com/users/11020140/hannah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1569522025, "creation_date": 1569442278, "last_edit_date": 1569447127, "question_id": 58105932, "link": "https://stackoverflow.com/questions/58105932/i-am-getting-an-routing-error-message-from-an-application-i-am-creating", "title": "I am getting an routing error message from an application I am creating", "body": "<p>I included <code>get '/favorites', to: 'favorites#index'</code> in my <code>config/routes.rb</code> and I am getting an error and im not really sure what the issue is </p>\n\n<pre><code>ActionController::RoutingError (uninitialized constant FavoritesController):\n\nbootsnap (1.4.4) lib/bootsnap/load_path_cache/core_ext/active_support.rb:79:in `block in load_missing_constant'\nbootsnap (1.4.4) lib/bootsnap/load_path_cache/core_ext/active_support.rb:8:in `without_bootsnap_cache'\nbootsnap (1.4.4) lib/bootsnap/load_path_cache/core_ext/active_support.rb:79:in `rescue in load_missing_constant'\nbootsnap (1.4.4) lib/bootsnap/load_path_cache/core_ext/active_support.rb:58:in `load_missing_constant'\nactivesupport (5.2.3) lib/active_support/inflector/methods.rb:283:in `const_get'\nactivesupport (5.2.3) lib/active_support/inflector/methods.rb:283:in `block in constantize'\nactivesupport (5.2.3) lib/active_support/inflector/methods.rb:281:in `each'\nactivesupport (5.2.3) lib/active_support/inflector/methods.rb:281:in `inject'\nactivesupport (5.2.3) lib/active_support/inflector/methods.rb:281:in `constantize'\nactionpack (5.2.3) lib/action_dispatch/http/request.rb:88:in `controller_class_for'\nactionpack (5.2.3) lib/action_dispatch/http/request.rb:81:in `controller_class'\nactionpack (5.2.3) lib/action_dispatch/routing/route_set.rb:46:in `controller'\nactionpack (5.2.3) lib/action_dispatch/routing/route_set.rb:32:in `serve'\nactionpack (5.2.3) lib/action_dispatch/journey/router.rb:52:in `block in serve'\nactionpack (5.2.3) lib/action_dispatch/journey/router.rb:35:in `each'\n</code></pre>\n\n<p>this is half of the error message, I chose not to post the whole entire thing because it may be too long for stack overflow</p>\n"}, {"tags": ["ruby", "macos"], "comments": [{"owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 1, "creation_date": 1569434664, "post_id": 58104136, "comment_id": 102599492, "body": "<a href=\"https://developer.apple.com/documentation/macos_release_notes/macos_catalina_10_15_beta_9_release_notes\" rel=\"nofollow noreferrer\">Scripting language runtimes such as Python, Ruby, and Perl are included in macOS for compatibility with legacy software. Future versions of macOS won\u2019t include scripting language runtimes by default, and might require you to install additional packages. If your software depends on scripting languages, it\u2019s recommended that you bundle the runtime within the app.</a>. Use something else to manage Ruby versions (rbenv, rvm, asdf, etc)."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1569435960, "post_id": 58104136, "comment_id": 102600012, "body": "OS X doesn&#39;t know which version(s) of Ruby you want to use (some Rubyists are still stuck on a decade-old version 1.8.x, usually not by choice), so no, the version is not automatically updated.  It&#39;s not version updating anyway, it&#39;s installing newer versions, which generally also requires that newer dependencies (e.g., gems) be installed as well, a task that is beyond every OS&#39;s  capabilities."}, {"owner": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "edited": false, "score": 1, "creation_date": 1569436239, "post_id": 58104136, "comment_id": 102600125, "body": "Install RVM with <code>\\curl -sSL https:&#47;&#47;get.rvm.io | bash -s stable</code>; restart your shell; install Ruby with <code>rvm install 2.6</code>. <a href=\"https://robots.thoughtbot.com/psa-do-not-use-system-ruby\" rel=\"nofollow noreferrer\">Don&#39;t</a> <a href=\"https://chrisherring.co/posts/why-you-shouldn-t-use-the-system-ruby\" rel=\"nofollow noreferrer\">use</a> <a href=\"http://billpatrianakos.me/blog/2014/05/15/never-use-system-ruby-ever/\" rel=\"nofollow noreferrer\">system Ruby</a>."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "reply_to_user": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "edited": false, "score": 0, "creation_date": 1569436983, "post_id": 58104136, "comment_id": 102600428, "body": "Further to @anothermh&#39;s comment, see the RVM docs at rvm.io."}], "answers": [{"tags": [], "owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "is_accepted": false, "score": 3, "last_activity_date": 1569438863, "creation_date": 1569438863, "answer_id": 58105158, "question_id": 58104136, "link": "https://stackoverflow.com/questions/58104136/do-you-need-to-update-ruby-manually-on-a-mac/58105158#58105158", "title": "Do you need to update Ruby manually on a Mac?", "body": "<blockquote>\n  <p>I assume when you get a new Mac it comes with the latest stable release of Ruby.</p>\n</blockquote>\n\n<p>No, it comes with whatever release Apple felt confident to support for the lifetime of the OS release.</p>\n\n<blockquote>\n  <p>Do you have to update it yourself manually over time, or does it get upgraded automatically when you upgrade your OS?</p>\n</blockquote>\n\n<p>Those two are not mutually exclusive.</p>\n\n<p>Yes, it does get upgraded automatically, in order to, e.g., patch security vulnerabilities. However, an OS vendor will generally avoid updating anything they ship as part of the OS as much as possible, since they generally guarantee backwards-compatibility, and the easiest way to guarantee backwards-compatibility for third-party code that you have no control over, is to just not change it.</p>\n\n<p>For example, macOS 10.14.6, which is the current release of macOS and was released 4 weeks ago, ships with Ruby 2.3.7, which was released 18 months ago.</p>\n\n<p>The last release of Ruby 2.3 was Ruby 2.3.8, and the Ruby developers stopped providing security patches to Ruby 2.3 6 months ago. (Note that Apple <em>does</em> still provide security patches for Ruby 2.3 as part of macOS, though.)</p>\n\n<p>So, yes, it does get upgraded automatically, with e.g. security fixes, but if you want a different version than the one shipped with the OS, you have to install it yourself.</p>\n"}, {"tags": [], "owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "is_accepted": false, "score": 3, "last_activity_date": 1569440944, "creation_date": 1569440944, "answer_id": 58105622, "question_id": 58104136, "link": "https://stackoverflow.com/questions/58104136/do-you-need-to-update-ruby-manually-on-a-mac/58105622#58105622", "title": "Do you need to update Ruby manually on a Mac?", "body": "<p>Short answer: <em>No.</em></p>\n\n<p>Long answer:</p>\n\n<p>If you just want a taste of Ruby, then no, you really don't need to do anything.</p>\n\n<p>If you want to <em>use</em> Ruby to do something non-trivial, like beyond a \"Hello, world!\" application, then yes you should update.</p>\n\n<p>The best approach is to use a Ruby version manager like <a href=\"https://rvm.io\" rel=\"nofollow noreferrer\">RVM</a> or <a href=\"https://github.com/sstephenson/rbenv\" rel=\"nofollow noreferrer\"><code>rbenv</code></a> where you can get the latest version of Ruby, specific historical versions if necessary for testing, as well as alternate implementations like <a href=\"https://www.jruby.org\" rel=\"nofollow noreferrer\">JRuby</a> and <a href=\"https://rubinius.com\" rel=\"nofollow noreferrer\">Rubinius</a>.</p>\n\n<p>These version managers make it possible to have <em>multiple versions of Ruby installed simultaneously</em> and you can switch between at any time. You can even pin different projects at specific versions if they haven't been updated to work with the latest Ruby, a common problem with older code-bases.</p>\n\n<p>This pattern plays out with any language, be it Ruby, Python, Perl, Node.js, C# or what have you. If you're doing serious development in those languages the first thing you do is install a version manager and the best version for your situation.</p>\n"}], "owner": {"reputation": 2824, "user_id": 10864356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/315465d723d17533b95c0615fd7201cc?s=128&d=identicon&r=PG&f=1", "display_name": "gkeenley", "link": "https://stackoverflow.com/users/10864356/gkeenley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 962, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1569440944, "creation_date": 1569434381, "question_id": 58104136, "link": "https://stackoverflow.com/questions/58104136/do-you-need-to-update-ruby-manually-on-a-mac", "title": "Do you need to update Ruby manually on a Mac?", "body": "<p>Ruby comes automatically installed on OS X. I assume when you get a new Mac it comes with the latest stable release of Ruby. Do you have to update it yourself manually over time, or does it get upgraded automatically when you upgrade your OS?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "haml"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 12120723, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAGNt7cT_QgizLFBobOb9ijAr8xjL723DWuEiZc=k-s128", "display_name": "Alex", "link": "https://stackoverflow.com/users/12120723/alex"}, "edited": false, "score": 0, "creation_date": 1569435840, "post_id": 58104018, "comment_id": 102599960, "body": "Ouuu Yeee, Thanks I realized that it was indented, but I tried various options, but your worker, thanks a lot, Apparently I&#39;m too dumb :)"}], "tags": [], "owner": {"reputation": 759, "user_id": 4352003, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I0GKg.jpg?s=128&g=1", "display_name": "Yury Matusevich", "link": "https://stackoverflow.com/users/4352003/yury-matusevich"}, "is_accepted": true, "score": 0, "last_activity_date": 1569433867, "creation_date": 1569433867, "answer_id": 58104018, "question_id": 58103926, "link": "https://stackoverflow.com/questions/58103926/problem-with-haml-i-study-ruby-on-rails-stumbled-where-with-the-following/58104018#58104018", "title": "problem with haml I study Ruby on rails stumbled where with the following", "body": "<p>HAML is indentation sensitive. From the screenshot I see that the problem is in indentations.</p>\n\n<p>That should work:</p>\n\n<pre><code>- @posts.each do |post|\n  = link_to(image_tag post.image.url(:small))\n  %h2= link_to post.title, post\n= link_to \"Add New Inspiration\", new_post_path\n</code></pre>\n\n<p>Make sure you have two spaces before line 2 and 3.</p>\n"}], "owner": {"reputation": 1, "user_id": 12120723, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAGNt7cT_QgizLFBobOb9ijAr8xjL723DWuEiZc=k-s128", "display_name": "Alex", "link": "https://stackoverflow.com/users/12120723/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 58104018, "answer_count": 1, "score": -2, "last_activity_date": 1581307105, "creation_date": 1569433427, "last_edit_date": 1581307105, "question_id": 58103926, "link": "https://stackoverflow.com/questions/58103926/problem-with-haml-i-study-ruby-on-rails-stumbled-where-with-the-following", "title": "problem with haml I study Ruby on rails stumbled where with the following", "body": "<p>NameError in Posts#index\nShowing /home/alexandr/Huntjob/app/views/posts/index.html.haml where line #4 raised:</p>\n\n<p>undefined local variable or method `haml_temp' for #&lt;#:0x00005621a21d4538>\nDid you mean?  haml_tag\n<a href=\"https://i.stack.imgur.com/pRvl7.png\" rel=\"nofollow noreferrer\">enter image description here</a></p>\n\n<p><strong>Code where an error occurs</strong></p>\n\n<pre><code>- @posts.each do |post|\n=link_to (image_tag post.image.url(:small))\n%h2= link_to post.title, post\n= link_to \"Add New Inspiration\", new_post_path\n</code></pre>\n\n<p><strong>Post controller</strong></p>\n\n<pre><code>class PostsController &lt; ApplicationController\nbefore_action :find_post, only: [:show, :edit, :update, :destroy]\nbefore_action :authenticate_user!, except: [:index, :show]\n\ndef index\n@posts = Post.all.order(\"created_at\")\n\nend\n\ndef show\n\nend\n\ndef new\n@post = current_user.posts.build\nend\n\ndef create\n@post = current_user.posts.build(post_params)\n\nif @post.save\n  redirect_to @post\nelse\n  render 'new'\nend\nend\n\ndef edit\nend\n\ndef update\nif @post.update(post_params)\n  redirect_to @post\nelse\n  render 'edit'\nend\nend\n\ndef destroy\n @post.destroy\n redirect_to root_path\n\n end\n\n private\n\n def find_post\n  @post = Post.find(params[:id])\n  end\n\n  def post_params\n\n  params.require(:post).permit(:title, :link, :description, :image)\n  end\n\n\n   end\n</code></pre>\n"}, {"tags": ["ruby"], "answers": [{"tags": [], "owner": {"reputation": 1200, "user_id": 10408280, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c7bbad62395ab7dcf79bd70d02f569e?s=128&d=identicon&r=PG&f=1", "display_name": "Mike", "link": "https://stackoverflow.com/users/10408280/mike"}, "is_accepted": false, "score": 1, "last_activity_date": 1569434840, "last_edit_date": 1569434840, "creation_date": 1569432983, "answer_id": 58103814, "question_id": 58103738, "link": "https://stackoverflow.com/questions/58103738/how-to-convert-a-ruby-hash-into-a-string-with-a-specific-format/58103814#58103814", "title": "How to convert a ruby hash into a string with a specific format", "body": "<p>One starting point might be to use JSON formatter:</p>\n\n<pre><code>require 'json'\ninput = {\"test_key\"=&gt;\"test_value\", \"test_key2\"=&gt;\"test_value2\"}\nJSON.pretty_generate(input)\n\n=&gt; \"{\\n  \\\"test_key\\\": \\\"test_value\\\",\\n  \\\"test_key2\\\": \\\"test_value2\\\"\\n}\"\n</code></pre>\n\n<p>This has some subtle differences, since it looks like you use <code>=</code> as opposed to <code>:</code>.  That said, perhaps it's easier to work from this than from what you have. </p>\n\n<h3>Working with JSON</h3>\n\n<pre><code>JSON.pretty_generate(input).gsub(/:/,' =').gsub(/,(?=\\n)/, ';').gsub(/(;\\n|\\n)\\s+/, '\\1'+\"\\t\")\n\n=&gt; \"{\\n\\t\\\"test_key\\\" = \\\"test_value\\\";\\n\\t\\\"test_key2\\\" = \\\"test_value2\\\"\\n}\"\n</code></pre>\n\n<h3>Custom Formatter</h3>\n\n<p>Of course you could define your custom formatter:</p>\n\n<pre><code>def formatter(hash)\n  output = \"\"\n  output += \"{\\n\\t\" \n  output += hash.entries.map{|a| \"\\\"#{a[0]}\\\" = \\\"#{a[1]}\\\"\" }.join(\";\\n\\t\")\n  output += \";\\n}\"\nend\n\nformatter( input )\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 308, "user_id": 2218094, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PnUld.jpg?s=128&g=1", "display_name": "SgtPepper", "link": "https://stackoverflow.com/users/2218094/sgtpepper"}, "edited": false, "score": 0, "creation_date": 1569435766, "post_id": 58104231, "comment_id": 102599916, "body": "Any idea why I&#39;m getting the <code>+</code> signs in the output? I&#39;m using the rails console <code>&quot;{\\n&quot; + &quot;\\t\\&quot;test_key\\&quot; = \\&quot;test_value\\&quot;;\\n&quot; + &quot;\\t\\&quot;test_key2\\&quot; = \\&quot;test_value2\\&quot;;\\n&quot; + &quot;}&quot;</code>"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "reply_to_user": {"reputation": 308, "user_id": 2218094, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PnUld.jpg?s=128&g=1", "display_name": "SgtPepper", "link": "https://stackoverflow.com/users/2218094/sgtpepper"}, "edited": false, "score": 0, "creation_date": 1569436199, "post_id": 58104231, "comment_id": 102600112, "body": "Are you sure you aren&#39;t looking at what you entered rather than the return value? Since you tried that I changed <code>+</code> to <code>&lt;&lt;</code> to make it slightly more efficient. Please try again with the current version. Also, confirm <code>input</code> has the correct value."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "reply_to_user": {"reputation": 308, "user_id": 2218094, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PnUld.jpg?s=128&g=1", "display_name": "SgtPepper", "link": "https://stackoverflow.com/users/2218094/sgtpepper"}, "edited": false, "score": 1, "creation_date": 1569436828, "post_id": 58104231, "comment_id": 102600361, "body": "Thanks for the greenie but it&#39;s best to wait awhile, mainly to avoid discouraging other readers from posting answers, but also to allow readers still working on their answers to complete them. Most here wait at least a couple of hours before making a selection; some wait until then-sleeping readers around the world have tuned into SO. There&#39;s no rush. Feel free to retract the checkmark if you wish to do so."}], "tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": true, "score": 2, "last_activity_date": 1569435140, "last_edit_date": 1569435140, "creation_date": 1569434774, "answer_id": 58104231, "question_id": 58103738, "link": "https://stackoverflow.com/questions/58103738/how-to-convert-a-ruby-hash-into-a-string-with-a-specific-format/58104231#58104231", "title": "How to convert a ruby hash into a string with a specific format", "body": "<pre><code>input = {\"test_key\"=&gt;\"test_value\", \"test_key2\"=&gt;\"test_value2\"}\n</code></pre>\n\n<h1><p></p></h1>\n\n<pre><code>\"{\" &lt;&lt; input.map { |k,v| \"\\n\\t\\\"#{k}\\\" = \\\"#{v}\\\"\" }.join(';') &lt;&lt; \";\\n}\"\n  #=&gt; \"{\\n\\t\\\"test_key\\\" = \\\"test_value\\\";\\n\\t\\\"test_key2\\\" = \\\"test_value2\\\";\\n}\"\n</code></pre>\n\n<p>The steps are as follows.</p>\n\n<pre><code>a = input.map { |k,v| \"\\n\\t\\\"#{k}\\\" = \\\"#{v}\\\"\" }\n  #=&gt; [\"\\n\\t\\\"test_key\\\" = \\\"test_value\\\"\", \"\\n\\t\\\"test_key2\\\" = \\\"test_value2\\\"\"] \nb = a.join(';')\n  #=&gt; \"\\n\\t\\\"test_key\\\" = \\\"test_value\\\";\\n\\t\\\"test_key2\\\" = \\\"test_value2\\\"\"\n\"{\" &lt;&lt; b &lt;&lt; \";\\n}\"\n  #=&gt; \"{\\n\\t\\\"test_key\\\" = \\\"test_value\\\";\\n\\t\\\"test_key2\\\" = \\\"test_value2\\\";\\n}\" \n</code></pre>\n\n<p><code>input</code> may contain any number of key-value pairs that adhere to the indicated pattern.</p>\n"}], "owner": {"reputation": 308, "user_id": 2218094, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PnUld.jpg?s=128&g=1", "display_name": "SgtPepper", "link": "https://stackoverflow.com/users/2218094/sgtpepper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 58104231, "answer_count": 2, "score": 1, "last_activity_date": 1569435140, "creation_date": 1569432623, "question_id": 58103738, "link": "https://stackoverflow.com/questions/58103738/how-to-convert-a-ruby-hash-into-a-string-with-a-specific-format", "title": "How to convert a ruby hash into a string with a specific format", "body": "<p>This is the hash I'm trying to format </p>\n\n<pre><code>input = {\"test_key\"=&gt;\"test_value\", \"test_key2\"=&gt;\"test_value2\"}\n</code></pre>\n\n<p>And this is the expected result</p>\n\n<pre><code>\"{\\n\\t\\\"test_key\\\" = \\\"test_value\\\";\\n\\t\\\"test_key2\\\" = \\\"test_value2\\\";\\n}\"\n</code></pre>\n\n<p>I have the following code so far</p>\n\n<pre><code>def format_hash(hash)\n  output = \"\"\n  hash.to_s.split(',').each do |k|\n    new_string = k + ';'\n    new_string.gsub!('=&gt;', ' = ')\n    output += new_string\n  end\nend\n</code></pre>\n\n<p>which gives me the this output</p>\n\n<pre><code>output = \"{\\\"test_key\\\" = \\\"test_value\\\"; \\\"test_key2\\\" = \\\"test_value2\\\"};\"\n</code></pre>\n\n<p>But I'm still struggling with adding the rest. Any ideas/suggestions?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "rspec", "rspec-rails"], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2012677, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/8d7cb2fe712fb17f44f8c354bf37e7b5?s=128&d=identicon&r=PG&f=1", "display_name": "user2012677", "link": "https://stackoverflow.com/users/2012677/user2012677"}, "edited": false, "score": 0, "creation_date": 1569428334, "post_id": 58102627, "comment_id": 102596731, "body": "I tried, but got .. #&lt;ListingsQuery::Search (class)&gt; expected to have received base_filters, but that object is not a spy or method has not been stubbed."}], "tags": [], "owner": {"reputation": 5312, "user_id": 6535997, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/10156345016155058/picture?type=large", "display_name": "Mark", "link": "https://stackoverflow.com/users/6535997/mark"}, "is_accepted": false, "score": 1, "last_activity_date": 1569428048, "creation_date": 1569428048, "answer_id": 58102627, "question_id": 58102200, "link": "https://stackoverflow.com/questions/58102200/rspec-failure-of-spy-to-detect-method-call-my-pattern-is-wrong/58102627#58102627", "title": "Rspec: Failure of spy to detect method call (my pattern is wrong)", "body": "<p>I think you're assigning the variable <code>so</code> to the result of <code>ListingsQuery::Search.call(current_user, {}, query_object)</code>. This might work:</p>\n\n<pre><code>so = ListingsQuery::Search\nso.call(current_user, {}, query_object)\nexpect(so).to have_received(:base_filters)\n</code></pre>\n\n<p>or the way I normally write them:</p>\n\n<pre><code>so = ListingsQuery::Search\nexpect(so).to receive(:base_filters)\nso.call(current_user, {}, query_object)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4416, "user_id": 2012677, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/8d7cb2fe712fb17f44f8c354bf37e7b5?s=128&d=identicon&r=PG&f=1", "display_name": "user2012677", "link": "https://stackoverflow.com/users/2012677/user2012677"}, "is_accepted": true, "score": 0, "last_activity_date": 1569429576, "creation_date": 1569429576, "answer_id": 58102984, "question_id": 58102200, "link": "https://stackoverflow.com/questions/58102200/rspec-failure-of-spy-to-detect-method-call-my-pattern-is-wrong/58102984#58102984", "title": "Rspec: Failure of spy to detect method call (my pattern is wrong)", "body": "<p>This works:</p>\n\n<pre><code>it \"should call base_filters\" do      \n  current_user = spy(\"User\")\n  query_object_class  = ListingsQuery::Car\n  search_object_class = ListingsQuery::Search\n  query_object = spy(query_object_class.name)\n  allow_any_instance_of(RSpec::Mocks::Double).to receive(:class) { query_object_class }\n  so = search_object_class.new(current_user, {}, query_object)\n  allow(so).to receive(:base_filters) { query_object }      \n  so.call\n  expect(so).to have_received(:base_filters)\nend\n</code></pre>\n\n<p>For some reason <code>allow_any_instance_of</code> did not work, I had to stub the specific instance.  I would be curious to know why, if anyone knows.</p>\n"}], "owner": {"reputation": 4416, "user_id": 2012677, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/8d7cb2fe712fb17f44f8c354bf37e7b5?s=128&d=identicon&r=PG&f=1", "display_name": "user2012677", "link": "https://stackoverflow.com/users/2012677/user2012677"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 244, "favorite_count": 0, "accepted_answer_id": 58102984, "answer_count": 2, "score": 0, "last_activity_date": 1569429576, "creation_date": 1569426466, "last_edit_date": 1569428923, "question_id": 58102200, "link": "https://stackoverflow.com/questions/58102200/rspec-failure-of-spy-to-detect-method-call-my-pattern-is-wrong", "title": "Rspec: Failure of spy to detect method call (my pattern is wrong)", "body": "<p>How do I test that a method is being called within another method?</p>\n\n<p>I need to test that ListingQuery.call() calls the base_filter method</p>\n\n<h3>Code</h3>\n\n<pre><code>module ListingsQuery\n  class Search\n    def self.call(current_user, params, query_object_override=nil)\n      new(current_user, params, query_object_override).call\n    end\n\n    def initialize(current_user, params, query_object_override=nil)\n      @params = params\n      @type = params[:market] || params[:type] || \"all\"\n      @current_user = current_user\n      @type = if @type.present?\n                @type.downcase.singularize\n              else\n                \"listing\"\n              end\n      @query_object = query_object_override\n    end\n\n    def call\n      relation_for(query_object)\n    end\n\n    private\n\n    def relation_for(query_object_instance)\n      if query_object_instance.class == ListingsQuery::Car\n        car_filters(query_object_instance).relation\n      else\n        raise ArgumentError, \"ListingsQuery 'Class: #{query_object_instance.class}' does not exist\"\n      end\n    end\n\n    def car_filters(query_object)\n      base_filters(query_object)\n      other_filters(query_object)\n      query_object\n    end\n\n    def query_object\n      @query_object ||= query_object_for(@type, @current_user) # =&gt; ListingQuery::Car\n    end\n  end\nend\n</code></pre>\n\n<p>### Test</p>\n\n<pre><code>  current_user = spy(\"User\")\n  query_object_class = ListingsQuery::Car\n  query_object = spy(query_object_class.name)\n\n  allow_any_instance_of(RSpec::Mocks::Double).to receive(:class) { query_object_class }\n  allow_any_instance_of(ListingsQuery::Search).to receive(:base_filters) { query_object }\n  so = ListingsQuery::Search.call(current_user, {}, query_object)\n  expect(so).to have_received(:base_filters)\n</code></pre>\n\n<h3>Error</h3>\n\n<pre><code> 1) ListingsQuery::Search#car_filters should call base_filters\n     Failure/Error: expect(so).to have_received(:base_filters)\n\n       (Double \"ListingsQuery::Car\").base_filters(*(any args))\n           expected: 1 time with any arguments\n           received: 0 times with any arguments\n</code></pre>\n\n<h3>UPDATED ALSO FAILS:</h3>\n\n<pre><code>  current_user = spy(\"User\")\n\n  query_object_class  = ListingsQuery::Car\n  search_object_class = ListingsQuery::Search\n\n  query_object = spy(query_object_class.name)\n  allow_any_instance_of(RSpec::Mocks::Double).to receive(:class) { query_object_class }\n\n  allow_any_instance_of(search_object_class).to receive(:base_filters) { query_object }\n  expect(search_object_class).to have_received(:base_filters)\n  search_object_class.call(current_user, {}, query_object)\n</code></pre>\n\n<h3>Error:</h3>\n\n<pre><code>Failure/Error: expect(search_object_class).to have_received(:base_filters)\n       #&lt;ListingsQuery::Search (class)&gt; expected to have received base_filters, but that object is not a spy or method has not been stubbed.\n</code></pre>\n"}, {"tags": ["ruby", "csv", "utf-8", "byte-order-mark", "ruby-csv"], "comments": [{"owner": {"reputation": 4127, "user_id": 4231385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d89a541a4609cafea3957e4cdfcca50f?s=128&d=identicon&r=PG&f=1", "display_name": "cremno", "link": "https://stackoverflow.com/users/4231385/cremno"}, "edited": false, "score": 0, "creation_date": 1569429657, "post_id": 58102188, "comment_id": 102597324, "body": "Is it not possible to remove the BOM before creating the StringIO instance or creating another one based on a UTF-8 string without BOM? All released StringIO versions don&#39;t support BOM handling."}, {"owner": {"reputation": 18079, "user_id": 503402, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/873ad707fb34aac8fbdfbfec676e02e9?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/503402/max"}, "edited": false, "score": 0, "creation_date": 1569514857, "post_id": 58102188, "comment_id": 102630562, "body": "The problem is that (since Ruby 2.4) BOM is a property of <i>files</i>, not an encoding. If you already have an encoded string, there is no such thing as BOM because the characters have already been properly read according to the BOM, and it is now unneeded. Since StringIO is backed by a string--not a file--it also does not understand BOM."}], "answers": [{"tags": [], "owner": {"reputation": 18079, "user_id": 503402, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/873ad707fb34aac8fbdfbfec676e02e9?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/503402/max"}, "is_accepted": false, "score": 2, "last_activity_date": 1569515690, "creation_date": 1569515690, "answer_id": 58121216, "question_id": 58102188, "link": "https://stackoverflow.com/questions/58102188/ruby-csv-bomutf-8-encoding-for-stringio/58121216#58121216", "title": "Ruby CSV BOM|UTF-8 encoding for StringIO", "body": "<p>Ruby doesn't like BOMs. It <em>only handles them when reading a file</em>, never anywhere else, and even then it only reads them so that it can get rid of them. If you want a BOM for your string, or a BOM when writing a file, you have to handle it manually.</p>\n\n<p>There are probably gems for doing this, though it's easy to do yourself</p>\n\n<pre><code>if string[0...3] == \"\\xef\\xbb\\xbf\"\n  string = string[3..-1].force_encoding('UTF-8')\nelsif string[0...2] == \"\\xff\\xfe\"\n  string = string[2..-1].force_encoding('UTF-16LE')\n# etc\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1748, "user_id": 3293310, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kYYxb.jpg?s=128&g=1", "display_name": "Pak", "link": "https://stackoverflow.com/users/3293310/pak"}, "is_accepted": false, "score": 2, "last_activity_date": 1570536588, "creation_date": 1570536588, "answer_id": 58286083, "question_id": 58102188, "link": "https://stackoverflow.com/questions/58102188/ruby-csv-bomutf-8-encoding-for-stringio/58286083#58286083", "title": "Ruby CSV BOM|UTF-8 encoding for StringIO", "body": "<p>I found out that forcing encoding to utf8 on the StringIO <code>string</code> and removing the BOM to generate a new StringIO worked: </p>\n\n<pre><code>require 'csv'\nCSV_READ_OPTIONS = { headers: true}.freeze\ncontent = StringIO.new(\"\\xEF\\xBB\\xBFid\\n123\")\ncsv_file = StringIO.new(content.string.force_encoding('utf-8').sub(\"\\xEF\\xBB\\xBF\", ''))\nfirst_row = CSV.parse(csv_file, CSV_READ_OPTIONS).first\n\nfirst_row.headers.first.include?(\"\\xEF\\xBB\\xBF\") # =&gt; false  \n\n</code></pre>\n\n<p>The <code>encoding</code> option is no more needed. It may not be the best option memory-wise, but it works.</p>\n"}, {"tags": [], "owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "is_accepted": false, "score": 2, "last_activity_date": 1605633583, "last_edit_date": 1605633583, "creation_date": 1589312980, "answer_id": 61760690, "question_id": 58102188, "link": "https://stackoverflow.com/questions/58102188/ruby-csv-bomutf-8-encoding-for-stringio/61760690#61760690", "title": "Ruby CSV BOM|UTF-8 encoding for StringIO", "body": "<p>Ruby 2.7 added the <a href=\"https://ruby-doc.org/core-2.7.0/IO.html#method-i-set_encoding_by_bom\" rel=\"nofollow noreferrer\"><code>set_encoding_by_bom</code></a> method to <code>IO</code>. This methods consumes the byte order mark and sets the encoding.</p>\n<pre><code>require 'csv'\nrequire 'stringio'\n\nCSV_READ_OPTIONS = { headers: true }.freeze\n\ncontent = StringIO.new(&quot;\\xEF\\xBB\\xBFid\\n123&quot;)\ncontent.set_encoding_by_bom\n\nfirst_row = CSV.parse(content, CSV_READ_OPTIONS).first\nfirst_row.headers.first.include?(&quot;\\xEF\\xBB\\xBF&quot;)\n#=&gt; false\n</code></pre>\n"}], "owner": {"reputation": 165, "user_id": 4404062, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/pjPSm.jpg?s=128&g=1", "display_name": "jovannypcg", "link": "https://stackoverflow.com/users/4404062/jovannypcg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1250, "favorite_count": 0, "answer_count": 3, "score": 6, "last_activity_date": 1605633583, "creation_date": 1569426425, "question_id": 58102188, "link": "https://stackoverflow.com/questions/58102188/ruby-csv-bomutf-8-encoding-for-stringio", "title": "Ruby CSV BOM|UTF-8 encoding for StringIO", "body": "<p>Ruby 2.6.3.</p>\n\n<p>I have been trying to parse a <code>StringIO</code> object into a <code>CSV</code> instance with the <code>bom|utf-8</code> encoding, so that the BOM character (undesired) is stripped and the content is encoded to UTF-8:</p>\n\n<pre><code>require 'csv'\n\nCSV_READ_OPTIONS = { headers: true, encoding: 'bom|utf-8' }.freeze\n\ncontent = StringIO.new(\"\\xEF\\xBB\\xBFid\\n123\")\nfirst_row = CSV.parse(content, CSV_READ_OPTIONS).first\n\nfirst_row.headers.first.include?(\"\\xEF\\xBB\\xBF\")     # This returns true\n</code></pre>\n\n<p>Apparently the <code>bom|utf-8</code> encoding does not work for <code>StringIO</code> objects, but I found that it does work for files, for instance:</p>\n\n<pre><code>require 'csv'\n\nCSV_READ_OPTIONS = { headers: true, encoding: 'bom|utf-8' }.freeze\n\n# File content is: \"\\xEF\\xBB\\xBFid\\n12\"\nfirst_row = CSV.read('bom_content.csv', CSV_READ_OPTIONS).first\n\nfirst_row.headers.first.include?(\"\\xEF\\xBB\\xBF\")     # This returns false\n</code></pre>\n\n<p>Considering that I need to work with <code>StringIO</code> directly, why does <code>CSV</code> ignores the <code>bom|utf-8</code> encoding? Is there any way to remove the BOM character from the <code>StringIO</code> instance?</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "answers": [{"tags": [], "owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "is_accepted": true, "score": 5, "last_activity_date": 1569425478, "creation_date": 1569425478, "answer_id": 58101931, "question_id": 58101787, "link": "https://stackoverflow.com/questions/58101787/how-to-collect-a-collection-of-objects-that-are-contained-in-the-current-month/58101931#58101931", "title": "How to collect a collection of objects that are contained in the current month", "body": "<p>If you already have an assignment where to take the <code>date</code> from, you can get the first and last day of that month:</p>\n\n<pre><code>assigment_date = assignment.date.to_date\nAssignment.where(date: assignment_date.beginning_of_month..assignment_date.end_of_month)\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 10949610, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1d982aec95597146d6b75148e090cdd?s=128&d=identicon&r=PG", "display_name": "user2369480", "link": "https://stackoverflow.com/users/10949610/user2369480"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34, "favorite_count": 0, "accepted_answer_id": 58101931, "answer_count": 1, "score": 3, "last_activity_date": 1569425478, "creation_date": 1569425012, "question_id": 58101787, "link": "https://stackoverflow.com/questions/58101787/how-to-collect-a-collection-of-objects-that-are-contained-in-the-current-month", "title": "How to collect a collection of objects that are contained in the current month", "body": "<p>Provided that. That we have an object that the date field contains for itself, like a date: \"2019-09-24\"</p>\n\n<pre><code>#&lt;Assignment id: 57, date: \"2019-09-24\"&gt;\n</code></pre>\n\n<p>And having such information, we see that this date refers to September, I need to find all the objects that exist in the range of days from the first to the last of September.</p>\n\n<pre><code>Assignment.where('date BETWEEN ? AND ?', \"2019-09-01\", \"2019-09-30\")\n</code></pre>\n\n<p>works fine, but i dont know how to find all dates :(</p>\n"}, {"tags": ["ruby-on-rails", "regex", "ruby"], "answers": [{"comments": [{"owner": {"reputation": 9, "user_id": 11578488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d43996b643e80c750eaf4be0e52ef911?s=128&d=identicon&r=PG&f=1", "display_name": "helloworld1234", "link": "https://stackoverflow.com/users/11578488/helloworld1234"}, "edited": false, "score": 0, "creation_date": 1569425954, "post_id": 58101137, "comment_id": 102595633, "body": "hi Alexey, yes i will read have a read through it today, thank you so much for your help!"}], "tags": [], "owner": {"reputation": 1357, "user_id": 6229122, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tQUnBjPGP9o/AAAAAAAAAAI/AAAAAAAACww/wJS82aCB06E/photo.jpg?sz=128", "display_name": "Alex Suslyakov", "link": "https://stackoverflow.com/users/6229122/alex-suslyakov"}, "is_accepted": false, "score": 2, "last_activity_date": 1569422868, "creation_date": 1569422868, "answer_id": 58101137, "question_id": 58100898, "link": "https://stackoverflow.com/questions/58100898/how-to-include-main-domain-and-several-subdomains-with-regex/58101137#58101137", "title": "how to include main domain and several subdomains with regex", "body": "<p>I'd highly recommend you to read some basics on the regex topic and try out some builders, they are very helpful (my fav <a href=\"https://regex101.com/\" rel=\"nofollow noreferrer\">https://regex101.com/</a>)</p>\n\n<p>So in your case, first of all let's fix the original regex</p>\n\n<ol>\n<li>Escape special characters\n<code>https:\\/\\/[a-zA-Z]\\.google\\.com</code></li>\n<li><code>[a-zA-Z]</code> group will match only a single symbol, so you need to add <code>+</code> if you want there to be at least one character in the group or <code>*</code> for any amount of characters (including 0)\n<code>https:\\/\\/[a-zA-Z]*\\.google\\.com</code></li>\n<li>Domain name may contain a dash <code>-</code> and numbers (sometimes even non-ascii characters, but let's not dig into it just yet)\n<code>https:\\/\\/[a-zA-Z-0-9]*\\.google\\.com</code></li>\n</ol>\n\n<p>Now we're almost there.\nYou can add <code>?</code> after a symbol in regex to make it optional</p>\n\n<p><code>https:\\/\\/[a-zA-Z-0-9]*\\.?google\\.com</code> will be your final regex</p>\n\n<p>I hope that's clear. Don't hesitate to ask any questions :)</p>\n"}], "owner": {"reputation": 9, "user_id": 11578488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d43996b643e80c750eaf4be0e52ef911?s=128&d=identicon&r=PG&f=1", "display_name": "helloworld1234", "link": "https://stackoverflow.com/users/11578488/helloworld1234"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1569422868, "creation_date": 1569422173, "question_id": 58100898, "link": "https://stackoverflow.com/questions/58100898/how-to-include-main-domain-and-several-subdomains-with-regex", "title": "how to include main domain and several subdomains with regex", "body": "<p>I am trying to build a regex that looks very similar to this,\nas for an example,</p>\n\n<p><code>https://[a-zA-Z].google.com</code>which applied to the main domain.\nI was wondering how do I make it work with including the main domain which is the google.com part?</p>\n"}, {"tags": ["ruby", "sketchup"], "comments": [{"owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "edited": false, "score": 0, "creation_date": 1569431132, "post_id": 58097725, "comment_id": 102598002, "body": "Can you post the values of <code>sel[0].faces[0].normal</code> and <code>sel[0].faces[1].normal</code>? (use <code>p</code> for printing with inspection). Also, please add a third face, let&#39;s say <code>sel[0].faces[2].normal</code>. Better if you can associate each face (index) with the faces of the image you posted."}], "owner": {"reputation": 47, "user_id": 12118793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f88919c8a708bdee6b96b81bed122d15?s=128&d=identicon&r=PG&f=1", "display_name": "rinse04", "link": "https://stackoverflow.com/users/12118793/rinse04"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 80, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1569422342, "creation_date": 1569412377, "last_edit_date": 1569422342, "question_id": 58097725, "link": "https://stackoverflow.com/questions/58097725/angle-between-issue-in-ruby", "title": "angle_between issue in ruby", "body": "<p>guys wonder if someone can help with a Sketchup ruby question.\nI am trying to differentiate the difference between an internal corner and an external corner to get two different angles as shown in the below image.</p>\n\n<p><a href=\"https://i.stack.imgur.com/Tt8ri.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Tt8ri.jpg\" alt=\"Sketchup example\"></a></p>\n\n<p>This is the code I am using, which is returning the same angle for all?</p>\n\n<pre><code>puts (sel[0].faces[0].normal.angle_between (sel[0].faces[1].normal)).radians\n</code></pre>\n"}, {"tags": ["html", "ruby-on-rails", "ruby", "css-selectors"], "answers": [{"comments": [{"owner": {"reputation": 8640, "user_id": 4055042, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/cd04c63d95d27033b53d4d83fea40c02?s=128&d=identicon&r=PG&f=1", "display_name": "SRack", "link": "https://stackoverflow.com/users/4055042/srack"}, "edited": false, "score": 0, "creation_date": 1569413926, "post_id": 58096790, "comment_id": 102588254, "body": "This still has the problem that of invalid HTML in a UL."}], "tags": [], "owner": {"reputation": 3926, "user_id": 2190621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c464f439212bca87517b234f7c9bd3e?s=128&d=identicon&r=PG&f=1", "display_name": "demir", "link": "https://stackoverflow.com/users/2190621/demir"}, "is_accepted": false, "score": 0, "last_activity_date": 1569412548, "last_edit_date": 1569412548, "creation_date": 1569408853, "answer_id": 58096790, "question_id": 58096545, "link": "https://stackoverflow.com/questions/58096545/how-to-create-condition-for-html-selector-with-each-rails/58096790#58096790", "title": "How to create condition for html selector with .each Rails", "body": "<p>I wrote helper for this. You can use this helper:</p>\n\n<ol>\n<li><p>Add these helper methods to <code>interests_helper.rb</code> or anywhere you want.</p>\n\n<pre><code>def checkboxes(interests, form)\n  container = ''\n  for_disable_div = '&lt;div class=\"for-disable\"&gt;'\n  interests.each do |interest|\n    if interest.id &gt; 5\n      for_disable_div += checkbox_item(interest, form)\n    else\n      container += checkbox_item(interest, form)\n    end\n  end\n  sanitize \"#{container} #{for_disable_div}&lt;/div&gt;\"\nend\n\ndef checkbox_item(interest, form)\n  content_tag :li do\n    form.check_box(interest.id)\n    form.label(interest.id, interest.name)\n  end\nend\n</code></pre></li>\n<li><p>Use it in form</p>\n\n<pre><code>= checkboxes(interests, f)\n</code></pre></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 8640, "user_id": 4055042, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/cd04c63d95d27033b53d4d83fea40c02?s=128&d=identicon&r=PG&f=1", "display_name": "SRack", "link": "https://stackoverflow.com/users/4055042/srack"}, "edited": false, "score": 0, "creation_date": 1569413443, "post_id": 58097114, "comment_id": 102587948, "body": "Glad I was able to help @\u0420\u043e\u043c\u0430\u043d\u041e\u043a\u0441 - which approach did you end up using?"}], "tags": [], "owner": {"reputation": 8640, "user_id": 4055042, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/cd04c63d95d27033b53d4d83fea40c02?s=128&d=identicon&r=PG&f=1", "display_name": "SRack", "link": "https://stackoverflow.com/users/4055042/srack"}, "is_accepted": true, "score": 1, "last_activity_date": 1569411182, "last_edit_date": 1569411182, "creation_date": 1569410120, "answer_id": 58097114, "question_id": 58096545, "link": "https://stackoverflow.com/questions/58096545/how-to-create-condition-for-html-selector-with-each-rails/58097114#58097114", "title": "How to create condition for html selector with .each Rails", "body": "<p><strong>Important note: adding a <code>div</code> as a child of an <code>ul</code> is <a href=\"https://html.spec.whatwg.org/multipage/grouping-content.html#the-ul-element\" rel=\"nofollow noreferrer\">invalid HTML</a> :)</strong></p>\n\n<p>As an alternative, you could add the <code>for-disable</code> class added to the <code>li</code>s after the first five <code>interests</code>? </p>\n\n<p>How about this using <a href=\"https://apidock.com/ruby/Enumerator/each_with_index\" rel=\"nofollow noreferrer\"><code>each_with_index</code></a>:</p>\n\n<pre><code>- @interests.each_with_index do |interest, index|\n  %li{ class: (\"for-disable\" if index &gt; 4) }\n    = f.check_box(interest.id)\n    = f.label(interest.id, interest.name)\n</code></pre>\n\n<p>Or an alternative syntax using the <a href=\"https://apidock.com/rails/ActionView/Helpers/TagHelper/tag\" rel=\"nofollow noreferrer\"><code>tag</code></a> helper should you prefer it:</p>\n\n<pre><code>- @interests.each_with_index do |interest, index|\n  = tag.li class: (\"for-disable\" if index &gt; 4) do\n    = f.check_box(interest.id)\n    = f.label(interest.id, interest.name)\n</code></pre>\n\n<p>The index starts at <code>0</code>, hence checking if <code>&gt; 4</code>.</p>\n\n<hr>\n\n<p>Alternatively, if you want all <code>interests</code> after the first five in a separate <code>div</code> you could use:</p>\n\n<pre><code>%ul\n  - @interests.first(5) do |interest|\n    %li\n      = f.check_box(interest.id)\n      = f.label(interest.id, interest.name)\n\n.for-disable\n  %ul\n    - @interests.drop(5) do |interest|\n      %li\n        = f.check_box(interest.id)\n        = f.label(interest.id, interest.name)\n</code></pre>\n\n<hr>\n\n<p>Both nice and clean and should offer something to do what you're after - let me know how you get on or if you have any questions :)</p>\n"}], "owner": {"reputation": 599, "user_id": 11544569, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xEqDN.jpg?s=128&g=1", "display_name": "RomanOks", "link": "https://stackoverflow.com/users/11544569/romanoks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 58097114, "answer_count": 2, "score": 0, "last_activity_date": 1569412548, "creation_date": 1569408017, "question_id": 58096545, "link": "https://stackoverflow.com/questions/58096545/how-to-create-condition-for-html-selector-with-each-rails", "title": "How to create condition for html selector with .each Rails", "body": "<p>Cycle displays several checkboxes and labels.\nAfter 5, rest of checkboxes should be displayed under one <code>.for-disable</code> class.</p>\n\n<p>How to do it in a loop?</p>\n\n<p><em>My .each method in haml:</em></p>\n\n<pre><code>- @interests.each do |interest|\n  %li\n    = f.check_box(interest.id)\n    = f.label(interest.id, interest.name)\n</code></pre>\n\n<p><em>I tried:</em></p>\n\n<pre><code>- @interests.each do |interest|\n    - if interest.id == 5\n      .for-disable\n        %li\n          = f.check_box(interest.id)\n          = f.label(interest.id, interest.name)\n    - else\n      %li\n        = f.check_box(interest.id)\n        = f.label(interest.id, interest.name)\n</code></pre>\n\n<p>But, as expected, in this case only one checkbox is displayed in the 'for-disable' class.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "bundler"], "answers": [{"tags": [], "owner": {"reputation": 1864, "user_id": 459856, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70037e355609caceae2500b183d28f58?s=128&d=identicon&r=PG", "display_name": "tjeden", "link": "https://stackoverflow.com/users/459856/tjeden"}, "is_accepted": false, "score": 0, "last_activity_date": 1569403087, "creation_date": 1569403087, "answer_id": 58095119, "question_id": 58094980, "link": "https://stackoverflow.com/questions/58094980/rails-bundler-version-issue/58095119#58095119", "title": "rails bundler version issue", "body": "<p>Uninstall bundler 2.0.2:</p>\n\n<pre><code>gem uninstall bundler -v 2.0.2\n</code></pre>\n\n<p>If you still have problem, you can use:</p>\n\n<pre><code>bundle exec rails db:create\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 16672, "user_id": 22237, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/hkobD.png?s=128&g=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/22237/kris"}, "is_accepted": false, "score": 0, "last_activity_date": 1569403913, "creation_date": 1569403913, "answer_id": 58095382, "question_id": 58094980, "link": "https://stackoverflow.com/questions/58094980/rails-bundler-version-issue/58095382#58095382", "title": "rails bundler version issue", "body": "<p>You can update to using bundler 2.x if possible with:</p>\n\n<pre><code>bundle update --bundler\n</code></pre>\n\n<p>This will change the <code>BUNDLED_WITH</code> version in Gemfile.lock.</p>\n\n<p>see: <a href=\"https://bundler.io/guides/bundler_2_upgrade.html\" rel=\"nofollow noreferrer\">https://bundler.io/guides/bundler_2_upgrade.html</a></p>\n\n<p>You could also set the default bundler version:</p>\n\n<pre><code>bundler config default 1.16.4\ngem list bundler\n</code></pre>\n\n<p>However I have found this to be a bit error prone.</p>\n"}, {"tags": [], "owner": {"reputation": 5, "user_id": 9429268, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7e0ad8a9712d23a0bdd8f8f867d679d?s=128&d=identicon&r=PG&f=1", "display_name": "ViachMoz", "link": "https://stackoverflow.com/users/9429268/viachmoz"}, "is_accepted": false, "score": 0, "last_activity_date": 1569411391, "creation_date": 1569411391, "answer_id": 58097480, "question_id": 58094980, "link": "https://stackoverflow.com/questions/58094980/rails-bundler-version-issue/58097480#58097480", "title": "rails bundler version issue", "body": "<p>Try to remove all your gems (go to the gems folder of your ruby, remove the specifications folder and the gems folder),</p>\n\n<ul>\n<li><code>gem list</code> should be more or less empty</li>\n<li><code>gem install bundler</code></li>\n<li>And try to <code>bundle install</code> again from scratch.</li>\n</ul>\n"}], "owner": {"reputation": 1634, "user_id": 5703217, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/Oj8Lb.jpg?s=128&g=1", "display_name": "Muhammad Faisal Iqbal", "link": "https://stackoverflow.com/users/5703217/muhammad-faisal-iqbal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 163, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1569416177, "creation_date": 1569402635, "last_edit_date": 1569416177, "question_id": 58094980, "link": "https://stackoverflow.com/questions/58094980/rails-bundler-version-issue", "title": "rails bundler version issue", "body": "<p>I have rails project working on Ubuntu.\nNow I installed WSL on another machine and cloned the very same project.\nNow when I try to install bundler with</p>\n\n<pre><code>gem install bundler \n</code></pre>\n\n<p>it installed bundler 2.0.2 and on <code>bundle install</code> it gives error:</p>\n\n<p><strong>Could not find gem 'bundler (&lt; 2.0, >= 1.3.0)', which is required by gem 'rails (~> 5.0.0)'</strong></p>\n\n<p>Now I looked at the gemfile.lock it was bundled with 1.16.4, I installed it with</p>\n\n<pre><code> gem install bundler -v '1.16.4' \n</code></pre>\n\n<p>Now I do a simple <code>bundle install</code>, then it uses 2.0.2, so I have to do</p>\n\n<pre><code>bundle _1.16.4_ install \n</code></pre>\n\n<p>It completed successfully, but now when I am trying to do <code>rails db:create</code>, it says</p>\n\n<p><strong>The git source <a href=\"https://github.com/activerecord-hackery/ransack.git\" rel=\"nofollow noreferrer\">https://github.com/activerecord-hackery/ransack.git</a> is not yet checked out. Please run <code>bundle install</code> before trying to start your application</strong></p>\n\n<p>What's wrong here? </p>\n"}, {"tags": ["ruby-on-rails", "ruby", "eager-loading", "rails-activestorage", "ruby-on-rails-6"], "comments": [{"owner": {"reputation": 748, "user_id": 3041946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/223e166ce464a1537230c1600c03e71c?s=128&d=identicon&r=PG&f=1", "display_name": "Cremz", "link": "https://stackoverflow.com/users/3041946/cremz"}, "edited": false, "score": 1, "creation_date": 1569410549, "post_id": 58094922, "comment_id": 102586460, "body": "meta_requests are probably caused by rails panel or better_errors, it&#39;s usually only in development mode. And I don&#39;t see any queries (DB), but you are loading some images and they need to be routed through the app, so you will see the GET requests"}, {"owner": {"reputation": 121, "user_id": 11488922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6a781b6fb23434621f617efcd4d9777?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastiaanpoppen", "link": "https://stackoverflow.com/users/11488922/sebastiaanpoppen"}, "reply_to_user": {"reputation": 748, "user_id": 3041946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/223e166ce464a1537230c1600c03e71c?s=128&d=identicon&r=PG&f=1", "display_name": "Cremz", "link": "https://stackoverflow.com/users/3041946/cremz"}, "edited": false, "score": 0, "creation_date": 1569476965, "post_id": 58094922, "comment_id": 102610550, "body": "@Cremz, thanks a lot for pointing this out! The issue was indeed caused by the Rails Panel and didn&#39;t persist on production."}], "owner": {"reputation": 121, "user_id": 11488922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6a781b6fb23434621f617efcd4d9777?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastiaanpoppen", "link": "https://stackoverflow.com/users/11488922/sebastiaanpoppen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 358, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1569402392, "creation_date": 1569402392, "question_id": 58094922, "link": "https://stackoverflow.com/questions/58094922/eager-loading-activestorage-attachments-still-performs-extra-queries-and-meta-re", "title": "Eager loading activestorage attachments still performs extra queries and meta requests", "body": "<p>I use rails active-storage to load avatars on a page. \nthe avatars are eager loaded via the with_attached helper.\nThis works fine. For the full collection of avatars only one sql query is performed.</p>\n\n<p>However when I render the avatar in the view an extra query per avatar is performed. This makes the page super slow to render.</p>\n\n<p>The avatars are eagerloaded in the controller</p>\n\n<p>Controller:\n<code>grouped_step_assignment_profiles = UserProfile.where(user_id: corresponding_step_assignments.pluck(:user_id)).with_attached_avatar.group_by{|x| x.user_id}</code></p>\n\n<p>And then added to an object (which is passed to the view)</p>\n\n<p><code>avatar: rails_representation_url(grouped_step_assignment_profiles[user_id][0].user_avatar(30))</code></p>\n\n<p>The user_avatar method in the UserProfile class:</p>\n\n<pre><code>has_one_attached :avatar\ndef user_avatar(size = 30)\n    if (self&amp;.avatar and self.avatar.attached?)\n        self.avatar.variant(resize: \"#{size}x#{size}\").processed\n    else\n        if self\n            gravatar_image_url(self.email, size: size)\n        end\n    end\nend\n</code></pre>\n\n<p>In the view the avatar is rendered by accessing the object avatar attribute:\n                                <code>image_tag user_step_assignment[1][:avatar], class: \"rounded-circle\"</code></p>\n\n<p>This performs the following extra query and meta request per avatar (20 avatars is 20 extra queries and meta requests):</p>\n\n<pre><code>Started GET \"/rails/active_storage/disk/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdDRG9JYTJWNVNTSnJkbUZ5YVdGdWRITXZiMmwyTUdzeGQydG9hWFZ2ZVhnd01USnljR1Z0Tm1Ob2FHMWhhQzlqWTJFMVpUYzNZVEJsWm1ReFlqRmxaRFZpTVdabE1qRmtOelV6TUdJeFl6VTBOek5pTkdFMVpUVTRaalkwTnpjd1lUVmtPR1ZrT0dOaFlXVTNOREUzQmpvR1JWUTZFR1JwYzNCdmMybDBhVzl1U1NKSGFXNXNhVzVsT3lCbWFXeGxibUZ0WlQwaWRHVnRjRjloZG1GMFlYSmZPREVpT3lCbWFXeGxibUZ0WlNvOVZWUkdMVGduSjNSbGJYQmZZWFpoZEdGeVh6Z3hCanNHVkRvUlkyOXVkR1Z1ZEY5MGVYQmxTU0lQYVcxaFoyVXZhbkJsWndZN0JsUT0iLCJleHAiOiIyMDE5LTA5LTI1VDA4OjM5OjU5LjIwOFoiLCJwdXIiOiJibG9iX2tleSJ9fQ==--4462bea946137c25d19bd706d48a0cbc5118c11e/temp_avatar_81?content_type=image%2Fjpeg&amp;disposition=inline%3B+filename%3D%22temp_avatar_81%22%3B+filename%2A%3DUTF-8%27%27temp_avatar_81\" for 127.0.0.1 at 2019-09-25 10:37:15 +0200\nProcessing by ActiveStorage::DiskController#show as HTML\n  Parameters: {\"content_type\"=&gt;\"image/jpeg\", \"disposition\"=&gt;\"inline; filename=\\\"temp_avatar_81\\\"; filename*=UTF-8''temp_avatar_81\", \"encoded_key\"=&gt;\"eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdDRG9JYTJWNVNTSnJkbUZ5YVdGdWRITXZiMmwyTUdzeGQydG9hWFZ2ZVhnd01USnljR1Z0Tm1Ob2FHMWhhQzlqWTJFMVpUYzNZVEJsWm1ReFlqRmxaRFZpTVdabE1qRmtOelV6TUdJeFl6VTBOek5pTkdFMVpUVTRaalkwTnpjd1lUVmtPR1ZrT0dOaFlXVTNOREUzQmpvR1JWUTZFR1JwYzNCdmMybDBhVzl1U1NKSGFXNXNhVzVsT3lCbWFXeGxibUZ0WlQwaWRHVnRjRjloZG1GMFlYSmZPREVpT3lCbWFXeGxibUZ0WlNvOVZWUkdMVGduSjNSbGJYQmZZWFpoZEdGeVh6Z3hCanNHVkRvUlkyOXVkR1Z1ZEY5MGVYQmxTU0lQYVcxaFoyVXZhbkJsWndZN0JsUT0iLCJleHAiOiIyMDE5LTA5LTI1VDA4OjM5OjU5LjIwOFoiLCJwdXIiOiJibG9iX2tleSJ9fQ==--4462bea946137c25d19bd706d48a0cbc5118c11e\", \"filename\"=&gt;\"temp_avatar_81\"}\nCompleted 200 OK in 1ms (ActiveRecord: 0.0ms | Allocations: 1388)\n</code></pre>\n\n<pre><code>Started GET \"/__meta_request/a5c57d1c-bfa3-48c3-ac7e-e0e78fadb997.json\" for 127.0.0.1 at 2019-09-25 10:37:21 +0200\n</code></pre>\n\n<p>It takes between 2 and 3 seconds for the page to load (with  less than 20 avatars). When I comment out the avatar line in the view the page load drops to around 200-300 ms.</p>\n\n<p>Can someone point out the flaw in this setup? Thanks in advance for the help!</p>\n"}, {"tags": ["ruby", "shell", "fastlane"], "comments": [{"owner": {"reputation": 16672, "user_id": 22237, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/hkobD.png?s=128&g=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/22237/kris"}, "edited": false, "score": 0, "creation_date": 1569400806, "post_id": 58093548, "comment_id": 102581131, "body": "What is producing the log files? And where does the <code>sh</code> method come from?"}, {"owner": {"reputation": 3453, "user_id": 838355, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/AIvqN.png?s=128&g=1", "display_name": "ir2pid", "link": "https://stackoverflow.com/users/838355/ir2pid"}, "reply_to_user": {"reputation": 16672, "user_id": 22237, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/hkobD.png?s=128&g=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/22237/kris"}, "edited": false, "score": 0, "creation_date": 1569402307, "post_id": 58093548, "comment_id": 102581981, "body": "the logs are shown in build logs in the CI pipeline[TravisCI/CircleCI/etc]. I have a .yaml build file for CI which calls &gt; bash script&gt;which calls fastlane commands"}, {"owner": {"reputation": 16672, "user_id": 22237, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/hkobD.png?s=128&g=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/22237/kris"}, "edited": false, "score": 1, "creation_date": 1569403751, "post_id": 58093548, "comment_id": 102582794, "body": "My guess is CI is logging STDOUT and you need to stop fastlane (whatever that is) outputing to STDOUT for the those specific commands."}], "answers": [{"comments": [{"owner": {"reputation": 4956, "user_id": 71877, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/69c9a8022174b2dbaf129eb629eecf88?s=128&d=identicon&r=PG", "display_name": "Lyndsey Ferguson", "link": "https://stackoverflow.com/users/71877/lyndsey-ferguson"}, "edited": false, "score": 0, "creation_date": 1569409192, "post_id": 58096851, "comment_id": 102585730, "body": "I recommend browsing through the docs to find other potentially useful commands that you can use. Sometimes, you&#39;ll find that you&#39;re doing something the hard way when there is an easier way."}], "tags": [], "owner": {"reputation": 4956, "user_id": 71877, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/69c9a8022174b2dbaf129eb629eecf88?s=128&d=identicon&r=PG", "display_name": "Lyndsey Ferguson", "link": "https://stackoverflow.com/users/71877/lyndsey-ferguson"}, "is_accepted": false, "score": 5, "last_activity_date": 1569409069, "creation_date": 1569409069, "answer_id": 58096851, "question_id": 58093548, "link": "https://stackoverflow.com/questions/58093548/hiding-sensitive-ruby-shell-commands/58096851#58096851", "title": "Hiding sensitive ruby shell commands", "body": "<p>You can pass <code>sh</code> extra parameters. In this case, you would call it like this:</p>\n\n<pre><code>sh(cmd_decrypt, log: false)\n</code></pre>\n\n<p>The documentation for <code>sh</code> is here: <a href=\"https://docs.fastlane.tools/actions/sh/\" rel=\"noreferrer\">https://docs.fastlane.tools/actions/sh/</a></p>\n\n<p>You get can get the docs for other built-in actions here:\n<a href=\"https://docs.fastlane.tools/actions/\" rel=\"noreferrer\">https://docs.fastlane.tools/actions/</a></p>\n\n<p>And the docs for other plugin's actions here: <a href=\"https://docs.fastlane.tools/plugins/available-plugins/\" rel=\"noreferrer\">https://docs.fastlane.tools/plugins/available-plugins/</a></p>\n"}, {"comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "reply_to_user": {"reputation": 4956, "user_id": 71877, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/69c9a8022174b2dbaf129eb629eecf88?s=128&d=identicon&r=PG", "display_name": "Lyndsey Ferguson", "link": "https://stackoverflow.com/users/71877/lyndsey-ferguson"}, "edited": false, "score": 0, "creation_date": 1569439878, "post_id": 58103282, "comment_id": 102601607, "body": "@LyndseyFerguson The second form should, as those are just regular Ruby variables that get passed through as arguments."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "reply_to_user": {"reputation": 4956, "user_id": 71877, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/69c9a8022174b2dbaf129eb629eecf88?s=128&d=identicon&r=PG", "display_name": "Lyndsey Ferguson", "link": "https://stackoverflow.com/users/71877/lyndsey-ferguson"}, "edited": false, "score": 1, "creation_date": 1569440971, "post_id": 58103282, "comment_id": 102602052, "body": "@LyndseyFerguson Always good to have two sets of eyes on the documentation."}], "tags": [], "owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "is_accepted": false, "score": 2, "last_activity_date": 1569430744, "creation_date": 1569430744, "answer_id": 58103282, "question_id": 58093548, "link": "https://stackoverflow.com/questions/58093548/hiding-sensitive-ruby-shell-commands/58103282#58103282", "title": "Hiding sensitive ruby shell commands", "body": "<p>Since you have an environment variable, why not just run with that?</p>\n\n<pre><code>cmd_decrypt = \"openssl enc -aes-256-cbc -d -a -k \\\"$MATCH_PASSWORD\\\" -in #{enc_file} -out #{dec_file[0]}\"\n\nsh(cmd_decrypt)\n</code></pre>\n\n<p>From there shell interpolation should take over and make it work. One thing to note is your <code>-in</code> parameter doesn't have shell escaping, which it usually must have, done using <a href=\"https://ruby-doc.org/stdlib-2.5.1/libdoc/shellwords/rdoc/Shellwords.html#method-c-shellescape\" rel=\"nofollow noreferrer\"><code>shellescape</code></a>.</p>\n\n<p>You <em>really</em> should be specifying these as separate arguments, though, whenever possible to avoid injection issues. The problem is you lose shell interpolation at that point.</p>\n\n<p>The good news is you can always write a wrapper script to provide safety and ease of use, something like:</p>\n\n<pre><code>#!/bin/sh\n# descrypt.sh\n\nopenssl enc -aes-256-cbc -d -a -k \"$MATCH_PASSWORD\" -in $1 -out $2\n</code></pre>\n\n<p>So then you can call it like this:</p>\n\n<pre><code>sh('descrypt.sh', enc_file, dec_file[0])\n</code></pre>\n\n<p>Now it logs something a lot quieter as well as a bonus. You can pick which arguments to pass through, or even throw them all through with <code>$*</code>.</p>\n"}], "owner": {"reputation": 3453, "user_id": 838355, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/AIvqN.png?s=128&g=1", "display_name": "ir2pid", "link": "https://stackoverflow.com/users/838355/ir2pid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 281, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1569430744, "creation_date": 1569397465, "question_id": 58093548, "link": "https://stackoverflow.com/questions/58093548/hiding-sensitive-ruby-shell-commands", "title": "Hiding sensitive ruby shell commands", "body": "<p>I'm using fastlane and sh command to decrypt some credentials but seems ruby prints the output in logs. How do I hide the sensitive information from logs?</p>\n\n<pre><code>cmd_decrypt = \"openssl enc -aes-256-cbc -d -a -k \\\"#{ENV[\"MATCH_PASSWORD\"]}\\\" -in #{enc_file} -out #{dec_file[0]}\"\n\nsh(cmd_decrypt)\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>[09:38:15]: --------------------------------------------------------------------\n[09:38:15]: Step: openssl enc -aes-256-cbc -d -a -k \"PASSWORD_SHOWN!\" -in /var/folders/7g/yy/T/d20190925-1304-1qv6cj1/vault/zz-out /var/folders/7g/yy/T/d20190925-1304-1qv6cj1/vault/xx\n[09:38:15]: --------------------------------------------------------------------\n[09:38:15]: $ openssl enc -aes-256-cbc -d -a -k \"PASSWORD_SHOWN!\" -in /var/folders/7g/yy/T/d20190925-1304-1qv6cj1/vault/zz -out /var/folders/7g/yy/T/d20190925-1304-1qv6cj1/vault/xx\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "activerecord", "associations"], "comments": [{"owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 0, "creation_date": 1569393060, "post_id": 58092293, "comment_id": 102577295, "body": "<code>books.update_all(author_id: &lt;author_id&gt;)</code> no?"}, {"owner": {"reputation": 778, "user_id": 4229641, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/VxtFd.jpg?s=128&g=1", "display_name": "vishnuprasanth", "link": "https://stackoverflow.com/users/4229641/vishnuprasanth"}, "reply_to_user": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 0, "creation_date": 1569393461, "post_id": 58092293, "comment_id": 102577460, "body": "@SebastianPalma But what if there are other books with different author_id?"}, {"owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 0, "creation_date": 1569393681, "post_id": 58092293, "comment_id": 102577572, "body": "You can group them. Isn&#39;t clear what you&#39;re trying to do. Can you explain further?"}, {"owner": {"reputation": 778, "user_id": 4229641, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/VxtFd.jpg?s=128&g=1", "display_name": "vishnuprasanth", "link": "https://stackoverflow.com/users/4229641/vishnuprasanth"}, "reply_to_user": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 0, "creation_date": 1569394113, "post_id": 58092293, "comment_id": 102577760, "body": "@SebastianPalma Yeah sure. Updated the question"}, {"owner": {"reputation": 48413, "user_id": 1279683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1veuT.jpg?s=128&g=1", "display_name": "Marek Lipka", "link": "https://stackoverflow.com/users/1279683/marek-lipka"}, "edited": false, "score": 1, "creation_date": 1569394517, "post_id": 58092293, "comment_id": 102577956, "body": "After you deleted <code>author1</code>, the books of <code>author1</code> are also destroyed."}, {"owner": {"reputation": 778, "user_id": 4229641, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/VxtFd.jpg?s=128&g=1", "display_name": "vishnuprasanth", "link": "https://stackoverflow.com/users/4229641/vishnuprasanth"}, "reply_to_user": {"reputation": 48413, "user_id": 1279683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1veuT.jpg?s=128&g=1", "display_name": "Marek Lipka", "link": "https://stackoverflow.com/users/1279683/marek-lipka"}, "edited": false, "score": 0, "creation_date": 1569395061, "post_id": 58092293, "comment_id": 102578218, "body": "@MarekLipka At the time of deletion the dependent: :destroy parameter was not specified in the Author model."}, {"owner": {"reputation": 2345, "user_id": 4988918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x1BRI.png?s=128&g=1", "display_name": "Mark Merritt", "link": "https://stackoverflow.com/users/4988918/mark-merritt"}, "edited": false, "score": 0, "creation_date": 1569398468, "post_id": 58092293, "comment_id": 102579905, "body": "@vishnuprasanth what? <code>dependent: :destroy</code> will delete the author and it&#39;s associated books on destroy. It seems like the association should be optional if books can be assigned to a different author...doesn&#39;t make sense logically though"}, {"owner": {"reputation": 778, "user_id": 4229641, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/VxtFd.jpg?s=128&g=1", "display_name": "vishnuprasanth", "link": "https://stackoverflow.com/users/4229641/vishnuprasanth"}, "reply_to_user": {"reputation": 2345, "user_id": 4988918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x1BRI.png?s=128&g=1", "display_name": "Mark Merritt", "link": "https://stackoverflow.com/users/4988918/mark-merritt"}, "edited": false, "score": 0, "creation_date": 1569401320, "post_id": 58092293, "comment_id": 102581434, "body": "@MarkMerritt At first I did not add that line in the Author model. Added it after destroying author1"}], "answers": [{"comments": [{"owner": {"reputation": 16672, "user_id": 22237, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/hkobD.png?s=128&g=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/22237/kris"}, "edited": false, "score": 0, "creation_date": 1569400988, "post_id": 58092421, "comment_id": 102581226, "body": "Note that <code>update_all</code> will not run callbacks. Instead you could do something like <code>author_1.books.each { |book| book.update_attributes(author_id: author_2.id) }</code>."}], "tags": [], "owner": {"reputation": 761, "user_id": 7786120, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3acd54907ef6cb3d7de0ebd91177850d?s=128&d=identicon&r=PG&f=1", "display_name": "Akshay Goyal", "link": "https://stackoverflow.com/users/7786120/akshay-goyal"}, "is_accepted": false, "score": 5, "last_activity_date": 1569401302, "last_edit_date": 1569401302, "creation_date": 1569393374, "answer_id": 58092421, "question_id": 58092293, "link": "https://stackoverflow.com/questions/58092293/rails-update-author-id-in-books-table-after-deleting-and-creating-a-new-author-r/58092421#58092421", "title": "Rails update author_id in books table after deleting and creating a new author record", "body": "<p>I would recommend you to first create the second author. If you delete the first author first then you won't be able to fetch the books associated with the first author.</p>\n\n<h2>Find the new author</h2>\n\n<pre><code>new_author = Author.find(new_id)\n</code></pre>\n\n<h2>Change the books from the old author to the new one</h2>\n\n<pre><code>old_author = Author.find(old_id)\nold_author.books.update_all(author_id: new_author.id)\n</code></pre>\n\n<h2>Delete the old author</h2>\n\n<pre><code>old_author.destroy\n</code></pre>\n\n<p>This would ensure no data is lost and also no orphan data is present.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 2101065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adb6d4103b752af3af9eef83b8c53584?s=128&d=identicon&r=PG", "display_name": "sah", "link": "https://stackoverflow.com/users/2101065/sah"}, "is_accepted": false, "score": 0, "last_activity_date": 1569418705, "creation_date": 1569418705, "answer_id": 58099735, "question_id": 58092293, "link": "https://stackoverflow.com/questions/58092293/rails-update-author-id-in-books-table-after-deleting-and-creating-a-new-author-r/58099735#58099735", "title": "Rails update author_id in books table after deleting and creating a new author record", "body": "<p>It sounds like you want the book object to stick around after you delete the author so you can then assign it to another author.  If that is the case, you might want to consider using a has and belongs to many relationship: <a href=\"https://guides.rubyonrails.org/association_basics.html#the-has-and-belongs-to-many-association\" rel=\"nofollow noreferrer\">https://guides.rubyonrails.org/association_basics.html#the-has-and-belongs-to-many-association</a>.  So you would have 3 tables: <code>authors</code>, <code>books</code> and <code>authors_books</code>. <code>author_books</code> would only have 2 columns: <code>author_id</code> and <code>book_id</code>.</p>\n\n<p>Another option would be to change <code>Author</code> like so:</p>\n\n<pre><code>  class Author &lt; ApplicationRecord\n    has_many :books, dependent: :nullify\n  end\n</code></pre>\n\n<p>Now when an author is deleted, the books are not deleted, instead <code>author_id</code> is set to null in the books table for all the books that previously belonged to a particular author: <a href=\"https://guides.rubyonrails.org/association_basics.html#dependent\" rel=\"nofollow noreferrer\">https://guides.rubyonrails.org/association_basics.html#dependent</a></p>\n"}], "owner": {"reputation": 778, "user_id": 4229641, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/VxtFd.jpg?s=128&g=1", "display_name": "vishnuprasanth", "link": "https://stackoverflow.com/users/4229641/vishnuprasanth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1569418705, "creation_date": 1569392861, "last_edit_date": 1569394091, "question_id": 58092293, "link": "https://stackoverflow.com/questions/58092293/rails-update-author-id-in-books-table-after-deleting-and-creating-a-new-author-r", "title": "Rails update author_id in books table after deleting and creating a new author record", "body": "<p>Here is the <code>Author</code> model and <code>Book</code> model</p>\n\n<pre><code>class Author &lt; ApplicationRecord\n  has_many :books, dependent: :destroy\nend\n\nclass Book &lt; ApplicationRecord\n  belongs_to :author\nend\n</code></pre>\n\n<p>I create 2 authors (author1 &amp; author2) and added 2 books for each one. </p>\n\n<p>Afterwards I deleted author1 and created a new author (author3). Now, I want to give author3 the two books of author1.</p>\n\n<p>Is there an ActiveRecord method to update the books author_id with the new author?</p>\n"}, {"tags": ["ruby", "bundler"], "comments": [{"owner": {"reputation": 1864, "user_id": 459856, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70037e355609caceae2500b183d28f58?s=128&d=identicon&r=PG", "display_name": "tjeden", "link": "https://stackoverflow.com/users/459856/tjeden"}, "edited": false, "score": 1, "creation_date": 1569401899, "post_id": 58091825, "comment_id": 102581768, "body": "What tool do you use to generate docs?"}, {"owner": {"reputation": 2996, "user_id": 7836976, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/67ae396b20200188272f0d121d9e9dfa?s=128&d=identicon&r=PG&f=1", "display_name": "runnerpaul", "link": "https://stackoverflow.com/users/7836976/runnerpaul"}, "reply_to_user": {"reputation": 1864, "user_id": 459856, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70037e355609caceae2500b183d28f58?s=128&d=identicon&r=PG", "display_name": "tjeden", "link": "https://stackoverflow.com/users/459856/tjeden"}, "edited": false, "score": 0, "creation_date": 1569405359, "post_id": 58091825, "comment_id": 102583705, "body": "I&#39;m using <code>Bundler</code>"}, {"owner": {"reputation": 1864, "user_id": 459856, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70037e355609caceae2500b183d28f58?s=128&d=identicon&r=PG", "display_name": "tjeden", "link": "https://stackoverflow.com/users/459856/tjeden"}, "edited": false, "score": 0, "creation_date": 1569411637, "post_id": 58091825, "comment_id": 102587021, "body": "Bundler doesn&#39;t generate documentation, so it must be something else, can you show your <code>Gemfile</code> or gemspec file?"}], "answers": [{"tags": [], "owner": {"reputation": 2996, "user_id": 7836976, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/67ae396b20200188272f0d121d9e9dfa?s=128&d=identicon&r=PG&f=1", "display_name": "runnerpaul", "link": "https://stackoverflow.com/users/7836976/runnerpaul"}, "is_accepted": true, "score": 0, "last_activity_date": 1569957641, "creation_date": 1569957641, "answer_id": 58191053, "question_id": 58091825, "link": "https://stackoverflow.com/questions/58091825/files-missing-from-bundler-docs-generation/58191053#58191053", "title": "Files missing from bundler docs generation", "body": "<p>My <code>.yardocs</code> file was not configured correctly.</p>\n"}], "owner": {"reputation": 2996, "user_id": 7836976, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/67ae396b20200188272f0d121d9e9dfa?s=128&d=identicon&r=PG&f=1", "display_name": "runnerpaul", "link": "https://stackoverflow.com/users/7836976/runnerpaul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 18, "favorite_count": 0, "accepted_answer_id": 58191053, "answer_count": 1, "score": 0, "last_activity_date": 1569957641, "creation_date": 1569390332, "question_id": 58091825, "link": "https://stackoverflow.com/questions/58091825/files-missing-from-bundler-docs-generation", "title": "Files missing from bundler docs generation", "body": "<p>When I run <code>bundle</code> to generate my docs I notice that <code>file.CHANGELOG.html</code> and <code>AWS/Config</code> do not exist in the generated files but they previously did. How can I get these to generate again?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "sidekiq", "rails-activejob"], "comments": [{"owner": {"reputation": 2345, "user_id": 4988918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x1BRI.png?s=128&g=1", "display_name": "Mark Merritt", "link": "https://stackoverflow.com/users/4988918/mark-merritt"}, "edited": false, "score": 0, "creation_date": 1569387076, "post_id": 58091288, "comment_id": 102575303, "body": "What is your question?"}, {"owner": {"reputation": 1058, "user_id": 1224718, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/d6b40ad0c1934651afa0d293ec822d22?s=128&d=identicon&r=PG", "display_name": "Agung Setiawan", "link": "https://stackoverflow.com/users/1224718/agung-setiawan"}, "reply_to_user": {"reputation": 2345, "user_id": 4988918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x1BRI.png?s=128&g=1", "display_name": "Mark Merritt", "link": "https://stackoverflow.com/users/4988918/mark-merritt"}, "edited": false, "score": 0, "creation_date": 1569387229, "post_id": 58091288, "comment_id": 102575334, "body": "@MarkMerritt what is actually happening behind the scene when I pass complex object to ActiveJob with Sidekiq as its backend."}, {"owner": {"reputation": 2345, "user_id": 4988918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x1BRI.png?s=128&g=1", "display_name": "Mark Merritt", "link": "https://stackoverflow.com/users/4988918/mark-merritt"}, "edited": false, "score": 0, "creation_date": 1569387604, "post_id": 58091288, "comment_id": 102575428, "body": "I&#39;m not sure what a &quot;complex object&quot; means...It seems like you should just pass in the id to your job"}, {"owner": {"reputation": 1058, "user_id": 1224718, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/d6b40ad0c1934651afa0d293ec822d22?s=128&d=identicon&r=PG", "display_name": "Agung Setiawan", "link": "https://stackoverflow.com/users/1224718/agung-setiawan"}, "reply_to_user": {"reputation": 2345, "user_id": 4988918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x1BRI.png?s=128&g=1", "display_name": "Mark Merritt", "link": "https://stackoverflow.com/users/4988918/mark-merritt"}, "edited": false, "score": 0, "creation_date": 1569387797, "post_id": 58091288, "comment_id": 102575476, "body": "According to the wiki (link on the question) it&#39;s something other than string, integer, float, boolean, null(nil), array and hash. So any ActiveRecord object, Date, DateTime, etc considered &quot;complex objects&quot;"}, {"owner": {"reputation": 1058, "user_id": 1224718, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/d6b40ad0c1934651afa0d293ec822d22?s=128&d=identicon&r=PG", "display_name": "Agung Setiawan", "link": "https://stackoverflow.com/users/1224718/agung-setiawan"}, "reply_to_user": {"reputation": 2345, "user_id": 4988918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x1BRI.png?s=128&g=1", "display_name": "Mark Merritt", "link": "https://stackoverflow.com/users/4988918/mark-merritt"}, "edited": false, "score": 0, "creation_date": 1569388281, "post_id": 58091288, "comment_id": 102575616, "body": "Yeah I think so too when we use Sidekiq to only pass an id. But ActiveJob clearly stated that it is possible to pass an actual object, not just its id. And my question arise when combining ActiveJob and Sidekiq"}, {"owner": {"reputation": 2345, "user_id": 4988918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x1BRI.png?s=128&g=1", "display_name": "Mark Merritt", "link": "https://stackoverflow.com/users/4988918/mark-merritt"}, "edited": false, "score": 0, "creation_date": 1569388775, "post_id": 58091288, "comment_id": 102575749, "body": "It is possible to pass in an object...but I&#39;m assuming this is something that is stored in the DB and can accessed via an id (or, maybe not?)"}, {"owner": {"reputation": 862, "user_id": 1600046, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/5rxUl.jpg?s=128&g=1", "display_name": "Vibol", "link": "https://stackoverflow.com/users/1600046/vibol"}, "edited": false, "score": 0, "creation_date": 1569389283, "post_id": 58091288, "comment_id": 102575911, "body": "It&#39;s a best practice to pass <code>id</code> or simple data type like <code>int</code>, <code>string</code>, or <code>json</code>, but you can also pass <code>ActiveRecord</code> object. The document mention very clear why it&#39;s good to send <code>id</code> rather than actual object."}], "answers": [{"tags": [], "owner": {"reputation": 16672, "user_id": 22237, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/hkobD.png?s=128&g=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/22237/kris"}, "is_accepted": false, "score": 1, "last_activity_date": 1569403115, "last_edit_date": 1569403115, "creation_date": 1569402038, "answer_id": 58094807, "question_id": 58091288, "link": "https://stackoverflow.com/questions/58091288/activejob-with-sidekiq-backend-passing-complex-object-as-parameter/58094807#58094807", "title": "ActiveJob with Sidekiq backend passing complex object as parameter", "body": "<p>You can find the global id of a model with <code>#to_global_id</code>:</p>\n\n<pre><code>gid = MyModel.first.to_global_id\n\ngid.uri # =&gt; #&lt;URI ...\n\ngid.to_s # =&gt; \"gid://...\"\n\nGlobalID::Locator.locate(gid) # =&gt; #&lt;MyModel\n</code></pre>\n\n<p>The code for <code>GlobalID</code> is <a href=\"https://github.com/rails/globalid/blob/master/lib/global_id/global_id.rb\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>It creates a URI from the application name, model class, model id and optional params. This is done in <a href=\"https://github.com/rails/globalid/blob/master/lib/global_id/uri/gid.rb\" rel=\"nofollow noreferrer\">GlobalID::URI::GID</a>.</p>\n\n<p>You can create you own GID as such:</p>\n\n<pre><code>URI::GID.create('myapp', MyModel.first, database: 'my_app_development')\n# =&gt; #&lt;URI::GID gid://myapp/MyModel/1?database=my_app_development&gt;\n</code></pre>\n\n<p>The model passed must be ActiveRecord complaint, so passing a PORO (Plain Old Ruby Object) will not work:</p>\n\n<pre><code>class MyModel\nend\n\nURI::GID.create('myapp', MyModel.new)\n# =&gt; NoMethodError (undefined method `id'\n</code></pre>\n\n<p>Let's add an id attribute:</p>\n\n<pre><code>MyModel = Struct.new(:id)\n\ngid = URI::GID.create('myapp', MyModel.new(1))\n# =&gt; #&lt;URI::GID gid://myapp/MyModel/1&gt;\n\nGlobalID::Locator.locate(gid)\n# =&gt; NoMethodError (undefined method `find' for MyModel:Class)\n</code></pre>\n\n<p>And a class method <code>#find</code>:</p>\n\n<pre><code>MyModel = Struct.new(:id) do\n  def self.find(id)\n    new(id)\n  end\nend\n\ngid = URI::GID.create('myapp', MyModel.new(1))\n\nGlobalID::Locator.locate(gid)\n# =&gt; #&lt;struct MyModel id=\"1\"&gt;\n</code></pre>\n"}], "owner": {"reputation": 1058, "user_id": 1224718, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/d6b40ad0c1934651afa0d293ec822d22?s=128&d=identicon&r=PG", "display_name": "Agung Setiawan", "link": "https://stackoverflow.com/users/1224718/agung-setiawan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 573, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1569403115, "creation_date": 1569386649, "question_id": 58091288, "link": "https://stackoverflow.com/questions/58091288/activejob-with-sidekiq-backend-passing-complex-object-as-parameter", "title": "ActiveJob with Sidekiq backend passing complex object as parameter", "body": "<p>Sidekiq worker's parameter should be simple data type according to this wiki by the author (<a href=\"https://github.com/mperham/sidekiq/wiki/Best-Practices\" rel=\"nofollow noreferrer\">https://github.com/mperham/sidekiq/wiki/Best-Practices</a>)</p>\n\n<p>ActiveJob's parameter can be complex object, thanks to Global ID (<a href=\"https://edgeguides.rubyonrails.org/active_job_basics.html#globalid\" rel=\"nofollow noreferrer\">https://edgeguides.rubyonrails.org/active_job_basics.html#globalid</a>)</p>\n\n<p>ActiveJob backend can be configured to use Sidekiq.</p>\n\n<p>So what happen behind the scene when I pass complex object to an ActiveJob worker with Sidekiq backend? I don't think Sidekiq will fail in processing it due to \"will not survive the dump/load round trip correctly\" this time.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "rvm", "rbenv"], "comments": [{"owner": {"reputation": 1864, "user_id": 459856, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70037e355609caceae2500b183d28f58?s=128&d=identicon&r=PG", "display_name": "tjeden", "link": "https://stackoverflow.com/users/459856/tjeden"}, "edited": false, "score": 0, "creation_date": 1569398868, "post_id": 58090840, "comment_id": 102580117, "body": "You don&#39;t have to create gemset, everything should work just by installing correct ruby version."}], "answers": [{"tags": [], "owner": {"reputation": 759, "user_id": 4352003, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I0GKg.jpg?s=128&g=1", "display_name": "Yury Matusevich", "link": "https://stackoverflow.com/users/4352003/yury-matusevich"}, "is_accepted": false, "score": 0, "last_activity_date": 1569395828, "creation_date": 1569395828, "answer_id": 58093050, "question_id": 58090840, "link": "https://stackoverflow.com/questions/58090840/rbenv-creating-a-gemset/58093050#58093050", "title": "RBenv - creating a gemset", "body": "<p>By default rbenv does not support gemsets.</p>\n\n<p>You need to set up <a href=\"https://github.com/jf/rbenv-gemset\" rel=\"nofollow noreferrer\">this</a> plugin to work with gemsets.</p>\n\n<pre><code># Set up a default gemset for your project.\n# Also will create a `.rbenv-gemsets` file in the current directory.\n# NOTE: this will create the gemset under the current ruby version.\nrbenv gemset init\n\n# Alternatively, you can provide `rbenv gemset init` with the name of a gemset:\nrbenv gemset init [gemset]\n\n# To create a gemset under a specific ruby version:\nrbenv gemset create [version] [gemset]\n\n# You can list the existing gemsets by using the following command:\n# This should include the most recent gemset you just created.\nrbenv gemset list\n\n# You can delete a gemset with the following command:\nrbenv gemset delete [version] [gemset]\n</code></pre>\n"}], "owner": {"reputation": 139, "user_id": 10809113, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-6At-0l8lnSc/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-g9X6dY7bVguQPi1yhCXLM6iYHudA/mo/photo.jpg?sz=128", "display_name": "JHero23", "link": "https://stackoverflow.com/users/10809113/jhero23"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1324, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1569395828, "creation_date": 1569382784, "question_id": 58090840, "link": "https://stackoverflow.com/questions/58090840/rbenv-creating-a-gemset", "title": "RBenv - creating a gemset", "body": "<p>Its a pretty straightforward question, so I'm trying to learn Ruby on Rails, I am following a tutorial, however they're saying that because they used RVM for the longest, they recommend to use RVM.</p>\n\n<p>I have been using RBenv because the WSL installation recommends me to do so, and I'm confused on a part of the tutorial where it says <code>rvm use --create ruby-version@project</code>, that tells me that they're creating a gemset for project, but they're using rvm. I don't know what the equivalent command is for RBenv.</p>\n\n<p>I am currently using Bundler 2. </p>\n\n<p>My question is what is the equivalent command to <code>rvm use --create ruby-version@project</code>? And can you give me an example?</p>\n\n<p>Please and thank you.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "erb", "faraday"], "comments": [{"owner": {"reputation": 2837, "user_id": 6245337, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8VoQ5.jpg?s=128&g=1", "display_name": "Ana Mar&#237;a Mart&#237;nez G&#243;mez", "link": "https://stackoverflow.com/users/6245337/ana-mar%c3%ada-mart%c3%adnez-g%c3%b3mez"}, "edited": false, "score": 0, "creation_date": 1569383134, "post_id": 58090771, "comment_id": 102574501, "body": "when is do_something called? what is get_trustpilot_reviews doing?"}, {"owner": {"reputation": 547, "user_id": 7602290, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5893d7c28bef1b3652c5d9694dd11f1f?s=128&d=identicon&r=PG&f=1", "display_name": "Doolan", "link": "https://stackoverflow.com/users/7602290/doolan"}, "reply_to_user": {"reputation": 2837, "user_id": 6245337, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8VoQ5.jpg?s=128&g=1", "display_name": "Ana Mar&#237;a Mart&#237;nez G&#243;mez", "link": "https://stackoverflow.com/users/6245337/ana-mar%c3%ada-mart%c3%adnez-g%c3%b3mez"}, "edited": false, "score": 0, "creation_date": 1569383683, "post_id": 58090771, "comment_id": 102574606, "body": "I fixed the typos but what I believe is happening (lol) is that <code>do_something</code> is calling the <code>initialize</code> method on a new instance of <code>SomeService</code> which is supposed to call the <code>get_reviews</code> method @AnaMar&#237;aMart&#237;nezG&#243;mez"}, {"owner": {"reputation": 12135, "user_id": 538471, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/d2051553a8bdd27c26fec84b47806714?s=128&d=identicon&r=PG", "display_name": "dan-klasson", "link": "https://stackoverflow.com/users/538471/dan-klasson"}, "edited": false, "score": 1, "creation_date": 1569386211, "post_id": 58090771, "comment_id": 102575118, "body": "Get rid of <code>@response = </code> and you also don&#39;t need the <code>.initialize</code>"}, {"owner": {"reputation": 547, "user_id": 7602290, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5893d7c28bef1b3652c5d9694dd11f1f?s=128&d=identicon&r=PG&f=1", "display_name": "Doolan", "link": "https://stackoverflow.com/users/7602290/doolan"}, "reply_to_user": {"reputation": 12135, "user_id": 538471, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/d2051553a8bdd27c26fec84b47806714?s=128&d=identicon&r=PG", "display_name": "dan-klasson", "link": "https://stackoverflow.com/users/538471/dan-klasson"}, "edited": false, "score": 0, "creation_date": 1569387660, "post_id": 58090771, "comment_id": 102575442, "body": "@dan-klasson I got rid of the <code>@response</code> instance variable and removed <code>.initialize</code> but still nothing. Also haven&#39;t been getting any errors either so it&#39;s making me feel like I didn&#39;t wire everything up correctly?"}, {"owner": {"reputation": 12135, "user_id": 538471, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/d2051553a8bdd27c26fec84b47806714?s=128&d=identicon&r=PG", "display_name": "dan-klasson", "link": "https://stackoverflow.com/users/538471/dan-klasson"}, "edited": false, "score": 1, "creation_date": 1569387838, "post_id": 58090771, "comment_id": 102575491, "body": "@DylanNguyen I mean get rid of it in the service. Also, just use <code>pry</code> and debug where your problem is."}, {"owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 0, "creation_date": 1569390186, "post_id": 58090771, "comment_id": 102576205, "body": "Try defining <code>get_reviews</code> directly in the controller, see if that works."}, {"owner": {"reputation": 2572, "user_id": 2862049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffd65bc37e559c2c407f064f308828a4?s=128&d=identicon&r=PG&f=1", "display_name": "Lukas Baliak", "link": "https://stackoverflow.com/users/2862049/lukas-baliak"}, "edited": false, "score": 0, "creation_date": 1569415217, "post_id": 58090771, "comment_id": 102589075, "body": "I can see <code>#{APIURL}</code> and <code>API_URL</code> constant, maybe this is the problem ?"}, {"owner": {"reputation": 934, "user_id": 3663124, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/dd2b3438ed3252dce5c184b4eace56ba?s=128&d=identicon&r=PG&f=1", "display_name": "fedest", "link": "https://stackoverflow.com/users/3663124/fedest"}, "edited": false, "score": 0, "creation_date": 1569422976, "post_id": 58090771, "comment_id": 102593848, "body": "I didn&#39;t understand the whole problem. You have two separate services or it&#39;s just one ror + react application? If it&#39;s the latest, how do you launch the react component?"}, {"owner": {"reputation": 750, "user_id": 406551, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sjuJz.jpg?s=128&g=1", "display_name": "AxelTheGerman", "link": "https://stackoverflow.com/users/406551/axelthegerman"}, "edited": false, "score": 0, "creation_date": 1569428318, "post_id": 58090771, "comment_id": 102596725, "body": "@DylanNguyen try to just render the API response in your view as text. If that works, you probably have to serialize it to JSON to pass it into your react component"}, {"owner": {"reputation": 1073, "user_id": 4024628, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Xc5J8.jpg?s=128&g=1", "display_name": "Allison", "link": "https://stackoverflow.com/users/4024628/allison"}, "edited": false, "score": 0, "creation_date": 1569473019, "post_id": 58090771, "comment_id": 102609286, "body": "Re: passing data to the partial, try:  <code>render &#39;my_review_partial&#39;, locals: { reviews: @reviews }</code>   See <a href=\"https://guides.rubyonrails.org/layouts_and_rendering.html#passing-local-variables\" rel=\"nofollow noreferrer\">guides.rubyonrails.org/&hellip;</a>"}], "owner": {"reputation": 547, "user_id": 7602290, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5893d7c28bef1b3652c5d9694dd11f1f?s=128&d=identicon&r=PG&f=1", "display_name": "Doolan", "link": "https://stackoverflow.com/users/7602290/doolan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1569383408, "creation_date": 1569382136, "last_edit_date": 1569383408, "question_id": 58090771, "link": "https://stackoverflow.com/questions/58090771/passing-data-from-controller-to-partial-view-in-ror", "title": "Passing data from controller to partial/view in RoR", "body": "<p>Haven't worked with Ruby + RoR in a professional setting until now. Currently, I am passing <code>.env</code> variables onto the mounted react component as a prop and then making the GET request via axios on the client like so.</p>\n\n<pre><code>&lt;%- cache(element_view) do -%&gt;\n  &lt;%= element_view_for(element_view) do |el| -%&gt;\n    &lt;div class=\"flex sm:flex-col\"&gt;\n      &lt;div class=\"sm:w-full ns:w-full text-center\"&gt;\n        &lt;%= react_component('element/SomeElement', {\n          id: ENV[\"ID\"], key: ENV[\"KEY\"]\n        }) %&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n  &lt;%- end %&gt;\n&lt;%- end %&gt;\n</code></pre>\n\n<p>But the team wants me to move the request into a backend service. This is what I currently have.</p>\n\n<pre><code>class SomeService\n  API_URL = \"someEndPoint\"\n  def initialize\n    @response = get_reviews\n  end\n\n  def get_reviews\n    conn = Faraday.new(url: \"#{APIURL}/#{ENV[\"ID\"]}/reviews?language=en&amp;stars=5\") do |faraday|\n      faraday.headers[\"apikey\"] = ENV[\"KEY\"]\n      faraday.adapter Faraday.default_adapter\n    end\n    response = conn.get\n    response.body\n  end\nend\n</code></pre>\n\n<p>I'm trying to use this service in a controller that looks like this</p>\n\n<pre><code>class SomeController &lt; ApplicationController\n  def show\n    @reviews = do_something\n  end\n\n  def do_something\n    SomeService.new.initialize\n  end\nend\n</code></pre>\n\n<p>And I want to access the data on the partial like <code>&lt;%= @reviews %&gt;</code> but I can't seem to get any data back. I know the request works because I've tested it as a single ruby file. This may seem extremely non-descript but I did so for privacy sake. The code is probably a mess but please let me know if I need to add more details.</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "edited": false, "score": 0, "creation_date": 1569379369, "post_id": 58090440, "comment_id": 102573824, "body": "You gotta show the definition of the class and the <code>set_type</code> method. this is not reproducible with this little info"}, {"owner": {"reputation": 3, "user_id": 10660238, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jWVku.jpg?s=128&g=1", "display_name": "J. Rafko", "link": "https://stackoverflow.com/users/10660238/j-rafko"}, "reply_to_user": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "edited": false, "score": 0, "creation_date": 1569379578, "post_id": 58090440, "comment_id": 102573865, "body": "@maxpleaner I updated it!"}, {"owner": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "edited": false, "score": 1, "creation_date": 1569380254, "post_id": 58090440, "comment_id": 102573991, "body": "yeah it&#39;s like I expected, this is a class-level instance var not a regular instance var. It is shared with all instances. Use <code>attr_reader :type</code> and <code>@type = num</code> instead"}, {"owner": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "edited": false, "score": 1, "creation_date": 1569386810, "post_id": 58090440, "comment_id": 102575241, "body": "Sorry i misspoke, it is a class variable not a class-level instance variable."}], "answers": [{"tags": [], "owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "is_accepted": true, "score": 1, "last_activity_date": 1569388590, "last_edit_date": 1569388590, "creation_date": 1569382010, "answer_id": 58090752, "question_id": 58090440, "link": "https://stackoverflow.com/questions/58090440/when-creating-multiple-instances-of-an-object-treats-them-like-the-same-object/58090752#58090752", "title": "When creating multiple instances of an object, treats them like the same object in memory", "body": "<p>To fill in what max said in comments:</p>\n\n<p>The <code>@@</code> sigil defines a class variable (kind of like Java's <code>static</code>). Instance variables are identified by the <code>@</code> sigil. All of your objects have the same value because they are all sharing the same class variable.</p>\n\n<p><code>set_type</code> looks quite unRubyish in most cases. Java's convention of <code>getFoo</code> translates to just <code>foo</code> in Ruby, and <code>setFoo</code> to <code>foo=</code>. As in</p>\n\n<pre><code>def foo\n  @foo\nend\n\ndef foo=(value)\n  @foo = value\nend\n</code></pre>\n\n<p>Furthermore, <code>obj.foo = bar</code> is a syntactic sugar for <code>obj.foo=(bar)</code> (invoking the function <code>foo=</code> with argument <code>bar</code>), so the code looks natural (i.e. using a setter looks like assigning a variable).</p>\n\n<p><code>attr_accessor :foo</code> will make both of those methods for you. <code>attr_reader :foo</code> and <code>attr_writer :foo</code> make just the getter, or just the setter method. Thus, your code can be written as</p>\n\n<pre><code>class Digit\n  attr_writer :type\nend\n\nn_three = Digit.new\nn_three.type = 3\n</code></pre>\n\n<p>which is identical to</p>\n\n<pre><code>class Digit\n  def type=(value)\n    @type = value\n  end\nend\n\nn_three = Digit.new\nn_three.type=(3)\n</code></pre>\n\n<p>Of course, if you wish to <em>read</em> <code>n_three.type</code>, you will need to also define a getter (or replace <code>attr_writer</code> with <code>attr_accessor</code> in the first snippet). Note that you also do not need to initialize <code>@type</code> to <code>nil</code>, as it is the default value of an uninitialised instance variable. But you could initialise it in the <code>initialize</code> method.</p>\n\n<p>Java conflates constructor and initialiser; in Ruby, the constructor is <code>::new</code> (the class method we typically call to create new objects, which you almost never need to override); and the initialiser is <code>#initialize</code> (automatically called by the default constructor). You cannot initialise instance variables outside a method like you can in Java. So, the correct way to initialise an instance variable would be:</p>\n\n<pre><code>class Digit\n  attr_writer :type\n\n  def initialize(type)\n    @type = type\n  end\nend\n</code></pre>\n\n<p>If you defined a setter, you could (and likely should) use <code>self.type = type</code> instead of <code>@type = type</code>.</p>\n"}], "owner": {"reputation": 3, "user_id": 10660238, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jWVku.jpg?s=128&g=1", "display_name": "J. Rafko", "link": "https://stackoverflow.com/users/10660238/j-rafko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 58090752, "answer_count": 1, "score": 0, "last_activity_date": 1569388590, "creation_date": 1569379140, "last_edit_date": 1569379558, "question_id": 58090440, "link": "https://stackoverflow.com/questions/58090440/when-creating-multiple-instances-of-an-object-treats-them-like-the-same-object", "title": "When creating multiple instances of an object, treats them like the same object in memory", "body": "<p>So basically, I'm trying to have different instances of the same object. I'm coming from java, and in java you can just use the new keyword and you're done. I tried \"Digit.new\" and the last assigned instance of that object changed all instances of that object</p>\n\n<p>I've tried using the \"self\" keyword, but it just crashes my program.</p>\n\n<pre><code>n_one = Digit.new\nn_two = Digit.new\nn_three = Digit.new\nn_four = Digit.new\nam_pm = Digit.new\n\n.\n.\n.\nn_three.set_type 3\n\nn_four.set_type 1\n\nclass Digit\n  @@type = nil\n\n  #This will determine what strings will be returned\n  def set_type num\n    @@type = num\n  end\nend\n</code></pre>\n\n<p>What's expected is the type of n_three is 3 and n_four is 1. But n_one, two, three, and four are all 1.</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 54921, "user_id": 294949, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3326427b9c2edc60ad293fdf51c5ba4c?s=128&d=identicon&r=PG&f=1", "display_name": "danh", "link": "https://stackoverflow.com/users/294949/danh"}, "edited": false, "score": 0, "creation_date": 1569380355, "post_id": 58090435, "comment_id": 102574007, "body": "Try the if statement with case equality <code>a.class === A</code>."}, {"owner": {"reputation": 4416, "user_id": 2012677, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/8d7cb2fe712fb17f44f8c354bf37e7b5?s=128&d=identicon&r=PG&f=1", "display_name": "user2012677", "link": "https://stackoverflow.com/users/2012677/user2012677"}, "reply_to_user": {"reputation": 54921, "user_id": 294949, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3326427b9c2edc60ad293fdf51c5ba4c?s=128&d=identicon&r=PG&f=1", "display_name": "danh", "link": "https://stackoverflow.com/users/294949/danh"}, "edited": false, "score": 0, "creation_date": 1569380405, "post_id": 58090435, "comment_id": 102574016, "body": "Trying to do the reverse, a case statement with =="}, {"owner": {"reputation": 16672, "user_id": 22237, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/hkobD.png?s=128&g=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/22237/kris"}, "edited": false, "score": 0, "creation_date": 1569405329, "post_id": 58090435, "comment_id": 102583691, "body": "You can&#39;t use <code>==</code>, it is always <code>===</code>."}, {"owner": {"reputation": 16672, "user_id": 22237, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/hkobD.png?s=128&g=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/22237/kris"}, "edited": false, "score": 1, "creation_date": 1569405379, "post_id": 58090435, "comment_id": 102583729, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/43957892/ruby-case-class-check\">Ruby Case class check</a>"}], "answers": [{"tags": [], "owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "is_accepted": true, "score": 6, "last_activity_date": 1569383240, "last_edit_date": 1569383240, "creation_date": 1569382903, "answer_id": 58090854, "question_id": 58090435, "link": "https://stackoverflow.com/questions/58090435/if-statement-and-case-statement-not-matching/58090854#58090854", "title": "If statement and Case statement - Not matching", "body": "<p>The form <code>case specific when archetype...</code> will always use the <code>archetype.===(specific)</code> subsumption check. To use <code>==</code>, you would need to be explicit, and use the other form: <code>case when boolean</code>:</p>\n\n<pre><code>case\nwhen a.class == A\n  puts \"done\"\nelse\n  puts \"else\"\nend\n</code></pre>\n\n<p>However, in this specific case (checking if an object belongs in a class), if you don't care whether <code>a</code> is an instance of <code>A</code> or an instance of a subclass of <code>A</code> (which is almost always the case), you can still use the subsumption check, like this:</p>\n\n<pre><code>case a         # Note: not a.class\nwhen A\n  puts \"done\"\nelse\n  puts \"else\"\nend\n</code></pre>\n\n<p>because <code>A === a</code> when <code>A</code> is a class is pretty much the same as <code>a.is_a?(A)</code>. Note that this is different from <code>a.class == A</code>, which will not be true if <code>a</code> is an instance of a subclass of <code>A</code>. For example for <code>class Dog &lt; Animal</code>, and <code>fido = Dog.new</code>, both <code>fido.instance_of?(Animal)</code> and <code>fido.class == Animal</code> are false, but both <code>fido.is_a?(Animal)</code> and <code>Animal === fido</code> are true.)</p>\n"}], "owner": {"reputation": 4416, "user_id": 2012677, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/8d7cb2fe712fb17f44f8c354bf37e7b5?s=128&d=identicon&r=PG&f=1", "display_name": "user2012677", "link": "https://stackoverflow.com/users/2012677/user2012677"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 1, "accepted_answer_id": 58090854, "answer_count": 1, "score": 4, "last_activity_date": 1569383240, "creation_date": 1569379107, "last_edit_date": 1569379408, "question_id": 58090435, "link": "https://stackoverflow.com/questions/58090435/if-statement-and-case-statement-not-matching", "title": "If statement and Case statement - Not matching", "body": "<h2>Why would the <code>if</code> statement work, but the <code>case</code> statement not work?</h2>\n\n<pre><code>class A\nend      # =&gt; nil\n\na= A.new  # =&gt; #&lt;A:0x00007fd9d6134770&gt;\n</code></pre>\n\n<h3><code>If</code> statement works</h3>\n\n<pre><code>a.class == A  # =&gt; true\n</code></pre>\n\n<h3><code>Case</code> statement does not work</h3>\n\n<pre><code>case a.class   # =&gt; A\nwhen A\n  puts \"done\"\nelse\n  puts \"else\"  # =&gt; nil\nend            # =&gt; nil\n\n# &gt;&gt; else\n</code></pre>\n\n<p>I read that case statement use <code>===</code> operators instead of <code>==</code>, how do I use <code>==</code> for the case statement?</p>\n"}, {"tags": ["javascript", "ruby-on-rails", "ruby"], "answers": [{"comments": [{"owner": {"reputation": 1263, "user_id": 10221813, "user_type": "registered", "profile_image": "https://graph.facebook.com/10160530708235447/picture?type=large", "display_name": "uno", "link": "https://stackoverflow.com/users/10221813/uno"}, "edited": false, "score": 0, "creation_date": 1569517567, "post_id": 58090599, "comment_id": 102631869, "body": "How does this work exactly? if the grouped_collection_select is being changed into the hidden field, doesn&#39;t that also need some sort of <code>onchange</code> as well?"}, {"owner": {"reputation": 1263, "user_id": 10221813, "user_type": "registered", "profile_image": "https://graph.facebook.com/10160530708235447/picture?type=large", "display_name": "uno", "link": "https://stackoverflow.com/users/10221813/uno"}, "edited": false, "score": 0, "creation_date": 1569517662, "post_id": 58090599, "comment_id": 102631924, "body": "I am just confused on how exactly the <code>grouped_collection_select</code> value is being passed to the hidden field here"}, {"owner": {"user_type": "does_not_exist", "display_name": "user11607383"}, "reply_to_user": {"reputation": 1263, "user_id": 10221813, "user_type": "registered", "profile_image": "https://graph.facebook.com/10160530708235447/picture?type=large", "display_name": "uno", "link": "https://stackoverflow.com/users/10221813/uno"}, "edited": false, "score": 0, "creation_date": 1569752175, "post_id": 58090599, "comment_id": 102691533, "body": "@uno you&#39;d do it with jquery. Just attach a simple <code>$(&#39;#selected-color-field&#39;).val(event.target.value)</code> to the select change."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user11607383"}, "is_accepted": false, "score": 1, "last_activity_date": 1569380765, "creation_date": 1569380765, "answer_id": 58090599, "question_id": 58089660, "link": "https://stackoverflow.com/questions/58089660/how-to-store-value-of-select-tag-in-javascript-var/58090599#58090599", "title": "how to store value of select_tag in javascript var?", "body": "<p>You could always just store the value in a <a href=\"https://apidock.com/rails/ActionView/Helpers/FormTagHelper/hidden_field_tag\" rel=\"nofollow noreferrer\">hidden field</a> element and just update the value of it whenever the select changes. </p>\n\n<p>Then do something like </p>\n\n<pre><code>&lt;%= hidden_field_tag 'color_id', '0', onchange: \"changeColor()\", id: 'selected-color-field'%&gt;\n&lt;script&gt;\n  function changeColor() {\n    var selectedColor = document.getElementById(\"selected-color-field\").value\n    // Do whatever\n  }\n&lt;/script&gt;\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1263, "user_id": 10221813, "user_type": "registered", "profile_image": "https://graph.facebook.com/10160530708235447/picture?type=large", "display_name": "uno", "link": "https://stackoverflow.com/users/10221813/uno"}, "edited": false, "score": 0, "creation_date": 1569512502, "post_id": 58106878, "comment_id": 102629467, "body": "Thanks but this is giving me an error in the javascript due to the ruby: <code>Unexpected token &amp;</code> ... Assuming this is due to pluck but what do you think: <code>const colors = {&amp;quot;1&amp;quot;:&amp;quot;White&amp;quot;,&amp;quot;2&amp;quot;:&amp;quot;Black&amp;q&zwnj;&#8203;uot;,&amp;quot;3&amp;quot;:&amp;&zwnj;&#8203;quot;Blue&amp;quot;,&amp;quo&zwnj;&#8203;t;4&amp;quot;:&amp;quot;Red&amp;&zwnj;&#8203;quot;};</code>"}, {"owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "reply_to_user": {"reputation": 1263, "user_id": 10221813, "user_type": "registered", "profile_image": "https://graph.facebook.com/10160530708235447/picture?type=large", "display_name": "uno", "link": "https://stackoverflow.com/users/10221813/uno"}, "edited": false, "score": 0, "creation_date": 1569513409, "post_id": 58106878, "comment_id": 102629905, "body": "@uno Seems like ERB replaces the HTML unsafe characters. Add <code>.html_safe</code> add the and to mark the string as HTML secure. I&#39;ll update the answer."}, {"owner": {"reputation": 1263, "user_id": 10221813, "user_type": "registered", "profile_image": "https://graph.facebook.com/10160530708235447/picture?type=large", "display_name": "uno", "link": "https://stackoverflow.com/users/10221813/uno"}, "edited": false, "score": 0, "creation_date": 1569515863, "post_id": 58106878, "comment_id": 102631062, "body": "Thanks! Just had to use <code>var</code> instead of <code>const</code> because my javascript is looped onto multiple canvas&#39;s"}], "tags": [], "owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "is_accepted": true, "score": 1, "last_activity_date": 1569513533, "last_edit_date": 1569513533, "creation_date": 1569447518, "answer_id": 58106878, "question_id": 58089660, "link": "https://stackoverflow.com/questions/58089660/how-to-store-value-of-select-tag-in-javascript-var/58106878#58106878", "title": "how to store value of select_tag in javascript var?", "body": "<p>You can't access JavaScript variables from inside the ERB tags. ERB lies on top of the script. Meaning that when the page request is made to the Rails server it will compile the page so that the ERB is interpreted. Then a plain JavaScript file or HTML file is send to the client. The JavaScript will be executed on the client.</p>\n\n<pre><code>&lt;%= Color.find(bg_color) %&gt;\n</code></pre>\n\n<p>Is run on the server side and has no access to the JavaScript variable <code>bg_color</code>.</p>\n\n<p>A simple solution is to provide all the colors up front and pick the color from that.</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>const colors = &lt;%= Color.pluck(:id, :value).to_h.to_json.html_safe %&gt;;\n\ndocument.getElementById(\"tshirt-color\").addEventListener(\"change\", function(){\n  document.getElementById(\"tshirt-div\").style.backgroundColor = colors[this.value];\n}, false);\n</code></pre>\n\n<p>If you don't want to provide all colors up front you'll have to set-up an AJAX request that queries the server when selecting a color.</p>\n\n<hr>\n\n<p>Let me quickly explain <code>&lt;%= Color.pluck(:id, :value).to_h.to_json.html_safe %&gt;</code>.</p>\n\n<pre><code>tmp = Color.pluck(:id, :value) # retrieve the id and value of the colors\n#=&gt; [[1, \"#fff\"], [2, \"#000\"]]\ntmp = tmp.to_h # convert the nested array into a hash\n#=&gt; { 1 =&gt; \"#fff\", 2 =&gt; \"#000\" }\ntmp = tmp.to_json # convert the hash to a JSON string\n#=&gt; '{\"1\":\"#fff\", \"2\":\"#000\"}'\ntmp = tmp.html_safe # mark the string as HTML safe so ERB won't replace characters such as \" with &amp;quot;\n#=&gt; '{\"1\":\"#fff\", \"2\":\"#000\"}'\n</code></pre>\n\n<p>Since JSON is short for JavaScript Object Notation it can simply be read by read as part of JavaScript.</p>\n\n<hr>\n\n<p>Alternatively you could manually build the options, and provide the color value through a custom attribute. An option could for example look something like this:</p>\n\n<pre class=\"lang-html prettyprint-override\"><code>&lt;option value=\"1\" data-color-value=\"#fff\"&gt;White&lt;/option&gt;\n</code></pre>\n\n<p>Then use the additional attribute to set the color.</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>const color = this.options[this.selectedIndex].dataset.colorValue;\ndocument.getElementById(\"tshirt-div\").style.backgroundColor = color;\n</code></pre>\n"}], "owner": {"reputation": 1263, "user_id": 10221813, "user_type": "registered", "profile_image": "https://graph.facebook.com/10160530708235447/picture?type=large", "display_name": "uno", "link": "https://stackoverflow.com/users/10221813/uno"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 58106878, "answer_count": 2, "score": 1, "last_activity_date": 1569513533, "creation_date": 1569371399, "last_edit_date": 1569446774, "question_id": 58089660, "link": "https://stackoverflow.com/questions/58089660/how-to-store-value-of-select-tag-in-javascript-var", "title": "how to store value of select_tag in javascript var?", "body": "<p>I want to store the value of  the select from a form into my javascript.</p>\n\n<p>This works:</p>\n\n<pre class=\"lang-html prettyprint-override\"><code>&lt;div id=\"tshirt-div\"&gt;\n    ....\n&lt;/div&gt;\n&lt;select id=\"tshirt-color\"&gt;\n   &lt;option value=\"#fff\"&gt;White&lt;/option&gt;\n   &lt;option value=\"#000\"&gt;Black&lt;/option&gt;\n   &lt;option value=\"#f00\"&gt;Red&lt;/option&gt;\n   &lt;option value=\"#008000\"&gt;Green&lt;/option&gt;\n   &lt;option value=\"#ff0\"&gt;Yellow&lt;/option&gt;\n&lt;/select&gt;\n\n&lt;script&gt;\ndocument.getElementById(\"tshirt-color\").addEventListener(\"change\", function(){\n    document.getElementById(\"tshirt-div\").style.backgroundColor = this.value;\n}, false);\n&lt;/script&gt;\n</code></pre>\n\n<p>I am trying to do this:</p>\n\n<pre class=\"lang-erb prettyprint-override\"><code>&lt;%= f.grouped_collection_select :color_id, @items.order(:title), :colors, :title, :id, :title, include_blank: \"Select Color\", id: \"tshirt-color\" %&gt;\n&lt;script&gt;\ndocument.getElementById(\"tshirt-color\").addEventListener(\"change\", function(){\n   var bg_color = this.value\n   document.getElementById(\"tshirt-div\").style.backgroundColor = &lt;%= Color.find(bg_color) %&gt;;\n}, false);\n&lt;/script&gt;\n</code></pre>\n\n<p>A few of my attempts:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>var bg_color = document.getElementById(\"tshirt-color\").value\n</code></pre>\n\n<p>inside and outside of the function</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>var bg_color = document.getElementById(\"tshirt-color\").addEventListener(\"change\", function(){\n    document.getElementById(\"tshirt-div\").style.backgroundColor = &lt;%= Color.find(bg_color.value) %&gt;;\n, false);\n</code></pre>\n\n<p>I have tried storing the <code>var</code> many different ways but each gives me the following error:</p>\n\n<blockquote>\n  <p>undefined local method or variable 'bg_color'</p>\n</blockquote>\n\n<p>The value of the <code>f.grouped_collection_select</code> is an integer so I want to then find the color title (red, blue, green, etc.) and return that to the <code>...style.backgroundColor</code>.</p>\n\n<p>How can I store the select from the form, store it as a variable, and then find the color from the Color model?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-5"], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 2492092, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JqMEd.png?s=128&g=1", "display_name": "Fernando M", "link": "https://stackoverflow.com/users/2492092/fernando-m"}, "edited": false, "score": 0, "creation_date": 1569377261, "post_id": 58090117, "comment_id": 102573400, "body": "Thanks Jacob, I&#39;m going to give your approach a try.  To clarify, while I have 500+ categories I only expect to render maybe 30 after I run through all of the transaction totals so I don&#39;t have any pagination (for now)."}], "tags": [], "owner": {"reputation": 470, "user_id": 1249891, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df65c5095bee4d8e1177fb87c4d81249?s=128&d=identicon&r=PG", "display_name": "Jacob Vanus", "link": "https://stackoverflow.com/users/1249891/jacob-vanus"}, "is_accepted": false, "score": 0, "last_activity_date": 1569376086, "creation_date": 1569376086, "answer_id": 58090117, "question_id": 58089582, "link": "https://stackoverflow.com/questions/58089582/rails-5-2-3-show-tree-of-categories-ordered-by-the-total-of-their-associated-r/58090117#58090117", "title": "Rails 5.2.3 - Show tree of Categories ordered by the total of their associated records", "body": "<p><strong>Caveat emptor:</strong></p>\n\n<p>Everything below should be considered pseudo-code. I didn't test any of this, I'm not trying to make it copy &amp; paste ready. It's just a starting point to help you <em>start</em> a refactor.</p>\n\n<h2>In your Model</h2>\n\n<p>You want to get stuff like <code>Transaction.where(account_id: current_user, category_id: primary_category.subtree).sum(:amount)</code> out of your views. </p>\n\n<p>You could create a method and / or scope to return the transaction total. For example:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code># app/models/transaction.rb\nscope :by_user_category, -&gt;(user, category) do \n  where(account: user, category: category.subtree)\nend\n\n# app/models/category.rb\ndef user_transaction_amount(user)\n  Transaction.by_user_category(user, self).sum(:amount)\nend\n</code></pre>\n\n<h2>In your Controller</h2>\n\n<p>You should <a href=\"https://guides.rubyonrails.org/active_record_querying.html#eager-loading-associations\" rel=\"nofollow noreferrer\">Eager load</a> the children. You know you're going to need them, so do it all at once. (<em>with-in reason, see below</em>)</p>\n\n<p>You mention 500+ categories, is this paginated? If so, do so in <a href=\"https://guides.rubyonrails.org/active_record_querying.html#retrieving-multiple-objects-in-batches\" rel=\"nofollow noreferrer\">batches</a>.</p>\n\n<h2>In your View</h2>\n\n<p>Notice that repeating code? Try using a <a href=\"https://guides.rubyonrails.org/layouts_and_rendering.html#using-partials\" rel=\"nofollow noreferrer\">partial</a> to DRY that up. For example:</p>\n\n<pre><code># app/views/categories/_category.html.erb\n&lt;% @categories.each do |category| %&gt;\n  &lt;% category_total = category.user_transaction_amount(current_user) %&gt;\n  &lt;% return if category_total == 0.0 %&gt;\n  &lt;%= link_to category.name, category_path(category) %&gt;\n  &lt;%= number_to_currency category_total %&gt;\n  &lt;% if category.has_children? &amp;&amp; category_total != 0.0 %&gt; \n      &lt;% category.children.each do |secondary_category| %&gt;\n        &lt;%= render category, category: secondary_category %&gt;\n      &lt;% end %&gt;\n  &lt;% end %&gt;\n&lt;% end %&gt;\n\n\n# app/views/categories/index.html.erb\n&lt;% @primary_categories.each do |primary_category| %&gt;\n  &lt;% render 'categories', category: primary_category %&gt;\n&lt;% end %&gt;\n</code></pre>\n\n<p>This could still use some improvement. View templates should be mostly html statements and this is 100% ruby. You could probably move this all into a helper, or even <a href=\"https://guides.rubyonrails.org/layouts_and_rendering.html#using-render\" rel=\"nofollow noreferrer\">render</a> directly from a controller action.</p>\n"}, {"tags": [], "owner": {"reputation": 25, "user_id": 2492092, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JqMEd.png?s=128&g=1", "display_name": "Fernando M", "link": "https://stackoverflow.com/users/2492092/fernando-m"}, "is_accepted": true, "score": 0, "last_activity_date": 1569551796, "creation_date": 1569551796, "answer_id": 58127028, "question_id": 58089582, "link": "https://stackoverflow.com/questions/58089582/rails-5-2-3-show-tree-of-categories-ordered-by-the-total-of-their-associated-r/58127028#58127028", "title": "Rails 5.2.3 - Show tree of Categories ordered by the total of their associated records", "body": "<p>After a bit of trial an error (based on Jacob's <a href=\"https://stackoverflow.com/a/58090117/2492092\">first answer</a>) I came up with a solution that performs significantly better, removed complexity from the controller and views and does everything on my requirements list from my first post.</p>\n\n<p>I still think there is room for optimization and clean up but here it goes:</p>\n\n<p><strong>app/models/transaction.rb</strong></p>\n\n<pre><code>  scope :by_user_category, -&gt;(user, category) do \n    where(account: user.accounts, category: category.subtree)\n  end\n</code></pre>\n\n<p><strong>app/models/category.rb</strong></p>\n\n<pre><code>  def balance(user)\n    Transaction.by_user_category(user, self).sum(:amount)\n  end\n\n  def self.spending_by(user)\n    categories_with_spending = []\n\n    categories_depth_0 = Category.where(ancestry: nil) # Get the root categories\n    categories_depth_0.each do |cat_depth_0|\n      category_depth_0_balance = cat_depth_0.balance(user)\n\n      if category_depth_0_balance &lt; 0  # \"Root category exists and has a balance\"\n        categories_depth_1_with_spending = []\n        categories_depth_1 = Category.find_by_id(cat_depth_0).children # Get the sub-categories\n\n        if !categories_depth_1.empty? # \"Sub-category exists\"\n          categories_depth_1.each do |cat_depth_1|\n            category_depth_1_balance = cat_depth_1.balance(user)\n\n            if category_depth_1_balance &lt; 0 # \"Sub-category exists and has a balance\"\n              categories_depth_2_with_spending = []\n              categories_depth_2 = Category.find_by_id(cat_depth_1).children\n\n              if !categories_depth_2.empty? # Sub-category has child\n                categories_depth_2.each do |cat_depth_2|\n                  category_depth_2_balance = cat_depth_2.balance(user)\n\n                  if category_depth_2_balance &lt; 0  # Sub-category child has a balance\n                    categories_depth_2_with_spending &lt;&lt; {\n                      category: cat_depth_2,\n                      balance: category_depth_2_balance\n                    }\n                  end\n                end\n              end\n\n              if categories_depth_2_with_spending != nil\n                # Passing child sub-categories to parent sub-categories\n                categories_depth_1_with_spending &lt;&lt; {\n                  category: cat_depth_1,\n                  balance: category_depth_1_balance,\n                  sub_categories: categories_depth_2_with_spending.sort_by { |c| c[:balance] }\n                }\n              end\n            end\n          end\n\n          if categories_depth_1_with_spending != nil\n            # Passing sub-categories to root category\n            categories_with_spending &lt;&lt; {\n              category: cat_depth_0,\n              balance: category_depth_0_balance,\n              sub_categories: categories_depth_1_with_spending.sort_by { |c| c[:balance] }\n            }\n          end\n        else\n          # \"Root exists but has no sub-categories\"\n          categories_with_spending &lt;&lt; {\n            category: cat_depth_0,\n            balance: category_depth_0_balance\n          }\n        end\n      end\n    end\n\n    return categories_with_spending.sort_by { |c| c[:balance] }\n  end\n</code></pre>\n\n<p><strong>app/controllers/categories_controller.rb</strong></p>\n\n<pre><code>  def index\n    @categories = Category.spending_by(current_user)\n  end\n</code></pre>\n\n<p><strong>app/views/categories/index.html.erb</strong></p>\n\n<pre><code>  &lt;% @categories.each do |cat_depth_0| %&gt;\n    &lt;section class=\"app-card app-amount-summary app-categories__card\"&gt;\n      &lt;%= render 'category_depth_0', category: cat_depth_0 %&gt;\n\n      &lt;% if cat_depth_0[:sub_categories] %&gt;\n        &lt;ul class=\"app-category-list\"&gt;\n          &lt;% cat_depth_0[:sub_categories].each do |cat_depth_1| %&gt;\n            &lt;%= render 'category_depth_1', category: cat_depth_1 %&gt;\n          &lt;% end %&gt;\n        &lt;/ul&gt;\n      &lt;% end %&gt;\n    &lt;/section&gt;\n  &lt;% end %&gt;\n</code></pre>\n\n<p><strong>app/views/categories/_category_depth_0.html.erb</strong></p>\n\n<pre><code>&lt;header class=\"app-card-header\"&gt;\n  &lt;h3 class=\"app-card-header__h3\"&gt;\n    &lt;%= link_to category[:category].name, category_path(category[:category].id) %&gt;\n  &lt;/h3&gt;\n  &lt;p class=\"app-card-header__balance\"&gt;&lt;%= number_to_currency category[:balance] %&gt;&lt;/p&gt;\n&lt;/header&gt;\n</code></pre>\n\n<p><code>_category_depth_1.html.erb</code> works exactly like <code>_category_depth_0.html.erb</code> but with a different structure so I skipped it on this example.</p>\n"}], "owner": {"reputation": 25, "user_id": 2492092, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JqMEd.png?s=128&g=1", "display_name": "Fernando M", "link": "https://stackoverflow.com/users/2492092/fernando-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 58127028, "answer_count": 2, "score": 0, "last_activity_date": 1569551796, "creation_date": 1569370571, "last_edit_date": 1569411481, "question_id": 58089582, "link": "https://stackoverflow.com/questions/58089582/rails-5-2-3-show-tree-of-categories-ordered-by-the-total-of-their-associated-r", "title": "Rails 5.2.3 - Show tree of Categories ordered by the total of their associated records", "body": "<p>I'm currently using the <a href=\"https://github.com/stefankroes/ancestry\" rel=\"nofollow noreferrer\">Ancestry gem</a> to render 500+ categories and sub-categories (they can go up to 3 levels deep).</p>\n\n<p>Now, what I'm trying to do is:</p>\n\n<ol>\n<li>Show only those categories/sub-categories with associated\ntransactions.</li>\n<li>Order those categories by:\n\n<ul>\n<li>The sum of the <code>:amount</code> of those associated transactions.</li>\n<li>And also order them by hierarchy.</li>\n</ul></li>\n<li>Print the total next to each category name.</li>\n</ol>\n\n<p>Here's an example of what I'm hoping to achieve:</p>\n\n<pre><code>Travel = $1500\nTravel &gt; Air = $1000\nTravel &gt; Ground = $250\nBusiness = $500\nBusiness &gt; Services = $250\nBusiness &gt; Services &gt; Marketing = $75\n# etc...\n</code></pre>\n\n<p>This is what my models look like:</p>\n\n<pre><code>class Category &lt; ApplicationRecord\n  has_many :transactions\n  has_ancestry\nend\n\nclass Transaction &lt; ApplicationRecord\n  belongs_to :account\n  belongs_to :category\nend\n</code></pre>\n\n<p>So far I was able to <em>ALMOST</em> get there by doing:</p>\n\n<pre><code># app/controllers/categories_controller.rb\ndef index\n  # Get all of the root categories\n  @primary_categories = Category.where(ancestry: nil)\nend\n\n# app/views/categories/index.html.erb\n&lt;% @primary_categories.each do |primary_category| %&gt;\n  &lt;% primary_category_total = Transaction.where(account_id: current_user, category_id: primary_category.subtree).sum(:amount) %&gt;\n\n  &lt;% if primary_category_total != 0.0 %&gt; \n    &lt;%= link_to primary_category.name, category_path(primary_category) %&gt;\n    &lt;%= number_to_currency primary_category_total %&gt;\n\n    &lt;% if primary_category.has_children? &amp;&amp; primary_category_total != 0.0 %&gt; \n      &lt;% primary_category.children.each do |secondary_category| %&gt;\n        &lt;% secondary_category_total = Transaction.where(account_id: current_user, category_id: primary_category.subtree).sum(:amount) %&gt;\n\n        &lt;% if secondary_category_total != 0.0 %&gt; \n          &lt;%= link_to secondary_category.name, category_path(secondary_category) %&gt;\n          &lt;%= number_to_currency secondary_category_total %&gt;\n\n          &lt;% if secondary_category.has_children? &amp;&amp; secondary_category_total != 0.0 %&gt;\n            &lt;% secondary_category.children.each do |tertiary_category| %&gt;\n            &lt;% tertiary_category_total = Transaction.where(account_id: current_user, category_id: primary_category.subtree).sum(:amount) %&gt;\n\n            &lt;% if tertiary_category_total != 0.0 %&gt; \n              &lt;%= link_to tertiary_category.name, category_path(tertiary_category) %&gt;\n              &lt;%= number_to_currency tertiary_category.transactions.sum(:amount) %&gt;\n# etc...\n</code></pre>\n\n<p>But this generates an insane amount of queries which it's painfully slow, not to mention that I now have a bunch of complex code on my view. And of course, they are not sorted by total.</p>\n\n<p>How else should I approach this?</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 5819, "user_id": 4385889, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/V0hjo.png?s=128&g=1", "display_name": "Andrew", "link": "https://stackoverflow.com/users/4385889/andrew"}, "edited": false, "score": 0, "creation_date": 1569375201, "post_id": 58089397, "comment_id": 102573049, "body": "Note from the answers that they all use find_by instead of find, even though you&#39;re just checking for id. It&#39;s because find_by returns nil if no entry is found. find throws"}], "answers": [{"tags": [], "owner": {"reputation": 862, "user_id": 1600046, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/5rxUl.jpg?s=128&g=1", "display_name": "Vibol", "link": "https://stackoverflow.com/users/1600046/vibol"}, "is_accepted": false, "score": -1, "last_activity_date": 1569370293, "creation_date": 1569370293, "answer_id": 58089557, "question_id": 58089397, "link": "https://stackoverflow.com/questions/58089397/how-should-i-write-code-if-a-paramsid-doesnt-exist-in-the-db/58089557#58089557", "title": "How should I write code if a params[:id] doesn&#39;t exist in the db", "body": "<p>Your code should be written like this:</p>\n\n<pre><code> def show\n    begin\n      @article = Article.find(params[:id])\n    rescue\n      redirect_to root_path\n    end\n end\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "is_accepted": true, "score": 2, "last_activity_date": 1569370714, "last_edit_date": 1569370714, "creation_date": 1569370321, "answer_id": 58089561, "question_id": 58089397, "link": "https://stackoverflow.com/questions/58089397/how-should-i-write-code-if-a-paramsid-doesnt-exist-in-the-db/58089561#58089561", "title": "How should I write code if a params[:id] doesn&#39;t exist in the db", "body": "<blockquote>\n  <p>How should I write code for this error?</p>\n</blockquote>\n\n<p>The short answer is \"you shouldn't\".</p>\n\n<p>Exceptions should, IMO, be exceptional. It sounds like you might expect this circumstance, so I suggest you write code that handles the scenario without raising an exception.</p>\n\n<p>If you really think you'll have circumstances where the <code>Article</code> record does not exist for the given <code>params[:id]</code> (seems a little odd, but I guess it's possible), then I would suggest that you use <code>.find_by</code> instead of <code>.find</code>:</p>\n\n<pre><code>class ArticlesController &lt; ApplicationController\n\n  #...\n\n  def show\n    if @article = Article.find_by(id: params[:id])\n      # do something with the article \n    else\n      render root\n    end\n  end\n\n  #...\n\nend\n</code></pre>\n\n<p>It seems like to you might want to do a <code>redirect</code> instead of a <code>render</code>:</p>\n\n<pre><code>class ArticlesController &lt; ApplicationController\n\n  #...\n\n  def show\n    if @article = Article.find_by(id: params[:id])\n      # do something with the article \n    else\n      redirect_to root_path\n    end\n  end\n\n  #...\n\nend\n</code></pre>\n\n<p>But, maybe not...</p>\n\n<p>Also, rescuing everything like this: </p>\n\n<pre><code>def show\n  begin\n    @article = Article.find(params[:id])\n  rescue\n    render root\n  end\nend\n</code></pre>\n\n<p>...is generally viewed as code smell. There are a <a href=\"https://www.google.com/search?q=ruby+don%27t+rescue\" rel=\"nofollow noreferrer\">lot of articles</a> on the interwebs about why.</p>\n"}, {"tags": [], "owner": {"reputation": 311, "user_id": 7105526, "user_type": "registered", "profile_image": "https://graph.facebook.com/1812496678973073/picture?type=large", "display_name": "B&#249;i Nh\u1eadt Duy", "link": "https://stackoverflow.com/users/7105526/b%c3%b9i-nh%e1%ba%adt-duy"}, "is_accepted": false, "score": 0, "last_activity_date": 1569374503, "creation_date": 1569374503, "answer_id": 58089944, "question_id": 58089397, "link": "https://stackoverflow.com/questions/58089397/how-should-i-write-code-if-a-paramsid-doesnt-exist-in-the-db/58089944#58089944", "title": "How should I write code if a params[:id] doesn&#39;t exist in the db", "body": "<p>You can handle the exception from <code>ArticlesController</code> but I advise put the code at \n<code>ApplicationController</code> like this:</p>\n\n<pre><code>rescue_from ActiveRecord::RecordNotFound do\n   redirect_back fallback_location: root_path, alert: t(\"resource_not_found\")\nend\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 10100425, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bhsyQ.jpg?s=128&g=1", "display_name": "tsubasa", "link": "https://stackoverflow.com/users/10100425/tsubasa"}, "edited": false, "score": 0, "creation_date": 1569376051, "post_id": 58089972, "comment_id": 102573192, "body": "Even after asking this question, I was looking for an answer on the internet. For now, it works as expected with <code>Article.exists?(params[:id])</code>. However, your answer is exactly what I wanted. Thank you very much!"}], "tags": [], "owner": {"reputation": 441, "user_id": 4311450, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zIfYt.gif?s=128&g=1", "display_name": "Evan", "link": "https://stackoverflow.com/users/4311450/evan"}, "is_accepted": false, "score": 0, "last_activity_date": 1569374685, "creation_date": 1569374685, "answer_id": 58089972, "question_id": 58089397, "link": "https://stackoverflow.com/questions/58089397/how-should-i-write-code-if-a-paramsid-doesnt-exist-in-the-db/58089972#58089972", "title": "How should I write code if a params[:id] doesn&#39;t exist in the db", "body": "<p>Maybe You can code like this:</p>\n\n<pre><code> def show\n    @article = Article.find_by(id: params[:id])\n    unless @article.present?\n      flash[:error] = \"Not Found.\"\n      redirect_to root_path\n    end\n  end\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 303, "user_id": 9479253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cd34f4996365a59ad414df6950d6d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ashok Damaniya", "link": "https://stackoverflow.com/users/9479253/ashok-damaniya"}, "is_accepted": false, "score": 0, "last_activity_date": 1569419339, "creation_date": 1569419339, "answer_id": 58099954, "question_id": 58089397, "link": "https://stackoverflow.com/questions/58089397/how-should-i-write-code-if-a-paramsid-doesnt-exist-in-the-db/58099954#58099954", "title": "How should I write code if a params[:id] doesn&#39;t exist in the db", "body": "<p>why write so much code, while you can achieve with two lines only.</p>\n\n<pre><code>class ArticlesController &lt; ApplicationController\n  def show\n    @article = Article.find_by(id: params[:id])\n    redirect_to root_path unless @article.present?\n  end \nend \n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10100425, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bhsyQ.jpg?s=128&g=1", "display_name": "tsubasa", "link": "https://stackoverflow.com/users/10100425/tsubasa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 58089561, "answer_count": 5, "score": 0, "last_activity_date": 1569419339, "creation_date": 1569368781, "question_id": 58089397, "link": "https://stackoverflow.com/questions/58089397/how-should-i-write-code-if-a-paramsid-doesnt-exist-in-the-db", "title": "How should I write code if a params[:id] doesn&#39;t exist in the db", "body": "<p>I'm writing a show action in a controller and want to branch if no id received from <code>params[:id]</code> exists in my database.</p>\n\n<p>My app is still being created. I've tried conditional branching and exception handling. However, they didn't work as expected.</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>class ArticlesController &lt; ApplicationController\n\n  #...\n\n  def show\n    begin\n      @article = Article.find(params[:id])\n    rescue\n      render root\n    end\n  end\n\n  #...\n\nend\n</code></pre>\n\n<p>I expect to be redirect to the root if any error occurs.</p>\n\n<p>The above code returns the record if it is found successfully. However, an <code>ActiveRecord::RecordNotFound in ArticlesController#show</code> occurs if no record is found.</p>\n\n<p>How should I write code for this error?</p>\n"}, {"tags": ["ruby", "reduce"], "comments": [{"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 0, "creation_date": 1569396887, "post_id": 58088930, "comment_id": 102579103, "body": "First of all, if you hardcode <code>+</code>, it&#39;s not &quot;generalized&quot;. Secondly, I doubt that the task &quot;write a generalized method for reduce&quot; will judge well a solution that merely wraps the native Ruby <code>reduce</code>. Thirdly, if you are giving out errors, it would be nice to know what inputs cause them (for example, I have no idea why &quot;my own reduce returns a running total when given a starting point&quot; is an error, I&#39;d guess that&#39;s the desired behaviour)."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1569439602, "post_id": 58088930, "comment_id": 102601518, "body": "I believe you are begin asked to create an instance method <code>Enumerable#my_own_reduce</code> that behaves the same as <code>Enumerable#reduce</code>. Since <code>reduce</code> optionally takes an argument it must look like <code>module Enumerable; def my_own_reduce(obj = nil); &lt;your code, which involves yielding to a block&gt;; end</code>. This is a non-trivial task for a newbie."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1569440670, "post_id": 58088930, "comment_id": 102601869, "body": "Presumably your method is being tested against unseen expressions. The second, &quot;return <code>true</code> when all values are truthy&quot;, might be, for example, <code>[1,2,nil,&#39;cat&#39;].my_own_reduce(true) { |t_or_f,e| t_or_f &amp; e  }</code> with the required return value of <code>false</code>. See <a href=\"https://ruby-doc.org/core-2.6.3/TrueClass.html#method-i-26\" rel=\"nofollow noreferrer\">TrueClass#&amp;</a> and <a href=\"https://ruby-doc.org/core-2.6.4/FalseClass.html#method-i-26\" rel=\"nofollow noreferrer\">FalseClass#&amp;</a>..."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1569440678, "post_id": 58088930, "comment_id": 102601876, "body": "... The fourth test might be: <code>[nil,&#39;cat&#39;,false].my_own_reduce(false) { |t_or_f,e| t_or_f | e  }</code> with the required return value of <code>true</code>. See <a href=\"https://ruby-doc.org/core-2.6.3/TrueClass.html#method-i-7C\" rel=\"nofollow noreferrer\">TrueClass#|</a> and <a href=\"https://ruby-doc.org/core-2.6.4/FalseClass.html#method-i-7C\" rel=\"nofollow noreferrer\">FalseClass#|</a>."}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 7585534, "user_type": "registered", "profile_image": "https://graph.facebook.com/10158342879855249/picture?type=large", "display_name": "Michael Jacobson", "link": "https://stackoverflow.com/users/7585534/michael-jacobson"}, "is_accepted": false, "score": 1, "last_activity_date": 1569420870, "last_edit_date": 1569420870, "creation_date": 1569420211, "answer_id": 58100242, "question_id": 58088930, "link": "https://stackoverflow.com/questions/58088930/how-do-i-test-for-truthy-and-falsy-in-this-generalized-ruby-method-for-reduce/58100242#58100242", "title": "How do I test for Truthy and Falsy in this generalized ruby method for reduce?", "body": "<p>All values in Ruby are truthy except for <code>nil</code> and <code>false</code>. </p>\n\n<p>If you want to convert a non-boolean object into a boolean, based on its truthiness, you can use a 'double bang' operator, as in the following example:</p>\n\n<pre><code>some_value = 42\nsome_other_value = 0\nyet_another_value = nil\n\nputs !!some_value # =&gt; true\nputs !!some_other_value # =&gt; true\nputs !!yet_another_value # =&gt; false\n</code></pre>\n\n<p>To use the truthiness of an object in conditions you can simply use them as you would booleans. Like so:</p>\n\n<pre><code>def my_method(my_argument)\n  if my_argument\n    'Received a truthy argument'\n  else\n    'Received a falsy argument'\n  end\nend\n\nputs my_method(0) # =&gt; 'Received a truthy argument'\nputs my_method(nil) # =&gt; 'Received a falsy argument'\nputs my_method(false) # =&gt; 'Received a falsy argument'\n</code></pre>\n\n<p>I hope this helps, but without a little more information about the context of your question I'm not sure I can tell you much more. The error messages you posted are more than a little unclear and even contradictory. </p>\n\n<p>Does the condition \"when given a starting point\" mean a starting point other than the default value of 0?</p>\n\n<p>The conditions \"any value is false\" and \"a truthy value is present\" could easily both be met, the given array could quite simply contain one of each. In this case, which condition should take precedence?</p>\n"}], "owner": {"reputation": 1, "user_id": 6003795, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e5d54f4629510da2dccd85e739cabb4?s=128&d=identicon&r=PG&f=1", "display_name": "Donny", "link": "https://stackoverflow.com/users/6003795/donny"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1569420870, "creation_date": 1569364412, "question_id": 58088930, "link": "https://stackoverflow.com/questions/58088930/how-do-i-test-for-truthy-and-falsy-in-this-generalized-ruby-method-for-reduce", "title": "How do I test for Truthy and Falsy in this generalized ruby method for reduce?", "body": "<p>This is for a ruby course.  We're being asked to write a generalized\nmethod for reduce.</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>def my_own_reduce(array, starting_point = 0)\n   final_total =  array.reduce(starting_point) { |sum, num| sum + num}\nend\n</code></pre>\n\n<p>Here are the error messages I'm getting:</p>\n\n<pre><code> # my own reduce returns a running total when given a starting point\n # my own reduce returns true when all values are truthy\n# my own reduce returns false when any value is false\n # my own reduce returns true when a truthy value is present\n # my own reduce returns false when no truthy value is present\n</code></pre>\n"}, {"tags": ["ruby", "rack"], "comments": [{"owner": {"reputation": 16402, "user_id": 4025095, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/blJ4L.jpg?s=128&g=1", "display_name": "Myst", "link": "https://stackoverflow.com/users/4025095/myst"}, "edited": false, "score": 0, "creation_date": 1570649080, "post_id": 58088628, "comment_id": 102983304, "body": "If you&#39;re trying to implement SSE, <b>don&#39;t hijack the socket</b>. Use an SSE enabled Ruby application Server (such as agoo or iodine). If you hijack the socket, you might find your app failing once HTTP/2 is implemented and you won&#39;t even know where to find the bug (they get difficult to track down at that point)."}], "answers": [{"tags": [], "owner": {"reputation": 1029, "user_id": 84802, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ec13dc4614eaf98b54b72a425bbd4fb7?s=128&d=identicon&r=PG", "display_name": "Andrey Khataev", "link": "https://stackoverflow.com/users/84802/andrey-khataev"}, "is_accepted": false, "score": 0, "last_activity_date": 1570526922, "creation_date": 1570526922, "answer_id": 58283631, "question_id": 58088628, "link": "https://stackoverflow.com/questions/58088628/sample-server-client-for-rack-hijack-proxy-questions/58283631#58283631", "title": "Sample server &amp; client for Rack hijack proxy questions", "body": "<p>Have figured it out. Headers do matter. This version makes it work for all clients</p>\n\n<pre><code>io_lambda = lambda{ |io|\n      5.times do |i|\n        puts i\n        io.write \"David\\r\\n\"\n        sleep 1\n      end\n      io.close\n    }\n\napp = lambda do |env|\n\n  response_headers = {}\n  response_headers['Transfer-Encoding'] = 'binary'\n  response_headers[\"Content-Type\"] = \"text/plain\"\n  response_headers[\"rack.hijack\"] = io_lambda\n  [200, response_headers, nil]\n\nend\n\nrun app\n</code></pre>\n"}], "owner": {"reputation": 1029, "user_id": 84802, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ec13dc4614eaf98b54b72a425bbd4fb7?s=128&d=identicon&r=PG", "display_name": "Andrey Khataev", "link": "https://stackoverflow.com/users/84802/andrey-khataev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 73, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1570695759, "creation_date": 1569362141, "last_edit_date": 1570695759, "question_id": 58088628, "link": "https://stackoverflow.com/questions/58088628/sample-server-client-for-rack-hijack-proxy-questions", "title": "Sample server &amp; client for Rack hijack proxy questions", "body": "<p>I've got <a href=\"https://github.com/rack/rack/blob/cabe6b33ca4601aa6acb56317ac1c819cf6dc4bb/test/spec_webrick.rb#L162-L183\" rel=\"nofollow noreferrer\">sample app</a> for hijack proxy server</p>\n\n<pre><code>io_lambda = lambda{ |io|\n      3.times do |i|\n        puts i\n        io.write \"David\\r\\n\"\n      end\n      io.close\n    }\n\nrun lambda{ |req|\n      [\n        200,\n        [ [ \"rack.hijack\", io_lambda ] ],\n        [\"\"]\n      ]\n    }\n</code></pre>\n\n<p>and starting it</p>\n\n<pre><code>rackup config.ru -p 3000\n</code></pre>\n\n<p>Now I trying to code client for it. First, just curl it:</p>\n\n<pre><code>curl http://localhost:3000 -vv\n</code></pre>\n\n<p>and get following client output:</p>\n\n<pre><code>* Rebuilt URL to: http://localhost:3000/\n*   Trying ::1...\n* TCP_NODELAY set\n* Connected to localhost (::1) port 3000 (#0)\n&gt; GET / HTTP/1.1\n&gt; Host: localhost:3000\n&gt; User-Agent: curl/7.54.0\n&gt; Accept: */*\n&gt;\n&lt; HTTP/1.1 200 OK\n&lt; Transfer-Encoding: chunked\n&lt;\nDavid\nDavid\n* transfer closed with outstanding read data remaining\n* stopped the pause stream!\n* Closing connection 0\ncurl: (18) transfer closed with outstanding read data remaining\n</code></pre>\n\n<p>now, with httparty:</p>\n\n<pre><code>require 'rubygems'\nrequire 'bundler/setup'\nBundler.require(:default)\n\nresponse = HTTParty.get('http://localhost:3000')\nputs response.body, response.code, response.message, response.headers.inspect\n</code></pre>\n\n<p>I get:</p>\n\n<pre><code>\u2192 ruby httparty-client.rb\nTraceback (most recent call last):\n    19: from httparty-client.rb:5:in `&lt;main&gt;'\n    18: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/gems/2.6.0/gems/httparty-0.17.1/lib/httparty.rb:627:in `get'\n    17: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/gems/2.6.0/gems/httparty-0.17.1/lib/httparty.rb:508:in `get'\n    16: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/gems/2.6.0/gems/httparty-0.17.1/lib/httparty.rb:594:in `perform_request'\n    15: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/gems/2.6.0/gems/httparty-0.17.1/lib/httparty/request.rb:145:in `perform'\n    14: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/http.rb:1470:in `request'\n    13: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/http.rb:920:in `start'\n    12: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/http.rb:1472:in `block in request'\n    11: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/http.rb:1479:in `request'\n    10: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/http.rb:1517:in `transport_request'\n     9: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/http/response.rb:166:in `reading_body'\n     8: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/http/response.rb:229:in `body'\n     7: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/http/response.rb:204:in `read_body'\n     6: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/http/response.rb:283:in `read_body_0'\n     5: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/http/response.rb:278:in `inflater'\n     4: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/http/response.rb:285:in `block in read_body_0'\n     3: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/http/response.rb:324:in `read_chunked'\n     2: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/http/response.rb:324:in `ensure in read_chunked'\n     1: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/protocol.rb:159:in `read'\n/Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/protocol.rb:225:in `rbuf_fill': end of file reached (EOFError)\n</code></pre>\n\n<p>last try with net/http:</p>\n\n<pre><code>require 'net/http'\n\nstreamURL = 'http://localhost:3000'\n\nuri = URI.parse(streamURL)\n\nNet::HTTP.start(uri.host, uri.port) do |http|\n  request = Net::HTTP::Get.new uri.request_uri\n\n  http.request request do |response|\n    response.read_body do |chunk|\n       #We get the data here chunk-by-chunk\n       puts chunk\n    end\n  end\nend\n</code></pre>\n\n<p>I get:</p>\n\n<pre><code>\u2192 ruby net-http-client.rb\nDavid\nDavid\nDavid\nDavid\nTraceback (most recent call last):\n    16: from net-http-client.rb:7:in `&lt;main&gt;'\n    15: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/http.rb:605:in `start'\n    14: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/http.rb:920:in `start'\n    13: from net-http-client.rb:10:in `block in &lt;main&gt;'\n    12: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/http.rb:1479:in `request'\n    11: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/http.rb:1517:in `transport_request'\n    10: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/http/response.rb:165:in `reading_body'\n     9: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/http.rb:1518:in `block in transport_request'\n     8: from net-http-client.rb:11:in `block (2 levels) in &lt;main&gt;'\n     7: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/http/response.rb:204:in `read_body'\n     6: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/http/response.rb:283:in `read_body_0'\n     5: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/http/response.rb:278:in `inflater'\n     4: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/http/response.rb:285:in `block in read_body_0'\n     3: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/http/response.rb:324:in `read_chunked'\n     2: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/http/response.rb:324:in `ensure in read_chunked'\n     1: from /Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/protocol.rb:159:in `read'\n/Users/khataev/.rbenv/versions/2.6.1/lib/ruby/2.6.0/net/protocol.rb:225:in `rbuf_fill': end of file reached (EOFError)\n</code></pre>\n\n<p>Could someone explain me:</p>\n\n<p>1) Why curl return David x2,  httparty - nothing and net/http - David x4, while server sent 5? Also I'm curious why httparty and net/http results differ, because one uses another under the hood.</p>\n\n<p>2) Why in all cases we have an error (<code>transfer closed with outstanding read data remaining</code> and <code>end of file reached (EOFError)</code>)?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "postgresql", "activerecord"], "comments": [{"owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 0, "creation_date": 1569386529, "post_id": 58088599, "comment_id": 102575183, "body": "How are the opening and closing hours actually stored in the database? As timestamps for each day? As strings? What about weekends or holidays? Do you take them into account?"}, {"owner": {"reputation": 377, "user_id": 9937135, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IvjeP.jpg?s=128&g=1", "display_name": "NicoBar", "link": "https://stackoverflow.com/users/9937135/nicobar"}, "reply_to_user": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 0, "creation_date": 1569393081, "post_id": 58088599, "comment_id": 102577305, "body": "In the code I added above I convert them as time but they appear like strings in the terminal: {&quot;Monday&quot; =&gt; &quot;12:00&quot;, &quot;Tuesday&quot; =&gt; &quot;13:00&quot;}"}, {"owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 0, "creation_date": 1569393121, "post_id": 58088599, "comment_id": 102577320, "body": "Do you have examples of those records? How are the migrations for Product and Shop defined?"}, {"owner": {"reputation": 377, "user_id": 9937135, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IvjeP.jpg?s=128&g=1", "display_name": "NicoBar", "link": "https://stackoverflow.com/users/9937135/nicobar"}, "edited": false, "score": 0, "creation_date": 1569394226, "post_id": 58088599, "comment_id": 102577819, "body": "Just added more details"}], "answers": [{"comments": [{"owner": {"reputation": 377, "user_id": 9937135, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IvjeP.jpg?s=128&g=1", "display_name": "NicoBar", "link": "https://stackoverflow.com/users/9937135/nicobar"}, "edited": false, "score": 0, "creation_date": 1569670453, "post_id": 58095935, "comment_id": 102676556, "body": "Thank you so much man! From all the solutions only the first one worked for me. The third one made my terminal glitch and the last one returned an empty array. But thanks again, really appreciate it :))"}], "tags": [], "owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "is_accepted": true, "score": 1, "last_activity_date": 1569409606, "last_edit_date": 1569409606, "creation_date": 1569405987, "answer_id": 58095935, "question_id": 58088599, "link": "https://stackoverflow.com/questions/58088599/access-json-field-of-join-table-with-active-record/58095935#58095935", "title": "Access JSON field of join table with Active Record", "body": "<p>You can use the <code>-&gt;&gt;</code> operator to access a specific JSON field as text:</p>\n\n<pre><code>SELECT opening_hours-&gt;&gt;'Monday' AS monday_opening_hour FROM shops;\n</code></pre>\n\n<p>Same for <code>closing_hours</code>, it just changes the name of the column and field.</p>\n\n<p>So the AR representation in your case would be like:</p>\n\n<pre><code>Product\n  .joins(:shop)\n  .where(\n    \"shops.opening_hours-&gt;&gt;:day &lt;= :now AND shops.closing_hours-&gt;&gt;:day &gt;= :now\",\n    day: day_today,\n    now: time_now\n  )\n</code></pre>\n\n<p>You can easily bind the key name and the time you're going to ask for, here as <code>day</code> and <code>now</code>.</p>\n\n<p>Notice, it's not needed to explicitly prepend the table name, but I'm doing so just for the sake of clarity.</p>\n\n<hr>\n\n<p>This can also be done with the BETWEEN operator:</p>\n\n<pre><code>Product\n  .joins(:shop)\n  .where(\n    \":now BETWEEN shops.opening_hours-&gt;&gt;:day AND shops.closing_hours-&gt;&gt;:day\",\n    day: day_today,\n    now: time_now\n  )\n</code></pre>\n\n<p>You can use the one you think is more clear.</p>\n\n<p>In any case, you can get rid of storing the <code>time_now</code> variable, by using the <code>NOW</code> function of PostgreSQL. It'll handle the time format difference if you cast it to text (<code>NOW()::text</code>):</p>\n\n<pre><code>Product\n  .joins(:shop)\n  .where(\n    \"NOW()::text BETWEEN shops.opening_hours-&gt;&gt;:day AND shops.closing_hours-&gt;&gt;:day\",\n    day: day_today\n  )\n</code></pre>\n\n<p>Similarly, the day can also be obtained from <code>NOW</code>. You can use <code>to_char(NOW(), 'Day')</code> for that</p>\n\n<pre><code>SELECT to_char(date, 'Day') AS day\nFROM generate_series (NOW() - '6 days'::interval, NOW(), '1 day') date;\n\n    day\n-----------\n Thursday\n Friday\n Saturday\n Sunday\n Monday\n Tuesday\n Wednesday\n</code></pre>\n\n<p>So:</p>\n\n<pre><code>Product\n  .joins(:shop)\n  .where(\"NOW()::text BETWEEN shops.opening_hours-&gt;&gt;(to_char(NOW(), 'Day'))\n                          AND shops.closing_hours-&gt;&gt;(to_char(NOW(), 'Day'))\")\n</code></pre>\n"}], "owner": {"reputation": 377, "user_id": 9937135, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IvjeP.jpg?s=128&g=1", "display_name": "NicoBar", "link": "https://stackoverflow.com/users/9937135/nicobar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 58095935, "answer_count": 1, "score": 0, "last_activity_date": 1569409659, "creation_date": 1569362001, "last_edit_date": 1569409659, "question_id": 58088599, "link": "https://stackoverflow.com/questions/58088599/access-json-field-of-join-table-with-active-record", "title": "Access JSON field of join table with Active Record", "body": "<p>One shop <code>has_many</code> products and a product <code>belongs_to</code> a shop.\nThe shop has <code>opening_hours</code> and <code>closing_hours</code> columns. Each column stores a hash which looks like the following:</p>\n\n<pre><code>opening_hours = {'Monday' =&gt; '12:00', 'Tuesday' =&gt; '13:00'}\n</code></pre>\n\n<p>and so on</p>\n\n<p>I am working with current date and time, and <strong>I would like to retrieve all products which stores have <code>opening_hours</code> smaller than current time which is smaller than <code>closing_hours</code>.</strong>\nBasically all the products that are available when the shop is open.</p>\n\n<p>I did something like that in my controller:</p>\n\n<pre><code>day_today = Date.today.strftime('%A')\ntime_now = Time.new.strftime('%H:%M')\n@products = Product.joins(shop: [{opening_hours[day_today] &lt; time_now, \n                                 {closing_hours[day_today] &gt; time_now }])\n</code></pre>\n\n<p><strong>Edit</strong></p>\n\n<p>This is the code that stores the opening times in the DB</p>\n\n<pre><code>hours_table = shop.search('table')\n    opening_hours = {}\n    closing_hours = {}\n    hours_table.first.search('tr').each do |tr|\n      cells = tr.search('td')\n      day = cells.first.text.strip\n      hours = cells.last.text.strip.tr('-', '').split\n      opening_hours[day] = hours[0].to_time.strftime('%H:%M')\n      closing_hours[day] = hours[1].to_time.strftime('%H:%M')\n    end\n\nshop = Shop.new(\n        name: shop_name,\n        opening_hours: opening_hours,\n        closing_hours: closing_hours\n      )\n      shop.save\n\n      new_product = Product.new(\n        name: foo,\n        description: foo,\n        price: foo,\n        company: 'foo',\n      )\n      new_product.shop = shop\n      new_product.save\n</code></pre>\n\n<p>This is the migration to add opening hours to Shop. The same is done for closing hours.</p>\n\n<pre><code>class AddOpeningHoursToShop &lt; ActiveRecord::Migration[5.1]\n  def change\n    add_column :shops, :opening_hours, :json, default: {}\n  end\nend\n</code></pre>\n\n<p>This is the migration to add the shop ID to products</p>\n\n<pre><code>class AddShopToProducts &lt; ActiveRecord::Migration[5.1]\n  def change\n    add_reference :products, :shop, foreign_key: true\n  end\nend\n</code></pre>\n\n<p>Any guess?</p>\n"}, {"tags": ["ruby", "rspec", "rspec-rails", "ruby-on-rails-5.2"], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2012677, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/8d7cb2fe712fb17f44f8c354bf37e7b5?s=128&d=identicon&r=PG&f=1", "display_name": "user2012677", "link": "https://stackoverflow.com/users/2012677/user2012677"}, "edited": false, "score": 0, "creation_date": 1569365286, "post_id": 58089013, "comment_id": 102571307, "body": "Search.call calls the CarQuery.new().with_user_id, please see code"}, {"owner": {"reputation": 24560, "user_id": 4880924, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d40e83be235d4f70428da0d42e12d427?s=128&d=identicon&r=PG&f=1", "display_name": "BKSpurgeon", "link": "https://stackoverflow.com/users/4880924/bkspurgeon"}, "reply_to_user": {"reputation": 4416, "user_id": 2012677, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/8d7cb2fe712fb17f44f8c354bf37e7b5?s=128&d=identicon&r=PG&f=1", "display_name": "user2012677", "link": "https://stackoverflow.com/users/2012677/user2012677"}, "edited": false, "score": 0, "creation_date": 1569365725, "post_id": 58089013, "comment_id": 102571421, "body": "@user2012677 yes, Search.call calls CarQuery, but your test will never pass:  you need to set up the spy correctly, and the expectations correctly."}, {"owner": {"reputation": 4416, "user_id": 2012677, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/8d7cb2fe712fb17f44f8c354bf37e7b5?s=128&d=identicon&r=PG&f=1", "display_name": "user2012677", "link": "https://stackoverflow.com/users/2012677/user2012677"}, "edited": false, "score": 0, "creation_date": 1569366181, "post_id": 58089013, "comment_id": 102571519, "body": "if you know how, please help"}, {"owner": {"reputation": 24560, "user_id": 4880924, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d40e83be235d4f70428da0d42e12d427?s=128&d=identicon&r=PG&f=1", "display_name": "BKSpurgeon", "link": "https://stackoverflow.com/users/4880924/bkspurgeon"}, "reply_to_user": {"reputation": 4416, "user_id": 2012677, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/8d7cb2fe712fb17f44f8c354bf37e7b5?s=128&d=identicon&r=PG&f=1", "display_name": "user2012677", "link": "https://stackoverflow.com/users/2012677/user2012677"}, "edited": false, "score": 0, "creation_date": 1569367240, "post_id": 58089013, "comment_id": 102571750, "body": "@user2012677 the problem is that you&#39;re not understanding how tests and spies should be set up - please ready the link i posted above. I would restructure the class in order to do it. You cannot test it directly because you have not publicly exposed it."}, {"owner": {"reputation": 4416, "user_id": 2012677, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/8d7cb2fe712fb17f44f8c354bf37e7b5?s=128&d=identicon&r=PG&f=1", "display_name": "user2012677", "link": "https://stackoverflow.com/users/2012677/user2012677"}, "edited": false, "score": 0, "creation_date": 1569371509, "post_id": 58089013, "comment_id": 102572473, "body": "I read the page you posted before I posted and read it again. I still do not know the solution, hence why I posted. I am not testing it directly.. <code>.call</code> is calling base_filters, which calls the method."}], "tags": [], "owner": {"reputation": 24560, "user_id": 4880924, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d40e83be235d4f70428da0d42e12d427?s=128&d=identicon&r=PG&f=1", "display_name": "BKSpurgeon", "link": "https://stackoverflow.com/users/4880924/bkspurgeon"}, "is_accepted": false, "score": 0, "last_activity_date": 1569365167, "creation_date": 1569365167, "answer_id": 58089013, "question_id": 58088396, "link": "https://stackoverflow.com/questions/58088396/rspec-failure-error-expectqbase-to-have-receivedwith-user-id-with1/58089013#58089013", "title": "Rspec: Failure/Error: expect(qbase).to have_received(:with_user_id).with(1)", "body": "<h2>Must call method on spy for it to work</h2>\n\n<p>If you are using a spy, then you need to call the method on it and then test whether the method has been received. See the rspec documentation on spies <a href=\"https://relishapp.com/rspec/rspec-mocks/docs/basics/spies\" rel=\"nofollow noreferrer\">here</a>. Or alternatively you can use a double. They are both similar, but you can't expect a double to work exactly like a spy.</p>\n\n<pre><code>RSpec.describe Search, type: :model do\n  describe \"#base_filters\" do\n    it \"should call with_limit method on query_object when user_id is passed in\" do\n      current_user = create(:user)\n      qbase =spy('CarQuery')\n      qbase.with_user_id(1) # &lt;-------- you need to add this line here first\n      ## but does qbase even have a method called 'with_user_id'? if not,\n      ## it will still fail\n      expect(qbase).to have_received(:with_user_id).with(1) \n      # If you don't add the line above, of course it will fail, \n      ## you haven't sent qbase any messages! It won't work otherwise.\n      ## I'm not sure what the line below is doing in relation to your tests?\n      Search.call(current_user, {user_id: 1})\n    end\n  end\nend\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 24560, "user_id": 4880924, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d40e83be235d4f70428da0d42e12d427?s=128&d=identicon&r=PG&f=1", "display_name": "BKSpurgeon", "link": "https://stackoverflow.com/users/4880924/bkspurgeon"}, "edited": false, "score": 0, "creation_date": 1569384581, "post_id": 58090210, "comment_id": 102574755, "body": "fantastic! This is exactly right - you have have to publicly expose it in order to test it the way you want to."}], "tags": [], "owner": {"reputation": 4416, "user_id": 2012677, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/8d7cb2fe712fb17f44f8c354bf37e7b5?s=128&d=identicon&r=PG&f=1", "display_name": "user2012677", "link": "https://stackoverflow.com/users/2012677/user2012677"}, "is_accepted": true, "score": 0, "last_activity_date": 1569376900, "creation_date": 1569376900, "answer_id": 58090210, "question_id": 58088396, "link": "https://stackoverflow.com/questions/58088396/rspec-failure-error-expectqbase-to-have-receivedwith-user-id-with1/58090210#58090210", "title": "Rspec: Failure/Error: expect(qbase).to have_received(:with_user_id).with(1)", "body": "<h2>Solved with Dependency Injection</h2>\n\n<p>If there is a better solution, please post it.</p>\n\n<h3>Search Query</h3>\n\n<pre><code>class Search\n  def self.call(current_user, params, query_object_override = nil)\n    new(current_user, params, query_object_override).call\n  end\n\n  def initialize(current_user, params, query_object_override = nil)\n    @params = params\n    @current_user = current_user\n    @query_object = query_object_override\n  end\n\n  def call\n    base_filters(query_object).relation\n  end\n\n  private\n\n  def query_object\n    @query_object ||= CarQuery.new(@current_user)\n  end\n\n  def base_filters(query_object)\n    query_object.with_user_id(@params[:user_id]) if @params[:user_id].present?\n    query_object\n  end\nend\n</code></pre>\n\n<h3>Rspec Test</h3>\n\n<pre><code>RSpec.describe Search, type: :model do\n  describe \"#base_filters\" do\n    it \"should call with_user_id method on query_object when user_id is passed in\" do\n\n      current_user = create(:user)\n      query_object = spy('CarQuery')\n      Search.call(current_user, {user_id: 1}, query_object)\n      expect(query_object).to have_received(:with_user_id )\n    end\n  end\nend\n</code></pre>\n"}], "owner": {"reputation": 4416, "user_id": 2012677, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/8d7cb2fe712fb17f44f8c354bf37e7b5?s=128&d=identicon&r=PG&f=1", "display_name": "user2012677", "link": "https://stackoverflow.com/users/2012677/user2012677"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 318, "favorite_count": 0, "accepted_answer_id": 58090210, "answer_count": 2, "score": 0, "last_activity_date": 1569376900, "creation_date": 1569360648, "last_edit_date": 1569361021, "question_id": 58088396, "link": "https://stackoverflow.com/questions/58088396/rspec-failure-error-expectqbase-to-have-receivedwith-user-id-with1", "title": "Rspec: Failure/Error: expect(qbase).to have_received(:with_user_id).with(1)", "body": "<p>How do I detect if the instance of CarQuery has called a method with a specific parameter? (I assume that is my issue, but please tell me if I am wrong). </p>\n\n<p>Is there a better way to test this?</p>\n\n<h3>Error</h3>\n\n<pre><code>Search#base_filters should call with_limit method on query_object when user_id is passed in\n     Failure/Error: expect(qbase).to have_received(:with_user_id).with(1)\n\n       (Double \"CarQuery\").with_user_id(1)\n           expected: 1 time with arguments: (1)\n           received: 0 times\n</code></pre>\n\n<h3>Search Query</h3>\n\n<pre><code>class Search\n  def self.call(current_user, params)\n    new(current_user, params).call\n  end\n\n  def initialize(current_user, params)\n    @params = params\n    @current_user = current_user\n  end\n\n  def call\n    base_filters(CarQuery.new(@current_user)).relation\n  end\n\n  private\n\n  def base_filters(query_object)\n    query_object.with_user_id(@params[:user_id]) if @params[:user_id].present?\n    query_object\n  end\nend\n</code></pre>\n\n<h3>Rspec Test</h3>\n\n<pre><code>RSpec.describe Search, type: :model do\n  describe \"#base_filters\" do\n    it \"should call with_limit method on query_object when user_id is passed in\" do\n\n      current_user = create(:user)\n      qbase =spy('CarQuery')\n      expect(qbase).to have_received(:with_user_id).with(1)\n      Search.call(current_user, {user_id: 1})\n    end\n  end\nend\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "postgresql", "activerecord"], "comments": [{"owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 1, "creation_date": 1569357363, "post_id": 58087683, "comment_id": 102569030, "body": "What DBMS (&quot;database&quot;) are you using?"}, {"owner": {"reputation": 2832, "user_id": 451893, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0dba10774351090583ce306ef0ca805b?s=128&d=identicon&r=PG", "display_name": "Les Nightingill", "link": "https://stackoverflow.com/users/451893/les-nightingill"}, "edited": false, "score": 0, "creation_date": 1569417876, "post_id": 58087683, "comment_id": 102590754, "body": "do you want &#39;Matt&#39; and &#39;Warren&#39; to appear in the output table? If you&#39;re just trying to eliminate duplicate name/school pairs, then Matt and Warren should be there. Or are you trying to do something else?"}, {"owner": {"reputation": 319, "user_id": 9379722, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DjypIfHCfa4/AAAAAAAAAAI/AAAAAAAAAKE/Arq2ERtWdwU/photo.jpg?sz=128", "display_name": "Abdul Rehman", "link": "https://stackoverflow.com/users/9379722/abdul-rehman"}, "edited": false, "score": 0, "creation_date": 1569431312, "post_id": 58087683, "comment_id": 102598073, "body": "do you want any 2 records or you need to apply some sorting?"}, {"owner": {"reputation": 31, "user_id": 12115426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c02a52527917a5fc3a1b6b0706b304e?s=128&d=identicon&r=PG&f=1", "display_name": "nate17", "link": "https://stackoverflow.com/users/12115426/nate17"}, "reply_to_user": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 0, "creation_date": 1569434063, "post_id": 58087683, "comment_id": 102599223, "body": "@SebastianPalma I&#39;m using Postgres"}, {"owner": {"reputation": 31, "user_id": 12115426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c02a52527917a5fc3a1b6b0706b304e?s=128&d=identicon&r=PG&f=1", "display_name": "nate17", "link": "https://stackoverflow.com/users/12115426/nate17"}, "reply_to_user": {"reputation": 2832, "user_id": 451893, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0dba10774351090583ce306ef0ca805b?s=128&d=identicon&r=PG", "display_name": "Les Nightingill", "link": "https://stackoverflow.com/users/451893/les-nightingill"}, "edited": false, "score": 0, "creation_date": 1569434074, "post_id": 58087683, "comment_id": 102599227, "body": "@LesNightingill could be, it really depends on the input, if I input 1 per school, then it should only show only jonathan and stephen. If it&#39;s 3 per school then get jonathan, dylan and matt for sunshine, then stephen, phil and warren for greenville"}, {"owner": {"reputation": 31, "user_id": 12115426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c02a52527917a5fc3a1b6b0706b304e?s=128&d=identicon&r=PG&f=1", "display_name": "nate17", "link": "https://stackoverflow.com/users/12115426/nate17"}, "reply_to_user": {"reputation": 319, "user_id": 9379722, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DjypIfHCfa4/AAAAAAAAAAI/AAAAAAAAAKE/Arq2ERtWdwU/photo.jpg?sz=128", "display_name": "Abdul Rehman", "link": "https://stackoverflow.com/users/9379722/abdul-rehman"}, "edited": false, "score": 0, "creation_date": 1569434089, "post_id": 58087683, "comment_id": 102599235, "body": "@AbdulRehman no need to sort"}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 12115426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c02a52527917a5fc3a1b6b0706b304e?s=128&d=identicon&r=PG&f=1", "display_name": "nate17", "link": "https://stackoverflow.com/users/12115426/nate17"}, "edited": false, "score": 0, "creation_date": 1569434538, "post_id": 58095538, "comment_id": 102599438, "body": "I could use that but where can I put an &quot;N&quot; variable to get N unique records per school.  So if N input is 2 then I should get 2 records per school like the example above"}, {"owner": {"reputation": 16672, "user_id": 22237, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/hkobD.png?s=128&g=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/22237/kris"}, "reply_to_user": {"reputation": 31, "user_id": 12115426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c02a52527917a5fc3a1b6b0706b304e?s=128&d=identicon&r=PG&f=1", "display_name": "nate17", "link": "https://stackoverflow.com/users/12115426/nate17"}, "edited": false, "score": 0, "creation_date": 1569498338, "post_id": 58095538, "comment_id": 102621294, "body": "You have changed the question since I answered."}, {"owner": {"reputation": 31, "user_id": 12115426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c02a52527917a5fc3a1b6b0706b304e?s=128&d=identicon&r=PG&f=1", "display_name": "nate17", "link": "https://stackoverflow.com/users/12115426/nate17"}, "edited": false, "score": 0, "creation_date": 1569545846, "post_id": 58095538, "comment_id": 102640765, "body": "Yes, I did, uniq still apply, but the output remains the same. I also added another result set just to be more clear."}], "tags": [], "owner": {"reputation": 16672, "user_id": 22237, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/hkobD.png?s=128&g=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/22237/kris"}, "is_accepted": false, "score": 0, "last_activity_date": 1569404517, "creation_date": 1569404517, "answer_id": 58095538, "question_id": 58087683, "link": "https://stackoverflow.com/questions/58087683/how-to-get-2-or-more-records-per-unique-column-value-in-activerecord/58095538#58095538", "title": "How to get 2 or more records per unique column value in ActiveRecord?", "body": "<p>You could <code>uniq</code> when you have transformed the collections of models in to a list of attributes which can be compared for equality:</p>\n\n<pre><code>MyModel.all.pluck(:first_name, :last_name).uniq\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "is_accepted": true, "score": 4, "last_activity_date": 1569436165, "creation_date": 1569436165, "answer_id": 58104553, "question_id": 58087683, "link": "https://stackoverflow.com/questions/58087683/how-to-get-2-or-more-records-per-unique-column-value-in-activerecord/58104553#58104553", "title": "How to get 2 or more records per unique column value in ActiveRecord?", "body": "<p>You can partition the data of the table by the column value you need. After that you can use a condition to tell how many records per partition you want:</p>\n\n<pre><code>Student\n  .from(\n    Student.select('*, row_number() OVER (PARTITION BY school) AS rownum')\n  )\n  .select('*')\n  .where('rownum &lt; 2')\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 40236, "user_id": 923315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/j6lLI.jpg?s=128&g=1", "display_name": "peter", "link": "https://stackoverflow.com/users/923315/peter"}, "is_accepted": false, "score": 1, "last_activity_date": 1569447009, "creation_date": 1569447009, "answer_id": 58106775, "question_id": 58087683, "link": "https://stackoverflow.com/questions/58087683/how-to-get-2-or-more-records-per-unique-column-value-in-activerecord/58106775#58106775", "title": "How to get 2 or more records per unique column value in ActiveRecord?", "body": "<p>Here a way without using sql.</p>\n\n<pre><code>Student.group(:school)\n   .each{|student| Student.where(school: student.school)\n   .first(2)\n   .each{|result| puts \"#{result.name.ljust(20, ' ')}| #{result.school}\"}}\n\n# Phil                | Greenville School\n# Warren              | Greenville School\n# Jonathan            | Sunshine College\n# Dylan               | Sunshine College\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 12115426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c02a52527917a5fc3a1b6b0706b304e?s=128&d=identicon&r=PG&f=1", "display_name": "nate17", "link": "https://stackoverflow.com/users/12115426/nate17"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 58104553, "answer_count": 3, "score": 2, "last_activity_date": 1569447009, "creation_date": 1569356931, "last_edit_date": 1569436651, "question_id": 58087683, "link": "https://stackoverflow.com/questions/58087683/how-to-get-2-or-more-records-per-unique-column-value-in-activerecord", "title": "How to get 2 or more records per unique column value in ActiveRecord?", "body": "<p>How to get 2 or more records per unique column value in ActiveRecord?</p>\n\n<p>Given:</p>\n\n<pre><code>Name     | School\nJonathan | Sunshine College\u2028\nDylan    | Sunshine College\nMatt     | Sunshine College\nJoseph   | Sunshine College\nStephen  | Greenville School\nPhil     | Greenville School\nWarren   | Greenville School\u2028\u2028\nJohnPaul | Greenville School\n</code></pre>\n\n<p>then if I wanted to output <strong><em>2 records</em></strong> per school, it will look like this:</p>\n\n<pre><code>Name     | School\nJonathan | Sunshine College\u2028\nDylan    | Sunshine College\nStephen  | Greenville School\nPhil     | Greenville School\n</code></pre>\n\n<p>If I wanted <strong><em>3 records</em></strong> per school then it'll look like this:</p>\n\n<pre><code>Name     | School\nJonathan | Sunshine College\u2028\nDylan    | Sunshine College\nMatt     | Sunshine College\nStephen  | Greenville School\nPhil     | Greenville School\nWarren   | Greenville School\u2028\u2028\n</code></pre>\n"}, {"tags": ["ruby", "string"], "comments": [{"owner": {"reputation": 550, "user_id": 4612071, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cda66985f822d7bfdee5d90e505379c3?s=128&d=identicon&r=PG&f=1", "display_name": "arcadeblast77", "link": "https://stackoverflow.com/users/4612071/arcadeblast77"}, "edited": false, "score": 2, "creation_date": 1569356891, "post_id": 58087665, "comment_id": 102568849, "body": "Search online for loops in Ruby."}, {"owner": {"reputation": 25573, "user_id": 676874, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/c8e67ec01dc3e7c402255ff26785863f?s=128&d=identicon&r=PG", "display_name": "knut", "link": "https://stackoverflow.com/users/676874/knut"}, "edited": false, "score": 0, "creation_date": 1569357536, "post_id": 58087665, "comment_id": 102569099, "body": "Check <code>each_char</code>, <code>each_byte</code> or maybe <code>split</code>."}], "answers": [{"tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": false, "score": 2, "last_activity_date": 1569397577, "last_edit_date": 1569397577, "creation_date": 1569358946, "answer_id": 58088104, "question_id": 58087665, "link": "https://stackoverflow.com/questions/58087665/string-count-without-using-length-or-size-methods/58088104#58088104", "title": "String count without using &quot;.length&quot; or &quot;.size&quot; methods?", "body": "<p>You can do that using any <code>String</code> method that enumerates characters. The most obvious is <a href=\"https://ruby-doc.org/core-2.6.3/String.html#method-i-each_char\" rel=\"nofollow noreferrer\">String#each_char</a>, as @knut mentioned in a comment.</p>\n\n<pre><code>def str_length(str)\n  enum = str.each_char\n  n = 0\n  loop do\n    enum.next\n    n += 1\n  end\n  n\nend\n</code></pre>\n\n<h1><p></p></h1>\n\n<pre><code>str_length \"Zaphod\"\n  #=&gt; 6\n</code></pre>\n\n<p>Let's see what is happening here.</p>\n\n<pre><code>str = \"Zaphod\"\nenum = str.each_char\n  #=&gt; #&lt;Enumerator: \"123456\":each_char&gt; \nn = 0\n\nloop do\n  s = enum.next\n  n += 1\n  puts \"s = #{s}, n = #{n}\"\nend\nn #=&gt; 6\n</code></pre>\n\n<p>prints</p>\n\n<pre><code>s = Z, n = 1\ns = a, n = 2\ns = p, n = 3\ns = h, n = 4\ns = o, n = 5\ns = d, n = 6\n</code></pre>\n\n<p>See <a href=\"https://ruby-doc.org/core-2.6.3/Enumerator.html#method-i-next\" rel=\"nofollow noreferrer\">Enumerator#next</a>. After <code>enum.next #=&gt; \"d\"</code> is executed <code>enum.next</code> is executed once more, raising a <code>StopIteration</code> exception. That exception is handled by <a href=\"https://ruby-doc.org/core-2.6.3/Kernel.html#method-i-loop\" rel=\"nofollow noreferrer\">Kernel#loop</a> by breaking out of the loop.</p>\n\n<p>As I said at the outset, any <code>String</code> method could be used that enumerates characters. For example, <code>enum = str.gsub(/./)</code>.</p>\n\n<p>The same approach could be used for any class that implements a method that enumerates elements of a collection. For example, we could add a method to the <code>Enumerable</code> module, which would then be available for every class that includes that module. </p>\n\n<pre><code>module Enumerable\n  def my_length\n    enum = each\n    n = 0\n    loop do\n      enum.next\n      n += 1\n    end\n    n\n  end\nend\n</code></pre>\n\n<h1><p></p></h1>\n\n<pre><code>[1,2,3,4].my_length\n  #=&gt; 4 \n{ a: 1, b: 2 }.my_length\n  #=&gt; 2 \n(1..5).my_length \n  #=&gt; 5\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1569398236, "post_id": 58088274, "comment_id": 102579781, "body": "Here&#39;s another you could add to your collection: <code>str = &quot;bulldog&quot;; str =~ &#47;#{str}&#47;; Regexp.last_match.end(0) #=&gt; 7</code>."}, {"owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "reply_to_user": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1569525741, "post_id": 58088274, "comment_id": 102635460, "body": "Nice @CarySwoveland! I&#39;m still trying to understand how is working.. I&#39;m really not a regexp guy :)"}], "tags": [], "owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "is_accepted": true, "score": 4, "last_activity_date": 1569360536, "last_edit_date": 1569360536, "creation_date": 1569359914, "answer_id": 58088274, "question_id": 58087665, "link": "https://stackoverflow.com/questions/58087665/string-count-without-using-length-or-size-methods/58088274#58088274", "title": "String count without using &quot;.length&quot; or &quot;.size&quot; methods?", "body": "<p>Other option, mapping <a href=\"https://ruby-doc.org/core-2.6.4/String.html#method-i-chars\" rel=\"nofollow noreferrer\">String#chars</a> with index then picking the last:</p>\n\n<pre><code>str = \"123456\"\nstr.chars.map.with_index { |_, i| i + 1 }.last\n#=&gt; 6\n</code></pre>\n\n<p>It generates an Array, but we are not looking for efficiency here.\n<hr>\nOr even using <a href=\"https://ruby-doc.org/core-2.6.4/String.html#method-i-index\" rel=\"nofollow noreferrer\">String#index</a> with offset:</p>\n\n<pre><code>str = \"aaaa\"\nstr.index(str[-1], -1) + 1\n#=&gt; 4\n</code></pre>\n\n<p>It looks for the index of the latest char starting from the end.</p>\n"}], "owner": {"reputation": 13, "user_id": 12115297, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3b2a68b22082f56aac3b09e0ea9a657?s=128&d=identicon&r=PG&f=1", "display_name": "Hassan Yamin", "link": "https://stackoverflow.com/users/12115297/hassan-yamin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 58088274, "answer_count": 2, "score": -1, "last_activity_date": 1569397577, "creation_date": 1569356846, "last_edit_date": 1569388423, "question_id": 58087665, "link": "https://stackoverflow.com/questions/58087665/string-count-without-using-length-or-size-methods", "title": "String count without using &quot;.length&quot; or &quot;.size&quot; methods?", "body": "<p>I am new to the ruby and was practicing a code. I want to count the letters in a string by a self written code, without using <code>#length</code> or <code>#size</code> method. I have searched online but am unable to find anything relating to my query. I would appreciate if anyone could help me out in this simple program. </p>\n"}, {"tags": ["ruby", "git", "github", "rubygems", "bundler"], "owner": {"reputation": 2996, "user_id": 7836976, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/67ae396b20200188272f0d121d9e9dfa?s=128&d=identicon&r=PG&f=1", "display_name": "runnerpaul", "link": "https://stackoverflow.com/users/7836976/runnerpaul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 81, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1569417292, "creation_date": 1569356546, "question_id": 58087605, "link": "https://stackoverflow.com/questions/58087605/bundle-command-prompts-for-github-login-which-doesnt-work", "title": "bundle command prompts for github login which doesn&#39;t work", "body": "<p>When I run bundle I get this:</p>\n\n<pre><code>$ bundle\nFollowing files may not be writable, so sudo is needed:\n  /Library/Ruby/Gems/2.3.0\n  /Library/Ruby/Gems/2.3.0/build_info\n  /Library/Ruby/Gems/2.3.0/cache\n  /Library/Ruby/Gems/2.3.0/doc\n  /Library/Ruby/Gems/2.3.0/extensions\n  /Library/Ruby/Gems/2.3.0/gems\n  /Library/Ruby/Gems/2.3.0/specifications\nFetching https://github.com/lsegal/yard.git\nFetching https://github.com/lsegal/yard-js.git\nFetching https://github.com/lsegal/parsejs.git\nUsername for 'https://github.com': me\nPassword for 'https://me@github.com': \nremote: Invalid username or password.\nfatal: Authentication failed for 'https://github.com/lsegal/parsejs.git/'\n\nRetrying `git clone 'https://github.com/lsegal/parsejs.git' \"/Users/me/.bundle/cache/git/parsejs-35f0b5a29373e174672dd4f95a4392093a2ddf51\" --bare --no-hardlinks --quiet` due to error (2/4): Bundler::Source::Git::GitCommandError Git error: command `git clone 'https://github.com/lsegal/parsejs.git' \"/Users/me/.bundle/cache/git/parsejs-35f0b5a29373e174672dd4f95a4392093a2ddf51\" --bare --no-hardlinks --quiet` in directory /Users/paulcarron/git/ibm-cos-sdk-js has failed.\nUsername for 'https://github.com': me\nPassword for 'https://me@github.com': \nremote: Repository not found.\nfatal: repository 'https://github.com/lsegal/parsejs.git/' not found\n\nRetrying `git clone 'https://github.com/lsegal/parsejs.git' \"/Users/me/.bundle/cache/git/parsejs-35f0b5a29373e174672dd4f95a4392093a2ddf51\" --bare --no-hardlinks --quiet` due to error (3/4): Bundler::Source::Git::GitCommandError Git error: command `git clone 'https://github.com/lsegal/parsejs.git' \"/Users/me/.bundle/cache/git/parsejs-35f0b5a29373e174672dd4f95a4392093a2ddf51\" --bare --no-hardlinks --quiet` in directory /Users/paulcarron/git/ibm-cos-sdk-js has failed.\nUsername for 'https://github.com':\n</code></pre>\n\n<p>I logged in to GitHub through the browser with the same username so don't know what's going on. Can anybody help?</p>\n"}, {"tags": ["ruby", "string", "integer", "enumeration"], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 5006313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t8AWW.jpg?s=128&g=1", "display_name": "Rupcio", "link": "https://stackoverflow.com/users/5006313/rupcio"}, "edited": false, "score": 0, "creation_date": 1569354407, "post_id": 58087040, "comment_id": 102568032, "body": "Thank you, I forgot about initializing an empty string. Fixed the post."}, {"owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "reply_to_user": {"reputation": 57, "user_id": 5006313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t8AWW.jpg?s=128&g=1", "display_name": "Rupcio", "link": "https://stackoverflow.com/users/5006313/rupcio"}, "edited": false, "score": 0, "creation_date": 1569354469, "post_id": 58087040, "comment_id": 102568053, "body": "If you initialize the empty string, the difference is mostly in memory footprint and readability. I strongly recommend <code>string * n</code> version"}], "tags": [], "owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "is_accepted": false, "score": 0, "last_activity_date": 1569406024, "last_edit_date": 1569406024, "creation_date": 1569353416, "answer_id": 58087040, "question_id": 58086860, "link": "https://stackoverflow.com/questions/58086860/repeating-string-n-times-multiplication-vs-enumerator/58087040#58087040", "title": "Repeating String N times - multiplication VS enumerator", "body": "<p>The output should differ. The first option creates a new instance of a <code>String</code> that contains <code>string</code> repeated <code>n</code> times. The second option mutates original <code>string</code> in every iteration, so as a result it's repeated much more than <code>n</code> times.</p>\n\n<p>For instance:</p>\n\n<pre><code>string = 'Abc'\nn = 3\nn.times do { string += string }\n</code></pre>\n\n<p>values of <code>string</code> after subsequent iterations will be:</p>\n\n<pre><code>init: Abc\n'AbcAbc'\n'AbcAbcAbcAbc'\n</code></pre>\n\n<p>This may work in the same manner if you use a different string as a buffer:</p>\n\n<pre><code>new_string = \"\"\nn.times { new_string += string }\n</code></pre>\n\n<p>I think that <code>string * n</code> is more memory efficient (only one new allocation).</p>\n"}, {"tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": true, "score": 1, "last_activity_date": 1569357670, "creation_date": 1569357670, "answer_id": 58087832, "question_id": 58086860, "link": "https://stackoverflow.com/questions/58086860/repeating-string-n-times-multiplication-vs-enumerator/58087832#58087832", "title": "Repeating String N times - multiplication VS enumerator", "body": "<p><a href=\"https://ruby-doc.org/core-2.6.3/String.html#method-i-2A\" rel=\"nofollow noreferrer\">String#*</a> is implemented in C, but I expect a Ruby equivalent is the following.</p>\n\n<pre><code>class String\n  def *(n)\n    return \"\" if n.zero?\n    (n-1).times.reduce(dup) { |s,_| s &lt;&lt; self }\n  end\nend\n</code></pre>\n\n<h1><p></p></h1>\n\n<pre><code>str = 'abc'\nstr*(3)\n  #=&gt; \"abcabcabc\"\n</code></pre>\n\n<p>We see that, for <code>n &gt; 0</code>, <code>str</code> is appended to the <code>dup</code> of <code>str</code> <code>n-1</code> times. No temporary arrays are created. This does not mutate <code>str</code> (<code>str #=&gt; \"abc\"</code>). </p>\n\n<p>Now consider:</p>\n\n<pre><code>str = 'abc'\nn = 3\n\nnew_string = \"\"\nn.times do { new_string += str }  \n</code></pre>\n\n<p>Neither does this mutate <code>str</code>, but since <code>new_string += str</code> expands to</p>\n\n<pre><code>new_string = new_string + str\n</code></pre>\n\n<p>we see that the right side of this expression causes <code>n</code> arrays to be created, with the variable <code>new_string</code> assigned to each in turn. As a result, <code>n-1</code> temporary arrays are orphaned and must be garbage-collected. There is no problem doing that but it is a relatively inefficient operation. </p>\n"}], "owner": {"reputation": 57, "user_id": 5006313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t8AWW.jpg?s=128&g=1", "display_name": "Rupcio", "link": "https://stackoverflow.com/users/5006313/rupcio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 58087832, "answer_count": 2, "score": 1, "last_activity_date": 1569406024, "creation_date": 1569352459, "last_edit_date": 1569354279, "question_id": 58086860, "link": "https://stackoverflow.com/questions/58086860/repeating-string-n-times-multiplication-vs-enumerator", "title": "Repeating String N times - multiplication VS enumerator", "body": "<p>What is the difference between using a multiplication (assuming n is an integer):</p>\n\n<pre><code>new_string = string * n\n</code></pre>\n\n<p>and an enumerator:</p>\n\n<pre><code>new_string = \"\"\nn.times do { new_string += string }`\n</code></pre>\n\n<p>The output seems the same, but I'm not sure about which method is <em>proper/correct</em> to do it.</p>\n\n<p>I'd appreciate some input on this.</p>\n"}, {"tags": ["arrays", "ruby", "assign"], "comments": [{"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1569352252, "post_id": 58086612, "comment_id": 102567211, "body": "<code>&lt;&lt;</code> changes the object the variable is referring to whereas <code>=</code> changes the variable itself. If two variables refer to the same object (like in the first example) and you change that object, the change is reflected by both variables."}, {"owner": {"reputation": 10858, "user_id": 788700, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f02925eef8f737905a8702b9cc21ff07?s=128&d=identicon&r=PG", "display_name": "Adobe", "link": "https://stackoverflow.com/users/788700/adobe"}, "edited": false, "score": 0, "creation_date": 1569353392, "post_id": 58086612, "comment_id": 102567669, "body": "you probably wanted to do <code>root_node = node.dup</code> in your second line."}], "answers": [{"comments": [{"owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "reply_to_user": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1569389000, "post_id": 58086865, "comment_id": 102575809, "body": "Thx, fixed that"}], "tags": [], "owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "is_accepted": true, "score": 1, "last_activity_date": 1569388970, "last_edit_date": 1569388970, "creation_date": 1569352487, "answer_id": 58086865, "question_id": 58086612, "link": "https://stackoverflow.com/questions/58086612/what-is-the-difference-between-these-two-memory-assignments/58086865#58086865", "title": "What is the difference between these two memory assignments?", "body": "<p>When you assign an array, the variable holds a value of a reference to this array. When you assign this to another variable, the reference is copied. Then when you call <code>&lt;&lt;</code> mutating the array, it's visible under both variables, because there is only one array.</p>\n\n<p>When you assign an integer, the a value of this integer is stored in the variable. When you reassign it, another value is stored in this variable. There is no difference if you reassign it using a constant <code>a = 1</code> or another variable <code>a = b</code>.</p>\n\n<p>An important thing to note is that assignment works this way also for arrays - the value of the reference is reassigned. If you assign another array, the original one is not changed.</p>\n\n<pre><code>node = [1]\nroot_node = node\nnew_node = [3]\nnode = new_node\np node\n#[3]\np root_node\n#[1]\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://learn.co/lessons/pass-by-reference\" rel=\"nofollow noreferrer\">https://learn.co/lessons/pass-by-reference</a></li>\n<li><a href=\"https://stackoverflow.com/questions/1872110/is-ruby-pass-by-reference-or-by-value\">Is Ruby pass by reference or by value?</a></li>\n<li><a href=\"https://robertheaton.com/2014/07/22/is-ruby-pass-by-reference-or-pass-by-value/\" rel=\"nofollow noreferrer\">https://robertheaton.com/2014/07/22/is-ruby-pass-by-reference-or-pass-by-value/</a></li>\n</ul>\n"}], "owner": {"reputation": 3945, "user_id": 2325598, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/wbO59.jpg?s=128&g=1", "display_name": "Dan Rubio", "link": "https://stackoverflow.com/users/2325598/dan-rubio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 58086865, "answer_count": 1, "score": 1, "last_activity_date": 1569388970, "creation_date": 1569351421, "last_edit_date": 1569352596, "question_id": 58086612, "link": "https://stackoverflow.com/questions/58086612/what-is-the-difference-between-these-two-memory-assignments", "title": "What is the difference between these two memory assignments?", "body": "<p>I tried to solve a kata today that took me through a loop through one portion of the exercise. The problem I experienced can be simplified to the following nuance:</p>\n\n<pre><code>node = [1]\nroot_node = node\n\nnode &lt;&lt; 2\n\np node #[1,2]\np root_node #[1,2]\n\nnode = 1\nroot_node = node\n\nnew_node = 3\nnode = new_node\n\n\np node #3\np root_node #1\n</code></pre>\n\n<p>Why is it that <code>node</code> and <code>root_node</code> both change when I modify the array assigned to one variable but assigning values to a variable doesn't modify the other?</p>\n\n<p>I would have expected <code>node = [1,2]</code> and <code>root_node = [1]</code>.</p>\n\n<p>Could someone shed light onto this or direct me towards documentation regarding this. I don't think I ever noticed that that was the case. Thank you. </p>\n"}, {"tags": ["ruby-on-rails", "ruby", "sass", "devise", "haml"], "answers": [{"tags": [], "owner": {"reputation": 101, "user_id": 6490782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d61ebacc629bc0b0d02a02ee24fa66d?s=128&d=identicon&r=PG&f=1", "display_name": "floworbit", "link": "https://stackoverflow.com/users/6490782/floworbit"}, "is_accepted": false, "score": 0, "last_activity_date": 1569403868, "last_edit_date": 1569403868, "creation_date": 1569402828, "answer_id": 58095037, "question_id": 58086000, "link": "https://stackoverflow.com/questions/58086000/devise-does-not-use-custom-css-when-opened-directly-but-works-when-using-button/58095037#58095037", "title": "Devise does not use custom CSS when opened directly, but works when using button on other page", "body": "<p>Welp, I feel a bit stupid now.</p>\n\n<pre><code>= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' =&gt; true\n</code></pre>\n\n<p>was missing from the registration page. What made it so confusing was that it worked fine using the button on the other page. I don't understand why that happened (some optimization shenanigans I guess) but the problem is resolved now :)</p>\n\n<p>Edit: It was caused by turbolinks</p>\n"}], "owner": {"reputation": 101, "user_id": 6490782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d61ebacc629bc0b0d02a02ee24fa66d?s=128&d=identicon&r=PG&f=1", "display_name": "floworbit", "link": "https://stackoverflow.com/users/6490782/floworbit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 75, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1581307117, "creation_date": 1569348578, "last_edit_date": 1581307117, "question_id": 58086000, "link": "https://stackoverflow.com/questions/58086000/devise-does-not-use-custom-css-when-opened-directly-but-works-when-using-button", "title": "Devise does not use custom CSS when opened directly, but works when using button on other page", "body": "<p>I have a Rails application with ActiveAdmin and an additional devise model named \"Users\" that I generated to keep admin and user login separated.\nOn the main page there are buttons for login and registration that look like this:</p>\n\n<pre><code>    - if !user_signed_in?\n  .nav.navbar-form.navbar-right\n    %a.form-control.btn.btn-register{href: 'register'} Register\n\n  .nav.navbar-form.navbar-right.dropdown\n    %button#loginMenu.btn.btn-login.dropdown-toggle{\"aria-expanded\" =&gt; \"true\", \"aria-haspopup\" =&gt; \"true\", \"data-toggle\" =&gt; \"dropdown\", :type =&gt; \"button\"} Login\n    %div.dropdown-menu.feeds_dropdown{\"aria-labelledby\" =&gt; \"feedMenu\"}\n      = render 'users/shared/new'\n</code></pre>\n\n<p>I generated the views to customize the registration menu and style it using CSS/SASS. Now when I open the registration using the button on my main page it brings me to <a href=\"http://localhost/register\" rel=\"nofollow noreferrer\">http://localhost/register</a> and I can see that all CSS is applied. But as soon as I reload the page or open the url directly in a new tab no styles are applied and I just see a plain and ugly HTML page.</p>\n\n<p>When checking in my browsers inspector I noticed that when I reach the site using the button the request shows up marked as \"xhr\", if I manually load it it shows up as \"document\".</p>\n\n<p>What is going on here and how can I make it always use the CSS?</p>\n"}, {"tags": ["ruby"], "answers": [{"tags": [], "owner": {"reputation": 213, "user_id": 4518165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bde070b1e84f8b0d5d2587b85560e4bf?s=128&d=identicon&r=PG&f=1", "display_name": "castwide", "link": "https://stackoverflow.com/users/4518165/castwide"}, "is_accepted": true, "score": 1, "last_activity_date": 1569350137, "creation_date": 1569350137, "answer_id": 58086336, "question_id": 58085815, "link": "https://stackoverflow.com/questions/58085815/sanitizing-url-strings/58086336#58086336", "title": "Sanitizing URL strings", "body": "<p>The <a href=\"https://github.com/sporkmonger/addressable\" rel=\"nofollow noreferrer\">addressable</a> gem can do this.</p>\n\n<pre><code>require 'addressable'\nAddressable::URI.parse(\"http://example.com/foo/baz/../../hello.html\").normalize.to_s\n#=&gt; \"http://example.com/hello.html\"    \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 10858, "user_id": 788700, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f02925eef8f737905a8702b9cc21ff07?s=128&d=identicon&r=PG", "display_name": "Adobe", "link": "https://stackoverflow.com/users/788700/adobe"}, "is_accepted": false, "score": 0, "last_activity_date": 1569351548, "creation_date": 1569351548, "answer_id": 58086644, "question_id": 58085815, "link": "https://stackoverflow.com/questions/58085815/sanitizing-url-strings/58086644#58086644", "title": "Sanitizing URL strings", "body": "<pre><code>#!/usr/bin/env ruby\n\n# ======\n## defs:\n\ndef process(url)\n  url_components = url.split('/')\n  url_components2 = url_components.dup\n\n  current_index = 0\n\n  url_components.each do |component|\n\n    if component == '..'\n      url_components2.delete_at(current_index)\n      url_components2.delete_at(current_index-1)\n      current_index -= 1\n    elsif\n      component == '.'\n      url_components2.delete_at(current_index)\n    else\n      current_index += 1\n    end\n\n  end\n\n  url_resolved = url_components2.join('/')\n  return url_resolved\nend\n\n\n# =======\n## tests:\n\nurls = [\n  \"http://example.com/foo/baz/../../.\",\n  \"http://example.com/foo/baz/../../hello.html\",\n  \"http://example.com/foo/baz/../.\"\n]\n\nurls.each do |url|\n  print url, ' =&gt; '\n  puts process(url)\nend\n</code></pre>\n"}], "owner": {"reputation": 249, "user_id": 11552811, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed366f03b5fd9bf76a34fca8707a6bad?s=128&d=identicon&r=PG&f=1", "display_name": "erli", "link": "https://stackoverflow.com/users/11552811/erli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 58086336, "answer_count": 2, "score": 0, "last_activity_date": 1569351548, "creation_date": 1569347736, "last_edit_date": 1569348055, "question_id": 58085815, "link": "https://stackoverflow.com/questions/58085815/sanitizing-url-strings", "title": "Sanitizing URL strings", "body": "<p>Say we have a string</p>\n\n<pre><code>url = \"http://example.com/foo/baz/../../.\"\n</code></pre>\n\n<p>Obviously, we know from the Unix shell that <code>../../.</code> essentially means to go up two directories. Hence, this URL is really going to <code>http://example.com/</code>. My question is, given these <code>../</code> characters in a string, how can we sanitize the URL string to point at the actual resource?</p>\n\n<p>For example:</p>\n\n<pre><code>url = \"http://example.com/foo/baz/../../hello.html\"\nurl = process(url)\nurl = \"http://example.com/hello.html\"\n</code></pre>\n\n<p>Another:</p>\n\n<pre><code>url = \"http://example.com/foo/baz/../.\"\nurl = process(url)\nurl = \"http://example.com/foo/\"\n</code></pre>\n\n<p>Keep in mind, the function still as to be able to take in normal URLs (ie. <code>http://example.com</code>) and return them as is if there is nothing to sanitize</p>\n"}, {"tags": ["ruby", "rspec", "rspec-rails"], "answers": [{"comments": [{"owner": {"reputation": 1480, "user_id": 4741620, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/13911648aa5b99a6542494b4c8fcbc38?s=128&d=identicon&r=PG&f=1", "display_name": "jedi", "link": "https://stackoverflow.com/users/4741620/jedi"}, "edited": false, "score": 0, "creation_date": 1569360002, "post_id": 58087901, "comment_id": 102569927, "body": "You are absolutely right, I will refactor this. This is a legacy code that I took over by another company. In fact, the code smells in my opinion and could be refactorred even further. Thanx!"}, {"owner": {"reputation": 1480, "user_id": 4741620, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/13911648aa5b99a6542494b4c8fcbc38?s=128&d=identicon&r=PG&f=1", "display_name": "jedi", "link": "https://stackoverflow.com/users/4741620/jedi"}, "edited": false, "score": 0, "creation_date": 1569360852, "post_id": 58087901, "comment_id": 102570161, "body": "What about the worker? Will it be called in the test? What about the ExternalData service? Will it be called as well?"}, {"owner": {"reputation": 320, "user_id": 9379031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d48b828c6e4a46c2d881c363fc775?s=128&d=identicon&r=PG&f=1", "display_name": "qpzm", "link": "https://stackoverflow.com/users/9379031/qpzm"}, "reply_to_user": {"reputation": 1480, "user_id": 4741620, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/13911648aa5b99a6542494b4c8fcbc38?s=128&d=identicon&r=PG&f=1", "display_name": "jedi", "link": "https://stackoverflow.com/users/4741620/jedi"}, "edited": false, "score": 1, "creation_date": 1569364877, "post_id": 58087901, "comment_id": 102571214, "body": "If you stub the <code>Action::PartsShow#call</code>, its function body is skipped and just return what you specify in <code>and_return(...)</code>."}, {"owner": {"reputation": 620, "user_id": 5571397, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/kaGhE.jpg?s=128&g=1", "display_name": "Salomanuel", "link": "https://stackoverflow.com/users/5571397/salomanuel"}, "edited": false, "score": 0, "creation_date": 1613119351, "post_id": 58087901, "comment_id": 116982862, "body": "what about returning <code>success</code>? for example, there may be something like <code>if Import.perform(import: @import).success?</code>"}], "tags": [], "owner": {"reputation": 320, "user_id": 9379031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d48b828c6e4a46c2d881c363fc775?s=128&d=identicon&r=PG&f=1", "display_name": "qpzm", "link": "https://stackoverflow.com/users/9379031/qpzm"}, "is_accepted": true, "score": 1, "last_activity_date": 1569357978, "creation_date": 1569357978, "answer_id": 58087901, "question_id": 58085529, "link": "https://stackoverflow.com/questions/58085529/how-to-properly-mock-itnernal-services-in-rspec/58087901#58087901", "title": "How to properly mock itnernal services in RSpec?", "body": "<p>With rspec-mocks gem, you can use <code>allow_any_instance_of</code>. Usually, this part lies in <code>before</code> block.</p>\n\n<p>In fact,<code>Action::PartsShow</code> is responsible for loading a part, so there is no need to leak two instance methods: <code>call</code> and <code>part</code>. You can simplify it through returning the part from <code>call</code>.</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>module Action\n  class PartsShowBase\n    #attr_reader :part\n\n    def call\n      find_part # assign @part\n      reload_part_availability\n      reload_part_price if @current_user.present?\n      @part\n    end\n    ...\nend\n</code></pre>\n\n<pre class=\"lang-rb prettyprint-override\"><code>RSpec.describe PartController, type: :request do\n  before :all do\n    allow_any_instance_of(Action::PartsShow).to receive(:call).and_return(returned_part)\n  end\n</code></pre>\n\n<p><strong>Reference</strong></p>\n\n<p><a href=\"https://relishapp.com/rspec/rspec-mocks/v/3-5/docs/working-with-legacy-code/any-instance\" rel=\"nofollow noreferrer\">https://relishapp.com/rspec/rspec-mocks/v/3-5/docs/working-with-legacy-code/any-instance</a></p>\n"}, {"comments": [{"owner": {"reputation": 1480, "user_id": 4741620, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/13911648aa5b99a6542494b4c8fcbc38?s=128&d=identicon&r=PG&f=1", "display_name": "jedi", "link": "https://stackoverflow.com/users/4741620/jedi"}, "edited": false, "score": 0, "creation_date": 1569587029, "post_id": 58125881, "comment_id": 102655744, "body": "but you see, I don&#39;t want to even get there, I want to mock the entire <code>Action::PartsShow.new(show_params, current_user)</code> service to avoid calling it. I just want to expect that it is called and returns a value but I don&#39;t want to call it at all."}, {"owner": {"reputation": 1073, "user_id": 4024628, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Xc5J8.jpg?s=128&g=1", "display_name": "Allison", "link": "https://stackoverflow.com/users/4024628/allison"}, "reply_to_user": {"reputation": 1480, "user_id": 4741620, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/13911648aa5b99a6542494b4c8fcbc38?s=128&d=identicon&r=PG&f=1", "display_name": "jedi", "link": "https://stackoverflow.com/users/4741620/jedi"}, "edited": false, "score": 1, "creation_date": 1569601383, "post_id": 58125881, "comment_id": 102663001, "body": "If you do that and the functionality of Action::PartsShow changes, your specs will not notify you that there is an issue with the core functionality of that controller. You can still do this with <code>allow(Action::PartsShow).to receive(:new).with(show_params, current_user) { service }</code> to ensure that any call with that method and those params (which you should define in your spec with let vars) will return that specific thing you\u2019ve defined with a let var. It\u2019s the same basic syntax and MUCH safer to use than allow_any_instance_of. <code>let(:service) { double(Action::PartShow, call: part) }</code>"}], "tags": [], "owner": {"reputation": 1073, "user_id": 4024628, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Xc5J8.jpg?s=128&g=1", "display_name": "Allison", "link": "https://stackoverflow.com/users/4024628/allison"}, "is_accepted": false, "score": 1, "last_activity_date": 1569540522, "last_edit_date": 1569540522, "creation_date": 1569540116, "answer_id": 58125881, "question_id": 58085529, "link": "https://stackoverflow.com/questions/58085529/how-to-properly-mock-itnernal-services-in-rspec/58125881#58125881", "title": "How to properly mock itnernal services in RSpec?", "body": "<p>Assuming that <code>find_part</code> calls <code>Part.find(id)</code>, you can add:</p>\n\n<pre><code>before do\n  allow(Part).to receive(:find).with(part.id) { part }\nend\n</code></pre>\n\n<p>to ensure that the record lookup always returns your test object. I also suggest reworking your spec a bit:</p>\n\n<pre><code>RSpec.describe PartController, type: :request do\n  describe 'GET #show' do\n    let(:request) { get \"/api/v1/parts/#{part.id}\" }\n    let(:part)    { create(:part) }\n\n    it '200s' do\n      request\n      expect(response).to have_http_status(:success)\n    end\n  end\nend\n</code></pre>\n\n<p>If your project has <a href=\"https://guides.rubyonrails.org/routing.html#path-and-url-helpers\" rel=\"nofollow noreferrer\">path helpers</a>, I would also recommend using those instead of the path string.</p>\n"}], "owner": {"reputation": 1480, "user_id": 4741620, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/13911648aa5b99a6542494b4c8fcbc38?s=128&d=identicon&r=PG&f=1", "display_name": "jedi", "link": "https://stackoverflow.com/users/4741620/jedi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 240, "favorite_count": 0, "accepted_answer_id": 58087901, "answer_count": 2, "score": 1, "last_activity_date": 1569540522, "creation_date": 1569346356, "last_edit_date": 1569349307, "question_id": 58085529, "link": "https://stackoverflow.com/questions/58085529/how-to-properly-mock-itnernal-services-in-rspec", "title": "How to properly mock itnernal services in RSpec?", "body": "<p>I would like to learn how to properly mock object calls inside other classes, foor example I have this controller action:</p>\n\n<pre><code>def show\n service = Action::PartsShow.new(show_params, current_user)\n service.call\n render json: service.part, root: :part, serializer: PartSerializer, include: '**',\n        scope: {current_user: current_user}\nend\n</code></pre>\n\n<p>The service class looks like this.</p>\n\n<pre><code>module Action\n  class PartsShow &lt; PartsShowBase\n    def find_part\n      ...\n    end\n  end\nend\n\nmodule Action\n  class PartsShowBase\n    attr_reader :part\n\n    def initialize(params, current_user)\n      @params = params\n      @current_user = current_user\n    end\n\n    def call\n      find_part\n      reload_part_availability\n      reload_part_price if @current_user.present?\n    end\n\n    private\n\n    def reload_part_availability\n      ReloadPartAvailabilityWorker.perform_async(part.id)\n    end\n\n    def reload_part_price\n      ExternalData::LauberApi::UpdatePrices.new(@current_user, [part]).execute\n    end\n  end\nend\n</code></pre>\n\n<p>I don't want to call the actual <code>Action::PartsShow</code> service inside this controller action and all other methods, services + the worker because this makes the test very slow. What I want is to test if this service is being called and mock the rest of the services. I don't want to call them in my tests, I want to mock them.</p>\n\n<p>My test looks like this:</p>\n\n<pre><code>RSpec.describe PartController, type: :request do\n  describe 'GET #show' do\n    let(:part) { create(:part) }\n\n    subject { get \"/api/v1/parts/#{part.id}\" }\n\n    expect(response_body).to eq(200)\n    # ...\n  end\nend\n</code></pre>\n\n<p>Could you show me how to properly mock it? I've read about RSpec mocks and stubs but I am confused about it. I would appreciate your help.</p>\n"}, {"tags": ["ruby", "faraday"], "answers": [{"tags": [], "owner": {"reputation": 6122, "user_id": 946500, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fqdcn.jpg?s=128&g=1", "display_name": "Pavel Oganesyan", "link": "https://stackoverflow.com/users/946500/pavel-oganesyan"}, "is_accepted": true, "score": 1, "last_activity_date": 1569437230, "last_edit_date": 1569437230, "creation_date": 1569403740, "answer_id": 58095318, "question_id": 58085291, "link": "https://stackoverflow.com/questions/58085291/faraday-test-a-connection/58095318#58095318", "title": "Faraday - test a connection", "body": "<p>Faraday throws specific errors in case of connection problems.</p>\n\n<p><a href=\"https://github.com/lostisland/faraday/blob/master/lib/faraday/error.rb\" rel=\"nofollow noreferrer\">https://github.com/lostisland/faraday/blob/master/lib/faraday/error.rb</a></p>\n\n<p>I suggest to add error handling to your code:</p>\n\n<pre><code>def do_my_network_stuff\n  #making_requests\nrescue Faraday::Error #or more specific error type \n  #handling_errors\nend\n</code></pre>\n"}], "owner": {"reputation": 1343, "user_id": 984415, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/rMvNp.gif?s=128&g=1", "display_name": "lilHar", "link": "https://stackoverflow.com/users/984415/lilhar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 58095318, "answer_count": 1, "score": 0, "last_activity_date": 1569437230, "creation_date": 1569345384, "question_id": 58085291, "link": "https://stackoverflow.com/questions/58085291/faraday-test-a-connection", "title": "Faraday - test a connection", "body": "<p>I'm working with a connection object with Faraday in Ruby. That said, sometimes the target server is down, which results in a pretty ugly ruby error. Is there a way use Faraday to test existence of a connection before risking error?</p>\n"}, {"tags": ["ruby", "bash", "macos", "rbenv"], "comments": [{"owner": {"reputation": 10843, "user_id": 5101148, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc92fb51fd3b1f946847ccd36d63aee6?s=128&d=identicon&r=PG&f=1", "display_name": "Simba", "link": "https://stackoverflow.com/users/5101148/simba"}, "edited": false, "score": 1, "creation_date": 1569411179, "post_id": 58085231, "comment_id": 102586765, "body": "Please provide the rbenv related content in <code>~&#47;.bash_profile</code>, <code>~&#47;.bashrc</code>."}], "answers": [{"tags": [], "owner": {"reputation": 3146, "user_id": 3834822, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M9RkL.png?s=128&g=1", "display_name": "ilgam", "link": "https://stackoverflow.com/users/3834822/ilgam"}, "is_accepted": false, "score": 0, "last_activity_date": 1580478443, "creation_date": 1580478443, "answer_id": 60005159, "question_id": 58085231, "link": "https://stackoverflow.com/questions/58085231/how-do-i-resolve-the-message-no-such-file-or-directory-after-installing-rbenv/60005159#60005159", "title": "How do I resolve the message &quot;No such file or directory&quot; after installing rbenv on Mac OS?", "body": "<p>This line fails during loading of bash </p>\n\n<pre><code>source '/usr/local/Cellar/rbenv/1.1.2/libexec/../completions/rbenv.bash\n</code></pre>\n\n<p>You need to set right path to <code>rbenv.bash</code> file from <code>/completions</code> folder \nTo find the folder do:</p>\n\n<ol>\n<li>Find version of your rbenv <code>rbenv --version</code> => <code>1.1.2</code></li>\n<li>Here you should see <code>/completions</code> folder <code>ls -la /usr/local/Cellar/rbenv/1.1.2/</code></li>\n<li>Set right path to <code>rbenv.bash</code> file in your <code>.bash_profile</code> which is <code>source '/usr/local/Cellar/rbenv/1.1.2/completions/rbenv.bash'</code></li>\n</ol>\n"}], "owner": {"reputation": 11, "user_id": 12114561, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mDKWeKjkkQf-yyrWBkai5fP7JQekb0lZOk6qdFYjA=k-s128", "display_name": "Ryan Anding", "link": "https://stackoverflow.com/users/12114561/ryan-anding"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 329, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1580478443, "creation_date": 1569345188, "last_edit_date": 1569413762, "question_id": 58085231, "link": "https://stackoverflow.com/questions/58085231/how-do-i-resolve-the-message-no-such-file-or-directory-after-installing-rbenv", "title": "How do I resolve the message &quot;No such file or directory&quot; after installing rbenv on Mac OS?", "body": "<p>When opening my Terminal and/or using an IDE to write code, I get the following message:</p>\n\n<pre><code>-bash: export PATH=\"/Users/ryananding/.rbenv/shims:${PATH}\"\nexport RBENV_SHELL=bash\nsource '/usr/local/Cellar/rbenv/1.1.2/libexec/../completions/rbenv.bash'\ncommand rbenv rehash 2&gt;/dev/null\nrbenv() {\nlocal command\ncommand=\"${1:-}\"\nif [ \"$#\" -gt 0 ]; then\n    shift\nfi\n\ncase \"$command\" in\nrehash|shell)\n    eval \"$(rbenv \"sh-$command\" \"$@\")\";;\n*)\n    command rbenv \"$command\" \"$@\";;\nesac\n}: No such file or directory\n</code></pre>\n\n<p>I have followed the instructions found on <a href=\"https://github.com/rbenv/rbenv\" rel=\"nofollow noreferrer\">https://github.com/rbenv/rbenv</a> and the rbenv doctor doesn't show any errors. Any help would be appreciated.</p>\n"}, {"tags": ["ruby", "input", "hash"], "comments": [{"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1569362641, "post_id": 58085228, "comment_id": 102570648, "body": "I don&#39;t understand how you could get that exception. In your code <code>chomp</code>&#39;s receiver is always <code>gets</code>, but <code>gets</code> (as used here) cannot return <code>nil</code>, only a string, even if it contains only a newline character. What is the value of your global variable <code>$stdin</code>? (I expect <code>#&lt;IO:&lt;STDIN&gt;&gt;</code>.) btw, <code>str</code> is perhaps not the best name for an array. :-) (Maybe <code>arr = entry.split</code>.)"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1569430376, "post_id": 58085228, "comment_id": 102597626, "body": "Please answer my question."}], "answers": [{"comments": [{"owner": {"reputation": 89, "user_id": 10908471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/861913003f006a077c9ca26edbb64594?s=128&d=identicon&r=PG&f=1", "display_name": "Karen", "link": "https://stackoverflow.com/users/10908471/karen"}, "edited": false, "score": 0, "creation_date": 1569348971, "post_id": 58085890, "comment_id": 102565868, "body": "Thanks! For number 2, is name_str being &quot;chomped&quot; twice? I&#39;m a bit confused on why we need to chomp name_str again in the loop :("}, {"owner": {"reputation": 89, "user_id": 10908471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/861913003f006a077c9ca26edbb64594?s=128&d=identicon&r=PG&f=1", "display_name": "Karen", "link": "https://stackoverflow.com/users/10908471/karen"}, "edited": false, "score": 0, "creation_date": 1569349083, "post_id": 58085890, "comment_id": 102565923, "body": "And I tried the first way, but it seems that either there&#39;s an infinite loop or the code takes too long to execute."}, {"owner": {"reputation": 51, "user_id": 2753690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2778a6b310cb638f13d2a5084b79fce3?s=128&d=identicon&r=PG&f=1", "display_name": "sathish1203", "link": "https://stackoverflow.com/users/2753690/sathish1203"}, "reply_to_user": {"reputation": 89, "user_id": 10908471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/861913003f006a077c9ca26edbb64594?s=128&d=identicon&r=PG&f=1", "display_name": "Karen", "link": "https://stackoverflow.com/users/10908471/karen"}, "edited": false, "score": 0, "creation_date": 1569351620, "post_id": 58085890, "comment_id": 102566954, "body": "Sorry, I made a typo in 2. The condition is name_str = gets, no chomp in the conditional. For the first option, to_s just converts the object to a string. So nil should become &#39;&#39;, computationally it should not take that much time. There is no print observed in the console for to_s fix, is it?"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1569374654, "post_id": 58085890, "comment_id": 102572961, "body": "Please explain what you mean by, &quot;When there is no input to be read from the console...&quot;. Does <code>gets</code> (when used without arguments) not wait patiently for a newline (possibly preceded by other characters) to be entered?"}, {"owner": {"reputation": 51, "user_id": 2753690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2778a6b310cb638f13d2a5084b79fce3?s=128&d=identicon&r=PG&f=1", "display_name": "sathish1203", "link": "https://stackoverflow.com/users/2753690/sathish1203"}, "edited": false, "score": 0, "creation_date": 1569405448, "post_id": 58085890, "comment_id": 102583768, "body": "In HackerRank Website, the input would be a file from which the data is read. At the end of the file, gets would return a nil. If the name of the file is stored in ARGV and the gets is used, then it would read line by line and return nil at the last line. Does that answer the question?"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1569430794, "post_id": 58085890, "comment_id": 102597851, "body": "Can you provide a link to the relevant part of the HankerRank site? I don\u2019t doubt what you are saying but the OP says nothing about <code>gets</code> taking input from a file rather than from the console."}, {"owner": {"reputation": 51, "user_id": 2753690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2778a6b310cb638f13d2a5084b79fce3?s=128&d=identicon&r=PG&f=1", "display_name": "sathish1203", "link": "https://stackoverflow.com/users/2753690/sathish1203"}, "edited": false, "score": 0, "creation_date": 1569479846, "post_id": 58085890, "comment_id": 102611648, "body": "Okay, sure! The link is <a href=\"https://www.hackerearth.com/practice/\" rel=\"nofollow noreferrer\">hackerearth.com/practice</a>  In that section, in any problem there would be an online ide. Using gets in that ide would read from the input file."}], "tags": [], "owner": {"reputation": 51, "user_id": 2753690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2778a6b310cb638f13d2a5084b79fce3?s=128&d=identicon&r=PG&f=1", "display_name": "sathish1203", "link": "https://stackoverflow.com/users/2753690/sathish1203"}, "is_accepted": true, "score": 1, "last_activity_date": 1569405592, "last_edit_date": 1569405592, "creation_date": 1569348106, "answer_id": 58085890, "question_id": 58085228, "link": "https://stackoverflow.com/questions/58085228/why-is-there-an-extra-empty-line-after-i-print-my-output/58085890#58085890", "title": "Why is there an extra empty line after I print my output?", "body": "<pre><code>name_str = gets.chomp\n</code></pre>\n\n<p>In the HackerEarth website, the input is read from a file. When there is no input to be read from the file, the gets returns a nil object. As the nil does not have a chomp method(Restricted to classes like string), the exception is thrown. </p>\n\n<ol>\n<li>A quick fix for the code can be a to_s method after the gets statement. </li>\n</ol>\n\n<pre><code>gets.to_s.chomp\n</code></pre>\n\n<ol start=\"2\">\n<li>A better fix, IMO would be to read the inputs till nil is received. </li>\n</ol>\n\n<pre><code>until((name_str = gets.chomp).nil?)\n  name_str.chomp!\n  # Rest of the logic\nend\n\n</code></pre>\n"}], "owner": {"reputation": 89, "user_id": 10908471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/861913003f006a077c9ca26edbb64594?s=128&d=identicon&r=PG&f=1", "display_name": "Karen", "link": "https://stackoverflow.com/users/10908471/karen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 235, "favorite_count": 0, "accepted_answer_id": 58085890, "answer_count": 1, "score": 0, "last_activity_date": 1569405592, "creation_date": 1569345162, "question_id": 58085228, "link": "https://stackoverflow.com/questions/58085228/why-is-there-an-extra-empty-line-after-i-print-my-output", "title": "Why is there an extra empty line after I print my output?", "body": "<p>I'm practicing some coding questions in Ruby on HackerRank and I'm having trouble understanding why I'm getting an extra empty line of output. The user input (from the console) is as follows:</p>\n\n<pre><code>3\nsam 99912222\ntom 11122222\nharry 12299933\nsam\nedward\nharry\n</code></pre>\n\n<p>The first number tells you how many key value pairs there are that need to be added into a phoneBook hash. The next few lines (specified by the first number) are those key value pairs to be added. And the rest of the queries are the keys that I'm searching for. I've already written all of the code and I've tested it; it successfully adds the key value pairs into a hash named phoneBook and it also successfully prints the right values when I'm searching through the hash with the given keys. However, I'm getting an extra empty line of output at the end and I can't figure out why. Below is my code:</p>\n\n<pre><code>entries = []\n\nnum_entries = gets.to_i\nnum_entries.times do | input |\n    entries &lt;&lt; gets.chomp\nend\n\n\nphoneBook = {}\nentries.each do | entry |\n    str = entry.split\n    phoneBook[str[0]] = str[1].to_i\nend\n\nname_str = gets.chomp\nwhile name_str != \"\"\n    if phoneBook.has_key?(name_str)\n        puts name_str + \"=\" + phoneBook[name_str].to_s\n    else\n        puts \"Not found\"\n    end\n\n    name_str = gets.chomp\nend\n</code></pre>\n\n<p>And this is the error message that I'm receiving:</p>\n\n<pre><code>Solution.rb:23:in `&lt;main&gt;': undefined method `chomp' for nil:NilClass (NoMethodError)\n</code></pre>\n\n<p>I understand that the error is probably coming from trying to execute code on that blank line of output that I'm getting, but I thought that once the user input is blank, it'll exit out of the while loop. </p>\n"}, {"tags": ["html", "regex", "ruby", "image"], "answers": [{"tags": [], "owner": {"reputation": 113, "user_id": 12096255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4733a4df6d8411a926c6dfdb7f8226b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mohammad", "link": "https://stackoverflow.com/users/12096255/mohammad"}, "is_accepted": false, "score": 1, "last_activity_date": 1569342649, "creation_date": 1569342649, "answer_id": 58084631, "question_id": 58084386, "link": "https://stackoverflow.com/questions/58084386/select-img-tags-which-are-having-text-logo-any-where-in-the-html-tag/58084631#58084631", "title": "Select img tags which are having text logo any where in the html tag", "body": "<p>I've checked this and works correct:</p>\n\n<p><code>&lt;img\\s+.*?src=['\"]([^\"']+).*? alt=\\\"(.*)logo(.*)\\\"&gt;</code></p>\n\n<p>Try once with this pattern, maybe it's suitable for your use case ...</p>\n"}, {"tags": [], "owner": {"reputation": 3388, "user_id": 9534819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0fdbae473f8d26eb6a10d85ab897e91e?s=128&d=identicon&r=PG&f=1", "display_name": "Matt.G", "link": "https://stackoverflow.com/users/9534819/matt-g"}, "is_accepted": false, "score": 0, "last_activity_date": 1569347099, "creation_date": 1569347099, "answer_id": 58085687, "question_id": 58084386, "link": "https://stackoverflow.com/questions/58084386/select-img-tags-which-are-having-text-logo-any-where-in-the-html-tag/58085687#58085687", "title": "Select img tags which are having text logo any where in the html tag", "body": "<p>Try Regex: <code>&lt;img(?=[^&gt;]*logo)[^&gt;]*\\/?&gt;</code></p>\n\n<p><a href=\"https://rubular.com/r/3OBZsfNeVqVEbA\" rel=\"nofollow noreferrer\">Demo</a></p>\n"}], "owner": {"reputation": 363, "user_id": 3008512, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/100002492486839/picture?type=large", "display_name": "kotu b", "link": "https://stackoverflow.com/users/3008512/kotu-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 28, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1569347099, "creation_date": 1569341556, "last_edit_date": 1569346913, "question_id": 58084386, "link": "https://stackoverflow.com/questions/58084386/select-img-tags-which-are-having-text-logo-any-where-in-the-html-tag", "title": "Select img tags which are having text logo any where in the html tag", "body": "<pre><code>&lt;img class=\"logo\" src=\"/logo.png\"&gt;\n&lt;img src=\"/product.png\" id=\"logo\"&gt;\n&lt;img \n   src=\"/product.png\" \n   id=\"logo\"\n/&gt;\n\n\n&lt;img class=\"with-text\" src=\"            /portal-resource/portal-theme-images/regence/identity/regence-sun-cs.svg\n    \" alt=\"Regence-cs\"&gt;\n\n\n&lt;img class=\"with-text\" src=\"            /portal-resource/portal-theme-images/regence/identity/regence-sun-cs.svg\n    \" alt=\"Regence-cs logo\"&gt;\n\n</code></pre>\n\n<p>My trial available at <a href=\"https://rubular.com/r/X16b9YZiHzG1bS\" rel=\"nofollow noreferrer\">A rubular trial</a></p>\n\n<p>Please guide me about selecting image tags which are having <strong>logo</strong> text anywhere in the entire tag</p>\n"}, {"tags": ["mysql", "ruby-on-rails", "ruby", "activerecord"], "comments": [{"owner": {"reputation": 147, "user_id": 3624321, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1390780727/picture?type=large", "display_name": "Alvaro Alday", "link": "https://stackoverflow.com/users/3624321/alvaro-alday"}, "reply_to_user": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 0, "creation_date": 1569342024, "post_id": 58084363, "comment_id": 102562921, "body": "using || instead of | can return an empty array when the authored_conversations are empty, but the received conversations are not. this is an example of this occurring in one of my tests.  <code>with_received_conversations(conversations) || with_authored_conversations(conversations) </code>  <code>#&lt;ActiveRecord::Relation []&gt;</code>"}, {"owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 0, "creation_date": 1569350837, "post_id": 58084363, "comment_id": 102566638, "body": "Would you mind adding your models? And the db/schema file if needed?"}, {"owner": {"reputation": 75558, "user_id": 544825, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/UFdOO.png?s=128&g=1", "display_name": "max", "link": "https://stackoverflow.com/users/544825/max"}, "edited": false, "score": 0, "creation_date": 1569352532, "post_id": 58084363, "comment_id": 102567339, "body": "<code>scope</code> is just syntactic sugar for declaring class methods. Its best used for simple one-liners (that actually fit on a normal line). Use normal class method definition on these monsters for better readability."}, {"owner": {"reputation": 761, "user_id": 7786120, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3acd54907ef6cb3d7de0ebd91177850d?s=128&d=identicon&r=PG&f=1", "display_name": "Akshay Goyal", "link": "https://stackoverflow.com/users/7786120/akshay-goyal"}, "edited": false, "score": 1, "creation_date": 1569395904, "post_id": 58084363, "comment_id": 102578624, "body": "This might be helpful for you: <a href=\"https://stackoverflow.com/questions/6686920/activerecord-query-union\" title=\"activerecord query union\">stackoverflow.com/questions/6686920/activerecord-query-union</a>"}], "answers": [{"tags": [], "owner": {"reputation": 151, "user_id": 11964190, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTnbD.png?s=128&g=1", "display_name": "zakariah1", "link": "https://stackoverflow.com/users/11964190/zakariah1"}, "is_accepted": false, "score": 0, "last_activity_date": 1569354546, "creation_date": 1569354546, "answer_id": 58087259, "question_id": 58084363, "link": "https://stackoverflow.com/questions/58084363/how-to-do-two-joins-and-execute-a-single-active-record-query-using-activerecord/58087259#58087259", "title": "How to do two joins and execute a single active record query using ActiveRecord?", "body": "<p>I'm not allowed to comment so I am sorry for creating an answer.  I think that this post is helpful.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/40742078/relation-passed-to-or-must-be-structurally-compatible-incompatible-values-r\">Relation passed to #or must be structurally compatible. Incompatible values: [:references]</a></p>\n"}], "owner": {"reputation": 147, "user_id": 3624321, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1390780727/picture?type=large", "display_name": "Alvaro Alday", "link": "https://stackoverflow.com/users/3624321/alvaro-alday"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1569354546, "creation_date": 1569341474, "question_id": 58084363, "link": "https://stackoverflow.com/questions/58084363/how-to-do-two-joins-and-execute-a-single-active-record-query-using-activerecord", "title": "How to do two joins and execute a single active record query using ActiveRecord?", "body": "<p>I'm using MySQL and I'm trying to create a couple of scopes to find a User based on a set of conversations, users and conversations have a polymorphic association that allows the user to author and receives conversations. </p>\n\n<p>The \"with_conversations\" scope is doing what I want, however, it's not very efficient, I'm having trouble making it execute a single query instead of the addition 2 arrays, which triggers 2 separate queries.</p>\n\n<pre><code>class User \n\n  scope :with_received_conversations, -&gt; (conversations) { joins(:received_conversations).where(conversations: { id: conversations, receiver_type: \"User\" }) }\n  scope :with_authored_conversations, -&gt; (conversations) { joins(:authored_conversations).where(conversations: { id: conversations, author_type: \"User\" }) }\n  scope :with_conversations,          -&gt; (conversations) { with_authored_conversations(conversations) | with_received_conversations(conversations) }\n\nend\n</code></pre>\n\n<p>I attempted using the \"or()\" active record function but it returns the following error:</p>\n\n<pre><code>*** ArgumentError Exception: Relation passed to #or must be structurally compatible. Incompatible values: [:joins]\n\nnil\n</code></pre>\n"}, {"tags": ["ruby", "postgresql", "chef-infra", "pg"], "answers": [{"comments": [{"owner": {"reputation": 189, "user_id": 4380155, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d807912a2e1caa459162fc97d3cd1e99?s=128&d=identicon&r=PG", "display_name": "Jaydeep", "link": "https://stackoverflow.com/users/4380155/jaydeep"}, "edited": false, "score": 0, "creation_date": 1569510958, "post_id": 58084500, "comment_id": 102628691, "body": "Thanks, actually gcc was missing in my case"}], "tags": [], "owner": {"reputation": 45322, "user_id": 421705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/581b1760881c962648f99d6040d41829?s=128&d=identicon&r=PG", "display_name": "Holger Just", "link": "https://stackoverflow.com/users/421705/holger-just"}, "is_accepted": true, "score": 1, "last_activity_date": 1569512484, "last_edit_date": 1569512484, "creation_date": 1569342055, "answer_id": 58084500, "question_id": 58083739, "link": "https://stackoverflow.com/questions/58083739/pg-gem-installation-is-giving-error-in-redhat/58084500#58084500", "title": "pg gem installation is giving error in Redhat", "body": "<p>You first need to install build tools (i.e. a C compiler and related tools) as well as development headers for your postgres server to be able to compile the gem.</p>\n\n<p>For RedHat, you should be able to get all required tools with</p>\n\n<pre><code>yum install autoconf bison flex gcc gcc-c++ gettext kernel-devel make m4 ncurses-devel patch\nyum install postgresql-devel\n</code></pre>\n\n<p>With Chef 14, you can use the built-in <a href=\"https://docs.chef.io/resource_build_essential.html\" rel=\"nofollow noreferrer\"><code>build_essential</code> resource</a> to install the required compiler packages. On older versions, you can use the <a href=\"https://supermarket.chef.io/cookbooks/build-essential\" rel=\"nofollow noreferrer\"><code>build-essential</code> cookbook</a>.</p>\n"}], "owner": {"reputation": 189, "user_id": 4380155, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d807912a2e1caa459162fc97d3cd1e99?s=128&d=identicon&r=PG", "display_name": "Jaydeep", "link": "https://stackoverflow.com/users/4380155/jaydeep"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "accepted_answer_id": 58084500, "answer_count": 1, "score": 0, "last_activity_date": 1569512484, "creation_date": 1569339220, "last_edit_date": 1569341794, "question_id": 58083739, "link": "https://stackoverflow.com/questions/58083739/pg-gem-installation-is-giving-error-in-redhat", "title": "pg gem installation is giving error in Redhat", "body": "<p>I am executing <code>gem install pg</code> to install the pg and execute chef scripts afterwards in Redhat AWS machine. I am getting following error:</p>\n\n<pre><code>gem install pg Building native extensions. This could take a while...\nERROR:  Error installing pg:\n       ERROR: Failed to build gem native extension.\n\ncurrent directory: /opt/chef/embedded/lib/ruby/gems/2.5.0/gems/pg-1.1.4/ext/opt/chef/embedded/bin/ruby -r ./siteconf20190924-20230-k0ngu5.rb extconf.rb\nchecking for pg_config... yes\nUsing config values from /bin/pg_config\nchecking for libpq-fe.h...\n*** extconf.rb failed ***\n\nCould not create Makefile due to some reason, probably lack of\nnecessary libraries and/or headers.  Check the mkmf.log file for more\ndetails.  You may need configuration options.\n\nProvided configuration options:\n       --with-opt-dir\n       --with-opt-include\n       --without-opt-include=${opt-dir}/include\n       --with-opt-lib\n       --without-opt-lib=${opt-dir}/lib\n       --with-make-prog\n       --without-make-prog\n       --srcdir=.\n       --curdir\n       --ruby=/opt/chef/embedded/bin/$(RUBY_BASE_NAME)\n       --with-pg\n       --without-pg\n       --enable-windows-cross\n       --disable-windows-cross\n       --with-pg-config\n       --without-pg-config\n       --with-pg_config\n       --without-pg_config\n       --with-pg-dir\n       --without-pg-dir\n       --with-pg-include=${pg-dir}/include\n       --with-pg-lib\n       --without-pg-lib=${pg-dir}/lib\n\n/opt/chef/embedded/lib/ruby/2.5.0/mkmf.rb:467:in `try_do': The compiler failed to generate an executable file. (RuntimeError) You have to install development tools first.\n       from /opt/chef/embedded/lib/ruby/2.5.0/mkmf.rb:601:in `try_cpp'\n       from /opt/chef/embedded/lib/ruby/2.5.0/mkmf.rb:1162:in `block in find_header'\n       from /opt/chef/embedded/lib/ruby/2.5.0/mkmf.rb:959:in `block in checking_for'\n       from /opt/chef/embedded/lib/ruby/2.5.0/mkmf.rb:350:in `block (2 levels) in postpone'\n       from /opt/chef/embedded/lib/ruby/2.5.0/mkmf.rb:320:in `open'\n       from /opt/chef/embedded/lib/ruby/2.5.0/mkmf.rb:350:in `block in postpone'\n       from /opt/chef/embedded/lib/ruby/2.5.0/mkmf.rb:320:in `open'\n       from /opt/chef/embedded/lib/ruby/2.5.0/mkmf.rb:346:in `postpone'\n       from /opt/chef/embedded/lib/ruby/2.5.0/mkmf.rb:958:in `checking_for'\n       from /opt/chef/embedded/lib/ruby/2.5.0/mkmf.rb:1161:in `find_header'\n       from extconf.rb:54:in `&lt;main&gt;'\n\nTo see why this extension failed to compile, please check the mkmf.log\nwhich can be found here:\n\n/opt/chef/embedded/lib/ruby/gems/2.5.0/extensions/x86_64-linux/2.5.0/pg-1.1.4/mkmf.log\n\nextconf failed, exit code 1\n</code></pre>\n\n<p>I am trying this with root user. I have installed <code>postgresql-devel</code> too using yum and tried to provide <code>--with-pg-include</code> too where <code>libpq-fe.h</code> resides (suggested in some other posts) but couldn't resolve the issue.</p>\n"}, {"tags": ["ruby", "aws-api-gateway", "serverless-framework", "serverless"], "answers": [{"comments": [{"owner": {"reputation": 131, "user_id": 5864270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/435158a26dfd4709e77779f6ebfddc88?s=128&d=identicon&r=PG&f=1", "display_name": "n41r0j", "link": "https://stackoverflow.com/users/5864270/n41r0j"}, "edited": false, "score": 0, "creation_date": 1611080093, "post_id": 64618596, "comment_id": 116333571, "body": "For what it&#39;s worth: this answer did the trick. The only thing I had to change was the capitalization of the headers: <code>Content-Type</code> was <code>content-type</code> in my case. Header capitalization shouldn&#39;t matter, but when reading headers, it matters."}, {"owner": {"reputation": 131, "user_id": 5864270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/435158a26dfd4709e77779f6ebfddc88?s=128&d=identicon&r=PG&f=1", "display_name": "n41r0j", "link": "https://stackoverflow.com/users/5864270/n41r0j"}, "edited": false, "score": 0, "creation_date": 1611080209, "post_id": 64618596, "comment_id": 116333626, "body": "Also, kudos for answering a question that is barely readable :)"}], "tags": [], "owner": {"reputation": 178, "user_id": 6111957, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f473ec39d4ce3dd1e345f62dc8fa23f3?s=128&d=identicon&r=PG&f=1", "display_name": "Yason", "link": "https://stackoverflow.com/users/6111957/yason"}, "is_accepted": false, "score": 1, "last_activity_date": 1604120637, "creation_date": 1604120637, "answer_id": 64618596, "question_id": 58083730, "link": "https://stackoverflow.com/questions/58083730/how-i-can-decode-or-parser-multipart-form-data-in-ruby-2-5-and-get-hash-with-p/64618596#64618596", "title": "how i can decode or parser &quot;multipart/form-data&quot; in ruby 2.5 and get hash with params", "body": "<p>My code was inspired (read: mostly copied from) Faraday Gem at: <a href=\"https://github.com/lostisland/faraday/blob/b863c167d6646bb46d51ad4f0e5081e06c915c67/spec/support/helper_methods.rb\" rel=\"nofollow noreferrer\">Faraday Gem Github</a></p>\n<p>You will need to use <code>gem 'multipart-parser', '~&gt; 0.1.1'</code> and\ncreate a <code>util.rb</code> file:</p>\n<pre><code>require 'multipart_parser/reader'\n\nmodule Util\n  extend self\n\n  # parse a multipart MIME message, returning a hash of any multipart errors\n  def parse_multipart(event)\n    body = event[&quot;body&quot;]\n    boundary = MultipartParser::Reader::extract_boundary_value(event.dig(&quot;headers&quot;,&quot;Content-Type&quot;))\n    reader = MultipartParser::Reader.new(boundary)\n\n    result = { errors: [], parts: [] }\n    def result.part(name)\n      hash = self[:parts].detect { |h| h[:part].name == name }\n      [hash[:part], hash[:body].join]\n    end\n\n    reader.on_part do |part|\n      result[:parts] &lt;&lt; thispart = {\n        part: part,\n        body: []\n      }\n      part.on_data do |chunk|\n        thispart[:body] &lt;&lt; chunk\n      end\n    end\n    reader.on_error do |msg|\n      result[:errors] &lt;&lt; msg\n    end\n    reader.write(body)\n    result\n  end\n\n  def parse_multipart_hash(event)\n    event_parts = parse_multipart(event)[:parts]\n    event_parts.inject({}) do |hash, part|\n      if part[:part].filename.nil?\n        hash.merge({part[:part].name =&gt; part[:body]})\n      else\n        hash.merge({part[:part].name =&gt; {mime: part[:part].mime, filename: part[:part].filename, data: part[:body].join}})\n      end\n    end\n  end\n\nend\n</code></pre>\n<p>Then you can use it like so:</p>\n<pre><code>require_relative './util'\n\ndef lambda_handler(event:, context:)\n    parsed_event_body = Util.parse_multipart_hash(event)\nend\n</code></pre>\n<p>Not sure how this will handle images, but it works fine for CSV. You can modify <code>parse_multipart</code> to just return the hash, but I left it because it seem to provide a more generic structure to the data.</p>\n<p>You can use the first method like this:</p>\n<pre><code>parts = Util.parse_multipart_hash(event)\nmeta, fieldname = parts.part(&quot;fieldname&quot;)\n</code></pre>\n"}], "owner": {"reputation": 93, "user_id": 4917414, "user_type": "registered", "profile_image": "https://graph.facebook.com/10204122101641004/picture?type=large", "display_name": "Victor Rojas", "link": "https://stackoverflow.com/users/4917414/victor-rojas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1604120637, "creation_date": 1569339201, "question_id": 58083730, "link": "https://stackoverflow.com/questions/58083730/how-i-can-decode-or-parser-multipart-form-data-in-ruby-2-5-and-get-hash-with-p", "title": "how i can decode or parser &quot;multipart/form-data&quot; in ruby 2.5 and get hash with params", "body": "<p>I want decode body what do i get of apigateway request to a lambda in ruby 2.5 and get hash with params.\nThis one comes with 'Content-type: \"form-data\"' </p>\n\n<blockquote>\n  <p>----------------------------106174163609970174188191\\r\\nContent-Disposition: form-data;\n  name=\\\"packageName\\\"\\r\\n\\r\\ncom.orbemnetworks.americatv\\r\\n----------------------------106174163609970174188191\\r\\nContent-Disposition: form-data;\n  name=\\\"subscriptionId\\\"\\r\\n\\r\\nsuscripcion_mensual\\r\\n----------------------------106174163609970174188191\\r\\nContent-Disposition: form-data;\n  name=\\\"token\\\"\\r\\n\\r\\ndaomloifokamoigolhhapeap.AO-J1OxQBm7mW7z6pPPfwE9bJ23n5oeQwOBf46gKFSjjdHmkRHJDIR-RCbXtuDD6L_C_KfYEVETbvpu0M72t9-FXTNdHbB67dfJqzGMpx197Pb_IN8kLyU6ng-b8Yvo-1r-xJzcC04Rg\\r\\n----------------------------106174163609970174188191\\r\\nContent-Disposition: form-data;\n  name=\\\"idusuario\\\"\\r\\n\\r\\n1577633\\r\\n----------------------------106174163609970174188191\\r\\nContent-Disposition: form-data;\n  name=\\\"os\\\"\\r\\n\\r\\nA\\r\\n----------------------------106174163609970174188191--\\r\\n</p>\n</blockquote>\n"}, {"tags": ["ruby", "pipe", "stdout"], "comments": [{"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 1, "creation_date": 1569341020, "post_id": 58082748, "comment_id": 102562415, "body": "The issues is that <code>whoami</code> is writing to STDOUT, and by flushing the buffer your ruby script is now writing to a broken pipe. Here is quite a good writeup on the issue: <a href=\"https://stackoverflow.com/a/30103307/1954610\">stackoverflow.com/a/30103307/1954610</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1341, "user_id": 11089758, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XQ5gw.jpg?s=128&g=1", "display_name": "S.Goswami", "link": "https://stackoverflow.com/users/11089758/s-goswami"}, "is_accepted": true, "score": 2, "last_activity_date": 1569368335, "last_edit_date": 1569368335, "creation_date": 1569365597, "answer_id": 58089064, "question_id": 58082748, "link": "https://stackoverflow.com/questions/58082748/ruby-broken-pipe-io-write-stdout/58089064#58089064", "title": "Ruby Broken pipe @ io_write - &lt;STDOUT&gt;", "body": "<h2>Introduction</h2>\n\n<p>Firstly, an explanation can be found <a href=\"https://stackoverflow.com/questions/1807355/broken-pipe-errnoepipe\">here</a>.</p>\n\n<p>Anyways, here's my thought...</p>\n\n<p>When a pipe is used like this:</p>\n\n<pre><code>a | b\n</code></pre>\n\n<p>Both a and b are executed <a href=\"https://unix.stackexchange.com/a/37597/274717\">concurrently</a>. b waits for standard input from a.</p>\n\n<p>Speaking of <code>Errno::EPIPE</code>, The <a href=\"http://man7.org/linux/man-pages/man2/write.2.html\" rel=\"nofollow noreferrer\">Linux man page of write</a> says:</p>\n\n<blockquote>\n  <p>EPIPE  fd is connected to a pipe or socket whose reading end is\n            closed.  When this happens the writing process will also\n            receive a SIGPIPE signal.  (Thus, the write return value is\n            seen only if the program catches, blocks or ignores this\n            signal.)</p>\n</blockquote>\n\n<p>Talking about the problem in the question:\nWhen the program <code>whoami</code> is run, it exits and no longer accepts standard inputs that ruby program <code>hello.rb</code> is sending - resulting in a broken pipe.</p>\n\n<p><strong>Here I wrote 2 ruby programs, named p.rb and q.rb to test that:</strong></p>\n\n<ul>\n<li>p.rb</li>\n</ul>\n\n<pre><code>#!/usr/bin/env ruby\nprint ?* * 100_000\n</code></pre>\n\n<ul>\n<li>q.rb</li>\n</ul>\n\n<pre><code>#!/usr/bin/ruby\nexit! 0\n</code></pre>\n\n<p><strong>Running:</strong></p>\n\n<pre><code>bash[~] $ ruby p.rb | ruby q.rb\n\nTraceback (most recent call last):\n    2: from p.rb:2:in `&lt;main&gt;'\n    1: from p.rb:2:in `print'\np.rb:2:in `write': Broken pipe @ io_write - &lt;STDOUT&gt; (Errno::EPIPE)\n\n</code></pre>\n\n<h2>Let's change the code of <em>q.rb</em> a bit, so that it accepts inputs:</h2>\n\n<pre><code>#!/usr/bin/ruby -w\nSTDIN.gets\n</code></pre>\n\n<p><strong>Running:</strong></p>\n\n<pre><code>bash[~] $ ruby p.rb | ruby q.rb\n</code></pre>\n\n<p>Right, it displays nothing actually. The reason is that q.rb now waits for standard inputs. <strong>Apparently, the waiting is what matters the most here</strong>. Now, p.rb will not crash with even with <code>STDOUT.sync</code> or <code>STDOUT.flush</code> when piped to this q.rb.</p>\n\n<h2>Another Example:</h2>\n\n<ul>\n<li>p.rb</li>\n</ul>\n\n<pre><code>STDOUT.sync = true\nloop until print(\"\\e[2K&lt;&lt;&lt;#{Time.now.strftime('%H:%M:%S:%2N')}&gt;&gt;&gt;\\r\")\n</code></pre>\n\n<p>[warning: the loop without sleep may bring up your CPU usage]</p>\n\n<ul>\n<li>q.rb</li>\n</ul>\n\n<pre><code>sleep 3\n</code></pre>\n\n<p><strong>Running:</strong></p>\n\n<pre><code>bash[~] $ time ruby p.rb | q.rb\nTraceback (most recent call last):\n    2: from p.rb:2:in `&lt;main&gt;'\n    1: from p.rb:2:in `print'\np.rb:2:in `write': Broken pipe @ io_write - &lt;STDOUT&gt; (Errno::EPIPE)\n\nreal    0m3.186s\nuser    0m0.282s\nsys 0m0.083s\n</code></pre>\n\n<p>You see the program crashed after 3 seconds. It will crash after 5.1 seconds if q.rb had <code>sleep 5</code>. Similarly <code>sleep 0</code> in <em>q.rb</em> will crash <em>p.rb</em> after 0.1 seconds. I guess the additional 0.1 seconds depends on the system because <strong>my system takes 0.1 seconds to load the ruby interpreter.</strong></p>\n\n<p>I wrote p.cr and q.cr Crystal programs to test. Crystal is <a href=\"https://crystal-lang.org/reference/using_the_compiler/\" rel=\"nofollow noreferrer\">compiled</a> and doesn't take the long 0.1 seconds to load up.</p>\n\n<h2>The Crystal Programs:</h2>\n\n<ul>\n<li>p.cr</li>\n</ul>\n\n<pre><code>STDOUT.sync = true\nloop do print(\"\\e[2KHi!\\r\") end rescue exit\n</code></pre>\n\n<ul>\n<li>q.cr</li>\n</ul>\n\n<pre><code>sleep 3\n</code></pre>\n\n<p>I compiled them, and ran:</p>\n\n<pre><code>bash[~] $ time ./p | ./q\n\nreal    0m3.013s\nuser    0m0.007s\nsys 0m0.019s\n</code></pre>\n\n<p>The binary <em>./p</em>, in very close to 3 seconds, handles <code>Unhandled exception: Error writing file: Broken pipe (Errno)</code> and exits. Again, 0.01 seconds may be taken by the two crystal programs to execute and maybe the Kernel also takes a bit time to run the processes.</p>\n\n<p>Also note that <code>STDERR#print</code>, <code>STDERR#puts</code>, <code>STDERR#putc</code>, <code>STDERR#printf</code>, <code>STDERR#write</code>, <code>STDERR#syswrite</code> doesn't raise Errno::EPIPE even if the output is in sync.</p>\n\n<h2>Conclusion</h2>\n\n<p>Pipe is <a href=\"https://unix.stackexchange.com/a/37513/274717\">arcane</a>. Setting <code>STDOUT#sync</code> to true or using <code>STDOUT#flush</code> flushes all buffered data to the underlying operating system.</p>\n\n<p>When running <code>hello.rb | whoami</code>, without sync, I can write 8191 bytes of data, and the program <em>hello.rb</em> doesn't crash. But with sync, writing 1 byte via pipe will crash <em>hello.rb</em>.</p>\n\n<p>So when <em>hello.rb</em> synchronizes standard outputs with the piped program <code>whoami</code>, and <code>whoami</code> doesn't wait for <em>hello.rb</em>; <em>hello.rb</em> raises <code>Errno::EPIPE</code> because the pipe between these two programs is broken (correct me if I am lost here).</p>\n"}], "owner": {"reputation": 1341, "user_id": 11089758, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XQ5gw.jpg?s=128&g=1", "display_name": "S.Goswami", "link": "https://stackoverflow.com/users/11089758/s-goswami"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1567, "favorite_count": 1, "accepted_answer_id": 58089064, "answer_count": 1, "score": 4, "last_activity_date": 1569368335, "creation_date": 1569335825, "last_edit_date": 1569336456, "question_id": 58082748, "link": "https://stackoverflow.com/questions/58082748/ruby-broken-pipe-io-write-stdout", "title": "Ruby Broken pipe @ io_write - &lt;STDOUT&gt;", "body": "<p>while trying to run a ruby program and piping the output to another program like this:</p>\n\n<pre><code>ruby hello.rb | whoami\n</code></pre>\n\n<p>The command <code>whoami</code> is executed first as expected, but after that, hello.rb crashes with:</p>\n\n<pre><code>Traceback (most recent call last):\n    2: from p.rb:2:in `&lt;main&gt;'\n    1: from p.rb:2:in `print'\np.rb:2:in `write': Broken pipe @ io_write - &lt;STDOUT&gt; (Errno::EPIPE)\n</code></pre>\n\n<p>This happens only when <code>STDOUT.sync</code> is set to <code>true</code></p>\n\n<pre><code>STDOUT.sync = true\nSTDOUT.print \"Hello!\"\n</code></pre>\n\n<p>[and a similar error is raised with <code>STDOUT.flush</code> after <code>STDOUT.puts</code> when piped to another program]</p>\n\n<p>What is the reason behind this crash?</p>\n"}, {"tags": ["ruby", "travis-ci", "travis-rb"], "owner": {"reputation": 55, "user_id": 2720150, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a497fddcdfad3c81a975eb98169b41bc?s=128&d=identicon&r=PG", "display_name": "nicholalexander", "link": "https://stackoverflow.com/users/2720150/nicholalexander"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 250, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1569333064, "creation_date": 1569331819, "last_edit_date": 1569333064, "question_id": 58081458, "link": "https://stackoverflow.com/questions/58081458/how-to-override-travis-yml-environment-variables-from-ruby-script-using-travis", "title": "How to override .travis.yml environment variables from ruby script using travis client", "body": "<p>I'm using the travis client to write a ruby script to interact with my TravisCI builds.  I have a working .travis.yml file with a series of encrypted env vars.  I'm trying to trigger the build from my script with a new env_var that overwrites one of the existing encrypted env vars in the travis.yml but I am unable to override the .yml configuration.</p>\n\n<p>When making API call using CURL, I can successfully override the env var.</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>body='{\n  \"request\": {\n    \"branch\":\"master\",\n    \"config\": {\n      \"merge_mode\": \"deep_merge\",\n      \"env\": {\n        \"SOME_ENV_VAR_DEFINED_IN_YML\": '\"$some_new_value_for_the_old_key\"'\n      }\n    }\n  }\n}'\n</code></pre>\n\n<pre class=\"lang-sh prettyprint-override\"><code>curl -s -X POST \\\n   -H \"Content-Type: application/json\" \\\n   -H \"Accept: application/json\" \\\n   -H \"Travis-API-Version: 3\" \\\n   -H \"Authorization: token MYSECRETTOKEN\" \\\n   -d \"$body\" \\\n   https://api.travis-ci.com/repo/MYORG%2FMYREPO/requests\n</code></pre>\n\n<p>This is what I'm trying to do with the client in the script but not able to.</p>\n\n<p>I've tried getting the repo and setting some env vars thusly:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>my_repo = Travis::Pro::Repository.find(\"MYREPO\")\nmy_repo.env_vars.upsert(\"SOME_ENV_VAR_DEFINED_IN_YML\", \"some_new_value\", public: true)\n</code></pre>\n\n<p>Nada.  It sets the env var on the repo that I can see in the travis ui but doesn't override the .yml config.</p>\n\n<p>I've also tried setting the config object on the build that I want.</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>build_that_i_am_targeting.config[\"global_env\"][index_of_env_var]=\"SOME_ENV_VAR_DEFINED_IN_YML=some_new_value\"\n</code></pre>\n\n<p>Also nada - when setting off the build it resets the global env vars to the previous version.</p>\n\n<p>Link to what I thought was relevant documentation: <a href=\"https://github.com/travis-ci/travis.rb#build-environment-variables\" rel=\"nofollow noreferrer\">https://github.com/travis-ci/travis.rb#build-environment-variables</a></p>\n\n<p>I was considering using the client session (just below the above in the docummentation) but I feel like there is something simpler that I'm missing.  Any suggestions/ideas much appreciated!  Thanks!</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "rubocop"], "comments": [{"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1569329570, "post_id": 58080658, "comment_id": 102555720, "body": "i&#39;m not sure I&#39;m following the need for this.  Will the &quot;local&quot; codebase be shared with the large organization or just the local team?  If not, than why not just have specific rules set at the project/repo level?  But if so, than doesn&#39;t not all using the same style guide break the purpose of even having a style guide (i.e. consistency) ?"}, {"owner": {"reputation": 67, "user_id": 4183602, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4200a20009ab7cccc4b8d81d7401da2b?s=128&d=identicon&r=PG&f=1", "display_name": "JsonP", "link": "https://stackoverflow.com/users/4183602/jsonp"}, "reply_to_user": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1569333443, "post_id": 58080658, "comment_id": 102558188, "body": "@lacostenycoder Yes we do have 1 code base shared by 15 teams, however at the moment the rules implemented company wide are minimal, we would like to build on this, have more stringent rules, try this approach in our team and the roll it out to the rest of the teams."}, {"owner": {"reputation": 3201, "user_id": 2892779, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uvM8S.jpg?s=128&g=1", "display_name": "Jay Dorsey", "link": "https://stackoverflow.com/users/2892779/jay-dorsey"}, "edited": false, "score": 1, "creation_date": 1569339992, "post_id": 58080658, "comment_id": 102561876, "body": "You could try setting up a bin/shell script to wrap a command up that uses the extra config file. <code>bin&#47;rc</code> for example, could call the alternate config file."}], "answers": [{"comments": [{"owner": {"reputation": 3201, "user_id": 2892779, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uvM8S.jpg?s=128&g=1", "display_name": "Jay Dorsey", "link": "https://stackoverflow.com/users/2892779/jay-dorsey"}, "edited": false, "score": 1, "creation_date": 1569340136, "post_id": 58083185, "comment_id": 102561944, "body": "I don&#39;t see the yml being parsed correctly here by rubocop, so it might require an interim conversion step which should be easy on CI. I tried it with <code>Style&#47;NumericLiterals</code> and the false/true (no conditional) and it always interpreted the result as true (enabled)"}, {"owner": {"reputation": 67, "user_id": 4183602, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4200a20009ab7cccc4b8d81d7401da2b?s=128&d=identicon&r=PG&f=1", "display_name": "JsonP", "link": "https://stackoverflow.com/users/4183602/jsonp"}, "edited": false, "score": 0, "creation_date": 1569342189, "post_id": 58083185, "comment_id": 102562993, "body": "Will try this approach and vote the answer if successful."}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1569343917, "post_id": 58083185, "comment_id": 102563773, "body": "I couldn&#39;t get the environment variables to work inside the <code>.rubocop.yml</code> so I removed that part from my answer.  There is probably a way to get them to work but that would require some hacks or scripts around rubocop itself."}], "tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": false, "score": 0, "last_activity_date": 1569343847, "last_edit_date": 1569343847, "creation_date": 1569337233, "answer_id": 58083185, "question_id": 58080658, "link": "https://stackoverflow.com/questions/58080658/rubocop-implementing-local-rules/58083185#58083185", "title": "Rubocop implementing local rules", "body": "<p>You should be able to pass a file to rubocop to use for your rules like this</p>\n\n<pre><code>rubocop -c team_a_only_rules.yml\n</code></pre>\n\n<p>But the problem will be with CI because I don't know how you would tell CI when to use which rules.  </p>\n"}], "owner": {"reputation": 67, "user_id": 4183602, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4200a20009ab7cccc4b8d81d7401da2b?s=128&d=identicon&r=PG&f=1", "display_name": "JsonP", "link": "https://stackoverflow.com/users/4183602/jsonp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 123, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1569343847, "creation_date": 1569329190, "last_edit_date": 1569333688, "question_id": 58080658, "link": "https://stackoverflow.com/questions/58080658/rubocop-implementing-local-rules", "title": "Rubocop implementing local rules", "body": "<p>I am part of a large organisation, we use CI and CD. As part of our drive to improve our ruby codebase we would like to enforce local rules than the wider team are not using.</p>\n\n<p>We work with 1 codebase shared between 15 teams (over 120 devs) and the rubocop rules implemented at the moment are fairly minimal. We would like to have our team comply with more rules and run this as a test within our team only, before making a decision to roll it out company wide.</p>\n\n<p>We have a <code>.rubocop.yml</code> which looks like this:</p>\n\n<pre><code>inherit_from:\n  - .rubocop/enforced_rules.yml\n  - .rubocop/optional_rules.yml\n  - .rubocop/disabled_rules.yml\n</code></pre>\n\n<p>We would like to have a local say <code>.team_a_only_rules.yml</code> that we can use in our team this file will override the 3 files above.</p>\n\n<p>Is there a way to do this and enforce it before committing any code to the remote? </p>\n\n<p>Also we don't want to commit this <code>.team_a_only_rules.yml</code> which I guess we could add it to the <code>.gitignore</code> file but the question would be how to enforce the local rules that override all other company wide rules?</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 16672, "user_id": 22237, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/hkobD.png?s=128&g=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/22237/kris"}, "edited": false, "score": 0, "creation_date": 1569328217, "post_id": 58080372, "comment_id": 102554997, "body": "As a side note when inhering from <code>Class</code> the block passed to <code>super()</code> is not executed and silently ignored."}, {"owner": {"reputation": 4127, "user_id": 4231385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d89a541a4609cafea3957e4cdfcca50f?s=128&d=identicon&r=PG&f=1", "display_name": "cremno", "link": "https://stackoverflow.com/users/4231385/cremno"}, "edited": false, "score": 0, "creation_date": 1569330288, "post_id": 58080372, "comment_id": 102556192, "body": "How do you inherit from <code>Class</code> when Ruby prohibits inheriting from <code>Class</code> or singleton classes?"}, {"owner": {"reputation": 16237, "user_id": 2166798, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/417356917295f5176d2a3e7c21d8f9e8?s=128&d=identicon&r=PG", "display_name": "pjs", "link": "https://stackoverflow.com/users/2166798/pjs"}, "edited": false, "score": 1, "creation_date": 1569333125, "post_id": 58080372, "comment_id": 102557985, "body": "Perhaps the parent class/module has been set up like <a href=\"https://stackoverflow.com/questions/34065817/initialize-an-object-with-a-block\">this</a>."}, {"owner": {"reputation": 4127, "user_id": 4231385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d89a541a4609cafea3957e4cdfcca50f?s=128&d=identicon&r=PG&f=1", "display_name": "cremno", "link": "https://stackoverflow.com/users/4231385/cremno"}, "reply_to_user": {"reputation": 16237, "user_id": 2166798, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/417356917295f5176d2a3e7c21d8f9e8?s=128&d=identicon&r=PG", "display_name": "pjs", "link": "https://stackoverflow.com/users/2166798/pjs"}, "edited": false, "score": 0, "creation_date": 1569337547, "post_id": 58080372, "comment_id": 102560550, "body": "@pjs: That&#39;s right, here <code>super</code> calls <a href=\"https://ruby-doc.org/core/Module.html#method-c-new\" rel=\"nofollow noreferrer\"><code>Module#initialize</code></a> which evaluates a given block in the module&#39;s context. The question - as I&#39;ve understood it - however is why you would make use of that in this case, not why does it work."}, {"owner": {"reputation": 16237, "user_id": 2166798, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/417356917295f5176d2a3e7c21d8f9e8?s=128&d=identicon&r=PG", "display_name": "pjs", "link": "https://stackoverflow.com/users/2166798/pjs"}, "reply_to_user": {"reputation": 4127, "user_id": 4231385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d89a541a4609cafea3957e4cdfcca50f?s=128&d=identicon&r=PG&f=1", "display_name": "cremno", "link": "https://stackoverflow.com/users/4231385/cremno"}, "edited": false, "score": 0, "creation_date": 1569345747, "post_id": 58080372, "comment_id": 102564567, "body": "@cremno The problem is there&#39;s not really a &quot;this case&quot; to discuss, since the example doesn&#39;t give any context.  I was trying to point to a specific use case that would justify this approach."}, {"owner": {"reputation": 4127, "user_id": 4231385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d89a541a4609cafea3957e4cdfcca50f?s=128&d=identicon&r=PG&f=1", "display_name": "cremno", "link": "https://stackoverflow.com/users/4231385/cremno"}, "reply_to_user": {"reputation": 16237, "user_id": 2166798, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/417356917295f5176d2a3e7c21d8f9e8?s=128&d=identicon&r=PG", "display_name": "pjs", "link": "https://stackoverflow.com/users/2166798/pjs"}, "edited": false, "score": 1, "creation_date": 1569346001, "post_id": 58080372, "comment_id": 102564681, "body": "@pjs: Agreed. A non-contrived example would be more helpful."}, {"owner": {"reputation": 16237, "user_id": 2166798, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/417356917295f5176d2a3e7c21d8f9e8?s=128&d=identicon&r=PG", "display_name": "pjs", "link": "https://stackoverflow.com/users/2166798/pjs"}, "reply_to_user": {"reputation": 4127, "user_id": 4231385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d89a541a4609cafea3957e4cdfcca50f?s=128&d=identicon&r=PG&f=1", "display_name": "cremno", "link": "https://stackoverflow.com/users/4231385/cremno"}, "edited": false, "score": 0, "creation_date": 1569346095, "post_id": 58080372, "comment_id": 102564716, "body": "@cremno Even a contrived example, if there&#39;s some actual working code."}, {"owner": {"reputation": 16237, "user_id": 2166798, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/417356917295f5176d2a3e7c21d8f9e8?s=128&d=identicon&r=PG", "display_name": "pjs", "link": "https://stackoverflow.com/users/2166798/pjs"}, "edited": false, "score": 0, "creation_date": 1569346325, "post_id": 58080372, "comment_id": 102564802, "body": "@Kris Do you have access to, and can you show, what the inherited module/class <code>initialize</code> method looks like?"}, {"owner": {"reputation": 16672, "user_id": 22237, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/hkobD.png?s=128&g=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/22237/kris"}, "reply_to_user": {"reputation": 4127, "user_id": 4231385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d89a541a4609cafea3957e4cdfcca50f?s=128&d=identicon&r=PG&f=1", "display_name": "cremno", "link": "https://stackoverflow.com/users/4231385/cremno"}, "edited": false, "score": 0, "creation_date": 1569398298, "post_id": 58080372, "comment_id": 102579815, "body": "@cremno by &quot;inheriting from Class&quot; I mean <code>class Foo; end;Foo.class # =&gt; Class</code>"}, {"owner": {"reputation": 16672, "user_id": 22237, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/hkobD.png?s=128&g=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/22237/kris"}, "reply_to_user": {"reputation": 16237, "user_id": 2166798, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/417356917295f5176d2a3e7c21d8f9e8?s=128&d=identicon&r=PG", "display_name": "pjs", "link": "https://stackoverflow.com/users/2166798/pjs"}, "edited": false, "score": 0, "creation_date": 1569398957, "post_id": 58080372, "comment_id": 102580159, "body": "@pjs I&#39;ve added a less contrived example."}, {"owner": {"reputation": 16672, "user_id": 22237, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/hkobD.png?s=128&g=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/22237/kris"}, "edited": false, "score": 0, "creation_date": 1569399416, "post_id": 58080372, "comment_id": 102580394, "body": "Maybe, since a block can be passed to <code>Module#new</code> and it is executed in the context of the module, i.e. <code>Module.new { }</code>, then that is all I am doing here when calling <code>super() { }</code>. It just isn&#39;t need, I am already within this context in the <code>#initialize</code> method, thus calling <code>super()</code> with a block or not, as the same effect in this case."}, {"owner": {"reputation": 48004, "user_id": 216513, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/30a45c64b2ef288f7ec098c5fb353a22?s=128&d=identicon&r=PG", "display_name": "nathanvda", "link": "https://stackoverflow.com/users/216513/nathanvda"}, "edited": false, "score": 0, "creation_date": 1569399584, "post_id": 58080372, "comment_id": 102580482, "body": "Why would you create a class that inherits from <code>Module</code> and not just define a <code>Module</code> straightaway? #confused Is there a specific pattern/code-sample you are inspired by?"}, {"owner": {"reputation": 16672, "user_id": 22237, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/hkobD.png?s=128&g=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/22237/kris"}, "reply_to_user": {"reputation": 48004, "user_id": 216513, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/30a45c64b2ef288f7ec098c5fb353a22?s=128&d=identicon&r=PG", "display_name": "nathanvda", "link": "https://stackoverflow.com/users/216513/nathanvda"}, "edited": false, "score": 1, "creation_date": 1569399940, "post_id": 58080372, "comment_id": 102580678, "body": "@nathanvda Because you can pass parameters (state) in to the module and use that to dynamically create methods based on those parameters. It is a rare technique and there are other options like defining class methods (aka macros) which when called will then define new methods on the target class, e.g. <code>has_many</code> in Rails. Here is an article on the technique: <a href=\"https://solnic.codes/2012/08/13/subclassing-module-for-fun-and-profit/\" rel=\"nofollow noreferrer\">solnic.codes/2012/08/13/subclassing-module-for-fun-and-profi&zwnj;&#8203;t</a>"}, {"owner": {"reputation": 48004, "user_id": 216513, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/30a45c64b2ef288f7ec098c5fb353a22?s=128&d=identicon&r=PG", "display_name": "nathanvda", "link": "https://stackoverflow.com/users/216513/nathanvda"}, "edited": false, "score": 1, "creation_date": 1569401751, "post_id": 58080372, "comment_id": 102581699, "body": "Insert <i>mind blown</i> gif :) :) Very interesting technique, and learned something new today :clap: :clap:"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 1, "creation_date": 1569462407, "post_id": 58080372, "comment_id": 102607274, "body": "Kris, I was going to ask you for a link to where you saw that construct, but I see you have in your last comment. Thanks. It was an interesting read. You might consider editing your question to provide more context for the potential use of subclasses of <code>Module</code>."}], "owner": {"reputation": 16672, "user_id": 22237, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/hkobD.png?s=128&g=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/22237/kris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 82, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1569398899, "creation_date": 1569328165, "last_edit_date": 1569398899, "question_id": 58080372, "link": "https://stackoverflow.com/questions/58080372/why-would-you-call-super-with-a-block-in-the-initialize-method-of-a-class-inhe", "title": "Why would you call `super` with a block in the initialize method of a class inherting from Module in Ruby?", "body": "<p>When inheriting from <code>Module</code> you can pass a block to <code>super()</code> and it is executed:</p>\n\n<pre><code>class Foo &lt; Module\n  def initialize\n    super() do\n      # do some other stuff...\n    end\n  end\nend\n</code></pre>\n\n<p>Why would you use this over just calling <code>super()</code>, without the block, followed by the rest of the code, such as:</p>\n\n<pre><code>class Foo &lt; Module\n  def initialize\n    super()\n    # do some other stuff...\n  end\nend\n</code></pre>\n\n<p>An less contrived example would be:</p>\n\n<pre><code>class QuestionAttr &lt; Module\n  def initialize(method_name)\n    super() do\n      define_method \"#{method_name}?\" do\n        !!public_send(method_name)\n      end\n    end\n  end\nend\n\nFruit = Struct.new(:colour) do\n  include QuestionAttr.new(:colour)\nend\n\nfruit = Fruit.new('red')\nfruit.colour? # =&gt; true\n</code></pre>\n\n<p>Why would I <code>define_method</code> inside the block passed to <code>super()</code>, as per the above example, instead of omitting the block passed to <code>super()</code> and <code>define_method</code> afterwards.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "devise", "ruby-on-rails-5"], "comments": [{"owner": {"reputation": 23594, "user_id": 336626, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/608b32640d0fca097b40bc6a28cadc5f?s=128&d=identicon&r=PG", "display_name": "Vasiliy Ermolovich", "link": "https://stackoverflow.com/users/336626/vasiliy-ermolovich"}, "edited": false, "score": 1, "creation_date": 1569331535, "post_id": 58080168, "comment_id": 102557031, "body": "Have you restarted the server after you added <code>CustomFailureApp</code>?"}, {"owner": {"reputation": 1958, "user_id": 1858727, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/3affc24909ae07768e44d1cc97d439bd?s=128&d=identicon&r=PG", "display_name": "opensource-developer", "link": "https://stackoverflow.com/users/1858727/opensource-developer"}, "reply_to_user": {"reputation": 23594, "user_id": 336626, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/608b32640d0fca097b40bc6a28cadc5f?s=128&d=identicon&r=PG", "display_name": "Vasiliy Ermolovich", "link": "https://stackoverflow.com/users/336626/vasiliy-ermolovich"}, "edited": false, "score": 0, "creation_date": 1569332315, "post_id": 58080168, "comment_id": 102557548, "body": "yes, have followed the instructions as specifed in the article"}, {"owner": {"reputation": 6039, "user_id": 2137458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cfca832ee746f3e3d9971148f52dc64?s=128&d=identicon&r=PG", "display_name": "NM Pennypacker", "link": "https://stackoverflow.com/users/2137458/nm-pennypacker"}, "edited": false, "score": 0, "creation_date": 1569333835, "post_id": 58080168, "comment_id": 102558437, "body": "Have you tried replacing <code>custom_logging</code> with <code>puts &quot;CUSTOM LOGGING TRIGGERED&quot;</code> and verifying that it shows up in your server logs? This will make sure that your class is being loaded and that the <code>route</code> method is being called"}, {"owner": {"reputation": 1958, "user_id": 1858727, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/3affc24909ae07768e44d1cc97d439bd?s=128&d=identicon&r=PG", "display_name": "opensource-developer", "link": "https://stackoverflow.com/users/1858727/opensource-developer"}, "reply_to_user": {"reputation": 6039, "user_id": 2137458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cfca832ee746f3e3d9971148f52dc64?s=128&d=identicon&r=PG", "display_name": "NM Pennypacker", "link": "https://stackoverflow.com/users/2137458/nm-pennypacker"}, "edited": false, "score": 0, "creation_date": 1569334694, "post_id": 58080168, "comment_id": 102558929, "body": "hi @NMPennypacker, yes i have tried that as well, but commenting the <code>custom_logging</code> method call and replace it with <code>Rails.logger.error</code> statements, but i do not see it in the logs, I am also using <code>turbolinks</code> not sure if thats helpfull. But yes, i have tried logging too"}, {"owner": {"reputation": 6039, "user_id": 2137458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cfca832ee746f3e3d9971148f52dc64?s=128&d=identicon&r=PG", "display_name": "NM Pennypacker", "link": "https://stackoverflow.com/users/2137458/nm-pennypacker"}, "edited": false, "score": 0, "creation_date": 1569335958, "post_id": 58080168, "comment_id": 102559628, "body": "Try it with <code>puts</code> and check the server logs"}, {"owner": {"reputation": 1958, "user_id": 1858727, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/3affc24909ae07768e44d1cc97d439bd?s=128&d=identicon&r=PG", "display_name": "opensource-developer", "link": "https://stackoverflow.com/users/1858727/opensource-developer"}, "reply_to_user": {"reputation": 6039, "user_id": 2137458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cfca832ee746f3e3d9971148f52dc64?s=128&d=identicon&r=PG", "display_name": "NM Pennypacker", "link": "https://stackoverflow.com/users/2137458/nm-pennypacker"}, "edited": false, "score": 0, "creation_date": 1569337688, "post_id": 58080168, "comment_id": 102560641, "body": "@NMPennypacker, tried it did not print anything"}, {"owner": {"reputation": 6039, "user_id": 2137458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cfca832ee746f3e3d9971148f52dc64?s=128&d=identicon&r=PG", "display_name": "NM Pennypacker", "link": "https://stackoverflow.com/users/2137458/nm-pennypacker"}, "edited": false, "score": 0, "creation_date": 1569338718, "post_id": 58080168, "comment_id": 102561207, "body": "Well there you go. Your code isn&#39;t being called for some reason"}], "owner": {"reputation": 1958, "user_id": 1858727, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/3affc24909ae07768e44d1cc97d439bd?s=128&d=identicon&r=PG", "display_name": "opensource-developer", "link": "https://stackoverflow.com/users/1858727/opensource-developer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 222, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1569327462, "creation_date": 1569327462, "question_id": 58080168, "link": "https://stackoverflow.com/questions/58080168/devise-warden-failure-app-not-redirecting-to-custom-path", "title": "Devise &amp; warden failure_app not redirecting to custom path", "body": "<p>I am trying to do some monitoring when user enters invalid login credentials and trying to use the <code>warder.failure_app</code> to do this as specified here <a href=\"https://github.com/plataformatec/devise/wiki/Redirect-to-new-registration-(sign-up)-path-if-unauthenticated\" rel=\"nofollow noreferrer\">https://github.com/plataformatec/devise/wiki/Redirect-to-new-registration-(sign-up)-path-if-unauthenticated</a>.</p>\n\n<p>However, the control never seems to come in my <code>CustomFailureApp</code> as i dont see the user redirected to the sign up page</p>\n\n<p>below is the code i am using</p>\n\n<pre><code>lib/custom_failure_app.rb\nclass CustomFailureApp &lt; Devise::FailureApp\n  protected\n  def route(scope)\n    custom_logging\n    :new_user_registration_url\n  end\nend\n</code></pre>\n\n<pre><code>application.rb\nconfig.autoload_paths &lt;&lt; Rails.root.join('lib')\n</code></pre>\n\n<pre><code>devise.rb\n\n  config.warden do |manager|\n    manager.failure_app = CustomFailureApp\n  end\n\n</code></pre>\n\n<p>Any help in this would be great, how do i ensure that my CustomFailureApp is called and user is redirected to the registration page.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "cancan", "cancancan"], "comments": [{"owner": {"reputation": 5385, "user_id": 936494, "user_type": "registered", "accept_rate": 34, "profile_image": "https://i.stack.imgur.com/TCqih.jpg?s=128&g=1", "display_name": "Jignesh Gohel", "link": "https://stackoverflow.com/users/936494/jignesh-gohel"}, "edited": false, "score": 0, "creation_date": 1569331279, "post_id": 58079680, "comment_id": 102556864, "body": "If it is possible I would suggest to switch to <a href=\"https://github.com/varvet/pundit\" rel=\"nofollow noreferrer\">github.com/varvet/pundit</a>. I have found it to be simple and more flexible compared to other authorization gems in Rails app I have worked on. Thanks."}, {"owner": {"reputation": 16587, "user_id": 177053, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f6c516626d381a1ea383cedd1799486?s=128&d=identicon&r=PG", "display_name": "Vasfed", "link": "https://stackoverflow.com/users/177053/vasfed"}, "edited": false, "score": 0, "creation_date": 1569337880, "post_id": 58079680, "comment_id": 102560744, "body": "Please post relevant parts of your <code>ability.rb</code> and exact error that you&#39;re getting. Also fix typos, because it&#39;s most likely <code>authorize!</code> and <code>Post.find(1)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 311, "user_id": 7105526, "user_type": "registered", "profile_image": "https://graph.facebook.com/1812496678973073/picture?type=large", "display_name": "B&#249;i Nh\u1eadt Duy", "link": "https://stackoverflow.com/users/7105526/b%c3%b9i-nh%e1%ba%adt-duy"}, "is_accepted": false, "score": 0, "last_activity_date": 1569375375, "creation_date": 1569375375, "answer_id": 58090034, "question_id": 58079680, "link": "https://stackoverflow.com/questions/58079680/rails-gem-cancancan-different-can-and-authorize/58090034#58090034", "title": "Rails gem cancancan different can? and authorize", "body": "<p>According the docs of this gem <a href=\"https://github.com/CanCanCommunity/cancancan\" rel=\"nofollow noreferrer\">enter link description here</a>, <code>can</code> to express the ability of <code>current_user</code>. This means <code>current_user</code> <code>can</code> do action, but when perform the action, if <code>current_user</code> can't perform the action then authorize will raise an exception.</p>\n"}], "owner": {"reputation": 412, "user_id": 4340066, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/c95cbbc65958d466aae2a234e8266a37?s=128&d=identicon&r=PG&f=1", "display_name": "bav ko ten", "link": "https://stackoverflow.com/users/4340066/bav-ko-ten"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 105, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1569375375, "creation_date": 1569325759, "question_id": 58079680, "link": "https://stackoverflow.com/questions/58079680/rails-gem-cancancan-different-can-and-authorize", "title": "Rails gem cancancan different can? and authorize", "body": "<p>I use cancancan to authorization in my App.\nIn my console, i code:</p>\n\n<pre><code>user = User.find(1)\ncurrent_ability = Ability.new(user)\n# i check can? with model Post\ncurrent_ability.can?(:manage, Post)\n# =&gt; true\n#but when authorize with rescue error\ncurrent_ability.authorize(:manage, Post.where(1) )\n\n</code></pre>\n\n<p>I don't understand, why i <code>can</code> but i don't <code>authorize</code> .\nPlease guide me.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-5", "paperclip", "paperclip-validation"], "comments": [{"owner": {"reputation": 48413, "user_id": 1279683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1veuT.jpg?s=128&g=1", "display_name": "Marek Lipka", "link": "https://stackoverflow.com/users/1279683/marek-lipka"}, "edited": false, "score": 0, "creation_date": 1569319169, "post_id": 58077639, "comment_id": 102550002, "body": "Check if photo if valid. Build your <code>Photo</code> record with <code>photo = new_answer.photos.build(image: URI.parse(&#39;www.abc.com&#47;&#39; + e))</code> and then check <code>photo.valid?</code> and <code>photo.errors</code>."}, {"owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 0, "creation_date": 1569319171, "post_id": 58077639, "comment_id": 102550003, "body": "Is there an error message next to the rollback? How do the log entries look like for that request?"}, {"owner": {"reputation": 143, "user_id": 2351980, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/HLah7.jpg?s=128&g=1", "display_name": "O\u011fuz &#199;i&#231;ek", "link": "https://stackoverflow.com/users/2351980/o%c4%9fuz-%c3%87i%c3%a7ek"}, "edited": false, "score": 0, "creation_date": 1569321310, "post_id": 58077639, "comment_id": 102551186, "body": "I don&#39;t have validations : <code>do_not_validate_attachment_file_type :image</code> . I only get :    <code>(0.3ms)  ROLLBACK   \u21b3 app&#47;controllers&#47;home_controller.rb:418 </code>"}, {"owner": {"reputation": 4047, "user_id": 3775217, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/G0bqn.jpg?s=128&g=1", "display_name": "user3775217", "link": "https://stackoverflow.com/users/3775217/user3775217"}, "edited": false, "score": 0, "creation_date": 1569321606, "post_id": 58077639, "comment_id": 102551350, "body": "change your code to <code>new_answer.photos.create!(image: URI.parse(&#39;www.abc.com&#47;&#39;+e))</code> and look for photo.errors and paste them in post"}], "answers": [{"tags": [], "owner": {"reputation": 48004, "user_id": 216513, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/30a45c64b2ef288f7ec098c5fb353a22?s=128&d=identicon&r=PG", "display_name": "nathanvda", "link": "https://stackoverflow.com/users/216513/nathanvda"}, "is_accepted": false, "score": 0, "last_activity_date": 1569345454, "creation_date": 1569345454, "answer_id": 58085307, "question_id": 58077639, "link": "https://stackoverflow.com/questions/58077639/rails-paperclip-rollback-due-to-associations/58085307#58085307", "title": "Rails - Paperclip ROLLBACK due to associations", "body": "<p>Since rails 5 the <code>belongs_to</code> associations are by default required. </p>\n\n<p>There are two possible solutions, either write </p>\n\n<pre><code>belongs_to :question, optional: true \n</code></pre>\n\n<p>in your <code>Photo</code> model, or, as you are saving them through the nested association (a bit like a nested-form), you have to clearly indicate which association is the inverse of which. </p>\n\n<p>So in your answer class, specify the inverse of the <code>:photos</code> association</p>\n\n<pre><code> has_many :photos, inverse_of: :answer \n</code></pre>\n\n<p>(to allow rails to correctly check that the belongs_to is set correctly)</p>\n"}], "owner": {"reputation": 143, "user_id": 2351980, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/HLah7.jpg?s=128&g=1", "display_name": "O\u011fuz &#199;i&#231;ek", "link": "https://stackoverflow.com/users/2351980/o%c4%9fuz-%c3%87i%c3%a7ek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 55, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1569345454, "creation_date": 1569318849, "question_id": 58077639, "link": "https://stackoverflow.com/questions/58077639/rails-paperclip-rollback-due-to-associations", "title": "Rails - Paperclip ROLLBACK due to associations", "body": "<p>I have 3 <code>models</code>. The <code>question</code>, <code>answer</code> and <code>photo</code>. I am using <code>paperclip</code> to <code>save</code> images. <code>Questions</code> and <code>answers</code> can have <code>multiple images</code>.</p>\n\n<p>However, I get <code>ROLLBACK</code> when saving images for <code>answer</code> model. I don't get <code>ROLLBACK</code> when saving images for <code>question</code> model. I think I have a problem with <code>model associations</code>.</p>\n\n<pre><code>#photo model\nclass Photo &lt; ApplicationRecord\n  belongs_to :question \n  belongs_to :answer\n\n  has_attached_file :image :path =&gt; \":rails_root/public/img/:filename\", validate_media_type: false\n  do_not_validate_attachment_file_type :image\nend\n\n#answer model\nclass Answer &lt; ApplicationRecord\n belongs_to :question\n has_many :photos\nend\n\n#question model\nclass Question &lt; ApplicationRecord  \n  has_many :answers\n  has_many :photos\nend\n</code></pre>\n\n<p>My Controller : </p>\n\n<pre><code>p.answers.each do |a|\n  new_answer = q.answers.create(body: a[:body])\n  if a[:images]\n    a[:images].each do |e|\n      new_answer.photos.create(image: URI.parse('www.abc.com/'+e))\n    end\n  end\nend\n</code></pre>\n\n<p>Any thoughts?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "attr-encrypted"], "answers": [{"comments": [{"owner": {"reputation": 351, "user_id": 2009652, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ab04284dee660708ce5c727fdf1f6958?s=128&d=identicon&r=PG", "display_name": "calyxofheld", "link": "https://stackoverflow.com/users/2009652/calyxofheld"}, "edited": false, "score": 0, "creation_date": 1569293298, "post_id": 58072255, "comment_id": 102540176, "body": "is there any benefit to storing the key on the model? it seems like it would be a security vulnerability. i&#39;m at a loss for why the docs suggest it."}, {"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "reply_to_user": {"reputation": 351, "user_id": 2009652, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ab04284dee660708ce5c727fdf1f6958?s=128&d=identicon&r=PG", "display_name": "calyxofheld", "link": "https://stackoverflow.com/users/2009652/calyxofheld"}, "edited": false, "score": 1, "creation_date": 1569298601, "post_id": 58072255, "comment_id": 102541124, "body": "If you are wondering about the examples hey do not <i>suggest</i> it; they are showing it as an option (e.g. if you want to allow your users to set the key for all encryption related to their data). Similarly, the rest of the examples are not recommendations, but merely explanations of the syntax \u2014 you can replace a literal with an environment variable."}], "tags": [], "owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "is_accepted": true, "score": 1, "last_activity_date": 1569291962, "creation_date": 1569291962, "answer_id": 58072255, "question_id": 58072109, "link": "https://stackoverflow.com/questions/58072109/securerandom-hex-vs-securerandom-random-bytes-for-key-generation-in-rails-wi/58072255#58072255", "title": "SecureRandom.hex() vs SecureRandom.random_bytes() for key generation in Rails with attr_encrypted", "body": "<p><code>SecureRandom#hex</code> is defined <a href=\"https://github.com/ruby/ruby/blob/5bab1304af25a843728dbcd2f3594913740aecb0/lib/securerandom.rb#L175\" rel=\"nofollow noreferrer\">here</a> as:</p>\n\n<pre><code>def hex(n=nil)\n  random_bytes(n).unpack(\"H*\")[0]\nend\n</code></pre>\n\n<p>so the data generated by them is exactly the same, just the format differs.</p>\n\n<p>As for encryption keys, it's up to you and the way you host your app. If it's on a server you control, an uncommitted config file is fine (though environment variable approach still works, obviously). If you are hosting on e.g. Heroku, an environment variable is the way to go.</p>\n"}], "owner": {"reputation": 351, "user_id": 2009652, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ab04284dee660708ce5c727fdf1f6958?s=128&d=identicon&r=PG", "display_name": "calyxofheld", "link": "https://stackoverflow.com/users/2009652/calyxofheld"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 227, "favorite_count": 1, "accepted_answer_id": 58072255, "answer_count": 1, "score": 0, "last_activity_date": 1569291962, "creation_date": 1569290492, "question_id": 58072109, "link": "https://stackoverflow.com/questions/58072109/securerandom-hex-vs-securerandom-random-bytes-for-key-generation-in-rails-wi", "title": "SecureRandom.hex() vs SecureRandom.random_bytes() for key generation in Rails with attr_encrypted", "body": "<p>The <a href=\"https://github.com/attr-encrypted/attr_encrypted\" rel=\"nofollow noreferrer\">docs</a> for <code>attr_encrypted</code> say that I must store the results of <code>key = SecureRandom.random_bytes(32)</code> on the model. I think that it would be more secure to have this key stored as an ENV variable. I am also accustomed to running <code>rake secret</code> for my ENV variables. <code>rake secret</code> relies on <code>SecureRandom.hex()</code>.</p>\n\n<p>I'm wondering two things:</p>\n\n<ol>\n<li>Am I right to assume that the encryption key should be stored as an ENV variable?</li>\n<li>Is there any difference in key encryption strength between either of the two SecureRandom methods? <code>hex()</code> vs <code>random_bytes()</code>?</li>\n</ol>\n"}, {"tags": ["ruby-on-rails", "ruby", "sqlite", "docker"], "answers": [{"comments": [{"owner": {"reputation": 236, "user_id": 4469154, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9hbfI.jpg?s=128&g=1", "display_name": "Reverse Engineered", "link": "https://stackoverflow.com/users/4469154/reverse-engineered"}, "edited": false, "score": 0, "creation_date": 1569374727, "post_id": 58072027, "comment_id": 102572968, "body": "Brilliant. Worked!"}], "tags": [], "owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "is_accepted": true, "score": 2, "last_activity_date": 1569289635, "creation_date": 1569289635, "answer_id": 58072027, "question_id": 58071977, "link": "https://stackoverflow.com/questions/58071977/error-loading-shared-library-libsqlite3-so-0-in-docker-container/58072027#58072027", "title": "Error loading shared library libsqlite3.so.0 in Docker container", "body": "<p>Dynamic libraries or shared objects (files ending in <code>.so</code>) need to be present on the system in order to run the program.  Your long <code>RUN</code> command is installing <code>sqlite-libs</code> and using it during the <code>bundle install</code> phase, but then deleting it again; the <code>sqlite</code> gem needs the dynamic library to still be installed.</p>\n\n<p>I'd install this in a separate <code>RUN</code> command.  Since the development package is likely to depend on the runtime library, I'd install it first to reduce churn and download time (marginally).</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>RUN apk add --no-cache sqlite-libs\nRUN apk add --no-cache --virtual=.build-deps \\\n  git openssh-client build-base mariadb-dev sqlite-dev \\\n  ... \\\n  &amp;&amp; apk del .build-deps\n</code></pre>\n"}], "owner": {"reputation": 236, "user_id": 4469154, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9hbfI.jpg?s=128&g=1", "display_name": "Reverse Engineered", "link": "https://stackoverflow.com/users/4469154/reverse-engineered"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1029, "favorite_count": 0, "accepted_answer_id": 58072027, "answer_count": 1, "score": 1, "last_activity_date": 1569290605, "creation_date": 1569288981, "last_edit_date": 1569290605, "question_id": 58071977, "link": "https://stackoverflow.com/questions/58071977/error-loading-shared-library-libsqlite3-so-0-in-docker-container", "title": "Error loading shared library libsqlite3.so.0 in Docker container", "body": "<p>I'm getting the following stack trace when I try to build a Rails application in a Docker container from Alpine Ruby 2.6.3.</p>\n\n<p>I've tried installing <code>sqlite</code>, <code>sqlite-dev</code>, and <code>sqlite-libs</code>, since there is no <code>apk</code> package for \"libsqlite3\".</p>\n\n<p>Am I going about this the wrong way?</p>\n\n<pre><code>LoadError: Error loading shared library libsqlite3.so.0: No such file or directory (needed by /usr/local/bundle/gems/sqlite3-1.3.13/lib/sqlite3/sqlite3_native.so) - /usr/local/bundle/gems/sqlite3-1.3.13/lib/sqlite3/sqlite3_native.so\n/usr/local/bundle/gems/activesupport-5.0.7/lib/active_support/dependencies.rb:293:in `require'\n/usr/local/bundle/gems/activesupport-5.0.7/lib/active_support/dependencies.rb:293:in `block in require'\n/usr/local/bundle/gems/activesupport-5.0.7/lib/active_support/dependencies.rb:259:in `load_dependency'\n/usr/local/bundle/gems/activesupport-5.0.7/lib/active_support/dependencies.rb:293:in `require'\n/usr/local/bundle/gems/sqlite3-1.3.13/lib/sqlite3.rb:6:in `rescue in &lt;top (required)&gt;'\n/usr/local/bundle/gems/sqlite3-1.3.13/lib/sqlite3.rb:2:in `&lt;top (required)&gt;'\n/app/config/application.rb:7:in `&lt;top (required)&gt;'\n</code></pre>\n\n<p>And here is my Dockerfile:</p>\n\n<pre><code>FROM ruby:2.6.4-alpine3.9\n\nWORKDIR /app\n\nENV RAILS_ENV=production\nENV RAILS_SERVE_STATIC_FILES=true\n\nEXPOSE 3000\n\n\n####\n# Setup ruby environment\n####\n\nCOPY ./admin/Gemfile* ./admin/*.gemspec ./admin/\nCOPY ./admin/lib/admin/version.rb ./admin/lib/admin/\n\nRUN apk add --no-cache --virtual=.build-deps \\\n  git openssh-client build-base mariadb-dev sqlite-libs sqlite-dev sqlite \\\n#Installing bundler without versioning could break things.\n  &amp;&amp; gem install bundler --pre \\\n  &amp;&amp; bundle install --without=development,test \\\n  &amp;&amp; bundle config \\\n  &amp;&amp; apk del .build-deps\n\nCOPY . ./\n\nRUN bundle config &amp;&amp; bundle \\\n  &amp;&amp; rm -f config/database.yml \\\n  &amp;&amp; DATABASE_URL=sqlite3:/tmp/assets_dummy.sqlite3 bundle exec rake assets:precompile\n\nCOPY entrypoint /usr/local/bin/entrypoint\n</code></pre>\n"}, {"tags": ["ruby", "csv", "jekyll", "generator", "data-files"], "comments": [{"owner": {"reputation": 46692, "user_id": 1548376, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qCZQw.gif?s=128&g=1", "display_name": "David Jacquel", "link": "https://stackoverflow.com/users/1548376/david-jacquel"}, "edited": false, "score": 0, "creation_date": 1569306084, "post_id": 58071231, "comment_id": 102543349, "body": "A Content Management System CMS it not so hard to install and configure. This will be less error prone that manipulating a CSV file with nearly no constrains. See <a href=\"https://duckduckgo.com/html/?q=static%20site%20generator%20cms\" rel=\"nofollow noreferrer\">duckduckgo.com/html/?q=static%20site%20generator%20cms</a>"}, {"owner": {"reputation": 35, "user_id": 9766125, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-4sVOMt54at0/AAAAAAAAAAI/AAAAAAAAADo/8xSpQKOrDGk/photo.jpg?sz=128", "display_name": "Dug Falby", "link": "https://stackoverflow.com/users/9766125/dug-falby"}, "reply_to_user": {"reputation": 46692, "user_id": 1548376, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qCZQw.gif?s=128&g=1", "display_name": "David Jacquel", "link": "https://stackoverflow.com/users/1548376/david-jacquel"}, "edited": false, "score": 0, "creation_date": 1569309061, "post_id": 58071231, "comment_id": 102544657, "body": "I have a CMS thanks. In this instance I&#39;m using Jekyll on another project and I&#39;m very happy with it. My problem is that I&#39;m not a Ruby programmer and the docs for generators are very limited."}], "owner": {"reputation": 35, "user_id": 9766125, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-4sVOMt54at0/AAAAAAAAAAI/AAAAAAAAADo/8xSpQKOrDGk/photo.jpg?sz=128", "display_name": "Dug Falby", "link": "https://stackoverflow.com/users/9766125/dug-falby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1569280677, "creation_date": 1569280677, "question_id": 58071231, "link": "https://stackoverflow.com/questions/58071231/looking-for-a-jekyll-generator-to-create-blog-pages-from-the-rows-of-a-csv-file", "title": "Looking for a Jekyll generator to create blog pages from the rows of a csv file in _data folder", "body": "<p>The title says it all.</p>\n\n<p>The 'why would you want to do that\" is simple. My team all edit a shared csv file and I use it as input for my dashboard. It's crude but it works and more importantly it respects the way people work. Nobody has to learn new software etc.</p>\n\n<p>I currently display the data I need on static pages but increasingly, I'm thinking the dataset I'm using would map really nicely to to a blog structure.</p>\n\n<p>Thanks:-)</p>\n"}, {"tags": ["ruby", "factory-bot"], "answers": [{"tags": [], "owner": {"reputation": 2628, "user_id": 868533, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/06Sjl.jpg?s=128&g=1", "display_name": "supersam654", "link": "https://stackoverflow.com/users/868533/supersam654"}, "is_accepted": true, "score": 1, "last_activity_date": 1569286065, "creation_date": 1569286065, "answer_id": 58071714, "question_id": 58070628, "link": "https://stackoverflow.com/questions/58070628/create-a-factory-field-value-based-on-a-number-set-in-another-field-in-the-same/58071714#58071714", "title": "Create a factory field value based on a number set in another field in the same factory", "body": "<p>You can make that work with an <a href=\"https://github.com/thoughtbot/factory_bot/blob/master/GETTING_STARTED.md#callbacks\" rel=\"nofollow noreferrer\"><code>after(:build)</code> callback</a> which will let you do things to the generated object after it is created but before it's returned. Depending on how your class actually works, you may not want to store <code>option_id</code> directly on the class. In that case, <a href=\"https://github.com/thoughtbot/factory_bot/blob/master/GETTING_STARTED.md#transient-attributes\" rel=\"nofollow noreferrer\">you can use the <code>values</code> object</a> in the block to read the original value passed into the factory.</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>require 'factory_bot'\nrequire 'ostruct'\n\nFactoryBot.define do\n  factory :test, class: OpenStruct do\n    sequence(:option_id, (1..3).cycle) { |n| n }\n\n    after(:build) do |o, values|\n      o.data_value = case values.option_id\n                     when 1\n                       Time.now\n                     when 2\n                       5\n                     when 3\n                       'hello world'\n                     end\n    end\n  end \nend\n\nputs(FactoryBot.build(:test))\nputs(FactoryBot.build(:test))\nputs(FactoryBot.build(:test))\n</code></pre>\n\n<p>Those last three lines will output something like:</p>\n\n<pre><code>#&lt;OpenStruct option_id=1, data_value=2019-09-24 00:44:01 +0000&gt;\n#&lt;OpenStruct option_id=2, data_value=5&gt;\n#&lt;OpenStruct option_id=3, data_value=\"hello world\"&gt;\n</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 11825400, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-72RXxMJH4fY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rexe_nEcIlVktR0iOFd4A2AqDMMqQ/photo.jpg?sz=128", "display_name": "NewUser123", "link": "https://stackoverflow.com/users/11825400/newuser123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 58071714, "answer_count": 1, "score": 2, "last_activity_date": 1569286065, "creation_date": 1569275467, "question_id": 58070628, "link": "https://stackoverflow.com/questions/58070628/create-a-factory-field-value-based-on-a-number-set-in-another-field-in-the-same", "title": "Create a factory field value based on a number set in another field in the same factory", "body": "<p>I have a table where the data_value is set based on option_id. Example,</p>\n\n<pre><code> option_id: 1 , data_value: `date value`\n option_id: 2, data_value: number\n option_id: 3, data_value: text\n\n\n  FactoryBot.define do\n       factory  :test do\n           sequence(:option_id, (1..3).cycle) { |n| n }\n           data_value {??} \n        end \n    end\n</code></pre>\n\n<p>How do I make FactoryBot generate data_value based on the option_id?</p>\n"}, {"tags": ["ruby", "rubygems"], "comments": [{"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 2, "creation_date": 1569342204, "post_id": 58070483, "comment_id": 102562998, "body": "Why do you assume the gem was created from a commit?"}, {"owner": {"reputation": 5513, "user_id": 808729, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/67vgi.jpg?s=128&g=1", "display_name": "OpenCoderX", "link": "https://stackoverflow.com/users/808729/opencoderx"}, "reply_to_user": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1569347719, "post_id": 58070483, "comment_id": 102565381, "body": "@J&#246;rgWMittag Excellent point, it may have been created from the current state of the checked out branch."}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 1, "creation_date": 1569357480, "post_id": 58070483, "comment_id": 102569080, "body": "Or without any version control system at all. Sadly, &quot;ZIP files with names like <code>myproject_123_final45_reallyfinal_63_patch.zip</code>&quot; is still by far the most widely-used method of version control, and &quot;no version control at all&quot; is even more popular than that."}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1569386283, "post_id": 58070483, "comment_id": 102575138, "body": "how about post a link to rubygems gem you&#39;re talking about and also the github repo assuming there is one?"}], "answers": [{"comments": [{"owner": {"reputation": 5513, "user_id": 808729, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/67vgi.jpg?s=128&g=1", "display_name": "OpenCoderX", "link": "https://stackoverflow.com/users/808729/opencoderx"}, "edited": false, "score": 0, "creation_date": 1569347828, "post_id": 58072943, "comment_id": 102565423, "body": "The author created the release locally pushed it to rubygems but did not update github, I&#39;m trying to backfill github with release tags."}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "reply_to_user": {"reputation": 5513, "user_id": 808729, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/67vgi.jpg?s=128&g=1", "display_name": "OpenCoderX", "link": "https://stackoverflow.com/users/808729/opencoderx"}, "edited": false, "score": 0, "creation_date": 1569385963, "post_id": 58072943, "comment_id": 102575050, "body": "What does &quot;backfill&quot; even mean? How does someone do development on open source without using git version control? If there is not git repo, how are you going to have any commit history?"}, {"owner": {"reputation": 5513, "user_id": 808729, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/67vgi.jpg?s=128&g=1", "display_name": "OpenCoderX", "link": "https://stackoverflow.com/users/808729/opencoderx"}, "edited": false, "score": 0, "creation_date": 1569394760, "post_id": 58072943, "comment_id": 102578074, "body": "meaning they pushed the release from their local dev machine directly to rubygems then did not update github.com with the same tags. rubygems is not dependent on github.com"}], "tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": false, "score": 0, "last_activity_date": 1569298233, "last_edit_date": 1569298233, "creation_date": 1569297890, "answer_id": 58072943, "question_id": 58070483, "link": "https://stackoverflow.com/questions/58070483/which-commit-was-a-specific-release-on-rubygems-created-from/58072943#58072943", "title": "Which commit was a specific release on rubygems created from?", "body": "<p>Normally there will be a link to the source code on the gem page of <a href=\"https://rubygems.org\" rel=\"nofollow noreferrer\">rubygems.org</a></p>\n\n<p>From there you should be taken to the repo, for example if you visit <a href=\"https://rubygems.org/gems/devise\" rel=\"nofollow noreferrer\">https://rubygems.org/gems/devise</a>  you will see link on the right side of the page that says <code>Source Code</code> which should link to</p>\n\n<p><a href=\"https://github.com/plataformatec/devise/\" rel=\"nofollow noreferrer\">https://github.com/plataformatec/devise/</a></p>\n\n<p>Then you can just click on <code>releases</code> at the top of the repo or go to \n<a href=\"https://github.com/plataformatec/devise/releases\" rel=\"nofollow noreferrer\">https://github.com/plataformatec/devise/releases</a></p>\n\n<p>There you will see the commit the release was built from.</p>\n\n<p>If you just download the .gem file from rubygems.org that will only include the gem code itself and not the git history whatsoever.  If you want the full git history you should clone the repo to your local machine.  To do so, click on the <code>Clone or download</code> button at the top of the repo's home page.  If you copy the url from there, can just go to your terminal and type </p>\n\n<pre><code>git clone &lt;paste repo url here&gt;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "is_accepted": true, "score": 2, "last_activity_date": 1569613858, "last_edit_date": 1569613858, "creation_date": 1569610889, "answer_id": 58140150, "question_id": 58070483, "link": "https://stackoverflow.com/questions/58070483/which-commit-was-a-specific-release-on-rubygems-created-from/58140150#58140150", "title": "Which commit was a specific release on rubygems created from?", "body": "<p>Simple answer: You cannot!</p>\n\n<p>Versions of a gem on Rubygems and commits or tags in Git are two totally different concepts and have nothing in common. </p>\n\n<p>You already discovered that the gem doesn't contain any information about the use of git or a specific commit. And if you think about that it makes sense that gems do not contain information about the version control system that was used:</p>\n\n<ul>\n<li>There is no need to use Rubygems and Git at the same time. Actually, there is no need to use a version control system at all when you build gems.</li>\n<li>And even if the author used a version control system, there are other version control systems \u2013 like SVN or Mercurial for example.</li>\n<li>Even if the author used Git to keep track of their source code changes, they could still create and upload multiple different versions of the gem without doing a single git commit in the meantime.</li>\n<li>And even if the author did a commit for every gem version then \u2013 depending on the configuration of the gem and the git repository \u2013 both systems can include files which exist on one system but not on the other.</li>\n</ul>\n\n<p>That said, the assumption that a specific gem version corresponds with a specific git commit is just wrong.</p>\n"}], "owner": {"reputation": 5513, "user_id": 808729, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/67vgi.jpg?s=128&g=1", "display_name": "OpenCoderX", "link": "https://stackoverflow.com/users/808729/opencoderx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 58140150, "answer_count": 2, "score": 1, "last_activity_date": 1569613858, "creation_date": 1569274449, "last_edit_date": 1569347821, "question_id": 58070483, "link": "https://stackoverflow.com/questions/58070483/which-commit-was-a-specific-release-on-rubygems-created-from", "title": "Which commit was a specific release on rubygems created from?", "body": "<p>I am trying to create a release history, how can I identify which commit a specific version of a gem was created from on rubygems.com? When I extract the *.gem archive it does not include any logging of the commit.</p>\n\n<p>EDIT: The releases were pushed to rubygems without updating the github repo with the relevant tags, I want to backfill github with the appropriate release tags.</p>\n"}, {"tags": ["ruby", "jwe", "jose"], "comments": [{"owner": {"reputation": 11100, "user_id": 2157818, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f122e6b4c044c93222b952d70aaec3ec?s=128&d=identicon&r=PG", "display_name": "Florent Morselli", "link": "https://stackoverflow.com/users/2157818/florent-morselli"}, "edited": false, "score": 0, "creation_date": 1569340321, "post_id": 58070452, "comment_id": 102562044, "body": "The shared key you provided has an invalid length. It should be at least 256 bits. It looks like it is encoded, but I cannot determine the standards. Can you post it in hex?"}, {"owner": {"reputation": 75, "user_id": 3944137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28a1b28df6d8ff7f9b61e5b9b2938e63?s=128&d=identicon&r=PG&f=1", "display_name": "Usman Arshad", "link": "https://stackoverflow.com/users/3944137/usman-arshad"}, "reply_to_user": {"reputation": 11100, "user_id": 2157818, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f122e6b4c044c93222b952d70aaec3ec?s=128&d=identicon&r=PG", "display_name": "Florent Morselli", "link": "https://stackoverflow.com/users/2157818/florent-morselli"}, "edited": false, "score": 0, "creation_date": 1569919423, "post_id": 58070452, "comment_id": 102742206, "body": "@FlorentMorselli I have updated my question and Java implementation that is working in the question. Can you please help on it?"}], "owner": {"reputation": 75, "user_id": 3944137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28a1b28df6d8ff7f9b61e5b9b2938e63?s=128&d=identicon&r=PG&f=1", "display_name": "Usman Arshad", "link": "https://stackoverflow.com/users/3944137/usman-arshad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 232, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1569919190, "creation_date": 1569274258, "last_edit_date": 1569919190, "question_id": 58070452, "link": "https://stackoverflow.com/questions/58070452/ruby-jwe-with-a256gcmkw-algorithm-and-encryption-with-a256gcm", "title": "Ruby JWE with A256GCMKW Algorithm and Encryption with A256GCM", "body": "<p>I have encrypt the Plain text in JWE using alg:\"A256GCMKW\", enc:\"A256GCM\" and channelSecurityContext:\"SHARED_SECRET\". I am using <a href=\"https://github.com/potatosalad/ruby-jose\" rel=\"nofollow noreferrer\">Jose Gem</a> for this. I have generated a payload which I can decrypt but other party unable to decrypt. They are using nimbus-jose for it. There generated payload I can't decrypt.</p>\n\n<p>Can somebody help on this? I need to decrypt following JWE.</p>\n\n<pre><code>ew0KICAiYWxnIiA6ICJBMjU2R0NNS1ciLA0KICAiaXYiIDogIlRNa2hjbkJZU082V2pueGEiLA0KICAidGFnIiA6ICJtelZqQjZ5aE5FVDEwTVYtYlp6U1lnIiwNCiAgImVuYyIgOiAiQTI1NkdDTSIsDQogICJ0eXAiIDogIkpPU0UiLA0KICAia2lkIiA6ICJGREpNUE8zQllLTldUTFFON1JCNDEzRFRQUzhPNlBuZzBYc2pPU3BobTI1MEFxMWtBIiwNCiAgImNoYW5uZWxTZWN1cml0eUNvbnRleHQiIDogIlNIQVJFRF9TRUNSRVQiLA0KICAiaWF0IiA6ICIxNTY5ODM4OTM2Ig0KfQ.pL9EOdzwq65L3OMIPd3x5YBlZgeXXmPbqlBg2ch7w0E.JTS4C7mnDsUKundm.022Xz4k2xUFgKxVwCHdwalJrjSeKPmh8thGrlgG8V664hN8sFiFH1DvvgPt0qExJ8CiUS7UNmb-puIHWzOsd_ariAZqy1VC42MNW6Cv7RM82XbvMzKJhq0L-c_jNhm9eC4LLRuOOmOUzfnu5y7G6lrokykY509xkFCItRUGkMnkztY0jsR_txcNY-2d-dw7c4ODmwvkbncU4uHsqRZFISmJMJZh7mT-ElMscT9qgokAxoBzfIJys6UxEq_FZSId59Ma_JADJa3NlLREJfH_xSh7yapehswscwJ7X9zpm8VZhH2tNhaJPGxWdpsfL6-c168aq-1Hhr3nTnDl-oaDy74WEZrZpf0pNDPg5XNYaiSD0B21_94iDepmctP2ujX2q9VEcYUnxE9AmjeoZpprNOJBtHummQ7NWjpNn9_2SE8NnNSLUK4MQmsUYxArah9sQBun_C11iCJ6y.LEzjjZPLOkTqr50uG3TGDw\n</code></pre>\n\n<p>JWE contains </p>\n\n<pre><code>***** decryptKey Key ***********\n\nshared secret HEX : DD38DD7C428A646408F3FD51622218C9AB0302F2272325C0C911EFEDDCDDB933\n\ndecryptKey: 7870587378667746306E6A38676F54727A533738454B387642327A4F6E5A4758\n\n***** decryptKey Key ***********\n\njwe.getHeaderJsonEncoded(): ew0KICAiYWxnIiA6ICJBMjU2R0NNS1ciLA0KICAiaXYiIDogIlRNa2hjbkJZU082V2pueGEiLA0KICAidGFnIiA6ICJtelZqQjZ5aE5FVDEwTVYtYlp6U1lnIiwNCiAgImVuYyIgOiAiQTI1NkdDTSIsDQogICJ0eXAiIDogIkpPU0UiLA0KICAia2lkIiA6ICJGREpNUE8zQllLTldUTFFON1JCNDEzRFRQUzhPNlBuZzBYc2pPU3BobTI1MEFxMWtBIiwNCiAgImNoYW5uZWxTZWN1cml0eUNvbnRleHQiIDogIlNIQVJFRF9TRUNSRVQiLA0KICAiaWF0IiA6ICIxNTY5ODM4OTM2Ig0KfQ\n\n***** decryptData  ***********\n\ndataSalt IV    : JTS4C7mnDsUKundm\n\ndataSalt IV HEX   : 2534B80BB9A70EC50ABA7766\n\ndata decoded CipherText  HEX : D36D97CF8936C541602B15700877706A526B8D278A3E687CB611AB9601BC57AEB884DF2C162147D43BEF80FB74A84C49F028944BB50D99BFA9B881D6CCEB1DFDAAE2019AB2D550B8D8C356E82BFB44CF365DBBCCCCA261AB42FE73F8CD866F5E0B82CB46E38E98E5337E7BB9CBB1BA96BA24CA4639D3DC6414222D4541A4327933B58D23B11FEDC5C358FB677E770EDCE0E0E6C2F91B9DC538B87B2A4591484A624C25987B993F8494CB1C4FDAA0A24031A01CDF209CACE94C44ABF159488779F4C6BF2400C96B73652D11097C7FF14A1EF26A97A1B30B1CC09ED7F73A66F156611F6B4D85A24F1B159DA6C7CBEBE735EBC6AAFB51E1AF79D39C397EA1A0F2EF858466B6697F4A4D0CF8395CD61A8920F4076D7FF788837A999CB4FDAE8D7DAAF5511C6149F113D0268DEA19A69ACD38906D1EE9A643B3568E9367F7FD9213C3673522D42B83109AC518C40ADA87DB1006E9FF0B5D62089EB2\n\ndata CipherText   : 022Xz4k2xUFgKxVwCHdwalJrjSeKPmh8thGrlgG8V664hN8sFiFH1DvvgPt0qExJ8CiUS7UNmb-puIHWzOsd_ariAZqy1VC42MNW6Cv7RM82XbvMzKJhq0L-c_jNhm9eC4LLRuOOmOUzfnu5y7G6lrokykY509xkFCItRUGkMnkztY0jsR_txcNY-2d-dw7c4ODmwvkbncU4uHsqRZFISmJMJZh7mT-ElMscT9qgokAxoBzfIJys6UxEq_FZSId59Ma_JADJa3NlLREJfH_xSh7yapehswscwJ7X9zpm8VZhH2tNhaJPGxWdpsfL6-c168aq-1Hhr3nTnDl-oaDy74WEZrZpf0pNDPg5XNYaiSD0B21_94iDepmctP2ujX2q9VEcYUnxE9AmjeoZpprNOJBtHummQ7NWjpNn9_2SE8NnNSLUK4MQmsUYxArah9sQBun_C11iCJ6y\n\ndataAuthTag: LEzjjZPLOkTqr50uG3TGDw\n\ndataAuthTag HEX : 2C4CE38D93CB3A44EAAF9D2E1B74C60F\n\nAAD HEX : 6577304B494341695957786E4969413649434A424D6A553252304E4E533163694C41304B494341696158596949446F67496C524E6132686A626B4A5A5530383256327075654745694C41304B494341696447466E4969413649434A74656C5A71516A5A35614535465644457754565974596C703655316C6E4969774E43694167496D5675597949674F694169515449314E6B64445453497344516F6749434A306558416949446F67496B7050553055694C41304B4943416961326C6B4969413649434A475245704E5545387A516C6C4C546C64555446464F4E314A434E44457A52465251557A68504E6C42755A7A4259633270505533426F625449314D4546784D5774424969774E43694167496D4E6F595735755A5778545A574E31636D6C3065554E76626E526C6548516949446F67496C4E4951564A465246395452554E53525651694C41304B494341696157463049694136494349784E5459354F444D344F544D324967304B6651\n\n\n\n***** decryptData ***********\n\ndecrypted: {\"accountNumber\":\"1234567812345678\",\"provider\":{\"clientAppID\":\"com-latuabancaperandroid\",\"clientDeviceID\":\"MTcwNTMxMDEwNzAwMzQ0OTA0\",\"clientWalletProvider\":\"40010043095\",\"clientWalletAccountID\":\"eCdcnZmATraNmO6ToS2hzg\",\"isIDnV\":\"false\",\"Intent\":\"PUSH_PROV_MOBILE\"},\"billingAddress\":{\"country\":\"IT\"},\"expirationDate\":{\"month\":\"10\",\"year\":\"2022\"}}\n</code></pre>\n\n<p>The shared_secret Key is \n<code>5foz3ZBrufi2JzmKgoLO6Av7pu4btFGY5iE@uFm0</code></p>\n\n<p>In Java we can decrypt it using Nimbus JOSE+JWT library. Its code is following</p>\n\n<pre><code>import com.nimbusds.jose.*;\nimport com.nimbusds.jose.crypto.AESDecrypter;\nimport com.nimbusds.jose.crypto.DirectDecrypter;\nimport com.nimbusds.jose.crypto.RSADecrypter;\nimport com.nimbusds.jose.crypto.RSAEncrypter;\n\nimport javax.crypto.KeyGenerator;\nimport javax.crypto.SecretKey;\nimport java.io.UnsupportedEncodingException;\nimport java.security.KeyPair;\nimport java.security.KeyPairGenerator;\nimport java.security.MessageDigest;\nimport java.security.NoSuchAlgorithmException;\n\nimport java.text.ParseException;\n\npublic class TestNimbus {\n    public static void main(String[] args) throws NoSuchAlgorithmException, JOSEException, ParseException, UnsupportedEncodingException {\n\n        String sharedSecret = \"5foz3ZBrufi2JzmKgoLO6Av7pu4btFGY5iE@uFm0\";\n        MessageDigest md = MessageDigest.getInstance(\"SHA-256\");\n        byte[] digest = md.digest(sharedSecret.getBytes(\"UTF-8\"));\n\n        String json = \"\";\n\n\n        JWEObject jwe = JWEObject.parse(\"ew0KICAiYWxnIiA6ICJBMjU2R0NNS1ciLA0KICAiaXYiIDogIlRNa2hjbkJZU082V2pueGEiLA0KICAidGFnIiA6ICJtelZqQjZ5aE5FVDEwTVYtYlp6U1lnIiwNCiAgImVuYyIgOiAiQTI1NkdDTSIsDQogICJ0eXAiIDogIkpPU0UiLA0KICAia2lkIiA6ICJGREpNUE8zQllLTldUTFFON1JCNDEzRFRQUzhPNlBuZzBYc2pPU3BobTI1MEFxMWtBIiwNCiAgImNoYW5uZWxTZWN1cml0eUNvbnRleHQiIDogIlNIQVJFRF9TRUNSRVQiLA0KICAiaWF0IiA6ICIxNTY5ODM4OTM2Ig0KfQ.pL9EOdzwq65L3OMIPd3x5YBlZgeXXmPbqlBg2ch7w0E.JTS4C7mnDsUKundm.022Xz4k2xUFgKxVwCHdwalJrjSeKPmh8thGrlgG8V664hN8sFiFH1DvvgPt0qExJ8CiUS7UNmb-puIHWzOsd_ariAZqy1VC42MNW6Cv7RM82XbvMzKJhq0L-c_jNhm9eC4LLRuOOmOUzfnu5y7G6lrokykY509xkFCItRUGkMnkztY0jsR_txcNY-2d-dw7c4ODmwvkbncU4uHsqRZFISmJMJZh7mT-ElMscT9qgokAxoBzfIJys6UxEq_FZSId59Ma_JADJa3NlLREJfH_xSh7yapehswscwJ7X9zpm8VZhH2tNhaJPGxWdpsfL6-c168aq-1Hhr3nTnDl-oaDy74WEZrZpf0pNDPg5XNYaiSD0B21_94iDepmctP2ujX2q9VEcYUnxE9AmjeoZpprNOJBtHummQ7NWjpNn9_2SE8NnNSLUK4MQmsUYxArah9sQBun_C11iCJ6y.LEzjjZPLOkTqr50uG3TGDw\");\n        jwe.decrypt(new AESDecrypter(digest));\n        System.out.println(jwe.getPayload().toString());\n    }\n}\n</code></pre>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 737, "user_id": 1514869, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/433c35e11c86a56f8b227de9224517e1?s=128&d=identicon&r=PG", "display_name": "Will", "link": "https://stackoverflow.com/users/1514869/will"}, "edited": false, "score": 0, "creation_date": 1569273017, "post_id": 58070192, "comment_id": 102536149, "body": "you can initialise &#39;all&#39; as [] (an array) and then insert arrays into it.  There is no special initialisation needed to make it 2 dimensional.  To make a 2d array create a 1d array, then put an array (or multiple arrays) inside it."}, {"owner": {"reputation": 737, "user_id": 1514869, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/433c35e11c86a56f8b227de9224517e1?s=128&d=identicon&r=PG", "display_name": "Will", "link": "https://stackoverflow.com/users/1514869/will"}, "edited": false, "score": 0, "creation_date": 1569273243, "post_id": 58070192, "comment_id": 102536223, "body": "I&#39;m not clear on exactly which bits of x you want in your array, or what the nubers in your array are representing, but to add an &#39;s&#39; after I you&#39;d do  all &lt;&lt; [i,&#39;s&#39;]"}, {"owner": {"reputation": 419, "user_id": 10242281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff314354a9784604814f64f822c1589e?s=128&d=identicon&r=PG&f=1", "display_name": "Mich28 ", "link": "https://stackoverflow.com/users/10242281/mich28"}, "reply_to_user": {"reputation": 737, "user_id": 1514869, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/433c35e11c86a56f8b227de9224517e1?s=128&d=identicon&r=PG", "display_name": "Will", "link": "https://stackoverflow.com/users/1514869/will"}, "edited": false, "score": 0, "creation_date": 1569273673, "post_id": 58070192, "comment_id": 102536329, "body": "Tx Will. it&#39;s solved). I Just need to deal with Indexes for each occurrence of regex, and it&#39;s should be for each line"}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1569342279, "post_id": 58070192, "comment_id": 102563024, "body": "&quot;it failed&quot; is not a precise enough error description for us to help you. <i>What</i> doesn&#39;t work? <i>How</i> doesn&#39;t it work? What trouble do you have with your code? Do you get an error message? What is the error message? Is the result you are getting not the result you are expecting? What result do you expect and why, what is the result you are getting and how do the two differ? Is the behavior you are observing not the desired behavior? What is the desired behavior and why, what is the observed behavior, and in what way do they differ?"}], "answers": [{"tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": true, "score": 2, "last_activity_date": 1569277487, "last_edit_date": 1569277487, "creation_date": 1569273754, "answer_id": 58070367, "question_id": 58070192, "link": "https://stackoverflow.com/questions/58070192/ruby-populate-2-dim-array-dynamically/58070367#58070367", "title": "Ruby populate 2 dim array dynamically", "body": "<p>You can do the following.</p>\n\n<pre><code>str = 'line:xss /*   */   /*   /*  CODE_Comment */  '\n</code></pre>\n\n<h1><p></p></h1>\n\n<pre><code>str.gsub(/\\/\\*/).with_object([]) { |_,a| a &lt;&lt; [Regexp.last_match.begin(0), 's'] }\n  #=&gt; [[9, \"s\"], [19, \"s\"], [24, \"s\"]] \n</code></pre>\n\n<p>The steps are as follows.</p>\n\n<pre><code>enum1 = str.gsub(/\\/\\*/)\n  #=&gt; #&lt;Enumerator: \"line:xss /*   */   /*   /*  CODE_Comment */  \"\n  #     :gsub(/\\/\\*/)&gt;\n</code></pre>\n\n<p>If you examine the doc for <a href=\"https://ruby-doc.org/core-2.6.3/String.html#method-i-gsub\" rel=\"nofollow noreferrer\">String#gsub</a> you will see that when <code>gsub</code> has a single argument and no block (the 4<sup>th</sup> form of the method) it returns an enumerator. Curiously, when used in this way it has nothing to do with substituting substrings with other substrings.</p>\n\n<p><code>enum1</code> does nothing more than generate matches:</p>\n\n<pre><code>enum1.next #=&gt; \"/*\" \nenum1.next #=&gt; \"/*\" \nenum1.next #=&gt; \"/*\" \nenum1.next #=&gt; StopIteration (iteration reached an end)\n</code></pre>\n\n<p>See <a href=\"https://ruby-doc.org/core-2.6.3/Enumerator.html#method-i-next\" rel=\"nofollow noreferrer\">Enumerator#next</a>. Before continuing, let's reset the enumerator:</p>\n\n<pre><code>enum1.rewind\n</code></pre>\n\n<p>See <a href=\"https://ruby-doc.org/core-2.6.3/Enumerator.html#method-i-rewind\" rel=\"nofollow noreferrer\">Enumerator#rewind</a>. Next,</p>\n\n<pre><code>enum2 = enum1.with_object([])\n  #=&gt; #&lt;Enumerator: #&lt;Enumerator: \"line:xss /*   */   /*   /*  CODE_Comment */  \"\n  #     :gsub(/\\/\\*/)&gt;:with_object([])&gt; \nenum2.next #=&gt; [\"/*\", []] \nenum2.next #=&gt; [\"/*\", []] \nenum2.next #=&gt; [\"/*\", []] \nenum2.next #=&gt; StopIteration (iteration reached an end) \nenum2.rewind\n</code></pre>\n\n<p><code>enum2</code> (which can be thought of as a <em>compound enumerator</em>) now generates elements which it passes to the block. The values of those elements are captured by the block variables and then the block calculation is performed. We can add some <code>puts</code> statements to examine the values that are computed.</p>\n\n<pre><code>enum2.each do |_,a|\n  puts \"\\n_ = #{_}, a = #{a}\"\n  md = Regexp.last_match\n  b= md.begin(0) \n  puts \"md = #{md}, b = #{b}\"\n  a &lt;&lt; [b, 's']\n  puts \"a = #{a}\"\nend\n  #=&gt; [[9, \"s\"], [19, \"s\"], [24, \"s\"]] \n</code></pre>\n\n<p>and prints</p>\n\n<pre><code>_ = /*, a = []\nmd = /*, b = 9\na = [[9, \"s\"]]\n\n_ = /*, a = [[9, \"s\"]]\nmd = /*, b = 19\na = [[9, \"s\"], [19, \"s\"]]\n\n_ = /*, a = [[9, \"s\"], [19, \"s\"]]\nmd = /*, b = 24\na = [[9, \"s\"], [19, \"s\"], [24, \"s\"]]\n</code></pre>\n\n<p>I have used an underscore (a valid local variable) as a placeholder for the first block variable to signify to the reader that it is not used in the block calculation (a commonly-used convention). To construct the array we need the offset in the string <code>str</code> where this match was made. For that we first obtain the <code>MatchData</code> instance generated by that match (see <a href=\"https://ruby-doc.org/core-2.6.3/Regexp.html#method-c-last_match\" rel=\"nofollow noreferrer\">Regexp::last_match</a>) and then use the method <a href=\"https://ruby-doc.org/core-2.6.3/MatchData.html#method-i-begin\" rel=\"nofollow noreferrer\">LastMatch#begin</a> to obtain the offset for the beginning of the match. Lastly, we append the desired 2-element array to <code>a</code>.</p>\n\n<p>The value of <code>Regexp.last_match</code> is held by the global variable <code>$~</code>, so that variable is sometimes used in place of <code>Regexp.last_match</code>.</p>\n"}], "owner": {"reputation": 419, "user_id": 10242281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff314354a9784604814f64f822c1589e?s=128&d=identicon&r=PG&f=1", "display_name": "Mich28 ", "link": "https://stackoverflow.com/users/10242281/mich28"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 58070367, "answer_count": 1, "score": -1, "last_activity_date": 1569277487, "creation_date": 1569272671, "last_edit_date": 1569273046, "question_id": 58070192, "link": "https://stackoverflow.com/questions/58070192/ruby-populate-2-dim-array-dynamically", "title": "Ruby populate 2 dim array dynamically", "body": "<p>I'm working on parser to analyze SQL code so trying to deal with all block comments. I come up with solution to process regex by index to see if it's inside comment block and for this purpose trying to fill 2 dim array in the code below where second element will be literal let say <strong>s</strong>. Not sure if this doable. I tried one gem but it failed.\nMy goal to get array filled like</p>\n\n<p><code>all =[[9,'s'],[19,'s'],[24,'s']]</code><br>\nreferring to example below. Final goal is to process legacy SQL code (a lot of it..) to find active lines with specific keywords.  Best </p>\n\n<pre><code>x = 'line:xss /*   */   /*   /*  CODE_Comment */  '\n     puts x\n\n    i = -1\n    all = [[],[]]\n    while i = x.index('/*',i+1)             \ndo   all &lt;&lt; i   ####&lt;@&gt;&gt;&lt; how to add literal to second element ???\n    end\n    puts all  \n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-5", "ruby-on-rails-5.2", "presenter"], "comments": [{"owner": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 0, "creation_date": 1569272481, "post_id": 58070136, "comment_id": 102535962, "body": "What is the correct path? In your error, what comes after <code>Searched in:</code>?"}, {"owner": {"reputation": 4416, "user_id": 2012677, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/8d7cb2fe712fb17f44f8c354bf37e7b5?s=128&d=identicon&r=PG&f=1", "display_name": "user2012677", "link": "https://stackoverflow.com/users/2012677/user2012677"}, "reply_to_user": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 0, "creation_date": 1569272720, "post_id": 58070136, "comment_id": 102536050, "body": "@jvillian updated. thanks"}, {"owner": {"reputation": 13378, "user_id": 1430810, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v669u.jpg?s=128&g=1", "display_name": "arieljuod", "link": "https://stackoverflow.com/users/1430810/arieljuod"}, "edited": false, "score": 0, "creation_date": 1569276669, "post_id": 58070136, "comment_id": 102537049, "body": "Those weird methods like &quot;h&quot; or &quot;routes&quot; are a sign of a bad design idea. Maybe you just need a helper method and not a presenter class."}, {"owner": {"reputation": 4416, "user_id": 2012677, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/8d7cb2fe712fb17f44f8c354bf37e7b5?s=128&d=identicon&r=PG&f=1", "display_name": "user2012677", "link": "https://stackoverflow.com/users/2012677/user2012677"}, "edited": false, "score": 0, "creation_date": 1569276759, "post_id": 58070136, "comment_id": 102537073, "body": "Need better organization around my helpers, so I am transferring them to presenters.  Why are they bad design?"}], "owner": {"reputation": 4416, "user_id": 2012677, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/8d7cb2fe712fb17f44f8c354bf37e7b5?s=128&d=identicon&r=PG&f=1", "display_name": "user2012677", "link": "https://stackoverflow.com/users/2012677/user2012677"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 103, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1569274164, "creation_date": 1569272362, "last_edit_date": 1569274164, "question_id": 58070136, "link": "https://stackoverflow.com/questions/58070136/template-path-issue-in-presenter-actionviewtemplateerror-missing-partial", "title": "Template Path issue in Presenter (ActionView::Template::Error (Missing partial...)", "body": "<p>I moved my render_listable helper into a presenter and now my render path is wrong, as the render method can not see the template. </p>\n\n<h3>How do I fix the path to the template path?</h3>\n\n<h2>Error</h2>\n\n<blockquote>\n  <p>ActionView::Template::Error (Missing partial search/_listing_car with\n  {:locale=>[:en], :formats=>[:html, :text, :js, :css, :ics, :csv, :vcf,\n  :vtt, :png, :jpeg, :gif, :bmp, :tiff, :svg, :mpeg, :mp3, :ogg, :m4a,\n  :webm, :mp4, :otf, :ttf, :woff, :woff2, :xml, :rss, :atom, :yaml,\n  :multipart_form, :url_encoded_form, :json, :pdf, :zip, :gzip],\n  :variants=>[], :handlers=>[:raw, :erb, :html, :builder, :ruby,\n  :coffee, :jbuilder]}. Searched in: ):</p>\n</blockquote>\n\n<pre><code>&gt;     3:     &lt;div class=\"col-md-12 vertical-right\"&gt;\n&gt;     4:            &lt;% if listings &amp;&amp; listings.size &gt; 0 %&gt;\n&gt;     5:                &lt;% listings.each do |listing_object| %&gt;\n&gt;     6:           &lt;%= listing_object.render_listable %&gt;\n&gt;     7:                    &lt;hr/&gt;\n&gt;     8:                &lt;% end %&gt;\n&gt;     9:\n&gt; \n</code></pre>\n\n<blockquote>\n  <p>app/presenters/listing_presenter.rb:60:in <code>render_listable'\n  app/views/search/_searchresults.html.erb:6:in</code>block in\n  _app_views_search__searchresults_html_erb___9192204423298974_70140171600340'\n  app/views/search/_searchresults.html.erb:5:in <code>each'\n  app/views/search/_searchresults.html.erb:5:in\n  </code>_app_views_search__searchresults_html_erb___919234423298974_70140171600340'\n  app/views/search/index.js.erb:3:in\n  `_app_views_search_index_js_erb___2514407173266410_70140171518260'</p>\n</blockquote>\n\n<p>My templates are in..</p>\n\n<p>MyAppName/app/views/search/_listing_car.html.erb\nMyAppName/app/views/search/_listing_truck.html.erb</p>\n\n<h2>Presenter</h2>\n\n<pre><code>class ListingPresenter &lt; ApplicationPresenter\n\n  def render_listable\n    case listable_type\n    when \"Car\"\n      h.render partial: \"search/listing_car\", locals: { listing: self }\n    when \"Truck\"\n      h.render partial: \"search/listing_truck\", locals: { listing: self }\n    else\n      \"NO TEMPLATE RENDERED\"\n    end\n  end\nend\n</code></pre>\n\n<h2>Application Presenter</h2>\n\n<pre><code>class ApplicationPresenter\n  delegate_missing_to :@object\n\n\n  def initialize(object)\n    @object = object\n  end\n\n  def h\n    ActionController::Base.helpers\n  end\n\n  def routes\n    Rails.application.routes.url_helpers\n  end \n\n  def self.present(obj, presenter_class = nil)\n    klass = presenter_class || presenter_name(obj).constantize\n    klass.new obj \n  end\n\n  def self.wrap_collection(collection)\n    collection.map { |obj| self.present(obj) }\n  end\n\n  private\n\n  def self.presenter_name(model)\n    if model.class == Listing\n      \"#{model.listable_type}Presenter\"\n    else\n      \"#{model.class}Presenter\"\n    end\n  end\nend\n</code></pre>\n\n<h3>Note:</h3>\n\n<p>I noticed that if I pass a viewcontext in, rather than use my ActionController::Base.helpers method (the h method), it works. </p>\n\n<h2>However, I would prefer to not have to pass the view_context in.</h2>\n\n<pre><code>  def render_listable(view_context)\n    case listable_type\n    when \"Car\"\n      view_context.render partial: \"search/listing_car\", locals: { listing: self }\n    when \"Truck\"\n      view_context.render partial: \"search/listing_truck\", locals: { listing: self }\n    else\n      \"NO TEMPLATE RENDERED\"\n    end\n  end\n</code></pre>\n\n<p>So when I call from the view..</p>\n\n<p><code>listing.listable_type(self)</code>,</p>\n\n<p>but I want  </p>\n\n<p><code>listing.listable_type</code></p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 13619, "user_id": 19093, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12a096a806db3ed30d5ebdb1a72deb3c?s=128&d=identicon&r=PG", "display_name": "Ji\u0159&#237; Posp&#237;\u0161il", "link": "https://stackoverflow.com/users/19093/ji%c5%99%c3%ad-posp%c3%ad%c5%a1il"}, "edited": false, "score": 3, "creation_date": 1569271773, "post_id": 58069844, "comment_id": 102535712, "body": "Keep in mind that you also need to escape both keys and values. If this just an exercise, carry on. If you want to use this in production, you are better of using <code>URI.encode_www_form</code>."}], "answers": [{"tags": [], "owner": {"reputation": 3926, "user_id": 2190621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c464f439212bca87517b234f7c9bd3e?s=128&d=identicon&r=PG&f=1", "display_name": "demir", "link": "https://stackoverflow.com/users/2190621/demir"}, "is_accepted": false, "score": 1, "last_activity_date": 1569272030, "creation_date": 1569272030, "answer_id": 58070057, "question_id": 58069844, "link": "https://stackoverflow.com/questions/58069844/stringifying-query-parameters-can-we-go-further/58070057#58070057", "title": "Stringifying query parameters: can we go further?", "body": "<p>It can be as follows:</p>\n\n<pre><code>def stringify_query_parameters(query_parameters)\n  '?' + query_parameters.map{ |k, v| \"#{k}=#{v}\" }.join('&amp;')\nend\n</code></pre>\n"}], "owner": {"reputation": 2389, "user_id": 761427, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/gqDlt.jpg?s=128&g=1", "display_name": "Arthur Coll&#233;", "link": "https://stackoverflow.com/users/761427/arthur-coll%c3%a9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1569272030, "creation_date": 1569270793, "question_id": 58069844, "link": "https://stackoverflow.com/questions/58069844/stringifying-query-parameters-can-we-go-further", "title": "Stringifying query parameters: can we go further?", "body": "<p>I wrote this method:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>    def stringify_query_params(query_parameters)\n      stringified_query_params = ''\n      query_parameters.each_with_index do |kv, i|\n        k, v = kv\n        index = i\n        if index == 0\n          stringified_query_params += \"?#{k}=#{v}\"\n        else\n          stringified_query_params += \"&amp;#{k}=#{v}\"\n        end\n      end\n      return stringified_query_params\n    end\n</code></pre>\n\n<p>RubyCop is complaining in my running instance of RubyMine saying that I should instead be capturing the output of the conditional branching logic like this.</p>\n\n<p>I was able to make it slightly better, using some methods in the Enumerable module</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>   def stringify_query_parameters(query_parameters)\n      query_parameters.each_with_object([]).with_index do |((k, v), acc), index|\n        acc.push((index.positive? ? '&amp;' : '?') + \"#{k}=#{v}\")\n      end.join('')\n    end\n</code></pre>\n\n<p>Can anyone think of a way to make it even terser?</p>\n"}, {"tags": ["mysql", "ruby", "activerecord"], "answers": [{"tags": [], "owner": {"reputation": 1392, "user_id": 1692916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99337906197e33b2c5f9835584389f44?s=128&d=identicon&r=PG", "display_name": "Sylwit", "link": "https://stackoverflow.com/users/1692916/sylwit"}, "is_accepted": false, "score": 0, "last_activity_date": 1569270360, "creation_date": 1569270360, "answer_id": 58069748, "question_id": 58069639, "link": "https://stackoverflow.com/questions/58069639/how-to-write-sql-request-through-active-record-query-interface-with-joins-two-ta/58069748#58069748", "title": "How to write sql request through Active Record Query Interface with joins two tables where condition - array of ids", "body": "<p>= is used for looking a single value. If you want to use an array, the sql syntax is</p>\n\n<p><code>.where('oc_product.product_id IN ?',[64,66,70,71])</code></p>\n\n<p>Not sure how ActiveRecord works but you can try this.</p>\n"}, {"tags": [], "owner": {"reputation": 3926, "user_id": 2190621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c464f439212bca87517b234f7c9bd3e?s=128&d=identicon&r=PG&f=1", "display_name": "demir", "link": "https://stackoverflow.com/users/2190621/demir"}, "is_accepted": true, "score": 0, "last_activity_date": 1569270366, "creation_date": 1569270366, "answer_id": 58069749, "question_id": 58069639, "link": "https://stackoverflow.com/questions/58069639/how-to-write-sql-request-through-active-record-query-interface-with-joins-two-ta/58069749#58069749", "title": "How to write sql request through Active Record Query Interface with joins two tables where condition - array of ids", "body": "<p>Use <code>IN</code> for multiple values (Array):</p>\n\n<pre><code>Product.joins('inner join oc_product_description on oc_product_description.product_id = oc_product.product_id')\n       .where('oc_product.product_id IN (?)',[64,66,70,71])\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 6250514, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-eFKxx_3qWsc/AAAAAAAAAAI/AAAAAAAAAEE/poGkSVU9stA/photo.jpg?sz=128", "display_name": "Octocat", "link": "https://stackoverflow.com/users/6250514/octocat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 23, "favorite_count": 0, "accepted_answer_id": 58069749, "answer_count": 2, "score": 1, "last_activity_date": 1569286662, "creation_date": 1569269852, "last_edit_date": 1569286662, "question_id": 58069639, "link": "https://stackoverflow.com/questions/58069639/how-to-write-sql-request-through-active-record-query-interface-with-joins-two-ta", "title": "How to write sql request through Active Record Query Interface with joins two tables where condition - array of ids", "body": "<p>This is pure ActiveRecord without Rails models, just connection to another mysql db.\nI tried to write a request like this:</p>\n\n<p><code>Product.joins('inner join oc_product_description on oc_product_description.product_id = oc_product.product_id').where('product_id = ?',[64,66,70,71])</code></p>\n\n<p>and got error <code>ActiveRecord::StatementInvalid (Mysql2::Error: Column 'product_id' in where clause is ambiguous)</code></p>\n\n<p>when I add unique table name like this <code>.where('oc_product.product_id = ?',[64,66,70,71])</code></p>\n\n<p>I got another error <code>ActiveRecord::StatementInvalid (Mysql2::Error: Operand should contain 1 column(s))</code></p>\n"}, {"tags": ["ruby", "string", "selenium", "capybara"], "answers": [{"tags": [], "owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "is_accepted": false, "score": 1, "last_activity_date": 1569269252, "creation_date": 1569269252, "answer_id": 58069518, "question_id": 58068692, "link": "https://stackoverflow.com/questions/58068692/how-to-save-a-return-as-string-and-use-it-in-another-method/58069518#58069518", "title": "How to save a return as string and use it in another method?", "body": "<p>I cannot use your data, but this simulates what you are looking for, if I understand the question. See inline comments:</p>\n\n<pre><code>@session = \"abc def gjk\"\n\ndef capture_number\n  @session.split.last # something to look for\nend\n\ndef fill_certification_no(field)\n  @session &lt;&lt; ' ' &lt;&lt; field\nend\n\ncapture_number #=&gt; \"gjk\" # returns a String\nfill_certification_no('xyz')\n@session #=&gt; \"abc def gjk xyz\"\n</code></pre>\n\n<p>So, call <code>capture_number</code> as argument:</p>\n\n<pre><code>fill_certification_no(capture_number)\n@session #=&gt; \"abc def gjk xyz xyz\"\n</code></pre>\n"}], "owner": {"reputation": 141, "user_id": 10261206, "user_type": "registered", "profile_image": "https://graph.facebook.com/1014898652026353/picture?type=large", "display_name": "Cleicy Gui&#227;o", "link": "https://stackoverflow.com/users/10261206/cleicy-gui%c3%a3o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1569269252, "creation_date": 1569265587, "question_id": 58068692, "link": "https://stackoverflow.com/questions/58068692/how-to-save-a-return-as-string-and-use-it-in-another-method", "title": "How to save a return as string and use it in another method?", "body": "<p>I'm new as Ruby programmer, and I'm developing an automation test using Ruby, Capybara etc. My System has a webtable, I need to get some cell value and send it in another method. </p>\n\n<p>So I developed the follow code:</p>\n\n<pre><code>def capture_number()\n            teste = @session.find(\"//*[@id=\\\"datagrid\\\"]/td[1]/div\").text\n\n            puts teste\nend\n</code></pre>\n\n<p>Is it a string? And how can I send it in this field?</p>\n\n<pre><code>def fill_certification_no(field)\n            @session.find(@path['fields']['field_name'].gsub(\"&lt;field_id&gt;\", field)).set('')\nend\n</code></pre>\n\n<p>Thanks so much! </p>\n"}, {"tags": ["ruby-on-rails", "ruby", "activerecord", "ruby-on-rails-5", "polymorphic-associations"], "comments": [{"owner": {"reputation": 4690, "user_id": 1937435, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YyN37.jpg?s=128&g=1", "display_name": "Josh Brody", "link": "https://stackoverflow.com/users/1937435/josh-brody"}, "edited": false, "score": 1, "creation_date": 1569265662, "post_id": 58068506, "comment_id": 102533163, "body": "Any reason why you&#39;re not using <a href=\"https://api.rubyonrails.org/classes/ActiveRecord/NestedAttributes/ClassMethods.html\" rel=\"nofollow noreferrer\">api.rubyonrails.org/classes/ActiveRecord/NestedAttributes/&hellip;</a>? It&#39;s made for this."}, {"owner": {"reputation": 21, "user_id": 12109053, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04dbec518075e2428362c02135787734?s=128&d=identicon&r=PG&f=1", "display_name": "Da9elKH", "link": "https://stackoverflow.com/users/12109053/da9elkh"}, "reply_to_user": {"reputation": 4690, "user_id": 1937435, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YyN37.jpg?s=128&g=1", "display_name": "Josh Brody", "link": "https://stackoverflow.com/users/1937435/josh-brody"}, "edited": false, "score": 0, "creation_date": 1569272617, "post_id": 58068506, "comment_id": 102536019, "body": "The problem I faced when using nested atteibutes were trying to look for an exisiting entry in the database, using the name of the skill. Do you know how an implementation with overriding the autosave or validation method using &#171;find or create by&#187; actually would look like using nested attributes?"}, {"owner": {"reputation": 24560, "user_id": 4880924, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d40e83be235d4f70428da0d42e12d427?s=128&d=identicon&r=PG&f=1", "display_name": "BKSpurgeon", "link": "https://stackoverflow.com/users/4880924/bkspurgeon"}, "edited": false, "score": 0, "creation_date": 1569276831, "post_id": 58068506, "comment_id": 102537094, "body": "can you post anything on Github? I&#39;m confused by what you are doing. It shouldn&#39;t be hard. If the skill exists, then use that, if it doesn&#39;t exist then create one, and if that fails, then save nothing. am i understanding correctly?"}, {"owner": {"reputation": 21, "user_id": 12109053, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04dbec518075e2428362c02135787734?s=128&d=identicon&r=PG&f=1", "display_name": "Da9elKH", "link": "https://stackoverflow.com/users/12109053/da9elkh"}, "reply_to_user": {"reputation": 24560, "user_id": 4880924, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d40e83be235d4f70428da0d42e12d427?s=128&d=identicon&r=PG&f=1", "display_name": "BKSpurgeon", "link": "https://stackoverflow.com/users/4880924/bkspurgeon"}, "edited": false, "score": 0, "creation_date": 1569310658, "post_id": 58068506, "comment_id": 102545428, "body": "The project is not open source, so it is difficult to post anything on Github.   Yes, that is right @BKSpurgeon! I want to do something like this in GraphQL:  <code>p = Project.create(name: &#39;Webpage&#39;, skill_attributes: [{name: &#39;HTML&#39;},{name: &#39;CSS&#39;}])</code>  If project or skills failes, then nothing is created and p has errors."}, {"owner": {"reputation": 24560, "user_id": 4880924, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d40e83be235d4f70428da0d42e12d427?s=128&d=identicon&r=PG&f=1", "display_name": "BKSpurgeon", "link": "https://stackoverflow.com/users/4880924/bkspurgeon"}, "edited": false, "score": 0, "creation_date": 1569361946, "post_id": 58068506, "comment_id": 102570467, "body": "@DanielKittilsenHenriksen my recommendation would be to extract (or even recreate) those essential models and attributes in a minimal rails app and post it on Github - make it easy for people to solve, and likely, someone will solve it. my two cents."}], "owner": {"reputation": 21, "user_id": 12109053, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04dbec518075e2428362c02135787734?s=128&d=identicon&r=PG&f=1", "display_name": "Da9elKH", "link": "https://stackoverflow.com/users/12109053/da9elkh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 154, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1569264724, "creation_date": 1569264724, "question_id": 58068506, "link": "https://stackoverflow.com/questions/58068506/find-or-create-nested-attributes-in-a-polymorphic-join-table-in-one-transaction", "title": "Find or create nested attributes in a polymorphic join table, in one transaction", "body": "<p><strong>Background</strong></p>\n\n<p>I want to save skills on different types of objects. Typically, a user can have a project or experience, and tag it with different skills etc. Ruby , python or Excel. These skills are global and used across the various possible objects that are \"skillable\".</p>\n\n<p>The problem consists of three models:</p>\n\n<ol>\n<li>Project - contains info about the project</li>\n<li>Skill - contains the name of the skill</li>\n<li>SkillObject - join table between skill and projects\n(polymorphic)</li>\n</ol>\n\n<p>Please look at this <a href=\"https://i.stack.imgur.com/zF8eb.png\" rel=\"nofollow noreferrer\">ER-diagram</a> for a more detailed picture.</p>\n\n<hr>\n\n<p><strong>The problem</strong></p>\n\n<p>When I create or update a project, I also want the skills to be added in the same transaction, just by sending the names of the skills from the front-end.</p>\n\n<p>I want a kind of find_or_create_by to avoid duplicate skills. At the same time, validations must ensure that two identical skills cannot be put on the same project (<em>skill_object.rb</em>) and that the skill name cannot be zero (<em>skill.rb</em>)</p>\n\n<p>The wanted behavior is if the validation of skills is not successful, then either the project nor the skills are stored in the database. If you enter two different skill names and one is already in the database, the one that exists should be found and connected to the project, and the other created and so connected through the join table, if not validations fails.</p>\n\n<p><hr>\n<strong>project.rb</strong></p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>class Project &lt; ApplicationRecord\n  include Skillable\n  [...] \nend\n\n</code></pre>\n\n<p><strong>skill_object.rb</strong></p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>class SkillObject &lt; ApplicationRecord\n  belongs_to :skill, inverse_of: :skill_objects\n  belongs_to :skillable, polymorphic: true\n\n  delegate :delete_if_empty_skill_objects, to: :skill\n  after_destroy :delete_if_empty_skill_objects\n\n  # Avoiding duplicates of the same skill\n  validates :skill, uniqueness: { scope: :skillable }\n\nend\n</code></pre>\n\n<p><strong>skill.rb</strong></p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>class Skill &lt; ApplicationRecord\n\n  has_many :skill_objects, inverse_of: :skill\n\n  has_many :projects, through: :skill_objects, source: :sectorable, source_type: 'Project'\n  has_many :experiences, through: :skill_objects, source: :sectorable, source_type: 'Experience'\n\n  validates :name, uniqueness: true, presence: true\n\n  def delete_if_empty_skill_objects\n    self.destroy if self.skill_objects.empty? and not self.is_global\n  end\nend\n</code></pre>\n\n<p>I use a concern that is included on the different types of skillable objects:</p>\n\n<p><strong>concercns/skillable.rb</strong></p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>module Skillable\n\n  extend ActiveSupport::Concern\n\n  included do\n    attr_accessor :skills_attributes\n    after_save :set_skills\n\n\n    # Adding needed relations for skillable objects\n    has_many :skill_objects, -&gt; { order(created_at: :asc) }, as: :skillable, dependent: :destroy\n    has_many :skills, through: :skill_objects\n\n\n    private\n    def set_skills\n\n      # THIS CODE IS THE ONE I AM STRUGGLING WITH\n\n\n      # Parsing out all the skill names\n      skill_names = skills_attributes.pluck(:name)\n\n      # Removing existing skills\n      self.skills = []\n\n\n      # Building new skills\n      skill_names.each do |name|\n        existing = Skill.find_by(name: name)\n\n        if existing\n          self.skills &lt;&lt; existing\n        else\n          self.skills.new(name: name)\n        end\n      end\n\n      raise ActiveRecord::Rollback unless self.valid?\n      self.skills.each(&amp;:save)\n    end\n  end\nend\n</code></pre>\n\n<p>Does anyone know how I can write the set_skill function in skillable.rb to be able to save and update skills, validate the parent object and the skills, do a rollback if not validated and add the appropriate errors to the project object if it failes?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-5", "paperclip"], "comments": [{"owner": {"reputation": 3926, "user_id": 2190621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c464f439212bca87517b234f7c9bd3e?s=128&d=identicon&r=PG&f=1", "display_name": "demir", "link": "https://stackoverflow.com/users/2190621/demir"}, "edited": false, "score": 0, "creation_date": 1569264830, "post_id": 58068330, "comment_id": 102532850, "body": "Try <code>create</code> method instead of <code>build</code>"}, {"owner": {"reputation": 143, "user_id": 2351980, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/HLah7.jpg?s=128&g=1", "display_name": "O\u011fuz &#199;i&#231;ek", "link": "https://stackoverflow.com/users/2351980/o%c4%9fuz-%c3%87i%c3%a7ek"}, "reply_to_user": {"reputation": 3926, "user_id": 2190621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c464f439212bca87517b234f7c9bd3e?s=128&d=identicon&r=PG&f=1", "display_name": "demir", "link": "https://stackoverflow.com/users/2190621/demir"}, "edited": false, "score": 0, "creation_date": 1569265106, "post_id": 58068330, "comment_id": 102532961, "body": "The error is due to the <code>create</code> method, not the <code>build</code> method."}, {"owner": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 0, "creation_date": 1569265787, "post_id": 58068330, "comment_id": 102533231, "body": "Why are you doing <code>p[:answer]</code> (for example) instead of <code>p.answer</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 1, "creation_date": 1569265822, "post_id": 58068709, "comment_id": 102533243, "body": "Out of curiosity, since <code>answer</code> isn&#39;t saved, will <code>answer.photos.create</code> work ok?"}, {"owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "reply_to_user": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 0, "creation_date": 1569266230, "post_id": 58068709, "comment_id": 102533444, "body": "@jvillian Good question. Actually I am not sure. Looking at the Rails Guides for <code>has_many</code> doesn&#39;t give an answer. It is probably better to create the answer first. Even if it was not necessary you would get better error messages when a validation fails."}, {"owner": {"reputation": 143, "user_id": 2351980, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/HLah7.jpg?s=128&g=1", "display_name": "O\u011fuz &#199;i&#231;ek", "link": "https://stackoverflow.com/users/2351980/o%c4%9fuz-%c3%87i%c3%a7ek"}, "edited": false, "score": 0, "creation_date": 1569266769, "post_id": 58068709, "comment_id": 102533648, "body": "Thank you for the answer, but now I&#39;m getting a  <code>rollback transaction </code> for images. Am I missing something? I don&#39;t use any validation   <code>do_not_validate_attachment_file_type :image</code>"}, {"owner": {"reputation": 143, "user_id": 2351980, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/HLah7.jpg?s=128&g=1", "display_name": "O\u011fuz &#199;i&#231;ek", "link": "https://stackoverflow.com/users/2351980/o%c4%9fuz-%c3%87i%c3%a7ek"}, "edited": false, "score": 0, "creation_date": 1569272425, "post_id": 58068709, "comment_id": 102535946, "body": "I think the reason is associations. But I couldn&#39;t solve it."}], "tags": [], "owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "is_accepted": true, "score": 4, "last_activity_date": 1569266086, "last_edit_date": 1569266086, "creation_date": 1569265643, "answer_id": 58068709, "question_id": 58068330, "link": "https://stackoverflow.com/questions/58068330/rails-add-data-to-relations-relation-table/58068709#58068709", "title": "Rails - add data to relation&#39;s relation table", "body": "<p>A photo belongs to one question and one answer. But you try to create a photo that belongs to several <code>q.answers</code>.</p>\n\n<p>You probably want to do something like this:</p>\n\n<pre><code>question = Question.new(title: p[:title], post: p[:post])\n\np[:answers].each do |a|\n  answer = q.answers.create(body: a[:body])\n  if a[:images]\n    a[:images].each do |e|\n      answer.photos.create(image: e, question: q)\n    end\n  end\nend\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "is_accepted": false, "score": 3, "last_activity_date": 1569267700, "last_edit_date": 1569267700, "creation_date": 1569266317, "answer_id": 58068848, "question_id": 58068330, "link": "https://stackoverflow.com/questions/58068330/rails-add-data-to-relations-relation-table/58068848#58068848", "title": "Rails - add data to relation&#39;s relation table", "body": "<p>First of all, it's not ruby-ish to do <code>p[:title]</code>, <code>a[:image]</code>, etc. (Also, you're typing three extra characters per method call and, you know, life is short.) Just do <code>p.title</code>, <code>a.image</code>, etc. So, your code should look like: </p>\n\n<pre><code>q = Question.new(title: p.title, post: p.post)\n\np.answers.each do |answer|\n  q.answers.build(body: answer.body)\n  if answer.images\n    answer.images.each do |image|\n      q.answers.photos.create(image: image)\n    end\n  end\nend\n</code></pre>\n\n<p>Now, you want to create new photos for the <code>answer</code> you instantiated here:</p>\n\n<pre><code>q.answers.build(body: answer.body)\n</code></pre>\n\n<p>Instead, you're trying to call <code>photos</code> on the enumerable that is returned by <code>q.answers.photos</code>. And, naturally, that enumerable (an <code>ActiveRecord_Associations_CollectionProxy</code> in this case) doesn't have that method. So, you're getting the <code>undefined method</code> error. </p>\n\n<p>You could try:</p>\n\n<pre><code>q = Question.new(title: p.title, post: p.post)\n\np.answers.each do |answer|\n  new_answer = q.answers.build(body: answer.body)\n  if answer.images\n    answer.images.each do |image|\n      new_answer.photos.create(image: image)\n    end\n  end\nend\n</code></pre>\n\n<p>Except you haven't saved <code>new_answer</code> yet, so it doesn't have an <code>id</code>. In which case, it <em>may</em> still error out. </p>\n\n<p>So, perhaps: </p>\n\n<pre><code>q = Question.new(title: p.title, post: p.post)\n\np.answers.each do |answer|\n  new_answer = q.answers.create(body: answer.body)\n  if answer.images\n    answer.images.each do |image|\n      new_answer.photos.create(image: image)\n    end\n  end\nend\n</code></pre>\n\n<p>I'm not sure if you <em>really</em> want all those duplicate <code>Photo</code>s (maybe you do). But, if you don't, I think I would do something like: </p>\n\n<pre><code>class AnswerPhoto &lt; ApplicationRecord\n  belongs_to :answer\n  belongs_to :photo\nend\n\nclass Answer &lt; ApplicationRecord\n  belongs_to :question\n  has_many :answer_photos\n  has_many :photos, through: :answer_photos\nend\n\nclass Photo &lt; ApplicationRecord\n  belongs_to :question\n  has_many :answer_photos\n  has_many :answers, through: :answer_photos\nend\n</code></pre>\n\n<p>In which case you might do something like: </p>\n\n<pre><code>q = Question.new(title: p.title, post: p.post)\n\np.answers.each do |answer|\n  new_answer = q.answers.create(body: answer.body)\n  new_answer.photos &lt;&lt; answer.photos\nend\n</code></pre>\n\n<p>It looks to me you have some <code>N+1</code> querying going on there, so you'll want to look into <code>.include</code>. And, since you're not really using <code>answer.photos</code> as proper ruby objects (you only really want those <code>id</code>s), you might look into <code>.pluck</code>.</p>\n"}], "owner": {"reputation": 143, "user_id": 2351980, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/HLah7.jpg?s=128&g=1", "display_name": "O\u011fuz &#199;i&#231;ek", "link": "https://stackoverflow.com/users/2351980/o%c4%9fuz-%c3%87i%c3%a7ek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 58068709, "answer_count": 2, "score": 0, "last_activity_date": 1569267700, "creation_date": 1569263875, "question_id": 58068330, "link": "https://stackoverflow.com/questions/58068330/rails-add-data-to-relations-relation-table", "title": "Rails - add data to relation&#39;s relation table", "body": "<p>i have <code>questions</code> , <code>answers</code> and <code>photos</code> <code>models</code>. I use <code>paperclip</code> for images. </p>\n\n<p>I can't add <code>answer's image</code> to <code>photos table</code> using below code.</p>\n\n<pre><code> q = Question.new(\n            title:  p[:title],\n            post:  p[:post]\n            )\n\np[:answers].each do |a|\n  q.answers.build(body: a[:body])\n  if a[:images]\n    a[:images].each do |e|\n      q.answers.photos.create(image: e) #this line gives the error\n    end\n  end\nend\n\n</code></pre>\n\n<p>Error line <code>q.answers.photos.create(image: e)</code></p>\n\n<p>Error is : </p>\n\n<pre><code>undefined method `photos' for #&lt;Answer::ActiveRecord_Associations_CollectionProxy:0x00007f9592208800&gt;\n\n</code></pre>\n\n<p>I created associations for my models like : </p>\n\n<pre><code>class Answer &lt; ApplicationRecord\n belongs_to :question\n has_many :photos\nend\n\nclass Photo &lt; ApplicationRecord\n  belongs_to :question\n  belongs_to :answer\n\n  has_attached_file :image,\n                    :path =&gt; \":rails_root/public/img/:filename\", validate_media_type: false\n\n  do_not_validate_attachment_file_type :image\nend\n\n\n</code></pre>\n"}, {"tags": ["ruby", "console"], "answers": [{"tags": [], "owner": {"reputation": 3926, "user_id": 2190621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c464f439212bca87517b234f7c9bd3e?s=128&d=identicon&r=PG&f=1", "display_name": "demir", "link": "https://stackoverflow.com/users/2190621/demir"}, "is_accepted": true, "score": 1, "last_activity_date": 1569264065, "last_edit_date": 1569264065, "creation_date": 1569263239, "answer_id": 58068183, "question_id": 58067933, "link": "https://stackoverflow.com/questions/58067933/ruby-can-i-skip-a-line-of-input-from-the-console-and-start-reading-from-the-ne/58068183#58068183", "title": "Ruby - Can I skip a line of input from the console and start reading from the next line?", "body": "<p>You can read words like this:</p>\n\n<pre><code>puts 'Number of words:'\nwords = []\nnumber_of_words = gets.to_i\nnumber_of_words.times do |i|\n  puts \"Word #{i + 1}:\"\n  words &lt;&lt; gets.chomp\nend\np words\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Number of words:\n2\nWord 1:\nHacker\nWord 2:\nRank\n\np words\n#~&gt; [Hacker\", \"Rank\"] \n</code></pre>\n"}], "owner": {"reputation": 89, "user_id": 10908471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/861913003f006a077c9ca26edbb64594?s=128&d=identicon&r=PG&f=1", "display_name": "Karen", "link": "https://stackoverflow.com/users/10908471/karen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 58068183, "answer_count": 1, "score": 1, "last_activity_date": 1569264065, "creation_date": 1569262046, "question_id": 58067933, "link": "https://stackoverflow.com/questions/58067933/ruby-can-i-skip-a-line-of-input-from-the-console-and-start-reading-from-the-ne", "title": "Ruby - Can I skip a line of input from the console and start reading from the next line?", "body": "<p>I'm practicing some Ruby exercises on HackerRank and one of the challenges is to separate a string based on the value of each character's index. Essentially, even indexed characters go into one string an odd characters go into another. I've already written the main chunk of the code and I'm confident that it works, but I need help with reading the input from the console. </p>\n\n<p>The input is as follows: </p>\n\n<pre><code>2\nHacker\nRank\n</code></pre>\n\n<p>The first line of input is the number of strings to perform the action on, and then it's followed by the two strings. I saw that there was a comment provided in the code that said to read input from STDIN, but I've only learned \"gets\" so far. And when I tried to use \"gets\", it was only grabbing the line of input that says \"2\". Is there a way to skip over the first line of input and go straight to the first string? I'll provide the rest of my code below just in case anyone needs it:</p>\n\n<pre><code>str = gets\nputs str \n\nevens = \"\"\nodds = \"\"\n\narr = str.split(\"\")\n\narr.each.with_index do | letter, indx |\n    if indx.even?\n        evens += letter\n    else\n        odds += letter\n    end \nend\n\nputs evens + \" \" + odds\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "csv", "psql"], "comments": [{"owner": {"reputation": 2832, "user_id": 451893, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0dba10774351090583ce306ef0ca805b?s=128&d=identicon&r=PG", "display_name": "Les Nightingill", "link": "https://stackoverflow.com/users/451893/les-nightingill"}, "edited": false, "score": 0, "creation_date": 1569255373, "post_id": 58066241, "comment_id": 102529024, "body": "notice it says &quot;unknown attribute &#39;id&#39; for TableName&quot;, it does not say &quot;unknown attribute &#39;id&#39; for Contact&quot;. I&#39;m not sure why you are importing the CSV inside a controller. It would be more appropriate as a rake task. Suggest you make a rake task (or even just try it in the rails console), and let us know what happens"}, {"owner": {"reputation": 23, "user_id": 11649729, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22c4d07a017ea932d8aeecc37a2de50b?s=128&d=identicon&r=PG&f=1", "display_name": "jennasaurusrex", "link": "https://stackoverflow.com/users/11649729/jennasaurusrex"}, "reply_to_user": {"reputation": 2832, "user_id": 451893, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0dba10774351090583ce306ef0ca805b?s=128&d=identicon&r=PG", "display_name": "Les Nightingill", "link": "https://stackoverflow.com/users/451893/les-nightingill"}, "edited": false, "score": 0, "creation_date": 1569255477, "post_id": 58066241, "comment_id": 102529075, "body": "Thanks. The error was actually for &#39;Contacts,&#39; but I tried to make the question ambiguous and didn&#39;t succeed.  :p Regardless, I&#39;ll try that!"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1569256406, "post_id": 58066241, "comment_id": 102529476, "body": "Note: Modern Ruby uses the <code>headers: true</code> notation instead of the old Ruby 1.8 <code>:headers =&gt; true</code> form. The new form is shorter, and also follows the same conventions used in other languages, like JavaScript."}, {"owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 0, "creation_date": 1569259353, "post_id": 58066241, "comment_id": 102530635, "body": "Are you sure that you actually run your database migration successfully? Rails creates an <code>id</code> column automatically, I would expect it to raise an error when you try to add another <code>id</code> column manually. Please double-check the table structure in your database."}, {"owner": {"reputation": 4690, "user_id": 1937435, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YyN37.jpg?s=128&g=1", "display_name": "Josh Brody", "link": "https://stackoverflow.com/users/1937435/josh-brody"}, "edited": false, "score": 0, "creation_date": 1569261995, "post_id": 58066241, "comment_id": 102531666, "body": "can you show the stacktrace? also beware: the <code>CSV.foreach</code> is also class-level on your controller; you should move it to a method or plug it in a model."}], "answers": [{"comments": [{"owner": {"reputation": 2832, "user_id": 451893, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0dba10774351090583ce306ef0ca805b?s=128&d=identicon&r=PG", "display_name": "Les Nightingill", "link": "https://stackoverflow.com/users/451893/les-nightingill"}, "edited": false, "score": 0, "creation_date": 1569258200, "post_id": 58066434, "comment_id": 102530208, "body": "there does not appear to be any issue creating an ActiveRecord model while specifying the id. I confirmed in the Rails console that it&#39;s possible, b/c this was my first suspicion about the problem."}, {"owner": {"reputation": 319, "user_id": 9379722, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DjypIfHCfa4/AAAAAAAAAAI/AAAAAAAAAKE/Arq2ERtWdwU/photo.jpg?sz=128", "display_name": "Abdul Rehman", "link": "https://stackoverflow.com/users/9379722/abdul-rehman"}, "reply_to_user": {"reputation": 2832, "user_id": 451893, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0dba10774351090583ce306ef0ca805b?s=128&d=identicon&r=PG", "display_name": "Les Nightingill", "link": "https://stackoverflow.com/users/451893/les-nightingill"}, "edited": false, "score": 0, "creation_date": 1569258340, "post_id": 58066434, "comment_id": 102530253, "body": "did you confirm that <code>row.to_hash</code> is producing correct hash?"}], "tags": [], "owner": {"reputation": 319, "user_id": 9379722, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DjypIfHCfa4/AAAAAAAAAAI/AAAAAAAAAKE/Arq2ERtWdwU/photo.jpg?sz=128", "display_name": "Abdul Rehman", "link": "https://stackoverflow.com/users/9379722/abdul-rehman"}, "is_accepted": false, "score": 0, "last_activity_date": 1569255514, "creation_date": 1569255514, "answer_id": 58066434, "question_id": 58066241, "link": "https://stackoverflow.com/questions/58066241/unknown-attribute-id-when-importing-csv-to-rails-app/58066434#58066434", "title": "Unknown attribute &quot;id&quot; when importing csv to rails app", "body": "<p>id is attr_protected that is why you can not set it manually in create, you can set it like this</p>\n\n<pre><code>Contact.create!(row.to_hash, without_protection: true)\n</code></pre>\n\n<p>but be careful when setting without_protection to true. You can read more about it <a href=\"https://stackoverflow.com/questions/8175035/what-could-happen-if-i-use-without-protection-true-when-creating-a-new-model-i\">here</a>. </p>\n"}, {"tags": [], "owner": {"reputation": 311, "user_id": 7105526, "user_type": "registered", "profile_image": "https://graph.facebook.com/1812496678973073/picture?type=large", "display_name": "B&#249;i Nh\u1eadt Duy", "link": "https://stackoverflow.com/users/7105526/b%c3%b9i-nh%e1%ba%adt-duy"}, "is_accepted": false, "score": 0, "last_activity_date": 1569376142, "creation_date": 1569376142, "answer_id": 58090125, "question_id": 58066241, "link": "https://stackoverflow.com/questions/58066241/unknown-attribute-id-when-importing-csv-to-rails-app/58090125#58090125", "title": "Unknown attribute &quot;id&quot; when importing csv to rails app", "body": "<p>In Rails, <code>id</code> is generated automatically, so you don't need specify the id in the migration file. You can remove this line in migration file:</p>\n\n<pre><code>t.integer :id\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 11649729, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22c4d07a017ea932d8aeecc37a2de50b?s=128&d=identicon&r=PG&f=1", "display_name": "jennasaurusrex", "link": "https://stackoverflow.com/users/11649729/jennasaurusrex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 68, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1569376142, "creation_date": 1569254716, "question_id": 58066241, "link": "https://stackoverflow.com/questions/58066241/unknown-attribute-id-when-importing-csv-to-rails-app", "title": "Unknown attribute &quot;id&quot; when importing csv to rails app", "body": "<p>I'm importing a csv to my app and I'm getting a routing error \"unknown attribute '\ufeffid' for TableName\"</p>\n\n<p>I understand so far that this should be due to my csv having columns that don't match with my table, but this isn't the case. I'm pretty sure it has to do with my column name in the .csv being \"id\", as that might be a reserved word, but I tried setting <code>id: false</code> in my <code>create_table</code> and I still got an error.</p>\n\n<p>I'm still getting the hang of ruby so any help would be appreciated. Thanks!</p>\n\n<p>schema:</p>\n\n<pre><code>class CreateContacts &lt; ActiveRecord::Migration[5.2]\n  def change\n    create_table :contacts do |t|\n      t.integer :id\n      t.string :first_name\n      t.string :last_name\n      t.string :company\n      t.string :email\n      t.string :address1\n      t.string :address2\n      t.string :city\n      t.string :state_long\n      t.string :state\n      t.string :phone\n\n      t.timestamps\n    end\n  end\nend\n\n</code></pre>\n\n<p>controller:</p>\n\n<pre><code>require 'csv'\n\nclass ContactController &lt; ApplicationController\n  def index\n  end\n\n  CSV.foreach('app/data/contact_data.csv', :headers =&gt; true) do |row|\n    Contact.create!(row.to_hash)\n  end\nend\n\n</code></pre>\n"}, {"tags": ["python", "ruby", "keyword-argument"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1569248889, "post_id": 58063884, "comment_id": 102525621, "body": "In Ruby <code>b = 2</code> is always a variable assignment."}, {"owner": {"reputation": 312, "user_id": 4436022, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh5.googleusercontent.com/-6D6mYmP-J-k/AAAAAAAAAAI/AAAAAAAAAYQ/Vr3TfwpQaTg/photo.jpg?sz=128", "display_name": "Yuriy Leonov", "link": "https://stackoverflow.com/users/4436022/yuriy-leonov"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 1, "creation_date": 1569249716, "post_id": 58063884, "comment_id": 102526074, "body": "@tadman yeah :) I&#39;ve read it in <a href=\"https://docs.ruby-lang.org/en/2.6.0/syntax/calling_methods_rdoc.html#label-Arguments\" rel=\"nofollow noreferrer\">docs.ruby-lang.org/en/2.6.0/syntax/&hellip;</a> (link from comments below)"}], "answers": [{"tags": [], "owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "is_accepted": true, "score": 4, "last_activity_date": 1569246643, "last_edit_date": 1569246643, "creation_date": 1569246470, "answer_id": 58063947, "question_id": 58063884, "link": "https://stackoverflow.com/questions/58063884/how-to-pass-kwargs-in-ruby-function-based-on-python-example/58063947#58063947", "title": "How to pass kwargs in ruby function? Based on python example", "body": "<p>In Ruby you need to use hash-like syntax</p>\n\n<pre><code>def any_func(a, b: 2, c: 0, d: nil)\n  c\nend\n\nany_func(25, c: 30)\n</code></pre>\n\n<p><code>def fun(a=1)</code> only sets a default value. And if you have <code>any_func(25, c = 30)</code>, it means \"call <code>any_func</code> with two arguments, 25 and result of expression <code>c = 30</code> (that is 30)\"</p>\n\n<p><a href=\"https://www.rubyguides.com/2018/06/rubys-method-arguments/\" rel=\"nofollow noreferrer\">Read more</a></p>\n"}, {"tags": [], "owner": {"reputation": 45322, "user_id": 421705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/581b1760881c962648f99d6040d41829?s=128&d=identicon&r=PG", "display_name": "Holger Just", "link": "https://stackoverflow.com/users/421705/holger-just"}, "is_accepted": false, "score": 4, "last_activity_date": 1569252558, "last_edit_date": 1569252558, "creation_date": 1569246606, "answer_id": 58063983, "question_id": 58063884, "link": "https://stackoverflow.com/questions/58063884/how-to-pass-kwargs-in-ruby-function-based-on-python-example/58063983#58063983", "title": "How to pass kwargs in ruby function? Based on python example", "body": "<p>Ruby has both positional arguments and keyword arguments. Differing from Python, you can't mix them  but have to declare them with their respective syntax and provide them accordingly in method calls.</p>\n\n<pre><code>def any_func(a, b: 2, c: 0, d: nil)\n  c\nend\n\nputs any_func(25, c: 30)\n</code></pre>\n\n<p>You can refer to the <a href=\"https://docs.ruby-lang.org/en/2.6.0/syntax/calling_methods_rdoc.html#label-Arguments\" rel=\"nofollow noreferrer\">official syntax documentation</a> to learn more about how to declare and call methods with arguments.</p>\n\n<p>As for your own example of calling your <code>any_func</code> method with <code>any_func(25, c = 30)</code>, what happened here is that you have created the local variable <code>c</code> in the calling context with the value <code>30</code>. You have also passed this value to the second (optional) argument <code>b</code> of your method.</p>\n"}], "owner": {"reputation": 312, "user_id": 4436022, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh5.googleusercontent.com/-6D6mYmP-J-k/AAAAAAAAAAI/AAAAAAAAAYQ/Vr3TfwpQaTg/photo.jpg?sz=128", "display_name": "Yuriy Leonov", "link": "https://stackoverflow.com/users/4436022/yuriy-leonov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1549, "favorite_count": 0, "accepted_answer_id": 58063947, "answer_count": 2, "score": 0, "last_activity_date": 1569252558, "creation_date": 1569246289, "last_edit_date": 1592644375, "question_id": 58063884, "link": "https://stackoverflow.com/questions/58063884/how-to-pass-kwargs-in-ruby-function-based-on-python-example", "title": "How to pass kwargs in ruby function? Based on python example", "body": "<h3>Env:</h3>\n<pre><code>$ ruby --version\nruby 2.5.1p57 (2018-03-29 revision 63029) [x86_64-linux-gnu]\n</code></pre>\n<h3>Question:</h3>\n<p>There is example on python:</p>\n<pre><code>def any_func(a, b=2, c = 0, d=None):\n    return c\n\nprint(any_func(25, c=30))  # will print 30\n</code></pre>\n<p>How can I do the same on ruby?<br>\nHow &quot;kwargs&quot; is called on ruby? I would like to know it for further searching.<br><br></p>\n<p>I tried following code on ruby:</p>\n<pre><code>#!/usr/bin/env ruby\ndef any_func(a, b = 2, c = 0, d = nil)\n  c\nend\n\nputs any_func(25, c = 30)  # will print 0, 30 is expected\n</code></pre>\n"}, {"tags": ["ruby", "security", "rubygems"], "comments": [{"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1569291065, "post_id": 58063580, "comment_id": 102539778, "body": "Are you sure every gem contains the checksums inside the tarball?"}], "answers": [{"comments": [{"owner": {"reputation": 1743, "user_id": 4308435, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Vgr6X.jpg?s=128&g=1", "display_name": "Nikita Misharin", "link": "https://stackoverflow.com/users/4308435/nikita-misharin"}, "edited": false, "score": 0, "creation_date": 1569266236, "post_id": 58065404, "comment_id": 102533445, "body": "I&#39;m not sure, to be honest that this provides any extra layer of security. I mean if I get mitm attacked, checksum of the <code>.gem</code> would be enough to prevent that. But suppose I don&#39;t use bunder that checks sums automatically and I download gem directly. I don&#39;t see how someone would replace content of the gem without changing the checksums, as <code>gem build</code> also adds those checksums automatically."}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "reply_to_user": {"reputation": 1743, "user_id": 4308435, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Vgr6X.jpg?s=128&g=1", "display_name": "Nikita Misharin", "link": "https://stackoverflow.com/users/4308435/nikita-misharin"}, "edited": false, "score": 0, "creation_date": 1569291522, "post_id": 58065404, "comment_id": 102539851, "body": "@NikitaMisharin see links I&#39;ve added to updated answer for more background on how or why this might be useful."}, {"owner": {"reputation": 1743, "user_id": 4308435, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Vgr6X.jpg?s=128&g=1", "display_name": "Nikita Misharin", "link": "https://stackoverflow.com/users/4308435/nikita-misharin"}, "edited": false, "score": 0, "creation_date": 1569299787, "post_id": 58065404, "comment_id": 102541425, "body": "@acostenycoder I&#39;ve seen the commit and docs. What surprised me is that they changed MD5 to SHA256, so it seemed like a somehow needed check. Anyway, thank you for the effort"}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "reply_to_user": {"reputation": 1743, "user_id": 4308435, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Vgr6X.jpg?s=128&g=1", "display_name": "Nikita Misharin", "link": "https://stackoverflow.com/users/4308435/nikita-misharin"}, "edited": false, "score": 0, "creation_date": 1569306343, "post_id": 58065404, "comment_id": 102543469, "body": "@NikitaMisharin saw where checksum.yml also contains SHA512 hashes."}], "tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": false, "score": 3, "last_activity_date": 1569291498, "last_edit_date": 1569291498, "creation_date": 1569251547, "answer_id": 58065404, "question_id": 58063580, "link": "https://stackoverflow.com/questions/58063580/whats-the-point-of-checksums-inside-the-ruby-gem/58065404#58065404", "title": "What&#39;s the point of checksums inside the ruby gem", "body": "<p>Normally you just run <code>gem install somegemfilename</code>  but if you chose for some reason to download the gem from <a href=\"https://rubygems.org/gems/\" rel=\"nofollow noreferrer\">https://rubygems.org/gems/</a> then you would want manually run the checksum on that file.</p>\n\n<p>Example</p>\n\n<p>Download a file like <a href=\"https://rubygems.org/downloads/foo-0.0.2.gem\" rel=\"nofollow noreferrer\">https://rubygems.org/downloads/foo-0.0.2.gem</a>\nThen in your terminal go to wherever your file is downloaded and run:</p>\n\n<pre><code>sha256sum foo-0.0.2.gem\n# it should output the same checksum shown at https://rubygems.org/gems/foo\n=&gt; 523009a5b977f79c8eaa79b521e416f26482bc4fbbcc04bd08580696e303a715\n</code></pre>\n\n<p>That alone should be enough security.  However it seem that these are extra layers of security to insure that each gz file which are unpacked by <code>tar xf somegem.gem</code> can be individually checked against contents of <code>checksums.yaml</code> which provides several variant checksums.  </p>\n\n<p>Short answer is that you should not need to worry about them, but they are there for you if you want to drill down to that level.</p>\n\n<p>UPDATED based on @NikitaMisharin's comment:</p>\n\n<p>Yes I see your point and would tend to agree with you.  It looks like it's very old legacy Ruby code and introduced in <a href=\"https://github.com/rubygems/rubygems/commit/9ac0e9149295f356f3aee2e6a7c3a4e22d0a904e#diff-63035a096a1484d3ccb5f311aa790dbb\" rel=\"nofollow noreferrer\">this commit</a>.</p>\n\n<pre><code>commit 9ac0e9149295f356f3aee2e6a7c3a4e22d0a904e\nAuthor: Chad Fowler &lt;chad@chadfowler.com&gt;\nDate:   Sun Nov 23 01:53:27 2003 +0000\n\n    Generate MD5 checksum for gem and store it in the file.  Will be used to validate gem file before installation.\n\n\n    git-svn-id: svn+ssh://rubyforge.org/var/svn/rubygems/trunk@66 3d4018f9-ac1a-0410-99e9-8a154d859a19\n</code></pre>\n\n<p>I would tend to conclude that this was a primitive way of checking code integrity, which has evolved since to use the checksum which would be published on <a href=\"https://rubygems.org/\" rel=\"nofollow noreferrer\">Rubygems.org</a>, the standard gem repository.</p>\n\n<p>I suppose this was perhaps left behind for legacy support? But I guess if you REALLY want to be sure, perhaps ask <a href=\"https://github.com/chad\" rel=\"nofollow noreferrer\">Chad Fowler</a>?</p>\n\n<p>For some more background perhaps <a href=\"http://docs.seattlerb.org/rubygems/Gem/Security.html\" rel=\"nofollow noreferrer\">read this documentation</a> which is linked directly on <a href=\"https://guides.rubygems.org/security/\" rel=\"nofollow noreferrer\">rubygems.org security section</a></p>\n"}, {"tags": [], "owner": {"reputation": 1743, "user_id": 4308435, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Vgr6X.jpg?s=128&g=1", "display_name": "Nikita Misharin", "link": "https://stackoverflow.com/users/4308435/nikita-misharin"}, "is_accepted": true, "score": 0, "last_activity_date": 1569487724, "last_edit_date": 1592644375, "creation_date": 1569487724, "answer_id": 58112958, "question_id": 58063580, "link": "https://stackoverflow.com/questions/58063580/whats-the-point-of-checksums-inside-the-ruby-gem/58112958#58112958", "title": "What&#39;s the point of checksums inside the ruby gem", "body": "<p>Asked the maintainer, here is his answer</p>\n<blockquote>\n<p>I believe I encountered some errors with truncated gems that RubyGems could not detect.  Adding the checksums would allow RubyGems to determine if the gem download had completed successfully and had not been corrupted either during the download or while being cached on-disk.</p>\n<p>The checksums allow RubyGems to say \u201cthis file is corrupt\u201d instead of a more-confusing error due to a truncated .gem (.tar) file, Zlib failure, etc.</p>\n</blockquote>\n"}], "owner": {"reputation": 1743, "user_id": 4308435, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Vgr6X.jpg?s=128&g=1", "display_name": "Nikita Misharin", "link": "https://stackoverflow.com/users/4308435/nikita-misharin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 0, "accepted_answer_id": 58112958, "answer_count": 2, "score": 3, "last_activity_date": 1569487724, "creation_date": 1569245316, "question_id": 58063580, "link": "https://stackoverflow.com/questions/58063580/whats-the-point-of-checksums-inside-the-ruby-gem", "title": "What&#39;s the point of checksums inside the ruby gem", "body": "<p>So the .gem file is tarball that contains data.gz metadata.gz and checksums. Checksums are being verified before data.gz is unarchived, but I don't understand the point of this. It doesn't seem to provide any real security benefit</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "activerecord", "range"], "comments": [{"owner": {"reputation": 159, "user_id": 9722060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd6af43aa5acad3d7111cc6be4d835bb?s=128&d=identicon&r=PG&f=1", "display_name": "Stefan Rendevski", "link": "https://stackoverflow.com/users/9722060/stefan-rendevski"}, "edited": false, "score": 0, "creation_date": 1569243388, "post_id": 58062682, "comment_id": 102522255, "body": "<code>Range</code> has a constructor <code>Range.new(begin,end,exclude_end=false)</code>, however I&#39;m not sure if this would helpful to you. Other than that, you could define your own <code>RangeUtils.to_inclusive(range)</code>,but that would only work for integers. Why do you want to work strictly with inclusive ranges? Aren&#39;t they functionally equivalent?"}, {"owner": {"reputation": 5147, "user_id": 322253, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/b8f8f573e852c25d5750027fdb5ca38f?s=128&d=identicon&r=PG", "display_name": "Cristian", "link": "https://stackoverflow.com/users/322253/cristian"}, "reply_to_user": {"reputation": 159, "user_id": 9722060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd6af43aa5acad3d7111cc6be4d835bb?s=128&d=identicon&r=PG&f=1", "display_name": "Stefan Rendevski", "link": "https://stackoverflow.com/users/9722060/stefan-rendevski"}, "edited": false, "score": 0, "creation_date": 1569243570, "post_id": 58062682, "comment_id": 102522359, "body": "My use case is to use the <code>begin</code> and <code>end</code> part of the ranges. I&#39;m not actually iterating over them or checking inclusion. I just thought that a ruby range is a nice way to represent the actual range for e.g. displaying a price ($ 1.000 - $ 10.000)"}, {"owner": {"reputation": 48049, "user_id": 6419007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/CwqtX.jpg?s=128&g=1", "display_name": "Eric Duminil", "link": "https://stackoverflow.com/users/6419007/eric-duminil"}, "edited": false, "score": 2, "creation_date": 1569243839, "post_id": 58062682, "comment_id": 102522511, "body": "Might be related : <a href=\"https://github.com/rails/rails/issues/30611\" rel=\"nofollow noreferrer\">github.com/rails/rails/issues/30611</a> As you said, it might be a better solution to store the 2 values and create the range dynamically. Use ranges in Ruby, use two integers (or decimals) and a boolean in Postgres."}, {"owner": {"reputation": 5147, "user_id": 322253, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/b8f8f573e852c25d5750027fdb5ca38f?s=128&d=identicon&r=PG", "display_name": "Cristian", "link": "https://stackoverflow.com/users/322253/cristian"}, "reply_to_user": {"reputation": 48049, "user_id": 6419007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/CwqtX.jpg?s=128&g=1", "display_name": "Eric Duminil", "link": "https://stackoverflow.com/users/6419007/eric-duminil"}, "edited": false, "score": 0, "creation_date": 1569244030, "post_id": 58062682, "comment_id": 102522622, "body": "@EricDuminil that is exactly my issue, thanks for pointing that issue, I wasn&#39;t able to find it on my own. It confirms that using ActiveRecord with Postgres ranges is not something very intuitive"}], "answers": [{"comments": [{"owner": {"reputation": 5147, "user_id": 322253, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/b8f8f573e852c25d5750027fdb5ca38f?s=128&d=identicon&r=PG", "display_name": "Cristian", "link": "https://stackoverflow.com/users/322253/cristian"}, "edited": false, "score": 0, "creation_date": 1569246713, "post_id": 58063855, "comment_id": 102524307, "body": "Interesting idea. I dismissed the thought of it because I thought it&#39;s going to run something like Array#min and max and compare all values. But on second thought now, I guess the algorithm of it might be more efficient in a range as it just needs to look at the ends. Do you know whether this is performant?"}], "tags": [], "owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "is_accepted": false, "score": 3, "last_activity_date": 1569246689, "last_edit_date": 1569246689, "creation_date": 1569246186, "answer_id": 58063855, "question_id": 58062682, "link": "https://stackoverflow.com/questions/58062682/how-to-convert-an-exclusive-range-to-inclusive-range-in-ruby/58063855#58063855", "title": "How to convert an exclusive range to inclusive range in Ruby?", "body": "<p>I would use <a href=\"https://ruby-doc.org/core-2.6.4/Range.html#method-i-min\" rel=\"nofollow noreferrer\"><code>Range#min</code></a> and <a href=\"https://ruby-doc.org/core-2.6.4/Range.html#method-i-max\" rel=\"nofollow noreferrer\"><code>Range#max</code></a>:</p>\n\n<pre><code>exclusive_range = (1000...10001)\ninclusive_range = (exclusive_range.min..exclusive_range.max)\n#=&gt; 1000..10000\n</code></pre>\n"}], "owner": {"reputation": 5147, "user_id": 322253, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/b8f8f573e852c25d5750027fdb5ca38f?s=128&d=identicon&r=PG", "display_name": "Cristian", "link": "https://stackoverflow.com/users/322253/cristian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 296, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1569246689, "creation_date": 1569242411, "last_edit_date": 1569243852, "question_id": 58062682, "link": "https://stackoverflow.com/questions/58062682/how-to-convert-an-exclusive-range-to-inclusive-range-in-ruby", "title": "How to convert an exclusive range to inclusive range in Ruby?", "body": "<p>I have an exclusive range of integers, e.g.</p>\n\n<pre><code>range = 1000...10001\n</code></pre>\n\n<p>I would rather work with inclusive ranges all the way, but the reason I have this is because when I tell ActiveRecord to store an inclusive range in PostgreSQL, I get the exclusive version when I query it back.</p>\n\n<p>I want to convert it into an inclusive range, e.g. <code>1000..10000</code>. </p>\n\n<p>I'm doing:</p>\n\n<pre><code>(range.begin)..(range.end-1)\n</code></pre>\n\n<p>However it feels clunky and un-ruby-ish.</p>\n\n<p>My whole API relies on passing ranges, but I'm also considering storying 2 values or storing an array in Postgres instead of a range.</p>\n\n<p>Is there a better way to do this?</p>\n\n<hr>\n\n<p><strong>Edit (some clarifications)</strong></p>\n\n<p>I want to do this as efficiently as possible, given the large difference between the ranges</p>\n\n<p>My use case is to use the begin and end part of the ranges. I'm not actually iterating over them or checking inclusion. I just thought that a ruby range is a nice way to represent the actual range for e.g. displaying a price ($ 1.000 - $ 10.000)</p>\n"}, {"tags": ["ruby", "macos", "augeas"], "comments": [{"owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 0, "creation_date": 1569243360, "post_id": 58062513, "comment_id": 102522236, "body": "Do you have <code>libxml2</code> installed? For example with <code>brew install libxml2</code>?"}, {"owner": {"reputation": 583, "user_id": 1845041, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eab0b3b808d2a07d6ae6f144ce5f2390?s=128&d=identicon&r=PG", "display_name": "Gagan", "link": "https://stackoverflow.com/users/1845041/gagan"}, "reply_to_user": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 0, "creation_date": 1569245499, "post_id": 58062513, "comment_id": 102523533, "body": "Yes, libxml2 in already installed."}], "answers": [{"tags": [], "owner": {"reputation": 583, "user_id": 1845041, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eab0b3b808d2a07d6ae6f144ce5f2390?s=128&d=identicon&r=PG", "display_name": "Gagan", "link": "https://stackoverflow.com/users/1845041/gagan"}, "is_accepted": false, "score": 0, "last_activity_date": 1569246036, "creation_date": 1569246036, "answer_id": 58063811, "question_id": 58062513, "link": "https://stackoverflow.com/questions/58062513/how-to-install-ruby-augeas-gem-macos-mojave/58063811#58063811", "title": "How to install ruby-augeas gem? (macOS Mojave)", "body": "<p>Finally, I have solved this issue.</p>\n\n<pre><code>export PKG_CONFIG_PATH=\"/usr/local/opt/libxml2/lib/pkgconfig\"\n</code></pre>\n\n<p>This is all you need. The configure script will run pkg-config to find out what to add to LDFLAGS and CPPFLAGS.</p>\n\n<p>source: <a href=\"https://github.com/remacs/remacs/issues/886\" rel=\"nofollow noreferrer\">https://github.com/remacs/remacs/issues/886</a></p>\n"}], "owner": {"reputation": 583, "user_id": 1845041, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eab0b3b808d2a07d6ae6f144ce5f2390?s=128&d=identicon&r=PG", "display_name": "Gagan", "link": "https://stackoverflow.com/users/1845041/gagan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 189, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1569246036, "creation_date": 1569241848, "question_id": 58062513, "link": "https://stackoverflow.com/questions/58062513/how-to-install-ruby-augeas-gem-macos-mojave", "title": "How to install ruby-augeas gem? (macOS Mojave)", "body": "<p>I spent most of the day yesterday searching for a clear answer for installing ruby-augeas. \nI can't find a good solution.</p>\n\n<p>How do I install it?</p>\n\n<p>The error while installing:</p>\n\n<pre><code>gem install ruby-augeas\n    Building native extensions. This could take a while...\n    ERROR:  Error installing ruby-augeas:\n        ERROR: Failed to build gem native extension.\n\n        current directory: /Users/vmware/.rvm/gems/ruby-2.4.4/gems/ruby-augeas-0.5.0/ext/augeas\n    /Users/vmware/.rvm/rubies/ruby-2.4.4/bin/ruby -I /Users/vmware/.rvm/rubies/ruby-2.4.4/lib/ruby/site_ruby/2.4.0 -r ./siteconf20190923-73327-iy4kfy.rb extconf.rb\n    creating Makefile\n\n    current directory: /Users/vmware/.rvm/gems/ruby-2.4.4/gems/ruby-augeas-0.5.0/ext/augeas\n    make \"DESTDIR=\" clean\n\n    current directory: /Users/vmware/.rvm/gems/ruby-2.4.4/gems/ruby-augeas-0.5.0/ext/augeas\n    make \"DESTDIR=\"\n    compiling _augeas.c\n    In file included from _augeas.c:25:\n    /usr/local/Cellar/augeas/1.12.0/include/augeas.h:24:10: fatal error: 'libxml/tree.h' file not found\n    #include &lt;libxml/tree.h&gt;\n             ^~~~~~~~~~~~~~~\n    1 error generated.\n    make: *** [_augeas.o] Error 1\n\n    make failed, exit code 2\n\n    Gem files will remain installed in /Users/vmware/.rvm/gems/ruby-2.4.4/gems/ruby-augeas-0.5.0 for inspection.\n    Results logged to /Users/vmware/.rvm/gems/ruby-2.4.4/extensions/x86_64-darwin-18/2.4.0/ruby-augeas-0.5.0/gem_make.out\n</code></pre>\n\n<p>I have also installed  brew install <code>augeas pkg-config</code>, but it shows same error. </p>\n"}, {"tags": ["ruby", "database", "postgresql", "hanami-model"], "answers": [{"comments": [{"owner": {"reputation": 1146, "user_id": 498386, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76aa5b311fb40fdc2bb70c0282d66af3?s=128&d=identicon&r=PG", "display_name": "Luca Guidi", "link": "https://stackoverflow.com/users/498386/luca-guidi"}, "edited": false, "score": 1, "creation_date": 1569249819, "post_id": 58063863, "comment_id": 102526136, "body": "I agree, for PG 1,500,000 records aren&#39;t hard to deal with. Like any other measurable subject, you may want to run benchmarks to see which configuration works better. Another suggestion is to use EXPLAIN, in order to check if you need indexes, or if your query is performant in general."}, {"owner": {"reputation": 125670, "user_id": 6464308, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/12PVX.jpg?s=128&g=1", "display_name": "Laurenz Albe", "link": "https://stackoverflow.com/users/6464308/laurenz-albe"}, "edited": false, "score": 1, "creation_date": 1569251398, "post_id": 58063863, "comment_id": 102526993, "body": "You would naturally index the table, then performance is virtually independent of the table size."}, {"owner": {"reputation": 184, "user_id": 3800524, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7478fdb5e644d85e0875f8200b33a279?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastjan Hribar", "link": "https://stackoverflow.com/users/3800524/sebastjan-hribar"}, "edited": false, "score": 0, "creation_date": 1569255604, "post_id": 58063863, "comment_id": 102529126, "body": "Thank you all. The table would definitely be indexed and we&#39;re currently looking at 6 to 8 language combinations."}], "tags": [], "owner": {"reputation": 180, "user_id": 6544200, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3e4cdf0b5847c65fd5b10b7c8527e90?s=128&d=identicon&r=PG", "display_name": "Shameel", "link": "https://stackoverflow.com/users/6544200/shameel"}, "is_accepted": true, "score": 4, "last_activity_date": 1569246208, "creation_date": 1569246208, "answer_id": 58063863, "question_id": 58062276, "link": "https://stackoverflow.com/questions/58062276/database-design-question-regarding-performance/58063863#58063863", "title": "Database design question regarding performance", "body": "<p>The first approach will be the most flexible since you will be able to add language combinations in future without schema changes. The second approach would mean you add a table for every language combination which would both be a maintenance nightmare and complex code to query multiple tables (which can also mean dynamic queries resulting in poor performance)</p>\n\n<p>PostgreSQL should be able to handle 1500000 records like a breeze provided you have enough hardware and have done proper performance configurations. I have worked with PostgreSQL tables with 50 million rows and it performs well.</p>\n"}, {"tags": [], "owner": {"reputation": 595, "user_id": 3632472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e431a79c8cf18fc5c29ebb94a721dda?s=128&d=identicon&r=PG&f=1", "display_name": "Rakesh", "link": "https://stackoverflow.com/users/3632472/rakesh"}, "is_accepted": false, "score": 0, "last_activity_date": 1569307482, "creation_date": 1569307482, "answer_id": 58074492, "question_id": 58062276, "link": "https://stackoverflow.com/questions/58062276/database-design-question-regarding-performance/58074492#58074492", "title": "Database design question regarding performance", "body": "<p>You can do normalizing your db schema and avoiding redundant data.</p>\n\n<p>In many cases it is convenient to have several small tables instead of one huge table. But it depends on our system and there is not a single possible solution.</p>\n\n<p>We must also use the indexes responsibly. We should not create indexes for each field or combination of fields, since, although we do not have to travel the entire table, we are using disk space and adding overhead to write operations.</p>\n\n<p>Another very useful tool is the management of connection pool. If we have a system with a lot of load, we can use this to avoid saturating the connections in the database and to be able to reuse them.</p>\n"}], "owner": {"reputation": 184, "user_id": 3800524, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7478fdb5e644d85e0875f8200b33a279?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastjan Hribar", "link": "https://stackoverflow.com/users/3800524/sebastjan-hribar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 58063863, "answer_count": 2, "score": 2, "last_activity_date": 1569307482, "creation_date": 1569241084, "question_id": 58062276, "link": "https://stackoverflow.com/questions/58062276/database-design-question-regarding-performance", "title": "Database design question regarding performance", "body": "<p>I need help with deciding on a DB design approach. We're building a translation tool with Hanami (Ruby web framework) and thus ROM. We are facing the design decision of having one DB (Postgresql) table for translation records, where each record is for one source and one target language combination. However, source and target may be any language: EN-DE, FR-EN.</p>\n\n<p>The other possibility would be DB table per language pair.</p>\n\n<p>We currently have about 1.500.000 legacy records. We will not reach 2.000.000 soon, but still, we need to consider it.</p>\n\n<p>We are inclined to the first option, but would it be feasible in terms of querying and performance? The main difference being, for option one matching languages must be queried first, and then the query for corresponding translation string is triggered.</p>\n\n<p>Would there be a significant difference in performance for between both options?</p>\n\n<p>Thank you</p>\n\n<p>seba</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "sphinx", "facet", "thinking-sphinx"], "answers": [{"tags": [], "owner": {"reputation": 15586, "user_id": 54500, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gg5v8.jpg?s=128&g=1", "display_name": "pat", "link": "https://stackoverflow.com/users/54500/pat"}, "is_accepted": true, "score": 1, "last_activity_date": 1569732446, "creation_date": 1569732446, "answer_id": 58152301, "question_id": 58061317, "link": "https://stackoverflow.com/questions/58061317/how-to-do-multi-facets-search-in-thinking-sphinx-rails/58152301#58152301", "title": "How to do multi facets search in thinking sphinx rails", "body": "<p>I <em>think</em> this code does what you want - though you may need to tweak things to get exactly what you're after:</p>\n\n<pre><code>Data.search(\n  :select =&gt; \"groupby() AS year, MIN(price) as min_price, count(DISTINCT sphinx_internal_id) as count\",\n  :group_by =&gt; :year,\n  :max_matches =&gt; 1000,\n  :middleware =&gt; ThinkingSphinx::Middlewares::RAW_ONLY\n)\n</code></pre>\n\n<p>Each option explained:</p>\n\n<ul>\n<li>The <code>select</code> specifies the appropriate aggregations you're after, and <code>groupby()</code> is a function that refers to the attribute this query is grouping by.</li>\n<li><code>group_by</code> specifies the attribute you want the query to group by. Sphinx's equivalent of <code>GROUP BY</code> in SQL, though in the past it has been more limited.</li>\n<li><code>max_matches</code> should be set to 1000, unless you've configured it to be a higher value in your Sphinx configuration (via <code>config/thinking_sphinx.yml</code>). Using the highest possible value ensures the facet results scan as many documents as possible. You could also set <code>:limit</code> to the same value for the specific number of rows being returned here.</li>\n<li><code>middleware</code> uses a limited set of Thinking Sphinx middleware classes, to avoid translating results into ActiveRecord objects - instead, you'll get an array of hashes with the Sphinx query data.</li>\n</ul>\n"}], "owner": {"reputation": 5144, "user_id": 5411461, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/RyJfN.jpg?s=128&g=1", "display_name": "Haseeb Ahmad", "link": "https://stackoverflow.com/users/5411461/haseeb-ahmad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "accepted_answer_id": 58152301, "answer_count": 1, "score": 0, "last_activity_date": 1569732446, "creation_date": 1569237595, "question_id": 58061317, "link": "https://stackoverflow.com/questions/58061317/how-to-do-multi-facets-search-in-thinking-sphinx-rails", "title": "How to do multi facets search in thinking sphinx rails", "body": "<p>Using <code>thinking-sphinx</code> for facets in my app and define two facets <code>price</code> and <code>year</code>.</p>\n\n<p>I want to fetch facets nested results.</p>\n\n<p>Now I am getting facets by year and it give count against year.</p>\n\n<pre><code>years = records[:year]\n</code></pre>\n\n<p>Along with the count of records along with year I also want to get min price in that year.</p>\n\n<p>Now I getting it like</p>\n\n<pre><code>years.map do |year,count|\n     price = Data.where(:year=&gt;year).minimum(:price)\n     {count: count,cheapest_price: price}\nend\n</code></pre>\n\n<p>But its like LazyLoading as N+1 against year. I want to fetch prices along within year facets.</p>\n\n<p>Is there any way to do it?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "inheritance"], "comments": [{"owner": {"reputation": 9584, "user_id": 1420684, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/78242bebaa42db9b1f771e6c19a074fe?s=128&d=identicon&r=PG&f=1", "display_name": "Mirror318", "link": "https://stackoverflow.com/users/1420684/mirror318"}, "reply_to_user": {"reputation": 48413, "user_id": 1279683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1veuT.jpg?s=128&g=1", "display_name": "Marek Lipka", "link": "https://stackoverflow.com/users/1279683/marek-lipka"}, "edited": false, "score": 0, "creation_date": 1569235941, "post_id": 58060649, "comment_id": 102518257, "body": "I&#39;m trying to achieve an object relationship where I can access a parent&#39;s data as well as methods"}, {"owner": {"reputation": 48413, "user_id": 1279683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1veuT.jpg?s=128&g=1", "display_name": "Marek Lipka", "link": "https://stackoverflow.com/users/1279683/marek-lipka"}, "edited": false, "score": 0, "creation_date": 1569235957, "post_id": 58060649, "comment_id": 102518264, "body": "After your edition: It does not work not because instance variables are somehow &quot;not shared&quot; (whatever it means), but because you overwrote method <code>initialize</code> in <code>A</code> class so now it doesn&#39;t set <code>@var</code> instance variable. What are you trying to achieve? What do you mean by trying to achieve &#39;parent&#39;s data&#39;? Instance variables only live on instances, not on classes (well they do, but it&#39;s a different case then)."}, {"owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 0, "creation_date": 1569236005, "post_id": 58060649, "comment_id": 102518291, "body": "What should happen when the variable <code>@var</code> is updated in the context of <code>b</code>? Should <code>a.test</code> change then too?"}, {"owner": {"reputation": 9584, "user_id": 1420684, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/78242bebaa42db9b1f771e6c19a074fe?s=128&d=identicon&r=PG&f=1", "display_name": "Mirror318", "link": "https://stackoverflow.com/users/1420684/mirror318"}, "reply_to_user": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 0, "creation_date": 1569236126, "post_id": 58060649, "comment_id": 102518357, "body": "@spickermann The idea is that <code>@var</code> belongs to <code>a</code>, but <code>a</code>&#39;s child <code>b</code> can access it. Kind of like a global variable for all children of <code>a</code>"}, {"owner": {"reputation": 48413, "user_id": 1279683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1veuT.jpg?s=128&g=1", "display_name": "Marek Lipka", "link": "https://stackoverflow.com/users/1279683/marek-lipka"}, "edited": false, "score": 0, "creation_date": 1569236226, "post_id": 58060649, "comment_id": 102518403, "body": "@Mirror318 as I wrote, instance variables live on instances, so if you define it on <code>b</code>, it will be defined on <code>b</code>. You just don&#39;t do this in your example, so you shouldn&#39;t expect this to &#39;work&#39;."}, {"owner": {"reputation": 9584, "user_id": 1420684, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/78242bebaa42db9b1f771e6c19a074fe?s=128&d=identicon&r=PG&f=1", "display_name": "Mirror318", "link": "https://stackoverflow.com/users/1420684/mirror318"}, "edited": false, "score": 0, "creation_date": 1569236712, "post_id": 58060649, "comment_id": 102518662, "body": "I have updated the question to (hopefully) clarify what I&#39;m trying to do"}, {"owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "edited": false, "score": 0, "creation_date": 1569237268, "post_id": 58060649, "comment_id": 102518931, "body": "Use composition, not inheritance if you want to depene on a single instance. See my update below."}, {"owner": {"reputation": 152277, "user_id": 438992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/QouOz.jpg?s=128&g=1", "display_name": "Dave Newton", "link": "https://stackoverflow.com/users/438992/dave-newton"}, "edited": false, "score": 1, "creation_date": 1569237825, "post_id": 58060649, "comment_id": 102519242, "body": "It&#39;s unclear <i>why</i> you want to do this--this isn&#39;t how OOP works in Ruby (and most other OOP languages). It sounds like you want a mix of &quot;classical&quot; and prototypal inheritance. While there a variety of hacks it might be better to fit the problem to the language."}, {"owner": {"reputation": 9584, "user_id": 1420684, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/78242bebaa42db9b1f771e6c19a074fe?s=128&d=identicon&r=PG&f=1", "display_name": "Mirror318", "link": "https://stackoverflow.com/users/1420684/mirror318"}, "reply_to_user": {"reputation": 152277, "user_id": 438992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/QouOz.jpg?s=128&g=1", "display_name": "Dave Newton", "link": "https://stackoverflow.com/users/438992/dave-newton"}, "edited": false, "score": 0, "creation_date": 1569239643, "post_id": 58060649, "comment_id": 102520204, "body": "@DaveNewton I&#39;m curious to see how it can be done regardless of whether it <i>should</i> be done. However, the example I have is that a few different classes are reading the same data for their methods. So instead of redundant db queries, I&#39;d like the parent instance to do the query once, and have the children read from it."}, {"owner": {"reputation": 152277, "user_id": 438992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/QouOz.jpg?s=128&g=1", "display_name": "Dave Newton", "link": "https://stackoverflow.com/users/438992/dave-newton"}, "edited": false, "score": 1, "creation_date": 1569262075, "post_id": 58060649, "comment_id": 102531706, "body": "@Mirror318 That doesn&#39;t really explain why you want to do it like <i>this</i>. So far it sounds like simple composition is more what you want, or a factory off of <code>A</code>."}], "answers": [{"comments": [{"owner": {"reputation": 9584, "user_id": 1420684, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/78242bebaa42db9b1f771e6c19a074fe?s=128&d=identicon&r=PG&f=1", "display_name": "Mirror318", "link": "https://stackoverflow.com/users/1420684/mirror318"}, "edited": false, "score": 0, "creation_date": 1569235904, "post_id": 58060738, "comment_id": 102518239, "body": "Right, I just updated the code example. Bugs aside, the question is can I have an object that is a child of an instance of it&#39;s parent class, accessing data?"}, {"owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "reply_to_user": {"reputation": 9584, "user_id": 1420684, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/78242bebaa42db9b1f771e6c19a074fe?s=128&d=identicon&r=PG&f=1", "display_name": "Mirror318", "link": "https://stackoverflow.com/users/1420684/mirror318"}, "edited": false, "score": 0, "creation_date": 1569236046, "post_id": 58060738, "comment_id": 102518319, "body": "Why do you want to do that? Do you want to all <code>B</code> instances do inherit data from some specific <code>A</code> instance?"}], "tags": [], "owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "is_accepted": false, "score": 0, "last_activity_date": 1569237243, "last_edit_date": 1569237243, "creation_date": 1569235628, "answer_id": 58060738, "question_id": 58060649, "link": "https://stackoverflow.com/questions/58060649/ruby-subclasses-using-instance-variables-of-the-parent/58060738#58060738", "title": "Ruby\u2014subclasses using instance variables of the parent", "body": "<p>Your code raises error:</p>\n\n<pre><code>b = B.new\nArgumentError: wrong number of arguments (given 0, expected 1)\nfrom (pry):14:in `initialize'\n</code></pre>\n\n<p><code>B</code> inherits the constructor and requires an argument in the intitialization.</p>\n\n<p>See below:</p>\n\n<pre><code>b = B.new(\"hello\")\n# =&gt; #&lt;B:0x0000555b8b8c20d0 @var=\"hello\"&gt;\nb.test\n# hello\n# =&gt; nil\n</code></pre>\n\n<p>As you can see, the ivar is inherited.</p>\n\n<p>EDIT</p>\n\n<p>In this case, you'd better use composition than inheritance:</p>\n\n<pre><code>class A\n  def initialize(var)\n    @var = var\n  end\n  attr_accessor :var\nend\n\nclass B &lt; A\n  def initialize(a)\n    @a = a\n  end\n\n  def test\n    puts var\n  end\n\n  def var\n    a.var\n  end\n\n  def var=(var)\n    a.var=(var)\n  end\nend\n\n# or with delegation\nclass C &lt; A\n  def initialize(a)\n    @a = a\n  end\n  delegate :var, :var=, to: :a\n\n  def test\n    puts var\n  end\nend\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 9584, "user_id": 1420684, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/78242bebaa42db9b1f771e6c19a074fe?s=128&d=identicon&r=PG&f=1", "display_name": "Mirror318", "link": "https://stackoverflow.com/users/1420684/mirror318"}, "edited": false, "score": 0, "creation_date": 1569236349, "post_id": 58060898, "comment_id": 102518469, "body": "This is in the right direction, but I&#39;m looking for a variable scoped to instances of <code>A</code>. So if there&#39;s <code>a1 = A.new(&#39;one&#39;)</code> and <code>a2 = A.new(&#39;two&#39;)</code>, then all children of <code>a1</code> would see <code>@var == &#39;one&#39;</code> and all children of <code>a2</code> would see <code>@var == &#39;two&#39;</code>"}, {"owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "reply_to_user": {"reputation": 9584, "user_id": 1420684, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/78242bebaa42db9b1f771e6c19a074fe?s=128&d=identicon&r=PG&f=1", "display_name": "Mirror318", "link": "https://stackoverflow.com/users/1420684/mirror318"}, "edited": false, "score": 2, "creation_date": 1569236445, "post_id": 58060898, "comment_id": 102518523, "body": "Classes inherit from classes. But <code>a1</code> and <code>a2</code> are instances. You cannot inherit a class from an instance."}], "tags": [], "owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "is_accepted": false, "score": 1, "last_activity_date": 1569236209, "creation_date": 1569236209, "answer_id": 58060898, "question_id": 58060649, "link": "https://stackoverflow.com/questions/58060649/ruby-subclasses-using-instance-variables-of-the-parent/58060898#58060898", "title": "Ruby\u2014subclasses using instance variables of the parent", "body": "<p>You might want to consider a class variable then:</p>\n\n<pre><code>class A\n  def initialize(var)\n    @@var = var\n  end\nend\n\nclass B &lt; A\n  def initialize\n  end\n\n  def test\n    puts @@var\n  end\nend\n\na = A.new('hello')\n\nb = B.new\nb.test\n#=&gt; 'hello'\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 48413, "user_id": 1279683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1veuT.jpg?s=128&g=1", "display_name": "Marek Lipka", "link": "https://stackoverflow.com/users/1279683/marek-lipka"}, "is_accepted": false, "score": 1, "last_activity_date": 1569237899, "last_edit_date": 1569237899, "creation_date": 1569237197, "answer_id": 58061193, "question_id": 58060649, "link": "https://stackoverflow.com/questions/58060649/ruby-subclasses-using-instance-variables-of-the-parent/58061193#58061193", "title": "Ruby\u2014subclasses using instance variables of the parent", "body": "<p>It's not possible using 'inheritance' as you described, because there's no such thing as inheritance from an instance in Ruby world. But, having said that, you can do some hacking to actually get what (I guess) you need, using <code>delegate</code> (you can do it, because, as you wrote, you're using Rails):</p>\n\n<pre><code>class A\n  attr_reader :var # here, you set method to get `@var` value\n  # ...\nend\n\nclass B &lt; A\n  delegate :var, to: :a # here, you're setting delegator\n\n  attr_reader :a # It's used by line above\n\n  def initialize(a)\n    @a = a\n  end\n\n  def test\n    puts var\n  end\nend\na1 = A.new('one')\na2 = A.new('two')\nb1 = B.new(a1)\nb2 = B.new(a2)\nb3 = B.new(a2)\nb1.test\n# one\nb2.test\n# two\nb3.test\n# two\n</code></pre>\n\n<p>Keep in mind though it's a solution written from scratch, as there's no 'syntatic' way to do this, as there's no inheritance from instances in Ruby world. </p>\n"}, {"comments": [{"owner": {"reputation": 9584, "user_id": 1420684, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/78242bebaa42db9b1f771e6c19a074fe?s=128&d=identicon&r=PG&f=1", "display_name": "Mirror318", "link": "https://stackoverflow.com/users/1420684/mirror318"}, "edited": false, "score": 0, "creation_date": 1569248181, "post_id": 58061838, "comment_id": 102525203, "body": "This is great. One problem is that it will only delegate public methods from the parent class (so it can&#39;t do e.g. private memoization methods). Do you know if there&#39;s a way around this?"}], "tags": [], "owner": {"reputation": 48049, "user_id": 6419007, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/CwqtX.jpg?s=128&g=1", "display_name": "Eric Duminil", "link": "https://stackoverflow.com/users/6419007/eric-duminil"}, "is_accepted": true, "score": 1, "last_activity_date": 1569239432, "creation_date": 1569239432, "answer_id": 58061838, "question_id": 58060649, "link": "https://stackoverflow.com/questions/58060649/ruby-subclasses-using-instance-variables-of-the-parent/58061838#58061838", "title": "Ruby\u2014subclasses using instance variables of the parent", "body": "<p>One quick way to achieve your goal would be to use the little known <a href=\"https://ruby-doc.org/stdlib-2.6.1/libdoc/delegate/rdoc/SimpleDelegator.html\" rel=\"nofollow noreferrer\">SimpleDelegator</a> class:</p>\n\n<pre><code>class A\n  attr_reader :var\n\n  def initialize(var)\n    @var = var\n  end\nend\n\nrequire 'delegate'\n\nclass B &lt; SimpleDelegator\n  def test\n    puts var\n  end\nend\n\na1 = A.new('one')\na2 = A.new('two')\nb1 = B.new(a1)\nb1 = B.new(a1)\nb2 = B.new(a2)\nb3 = B.new(a2)\n\nb3.test\n#=&gt; 'two'\nb2.test\n#=&gt; 'two'\nb1.test\n#=&gt; 'one'\n</code></pre>\n\n<p>This <a href=\"https://blog.lelonek.me/how-to-delegate-methods-in-ruby-a7a71b077d99\" rel=\"nofollow noreferrer\">blog article</a> (\"5 ways of forwarding your work to some other object in Ruby\") might be of interest to you.</p>\n"}, {"tags": [], "owner": {"reputation": 3630, "user_id": 4799659, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153200714295120/picture?type=large", "display_name": "fylooi", "link": "https://stackoverflow.com/users/4799659/fylooi"}, "is_accepted": false, "score": 0, "last_activity_date": 1569249050, "creation_date": 1569249050, "answer_id": 58064682, "question_id": 58060649, "link": "https://stackoverflow.com/questions/58060649/ruby-subclasses-using-instance-variables-of-the-parent/58064682#58064682", "title": "Ruby\u2014subclasses using instance variables of the parent", "body": "<p>One highly unrecommended way to achieve this would be to move the inheritance chain into a dynamic module, eg.</p>\n\n<pre><code>class InheritableState &lt; Module\n  def initialize(key)\n    var_name = \"@@#{key}_state\".to_sym\n\n    define_method :state do \n      return self.class.class_variable_get(var_name) if self.class.class_variable_defined?(var_name)\n      self.class.class_variable_set(var_name, nil)\n    end\n\n    define_method :state= do |val|\n      self.class.class_variable_set(var_name, val)\n    end\n  end\nend\n\nclass A\nend\n\n&gt; a, b, c = A.new, A.new, A.new\n =&gt; [#&lt;A:0x00007fb691944338&gt;, #&lt;A:0x00007fb691944310&gt;, #&lt;A:0x00007fb6919442e8&gt;]\n&gt; a.extend(InheritableState.new(\"abc\")); b.extend(InheritableState.new(\"abc\")); c.extend(InheritableState.new(\"def\"));\n =&gt; #&lt;A:0x00007fb6919442e8&gt;\n&gt; [a.state, b.state, c.state]\n =&gt; [nil, nil, nil]\n&gt; a.state = \"abc\"\n =&gt; \"abc\"\n&gt; [a.state, b.state, c.state]\n =&gt; [\"abc\", \"abc\", nil]\n</code></pre>\n"}], "owner": {"reputation": 9584, "user_id": 1420684, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/78242bebaa42db9b1f771e6c19a074fe?s=128&d=identicon&r=PG&f=1", "display_name": "Mirror318", "link": "https://stackoverflow.com/users/1420684/mirror318"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "accepted_answer_id": 58061838, "answer_count": 5, "score": 1, "last_activity_date": 1569249050, "creation_date": 1569235333, "last_edit_date": 1569237318, "question_id": 58060649, "link": "https://stackoverflow.com/questions/58060649/ruby-subclasses-using-instance-variables-of-the-parent", "title": "Ruby\u2014subclasses using instance variables of the parent", "body": "<pre><code>class A\n  def initialize(var)\n    @var = var\n  end\nend\n\nclass B &lt; A\n  def initialize\n  end\n\n  def test\n    puts @var\n  end\nend\n\na = A.new('hello')\n\nb = B.new\nb.test\n</code></pre>\n\n<p>This code doesn't work, because <code>b</code> inherits from <code>A</code> but not <code>a</code>.</p>\n\n<p>In Ruby (or Rails), how do I get this kind of behavior? Inheritance is useful for sharing methods, can it also share data?</p>\n\n<hr>\n\n<p>UPDATE</p>\n\n<p>This question is a bit confusing, so I will try to clarify.</p>\n\n<p>I want instances of <code>B</code> to inherit not only from the class <code>A</code>, but also from an instance of <code>A</code>. That way, I could do something like this:</p>\n\n<pre><code>a1 = A.new('one')\na2 = A.new('two')\nb1 = a1.B.new # not ruby syntax, but this is why I'm asking the question\nb2 = a2.B.new\nb3 = a2.B.new\n\nb3.test\n#=&gt; 'two'\nb2.test\n#=&gt; 'two'\nb1.test\n#=&gt; 'one'\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "checkbox", "view"], "answers": [{"comments": [{"owner": {"reputation": 599, "user_id": 11544569, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xEqDN.jpg?s=128&g=1", "display_name": "RomanOks", "link": "https://stackoverflow.com/users/11544569/romanoks"}, "edited": false, "score": 0, "creation_date": 1569235589, "post_id": 58060594, "comment_id": 102518094, "body": "But &#39;a1&#39; is just the name of the checkbox, by which I determine its serial number for writing to the database."}, {"owner": {"reputation": 5669, "user_id": 7429104, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/TZAPt.jpg?s=128&g=1", "display_name": "Aman", "link": "https://stackoverflow.com/users/7429104/aman"}, "reply_to_user": {"reputation": 599, "user_id": 11544569, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xEqDN.jpg?s=128&g=1", "display_name": "RomanOks", "link": "https://stackoverflow.com/users/11544569/romanoks"}, "edited": false, "score": 0, "creation_date": 1569235782, "post_id": 58060594, "comment_id": 102518176, "body": "@\u0420\u043e\u043c\u0430\u043d\u041e\u043a\u0441 I guess you are using form_for which is used for any object and so i believe a1, a2 .. should be attributes of the object <code>skill_list </code>."}, {"owner": {"reputation": 5669, "user_id": 7429104, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/TZAPt.jpg?s=128&g=1", "display_name": "Aman", "link": "https://stackoverflow.com/users/7429104/aman"}, "reply_to_user": {"reputation": 599, "user_id": 11544569, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xEqDN.jpg?s=128&g=1", "display_name": "RomanOks", "link": "https://stackoverflow.com/users/11544569/romanoks"}, "edited": false, "score": 0, "creation_date": 1569235886, "post_id": 58060594, "comment_id": 102518226, "body": "@\u0420\u043e\u043c\u0430\u043d\u041e\u043a\u0441 the value stored corresponding to each attribute is compared with the checked and unchecked value and it works the way. Hopefully, you understand it."}], "tags": [], "owner": {"reputation": 5669, "user_id": 7429104, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/TZAPt.jpg?s=128&g=1", "display_name": "Aman", "link": "https://stackoverflow.com/users/7429104/aman"}, "is_accepted": false, "score": 0, "last_activity_date": 1569235156, "creation_date": 1569235156, "answer_id": 58060594, "question_id": 58060438, "link": "https://stackoverflow.com/questions/58060438/how-to-remember-checkbox-status-rails/58060594#58060594", "title": "How to remember checkbox status Rails?", "body": "<p><a href=\"https://apidock.com/rails/ActionView/Helpers/FormHelper/check_box\" rel=\"nofollow noreferrer\">Rails check_box</a></p>\n\n<p>It accepts 2 parameters <code>checked</code> and <code>unchecked</code> value</p>\n\n<p>=> For example, if a1, a2,.. are <code>boolean</code> field then it should be</p>\n\n<pre><code>= f.check_box :a1, {class: 'm-enabled'}, true, false\n</code></pre>\n\n<p>=> For example, if a1, a2,.. are any <code>string</code> field then it should be</p>\n\n<pre><code>= f.check_box :a1, {class: 'm-enabled'}, \"value-for-checked\", \"value-for-unchecked\"  \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 166, "user_id": 10206592, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kKKgn.jpg?s=128&g=1", "display_name": "Meursault", "link": "https://stackoverflow.com/users/10206592/meursault"}, "is_accepted": false, "score": 0, "last_activity_date": 1569429570, "creation_date": 1569429570, "answer_id": 58102980, "question_id": 58060438, "link": "https://stackoverflow.com/questions/58060438/how-to-remember-checkbox-status-rails/58102980#58102980", "title": "How to remember checkbox status Rails?", "body": "<p>Using boolean fields in the UserSkillList table for each skill (Programming, Communication, etc.) will solve your issue. In that case, you will have a form_for the skillset object that can reference these boolean table columns.</p>\n\n<p>Then this would work</p>\n\n<pre><code>= f.check_box(:programming, class: 'm-enabled')\n</code></pre>\n\n<p>If you really want a 'skill list' in the database, use a hash with boolean values, not an array. i.e. {programming:true, communication:false, etc.}. Use 'text' as type.</p>\n\n<p>The only logic connecting your 'serial number' to the name of the skill is the loop that creates the skills array. So it's not really a serial number at all if you  can't locate the reference anywhere.</p>\n"}], "owner": {"reputation": 599, "user_id": 11544569, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xEqDN.jpg?s=128&g=1", "display_name": "RomanOks", "link": "https://stackoverflow.com/users/11544569/romanoks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 106, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1569429570, "creation_date": 1569234611, "last_edit_date": 1569234976, "question_id": 58060438, "link": "https://stackoverflow.com/questions/58060438/how-to-remember-checkbox-status-rails", "title": "How to remember checkbox status Rails?", "body": "<p>My app has a list of skills to choose from. When you click on 'Save', user id and skill id are recorded in the database.</p>\n\n<p><a href=\"https://i.stack.imgur.com/jwMzH.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/jwMzH.png\" alt=\"checkboxes\"></a></p>\n\n<p>If the user visits this page again, all checkboxes are turned off. </p>\n\n<p>How to check from the database so that the selected checkboxes are always included in the view?</p>\n\n<p>My view:</p>\n\n<pre><code>= form_for(:skill_list, url: user_skill_list_index_path) do |f|\n %li\n  = f.check_box(:a1, class: 'm-enabled')\n  = f.label(:a1, 'Programming')\n%li\n  = f.check_box(:a2, class: 'm-enabled')\n  = f.label(:a2, 'Communication')\n%li\n  = f.check_box(:a3, class: 'm-enabled')\n  = f.label(:a3, 'Problem-solving')\n%li\n  = f.check_box(:a4, class: 'm-enabled')\n  = f.label(:a4, 'Teamwork')\n%li\n  = f.check_box(:a5, class: 'm-enabled')\n  = f.label(:a5, 'Creative')\n%li\n  = f.check_box(:a6, class: 'm-enabled')\n  = f.label(:a6, 'Marketing')\n</code></pre>\n\n<p>My controller:</p>\n\n<pre><code>def create\n  @skill_record = UserSkillList.where(user_id: current_user.id).first\n\n  skill_params = params[:skill_list]\n  skills = []\n\n  skill_params.each do |k, v|\n    if v == '1'\n      id = k.dup\n      id.slice!(0).to_i\n      skills &lt;&lt; id\n    end\n  end\n\n  if @skill_record.blank?\n    UserSkillList.create(user_id: current_user.id, skill_id: skills)\n  else\n    @skill_record.update_attributes(skill_id: skills)\n  end\n  redirect_to :back\nend\n</code></pre>\n\n<p>My db record:</p>\n\n<p><a href=\"https://i.stack.imgur.com/u8q0Q.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/u8q0Q.png\" alt=\"db-record\"></a></p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "answers": [{"tags": [], "owner": {"reputation": 3926, "user_id": 2190621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c464f439212bca87517b234f7c9bd3e?s=128&d=identicon&r=PG&f=1", "display_name": "demir", "link": "https://stackoverflow.com/users/2190621/demir"}, "is_accepted": true, "score": 1, "last_activity_date": 1569235994, "last_edit_date": 1569235994, "creation_date": 1569235445, "answer_id": 58060686, "question_id": 58060423, "link": "https://stackoverflow.com/questions/58060423/compare-2-different-arrays-with-same-indexer-but-different-amount-of-values-in/58060686#58060686", "title": "Compare 2 different arrays with same indexer but different amount of values in", "body": "<p>Try this:</p>\n\n<pre><code>b_indexes = b.map(&amp;:first)\na.delete_if { |arr| b_indexes.include?(arr.first) }\n#~&gt; [\n      [\"01000340001001\", 0, 1122, \"Triju vai vair\u2500\u00fcku dz\u2500\u00bdvok\u2500\u255du m\u2500\u00fcjas\", \"Dz\u2500\u00bdvojam\u2500\u00fc \u2500\u014dka\", 27, \"Aleksandra \u2500\u012baka iela 110, R\u2500\u00bdga\"],\n      [\"01000340002005\", 0, 1252, \"Noliktavas, rezervu\u2500\u00fcri, bunkuri un silosi\", \"Noliktava\", 1, \"Aleksandra \u2500\u012baka iela 108B, R\u2500\u00bdga\"],\n      [\"01000340002008\", 0, 1274, \"Citas, iepriek\u253c\u012a neklasific\u2500\u014dtas, \u2500\u014dkas\", \"Nojume\", 0, nil]\n    ]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "is_accepted": false, "score": 0, "last_activity_date": 1569241096, "creation_date": 1569241096, "answer_id": 58062280, "question_id": 58060423, "link": "https://stackoverflow.com/questions/58060423/compare-2-different-arrays-with-same-indexer-but-different-amount-of-values-in/58062280#58062280", "title": "Compare 2 different arrays with same indexer but different amount of values in", "body": "<p>It seems that elements of <code>a</code> differs from elements of <code>b</code> for having a string more as last element.</p>\n\n<p>So, you could just <a href=\"https://ruby-doc.org/core-2.6.4/Array.html#method-i-reject-21\" rel=\"nofollow noreferrer\">Array#reject!</a> comparing the whole element of <code>b</code>:</p>\n\n<pre><code>a.reject! { |e| b.include? e[0...-1] }\n</code></pre>\n\n<p>But if only the first element of each nested array is the signal, mapping <code>b</code> against the first element before and then rejecting elements based on that map is the correct way.</p>\n\n<p>Note that Array#reject! affects the original array.</p>\n"}, {"tags": [], "owner": {"reputation": 73209, "user_id": 290394, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d7908f05c89e965f6bc5308ad6f41256?s=128&d=identicon&r=PG", "display_name": "steenslag", "link": "https://stackoverflow.com/users/290394/steenslag"}, "is_accepted": false, "score": 0, "last_activity_date": 1569248665, "creation_date": 1569248665, "answer_id": 58064590, "question_id": 58060423, "link": "https://stackoverflow.com/questions/58060423/compare-2-different-arrays-with-same-indexer-but-different-amount-of-values-in/58064590#58064590", "title": "Compare 2 different arrays with same indexer but different amount of values in", "body": "<p><a href=\"https://docs.ruby-lang.org/en/2.6.0/Array.html#method-i-assoc\" rel=\"nofollow noreferrer\">assoc</a> is nice for this:</p>\n\n<pre><code>p b.map{|ar| a.assoc(ar.first)}\n</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 10927701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5eef80517111079e3b8b8ecf3a347972?s=128&d=identicon&r=PG&f=1", "display_name": "Marshmello", "link": "https://stackoverflow.com/users/10927701/marshmello"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "accepted_answer_id": 58060686, "answer_count": 3, "score": 1, "last_activity_date": 1569248665, "creation_date": 1569234571, "question_id": 58060423, "link": "https://stackoverflow.com/questions/58060423/compare-2-different-arrays-with-same-indexer-but-different-amount-of-values-in", "title": "Compare 2 different arrays with same indexer but different amount of values in", "body": "<p>looking for your help.</p>\n\n<p>I do have 2 arrays</p>\n\n<pre><code>a = [[\"01000340001001\", 0, 1122, \"Triju vai vair\u2500\u00fcku dz\u2500\u00bdvok\u2500\u255du m\u2500\u00fcjas\", \"Dz\u2500\u00bdvojam\u2500\u00fc \u2500\u014dka\", 27, \"Aleksandra \u2500\u012baka iela 110, R\u2500\u00bdga\"], [\"01000340002001\", 0, 1122, \"Triju vai vair\u2500\u00fcku dz\u2500\u00bdvok\u2500\u255du m\u2500\u00fcjas\", \"Dz\u2500\u00bdvojam\u2500\u00fc \u2500\u014dka\", 15, \"Aleksandra \u2500\u012baka iela 108, R\u2500\u00bdga\"], [\"01000340002002\", 0, 1122, \"Triju vai vair\u2500\u00fcku dz\u2500\u00bdvok\u2500\u255du m\u2500\u00fcjas\", \"Dz\u2500\u00bdvojam\u2500\u00fc \u2500\u014dka\", 4, \"Aleksandra \u2500\u012baka iela 108, R\u2500\u00bdga\"], [\"01000340002005\", 0, 1252, \"Noliktavas, rezervu\u2500\u00fcri, bunkuri un silosi\", \"Noliktava\", 1, \"Aleksandra \u2500\u012baka iela 108B, R\u2500\u00bdga\"], [\"01000340002006\", 0, 1252, \"Noliktavas, rezervu\u2500\u00fcri, bunkuri un silosi\", \"Noliktava\", 1, \"Aleksandra \u2500\u012baka iela 108, R\u2500\u00bdga\"], [\"01000340002006\", 0, 1252, \"Noliktavas, rezervu\u2500\u00fcri, bunkuri un silosi\", \"Noliktava\", 1, \"Aleksandra \u2500\u012baka iela 108B, R\u2500\u00bdga\"], [\"01000340002008\", 0, 1274, \"Citas, iepriek\u253c\u012a neklasific\u2500\u014dtas, \u2500\u014dkas\", \"Nojume\", 0, nil]]\n</code></pre>\n\n<p>Another one</p>\n\n<pre><code>b = [[\"01000340002001\", 0, 1122, \"Triju vai vair\u2500\u00fcku dz\u2500\u00bdvok\u2500\u255du m\u2500\u00fcjas\", \"Dz\u2500\u00bdvojam\u2500\u00fc \u2500\u014dka\", 15], [\"01000340002002\", 0, 1122, \"Triju vai vair\u2500\u00fcku dz\u2500\u00bdvok\u2500\u255du m\u2500\u00fcjas\", \"Dz\u2500\u00bdvojam\u2500\u00fc \u2500\u014dka\", 4], [\"01000340002006\", 0, 1252, \"Noliktavas, rezervu\u2500\u00fcri, bunkuri un silosi\", \"Noliktava\", 1]]\n</code></pre>\n\n<p>I need to remove from <code>a</code> those arrays, that are in <code>b</code> by indexers as i think(e.g. remove duplicated).</p>\n\n<p>What i was trying is to do this</p>\n\n<pre><code>all = []\nall = a.collect {|key, value | key} - b.collect {|key, value | key}\n# [\"01000340002005\", \"01000340001001\", \"01000340002008\"]\n</code></pre>\n\n<p>And then select arrays that i need</p>\n\n<pre><code>a.select { |key, value| key == b }\n# [\"01000340002008\", 0, 1274, \"Citas, iepriek\u253c\u012a neklasific\u2500\u014dtas, \u2500\u014dkas\", \"Nojume\", 0, nil]\n</code></pre>\n\n<p>As outcome i get only 1 array, but should 3.</p>\n\n<p>Could someone please suggest me how to make it work? :)</p>\n"}, {"tags": ["json", "ruby", "parsing", "hash", "extract"], "comments": [{"owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "edited": false, "score": 0, "creation_date": 1569233622, "post_id": 58060021, "comment_id": 102517073, "body": "What error is raised? Which line from? Could you paste the stacktrace?"}, {"owner": {"reputation": 21, "user_id": 12106146, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-uKQxLZyDiIk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reWnTaRP-Ju3UgvfVceNON09uSNLQ/photo.jpg?sz=128", "display_name": "Dean E", "link": "https://stackoverflow.com/users/12106146/dean-e"}, "reply_to_user": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "edited": false, "score": 0, "creation_date": 1569256461, "post_id": 58060021, "comment_id": 102529503, "body": "Thank you @mrzasa. I updated your code, but now I am getting Nil values in the console  $uri = &quot;URL&quot;   $json_string = RestClient.get &quot;#{$uri}&quot;, {:content_type =&gt; &#39;application/json&#39;}   $hash = JSON.parse($json_string)   puts $hash.first&amp;.dig(:restriction)&amp;.first&amp;.dig(:restrictionTypeC&zwnj;&#8203;ode)   puts $hash.flat_map { |hsh| hsh[:restriction]&amp;.map { |sub_hsh| sub_hsh[:restrictionTypeCode] } } . When I output the $json_string or the hash I can see the entire response. But when I output the 2 lines that you provided, I get empty 2 lines in the console for both &quot;puts&quot; above"}, {"owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "edited": false, "score": 0, "creation_date": 1569263088, "post_id": 58060021, "comment_id": 102532118, "body": "it&#39;s not me, it&#39;s @SRack that helps you :)"}], "answers": [{"comments": [{"owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "edited": false, "score": 1, "creation_date": 1569233710, "post_id": 58060138, "comment_id": 102517118, "body": "<code>hash.first[&#39;restriction&#39;].first[&#39;restrictionTypeCode&#39;]</code>"}, {"owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "edited": false, "score": 0, "creation_date": 1569233736, "post_id": 58060138, "comment_id": 102517131, "body": "Also most probably symbols, not strings as keys"}, {"owner": {"reputation": 8640, "user_id": 4055042, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/cd04c63d95d27033b53d4d83fea40c02?s=128&d=identicon&r=PG&f=1", "display_name": "SRack", "link": "https://stackoverflow.com/users/4055042/srack"}, "reply_to_user": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "edited": false, "score": 0, "creation_date": 1569233773, "post_id": 58060138, "comment_id": 102517148, "body": "Thanks @mrzasa - good catch. I&#39;ll update. Much appreciated :)"}, {"owner": {"reputation": 8640, "user_id": 4055042, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/cd04c63d95d27033b53d4d83fea40c02?s=128&d=identicon&r=PG&f=1", "display_name": "SRack", "link": "https://stackoverflow.com/users/4055042/srack"}, "reply_to_user": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "edited": false, "score": 0, "creation_date": 1569407463, "post_id": 58060138, "comment_id": 102584832, "body": "How did you get on with this @DeanE?"}], "tags": [], "owner": {"reputation": 8640, "user_id": 4055042, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/cd04c63d95d27033b53d4d83fea40c02?s=128&d=identicon&r=PG&f=1", "display_name": "SRack", "link": "https://stackoverflow.com/users/4055042/srack"}, "is_accepted": false, "score": 3, "last_activity_date": 1569234460, "last_edit_date": 1569234460, "creation_date": 1569233635, "answer_id": 58060138, "question_id": 58060021, "link": "https://stackoverflow.com/questions/58060021/cant-extract-data-from-parsed-json-hash-in-ruby/58060138#58060138", "title": "Can&#39;t extract data from parsed JSON Hash in ruby", "body": "<p>Your problem is your data is returning arrays in places. Try the following: </p>\n\n<pre><code>data = [\n  {\n    \"ID\": \"295699\",\n    \"restriction\": [\n      {\n        \"restrictionTypeCode\": \"10001\"\n      }\n    ]\n  }\n]\n\ndata.first[:restriction].first[:restrictionTypeCode]\n# to make this safe from any nil values you may encounter, you might want to use\ndata.first&amp;.dig(:restriction)&amp;.first&amp;.dig(:restrictionTypeCode)\n# =&gt; \"10001\"\n\n#\u00a0or \n\ndata.flat_map { |hsh| hsh[:restriction]&amp;.map { |sub_hsh| sub_hsh[:restrictionTypeCode] } }\n# =&gt; [\"10001\"]\n</code></pre>\n\n<p>To break it down a little, your top level response and that falling under the key <code>:restriction</code> both return arrays; therefore, to get the data from them you either need to access one of the items they contain (in my example using <code>first</code>) or map them (the second example).</p>\n\n<p>I've added some checks for <code>nil</code> values in there: this is pretty vital when dealing with API responses as you're not in control of the data so can't be certain all the fields will be present. Rather than throw an error should you encounter data like this, you'll get <code>nil</code> returned to avoid breaking subsequent code.</p>\n\n<p>Hope this helps - let me know how you get on or if you have any questions :)</p>\n"}], "owner": {"reputation": 21, "user_id": 12106146, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-uKQxLZyDiIk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reWnTaRP-Ju3UgvfVceNON09uSNLQ/photo.jpg?sz=128", "display_name": "Dean E", "link": "https://stackoverflow.com/users/12106146/dean-e"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1569234460, "creation_date": 1569233170, "question_id": 58060021, "link": "https://stackoverflow.com/questions/58060021/cant-extract-data-from-parsed-json-hash-in-ruby", "title": "Can&#39;t extract data from parsed JSON Hash in ruby", "body": "<p>I am trying to extract elements from this API response, but I am not able to for some reason. I have the following API response body: \n`</p>\n\n<pre><code>[\n  {\n    \"ID\": \"295699\",\n    \"restriction\": [\n      {\n        \"restrictionTypeCode\": \"10001\"\n      }\n    ]\n  }\n]\n</code></pre>\n\n<p>`\nNow, I simply want to print restrictionTypeCode</p>\n\n<pre><code>  json_string = RestClient.get \"#{$uri}\", {:content_type =&gt; 'application/json'}\n  hash = JSON.parse(json_string) \n  code= hash['restriction']['restrictionTypeCode']\n  puts code\n</code></pre>\n\n<p>the above code errors out and it doesn't display the restrictionTypeCode</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "httparty"], "comments": [{"owner": {"reputation": 75558, "user_id": 544825, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/UFdOO.png?s=128&g=1", "display_name": "max", "link": "https://stackoverflow.com/users/544825/max"}, "edited": false, "score": 2, "creation_date": 1569239535, "post_id": 58059520, "comment_id": 102520144, "body": "<code>HTTParty#post</code> is just a thin wrapper around <code>Net::HTTP::Post</code> from the stdlib. If you really want to post formdata use <code>Net::HTTP.post_form</code> which will encode the body for you."}, {"owner": {"reputation": 51, "user_id": 4198075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1d8ff2fc09b93dc890f0351e714cad2?s=128&d=identicon&r=PG&f=1", "display_name": "bmes", "link": "https://stackoverflow.com/users/4198075/bmes"}, "reply_to_user": {"reputation": 75558, "user_id": 544825, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/UFdOO.png?s=128&g=1", "display_name": "max", "link": "https://stackoverflow.com/users/544825/max"}, "edited": false, "score": 0, "creation_date": 1569306858, "post_id": 58059520, "comment_id": 102543697, "body": "Thanks! This solved my problem and the request is now sent in correct form to the API in question."}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 4198075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1d8ff2fc09b93dc890f0351e714cad2?s=128&d=identicon&r=PG&f=1", "display_name": "bmes", "link": "https://stackoverflow.com/users/4198075/bmes"}, "edited": false, "score": 0, "creation_date": 1569307003, "post_id": 58062153, "comment_id": 102543770, "body": "I tried this, but it resulted in bad request. Didn&#39;t know this Postman feature though, it will be handy in the future. max&#39;s comment in the question solved the problem."}], "tags": [], "owner": {"reputation": 6122, "user_id": 946500, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fqdcn.jpg?s=128&g=1", "display_name": "Pavel Oganesyan", "link": "https://stackoverflow.com/users/946500/pavel-oganesyan"}, "is_accepted": false, "score": 0, "last_activity_date": 1569240633, "creation_date": 1569240633, "answer_id": 58062153, "question_id": 58059520, "link": "https://stackoverflow.com/questions/58059520/how-to-send-httparty-post-call-with-body-values-as-form-data/58062153#58062153", "title": "How to send HTTParty POST call with body values as form-data", "body": "<p>If you want just to make a copy of Postman request, you could try Postman code generation tool.</p>\n\n<p><a href=\"https://learning.getpostman.com/docs/postman/sending_api_requests/generate_code_snippets/\" rel=\"nofollow noreferrer\">Description</a></p>\n\n<p><a href=\"https://i.stack.imgur.com/3nNH4.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/3nNH4.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 51, "user_id": 4198075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1d8ff2fc09b93dc890f0351e714cad2?s=128&d=identicon&r=PG&f=1", "display_name": "bmes", "link": "https://stackoverflow.com/users/4198075/bmes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1728, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1569240633, "creation_date": 1569231249, "question_id": 58059520, "link": "https://stackoverflow.com/questions/58059520/how-to-send-httparty-post-call-with-body-values-as-form-data", "title": "How to send HTTParty POST call with body values as form-data", "body": "<p>I have a RoR application from where I need to call a 3rd party API with several different calls. GET requests work fine with both Postman and HTTParty, but I can't get POST to work with latter. In Postman, I have a default request with <em>basic auth</em>, <em>headers</em> and a half dozen parameters in the <em>body</em> with the default form-data option.</p>\n\n<p>The Postman request works fine, but I've been having hard time to replicate the request to HTTParty, leading to the API responding with error as parameters are missing.</p>\n\n<p>Here's some of the code I've been working with to no avail:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>options = { headers: {\"Accept\"=&gt;\"application/json\", \"Content-Type\"=&gt;\"application/json\"}, \n:debug_output =&gt; $stdout, body: { \"param1\" =&gt; 1, \"param2\" =&gt; 5, \n\"param3\" =&gt; 'foo', \"param4\" =&gt; 'bar', \"param5\" =&gt; 'test' }\n.to_json, \nbasic_auth: {:username=&gt;'censored', :password=&gt;'censored'} }\n\nresponse = HTTParty.post(\"#{Settings.api_url}\", options)\n\nopening connection to ...\nopened\nstarting SSL for ...\nSSL established\n&lt;- \"POST ... HTTP/1.1\\r\\nAccept: application/json\\r\\n\nContent-Type: application/json\\r\\nAuthorization: Basic censored\\r\\nConnection: close\\r\\n\nHost: www.censored.com\\r\\n\nContent-Length: 113\\r\\n\\r\\n\"\n&lt;- \"{\\\"param1\\\":1,\\\"param2\\\":5,\\\"param3\\\":\\\"foo\\\",\\\"param4\\\":\\\"bar\\\",\\\"param5\\\":\\\"test\\\"}\"\n-&gt; \"HTTP/1.1 200 OK\\r\\n\"\n-&gt; \"Server: Apache\\r\\n\"\n-&gt; \"Set-Cookie: PHPSESSID=...; path=/\\r\\n\"\n-&gt; \"Expires: Thu, 19 Nov 1981 08:52:00 GMT\\r\\n\"\n-&gt; \"Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0\\r\\n\"\n-&gt; \"Pragma: no-cache\\r\\n\"\n-&gt; \"Content-Length: 61\\r\\n\"\n-&gt; \"Connection: close\\r\\n\"\n-&gt; \"Content-Type: application/json\\r\\n\"\n-&gt; \"\\r\\n\"\nreading 61 bytes...\n</code></pre>\n\n<p>and then comes the error response. I tried with various combinations regarding body, also trying to set Accept and Content-Type headers to multipart/formdata but didn't get it working. How could I replicate the Postman request?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "wicked-pdf"], "answers": [{"tags": [], "owner": {"reputation": 595, "user_id": 3632472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e431a79c8cf18fc5c29ebb94a721dda?s=128&d=identicon&r=PG&f=1", "display_name": "Rakesh", "link": "https://stackoverflow.com/users/3632472/rakesh"}, "is_accepted": false, "score": 0, "last_activity_date": 1569232427, "creation_date": 1569232427, "answer_id": 58059819, "question_id": 58059432, "link": "https://stackoverflow.com/questions/58059432/how-to-give-custom-margin-for-coverpage-with-wicked-pdf-in-ruby-on-rails/58059819#58059819", "title": "how to give custom margin for coverpage with wicked_pdf in ruby on rails", "body": "<p>The headers and footers and margins are global to the PDF created, so you can't tweak the cover page independently.</p>\n\n<p>However, you can create two PDFs, one of just the cover, and one of the rest and combine them with Ghostscript or PDFtk.</p>\n\n<pre><code>html_content = render_to_string\ncover_pdf = WickedPdf.new.pdf_from_string(html_content, { footer: { margin: { bottom: 200 })\nbody_pdf = WickedPdf.new.pdf_from_string(html_content, { footer: { margin: { bottom: 10 })\n\ncover_src_temp_file = Tempfile.new(['cover_src', '.pdf'])\ncover_src_temp_file.binmode\ncover_src_temp_file.write(cover_pdf)\ncover_src_temp_file.rewind\ncover_temp_file = Tempfile.new(cover_pdf)\n`pdftk #{cover_src_temp_file} cat 1 output #{cover_temp_file.path.to_s}` # first page only\n\nbody_src_temp_file = Tempfile.new(['body_src', '.pdf'])\nbody_src_temp_file.binmode\nbody_src_temp_file.write(cover_pdf)\nbody_src_temp_file.rewind\nbody_temp_file = Tempfile.new(body_pdf)\n`pdftk #{body_src_temp_file.path} cat 2-end output #{body_temp_file.path}` # everything else\n\noutput_temp_file = Tempfile.new(['output', '.pdf'])\n`pdftk #{cover_temp_file.path} #{body_temp_file.path} cat output #{output_temp_file.path}`\nsend_file output_temp_file, disposition: 'inline'\n\n[cover_src_temp_file, body_src_temp_file, cover_temp_file, body_temp_file, output_temp_file].each do |tf|\ntf.close\ntf.unlink\nend\n</code></pre>\n\n<p>Source - <a href=\"https://github.com/mileszs/wicked_pdf/issues/572#issuecomment-245044036\" rel=\"nofollow noreferrer\">https://github.com/mileszs/wicked_pdf/issues/572#issuecomment-245044036</a></p>\n"}], "owner": {"reputation": 1, "user_id": 5719965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eeeb56fdd2e8bc6d2679e39d50215f9d?s=128&d=identicon&r=PG&f=1", "display_name": "ksk95", "link": "https://stackoverflow.com/users/5719965/ksk95"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 165, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1569232427, "creation_date": 1569230898, "question_id": 58059432, "link": "https://stackoverflow.com/questions/58059432/how-to-give-custom-margin-for-coverpage-with-wicked-pdf-in-ruby-on-rails", "title": "how to give custom margin for coverpage with wicked_pdf in ruby on rails", "body": "<p>i don't want margin for the fist page on generating PDF</p>\n\n<p>this is the ruby code to generate the pdf</p>\n\n<pre><code>  def files\n    respond_to do |format|\n      format.html\n      format.pdf do\n        render pdf: params[:filename],\n               page_size: 'A4',\n               dpi: '300',\n               user_style_sheet: '../assets/stylesheet/quotation.css',\n               margin:  {\n                top:               0,\n                bottom:            0,\n                left:              0,\n                right:             0\n              }\n      end\n    end\n  end\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "arrays", "ruby"], "comments": [{"owner": {"reputation": 48413, "user_id": 1279683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1veuT.jpg?s=128&g=1", "display_name": "Marek Lipka", "link": "https://stackoverflow.com/users/1279683/marek-lipka"}, "edited": false, "score": 1, "creation_date": 1569225703, "post_id": 58057939, "comment_id": 102513202, "body": "Your question is unclear. <code>[&#39;005&#39;, 1, 1434, &#39;buve&#39;, &#39;eka, &#39;27&#39;, &#39;110A&#39;]</code> is an example value that exists in first table but does not in other. Should it be in result table?"}, {"owner": {"reputation": 2251, "user_id": 9785060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IUduC.png?s=128&g=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/9785060/viktor"}, "edited": false, "score": 0, "creation_date": 1569231528, "post_id": 58057939, "comment_id": 102516072, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/1192186/subtracting-one-array-from-another-in-ruby\">Subtracting one Array from another in Ruby</a>"}, {"owner": {"reputation": 157, "user_id": 12105661, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83c6776a7cfc40cf45c67793b0b8efd4?s=128&d=identicon&r=PG&f=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/12105661/viktor"}, "reply_to_user": {"reputation": 2251, "user_id": 9785060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IUduC.png?s=128&g=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/9785060/viktor"}, "edited": false, "score": 0, "creation_date": 1569231898, "post_id": 58057939, "comment_id": 102516263, "body": "@\u0412\u0438\u043a\u0442\u043e\u0440 Not really. can&#39;t agree with you.I&#39;ve forgotten that the in these 2 arrays are not the same(amount of values in array and the values of them), except the first value(index)(I&#39;ve fixed the post). So now things are more complicated."}, {"owner": {"reputation": 2251, "user_id": 9785060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IUduC.png?s=128&g=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/9785060/viktor"}, "edited": false, "score": 1, "creation_date": 1569232142, "post_id": 58057939, "comment_id": 102516403, "body": "That&#39;s a horrible way to do things. You posted a question, went afk, got 6 answers and then came back to change the question completely? You have to value other people&#39;s time and effort in helping you. The best thing you can do is accept an answer that answers your original question and then make a new question better worded and more clearly. Make sure to include proper examples (not just one) next time."}, {"owner": {"reputation": 157, "user_id": 12105661, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83c6776a7cfc40cf45c67793b0b8efd4?s=128&d=identicon&r=PG&f=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/12105661/viktor"}, "reply_to_user": {"reputation": 2251, "user_id": 9785060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IUduC.png?s=128&g=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/9785060/viktor"}, "edited": false, "score": 0, "creation_date": 1569232278, "post_id": 58057939, "comment_id": 102516463, "body": "@\u0412\u0438\u043a\u0442\u043e\u0440 Without blamelessly, please. If I were unable to answer at once, then I was away from my PC."}], "answers": [{"tags": [], "owner": {"reputation": 3926, "user_id": 2190621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c464f439212bca87517b234f7c9bd3e?s=128&d=identicon&r=PG&f=1", "display_name": "demir", "link": "https://stackoverflow.com/users/2190621/demir"}, "is_accepted": true, "score": 3, "last_activity_date": 1569231698, "last_edit_date": 1569231698, "creation_date": 1569225858, "answer_id": 58058061, "question_id": 58057939, "link": "https://stackoverflow.com/questions/58057939/get-difference-between-2d-arrays/58058061#58058061", "title": "Get difference between 2D arrays", "body": "<p>You can use the <code>-</code> operator</p>\n\n<pre><code>a = [[\"001\", 1, 3333, \"maja\", \"eka\", 17, \"110B\"], [\"005\", 1, 1434, \"buve\", \"eka\", 27, \"110A\"], [\"008\", 1, 1111, \"maja\", \"\", 31, \"110\"]]\nb = [[\"001\", 1, 3333, \"maja\", \"eka\", 17, \"110B\"], [\"007\", 1, 3381, \"buve\", \"eka\", 31, \"110\"], [\"009\", 1, 2824, \"maja\", \"\", 28, \"110C\"]]\n\n# You can find the difference between the arrays with - operator\na - b \n#~&gt; [[\"005\", 1, 1434, \"buve\", \"eka\", 27, \"110A\"], [\"008\", 1, 1111, \"maja\", \"\", 31, \"110\"]]\nb - a \n#~&gt; [[\"007\", 1, 3381, \"buve\", \"eka\", 31, \"110\"], [\"009\", 1, 2824, \"maja\", \"\", 28, \"110C\"]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 48413, "user_id": 1279683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1veuT.jpg?s=128&g=1", "display_name": "Marek Lipka", "link": "https://stackoverflow.com/users/1279683/marek-lipka"}, "is_accepted": false, "score": 0, "last_activity_date": 1569225922, "creation_date": 1569225922, "answer_id": 58058081, "question_id": 58057939, "link": "https://stackoverflow.com/questions/58057939/get-difference-between-2d-arrays/58058081#58058081", "title": "Get difference between 2D arrays", "body": "<blockquote>\n  <p>to get the values that exist in one array and don't exist in another one</p>\n</blockquote>\n\n<p>To get this result, you don't have to write your own solution, all you need is:</p>\n\n<pre><code>(a1 - a2) + (a2 - a1)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384, "user_id": 7365329, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/DjrN8.gif?s=128&g=1", "display_name": "Touqeer", "link": "https://stackoverflow.com/users/7365329/touqeer"}, "is_accepted": false, "score": 0, "last_activity_date": 1569227059, "creation_date": 1569227059, "answer_id": 58058383, "question_id": 58057939, "link": "https://stackoverflow.com/questions/58057939/get-difference-between-2d-arrays/58058383#58058383", "title": "Get difference between 2D arrays", "body": "<pre><code>a = [[\"001\", 1, 3333, \"maja\", \"eka\", 17, \"110B\"], [\"005\", 1, 1434, \"buve\", \"eka\", 27, \"110A\"], [\"008\", 1, 1111, \"maja\", \"\", 31, \"110\"]]\nb = [[\"001\", 1, 3333, \"maja\", \"eka\", 17, \"110B\"], [\"007\", 1, 3381, \"buve\", \"eka\", 31, \"110\"], [\"009\", 1, 2824, \"maja\", \"\", 28, \"110C\"]]\n</code></pre>\n\n<p>if you use <code>a[0] - b[0]</code> it will give array that has <strong>a's</strong> values but not <strong>b's</strong>.\nif you use <code>b[0] - a[0]</code> it will give array that has <strong>b's</strong> values but not <strong>a's</strong>.\nto get unique values from both array you use should do <code>((a[0] - b[0]) - (a[0] - b[0])).uniq</code></p>\n\n<pre><code>a.each_with_index.map{|arr, index| ((arr - b[index]) + (b[index] - arr)).uniq }.reject!(&amp;:empty?)\n</code></pre>\n\n<p><em>(supposing both array are of same size)</em></p>\n"}, {"tags": [], "owner": {"reputation": 358, "user_id": 8708097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/APLHT.jpg?s=128&g=1", "display_name": "Saif chaudhry", "link": "https://stackoverflow.com/users/8708097/saif-chaudhry"}, "is_accepted": false, "score": 0, "last_activity_date": 1569228669, "creation_date": 1569228669, "answer_id": 58058803, "question_id": 58057939, "link": "https://stackoverflow.com/questions/58057939/get-difference-between-2d-arrays/58058803#58058803", "title": "Get difference between 2D arrays", "body": "<p><strong>Simplest Example</strong> </p>\n\n<pre><code>a1 = [[1,2,3],[1,2]] \na2 = [[1,2,3],[1,3]]\na1-a2\n[[1, 2]] \na2-a1\n[[1, 3]] \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8640, "user_id": 4055042, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/cd04c63d95d27033b53d4d83fea40c02?s=128&d=identicon&r=PG&f=1", "display_name": "SRack", "link": "https://stackoverflow.com/users/4055042/srack"}, "is_accepted": false, "score": 0, "last_activity_date": 1569229900, "last_edit_date": 1569229900, "creation_date": 1569228962, "answer_id": 58058879, "question_id": 58057939, "link": "https://stackoverflow.com/questions/58057939/get-difference-between-2d-arrays/58058879#58058879", "title": "Get difference between 2D arrays", "body": "<p>To get the difference between the subarrays you'll need to iterate. I believe this offers the best solution for brevity and performance, as others deal with flat arrays, leave unneeded elements or iterate multiple times. </p>\n\n<p>Here's how:</p>\n\n<p>If you're using Ruby 2.7: </p>\n\n<pre><code>a = [[\"001\", 1, 3333, \"maja\", \"eka\", 17, \"110B\"], [\"005\", 1, 1434, \"buve\", \"eka\", 27, \"110A\"], [\"008\", 1, 1111, \"maja\", \"\", 31, \"110\"]]\nb = [[\"001\", 1, 3333, \"maja\", \"eka\", 17, \"110B\"], [\"007\", 1, 3381, \"buve\", \"eka\", 31, \"110\"], [\"009\", 1, 2824, \"maja\", \"\", 28, \"110C\"]]\n\na.map.with_index { |arr, i| b[i].difference(arr) }\n# =&gt; [[], [\"007\", 3381, 31, \"110\"], [\"009\", 2824, 28, \"110C\"]]\n</code></pre>\n\n<p>Or before 2.7:</p>\n\n<pre><code>a.map.with_index { |arr, i| b[i] - arr }\n# =&gt; [[], [\"007\", 3381, 31, \"110\"], [\"009\", 2824, 28, \"110C\"]]\n</code></pre>\n\n<p>If you need to avoid having the empty arrays appearing where results are identical, you can tweak a bit:</p>\n\n<pre><code># Ruby 2.7\na.filter_map.with_index do |arr, i|\n  diff = b[i].difference(arr)\n  diff if diff.any?\nend\n# =&gt; [[\"007\", 3381, 31, \"110\"], [\"009\", 2824, 28, \"110C\"]]\n\n# &lt; Ruby 2.7\na.each_with_object([]).with_index do |(arr, results), i|\n  diff = b[i] - arr\n  results &lt;&lt; diff if diff.any?\nend\n# =&gt; [[\"007\", 3381, 31, \"110\"], [\"009\", 2824, 28, \"110C\"]]\n</code></pre>\n\n<p>Hope that helps - let me know how you get on or if you have any questions.</p>\n"}, {"tags": [], "owner": {"reputation": 2566, "user_id": 1578898, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13d8e2260005e30e823d507385019735?s=128&d=identicon&r=PG", "display_name": "vidur punj", "link": "https://stackoverflow.com/users/1578898/vidur-punj"}, "is_accepted": false, "score": 0, "last_activity_date": 1569229545, "creation_date": 1569229545, "answer_id": 58059053, "question_id": 58057939, "link": "https://stackoverflow.com/questions/58057939/get-difference-between-2d-arrays/58059053#58059053", "title": "Get difference between 2D arrays", "body": "<p>The desired solution is as:</p>\n\n<pre><code>    irb&gt; a = [[\"001\", 1, 3333, \"maja\", \"eka\", 17, \"110B\"], [\"005\", 1, 1434, \"buve\", \"eka\", 27, \"110A\"], [\"008\", 1, 1111, \"maja\", \"\", 31, \"110\"]]\n    irb&gt; b = [[\"001\", 1, 3333, \"maja\", \"eka\", 17, \"110B\"], [\"007\", 1, 3381, \"buve\", \"eka\", 31, \"110\"], [\"009\", 1, 2824, \"maja\", \"\", 28, \"110C\"]]\n    irb&gt; b-a\n         =&gt; [[\"007\", 1, 3381, \"buve\", \"eka\", 31, \"110\"], [\"009\", 1, 2824, \"maja\", \"\", 28, \"110C\"]] \n</code></pre>\n"}], "owner": {"reputation": 157, "user_id": 12105661, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83c6776a7cfc40cf45c67793b0b8efd4?s=128&d=identicon&r=PG&f=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/12105661/viktor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 58058061, "answer_count": 6, "score": -1, "last_activity_date": 1569232901, "creation_date": 1569225482, "last_edit_date": 1569232901, "question_id": 58057939, "link": "https://stackoverflow.com/questions/58057939/get-difference-between-2d-arrays", "title": "Get difference between 2D arrays", "body": "<p>I'm having troubles with 2D arrays to get the values that exist in one array and don't exist in another one.</p>\n\n<p>We have 2 arrays</p>\n\n<pre><code>[[\"001\", 1, 3333, \"maja\", \"eka\", 17, \"110B\"], [\"005\", 1, 1434, \"buve\", \"eka\", 27, \"110A\"], [\"008\", 1, 1111, \"maja\", \"\", 31, \"110\"]]\n</code></pre>\n\n<p>And the second one</p>\n\n<pre><code>[[\"001\", 1, 3333, \"maja\", \"eka\", 17, \"110B\"], [\"007\", 1, 3381, \"buve\", \"eka\", 31, \"110\"], [\"009\", 1, 2824, \"maja\", \"\", 28, \"110C\"]]\n</code></pre>\n\n<p>So the output should be the</p>\n\n<pre><code>[[\"007\", 1, 3381, \"buve\", \"eka\", 31, \"110\"], [\"009\", 1, 2824, \"maja\", \"\", 28, \"110C\"]]\n</code></pre>\n\n<p>Atm I'm doing it in this way, but I struggle because it returns only 1 record</p>\n\n<pre><code>detect = []\nrecords = first_array.collect {|a| a[0]} - second_array.collect {|a| a[0]}\n    records.each do |r|\n      detect = first_array.detect { |k, v| k == r }\n    end\nreturn detect\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "rails-activestorage"], "answers": [{"comments": [{"owner": {"reputation": 19261, "user_id": 4758119, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/F4dJY.jpg?s=128&g=1", "display_name": "Deepak Mahakale", "link": "https://stackoverflow.com/users/4758119/deepak-mahakale"}, "edited": false, "score": 0, "creation_date": 1569221597, "post_id": 58056847, "comment_id": 102511313, "body": "<code>report_files</code> table name in the query"}, {"owner": {"reputation": 48413, "user_id": 1279683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1veuT.jpg?s=128&g=1", "display_name": "Marek Lipka", "link": "https://stackoverflow.com/users/1279683/marek-lipka"}, "edited": false, "score": 0, "creation_date": 1569223890, "post_id": 58056847, "comment_id": 102512367, "body": "It&#39;s not gonna work, there&#39;s no such column as <code>file</code> in <code>report_files</code> table."}, {"owner": {"reputation": 453, "user_id": 2900304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12e41ccfa2d9a63aca48204cad5ecf9d?s=128&d=identicon&r=PG&f=1", "display_name": "Hemali", "link": "https://stackoverflow.com/users/2900304/hemali"}, "edited": false, "score": 0, "creation_date": 1569227392, "post_id": 58056847, "comment_id": 102513990, "body": "agree. idea is more towards using &quot;includes&quot; , we can change where condition to based on column generated by activestorage"}], "tags": [], "owner": {"reputation": 149, "user_id": 6843054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6539be961385a57301cc3b1efd2d3ff3?s=128&d=identicon&r=PG&f=1", "display_name": "SujoyD", "link": "https://stackoverflow.com/users/6843054/sujoyd"}, "is_accepted": false, "score": -1, "last_activity_date": 1569220657, "creation_date": 1569220657, "answer_id": 58056847, "question_id": 58056746, "link": "https://stackoverflow.com/questions/58056746/get-all-record-without-attachment/58056847#58056847", "title": "Get all record without attachment", "body": "<pre><code>Report.eager_load(:report_file).where(report_file: {file: nil})\n</code></pre>\n\n<p>should work</p>\n"}, {"tags": [], "owner": {"reputation": 159, "user_id": 9722060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd6af43aa5acad3d7111cc6be4d835bb?s=128&d=identicon&r=PG&f=1", "display_name": "Stefan Rendevski", "link": "https://stackoverflow.com/users/9722060/stefan-rendevski"}, "is_accepted": false, "score": 1, "last_activity_date": 1569221877, "creation_date": 1569221877, "answer_id": 58057125, "question_id": 58056746, "link": "https://stackoverflow.com/questions/58056746/get-all-record-without-attachment/58057125#58057125", "title": "Get all record without attachment", "body": "<p>Attachment associations have the following naming convention: _attachment. In your case, this would be file_attachment.</p>\n\n<p>Since this is a regular ActiveRecord association, you can do joins with it. The query you're looking for, then, is:</p>\n\n<pre><code>Record.where(id: RecordFile.where.not(id: RecordFile.joins(:file_attachment)).pluck(:record_id)) \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 453, "user_id": 2900304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12e41ccfa2d9a63aca48204cad5ecf9d?s=128&d=identicon&r=PG&f=1", "display_name": "Hemali", "link": "https://stackoverflow.com/users/2900304/hemali"}, "is_accepted": false, "score": -1, "last_activity_date": 1569222448, "creation_date": 1569222448, "answer_id": 58057254, "question_id": 58056746, "link": "https://stackoverflow.com/questions/58056746/get-all-record-without-attachment/58057254#58057254", "title": "Get all record without attachment", "body": "<p>Report.includes(:report_files).where('report_files.file= ?',nil)</p>\n\n<p>Ref:\n<a href=\"https://apidock.com/rails/ActiveRecord/QueryMethods/includes\" rel=\"nofollow noreferrer\">https://apidock.com/rails/ActiveRecord/QueryMethods/includes</a></p>\n"}, {"tags": [], "owner": {"reputation": 48413, "user_id": 1279683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1veuT.jpg?s=128&g=1", "display_name": "Marek Lipka", "link": "https://stackoverflow.com/users/1279683/marek-lipka"}, "is_accepted": true, "score": 1, "last_activity_date": 1569224246, "last_edit_date": 1569224246, "creation_date": 1569223481, "answer_id": 58057496, "question_id": 58056746, "link": "https://stackoverflow.com/questions/58056746/get-all-record-without-attachment/58057496#58057496", "title": "Get all record without attachment", "body": "<p>There's <code>left_joins</code> method in Rails 5, so you can use this instead of <code>includes</code> (or <code>eager_load</code>, which works here in the same way), since it fits better in this case. Also, the table you really should join to get what you want is <code>active_storage_attachment</code>, which is associated as <code>file_attachment</code> to <code>ReportFile</code>. Thus, I think the best way to get what you want is:</p>\n\n<pre><code>Report.left_joins(report_file: :file_attachment).where(active_storage_attachments: { id: nil })\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2566, "user_id": 1578898, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13d8e2260005e30e823d507385019735?s=128&d=identicon&r=PG", "display_name": "vidur punj", "link": "https://stackoverflow.com/users/1578898/vidur-punj"}, "is_accepted": false, "score": 0, "last_activity_date": 1569230643, "creation_date": 1569230643, "answer_id": 58059358, "question_id": 58056746, "link": "https://stackoverflow.com/questions/58056746/get-all-record-without-attachment/58059358#58059358", "title": "Get all record without attachment", "body": "<pre><code>Report.joins(\"left join report_files on reports.id = report_files.report_id\").where(\"report_files.file is null\")\n</code></pre>\n\n<p>will work</p>\n"}], "owner": {"reputation": 33, "user_id": 9238588, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/300bfd49c148385e968b7b006e72f2b5?s=128&d=identicon&r=PG&f=1", "display_name": "Sergey Vershinin Yazzi", "link": "https://stackoverflow.com/users/9238588/sergey-vershinin-yazzi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 331, "favorite_count": 0, "accepted_answer_id": 58057496, "answer_count": 5, "score": 2, "last_activity_date": 1569230643, "creation_date": 1569220207, "question_id": 58056746, "link": "https://stackoverflow.com/questions/58056746/get-all-record-without-attachment", "title": "Get all record without attachment", "body": "<p>Given a model with ActiveStorage</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>class Report\n  has_one :report_file\nend\n\nclass ReportFile\n  belongs_to :report\n  has_one_attached :file\nend\n</code></pre>\n\n<p>How can I get all Report where file in ReportFile not attached.</p>\n"}, {"tags": ["ruby", "twitter"], "answers": [{"tags": [], "owner": {"reputation": 1864, "user_id": 459856, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70037e355609caceae2500b183d28f58?s=128&d=identicon&r=PG", "display_name": "tjeden", "link": "https://stackoverflow.com/users/459856/tjeden"}, "is_accepted": true, "score": 1, "last_activity_date": 1569225049, "creation_date": 1569225049, "answer_id": 58057839, "question_id": 58056328, "link": "https://stackoverflow.com/questions/58056328/cant-save-user-profiler-image/58057839#58057839", "title": "Can&#39;t save user profiler image", "body": "<p>You have to use <code>path</code> method:</p>\n\n<pre><code>@image = subject.user.profile_image_url.path\n</code></pre>\n\n<p>Check more in <a href=\"https://www.rubydoc.info/gems/addressable/2.2.4/Addressable/URI#path-instance_method\" rel=\"nofollow noreferrer\">documenation</a></p>\n"}], "owner": {"reputation": 601, "user_id": 9315566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-pnkVEz0JwTw/AAAAAAAAAAI/AAAAAAAAASo/NlxvDhY5hi0/photo.jpg?sz=128", "display_name": "Shun Yamada", "link": "https://stackoverflow.com/users/9315566/shun-yamada"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 26, "favorite_count": 0, "accepted_answer_id": 58057839, "answer_count": 1, "score": 0, "last_activity_date": 1569225049, "creation_date": 1569217794, "question_id": 58056328, "link": "https://stackoverflow.com/questions/58056328/cant-save-user-profiler-image", "title": "Can&#39;t save user profiler image", "body": "<p>I'm working on Ruby script with Twitter API. I try to save profile image fetched but couldn't.</p>\n\n<pre><code>@image = subject.user.profile_image_url\n=&gt; #&lt;Addressable::URI:xxxxxxxx URI:http://pbs.twimg.com/profile_images/xxxxxxxxxx/m_xxxxxxxxxxx.jpg&gt;\n</code></pre>\n\n<p>I want to save only image URI. It's not concise.\nHow can I remove <code>#&lt;Addressable::URI:xxxxxxxx &gt;</code>?</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 28433, "user_id": 1565525, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f2e3a5d0911464ffa3d7ac48475cf98d?s=128&d=identicon&r=PG", "display_name": "Fabio", "link": "https://stackoverflow.com/users/1565525/fabio"}, "edited": false, "score": 1, "creation_date": 1569212879, "post_id": 58055637, "comment_id": 102508833, "body": "1. Make it work. 2.Make it right/clean/perform. Can you show step 1? And forgot to mention 0. Write tests"}, {"owner": {"reputation": 4690, "user_id": 1937435, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YyN37.jpg?s=128&g=1", "display_name": "Josh Brody", "link": "https://stackoverflow.com/users/1937435/josh-brody"}, "edited": false, "score": 2, "creation_date": 1569214009, "post_id": 58055637, "comment_id": 102509065, "body": "<code>hash.max_by(100) { |k,v| v }</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": false, "score": 5, "last_activity_date": 1569215941, "creation_date": 1569215941, "answer_id": 58056045, "question_id": 58055637, "link": "https://stackoverflow.com/questions/58055637/how-do-you-get-the-max-100-values-of-a-hash-in-ruby/58056045#58056045", "title": "How do you get the max 100 values of a hash in Ruby?", "body": "<p>Suppose we have the following hash with 10,000 keys and randomly-generated values:</p>\n\n<pre><code>N = 10_000\nM = 25_000\n\nh = N.times.with_object({}) { |i,h| h[i] = rand(M) }\n  #=&gt; { 0=&gt;23644, 1=&gt;5008, 2=&gt;22792, 3=&gt;3700, 4=&gt;6828,\n  #     ...\n  #     9995=&gt;2240, 9996=&gt;7923, 9997=&gt;23223, 9998=&gt;11945, 9999=&gt;17913 }    \n</code></pre>\n\n<p>The largest 100 values of <code>h</code> are obtained as follows:</p>\n\n<pre><code>h.values.max(100)\n  #=&gt; [24999, 24998, 24997, 24996, 24995, 24991, 24985, 24985, 24983, 24977,\n  #    24975, 24972, 24972, 24969, 24969, 24963, 24963, 24958, 24958, 24956,\n  #    ...\n  #    24801, 24799, 24798, 24798, 24795, 24794, 24785, 24782, 24778, 24778]\n</code></pre>\n\n<p>See (the third form of) <a href=\"https://ruby-doc.org/core-2.6.3/Array.html#method-i-max\" rel=\"noreferrer\">Array#max</a>. </p>\n"}], "owner": {"reputation": 153, "user_id": 7318875, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4UtMGK--wJE/AAAAAAAAAAI/AAAAAAAABd0/hwsllXNP0yw/photo.jpg?sz=128", "display_name": "Emily Kingan", "link": "https://stackoverflow.com/users/7318875/emily-kingan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1569215941, "creation_date": 1569212567, "question_id": 58055637, "link": "https://stackoverflow.com/questions/58055637/how-do-you-get-the-max-100-values-of-a-hash-in-ruby", "title": "How do you get the max 100 values of a hash in Ruby?", "body": "<p>I am tasked with returning the top 100 values of a hash in Ruby. I would like to avoid using <code>.sort_by</code> because it would be slow for large sets, and would prefer to grab the top 100 hash values first and then sort. How would you approach this?</p>\n"}, {"tags": ["ruby", "rest", "api", "server"], "comments": [{"owner": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "edited": false, "score": 0, "creation_date": 1569199487, "post_id": 58054445, "comment_id": 102506745, "body": "You should read up on how to make a JSON API in ruby"}, {"owner": {"reputation": 75, "user_id": 8702213, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/099caf15a5389286503bb56dec9ee607?s=128&d=identicon&r=PG&f=1", "display_name": "Alien", "link": "https://stackoverflow.com/users/8702213/alien"}, "reply_to_user": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "edited": false, "score": 0, "creation_date": 1569201910, "post_id": 58054445, "comment_id": 102507078, "body": "@maxpleaner would that allow keys to be sent in the get request? The key is required, and each unique key generates a different json file based on the ruby program."}], "answers": [{"comments": [{"owner": {"reputation": 75, "user_id": 8702213, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/099caf15a5389286503bb56dec9ee607?s=128&d=identicon&r=PG&f=1", "display_name": "Alien", "link": "https://stackoverflow.com/users/8702213/alien"}, "edited": false, "score": 0, "creation_date": 1569236736, "post_id": 58055355, "comment_id": 102518672, "body": "Would this cause any issues if multiple people used the program at once? The JSON file generated by the program is different for each request, so my main concern would be that if multiple people are reading from the same JSON file, it wouldn\u2019t return the right JSON for one of the users."}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "reply_to_user": {"reputation": 75, "user_id": 8702213, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/099caf15a5389286503bb56dec9ee607?s=128&d=identicon&r=PG&f=1", "display_name": "Alien", "link": "https://stackoverflow.com/users/8702213/alien"}, "edited": false, "score": 1, "creation_date": 1569244761, "post_id": 58055355, "comment_id": 102523067, "body": "Do you have a limited number of users?  How many?  Will that list need to grow over time?  This would surely need to change to support that.  How do you go about distributing the keys?  It sounds like you need a more fully structured web app api backed with database to store  user informations, keys etc.  For that you probably want to lean towards <a href=\"https://guides.rubyonrails.org/api_app.html\" rel=\"nofollow noreferrer\">Ruby on Rails start reading here</a>"}, {"owner": {"reputation": 75, "user_id": 8702213, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/099caf15a5389286503bb56dec9ee607?s=128&d=identicon&r=PG&f=1", "display_name": "Alien", "link": "https://stackoverflow.com/users/8702213/alien"}, "edited": false, "score": 0, "creation_date": 1569248489, "post_id": 58055355, "comment_id": 102525376, "body": "The way the ruby program works is it takes two hashed queries (username and password), and generates a JSON file after doing something with the username &amp; password. Therefore, the JSON file will be completely different, based on the username and password. The amount of users at one time would most likely never surpass 36, but there should be room for potential growth. My question is, how could I use these queries to interact with the ruby program and send back the JSON generated from it?"}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "reply_to_user": {"reputation": 75, "user_id": 8702213, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/099caf15a5389286503bb56dec9ee607?s=128&d=identicon&r=PG&f=1", "display_name": "Alien", "link": "https://stackoverflow.com/users/8702213/alien"}, "edited": false, "score": 1, "creation_date": 1569250173, "post_id": 58055355, "comment_id": 102526339, "body": "@Alien you should combine your current ruby program into your API application.  But I have no idea what that program looks like.  I&#39;ve given you as much help as I can on this question.  Now you need to read up on both Sinatra and Rails and decide which one is best for your use case.  Then go ahead and build your fully working API as a single ruby application."}], "tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": true, "score": 1, "last_activity_date": 1569245199, "last_edit_date": 1569245199, "creation_date": 1569209872, "answer_id": 58055355, "question_id": 58054445, "link": "https://stackoverflow.com/questions/58054445/i-would-like-to-create-some-kind-of-api-to-run-a-ruby-program-via-a-unique-key/58055355#58055355", "title": "I would like to create some kind of API to run a ruby program via a unique key", "body": "<p>Here is a VERY basic example of how easy this is to do using <a href=\"http://sinatrarb.com/\" rel=\"nofollow noreferrer\">Sinatra</a> which is good for such simple type of web applications / APIs. </p>\n\n<p>If we assume your current program already renders the json to a static file, for example.</p>\n\n<h3>sample.json</h3>\n\n<pre><code>[\n  {\n    \"item1\": {\n      \"foo\": \"bar\"\n    },\n    \"item2\": {\n      \"baz\": \"qux\"\n    }\n  }\n]\n</code></pre>\n\n<p>On your linux system you should have some secure random key set.  You can do that also with one liner assuming ruby is installed.</p>\n\n<pre><code>ruby -e 'require \"SecureRandom\"; puts SecureRandom.hex(32)'\n</code></pre>\n\n<p>Or in pure linux</p>\n\n<pre><code>date +%s | sha256sum | base64 | head -c 64 ; echo\n</code></pre>\n\n<p>Then in your server's startup scripts you'll need to make sure to export the key.</p>\n\n<pre><code>export API_KEY=ODAzN2EzMmI2YTc2ZDIzZjA5NzRmYmJiNjJjYmE4OGUyYjVjMDM0ZWJkZWU4NmMz\n</code></pre>\n\n<p>Then in same path as your json file, write a file called <code>api.rb</code></p>\n\n<pre><code># api.rb\nrequire 'sinatra'\n\nget '/api' do\n  if params['key'] == ENV['API_KEY']\n    return File.read 'sample.json'\n  else\n    status 401\n  end\nend\n</code></pre>\n\n<p>By default Sinatra runs on port 4567 so you'll need to expose it on your server which seems outside the scope of your Ruby question.  </p>\n\n<p>Depending on how and where you host this, you'll want to configure your server to run the application at startup.  For your local development you can just run this from terminal.</p>\n\n<pre><code>ruby app.rb\n</code></pre>\n\n<p>To see it working just visit</p>\n\n<pre><code>http://localhost:4567/api?key= # &lt;&lt;-- paste your key here.\n</code></pre>\n\n<p>Also, keep in mind, there is no security besides the key here and this will be subject to <a href=\"https://en.wikipedia.org/wiki/Brute-force_attack\" rel=\"nofollow noreferrer\">brute force attacks</a>, but again, that's also outside the scope of this question.</p>\n\n<p>UPDATE</p>\n\n<p>If you need to support multiple users with their own keys, you'll need more complex logic and likely use a database to store the user information.  API keys alone may not provide enough security if your api is serving sensitive information. So you'll probably want to add more layers of security.  You still could build this using Sinatra, but you might want to go with <a href=\"https://guides.rubyonrails.org/api_app.html\" rel=\"nofollow noreferrer\">Ruby on Rails to build your API</a> instead.</p>\n"}], "owner": {"reputation": 75, "user_id": 8702213, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/099caf15a5389286503bb56dec9ee607?s=128&d=identicon&r=PG&f=1", "display_name": "Alien", "link": "https://stackoverflow.com/users/8702213/alien"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 58055355, "answer_count": 1, "score": 2, "last_activity_date": 1569245199, "creation_date": 1569199138, "question_id": 58054445, "link": "https://stackoverflow.com/questions/58054445/i-would-like-to-create-some-kind-of-api-to-run-a-ruby-program-via-a-unique-key", "title": "I would like to create some kind of API to run a ruby program via a unique key", "body": "<p>I wrote a ruby program that runs on my local machine, and I want to turn it into a linux server API that will send back the formatted JSON file that the ruby program generates. The ruby program already works, and generates a separate JSON file on my local machine, but I would like to turn it into an API that returns the generated JSON from the program on request. The API should accept a single key, and run the program based on that key. How can I do this? What is it called that I am trying to accomplish? Thank you for any help you can provide.</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "answers": [{"tags": [], "owner": {"reputation": 1607, "user_id": 7151673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/257324e88d03e0fd01d7f09f3bd5a788?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/7151673/max"}, "is_accepted": true, "score": 2, "last_activity_date": 1569212962, "last_edit_date": 1569212962, "creation_date": 1569198195, "answer_id": 58054380, "question_id": 58054188, "link": "https://stackoverflow.com/questions/58054188/how-to-create-a-url-link-shortener-slug-that-has-the-least-amount-of-digits-base/58054380#58054380", "title": "How to create a url link shortener slug that has the least amount of digits based of records in database", "body": "<p>For the slug digits count, you're essentially looking for how long your number would be in base 66. This is related to calculating the logarithm of the number in base 66: the base-66 log of 1 (1 digit in base 66) is 0, the base-66 log of 66 (2 digits in base 66) is 1, the base-log of 66^2 (3 digits in base 66) is 2, etc. So <code>(Math.log(Link.count, 66) + 1).floor</code> should give you the number you're looking for.</p>\n\n<p>Note that you'll run into issues if your <code>Link.count</code> is 0, but it's not clear if you'll ever run it in that situation.</p>\n"}], "owner": {"reputation": 27, "user_id": 2304695, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G1jLw.gif?s=128&g=1", "display_name": "Adam Freemer", "link": "https://stackoverflow.com/users/2304695/adam-freemer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 58054380, "answer_count": 1, "score": 0, "last_activity_date": 1569212962, "creation_date": 1569196121, "question_id": 58054188, "link": "https://stackoverflow.com/questions/58054188/how-to-create-a-url-link-shortener-slug-that-has-the-least-amount-of-digits-base", "title": "How to create a url link shortener slug that has the least amount of digits based of records in database", "body": "<p>I'm trying to figure out an algorithm to produce a link shortener slug (i.e. just the key, not the entire short url), that will be as short as possible, based off of how many submitted links there are in the database, on table <code>Link</code>. </p>\n\n<p>I made a couple assumptions:</p>\n\n<p>1- that based off of the standard characters and unreserved RFC 3986 characters, I could work in a base 66 system (26 + 26 + 10 + <code>'-', '_', '.', '~'</code>).</p>\n\n<p>2- This case statement was the best way to handle setting digit size for the output link slug. I thought there would be a more elegant way to do this, but this was about the best I could come up with. </p>\n\n<pre><code>  def self.slug_characters(slug_digits)\n    alphanumcase = [('a'..'z'), ('A'..'Z'), ('0'..'9')].map(&amp;:to_a).flatten\n    unreserved = ['-', '_', '.', '~']\n    # unreserved = the balance of the RFC 3986 unreserved character set\n    characters = [alphanumcase, unreserved].map(&amp;:to_a).flatten\n    (0...slug_digits).map { characters[rand(characters.length)] }.join\n  end\n\n  def self.generate_slug\n    case Link.count\n    when 0..66**1\n      digits = 1\n    when (66**1+1)..66**2\n      digits = 2\n    when (66**2+1)..66**3\n      digits = 3\n    when (66**3+1)..66**4\n      digits = 5\n    when (66**4+1)..66**5\n      digits = 6\n    when (66**5+1)..66**6\n      digits = 7\n    end\n\n    self.slug_characters(digits)\n  end\nend\n</code></pre>\n\n<p>I was looking for some knowledge on what's permissible in a url as my understanding is somewhat cloudy from what I've been able to research.</p>\n\n<p>Also, given my supplied code, I was hoping for a more elegant way to generate the slug digits count.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "boolean", "short-circuiting"], "comments": [{"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1569178166, "post_id": 58052202, "comment_id": 102502779, "body": "As @iGian says, the error message tells us that <code>flash[:notice] #=&gt; nil</code>. You have not told us what you think <code>flash[:notice]</code> equals, which a weakness of the question. Pay close attention to error messages. Often, as here, they pinpoint the problem."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 2, "creation_date": 1569179846, "post_id": 58052202, "comment_id": 102503227, "body": "There is no rush to select an answer. Most members wait a minimum of a couple of hours; some wait more than a day so that those asleep when the question is posted might see it before a selection is made. Another reason to wait is that sometimes, as here, it allows readers time to show you that an answer you might otherwise select is incorrect."}, {"owner": {"reputation": 31, "user_id": 3062907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99f55e031937a1a3b0a60223bc68e062?s=128&d=identicon&r=PG&f=1", "display_name": "ososhyong", "link": "https://stackoverflow.com/users/3062907/ososhyong"}, "reply_to_user": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1569277074, "post_id": 58052202, "comment_id": 102537162, "body": "I selected Abdul&#39;s answer because it solved my problem, not because I was in a rush. As far as I can tell it is the most concise and correct answer here."}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 3062907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99f55e031937a1a3b0a60223bc68e062?s=128&d=identicon&r=PG&f=1", "display_name": "ososhyong", "link": "https://stackoverflow.com/users/3062907/ososhyong"}, "edited": false, "score": 0, "creation_date": 1569177688, "post_id": 58052290, "comment_id": 102502639, "body": "Yes, I&#39;m aware. My confusion stems from the fact that short-circuit evaluation isn&#39;t working as expected. If the left-hand side returns false, then the right-hand side (<code>is_empty?</code>) shouldn&#39;t be called at all."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1569179354, "post_id": 58052290, "comment_id": 102503103, "body": "ososhyong, suppose you had an expression <code>if [1,2,3].is_a?(x)...</code>, where <code>x</code> is an expression. To determine if  <code>[1,2,3].is_a?(x)</code> is <code>true</code> or <code>false</code> we obviously need to first evaluate <code>x</code>. Here <code>x</code> equals <code>Array &amp;&amp; !flash[:notice].empty?</code>. Since <code>Array</code> is <i>truthy</i>, the expression reduces to  <code>!flash[:notice].empty?</code>. To evaluate that expression we first evaluate <code>flash[:notice].empty?</code>. The error message tells us that <code>nil</code> does not have a method <code>empty?</code>. So what does that tell you about <code>flash[:notice]</code>?"}, {"owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "reply_to_user": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1569219314, "post_id": 58052290, "comment_id": 102510445, "body": "In my answer I stuck strictly to the question as @CarySwoveland pointed, missing the syntax error (good catch from @Abdul Rehman). I added an edit to show how it would be caught by evaluating the existence of <code>flash[:notice]</code> first."}, {"owner": {"reputation": 31, "user_id": 3062907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99f55e031937a1a3b0a60223bc68e062?s=128&d=identicon&r=PG&f=1", "display_name": "ososhyong", "link": "https://stackoverflow.com/users/3062907/ososhyong"}, "edited": false, "score": 0, "creation_date": 1569277478, "post_id": 58052290, "comment_id": 102537261, "body": "Thanks, @iGian. Gave you an upvote since I believe you were unfairly downvoted."}], "tags": [], "owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "is_accepted": false, "score": 1, "last_activity_date": 1569218577, "last_edit_date": 1569218577, "creation_date": 1569177131, "answer_id": 58052290, "question_id": 58052202, "link": "https://stackoverflow.com/questions/58052202/why-does-a-is-a-array-a-empty-raise-nomethoderror/58052290#58052290", "title": "Why does `a.is_a? Array &amp;&amp; !a.empty?` raise NoMethodError?", "body": "<p>It's because <code>NilClass</code> does not respond to <code>empty</code>:</p>\n\n<pre><code>nil.class #=&gt; NilClass\nnil.respond_to? :empty?\n#=&gt; false\n</code></pre>\n\n<p>While it responds to <code>is_a?</code>:</p>\n\n<pre><code>nil.respond_to? :is_a?\n#=&gt; true\n</code></pre>\n\n<p>Shows all methods <code>nil</code> respond to:</p>\n\n<pre><code>nil.methods\n#=&gt; [:&amp;, :inspect, :to_a, :to_s, :===, :to_f, :to_i, :=~, :to_h, :nil?, :to_r, :rationalize, :|, :to_c, :^, :instance_variable_defined?, :remove_instance_variable, :instance_of?, :kind_of?, :is_a?, :tap, :instance_variable_set, :protected_methods, :instance_variables, :instance_variable_get, :public_methods, :private_methods, :method, :public_method, :public_send, :singleton_method, :define_singleton_method, :extend, :to_enum, :enum_for, :&lt;=&gt;, :!~, :eql?, :respond_to?, :freeze, :object_id, :send, :display, :hash, :class, :singleton_class, :clone, :dup, :itself, :yield_self, :then, :taint, :tainted?, :untaint, :untrust, :untrusted?, :trust, :frozen?, :methods, :singleton_methods, :equal?, :!, :==, :instance_exec, :!=, :instance_eval, :__id__, :__send__]\n</code></pre>\n\n<p><hr>\nIf you fix by checking first the existence of the value for the key <code>:notice</code>, as this example shows: <a href=\"https://api.rubyonrails.org/classes/ActionDispatch/Flash.html\" rel=\"nofollow noreferrer\">https://api.rubyonrails.org/classes/ActionDispatch/Flash.html</a>, a syntax error is raised, which points to the parenthesis missing:</p>\n\n<pre><code>flash[:notice] &amp;&amp; flash[:notice].is_a? Array &amp;&amp; flash[:notice].empty?\n# syntax error, unexpected tCONSTANT, expecting end-of-input\n# ...] &amp;&amp; flash[:notice].is_a? Array &amp;&amp; flash[:notice].empty?\n#                              ^~~~~\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31, "user_id": 3062907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99f55e031937a1a3b0a60223bc68e062?s=128&d=identicon&r=PG&f=1", "display_name": "ososhyong", "link": "https://stackoverflow.com/users/3062907/ososhyong"}, "edited": false, "score": 0, "creation_date": 1569177437, "post_id": 58052299, "comment_id": 102502561, "body": "Oh wow. So basically, you&#39;re saying my code evaluates to:  <code>flash[:notice].is_a?(Array &amp;&amp; !flash[:notice].empty?)</code>  Is there ever any reason to omit the parentheses, then? Seems like that coding style would always have the potential of introducing subtle bugs like this."}, {"owner": {"reputation": 31, "user_id": 3062907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99f55e031937a1a3b0a60223bc68e062?s=128&d=identicon&r=PG&f=1", "display_name": "ososhyong", "link": "https://stackoverflow.com/users/3062907/ososhyong"}, "edited": false, "score": 1, "creation_date": 1569177888, "post_id": 58052299, "comment_id": 102502703, "body": "Thanks, that was helpful. Guess I&#39;ll just always use parentheses in complex expressions :)"}, {"owner": {"reputation": 319, "user_id": 9379722, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DjypIfHCfa4/AAAAAAAAAAI/AAAAAAAAAKE/Arq2ERtWdwU/photo.jpg?sz=128", "display_name": "Abdul Rehman", "link": "https://stackoverflow.com/users/9379722/abdul-rehman"}, "reply_to_user": {"reputation": 31, "user_id": 3062907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99f55e031937a1a3b0a60223bc68e062?s=128&d=identicon&r=PG&f=1", "display_name": "ososhyong", "link": "https://stackoverflow.com/users/3062907/ososhyong"}, "edited": false, "score": 0, "creation_date": 1569178021, "post_id": 58052299, "comment_id": 102502736, "body": "Yes Exactly and as Array is a class so it evaluates to <code>true</code> and then rails try to evaluate <code>empty?</code> method which raises an error. <a href=\"https://stackoverflow.com/questions/37692539/why-do-we-omit-parenthesis-only-some-of-the-time\">This</a> thread might help you understand better when and when not to use parenthesis."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 2, "creation_date": 1569178605, "post_id": 58052299, "comment_id": 102502901, "body": "While that is a problem, it is not the reason the exception was raised. The error message tells us that the error occurs before <code>if flash[:notice].is_a? ...</code> is evaluated. Since we know <code>flash[:notice] #=&gt; nil</code>, the expression simplifies to <code>&lt;% if nil.is_a? Array &amp;&amp; !nil.empty? %&gt;</code>."}, {"owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "reply_to_user": {"reputation": 31, "user_id": 3062907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99f55e031937a1a3b0a60223bc68e062?s=128&d=identicon&r=PG&f=1", "display_name": "ososhyong", "link": "https://stackoverflow.com/users/3062907/ososhyong"}, "edited": false, "score": 0, "creation_date": 1569179009, "post_id": 58052299, "comment_id": 102503016, "body": "@ososhyong They Ruby style guide says the following about using parentheses for on method invocation: <i>&quot;Use parentheses around the arguments of method invocations, especially if the first argument begins with an open parenthesis <code>(</code>, as in <code>f((3 + 2) + 1)</code>.&quot;</i> - <a href=\"https://github.com/rubocop-hq/ruby-style-guide#method-invocation-parens\" rel=\"nofollow noreferrer\">Ruby Style Guide</a>"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "reply_to_user": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "edited": false, "score": 0, "creation_date": 1569179588, "post_id": 58052299, "comment_id": 102503161, "body": "@3limin4t0r, I said that was a problem, but it was not the reason the exception was raised. See my comment on iGian&#39;s answer."}, {"owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "reply_to_user": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 1, "creation_date": 1569181056, "post_id": 58052299, "comment_id": 102503506, "body": "@CarySwoveland The missing parameter parentheses are the reason for the exception. By not calling <code>is_a?</code> with parentheses the content of <code>flash[:notice]</code> isn&#39;t checked to be an array which is clearly the intent if you look at the code. Due to it not being checked it can be <code>nil</code> thus resulting in the exception on the <code>empty?</code> call. So I would argue this is the reason for the exception. <code>flash[:notice]</code> being <code>nil</code> is a consequence."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "reply_to_user": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "edited": false, "score": 0, "creation_date": 1569188210, "post_id": 58052299, "comment_id": 102505048, "body": "@3limin4t0r and \u0412\u0438\u043a\u0442\u043e\u0440, the simple answer is that the error tells us that <code>empty?</code>&#39;s receiver,  <code>flash[:notice]</code>, is <code>nil</code> and <code>nil</code> does not have a method <code>empty?</code>. The first step is to evaluate <code>flash[:notice]</code>. That does not raise an exception. Let <code>x = flash[:notice]</code>. Next Ruby sees if <code>x</code>  has a method <code>:is_a?</code>. It does, as do all objects. To evaluate <code>x.is_a?(y)</code> she evaluates <code>y = Array &amp;&amp; !x.empty?</code>. Since <code>Array</code> is <i>truthy</i> and is followed by <code>&amp;&amp;</code> she must evaluate <code>x.empty?</code> (and then compute <code>!x</code> if no exception is raised). But an exception is raised, telling us that <code>x #=&gt; nil</code>."}, {"owner": {"reputation": 2251, "user_id": 9785060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IUduC.png?s=128&g=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/9785060/viktor"}, "reply_to_user": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1569189546, "post_id": 58052299, "comment_id": 102505309, "body": "@CarySwoveland If I understood correctly, the thing here is that the answer to  &quot;Why does <code>a.is_a? Array &amp;&amp; !a.empty?</code> raise NoMethodError?&quot; is &quot;because <code>a</code> is <code>nil</code>&quot; . But the answer to a question like &quot;How can I change this code to not throw an error when <code>a</code> is <code>nil</code>&quot; would be &quot;add parentheses around Array&quot; or something like that. But since the second question wasn&#39;t asked, this answer is incorrect ?"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "reply_to_user": {"reputation": 2251, "user_id": 9785060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IUduC.png?s=128&g=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/9785060/viktor"}, "edited": false, "score": 0, "creation_date": 1569190755, "post_id": 58052299, "comment_id": 102505533, "body": "@\u0412\u0438\u043a\u0442\u043e\u0440, I believe it is helpful to point out the problem with the lack of parentheses but that does not answer the question. The question, as you recounted it, is &quot;Why does...raise <code>NoMethodError</code>&quot;."}, {"owner": {"reputation": 2251, "user_id": 9785060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IUduC.png?s=128&g=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/9785060/viktor"}, "reply_to_user": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 4, "creation_date": 1569191813, "post_id": 58052299, "comment_id": 102505723, "body": "@CarySwoveland But judging by the first comment by OP on iGian&#39;s answer and this sentence from the question: &quot;It seems like Ruby should not be calling .empty? in the second part of this clause&quot;, the asnwer &quot;because <code>a</code> is <code>nil</code>&quot; seems a bit too literal. It just seems like the title of the question is badly worded but the content and the comments clearly show that he knows &quot;<code>a</code> is <code>nil</code>&quot; but is unsure of the reason why the second part is being executed (which this answer addresses correctly in my opinion)"}, {"owner": {"reputation": 89316, "user_id": 238886, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/8ca29123b5669b26f9b6ca2c62d9d215?s=128&d=identicon&r=PG", "display_name": "Wayne Conrad", "link": "https://stackoverflow.com/users/238886/wayne-conrad"}, "reply_to_user": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1569193488, "post_id": 58052299, "comment_id": 102506001, "body": "I disagree with @CarySwoveland that the question should be interpreted so literally, but adding to your answer your comments explaining exactly why the exception happened would improve the answer and (I think) fix what he is objecting to."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "reply_to_user": {"reputation": 89316, "user_id": 238886, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/8ca29123b5669b26f9b6ca2c62d9d215?s=128&d=identicon&r=PG", "display_name": "Wayne Conrad", "link": "https://stackoverflow.com/users/238886/wayne-conrad"}, "edited": false, "score": 0, "creation_date": 1569194136, "post_id": 58052299, "comment_id": 102506079, "body": "@Wayne, how could the title of the question be more clear? Code in questions often contain multiple errors and while it&#39;s useful to point them out, job #1 is to answer the question asked."}, {"owner": {"reputation": 31, "user_id": 3062907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99f55e031937a1a3b0a60223bc68e062?s=128&d=identicon&r=PG&f=1", "display_name": "ososhyong", "link": "https://stackoverflow.com/users/3062907/ososhyong"}, "reply_to_user": {"reputation": 2251, "user_id": 9785060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IUduC.png?s=128&g=1", "display_name": "Viktor", "link": "https://stackoverflow.com/users/9785060/viktor"}, "edited": false, "score": 0, "creation_date": 1569277230, "post_id": 58052299, "comment_id": 102537198, "body": "I am surprised that this answer has so much commentary but I agree with @\u0412\u0438\u043a\u0442\u043e\u0440&#39;s answer here. My question is not literally &quot;why am I getting an exception&quot;, but rather &quot;why isn&#39;t short circuit evaluation working in this conditional expression?&quot; The problem was the syntax, not the literal evaluation of <code>a.nil?</code>."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1569279054, "post_id": 58052299, "comment_id": 102537634, "body": "Please do a minor edit so that I may remove my downvote."}], "tags": [], "owner": {"reputation": 319, "user_id": 9379722, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DjypIfHCfa4/AAAAAAAAAAI/AAAAAAAAAKE/Arq2ERtWdwU/photo.jpg?sz=128", "display_name": "Abdul Rehman", "link": "https://stackoverflow.com/users/9379722/abdul-rehman"}, "is_accepted": true, "score": 8, "last_activity_date": 1569430632, "last_edit_date": 1569430632, "creation_date": 1569177167, "answer_id": 58052299, "question_id": 58052202, "link": "https://stackoverflow.com/questions/58052202/why-does-a-is-a-array-a-empty-raise-nomethoderror/58052299#58052299", "title": "Why does `a.is_a? Array &amp;&amp; !a.empty?` raise NoMethodError?", "body": "<p>This is happening because you are using space and not brackets for the parameters of <code>is_a?</code> function so rails is trying to send the whole thing as a parameter. Try it like this</p>\n\n<pre><code>&lt;% if flash[:notice].is_a?(Array) &amp;&amp; !flash[:notice].empty? %&gt;\n</code></pre>\n\n<p>Explanation:</p>\n\n<p>when you write <code>flash[:notice].is_a? Array &amp;&amp; !flash[:notice].empty?</code> rails interpret it like <code>flash[:notice].is_a?(Array &amp;&amp; !flash[:notice].empty?)</code> so <code>Array</code> is evaluated as <code>true</code> and <code>!flash[:notice].empty?</code> is evaluated which raises the exception.</p>\n"}], "owner": {"reputation": 31, "user_id": 3062907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99f55e031937a1a3b0a60223bc68e062?s=128&d=identicon&r=PG&f=1", "display_name": "ososhyong", "link": "https://stackoverflow.com/users/3062907/ososhyong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 0, "accepted_answer_id": 58052299, "answer_count": 2, "score": 2, "last_activity_date": 1569430632, "creation_date": 1569176566, "last_edit_date": 1569194808, "question_id": 58052202, "link": "https://stackoverflow.com/questions/58052202/why-does-a-is-a-array-a-empty-raise-nomethoderror", "title": "Why does `a.is_a? Array &amp;&amp; !a.empty?` raise NoMethodError?", "body": "<p>I'm a Python developer and I just started learning Rails, so this might be a noobish question. I found some surprising behavior in my code:</p>\n\n<pre class=\"lang-erb prettyprint-override\"><code>&lt;!-- render flash message array if set --&gt;\n&lt;% if flash[:notice].is_a? Array &amp;&amp; !flash[:notice].empty? %&gt;\n</code></pre>\n\n<p>This results in the following error: <code>undefined method `empty?' for nil:NilClass</code></p>\n\n<p>It seems like Ruby should not be calling <code>.empty?</code> in the second part of this clause. I confirmed that short-circuit evaluation works in other cases:</p>\n\n<pre><code># this is more what I expected\n[3] pry(main)&gt; a = nil\n=&gt; nil\n[5] pry(main)&gt; !a.nil? &amp;&amp; a.empty?\n=&gt; false\n...\n[6] pry(main)&gt; a = 1\n=&gt; 1\n[7] pry(main)&gt; !a.nil? &amp;&amp; a.empty?\nNoMethodError: undefined method `empty?' for 1:Integer\nfrom (pry):7:in `__pry__'\n</code></pre>\n\n<p>Anyone know why this behavior is happening? Seems to only trigger when I use <code>is_a?</code> and not the other operators.</p>\n"}, {"tags": ["ruby", "methods", "rubygems", "yield"], "answers": [{"comments": [{"owner": {"reputation": 180, "user_id": 8659405, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ICOCH.gif?s=128&g=1", "display_name": "J.R. Bob Dobbs", "link": "https://stackoverflow.com/users/8659405/j-r-bob-dobbs"}, "edited": false, "score": 0, "creation_date": 1569180223, "post_id": 58052635, "comment_id": 102503324, "body": "To clarify the Array object of set.colors: if <code>set</code> is an Array of strings before <code>#colorize</code> is invoked, what is the <code>#colors</code> method doing when <code>#colorize</code> is invoked?"}, {"owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "edited": false, "score": 3, "creation_date": 1569180226, "post_id": 58052635, "comment_id": 102503326, "body": "You&#39;ve got some misinformation about <code>public_send</code> in there. The method is not removed from Ruby and is still present in the newest 2.6.4 version. The difference is that <a href=\"https://ruby-doc.org/core-2.6.4/Object.html#method-i-public_send\" rel=\"nofollow noreferrer\"><code>public_send</code></a> only calls public methods while <a href=\"https://ruby-doc.org/core-2.6.4/Object.html#method-i-send\" rel=\"nofollow noreferrer\"><code>send</code></a> can also call private or protected methods."}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "reply_to_user": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "edited": false, "score": 0, "creation_date": 1569180384, "post_id": 58052635, "comment_id": 102503369, "body": "@3limin4t0r right, what was I thinking, it was defined forever. Updated, thanks."}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "reply_to_user": {"reputation": 180, "user_id": 8659405, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ICOCH.gif?s=128&g=1", "display_name": "J.R. Bob Dobbs", "link": "https://stackoverflow.com/users/8659405/j-r-bob-dobbs"}, "edited": false, "score": 0, "creation_date": 1569180529, "post_id": 58052635, "comment_id": 102503406, "body": "@J.R.BobDobbs inside the method here <code>.colors</code> is not &quot;doing&quot; anything.  It&#39;s just a local array defined to be used in the local <code>.each</code> loop.  I will refactor it to use <code>.map</code> instead"}, {"owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "edited": false, "score": 0, "creation_date": 1569180549, "post_id": 58052635, "comment_id": 102503410, "body": "You&#39;re also better of using using the same method invocation tactic for your example. For <code>text.public_send(color.to_sym)</code> I would use the example <code>&#39;blue&#39;.blue #=&gt; ...</code> since that&#39;s how it&#39;s technically called. Although I agree that <code>text.colorize(color)</code> might be more fitting (especially while dynamically colouring)."}, {"owner": {"reputation": 180, "user_id": 8659405, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ICOCH.gif?s=128&g=1", "display_name": "J.R. Bob Dobbs", "link": "https://stackoverflow.com/users/8659405/j-r-bob-dobbs"}, "edited": false, "score": 0, "creation_date": 1569180771, "post_id": 58052635, "comment_id": 102503450, "body": "@lacostenycoder Maybe that&#39;s where my confusion is coming from; The usage of <code>colors</code> as a local Array. Will you please confirm my confusion? The <code>colors</code> in <code>set.colors.each</code> is NOT a call to the <code>#colors</code> method from the Colorize Gem..."}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 1, "creation_date": 1569181245, "post_id": 58052635, "comment_id": 102503545, "body": "<code>set.colors</code> is an instance variable assigned to instance of <code>Hint</code> or <code>ColorCode</code> which are the objects passed as first argument to your <code>colorize</code> method. See <code>initialize</code> methods defined in <a href=\"https://github.com/JonathanYiv/mastermind/blob/master/hint.rb#L4\" rel=\"nofollow noreferrer\">Hint</a> and <a href=\"https://github.com/JonathanYiv/mastermind/blob/master/colorcode.rb#L4\" rel=\"nofollow noreferrer\">ColorCode</a>. So you are correct that <code>set.colors</code> has nothing to do with the colorize gem."}, {"owner": {"reputation": 180, "user_id": 8659405, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ICOCH.gif?s=128&g=1", "display_name": "J.R. Bob Dobbs", "link": "https://stackoverflow.com/users/8659405/j-r-bob-dobbs"}, "edited": false, "score": 0, "creation_date": 1569181384, "post_id": 58052635, "comment_id": 102503579, "body": "Oh wow. I can get on with my life now. Thanks for giving me my freedom back."}, {"owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "edited": false, "score": 2, "creation_date": 1569181680, "post_id": 58052635, "comment_id": 102503653, "body": "Due to the duck-typing nature of Ruby you can&#39;t know what the <code>set</code> parameter is. If you want to know what the content of <code>set</code> is you can either add some debugging in the <code>colorize</code> method, or simply look at the <a href=\"https://github.com/JonathanYiv/mastermind/blob/dc36455a31969479170627ec60b79993f6764d35/gameboard.rb#L14\" rel=\"nofollow noreferrer\">usage</a>."}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "reply_to_user": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "edited": false, "score": 0, "creation_date": 1569181887, "post_id": 58052635, "comment_id": 102503696, "body": "@3limin4t0r yep thanks that&#39;s exactly what I meant to do.  Updated."}, {"owner": {"reputation": 180, "user_id": 8659405, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ICOCH.gif?s=128&g=1", "display_name": "J.R. Bob Dobbs", "link": "https://stackoverflow.com/users/8659405/j-r-bob-dobbs"}, "edited": false, "score": 0, "creation_date": 1569181989, "post_id": 58052635, "comment_id": 102503727, "body": "In an effort to understand the <code>#colorize</code> method...I was abstracting too far away from the original usage of what <code>set</code> would be passed as -- either a ColorCode or Hint object -- and was simplifying into confusion..."}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "reply_to_user": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "edited": false, "score": 1, "creation_date": 1569182597, "post_id": 58052635, "comment_id": 102503877, "body": "when in doubt, try to find where the method in question is being called as explained by @3limin4t0r  in previous comment.  Glad it makes sense now."}], "tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": true, "score": 3, "last_activity_date": 1569181864, "last_edit_date": 1569181864, "creation_date": 1569179802, "answer_id": 58052635, "question_id": 58052030, "link": "https://stackoverflow.com/questions/58052030/what-is-the-return-of-the-yield-block-on-a-call-to-a-parameter-chained-with-a-me/58052635#58052635", "title": "What is the return of the yield block on a call to a parameter chained with a method from a Gem iterated with #each?", "body": "<p>Let's break down the method line by line to see what's going on.</p>\n\n<pre><code>def colorize(set, is_color_code)\n  colors = [] # instantiate an array\n  text = is_color_code ? \"0\" : \".\"  # ternary assignment if is_color_code == true || false\n  # set.colors is an array of strings like ['white', 'white', 'white', 'white']\n  # set.colors.each { |color| colors.push(text.public_send(color.to_sym)) }\n  # line above this refactored to comment\n  set.colors.each do |color|\n    # color.to_sym # convert the string to symbol so 'white' becomes :white\n    # you must pass a symbol to public_send \n    # so this is sending the name of the color to the string as provided by the gem.\n    colors.push( text.public_send(color.to_sym) ) # push the return of that into array\n  end \n  # In Ruby the method always returns whatever the output of the last line returns.\n  colors.join(' ') # returns the colors array a string joined by spaces\nend\n</code></pre>\n\n<p>In this case the colorize method is defined inside the <code>GameBoard</code> class. So when that method is called on an instance of <code>GameBoard</code> it will behave as it was defined to do. Where as <code>'blue'.colorize(:blue)</code> here <code>.colorize</code> method extends the <code>String</code> class to respond with the color codes of the color symbol passed </p>\n\n<p>Example</p>\n\n<pre><code>'blue'.colorize(:blue) # same as 'blue'.blue\n =&gt;\"\\e[0;34;49mblue\\e[0m\"\n</code></pre>\n\n<p>Refactored version</p>\n\n<pre><code>def colorize(set, is_color_code)\n  text = is_color_code ? \"0\" : \".\"\n  set.colors\n     .map { |color| text.public_send(color.to_sym) }\n     .join(' ')\nend\n</code></pre>\n"}], "owner": {"reputation": 180, "user_id": 8659405, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ICOCH.gif?s=128&g=1", "display_name": "J.R. Bob Dobbs", "link": "https://stackoverflow.com/users/8659405/j-r-bob-dobbs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 58052635, "answer_count": 1, "score": 1, "last_activity_date": 1569181864, "creation_date": 1569175519, "question_id": 58052030, "link": "https://stackoverflow.com/questions/58052030/what-is-the-return-of-the-yield-block-on-a-call-to-a-parameter-chained-with-a-me", "title": "What is the return of the yield block on a call to a parameter chained with a method from a Gem iterated with #each?", "body": "<p>I'm attempting to understand a method used in a Mastermind Game, and I don't understand what the yield block is producing; or the return of the actual method...  </p>\n\n<p>Here's the code:</p>\n\n<pre><code>#lib/mastermind/gameboard.rb\n\nrequire 'colorize'\n\ndef colorize(set, is_color_code)\n  colors = []\n  text = is_color_code ? \"0\" : \".\"\n  set.colors.each { |color| colors.push(text.public_send(color.to_sym)) }\n  colors.join(' ')\nend\n</code></pre>\n\n<p>My primary question is: If <code>#colors</code> returns an Array of all the keys from a hash, and I'm simply pushing the local <code>text</code> variable to the local <code>colors</code> Array, joined with <code>#public_send(color.to_sym)</code>, won't the return of the <code>#colorize</code> method here be an Array of either \"0\".color or \".\".color?</p>\n\n<p>I think it needs to be said that <code>#colorize</code> is a method in the Colorize Gem, however, this <code>#colorize</code> method is part of a separate class in the <a href=\"https://github.com/JonathanYiv/mastermind/blob/master/gameboard.rb\" rel=\"nofollow noreferrer\">project I'm reviewing.</a></p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "edited": false, "score": 0, "creation_date": 1569169953, "post_id": 58051176, "comment_id": 102500500, "body": "Look at the right column on this page: <a href=\"https://ruby-doc.org/core-2.6.4/\" rel=\"nofollow noreferrer\">ruby-doc.org/core-2.6.4</a> There is just String#to_str. You can always define your to_str method for a certain Class. But what&#39;s the goal?"}, {"owner": {"reputation": 4127, "user_id": 4231385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d89a541a4609cafea3957e4cdfcca50f?s=128&d=identicon&r=PG&f=1", "display_name": "cremno", "link": "https://stackoverflow.com/users/4231385/cremno"}, "edited": false, "score": 2, "creation_date": 1569175407, "post_id": 58051176, "comment_id": 102502014, "body": "The Ruby programming language supports inspection/reflection (e.g. <code>ObjectSpace</code>) which you can make use of to find the answer by yourself. It&#39;s also more trustworthy than any kind of documentation and even may raise new questions."}, {"owner": {"reputation": 179, "user_id": 2418839, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/831f269745f2902732d71ff9f69d3ac7?s=128&d=identicon&r=PG", "display_name": "Burdette Lamar", "link": "https://stackoverflow.com/users/2418839/burdette-lamar"}, "reply_to_user": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "edited": false, "score": 0, "creation_date": 1569178759, "post_id": 58051176, "comment_id": 102502939, "body": "Thanks, @iGian.  True, nothing in core, but still could be in std-lib.  Env.store(name, value) coerces both name and value via #to_str, so was looking for a non-String method to illustrate.  ENV&#39;s own tests cheat thus:    it &quot;coerces the key argument with #to_str&quot; do     k = mock(&quot;key&quot;)     k.should_receive(:to_str).and_return(&quot;foo&quot;)     ENV.send(@method, k, &quot;bar&quot;)     ENV[&quot;foo&quot;].should == &quot;bar&quot;   end"}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1569183023, "post_id": 58051176, "comment_id": 102503994, "body": "@BurdetteLamar you can wrap code in bactics in comments like <code>puts &#39;hello&#39;</code> for example. For more tips click the little <code>help</code> link below the <code>Add Comment</code> button when typing comments."}, {"owner": {"reputation": 179, "user_id": 2418839, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/831f269745f2902732d71ff9f69d3ac7?s=128&d=identicon&r=PG", "display_name": "Burdette Lamar", "link": "https://stackoverflow.com/users/2418839/burdette-lamar"}, "reply_to_user": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1569193791, "post_id": 58051176, "comment_id": 102506031, "body": "Thanks, @lacostenycoder, good info."}], "answers": [{"tags": [], "owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "is_accepted": true, "score": 7, "last_activity_date": 1569194043, "last_edit_date": 1569194043, "creation_date": 1569182241, "answer_id": 58052926, "question_id": 58051176, "link": "https://stackoverflow.com/questions/58051176/is-there-a-ruby-built-in-class-or-module-other-than-string-that-has-method-to/58052926#58052926", "title": "Is there a Ruby built-in class or module (other than String) that has method #to_str?", "body": "<p>The easiest way is to ask Ruby herself:</p>\n\n<pre><code>ObjectSpace.\n  each_object(Module).\n  select {|mod| mod.instance_methods(false).include?(:to_str) } - \n    [String]\n#=&gt; [NameError::message]\n</code></pre>\n\n<p>So, it turns out the only other class that defines <code>to_str</code> is an internal implementation class inside <code>NameError</code>. Which makes sense, really, there are not that many objects in Ruby that <em>are</em> strings but are not instances of <code>String</code>.</p>\n\n<p>I would expect a Ropes library (if such a thing exists) to implement <code>to_str</code>, for example.</p>\n"}, {"tags": [], "owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "is_accepted": false, "score": 1, "last_activity_date": 1569185405, "last_edit_date": 1569185405, "creation_date": 1569184820, "answer_id": 58053233, "question_id": 58051176, "link": "https://stackoverflow.com/questions/58051176/is-there-a-ruby-built-in-class-or-module-other-than-string-that-has-method-to/58053233#58053233", "title": "Is there a Ruby built-in class or module (other than String) that has method #to_str?", "body": "<p>This doesn't answer the question if there is any class that implements the <code>#to_str</code> method. Rather this answer focuses on:</p>\n\n<blockquote>\n  <p>For some testing, I'm looking for a Ruby built-in class or module (other than String) that has method #to_str.</p>\n</blockquote>\n\n<p>You could create an temporary class for testing purposes that forwards all calls to the internal string.</p>\n\n<pre><code>require 'delegate'\n\n# create an anonymous class inheriting from DelegateClass(String)\nmy_string_class = Class.new(DelegateClass(String))\nmy_string       = my_string_class.new(\"Hello World!\")\n\nmy_string.is_a?(String)     #=&gt; false\n\"Hello World!\" == my_string #=&gt; true\n</code></pre>\n\n<p>The reason the above comparison returns <code>true</code> can be found in the <em>String</em> <a href=\"https://ruby-doc.org/core-2.6.4/String.html#method-i-3D-3D\" rel=\"nofollow noreferrer\">documentation</a>.</p>\n\n<blockquote>\n  <h2>str == obj \u2192 true or false</h2>\n  \n  <p>Equality\u2014Returns whether <code>str == obj</code>, similar to <code>Object#==</code>.</p>\n  \n  <p>If <code>obj</code> is not an instance of <a href=\"https://ruby-doc.org/core-2.6.4/String.html\" rel=\"nofollow noreferrer\">String</a> but responds to <code>to_str</code>, then the two strings are compared using <code>obj.==</code>.</p>\n  \n  <p>Otherwise, returns similarly to <a href=\"https://ruby-doc.org/core-2.6.4/String.html#method-i-eql-3F\" rel=\"nofollow noreferrer\"><code>#eql?</code></a>, comparing length and content.</p>\n</blockquote>\n\n<p>You could also skip the creation of the anonymous class and use <em>SimpleDelegator</em> instead.</p>\n\n<pre><code>my_string = SimpleDelegator.new(\"Hello World!\")\n</code></pre>\n\n<p>For more info about delegators take a look at the <a href=\"https://ruby-doc.org/stdlib-2.6.4/libdoc/delegate/rdoc/index.html\" rel=\"nofollow noreferrer\">documentation</a>.</p>\n"}], "owner": {"reputation": 179, "user_id": 2418839, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/831f269745f2902732d71ff9f69d3ac7?s=128&d=identicon&r=PG", "display_name": "Burdette Lamar", "link": "https://stackoverflow.com/users/2418839/burdette-lamar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 58052926, "answer_count": 2, "score": 4, "last_activity_date": 1569194043, "creation_date": 1569169478, "question_id": 58051176, "link": "https://stackoverflow.com/questions/58051176/is-there-a-ruby-built-in-class-or-module-other-than-string-that-has-method-to", "title": "Is there a Ruby built-in class or module (other than String) that has method #to_str?", "body": "<p>For some testing, I'm looking for a Ruby built-in class or module (other than String) that has method #to_str.</p>\n\n<p>(I know that many have method #to_s, but that's not what I'm looking for.)</p>\n\n<p>I've pored over the docs, and can't find any such.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "heroku"], "answers": [{"tags": [], "owner": {"reputation": 301, "user_id": 10213506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6864b90887eb6f1190eda117c20494e8?s=128&d=identicon&r=PG&f=1", "display_name": "vendrediSurMer", "link": "https://stackoverflow.com/users/10213506/vendredisurmer"}, "is_accepted": true, "score": 0, "last_activity_date": 1569191987, "creation_date": 1569191987, "answer_id": 58053900, "question_id": 58050862, "link": "https://stackoverflow.com/questions/58050862/how-i-can-slove-heroku-h13/58053900#58053900", "title": "How I can slove heroku H13?", "body": "<p>A few ideas since I don't know your exact case:</p>\n\n<ul>\n<li>If your server (e.g. Unicorn) worker timeout is set to less than 30\nseconds, you could try increasing it to a higher value (but Heroku\nlimits this to 30s explicitly).</li>\n<li>If this only happens when you first try to load the application after it has been idle (sleeping) for some time, then this is expected. The subsequent requests should be fast though.   </li>\n<li>If you're performing long processes within the HTTP request context\nand they frequently take more than 30 seconds to complete, you might\nwant to consider using a background job manager (e.g. Sidekiq for\nRuby) to run such processes in the application background.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 595, "user_id": 3632472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e431a79c8cf18fc5c29ebb94a721dda?s=128&d=identicon&r=PG&f=1", "display_name": "Rakesh", "link": "https://stackoverflow.com/users/3632472/rakesh"}, "is_accepted": false, "score": 0, "last_activity_date": 1569224908, "creation_date": 1569224908, "answer_id": 58057808, "question_id": 58050862, "link": "https://stackoverflow.com/questions/58050862/how-i-can-slove-heroku-h13/58057808#58057808", "title": "How I can slove heroku H13?", "body": "<p><strong>H13 - Connection closed without response</strong></p>\n\n<p>This error is thrown when a process in your web dyno accepts a connection, but then closes the socket without writing anything to it.</p>\n\n<p>One example where this might happen is when a Unicorn web server is configured with a timeout shorter than 30s and a request has not been processed by a worker before the timeout happens. In this case, Unicorn closes the connection before any data is written, resulting in an H13.</p>\n\n<p>A couple lines up, you have an error about a process timing out after say 15s:</p>\n\n<pre><code>ERROR -- : worker=1 PID:8 timeout (16s &gt; 15s), killing\n</code></pre>\n\n<p>Heroku help has a section on timeout settings:</p>\n\n<p>In Unicorn you can set a timeout in config/unicorn.rb like this:</p>\n\n<pre><code>timeout 15\n</code></pre>\n\n<p>The timer will begin once Unicorn starts processing the request, if 15 seconds pass, then the master process will send a SIGKILL to the worker but no exception will be raised.</p>\n\n<p>P.s. If you are getting above error in one request so you can try below steps - </p>\n\n<pre><code>-&gt; push the API call to background job\n-&gt; submit the form as ajax\n-&gt; In the action which handle submit, trigger the background job and render the job_id , the path to which need to be redirected and other parameter you want to reuse\n-&gt; On success of ajax request, trigger another ajax call to a separate method which keep checking the status of the job after a fix interval say 3 seconds.\n-&gt; when the second ajax call see that status is complete, it will reload the page\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 11735024, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SS79i.jpg?s=128&g=1", "display_name": "Yashy", "link": "https://stackoverflow.com/users/11735024/yashy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 58053900, "answer_count": 2, "score": 0, "last_activity_date": 1569224908, "creation_date": 1569167335, "last_edit_date": 1569167655, "question_id": 58050862, "link": "https://stackoverflow.com/questions/58050862/how-i-can-slove-heroku-h13", "title": "How I can slove heroku H13?", "body": "<p>I've been getting this error now on &amp; off for the past couple days since I deployed my application(Ruby on Rails) to heroku.</p>\n\n<pre><code>2019-09-22T15:35:11.196499+00:00 heroku[router]: at=error code=H13 desc=\"Connection closed without response\" method=GET path=\"/\" host=myapp.herokuapp.com request_id=82376036-bcc3-4f63-8019-1b206e534947 fwd=\"60.114.58.106\" dyno=web.1 connect=1ms service=908ms status=503 bytes=0 protocol=https\n2019-09-22T15:35:11.252159+00:00 heroku[web.1]: Process exited with status 134\n</code></pre>\n\n<p>I tried following commands, but I couldn't solve error.</p>\n\n<pre><code>$heroku container:rm web\n$heroku container:push web\n$heroku container:release web\n</code></pre>\n\n<p>I want to know solving H13 error.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["ruby", "hex", "byte", "unpack"], "comments": [{"owner": {"reputation": 2466, "user_id": 1596750, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AUl9X.jpg?s=128&g=1", "display_name": "Ross Jacobs", "link": "https://stackoverflow.com/users/1596750/ross-jacobs"}, "edited": false, "score": 0, "creation_date": 1569172417, "post_id": 58049215, "comment_id": 102501200, "body": "Please add the code you have so far. Please make sure to create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">Minimal, Reproducible Example</a>."}, {"owner": {"reputation": 61, "user_id": 3756887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d19f2f0f8e3bdafb0cb9d550d12f91d9?s=128&d=identicon&r=PG&f=1", "display_name": "Leighton James", "link": "https://stackoverflow.com/users/3756887/leighton-james"}, "reply_to_user": {"reputation": 2466, "user_id": 1596750, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AUl9X.jpg?s=128&g=1", "display_name": "Ross Jacobs", "link": "https://stackoverflow.com/users/1596750/ross-jacobs"}, "edited": false, "score": 0, "creation_date": 1569176840, "post_id": 58049215, "comment_id": 102502414, "body": "@RossJacobs The code I have tried so far is string.unpack(&#39;B8B8B8&#39;) and string.unpack(&#39;B8S&gt;&#39;) as mentioned in my question?"}], "owner": {"reputation": 61, "user_id": 3756887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d19f2f0f8e3bdafb0cb9d550d12f91d9?s=128&d=identicon&r=PG&f=1", "display_name": "Leighton James", "link": "https://stackoverflow.com/users/3756887/leighton-james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1569155373, "creation_date": 1569155373, "question_id": 58049215, "link": "https://stackoverflow.com/questions/58049215/unpacking-a-payload-using-ruby", "title": "Unpacking a payload using Ruby", "body": "<p>I have a hex payload 1703cd0650000aff79fc2802 which I would like to unpack to values. I have been given a definition:</p>\n\n<p>Byte 1:</p>\n\n<p>0bxx01, order: MS nibble</p>\n\n<p>0byyxx, order: LS nibble</p>\n\n<p>Byte 2  0bxxxxxxxx  MSB</p>\n\n<p>Byte 3  0bxxxxxxxx  LSB</p>\n\n<p>and so on for 12 bytes in total</p>\n\n<p>And I concat byte 2+3 to get a distance in mm. Could anyone help me with an unpack that could achieve this?</p>\n\n<p>I have tried to unpack using 'B8B8B8':</p>\n\n<p>Byte 1, part 1: I get 0001 which I calc to be 1</p>\n\n<p>Byte 1, part 2: I get 1110, which I have reversed (as LSB) which gives me 14</p>\n\n<p>Byte 2: I get 00000011, which I think is 3</p>\n\n<p>Byte 3: I get 11001101, which I reversed to 10110011 (as LSB), which I think is 179</p>\n\n<p>So is the value 3 + 179 concat 3179 or ('00000011' + '10110011').to_i(2) which is 973</p>\n\n<p>I have also tried to unpack with 'B8S>', and byte2 also gives me 973.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["arrays", "ruby", "sorting", "hash"], "comments": [{"owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "edited": false, "score": 0, "creation_date": 1569180601, "post_id": 58048956, "comment_id": 102503419, "body": "What do you mean as first half?"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1569193576, "post_id": 58048956, "comment_id": 102506009, "body": "You selected an answer that returns an ordering that is considerably different than your desired &quot;final result&quot;. What is your justification for doing so?"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "reply_to_user": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "edited": false, "score": 0, "creation_date": 1569194038, "post_id": 58048956, "comment_id": 102506063, "body": "I&#39;ve downvoted your question because it is not clear. Specifically, what is the criterion for partitioning the array before the sorting of the two parts is performed? If you address @iGian&#39;s comment (which I don&#39;t believe you&#39;ve seen) by clarifying with an edit, I will remove my downvote."}], "answers": [{"comments": [{"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1569193475, "post_id": 58049308, "comment_id": 102505999, "body": "This returns <code>[{:rating=&gt;4.0, :num=&gt;38}, {:rating=&gt;4.0, :num=&gt;23}, {:rating=&gt;3.5, :num=&gt;37}, {:rating=&gt;1, :num=&gt;1}, {:rating=&gt;1, :num=&gt;1}, {:rating=&gt;3.5, :num=&gt;72}, {:rating=&gt;4.0, :num=&gt;72}, {:rating=&gt;4.0, :num=&gt;74}]</code>, which bears little resemblance to the OP&#39;s  desired &quot;final result&quot;."}, {"owner": {"reputation": 6624, "user_id": 4896493, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/197888927236621/picture?type=large", "display_name": "Sergey Mell", "link": "https://stackoverflow.com/users/4896493/sergey-mell"}, "edited": false, "score": 0, "creation_date": 1569226783, "post_id": 58049308, "comment_id": 102513711, "body": "Actually, my answer follows the general idea - minimal in the middle and increase step by step toward the endings. If you want to get exactly the same answer as in the question just change <code>is_odd</code> determination to <code>is_odd = i % 2 == 0</code>."}], "tags": [], "owner": {"reputation": 6624, "user_id": 4896493, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/197888927236621/picture?type=large", "display_name": "Sergey Mell", "link": "https://stackoverflow.com/users/4896493/sergey-mell"}, "is_accepted": true, "score": 1, "last_activity_date": 1569155976, "creation_date": 1569155976, "answer_id": 58049308, "question_id": 58048956, "link": "https://stackoverflow.com/questions/58048956/sorting-an-array-of-hashes-with-the-smallest-value-in-the-middle/58049308#58049308", "title": "Sorting an array of hashes with the smallest value in the middle", "body": "<p>Maybe a bit complicated solution but it works. Please take a look while I'll try to refactor it</p>\n\n<pre><code>initial_array = [\n    {:rating=&gt;1, :num=&gt;1},\n    {:rating=&gt;1, :num=&gt;1},\n    {:rating=&gt;3.5, :num=&gt;37},\n    {:rating=&gt;4.0, :num=&gt;23},\n    {:rating=&gt;4.0, :num=&gt;72},\n    {:rating=&gt;4.0, :num=&gt;38},\n    {:rating=&gt;3.5, :num=&gt;72},\n    {:rating=&gt;4.0, :num=&gt;74}\n]\n\n\nlength = initial_array.length\nnew_array = []\n\nlength.times do |i|\n  is_odd = i % 2 == 1\n  min_index = initial_array.map{|el| el[:rating]}.each_with_index.min.last\n  if is_odd\n    new_array.push(initial_array.delete_at(min_index))\n  else\n    new_array.unshift(initial_array.delete_at(min_index))\n  end\nend\n\np new_array\n</code></pre>\n\n<p>The main idea is to find minimum element from the array each time and push it to a new array once from right and once from left.</p>\n\n<p>The minimum value is found by rating (<code>map{|el| el[:rating]}</code>) however you can implement some more complex function that will utilize both <code>rating</code> and <code>num</code> depending on your business logic.</p>\n"}, {"comments": [{"owner": {"reputation": 13, "user_id": 3988356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/081e2fbed9079f4ba9b232bdceb3a0f5?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastian Cretu", "link": "https://stackoverflow.com/users/3988356/sebastian-cretu"}, "edited": false, "score": 0, "creation_date": 1569522132, "post_id": 58105993, "comment_id": 102633869, "body": "Interesting approach. This also works great. Thank you!"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "reply_to_user": {"reputation": 13, "user_id": 3988356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/081e2fbed9079f4ba9b232bdceb3a0f5?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastian Cretu", "link": "https://stackoverflow.com/users/3988356/sebastian-cretu"}, "edited": false, "score": 0, "creation_date": 1569522597, "post_id": 58105993, "comment_id": 102634080, "body": "Is the interpretation I set out in my first paragraph correct? Regardless, you need to edit your question to clarify &quot;split an array in half&quot;."}], "tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": false, "score": 0, "last_activity_date": 1569442698, "creation_date": 1569442698, "answer_id": 58105993, "question_id": 58048956, "link": "https://stackoverflow.com/questions/58048956/sorting-an-array-of-hashes-with-the-smallest-value-in-the-middle/58105993#58105993", "title": "Sorting an array of hashes with the smallest value in the middle", "body": "<p>The only interpretation I can think of for \"split an array in half\" that is consistent with your desired result, is that the hashes that are to be sorted in ascending order are those hashes <code>h</code> for which <code>h[:num]</code> is less than the average of the values <code>h[:num]</code> for all hashes <code>h</code> in the array, and that the remaining hashes are to be sorted in ascending order.</p>\n\n<p>Assuming this interpretation is correct, and letting the variable <code>arr</code> hold your array, the desired sorted array can be obtained as follows.</p>\n\n<pre><code>avg = arr.sum { |h| h[:num] }.fdiv(arr.size)\n  #=&gt; 39.75\n\narr.sort_by { |h| h[:num] &lt; avg ? [h[:rating], h[:num]] : [-h[:rating], -h[:num]] }\n  #=&gt; [{:rating=&gt;4.0, :num=&gt;74},\n  #    {:rating=&gt;4.0, :num=&gt;72},\n  #    {:rating=&gt;3.5, :num=&gt;72},\n  #    {:rating=&gt;1,   :num=&gt; 1},\n  #    {:rating=&gt;1,   :num=&gt; 1},\n  #    {:rating=&gt;3.5, :num=&gt;37},\n  #    {:rating=&gt;4.0, :num=&gt;23},\n  #    {:rating=&gt;4.0, :num=&gt;38}] \n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 3988356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/081e2fbed9079f4ba9b232bdceb3a0f5?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastian Cretu", "link": "https://stackoverflow.com/users/3988356/sebastian-cretu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 58049308, "answer_count": 2, "score": 0, "last_activity_date": 1569521578, "creation_date": 1569153275, "last_edit_date": 1569521578, "question_id": 58048956, "link": "https://stackoverflow.com/questions/58048956/sorting-an-array-of-hashes-with-the-smallest-value-in-the-middle", "title": "Sorting an array of hashes with the smallest value in the middle", "body": "<p>I'm new to ruby and didn't manage to find any answer or logic about how can I do this. I'm trying to split an array in half, and half of it to sort it descending, and the other half ascending.</p>\n\n<p>Long story short, lets consider we have the following array of hashes:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>[\n {:rating=&gt;1, :num=&gt;1},\n {:rating=&gt;1, :num=&gt;1},\n {:rating=&gt;3.5, :num=&gt;37},\n {:rating=&gt;4.0, :num=&gt;23},\n {:rating=&gt;4.0, :num=&gt;72},\n {:rating=&gt;4.0, :num=&gt;38}, \n {:rating=&gt;3.5, :num=&gt;72}, \n {:rating=&gt;4.0, :num=&gt;74}\n]\n</code></pre>\n\n<p>I'm not very good at explaining things, but I will try my best to explain better whats the expected result.</p>\n\n<p>First I need to get the hash that has the smallest <code>:rating</code> key value and <code>:num</code> key value and push it in a new array. The remaining hashes should be sorted asc after <code>:rating</code> and <code>:num</code> and then, each of the hashes, starting with the one that has the smallest <code>:rating</code> value, should be pushed in the new created array following the rule: one in the beginning of the array and one in the end until no hashes remain.</p>\n\n<p>So the final result should look like this:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>[\n {:rating=&gt;4.0, :num=&gt;74},\n {:rating=&gt;4.0, :num=&gt;72},\n {:rating=&gt;3.5, :num=&gt;72},\n {:rating=&gt;1, :num=&gt;1},\n {:rating=&gt;1, :num=&gt;1},\n {:rating=&gt;3.5, :num=&gt;37},\n {:rating=&gt;4.0, :num=&gt;23},\n {:rating=&gt;4.0, :num=&gt;38}\n]\n</code></pre>\n\n<p>Any help is highly appreciated. Thanks.</p>\n"}, {"tags": ["ruby", "xcode", "xcode11"], "answers": [{"tags": [], "owner": {"reputation": 19227, "user_id": 3040446, "user_type": "registered", "accept_rate": 35, "profile_image": "https://i.stack.imgur.com/xspEJ.png?s=128&g=1", "display_name": "Ted", "link": "https://stackoverflow.com/users/3040446/ted"}, "is_accepted": false, "score": 1, "last_activity_date": 1569736974, "last_edit_date": 1569736974, "creation_date": 1569134558, "answer_id": 58046738, "question_id": 58046737, "link": "https://stackoverflow.com/questions/58046737/xcversion-update-nomethoderror-undefined-method-first-for-nilnilclass/58046738#58046738", "title": "xcversion update`: NoMethodError: undefined method `first&#39; for nil:NilClass", "body": "<p>Works for any ruby version manager (<strong>chruby</strong>, <strong>rvm</strong>, <strong>rbenv</strong>, etc or <strong>no version manage</strong>r)</p>\n\n<p>When you call </p>\n\n<pre><code>xcversion update\n</code></pre>\n\n<ol>\n<li>Get the path of the failing file -> <strong>install.rb</strong></li>\n<li>Open it in your editor</li>\n</ol>\n\n<p><a href=\"https://i.stack.imgur.com/WGkQH.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/WGkQH.gif\" alt=\"enter image description here\"></a></p>\n\n<ol start=\"3\">\n<li>Comment line 382</li>\n</ol>\n\n<p><a href=\"https://i.stack.imgur.com/RXL4f.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/RXL4f.gif\" alt=\"enter image description here\"></a></p>\n"}, {"tags": [], "owner": {"reputation": 628, "user_id": 336616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/dc730ac7300ee5d01caaf9631eaffdde?s=128&d=identicon&r=PG", "display_name": "Frost", "link": "https://stackoverflow.com/users/336616/frost"}, "is_accepted": false, "score": 0, "last_activity_date": 1569230416, "creation_date": 1569230416, "answer_id": 58059280, "question_id": 58046737, "link": "https://stackoverflow.com/questions/58046737/xcversion-update-nomethoderror-undefined-method-first-for-nilnilclass/58059280#58059280", "title": "xcversion update`: NoMethodError: undefined method `first&#39; for nil:NilClass", "body": "<p>A workaround is to comment out the failing call in <code>install.rb</code>, however its path varies by installation.</p>\n\n<p>Check the output of the xcversion command to find it:</p>\n\n<pre><code>Available session is not valid any more. Continuing with normal login.\n/usr/local/lib/ruby/gems/2.4.0/gems/xcode-install-2.4.4/lib/xcode/install.rb:444:in `prereleases': undefined method `first' for nil:NilClass (NoMethodError)\n    from /usr/local/lib/ruby/gems/2.4.0/gems/xcode-install-2.4.4/lib/xcode/install.rb:379:in `fetch_seedlist'\n</code></pre>\n\n<p>--> <code>/usr/local/lib/ruby/gems/2.4.0/gems/xcode-install-2.4.4/lib/xcode/install.rb</code></p>\n\n<p>Open that <code>install.rb</code> in a text editor, go to line #382 which calls the prereleases function and comment it out by changing it to</p>\n\n<pre><code>#@xcodes += prereleases.reject { |pre| names.include?(pre.name) }\n</code></pre>\n\n<p>(Note: this is exactly the same solution as provided by Ted, but without the flashing gifs.)</p>\n"}], "owner": {"reputation": 19227, "user_id": 3040446, "user_type": "registered", "accept_rate": 35, "profile_image": "https://i.stack.imgur.com/xspEJ.png?s=128&g=1", "display_name": "Ted", "link": "https://stackoverflow.com/users/3040446/ted"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1569736974, "creation_date": 1569134558, "question_id": 58046737, "link": "https://stackoverflow.com/questions/58046737/xcversion-update-nomethoderror-undefined-method-first-for-nilnilclass", "title": "xcversion update`: NoMethodError: undefined method `first&#39; for nil:NilClass", "body": "<p>When downloading xcode 11 with xcode-install 2.6.1, we get this error</p>\n\n<blockquote>\n  <p>xcversion update<code>: NoMethodError: undefined method</code>first' for nil:NilClass</p>\n</blockquote>\n\n<p>Its a known issue <a href=\"https://github.com/xcpretty/xcode-install/issues/348\" rel=\"nofollow noreferrer\">https://github.com/xcpretty/xcode-install/issues/348</a></p>\n\n<p>How to fix it?</p>\n"}, {"tags": ["ruby", "string", "watir"], "comments": [{"owner": {"reputation": 798, "user_id": 652779, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/bfdf2256663085a64c468c4b4c0f62f4?s=128&d=identicon&r=PG", "display_name": "Lomefin", "link": "https://stackoverflow.com/users/652779/lomefin"}, "edited": false, "score": 2, "creation_date": 1569118988, "post_id": 58045449, "comment_id": 102490807, "body": "There is an issue in Watir&#39;s github (<a href=\"https://github.com/watir/watir/issues/877\" rel=\"nofollow noreferrer\">github.com/watir/watir/issues/877</a>) the errors are ocurring in several places and it looks like a Ruby 2.6 issue.  I will downgrade ruby for the sake of moving forwards for now."}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 1, "creation_date": 1569121975, "post_id": 58045449, "comment_id": 102491116, "body": "I am using Ruby 2.6 with recent watir but I don&#39;t have any such issue."}, {"owner": {"reputation": 798, "user_id": 652779, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/bfdf2256663085a64c468c4b4c0f62f4?s=128&d=identicon&r=PG", "display_name": "Lomefin", "link": "https://stackoverflow.com/users/652779/lomefin"}, "reply_to_user": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1569792077, "post_id": 58045449, "comment_id": 102700888, "body": "Maybe it is because your code can find firefox, mine was unaccessible from the code and thus an exception was tried to be thrown and it fell in that moment."}], "answers": [{"comments": [{"owner": {"reputation": 798, "user_id": 652779, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/bfdf2256663085a64c468c4b4c0f62f4?s=128&d=identicon&r=PG", "display_name": "Lomefin", "link": "https://stackoverflow.com/users/652779/lomefin"}, "edited": false, "score": 1, "creation_date": 1569792010, "post_id": 58073727, "comment_id": 102700879, "body": "Yes, finally that is the issue. It breaks while trying to show up the problem."}], "tags": [], "owner": {"reputation": 6589, "user_id": 409820, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b01ab32f3a9016b9e2ade35f3aeb4023?s=128&d=identicon&r=PG", "display_name": "Chuck van der Linden", "link": "https://stackoverflow.com/users/409820/chuck-van-der-linden"}, "is_accepted": true, "score": 0, "last_activity_date": 1569303702, "creation_date": 1569303702, "answer_id": 58073727, "question_id": 58045449, "link": "https://stackoverflow.com/questions/58045449/frozenerror-when-creating-new-watir-browser/58073727#58073727", "title": "FrozenError when creating new Watir Browser", "body": "<p>Is it possible that firefox is not installed or not being found?  There's a <a href=\"https://github.com/SeleniumHQ/selenium/issues/7365\" rel=\"nofollow noreferrer\">known bug</a> for Webdriver will generate an error like this if you are on a newer version of Ruby and it can't locate the firefox executable.   (all of which might change in the future when that issue is addressed) </p>\n\n<p>if you read the issue, it's trying to do some magic with strings for the error message, but also wanting to use frozen strings, and thus the error (can't have it both ways)</p>\n"}], "owner": {"reputation": 798, "user_id": 652779, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/bfdf2256663085a64c468c4b4c0f62f4?s=128&d=identicon&r=PG", "display_name": "Lomefin", "link": "https://stackoverflow.com/users/652779/lomefin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 58073727, "answer_count": 1, "score": 2, "last_activity_date": 1569303702, "creation_date": 1569117195, "question_id": 58045449, "link": "https://stackoverflow.com/questions/58045449/frozenerror-when-creating-new-watir-browser", "title": "FrozenError when creating new Watir Browser", "body": "<p>I'm trying to open a new <code>Watir::Browser</code> on a Heroku machine</p>\n\n<p>The instruction I am giving is</p>\n\n<pre><code>browser = Watir::Browser.new :firefox\n</code></pre>\n\n<p>But this is throwing me an exception</p>\n\n<p><code>FrozenError (can't modify frozen String)</code></p>\n\n<p>I must assume this is a ruby 2.6 issue</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "devise"], "comments": [{"owner": {"reputation": 2019, "user_id": 9595653, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-jNAfm9c6bRo/AAAAAAAAAAI/AAAAAAAAABA/2JGGWk6fJl8/photo.jpg?sz=128", "display_name": "Clara", "link": "https://stackoverflow.com/users/9595653/clara"}, "edited": false, "score": 1, "creation_date": 1569128542, "post_id": 58045324, "comment_id": 102491857, "body": "Signing out by merely typing localhost:3000/clients/sign_out won&#39;t work because it expects the DELETE verb in the http request, not GET. Have you tried to create a sign out link? <code>&lt;%= link_to, &quot;Logout&quot;, destroy_user_session_path, method: :delete %&gt;</code> Other than that I assume the code in our custom controllers is mixing stuff up."}], "owner": {"reputation": 632, "user_id": 11467079, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6Ab3W.jpg?s=128&g=1", "display_name": "FlowMafia", "link": "https://stackoverflow.com/users/11467079/flowmafia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 223, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1569115104, "creation_date": 1569115104, "question_id": 58045324, "link": "https://stackoverflow.com/questions/58045324/error-with-devise-you-are-already-signed-in-without-users-in-the-database-ra", "title": "Error with devise: &quot;You are already signed in&quot; without users in the database (Rails 5)", "body": "<p>I am using devise for my clients authentication, however, when I hit the sign up button in my view it throws me that I am already signed in, how so? I don't even have users in my database.</p>\n\n<p><strong>routes.rb</strong></p>\n\n<pre><code>Rails.application.routes.draw do\n  devise_for :clients, controllers: { registrations: 'clients/registrations', sessions: 'clients/sessions' }\n  root to: \"mainpages#index\"\n\n  get '/mainpages', controller: 'mainpages', action: 'index'\n  get '/planes', controller: 'planes', action: 'planes'\n\n  resources :planes\n</code></pre>\n\n<p>My controllers are inside of controllers/clients, At the moment I want to activate all the related with registration and sessions, so here's my registration controller</p>\n\n<p><strong>registrations_controller</strong></p>\n\n<pre><code>class Clients::RegistrationsController &lt; Devise::RegistrationsController\n   before_action :configure_sign_up_params, only: [:create]\n   before_action :configure_account_update_params, only: [:update]\n  # GET /resource/sign_up\n   def new\n     super\n     @client = Client.new\n   end\n\n  # POST /resource\n   def create\n     super\n     @client = Client.new(client_params)\n\n     #Set user perms to provider or to client\n\n       if @client.perms == false\n         @client.perms = \"Client\"\n       else\n         @client.perms = \"Provider\"\n       end\n\n         @client.status = \"Not activated\"\n\n       if @client.save \n         return redirect_to :root\n       end\n       render 'new'\n   end\n\n   protected\n\n   def configure_sign_up_params\n     devise_parameter_sanitizer.permit(:sign_up, keys: [:attribute])\n   end\n\n  # The path used after sign up.\n   def after_sign_up_path_for(resource)\n     super(resource)\n   end\n\n  private\n  def client_params\n    params.require(:client).permit(:name, :last_name, :email, :country, :username, :city, :address, :date, :perms, :status)\n  end\nend\n\n</code></pre>\n\n<p><strong>sessions_controller</strong></p>\n\n<pre><code># frozen_string_literal: true\n\nclass Clients::SessionsController &lt; Devise::SessionsController\n  # before_action :configure_sign_in_params, only: [:create]\n\n  # GET /resource/sign_in\n  def new\n    super\n  end\n\n  # POST /resource/sign_in\n  def create\n    super\n  end\n\n  # DELETE /resource/sign_out\n  def destroy\n    super\n  end\n\n  protected\n\n  # If you have extra params to permit, append them to the sanitizer.\n  def configure_sign_in_params\n    devise_parameter_sanitizer.permit(:sign_in, keys: [:attribute])\n  end\nend\n\n</code></pre>\n\n<p><strong>index.html.erb</strong> views/mainpages/</p>\n\n<pre><code>&lt;div class=\"col-sm-6\"&gt;&lt;h4&gt;Not a member?&lt;/h4&gt;\n    &lt;%= link_to '&lt;p&gt;You can create an account:&lt;/p&gt;'.html_safe, controller: \"clients/registrations\", action:\"new\" %&gt;\n        &lt;p class=\"text-center\"&gt;\n            &lt;%= link_to '&lt;i class=\"fas fa-sign-in-alt big-icon\"&gt;&lt;/i&gt;'.html_safe, controller: \"clients/registrations\", action:\"new\" %&gt;\n        &lt;/p&gt;\n&lt;/div&gt;\n</code></pre>\n\n<p>I tried to manually sign out by typing localhost:3000/clients/sign_out but I get a routing error, my link to the sign up page doesn't work if I don't get rid of that session, tried to restart the server but I still get the same error. </p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "answers": [{"comments": [{"owner": {"reputation": 61, "user_id": 2743478, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93b4b3ae64650054ec580d8dd4921132?s=128&d=identicon&r=PG&f=1", "display_name": "Ali Ove", "link": "https://stackoverflow.com/users/2743478/ali-ove"}, "edited": false, "score": 0, "creation_date": 1569109592, "post_id": 58044783, "comment_id": 102489853, "body": "In my model.rb ``` after_save: slug   def slug=(value)     write_attribute(:slug, value.gsub(/.*\\//, &#39;&#39;))   end ```"}], "tags": [], "owner": {"reputation": 22836, "user_id": 152786, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/581hP.jpg?s=128&g=1", "display_name": "smathy", "link": "https://stackoverflow.com/users/152786/smathy"}, "is_accepted": true, "score": 2, "last_activity_date": 1569107212, "creation_date": 1569107212, "answer_id": 58044783, "question_id": 58044696, "link": "https://stackoverflow.com/questions/58044696/how-to-remove-url-from-friendlyid-slug-if-user-inputs-www-examplesite-com/58044783#58044783", "title": "How to remove url from friendlyID slug if user inputs www.examplesite.com/", "body": "<p><code>self.slug = slug.sub /.*\\//, ''</code></p>\n"}], "owner": {"reputation": 61, "user_id": 2743478, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93b4b3ae64650054ec580d8dd4921132?s=128&d=identicon&r=PG&f=1", "display_name": "Ali Ove", "link": "https://stackoverflow.com/users/2743478/ali-ove"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 28, "favorite_count": 0, "accepted_answer_id": 58044783, "answer_count": 1, "score": 0, "last_activity_date": 1569107212, "creation_date": 1569106350, "question_id": 58044696, "link": "https://stackoverflow.com/questions/58044696/how-to-remove-url-from-friendlyid-slug-if-user-inputs-www-examplesite-com", "title": "How to remove url from friendlyID slug if user inputs www.examplesite.com/", "body": "<p>I am letting users enter a custom url slug in their profile page on sign up. When someone inevitably puts <a href=\"https://www.examplesite.com/exampleSlug\" rel=\"nofollow noreferrer\">https://www.examplesite.com/exampleSlug</a> || www.examplesite.com/exampleSlug etc in the form field as well as the slug itself. Instead of just example site. </p>\n\n<p>Is there a handy way in rails to remove all of the matches for the urls?</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>def slug_filter\n    if self.slug[/\\Ahttps:\\/\\/www.examplesite.com\\//] || self.slug[/\\Ahttp:\\/\\/www.examplesite.com\\//] || self.slug[/\\Awww.examplesite.com\\//] || self.slug[/\\Aexamplesite.com\\//]\n# Not sure what to do here?\n      self.slug = self.slug\n  end\n\n</code></pre>\n"}, {"tags": ["ruby"], "answers": [{"tags": [], "owner": {"reputation": 136, "user_id": 3540495, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ON2ijeeDNqw/AAAAAAAAAAI/AAAAAAAAAR8/9HRK2QEV9o4/photo.jpg?sz=128", "display_name": "ArMD", "link": "https://stackoverflow.com/users/3540495/armd"}, "is_accepted": true, "score": 1, "last_activity_date": 1569108586, "last_edit_date": 1569108586, "creation_date": 1569107782, "answer_id": 58044821, "question_id": 58044551, "link": "https://stackoverflow.com/questions/58044551/ruby-am-i-using-the-correct-scope/58044821#58044821", "title": "Ruby: Am I using the correct scope?", "body": "<p>There are two parts to this question.</p>\n\n<ol>\n<li><p>How to display an operation's result as a float value?</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>1/2 # this will give 0\n1.0/2 # this will give 0.5\n</code></pre></li>\n<li>How to limit a float value to 2 decimal places?<br>\nYou can use the round function\n\n<pre class=\"lang-rb prettyprint-override\"><code> 22.0/7 # this will give pi value - 3.142857142857143\n (22.0/7).round(2) # this will give 3.14\n</code></pre>\n\nThe two answers above can be combined to get your answer. I would leave it as an exercise for you to come up with the exact code to solve your problem.</li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 16237, "user_id": 2166798, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/417356917295f5176d2a3e7c21d8f9e8?s=128&d=identicon&r=PG", "display_name": "pjs", "link": "https://stackoverflow.com/users/2166798/pjs"}, "edited": false, "score": 0, "creation_date": 1569108995, "post_id": 58044835, "comment_id": 102489782, "body": "If you change <code>inject</code> to <code>inject(0)</code>, you can do away with the <code>if&#47;else</code> and turn it into a one-liner: <code>&#39;%.2f&#39; % (1..n).inject(0) { |sum, i| sum + (1&#47;(1.to_f + (3 * (i - 1)))) }</code>"}, {"owner": {"reputation": 96, "user_id": 6139537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0596629c3c2216a1d8bc79c094516d2b?s=128&d=identicon&r=PG&f=1", "display_name": "noordean", "link": "https://stackoverflow.com/users/6139537/noordean"}, "reply_to_user": {"reputation": 16237, "user_id": 2166798, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/417356917295f5176d2a3e7c21d8f9e8?s=128&d=identicon&r=PG", "display_name": "pjs", "link": "https://stackoverflow.com/users/2166798/pjs"}, "edited": false, "score": 0, "creation_date": 1569109181, "post_id": 58044835, "comment_id": 102489808, "body": "I was trying to make it as readable as possible considering the fact that the person asking the question is a beginner."}, {"owner": {"reputation": 16237, "user_id": 2166798, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/417356917295f5176d2a3e7c21d8f9e8?s=128&d=identicon&r=PG", "display_name": "pjs", "link": "https://stackoverflow.com/users/2166798/pjs"}, "edited": false, "score": 1, "creation_date": 1569109316, "post_id": 58044835, "comment_id": 102489822, "body": "I doubt that putting <code>(0)</code> alters the readability by much.  ;)"}], "tags": [], "owner": {"reputation": 96, "user_id": 6139537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0596629c3c2216a1d8bc79c094516d2b?s=128&d=identicon&r=PG&f=1", "display_name": "noordean", "link": "https://stackoverflow.com/users/6139537/noordean"}, "is_accepted": false, "score": 2, "last_activity_date": 1569107949, "creation_date": 1569107949, "answer_id": 58044835, "question_id": 58044551, "link": "https://stackoverflow.com/questions/58044551/ruby-am-i-using-the-correct-scope/58044835#58044835", "title": "Ruby: Am I using the correct scope?", "body": "<p>A couple of things to note:\n - Ruby has <code>reduce</code> method that can sum up a list of numbers: <a href=\"https://apidock.com/ruby/Enumerable/reduce\" rel=\"nofollow noreferrer\">https://apidock.com/ruby/Enumerable/reduce</a>\n - You don't need to explicitly <code>return</code> from your method. Ruby automatically returns the last statement in your method.</p>\n\n<p>I've modified your solution, and this should work:</p>\n\n<pre><code>def series_sum(n)\n  if n &gt; 1\n    sum = (1..n).inject { |sum, i| sum + (1/(1.to_f + (3 * (i - 1)))) }\n  else\n    sum = n\n  end\n  '%.2f' % sum\nend\n</code></pre>\n\n<p>When you are expecting a decimal number in a division, always make sure that either the numerator or the denominator is in float, hence the reason for the <code>1.to_f</code>.\n'%.2f' is a string format to ensure the final answer is returned in 2 decimal places.</p>\n"}, {"comments": [{"owner": {"reputation": 5, "user_id": 10961125, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BvxVd.jpg?s=128&g=1", "display_name": "04Tribe", "link": "https://stackoverflow.com/users/10961125/04tribe"}, "edited": false, "score": 0, "creation_date": 1569172940, "post_id": 58046318, "comment_id": 102501360, "body": "Thank you, I&#39;m new to Ruby but I cannot wait till this efficient. Nice!"}], "tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": false, "score": 0, "last_activity_date": 1569177317, "last_edit_date": 1569177317, "creation_date": 1569130267, "answer_id": 58046318, "question_id": 58044551, "link": "https://stackoverflow.com/questions/58044551/ruby-am-i-using-the-correct-scope/58046318#58046318", "title": "Ruby: Am I using the correct scope?", "body": "<pre><code>def series_sum(n)\n  return \"0.00\" if n.zero?\n  sprintf(\"%.2f\", (0..n-1).sum { |m| 1.fdiv(3*m+1) }.round(2))\nend\n</code></pre>\n\n<h1><p></p></h1>\n\n<pre><code>series_sum(0) #=&gt; \"0.00\" \nseries_sum(1) #=&gt; \"1.00\" \nseries_sum(2) #=&gt; \"1.25\" \nseries_sum(3) #=&gt; \"1.39\"\nseries_sum(4) #=&gt; \"1.49\" \nseries_sum(5) #=&gt; \"1.57\" \n</code></pre>\n\n<p>See <a href=\"https://ruby-doc.org/core-2.6.3/Kernel.html#method-i-sprintf\" rel=\"nofollow noreferrer\">Kernel#sprintf</a>. One could alternatively use <a href=\"https://ruby-doc.org/core-2.6.3/String.html#method-i-25\" rel=\"nofollow noreferrer\">String%</a>, which shares <code>sprintf</code>'s formatting directives:</p>\n\n<pre><code>\"%.2f\" % (0..n-1).sum { |m| 1.fdiv(3*m+1) }.round(2)\n</code></pre>\n\n<p>I am not aware of the existence of a closed-form expression for this partial sum. Though not relevant to the question, this partial sum can be shown to be  divergent.</p>\n"}], "owner": {"reputation": 5, "user_id": 10961125, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BvxVd.jpg?s=128&g=1", "display_name": "04Tribe", "link": "https://stackoverflow.com/users/10961125/04tribe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "accepted_answer_id": 58044821, "answer_count": 3, "score": 0, "last_activity_date": 1569177317, "creation_date": 1569104371, "last_edit_date": 1569105206, "question_id": 58044551, "link": "https://stackoverflow.com/questions/58044551/ruby-am-i-using-the-correct-scope", "title": "Ruby: Am I using the correct scope?", "body": "<p>I come from a JavaScript  background and wrote this similar to how I would in javascript. I am writing it in Ruby.\nThis is a codewars exercise. \nn being 0 and 1 returns 0.00 and 1.00 as expected. Every other positive natural number returns 0.</p>\n\n<pre><code># Task:\n# Your task is to write a function which returns the sum of following series upto nth term(parameter).\n# Series: 1 + 1/4 + 1/7 + 1/10 + 1/13 + 1/16 +...\n\n\n# Rules:\n# You need to round the answer to 2 decimal places and return it as String.\n# If the given value is 0 then it should return 0.00\n# You will only be given Natural Numbers as arguments.\n\n# Examples:\n# SeriesSum(1) =&gt; 1 = \"1.00\"\n# SeriesSum(2) =&gt; 1 + 1/4 = \"1.25\"\n# SeriesSum(5) =&gt; 1 + 1/4 + 1/7 + 1/10 + 1/13 = \"1.57\"\n\n\ndef series_sum(n)\n    sum = 0\n    if n == 0\n        return 0.00\n    elsif n == 1\n        return 1.00\n    else \n        n.times do |i|\n            if i == 1 \n                sum += 1\n                break\n            end \n            sum += 1/( 1 + (3 * (i - 1)) )\n        end\n    end\n    return sum \nend\n\nputs series_sum(0)\nputs series_sum(1)\nputs series_sum(2)\nputs series_sum(4)\nputs series_sum(5)\n</code></pre>\n"}, {"tags": ["ruby", "ssl", "command-line-interface", "rest-client"], "answers": [{"tags": [], "owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "is_accepted": true, "score": 1, "last_activity_date": 1569104329, "creation_date": 1569104329, "answer_id": 58044547, "question_id": 58044307, "link": "https://stackoverflow.com/questions/58044307/rest-client-gem-ror-getting-ssl-wrong-version-error/58044547#58044547", "title": "Rest-Client gem RoR, Getting SSL wrong version error", "body": "<p>Likely the port 3000 you access is only <code>http://</code> and not <code>https://</code>. Accessing a plain <code>http://</code> port with <code>https://</code> will cause the client to interpret the servers HTTP error message (since the beginning of the TLS handshake sent by the client was not valid HTTP) wrongly as HTTPS which can result in strange errors like invalid packet length or also wrong version number.</p>\n"}], "owner": {"reputation": 13, "user_id": 11170798, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-tAnnxwkgfmk/AAAAAAAAAAI/AAAAAAAAABI/4wfkJXDCE7E/photo.jpg?sz=128", "display_name": "aJEFFIKa", "link": "https://stackoverflow.com/users/11170798/ajeffika"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1015, "favorite_count": 0, "accepted_answer_id": 58044547, "answer_count": 1, "score": 1, "last_activity_date": 1569139148, "creation_date": 1569101860, "last_edit_date": 1569139148, "question_id": 58044307, "link": "https://stackoverflow.com/questions/58044307/rest-client-gem-ror-getting-ssl-wrong-version-error", "title": "Rest-Client gem RoR, Getting SSL wrong version error", "body": "<p>I want to build a cli ruby app which sends requests to Rails API server. I wanted to use rest-client gem to do that. Every time i use </p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>RestClient.post \n</code></pre>\n\n<p>I get the following error</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>SSL_connect returned=1 errno=0 state=error: wrong version number (OpenSSL::SSL::SSLError)\n</code></pre>\n\n<p>Is there anything i can do for it to run from the console? The code is pretty simple, I just wanted to test out the feature, so don't worry, that's not final.</p>\n\n<p>I am running rails 6.0.3, ruby 2.6.3.</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>require \"tty-prompt\"\nprompt = TTY::Prompt.new\nrequire 'rest-client'\n\n\n\nif prompt.yes? \"Do you have an account ?\"\n  email = prompt.ask('What is your email?') do |q|\n    q.validate(/\\A\\w+@\\w+\\.\\w+\\Z/, 'Invalid email address')\n  end\n  pass = prompt.mask('password:')\n  puts email\n  puts pass\n  RestClient.post \"https://localhost:3000/auth/sign_in\",  \"email: #{email},password:#{pass}\"\n  puts response.code\nelse\n  RestClient.post \"https://localhost:3000/auth\",  \"email: #{email},password:#{pass}\"\n\nend\n</code></pre>\n\n<p>I would like for the cli app to send a request to API, That's it, rest-client doesn't want to cooperate with me. Thank You :D</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "answers": [{"comments": [{"owner": {"reputation": 632, "user_id": 11467079, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6Ab3W.jpg?s=128&g=1", "display_name": "FlowMafia", "link": "https://stackoverflow.com/users/11467079/flowmafia"}, "edited": false, "score": 0, "creation_date": 1569100767, "post_id": 58043973, "comment_id": 102488615, "body": "So, if I want to resubmit the form when i refresh the page with the invalid data what should I put in the routes?"}, {"owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "reply_to_user": {"reputation": 632, "user_id": 11467079, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6Ab3W.jpg?s=128&g=1", "display_name": "FlowMafia", "link": "https://stackoverflow.com/users/11467079/flowmafia"}, "edited": false, "score": 0, "creation_date": 1569101234, "post_id": 58043973, "comment_id": 102488703, "body": "@FlowMafia It currently works as is. I&#39;m guessing you&#39;re simply refreshing the page wrong if you&#39;re running into trouble. Most web-browsers allow a refresh by pressing <code>F5</code>, <code>Ctrl + R</code> or clicking the \u21bb icon."}, {"owner": {"reputation": 632, "user_id": 11467079, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6Ab3W.jpg?s=128&g=1", "display_name": "FlowMafia", "link": "https://stackoverflow.com/users/11467079/flowmafia"}, "edited": false, "score": 0, "creation_date": 1569101351, "post_id": 58043973, "comment_id": 102488731, "body": "that&#39;s how I try to refresh it (F5), but the browser sends the request to load &quot;index&quot;, which, as i&#39;ve mentioned before i don&#39;t have a view for it because my intention was to resend the form :/ (rails 5, if that information is relevant)"}, {"owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "reply_to_user": {"reputation": 632, "user_id": 11467079, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6Ab3W.jpg?s=128&g=1", "display_name": "FlowMafia", "link": "https://stackoverflow.com/users/11467079/flowmafia"}, "edited": false, "score": 0, "creation_date": 1569101670, "post_id": 58043973, "comment_id": 102488788, "body": "@FlowMafia What web-browser + version are you using? As far as I know all modern browsers reload the page with a <code>POST</code> request."}, {"owner": {"reputation": 632, "user_id": 11467079, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6Ab3W.jpg?s=128&g=1", "display_name": "FlowMafia", "link": "https://stackoverflow.com/users/11467079/flowmafia"}, "edited": false, "score": 0, "creation_date": 1569101848, "post_id": 58043973, "comment_id": 102488822, "body": "Opera Version:63.0.3368.88"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 632, "user_id": 11467079, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6Ab3W.jpg?s=128&g=1", "display_name": "FlowMafia", "link": "https://stackoverflow.com/users/11467079/flowmafia"}, "edited": false, "score": 0, "creation_date": 1569136963, "post_id": 58043973, "comment_id": 102493074, "body": "@FlowMafia: what happens if you try in chrome or firefox?"}, {"owner": {"reputation": 632, "user_id": 11467079, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6Ab3W.jpg?s=128&g=1", "display_name": "FlowMafia", "link": "https://stackoverflow.com/users/11467079/flowmafia"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1569167702, "post_id": 58043973, "comment_id": 102499913, "body": "@SergioTulentsev same thing"}], "tags": [], "owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "is_accepted": false, "score": 6, "last_activity_date": 1569099386, "last_edit_date": 1569099386, "creation_date": 1569098753, "answer_id": 58043973, "question_id": 58043429, "link": "https://stackoverflow.com/questions/58043429/why-is-render-new-changing-my-url-ruby-on-rails/58043973#58043973", "title": "Why is &quot;render &#39;new&#39; &quot; changing my URL? (Ruby On Rails)", "body": "<p>The reason the URL shows <code>/clients</code> after submitting invalid data is because the <code>/clients/new</code> form submits the request to <code>clients#create</code> which is registered under <code>POST /clients</code> if you use the Rails defaults.</p>\n\n<p>If your data was valid, Rails will redirect the user to the root path <code>GET /</code>. If your data was invalid it will <code>render :new</code> as response to <code>POST /clients</code> which shows up as <code>/clients</code> in your browser.</p>\n\n<p>If you try to refresh the page after submitting invalid data, the browser should ask something like \"do you want to resubmit the form?\". If you click yes the page is refreshed and and it shouldn't hit <code>GET /clients</code> (which normally routes to <code>clients#index</code>). If you manually click in the URL bar of your web-browser and hit <kbd>Enter</kbd> a <code>GET /clients</code> request is send instead, thus landing you on the wrong page.</p>\n\n<p>You can see all routes, including request types, by running the <code>rails routes</code> command.</p>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 4916589, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eoQNA.jpg?s=128&g=1", "display_name": "Sumit Pahuja", "link": "https://stackoverflow.com/users/4916589/sumit-pahuja"}, "is_accepted": false, "score": 0, "last_activity_date": 1569106709, "creation_date": 1569106709, "answer_id": 58044733, "question_id": 58043429, "link": "https://stackoverflow.com/questions/58043429/why-is-render-new-changing-my-url-ruby-on-rails/58044733#58044733", "title": "Why is &quot;render &#39;new&#39; &quot; changing my URL? (Ruby On Rails)", "body": "<p>When you submit this form, it goes to /client URL with the post method. And when you call render method in case of error, \nlet's understand how 'render' works and what it does (and how it is different from 'redirect'):</p>\n\n<p>render: Renders the content that will be returned to the browser as the response body. </p>\n\n<p>Render tells Rails which view or asset to show a user, without losing access to any variables defined in the controller action.</p>\n\n<p>Redirect is different. The redirect_to method tells your browser to send a request to another URL. Since the request is completely different, the view to which you redirect will NOT have access to any variables defined in the controller.</p>\n\n<p>So in this case, if you redirect, you will lose your submitted data as this will be a completely fresh and independent request.</p>\n\n<p>There are some ways (described in below URL) by which you can also change the URL with render (but these are not the Rails and Rest way.)</p>\n\n<p><a href=\"https://stackoverflow.com/questions/4707471/render-template-and-change-url-string-in-browser\">Render template and change url string in browser?</a></p>\n"}, {"tags": [], "owner": {"reputation": 75558, "user_id": 544825, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/UFdOO.png?s=128&g=1", "display_name": "max", "link": "https://stackoverflow.com/users/544825/max"}, "is_accepted": true, "score": 12, "last_activity_date": 1583321941, "last_edit_date": 1583321941, "creation_date": 1569150496, "answer_id": 58048597, "question_id": 58043429, "link": "https://stackoverflow.com/questions/58043429/why-is-render-new-changing-my-url-ruby-on-rails/58048597#58048597", "title": "Why is &quot;render &#39;new&#39; &quot; changing my URL? (Ruby On Rails)", "body": "<p>Your expectation is completely wrong but quite common among Rails beginners.</p>\n\n<p>In <a href=\"https://guides.rubyonrails.org/routing.html#resource-routing-the-rails-default\" rel=\"noreferrer\">Rails flavor REST</a> <code>GET /clients/new</code> is just a page that contains the form for creating a new resource. Since its a GET request it is <a href=\"https://restfulapi.net/idempotent-rest-apis/\" rel=\"noreferrer\">idempotent</a> - that means its stateless and looks the same for all visitors.</p>\n\n<p>When you submit the form your browser is sending a POST request to <code>/clients</code>. Again in Rails flavored REST this is how you create a resource.</p>\n\n<p>If the validation fails rails simply renders a response containing the form. This SHOULD NOT redirect the user as what you are seeing is the result of the non-idempotent POST request. This is not the same resource as <code>GET /clients/new</code>.</p>\n\n<p>In fact <code>render 'new'</code> is just a shortcut to <code>render 'app/views/clients/new.html.erb'</code>. The two endpoints share a view - nothing else. </p>\n\n<blockquote>\n  <p>Why is that? Isn't \"render\" supposed to not change anything from the URL?</p>\n</blockquote>\n\n<p>You are completely mistaken. <code>render</code> does not change the URL. Submitting the form earlier changed the URL in the browser. Render just renders the view and returns it as the body of the response. Look at the logs of your Rails app if you want to get an idea of how the interchange between client and server actually works.</p>\n\n<p>You can contrast this with <code>redirect_to</code> which sends a <code>location</code> header back and the correct response code (302) which will redirect the browser to the new location.</p>\n\n<blockquote>\n  <p>This gives problems when I refresh the page because I have no \"index\"\n  view and it's triggering an error instead of showing the \"new\" view as\n  it's supposed to.</p>\n</blockquote>\n\n<p>To resolve this you need to add an index action which can be a simple redirect to <code>/clients/new</code>. When you reload the page you are sending a GET request to <code>/clients</code> which should render the index.</p>\n\n<p>I would really recommend that you try just creating a scaffolded rails app so that you get an idea of how the rails conventions do simple CRUD operations before you start imposing your own ideas.</p>\n"}], "owner": {"reputation": 632, "user_id": 11467079, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6Ab3W.jpg?s=128&g=1", "display_name": "FlowMafia", "link": "https://stackoverflow.com/users/11467079/flowmafia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1720, "favorite_count": 1, "accepted_answer_id": 58048597, "answer_count": 3, "score": 9, "last_activity_date": 1583321941, "creation_date": 1569093823, "last_edit_date": 1569126824, "question_id": 58043429, "link": "https://stackoverflow.com/questions/58043429/why-is-render-new-changing-my-url-ruby-on-rails", "title": "Why is &quot;render &#39;new&#39; &quot; changing my URL? (Ruby On Rails)", "body": "<p>I have a view called <code>new.html.erb</code> for clients at <code>localhost:3000/clients/new</code>. I validate it for errors. If there's an error I render the new view again to show all the errors. The problem is that it is showing as <code>localhost:3000/clients</code> in my browser instead of <code>localhost:3000/clients/new</code>. Why is that? Isn't \"render\" supposed to not change anything from the URL? This gives problems when I refresh the page because I have no \"index\" view and it's triggering an error instead of showing the \"new\" view as it's supposed to.</p>\n\n<p><strong>new.html.erb</strong></p>\n\n<pre><code>&lt;% if @client.errors.any? %&gt;\n    &lt;div class=\"alert alert-danger\"&gt;\n        &lt;h4 class=\"alert-heading\"&gt;Error&lt;/h4&gt;\n            &lt;% @client.errors.full_messages.each do |msg| %&gt;\n                &lt;p&gt;&lt;%= msg %&gt;&lt;/p&gt;\n            &lt;% end %&gt;\n     &lt;/div&gt;\n&lt;% end %&gt;\n\n&lt;%= form_for @client, url: clients_path, remote: false do |f| %&gt;\n    &lt;div class=\"form-group  row\"&gt;&lt;label class=\"col-sm-2 col-form-label\"&gt;*Name&lt;/label&gt;\n        &lt;div class=\"col-sm-3\"&gt;\n            &lt;%= f.text_field :name, class:\"form-control\" %&gt;\n                &lt;% if @client.errors[:name].any? %&gt;\n                    &lt;script&gt;$('#client_name').css('border-color', 'red');&lt;/script&gt;\n                &lt;% end %&gt;\n         &lt;/div&gt;\n&lt;/div&gt;\n\n&lt;div class=\"col-sm-4 col-sm-offset-2\"&gt;\n    &lt;%= f.submit \"Submit\", id:\"submit\", class: 'btn btn-primary btn-sm'%&gt;\n    &lt;%= link_to \"Cancel\", controller:\"mainpages\", action:\"index\", :html=&gt;{:class=&gt; \"btn btn-primary btn-sm\"}%&gt;\n&lt;/div&gt;\n&lt;% end %&gt;\n</code></pre>\n\n<p><strong>clients_controller.rb</strong></p>\n\n<pre><code>def new\n    @client = Client.new\n  end\n\n  def create\n    @client = Client.new(client_params)\n\n      if @client.save \n        return redirect_to :root\n      end\n      render 'new'\n  end\n</code></pre>\n\n<p><strong>routes.rb</strong></p>\n\n<pre><code>  root to: \"mainpages#index\"\n\n  get '/mainpages', controller: 'mainpages', action: 'index'\n  get '/planes', controller: 'planes', action: 'planes'\n\n  resources :clients\n  resources :planes\n</code></pre>\n\n<p><strong>client.rb</strong></p>\n\n<pre><code>class Client &lt; ApplicationRecord\n    validates :name, presence: true\nend\n</code></pre>\n"}]