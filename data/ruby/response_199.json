[{"tags": ["ruby", "hash", "yaml"], "answers": [{"comments": [{"owner": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "edited": false, "score": 0, "creation_date": 1541031984, "post_id": 53093339, "comment_id": 93084065, "body": "There are pure Ruby ways to do this as well. See <a href=\"https://stackoverflow.com/q/8379596/3784008\">this question</a> and <a href=\"https://stackoverflow.com/a/46978937/3784008\">this answer in particular</a>."}, {"owner": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "edited": false, "score": 3, "creation_date": 1541041299, "post_id": 53093339, "comment_id": 93085855, "body": "with ruby 2.5 you can use <code>the_hash.transform_keys(&amp;:to_s)</code>"}], "tags": [], "owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "is_accepted": false, "score": 5, "last_activity_date": 1541029004, "creation_date": 1541029004, "answer_id": 53093339, "question_id": 53093316, "link": "https://stackoverflow.com/questions/53093316/ruby-to-yaml-colon-in-keys/53093339#53093339", "title": "ruby to_yaml colon in keys", "body": "<p>If you use string keys you won't get those prefixes. That's what happens when you serialize something with symbol keys.</p>\n\n<p>In Rails or using ActiveSupport you can call <a href=\"https://api.rubyonrails.org/classes/Hash.html#method-i-deep_stringify_keys\" rel=\"noreferrer\"><code>deep_stringify_keys</code></a> to convert them all prior to a <code>YAML.dump</code>.</p>\n\n<p>Otherwise YAML is just trying to serialize and de-serialize as exactly as it can. A restored file with <code>:name: x</code> has <code>{ :name =&gt; 'x' }</code> as the resulting data.</p>\n"}], "owner": {"reputation": 153, "user_id": 4254220, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b3f2b88b871bdf3990476ebcf345d22d?s=128&d=identicon&r=PG&f=1", "display_name": "kotyara85", "link": "https://stackoverflow.com/users/4254220/kotyara85"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1350, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1541054363, "creation_date": 1541028825, "last_edit_date": 1541054363, "question_id": 53093316, "link": "https://stackoverflow.com/questions/53093316/ruby-to-yaml-colon-in-keys", "title": "ruby to_yaml colon in keys", "body": "<p>I'm converting a hash to yaml in ruby but it adds : to keys:\nFor example:</p>\n\n<pre><code>:name: \"Name\"\n:value: \"Value\"\n</code></pre>\n\n<p>If there a way to avoid and just output:</p>\n\n<pre><code>name: \"Name\"\nvalue: \"Value\"\n</code></pre>\n\n<p>I can do this easily with gsub,\nBut just curious</p>\n"}, {"tags": ["ruby", "class", "methods", "logic", "self"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1541028499, "post_id": 53093257, "comment_id": 93083297, "body": "Tip: Instead of using a forced <code>return</code>, just use the expression: <code>@@valor &gt; @limite</code> is sufficient as the body of the function."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1541028543, "post_id": 53093257, "comment_id": 93083311, "body": "You may need to define <code>.eql?</code> instead of just <code>==</code>. You&#39;ll also want to ensure that two &quot;identical&quot; values have equivalent results from the <code>hash</code> method or your objects may not sort properly into hash tables as keys."}, {"owner": {"reputation": 27, "user_id": 10587677, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6286e5499a121af0e479956d84224c85?s=128&d=identicon&r=PG&f=1", "display_name": "Matheus Andrade", "link": "https://stackoverflow.com/users/10587677/matheus-andrade"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1541029164, "post_id": 53093257, "comment_id": 93083476, "body": "Thanks for the tip!  I put the method name as eql? and seems I&#39;m closer to it However it&#39;s still returning the object_id  What do you mean by equivalent results from the hash method? Thanks!"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1541029258, "post_id": 53093257, "comment_id": 93083505, "body": "Check that it&#39;s actually running your custom equivalence method by throwing in a <code>raise</code> or a <code>puts</code> to be sure you&#39;re on the right track."}], "answers": [{"tags": [], "owner": {"reputation": 34, "user_id": 5101013, "user_type": "registered", "profile_image": "https://graph.facebook.com/1121351154546047/picture?type=large", "display_name": "Chiwen Chen", "link": "https://stackoverflow.com/users/5101013/chiwen-chen"}, "is_accepted": false, "score": 1, "last_activity_date": 1541038906, "creation_date": 1541038906, "answer_id": 53094413, "question_id": 53093257, "link": "https://stackoverflow.com/questions/53093257/different-obj-id-but-equal-values-in-ruby/53094413#53094413", "title": "Different obj_id but equal values in ruby?", "body": "<p>If you wants to only compare the attributes, not the object itself, here is the example code you might start with.</p>\n\n<pre><code>class Person\n  attr_accessor :name, :id\n  def initialize(id, name)\n    @id = id\n    @name = name\n  end\n\n  def ==(other_person)\n    self.instance_variables.each do |method|\n      method = method.to_s.gsub('@', '')\n      return false if self.send(method) != other_person.send(method)\n    end\n    return true\n  end\nend\n\np1 = Person.new(1, 'alice')\np2 = Person.new(1, 'alice')\np3 = Person.new(1, 'tim')\nputs p1 == p2 # true\nputs p1 == p3 # false \n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 10587677, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6286e5499a121af0e479956d84224c85?s=128&d=identicon&r=PG&f=1", "display_name": "Matheus Andrade", "link": "https://stackoverflow.com/users/10587677/matheus-andrade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1541038906, "creation_date": 1541028383, "question_id": 53093257, "link": "https://stackoverflow.com/questions/53093257/different-obj-id-but-equal-values-in-ruby", "title": "Different obj_id but equal values in ruby?", "body": "<p>I'm fairly new to ruby and am practicing it.\nHowever in this exercise I'm doing it creates two bank accounts using the same method and same values, and the program expects both to be equal.\nRSpec returns this to me:</p>\n\n<pre><code>Failure/Error: expect(conta1).to eql conta2\n\n   expected: #&lt;Conta:0x3161bc8 @numero=\"2303-2\", @nome=\"Jose da Silva\", @saldo=1000.1, @limite=500&gt;\n        got: #&lt;Conta:0x31615f8 @numero=\"2303-2\", @nome=\"Jose da Silva\", @saldo=1000.1, @limite=500&gt;\n\n   (compared using eql?)\n\n   Diff:\n   @@ -1,4 +1,4 @@\n   -#&lt;Conta:0x3161bc8\n   +#&lt;Conta:0x31615f8\n     @limite=500,\n     @nome=\"Jose da Silva\",\n     @numero=\"2303-2\",\n</code></pre>\n\n<p>The content of both the accounts are the same, but there's a conflict on the object_id, how do I resolve this?</p>\n\n<p>Here is the code:</p>\n\n<pre><code>it \"Two accounts with the same data should be equal\" do\nconta1 = cria_conta\nconta2 = cria_conta\nexpect(conta1).to eql conta2\nend\n\ndef cria_conta(numero=\"2303-2\", nome=\"Jose da Silva\", saldo=1000.10, limite=500)\nConta.new(numero: numero, nome: nome, saldo: saldo, limite: limite)\nend\n</code></pre>\n\n<p>Also:</p>\n\n<pre><code>class Conta\nattr_accessor :numero, :nome, :saldo, :limite\n\ndef initialize(arr)\n    @numero = arr[:numero]\n    @nome = arr[:nome]\n    @saldo = arr[:saldo]\n    @limite = arr[:limite]\nend\n\ndef sacar(valor)\n    possibilidade = false\n    @@valor = valor\n    if valor &lt; @saldo\n        @saldo -= valor\n        possibilidade = true\n    elsif valor &gt; @limite\n        @saldo -= valor\n        @@saldo = @saldo\n        possibilidade\n    end\nend\n\ndef no_limite?()\n    if @@valor &gt; @limite\n        return true\n    elsif @@valor &lt; @limite\n        return false\n    end \nend\n\ndef depositar(valor)\n    @saldo += valor\nend\n\ndef ==(outra_conta)\nself.conta == outra_conta\n</code></pre>\n\n<p>end\nend</p>\n\n<p>I tried to define a a diffrent method for == but I was unsuccessful.</p>\n"}, {"tags": ["ruby", "yaml"], "answers": [{"comments": [{"owner": {"reputation": 50175, "user_id": 1307905, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a38a4f5f180194ac457cdc057f1be6e3?s=128&d=identicon&r=PG", "display_name": "Anthon", "link": "https://stackoverflow.com/users/1307905/anthon"}, "edited": false, "score": 0, "creation_date": 1541055450, "post_id": 53093057, "comment_id": 93089083, "body": "The end of documment marker in YAML (1.0 - 1.2) is <code>...</code>. It is necessary in a stream when data &quot;trickles&quot; in and you want to indicate that the root-level node is complete and <b>may</b> be used to indicate that directives can follow but are <b>not</b> needed for that (see the <a href=\"http://yaml.org/spec/1.2/spec.html#id2801226\" rel=\"nofollow noreferrer\">spec right hand example</a>. Please indicate where you got your information about the document marker from, so we hopefully can address the dissemination of such non-sense."}], "tags": [], "owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "is_accepted": true, "score": 4, "last_activity_date": 1541059408, "last_edit_date": 1541059408, "creation_date": 1541026589, "answer_id": 53093057, "question_id": 53092786, "link": "https://stackoverflow.com/questions/53092786/use-of-in-yaml/53093057#53093057", "title": "Use of --- in yaml", "body": "<p>In YAML, <code>---</code> is the <em>end of directives marker</em>.</p>\n\n<p>A YAML document may begin with a number of YAML directives (currently, two directives are defined, <code>%YAML</code> and <code>%TAG</code>). Since a text node (for example) can also start with a <code>%</code> character, there needs to be a way to distinguish between directives and text. This is achieved using the end of directives marker <code>---</code> which signals the end of the directives and the beginning of the document.</p>\n\n<p>Since directives are allowed to be empty, <code>---</code> can also serve as a document separator.</p>\n\n<p>YAML also has an <em>end of document marker</em> <code>...</code>. However, this is not often used, because and end of directives marker / document separator also implies the end of the document. You need it if you want to have multiple documents with directives within the same stream or when you want to indicate that a document is finished without necessarily starting a new one (e.g. in cases where there may be significant time passing between the end of one document and the start of another).</p>\n\n<p>Many YAML emitters, and Psych is no exception, always emit an end of directives marker at the beginning of each document. This allows you to easily concatenate multiple documents into a single stream without doing any additional processing of the documents.</p>\n\n<p>The other half of that line, <code>!ruby/object:MyClass</code>, is a <em>tag</em>. A tag is used to give a type to the following node. In YAML, every node has a type, even if it is implicit. You can also write the tag explicitly, for example text nodes have the type (tag) <code>!!str</code>. This can be useful in certain circumstances, for example here:</p>\n\n<pre><code>!!str 2018-10-31\n</code></pre>\n\n<p>This tells YAML that <code>2018-10-31</code> is text, not a date.</p>\n\n<p><code>!ruby/object:MyClass</code> is a tag used by Psych to indicate that the node is a serialized Ruby Object which is an instance of class <code>MyClass</code>. This way, when deserializing the document, Psych knows what class to instantiate and how to treat the node.</p>\n"}, {"tags": [], "owner": {"reputation": 4655, "user_id": 396483, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/H9TkA.jpg?s=128&g=1", "display_name": "john ktejik", "link": "https://stackoverflow.com/users/396483/john-ktejik"}, "is_accepted": false, "score": 1, "last_activity_date": 1603902853, "creation_date": 1603902853, "answer_id": 64577300, "question_id": 53092786, "link": "https://stackoverflow.com/questions/53092786/use-of-in-yaml/64577300#64577300", "title": "Use of --- in yaml", "body": "<p>According to <a href=\"https://yaml.org/refcard.html\" rel=\"nofollow noreferrer\">yaml.org</a>, '---' indicates the start of a document.</p>\n<p><a href=\"https://yaml.org/spec/1.2/spec.html\" rel=\"nofollow noreferrer\">https://yaml.org/spec/1.2/spec.html</a>\nfor official specifications.</p>\n"}], "owner": {"reputation": 3047, "user_id": 10388629, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/My8T3.png?s=128&g=1", "display_name": "Pika the Master of the Whales", "link": "https://stackoverflow.com/users/10388629/pika-the-master-of-the-whales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2255, "favorite_count": 1, "accepted_answer_id": 53093057, "answer_count": 2, "score": 2, "last_activity_date": 1603902853, "creation_date": 1541024635, "last_edit_date": 1541063532, "question_id": 53092786, "link": "https://stackoverflow.com/questions/53092786/use-of-in-yaml", "title": "Use of --- in yaml", "body": "<p>I came across this yaml document:</p>\n\n<pre><code>--- !ruby/object:MyClass\nmyint: 100\nmystring: hello world\n</code></pre>\n\n<p>What does the line:</p>\n\n<pre><code>--- !ruby/object:MyClass\n</code></pre>\n\n<p>mean?</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1541022879, "post_id": 53092435, "comment_id": 93081702, "body": "Unless your rails project loads this file, it should not get evaluated when Rails boots.  Where does this &quot;program&quot; live?"}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1541023688, "post_id": 53092435, "comment_id": 93081956, "body": "Also WHY do you need this monkey patch? It&#39;s pretty far-reaching."}, {"owner": {"reputation": 665, "user_id": 4946720, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/622978bee90b9bd34da2af337578bf32?s=128&d=identicon&r=PG&f=1", "display_name": "some user", "link": "https://stackoverflow.com/users/4946720/some-user"}, "reply_to_user": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1541025280, "post_id": 53092435, "comment_id": 93082432, "body": "It is a library / tool. I need this monkey patch when invoked directly using ruby."}], "answers": [{"tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": false, "score": 0, "last_activity_date": 1541026919, "creation_date": 1541026919, "answer_id": 53093091, "question_id": 53092435, "link": "https://stackoverflow.com/questions/53092435/how-to-detect-if-ruby-code-is-invoked-via-ruby-on-rails/53093091#53093091", "title": "How to detect if ruby code is invoked via Ruby on Rails", "body": "<p>Rails by default should not load a file at runtime unless it is expected to through some kind of configuration either by default or an initializer etc.  If this class definition just sits inside your <code>lib/monkey.rb</code> for example, Rails won't auto-load it unless you tell it to.</p>\n\n<p>You can test this out in your rails console if you are using <code>pry</code>.</p>\n\n<p>Just do:</p>\n\n<pre><code>rails c\n# inside your console:\nshow-method Object.blank?\n# this should show you the actual method definition which should be somthing\n# like:\nFrom: /Users/myself/.rvm/gems/ruby-2.5.1/gems/activesupport-4.2.10/lib/active_support/core_ext/object/blank.rb @ line 16:\nOwner: Object\nVisibility: public\nNumber of lines: 3\n\ndef blank?\n  respond_to?(:empty?) ? !!empty? : !self\nend\n</code></pre>\n\n<p>But if rails had loaded your lib file, you would see instead that definition which you can force in the console with <code>require</code></p>\n\n<pre><code>require './lib/monkey.rb'\nshow-method Object.blank?\n\nFrom: /Users/myself/some/rails/project/lib/monkey.rb @ line 2:\nOwner: Object\nVisibility: public\nNumber of lines: 4\n\ndef blank?\n  puts \"this is a monkey patch\"\n  respond_to?(:empty?) ? (respond_to?(:strip) ? strip.empty? : !!empty?) : !self\nend\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 9917, "user_id": 1586221, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/96ab4c67eb62b315a8e7584f7dfd547a?s=128&d=identicon&r=PG", "display_name": "tompave", "link": "https://stackoverflow.com/users/1586221/tompave"}, "is_accepted": true, "score": 4, "last_activity_date": 1541029651, "creation_date": 1541029651, "answer_id": 53093403, "question_id": 53092435, "link": "https://stackoverflow.com/questions/53092435/how-to-detect-if-ruby-code-is-invoked-via-ruby-on-rails/53093403#53093403", "title": "How to detect if ruby code is invoked via Ruby on Rails", "body": "<p>The first thing to keep in mind is that monkey-patching a class directly \u2014 that is, opening a class to define a new method \u2014 is discouraged. It works, but it's not very flexible and it's considered a code smell.</p>\n\n<p>A more sensible approach to monkey-patching is to define your methods in a mixin and then including it in a class.</p>\n\n<p>This also allows you to conditionally include the mixin. For example, a common requirement in Ruby Gems is to only implement or define something if another library is (already) loaded. A common way to do this is to check if a constant from that library is defined. For example, in your case you could do this:</p>\n\n<pre><code>module PresenceExtensions\n  def blank?\n    respond_to?(:empty?) ? (respond_to?(:strip) ? strip.empty? : !!empty?) : !self\n  end\nend\n\nunless Module.const_defined?(\"Rails\") || Object.method_defined?(:blank?)\n  Object.include PresenceExtensions\nend\n</code></pre>\n\n<p>Another common technique is to try to load a gem and then add your alternative monkey-patch only if the gem is not available:</p>\n\n<pre><code>begin\n  require \"active_support/core_ext/object/blank\"\nrescue LoadError\n  Object.include PresenceExtensions\nend\n</code></pre>\n\n<p>This technique has the advantage that will tell you immediately if the gem is not available, so that you don't have to worry about load order.</p>\n"}], "owner": {"reputation": 665, "user_id": 4946720, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/622978bee90b9bd34da2af337578bf32?s=128&d=identicon&r=PG&f=1", "display_name": "some user", "link": "https://stackoverflow.com/users/4946720/some-user"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "accepted_answer_id": 53093403, "answer_count": 2, "score": 1, "last_activity_date": 1541029651, "creation_date": 1541022561, "question_id": 53092435, "link": "https://stackoverflow.com/questions/53092435/how-to-detect-if-ruby-code-is-invoked-via-ruby-on-rails", "title": "How to detect if ruby code is invoked via Ruby on Rails", "body": "<p>I wrote a small .rb tool that used the \"blank?\" method. I want my program to continue to work if invoked directly by ruby. I Monkey Patched Object with code below but I don't want to monkey patch when running under Rails. What can I do?</p>\n\n<pre><code>class Object\n  def blank?\n    respond_to?(:empty?) ? (respond_to?(:strip) ? strip.empty? : !!empty?) : !self\n  end\nend\n</code></pre>\n"}, {"tags": ["ruby", "class", "methods", "hash"], "comments": [{"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1541023568, "post_id": 53092122, "comment_id": 93081917, "body": "Your class method as with any ruby method will return the last method called within in it.  <code>JSON.parse(arquivo)</code> will return a hash so your test will fail.  You need to find a way to return an instance of your Recipe class to make that test pass."}, {"owner": {"reputation": 27, "user_id": 10587677, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6286e5499a121af0e479956d84224c85?s=128&d=identicon&r=PG&f=1", "display_name": "Matheus Andrade", "link": "https://stackoverflow.com/users/10587677/matheus-andrade"}, "reply_to_user": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1541028461, "post_id": 53092122, "comment_id": 93083285, "body": "@lacostenycoder Anywhere I can look to give me more info on that? Anything ruby related for JSON is kinda messy"}], "answers": [{"tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": false, "score": 0, "last_activity_date": 1541275020, "creation_date": 1541275020, "answer_id": 53134992, "question_id": 53092122, "link": "https://stackoverflow.com/questions/53092122/how-to-properly-use-file-json-to-objects-on-ruby/53134992#53134992", "title": "How to properly use file.json to objects on ruby?", "body": "<p>Try this</p>\n\n<pre><code>def self.from_json(path)\n  arquivo = File.read(path)\n  Recipe.new JSON.parse(arquivo)\nend\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 10587677, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6286e5499a121af0e479956d84224c85?s=128&d=identicon&r=PG&f=1", "display_name": "Matheus Andrade", "link": "https://stackoverflow.com/users/10587677/matheus-andrade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 38, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1541275020, "creation_date": 1541020867, "question_id": 53092122, "link": "https://stackoverflow.com/questions/53092122/how-to-properly-use-file-json-to-objects-on-ruby", "title": "How to properly use file.json to objects on ruby?", "body": "<p>I'm learning and doing some exercises, but I'm stuck on this one.</p>\n\n<pre><code>it 'Converts a JSON to an object of type recipe' do\nrecipe = Recipe.from_json('data/pudim.json')\n\nexpect(recipe.class).to eq Recipe\nexpect(recipe.title).to eq 'Pudim'\nexpect(recipe.description).to eq 'O melhor pudim da sua vida!'\nexpect(recipe.ingredients).to eq 'Leite condensado, ovos e leite'\nexpect(recipe.cook_time).to eq 80\nexpect(recipe.featured).to eq true\nend\n</code></pre>\n\n<p>It requires you to make a method so it returns the JSON file that has hashes to objects.</p>\n\n<p>Currently this is what I've done:</p>\n\n<pre><code>class Recipe\n    require 'json'\n    attr_accessor :title, :description, :ingredients, :cook_time, :featured\n\n    def initialize(arr)\n        @title = arr[:title]\n        @description = arr[:description]\n        @ingredients = arr[:ingredients]\n        @cook_time = arr[:cook_time]\n        @featured = arr[:featured]\n    end\n\n    def self.from_json(path)\n        arquivo = File.read(path)\n        recipe = JSON.parse(arquivo)\n    end\nend\n</code></pre>\n\n<p>rspec says: </p>\n\n<pre><code>   Failure/Error: expect(recipe.class).to eq Recipe\n\n   expected: Recipe\n        got: Hash\n\n   (compared using ==)\n\n   Diff:\n   @@ -1,2 +1,2 @@\n   -Recipe\n   +Hash\n</code></pre>\n\n<p>I've tried many different ways to parse JSON to objects but can't do it, and the Ruby doccumentation is sort of messy.\nWhat is wrong on my code?\nAlso, what is a good place to look for Ruby doccumentation besides the ruby-doc.org website?</p>\n"}, {"tags": ["ruby", "regex"], "comments": [{"owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "edited": false, "score": 2, "creation_date": 1541018927, "post_id": 53091679, "comment_id": 93080265, "body": "Does this helps: <a href=\"https://stackoverflow.com/questions/9292338/ruby-split-string-by-repeating-characters-or-a-space\" title=\"ruby split string by repeating characters or a space\">stackoverflow.com/questions/9292338/&hellip;</a> ?"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1541044300, "post_id": 53091679, "comment_id": 93086437, "body": "This question was also asked <a href=\"https://stackoverflow.com/questions/39029898/ruby-split-string-at-character-difference-using-regex\">here</a>."}], "answers": [{"comments": [{"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 2, "creation_date": 1541019386, "post_id": 53091786, "comment_id": 93080469, "body": "But why assume the OP needs to monkey patch the string class?"}, {"owner": {"reputation": 1349, "user_id": 6163262, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7f3655350c57cb94195d64808b7ba61?s=128&d=identicon&r=PG&f=1", "display_name": "whodini9", "link": "https://stackoverflow.com/users/6163262/whodini9"}, "reply_to_user": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 1, "creation_date": 1541019640, "post_id": 53091786, "comment_id": 93080563, "body": "Good point I guess there is not really a reason to do that here when it is not advised."}], "tags": [], "owner": {"reputation": 1349, "user_id": 6163262, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7f3655350c57cb94195d64808b7ba61?s=128&d=identicon&r=PG&f=1", "display_name": "whodini9", "link": "https://stackoverflow.com/users/6163262/whodini9"}, "is_accepted": true, "score": 1, "last_activity_date": 1541019615, "last_edit_date": 1541019615, "creation_date": 1541019119, "answer_id": 53091786, "question_id": 53091679, "link": "https://stackoverflow.com/questions/53091679/split-by-consecutive-group-in-ruby/53091786#53091786", "title": "Split by consecutive group in Ruby", "body": "<p>Based on @iGian's response:</p>\n\n<pre><code>def split_by_chars\n  scan(/((\\w)\\2*)/).map(&amp;:first)\nend\n\ntxt = \"HwwwwjjaoHHH HHHaffgd\"\ntxt.split_by_chars\n# =&gt; [\"H\", \"wwww\", \"jj\", \"a\", \"o\", \"HHH\", \"HHH\", \"a\", \"ff\", \"g\", \"d\"]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": false, "score": 2, "last_activity_date": 1541022074, "creation_date": 1541022074, "answer_id": 53092356, "question_id": 53091679, "link": "https://stackoverflow.com/questions/53091679/split-by-consecutive-group-in-ruby/53092356#53092356", "title": "Split by consecutive group in Ruby", "body": "<p>Let's breakdown the accepted answer:</p>\n\n<pre><code>str = \"HwwwwjjaoHHHHaffgd\"\n\nstr.scan(/((\\w)\\2*)/).map(&amp;:first)\n\n# =&gt; [\"H\", \"wwww\", \"jj\", \"a\", \"o\", \"HHHH\", \"a\", \"ff\", \"g\", \"d\"]\n</code></pre>\n\n<p>How does this work?</p>\n\n<pre><code>.scan #from https://ruby-doc.org/core-2.2.0/String.html\n\n#scan(pattern) \n#scan(pattern) {|match, ...| block } \u2192 str\n</code></pre>\n\n<blockquote>\n  <p>Both forms iterate through str, matching the pattern (which may be a\n  Regexp or a String). For each match, a result is generated and either\n  added to the result array or passed to the block. If the pattern\n  contains no groups, each individual result consists of the matched\n  string, $&amp;. If the pattern contains groups, each individual result is\n  itself an array containing one entry per group.</p>\n</blockquote>\n\n<p>The regex pattern used</p>\n\n<p><code>\\w</code> matches any Any word character (letter, number, underscore)\n<code>(\\w)</code> wrap it in parens aka \"capturing group\" - Parentheses group the regex between them. They capture the text matched by the regex inside them into a numbered group that can be reused with a numbered backreference. They allow you to apply regex operators to the entire grouped regex. </p>\n\n<p>This is what you do with <code>(\\w)\\2</code> and passing it to <code>.scan</code> inside <code>//</code> tells scan that it's a regex and not a pure string.</p>\n\n<pre><code>str.scan(/((\\w)\\2*)/) # will return the following array of arrays\n[ [\"H\", \"H\"], [\"wwww\", \"w\"], [\"jj\", \"j\"], [\"a\", \"a\"], [\"o\", \"o\"], \n  [\"HHHH\", \"H\"], [\"a\", \"a\"], [\"ff\", \"f\"], [\"g\", \"g\"], [\"d\", \"d\"] ]\n</code></pre>\n\n<p>Now you only need the 1st item in each array so you can simply call <code>.map</code> on\nthe result</p>\n\n<pre><code>str.scan(/((\\w)\\2*)/).map(&amp;:first) # shorthand for \nstr.scan(/((\\w)\\2*)/).map{|i| i.first}\n\n#=&gt; [\"H\", \"wwww\", \"jj\", \"a\", \"o\", \"HHHH\", \"a\", \"ff\", \"g\", \"d\"]\n</code></pre>\n\n<p>Here are some helpful resources you might use in the future when needing to handle regex on your own.</p>\n\n<p><a href=\"https://www.regular-expressions.info/tutorial.html\" rel=\"nofollow noreferrer\">https://www.regular-expressions.info/tutorial.html</a></p>\n\n<p>This one is a bit out of date but often helpful for quick testing\n<a href=\"http://rubular.com/\" rel=\"nofollow noreferrer\">http://rubular.com/</a></p>\n"}, {"comments": [{"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 1, "creation_date": 1541047172, "post_id": 53094814, "comment_id": 93086896, "body": "You missed out the double quote after <code>}+</code>"}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1541105785, "post_id": 53094814, "comment_id": 93113758, "body": "Other modifications of the above include: <code>txt.gsub(&#47;(.)\\1*&#47;).reduce([],&amp;:&lt;&lt;)</code>, <code>Regexp.new((&#39;a&#39;..&#39;z&#39;).to_a.join(&#39;+|&#39;).&lt;&lt;(&#39;+&#39;), true)</code>"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1541109063, "post_id": 53094814, "comment_id": 93114960, "body": "@engineersmnky, two great suggestions! I implemented both. Readers: for the former I previously had <code>txt.gsub(&#47;(.)\\1*&#47;).with_object([]) { |s,a| a &lt;&lt; s }</code>. This is an unusual use of <a href=\"http://ruby-doc.org/core-2.5.1/String.html#method-i-gsub\" rel=\"nofollow noreferrer\">String#gsub</a>. As noted in the doc, when it used without a block it returns an enumerator (in which case you may think of the method as being named <code>each_match</code>), and has nothing to do with string substitutions."}], "tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": false, "score": 6, "last_activity_date": 1541128203, "last_edit_date": 1541128203, "creation_date": 1541042578, "answer_id": 53094814, "question_id": 53091679, "link": "https://stackoverflow.com/questions/53091679/split-by-consecutive-group-in-ruby/53094814#53094814", "title": "Split by consecutive group in Ruby", "body": "<p>Here are several ways to do that.</p>\n\n<pre><code>txt = \"Hwwww||333jjao{{\\\\HHHH@@affg//d\"\n\ntxt.split(/(?&lt;=(.))(?!\\1)/).each_slice(2).map(&amp;:first)\n\ntxt.each_char.slice_when(&amp;:!=).map(&amp;:join)\n\ntxt.each_char.chunk(&amp;:itself).map { |_,a| a.join }\n\ntxt.each_char.chunk_while(&amp;:==).map(&amp;:join)\n\ntxt.gsub(/(?&lt;=(.))(?!\\1)/, ' ').split\n\ntxt.gsub(/(.)\\1*/).reduce([], &amp;:&lt;&lt;)  \n\ntxt[1..-1].each_char.with_object([txt[0]]) {|c,a| a.last[-1]==c ? (a.last&lt;&lt;c) : a &lt;&lt; c}\n</code></pre>\n\n<p>All the above return</p>\n\n<pre><code>[\"H\", \"wwww\", \"||\", \"333\", \"jj\", \"a\", \"o\", \"{{\", \"\\\\\", \"HHHH\", \"@@\", \"a\",\n \"ff\", \"g\", \"//\", \"d\"]\n</code></pre>\n"}], "owner": {"reputation": 1589, "user_id": 1123717, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/fb3d5703694d21ac6573b31d3f3014f0?s=128&d=identicon&r=PG", "display_name": "aarkerio", "link": "https://stackoverflow.com/users/1123717/aarkerio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 265, "favorite_count": 0, "accepted_answer_id": 53091786, "answer_count": 3, "score": 0, "last_activity_date": 1541128203, "creation_date": 1541018611, "last_edit_date": 1541099848, "question_id": 53091679, "link": "https://stackoverflow.com/questions/53091679/split-by-consecutive-group-in-ruby", "title": "Split by consecutive group in Ruby", "body": "<p>I have the next string:</p>\n\n<pre><code>txt = \"HwwwwjjaoHHHHaffgd\"\n</code></pre>\n\n<p>I need to form an array by grouping the same consecutive characters to get:</p>\n\n<pre><code>[\"H\" \"wwww\" \"jj\" \"a\" \"o\" \"HHHH\" \"a\" \"ff\" \"g\" \"d\"]\n</code></pre>\n"}, {"tags": ["ruby", "macos", "homebrew"], "comments": [{"owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "edited": false, "score": 0, "creation_date": 1541018837, "post_id": 53091567, "comment_id": 93080230, "body": "I&#39;d suggest you to use <a href=\"https://rvm.io\" rel=\"nofollow noreferrer\">rvm.io</a>"}, {"owner": {"reputation": 16237, "user_id": 2166798, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/417356917295f5176d2a3e7c21d8f9e8?s=128&d=identicon&r=PG", "display_name": "pjs", "link": "https://stackoverflow.com/users/2166798/pjs"}, "edited": false, "score": 0, "creation_date": 1541024515, "post_id": 53091567, "comment_id": 93082200, "body": "What you&#39;re reporting seems dubious.  <code>brew update ruby</code> produces the message <code>Error: This command updates brew itself, and does not take formula names. Use &#39;brew upgrade ruby&#39; instead.</code>  In other words, the error you&#39;re reporting is not consistent with <code>brew update</code>&#39;s behavior and is not reproducible."}], "answers": [{"comments": [{"owner": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "edited": false, "score": 0, "creation_date": 1541096685, "post_id": 53092245, "comment_id": 93109687, "body": "Like @iGian commented above, you will be much, much better off if you install Ruby on macOS with <a href=\"https://rvm.io/\" rel=\"nofollow noreferrer\">RVM</a>. The default version of Ruby and versions installed by brew lead to all kinds of issues, and troubleshooting them is a nightmare. Asking for help in the future will lead to people telling you not to use them and to use RVM instead. (or rbenv)"}], "tags": [], "owner": {"reputation": 14, "user_id": 6454200, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c8d3dfb4b4dff67ea4b2cc61d0315bf?s=128&d=identicon&r=PG&f=1", "display_name": "DommyP", "link": "https://stackoverflow.com/users/6454200/dommyp"}, "is_accepted": false, "score": 0, "last_activity_date": 1541021592, "creation_date": 1541021592, "answer_id": 53092245, "question_id": 53091567, "link": "https://stackoverflow.com/questions/53091567/how-to-use-updated-version-of-ruby/53092245#53092245", "title": "How to use updated version of Ruby?", "body": "<p>using: </p>\n\n<pre><code>brew link --overwrite ruby\n</code></pre>\n\n<p>and restarting terminal worked.</p>\n"}], "owner": {"reputation": 14, "user_id": 6454200, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c8d3dfb4b4dff67ea4b2cc61d0315bf?s=128&d=identicon&r=PG&f=1", "display_name": "DommyP", "link": "https://stackoverflow.com/users/6454200/dommyp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 55, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1541021592, "creation_date": 1541018157, "question_id": 53091567, "link": "https://stackoverflow.com/questions/53091567/how-to-use-updated-version-of-ruby", "title": "How to use updated version of Ruby?", "body": "<p>On my Mac (I'm a Windows user), I'm trying to update Ruby. So I did it with Homebrew, and when I write</p>\n\n<pre><code>brew update ruby\n</code></pre>\n\n<p>it says </p>\n\n<pre><code>ruby 2.5.3 already installed\n</code></pre>\n\n<p>but typing </p>\n\n<pre><code>ruby -v \n</code></pre>\n\n<p>in the terminal produces:</p>\n\n<pre><code>Error: ruby 2.5.3 already installed\n</code></pre>\n\n<p>I'd guess it's a <code>PATH</code> variable that's not being pointed to? Why are there more than one installations of Ruby? How do I correct this to use the Homebrew version?</p>\n"}, {"tags": ["ruby", "ruby-on-rails-5", "rails-activerecord"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1541014354, "post_id": 53090687, "comment_id": 93078367, "body": "Do you call this method in a loop?"}, {"owner": {"reputation": 135, "user_id": 7858350, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d2def96ee1bc978089e10efbda103e8a?s=128&d=identicon&r=PG&f=1", "display_name": "David S", "link": "https://stackoverflow.com/users/7858350/david-s"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1541014575, "post_id": 53090687, "comment_id": 93078476, "body": "It&#39;s within a loop from a helper method for grabbing the date for each day in a month"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1541016292, "post_id": 53090687, "comment_id": 93079305, "body": "No need to copy answers into your post. Instead, simply mark the answer as accepted and optionally comment on it."}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1541016722, "post_id": 53090687, "comment_id": 93079502, "body": "Just curious, what is the purpose of the view code you&#39;ve posted?  It seems to be complex logic in the view."}, {"owner": {"reputation": 18763, "user_id": 472495, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4rtxd.png?s=128&g=1", "display_name": "halfer", "link": "https://stackoverflow.com/users/472495/halfer"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1541250161, "post_id": 53090687, "comment_id": 93156687, "body": "To add to @Sergio&#39;s comment, you are most welcome to post your own answers. Just make sure you post them as an answer below, and not as an edit to the question."}], "answers": [{"comments": [{"owner": {"reputation": 135, "user_id": 7858350, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d2def96ee1bc978089e10efbda103e8a?s=128&d=identicon&r=PG&f=1", "display_name": "David S", "link": "https://stackoverflow.com/users/7858350/david-s"}, "edited": false, "score": 0, "creation_date": 1541014991, "post_id": 53090786, "comment_id": 93078693, "body": "It&#39;s returning <code>0.1e1</code> which is the value of the starting_safe, and all of the other attributes are also now being displayed. Can you explain why that worked?? Whoops, i had .inspect in the view still. It properly displays <code>1.0</code> now."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 135, "user_id": 7858350, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d2def96ee1bc978089e10efbda103e8a?s=128&d=identicon&r=PG&f=1", "display_name": "David S", "link": "https://stackoverflow.com/users/7858350/david-s"}, "edited": false, "score": 0, "creation_date": 1541015205, "post_id": 53090786, "comment_id": 93078801, "body": "@DavidS Did it work, though? it simply ignored the error. Have you checked the logs to see which parameters were logged? Also check out my second variant. The error will be in your face, won&#39;t miss it :)"}, {"owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "reply_to_user": {"reputation": 135, "user_id": 7858350, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d2def96ee1bc978089e10efbda103e8a?s=128&d=identicon&r=PG&f=1", "display_name": "David S", "link": "https://stackoverflow.com/users/7858350/david-s"}, "edited": false, "score": 1, "creation_date": 1541015391, "post_id": 53090786, "comment_id": 93078893, "body": "@DavidS This is currently not really a fix. More something to find your missing record. It should be printed in the server log. The <i>NoMethodError</i> exception is still raised, but caught printing out the input values that caused the exception and returning <code>nil</code>. If you&#39;d like to return <code>nil</code> if no object is found save it into a variable and call <i>send</i> only if it contains an object. <code>daily = Daily.find_by(store_id: store, month: month, day: day, year, year) or return</code>."}, {"owner": {"reputation": 135, "user_id": 7858350, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d2def96ee1bc978089e10efbda103e8a?s=128&d=identicon&r=PG&f=1", "display_name": "David S", "link": "https://stackoverflow.com/users/7858350/david-s"}, "edited": false, "score": 0, "creation_date": 1541015456, "post_id": 53090786, "comment_id": 93078929, "body": "Adding the rescue line &#39;fixes&#39; it. I&#39;ll have to dig around more and see if I can figure out what exactly happened. I&#39;m still a bit new to rails/ruby, so I&#39;m still learning how to properly debug."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "edited": false, "score": 1, "creation_date": 1541015496, "post_id": 53090786, "comment_id": 93078948, "body": "@JohanWentholt: removed that rescue/log snippet in favor of the more foolproof one"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 135, "user_id": 7858350, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d2def96ee1bc978089e10efbda103e8a?s=128&d=identicon&r=PG&f=1", "display_name": "David S", "link": "https://stackoverflow.com/users/7858350/david-s"}, "edited": false, "score": 0, "creation_date": 1541015682, "post_id": 53090786, "comment_id": 93079028, "body": "@DavidS: it wasn&#39;t meant to be a fix. It&#39;s a debugging measure. Don&#39;t leave it there. Try the current snippet"}, {"owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "edited": false, "score": 0, "creation_date": 1541015771, "post_id": 53090786, "comment_id": 93079067, "body": "@SergioTulentsev It was fine, but should <code>raise</code> without arguments inside the rescue block to re-raise the current exception after printing your custom message."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "reply_to_user": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "edited": false, "score": 0, "creation_date": 1541015780, "post_id": 53090786, "comment_id": 93079074, "body": "<code>find_by</code> is a bit cleaner in my opinion so that one does not miss the <code>first</code> at the end. @JohanWentholt <code>or return</code> is dirty to me; given the rails version <code>find_by(...)&amp;.send(field)</code> is less of an antipattern"}, {"owner": {"reputation": 310, "user_id": 10445527, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pQjXF.jpg?s=128&g=1", "display_name": "Mihail Panayotov", "link": "https://stackoverflow.com/users/10445527/mihail-panayotov"}, "reply_to_user": {"reputation": 135, "user_id": 7858350, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d2def96ee1bc978089e10efbda103e8a?s=128&d=identicon&r=PG&f=1", "display_name": "David S", "link": "https://stackoverflow.com/users/7858350/david-s"}, "edited": false, "score": 2, "creation_date": 1541015916, "post_id": 53090786, "comment_id": 93079134, "body": "@DavidS it is just a guess that as you probably loop thru each day of the month, for some day you have zero records, hence first() returns nil and then the error is raised."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 3, "creation_date": 1541016081, "post_id": 53090786, "comment_id": 93079203, "body": "@engineersmnky <code>send</code> is dirty too. For active records there&#39;s   cleaner <code>read_attribute(field)</code> :)"}, {"owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1541016156, "post_id": 53090786, "comment_id": 93079242, "body": "@engineersmnky I agree with you that using the safe navigator is better here, since the only thing to do after finding the record is sending the method name. However I don&#39;t consider <code>or return</code> dirty. <code>or</code> and <code>and</code> are fine for use in flow control. As long as you don&#39;t use them in boolean context. <a href=\"https://github.com/rubocop-hq/ruby-style-guide/pull/730\" rel=\"nofollow noreferrer\">github.com/rubocop-hq/ruby-style-guide/pull/730</a>"}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1541016192, "post_id": 53090786, "comment_id": 93079257, "body": "@SergioTulentsev very nice (I was unaware of that method) as long as it is a true <code>attribute</code> which in this case it definitely appears to be"}, {"owner": {"reputation": 135, "user_id": 7858350, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d2def96ee1bc978089e10efbda103e8a?s=128&d=identicon&r=PG&f=1", "display_name": "David S", "link": "https://stackoverflow.com/users/7858350/david-s"}, "reply_to_user": {"reputation": 310, "user_id": 10445527, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pQjXF.jpg?s=128&g=1", "display_name": "Mihail Panayotov", "link": "https://stackoverflow.com/users/10445527/mihail-panayotov"}, "edited": false, "score": 0, "creation_date": 1541016388, "post_id": 53090786, "comment_id": 93079354, "body": "@MihailPanayotov I believe that was the issue. Thank you everyone that was involved. You&#39;ve all contributed valuable tips!"}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "reply_to_user": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "edited": false, "score": 0, "creation_date": 1541022786, "post_id": 53090786, "comment_id": 93081673, "body": "@johanwentholt I have a general distaste for early returns (excepting guard clauses)  but that&#39;s just my opinion :)"}], "tags": [], "owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "is_accepted": true, "score": 2, "last_activity_date": 1541015446, "last_edit_date": 1541015446, "creation_date": 1541014624, "answer_id": 53090786, "question_id": 53090687, "link": "https://stackoverflow.com/questions/53090687/why-do-i-get-undefined-method-for-nilnilclass-on-an-object-that-clearly-exist/53090786#53090786", "title": "Why do I get &quot;undefined method for nil:NilClass&quot; on an object that clearly exists?", "body": "<p>I'm pretty sure that the record you inspect (Daily with id=1030) and the failing [non-existing] record are two different records. Here's how you can find out. Amend your method like this, temporarily:</p>\n\n<pre><code>def daily_data_for(store, month, day, year, field)\n  daily = Daily.where(store_id: store, month: month, day: day, year: year).first\n  raise \"Daily not found for #{store.inspect}, #{month.inspect}, #{day.inspect}, #{year.inspect}\" unless daily\n  daily.send(field)\nend\n</code></pre>\n\n<p>Now the error message should be much more revealing.</p>\n"}, {"comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1541016767, "post_id": 53091209, "comment_id": 93079523, "body": "Good tips, but, of course, if they expect/allow records to be missing. Sometimes missing record is a legitimate failure state (and so the app should crash loudly)"}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1541016953, "post_id": 53091209, "comment_id": 93079593, "body": "@SergioTulentsev yes agreed. However, the OP asked WHY they were getting the error.  I suppose I didn&#39;t need to explain how they might fix it. However, IMHO the method&#39;s use in the view doesn&#39;t make much sense here."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1541017055, "post_id": 53091209, "comment_id": 93079627, "body": "The method call in the view looks fine to me. Not any more complex than, say, <code>options_for_select</code>. The N+1 is the real problem here."}], "tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": false, "score": 0, "last_activity_date": 1541016541, "creation_date": 1541016541, "answer_id": 53091209, "question_id": 53090687, "link": "https://stackoverflow.com/questions/53090687/why-do-i-get-undefined-method-for-nilnilclass-on-an-object-that-clearly-exist/53091209#53091209", "title": "Why do I get &quot;undefined method for nil:NilClass&quot; on an object that clearly exists?", "body": "<p>The error <code>undefined method 'starting_safe' for nil:NilClass</code> is specifically telling you that you can't call <code>starting_safe</code> on <code>nil</code>.  Since your helper method calls a scope <code>.where</code> method, calling <code>.first</code> on that doesn't insure that it won't be an empty activerecord relation object. If it is empty, then calling <code>.first</code> on it will return <code>nil</code>.  So you might wanna just use <a href=\"https://stackoverflow.com/questions/34583168/safe-navigation-operator-for-nil\">safe navigation</a> to be safe.</p>\n\n<pre><code>def daily_data_for(store, month, day, year, field)\n  Daily.where(store_id: store, month: month, day: day, year: year).first&amp;.send(field)\nend\n</code></pre>\n\n<p>Or if you happen to be on ruby version &lt; 2.3 just use a <code>.try</code></p>\n\n<pre><code>Daily.where(store_id: store, month: month, day: day, year: year).first.try(:send, field)\n#try will only run if first is not nil\n</code></pre>\n"}], "owner": {"reputation": 135, "user_id": 7858350, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d2def96ee1bc978089e10efbda103e8a?s=128&d=identicon&r=PG&f=1", "display_name": "David S", "link": "https://stackoverflow.com/users/7858350/david-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 799, "favorite_count": 0, "accepted_answer_id": 53090786, "answer_count": 2, "score": 2, "last_activity_date": 1541250086, "creation_date": 1541014149, "last_edit_date": 1541250086, "question_id": 53090687, "link": "https://stackoverflow.com/questions/53090687/why-do-i-get-undefined-method-for-nilnilclass-on-an-object-that-clearly-exist", "title": "Why do I get &quot;undefined method for nil:NilClass&quot; on an object that clearly exists?", "body": "<p>controller</p>\n\n<pre><code>def show\n  @dailies = Daily.where(store_id: params[:store]).order(created_at: :asc).by_month_year(params[:month],params[:year])\n  @services = Service.all.order(id: :asc)\nend\n</code></pre>\n\n<p>view</p>\n\n<pre><code>&lt;%= daily_data_for(params[:store], params[:month], date.day, params[:year], 'starting_safe') %&gt;\n</code></pre>\n\n<p>helper</p>\n\n<pre><code>def daily_data_for(store, month, day, year, field)\n  Daily.where(store_id: store, month: month, day: day, year: year).first().send(field)\nend\n</code></pre>\n\n<p>I'm getting the error <code>undefined method 'starting_safe' for nil:NilClass</code> when trying to display ActiveRecord object attribute in the view. I'm a but confused as it shouldn't be nil, because if I remove .send(field) from the helper, I get <code>#&lt;Daily:0x00007fea597aad50&gt;</code>. So it's returning an object. So then I inspect the Activerecord Object in the view:</p>\n\n<pre><code>daily_data_for(params[:store], params[:month], date.day, params[:year], 'starting_safe').inspect\n</code></pre>\n\n<p>Which displays <code>#&lt;Daily id: 1030, store_id: 1, created_at: \"2018-10-01 18:20:07\", updated_at: \"2018-10-01 18:20:07\", starting_safe: 0.1e1, ending_safe: 0.1e1, total_in: 0.1e1, total_out: 0.1e1, sum: 0.1e1, starting_drawer: 0.1e1, ending_drawer: 0.1e1, over_short: 0.1e1, year: \"2018\", month: \"10\", day: \"1\"&gt;</code></p>\n\n<p>It's getting the right record and returning it, but then I get undefined method of nil class when I try to access starting_safe. </p>\n\n<p>Why am I unable to display starting_safe in the view? I'd like to be using the instance variable @dailies in the helper instead of querying the database again, but I get the same errors. I've tried in the console and everything works fine. I'm a bit lost as to what's going on here.</p>\n"}, {"tags": ["ruby", "class", "object", "methods"], "comments": [{"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1541026754, "post_id": 53090425, "comment_id": 93082844, "body": "The error message says that you are trying to call the method <code>-</code>, but it doesn&#39;t exist. There is exactly <i>one</i> occurrence of the symbol <code>-</code> in your entire code. Look at that occurrence. Does it make sense?"}], "answers": [{"tags": [], "owner": {"reputation": 32451, "user_id": 2516474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a2179a340c0e84edc285d432211145d?s=128&d=identicon&r=PG", "display_name": "SteveTurczyn", "link": "https://stackoverflow.com/users/2516474/steveturczyn"}, "is_accepted": true, "score": 1, "last_activity_date": 1541013586, "creation_date": 1541013586, "answer_id": 53090557, "question_id": 53090425, "link": "https://stackoverflow.com/questions/53090425/how-to-instance-hashes-to-objects-ruby/53090557#53090557", "title": "How to instance hashes to objects (ruby)", "body": "<p>This is your problem... you put a minus instead of an equals</p>\n\n<pre><code>@description - arr[:description]\n</code></pre>\n\n<p>Because instance variables like <code>@description</code> are <code>nil</code> until initialized, you're trying to run method <code>-</code> on a <code>nil</code> object, which explains your error message exactly.</p>\n"}], "owner": {"reputation": 27, "user_id": 10587677, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6286e5499a121af0e479956d84224c85?s=128&d=identicon&r=PG&f=1", "display_name": "Matheus Andrade", "link": "https://stackoverflow.com/users/10587677/matheus-andrade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "accepted_answer_id": 53090557, "answer_count": 1, "score": -1, "last_activity_date": 1541013586, "creation_date": 1541012950, "question_id": 53090425, "link": "https://stackoverflow.com/questions/53090425/how-to-instance-hashes-to-objects-ruby", "title": "How to instance hashes to objects (ruby)", "body": "<p>I'm currently learning Ruby and I'm on my third day of practicing it but I'm having trouble with classes and objects.</p>\n\n<pre><code>escribe Recipe do\nit 'Instance an object of type recipe' do\nrecipe = Recipe.new(title: 'Feijoada',\n                    description: 'Voc\u00ea nunca comeu uma receita igual',\n                    ingredients: 'Feij\u00e3o e Carnes',\n                    cook_time: 80,\n                    featured: true)\n\nexpect(recipe.class).to eq Recipe\nexpect(recipe.title).to eq 'Feijoada'\nexpect(recipe.description).to eq 'Voc\u00ea nunca comeu uma receita igual'\nexpect(recipe.ingredients).to eq 'Feij\u00e3o e Carnes'\nexpect(recipe.cook_time).to eq 80\nexpect(recipe.featured).to eq true\nend\n</code></pre>\n\n<p>How do I properly initialize every hash in a way that when it returns it will be readable? Running rspec it gives me \"NoMethodError: undefined method '-' for nil:NilClass\"</p>\n\n<p>This is my current class code:</p>\n\n<pre><code>class Recipe\nrequire 'json'\nattr_accessor :title, :description, :ingredients, :cook_time, :featured\n\ndef initialize(arr)\n    @title = arr[:title]\n    @description - arr[:description]\n    @ingredients = arr[:ingredients]\n    @cook_time = arr[:cook_time]\n    @featured = arr[:featured]\nend\n\ndef self.from_json(path)\n    arquivo = File.read(path)\n    recipe = JSON.parse(arquivo)\nend\nend\n</code></pre>\n"}, {"tags": ["ruby", "rspec", "tdd"], "comments": [{"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1541012344, "post_id": 53089880, "comment_id": 93077479, "body": "Updated my answer with file structure tip"}], "answers": [{"tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": true, "score": 0, "last_activity_date": 1541011970, "last_edit_date": 1541011970, "creation_date": 1541011002, "answer_id": 53089989, "question_id": 53089880, "link": "https://stackoverflow.com/questions/53089880/learning-ttd-rspec-cant-load-require-relative-file/53089989#53089989", "title": "Learning TTD Rspec. cant load require relative file", "body": "<p>The file you want is up one directory, but then nested down one in <code>app</code> folder so instead, try this</p>\n\n<pre><code>require_relative '../app/current_age_for_birth_year'\n</code></pre>\n\n<p>On a side note, it looks like you created your Gemfile in the spec folder, but you normally want to keep the Gemfile in the root of your project folder, so in this case you probably want to move</p>\n\n<pre><code>test/spec/Gemfile\ntest/spec/Gemfile.lock\n</code></pre>\n\n<p>up one level to:</p>\n\n<pre><code>test/Gemfile\ntest/Gemfile.lock\n</code></pre>\n\n<p>From the looks of it there's really nothing in your Gemfile anyway but that should be your typical file structure.</p>\n"}], "owner": {"reputation": 375, "user_id": 10409976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/91acc14383d05b02f61e8deb0fde4c56?s=128&d=identicon&r=PG&f=1", "display_name": "b.herring", "link": "https://stackoverflow.com/users/10409976/b-herring"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 53089989, "answer_count": 1, "score": 0, "last_activity_date": 1541011970, "creation_date": 1541010501, "question_id": 53089880, "link": "https://stackoverflow.com/questions/53089880/learning-ttd-rspec-cant-load-require-relative-file", "title": "Learning TTD Rspec. cant load require relative file", "body": "<p>im trying to practise TDD and rspec. im testing a method that returns someone age from a year of birth argument.\nhowever when i run rspec it cant read the require relative file. im not sure why.\nalso i was wondering if i am doing anything else wrong. thanks.</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>require \"date\"\r\ndef current_age_for_birth_year(birthyear)\r\n  year = Date.today.year\r\n  puts birthyear - year\r\nend</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>require_relative '../current_age_for_birth_year'\r\n\r\ndescribe \"current_age_for_birth_year method\" do\r\n  it \"returns the age of a person based on the year of birth\" do\r\n    age_of_person = current_age_for_birth_year(1984)\r\n\r\n    expect(age_of_person).to eq(19)\r\n  end\r\nend</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>source 'https://rubygems.org'\r\ngem \"rspec\"</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>  testing rspec\r\n\r\nAn error occurred while loading ./spec/current_age_for_birth_year_spec.rb.\r\nFailure/Error: require_relative 'current_age_for_birth_year'\r\n\r\nLoadError:\r\n  cannot load such file -- /Users/benherring/testing/spec/current_age_for_birth_year\r\n# ./spec/current_age_for_birth_year_spec.rb:1:in `require_relative'\r\n# ./spec/current_age_for_birth_year_spec.rb:1:in `&lt;top (required)&gt;'\r\nNo examples found.\r\n\r\nFinished in 0.00027 seconds (files took 0.10919 seconds to load)\r\n0 examples, 0 failures, 1 error occurred outside of examples</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p><a href=\"https://i.stack.imgur.com/0CQlO.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/0CQlO.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["ruby", "ruby-on-rails-5"], "comments": [{"owner": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "edited": false, "score": 0, "creation_date": 1541009454, "post_id": 53089579, "comment_id": 93076211, "body": "Post stack trace"}], "answers": [{"comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1541009452, "post_id": 53089627, "comment_id": 93076209, "body": "And on at least one other line"}, {"owner": {"reputation": 177, "user_id": 10095385, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-AQNUq2AuhX0/AAAAAAAAAAI/AAAAAAAACeM/W_ToTsU2GKw/photo.jpg?sz=128", "display_name": "Sachin", "link": "https://stackoverflow.com/users/10095385/sachin"}, "edited": false, "score": 0, "creation_date": 1541009781, "post_id": 53089627, "comment_id": 93076374, "body": "There is one on that line, I have 2 &gt;, I seperated it with a space"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 177, "user_id": 10095385, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-AQNUq2AuhX0/AAAAAAAAAAI/AAAAAAAACeM/W_ToTsU2GKw/photo.jpg?sz=128", "display_name": "Sachin", "link": "https://stackoverflow.com/users/10095385/sachin"}, "edited": false, "score": 0, "creation_date": 1541010182, "post_id": 53089627, "comment_id": 93076560, "body": "@Sohel not talking about <code>&gt;</code>"}], "tags": [], "owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "is_accepted": true, "score": 0, "last_activity_date": 1541009406, "creation_date": 1541009406, "answer_id": 53089627, "question_id": 53089579, "link": "https://stackoverflow.com/questions/53089579/ruby-on-rails-project-running-into-a-syntax-error-dont-see-what-im-missing/53089627#53089627", "title": "Ruby on Rails project, running into a syntax error don&#39;t see what I&#39;m missing", "body": "<p>Missing a closing parenthesis on the very first line</p>\n\n<pre><code>id=&lt;%= post_path(post.id %&gt;\n</code></pre>\n"}], "owner": {"reputation": 177, "user_id": 10095385, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-AQNUq2AuhX0/AAAAAAAAAAI/AAAAAAAACeM/W_ToTsU2GKw/photo.jpg?sz=128", "display_name": "Sachin", "link": "https://stackoverflow.com/users/10095385/sachin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 23, "favorite_count": 0, "accepted_answer_id": 53089627, "answer_count": 1, "score": -2, "last_activity_date": 1541009406, "creation_date": 1541009201, "question_id": 53089579, "link": "https://stackoverflow.com/questions/53089579/ruby-on-rails-project-running-into-a-syntax-error-dont-see-what-im-missing", "title": "Ruby on Rails project, running into a syntax error don&#39;t see what I&#39;m missing", "body": "<p>Here is the error:\n_post.html.erb:17: syntax error, unexpected keyword_ensure, expecting ')' ensure ^~~~~~ </p>\n\n<p>Problem is there is no line17.  The partial this error is produce on looks as follows:</p>\n\n<pre><code>&lt;div class='col-sm-3 single-post-card' id=&lt;%= post_path(post.id %&gt; &gt;\n  &lt;div class='card'&gt;\n    &lt;div class='card-block'&gt;\n      &lt;h4 class='post-text'&gt;\n        &lt;%= truncate(post.title, :length =&gt; 60 %&gt;\n      &lt;/h4&gt;\n      &lt;div class='post-content'&gt;\n        &lt;div class='posted-by'&gt;Posted by &lt;%= post.user.name %&gt;&lt;/div&gt;\n        &lt;h3&gt;&lt;%= post.title %&gt; &lt;/h3&gt;\n        &lt;p&gt;&lt;%= post.content %&gt;&lt;/p&gt;\n        &lt;%= link_to  \"I'm interested\", post_path(post.id), class: 'interested' %&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n&lt;/div&gt;\n</code></pre>\n\n<p>Only 15 lines of code.  it is rendered here:</p>\n\n<pre><code>&lt;div class=\"container\"&gt;\n  &lt;div class=\"row\"&gt;\n    &lt;div id=\"side-menu\" class=\"col-sm-3\"&gt;\n    &lt;/div&gt;\n\n    &lt;div id=\"main-content\" class='col-sm-9'&gt;\n      &lt;%= render @posts %&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n&lt;/div&gt;\n</code></pre>\n\n<p>I'm sure it's something small I'm missing but I can't seem to figure it out, a second pair of eyes would be helpful.</p>\n"}, {"tags": ["ruby", "regex", "mediawiki", "wiki-markup"], "comments": [{"owner": {"reputation": 43580, "user_id": 1020526, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/Scjj8.jpg?s=128&g=1", "display_name": "revo", "link": "https://stackoverflow.com/users/1020526/revo"}, "edited": false, "score": 0, "creation_date": 1541009950, "post_id": 53089493, "comment_id": 93076461, "body": "Please <a href=\"https://regex101.com/r/BbTlXY/1\" rel=\"nofollow noreferrer\">check this</a> and take a look at <i>Match Information</i> block at right."}, {"owner": {"reputation": 81037, "user_id": 8454, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2NlHs.png?s=128&g=1", "display_name": "Andy Lester", "link": "https://stackoverflow.com/users/8454/andy-lester"}, "edited": false, "score": 0, "creation_date": 1541010421, "post_id": 53089493, "comment_id": 93076659, "body": "Parsing wiki markup is a problem that&#39;s already been well-solved.  I&#39;d suggest using existing code that has already been written, tested and debugged before reinventing the wheel.  Googling for &quot;ruby wiki markup parse&quot; turned this up: <a href=\"https://github.com/marnen/rookie\" rel=\"nofollow noreferrer\">github.com/marnen/rookie</a>"}, {"owner": {"reputation": 2096, "user_id": 2108990, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/886481640b3ab8f05cdf3be8c0efdad6?s=128&d=identicon&r=PG", "display_name": "Zack", "link": "https://stackoverflow.com/users/2108990/zack"}, "reply_to_user": {"reputation": 81037, "user_id": 8454, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2NlHs.png?s=128&g=1", "display_name": "Andy Lester", "link": "https://stackoverflow.com/users/8454/andy-lester"}, "edited": false, "score": 0, "creation_date": 1541017416, "post_id": 53089493, "comment_id": 93079738, "body": "@AndyLester that parser is from 10 years ago, is not maintained and doesn&#39;t work. Appreciate the tip, but not reinventing the wheel when the solution you propose doesn&#39;t work."}, {"owner": {"reputation": 5122, "user_id": 109011, "user_type": "registered", "profile_image": "https://graph.facebook.com/552148900/picture?type=large", "display_name": "Marnen Laibow-Koser", "link": "https://stackoverflow.com/users/109011/marnen-laibow-koser"}, "reply_to_user": {"reputation": 81037, "user_id": 8454, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2NlHs.png?s=128&g=1", "display_name": "Andy Lester", "link": "https://stackoverflow.com/users/8454/andy-lester"}, "edited": false, "score": 1, "creation_date": 1563834845, "post_id": 53089493, "comment_id": 100824194, "body": "@AndyLester I never got very far with implementing the Rookie project, but doesn\u2019t the MediaCloth gem work for interpreting MediaWiki markup?"}], "answers": [{"tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": true, "score": 1, "last_activity_date": 1541878087, "last_edit_date": 1541878087, "creation_date": 1541019968, "answer_id": 53091957, "question_id": 53089493, "link": "https://stackoverflow.com/questions/53089493/regex-to-match-pipes-not-within-brackets-or-braces-with-nested-blocks/53091957#53091957", "title": "Regex to match pipes not within brackets or braces with nested blocks", "body": "<p>The following is a pure-Ruby solution. I assume the braces and brackets in the string are balanced.</p>\n\n<pre><code>str =&lt;&lt;BITTER_END\nSome infobox royalty|testing\n| name = Louis\n| title = Prince Napol\u00e9on \n| elevation_imperial_note= &lt;ref name=\"usgs\"&gt;{{cite web|url={{Gnis3|1802764}}|title=USGS}}&lt;/ref&gt;\n| a = [[AA|aa]] | b =  {{cite\n|title=TITLE\n|author=AUTHOR}}\nBITTER_END\n</code></pre>\n\n<p></p>\n\n<pre><code>stack = []\nlast = 0\nstr.each_char.with_index.with_object([]) do |(c,i),locs|\n  puts \"c=#{c}, i=#{i}, locs=#{locs}, stack=#{stack}\" \n  case c\n  when ']', '}'\n    puts \"  pop #{c} from stack\"\n    stack.pop\n  when '[', '{'\n    puts \"  push #{c} onto stack\"\n    stack &lt;&lt; c\n  when '|'\n    puts stack.empty? ? \"  record location of #{c}\" : \"  skip | as stack is non-empty\" \n    locs &lt;&lt; i if stack.empty?\n  end\n    puts \"  after: locs=#{locs}, stack=#{stack}\" \nend.map do |i|\n  old_last = last\n  last = i+1\n  str[old_last..i-1].strip if i &gt; 0\nend.tap { |a| a &lt;&lt; str[last..-1].strip if last &lt; str.size }\n  #=&gt; [\"Some infobox royalty\",\n  #    \"testing\",\n  #    \"name = Louis\", \n  #    \"title = Prince Napol\u00e9on\",\n  #    \"elevation_imperial_note= &lt;ref name=\\\"usgs\\\"&gt;\n  #      {{cite web|url={{Gnis3|1802764}}|title=USGS}}&lt;/ref&gt;\",\n  #    \"a = [[AA|aa]]\",\n  #    \"b =  {{cite\\n|title=TITLE\\n|author=AUTHOR}}\"]\n</code></pre>\n\n<p>Note that, to improve readability, I've broken the string that is the antepenultimate element of the returned array<sup>1</sup>.</p>\n\n<p><strong>Explanation</strong></p>\n\n<p>For an explanation of how the locations of the pipe symbols on which to split are determined, run the Heredoc above to determine <code>str</code> (the Heredoc needs to be un-indented first), then run the following code. All will be revealed. (The output is long, so focus on changes to the arrays <code>locs</code> and <code>stack</code>.)</p>\n\n<pre><code>stack = []\nstr.each_char.with_index.with_object([]) do |(c,i),locs|\n  puts \"c=#{c}, i=#{i}, locs=#{locs}, stack=#{stack}\" \n  case c\n  when ']', '}'\n    puts \"  pop #{c} from stack\"\n    stack.pop\n  when '[', '{'\n    puts \"  push #{c} onto stack\"\n    stack &lt;&lt; c\n  when '|'\n    puts stack.empty? ? \"  record location of #{c}\" : \"  skip | as stack is non-empty\" \n    locs &lt;&lt; i if stack.empty?\n  end\n    puts \"  after: locs=#{locs}, stack=#{stack}\" \nend\n  #=&gt; [20, 29, 44, 71, 167, 183]\n</code></pre>\n\n<p>If desired, one can confirm the braces and brackets are balanced as follows.</p>\n\n<pre><code>def balanced?(str)\n  h = { '}'=&gt;'{', ']'=&gt;'[' }\n  stack = []\n  str.each_char do |c|\n    case c\n    when '[', '{'\n      stack &lt;&lt; c\n    when ']', '}'\n      stack.last == h[c] ? (stack.pop) : (return false)\n    end\n  end   \n  stack.empty?\nend\n\nbalanced?(str)\n  #=&gt; true\n\nbalanced?(\"[[{]}]\")\n  #=&gt; false\n</code></pre>\n\n<p><sup>1 ...and, in the interest of transparency, to have the opportunity to use a certain word</sup>.</p>\n"}, {"comments": [{"owner": {"reputation": 83048, "user_id": 2255089, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZNAsT.jpg?s=128&g=1", "display_name": "Casimir et Hippolyte", "link": "https://stackoverflow.com/users/2255089/casimir-et-hippolyte"}, "edited": false, "score": 0, "creation_date": 1571050880, "post_id": 58309316, "comment_id": 103099709, "body": "Be careful, regular expressions as defined in computer science are indeed unable to handle arbitrary nesting, but this isn&#39;t the case for what is called regular expressions <i>in real life</i> (at least in Ruby, PHP, R, Perl, .net and all that uses similar regex engines). These regex engines have features that perfectly handle nested structures (balancing groups for .net languages, recursion for the others)."}, {"owner": {"reputation": 5122, "user_id": 109011, "user_type": "registered", "profile_image": "https://graph.facebook.com/552148900/picture?type=large", "display_name": "Marnen Laibow-Koser", "link": "https://stackoverflow.com/users/109011/marnen-laibow-koser"}, "reply_to_user": {"reputation": 83048, "user_id": 2255089, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZNAsT.jpg?s=128&g=1", "display_name": "Casimir et Hippolyte", "link": "https://stackoverflow.com/users/2255089/casimir-et-hippolyte"}, "edited": false, "score": 0, "creation_date": 1571141151, "post_id": 58309316, "comment_id": 103134194, "body": "@Casimir And how do you recurse nesting in a Ruby regex? I know Ruby regexes well, and I can\u2019t think of how to do this <i>practically</i>. Even if it\u2019s technically possible (which I\u2019m not sure it is), it would be awkward, and the time would be better spent using a better tool for the job."}, {"owner": {"reputation": 83048, "user_id": 2255089, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZNAsT.jpg?s=128&g=1", "display_name": "Casimir et Hippolyte", "link": "https://stackoverflow.com/users/2255089/casimir-et-hippolyte"}, "edited": false, "score": 1, "creation_date": 1571142068, "post_id": 58309316, "comment_id": 103134742, "body": "A basic example: <a href=\"https://rubular.com/r/UizxlawOWArYrf\" rel=\"nofollow noreferrer\">rubular.com/r/UizxlawOWArYrf</a> or the answer to the question: <a href=\"https://rubular.com/r/Z6EqGuRrtafSFF\" rel=\"nofollow noreferrer\">rubular.com/r/Z6EqGuRrtafSFF</a> (or more or less the same written in a more readable way: <a href=\"https://regex101.com/r/9fIYYX/1\" rel=\"nofollow noreferrer\">regex101.com/r/9fIYYX/1</a> )"}, {"owner": {"reputation": 5122, "user_id": 109011, "user_type": "registered", "profile_image": "https://graph.facebook.com/552148900/picture?type=large", "display_name": "Marnen Laibow-Koser", "link": "https://stackoverflow.com/users/109011/marnen-laibow-koser"}, "reply_to_user": {"reputation": 83048, "user_id": 2255089, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZNAsT.jpg?s=128&g=1", "display_name": "Casimir et Hippolyte", "link": "https://stackoverflow.com/users/2255089/casimir-et-hippolyte"}, "edited": false, "score": 0, "creation_date": 1571157650, "post_id": 58309316, "comment_id": 103143831, "body": "@Casimir Interesting; I think <code>\\g</code> is one of the few features of Ruby regexes that I\u2019ve never used. I still claim that these regexes are not especially clear or maintainable compared to a parser-based solution, but it\u2019s good to know that these solutions exist."}], "tags": [], "owner": {"reputation": 5122, "user_id": 109011, "user_type": "registered", "profile_image": "https://graph.facebook.com/552148900/picture?type=large", "display_name": "Marnen Laibow-Koser", "link": "https://stackoverflow.com/users/109011/marnen-laibow-koser"}, "is_accepted": false, "score": 0, "last_activity_date": 1570641967, "creation_date": 1570641967, "answer_id": 58309316, "question_id": 53089493, "link": "https://stackoverflow.com/questions/53089493/regex-to-match-pipes-not-within-brackets-or-braces-with-nested-blocks/58309316#58309316", "title": "Regex to match pipes not within brackets or braces with nested blocks", "body": "<p>Regular expressions can\u2019t handle arbitrary nesting (such as the brackets here), and therefore are the wrong tool for this parsing problem. If you can\u2019t find a ready-made MediaWiki markup parser, you\u2019ll want to use an actual parser library (such as Treetop), not regexes. </p>\n"}, {"tags": [], "owner": {"reputation": 83048, "user_id": 2255089, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZNAsT.jpg?s=128&g=1", "display_name": "Casimir et Hippolyte", "link": "https://stackoverflow.com/users/2255089/casimir-et-hippolyte"}, "is_accepted": false, "score": 0, "last_activity_date": 1571165641, "last_edit_date": 1571165641, "creation_date": 1571157985, "answer_id": 58399291, "question_id": 53089493, "link": "https://stackoverflow.com/questions/53089493/regex-to-match-pipes-not-within-brackets-or-braces-with-nested-blocks/58399291#58399291", "title": "Regex to match pipes not within brackets or braces with nested blocks", "body": "<p>It's often more complicated to split a string using a split method than scanning for the substrings you need.</p>\n\n<p>Skipping pipes enclosed between brackets is relatively easy, all you have to do is to define subpatterns able to match eventually nested brackets and to consume them in the main pattern. This way, pipes enclosed between them are simply ignored.</p>\n\n<p>To be sure to not match pipes outside of the main <code>{{...}}</code> block, if any, you have to use a <code>\\G</code> based pattern. <code>\\G</code> is an anchor for the position after the last successful match. It ensures each match to be contigous with the previous match. Since the closing <code>}}</code> is never consumed in the main pattern, you can be sure that the pattern will fail when this one is reached and that no further matches are possible. </p>\n\n<pre><code>pat = /\n  # subpatterns\n  (?&lt;cb&gt;  { [^{}]*+   (?: \\g&lt;cb&gt; [^{}]*   )*+  } ){0} # curly brackets\n  (?&lt;sb&gt; \\[ [^\\]\\[]*+ (?: \\g&lt;sb&gt; [^\\]\\[]* )*+ \\] ){0} # square brackets\n\n  (?&lt;nbpw&gt; [^|{}\\]\\[\\s]+ ){0} # no brackets, pipes nor white-spaces\n\n  # main pattern\n  (?:\n      \\G (?!\\A) \\s* # other contigous matches branch\n    |\n      {{ [^|{}]*+ # first match branch\n      # check if curly brackets are balanced until }} (optional but recommended)\n      (?= [^{}]*+ (?: \\g&lt;cb&gt; [^{}]* )*+ }} )\n  )\n  \\| \\s* \n\n  (?&lt;result&gt;\n      \\g&lt;nbpw&gt;?\n      (?: \\s* (?: \\g&lt;cb&gt; | \\g&lt;sb&gt; | \\s \\g&lt;nbpw&gt; ) \\g&lt;nbpw&gt;? )*\n  )\n/x\n\nstr.scan(pat).map{|item| item[3]}\n</code></pre>\n\n<p>Note that results are already trimmed for white-spaces.</p>\n\n<p>If you want to use it to process several <code>{{...}}</code> blocks at a time, add a capture group around the second branch of the pattern to know when the next block begins.</p>\n"}], "owner": {"reputation": 2096, "user_id": 2108990, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/886481640b3ab8f05cdf3be8c0efdad6?s=128&d=identicon&r=PG", "display_name": "Zack", "link": "https://stackoverflow.com/users/2108990/zack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "accepted_answer_id": 53091957, "answer_count": 3, "score": 0, "last_activity_date": 1571165641, "creation_date": 1541008855, "question_id": 53089493, "link": "https://stackoverflow.com/questions/53089493/regex-to-match-pipes-not-within-brackets-or-braces-with-nested-blocks", "title": "Regex to match pipes not within brackets or braces with nested blocks", "body": "<p>I am trying to parse some wiki markup. For example, the following:</p>\n\n<pre><code>{{Some infobox royalty|testing\n| name = Louis\n| title = Prince Napol\u00e9on \n| elevation_imperial_note= &lt;ref name=\"usgs\"&gt;{{cite web|url={{Gnis3|1802764}}|title=USGS}}&lt;/ref&gt;\n| a = [[AA|aa]] | b =  {{cite\n|title=TITLE\n|author=AUTHOR}}\n}}\n</code></pre>\n\n<p>can be the text to start with. I first remove the starting <code>{{</code> and ending <code>}}</code>, so I can assume those are gone.</p>\n\n<p>I want to do <code>.split(&lt;regex&gt;)</code> on the string to split the string by all <code>|</code> characters that are not within braces or brackets. The regex needs to ignore the <code>|</code> characters in <code>[[AA|aa]]</code>, <code>&lt;ref name=\"usgs\"&gt;{{cite web|url={{Gnis3|1802764}}|title=USGS}}&lt;/ref&gt;</code>, and <code>{{cite|title=TITLE|author=AUTHOR}}</code>. The expected result is:</p>\n\n<pre><code>[\n 'testing'\n 'name = Louis', \n 'title = Prince Napol\u00e9on', \n 'elevation_imperial_note= &lt;ref name=\"usgs\"&gt;{{cite web|url={{Gnis3|1802764}}|title=USGS}}&lt;/ref&gt;',\n 'a = [[AA|aa]]',\n 'b =  {{cite\\n|title=TITLE\\n|author=AUTHOR}}'\n]\n</code></pre>\n\n<p>There can be line breaks at any point, so I can't just look for <code>\\n|</code>.  If there is extra white space in it, that is fine. I can easily strip out extra <code>\\s*</code> or <code>\\n*</code>.</p>\n\n<p><a href=\"https://regex101.com/r/dEDcAS/2\" rel=\"nofollow noreferrer\">https://regex101.com/r/dEDcAS/2</a></p>\n"}, {"tags": ["ruby-on-rails", "ruby", "validation", "error-handling", "devise"], "comments": [{"owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 0, "creation_date": 1541005834, "post_id": 53088609, "comment_id": 93074377, "body": "<a href=\"https://github.com/plataformatec/devise/wiki/Override-devise_error_messages!-for-views\" rel=\"nofollow noreferrer\"><code>devise_error_messages!</code></a> is just a helper method. You can just override it or show the error messages one by one next to the fields yourself."}, {"owner": {"reputation": 21, "user_id": 10510279, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aac68c21740de5fee651c06a12cb549a?s=128&d=identicon&r=PG&f=1", "display_name": "Raffaele", "link": "https://stackoverflow.com/users/10510279/raffaele"}, "reply_to_user": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 0, "creation_date": 1541187981, "post_id": 53088609, "comment_id": 93144583, "body": "Thanks, but how can I show messages one by one?"}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 10510279, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aac68c21740de5fee651c06a12cb549a?s=128&d=identicon&r=PG&f=1", "display_name": "Raffaele", "link": "https://stackoverflow.com/users/10510279/raffaele"}, "edited": false, "score": 0, "creation_date": 1541188406, "post_id": 53088778, "comment_id": 93144777, "body": "Thank you, I did this but the result is the same. I&#39;m having all the error messages in the same place. I wish to have username error shown below the username field, password error shown below the password field and so on.."}, {"owner": {"reputation": 703, "user_id": 3275627, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sFsXG.jpg?s=128&g=1", "display_name": "Jonathan Duarte", "link": "https://stackoverflow.com/users/3275627/jonathan-duarte"}, "reply_to_user": {"reputation": 21, "user_id": 10510279, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aac68c21740de5fee651c06a12cb549a?s=128&d=identicon&r=PG&f=1", "display_name": "Raffaele", "link": "https://stackoverflow.com/users/10510279/raffaele"}, "edited": false, "score": 1, "creation_date": 1541409260, "post_id": 53088778, "comment_id": 93193014, "body": "<code>errors</code> object is a hash, you can easily pick and choose the errors you want to display based on the field&#39;s name:  &lt;%= f.text_field :user_name %&gt; &lt;%= resource.errors[:user_name] %&gt;"}], "tags": [], "owner": {"reputation": 703, "user_id": 3275627, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sFsXG.jpg?s=128&g=1", "display_name": "Jonathan Duarte", "link": "https://stackoverflow.com/users/3275627/jonathan-duarte"}, "is_accepted": false, "score": 1, "last_activity_date": 1541005906, "creation_date": 1541005906, "answer_id": 53088778, "question_id": 53088609, "link": "https://stackoverflow.com/questions/53088609/how-to-show-devise-error-messages-one-by-one/53088778#53088778", "title": "How to show devise error messages one by one", "body": "<p>You can always iterate over the errors in the resource.</p>\n\n<p>So if you for looks similar to this:</p>\n\n<p><code>&lt;%= form_for(resource, :as =&gt; resource_name, :url =&gt; registration_path(...</code></p>\n\n<p>You can simple, get the errors inside the resource and show them, like so:</p>\n\n<pre><code>&lt;% resource.errors.full_messages.each do |msg| %&gt;\n  &lt;div&gt;&lt;%= msg %&gt;&lt;/div&gt;\n&lt;% end %&gt;\n</code></pre>\n\n<p><code>errors.full_messages</code> - will give you an array with nice errors messages that you can display to the user.</p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 10510279, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aac68c21740de5fee651c06a12cb549a?s=128&d=identicon&r=PG&f=1", "display_name": "Raffaele", "link": "https://stackoverflow.com/users/10510279/raffaele"}, "is_accepted": false, "score": 0, "last_activity_date": 1541189326, "creation_date": 1541189326, "answer_id": 53125208, "question_id": 53088609, "link": "https://stackoverflow.com/questions/53088609/how-to-show-devise-error-messages-one-by-one/53125208#53125208", "title": "How to show devise error messages one by one", "body": "<p>I solved it creating an initializer with this</p>\n\n<pre><code>ActionView::Base.field_error_proc = Proc.new do |html_tag, instance|   unless html_tag \n=~ /^&lt;label/\n    %{&lt;div class=\"field_with_errors\"&gt;#{html_tag}&lt;label for=\"#{instance.send(:tag_id)}\" \nclass=\"message\"&gt;#{instance.error_message.first}&lt;/label&gt;&lt;/div&gt;}.html_safe else\n    %{&lt;div class=\"field_with_errors\"&gt;#{html_tag}&lt;/div&gt;}.html_safe   end end\n</code></pre>\n\n<p>This gave me the exact result that I was looking for.</p>\n\n<p><a href=\"https://i.stack.imgur.com/BrrbR.png\" rel=\"nofollow noreferrer\">Result</a></p>\n\n<p>Thanks for your help! :)</p>\n"}], "owner": {"reputation": 21, "user_id": 10510279, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aac68c21740de5fee651c06a12cb549a?s=128&d=identicon&r=PG&f=1", "display_name": "Raffaele", "link": "https://stackoverflow.com/users/10510279/raffaele"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 882, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1541189326, "creation_date": 1541005262, "question_id": 53088609, "link": "https://stackoverflow.com/questions/53088609/how-to-show-devise-error-messages-one-by-one", "title": "How to show devise error messages one by one", "body": "<p>I'm writing an app and I'm using devise for signup and login purposes.</p>\n\n<p>I'm now validating registration form fields and I can check and show the \"non-validated\" data by using the \"&lt;%= devise_error_messages! %>\".</p>\n\n<p>The thing is that I don't want to show all the errors in the same div, I'd like to put error 1 in one div, error 2 in another div and so on.</p>\n\n<p>For example: If an user insert an already taken username and leave the email field empty, I'd like to show:</p>\n\n<ol>\n<li>\"Username already taken\" close to the username field</li>\n<li>\"Email can't be blank\" close to the email field</li>\n</ol>\n\n<p>Thank you</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-4"], "answers": [{"tags": [], "owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "is_accepted": true, "score": 2, "last_activity_date": 1541026623, "last_edit_date": 1541026623, "creation_date": 1541003441, "answer_id": 53088110, "question_id": 53088014, "link": "https://stackoverflow.com/questions/53088014/nomethoderror-in-admindashboardcontrollerindex/53088110#53088110", "title": "NoMethodError in Admin::DashboardController#index", "body": "<p><code>before_action :asideSection</code> tries to call a method named <code>asideSection</code>.</p>\n\n<p>This method does not exist.</p>\n\n<p>However, you <em>have</em> defined a method named: <code>getAsideSection</code>. I presume that this is what you want to be called.</p>\n\n<p>So, you could either change that to: <code>before_action :getAsideSection</code>, or rename the method to <code>asideSection</code>.</p>\n\n<p>Here is how I would write it, also following the <a href=\"https://github.com/rubocop-hq/ruby-style-guide\" rel=\"nofollow noreferrer\">ruby style guide convention</a> of using <code>snake_case</code> for variables and method names:</p>\n\n<pre><code>class ApplicationController &lt; ActionController::Base\n  before_action :get_aside_sections\n\n  def home\n    # ...\n  end\n\n  private\n\n  def get_aside_sections\n    @aside_sections = Page.all\n  end\nend\n</code></pre>\n"}], "owner": {"reputation": 74, "user_id": 10560675, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a032efbf386fce2fab38d983cb08f5e1?s=128&d=identicon&r=PG&f=1", "display_name": "Albert Conrad", "link": "https://stackoverflow.com/users/10560675/albert-conrad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 372, "favorite_count": 0, "accepted_answer_id": 53088110, "answer_count": 1, "score": 0, "last_activity_date": 1541026623, "creation_date": 1541003135, "question_id": 53088014, "link": "https://stackoverflow.com/questions/53088014/nomethoderror-in-admindashboardcontrollerindex", "title": "NoMethodError in Admin::DashboardController#index", "body": "<p>am new to rails, and am using active admin for a work, and i get this error whenever i open active admin dashboard</p>\n\n<pre><code>NoMethodError in Admin::DashboardController#index\nundefined method `asideSection' for #&lt;Admin::DashboardController:0x00007fc544017d70&gt;\n</code></pre>\n\n<p>here is my application_conrtoller.rb</p>\n\n<pre><code>class ApplicationController &lt; ActionController::Base\n    before_action :asideSection\n    def hhome\n\n    end\n\n    def getAsideSection\n        @asideSections = Page.all\n    end\nend\n</code></pre>\n\n<p>how can i fix it please.</p>\n"}, {"tags": ["ruby", "pretty-print", "pry"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1541002979, "post_id": 53087712, "comment_id": 93072902, "body": "That is, indeed, curious."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 1, "creation_date": 1541009833, "post_id": 53087712, "comment_id": 93076407, "body": "<a href=\"https://github.com/ruby/ruby/blob/trunk/range.c#L1265\" rel=\"nofollow noreferrer\"><code>Range#inspect</code></a> and <a href=\"https://github.com/ruby/ruby/blob/trunk/range.c#L1222\" rel=\"nofollow noreferrer\"><code>Range#to_s</code></a> are not the same thing so I think your super call is the issue here. Hint: <a href=\"https://github.com/ruby/ruby/blob/trunk/range.c#L1242\" rel=\"nofollow noreferrer\">github.com/ruby/ruby/blob/trunk/range.c#L1242</a>"}, {"owner": {"reputation": 1056, "user_id": 9652640, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rZGNE.png?s=128&g=1", "display_name": "Min-Soo Pipefeet", "link": "https://stackoverflow.com/users/9652640/min-soo-pipefeet"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1541020730, "post_id": 53087712, "comment_id": 93080953, "body": "@engineersmnky I&#39;ve streamlined my question (calls to <i>super</i> removed). <i>(1..10).to_s</i> and <i>(1..10).inspect</i> return the same output <i>1..10</i> . It is weird that calling <i>inspect</i> from an inherited level changes it&#39;s behavior. If inherited the call to inspect_range(VALUE range, VALUE dummy, int recur) seems to have the arg <i>recur</i> set to <i>true</i>. I could not figure out what this arg means. I either could not figure why this arg is set differently if called from inherited level."}], "owner": {"reputation": 1056, "user_id": 9652640, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rZGNE.png?s=128&g=1", "display_name": "Min-Soo Pipefeet", "link": "https://stackoverflow.com/users/9652640/min-soo-pipefeet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 129, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1541020521, "creation_date": 1541002135, "last_edit_date": 1541020521, "question_id": 53087712, "link": "https://stackoverflow.com/questions/53087712/ruby-pretty-print-in-pry-delegating-to-inspect-leads-to-unexpected-behavior", "title": "Ruby: pretty_print in pry: delegating to inspect leads to unexpected behavior", "body": "<p>Delegating <em>pretty_print</em> to <em>to_s</em> works as expected:</p>\n\n<pre><code>class R &lt; Range\n  def pretty_print(pp)    \n    pp.text(to_s)        \n  end       \nend  \n# =&gt; :pretty_print\n\nr = R.new(1, 10)\n#=&gt; 1..10\n</code></pre>\n\n<p>But delegating to <em>inspect</em> produces unexpected represenation:</p>\n\n<pre><code>class R &lt; Range\n  def pretty_print(pp)    \n    pp.text(inspect)\n  end       \nend  \n# =&gt; :pretty_print\n\nr = R.new(1, 10)\n#=&gt; (... .. ...)\n</code></pre>\n\n<p>Why?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "rspec", "database-cleaner"], "answers": [{"tags": [], "owner": {"reputation": 79, "user_id": 744216, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d0badd8b60b13c6b28a7691340c9723?s=128&d=identicon&r=PG", "display_name": "bibliotechy", "link": "https://stackoverflow.com/users/744216/bibliotechy"}, "is_accepted": true, "score": 1, "last_activity_date": 1541002049, "last_edit_date": 1541002049, "creation_date": 1541000457, "answer_id": 53087208, "question_id": 53087207, "link": "https://stackoverflow.com/questions/53087207/databasecleaner-raising-nomethoderror-undefined-method-rollback-for-nilnilcl/53087208#53087208", "title": "DatabaseCleaner raising NoMethodError: undefined method `rollback&#39; for nil:NilClass", "body": "<p>So it turns out that one the developers (me) did not understand that the DatabaseCleaner invocation in the rails_helper was already applying to all specs, and added an extra invocation of <code>DatabaseCleaner.clean</code> to one of the spec files. Removing the addiitonal:</p>\n\n<pre><code> after do\n    DatabaseCleaner.clean\n  end\n</code></pre>\n\n<p>fixed the issue.</p>\n\n<p>I'm guessing it was a race condition caused by the two invocations of <code>DatabaseCleaner.clean</code> being called.</p>\n"}], "owner": {"reputation": 79, "user_id": 744216, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d0badd8b60b13c6b28a7691340c9723?s=128&d=identicon&r=PG", "display_name": "bibliotechy", "link": "https://stackoverflow.com/users/744216/bibliotechy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 889, "favorite_count": 0, "accepted_answer_id": 53087208, "answer_count": 1, "score": 5, "last_activity_date": 1541002049, "creation_date": 1541000457, "question_id": 53087207, "link": "https://stackoverflow.com/questions/53087207/databasecleaner-raising-nomethoderror-undefined-method-rollback-for-nilnilcl", "title": "DatabaseCleaner raising NoMethodError: undefined method `rollback&#39; for nil:NilClass", "body": "<p>I have a rails app using rspec and including DatabseCleaner to ensure the test database is clean between each test. </p>\n\n<p>DatabaseCleaner is configured in our <code>spec/rails_helper.rb</code> with</p>\n\n<pre><code>  config.before(:suite) do\n    DatabaseCleaner.strategy = :transaction\n    DatabaseCleaner.clean_with(:truncation)\n  end\n\n  config.around(:each) do |example|\n    DatabaseCleaner.cleaning do\n      example.run\n    end\n  end\n</code></pre>\n\n<p>We've been seeing intermittent errors in our ci environment, where a single test will fail with</p>\n\n<pre><code> 1) LibraryHours Required fields Library Hour must have a location\n Failure/Error:\n   DatabaseCleaner.cleaning do\n     example.run\n   end\n\n NoMethodError:\n   undefined method `rollback' for nil:NilClass\n # ./spec/rails_helper.rb:66:in `block (2 levels) in &lt;top (required)&gt;'\n</code></pre>\n\n<p>We cannot reproduce the error locally with the seed from the rspec run, and are havng real trouble debugging.</p>\n"}, {"tags": ["ruby", "self", "operator-precedence"], "comments": [{"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1541064014, "post_id": 53086002, "comment_id": 93092388, "body": "Please write different questions in different threads."}], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 3097888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54cac127634fb489745e70a6e1220d82?s=128&d=identicon&r=PG&f=1", "display_name": "ngriffin", "link": "https://stackoverflow.com/users/3097888/ngriffin"}, "edited": false, "score": 0, "creation_date": 1540997912, "post_id": 53086114, "comment_id": 93069476, "body": "Thank you very much &amp; great points on the reader, forgot about that. I&#39;m still struggling with why <code>(self % i)</code> works but <code>(self a &quot;hello&quot;)</code> doesn&#39;t work - that&#39;s why I thought it had something to do with operator precedence."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 95, "user_id": 3097888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54cac127634fb489745e70a6e1220d82?s=128&d=identicon&r=PG&f=1", "display_name": "ngriffin", "link": "https://stackoverflow.com/users/3097888/ngriffin"}, "edited": false, "score": 0, "creation_date": 1540997984, "post_id": 53086114, "comment_id": 93069531, "body": "@ngriffin:  that&#39;s because <code>%</code> is a valid operator (and thus can use operator syntax) and <code>a</code> isn&#39;t."}], "tags": [], "owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "is_accepted": true, "score": 3, "last_activity_date": 1540997927, "last_edit_date": 1540997927, "creation_date": 1540997290, "answer_id": 53086114, "question_id": 53086002, "link": "https://stackoverflow.com/questions/53086002/ruby-self-operator-precedence-and-instance-method-invocation/53086114#53086114", "title": "Ruby self, operator precedence and instance method invocation", "body": "<blockquote>\n  <p>why <code>number</code> instead of <code>@number</code></p>\n</blockquote>\n\n<p>Because you have defined a reader/getter, might as well use it. Today method <code>number</code> is backed by an instance variable, tomorrow it's computed (or lazily instantiated, etc.). By using the method and not its internals, you shield yourself from cascading changes. It's called \"encapsulation\". But you <em>could have</em> used the variable, it's just not a good practice.</p>\n\n<blockquote>\n  <p>the call to (self % i) doesn't require a space between the self and %, I'm guessing it has something to do with operator precedence?</p>\n</blockquote>\n\n<p>No. Nothing to do with precedence. There was no ambiguity in the spaceless form and ruby was able to parse it successfully, that's why it's allowed.</p>\n"}], "owner": {"reputation": 95, "user_id": 3097888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54cac127634fb489745e70a6e1220d82?s=128&d=identicon&r=PG&f=1", "display_name": "ngriffin", "link": "https://stackoverflow.com/users/3097888/ngriffin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 53086114, "answer_count": 1, "score": 0, "last_activity_date": 1540997927, "creation_date": 1540996929, "question_id": 53086002, "link": "https://stackoverflow.com/questions/53086002/ruby-self-operator-precedence-and-instance-method-invocation", "title": "Ruby self, operator precedence and instance method invocation", "body": "<p>Working through some code examples and came across this snippet, edited here for brevity:</p>\n\n<pre><code>  class Year\n    attr_reader :number\n\n    def initialize(number)\n      @number = number\n    end\n\n   def a(str)\n     puts str\n   end\n\n   def %(other)\n     number % other # why number instead of @number\n   end\n\n   def my_func()\n     (self a \"hello\") # error\n   end\n\n   private\n\n   def divisible_by?(i)\n     (self % i) == 0 #Operator precedence binding self and % together?\n   end\nend\n</code></pre>\n\n<p>I'm looking to understand why:</p>\n\n<ol>\n<li><p>the call to <code>(self % i)</code> doesn't require a space between the <code>self</code> and <code>%</code>, I'm guessing it has something to do with operator precedence?</p></li>\n<li><p>Why does, within the method definition for <code>%(other)</code> the method refer to <code>number</code>, I would've expected it to have to refer to the instance variable <code>@number</code>.</p></li>\n</ol>\n\n<p>Any help would be appreciated and/or links to ruby docs that would help me explain this. ty in advance</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-5"], "answers": [{"comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1541001369, "post_id": 53086328, "comment_id": 93071885, "body": "While APIDock had a good run, it&#39;s defunct now and out of date. Try linking to the <a href=\"https://api.rubyonrails.org/classes/ActiveRecord/Relation.html#method-i-find_or_create_by\" rel=\"nofollow noreferrer\">current documentation</a> instead."}, {"owner": {"reputation": 2228, "user_id": 797285, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/155e3a832ac9eda845e10564e4e3c1a1?s=128&d=identicon&r=PG", "display_name": "lafeber", "link": "https://stackoverflow.com/users/797285/lafeber"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 1, "creation_date": 1542031368, "post_id": 53086328, "comment_id": 93411628, "body": "Too bad, I liked apidock. Updated the link."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1542040120, "post_id": 53086328, "comment_id": 93416617, "body": "It&#39;s really a shame it&#39;s stopped being updated because it&#39;s a fantastic tool."}], "tags": [], "owner": {"reputation": 2228, "user_id": 797285, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/155e3a832ac9eda845e10564e4e3c1a1?s=128&d=identicon&r=PG", "display_name": "lafeber", "link": "https://stackoverflow.com/users/797285/lafeber"}, "is_accepted": false, "score": 0, "last_activity_date": 1542031338, "last_edit_date": 1542031338, "creation_date": 1540997887, "answer_id": 53086328, "question_id": 53085832, "link": "https://stackoverflow.com/questions/53085832/check-if-record-exists-inside-create-action/53086328#53086328", "title": "Check if record exists inside create action", "body": "<p>My guess it you probably want to look at <a href=\"https://api.rubyonrails.org/classes/ActiveRecord/Relation.html#method-i-find_or_create_by\" rel=\"nofollow noreferrer\">https://api.rubyonrails.org/classes/ActiveRecord/Relation.html#method-i-find_or_create_by</a></p>\n"}, {"comments": [{"owner": {"reputation": 27, "user_id": 10382586, "user_type": "registered", "profile_image": "https://graph.facebook.com/1827035674000342/picture?type=large", "display_name": "David Sarvasidze", "link": "https://stackoverflow.com/users/10382586/david-sarvasidze"}, "edited": false, "score": 0, "creation_date": 1541171256, "post_id": 53086795, "comment_id": 93136667, "body": "Thank you for your reply, I still have a bit of uncertainty, because if I use <code>find_or_create_by(sale_item_params)</code> then if the sale_id and product_id match but quantity doesnt (in case if user enters quantity: 4, but the existing record in the db has same sale_id and product_id but different quantity value then it wont match these two records.) Thats why I am trying to find just by the sale_id and product_id, but I am failing, like I can find the record but cant add up quantities and save the record"}, {"owner": {"reputation": 635, "user_id": 8439462, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/boggA.jpg?s=128&g=1", "display_name": "Talha Junaid", "link": "https://stackoverflow.com/users/8439462/talha-junaid"}, "reply_to_user": {"reputation": 27, "user_id": 10382586, "user_type": "registered", "profile_image": "https://graph.facebook.com/1827035674000342/picture?type=large", "display_name": "David Sarvasidze", "link": "https://stackoverflow.com/users/10382586/david-sarvasidze"}, "edited": false, "score": 0, "creation_date": 1541173635, "post_id": 53086795, "comment_id": 93138030, "body": "Hey. @DavidSarvasidze sorry thats my bad, replace <code>sale_item_params</code>  with <code>sale_id: sale_item_params[:sale_id], product_id: sale_item_params[:product_id]</code> in <code>find_or_create_by</code>"}, {"owner": {"reputation": 27, "user_id": 10382586, "user_type": "registered", "profile_image": "https://graph.facebook.com/1827035674000342/picture?type=large", "display_name": "David Sarvasidze", "link": "https://stackoverflow.com/users/10382586/david-sarvasidze"}, "edited": false, "score": 0, "creation_date": 1541176373, "post_id": 53086795, "comment_id": 93139536, "body": "Thank you, I figured that out but could you help me with one more thing please. I need to add <code>:quantities</code> only when an existing record is found. As I understand I should do it outside the <code>find_or_create_by</code> block, because inside the block we create a new record if no record found. At the moment I have this straight after the block <code>@sale_item.quantity = @sale_item.quantity.to_i + sale_item_params[:quantity].to_i </code> but I am sure this is rubbish because if the record is new then it will add up its <code>:quantity</code> twice!? Maybe you have a suggestion, would much appreciate it. let me kno if unclear"}, {"owner": {"reputation": 27, "user_id": 10382586, "user_type": "registered", "profile_image": "https://graph.facebook.com/1827035674000342/picture?type=large", "display_name": "David Sarvasidze", "link": "https://stackoverflow.com/users/10382586/david-sarvasidze"}, "edited": false, "score": 0, "creation_date": 1541257853, "post_id": 53086795, "comment_id": 93158602, "body": "Figured it out and updated my post, Thank you for help =)))"}], "tags": [], "owner": {"reputation": 635, "user_id": 8439462, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/boggA.jpg?s=128&g=1", "display_name": "Talha Junaid", "link": "https://stackoverflow.com/users/8439462/talha-junaid"}, "is_accepted": true, "score": 0, "last_activity_date": 1540999259, "creation_date": 1540999259, "answer_id": 53086795, "question_id": 53085832, "link": "https://stackoverflow.com/questions/53085832/check-if-record-exists-inside-create-action/53086795#53086795", "title": "Check if record exists inside create action", "body": "<p>Change your <code>create</code> action code from this</p>\n\n<pre><code>def create\n\n  @sale_item = SaleItem.where(sale_id: params[:sale_id], product_id: sale_item_params[:product_id]).first_or_create do |sale_item|\n    sale_item.quantity = sale_item.quantity.to_i + sale_item_params[:quantity].to_i\n  end\n\n  @sale = @sale_item.sale\n  @sale_item = SaleItem.create(sale_item_params)\n  @event = @sale.event\n\n  if @sale_item.save\n    redirect_to event_sale_path(@event, @sale)\n  else\n    redirect_to event_sale_path(@event, @sale)\n  end\nend\n</code></pre>\n\n<p>to this</p>\n\n<pre><code>def create\n\n  @sale_item = SaleItem.find_or_create_by(sale_item_params) do |sale_item|\n    sale_item.quantity = sale_item.quantity.to_i + sale_item_params[:quantity].to_i\n    sale_item.save\n  end\n\n  @sale = @sale_item.sale\n  @event = @sale.event\n\n  if @sale_item.save\n    redirect_to event_sale_path(@event, @sale)\n  else\n    redirect_to event_sale_path(@event, @sale)\n  end\nend\n</code></pre>\n\n<p><code>find_or_create_by(sale_item_params)</code> will first find the sale_item with <code>sale_id</code>, <code>product_id</code> and <code>quantity</code> and then if there isn't any sale_item record found it will create a new one, In both case you can update the quantity.</p>\n"}, {"tags": [], "owner": {"reputation": 116, "user_id": 1781803, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33eb05f10f2b71b9272ab3da9c379616?s=128&d=identicon&r=PG", "display_name": "unlimitedfocus", "link": "https://stackoverflow.com/users/1781803/unlimitedfocus"}, "is_accepted": false, "score": 0, "last_activity_date": 1541344794, "creation_date": 1541344794, "answer_id": 53142299, "question_id": 53085832, "link": "https://stackoverflow.com/questions/53085832/check-if-record-exists-inside-create-action/53142299#53142299", "title": "Check if record exists inside create action", "body": "<p>I think you have to define the unique key to find <code>SaleItem</code></p>\n\n<ul>\n<li>for example, if <code>sale_id</code> and <code>product_id</code> are keys to find <code>SaleItem</code>.</li>\n<li>it's better to have new strong parameter method for find or create <code>SaleItem</code> on <code>create</code> method.</li>\n</ul>\n\n<p>controller example:</p>\n\n<pre><code>    class SaleItemsController &lt; ApplicationController\n        before_action :initialize_sale_item, only: [:create]\n\n        def create\n            @sale_item.assign_attributes(sale_item_params)\n            @sale_item.save\n            # render or respond_to ...\n        end\n\n        private\n        def sale_item_params\n            params.require(:sale_item).permit(:sale_id, :product_id, :quantity)\n        end\n\n        def sale_item_key_params\n            params.require(:sale_item).permit(:sale_id, :product_id)\n        end\n\n        def initialize_sale_item\n            @sale_item = SaleItem.find_or_initialize_by(sale_item_key_params)\n        end\n    end\n</code></pre>\n\n<ul>\n<li>as <code>Talha Junaid</code> suggested, you can use <code>find_or_create_by</code> instead of using <code>find_or_initialize_by</code>(and remove <code>initialize_sale_item</code> ...)</li>\n<li>references\n\n<ul>\n<li><a href=\"https://api.rubyonrails.org/classes/ActiveRecord/Relation.html#method-i-find_or_initialize_by\" rel=\"nofollow noreferrer\">https://api.rubyonrails.org/classes/ActiveRecord/Relation.html#method-i-find_or_initialize_by</a></li>\n<li><a href=\"https://api.rubyonrails.org/classes/ActiveRecord/Relation.html#method-i-find_or_create_by\" rel=\"nofollow noreferrer\">https://api.rubyonrails.org/classes/ActiveRecord/Relation.html#method-i-find_or_create_by</a></li>\n</ul></li>\n</ul>\n"}], "owner": {"reputation": 27, "user_id": 10382586, "user_type": "registered", "profile_image": "https://graph.facebook.com/1827035674000342/picture?type=large", "display_name": "David Sarvasidze", "link": "https://stackoverflow.com/users/10382586/david-sarvasidze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 53086795, "answer_count": 3, "score": 0, "last_activity_date": 1542031338, "creation_date": 1540996367, "last_edit_date": 1541257313, "question_id": 53085832, "link": "https://stackoverflow.com/questions/53085832/check-if-record-exists-inside-create-action", "title": "Check if record exists inside create action", "body": "<p>My scenario: </p>\n\n<p>I have <code>SaleItem</code> model, which stores <code>(:sale_id, :product_id, :quantity, :total_price)</code>. </p>\n\n<pre><code>class SaleItem &lt; ApplicationRecord\n  belongs_to :sale\n  belongs_to :product\n\n  before_save :set_unit_price\n  before_save :set_total_price\n  before_save :set_total_disscounted_price\n\n  def unit_price\n    if persisted?\n      self[:unit_price]\n    else\n      product.price_pence\n    end\n  end\n\n  def total_price\n    unit_price * quantity\n  end\n\n  private\n\n    def set_unit_price\n      self[:unit_price] = unit_price\n    end\n\n    def set_total_price\n      self[:total_price] = quantity * set_unit_price\n    end\n\n    def set_total_disscounted_price\n      self[:total_disscounted_price] =self[:total_price] - (self[:total_price] * self.sale.event.event_disscount) / 100\n    end\nend\n</code></pre>\n\n<p>My problem is, whenever I create new <code>SaleItem</code> object I want to check if the same record already exists and if it does then I just need to add up the <code>:quantity</code> and recalculate total price (in the model) according to the new <code>:quantity</code>.</p>\n\n<p>What I am confused about is is it possible to check it within the create method?\nSo far I found this rails method  <code>first_or_create</code>.</p>\n\n<p>This is my initial code from <code>SaleItem</code> controller </p>\n\n<pre><code>class SaleItemsController &lt; ApplicationController\n  def create\n    @sale = @sale_item.sale\n    @sale_item = SaleItem.create(sale_item_params)\n    @event = @sale.event\n\n    if @sale_item.save\n      redirect_to event_sale_path(@event, @sale)\n    else\n      redirect_to event_sale_path(@event, @sale)\n\n    end\n  end\n\n  private\n\n  def sale_item_params\n    params.require(:sale_item).permit(:sale_id, :product_id, :quantity)\n  end\nend\n</code></pre>\n\n<p>and then after I found <code>first_or_create</code> I started changing it to this, but havent finished as I am a bit stuck: </p>\n\n<pre><code>class SaleItemsController &lt; ApplicationController\n  def create\n\n    @sale_item = SaleItem.where(sale_id: params[:sale_id], product_id: sale_item_params[:product_id]).first_or_create do |sale_item|\n      sale_item.quantity = sale_item.quantity.to_i + sale_item_params[:quantity].to_i\n    end\n\n    @sale = @sale_item.sale\n    @sale_item = SaleItem.create(sale_item_params)\n    @event = @sale.event\n\n    if @sale_item.save\n      redirect_to event_sale_path(@event, @sale)\n    else\n      redirect_to event_sale_path(@event, @sale)\n\n    end\n  end\n\n  private\n\n  def sale_item_params\n    params.require(:sale_item).permit(:sale_id, :product_id, :quantity)\n  end\nend\n</code></pre>\n\n<p><strong>I couldn't figure out how to update record that was found and dont change newly created record, so I created a variable <code>@new_record</code> and set it initially to <code>false</code>, and then once new record created, <code>@new_record</code> changes to <code>true</code>. In this way I was being able to track each record and change it if needed.</strong></p>\n\n<p><strong>This is the <code>SaleItem Controller</code> updated code</strong></p>\n\n<pre><code>class SaleItemsController &lt; ApplicationController\n  def create\n\n    @new_record = false\n\n    @sale_item = SaleItem.where(sale_id: params[:sale_id], product_id: sale_item_params[:product_id]).first_or_create do |sale_item|\n      sale_item.quantity = sale_item_params[:quantity]\n      @new_record = true\n    end\n\n    @new_record == false ? @sale_item.quantity = @sale_item.quantity.to_i + sale_item_params[:quantity].to_i : sale_item_params[:quantity].to_i\n\n    @sale = @sale_item.sale\n    @event = @sale.event\n\n    if @sale_item.save\n      redirect_to event_sale_path(@event, @sale)\n    else\n      redirect_to event_sale_path(@event, @sale)\n    end\n  end\n\n  def destroy\n    @sale_item = SaleItem.find(params[:id])\n    @sale = @sale_item.sale\n    @event = @sale.event\n    @sale_item.destroy\n    redirect_to event_sale_path(@event, @sale)\n\n  end\n\n  private\n\n  def sale_item_params\n    params.require(:sale_item).permit(:sale_id, :product_id, :quantity)\n  end\nend\n</code></pre>\n"}, {"tags": ["ruby", "web-scraping", "initialization", "constants", "nameerror"], "answers": [{"tags": [], "owner": {"reputation": 426, "user_id": 8287207, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PZ5Cf.jpg?s=128&g=1", "display_name": "Alexey Strizhak", "link": "https://stackoverflow.com/users/8287207/alexey-strizhak"}, "is_accepted": false, "score": 0, "last_activity_date": 1540999542, "creation_date": 1540999542, "answer_id": 53086888, "question_id": 53085783, "link": "https://stackoverflow.com/questions/53085783/ruby-uninitialized-constant-job-nameerror-scraping-and-adding-to-database/53086888#53086888", "title": "Ruby uninitialized constant Job (NameError) Scraping and adding to database", "body": "<p>make sure that the model is created and there are necessary fields in the table</p>\n\n<p>let's put you code of parser into the rails services:</p>\n\n<pre><code>class Jobs\n  def self.jobs\n    return @jobs if @jobs\n\n    require 'open-uri'\n    require 'nokogiri'\n\n    url = \"https://www.savedroid.com/#karriere-section\"\n\n    html_file = open(url).read\n    html_doc = Nokogiri::HTML(html_file)\n    jobs = []\n\n    html_doc.search('.job').each do |element|\n      jobs &lt;&lt; element.text.strip\n    end\n\n    @jobs = jobs\n  end\nend\n</code></pre>\n\n<p>then you can call it inside rails controller:</p>\n\n<pre><code>VacancyController &lt; ApplicationController\n  def create\n    Jobs.jobs.each do |job|\n      Vacancy.create(companyname: job)\n    end\n  end\nend\n</code></pre>\n"}], "owner": {"reputation": 113, "user_id": 10075876, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-j7d3Chl5TZo/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7obE-kTGcNuqf5tWp6sQ3RBQUo5dA/mo/photo.jpg?sz=128", "display_name": "Sabrina", "link": "https://stackoverflow.com/users/10075876/sabrina"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 240, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1541003462, "creation_date": 1540996217, "last_edit_date": 1541003462, "question_id": 53085783, "link": "https://stackoverflow.com/questions/53085783/ruby-uninitialized-constant-job-nameerror-scraping-and-adding-to-database", "title": "Ruby uninitialized constant Job (NameError) Scraping and adding to database", "body": "<p>I am creating a scraper with <code>Nokogiri</code> and <code>Ruby on Rails</code>. My goal is to scrape jobs from a specific webpage. I created the following code, which results in an array of job titles. So this works fine.</p>\n\n<p>My problem is now, that I want to add these titles to my database of Vacancies. When I type in <code>Vacancy.create(companyname=jobs[0])</code>, it should create a <code>Vacancy</code> with the first job-title in the array. </p>\n\n<p>But it gives me an error instead:</p>\n\n<blockquote>\n  <p>app/services/job_service.rb:18:in `': uninitialized constant\n  Vacancy (NameError)</p>\n</blockquote>\n\n<p>So it looks like it does not know the class <code>Vacancy</code>.\nI therefore required the file vacancy.rb:</p>\n\n<pre><code>require_relative(../models/vacancy.rb')\n</code></pre>\n\n<p>But then it gives me another error:</p>\n\n<blockquote>\n  <p>uninitialized constant ApplicationRecord (NameError)</p>\n</blockquote>\n\n<p>So I now think that I am doing something fundamentally wrong here.\nAm I putting the whole scraper file in the wrong folder (should I probably put it in the rake folder)?. All I want is to execute something like <code>Vacancy.create</code> so that it pushes this to my database of Vacancies (aka Jobs).</p>\n\n<p>Here is the the scraper (job_service.rb):</p>\n\n<pre><code>require 'open-uri'\nrequire 'nokogiri'\n\nurl = \"https://www.savedroid.com/#karriere-section\"\n\nhtml_file = open(url).read\nhtml_doc = Nokogiri::HTML(html_file)\njobs = []\nhtml_doc.search('.job').each do |element|\n  jobs &lt;&lt; element.text.strip\nend\n\n\nVacancy.create(companyname=jobs[0])\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby"], "answers": [{"comments": [{"owner": {"reputation": 1913, "user_id": 547341, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/10a0cbba661dd3521b5a35a3e7bbabcd?s=128&d=identicon&r=PG", "display_name": "Albert Catal&#224;", "link": "https://stackoverflow.com/users/547341/albert-catal%c3%a0"}, "edited": false, "score": 0, "creation_date": 1540999260, "post_id": 53086004, "comment_id": 93070417, "body": "this does not work: <code>NoMethodError: undefined method </code>key_cache&#39; for #&lt;Site::TranslatorManager::CacheEraser:0x0` <code>from app&#47;services&#47;site&#47;translator_manager&#47;cache_eraser.rb:11:in </code>call&#39;`"}, {"owner": {"reputation": 1913, "user_id": 547341, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/10a0cbba661dd3521b5a35a3e7bbabcd?s=128&d=identicon&r=PG", "display_name": "Albert Catal&#224;", "link": "https://stackoverflow.com/users/547341/albert-catal%c3%a0"}, "edited": false, "score": 0, "creation_date": 1541000236, "post_id": 53086004, "comment_id": 93071109, "body": "all in the same folder, I&#39;m going to add an image in the &quot;question&quot;"}, {"owner": {"reputation": 1913, "user_id": 547341, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/10a0cbba661dd3521b5a35a3e7bbabcd?s=128&d=identicon&r=PG", "display_name": "Albert Catal&#224;", "link": "https://stackoverflow.com/users/547341/albert-catal%c3%a0"}, "edited": false, "score": 0, "creation_date": 1541000462, "post_id": 53086004, "comment_id": 93071270, "body": "I&#39;ve moved to previous folder and now your solution works"}, {"owner": {"reputation": 1913, "user_id": 547341, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/10a0cbba661dd3521b5a35a3e7bbabcd?s=128&d=identicon&r=PG", "display_name": "Albert Catal&#224;", "link": "https://stackoverflow.com/users/547341/albert-catal%c3%a0"}, "edited": false, "score": 0, "creation_date": 1541000662, "post_id": 53086004, "comment_id": 93071424, "body": "<b>I wonder if this is a sane solution</b>, .... is like including a module where you already are"}, {"owner": {"reputation": 334, "user_id": 2606111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FUdFG.jpg?s=128&g=1", "display_name": "Mahys116", "link": "https://stackoverflow.com/users/2606111/mahys116"}, "reply_to_user": {"reputation": 1913, "user_id": 547341, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/10a0cbba661dd3521b5a35a3e7bbabcd?s=128&d=identicon&r=PG", "display_name": "Albert Catal&#224;", "link": "https://stackoverflow.com/users/547341/albert-catal%c3%a0"}, "edited": false, "score": 0, "creation_date": 1541001014, "post_id": 53086004, "comment_id": 93071655, "body": "@AlbertCatal&#224; yes, you need store module inside app/services/site folder"}, {"owner": {"reputation": 1913, "user_id": 547341, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/10a0cbba661dd3521b5a35a3e7bbabcd?s=128&d=identicon&r=PG", "display_name": "Albert Catal&#224;", "link": "https://stackoverflow.com/users/547341/albert-catal%c3%a0"}, "edited": false, "score": 0, "creation_date": 1541001751, "post_id": 53086004, "comment_id": 93072127, "body": "Yes, I&#39;ve seen and I&#39;ve corrected, thank you. Even though it seems some weird this <code>include</code>, as I said before, is like including something that it is already included, isn&#39;t it?"}], "tags": [], "owner": {"reputation": 334, "user_id": 2606111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FUdFG.jpg?s=128&g=1", "display_name": "Mahys116", "link": "https://stackoverflow.com/users/2606111/mahys116"}, "is_accepted": true, "score": 1, "last_activity_date": 1540996947, "creation_date": 1540996947, "answer_id": 53086004, "question_id": 53085627, "link": "https://stackoverflow.com/questions/53085627/organizing-modules-services-and-their-shared-methods-in-ruby/53086004#53086004", "title": "Organizing modules, services, and their shared methods in ruby", "body": "<p>You need to include your <code>Site::TranslatorManager</code> module inside <code>CacheEraser</code> class:</p>\n\n<pre><code>module Site\n  module TranslatorManager\n    class CacheEraser &lt; ApplicationService\n      include Site::TranslatorManager # include module methods\n      def initialize(company_id, text, head_locale, locale)\n        @company_id, @text, @head_locale, @locale = company_id, text, head_locale, locale\n      end\n\n      def call\n        #             ---&gt; will work &lt;----\n        Rails.cache.delete key_cache(@company_id, @text, @head_locale, @locale)\n      end\n    end\n  end\nend\n</code></pre>\n"}], "owner": {"reputation": 1913, "user_id": 547341, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/10a0cbba661dd3521b5a35a3e7bbabcd?s=128&d=identicon&r=PG", "display_name": "Albert Catal&#224;", "link": "https://stackoverflow.com/users/547341/albert-catal%c3%a0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 53086004, "answer_count": 1, "score": 0, "last_activity_date": 1541000375, "creation_date": 1540995796, "last_edit_date": 1541000375, "question_id": 53085627, "link": "https://stackoverflow.com/questions/53085627/organizing-modules-services-and-their-shared-methods-in-ruby", "title": "Organizing modules, services, and their shared methods in ruby", "body": "<p>I'm trying to share a method between two ruby services, these services have a lot in common and they are inside the same module.</p>\n\n<p><code>TranslatorManager</code> is the module that onws the services: <code>CacheEraser</code> and <code>Translator</code>.</p>\n\n<p>The shared method is <code>key_cache</code>, and I need to call it from <code>CacheEraser</code> and <code>Translator</code> services, just for them, it is only relationated to TranslatorManager, so I supose that this code must be in the module file <code>translator_anager.rb</code></p>\n\n<p>Each service has its file and all these files are in the the folder  <code>app/services/site/translator_manager/</code> </p>\n\n<p><a href=\"https://i.stack.imgur.com/V3aMl.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/V3aMl.png\" alt=\"enter image description here\"></a></p>\n\n<p>For me, this is the correct files organization, isn't it?</p>\n\n<p>How can I call <code>key_cache</code> from <code>call</code> services method? this don't work</p>\n\n<ul>\n<li>I can't include Site::TranslatorManager from a nested class</li>\n<li>Need <code>key_cache</code> to be a class method? how can extend it <strong>considering thar are distinct files</strong>? I have try this <a href=\"https://stackoverflow.com/a/37845922/547341\">answer</a> and don't work.</li>\n</ul>\n\n<p><strong>cache_eraser.rb</strong></p>\n\n<pre><code>module Site\n  module TranslatorManager\n    class CacheEraser &lt; ApplicationService\n      def initialize(company_id, text, head_locale, locale)\n        @company_id, @text, @head_locale, @locale = company_id, text, head_locale, locale\n      end\n\n      def call\n        #             ---&gt; Don't work &lt;----\n        Rails.cache.delete key_cache(@company_id, @text, @head_locale, @locale)\n      end\n    end\n  end\nend\n</code></pre>\n\n<p><strong>translator_manager.rb</strong></p>\n\n<pre><code>module Site\n  module TranslatorManager\n    def key_cache(company_id, text, head_locale, locale)\n      # return a string\n    end\n\n    def translatable_key?(key)\n      # return true or false\n    end\n  end\nend\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "devise", "multi-tenant", "apartment-gem"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 1, "creation_date": 1541002169, "post_id": 53085558, "comment_id": 93072386, "body": "You&#39;re talking about a &quot;superadmin&quot;, or an admin of all tenant applications. That&#39;s usually a regular user with a different flag, or membership to a &quot;house account&quot; that signifies superadmin status."}], "answers": [{"tags": [], "owner": {"reputation": 3807, "user_id": 2043592, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/zCbuL.jpg?s=128&g=1", "display_name": "xploshioOn", "link": "https://stackoverflow.com/users/2043592/xploshioon"}, "is_accepted": false, "score": 0, "last_activity_date": 1541039472, "creation_date": 1541039472, "answer_id": 53094468, "question_id": 53085558, "link": "https://stackoverflow.com/questions/53085558/how-to-setup-multi-tenant-rails-app-with-an-admin/53094468#53094468", "title": "How to setup multi-tenant rails app with an admin", "body": "<p>I think you can work with same table and just adding role to each user, admin, owner and user (different table for roles or just boolean attribute for each one) and then just play with conditionals on this or some before_filter to validate that certain type of user can access to different views or run some actions. Doesn't seems too complicated.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 3869229, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d16ae49c0893604cd0a54aab55f312d?s=128&d=identicon&r=PG&f=1", "display_name": "type-face", "link": "https://stackoverflow.com/users/3869229/type-face"}, "is_accepted": false, "score": 0, "last_activity_date": 1560807131, "creation_date": 1560807131, "answer_id": 56639164, "question_id": 53085558, "link": "https://stackoverflow.com/questions/53085558/how-to-setup-multi-tenant-rails-app-with-an-admin/56639164#56639164", "title": "How to setup multi-tenant rails app with an admin", "body": "<p>If you are using the apartment gem, you will need to create a new Devise user model for the 'admin' (e.g. AdminUser) and add that model to the config.excluded_models in your apartment config file: <a href=\"https://github.com/influitive/apartment#excluding-models\" rel=\"nofollow noreferrer\">https://github.com/influitive/apartment#excluding-models</a>. This will make AdminUsers records available at the top level domain. You can't just add a role to the UserAccount model because those records are scoped to each apartment 'tenant'.</p>\n\n<p>You will also need to add WebsiteAccount to the config.excluded_models for apartment to allow those to be managed at example.com. This is assuming that you want WebsiteAccount to be your apartment 'tenants'. </p>\n\n<p>To manage the UserAccount for each WebsiteAccount, you'll need to either manage that within each WebsiteAccount's subdomain, or do some tenant switching at example.com to gain access to and assign a UserAccount to a WebsiteAccount.</p>\n"}], "owner": {"reputation": 1221, "user_id": 9375533, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a08c00e9e6694fe8222c6918801dcc0?s=128&d=identicon&r=PG&f=1", "display_name": "dcangulo", "link": "https://stackoverflow.com/users/9375533/dcangulo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 522, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1560807131, "creation_date": 1540995597, "question_id": 53085558, "link": "https://stackoverflow.com/questions/53085558/how-to-setup-multi-tenant-rails-app-with-an-admin", "title": "How to setup multi-tenant rails app with an admin", "body": "<p>I am having a problem with how will I correctly set the models of my rails application. I will use the gem <a href=\"https://github.com/influitive/apartment\" rel=\"nofollow noreferrer\">Apartment</a> for multi-tenancy and the gem <a href=\"https://github.com/plataformatec/devise\" rel=\"nofollow noreferrer\">Devise</a> for authentication.</p>\n\n<p>What I want to achieve is that I will have 3 user levels. The <strong>admin</strong>, <strong>owner</strong>, and <strong>user</strong>.</p>\n\n<p>Basically, the <strong>admin</strong> handle all <strong>owners</strong> in the site, he can add, edit, and delete <strong>owners</strong>. Imagine that <strong>admin</strong> owns the whole website (<a href=\"https://example.com\" rel=\"nofollow noreferrer\">https://example.com</a>).</p>\n\n<p>The <strong>owner</strong> will handle <strong>users</strong>, he can add, edit, and delete <strong>users</strong>. If the <strong>admin</strong> owns (<a href=\"https://example.com\" rel=\"nofollow noreferrer\">https://example.com</a>) then the <strong>owner</strong> only owns (<a href=\"https://owner1.example.com\" rel=\"nofollow noreferrer\">https://owner1.example.com</a>).</p>\n\n<p>Each subdomain will have its own <strong>users</strong> handled by the <strong>owner</strong>. And all owners are handled by the <strong>admin</strong>.</p>\n\n<p>What I have come up currently is having 2 models.</p>\n\n<ul>\n<li>WebsiteAccount</li>\n<li>UserAccount</li>\n</ul>\n\n<p>WebsiteAccount will have <strong>subdomain</strong> and <strong>owner_name</strong> columns.\nUserAccount will have <strong>email</strong>, <strong>password</strong>, and <strong>user_level</strong>. Where user_level can be <strong>owner</strong> or <strong>user</strong>.</p>\n\n<p>Then the Devise will be used on <strong>UserAccount</strong> model. The UserAccount model will only show data based on the subdomain. </p>\n\n<p>Now the question is where does the <strong>admin</strong> account fall? </p>\n\n<p>Do I create a separate model for it and also use Devise gem on that?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "mongodb", "mongoid", "mongoid6"], "answers": [{"tags": [], "owner": {"reputation": 798, "user_id": 3488179, "user_type": "registered", "accept_rate": 69, "profile_image": "https://graph.facebook.com/1295000681/picture?type=large", "display_name": "OzW", "link": "https://stackoverflow.com/users/3488179/ozw"}, "is_accepted": false, "score": 0, "last_activity_date": 1541691819, "creation_date": 1541691819, "answer_id": 53211215, "question_id": 53084833, "link": "https://stackoverflow.com/questions/53084833/mongodb-aggregation-push-zero-in-keys-while-doing-group/53211215#53211215", "title": "MongoDB Aggregation push zero in keys while doing group", "body": "<p>The Aggregation Framework can only aggregate the <strong>documents you have</strong>. You are actually asking it to add groups for <strong>documents that do not exist</strong>, but it has no way to \"know\" which groups to add. </p>\n\n<p>What I would do is run the query as you have it, and afterwards \"spread\" the date units according to the chosen granularity (in your example it will be 01/01/2018, 01/02/2018, 01/03/2018, 01/04/2018, 01/05/2018, 01/06/2018, and run a simple function which will add an entry for each missing unit.</p>\n"}], "owner": {"reputation": 1319, "user_id": 5060959, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/2d7af66fc79160e5872515869fad813c?s=128&d=identicon&r=PG&f=1", "display_name": "thedudecodes", "link": "https://stackoverflow.com/users/5060959/thedudecodes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 30, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1541691819, "creation_date": 1540993348, "question_id": 53084833, "link": "https://stackoverflow.com/questions/53084833/mongodb-aggregation-push-zero-in-keys-while-doing-group", "title": "MongoDB Aggregation push zero in keys while doing group", "body": "<p>I am not sure that this is a valid question or not. I have started working on mongodb aggregation. I have to make a graph for the data on daily, weekly, monthly basis.</p>\n\n<p>I am using \"<strong>$dayOfMonth</strong>\", \"<strong>$week</strong>\", \"<strong>$month</strong>\" to group by depending on the date provided. ex if from and to dates difference is less or equal to 6 I am grouping on daily basis using \"<strong>$dayOfMonth</strong>\", \nIf from and to dates difference is greater than 6 and less than 30 grouping is done of \"<strong>$week</strong>\" and if differece is greater than 30 then grouping is done on monthly basis \"<strong>$month</strong>\".</p>\n\n<p>I am passing date in my \"<strong>$match</strong>\". Is it possible to push 0 as keys if the gouping is not present.</p>\n\n<p>example -  from_date = \"01/01/2018\"   to_date = \"30/6/2018\"\nso grouping will be done on month. and suppose if I dont have date for 3 and 4th &amp; 5th month. I want to push 0 in the nested keys as the value.</p>\n\n<pre><code>    output = [\n               {\"_id\": \"01/01/2018\", \"counter\":12}, \n               {\"_id\": \"01/02/2018\", \"counter\": 15}, \n               {\"_id\":\"01/06/2018\", counter: 10}\n             ]\n\n     expected_output = \n             [\n              {\"_id\": \"01/01/2018\", \"counter\":12}, \n              {\"_id\": \"01/02/2018\", \"counter\": 15},\n              {\"_id\":\"01/03/2018\", counter: 0},\n              {\"_id\":\"01/04/2018\", counter:0},\n              {\"_id\":\"01/05/2018\", counter: 0},\n              {\"_id\":\"01/06/2018\", counter: 10}\n             ]\n</code></pre>\n\n<p>I am using Rails and Mongoid Gem.\n Query That I am using</p>\n\n<pre><code>    converted = Analytics::Conversion::PharmacyPrescription.collection.aggregate([\n       { \"$match\" =&gt; { \n            \"organisation_id\" =&gt; org_id.to_s, \n            \"date\" =&gt; {\n              \"$gte\" =&gt; from_date, \n              \"$lte\" =&gt; to_date\n            },\n            \"role_ids\" =&gt; {\"$in\" =&gt; [role_id, \"$role_ids\"]}\n          }\n        },{\n          \"$project\" =&gt; {\n            \"total_count\" =&gt; 1,\n            \"converted_count\" =&gt; 1,\n            \"not_converted_count\" =&gt; 1,\n            \"total_invoice_amount\" =&gt; 1,\n            \"user_id\" =&gt; 1,\n            \"facility_id\" =&gt; 1,\n            \"organisation_id\" =&gt; 1,\n            \"date\" =&gt; 1,\n          }\n        },{\n          \"$group\" =&gt; {\n            \"_id\" =&gt; { \"#{groupby}\" =&gt; \"$date\" },\n            \"total_count\" =&gt; {\"$sum\" =&gt; \"$total_count\"},\n            \"converted_count\" =&gt; { \"$sum\" =&gt; \"$converted_count\" },\n            \"not_converted_count\" =&gt; { \"$sum\" =&gt; \"$not_converted_count\"},\n          }\n        }\n    ]).to_a\n</code></pre>\n"}, {"tags": ["ruby", "tostring", "pry"], "comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1541011193, "post_id": 53084749, "comment_id": 93077022, "body": "Sidenote: if your method results in raised exception pry will rescue this <a href=\"https://github.com/pry/pry/blob/master/lib/pry/color_printer.rb#L41\" rel=\"nofollow noreferrer\">Here</a> which will be even more confusing :) as your output would be akin to <code>#&lt;RangeInherited:0x2f013a8&gt;</code> without any notification of the error."}], "answers": [{"comments": [{"owner": {"reputation": 1056, "user_id": 9652640, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rZGNE.png?s=128&g=1", "display_name": "Min-Soo Pipefeet", "link": "https://stackoverflow.com/users/9652640/min-soo-pipefeet"}, "edited": false, "score": 0, "creation_date": 1540997143, "post_id": 53084927, "comment_id": 93068909, "body": "It works. Sometimes. If executed repeatedly (incl. class definition), it shows a kind of weird behaviour. Sometimes it outputs &quot;1..10#&lt;RangeInherited 1..10 x&gt;&quot;, sometimes &quot;#&lt;RangeInherited (... .. ...) x&gt;&quot;, sometimes even &quot;#&lt;RangeInherited #&lt;RangeInherited (... .. ...) x&gt; x&gt;&quot;. Seemingly, some kind of recursion occurs."}, {"owner": {"reputation": 4866, "user_id": 6603195, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nZGPkfcc0EE/AAAAAAAAAAI/AAAAAAAAAoE/op-TBiFRNzg/photo.jpg?sz=128", "display_name": "Marcin Ko\u0142odziej", "link": "https://stackoverflow.com/users/6603195/marcin-ko%c5%82odziej"}, "reply_to_user": {"reputation": 1056, "user_id": 9652640, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rZGNE.png?s=128&g=1", "display_name": "Min-Soo Pipefeet", "link": "https://stackoverflow.com/users/9652640/min-soo-pipefeet"}, "edited": false, "score": 0, "creation_date": 1540997397, "post_id": 53084927, "comment_id": 93069098, "body": "Quit your pry, quit your irb, restart everything. You might still have <code>to_s</code> declared somewhere in your class."}, {"owner": {"reputation": 1056, "user_id": 9652640, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rZGNE.png?s=128&g=1", "display_name": "Min-Soo Pipefeet", "link": "https://stackoverflow.com/users/9652640/min-soo-pipefeet"}, "edited": false, "score": 0, "creation_date": 1540999706, "post_id": 53084927, "comment_id": 93070737, "body": "Indeed, still having to_s declared was the pivotal hint, thx! But what if I want to have to_s <i>and</i> pretty_print; moreover, I don&#39;t like to duplicate code but to call to_s from pretty_print(pp)."}, {"owner": {"reputation": 4866, "user_id": 6603195, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nZGPkfcc0EE/AAAAAAAAAAI/AAAAAAAAAoE/op-TBiFRNzg/photo.jpg?sz=128", "display_name": "Marcin Ko\u0142odziej", "link": "https://stackoverflow.com/users/6603195/marcin-ko%c5%82odziej"}, "reply_to_user": {"reputation": 1056, "user_id": 9652640, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rZGNE.png?s=128&g=1", "display_name": "Min-Soo Pipefeet", "link": "https://stackoverflow.com/users/9652640/min-soo-pipefeet"}, "edited": false, "score": 0, "creation_date": 1541000411, "post_id": 53084927, "comment_id": 93071233, "body": "Have your <code>to_s</code> return the whole string from that you initially wrote and define the <code>pretty_print</code> as <code>pp.text(to_s)</code>."}, {"owner": {"reputation": 1056, "user_id": 9652640, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rZGNE.png?s=128&g=1", "display_name": "Min-Soo Pipefeet", "link": "https://stackoverflow.com/users/9652640/min-soo-pipefeet"}, "edited": false, "score": 1, "creation_date": 1541000774, "post_id": 53084927, "comment_id": 93071491, "body": "Yes, that was what I tried as first but something went wrong. Must have been a fault of mine. Because after a clean start it worked fine. Repeatedly. Thx."}], "tags": [], "owner": {"reputation": 4866, "user_id": 6603195, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nZGPkfcc0EE/AAAAAAAAAAI/AAAAAAAAAoE/op-TBiFRNzg/photo.jpg?sz=128", "display_name": "Marcin Ko\u0142odziej", "link": "https://stackoverflow.com/users/6603195/marcin-ko%c5%82odziej"}, "is_accepted": true, "score": 4, "last_activity_date": 1540995432, "last_edit_date": 1540995432, "creation_date": 1540993643, "answer_id": 53084927, "question_id": 53084749, "link": "https://stackoverflow.com/questions/53084749/ruby-in-pry-overriding-ranges-to-string-methods/53084927#53084927", "title": "Ruby in pry: overriding Range&#39;s to string methods", "body": "<p>Without any <a href=\"https://github.com/pry/pry/wiki/Customization-and-configuration#the-print-object\" rel=\"nofollow noreferrer\">customization</a>, <code>pry</code> uses <code>pp</code> (pretty print) for its output, not <code>inspect</code>. </p>\n\n<p>In order to overwrite it, you have to redefine <code>pretty_print</code>, like so:</p>\n\n<pre><code>def pretty_print(pp)\n  pp.text(\n    \"#&lt;\".concat(self.class.name, \" \", to_s, \" \", @added || \"-\", \"&gt;\")\n  )\nend  \n</code></pre>\n\n<p>your pry will output what you wanted:</p>\n\n<pre><code>[3] pry(main)&gt; r = RangeInherited.new(1, 10, \"x\")\n=&gt; #&lt;RangeInherited 1..10 x&gt;\n</code></pre>\n"}], "owner": {"reputation": 1056, "user_id": 9652640, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rZGNE.png?s=128&g=1", "display_name": "Min-Soo Pipefeet", "link": "https://stackoverflow.com/users/9652640/min-soo-pipefeet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 53084927, "answer_count": 1, "score": 0, "last_activity_date": 1541000481, "creation_date": 1540993103, "last_edit_date": 1541000481, "question_id": 53084749, "link": "https://stackoverflow.com/questions/53084749/ruby-in-pry-overriding-ranges-to-string-methods", "title": "Ruby in pry: overriding Range&#39;s to string methods", "body": "<p>I cannot get pry to show instances of my class, derived from Range, in the way I have overridden to_s / inspect:</p>\n\n<pre><code>[1] pry(main)&gt; class RangeInherited &lt; Range\n[1] pry(main)*   def initialize(first, last, added=nil)\n[1] pry(main)*     super(first, last)\n[1] pry(main)*     @added = added\n[1] pry(main)*   end  \n[1] pry(main)*   def to_s\n[1] pry(main)*     \"#&lt;\".concat(self.class.name, \" \", super, \" \", @added || \"-\", \"&gt;\")\n[1] pry(main)*   end  \n[1] pry(main)*   alias inspect to_s\n[1] pry(main)* end  \n=&gt; nil\n[2] pry(main)&gt; r = RangeInherited.new(1, 10, \"x\")\n=&gt; 1..10\n</code></pre>\n\n<p>Despite the fact that direct calls of to_s / inspect produce the wanted result:</p>\n\n<pre><code>[3] pry(main)&gt; r.to_s\n=&gt; \"#&lt;RangeInherited 1..10 x&gt;\"\n[4] pry(main)&gt; r.inspect\n=&gt; \"#&lt;RangeInherited 1..10 x&gt;\"\n[5] pry(main)&gt; \n</code></pre>\n\n<p>Why?</p>\n\n<hr>\n\n<p>With the help of Marcin Ko\u0142odziej's answer I came to the following solution:</p>\n\n<pre><code>[1] pry(main)&gt; class RangeInherited &lt; Range\n[1] pry(main)*   def initialize(first, last, added=nil)    \n[1] pry(main)*     super(first, last)        \n[1] pry(main)*     @added = added        \n[1] pry(main)*   end      \n[1] pry(main)*   def to_s    \n[1] pry(main)*     \"#&lt;\".concat(self.class.name, \" \", super, \" \", @added || \"-\", \"&gt;\")        \n[1] pry(main)*   end      \n[1] pry(main)*   alias inspect to_s    \n[1] pry(main)*   def pretty_print(pp)    \n[1] pry(main)*     pp.text(to_s)        \n[1] pry(main)*   end       \n[1] pry(main)* end  \n=&gt; :pretty_print\n[2] pry(main)&gt; \n[3] pry(main)&gt; r = RangeInherited.new(1, 10, \"x\")\n=&gt; #&lt;RangeInherited 1..10 x&gt;\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "scep", "openscep"], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 5407267, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pvoTv.jpg?s=128&g=1", "display_name": "madmatvey", "link": "https://stackoverflow.com/users/5407267/madmatvey"}, "is_accepted": false, "score": 0, "last_activity_date": 1570937310, "last_edit_date": 1570937310, "creation_date": 1570890751, "answer_id": 58355192, "question_id": 53084619, "link": "https://stackoverflow.com/questions/53084619/ioscertenrollment-is-ruby-gem-for-ios-scep-how-to-run-this-on-localhost/58355192#58355192", "title": "IOSCertEnrollment is ruby gem for iOS SCEP, how to run this on localhost?", "body": "<p><strong>Second question's answer:</strong></p>\n\n<p>Add <code>192.168.100.48 you-perfect-domain.local</code> to <code>/etc/hosts</code> file at the device who can share Wi-Fi to your iOS device. </p>\n\n<p>And open <code>you-perfect-domain.local:3001</code> on iOS device browser</p>\n\n<p>I hope it will work.</p>\n"}], "owner": {"reputation": 2725, "user_id": 3145189, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/3b7992b5e5cbf3d0e7587f00f1bae5fa?s=128&d=identicon&r=PG&f=1", "display_name": "CMS Signage", "link": "https://stackoverflow.com/users/3145189/cms-signage"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 94, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1570937310, "creation_date": 1540992780, "question_id": 53084619, "link": "https://stackoverflow.com/questions/53084619/ioscertenrollment-is-ruby-gem-for-ios-scep-how-to-run-this-on-localhost", "title": "IOSCertEnrollment is ruby gem for iOS SCEP, how to run this on localhost?", "body": "<p><a href=\"https://github.com/nolanbrown/ios-cert-enrollment\" rel=\"nofollow noreferrer\">So this is rails gem for iOS SCEP</a>, this library code has example as well examples runs using webrick and sinatra, i created self sign SSL certificate for common name(CN) localhost, i can access this project on my machine but can't access using my machine public ip address.</p>\n\n<p>Using terminal(inside example project) i run like $ruby application.rb</p>\n\n<p>code of application.rb as below</p>\n\n<pre><code>require 'rubygems'\nrequire 'sinatra'\nrequire 'ios-cert-enrollment'\n\nrequire 'sinatra/base'\nrequire 'webrick'\nrequire 'webrick/https'\nrequire 'openssl'\n\nIOSCertEnrollment.configure do |config|\n  config.ssl_certificate_path = \"./ssl_cert/server.crt\"\n  config.ssl_key_path = \"./ssl_cert/server.key\"\n  config.base_url = \"192.168.100.48\"\n  config.identifier = \"192.168.100.48\"\n  config.display_name = \"iOS Enrollment Server\"\n  config.organization = \"Nolan Brown\"\nend\n\nwebrick_options = {\n        :Port               =&gt; 3001,\n        :Logger             =&gt; WEBrick::Log::new($stderr, WEBrick::Log::DEBUG),\n        :DocumentRoot       =&gt; \"/ruby/htdocs\",\n        :DoNotReverseLookup =&gt; false,\n        :SSLEnable          =&gt; true,\n        :SSLVerifyClient    =&gt; OpenSSL::SSL::VERIFY_NONE,\n        :SSLCertificate     =&gt; IOSCertEnrollment::SSL.certificate,\n        :SSLPrivateKey      =&gt; IOSCertEnrollment::SSL.key,\n        :SSLCertName        =&gt; [ [ \"CN\",WEBrick::Utils::getservername ] ]\n}\n\nclass MyServer &lt; Sinatra::Base\n\n  get '/' do\n    '&lt;a href=\"/enroll\"&gt;Enroll&lt;/a&gt;'\n  end\n\n  get '/enroll' do \n    signed_certificate = IOSCertEnrollment::Profile.new(\"/profile\").service().sign()\n\n    ## Send\n    content_type signed_certificate.mime_type\n    signed_certificate.certificate  \n\n  end\n\n  post '/profile' do  \n    p7sign = IOSCertEnrollment::Sign.verify_response(request.body.read)\n    if IOSCertEnrollment::Sign.verify_signer(p7sign)\n\n      profile = IOSCertEnrollment::Profile.new()\n      profile.icon = File.open(File.expand_path('&lt;PATH TO YOUR ICON&gt;', __FILE__))\n      profile.display_name = \"iOS Enrollment Server\"\n      profile.description = \"Easy access to web\"\n      profile.label = \"iOS Enrollment\"\n      profile.url = \"&lt;URL FOR WEBCLIP&gt;\"\n      encrypted_profile = profile.webclip().encrypt(p7sign.certificates)\n      signed_profile = profile.configuration(encrypted_profile.certificate).sign()\n\n    else\n      # Get returned device attributes\n      device_attributes = IOSCertEnrollment::Device.parse(p7sign)  \n\n      # \"UDID\", \n      # \"VERSION\",\n      # \"PRODUCT\",          \n      # \"DEVICE_NAME\",\n      # \"MAC_ADDRESS_EN0\",\n      # \"IMEI\",\n      # \"ICCID\"\n\n      ## Validation\n      profile = IOSCertEnrollment::Profile.new(\"/scep\")\n      signed_profile = profile.encrypted_service().sign()\n\n    end\n    ## Send \n    content_type signed_profile.mime_type\n    signed_profile.certificate\n\n  end\n\n  get '/scep' do\n    case params['operation']\n    when \"GetCACert\"\n      registration_authority = IOSCertEnrollment::Sign.registration_authority\n      content_type registration_authority.mime_type\n      registration_authority.certificate\n\n    when \"GetCACaps\" \n      content_type \"text/plain\"\n      IOSCertEnrollment::Sign.certificate_authority_caps\n    else\n      \"Invalid Action\"\n    end\n  end\n\n  post '/scep' do\n    if params['operation'] == \"PKIOperation\"\n      signed_pki = IOSCertEnrollment::Sign.sign_PKI(request.body.read)\n\n      content_type signed_pki.mime_type\n      signed_pki.certificate\n\n    else\n      \"Invalid Action\"\n    end\n  end      \nend\n\nRack::Handler::WEBrick.run MyServer, webrick_options\n</code></pre>\n\n<p>Note- application.rb code is as it is given in example-project with this library, only thing i am changing/putting is SSL library path.</p>\n\n<p>My question is -</p>\n\n<p>1) is it possible to test SCEP using localhost ?</p>\n\n<p>2) if possible, how can i access localhost using IP address</p>\n"}, {"tags": ["ruby", "string", "parsing", "hash"], "comments": [{"owner": {"reputation": 14010, "user_id": 3109182, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4b305f0077055b4fdcf715067775d5a?s=128&d=identicon&r=PG", "display_name": "Anthony", "link": "https://stackoverflow.com/users/3109182/anthony"}, "edited": false, "score": 0, "creation_date": 1540994571, "post_id": 53084386, "comment_id": 93067204, "body": "it looks like a machine is producing this output - can it be formatted differently?"}, {"owner": {"reputation": 9772, "user_id": 1786065, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/udTpS.png?s=128&g=1", "display_name": "Rogue", "link": "https://stackoverflow.com/users/1786065/rogue"}, "edited": false, "score": 0, "creation_date": 1541008562, "post_id": 53084386, "comment_id": 93075782, "body": "Where did the string originally come from?"}, {"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1541064340, "post_id": 53084386, "comment_id": 93092541, "body": "The logic is not clear. Where does <code>&#39;GBR&#39;</code> come from?"}, {"owner": {"reputation": 1, "user_id": 10586044, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-jcg35h66yVw/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbD3rJrXP54ioq2cz78p_oq_laSvWQ/mo/photo.jpg?sz=128", "display_name": "fix12332", "link": "https://stackoverflow.com/users/10586044/fix12332"}, "reply_to_user": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1541158170, "post_id": 53084386, "comment_id": 93129787, "body": "@sawa it&#39;s a typo"}], "answers": [{"tags": [], "owner": {"reputation": 426, "user_id": 8287207, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PZ5Cf.jpg?s=128&g=1", "display_name": "Alexey Strizhak", "link": "https://stackoverflow.com/users/8287207/alexey-strizhak"}, "is_accepted": false, "score": 0, "last_activity_date": 1541003179, "creation_date": 1541003179, "answer_id": 53088030, "question_id": 53084386, "link": "https://stackoverflow.com/questions/53084386/how-can-i-parse-a-string-into-a-hash/53088030#53088030", "title": "How can I parse a string into a hash?", "body": "<p>something like this with regexp:</p>\n\n<pre><code>require 'pp'\n\nstr = \"Notifications[0].Open=1\nNotifications[0].Body.Message[0]=3455\nNotifications[0].Body.Message[1]=2524\nNotifications[0].Body.Message[2]=2544\nNotifications[0].Body.Message[3]=2452\nNotifications[0].Body.Error[0]=2455\nNotifications[0].Body.Currency=EUR\nNotifications[0].Published=true\"\n\npairs         = {}\npairs['Body'] = {}\nvalues        = []\n\nstr.scan(/Body\\W+(.+)/).flatten.each do |line|\n  key   = line[/\\A\\w+/]\n  value = line[/\\w+\\z/]\n\n  if line[/\\A\\w+\\[\\d+\\]/] || key == 'Error'\n    values = [] unless pairs['Body'][key]\n\n    values &lt;&lt; value\n    value = values\n  end\n\n  pairs['Body'][key] = value\nend\n\nstr.scan(/\\[0\\]\\.(?!Body.).*/).each do |line|\n  key   = line[/(?!\\A)\\.(\\w+)/, 1]\n  value = line[/\\w+\\z/]\n\n  if line[/\\A\\w+\\[\\d+\\]/]\n    values = [] unless pairs[key]\n\n    values &lt;&lt; value\n    value = values\n  end\n\n  pairs[key] = value\nend\n\nPP.pp pairs\n</code></pre>\n\n<p>-</p>\n\n<pre><code>{\"Body\"=&gt;\n  {\"Message\"=&gt;[\"3455\", \"2524\", \"2544\", \"2452\"],\n   \"Error\"=&gt;[\"2455\"],\n   \"Currency\"=&gt;\"EUR\"},\n \"Open\"=&gt;\"1\",\n \"Published\"=&gt;\"true\"}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2496, "user_id": 3046905, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/692eb06201cbed91c3c6a9cf11ed0511?s=128&d=identicon&r=PG", "display_name": "Ilya Konyukhov", "link": "https://stackoverflow.com/users/3046905/ilya-konyukhov"}, "is_accepted": false, "score": 0, "last_activity_date": 1541009450, "last_edit_date": 1541009450, "creation_date": 1541008445, "answer_id": 53089371, "question_id": 53084386, "link": "https://stackoverflow.com/questions/53084386/how-can-i-parse-a-string-into-a-hash/53089371#53089371", "title": "How can I parse a string into a hash?", "body": "<p>Here it is. This code should work with any structure.</p>\n\n<pre><code>def parse(path, value, hash)\n  key, rest = path.split('.', 2)\n  if rest.nil?\n    hash[key] = value\n  else\n    hash[key] ||= {}\n    parse(rest, value, hash[key])\n  end\nend\n\ndef conv_to_array(hash)\n  if hash.is_a?(Hash)\n    hash.each do |key, value|\n      hash[key] = if value.is_a?(Hash) &amp;&amp; value.keys.all? { |k| k !~ /\\D/ }\n                    arr = []\n                    value.each do |k, v|\n                      arr[k.to_i] = conv_to_array(v)\n                    end\n                    arr\n                  else\n                    conv_to_array(value)\n                  end\n    end\n    hash\n  else\n    if hash !~ /\\D/\n      hash.to_i\n    elsif hash == 'true'\n      true\n    elsif hash == 'false'\n      false\n    else\n      hash\n    end\n  end\nend\n\n\nstr = \"Notifications[0].Open=1\nNotifications[0].Body.Message[0]=3455\nNotifications[0].Body.Message[1]=2524\nNotifications[0].Body.Message[2]=2544\nNotifications[0].Body.Message[3]=2452\nNotifications[0].Body.Error[0]=2455\nNotifications[0].Body.Currency=EUR\nNotifications[0].Published=true\"\n\nstr = str.tr('[', '.').tr(']', '')\nhash = {}\nstr.split(' ').each do |chunk|\n  path, value = chunk.split('=')\n  parse(path.strip, value.strip, hash)\nend\nhash = conv_to_array(hash)\n\nhash['Notifications'][0]\n\n# =&gt; {\"Open\"=&gt;1, \"Body\"=&gt;{\"Message\"=&gt;[3455, 2524, 2544, 2452], \"Error\"=&gt;[2455], \"Currency\"=&gt;\"EUR\"}, \"Published\"=&gt;true}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10586044, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-jcg35h66yVw/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbD3rJrXP54ioq2cz78p_oq_laSvWQ/mo/photo.jpg?sz=128", "display_name": "fix12332", "link": "https://stackoverflow.com/users/10586044/fix12332"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1541158099, "creation_date": 1540992078, "last_edit_date": 1541158099, "question_id": 53084386, "link": "https://stackoverflow.com/questions/53084386/how-can-i-parse-a-string-into-a-hash", "title": "How can I parse a string into a hash?", "body": "<p>I am trying to parse a string into a hash.</p>\n\n<pre><code>str = \"Notifications[0].Open=1\nNotifications[0].Body.Message[0]=3455\nNotifications[0].Body.Message[1]=2524\nNotifications[0].Body.Message[2]=2544\nNotifications[0].Body.Message[3]=2452\nNotifications[0].Body.Error[0]=2455\nNotifications[0].Body.Currency=EUR\nNotifications[0].Published=true\"\n</code></pre>\n\n<p>The result should look similar to this:</p>\n\n<pre><code>pairs = {\n 'Open' = 1,\n 'Published' =&gt; true\n 'Body' =&gt; {\n    'Message' =&gt; [3455, 2524, 2544, 2452],\n    'Error' =&gt; [2455],\n    'Currency' =&gt; 'EUR',\n }\n}\n</code></pre>\n\n<p>Maybe someone can help on how I can make it. The only way I can think as for now is regexp.</p>\n"}, {"tags": ["ruby", "hash"], "comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 2, "creation_date": 1540994500, "post_id": 53084168, "comment_id": 93067157, "body": "Probably would be better to wrap the offending Hash in a proxy class and track all the calls than it would be to monkey patch the Hash class. Also remember key reassignment need not occur for the value to change e.g. <code>h = {n: &quot;hello&quot;}; h[:n].concat(&quot; world&quot;); h[:n] #=&gt; &quot;hello world&quot;</code> or <code>h = {n: 12}; h[:n] += 12; h[:n] #=&gt; 24</code> and furthermore <code>Hash#[]=</code> is not the only method that modifies key =&gt; value assignments other methods can do that such as <code>store</code>, <code>transform_values</code>, <code>update</code>,<code>merge</code>, etc."}, {"owner": {"reputation": 821, "user_id": 1481415, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ded99b62da807b71e7c626350e074994?s=128&d=identicon&r=PG", "display_name": "Doug Hughes", "link": "https://stackoverflow.com/users/1481415/doug-hughes"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1541094290, "post_id": 53084168, "comment_id": 93108497, "body": "I agree with you, but I&#39;m not sure if there&#39;s another instance of hash being created by <code>dup</code>ing this hash or not. It&#39;s just one way to see what&#39;s going on."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1541095207, "post_id": 53084168, "comment_id": 93108971, "body": "If you wrap it in a proxy object you can track all the calls made including duplication and wrap the duplication in another proxy object that is why I suggested it"}], "answers": [{"comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 3, "creation_date": 1541065370, "post_id": 53089491, "comment_id": 93093018, "body": "That was the old way, indeed. It&#39;s been obsolete for 5 years now. Modern way is <code>Module#prepend</code>"}], "tags": [], "owner": {"reputation": 600, "user_id": 5994561, "user_type": "registered", "accept_rate": 88, "profile_image": "https://lh5.googleusercontent.com/-VGTzdts3mMw/AAAAAAAAAAI/AAAAAAAAADY/6Qwn_AVjnQI/photo.jpg?sz=128", "display_name": "sammms", "link": "https://stackoverflow.com/users/5994561/sammms"}, "is_accepted": false, "score": 1, "last_activity_date": 1541098592, "last_edit_date": 1541098592, "creation_date": 1541008855, "answer_id": 53089491, "question_id": 53084168, "link": "https://stackoverflow.com/questions/53084168/how-can-i-spy-on-the-method-in-ruby-hash/53089491#53089491", "title": "How can I spy on the `[]=` method in Ruby hash?", "body": "<p>You can to monkey patch the <code>Hash</code> class itself.  Put this inside the module / class definition,</p>\n\n<pre><code>class Hash\n  def []=(arg)\n    # do your magic here with a debugger or pry\n  end \nend\n</code></pre>\n\n<p>Edit: This way is obsolete, but leaving for reference.  </p>\n"}, {"tags": [], "owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "is_accepted": true, "score": 2, "last_activity_date": 1541065146, "creation_date": 1541065146, "answer_id": 53098595, "question_id": 53084168, "link": "https://stackoverflow.com/questions/53084168/how-can-i-spy-on-the-method-in-ruby-hash/53098595#53098595", "title": "How can I spy on the `[]=` method in Ruby hash?", "body": "<p><code>Hash.send(:include, HashPatches)</code> only makes your <code>HashPatches#[]=</code> to be called when (the original) <code>Hash#[]=</code> is not available, which is not the case. Also, <code>super</code> in your <code>HashPatches#[]=</code> definition will not work since the superclass <code>Object</code> of your <code>HashPatches</code> does not have <code>[]=</code>.</p>\n\n<p>To give precedence to your <code>HashPatches#[]=</code> over the original <code>Hash#[]=</code>, you need to do:</p>\n\n<pre><code>Hash.prepend(HashPatches)\n</code></pre>\n"}], "owner": {"reputation": 821, "user_id": 1481415, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ded99b62da807b71e7c626350e074994?s=128&d=identicon&r=PG", "display_name": "Doug Hughes", "link": "https://stackoverflow.com/users/1481415/doug-hughes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 53098595, "answer_count": 2, "score": 2, "last_activity_date": 1541098592, "creation_date": 1540991441, "last_edit_date": 1541065039, "question_id": 53084168, "link": "https://stackoverflow.com/questions/53084168/how-can-i-spy-on-the-method-in-ruby-hash", "title": "How can I spy on the `[]=` method in Ruby hash?", "body": "<p>I have a hash. One of these keys is <code>daily_budget</code>. After some process, <code>daily_budget</code> has been changed while all other keys' values have not. Either the hash's value for that key changed, or I'm cloning the hash and setting that value on the cloned hash.</p>\n\n<p>I want to spy on the <code>Hash#[]=</code> method to figure out where this happens. I'd monkey patch it, watch for a key named <code>daily_budget</code>, and dump a stack trace whenever it is set.</p>\n\n<p>I was trying to use a code like this:</p>\n\n<pre><code>module HashPatches\n  def []=(key, value)\n    puts \"&gt;&gt;&gt;&gt; hey! I got here!\"\n    super(key, value)\n  end\nend\n\nHash.send(:include, HashPatches)\n</code></pre>\n\n<p>It seems like this change is ignored, while other patches on <code>Hash</code> are working. Did I do something wrong?</p>\n\n<p>I also tried using <code>set_trace_func</code> to trace calls to the hash with this code,</p>\n\n<pre><code>set_trace_func proc { |event, file, line, id, binding, classname|\n  if file =~ /\\/my_project_name\\//\n    puts \"&gt;&gt;&gt;&gt; #{id}\"\n    puts \"&gt;&gt;&gt;&gt; #{classname}\"\n    puts \"&gt;&gt;&gt;&gt; #{event}\"\n    puts \"&gt;&gt;&gt;&gt; #{file}\"\n    puts \"&gt;&gt;&gt;&gt; #{line}\"\n  end\n}\n</code></pre>\n\n<p>but <code>:[]=</code> isn't traced. I'd removed the monkey patch. I couldn't get usages of <code>:[]=</code> to appear in this output.</p>\n\n<p>Is there any way to spy changes to hashes so I can track down where this key's value is changed?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "rabbitmq", "amqp", "sneakers"], "answers": [{"tags": [], "owner": {"reputation": 10274, "user_id": 930207, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oy7Q3.png?s=128&g=1", "display_name": "mcfinnigan", "link": "https://stackoverflow.com/users/930207/mcfinnigan"}, "is_accepted": false, "score": 0, "last_activity_date": 1540995433, "creation_date": 1540995433, "answer_id": 53085503, "question_id": 53083794, "link": "https://stackoverflow.com/questions/53083794/rabbitmq-sneakers-one-worker-or-100/53085503#53085503", "title": "RabbitMQ + Sneakers: one worker or 100?", "body": "<p>Neither of your assumptions hold.  You are not guaranteed to have 100 parallel workers as sneakers has a default thread pool size that you are not necessarily overriding:</p>\n\n<p><a href=\"https://github.com/jondot/sneakers/blob/master/lib/sneakers/worker.rb#L20\" rel=\"nofollow noreferrer\">https://github.com/jondot/sneakers/blob/master/lib/sneakers/worker.rb#L20</a></p>\n\n<p>And if you do not have an ActiveRecord connection pool of at least 100 connections configured, your code will also block and wait because of resource starvation here.</p>\n\n<p>in GENERAL, doing this sort of task in parallel is likely to be faster <em>most of the time</em> - but this is not guaranteed.</p>\n"}], "owner": {"reputation": 917, "user_id": 7411621, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/a37fcd6d889200d8721cf58a491e4ee5?s=128&d=identicon&r=PG&f=1", "display_name": "taras", "link": "https://stackoverflow.com/users/7411621/taras"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 372, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1540995433, "creation_date": 1540990305, "question_id": 53083794, "link": "https://stackoverflow.com/questions/53083794/rabbitmq-sneakers-one-worker-or-100", "title": "RabbitMQ + Sneakers: one worker or 100?", "body": "<p>Let's say that I need to do complex calculations for 100 users. My current configuration looks like this:</p>\n\n<p><strong>producer</strong></p>\n\n<pre><code>class Producer\n  class &lt;&lt; self\n    def publish(target, options = {})\n      connection = Bunny.new(some_params).start\n      channel    = connection.create_channel\n      exchange   = channel.fanout(\"#{target}_exchange\", durable: true)\n\n      exchange.publish(options.to_json)\n    end\n  end\nend\n</code></pre>\n\n<p><strong>MassComplexCalculations worker</strong></p>\n\n<pre><code>module UsersWorkers\n  class MassComplexCalculations\n    include Sneakers::Worker\n\n    from_queue \"#{ENV['RAILS_ENV']}.users.mass_complex_calculations_queue\",\n               exchange: \"#{ENV['RAILS_ENV']}.users.mass_complex_calculations_exchange\"\n\n    def work(options)\n      parsed_options = JSON.parse(options)\n\n      ActiveRecord::Base.connection_pool.with_connection do\n        User.where(id: parsed_options['ids']).each do |user|\n          ::Services::Users::ComplexCalculations.call(user)\n        end\n      end\n      ack!\n    end\n  end\nend\n</code></pre>\n\n<p><strong>run worker</strong></p>\n\n<pre><code>Producer.publish(\"#{ENV['RAILS_ENV']}.users.mass_complex_calculations\", ids: User.limit(100).ids)\n</code></pre>\n\n<p>I do not quite understand how AMQP allocates resources to perform tasks and how I can help. Is it right, that it would be better to run each calculation in a separate worker? For example:</p>\n\n<p><strong>CHANGED MassComplexCalculations worker</strong></p>\n\n<pre><code>module UsersWorkers\n  class MassComplexCalculations\n    include Sneakers::Worker\n\n    from_queue \"#{ENV['RAILS_ENV']}.users.mass_complex_calculations_queue\",\n               exchange: \"#{ENV['RAILS_ENV']}.users.mass_complex_calculations_exchange\"\n\n    def work(options)\n      parsed_options = JSON.parse(options)\n\n      ActiveRecord::Base.connection_pool.with_connection do\n        parsed_options['ids'].each do |id|\n          Producer.publish(\"#{ENV['RAILS_ENV']}.users.personal_complex_calculations\", id: id)\n        end\n      end\n      ack!\n    end\n  end\nend\n</code></pre>\n\n<p><strong>NEW PersonalComplexCalculations worker</strong></p>\n\n<pre><code>module UsersWorkers\n  class PersonalComplexCalculations\n    include Sneakers::Worker\n\n    from_queue \"#{ENV['RAILS_ENV']}.users.personal_complex_calculations_queue\",\n               exchange: \"#{ENV['RAILS_ENV']}.users.personal_complex_calculations_exchange\"\n\n    def work(options)\n      parsed_options = JSON.parse(options)\n      user           = User.find(parsed_options['id'])\n\n      ActiveRecord::Base.connection_pool.with_connection do\n        ::Services::Users::ComplexCalculations.call(user)\n      end\n      ack!\n    end\n  end\nend\n</code></pre>\n\n<p>In my understanding, there may be two options:</p>\n\n<ol>\n<li>the first implementation may work slower because it will call the service in order for each user, while in the second option we will have 100 simultaneous working workers which will do their job in parallel</li>\n<li>there is no difference</li>\n</ol>\n\n<p>So which approach is better? Or maybe even one of them is completely wrong?</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "answers": [{"tags": [], "owner": {"reputation": 10274, "user_id": 930207, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oy7Q3.png?s=128&g=1", "display_name": "mcfinnigan", "link": "https://stackoverflow.com/users/930207/mcfinnigan"}, "is_accepted": false, "score": 1, "last_activity_date": 1540985991, "last_edit_date": 1540985991, "creation_date": 1540985457, "answer_id": 53082342, "question_id": 53081736, "link": "https://stackoverflow.com/questions/53081736/erb-string-interpolation-generating-incorrect-html-syntax/53082342#53082342", "title": "ERB String interpolation generating incorrect HTML syntax", "body": "<pre><code>&lt;div class=&lt;%= cls %&gt; &gt;\n</code></pre>\n\n<p>should probably be</p>\n\n<pre><code>&lt;div class=\"&lt;%= cls %&gt;\"&gt;\n</code></pre>\n\n<p>You're substituting a string into an erb placeholder, but the underlying template does not indicate that the placeholder itself is a string.  <strike>ERB is likely making a best effort attempt to do a correction but it's oviously not able to cope.</strike> Edit: Sergio pointed out this is likely the browser doing this, not ERB.</p>\n"}, {"comments": [{"owner": {"reputation": 1798, "user_id": 587238, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/957f31102fe690aca373f297176b9d18?s=128&d=identicon&r=PG", "display_name": "Peter Andersson", "link": "https://stackoverflow.com/users/587238/peter-andersson"}, "edited": false, "score": 0, "creation_date": 1540985992, "post_id": 53082388, "comment_id": 93061780, "body": "correct! I was using inspect element, had no idea that it worked the way it did. Also, the browser only displays using the first class which threw me off guard."}], "tags": [], "owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "is_accepted": true, "score": 4, "last_activity_date": 1540985623, "last_edit_date": 1592644375, "creation_date": 1540985623, "answer_id": 53082388, "question_id": 53081736, "link": "https://stackoverflow.com/questions/53081736/erb-string-interpolation-generating-incorrect-html-syntax/53082388#53082388", "title": "ERB String interpolation generating incorrect HTML syntax", "body": "<blockquote>\n<p>This produces:</p>\n<pre><code>&lt;div class=&quot;product&quot; fav&gt;\n</code></pre>\n</blockquote>\n<p>No, it doesn't. It produces <code>&lt;div class=product fav&gt;</code>. What you <strong>see</strong> (via something like &quot;inspect element&quot;, correct?) is browser trying to interpret your broken markup as close to html spec as it can.</p>\n<p>As noted in other answers, what you should do instead is something like this:</p>\n<pre><code>&lt;div class=&quot;&lt;%= cls %&gt;&quot;&gt;\n</code></pre>\n"}], "owner": {"reputation": 1798, "user_id": 587238, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/957f31102fe690aca373f297176b9d18?s=128&d=identicon&r=PG", "display_name": "Peter Andersson", "link": "https://stackoverflow.com/users/587238/peter-andersson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 53082388, "answer_count": 2, "score": -2, "last_activity_date": 1540986531, "creation_date": 1540983421, "last_edit_date": 1540986531, "question_id": 53081736, "link": "https://stackoverflow.com/questions/53081736/erb-string-interpolation-generating-incorrect-html-syntax", "title": "ERB String interpolation generating incorrect HTML syntax", "body": "<p>I have these lines in a view:</p>\n\n<pre><code>&lt;%\n  if current_user.is_fav?(a)\n    cls = \"product fav\"\n  else\n    cls = \"product\"\n  end\n%&gt;\n</code></pre>\n\n<p>and later</p>\n\n<pre><code>&lt;div class=&lt;%= cls %&gt; &gt;\n</code></pre>\n\n<p>This produces:</p>\n\n<pre><code>&lt;div class=\"product\" fav&gt;\n</code></pre>\n\n<p>EDIT: as the answer says, it did NOT produce this, it was the browser \"inspect\" that showed it to me.  </p>\n\n<p>I can work my around it, but why doesn't the above code work?</p>\n"}, {"tags": ["javascript", "ruby-on-rails", "ruby", "reactjs", "react-native"], "answers": [{"tags": [], "owner": {"reputation": 645, "user_id": 6285605, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/d21129320196972e88809eefe996bdc2?s=128&d=identicon&r=PG&f=1", "display_name": "Suganya Selvarajan", "link": "https://stackoverflow.com/users/6285605/suganya-selvarajan"}, "is_accepted": false, "score": 1, "last_activity_date": 1540986318, "creation_date": 1540986318, "answer_id": 53082585, "question_id": 53081529, "link": "https://stackoverflow.com/questions/53081529/rails-and-react-react-createclass-react-createreactclass-is-not-a-function/53082585#53082585", "title": "Rails and React - React.createClass / React.createReactClass is not a function", "body": "<p>This seems to be a version problem. I had to use the following syntax to get this working.</p>\n\n<pre><code>class Main extends React.Component{\n  render() {\n    return (\n      &lt;div&gt;\n        &lt;Header /&gt;\n      &lt;/div&gt;    \n    )\n  }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 26, "user_id": 1224410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e532d60545ebffab0aae694a439ee8f?s=128&d=identicon&r=PG", "display_name": "Jonnyman9", "link": "https://stackoverflow.com/users/1224410/jonnyman9"}, "is_accepted": true, "score": 0, "last_activity_date": 1540986936, "creation_date": 1540986936, "answer_id": 53082778, "question_id": 53081529, "link": "https://stackoverflow.com/questions/53081529/rails-and-react-react-createclass-react-createreactclass-is-not-a-function/53082778#53082778", "title": "Rails and React - React.createClass / React.createReactClass is not a function", "body": "<p>Relevant docs are here:</p>\n\n<p><a href=\"https://reactjs.org/docs/react-without-es6.html\" rel=\"nofollow noreferrer\">https://reactjs.org/docs/react-without-es6.html</a></p>\n\n<p>Normally you would define a React component as a plain JavaScript class:</p>\n\n<pre><code>class Greeting extends React.Component {\n  render() {\n    return &lt;h1&gt;Hello, {this.props.name}&lt;/h1&gt;;\n  }\n}\n</code></pre>\n\n<p>If you don\u2019t use ES6 yet, you may use the create-react-class module instead:</p>\n\n<pre><code>var createReactClass = require('create-react-class');\nvar Greeting = createReactClass({\n  render: function() {\n    return &lt;h1&gt;Hello, {this.props.name}&lt;/h1&gt;;\n  }\n});\n</code></pre>\n\n<p>The API of ES6 classes is similar to createReactClass() with a few exceptions.</p>\n"}], "owner": {"reputation": 645, "user_id": 6285605, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/d21129320196972e88809eefe996bdc2?s=128&d=identicon&r=PG&f=1", "display_name": "Suganya Selvarajan", "link": "https://stackoverflow.com/users/6285605/suganya-selvarajan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 632, "favorite_count": 0, "closed_date": 1540988610, "accepted_answer_id": 53082778, "answer_count": 2, "score": 0, "last_activity_date": 1540986936, "creation_date": 1540982771, "last_edit_date": 1540983561, "question_id": 53081529, "link": "https://stackoverflow.com/questions/53081529/rails-and-react-react-createclass-react-createreactclass-is-not-a-function", "closed_reason": "Duplicate", "title": "Rails and React - React.createClass / React.createReactClass is not a function", "body": "<p>I am trying to use React within a Rails application. I am using Rails 5.2.1 and Ruby 2.4.1. I also installed <strong>react-rails</strong> gem version 2.4.4 and also tried in 2.4.7. I have a </p>\n\n<p>sites_controller.rb</p>\n\n<pre><code>class SitesController &lt; ApplicationController\n\n  def index\n  end\nend\n</code></pre>\n\n<p>views/sites/index.html.erb</p>\n\n<pre><code>&lt;%= react_component 'Main' %&gt;\n</code></pre>\n\n<p>app/assets/javascripts/components/_main.js.jsx</p>\n\n<pre><code>var Main = React.createReactClass({\nrender() {\n return (\n      &lt;div&gt;\n        &lt;Header /&gt;\n      &lt;/div&gt;    \n   )\n  }\n})\n</code></pre>\n\n<p>app/assets/javascripts/components/_header.js.jsx</p>\n\n<pre><code>var Header = React.createReactClass({\n render() {\n  return (\n    &lt;div&gt;\n      &lt;h1&gt;Hello, World!&lt;/h1&gt;\n    &lt;/div&gt;\n  );\n}\n</code></pre>\n\n<p>});</p>\n\n<p>I first tried createClass and as it did not work and some links said createClass has been rmoved from React JS v16, I tried createReactClass. I get the following error</p>\n\n<pre><code>  Uncaught TypeError: React.createReactClass is not a function\nat _header.self- \n(anonymous) @ _header.self- \n f50926322cbfc16ac78826d5bfa8a3f192af29cac5125c3955f9bef3355b54d9.js? \n  body=1:1\n_main.self-1ed2e3a6d11c77d50ab4dd84f59f619d3ae85141ee36949c34885bb6b90992c4.js?body=1:1 Uncaught TypeError: React.createClass is not a function\nat _main.self-1ed2e3a6d11c77d50ab4dd84f59f619d3ae85141ee36949c34885bb6b90992c4.js?body=1:1\n(anonymous) @ _main.self-1ed2e3a6d11c77d50ab4dd84f59f619d3ae85141ee36949c34885bb6b90992c4.js?body=1:1\n  react_ujs.self-eb4e9994228856e343ab49d1aed6c23046bf4308ea6d46395e5c39170ab3e56f.js?body=1:313 Uncaught Error: Cannot find component: 'Main'. Make sure your component is available to render.\n    at Object.mountComponents (react_ujs.self-eb4e9994228856e343ab49d1aed6c23046bf4308ea6d46395e5c39170ab3e56f.js?body=1:313)\n    at HTMLDocument.ReactRailsUJS.handleMount (react_ujs.self-eb4e9994228856e343ab49d1aed6c23046bf4308ea6d46395e5c39170ab3e56f.js?body=1:350)\n    at Object.e.dispatch (turbolinks.self-569ee74eaa15c1e2019317ff770b8769b1ec033a0f572a485f64c82ddc8f989e.js?body=1:6)\n    at r.notifyApplicationAfterPageLoad (turbolinks.self-569ee74eaa15c1e2019317ff770b8769b1ec033a0f572a485f64c82ddc8f989e.js?body=1:7)\n    at r.pageLoaded (turbolinks.self-569ee74eaa15c1e2019317ff770b8769b1ec033a0f572a485f64c82ddc8f989e.js?body=1:7)\n    at turbolinks.self-569ee74eaa15c1e2019317ff770b8769b1ec033a0f572a485f64c82ddc8f989e.js?body=1:6\n</code></pre>\n"}, {"tags": ["ruby", "postgresql"], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 3664043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2aec41b6dd465eef7a50ab1a1ceb292d?s=128&d=identicon&r=PG&f=1", "display_name": "PauloMendes", "link": "https://stackoverflow.com/users/3664043/paulomendes"}, "edited": false, "score": 0, "creation_date": 1541787976, "post_id": 53089879, "comment_id": 93349609, "body": "It was a docker problem, all I had to do was run: <b>sudo service restart docker</b> . Then docker-compose up loaded everything just fine."}], "tags": [], "owner": {"reputation": 146, "user_id": 10563676, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Y27jw.png?s=128&g=1", "display_name": "Fe&#241;a Agar", "link": "https://stackoverflow.com/users/10563676/fe%c3%b1a-agar"}, "is_accepted": true, "score": 1, "last_activity_date": 1541010496, "creation_date": 1541010496, "answer_id": 53089879, "question_id": 53081298, "link": "https://stackoverflow.com/questions/53081298/postgres-bad-connection-localhost/53089879#53089879", "title": "postgres bad connection localhost", "body": "<p>Check the logs in your DB, if the DB is running on docker as well then maybe it's not finishing the DB boot correctly. </p>\n\n<p>If this is the case, run the DB container manually first with the same options as in your docker-compose and then check <code>docker logs</code> for that container.</p>\n"}], "owner": {"reputation": 15, "user_id": 3664043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2aec41b6dd465eef7a50ab1a1ceb292d?s=128&d=identicon&r=PG&f=1", "display_name": "PauloMendes", "link": "https://stackoverflow.com/users/3664043/paulomendes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 487, "favorite_count": 0, "accepted_answer_id": 53089879, "answer_count": 1, "score": 1, "last_activity_date": 1541010496, "creation_date": 1540981980, "question_id": 53081298, "link": "https://stackoverflow.com/questions/53081298/postgres-bad-connection-localhost", "title": "postgres bad connection localhost", "body": "<p>On UBUNTU, I have a ruby app with a postgresql database on my localhost.\nEverything was working fine yesterday, but today my database was gone. I was still able to open the app. Then I got an error saying something like, </p>\n\n<p><code>run rails db:migrate</code> </p>\n\n<p>After I ran the command I started getting</p>\n\n<pre><code>PG::ConnectionBad at /\n    server closed the connection unexpectedly\n        This probably means the server terminated abnormally\n        before or while processing the request.\n</code></pre>\n\n<p>None of the config files were changed since yesterday.\nI use docker-compose up to start the server and apparently it starts the connection but I still cannot access my localhost.</p>\n\n<p>What could be the problem here?</p>\n\n<p>Thank you in advance</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "rspec"], "comments": [{"owner": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "edited": false, "score": 0, "creation_date": 1540981401, "post_id": 53080199, "comment_id": 93059306, "body": "not really sure what you mean, that rspec evaluares <code>gift.avalaible_quantity</code> before you create the orders. Isn&#39;t this method evaluated when the endpoint is hit? You don&#39;t show any code where you evaluate this method. Also, side note - you should assign variables to <code>gifts.first</code> and <code>gifts.last</code> and reuse them - it will make the test faster by avoiding repeated db lookups,"}, {"owner": {"reputation": 27, "user_id": 3726231, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8441576a698753bc0fd0cf28fa6d52e?s=128&d=identicon&r=PG&f=1", "display_name": "Ben", "link": "https://stackoverflow.com/users/3726231/ben"}, "reply_to_user": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "edited": false, "score": 0, "creation_date": 1540981596, "post_id": 53080199, "comment_id": 93059421, "body": "Thank&#39;s for the answer.  When i&#39;m debugging, i pass first in &quot;def available_quantity&quot; (i don&#39;t have any order here) and then, i pass in &quot;example_request&quot; (and i have an order)."}], "answers": [{"tags": [], "owner": {"reputation": 111, "user_id": 4275302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b495db33ec776c3e6a7dfd347f80a4ae?s=128&d=identicon&r=PG&f=1", "display_name": "A_rayB", "link": "https://stackoverflow.com/users/4275302/a-rayb"}, "is_accepted": true, "score": 2, "last_activity_date": 1540987988, "last_edit_date": 1540987988, "creation_date": 1540987376, "answer_id": 53082917, "question_id": 53080199, "link": "https://stackoverflow.com/questions/53080199/rspec-flow-isnt-understandable/53082917#53082917", "title": "rspec flow isn&#39;t understandable", "body": "<p>I think the problem is that your order_lines aren't being created before the spec runs.</p>\n\n<p>Use <code>let!</code> to create them instead so they exist when the <code>available_quantity</code> method runs.</p>\n\n<pre><code>let!(:order_lines) { create(:order_line, gift_ean13: gifts.first.ean13, quantity: 1, order_id: order.id) }\nlet!(:order_lines2) { create(:order_line, gift_ean13: gifts.last.ean13, quantity: 2, order_id: order.id) }\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 3726231, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8441576a698753bc0fd0cf28fa6d52e?s=128&d=identicon&r=PG&f=1", "display_name": "Ben", "link": "https://stackoverflow.com/users/3726231/ben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 53082917, "answer_count": 1, "score": 1, "last_activity_date": 1540987988, "creation_date": 1540978279, "question_id": 53080199, "link": "https://stackoverflow.com/questions/53080199/rspec-flow-isnt-understandable", "title": "rspec flow isn&#39;t understandable", "body": "<p>In my acceptance test, i want to test the value of gift.available_quantity wich is  virtual attribute : </p>\n\n<pre><code>  def available_quantity\n    pendings_orders = Order.where(status: 'pending')\n    order_lines_pending = OrderLine.where(order_id: pendings_orders)\n    gift_quantity_pending = order_lines_pending.sum do |oline|\n      return oline.quantity if oline.gift_ean13 == ean13\n    end\n    quantity - gift_quantity_pending\n  end\n</code></pre>\n\n<p>I don't test my code, but it's not the problem :)</p>\n\n<p>The problem is that my rspec evaluate the value of my gift.available_quantity before creating my fake order :</p>\n\n<pre><code>require 'acceptance_helper'\n\nresource 'Gifts' do\n  header 'Accept', 'application/json'\n  header 'Content-Type', 'application/json'\n  header 'Authorization', :authorization\n\n  get '/api/v1/gifts' do\n    let!(:member) { create(:member, id: 1) }\n\n    let(:user) { create(:user, :activated, member: member) }\n    let(:token) { Knock::AuthToken.new(payload: { sub: user.id }).token }\n    let(:authorization) { \"Bearer #{token}\" }\n\n    let!(:delivery_address) { create(:delivery_address, :favorited, member: member) }\n    let!(:gifts) { create_list(:gift, 2, :enabled, quantity: 4) }\n\n    let(:order_lines) { create(:order_line, gift_ean13: gifts.first.ean13, quantity: 1, order_id: order.id) }\n    let(:order_lines2) { create(:order_line, gift_ean13: gifts.last.ean13, quantity: 2, order_id: order.id) }\n\n    let!(:order) { create(:order, member: member, delivery_address: delivery_address) }\n\n\n    example_request 'Get gift list' do\n      expected_response = {\n        gifts: [\n        {\n        id: gifts.first.id,\n        name: gifts.first.name,\n        description: gifts.first.description,\n        reward_price: gifts.first.reward_price,\n        quantity: gifts.first.quantity,\n        date_from: gifts.first.date_from,\n        date_to: gifts.first.date_to,\n        image: nil,\n        quantity_alert: gifts.first.quantity_alert,\n        available_quantity: 3\n      },\n      {\n        id: gifts.last.id,\n        name: gifts.last.name,\n        description: gifts.last.description,\n        reward_price: gifts.last.reward_price,\n        quantity: gifts.last.quantity,\n        date_from: gifts.last.date_from,\n        date_to: gifts.last.date_to,\n        image: nil,\n        quantity_alert: gifts.last.quantity_alert,\n        available_quantity: 2\n      }\n    ]\n  }\n\n      expect(status).to eq(200)\n      expect(response_body).to eq(expected_response.to_json)\n    end\n  end\nend\n</code></pre>\n\n<p>My order isn't created before, so gift.avalaible_quantity isn't good...</p>\n\n<p>Can someone help me understand \"RSpec flow\" ?</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 1, "creation_date": 1540976845, "post_id": 53079207, "comment_id": 93056832, "body": "You could simplify the wording by just asking which elements of the array are unique, unless you want answers to also show how to remove the unique elements from the array (in which case you should make that requirement clear)."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1540977455, "post_id": 53079207, "comment_id": 93057158, "body": "The title and first sentence seem to be in conflict. I presume you want to identify the unique values and remove them, though the latter operation does not seem to be part of the question."}], "answers": [{"comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1540974946, "post_id": 53079208, "comment_id": 93055770, "body": "Hint: <code>.group_by(&amp;:itself)</code>"}], "tags": [], "owner": {"reputation": 1330, "user_id": 3548935, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/ed6d58f6a7e4b80744fd4474f858df79?s=128&d=identicon&r=PG", "display_name": "Aryeh Beitz", "link": "https://stackoverflow.com/users/3548935/aryeh-beitz"}, "is_accepted": false, "score": 0, "last_activity_date": 1540975058, "last_edit_date": 1540975058, "creation_date": 1540974762, "answer_id": 53079208, "question_id": 53079207, "link": "https://stackoverflow.com/questions/53079207/extract-non-unique-values-from-array/53079208#53079208", "title": "Extract non unique values from array", "body": "<p>Given the array above</p>\n\n<pre><code>array_with_doubles = [[1,2], [2,3], [1,2]]\n</code></pre>\n\n<p>Simply run the following to get the array values appearing more than once</p>\n\n<pre><code>array_with_doubles.group_by{|x|x}.map_values(&amp;:size).select {|k,v| v&gt;1}.keys\n# =&gt; [[1,2]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": false, "score": 0, "last_activity_date": 1540977155, "last_edit_date": 1540977155, "creation_date": 1540976053, "answer_id": 53079558, "question_id": 53079207, "link": "https://stackoverflow.com/questions/53079207/extract-non-unique-values-from-array/53079558#53079558", "title": "Extract non unique values from array", "body": "<p>The unique elements can be determined as follows:</p>\n\n<pre><code>arr = [1, 2, 3, 2, 1, 4, 1]\n\nuniq = arr.each_with_object(Hash.new(0)) {|e,h| h[e] += 1}.select {|_,v| v == 1}.keys\n  #=&gt; [3, 4]\n</code></pre>\n\n<p>To remove the unique elements:</p>\n\n<pre><code>arr.reject { |e| uniq.include?(e) }\n  #=&gt; [1, 2, 2, 1, 1]\n</code></pre>\n\n<p>The nature of the objects in the array (numbers, arrays, hashes, instances, etc.) is not relevant to the question.</p>\n\n<p>Determining the unique elements uses the form of <a href=\"http://ruby-doc.org/core-2.5.1/Hash.html#method-c-new\" rel=\"nofollow noreferrer\">Hash::new</a> that takes an argument (here zero), which is the value returned by <code>h[k]</code> if the hash <code>h</code> does not have a key <code>k</code>. Therefore, the expression <code>h[e] += 1</code>, which Ruby expands to</p>\n\n<pre><code>h[e] = h[e] + 1\n</code></pre>\n\n<p>before evaluating it, becomes</p>\n\n<pre><code>h[e] = 0 + 1\n</code></pre>\n\n<p>if <code>h</code> does not have a key <code>k</code>. This is sometimes called a <em>counting hash</em>.</p>\n"}, {"comments": [{"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 1, "creation_date": 1540978728, "post_id": 53079771, "comment_id": 93057845, "body": "This has the disadvantage that it is <code>O(n**2)</code> time complexity, compared to using <code>group_by</code> or a counting hash, which are <code>O(n)</code>. That&#39;s because <code>count</code> is <code>O(n)</code> and it has to be done for each element of the array. You can speed it up a bit by inserted <code>.uniq</code> before <code>.select</code>."}], "tags": [], "owner": {"reputation": 1651, "user_id": 7499455, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-pALqkvJ9LpE/AAAAAAAAAAI/AAAAAAAAATE/gXYryXAigJg/photo.jpg?sz=128", "display_name": "Ashik Salman", "link": "https://stackoverflow.com/users/7499455/ashik-salman"}, "is_accepted": false, "score": 0, "last_activity_date": 1540979264, "last_edit_date": 1540979264, "creation_date": 1540976838, "answer_id": 53079771, "question_id": 53079207, "link": "https://stackoverflow.com/questions/53079207/extract-non-unique-values-from-array/53079771#53079771", "title": "Extract non unique values from array", "body": "<p>You could try this:</p>\n\n<pre><code> array_with_doubles.uniq.select { |x| array_with_doubles.count(x) &gt; 1 }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "is_accepted": false, "score": 0, "last_activity_date": 1540977976, "creation_date": 1540977976, "answer_id": 53080113, "question_id": 53079207, "link": "https://stackoverflow.com/questions/53079207/extract-non-unique-values-from-array/53080113#53080113", "title": "Extract non unique values from array", "body": "<p>You can get all removed elements like this:</p>\n\n<pre><code>array_with_doubles = [[1, 2], [2, 3], [1, 2], [1, 2]]\nrequire 'set'\narray_with_doubles.each_with_object(Set.new).inject([]) { |a, (e, seen)|\n  a &lt;&lt; e if seen === e\n  seen &lt;&lt; e\n  a\n}\n# =&gt; [[1, 2], [1, 2]]\n</code></pre>\n\n<p>Unlike most other answers, if an element would be removed twice by <code>uniq</code>, both copies of it are shown by this code. <code>uniq</code> retains the first equal element, while this code rejects the first equal element.</p>\n"}, {"tags": [], "owner": {"reputation": 5060, "user_id": 10522579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7GQ6a.jpg?s=128&g=1", "display_name": "ray", "link": "https://stackoverflow.com/users/10522579/ray"}, "is_accepted": false, "score": 0, "last_activity_date": 1540981213, "creation_date": 1540981213, "answer_id": 53081083, "question_id": 53079207, "link": "https://stackoverflow.com/questions/53079207/extract-non-unique-values-from-array/53081083#53081083", "title": "Extract non unique values from array", "body": "<p>I have solved above as below,</p>\n\n<pre><code>arr.inject([[],[]]) { |m, a| m[0].include?(a) ? m[1] &lt;&lt; a : m[0] &lt;&lt; a; m }[1]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "edited": false, "score": 0, "creation_date": 1540988312, "post_id": 53081414, "comment_id": 93063030, "body": "Updated after I noticed I duplicated a solution."}], "tags": [], "owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "is_accepted": false, "score": 0, "last_activity_date": 1540988729, "last_edit_date": 1540988729, "creation_date": 1540982368, "answer_id": 53081414, "question_id": 53079207, "link": "https://stackoverflow.com/questions/53079207/extract-non-unique-values-from-array/53081414#53081414", "title": "Extract non unique values from array", "body": "<p>Another option, one liner:</p>\n\n<pre><code>array_with_doubles = [[1, 2], [2, 3], [1, 2], [1, 2], [3, 5], [3, 5]]\n\narray_with_doubles.uniq.each_with_object(array_with_doubles) { |e, a| a.delete_at(a.rindex(e)) }\n# =&gt; [[1, 2], [1, 2], [3, 5]]\n</code></pre>\n"}], "owner": {"reputation": 1330, "user_id": 3548935, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/ed6d58f6a7e4b80744fd4474f858df79?s=128&d=identicon&r=PG", "display_name": "Aryeh Beitz", "link": "https://stackoverflow.com/users/3548935/aryeh-beitz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 98, "favorite_count": 0, "answer_count": 6, "score": 1, "last_activity_date": 1540988729, "creation_date": 1540974762, "last_edit_date": 1540975704, "question_id": 53079207, "link": "https://stackoverflow.com/questions/53079207/extract-non-unique-values-from-array", "title": "Extract non unique values from array", "body": "<p>I can remove unique values from an array:</p>\n\n<pre><code>array_with_doubles = [[1, 2], [2, 3], [1, 2]]\n</code></pre>\n\n<p>using <code>uniq</code>:</p>\n\n<pre><code>array_with_doubles.uniq\n# =&gt; [[1, 2], [2, 3]]\n</code></pre>\n\n<p>I want to find which values were removed.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "solidus"], "comments": [{"owner": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "edited": false, "score": 0, "creation_date": 1540974701, "post_id": 53078912, "comment_id": 93055659, "body": "What do you mean, &quot;garbled&quot;? What version of Ruby? What version of erd? What version of Rails?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user10358924"}, "reply_to_user": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "edited": false, "score": 0, "creation_date": 1540976249, "post_id": 53078912, "comment_id": 93056474, "body": "Ruby 2.5.1. Rails 5.2.1. I use vscode."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10358924"}, "reply_to_user": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "edited": false, "score": 0, "creation_date": 1540976653, "post_id": 53078912, "comment_id": 93056717, "body": "add garbled code."}, {"owner": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "edited": false, "score": 0, "creation_date": 1541003122, "post_id": 53078912, "comment_id": 93072975, "body": "How did you try to view the pdf? It\u2019s a document that you have to view with your operating systems pdf viewer; you can\u2019t render a pdf on the command line. Find the file and double click it to open it."}], "owner": {"user_type": "does_not_exist", "display_name": "user10358924"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1540987181, "creation_date": 1540973452, "last_edit_date": 1540976624, "question_id": 53078912, "link": "https://stackoverflow.com/questions/53078912/my-erd-pdf-was-garbled-i-want-to-solve-this-problem", "title": "My erd.pdf was garbled. I want to solve this problem", "body": "<p>I\u2019m beginner.\nI study Ruby.</p>\n\n<p>I want to see ERD.</p>\n\n<p>So,I did this command.</p>\n\n<pre><code>brew install Graphviz\nbundle exec erd --filename=tmp/erd\n</code></pre>\n\n<p>I was able to display erd.pdf,but it was garbled.</p>\n\n<pre><code>%\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\n4 0 obj\n&lt;&lt; /Length 5 0 R /Filter /FlateDecode &gt;&gt;\nstream\n    x\ufffdZ\ufffdr\ufffd\ufffd\ufffd+\ufffdU\ufffd\ufffdx\ufffd\ufffd\ufffdLe\ufffd\ufffd]\ufffdb\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffdZN&lt;\ufffd\ufffd|K\u03bd.\ufffd&amp;\ufffd\ufffd\ufffdT\ufffdT\ufffd\ufffd&amp;p\u07cf\ufffd~\ufffd\ufffd\ufffd'\ufffd\ufffd\u06fd\ufffd\u06fd6\ufffd\ufffd\ufffdb\ufffd2i\ufffd\ufffdmL\ufffd;\ufffdf\ufffd\ufffdO7\ufffd\ufffd\u01b7.vAw\ufffdk\ufffd\ufffd\ufffd/7\ufffd7\ufffd\ufffd\ufffdu\ufffd\ufffd\ufffdw\ufffd\u03e6u\ufffdy\ufffd\ufffd|}(\ufffdC!~)D\ufffd\ufffdj\ufffd:?\ufffd\ufffd\u0712\ufffdv\ufffd\u0607rO\ufffd/O\ufffd\ufffd\ufffd\ufffd\ufffdTbC\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd_\ufffd_6\ufffdE{\ufffdE\ufffd{Ltk\ufffd\ufffd\ufffdW;\ufffd\u0354vn~\ufffdbe\ufffd\ufffdh\ufffd\ufffd\ufffd:\ufffd\ufffd%&amp;\ufffd\ufffd\ufffdC\ufffd\ufffdt\ufffd\ufffd\u0620\ufffdho&amp;h\ufffdL\u04b9\ufffd&amp;\ufffdV\ufffd]Z\ufffdQ\ufffd1\ufffd\u0377\ufffdP\ufffd\ufffd\ufffd\ufffdw\ufffd,&lt;Jli\ufffd\ufffd\ufffd]aaw\ufffd\ufffdo\ufffd\ufffd&amp;\ufffdq\ufffdv#\ufffd{h\ufffd{1\ufffd(\\\ufffd\ufffdU\ufffdi\ufffd\ufffd-\ufffd\ufffdI\ufffd\ufffd\u0134\ufffd\ufffd\ufffd\ufffd[Y-\n\n\ufffd\ufffdU\ufffd\ufffdF=\ufffd\u0401\ufffdy\ufffd\ufffd`\ufffdQ\ufffd+\ufffd\ufffd\ufffd\ufffd:\ufffd\ufffdB\ufffd=\ufffd\ufffd\ufffd\ufffd\ufffde\ufffdr\ufffd63\ufffd\ufffd\ufffdwe67e6\ufffdw\ufffd\\\ufffd\ufffd\ufffd'\ufffd\ufffd\ufffd8S\ufffd5\ufffd@\ufffd[\ufffd~p\ufffd\u07b5\ufffd\ufffd&lt;s\ufffd4~yy\ufffd\ufffd\ufffd\ufffdNm\ufffd\ufffd\\\ufffd\ufffd\ufffdR\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd&lt;\ufffd\ufffd\ufffdv\ufffd\ufffdt\ufffd\ufffd\ufffd\u073bPt\ufffd?]\ufffd\ufffd\ufffd&lt;\ufffdz&lt;\ufffd]\ufffdJ\ufffd1\ufffd\ufffd!\ufffd(\ufffd\ufffdk\ufffd\ufffdA\ufffd\ufffdK\ufffdBJ\ufffd\ufffd\ufffdn\ufffd\npq\u012c\ufffd\ufffd\ufffdI'\ufffd\ufffd\ufffdx\ufffd\ufffd\ufffd\ufffd.\ufffd]\ufffd\ufffdT\ufffd\ufffd    w\ufffdMq\ufffdr\ufffd\ufffdY,,Y\ufffd\ufffd[\ufffdC\ufffd\ufffd@N?\ufffd H\ufffd\ufffd\ufffd\ufffdR\ufffd\ufffd(z\ufffdv\ufffdG\ufffd#;\ufffd\ufffd\u03bf\ufffd\ufffd\ufffd\ufffdQ\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u07d7[\"\ufffd4\ufffdf\ufffdK\u0143\ufffdz\ufffd\ufffd\ufffd\u0437\ufffd\ufffd{J{U+6]\n\ufffd%\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffdV\ufffd\ufffd\ufffd\ufffd1E\ufffd/r\ufffd\ufffdo\u79ae9\ufffd?\nUp-a\u03b434\ufffd^\ufffd}\ufffd\ufffd)\ufffdu\ufffd\ufffd\ufffdQ?\ufffd]~v\ufffd=[Y\ufffd\ufffd\n*\ufffdUE\ufffd\ufffdME\ufffd(\ufffdy\ufffd\ufffd\ufffd\ufffd9S:\ufffd\ufffd\ufffdj\ufffd}Jf]\ufffd\ufffd\ufffdR+\ufffdhy\ufffd\ufffd\ufffd\ufffd&gt;\ufffd\ufffd\ufffd\ufffd-\ufffd\ufffdc\ufffd\ufffd\ufffd)w)\ufffds\ufffd\ufffdH\ufffd\ufffdP\ufffd_\ufffdib\ufffdx\ufffd}\ufffd\ufffd\ufffd\ufffd\ufffd\ufffde\ufffdZ)`\u0300\ufffdK\ufffd,Z\ufffd\"\ufffdgRX\ufffd\ufffd\ufffd\ufffd\ufffd,|\ufffdw\ufffd}\ufffd^\ufffd\ufffd~\ufffd+\u05714\ufffd\ufffdF\ufffd\ufffd    \ufffd\ufffd\ufffdE\u0579\ufffd?^\ufffdI\ufffd~\ufffd:P\ufffd#\ufffd\ufffd'\u054e\\\ufffd\ufffdp(A4w\ufffdnl\ufffd\ufffd\ufffd\"\ufffdA\ufffd.\\\ufffdnts\ufffdn\ufffdA\nU7\ufffd&amp;%aHpUmeAO\ufffd\ufffd!\ufffd\ufffd\ufffdF\ufffd%\ufffdf\ufffd\ufffdA\ufffd\u4702\ufffd0[Q^o\ufffd\ufffd+\u0185j?\ufffdc\ufffdy\ufffdd\ufffd\u0475\ufffdu*a-\ufffdy \ufffd\ufffd\ufffd\ufffd\ufffdcI\u00b5\ufffd3Wq'\ufffd/\ufffd\ufffd\ufffdr\u02e1\ufffde\ufffdq\ufffd\ufffd!m\ufffdH!$\ufffd\ufffd\ufffd\ufffd\ufffd\ufffdX\ufffd\"#\ufffd\ufffdx\ufffd\ufffd4W\ufffd\ufffd\"\ufffd0Y\ufffd\ufffd\ufffd\ufffd\ufffd[Ia\ufffd\ufffd\ufffd\u04c3~BB C\ufffdL\ufffdR\ufffd0\ufffd[\ufffd\n\\\ufffd\ufffd\u0399d=o\ufffdZ\ufffdWx8\ufffd\ufffd]k\ufffd.U\ufffdd\ufffd\ufffd\u039cpp\ufffd'\ufffd\ufffd&amp;\ufffd\ufffd\ufffdyobg\ufffdf\ufffd\ufffd\ufffd\u0688=A?Z\ufffddb\ufffdm\ufffd\ufffd\ufffd5\ufffd\u0607\ufffd\"\ufffd\ufffd@\ufffd0\ufffd\ufffd\ufffd\ufffd\ufffd5Ym\ufffd1\ufffd&lt;\u053a\ufffdN\ufffd\ufffd\ufffd.H(^MV\ufffd;\u0400j;\ufffd0\u0111\ufffd\ufffd\ufffdc\u07e9G\ufffd\ufffdJ8Zwck\ufffd:\ufffd?\ufffd7\ufffd\ufffdcc\ufffd:/\u06af\ufffd\ufffdz\ufffdk \ufffd\u036d\ufffdvL\ufffdw\ufffdFm\ufffd5#\ufffdn\ufffd\ufffd/1\ufffdx5R\ufffd\ufffd]\ufffdC\ufffdT\ufffdh\ufffdBi\ufffdR\ufffd\ufffdR^U(\ufffd\ufffdh'\ufffd\ufffd$\ufffd\ufffdU\ufffd\ufffdb\ufffd\ufffdHw\ufffda\u0686\ufffd\ufffd\ufffdI\ufffd\ufffd\ufffdFIq\ufffd\ufffd\ufffdCG\ufffd\ufffd4\ufffdDC\ufffdM\ufffdj\ufffd\u0711\ufffd\ufffd:Q\ufffd\ufffds\ufffdj;\ufffdi\\q&lt;\ufffd+IK\ufffd\ufffde-}n\n\\i\ufffd&amp;k\ufffd:'\ufffd#_~B\ufffdzY;\ufffdd&amp;\ufffd\ufffdIyp\u0721\u0161v\ufffdL\ufffd\ufffdw\ufffd\ufffd?\ufffd\ufffd\ufffdMs\ufffd\ufffd0\ufffd\ufffd\ufffdTA\ufffdn\ufffdX\ufffdx\u0309S\ufffd\ufffdn\ufffdzI\ufffd\ufffd\ufffda\ufffd\u0782;y\ufffd\u0711\ufffd\ufffd,|\ufffd\ufffd/\"\ufffdZ\ufffd\ufffd\ufffd\u06f1\ufffd\\Tl]Ux\ufffdk\ufffd\ufffdt\ufffd\ufffdY\ufffd\ufffd\ufffdLK\ufffdq\ufffd*\ufffd}.\ufffd\ufffdy)\u0462Q\ufffd(U\ufffd\ufffdi\u01e9&amp;\ufffd\ufffd\ufffd\ufffd\ufffd0\ufffd2c:\ufffdD\ufffddY\ufffd7\ufffdG\u0759\ufffdV\u0531\ufffdl\ufffd\ufffd\ufffd\"\ufffd\ufffd\ufffdV\ufffdjZ\ufffd]\ufffd\ufffd\ufffdRM#i\ufffd\u06bb5w\ufffd\ufffdHX\ufffd\ufffdu\ufffd\ufffd.P\ufffdn\ufffd\ufffd\ufffd\ufffdGFZ\ufffd?q\ufffd\ufffdY\ufffd\ufffds\ufffd\ufffd\ufffdN\ufffd!\ufffd\ufffdc\ufffdp\ufffd8XLX85\ufffd\ufffd`\\\u2c25\ufffd\ufffd\ufffdX]\ufffd\ufffd5\ufffdS\ufffd\ufffdah\u07ef\ufffdt\ufffd(\ufffd\ufffdek\ufffdj\ufffdz\ufffdH\ufffd9p   E\ufffd]\ufffd\ufffd__-\ufffd\u03a5kU\ufffd\ufffd#v\ufffd\ufffdEv\ufffd\ufffd\ufffd\ufffd\ufffdL\ufffd\ufffdR\ufffdq\ufffd\ufffdVV\ufffd\ufffd\ufffdk\ufffdDHF\ufffd\ufffdg\ufffd)^ .p\ufffd+\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u00e6\ufffd\ufffd&lt;XG\ufffdK\ufffd\ufffd)e\u077dRZp\ufffd\ufffd\ufffd)i;au\ufffd\ufffd4|\u07a2\ufffd\u057a\ufffdC\u01a2.\ufffdW\ufffd\ufffdvG\ufffdx\u0432&lt;s~ap\ufffd\ufffd\ufffdF\ufffd\ufffdH\ufffd\ufffd]\ufffd\ufffd\ufffd\ufffd:)\ufffd\ufffdv\ufffd#\ufffd2\ufffdN\ufffdI\ufffd+]\"*Z\ufffd0\ufffd\ufffd\ufffd\ufffd\ufffd$\ufffdt|n|\ufffd\ufffd\ufffd\ufffd\u0518\ufffd4\ufffd`eD\ufffd\ufffd\ufffd\ufffd\ufffd\ufffdA(\ufffdG\ufffd\ufffds}\ufffd\ufffdX@'\ufffd1Q\ufffd\ufffd'}j9\ufffd#\ufffd\ufffdE\ufffd$\ufffdO9\ufffd\ufffdS\ufffd\ufffd}j\ufffdS2\ufffd6rW\ufffd\ufffd\ufffd\ufffd\ufffdT\u0409\ufffd$\ufffd\ufffdv\ufffd\ufffdhA&gt;#\ufffd m\ufffd\ufffd\ufffdC\ufffd[\ufffd\ufffdQku\ufffdY\ufffd\ufffd\ufffd\ufffdC\ufffdu,\ufffd\u05b5:\ufffds\ufffd\ufffd$\ufffd\\i\ufffdS\ufffd\ufffd\u06ae\ufffdN\ufffd\ufffd\ufffdZ\ufffd\ufffdTmm\ufffdC\ufffdP\ufffd\ufffdE\ufffd\u0486\ufffd\u03c0o\ufffdx@E\ufffd`t\ufffdZ\ufffd\ufffd  \ufffdc%\ufffd\ufffd\ufffd\ufffd\ufffd\"o|\ufffd \"$\u0417=\ufffdS\ufffd\ufffd@\ufffd@G\ufffd\ufffd:(!D@&lt;\n</code></pre>\n\n<p>I want to solve this problem.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "hash"], "comments": [{"owner": {"reputation": 48413, "user_id": 1279683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1veuT.jpg?s=128&g=1", "display_name": "Marek Lipka", "link": "https://stackoverflow.com/users/1279683/marek-lipka"}, "edited": false, "score": 3, "creation_date": 1540972466, "post_id": 53078626, "comment_id": 93054673, "body": "You have to write a piece of your own logic to handle this."}, {"owner": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 1, "creation_date": 1540973172, "post_id": 53078626, "comment_id": 93054990, "body": "Can you give an example for 3-level nesting? Will it be <code>&#39;key1[key2][key3]&#39;</code> or <code>&#39;key1[key2[key3]]&#39;</code>?"}, {"owner": {"reputation": 920, "user_id": 3512189, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/hXdNN.jpg?s=128&g=1", "display_name": "wasipeer", "link": "https://stackoverflow.com/users/3512189/wasipeer"}, "edited": false, "score": 0, "creation_date": 1540977852, "post_id": 53078626, "comment_id": 93057348, "body": "key1[key2][key3]"}], "answers": [{"tags": [], "owner": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "is_accepted": false, "score": 0, "last_activity_date": 1540973092, "creation_date": 1540973092, "answer_id": 53078837, "question_id": 53078626, "link": "https://stackoverflow.com/questions/53078626/get-nested-values-from-a-hash-using-single-string/53078837#53078837", "title": "Get nested values from a hash using single string", "body": "<p>To answer your specific question, <strong>No</strong>, there is no way (to my knowledge) to get the value from hash directly by passing your input string.</p>\n\n<p>You will have to write your own logic to extract the keys from string and then fetch the value.</p>\n"}, {"tags": [], "owner": {"reputation": 33085, "user_id": 2423164, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Nxbnp.jpg?s=128&g=1", "display_name": "ndnenkov", "link": "https://stackoverflow.com/users/2423164/ndnenkov"}, "is_accepted": false, "score": 3, "last_activity_date": 1540975378, "creation_date": 1540975378, "answer_id": 53079378, "question_id": 53078626, "link": "https://stackoverflow.com/questions/53078626/get-nested-values-from-a-hash-using-single-string/53079378#53079378", "title": "Get nested values from a hash using single string", "body": "<pre><code>hash.dig(*keys.delete(']').split('[').map(&amp;:to_sym))\n</code></pre>\n"}], "owner": {"reputation": 920, "user_id": 3512189, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/hXdNN.jpg?s=128&g=1", "display_name": "wasipeer", "link": "https://stackoverflow.com/users/3512189/wasipeer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1540976051, "creation_date": 1540972289, "last_edit_date": 1540976051, "question_id": 53078626, "link": "https://stackoverflow.com/questions/53078626/get-nested-values-from-a-hash-using-single-string", "title": "Get nested values from a hash using single string", "body": "<p>I have a string that represents a sequence of keys in a nested hash in the following format:</p>\n\n<pre><code>keys = 'key1[key2]'\n</code></pre>\n\n<p>and a nested hash that has the corresponding keys like the following:</p>\n\n<pre><code>hash = {key1: {key2: 'value'}}\n</code></pre>\n\n<p>Is there any way to get the value from this hash directly as in the following?</p>\n\n<pre><code>value = hash[keys]\n</code></pre>\n\n<p>Or, do I have to write my own logic?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "activerecord"], "answers": [{"tags": [], "owner": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "is_accepted": true, "score": 2, "last_activity_date": 1540974242, "last_edit_date": 1592644375, "creation_date": 1540974242, "answer_id": 53079076, "question_id": 53078547, "link": "https://stackoverflow.com/questions/53078547/performance-multiple-association-call-on-object/53079076#53079076", "title": "Performance - Multiple association call on object", "body": "<p>Rails automatically caches the result of database calls. From the <a href=\"https://edgeguides.rubyonrails.org/caching_with_rails.html#sql-caching\" rel=\"nofollow noreferrer\">Rails Guides</a>:</p>\n<blockquote>\n<p>Query caching is a Rails feature that caches the result set returned by each query. If Rails encounters the same query again for that request, it will use the cached result set as opposed to running the query against the database again.</p>\n<p>For example:</p>\n</blockquote>\n<pre><code>class ProductsController &lt; ApplicationController\n\n  def index\n    # Run a find query\n    @products = Product.all\n\n    ...\n\n    # Run the same query again\n    @products = Product.all\n  end\n\nend\n</code></pre>\n<blockquote>\n<p>The second time the same query is run against the database, it's not actually going to hit the database. The first time the result is returned from the query it is stored in the query cache (in memory) and the second time it's pulled from memory.</p>\n<p>However, it's important to note that query caches are created at the start of an action and destroyed at the end of that action and thus persist only for the duration of the action. If you'd like to store query results in a more persistent fashion, you can with low level caching.</p>\n</blockquote>\n<p>My recommendation is not to assign it to a variable because it does nothing to improve the readability of the code and the performance difference is negligible. It could introduce confusion; if I were reading the code and saw someone replaced all calls to <code>documents</code> with <code>docs</code> I would wonder why and would have to take time to understand why.</p>\n<p>Ultimately, setting <code>docs = self.documents</code> just tells Ruby &quot;<code>docs</code> should point at the same memory location as <code>self.documents</code>&quot;, and regardless of which one you call Ruby will return the same data from the same memory location. There is <a href=\"https://stackoverflow.com/a/27898582/3784008\">a performance difference</a> between calling a method and calling a variable, but that performance difference is so minor in comparison to something like the speed of a database call that it can be ignored; there are much better ways to improve the performance of an app than switching method calls to variable calls.</p>\n<p>If your concern is that you don't want to type out <code>documents</code> over and over again when you could just type <code>docs</code>, then use <code>alias_method</code>:</p>\n<pre><code>class User &lt; ApplicationRecord\n  has_many :documents\n  alias_method :docs, :documents\nend\n</code></pre>\n<p>Then there is no difference between calling <code>user.documents</code> and <code>user.docs</code> -- they call the same method. But again, does it do anything to improve readability of the code? In my opinion, no.</p>\n<p>Stick with calling <code>documents</code>.</p>\n"}], "owner": {"reputation": 5060, "user_id": 10522579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7GQ6a.jpg?s=128&g=1", "display_name": "ray", "link": "https://stackoverflow.com/users/10522579/ray"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "accepted_answer_id": 53079076, "answer_count": 1, "score": 0, "last_activity_date": 1540974242, "creation_date": 1540971964, "question_id": 53078547, "link": "https://stackoverflow.com/questions/53078547/performance-multiple-association-call-on-object", "title": "Performance - Multiple association call on object", "body": "<p>I have a method called on <code>user</code> object which has many <code>documents</code> (associated).</p>\n\n<p>Inside method I had to call <code>documents</code> many places where caller is <code>self</code> by default.</p>\n\n<p>So I was wondering whether it will call documents for user so many times, and thought that I will call once and refer by docs, <code>docs = self.documents</code>  or <code>docs = documents</code> and I will use this reference wherever user's documents are needed &amp; thus we can avoid <em>calling association method documents on user object</em></p>\n\n<p>But does it really call again and again or just cache it for first time when it gets called?</p>\n\n<p>I checked in console, When I call user.documents, it loaded documents (db call) but later for same call It was not loading.</p>\n\n<p>Suggest how it works. Is it good to use reference variable for first call and use it further ? </p>\n"}, {"tags": ["javascript", "ruby-on-rails", "ruby", "stripe-payments"], "answers": [{"comments": [{"owner": {"reputation": 1263, "user_id": 10221813, "user_type": "registered", "profile_image": "https://graph.facebook.com/10160530708235447/picture?type=large", "display_name": "uno", "link": "https://stackoverflow.com/users/10221813/uno"}, "edited": false, "score": 0, "creation_date": 1541023125, "post_id": 53078287, "comment_id": 93081785, "body": "the window.onload = function () { .... } didn&#39;t do it... it works separately when i dont have it embeded within the @orders form_for... that&#39;s (when i added the stripe code into the order controller) when the issues start happening."}, {"owner": {"reputation": 1263, "user_id": 10221813, "user_type": "registered", "profile_image": "https://graph.facebook.com/10160530708235447/picture?type=large", "display_name": "uno", "link": "https://stackoverflow.com/users/10221813/uno"}, "edited": false, "score": 0, "creation_date": 1541030570, "post_id": 53078287, "comment_id": 93083767, "body": "all of it works somewhat properly.. the token is sent to stripe and the order is created.  ideally i would want the order to be created only if the stripe payment is successful but first and foremost, i need to figure out why i&#39;m even sending the token payment to stripe if the credit card field isn&#39;t filled out"}], "tags": [], "owner": {"reputation": 1107, "user_id": 5487345, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/TIjQP.jpg?s=128&g=1", "display_name": "maxadorable", "link": "https://stackoverflow.com/users/5487345/maxadorable"}, "is_accepted": false, "score": 0, "last_activity_date": 1540970808, "creation_date": 1540970808, "answer_id": 53078287, "question_id": 53077990, "link": "https://stackoverflow.com/questions/53077990/how-to-require-the-credit-card-field-in-stripe-elements-fields/53078287#53078287", "title": "How to require the credit card field in Stripe Elements fields?", "body": "<p>I can see that you are using <a href=\"https://stripe.com/docs/stripe-js\" rel=\"nofollow noreferrer\">https://stripe.com/docs/stripe-js</a> template</p>\n\n<p>Try adding <code>window.onload = function () {\n var stripe = Stripe('pk_test_413253....f0B8');\n.............................................. // UR CODE\n}</code></p>\n\n<p>You can see in the docs example it should alert if the user submits a card blank. You can't verify it in the backend as stripe.js in the frontend creates a credit card token for you to use as security</p>\n"}, {"comments": [{"owner": {"reputation": 1263, "user_id": 10221813, "user_type": "registered", "profile_image": "https://graph.facebook.com/10160530708235447/picture?type=large", "display_name": "uno", "link": "https://stackoverflow.com/users/10221813/uno"}, "edited": false, "score": 0, "creation_date": 1541023256, "post_id": 53080271, "comment_id": 93081818, "body": "the issue i think it mostly in the controller or similar.  because on stripes side, it works... but i dont need to fill out or complete the credit card information to input the order.. even when i use the &quot;&lt;button id=&quot;button-element&quot; ... &gt;&quot; as the input"}], "tags": [], "owner": {"reputation": 666, "user_id": 1270929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6136fe60f32b1057c392250f3f17b620?s=128&d=identicon&r=PG", "display_name": "wsw", "link": "https://stackoverflow.com/users/1270929/wsw"}, "is_accepted": false, "score": 1, "last_activity_date": 1540978492, "creation_date": 1540978492, "answer_id": 53080271, "question_id": 53077990, "link": "https://stackoverflow.com/questions/53077990/how-to-require-the-credit-card-field-in-stripe-elements-fields/53080271#53080271", "title": "How to require the credit card field in Stripe Elements fields?", "body": "<p>As @Auriga has pointed out, credit card validation is done by stripe during the tokenization process. </p>\n\n<p>However, Stripe Element does provide a way for you verify the fields and give more meaningful feedback to your frontend user. </p>\n\n<p><a href=\"https://stripe.com/docs/stripe-js/reference#input-validation\" rel=\"nofollow noreferrer\">https://stripe.com/docs/stripe-js/reference#input-validation</a></p>\n"}], "owner": {"reputation": 1263, "user_id": 10221813, "user_type": "registered", "profile_image": "https://graph.facebook.com/10160530708235447/picture?type=large", "display_name": "uno", "link": "https://stackoverflow.com/users/10221813/uno"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2187, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1593436019, "creation_date": 1540969585, "last_edit_date": 1540974939, "question_id": 53077990, "link": "https://stackoverflow.com/questions/53077990/how-to-require-the-credit-card-field-in-stripe-elements-fields", "title": "How to require the credit card field in Stripe Elements fields?", "body": "<p>My issue is that I have a form that submits with the credit card field being blank.</p>\n\n<p>I have the credit card field combined with another form which is where the issue lies.  </p>\n\n<p>So my question is, how do I require the credit card field using JS or Ruby?</p>\n\n<p>Here's the form and javascript:</p>\n\n<pre><code>&lt;%= form_for([@listing, @order], html: {id: \"Orders\"}) do |form| %&gt;\n  &lt;div class=\"form-group\"&gt;\n    &lt;%= form.label :name, \"Who's the Order for?\" %&gt;\n    &lt;%= form.text_field :name, class: \"form-control\", required: true  %&gt;\n  &lt;/div&gt;\n\n  &lt;script\n    src=\"https://js.stripe.com/v3/\"&gt;\n  &lt;/script&gt;\n\n    &lt;div class=\"form-row\"&gt;\n      &lt;label for=\"card-element\"&gt;\n        Credit or debit card\n      &lt;/label&gt;\n      &lt;div id=\"card-element\" class=\"form-control\"&gt;\n      &lt;/div&gt;\n\n      &lt;div id=\"card-errors\" role=\"alert\"&gt;&lt;/div&gt;\n    &lt;/div&gt;\n      &lt;br&gt;\n      &lt;div class=\"form-group\"&gt;\n\n    &lt;%= form.submit \"asdf\", class:\"ripple-effect\", id:\"button-element\" %&gt;\n    &lt;!-- &lt;button id=\"button-element\" class=\"ripple-effect\"&gt;Submit Payment for &lt;/button&gt; EITHER OF THESE BUTTONS WORK WITH THE FORM--&gt;\n  &lt;/div&gt;\n  &lt;span class=\"token\"&gt;&lt;/span&gt;\n  &lt;/form&gt;\n  &lt;% end %&gt;\n\n&lt;script&gt;\n  var stripe = Stripe('pk_test_413253....f0B8');\n\n  var elements = stripe.elements();\n\n  var style = {\n    base: {\n      color: '#32325d',\n      lineHeight: '24px',\n      fontFamily: '\"Helvetica Neue\", Helvetica, sans-serif',\n      fontSmoothing: 'antialiased',\n      fontSize: '16px',\n      '::placeholder': {\n        color: '#aab7c4'\n      }\n    },\n    invalid: {\n      color: '#fa755a',\n      iconColor: '#fa755a'\n    }\n  };\n\n  var card = elements.create('card', {style: style});\n\n  card.mount('#card-element');\n\n  card.addEventListener('change', function(event) {\n    var displayError = document.getElementById('card-errors');\n    if (event.error) {\n      displayError.textContent = event.error.message;\n    } else {\n      displayError.textContent = '';\n    }\n  });\n\n  var form = document.getElementById('payment_form');\n  form.addEventListener('submit', function(event) {\n    event.preventDefault();\n\n    stripe.createToken(card).then(function(result) {\n      if (result.error) {\n        // Inform the user if there was an error\n        var errorElement = document.getElementById('card-errors');\n        errorElement.textContent = result.error.message;\n      } else {\n        // Send the token to your server\n        stripeTokenHandler(result.token);\n      }\n    });\n\n    });\n\n    function stripeTokenHandler(token) {\n\n      var form = document.getElementById('payment_form');\n      var hiddenInput = document.createElement('input');\n      hiddenInput.setAttribute('type', 'hidden');\n      hiddenInput.setAttribute('name', 'stripeToken');\n      hiddenInput.setAttribute('value', token.id);\n      form.appendChild(hiddenInput);\n\n\n      [\"brand\", \"exp_month\", \"exp_year\", \"last4\"].forEach(function(field) {\n         addFieldToForm(form, token, field);\n\n    });\n\n      // Submit the form\n      form.submit();\n\n    }\n&lt;/script&gt;\n</code></pre>\n\n<p>Here's the orders controller create method, which is now a bit messy:</p>\n\n<pre><code>def create\n    @order = Order.new(order_params)\n    @listing = Listing.find(params[:listing_id])\n    @seller = @listing.user\n\n    @order.listing_id = @listing.id\n    @order.buyer_id = current_user.id\n    @order.seller_id = @seller.id\n\n    if @order.valid?\n      begin\n        @amount = 500\n        token = params[:stripeToken]\n        payment_form = params[:payment_form]\n\n        charge = Stripe::Charge.create({\n          :source  =&gt; 'tok_visa',\n          :amount      =&gt; @amount,\n          :description =&gt; 'Rails Stripe customer',\n          :currency    =&gt; 'usd'\n        })\n\n      rescue Stripe::CardError =&gt; e\n        flash[:error] = e.message\n        redirect_to new_charge_path\n      end\n    end\n\n    respond_to do |format|\n      if @order.save\n        if user_signed_in?\n          @user = current_user\n          OrderMailer.order_email(@user, @order).deliver\n          format.html { redirect_to @order, notice: 'Order was successfully created.' }\n          format.json { render :show, status: :created, location: @order }\n          else\n            format.html { render :new }\n            format.json { render json: @order.errors, status: :unprocessable_entity }\n          end\n          if buyer_signed_in?\n            @user = current_buyer\n            OrderMailer.order_email(@user, @order).deliver\n            format.html { redirect_to @listing, notice: 'Order was successfully created.' }\n            format.json { render :show, status: :created, location: @order }\n          else\n            format.html { render :new }\n            format.json { render json: @order.errors, status: :unprocessable_entity }\n          end\n        end\n      end\n    end\n\n\n  def update\n    respond_to do |format|\n      if @order.update(order_params)\n        if user_signed_in?\n          format.html { redirect_to @order, notice: 'Order was successfully uploaded.' }\n          format.json { render :show, status: :ok, location: @order }\n        else\n          format.html { render :edit }\n          format.json { render json: @order.errors, status: :unprocessable_entity }\n        end\n        if buyer_signed_in?\n          format.html { redirect_to @order, notice: 'Order was successfully updated.' }\n          format.json { render :show, status: :ok, location: @order }\n        else\n          format.html { render :edit }\n          format.json { render json: @order.errors, status: :unprocessable_entity }\n        end\n      end\n    end\n  end\n\n  def destroy\n    @order.destroy\n    respond_to do |format|\n      format.html { redirect_to orders_url, notice: 'Order was successfully destroyed.' }\n      format.json { head :no_content }\n    end\n  end\n\n  private\n    # Use callbacks to share common setup or constraints between actions.\n    def set_order\n      @order = Order.find(params[:id])\n    end\n\n    def order_params\n      params.require(:order).permit(:name, :address, :city, :state, :image, :video, :description, :order_status)\n    end\n\n    def deny_to_visitors\n      redirect_to root_path unless user_signed_in? or buyer_signed_in?\n    end\n\n    def user_orders\n      @order.buyer_id = current_buyer.id or current_user\n    end\n\nend\n</code></pre>\n\n<p>When I press submit, both the Order gets created and the API request is successful.  How can I require the credit card field to be validated with either ruby or javascript?</p>\n"}, {"tags": ["arrays", "ruby"], "comments": [{"owner": {"reputation": 5449, "user_id": 681520, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/701baebf68d1d7faa9f9def6a24fe356?s=128&d=identicon&r=PG", "display_name": "Kimmo Lehto", "link": "https://stackoverflow.com/users/681520/kimmo-lehto"}, "edited": false, "score": 0, "creation_date": 1540970670, "post_id": 53075637, "comment_id": 93053891, "body": "<code>num_array.count(x...y)</code> counts the number of <code>(x...y)</code>&#39;s (instances of <code>Range.new(x,y, true)</code>) there are in the array."}], "answers": [{"comments": [{"owner": {"reputation": 2496, "user_id": 3046905, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/692eb06201cbed91c3c6a9cf11ed0511?s=128&d=identicon&r=PG", "display_name": "Ilya Konyukhov", "link": "https://stackoverflow.com/users/3046905/ilya-konyukhov"}, "edited": false, "score": 0, "creation_date": 1540958264, "post_id": 53075718, "comment_id": 93050032, "body": "Nice use of <code>between?</code>, but I&#39;d simplify it to <code>num_array.count { |el| el &gt;= x &amp;&amp; el &lt;= y }</code>"}], "tags": [], "owner": {"reputation": 4866, "user_id": 6603195, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nZGPkfcc0EE/AAAAAAAAAAI/AAAAAAAAAoE/op-TBiFRNzg/photo.jpg?sz=128", "display_name": "Marcin Ko\u0142odziej", "link": "https://stackoverflow.com/users/6603195/marcin-ko%c5%82odziej"}, "is_accepted": false, "score": 4, "last_activity_date": 1540955341, "creation_date": 1540955341, "answer_id": 53075718, "question_id": 53075637, "link": "https://stackoverflow.com/questions/53075637/count-how-many-times-a-value-between-x-and-y-is-present-in-an-array/53075718#53075718", "title": "Count how many times a value between x and y is present in an array", "body": "<p><a href=\"https://ruby-doc.org/core-2.5.1/Array.html#method-i-count\" rel=\"nofollow noreferrer\">Array#count</a> with an argument and without a block checks whether the argument and the current element are equal. You'll need to pass a block and do some comparison, you may use <a href=\"https://ruby-doc.org/core-2.5.0/Comparable.html#method-i-between-3F\" rel=\"nofollow noreferrer\">Comparable#between?</a>, like this:</p>\n\n<pre><code>num_array.count { |el| el.between?(x,y) }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "is_accepted": false, "score": 1, "last_activity_date": 1540982359, "last_edit_date": 1540982359, "creation_date": 1540957626, "answer_id": 53075988, "question_id": 53075637, "link": "https://stackoverflow.com/questions/53075637/count-how-many-times-a-value-between-x-and-y-is-present-in-an-array/53075988#53075988", "title": "Count how many times a value between x and y is present in an array", "body": "<p>You can use <code>group_by</code> and group the values on the array according to (n / 10) * 10 which gives you the corresponding ten, e.g:</p>\n\n<blockquote>\n  <p>(83 / 10) * 10 = 80</p>\n</blockquote>\n\n<pre><code>p Array.new(200) { rand(1..100) }.group_by { |i| (i / 10) * 10 }\n{ 70=&gt;[73, 77, 79, 70, 72, 78, 72, 75, 74, 71, 79, 70, 75, 78, 76, 70, 77, 76, 76, 70],\n  80=&gt;[81, 85, 81, 86, 88, 87, 85, 86, 80, 80, 82, 88, 89, 87, 87, 89, 86, 84, 82],\n  60=&gt;[68, 60, 64, 63, 64, 66, 69, 68, 66, 68, 67, 69, 61, 69, 62, 61, 66, 67, 69, 64, 65, 66, 68, 68, 60, 64, 69],\n  30=&gt;[31, 39, 39, 37, 32, 35, 31, 39, 30, 39, 33, 31, 36, 38, 30, 30, 36, 32, 39, 32, 31],\n  20=&gt;[22, 27, 24, 27, 25, 20, 23, 25, 27, 23, 24, 26, 27, 25, 25, 28, 20],\n  40=&gt;[42, 44, 47, 43, 45, 45, 41, 48, 41, 42, 45, 46, 45, 48, 47, 46, 45],\n  90=&gt;[92, 97, 92, 94, 94, 95, 93, 98, 93, 94, 94, 92, 96, 94, 91, 95, 94, 93, 99, 92, 99, 96, 91, 97, 99, 96, 94, 99],\n  10=&gt;[17, 13, 16, 18, 13, 19, 14, 16, 14, 12, 10, 15, 13, 16, 14, 13],\n  50=&gt;[58, 50, 54, 58, 57, 52, 53, 53, 56, 57, 50, 52, 55],\n  0=&gt;[4, 3, 7, 4, 2, 5, 9, 1, 4, 7, 8, 7, 3, 7, 9, 6, 6, 9, 6],\n  100=&gt;[100, 100, 100] }\n</code></pre>\n\n<p>Applying transform_values, it gets the total of elements per array for each element in the hash:</p>\n\n<pre><code>p Array.new(200) { rand(1..100) }.group_by { |i| (i / 10) * 10 }.transform_values(&amp;:count)  \n#\u00a0{70=&gt;20, 80=&gt;19, 60=&gt;27, 30=&gt;21, 20=&gt;17, 40=&gt;17, 90=&gt;28, 10=&gt;16, 50=&gt;13, 0=&gt;19, 100=&gt;3} \n</code></pre>\n\n<p>Note 0 is the key for the numbers between 1 and 10 (exclusive).</p>\n"}, {"tags": [], "owner": {"reputation": 5060, "user_id": 10522579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7GQ6a.jpg?s=128&g=1", "display_name": "ray", "link": "https://stackoverflow.com/users/10522579/ray"}, "is_accepted": false, "score": 1, "last_activity_date": 1540963032, "creation_date": 1540963032, "answer_id": 53076748, "question_id": 53075637, "link": "https://stackoverflow.com/questions/53075637/count-how-many-times-a-value-between-x-and-y-is-present-in-an-array/53076748#53076748", "title": "Count how many times a value between x and y is present in an array", "body": "<p><strong>Additional:</strong> You can also get which elements which are in between x &amp; y and how many times those are repeated,</p>\n\n<pre><code>arr = num_array.group_by(&amp;:itself).inject({}) { |m, (k,v)| m[k] = v.count if k.between?(x,y); m }\n=&gt; {5=&gt;2, 6=&gt;3, 8=&gt;3, 2=&gt;3, 10=&gt;2, 7=&gt;1, 4=&gt;2, 9=&gt;1}\n\narr.count\n=&gt; 8 \n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 10583554, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19a7b36a831eb2f370ea48f9ab2c9112?s=128&d=identicon&r=PG&f=1", "display_name": "Tobyrrr00", "link": "https://stackoverflow.com/users/10583554/tobyrrr00"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1540982359, "creation_date": 1540954718, "last_edit_date": 1540975490, "question_id": 53075637, "link": "https://stackoverflow.com/questions/53075637/count-how-many-times-a-value-between-x-and-y-is-present-in-an-array", "title": "Count how many times a value between x and y is present in an array", "body": "<p>I have an array of 200 random numbers between 1 and 100 and need to find how many numbers between x and y are in the array. The ranges are between 1-10, 11-20, 21-30, and so on.</p>\n\n<p>I have something like this</p>\n\n<pre><code>num_array = Array.new\n200.times do\n   num_array.push(rand(1...100))\nend\nprint num_array\nx = 1\ny = 10\n9.times do\n  print num_array.count(x...y)   #&lt;==\n  x += 10\n  y += 10\nend\n</code></pre>\n\n<p>I want line 9 (the one that the arrow points to) to tell how many times numbers between x and y appear in the array. I know how to do it with more code, but I really want to do it with just this one or two lines.</p>\n"}, {"tags": ["ruby", "selenium", "docker", "watir"], "answers": [{"comments": [{"owner": {"reputation": 215, "user_id": 7222354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f492af8a144101e721d017576c461390?s=128&d=identicon&r=PG&f=1", "display_name": "Chong", "link": "https://stackoverflow.com/users/7222354/chong"}, "edited": false, "score": 0, "creation_date": 1541098281, "post_id": 53104227, "comment_id": 93110453, "body": "I have tried to use the Option. That&#39;s one of the solutions that I have found online, actually. And it just doesn&#39;t work, as well.."}, {"owner": {"reputation": 215, "user_id": 7222354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f492af8a144101e721d017576c461390?s=128&d=identicon&r=PG&f=1", "display_name": "Chong", "link": "https://stackoverflow.com/users/7222354/chong"}, "edited": false, "score": 0, "creation_date": 1541098524, "post_id": 53104227, "comment_id": 93110548, "body": "That implementation is (which seems to exactly the same as yours..):  options = Selenium::WebDriver::Chrome::Options.new download_setting = {             prompt_for_download: false,             default_directory: &quot;/hosttmp/#{download_location}&quot;           } options.add_preference(download: download_setting) Watir::Browser.new(:chrome, url: selenium_hub_url, options: options)"}], "tags": [], "owner": {"reputation": 1113, "user_id": 1250190, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/42209a6704f712d1eadbc28a4f024c9e?s=128&d=identicon&r=PG", "display_name": "pjd", "link": "https://stackoverflow.com/users/1250190/pjd"}, "is_accepted": false, "score": 1, "last_activity_date": 1555333393, "last_edit_date": 1555333393, "creation_date": 1541085643, "answer_id": 53104227, "question_id": 53075365, "link": "https://stackoverflow.com/questions/53075365/not-able-to-change-default-download-directory-for-chrome-with-selenium-hub-docke/53104227#53104227", "title": "Not able to change default download directory for chrome with selenium hub docker and ruby watir", "body": "<p>Did you define <code>options = Selenium::WebDriver::Chrome::Options.new</code>?</p>\n\n<p>We use</p>\n\n<pre><code>options = Selenium::WebDriver::Chrome::Options.new\nprefs = {\n  prompt_for_download: false,\n  default_directory: download_directory\n}\noptions.add_preference(download: prefs)\n</code></pre>\n\n<p>and then you would want something like</p>\n\n<p><code>browser = Watir::Browser.new(:chrome, url: selenium_hub_url, options: options)</code></p>\n\n<p>But maybe the main problem is just that you are using\n<code>options: {prefs: prefs}</code>\ninstead of\n<code>options: {download: prefs}</code></p>\n"}, {"tags": [], "owner": {"reputation": 215, "user_id": 7222354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f492af8a144101e721d017576c461390?s=128&d=identicon&r=PG&f=1", "display_name": "Chong", "link": "https://stackoverflow.com/users/7222354/chong"}, "is_accepted": true, "score": 0, "last_activity_date": 1541196922, "creation_date": 1541196922, "answer_id": 53126440, "question_id": 53075365, "link": "https://stackoverflow.com/questions/53075365/not-able-to-change-default-download-directory-for-chrome-with-selenium-hub-docke/53126440#53126440", "title": "Not able to change default download directory for chrome with selenium hub docker and ruby watir", "body": "<p>Okay, by digging into the source code of the Watir and Selenium-Webdriver, I think I know the 'root cause'.</p>\n\n<p>I have created an issue since I am not sure if this is a bug or a 'feature' <a href=\"https://github.com/watir/watir/issues/812\" rel=\"nofollow noreferrer\">The issue</a></p>\n\n<p>Also, I have a workaround for my case, in watir/capabilities.rb:</p>\n\n<p>Change </p>\n\n<pre><code>@selenium_browser = browser == :remote || options[:url] ? :remote : browser\n</code></pre>\n\n<p>to</p>\n\n<pre><code>@selenium_browser = browser == :remote ? :remote : browser\n</code></pre>\n\n<p>This shouldn't be the final solution as it might not be a good idea. Will wait for what the Watir people say about this. </p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 10308254, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68bb9e308223035a06a49078b50353d2?s=128&d=identicon&r=PG&f=1", "display_name": "Jing Li", "link": "https://stackoverflow.com/users/10308254/jing-li"}, "is_accepted": false, "score": 0, "last_activity_date": 1542956931, "creation_date": 1542956931, "answer_id": 53442078, "question_id": 53075365, "link": "https://stackoverflow.com/questions/53075365/not-able-to-change-default-download-directory-for-chrome-with-selenium-hub-docke/53442078#53442078", "title": "Not able to change default download directory for chrome with selenium hub docker and ruby watir", "body": "<p>I'm using Java+Docker+Selenium+Chrome for automation test and also met similar issue with you. Please find my solutions below and try if it works for your case.</p>\n\n<ol>\n<li>Don't set default download directory in the options, just leave \"/home/seluser/Downloads\" as it is.</li>\n<li>When you start up the chrome node on docker, please add the parameter of volume that could transfer the downloaded files to the directory you want.</li>\n</ol>\n\n<p>e.g. docker run -d -p 5900:5900 --link myhub:hub -v :/home/seluser/Downloads selenium/node-chrome-debug:3.14.0</p>\n\n<p>In my case, the JDK environment and my test script is on Linux machine while the selenium webdriver &amp; browser are all on docker, so once the file downloaded by browser it cannot saved directly on Linux machine, you have to mount the local directory with default directory on docker. Then you could find the file saved in the directory you want. \nThanks &amp; Regards!\nJing</p>\n"}], "owner": {"reputation": 215, "user_id": 7222354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f492af8a144101e721d017576c461390?s=128&d=identicon&r=PG&f=1", "display_name": "Chong", "link": "https://stackoverflow.com/users/7222354/chong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1364, "favorite_count": 0, "accepted_answer_id": 53126440, "answer_count": 3, "score": 1, "last_activity_date": 1555333393, "creation_date": 1540952343, "question_id": 53075365, "link": "https://stackoverflow.com/questions/53075365/not-able-to-change-default-download-directory-for-chrome-with-selenium-hub-docke", "title": "Not able to change default download directory for chrome with selenium hub docker and ruby watir", "body": "<p>After a few days of searching and experimenting with any of the solutions I could find online, I give up and want to get some help from the community.</p>\n\n<p>Ruby gems (ruby 2.5.1):</p>\n\n<pre><code>watir 6.11.0\nselenium-webdriver 3.4.1\n</code></pre>\n\n<p>Docker:</p>\n\n<pre><code>selenium/node-chrome-debug:3.14\nselenium/hub:3.14\n</code></pre>\n\n<p>My ruby code:</p>\n\n<pre><code>prefs = {\n    download: {\n        prompt_for_download: false,\n        default_directory: download_directory\n    }\n}\nbrowser = Watir::Browser.new(:chrome, url: selenium_hub_url, options: {prefs: prefs})\n</code></pre>\n\n<p>Our set-up is:</p>\n\n<ol>\n<li>Run a selenium/hub and a selenium/node-chrome-debug. Something that might be different is that we are mounting the /tmp of the base OS as /hosttmp/tmp in the node container</li>\n<li>Make the selenium/node-chrome-debug talk to selenium/hub</li>\n<li>Make the browser automation talk to the selenium/hub using the code provided above</li>\n</ol>\n\n<p>The problem is that I was never able to set the default download directory. However, all other parts are working correctly. The VNC window shows the browser is working correctly despite the default download directory settings. It is always /home/seluser/Downloads</p>\n\n<p>Things I have tried:</p>\n\n<ol>\n<li>Other people's ideas such as different ways to specify the options and preferences. (e.g. using the Capabilities)</li>\n<li>Docker security-related settings such as: --privileged --security-opt apparmor:unconfined --cap-add SYS_ADMIN</li>\n<li>On the base OS, chmod 777 for the download_directory. The download_directory, for example, /tmp/tmp.123 on the base OS, which is mounted as /hosttmp/tmp/tmp.123 in the chrome node container, I could see it and make a few read/write operations in this folder inside the container or on the base OS</li>\n<li>Tweaks about the interesting ruby symbol/string stuff when creating a Hash object.</li>\n</ol>\n\n<p>Does anyone have more ideas about what could lead to this situation? What else I could try? And is there any log that I could refer to. There is no error or warning when running the code. Thanks in advance.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "liquid", "mustache"], "answers": [{"comments": [{"owner": {"reputation": 67, "user_id": 9732722, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d51ae9bf08232bc377afdfc7671105e9?s=128&d=identicon&r=PG&f=1", "display_name": "Paco V.", "link": "https://stackoverflow.com/users/9732722/paco-v"}, "edited": false, "score": 0, "creation_date": 1540986407, "post_id": 53076602, "comment_id": 93061983, "body": "Hi Saiqul, thanks for taking the time answering, but  sadly, this could not match the need that I have. I want the function in mustache or {{ function }} to be rendered every time it&#39;s invoked by the users since the text they have this could be rendered into an api response."}, {"owner": {"reputation": 1344, "user_id": 1866752, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6I18d.jpg?s=128&g=1", "display_name": "Saiqul Haq", "link": "https://stackoverflow.com/users/1866752/saiqul-haq"}, "reply_to_user": {"reputation": 67, "user_id": 9732722, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d51ae9bf08232bc377afdfc7671105e9?s=128&d=identicon&r=PG&f=1", "display_name": "Paco V.", "link": "https://stackoverflow.com/users/9732722/paco-v"}, "edited": false, "score": 0, "creation_date": 1541048755, "post_id": 53076602, "comment_id": 93087213, "body": "&#39;read_json&#39; is a javascript function, right? if it&#39;s a asynchronous request, then read this one to implement your own helper <a href=\"https://stackoverflow.com/questions/14666557/how-to-run-a-callback-when-mustache-js-has-finished-rendering-template\" title=\"how to run a callback when mustache js has finished rendering template\">stackoverflow.com/questions/14666557/&hellip;</a>"}], "tags": [], "owner": {"reputation": 1344, "user_id": 1866752, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6I18d.jpg?s=128&g=1", "display_name": "Saiqul Haq", "link": "https://stackoverflow.com/users/1866752/saiqul-haq"}, "is_accepted": false, "score": 1, "last_activity_date": 1540962151, "creation_date": 1540962151, "answer_id": 53076602, "question_id": 53075023, "link": "https://stackoverflow.com/questions/53075023/choose-a-valid-template-solution-that-can-render-custom-functions/53076602#53076602", "title": "Choose a valid template solution that can render custom functions", "body": "<p>I think it should be done on client side</p>\n\n<p>so if you use jQuery, you can do this</p>\n\n<h3>your view file: x.html</h3>\n\n<pre><code>&lt;div&gt;Today the weather is &lt;span class=\"read-json\" data-type=\"weathersystem\" data-subtype=\"temperature\"&gt;&lt;/span&gt; degrees&lt;/div&gt;\n</code></pre>\n\n<h3>javascript file</h3>\n\n<pre><code>$('.read-json').each(function(el) {\n   var $el = $(el)\n   var type = $el.data('type')\n   var subType = $el.data('subType')\n   // url = ... set URL based on `type` and `subType` variable above \n   $el.load(url)\n}\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 9732722, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d51ae9bf08232bc377afdfc7671105e9?s=128&d=identicon&r=PG&f=1", "display_name": "Paco V.", "link": "https://stackoverflow.com/users/9732722/paco-v"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1540986663, "creation_date": 1540949096, "last_edit_date": 1540986663, "question_id": 53075023, "link": "https://stackoverflow.com/questions/53075023/choose-a-valid-template-solution-that-can-render-custom-functions", "title": "Choose a valid template solution that can render custom functions", "body": "<p>I'm wondering how to let my customer 'personalize' their view executing some of my custom functions using an mustache/handlebar format, but I'm not able to understand how to do it effectively. I have it in my mind the flow, but in code, I don't know where to start.</p>\n\n<p>Example given: \nI want my users to be able to invoke a function/method called <code>read_json(url,key)</code></p>\n\n<p>So in my mind, the flow should be to have a template like mustache or liquid and have: <code>Today the weather is {{read_json(https://weathersystem,temperature)}} degrees</code> and have it rendered to: Today the weather is 56 degrees.</p>\n\n<p>Or maybe having a set of functions that the user will declare as variable   weather somewhere in my rails database, specific to the user like:  <code>weather=read_json(\"https:/weathersystem\", temperature)</code> and then the user would be able to do something like: <code>Today the weather is {{weather}} degrees</code></p>\n\n<p>Since the text or function the user might want to add  or <code>{{ function }}</code> to be rendered every time it's invoked by the users since the text they have this could be rendered in a normal view or into an API response.</p>\n\n<p>I'm kinda struggling figuring it out what or how can be done.</p>\n\n<p>Cheers!</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "activerecord", "rails-activerecord"], "comments": [{"owner": {"reputation": 4866, "user_id": 6603195, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nZGPkfcc0EE/AAAAAAAAAAI/AAAAAAAAAoE/op-TBiFRNzg/photo.jpg?sz=128", "display_name": "Marcin Ko\u0142odziej", "link": "https://stackoverflow.com/users/6603195/marcin-ko%c5%82odziej"}, "edited": false, "score": 1, "creation_date": 1540945243, "post_id": 53074466, "comment_id": 93047542, "body": "While I understand the intention behind this, I would advise against such approach, chaining scopes should really have no side effects and making external calls is a nasty one. In this case, I would probably write a decorator to wrap the relation and use it very explicitly."}, {"owner": {"reputation": 60801, "user_id": 670206, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/08d285c964555cd9953d70981fd03f27?s=128&d=identicon&r=PG", "display_name": "Suever", "link": "https://stackoverflow.com/users/670206/suever"}, "reply_to_user": {"reputation": 4866, "user_id": 6603195, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nZGPkfcc0EE/AAAAAAAAAAI/AAAAAAAAAoE/op-TBiFRNzg/photo.jpg?sz=128", "display_name": "Marcin Ko\u0142odziej", "link": "https://stackoverflow.com/users/6603195/marcin-ko%c5%82odziej"}, "edited": false, "score": 0, "creation_date": 1540947894, "post_id": 53074466, "comment_id": 93048003, "body": "@MarcinKo\u0142odziej Decorators were the other approach that I had toyed with for this. I could only really find examples where they were used specifically for views and this data will likely be consumed elsewhere in the app so I wasn&#39;t sure if that was a good pattern or not. I think your point about it being more explicit makes a lot of sense, though."}], "owner": {"reputation": 60801, "user_id": 670206, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/08d285c964555cd9953d70981fd03f27?s=128&d=identicon&r=PG", "display_name": "Suever", "link": "https://stackoverflow.com/users/670206/suever"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1540989060, "creation_date": 1540943876, "last_edit_date": 1540989060, "question_id": 53074466, "link": "https://stackoverflow.com/questions/53074466/eager-loading-external-data-associated-with-an-active-record-model", "title": "Eager-Loading External Data Associated with an Active Record Model", "body": "<p>I am trying to combine data from an <code>ActiveRecord</code> model with external data related to each object and I'm trying to figure out a clean and performant way to accomplish this. </p>\n\n<p>I can obviously define an instance method on the model to fetch the corresponding external data:</p>\n\n<pre><code>class State &lt; ActiveRecord::Base\n  def counties\n    @counties ||= fetch_external_data(state: name)['counties']\n  end\nend\n\nState.find_by_name('Alabama').counties\n</code></pre>\n\n<p>But if I have a collection of objects (via an <code>ActiveRecord::Relation</code>), then this would result in an N+1 query to this external data source.</p>\n\n<pre><code>State.where(name: %w[Alabama Georgia]).map(&amp;:counties)\n</code></pre>\n\n<p>Ideally, I would eager-load all of the data from the external data source and then have the <code>counties</code> instance method access data from this \"shared\" object. I could do this using a class method:</p>\n\n<pre><code>class State &lt; ActiveRecord::Base\n\n  attr_accessor :counties\n\n  def self.with_counties\n    # Get external data for all states in our scope\n    counties = fetch_external_data(states: pluck(:name))\n\n    # Group by the state\n    counties_by_state = counties.group_by { |c| c['state'] }\n\n    # Now hydrate all of the state models and set the counties\n    all.map do |state|\n      state.counties = counties_by_state.dig(state.name, 'counties')\n    end\n  end\nend\n</code></pre>\n\n<p>While this is possible, it prevents me from being able to further chain scopes after using <code>State.where(name: %w[Alabama Georgia]).with_counties</code> and it just feels like it could be handled more elegantly.</p>\n\n<p>Is there a clear way to \"eager-load\" data like this (i.e. being able to set \"collection data\" on the <code>ActiveRecord::Relation</code> object that can be accessed when the record is hydrated)? If I have a class that represents this external data interface, are there methods that I could define on this class to make it work with <code>State.includes(:counties)</code> or <code>State.eager_load(:counties)</code>?</p>\n\n<p>Any thoughts or suggestions would  be appreciated. </p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 2946, "user_id": 1430057, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/Tbizp.jpg?s=128&g=1", "display_name": "Subash", "link": "https://stackoverflow.com/users/1430057/subash"}, "edited": false, "score": 2, "creation_date": 1540938133, "post_id": 53073624, "comment_id": 93045706, "body": "It feels like an assignment task, and you don&#39;t need the rails framework for it, you can easily do it in ruby, please show your effort or some work before asking for help"}, {"owner": {"reputation": 1, "user_id": 9962517, "user_type": "registered", "profile_image": "https://graph.facebook.com/2142951129317352/picture?type=large", "display_name": "Nicolas Rodriguez Sande", "link": "https://stackoverflow.com/users/9962517/nicolas-rodriguez-sande"}, "reply_to_user": {"reputation": 2946, "user_id": 1430057, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/Tbizp.jpg?s=128&g=1", "display_name": "Subash", "link": "https://stackoverflow.com/users/1430057/subash"}, "edited": false, "score": 1, "creation_date": 1540938451, "post_id": 53073624, "comment_id": 93045802, "body": "Its not. Its the way to calculate the verification number of Argentine Invoices that must be included in the barcode. <a href=\"http://www.formularioscontinuos.com/digito.html\" rel=\"nofollow noreferrer\">formularioscontinuos.com/digito.html</a>"}, {"owner": {"reputation": 1, "user_id": 9962517, "user_type": "registered", "profile_image": "https://graph.facebook.com/2142951129317352/picture?type=large", "display_name": "Nicolas Rodriguez Sande", "link": "https://stackoverflow.com/users/9962517/nicolas-rodriguez-sande"}, "reply_to_user": {"reputation": 2946, "user_id": 1430057, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/Tbizp.jpg?s=128&g=1", "display_name": "Subash", "link": "https://stackoverflow.com/users/1430057/subash"}, "edited": false, "score": 0, "creation_date": 1540938494, "post_id": 53073624, "comment_id": 93045819, "body": "@Subash Its not. Its the way to calculate the verification number of Argentine Invoices that must be included in the barcode. formularioscontinuos.com/digito.html"}, {"owner": {"reputation": 2946, "user_id": 1430057, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/Tbizp.jpg?s=128&g=1", "display_name": "Subash", "link": "https://stackoverflow.com/users/1430057/subash"}, "edited": false, "score": 0, "creation_date": 1540939374, "post_id": 53073624, "comment_id": 93046103, "body": "ok I stand corrected so where are you stuck ?"}, {"owner": {"reputation": 1, "user_id": 9962517, "user_type": "registered", "profile_image": "https://graph.facebook.com/2142951129317352/picture?type=large", "display_name": "Nicolas Rodriguez Sande", "link": "https://stackoverflow.com/users/9962517/nicolas-rodriguez-sande"}, "reply_to_user": {"reputation": 2946, "user_id": 1430057, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/Tbizp.jpg?s=128&g=1", "display_name": "Subash", "link": "https://stackoverflow.com/users/1430057/subash"}, "edited": false, "score": 0, "creation_date": 1540939534, "post_id": 53073624, "comment_id": 93046164, "body": "One of my problems is that i need to consider the &quot;0&quot; index like a odd position. And also dont know how to do the comparison in 6)"}, {"owner": {"reputation": 1, "user_id": 9962517, "user_type": "registered", "profile_image": "https://graph.facebook.com/2142951129317352/picture?type=large", "display_name": "Nicolas Rodriguez Sande", "link": "https://stackoverflow.com/users/9962517/nicolas-rodriguez-sande"}, "reply_to_user": {"reputation": 2946, "user_id": 1430057, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/Tbizp.jpg?s=128&g=1", "display_name": "Subash", "link": "https://stackoverflow.com/users/1430057/subash"}, "edited": false, "score": 0, "creation_date": 1540939556, "post_id": 53073624, "comment_id": 93046171, "body": "Iam looking to a fast solution also, because mine its very low"}, {"owner": {"reputation": 1, "user_id": 9962517, "user_type": "registered", "profile_image": "https://graph.facebook.com/2142951129317352/picture?type=large", "display_name": "Nicolas Rodriguez Sande", "link": "https://stackoverflow.com/users/9962517/nicolas-rodriguez-sande"}, "reply_to_user": {"reputation": 2946, "user_id": 1430057, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/Tbizp.jpg?s=128&g=1", "display_name": "Subash", "link": "https://stackoverflow.com/users/1430057/subash"}, "edited": false, "score": 0, "creation_date": 1540939898, "post_id": 53073624, "comment_id": 93046266, "body": "@Subash I edited my question with what i found, i didnt test it yet because i need the last step .Can you take a look at it?"}, {"owner": {"reputation": 986, "user_id": 8304905, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YpAOE.jpg?s=128&g=1", "display_name": "EmmanuelB", "link": "https://stackoverflow.com/users/8304905/emmanuelb"}, "edited": false, "score": 0, "creation_date": 1540941988, "post_id": 53073624, "comment_id": 93046782, "body": "Can you explain you step <code>6)</code> I dont understand what you require there."}, {"owner": {"reputation": 1, "user_id": 9962517, "user_type": "registered", "profile_image": "https://graph.facebook.com/2142951129317352/picture?type=large", "display_name": "Nicolas Rodriguez Sande", "link": "https://stackoverflow.com/users/9962517/nicolas-rodriguez-sande"}, "edited": false, "score": 0, "creation_date": 1540943959, "post_id": 53073624, "comment_id": 93047242, "body": "I managed to solve it. Thanks."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 9962517, "user_type": "registered", "profile_image": "https://graph.facebook.com/2142951129317352/picture?type=large", "display_name": "Nicolas Rodriguez Sande", "link": "https://stackoverflow.com/users/9962517/nicolas-rodriguez-sande"}, "is_accepted": false, "score": 0, "last_activity_date": 1540943915, "creation_date": 1540943915, "answer_id": 53074471, "question_id": 53073624, "link": "https://stackoverflow.com/questions/53073624/convert-string-into-array-and-do-operations/53074471#53074471", "title": "Convert string into array and do operations", "body": "<p>I solved it. Here is the code if anyone needs it: </p>\n\n<pre><code>barcode_array = @invoice.barcode.each_char.map {|c| c.to_i}\nimpares = [barcode_array[0]] + (1...barcode_array.size).step(2).collect { |i| barcode_array[i] }\npares = (2...barcode_array.size).step(2).collect { |i| barcode_array[i] }\nsuma_impares = impares.inject(:+).to_i\nmult_impares = suma_impares * 3\nsuma_pares = pares.inject(:+).to_i\nsuma_total = mult_impares + suma_pares\nverificador = 10 - (suma_total - (suma_total / 10).to_i * 10)\n@invoice.barcode = @invoice.barcode.to_s + verificador.to_s\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 22303, "user_id": 2456433, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NiN8K.jpg?s=128&g=1", "display_name": "infused", "link": "https://stackoverflow.com/users/2456433/infused"}, "is_accepted": false, "score": 0, "last_activity_date": 1540944307, "creation_date": 1540944307, "answer_id": 53074521, "question_id": 53073624, "link": "https://stackoverflow.com/questions/53073624/convert-string-into-array-and-do-operations/53074521#53074521", "title": "Convert string into array and do operations", "body": "<p>I'm not sure what you mean in step 6, but here's how I would tackle 1-5:</p>\n\n<pre><code>s = '1234567334535674326774324423'\na = s.chars.map(&amp;:to_i) # convert to an array of integers\n\nodd_sum = 0\neven_sum = 0\n\n# sum up odds and evens\na.each_with_index {|n, i| n.even? ? even_sum += n : odd_sum += n}\n\ntotal = even_sum + odd_sum * 3\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 9962517, "user_type": "registered", "profile_image": "https://graph.facebook.com/2142951129317352/picture?type=large", "display_name": "Nicolas Rodriguez Sande", "link": "https://stackoverflow.com/users/9962517/nicolas-rodriguez-sande"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 0, "answer_count": 2, "score": -4, "last_activity_date": 1540976286, "creation_date": 1540937543, "last_edit_date": 1540976286, "question_id": 53073624, "link": "https://stackoverflow.com/questions/53073624/convert-string-into-array-and-do-operations", "title": "Convert string into array and do operations", "body": "<p>I have a string like: <code>\"1234567334535674326774324423\"</code>. I need to create a method to do the following: </p>\n\n<ol>\n<li>Make an array consisting of digits in the string like <code>[1, 2, 3, ..., 2, 3]</code></li>\n<li>Sum all the odd positions of the array</li>\n<li>Sum all the even positions of the array</li>\n<li>Multiply the odd sum by 3</li>\n<li>Sum step 4 and step 3.</li>\n<li>Get the minimum number to sum to step 5 to get the sum that is a multiple of 5.</li>\n</ol>\n\n<p>I don't know how to solve this with rails. If anyone can help me, I would be glad.</p>\n\n<p>I have this: </p>\n\n<pre><code>barcode_array = @invoice.barcode.each_char.map {|c| c.to_i}\nimpares = [barcode_array[0]] + (1...barcode_array.size).step(2).collect { |i| barcode_array[i] }\npares = (2...barcode_array.size).step(2).collect { |i| barcode_array[i] }\nsuma_impares = impares.inject(:+)\nmult_impares = suma_impares * 3\nsuma total = mult_impares + pares\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "activerecord", "sinatra", "sinatra-activerecord"], "comments": [{"owner": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "edited": false, "score": 1, "creation_date": 1540938420, "post_id": 53073486, "comment_id": 93045794, "body": "<code>t = Team.create; t.members.new</code> will create through the association and assign the fields automatically."}, {"owner": {"reputation": 13, "user_id": 10569544, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/836fc4e1fa7575936358c3842934c6c8?s=128&d=identicon&r=PG&f=1", "display_name": "user10569544", "link": "https://stackoverflow.com/users/10569544/user10569544"}, "reply_to_user": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "edited": false, "score": 0, "creation_date": 1540940693, "post_id": 53073486, "comment_id": 93046486, "body": "@anothermh any idea why above works sometimes but not always?"}], "answers": [{"tags": [], "owner": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "is_accepted": true, "score": 2, "last_activity_date": 1540944561, "creation_date": 1540944561, "answer_id": 53074553, "question_id": 53073486, "link": "https://stackoverflow.com/questions/53073486/activerecord-belongs-to-association-id-is-not-always-set/53074553#53074553", "title": "ActiveRecord belongs_to association id is not always set", "body": "<p>Always create associated objects through the association. That means that you should do the following:</p>\n\n<pre><code>t = Team.create!\nm = t.members.create!\n</code></pre>\n\n<p>This is described in greater detail in the guide for <a href=\"https://guides.rubyonrails.org/association_basics.html#why-associations-questionmark\" rel=\"nofollow noreferrer\">Active Record Associations</a>.</p>\n\n<p>You asked why the example you provided works sometimes but not others. I cannot replicate the problems that you're seeing. It is probably something specific to your implementation or practices that are not shared in your question. Here is how I verified that the issue does not occur.</p>\n\n<p>First, create the Rails app, its associations, its database, and then start the Rails console:</p>\n\n<pre><code>rails new tester\ncd tester\nrails generate model Team\nrails generate model Member team:belongs_to\nsed -i '' 's/end/  has_many :members\\'$'\\nend/' app/models/team.rb\nrake db:migrate\nrails console\n</code></pre>\n\n<p>Now create one thousand teams with an associated member, and if the fields are not appropriately set then raise an exception:</p>\n\n<pre><code>1000.times do\n  t = Team.create!\n  m = t.members.create!\n  raise unless m.team_id &amp;&amp; m.team_id == t.id\nend\n</code></pre>\n\n<p>Or alternatively, using <code>.new</code> and <code>.save!</code>:</p>\n\n<pre><code>1000.times do\n  t = Team.new\n  m = t.members.new\n  m.save!\n  raise unless m.team_id &amp;&amp; m.team_id == t.id\nend\n</code></pre>\n\n<p>No exception is raised, so by creating in this manner you can be assured that it will work properly.</p>\n"}], "owner": {"reputation": 13, "user_id": 10569544, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/836fc4e1fa7575936358c3842934c6c8?s=128&d=identicon&r=PG&f=1", "display_name": "user10569544", "link": "https://stackoverflow.com/users/10569544/user10569544"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 622, "favorite_count": 0, "accepted_answer_id": 53074553, "answer_count": 1, "score": 1, "last_activity_date": 1540944561, "creation_date": 1540936818, "question_id": 53073486, "link": "https://stackoverflow.com/questions/53073486/activerecord-belongs-to-association-id-is-not-always-set", "title": "ActiveRecord belongs_to association id is not always set", "body": "<p>I have models like this:</p>\n\n<pre><code>class Member\n  belongs_to :team, class_name: 'Team'\nend\n\nclass Team\n  has_many :members, foreign_key: :team_id\nend\n</code></pre>\n\n<p>Database has all the columns needed.</p>\n\n<p>When I do:\n    t = Team.new\n    m = Member.new</p>\n\n<pre><code>m.team = team\nm.save!\n#some other code\nt.save!\n</code></pre>\n\n<p>team_id field is present most of the times but is absent sometimes in the database. I saw in active record documentation that belongs to association is not saved. This looks like a race condition to me but I want to understand why it might happen.</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["json", "ruby", "api", "ruby-on-rails-5", "restful-url"], "comments": [{"owner": {"reputation": 161, "user_id": 9761922, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/c3kTy.jpg?s=128&g=1", "display_name": "Maycon Seidel", "link": "https://stackoverflow.com/users/9761922/maycon-seidel"}, "edited": false, "score": 0, "creation_date": 1540958125, "post_id": 53073052, "comment_id": 93049996, "body": "Strong parameters exist exactly to perform this job. If you do not include <code>owner</code> on permitted params and try to save your object with this params, the model will throw an exception. The question is, why you want to &quot;double-check&quot; this behavior?"}, {"owner": {"reputation": 53, "user_id": 9028145, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YqGfxAOs6g0/AAAAAAAAAAI/AAAAAAAAAD0/irtE1Um76UQ/photo.jpg?sz=128", "display_name": "Mexa Fireg", "link": "https://stackoverflow.com/users/9028145/mexa-fireg"}, "reply_to_user": {"reputation": 161, "user_id": 9761922, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/c3kTy.jpg?s=128&g=1", "display_name": "Maycon Seidel", "link": "https://stackoverflow.com/users/9761922/maycon-seidel"}, "edited": false, "score": 0, "creation_date": 1541026250, "post_id": 53073052, "comment_id": 93082717, "body": "I just want to return a 400 error if a json structure is not correct, I don&#39;t want to keep that value null, I want to deny the post. greetings."}, {"owner": {"reputation": 53, "user_id": 9028145, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YqGfxAOs6g0/AAAAAAAAAAI/AAAAAAAAAD0/irtE1Um76UQ/photo.jpg?sz=128", "display_name": "Mexa Fireg", "link": "https://stackoverflow.com/users/9028145/mexa-fireg"}, "reply_to_user": {"reputation": 161, "user_id": 9761922, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/c3kTy.jpg?s=128&g=1", "display_name": "Maycon Seidel", "link": "https://stackoverflow.com/users/9761922/maycon-seidel"}, "edited": false, "score": 0, "creation_date": 1541088718, "post_id": 53073052, "comment_id": 93105492, "body": "the problem is that the model is not throwing anything it is saving the object to the db but the field owner is saved as nil, I don&#39;t want to do that just throw a 400, please if someone could help me I will be very grateful."}], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 9028145, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YqGfxAOs6g0/AAAAAAAAAAI/AAAAAAAAAD0/irtE1Um76UQ/photo.jpg?sz=128", "display_name": "Mexa Fireg", "link": "https://stackoverflow.com/users/9028145/mexa-fireg"}, "edited": false, "score": 0, "creation_date": 1541026152, "post_id": 53075534, "comment_id": 93082688, "body": "not really, I want to deny access to everything different to  model or year not just owner.  Thank you so much for your answer, greetings."}], "tags": [], "owner": {"reputation": 3, "user_id": 7822771, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gA8vf.jpg?s=128&g=1", "display_name": "Gabriel Klockner", "link": "https://stackoverflow.com/users/7822771/gabriel-klockner"}, "is_accepted": false, "score": 0, "last_activity_date": 1540953712, "creation_date": 1540953712, "answer_id": 53075534, "question_id": 53073052, "link": "https://stackoverflow.com/questions/53073052/permit-params-by-json-rails/53075534#53075534", "title": "permit params by JSON Rails", "body": "<p>You can check if the owner field is present and raise the error for example...</p>\n\n<pre><code>def car_params\n  raise StandardError.new('Invalid JSON structure.') if params[:car].key?(:owner)\n  params.require(:car).permit(:model, :year)\nend\n</code></pre>\n\n<p>Is that what you had in your mind? I'm not sure if I got your point.</p>\n"}], "owner": {"reputation": 53, "user_id": 9028145, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YqGfxAOs6g0/AAAAAAAAAAI/AAAAAAAAAD0/irtE1Um76UQ/photo.jpg?sz=128", "display_name": "Mexa Fireg", "link": "https://stackoverflow.com/users/9028145/mexa-fireg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 244, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1540953712, "creation_date": 1540934204, "question_id": 53073052, "link": "https://stackoverflow.com/questions/53073052/permit-params-by-json-rails", "title": "permit params by JSON Rails", "body": "<p>I have a problem when trying to validate params in Rails, I want to post data by POST but I neet to validate first the structure of the Json object.</p>\n\n<p>this is my JSON:</p>\n\n<pre><code>{\"car\":{\"year\": 2018, \"owner\": \"Fernando\"}}\n</code></pre>\n\n<p>I do not want to keep the value as null.</p>\n\n<pre><code>def car_params\n  params.require(:car).permit(:model, :year)\nend\n</code></pre>\n\n<p>I need to throw and error if in the JSON structure exists for example the owner field.</p>\n\n<p>Have a nice day.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "puma"], "comments": [{"owner": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "edited": false, "score": 0, "creation_date": 1540936229, "post_id": 53072995, "comment_id": 93044974, "body": "Check the permissions on the directory <code>site&#47;tmp&#47;pids</code> and if <code>puma.pid</code> already exists there (and Puma is not running) then delete that file. (or verify its permissions as well). Also try a full path in <code>app_dir</code>, not a relative path. Next, read <a href=\"https://stackoverflow.com/help/mcve\">How to create a Minimal, Complete, and Verifiable example</a> with emphasis on <b>minimal</b>."}, {"owner": {"reputation": 37, "user_id": 9592597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa3591f8c4fa499ef89e07d20f5ac37a?s=128&d=identicon&r=PG&f=1", "display_name": "KAYJAY", "link": "https://stackoverflow.com/users/9592597/kayjay"}, "reply_to_user": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "edited": false, "score": 0, "creation_date": 1541024147, "post_id": 53072995, "comment_id": 93082070, "body": "Thanks anothermh. That worked."}], "owner": {"reputation": 37, "user_id": 9592597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa3591f8c4fa499ef89e07d20f5ac37a?s=128&d=identicon&r=PG&f=1", "display_name": "KAYJAY", "link": "https://stackoverflow.com/users/9592597/kayjay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1895, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1540933925, "creation_date": 1540933925, "question_id": 53072995, "link": "https://stackoverflow.com/questions/53072995/no-such-file-or-directory-rb-sysopen-site-tmp-pids-puma-pid-errnoenoent", "title": "No such file or directory @ rb_sysopen - site/tmp/pids/puma.pid (Errno::ENOENT)", "body": "<p>I have deployed a Rails app manually to virtual private server (VPS) and trying to get it to run. The VPS has Ubuntu 18.04, Apache2, Ruby 2.5.1, &amp; Rails 5.2.1. Puma 3.12.0 is the web server. Everything ran well in development. In production, when I run puma, I get the following:</p>\n\n<pre><code>[28751] Puma starting in cluster mode...\n[28751] * Version 3.12.0 (ruby 2.5.1-p57), codename: Llamas in Pajamas\n[28751] * Min threads: 5, max threads: 5\n[28751] * Environment: production\n[28751] * Process workers: 2\n[28751] * Preloading application\n[28751] * Listening on unix:///home/kenneth/site/tmp/sockets/puma.sock\n[28751] * Listening on tcp://0.0.0.0:3000\n[28751] ! WARNING: Detected 1 Thread(s) started in app boot:\n[28751] ! #&lt;Thread:0x00005643a2eda878@/home/kenneth/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/connection_adapters/abstract/connection_pool.rb:297 sleep&gt; - /home/kenneth/.rvm/gems/ruby-2.5.1/gems/activerecord-5.2.1/lib/active_record/connection_adapters/abstract/connection_pool.rb:299:in `sleep'\n[28751] Use Ctrl-C to stop\nTraceback (most recent call last):\n    11: from /home/kenneth/.rvm/gems/ruby-2.5.1/bin/ruby_executable_hooks:24:in `&lt;main&gt;'\n    10: from /home/kenneth/.rvm/gems/ruby-2.5.1/bin/ruby_executable_hooks:24:in `eval'\n     9: from /home/kenneth/.rvm/gems/ruby-2.5.1/bin/puma:23:in `&lt;main&gt;'\n     8: from /home/kenneth/.rvm/gems/ruby-2.5.1/bin/puma:23:in `load'\n     7: from /home/kenneth/.rvm/gems/ruby-2.5.1/gems/puma-3.12.0/bin/puma:10:in `&lt;top (required)&gt;'\n     6: from /home/kenneth/.rvm/gems/ruby-2.5.1/gems/puma-3.12.0/lib/puma/cli.rb:78:in `run'\n     5: from /home/kenneth/.rvm/gems/ruby-2.5.1/gems/puma-3.12.0/lib/puma/launcher.rb:184:in `run'\n     4: from /home/kenneth/.rvm/gems/ruby-2.5.1/gems/puma-3.12.0/lib/puma/cluster.rb:458:in `run'\n     3: from /home/kenneth/.rvm/gems/ruby-2.5.1/gems/puma-3.12.0/lib/puma/launcher.rb:104:in `write_state'\n     2: from /home/kenneth/.rvm/gems/ruby-2.5.1/gems/puma-3.12.0/lib/puma/launcher.rb:131:in `write_pid'\n     1: from /home/kenneth/.rvm/gems/ruby-2.5.1/gems/puma-3.12.0/lib/puma/launcher.rb:131:in `open' /home/kenneth/.rvm/gems/ruby-2.5.1/gems/puma-3.12.0/lib/puma/launcher.rb:131:in `initialize': No such file or directory @ rb_sysopen - site/tmp/pids/puma.pid (Errno::ENOENT)\n</code></pre>\n\n<p>I searched the knowledge base here. One similar inquiry concerning a puma.pid was found but the solution was to create the tmp/pids directories. In my case,  those directories &amp; the puma.pid exist. The output appears to indicate that the initialization of the Puma::Launcher instance failed and refers to the write_pid method circa line 131 in launcher.rb. I have included the code from the launcher.rb and puma.rb and  files. Please help me to understand what the problem is and how it can be resolved.</p>\n\n<p>launch.rb</p>\n\n<pre><code>require 'puma/events'\nrequire 'puma/detect'\n\nrequire 'puma/cluster'\nrequire 'puma/single'\n\nrequire 'puma/const'\n\nrequire 'puma/binder'\n\nmodule Puma\n  # Puma::Launcher is the single entry point for starting a Puma server based on user\n  # configuration. It is responsible for taking user supplied arguments and resolving them\n  # with configuration in `config/puma.rb` or `config/puma/&lt;env&gt;.rb`.\n  #\n  # It is responsible for either launching a cluster of Puma workers or a single\n  # puma server.\n  class Launcher\n    KEYS_NOT_TO_PERSIST_IN_STATE = [\n       :logger, :lowlevel_error_handler,\n       :before_worker_shutdown, :before_worker_boot, :before_worker_fork,\n       :after_worker_boot, :before_fork, :on_restart\n     ]\n    # Returns an instance of Launcher\n    #\n    # +conf+ A Puma::Configuration object indicating how to run the server.\n    #\n    # +launcher_args+ A Hash that currently has one required key `:events`,\n    # this is expected to hold an object similar to an `Puma::Events.stdio`,\n    # this object will be responsible for broadcasting Puma's internal state\n    # to a logging destination. An optional key `:argv` can be supplied,\n    # this should be an array of strings, these arguments are re-used when\n    # restarting the puma server.\n    #\n    # Examples:\n    #\n    #   conf = Puma::Configuration.new do |user_config|\n    #     user_config.threads 1, 10\n    #     user_config.app do |env|\n    #       [200, {}, [\"hello world\"]]\n    #     end\n    #   end\n    #   Puma::Launcher.new(conf, events: Puma::Events.stdio).run\n    def initialize(conf, launcher_args={})\n      @runner        = nil\n      @events        = launcher_args[:events] || Events::DEFAULT\n      @argv          = launcher_args[:argv] || []\n      @original_argv = @argv.dup\n      @config        = conf\n\n      @binder        = Binder.new(@events)\n      @binder.import_from_env\n\n      @environment = conf.environment\n\n      # Advertise the Configuration\n      Puma.cli_config = @config if defined?(Puma.cli_config)\n\n      @config.load\n\n      @options = @config.options\n      @config.clamp\n\n      generate_restart_data\n\n      if clustered? &amp;&amp; (Puma.jruby? || Puma.windows?)\n        unsupported 'worker mode not supported on JRuby or Windows'\n      end\n\n      if @options[:daemon] &amp;&amp; Puma.windows?\n        unsupported 'daemon mode not supported on Windows'\n      end\n\n      Dir.chdir(@restart_dir)\n\n      prune_bundler if prune_bundler?\n\n      @environment = @options[:environment] if @options[:environment]\n      set_rack_environment\n\n      if clustered?\n        @events.formatter = Events::PidFormatter.new\n        @options[:logger] = @events\n\n        @runner = Cluster.new(self, @events)\n      else\n        @runner = Single.new(self, @events)\n      end\n      Puma.stats_object = @runner\n\n      @status = :run\n    end\n\n    attr_reader :binder, :events, :config, :options, :restart_dir\n\n    # Return stats about the server\n    def stats\n      @runner.stats\n    end\n\n    # Write a state file that can be used by pumactl to control\n    # the server\n    def write_state\n      write_pid\n\n      path = @options[:state]\n      return unless path\n\n      require 'puma/state_file'\n\n      sf = StateFile.new\n      sf.pid = Process.pid\n      sf.control_url = @options[:control_url]\n      sf.control_auth_token = @options[:control_auth_token]\n\n      sf.save path\n    end\n\n    # Delete the configured pidfile\n    def delete_pidfile\n      path = @options[:pidfile]\n      File.unlink(path) if path &amp;&amp; File.exist?(path)\n    end\n# The problem appears to pertain to this method\n#\n    # If configured, write the pid of the current process out\n    # to a file.\n    def write_pid\n      path = @options[:pidfile]\n      return unless path\n# The error output indicated the following line (131) to be the culprit\n      File.open(path, 'w') { |f| f.puts Process.pid }\n      cur = Process.pid\n      at_exit do\n        delete_pidfile if cur == Process.pid\n      end\n    end\n\n    # Begin async shutdown of the server\n    def halt\n      @status = :halt\n      @runner.halt\n    end\n\n    # Begin async shutdown of the server gracefully\n    def stop\n      @status = :stop\n      @runner.stop\n    end\n\n    # Begin async restart of the server\n    def restart\n      @status = :restart\n      @runner.restart\n    end\n\n    # Begin a phased restart if supported\n    def phased_restart\n      unless @runner.respond_to?(:phased_restart) and @runner.phased_restart\n        log \"* phased-restart called but not available, restarting normally.\"\n        return restart\n      end\n      true\n    end\n\n    # Run the server. This blocks until the server is stopped\n    def run\n      previous_env =\n        if defined?(Bundler)\n          env = Bundler::ORIGINAL_ENV.dup\n          # add -rbundler/setup so we load from Gemfile when restarting\n          bundle = \"-rbundler/setup\"\n          env[\"RUBYOPT\"] = [env[\"RUBYOPT\"], bundle].join(\" \").lstrip unless env[\"RUBYOPT\"].to_s.include?(bundle)\n          env\n        else\n          ENV.to_h\n        end\n\n      @config.clamp\n\n      @config.plugins.fire_starts self\n\n      setup_signals\n      set_process_title\n      @runner.run\n\n      case @status\n      when :halt\n        log \"* Stopping immediately!\"\n      when :run, :stop\n        graceful_stop\n      when :restart\n        log \"* Restarting...\"\n        ENV.replace(previous_env)\n        @runner.before_restart\n        restart!\n      when :exit\n        # nothing\n      end\n    end\n\n    # Return which tcp port the launcher is using, if it's using TCP\n    def connected_port\n      @binder.connected_port\n    end\n\n    def restart_args\n      cmd = @options[:restart_cmd]\n      if cmd\n        cmd.split(' ') + @original_argv\n      else\n        @restart_argv\n      end\n    end\n\n    private\n\n    def reload_worker_directory\n      @runner.reload_worker_directory if @runner.respond_to?(:reload_worker_directory)\n    end\n\n    def restart!\n      @config.run_hooks :on_restart, self\n\n      if Puma.jruby?\n        close_binder_listeners\n\n        require 'puma/jruby_restart'\n        JRubyRestart.chdir_exec(@restart_dir, restart_args)\n      elsif Puma.windows?\n        close_binder_listeners\n\n        argv = restart_args\n        Dir.chdir(@restart_dir)\n        Kernel.exec(*argv)\n      else\n        redirects = {:close_others =&gt; true}\n        @binder.listeners.each_with_index do |(l, io), i|\n          ENV[\"PUMA_INHERIT_#{i}\"] = \"#{io.to_i}:#{l}\"\n          redirects[io.to_i] = io.to_i\n        end\n\n        argv = restart_args\n        Dir.chdir(@restart_dir)\n        argv += [redirects] if RUBY_VERSION &gt;= '1.9'\n        Kernel.exec(*argv)\n      end\n    end\n\n    def prune_bundler\n      return unless defined?(Bundler)\n      puma = Bundler.rubygems.loaded_specs(\"puma\")\n      dirs = puma.require_paths.map { |x| File.join(puma.full_gem_path, x) }\n      puma_lib_dir = dirs.detect { |x| File.exist? File.join(x, '../bin/puma-wild') }\n\n      unless puma_lib_dir\n        log \"! Unable to prune Bundler environment, continuing\"\n        return\n      end\n\n      deps = puma.runtime_dependencies.map do |d|\n        spec = Bundler.rubygems.loaded_specs(d.name)\n        \"#{d.name}:#{spec.version.to_s}\"\n      end\n\n      log '* Pruning Bundler environment'\n      home = ENV['GEM_HOME']\n      Bundler.with_clean_env do\n        ENV['GEM_HOME'] = home\n        ENV['PUMA_BUNDLER_PRUNED'] = '1'\n        wild = File.expand_path(File.join(puma_lib_dir, \"../bin/puma-wild\"))\n        args = [Gem.ruby, wild, '-I', dirs.join(':'), deps.join(',')] + @original_argv\n        # Ruby 2.0+ defaults to true which breaks socket activation\n        args += [{:close_others =&gt; false}] if RUBY_VERSION &gt;= '2.0'\n        Kernel.exec(*args)\n      end\n    end\n\n    def log(str)\n      @events.log str\n    end\n\n    def clustered?\n      (@options[:workers] || 0) &gt; 0\n    end\n\n    def unsupported(str)\n      @events.error(str)\n      raise UnsupportedOption\n    end\n\n    def graceful_stop\n      @runner.stop_blocked\n      log \"=== puma shutdown: #{Time.now} ===\"\n      log \"- Goodbye!\"\n    end\n\n    def set_process_title\n      Process.respond_to?(:setproctitle) ? Process.setproctitle(title) : $0 = title\n    end\n\n    def title\n      buffer  = \"puma #{Puma::Const::VERSION} (#{@options[:binds].join(',')})\"\n      buffer += \" [#{@options[:tag]}]\" if @options[:tag] &amp;&amp; !@options[:tag].empty?\n      buffer\n    end\n\n    def set_rack_environment\n      @options[:environment] = environment\n      ENV['RACK_ENV'] = environment\n    end\n\n    def environment\n      @environment\n    end\n\n    def prune_bundler?\n      @options[:prune_bundler] &amp;&amp; clustered? &amp;&amp; !@options[:preload_app]\n    end\n\n    def close_binder_listeners\n      @binder.listeners.each do |l, io|\n        io.close\n        uri = URI.parse(l)\n        next unless uri.scheme == 'unix'\n        File.unlink(\"#{uri.host}#{uri.path}\")\n      end\n    end\n\n\n    def generate_restart_data\n      if dir = @options[:directory]\n        @restart_dir = dir\n\n      elsif Puma.windows?\n        # I guess the value of PWD is garbage on windows so don't bother\n        # using it.\n        @restart_dir = Dir.pwd\n\n        # Use the same trick as unicorn, namely favor PWD because\n        # it will contain an unresolved symlink, useful for when\n        # the pwd is /data/releases/current.\n      elsif dir = ENV['PWD']\n        s_env = File.stat(dir)\n        s_pwd = File.stat(Dir.pwd)\n\n        if s_env.ino == s_pwd.ino and (Puma.jruby? or s_env.dev == s_pwd.dev)\n          @restart_dir = dir\n        end\n      end\n\n      @restart_dir ||= Dir.pwd\n\n      # if $0 is a file in the current directory, then restart\n      # it the same, otherwise add -S on there because it was\n      # picked up in PATH.\n      #\n      if File.exist?($0)\n        arg0 = [Gem.ruby, $0]\n      else\n        arg0 = [Gem.ruby, \"-S\", $0]\n      end\n\n      # Detect and reinject -Ilib from the command line, used for testing without bundler\n      # cruby has an expanded path, jruby has just \"lib\"\n      lib = File.expand_path \"lib\"\n      arg0[1,0] = [\"-I\", lib] if [lib, \"lib\"].include?($LOAD_PATH[0])\n\n      if defined? Puma::WILD_ARGS\n        @restart_argv = arg0 + Puma::WILD_ARGS + @original_argv\n      else\n        @restart_argv = arg0 + @original_argv\n      end\n    end\n\n    def setup_signals\n      begin\n        Signal.trap \"SIGUSR2\" do\n          restart\n        end\n      rescue Exception\n        log \"*** SIGUSR2 not implemented, signal based restart unavailable!\"\n      end\n\n      unless Puma.jruby?\n        begin\n          Signal.trap \"SIGUSR1\" do\n            phased_restart\n          end\n        rescue Exception\n          log \"*** SIGUSR1 not implemented, signal based restart unavailable!\"\n        end\n      end\n\n      begin\n        Signal.trap \"SIGTERM\" do\n          graceful_stop\n\n          raise SignalException, \"SIGTERM\"\n        end\n      rescue Exception\n        log \"*** SIGTERM not implemented, signal based gracefully stopping unavailable!\"\n      end\n\n      begin\n        Signal.trap \"SIGINT\" do\n          if Puma.jruby?\n            @status = :exit\n            graceful_stop\n            exit\n          end\n\n          stop\n        end\n      rescue Exception\n        log \"*** SIGINT not implemented, signal based gracefully stopping unavailable!\"\n      end\n\n      begin\n        Signal.trap \"SIGHUP\" do\n          if @runner.redirected_io?\n            @runner.redirect_io\n          else\n            stop\n          end\n        end\n      rescue Exception\n        log \"*** SIGHUP not implemented, signal based logs reopening unavailable!\"\n      end\n    end\n  end\nend\n</code></pre>\n\n<p>puma.rb</p>\n\n<pre><code># Puma can serve each request in a thread from an internal thread pool.\n# The `threads` method setting takes two numbers: a minimum and maximum.\n# Any libraries that use thread pools should be configured to match\n# the maximum value specified for Puma. Default is set to 5 threads for minimum\n# and maximum; this matches the default thread size of Active Record.\n#\n\napp_dir = \"site\"      # File.expand_path(\"../..\", __FILE__)\nshared_dir = \"    #{app_dir}/tmp\"\n    # Set up socket location\nbind 'unix:///home/kenneth/site/tmp/sockets/puma.sock' #\"unix://#{shared_dir}/sockets/puma.sock\"\n\nthreads_count = Integer(ENV['RAILS_MAX_THREADS'] || 5)\nthreads threads_count, threads_count\n\nrackup      DefaultRackup\n\n    # Specifies the `port` that Puma will listen on to receive requests; default is 3000.\n    #\nport        ENV['PORT'] || 3000\n\n    # Specifies the `environment` that Puma will run in.\n    # environment ENV['RAILS_ENV'] || 'development'\n    #\nrails_env = ENV['RAILS_ENV'] || 'production'\nenvironment rails_env\n\n# Logging\n# stdout_redirect \"    #{shared_dir}/log/puma.stdout.log\", \"  #{shared_dir}/log/puma.stderr.log\", true\n\n\n# config.logger = Logger.new(STDOUT)\n# config.logger = Logger.new(STDERR)\n\n# Set master PID and state locations\npidfile \"    #{shared_dir}/pids/puma.pid\"\nstate_path \"    #{shared_dir}/pids/puma.state\"\nactivate_control_app\n\n# Specifies the number of `workers` to boot in clustered mode.\n# Workers are forked webserver processes. If using threads and workers together\n# the concurrency of the application would be max `threads` * `workers`.\n# Workers do not work on JRuby or Windows (both of which do not support\n# processes).\n#\nworkers Integer(ENV['WEB_CONCURRENCY'] || 2)\n\n# Use the `preload_app!` method when specifying a `workers` number.\n# This directive tells Puma to first boot the application and load code\n# before forking the application. This takes advantage of Copy On Write\n# process behavior so workers use less memory.\n#\npreload_app!\n\non_worker_boot do\n  ActiveRecord::Base.establish_connection # if defined?(ActiveRecord)\n                 ActiveRecord::Base.establish_connection(YAML.load_file(\"#{app_dir}/config/database.yml\")[rails_env])\nend\n\n# Allow puma to be restarted by `rails restart` command.\nplugin :tmp_restart\n</code></pre>\n"}, {"tags": ["ruby", "regex"], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 4170904, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b96a160968a0c9fe1f4b77e6c3d5d03?s=128&d=identicon&r=PG&f=1", "display_name": "Taylor", "link": "https://stackoverflow.com/users/4170904/taylor"}, "edited": false, "score": 1, "creation_date": 1540934549, "post_id": 53072951, "comment_id": 93044548, "body": "Thanks for the quick response! Simple and works great."}], "tags": [], "owner": {"reputation": 481662, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 1, "last_activity_date": 1540934060, "last_edit_date": 1540934060, "creation_date": 1540933740, "answer_id": 53072951, "question_id": 53072921, "link": "https://stackoverflow.com/questions/53072921/regex-to-match-some-words-excluding-strings-with-a-dot/53072951#53072951", "title": "Regex to match some words excluding strings with a dot", "body": "<p>You may add a negative  lookahead after <code>Co</code>:</p>\n\n<pre><code>/\\b(Colorado|Co(?!\\.))\\b/i\n               ^^^^^^\n</code></pre>\n\n<p>See the <a href=\"http://%5Cb(Colorado%7CCo(?!%5C.))%5Cb\" rel=\"nofollow noreferrer\">Rubular demo</a></p>\n\n<p>Note I omitted <code>co</code> alternative since you are using a case insensitive <code>i</code> modifier that makes <code>Co</code> equal to <code>co</code>.</p>\n\n<p>Another way is to add the negative lookahead before the group after the first <code>\\b</code>: </p>\n\n<pre><code>/\\b(?!Co\\.)(Colorado|Co)\\b/i\n   ^^^^^^^^ \n</code></pre>\n\n<p>See <a href=\"http://rubular.com/r/69D6xHm53n\" rel=\"nofollow noreferrer\">another Rubular demo</a>.</p>\n\n<p>Here, <code>\\b</code> asserts the position at the word boundary, then <code>(?!Co\\.)</code> fails the match if <code>Co.</code> is the text immediately to the right of the current location, and <code>(Colorado|Co)\\b</code> matches a whole word <code>Colorado</code> or <code>Co</code>.</p>\n\n<p>Note you may further shorten the pattern if you write it manually, like</p>\n\n<pre><code>/\\b(?!Co\\.)Co(?:lorado)?\\b/i\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 4170904, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b96a160968a0c9fe1f4b77e6c3d5d03?s=128&d=identicon&r=PG&f=1", "display_name": "Taylor", "link": "https://stackoverflow.com/users/4170904/taylor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 0, "accepted_answer_id": 53072951, "answer_count": 1, "score": 0, "last_activity_date": 1540976871, "creation_date": 1540933619, "last_edit_date": 1540976871, "question_id": 53072921, "link": "https://stackoverflow.com/questions/53072921/regex-to-match-some-words-excluding-strings-with-a-dot", "title": "Regex to match some words excluding strings with a dot", "body": "<p>What is the regex to match <code>\"Colorado\"</code>, <code>\"Co\"</code>, or <code>\"CO\"</code>, excluding strings that include a period such as <code>\"Co.\"</code> or <code>\"co.\"</code>?</p>\n\n<p>This:</p>\n\n<pre><code>/\\b(Colorado|Co|CO)\\b/i\n</code></pre>\n\n<p>matches the two instances of <code>\"CO\"</code>. How do you exclude matches that contain the dot?</p>\n\n<p>This:</p>\n\n<pre><code>\\b(?:(?!Co\\.)\\w)+\\b\n</code></pre>\n\n<p>ignores <code>\"Co.\"</code>, but I can't figure out how to combine that with the keywords allowed.</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 1062, "user_id": 2299825, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e560dd8414404e8ac145542bf3ccbc5a?s=128&d=identicon&r=PG", "display_name": "alejandrociatti", "link": "https://stackoverflow.com/users/2299825/alejandrociatti"}, "edited": false, "score": 0, "creation_date": 1540933441, "post_id": 53072420, "comment_id": 93044170, "body": "Nattemando, what you are trying to do is called string interpolation, you should google search: &quot;string interpolation ruby&quot;. Here you have a nice example: <a href=\"http://ruby-for-beginners.rubymonstas.org/bonus/string_interpolation.html\" rel=\"nofollow noreferrer\">ruby-for-beginners.rubymonstas.org/bonus/&hellip;</a>"}, {"owner": {"reputation": 7878, "user_id": 630780, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/fskbD.png?s=128&g=1", "display_name": "Carl Markham", "link": "https://stackoverflow.com/users/630780/carl-markham"}, "edited": false, "score": 2, "creation_date": 1540934641, "post_id": 53072420, "comment_id": 93044577, "body": "@Nattemando Please take others answers and comments in to consideration. Rather than replying with &quot;gibberish&quot; or &quot;you lack an understanding&quot;, perhaps phrase your question better or ask for more information."}, {"owner": {"reputation": 7878, "user_id": 630780, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/fskbD.png?s=128&g=1", "display_name": "Carl Markham", "link": "https://stackoverflow.com/users/630780/carl-markham"}, "edited": false, "score": 2, "creation_date": 1540945352, "post_id": 53072420, "comment_id": 93047574, "body": "@Nattemando Then you leave me no option other than to report you. SO is a place to get answers and comments for your question. You can&#39;t simply try and belittle others for trying to help."}, {"owner": {"reputation": 69, "user_id": 10447327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5bbae0ed802a138f9f3ecc875095b904?s=128&d=identicon&r=PG&f=1", "display_name": "Nattemando", "link": "https://stackoverflow.com/users/10447327/nattemando"}, "reply_to_user": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1540992574, "post_id": 53072420, "comment_id": 93065799, "body": "@sawa there&#39;s no question"}], "answers": [{"comments": [{"owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "reply_to_user": {"reputation": 69, "user_id": 10447327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5bbae0ed802a138f9f3ecc875095b904?s=128&d=identicon&r=PG&f=1", "display_name": "Nattemando", "link": "https://stackoverflow.com/users/10447327/nattemando"}, "edited": false, "score": 0, "creation_date": 1540933658, "post_id": 53072612, "comment_id": 93044253, "body": "It uses regex to split the original string, then maps the resulting array by the substitution hash, finally joins the array back into a string. Is this &quot;my_string_aa___bb&quot; the desired output?  In case I could edit with a better explanation."}], "tags": [], "owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "is_accepted": false, "score": 0, "last_activity_date": 1540932113, "creation_date": 1540932113, "answer_id": 53072612, "question_id": 53072420, "link": "https://stackoverflow.com/questions/53072420/trying-to-replace-varn-in-a-string-with-actual-values/53072612#53072612", "title": "Trying to replace {varN} in a string with actual values", "body": "<p>One option, if I get the point:</p>\n\n<pre><code>s = \"my_string_{var1}___{var2}\"\n\nsubstitute = {var1: \"aa\", var2: \"bb\"}\n\ns.split(/\\{(.*?)\\}/).map { |e| substitute[e.to_sym] || e }.join\n\n#=&gt; \"my_string_aa___bb\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5449, "user_id": 681520, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/701baebf68d1d7faa9f9def6a24fe356?s=128&d=identicon&r=PG", "display_name": "Kimmo Lehto", "link": "https://stackoverflow.com/users/681520/kimmo-lehto"}, "is_accepted": false, "score": 0, "last_activity_date": 1540970884, "creation_date": 1540970884, "answer_id": 53078310, "question_id": 53072420, "link": "https://stackoverflow.com/questions/53072420/trying-to-replace-varn-in-a-string-with-actual-values/53078310#53078310", "title": "Trying to replace {varN} in a string with actual values", "body": "<p>Ruby uses <code>%{</code>, not <code>{</code> for interpolation from hash:</p>\n\n<pre><code>s.gsub(\"{\", \"%{\") % { var1: \"foo\", var2: \"bar\" }\n# =&gt; \"my_string_foo___bar\"\n</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 10447327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5bbae0ed802a138f9f3ecc875095b904?s=128&d=identicon&r=PG&f=1", "display_name": "Nattemando", "link": "https://stackoverflow.com/users/10447327/nattemando"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 36, "favorite_count": 0, "answer_count": 2, "score": -4, "last_activity_date": 1540970884, "creation_date": 1540931347, "last_edit_date": 1540934449, "question_id": 53072420, "link": "https://stackoverflow.com/questions/53072420/trying-to-replace-varn-in-a-string-with-actual-values", "title": "Trying to replace {varN} in a string with actual values", "body": "<p>I have a string:</p>\n\n<pre><code>s = ExternalLibrary::get_string_data\n# ====&gt; my_string_{var1}___{var2}\n</code></pre>\n\n<p>I want to replace \"var1\" and \"var2\". This doesn't work:</p>\n\n<pre><code>s % {var1: \"aa\", var2: \"bb\"}\n# ====&gt; my_string_{var1}___{var2}\n</code></pre>\n"}, {"tags": ["ruby", "algorithm", "matrix", "matrix-multiplication"], "comments": [{"owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "edited": false, "score": 0, "creation_date": 1540930749, "post_id": 53072025, "comment_id": 93042981, "body": "Check this: <a href=\"https://ruby-doc.org/stdlib-2.5.1/libdoc/matrix/rdoc/Matrix.html#method-i-2A\" rel=\"nofollow noreferrer\">ruby-doc.org/stdlib-2.5.1/libdoc/matrix/rdoc/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": false, "score": 0, "last_activity_date": 1540931371, "creation_date": 1540931371, "answer_id": 53072426, "question_id": 53072025, "link": "https://stackoverflow.com/questions/53072025/how-to-perform-a-matrix-multiplicaton-on-ruby/53072426#53072426", "title": "How to perform a matrix multiplicaton on ruby?", "body": "<p>This doesn't do what you think it does:</p>\n\n<pre><code>result_matrix = [][]\n</code></pre>\n\n<p>That's trying to call the \"array indexing method\" (<code>[]</code>) on an empty array but doesn't pass any argument to the <code>[]</code> method. Operators are just methods with some syntactic sugar in Ruby so <code>[][]</code> is roughly equivalent to:</p>\n\n<pre><code>empty_array = []\nempty_array.[]()\n</code></pre>\n\n<p>where <code>.[]</code> is a call to the <code>[]</code> method (just like <code>obj.m</code> is a call to the <code>m</code> method) and <code>()</code> is an empty argument list.</p>\n\n<p>Ruby (like most languages) doesn't have multi-dimensional arrays, it has arrays-of-arrays so you could create the inner arrays the first time you need them:</p>\n\n<pre><code>result_matrix = [ ]\n#...\nresult_matrix[i]  ||= [ ]\nresult_matrix[i][j] = sum\n</code></pre>\n\n<p>instead of</p>\n\n<pre><code>result_matrix[i][j] = sum\n</code></pre>\n\n<p>Or you could prefill <code>result_matrix</code>:</p>\n\n<pre><code>result_matrix = Array.new(2) { [ ] }\n</code></pre>\n\n<p>See the <a href=\"http://ruby-doc.org/core/Array.html#method-c-new\" rel=\"nofollow noreferrer\">Array constructor docs</a> to see what's going on with that <code>Array.new</code> call.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9569704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 339, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1540931371, "creation_date": 1540929526, "question_id": 53072025, "link": "https://stackoverflow.com/questions/53072025/how-to-perform-a-matrix-multiplicaton-on-ruby", "title": "How to perform a matrix multiplicaton on ruby?", "body": "<p>Hi everyone in my Programming Paradigms class we just started to learn how to program in ruby. One exercise asks to implement a function that multiplyes two matrices.</p>\n\n<p>Using normally java I tried thinking making three bidimensional arrays and this is how I tries to implement it for two matrices 2x2:</p>\n\n<pre><code>def matrixmultiplicator(first_matrix, second_matrix)\n    result_matrix = [][]\n    first_matrix.each_index do |i|\n        second_matrix[i].each_index do |j|\n            sum = 0\n            //This loop range is just a test for two 2x2 matrices\n            (0..1).each do |k|\n                sum = sum +(first_matrix[i][j+k] * second_matrix[j+k][i])\n            end\n        result_matrix[i][j] = sum\n        end\n    end\nend\n\nmatrixmultiplicator([[1, 2], [3, 4]], [[2, 3], [3, 3]])\n</code></pre>\n\n<p>unfortunately I recive this error:\nwrong number of arguments (given 0, expected 1..2) (ArgumentError)</p>\n\n<p>Could someone help me?\nThank you in advance</p>\n"}, {"tags": ["arrays", "ruby", "sorting"], "answers": [{"comments": [{"owner": {"reputation": 402, "user_id": 729739, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dc624940d049dab86c6af5e6dc79765a?s=128&d=identicon&r=PG", "display_name": "Bruce P. Henry", "link": "https://stackoverflow.com/users/729739/bruce-p-henry"}, "edited": false, "score": 0, "creation_date": 1540928677, "post_id": 53071682, "comment_id": 93042005, "body": "Yup! I got the wrong method on the array. I knew this was dumb."}, {"owner": {"reputation": 402, "user_id": 729739, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dc624940d049dab86c6af5e6dc79765a?s=128&d=identicon&r=PG", "display_name": "Bruce P. Henry", "link": "https://stackoverflow.com/users/729739/bruce-p-henry"}, "edited": false, "score": 0, "creation_date": 1540929189, "post_id": 53071682, "comment_id": 93042245, "body": "For the record, I&#39;m planning on building MUCH more complex comparison functions for sorting the array. But I wanted to get a SUPER simple version working first before I start layering on complexity."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "reply_to_user": {"reputation": 402, "user_id": 729739, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dc624940d049dab86c6af5e6dc79765a?s=128&d=identicon&r=PG", "display_name": "Bruce P. Henry", "link": "https://stackoverflow.com/users/729739/bruce-p-henry"}, "edited": false, "score": 0, "creation_date": 1540932563, "post_id": 53071682, "comment_id": 93043759, "body": "That&#39;s fair. Just keep in mind that <code>sort_by</code> operates <i>N</i> times and <code>sort</code> operates on average <i>N x log(N)</i> times, which can be a lot more. In almost all cases <code>sort_by</code> is the way to go. It&#39;s when you need to write very complex tie-breaking rules that the other comes into play, but if you can express each entry as a sortable value, which can include arrays (e.g. <code>[ a.effort, a.tie_breaker ]</code>) then <code>sort_by</code> can do the job."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "reply_to_user": {"reputation": 402, "user_id": 729739, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dc624940d049dab86c6af5e6dc79765a?s=128&d=identicon&r=PG", "display_name": "Bruce P. Henry", "link": "https://stackoverflow.com/users/729739/bruce-p-henry"}, "edited": false, "score": 0, "creation_date": 1540932696, "post_id": 53071682, "comment_id": 93043836, "body": "Remember when writing a <code>sort</code> function that if <code>a</code> sorts before <code>b</code> then <code>b</code> <i>must</i> sort after <code>a</code>. This sounds obvious, but it&#39;s not hard to introduce rock-paper-scissors type loops in your logic where <code>rock,paper,scissors</code> and <code>scissors,paper,rock</code> are both valid sort orders. That leads to inconsistent output."}], "tags": [], "owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "is_accepted": true, "score": 3, "last_activity_date": 1540928105, "creation_date": 1540928105, "answer_id": 53071682, "question_id": 53071629, "link": "https://stackoverflow.com/questions/53071629/ruby-sort-by-for-array-of-objects/53071682#53071682", "title": "ruby sort_by! for array of objects", "body": "<p>The <code>sort</code> method requires a comparison block (a vs. b) but the <code>sort_by</code> method only takes one argument, the element being sorted, and you're expected to return a transformed version if necessary, the way you want it sorted.</p>\n\n<p>In your case it's this:</p>\n\n<pre><code>backlog.sort_by! { |e| e.effort }\n</code></pre>\n\n<p>Or more concisely:</p>\n\n<pre><code>backlog.sort_by!(&amp;:effort)\n</code></pre>\n\n<p>Your original code would work if you use the correct method:</p>\n\n<pre><code>backlog.sort! {|opA,opB| opA.effort &lt;=&gt; opB.effort }\n</code></pre>\n\n<p>Where that's a lot more code than the <code>sort_by</code> alternative, but it does the job just the same. Generally <code>sort_by</code> performs better, it only transforms once per sort pass. The other function must transform once per <em>comparison</em>, of which there are usually a lot more than entries in an array, especially at larger array sizes.</p>\n\n<blockquote><strong>NOTE:</strong> In Ruby capital letters have significant contextual meaning, so variable and method names should be in <code>lower_case</code> only form. Capitals are reserved for <code>ClassName</code> and <code>CONSTANT_NAME</code> situations.\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": false, "score": -1, "last_activity_date": 1540928625, "last_edit_date": 1540928625, "creation_date": 1540928304, "answer_id": 53071719, "question_id": 53071629, "link": "https://stackoverflow.com/questions/53071629/ruby-sort-by-for-array-of-objects/53071719#53071719", "title": "ruby sort_by! for array of objects", "body": "<p>First, <a href=\"https://stackoverflow.com/a/53071682/14660\">fix your <code>sort_by</code> as per @tadman's answer</a>.</p>\n\n<pre><code>backlog.sort_by!(&amp;:effort)\n</code></pre>\n\n<blockquote>\n  <p><em>So I KNOW there's an array of non-NULL objects there because that \"6\" on the first line of output is non-Null.</em></p>\n</blockquote>\n\n<p>You only checked the first element of <code>workingBacklog.backlog</code>. There could still be a <code>nil</code> somewhere further in your <code>backlog</code> array.</p>\n\n<p>Look for <code>nil</code> with a <code>select.with_index</code>.</p>\n\n<pre><code>backlog.select.with_index { |obj,idx|\n  puts \"nil at #{idx}\" if obj == nil\n}\n</code></pre>\n\n<p>Here's an example that also reproduces the error.</p>\n\n<pre><code>backlog = [Opportunity.new(3, 4), nil]\nputs backlog[0].effort\nbacklog.sort_by!(&amp;:effort)\n\n4    \n/Users/schwern/tmp/test.rb:16:in `each': undefined method `effort' for nil:NilClass (NoMethodError)\n    from /Users/schwern/tmp/test.rb:16:in `sort_by'\n    from /Users/schwern/tmp/test.rb:16:in `sort_by!'\n    from /Users/schwern/tmp/test.rb:16:in `&lt;main&gt;'\n</code></pre>\n"}], "owner": {"reputation": 402, "user_id": 729739, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dc624940d049dab86c6af5e6dc79765a?s=128&d=identicon&r=PG", "display_name": "Bruce P. Henry", "link": "https://stackoverflow.com/users/729739/bruce-p-henry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "accepted_answer_id": 53071682, "answer_count": 2, "score": 0, "last_activity_date": 1540928625, "creation_date": 1540927888, "question_id": 53071629, "link": "https://stackoverflow.com/questions/53071629/ruby-sort-by-for-array-of-objects", "title": "ruby sort_by! for array of objects", "body": "<p>Okay, I KNOW I'm just doing something dumb here, but I just cannot get this to work.</p>\n\n<p>I have an opportunity object</p>\n\n<pre><code>class Opportunity\n  attr_accessor :effort\n  attr_accessor :value\n\n  def initialize(effort,value)\n    # set values to 1 + the Rayleigh distribution (rounded) \n    @effort = 1 + (effort * Math.sqrt(0-2*Math.log(1-rand()))).round\n    @value = 1 + (value * Math.sqrt(0-2*Math.log(1-rand()))).round\n  end\nend\n</code></pre>\n\n<p>I push a set of these onto an array (that's a property of another object) and then I want to sort those by specific properties (like effort)</p>\n\n<pre><code>    # Order the working backlog\n    #  (see https://ruby-doc.org/core-2.4.3/Array.html#method-i-sort_by-21)\n    puts workingBacklog.backlog[0].effort\n    workingBacklog.backlog.sort_by! {|opA,opB| opA.effort &lt;=&gt; opB.effort }\n</code></pre>\n\n<p>Here's sample output...</p>\n\n<pre><code>6\n3cmc.rb:57:in `block (2 levels) in &lt;main&gt;': undefined method `effort' for \nnil:NilClass (NoMethodError)\n    from 3cmc.rb:57:in `each'\n    from 3cmc.rb:57:in `sort_by'\n    from 3cmc.rb:57:in `sort_by!'\n    from 3cmc.rb:57:in `block in &lt;main&gt;'\n    from 3cmc.rb:51:in `each'\n    from 3cmc.rb:51:in `&lt;main&gt;'\n</code></pre>\n\n<p>So I KNOW there's an array of non-NULL objects there because that \"6\" on the first line of output is non-Null. But right after that it looks like the proverbial wheels come off. What the heck is going on here?</p>\n"}, {"tags": ["ruby", "cryptography"], "comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 4, "creation_date": 1540932528, "post_id": 53071071, "comment_id": 93043740, "body": "So here is a rabbit hole to run down <a href=\"https://github.com/ruby/ruby/blob/ruby_2_5/array.c#L4759\" rel=\"nofollow noreferrer\">sample</a> and all the other calls are available in <a href=\"https://github.com/ruby/ruby/blob/ruby_2_5/random.c\" rel=\"nofollow noreferrer\">random.c</a>. So it appears <a href=\"https://ruby-doc.org/core-2.5.0/Random.html\" rel=\"nofollow noreferrer\">Random</a> class might be what you are actually asking about which states &quot;PRNGs are currently implemented as a modified Mersenne Twister with a period of 2**19937-1.&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 2, "creation_date": 1540995260, "post_id": 53081631, "comment_id": 93067664, "body": "Sidenote: Your code snippet is from ruby &lt; 2.5 (2.5 <a href=\"https://github.com/ruby/ruby/blob/ruby_2_5/array.c#L4862\" rel=\"nofollow noreferrer\"><code>Array#sample</code></a>) but your reference to <code>Random</code> is 2.5.0 (which is different than <code>Random</code> &lt; 2.5)"}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 2, "creation_date": 1541000157, "post_id": 53081631, "comment_id": 93071051, "body": "just because <code>Kernel#rand</code> is the same does not mean <code>Random</code> class is the same <a href=\"https://github.com/ruby/ruby/blob/ruby_2_5/random.c#L633\" rel=\"nofollow noreferrer\">2.4 random_raw_seed <code>Random::raw_seed</code></a> vs <a href=\"https://github.com/ruby/ruby/blob/ruby_2_5/random.c#L633\" rel=\"nofollow noreferrer\">2.5 random_raw_seed <code>Random::urandom</code></a> which bleeds into <code>fill_random_bytes_urandom</code> so since the way the random seed is generated changed I would still say yes it has changed albeit minor modifications that are not impactful to the answer. <a href=\"https://github.com/ruby/ruby/commits/ruby_2_5/random.c\" rel=\"nofollow noreferrer\">Commits</a>"}, {"owner": {"reputation": 21271, "user_id": 168143, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/75fb60cc633a994debfe8b3a19eb91cb?s=128&d=identicon&r=PG", "display_name": "John Bachir", "link": "https://stackoverflow.com/users/168143/john-bachir"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 1, "creation_date": 1541008674, "post_id": 53081631, "comment_id": 93075852, "body": "@engineersmnky - thanks for pointing this stuff out! looks like you accidentally linked to the 2.5 source in your 2.4 link above."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "reply_to_user": {"reputation": 21271, "user_id": 168143, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/75fb60cc633a994debfe8b3a19eb91cb?s=128&d=identicon&r=PG", "display_name": "John Bachir", "link": "https://stackoverflow.com/users/168143/john-bachir"}, "edited": false, "score": 2, "creation_date": 1541008748, "post_id": 53081631, "comment_id": 93075888, "body": "@JohnBachir you are correct sorry <a href=\"https://github.com/ruby/ruby/blob/ruby_2_4/random.c#L613\" rel=\"nofollow noreferrer\">Correct Link</a>"}], "tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": true, "score": 1, "last_activity_date": 1541007919, "last_edit_date": 1541007919, "creation_date": 1540983117, "answer_id": 53081631, "question_id": 53071071, "link": "https://stackoverflow.com/questions/53071071/what-randomness-algorithm-does-arraysample-use/53081631#53081631", "title": "What randomness algorithm does Array#sample use?", "body": "<p>I find it helpful to dig in pry to examine actual source code although you can find it also by going to <a href=\"https://ruby-doc.org/core-2.5.0/Array.html#sample\" rel=\"nofollow noreferrer\">Ruby Docs</a> and hover the method names to reveal the <code>click to toggle source</code> with magnifying glass which will also show you the same source code you can find here in pry, if you've done <code>gem install pry-doc</code></p>\n\n<pre class=\"lang-c prettyprint-override\"><code>arr = []\ncd arr\nshow-method sample\n\n(#&lt;Array&gt;):1&gt; show-method sample\n\nFrom: array.c (C Method):\nOwner: Array\nVisibility: public\nNumber of lines: 103\n\nstatic VALUE\nrb_ary_sample(int argc, VALUE *argv, VALUE ary)\n{\n    VALUE nv, result;\n    VALUE opts, randgen = rb_cRandom;\n    long n, len, i, j, k, idx[10];\n    long rnds[numberof(idx)];\n\n    if (OPTHASH_GIVEN_P(opts)) {\n        VALUE rnd;\n        ID keyword_ids[1];\n\n        keyword_ids[0] = id_random;\n        rb_get_kwargs(opts, keyword_ids, 0, 1, &amp;rnd);\n        if (rnd != Qundef) {\n            randgen = rnd;\n        }\n    }\n    len = RARRAY_LEN(ary);\n    if (argc == 0) {\n        if (len &lt; 2)\n            i = 0;\n        else\n            i = RAND_UPTO(len);\n\n        return rb_ary_elt(ary, i);\n    }\n    rb_scan_args(argc, argv, \"1\", &amp;nv);\n    n = NUM2LONG(nv);\n    if (n &lt; 0) rb_raise(rb_eArgError, \"negative sample number\");\n    if (n &gt; len) n = len;\n    if (n &lt;= numberof(idx)) {\n        for (i = 0; i &lt; n; ++i) {\n            rnds[i] = RAND_UPTO(len - i);\n        }\n    }\n    k = len;\n    len = RARRAY_LEN(ary);\n    if (len &lt; k &amp;&amp; n &lt;= numberof(idx)) {\n        for (i = 0; i &lt; n; ++i) {\n            if (rnds[i] &gt;= len) return rb_ary_new_capa(0);\n        }\n    }\n    if (n &gt; len) n = len;\n    switch (n) {\n      case 0:\n        return rb_ary_new_capa(0);\n      case 1:\n        i = rnds[0];\n        return rb_ary_new_from_values(1, &amp;RARRAY_AREF(ary, i));\n      case 2:\n        i = rnds[0];\n        j = rnds[1];\n        if (j &gt;= i) j++;\n        return rb_ary_new_from_args(2, RARRAY_AREF(ary, i), RARRAY_AREF(ary, j));\n      case 3:\n        i = rnds[0];\n        j = rnds[1];\n        k = rnds[2];\n        {\n            long l = j, g = i;\n            if (j &gt;= i) l = i, g = ++j;\n            if (k &gt;= l &amp;&amp; (++k &gt;= g)) ++k;\n        }\n        return rb_ary_new_from_args(3, RARRAY_AREF(ary, i), RARRAY_AREF(ary, j), RARRAY_AREF(ary, k));\n    }\n    if (n &lt;= numberof(idx)) {\n        long sorted[numberof(idx)];\n        sorted[0] = idx[0] = rnds[0];\n        for (i=1; i&lt;n; i++) {\n            k = rnds[i];\n            for (j = 0; j &lt; i; ++j) {\n                if (k &lt; sorted[j]) break;\n                ++k;\n            }\n            memmove(&amp;sorted[j+1], &amp;sorted[j], sizeof(sorted[0])*(i-j));\n            sorted[j] = idx[i] = k;\n        }\n        result = rb_ary_new_capa(n);\n        RARRAY_PTR_USE(result, ptr_result, {\n            for (i=0; i&lt;n; i++) {\n                ptr_result[i] = RARRAY_AREF(ary, idx[i]);\n            }\n        });\n    }\n    else {\n        result = rb_ary_dup(ary);\n        RBASIC_CLEAR_CLASS(result);\n        RB_GC_GUARD(ary);\n        RARRAY_PTR_USE(result, ptr_result, {\n            for (i=0; i&lt;n; i++) {\n                j = RAND_UPTO(len-i) + i;\n                nv = ptr_result[j];\n                ptr_result[j] = ptr_result[i];\n                ptr_result[i] = nv;\n            }\n        });\n        RBASIC_SET_CLASS_RAW(result, rb_cArray);\n    }\n    ARY_SET_LEN(result, n);\n\n    return result;\n}\n</code></pre>\n\n<p>So we can see </p>\n\n<pre class=\"lang-c prettyprint-override\"><code>    VALUE opts, randgen = rb_cRandom;\n</code></pre>\n\n<p>This would indicate the ruby Random class c is used for the randomness.</p>\n\n<p>The code alone wouldn't tell us much about the algo</p>\n\n<p>So lookup of <a href=\"https://ruby-doc.org/core-2.5.0/Random.html\" rel=\"nofollow noreferrer\">https://ruby-doc.org/core-2.5.0/Random.html</a> tells us it uses</p>\n\n<blockquote>\n  <p>PRNGs are currently implemented as a modified Mersenne Twister with a period of 2**19937-1.</p>\n</blockquote>\n\n<p>And what the heck is a <code>Mersenne Twister</code>?  I don't know but it sounds cool \ud83d\ude0e so <a href=\"https://en.wikipedia.org/wiki/Mersenne_Twister\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Mersenne_Twister</a> tells us about it and that it is exstensively used:</p>\n\n<blockquote>\n  <p>The Mersenne Twister is the default PRNG for the following software systems: Microsoft Excel,[3] GAUSS,[4] GLib,[5] GNU Multiple Precision Arithmetic Library,[6] GNU Octave,[7] GNU Scientific Library,[8] gretl,[9] IDL,[10] Julia,[11] CMU Common Lisp,[12] Embeddable Common Lisp,[13] Steel Bank Common Lisp,[14] Maple,[15] MATLAB,[16] Free Pascal,[17] PHP,[18] Python,[19][20] R,[21] Ruby,[22] SageMath,[23] Scilab,[24] Stata.[25]</p>\n</blockquote>\n"}], "owner": {"reputation": 21271, "user_id": 168143, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/75fb60cc633a994debfe8b3a19eb91cb?s=128&d=identicon&r=PG", "display_name": "John Bachir", "link": "https://stackoverflow.com/users/168143/john-bachir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 53081631, "answer_count": 1, "score": 2, "last_activity_date": 1541007919, "creation_date": 1540925517, "question_id": 53071071, "link": "https://stackoverflow.com/questions/53071071/what-randomness-algorithm-does-arraysample-use", "title": "What randomness algorithm does Array#sample use?", "body": "<p>I'm trying to figure out which random algorithm <code>Array#sample</code> uses, but I'm getting a bit lost hunting around in the Ruby C code.</p>\n"}, {"tags": ["ruby", "regex"], "comments": [{"owner": {"reputation": 43580, "user_id": 1020526, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/Scjj8.jpg?s=128&g=1", "display_name": "revo", "link": "https://stackoverflow.com/users/1020526/revo"}, "edited": false, "score": 1, "creation_date": 1540923928, "post_id": 53070570, "comment_id": 93039667, "body": "A quick solution would be using <code>\\s*\\|\\s*(?![^{\\[]*[]}])</code>. See live demo here <a href=\"https://regex101.com/r/dEDcAS/1\" rel=\"nofollow noreferrer\">regex101.com/r/dEDcAS/1</a>"}, {"owner": {"reputation": 253873, "user_id": 9515207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34932d3e923ffad9a4a1423e30b1d9fc?s=128&d=identicon&r=PG&f=1", "display_name": "CertainPerformance", "link": "https://stackoverflow.com/users/9515207/certainperformance"}, "reply_to_user": {"reputation": 43580, "user_id": 1020526, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/Scjj8.jpg?s=128&g=1", "display_name": "revo", "link": "https://stackoverflow.com/users/1020526/revo"}, "edited": false, "score": 0, "creation_date": 1540924205, "post_id": 53070570, "comment_id": 93039816, "body": "@revo&#39;s suggestion looks great, I hope you can remove the <code>{{</code> <code>}}</code>s <i>after</i> splitting, rather than before, else it may be much more difficult"}, {"owner": {"reputation": 481662, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1540925176, "post_id": 53070570, "comment_id": 93040248, "body": "To write a parser for a markup language, you are likely to need a whole group of regexps that should fit.If we assume you want to match 1 or more word chars that can be followed with an optional sequence of <code>=</code>, then 1 or more sequences of <code>{{...}}</code> (with no nested <code>{{...}}</code>), <code>[[...]]</code> (with no nested <code>[[...]]</code>) or any char other than <code>|</code>, <code>[</code> and <code>{</code>, you may use <code>s.scan(&#47;\\w+(?:\\s*=\\s*(?:\\[\\[[^\\]\\[]*]]|{{[^{}]*}}|[^|{\\[])*)&zwnj;&#8203;?&#47;)</code>,see <a href=\"http://rubular.com/r/xowHisf1K9\" rel=\"nofollow noreferrer\">this demo</a>.It may be further enhanced, but without  knowing what you run before or after, it is hard to say if it works for you."}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1540927469, "post_id": 53070570, "comment_id": 93041419, "body": "in your example output it looks like you have a new line after <code>person</code> but no comma after it.  Also it shows single quotes.  Do you want an array or a string output that looks like an array?"}, {"owner": {"reputation": 2096, "user_id": 2108990, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/886481640b3ab8f05cdf3be8c0efdad6?s=128&d=identicon&r=PG", "display_name": "Zack", "link": "https://stackoverflow.com/users/2108990/zack"}, "reply_to_user": {"reputation": 43580, "user_id": 1020526, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/Scjj8.jpg?s=128&g=1", "display_name": "revo", "link": "https://stackoverflow.com/users/1020526/revo"}, "edited": false, "score": 0, "creation_date": 1540967006, "post_id": 53070570, "comment_id": 93052466, "body": "@revo your solution was actually spot on. If you want to post that as an answer I will gladly give it the check. Worked exactly for what I needed!"}, {"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1540977714, "post_id": 53070570, "comment_id": 93057280, "body": "Your expected result is invalid."}], "answers": [{"comments": [{"owner": {"reputation": 43580, "user_id": 1020526, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/Scjj8.jpg?s=128&g=1", "display_name": "revo", "link": "https://stackoverflow.com/users/1020526/revo"}, "edited": false, "score": 1, "creation_date": 1540925430, "post_id": 53070984, "comment_id": 93040380, "body": "Did you read last line <i>...there can be linebreaks at any point so can&#39;t just look for <code>\\n|</code></i>?"}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "reply_to_user": {"reputation": 43580, "user_id": 1020526, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/Scjj8.jpg?s=128&g=1", "display_name": "revo", "link": "https://stackoverflow.com/users/1020526/revo"}, "edited": false, "score": 0, "creation_date": 1540927077, "post_id": 53070984, "comment_id": 93041206, "body": "This should give the requested result now"}], "tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": false, "score": -2, "last_activity_date": 1540926787, "last_edit_date": 1540926787, "creation_date": 1540925220, "answer_id": 53070984, "question_id": 53070570, "link": "https://stackoverflow.com/questions/53070570/regex-to-match-pipes-not-within-brackets-or-braces/53070984#53070984", "title": "Regex to match pipes not within brackets or braces", "body": "<p>I literally stole the regex from @WiktorStribi\u017cew but this should work for your input string</p>\n\n<pre><code>regex = (/\\w+(?:\\s*=\\s*(?:\\[\\[[^\\]\\[]*]]|{{[^{}]*}}|[^|{\\[])*)?/)\narr = str.scan(regex).map{|l| l.strip.delete(\"\\n\")}[1..-1]\n</code></pre>\n\n<p><code>arr</code> is now the array you've requested.</p>\n"}, {"comments": [{"owner": {"reputation": 2096, "user_id": 2108990, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/886481640b3ab8f05cdf3be8c0efdad6?s=128&d=identicon&r=PG", "display_name": "Zack", "link": "https://stackoverflow.com/users/2108990/zack"}, "edited": false, "score": 0, "creation_date": 1541004853, "post_id": 53078273, "comment_id": 93073903, "body": "so this works about 95%. I found a case that doesn&#39;t work though and hoping you can help? <a href=\"https://regex101.com/r/dEDcAS/2\" rel=\"nofollow noreferrer\">regex101.com/r/dEDcAS/2</a>"}, {"owner": {"reputation": 43580, "user_id": 1020526, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/Scjj8.jpg?s=128&g=1", "display_name": "revo", "link": "https://stackoverflow.com/users/1020526/revo"}, "reply_to_user": {"reputation": 2096, "user_id": 2108990, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/886481640b3ab8f05cdf3be8c0efdad6?s=128&d=identicon&r=PG", "display_name": "Zack", "link": "https://stackoverflow.com/users/2108990/zack"}, "edited": false, "score": 1, "creation_date": 1541008122, "post_id": 53078273, "comment_id": 93075570, "body": "Actually you can&#39;t adjust this for nested blocks. You&#39;d better ask another question since that would be totally different."}, {"owner": {"reputation": 2096, "user_id": 2108990, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/886481640b3ab8f05cdf3be8c0efdad6?s=128&d=identicon&r=PG", "display_name": "Zack", "link": "https://stackoverflow.com/users/2108990/zack"}, "edited": false, "score": 1, "creation_date": 1541008619, "post_id": 53078273, "comment_id": 93075818, "body": "Copy that! Much appreciated."}], "tags": [], "owner": {"reputation": 43580, "user_id": 1020526, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/Scjj8.jpg?s=128&g=1", "display_name": "revo", "link": "https://stackoverflow.com/users/1020526/revo"}, "is_accepted": true, "score": 1, "last_activity_date": 1540970768, "creation_date": 1540970768, "answer_id": 53078273, "question_id": 53070570, "link": "https://stackoverflow.com/questions/53070570/regex-to-match-pipes-not-within-brackets-or-braces/53078273#53078273", "title": "Regex to match pipes not within brackets or braces", "body": "<p>You could split on:</p>\n\n<pre><code>\\s*\\|\\s*(?![^{\\[]*[]}])\n</code></pre>\n\n<p>Breakdown:</p>\n\n<ul>\n<li><code>\\s*\\|\\s*</code> Match a pipe with any leading or trailing whitespaces</li>\n<li><code>(?!</code> Start of negative lookahead\n\n<ul>\n<li><code>[^{\\[]*</code> Match anything except <code>{</code> and <code>[</code> as much as possible</li>\n<li><code>[]}]</code> Up to a closing <code>]</code> or <code>}</code></li>\n</ul></li>\n<li><code>)</code> End of negative lookahead</li>\n</ul>\n\n<p>The negative lookahead asserts that we shouldn't reach <code>}</code> or <code>]</code> without matching an opening pair.</p>\n\n<p>See <a href=\"https://regex101.com/r/dEDcAS/1\" rel=\"nofollow noreferrer\">live demo here</a></p>\n"}], "owner": {"reputation": 2096, "user_id": 2108990, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/886481640b3ab8f05cdf3be8c0efdad6?s=128&d=identicon&r=PG", "display_name": "Zack", "link": "https://stackoverflow.com/users/2108990/zack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 53078273, "answer_count": 2, "score": 0, "last_activity_date": 1541559370, "creation_date": 1540923751, "last_edit_date": 1541559370, "question_id": 53070570, "link": "https://stackoverflow.com/questions/53070570/regex-to-match-pipes-not-within-brackets-or-braces", "title": "Regex to match pipes not within brackets or braces", "body": "<p>I am trying to parse some wiki markup. For example, the following:</p>\n\n<pre><code>{{Infobox \n| person\n| name = Joe\n| title = Ruler\n| location = [[United States|USA]] | height = {{convert|12|m|abbr=on}}\n| note = &lt;ref&gt;{{cite book|title= Some Book}}&lt;/ref&gt;  \n}}\n</code></pre>\n\n<p>can be the text to start with. I first remove the starting <code>{{</code> and ending <code>}}</code>, so I can assume those are gone.</p>\n\n<p>I want to do <code>.split(&lt;regex&gt;)</code> on the string to split the string by all <code>|</code> characters that are not within braces or brackets. The regex needs to ignore the <code>|</code> characters in <code>[[United States|USA]]</code>, <code>{{convert|12|m|abbr=on}}</code>, and <code>{{cite book|title= Some Book}}</code>. The expected result is:</p>\n\n<pre><code>[\n 'person'\n 'name = Joe', \n 'title = Ruler', \n 'location = [[United States|USA]]',\n 'height = {{convert|12|m|abbr=on}}',\n 'note = &lt;ref&gt;{{cite book|title= Some Book}}&lt;/ref&gt;'\n]\n</code></pre>\n\n<p>There can be line breaks at any point, so I can't just look for <code>\\n|</code>.  If there is extra white space in it, that is fine. I can easily strip out extra <code>\\s*</code> or <code>\\n*</code>.</p>\n"}, {"tags": ["html", "ruby"], "comments": [{"owner": {"reputation": 37, "user_id": 7571813, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e820b5e909e4d68e64f7e281bd9fed4?s=128&d=identicon&r=PG&f=1", "display_name": "Ruby_Learner", "link": "https://stackoverflow.com/users/7571813/ruby-learner"}, "edited": false, "score": 0, "creation_date": 1540921185, "post_id": 53069923, "comment_id": 93038316, "body": "prints as &lt;a href = &quot;File://C://Users&quot;&gt;C://Users&lt;/a&gt; and not &quot;C://Users&quot;, editor changed it somehow."}, {"owner": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "edited": false, "score": 0, "creation_date": 1540922998, "post_id": 53069923, "comment_id": 93039227, "body": "You&#39;re telling it to print <code>&lt;a href=&quot;File:&#47;&#47;C:&#47;&#47;Users&quot;&gt;C:&#47;&#47;Users&lt;&#47;a&gt;</code> and that&#39;s what it&#39;s doing so what is your expected outcome? Are you trying to make it possible to click <code>C:&#47;&#47;Users</code> in your console IRB session, and then have it open Windows Explorer? Because <code>&lt;a href&gt;</code> is HTML and that won&#39;t render in any console on any platform, and won&#39;t work the way you&#39;re hoping. On Linux/UNIX/macOS/etc. terminals you can generally click plaintext paths like <code>&#47;Users&#47;foo</code> and have it open, but that is a function of the terminal/console and has nothing to do with your code. The console must support it."}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1540923245, "post_id": 53069923, "comment_id": 93039358, "body": "What editor? How are you running this code? Please improve your question see <a href=\"https://stackoverflow.com/help/how-to-ask\">stackoverflow.com/help/how-to-ask</a>"}, {"owner": {"reputation": 37, "user_id": 7571813, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e820b5e909e4d68e64f7e281bd9fed4?s=128&d=identicon&r=PG&f=1", "display_name": "Ruby_Learner", "link": "https://stackoverflow.com/users/7571813/ruby-learner"}, "edited": false, "score": 0, "creation_date": 1540924485, "post_id": 53069923, "comment_id": 93039958, "body": "I am running it in Intellij. I want to print the file path as a clickable link in console output"}], "answers": [{"tags": [], "owner": {"reputation": 426, "user_id": 8287207, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PZ5Cf.jpg?s=128&g=1", "display_name": "Alexey Strizhak", "link": "https://stackoverflow.com/users/8287207/alexey-strizhak"}, "is_accepted": false, "score": 0, "last_activity_date": 1540925054, "last_edit_date": 1540925054, "creation_date": 1540924217, "answer_id": 53070717, "question_id": 53069923, "link": "https://stackoverflow.com/questions/53069923/converting-file-path-to-clickable-hyperlink-ruby/53070717#53070717", "title": "Converting file path to clickable hyperlink ruby", "body": "<p>you can use npm package for this: <a href=\"https://github.com/sindresorhus/terminal-link\" rel=\"nofollow noreferrer\">https://github.com/sindresorhus/terminal-link</a></p>\n\n<p>Example:</p>\n\n<pre><code>            mifrill@mifrill-desktop:~$ npm install terminal-link\n\n            npm WARN saveError ENOENT: no such file or directory, open '/home/mifrill/package.json'\n            npm notice created a lockfile as package-lock.json. You should commit this file.\n            npm WARN enoent ENOENT: no such file or directory, open '/home/mifrill/package.json'\n            npm WARN mifrill No description\n            npm WARN mifrill No repository field.\n            npm WARN mifrill No README data\n            npm WARN mifrill No license field.\n\n            + terminal-link@1.1.0\n            added 6 packages from 2 contributors and audited 6 packages in 2.868s\n            found 0 vulnerabilities\n</code></pre>\n\n<p>_</p>\n\n<pre><code>            mifrill@mifrill-desktop:~$ node\n\n            &gt; const terminalLink = require('terminal-link');\n            undefined\n</code></pre>\n\n<p>_</p>\n\n<pre><code>            &gt; console.log(terminalLink('file', 'C://Users'))\n\n            file\n</code></pre>\n\n<p>This string (file) would be clickable</p>\n\n<p>Or you can use just special characters (on ruby):</p>\n\n<pre><code>irb\nlink  = 'C://Users'\ntitle = 'File'\nputs \"\\u001b]8;;#{link}\\u0007#{title}\\u001b]8;;\\u0007\"\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 7571813, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e820b5e909e4d68e64f7e281bd9fed4?s=128&d=identicon&r=PG&f=1", "display_name": "Ruby_Learner", "link": "https://stackoverflow.com/users/7571813/ruby-learner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 329, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1540925054, "creation_date": 1540921054, "last_edit_date": 1540924888, "question_id": 53069923, "link": "https://stackoverflow.com/questions/53069923/converting-file-path-to-clickable-hyperlink-ruby", "title": "Converting file path to clickable hyperlink ruby", "body": "<p>I am trying to print out a file path which should be displayed as a link in Intellij console output. I have tried doing the following</p>\n\n<pre><code>    file_path =  'C://Users'\n    puts '&lt;a href= \"File:///' + file_path + '\"&gt;'+ file_path + '&lt;/a&gt;'\n</code></pre>\n\n<p>This just prints me a statement C://Users but does not change it to clickable link. Please let me know what am I missing to convert it into clickable link. </p>\n"}, {"tags": ["arrays", "ruby"], "answers": [{"tags": [], "owner": {"reputation": 4866, "user_id": 6603195, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nZGPkfcc0EE/AAAAAAAAAAI/AAAAAAAAAoE/op-TBiFRNzg/photo.jpg?sz=128", "display_name": "Marcin Ko\u0142odziej", "link": "https://stackoverflow.com/users/6603195/marcin-ko%c5%82odziej"}, "is_accepted": true, "score": 4, "last_activity_date": 1540914599, "creation_date": 1540914599, "answer_id": 53068170, "question_id": 53068106, "link": "https://stackoverflow.com/questions/53068106/ruby-hash-dig-or-return-nil-if-not-possible/53068170#53068170", "title": "Ruby hash dig or return nil if not possible", "body": "<p>I'd simply go for</p>\n\n<pre><code>the_data.dig('foo', 'bar', 0, 'baz', 'fuzz').to_a.map\n</code></pre>\n\n<p>as </p>\n\n<pre><code>nil.to_a == []\n</code></pre>\n\n<p>You'll try to map an empty array, which will simply not do anything and return an empty array again.</p>\n"}, {"comments": [{"owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "edited": false, "score": 1, "creation_date": 1540920748, "post_id": 53069220, "comment_id": 93038099, "body": "Using a default value would also work. <code>fuzz = the_data.dig(&#39;foo&#39;, &#39;bar&#39;, 0, &#39;baz&#39;, &#39;fuzz&#39;) || []</code> working further with the <code>fuzz</code> variable."}, {"owner": {"reputation": 69864, "user_id": 421018, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/e8lcr.jpg?s=128&g=1", "display_name": "Fogmeister", "link": "https://stackoverflow.com/users/421018/fogmeister"}, "edited": false, "score": 0, "creation_date": 1540921123, "post_id": 53069220, "comment_id": 93038284, "body": "Excellent, thanks very much. Will definitely be back here for reference in the future :D"}, {"owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "reply_to_user": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1540937286, "post_id": 53069220, "comment_id": 93045371, "body": "@CarySwoveland Did you see my example? The safe navigator is not meant for <i>dig</i>. It&#39;s meant to only call <i>map</i> if <i>dig</i> doesn&#39;t results in <code>nil</code>."}, {"owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "reply_to_user": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1540986750, "post_id": 53069220, "comment_id": 93062170, "body": "@CarySwoveland Np, we all have those days. ;-)"}], "tags": [], "owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "is_accepted": false, "score": 3, "last_activity_date": 1540919535, "last_edit_date": 1540919535, "creation_date": 1540918171, "answer_id": 53069220, "question_id": 53068106, "link": "https://stackoverflow.com/questions/53068106/ruby-hash-dig-or-return-nil-if-not-possible/53069220#53069220", "title": "Ruby hash dig or return nil if not possible", "body": "<p>You could use the <a href=\"https://bugs.ruby-lang.org/issues/11537\" rel=\"nofollow noreferrer\">safe navigation operator</a> <code>&amp;.</code> (introduced in Ruby 2.3).</p>\n\n<pre><code>some_variable&amp;.some_method\n# is equivalent to\nsome_variable.nil? ? nil : some_variable.some_method\n# or\nsome_variable.some_method unless some_variable.nil?\n</code></pre>\n\n<p>Since both <a href=\"http://ruby-doc.org/core-2.5.3/Array.html#method-i-dig\" rel=\"nofollow noreferrer\"><em>Array#dig</em></a> and <a href=\"http://ruby-doc.org/core-2.5.3/Hash.html#method-i-dig\" rel=\"nofollow noreferrer\"><em>Hash#dig</em></a> return <code>nil</code> if any intermediate step is <code>nil</code> this should meet your requirement. Skipping the <em>map</em> call if the resulting value is <code>nil</code>.</p>\n\n<pre><code>the_data\n  .dig('foo', 'bar', 0, 'baz', 'fuzz')\n  &amp;.map ...\n</code></pre>\n\n<hr>\n\n<p>Another option is to save the data in a variable and use an <em>if</em> statement.</p>\n\n<pre><code>if fuzz = the_data.dig('foo', 'bar', 0, 'baz', 'fuzz')\n  fuzz.map ...\nend\n</code></pre>\n\n<hr>\n\n<p>Or if you're working in a method and can't proceed without the value you can add a guard that returns the method if the value is missing.</p>\n\n<pre><code>##\n# Does something.\n# \n# @param the_data [Hash] a JSON object that ...\n# @return [Array&lt;Object&gt;, nil] an array containing ... \n#   or nil if the JSON object doesn't has the correct structure \ndef some_method(the_data)\n  fuzz = the_data.dig('foo', 'bar', 0, 'baz', 'fuzz') or return\n  fuzz.map ...\nend\n</code></pre>\n"}], "owner": {"reputation": 69864, "user_id": 421018, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/e8lcr.jpg?s=128&g=1", "display_name": "Fogmeister", "link": "https://stackoverflow.com/users/421018/fogmeister"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1481, "favorite_count": 0, "accepted_answer_id": 53068170, "answer_count": 2, "score": 2, "last_activity_date": 1540919535, "creation_date": 1540914390, "question_id": 53068106, "link": "https://stackoverflow.com/questions/53068106/ruby-hash-dig-or-return-nil-if-not-possible", "title": "Ruby hash dig or return nil if not possible", "body": "<p>I have to access an array that is fairly deep into a JSON object to then map the contents of the array and return the new array.</p>\n\n<p>If the array exists -> mapped array contents</p>\n\n<p>If the array is empty... OR the array doesn't exist -> [] (empty array)</p>\n\n<p>I've tried doing a dig and map...</p>\n\n<p><code>the_data.dig('foo', 'bar', 0, 'baz', 'fuzz').map ...</code></p>\n\n<p><code>fuzz</code> is my array I want to map.</p>\n\n<p>But the part that fails is the part after <code>bar</code> because it is an empty array here.</p>\n\n<p>How can I safely fall back here?</p>\n"}, {"tags": ["ruby", "sinatra", "thin"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1540911942, "post_id": 53067147, "comment_id": 93032913, "body": "Why not use thin.yml?"}, {"owner": {"reputation": 93455, "user_id": 187141, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f9e28dc83496320c87c55b3cf988ab60?s=128&d=identicon&r=PG", "display_name": "yegor256", "link": "https://stackoverflow.com/users/187141/yegor256"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1540912627, "post_id": 53067147, "comment_id": 93033341, "body": "@SergioTulentsev how exactly? I&#39;m ready to use it, but how do I tell Thin where it&#39;s located?"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1540912715, "post_id": 53067147, "comment_id": 93033382, "body": "Through the command-line: <code>thin start -C config&#47;thin.yml</code>"}, {"owner": {"reputation": 93455, "user_id": 187141, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f9e28dc83496320c87c55b3cf988ab60?s=128&d=identicon&r=PG", "display_name": "yegor256", "link": "https://stackoverflow.com/users/187141/yegor256"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1540913659, "post_id": 53067147, "comment_id": 93034003, "body": "@SergioTulentsev I don&#39;t start my Sinatra app from the command line, as you see in the question above."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 2, "creation_date": 1540913770, "post_id": 53067147, "comment_id": 93034071, "body": "&quot;I don&#39;t start my Sinatra app from the command line&quot; - But of course you do, by doing <code>rackup</code> or something similar. By the time thin boots your app, it may be already too late to change its architecture. I am actually mildly surprised that sinatra lets you choose the handler in the first place. I shall find out how it&#39;s done."}, {"owner": {"reputation": 93455, "user_id": 187141, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f9e28dc83496320c87c55b3cf988ab60?s=128&d=identicon&r=PG", "display_name": "yegor256", "link": "https://stackoverflow.com/users/187141/yegor256"}, "reply_to_user": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1540913843, "post_id": 53067147, "comment_id": 93034129, "body": "@lacostenycoder yes, there are reasons. I would not ask this question here otherwise. I know how to configure it from command line. My business case is different."}], "answers": [{"comments": [{"owner": {"reputation": 93455, "user_id": 187141, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f9e28dc83496320c87c55b3cf988ab60?s=128&d=identicon&r=PG", "display_name": "yegor256", "link": "https://stackoverflow.com/users/187141/yegor256"}, "edited": false, "score": 0, "creation_date": 1541344183, "post_id": 53071095, "comment_id": 93175933, "body": "This example doesn&#39;t really work. If you change that <code>@threaded</code> to <code>@maximum_connections = 10</code> and run again, you will see in the logs that the value is still 1024, which is the default one."}], "tags": [], "owner": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "is_accepted": false, "score": 2, "last_activity_date": 1540925634, "creation_date": 1540925634, "answer_id": 53071095, "question_id": 53067147, "link": "https://stackoverflow.com/questions/53067147/how-to-configure-thin-web-server-from-sinatra/53071095#53071095", "title": "How to configure Thin web server from Sinatra?", "body": "<p>The thin web server is threaded by default when started in the way you describe.</p>\n\n<pre><code># thin_test.rb\nrequire 'sinatra/base'\n\nclass Front &lt; Sinatra::Base\n  configure do\n    set :server, :thin\n  end\n\n  get '/' do\n    'Hello, world!'\n  end \n\n  get '/foo' do\n    sleep 30\n    'bar'\n  end\nend\n\nFront.start!\n</code></pre>\n\n<p>Start with:</p>\n\n<pre><code>ruby thin_test.rb\n</code></pre>\n\n<p>Confirm with:</p>\n\n<pre><code># will hang for 30 seconds while sleeping\ncurl localhost:4567/foo\n\n# will complete successfully while the other request is pending\ncurl localhost:4567\nHello, world!\n</code></pre>\n\n<p>There is additional detail in <a href=\"https://stackoverflow.com/a/6282999/3784008\">this answer</a> about how Sinatra uses other web servers.</p>\n\n<p>If this doesn't work for some reason, it may be possible to hack together something with the <code>server_settings</code> option, which is generally only useful for WEBrick unless you use some undocumented ways to force it:</p>\n\n<pre><code>require 'sinatra/base'\nrequire 'thin'\n\nclass ThreadedThinBackend &lt; ::Thin::Backends::TcpServer\n  def initialize(host, port, options)\n    super(host, port)\n    @threaded = true\n  end\nend\n\nclass Front &lt; Sinatra::Base\n  configure do\n    set :server, :thin\n\n    class &lt;&lt; settings\n      def server_settings\n        { :backend =&gt; ThreadedThinBackend }\n      end\n    end\n  end\n\n  get '/' do\n    'Hello, world!'\n  end \n\n  get '/foo' do\n    sleep 30\n    'foobar'\n  end\nend\n\nFront.start!\n</code></pre>\n\n<p>It's hard for me to tell if this example is the cause of it being threaded though, because it starts in threaded mode by default. That said, it doesn't raise an exception and does run in threaded mode:</p>\n\n<pre><code># will hang for 30 seconds while sleeping\ncurl localhost:4567/foo\n\n# will complete successfully while the other request is pending\ncurl localhost:4567\nHello, world!\n</code></pre>\n\n<p>More information about <code>server_settings</code> can be found <a href=\"https://github.com/sinatra/sinatra/issues/940\" rel=\"nofollow noreferrer\">here</a>, <a href=\"https://github.com/sinatra/sinatra/pull/1360/commits/af6192bc4033c0131ae1db2683f22114927dae6f\" rel=\"nofollow noreferrer\">here</a>, and <a href=\"https://gist.github.com/TakahikoKawasaki/aefb0b9e4306b6dfbcc5\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 93455, "user_id": 187141, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f9e28dc83496320c87c55b3cf988ab60?s=128&d=identicon&r=PG", "display_name": "yegor256", "link": "https://stackoverflow.com/users/187141/yegor256"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 761, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1540925634, "creation_date": 1540911400, "question_id": 53067147, "link": "https://stackoverflow.com/questions/53067147/how-to-configure-thin-web-server-from-sinatra", "title": "How to configure Thin web server from Sinatra?", "body": "<p>This is my web app:</p>\n\n<pre><code>class Front &lt; Sinatra::Base\n  configure do\n    set :server, :thin\n  end\n  get '/' do\n    'Hello, world!'\n  end \nend\n</code></pre>\n\n<p>I start it like this:</p>\n\n<pre><code>Front.start!\n</code></pre>\n\n<p>Works great, but I want to configure Thin to be \"threaded\". I know it's possible, according to <a href=\"https://github.com/macournoyer/thin\" rel=\"nofollow noreferrer\">their documentation</a>. But I can't figure out how to pass that <code>threaded: true</code> parameter to Thin. I tried this and it doesn't work:</p>\n\n<pre><code>configure do\n  set :server_settings, threaded: true\nend\n</code></pre>\n"}, {"tags": ["arrays", "ruby"], "comments": [{"owner": {"reputation": 5312, "user_id": 6535997, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/10156345016155058/picture?type=large", "display_name": "Mark", "link": "https://stackoverflow.com/users/6535997/mark"}, "edited": false, "score": 1, "creation_date": 1540911009, "post_id": 53066864, "comment_id": 93032313, "body": "What do you want to happen when you come across an image that starts with the string you give? At the moment your code goes through each object in &#39;images&#39; and returns true if it starts with the string"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 2, "creation_date": 1540911026, "post_id": 53066864, "comment_id": 93032322, "body": "That&#39;s array of strings, not images."}, {"owner": {"reputation": 5312, "user_id": 6535997, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/10156345016155058/picture?type=large", "display_name": "Mark", "link": "https://stackoverflow.com/users/6535997/mark"}, "edited": false, "score": 1, "creation_date": 1540911051, "post_id": 53066864, "comment_id": 93032343, "body": "It&#39;s also much nicer to write: images.each { |image| image.start_with?(&#39;help-me&#39;) } This isn&#39;t javascript :D"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 5312, "user_id": 6535997, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/10156345016155058/picture?type=large", "display_name": "Mark", "link": "https://stackoverflow.com/users/6535997/mark"}, "edited": false, "score": 1, "creation_date": 1540911085, "post_id": 53066864, "comment_id": 93032365, "body": "@Mark: nicer, yes, but equally useless (here). :)"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 4, "creation_date": 1540911167, "post_id": 53066864, "comment_id": 93032420, "body": "<code>images.all?{ |image| image.start_with?(&#39;help-me&#39;) }</code>"}, {"owner": {"reputation": 245, "user_id": 2019182, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/2dd9182728409f6cc6bcb4788830cbc9?s=128&d=identicon&r=PG", "display_name": "user2019182", "link": "https://stackoverflow.com/users/2019182/user2019182"}, "edited": false, "score": 0, "creation_date": 1540911449, "post_id": 53066864, "comment_id": 93032600, "body": "Basically if its not true for all, print an error message. If it is true, continue on."}, {"owner": {"reputation": 4348, "user_id": 3435610, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/IBOFX.jpg?s=128&g=1", "display_name": "Sara Tibbetts", "link": "https://stackoverflow.com/users/3435610/sara-tibbetts"}, "edited": false, "score": 0, "creation_date": 1540912052, "post_id": 53066864, "comment_id": 93032976, "body": "Do you want to remove all images that don&#39;t start with that string?"}, {"owner": {"reputation": 245, "user_id": 2019182, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/2dd9182728409f6cc6bcb4788830cbc9?s=128&d=identicon&r=PG", "display_name": "user2019182", "link": "https://stackoverflow.com/users/2019182/user2019182"}, "edited": false, "score": 0, "creation_date": 1540912380, "post_id": 53066864, "comment_id": 93033193, "body": "No I just want to exit out altogether."}], "answers": [{"comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1540981386, "post_id": 53067838, "comment_id": 93059299, "body": "<code>images.find?</code>? This is not standard ruby"}], "tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": false, "score": 0, "last_activity_date": 1540913519, "creation_date": 1540913519, "answer_id": 53067838, "question_id": 53066864, "link": "https://stackoverflow.com/questions/53066864/array-of-images-ruby-to-check-what-each-value-starts-with/53067838#53067838", "title": "Array of Images Ruby to check what each value starts with", "body": "<p>Perhaps this is what you want?</p>\n\n<pre><code>if images.find?{ |image| !image.start_with?('help-me') }\n  #if you want to exit the app then do\n  abort('Dev asked to kill this app because we who knows?')\n  #if you want to raise exception then\n  raise 'Image found that does not start with help-me'\nend\n</code></pre>\n\n<p>Or do you want to <code>raise</code> or <code>puts</code> ?</p>\n\n<pre><code>images.each_with_index do |image, i| \n  unless images[i].start_with?('help-me')\n    puts \"Image #{image} at index #{i} does not start with 'help-me'\"\n    #or raise exception here if you want\n  end\nend\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4644, "user_id": 2594185, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003773788931/picture?type=large", "display_name": "Jagdeep Singh", "link": "https://stackoverflow.com/users/2594185/jagdeep-singh"}, "edited": false, "score": 0, "creation_date": 1540974192, "post_id": 53072494, "comment_id": 93055443, "body": "What is the purpose of <code>group_by</code>? Can&#39;t you do <code>puts &quot;Error&quot; if images.any? ...</code>"}], "tags": [], "owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "is_accepted": false, "score": 0, "last_activity_date": 1540931642, "creation_date": 1540931642, "answer_id": 53072494, "question_id": 53066864, "link": "https://stackoverflow.com/questions/53066864/array-of-images-ruby-to-check-what-each-value-starts-with/53072494#53072494", "title": "Array of Images Ruby to check what each value starts with", "body": "<blockquote>\n  <p>Basically if its not true for all, print an error message. If it is true, continue on.</p>\n</blockquote>\n\n<p>I guess the best option is in the comment above from <strong>@Sergio Tulentsev</strong>.</p>\n\n<p>Anyhow, this is just a further idea:</p>\n\n<pre><code>images = [\"nginx\", \"help-me-1\", \"flip-flop\", \"help-me-if-you-can\", \"tick-tack-toe\"]\n\nstart_with_help_me = images.group_by{ |image| image.start_with?('help-me') }\n#=&gt; {false=&gt;[\"nginx\", \"flip-flop\"], true=&gt;[\"help-me-1\", \"help-me-if-you-can\"]}\n\nputs \"Error\" if start_with_help_me[false].any? #=&gt; Error\n</code></pre>\n\n<p>Just in case you would need to get more info, for example:</p>\n\n<pre><code>start_with_help_me[false].count #=&gt; 3\nstart_with_help_me[true].count #=&gt; 2\n</code></pre>\n"}], "owner": {"reputation": 245, "user_id": 2019182, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/2dd9182728409f6cc6bcb4788830cbc9?s=128&d=identicon&r=PG", "display_name": "user2019182", "link": "https://stackoverflow.com/users/2019182/user2019182"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 35, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1540931642, "creation_date": 1540910582, "question_id": 53066864, "link": "https://stackoverflow.com/questions/53066864/array-of-images-ruby-to-check-what-each-value-starts-with", "title": "Array of Images Ruby to check what each value starts with", "body": "<p>I have an array of different images. I am trying to confirm that if the images start with the right name.</p>\n\n<pre><code>images = [\"nginx\", \"help-me-1\"]\n\nimages.each_with_index {|image, i| images[i].start_with?('help-me')}\n</code></pre>\n\n<p>Unfortunately its not looping through correctly, and I'm unsure whats wrong. I don't get an error message of any sort, and I've added some logging expecting some and do not. What might I be missing?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "postgresql", "jsonb"], "answers": [{"comments": [{"owner": {"reputation": 1679, "user_id": 1180092, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/2b9eecfea2466228e3e3f51d86d1d2a3?s=128&d=identicon&r=PG", "display_name": "Raoot", "link": "https://stackoverflow.com/users/1180092/raoot"}, "edited": false, "score": 0, "creation_date": 1540911643, "post_id": 53066945, "comment_id": 93032739, "body": "Great! That worked perfectly. I note your concerns about performance, however, this is being used for background reports and is a bit of an edge case."}], "tags": [], "owner": {"reputation": 4866, "user_id": 6603195, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nZGPkfcc0EE/AAAAAAAAAAI/AAAAAAAAAoE/op-TBiFRNzg/photo.jpg?sz=128", "display_name": "Marcin Ko\u0142odziej", "link": "https://stackoverflow.com/users/6603195/marcin-ko%c5%82odziej"}, "is_accepted": true, "score": 2, "last_activity_date": 1540910845, "creation_date": 1540910845, "answer_id": 53066945, "question_id": 53066655, "link": "https://stackoverflow.com/questions/53066655/active-record-query-on-first-value-in-stored-array-on-jsonb-column/53066945#53066945", "title": "Active Record query on first value in stored array on JSONB column", "body": "<p>This should work:</p>\n\n<pre><code>Item.where(\"active_at-&gt;'dates'-&gt;&gt;0 = ?\", \"2018-10-20\")\n</code></pre>\n\n<p><a href=\"https://dbfiddle.uk/?rdbms=postgres_9.6&amp;fiddle=8d75a54c244cea8e96712840419176ce\" rel=\"nofollow noreferrer\">SQL Fiddle</a></p>\n\n<p>I'd be really concerned about the performance of this query and consider doing some schema changes.</p>\n"}], "owner": {"reputation": 1679, "user_id": 1180092, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/2b9eecfea2466228e3e3f51d86d1d2a3?s=128&d=identicon&r=PG", "display_name": "Raoot", "link": "https://stackoverflow.com/users/1180092/raoot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39, "favorite_count": 0, "accepted_answer_id": 53066945, "answer_count": 1, "score": 0, "last_activity_date": 1540910845, "creation_date": 1540909993, "question_id": 53066655, "link": "https://stackoverflow.com/questions/53066655/active-record-query-on-first-value-in-stored-array-on-jsonb-column", "title": "Active Record query on first value in stored array on JSONB column", "body": "<p>I have a scenario where for an Item, I am logging dates it was 'active_at' into an array stored in a JSONB column. </p>\n\n<p>So the data would look something like this:</p>\n\n<pre><code>active_at:\n {\"dates\"=&gt;\n   [\"2018-07-22\",\n    \"2018-09-05\",\n    \"2018-09-06\",\n    \"2018-09-07\",\n    \"2018-09-14\",\n    \"2018-09-15\",\n    \"2018-09-16\",\n    \"2018-10-20\",\n    \"2018-10-21\",\n    \"2018-10-30\"]}\n</code></pre>\n\n<p>I can successfully query the column as follows for a date match within the array:</p>\n\n<pre><code>@item = Item.where('active_at @&gt; ?', {dates: '2018-10-20'.split}.to_json)\n</code></pre>\n\n<p>However, I now need to be able to query for a match on the first entry in the array only. Entries in the array are always in date order as new values are appended to the end of the array. </p>\n\n<p>I have tried things like this, but with no joy:</p>\n\n<pre><code>@item = Item.where('active_at @&gt; ?', {dates['first']: '2018-10-20'.split}.to_json)\n@item = Item.where('active_at @&gt; ?', {dates.first: '2018-10-20'.split}.to_json)\n</code></pre>\n"}, {"tags": ["ruby", "ruby-on-rails-5"], "comments": [{"owner": {"reputation": 5312, "user_id": 6535997, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/10156345016155058/picture?type=large", "display_name": "Mark", "link": "https://stackoverflow.com/users/6535997/mark"}, "edited": false, "score": 0, "creation_date": 1540909845, "post_id": 53066304, "comment_id": 93031561, "body": "Your problem is that children get saved before the parent. In your controller method for updating the records, you&#39;ll need to create 2 separate methods to update the parent and child record individually. If you update the parent first, validate that, and then try the child, you should get the outcome you&#39;re looking for."}], "answers": [{"tags": [], "owner": {"reputation": 436, "user_id": 2570423, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zVptB.png?s=128&g=1", "display_name": "mehedi", "link": "https://stackoverflow.com/users/2570423/mehedi"}, "is_accepted": false, "score": 0, "last_activity_date": 1540910288, "creation_date": 1540910288, "answer_id": 53066759, "question_id": 53066304, "link": "https://stackoverflow.com/questions/53066304/rails-nested-attributes-validation-force-save-parent-firstly/53066759#53066759", "title": "Rails nested attributes validation force save parent firstly", "body": "<p>Moving the validation logic from Child to Father should solve the problem.</p>\n\n<pre><code>class Father &lt; ActiveRecord::Base\n  has_many :children\n  accepts_nested_attributes_for :children\n  validate :validate_money\n\n  def validate_money\n    children = Child.where(id: id)\n    sum_of_children_pocket_money = my_func # function for getting sum of all pocket money of all children\n    if sum_of_children_pocket_money &gt; money\n      errors.add(:pocket_money, \"My error message!!!\")\n    end\n  end\nend\n\n\n\nclass Child &lt; ActiveRecord::Base\n  belongs_to :father\nend\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10580923, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Y3B4_58aaUw/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbBpC02AgevqXhVfWdTUFilxjiUmiA/mo/photo.jpg?sz=128", "display_name": "Karen Kirakosyan", "link": "https://stackoverflow.com/users/10580923/karen-kirakosyan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 124, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1540910288, "creation_date": 1540908921, "question_id": 53066304, "link": "https://stackoverflow.com/questions/53066304/rails-nested-attributes-validation-force-save-parent-firstly", "title": "Rails nested attributes validation force save parent firstly", "body": "<p>I have 2 models like:</p>\n\n<pre><code>class Father &lt; ActiveRecord::Base\n    has_many :children\n    accepts_nested_attributes_for :children\nend\n\n\n\nclass Child &lt; ActiveRecord::Base\n    belongs_to :father\n    validate :validate_money\n\n    def validate_money\n      children = Child.where(id: self.father.id)\n      sum_of_children_pocket_money = my_func # function for getting sum of all pocket money of all children\n      if sum_of_children_pocket_money &gt; self.father.money\n        errors.add(:pocket_money, \"My error message!!!\")\n      end\n    end\n  end\n</code></pre>\n\n<p>and initially I have:</p>\n\n<p>and when pass passengers_attributes to update customer (id=1) like</p>\n\n<pre><code>{\n  id: 1,\n  name: \"Father 1\",\n  money: 1000,\n  children: [\n    {\n      name: \"Child 1\",\n      id: 1,\n      pocket_money: 500\n    }\n  ]\n}\n</code></pre>\n\n<p>and then I am sending for update:</p>\n\n<pre><code>{\n  id: 1,\n  name: \"Father 1\",\n  money: 2000,\n  children: [\n    {\n      name: \"Child 1\",\n      id: 1,\n      pocket_money: 1500\n    }\n  ]\n}\n</code></pre>\n\n<p>So I am getting an error in my validation because it starts <code>sum_of_children_pocket_money &gt; self.father.money</code> comparison and <code>sum_of_children_pocket_money</code> is equal to 1500 but <code>self.father.money</code> still 1000. How can I fix this?</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 1670, "user_id": 3475163, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dce396a4249c07f19902779e54c7a40b?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammed Anees", "link": "https://stackoverflow.com/users/3475163/muhammed-anees"}, "edited": false, "score": 0, "creation_date": 1540909018, "post_id": 53066216, "comment_id": 93031008, "body": "can you please share the error message or console logs ??"}, {"owner": {"reputation": 986, "user_id": 8304905, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YpAOE.jpg?s=128&g=1", "display_name": "EmmanuelB", "link": "https://stackoverflow.com/users/8304905/emmanuelb"}, "edited": false, "score": 0, "creation_date": 1540909027, "post_id": 53066216, "comment_id": 93031017, "body": "Which are the errors that you are getting, can you show them in the code?"}, {"owner": {"reputation": 1320, "user_id": 4531923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/749da210afda1b309680b354f019849e?s=128&d=identicon&r=PG", "display_name": "Vincent Rolea", "link": "https://stackoverflow.com/users/4531923/vincent-rolea"}, "edited": false, "score": 0, "creation_date": 1540909040, "post_id": 53066216, "comment_id": 93031024, "body": "Are you using something like ActiveModel Serializer to serialize your model?"}, {"owner": {"reputation": 11, "user_id": 10048188, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D2Ju2.jpg?s=128&g=1", "display_name": "Panda", "link": "https://stackoverflow.com/users/10048188/panda"}, "edited": false, "score": 0, "creation_date": 1540909830, "post_id": 53066216, "comment_id": 93031555, "body": "I added the errors. I am not using serializers this time. I just used &quot; include: &quot; instead. And I tried to fix the syntax errors one at a time, but it just gave me new syntax errors. I tried to look up the correct syntax for what I was writing, but I didn&#39;t find any examples that worked."}], "answers": [{"comments": [{"owner": {"reputation": 75558, "user_id": 544825, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/UFdOO.png?s=128&g=1", "display_name": "max", "link": "https://stackoverflow.com/users/544825/max"}, "edited": false, "score": 0, "creation_date": 1540917593, "post_id": 53067143, "comment_id": 93036424, "body": "Actually it is a valid hash. Although its not used that often you can use any object as a hash key in ruby. Try <code>@hash = { foo: :bar }; { @hash =&gt; &#39;baz&#39; }[@hash]</code> for example. So it is a valid ruby hash - its just not valid input for <code>render json:</code>."}], "tags": [], "owner": {"reputation": 1528, "user_id": 1244089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d573e472891ca6b781c6967b2ccb409?s=128&d=identicon&r=PG", "display_name": "Lorenzo Baracchi", "link": "https://stackoverflow.com/users/1244089/lorenzo-baracchi"}, "is_accepted": false, "score": 0, "last_activity_date": 1540911391, "creation_date": 1540911391, "answer_id": 53067143, "question_id": 53066216, "link": "https://stackoverflow.com/questions/53066216/trouble-getting-user-and-token-in-rails-controller/53067143#53067143", "title": "Trouble getting user AND token in Rails Controller", "body": "<p>Your main problem is </p>\n\n<pre><code>{\n    @user =&gt; include: [:categories, :resources],\n    jwt: @token\n  }\n</code></pre>\n\n<p>since its not a valid hash. Take a look at how to create <a href=\"https://docs.ruby-lang.org/en/2.0.0/Hash.html\" rel=\"nofollow noreferrer\">hashes in ruby</a>!</p>\n\n<p>I suggest to build your response step by step until you have what you need.\nStart with</p>\n\n<pre><code>render json: @token\n</code></pre>\n\n<p>then you can try something like</p>\n\n<pre><code>render json: {user: @user.to_json, token: @token.to_json }\n</code></pre>\n\n<p>then whatever you want! </p>\n"}, {"tags": [], "owner": {"reputation": 639, "user_id": 7046734, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RQ62P.jpg?s=128&g=1", "display_name": "Mayank", "link": "https://stackoverflow.com/users/7046734/mayank"}, "is_accepted": false, "score": 0, "last_activity_date": 1540912309, "creation_date": 1540912309, "answer_id": 53067444, "question_id": 53066216, "link": "https://stackoverflow.com/questions/53066216/trouble-getting-user-and-token-in-rails-controller/53067444#53067444", "title": "Trouble getting user AND token in Rails Controller", "body": "<p>You need to replace your code </p>\n\n<pre><code>render json: {\n    @user =&gt; include: [:categories, :resources],\n    jwt: @token\n  }, status: :created\n</code></pre>\n\n<p>with</p>\n\n<pre><code>render json: {\n    user: @user.as_json(include: [:categories, :resources]),\n    jwt: @token\n  }, status: :created\n</code></pre>\n\n<p>You can also use separate activemodel serializers if you want, however as_json is a built in serializer for activemodel objects provided by rails. You can learn more from <a href=\"https://apidock.com/rails/ActiveModel/Serializers/JSON/as_json\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>Hope this helps !</p>\n"}], "owner": {"reputation": 11, "user_id": 10048188, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D2Ju2.jpg?s=128&g=1", "display_name": "Panda", "link": "https://stackoverflow.com/users/10048188/panda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 41, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1540912309, "creation_date": 1540908635, "last_edit_date": 1540909741, "question_id": 53066216, "link": "https://stackoverflow.com/questions/53066216/trouble-getting-user-and-token-in-rails-controller", "title": "Trouble getting user AND token in Rails Controller", "body": "<p>I tried testing a post request in Postman to create a user, but I keep getting errors in my controller when trying to create the user. I'm not getting my token at all. Here is my code.</p>\n\n<pre><code>class Api::V1::UsersController &lt; ApplicationController\n  skip_before_action :authorized, only: [:create]\n\n  def create\n    @user = User.create(user_params)\n    if @user.valid?\n      @token = encode_token(user_id: @user.id)\n      render json: {\n        @user =&gt; include: [:categories, :resources],\n        jwt: @token\n      }, status: :created\n    else\n      render json: { error: 'failed to create user' }, status: :not_acceptable\n    end\n  end\n\n  private\n  def user_params\n    params.permit(:username, :email, :password, :password_confirmation)\n  end\n\nend\n</code></pre>\n\n<p>These are the errors I was getting:</p>\n\n<p>SyntaxError (/Users/flatironschool/Desktop/5-Module/houston-helper-backend/app/controllers/api/v1/users_controller.rb:8: syntax error, unexpected =>\n      render json: => {\n                   ^~\n/Users/flatironschool/Desktop/5-Module/houston-helper-backend/app/controllers/api/v1/users_controller.rb:9: syntax error, unexpected ':', expecting '}'\n        @user => include: [:categories, :resources]\n                        ^\n/Users/flatironschool/Desktop/5-Module/houston-helper-backend/app/controllers/api/v1/users_controller.rb:10: syntax error, unexpected '}', expecting keyword_end\n      }, jwt: @token, status: :creat...\n      ^):</p>\n\n<p>app/controllers/api/v1/users_controller.rb:8: syntax error, unexpected =>\napp/controllers/api/v1/users_controller.rb:9: syntax error, unexpected ':', expecting '}'\napp/controllers/api/v1/users_controller.rb:10: syntax error, unexpected '}', expecting keyword_end</p>\n"}, {"tags": ["ruby", "ssl", "nginx", "openssl", "smtp"], "comments": [{"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1540909797, "post_id": 53065740, "comment_id": 93031534, "body": "please paste full backtrace errors"}, {"owner": {"reputation": 83, "user_id": 5197870, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/02b1021f20ad57d24620f0210d01a4b4?s=128&d=identicon&r=PG&f=1", "display_name": "Rick Grimes", "link": "https://stackoverflow.com/users/5197870/rick-grimes"}, "reply_to_user": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1540972234, "post_id": 53065740, "comment_id": 93054565, "body": "edited my question"}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1540980580, "post_id": 53065740, "comment_id": 93058858, "body": "can you post <code>app&#47;controllers&#47;passwords_controller.rb</code> ?"}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1540983476, "post_id": 53065740, "comment_id": 93060452, "body": "Also we assume you&#39;re not using <code>xxxxxx</code> as password? I would suggest using <code>ENV[&#39;GMAIL_PASSWORD&#39;]</code>"}, {"owner": {"reputation": 10274, "user_id": 930207, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oy7Q3.png?s=128&g=1", "display_name": "mcfinnigan", "link": "https://stackoverflow.com/users/930207/mcfinnigan"}, "edited": false, "score": 0, "creation_date": 1540986405, "post_id": 53065740, "comment_id": 93061981, "body": "Have you seen <a href=\"https://stackoverflow.com/a/17371132/930207\">This stackoverflow post</a> and tried the debugging suggested in the linked answer via the openssl command line client?  It&#39;s almost certainly a handshake issue due to a protocol mismatch."}, {"owner": {"reputation": 83, "user_id": 5197870, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/02b1021f20ad57d24620f0210d01a4b4?s=128&d=identicon&r=PG&f=1", "display_name": "Rick Grimes", "link": "https://stackoverflow.com/users/5197870/rick-grimes"}, "reply_to_user": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1540989906, "post_id": 53065740, "comment_id": 93063890, "body": "@lacostenycoder of course I am using enviroment variables."}, {"owner": {"reputation": 83, "user_id": 5197870, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/02b1021f20ad57d24620f0210d01a4b4?s=128&d=identicon&r=PG&f=1", "display_name": "Rick Grimes", "link": "https://stackoverflow.com/users/5197870/rick-grimes"}, "reply_to_user": {"reputation": 10274, "user_id": 930207, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oy7Q3.png?s=128&g=1", "display_name": "mcfinnigan", "link": "https://stackoverflow.com/users/930207/mcfinnigan"}, "edited": false, "score": 0, "creation_date": 1540989979, "post_id": 53065740, "comment_id": 93063927, "body": "@mcfinnigan thanks for the link. Yeah I also think this must be the problem, but I am not really familiar with ssl..."}], "answers": [{"comments": [{"owner": {"reputation": 83, "user_id": 5197870, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/02b1021f20ad57d24620f0210d01a4b4?s=128&d=identicon&r=PG&f=1", "display_name": "Rick Grimes", "link": "https://stackoverflow.com/users/5197870/rick-grimes"}, "edited": false, "score": 0, "creation_date": 1540982467, "post_id": 53080919, "comment_id": 93059912, "body": "Thanks for the links, but I&#39;ve already taken a look at them. Authentication type password does not exist, but tried it also with :login"}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "reply_to_user": {"reputation": 83, "user_id": 5197870, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/02b1021f20ad57d24620f0210d01a4b4?s=128&d=identicon&r=PG&f=1", "display_name": "Rick Grimes", "link": "https://stackoverflow.com/users/5197870/rick-grimes"}, "edited": false, "score": 0, "creation_date": 1540983238, "post_id": 53080919, "comment_id": 93060323, "body": "oh yeah my mistake, I meant <code>:login</code> and updated. But I guess it doesn&#39;t solve your problem? Can we see your controller code?"}], "tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": false, "score": 0, "last_activity_date": 1540984235, "last_edit_date": 1540984235, "creation_date": 1540980657, "answer_id": 53080919, "question_id": 53065740, "link": "https://stackoverflow.com/questions/53065740/ssl-connect-returned-1-errno-0-state-unknown-state-unknown-protocol/53080919#53080919", "title": "SSL_connect returned=1 errno=0 state=unknown state: unknown protocol", "body": "<p>What happens if you try this settings and get rid of everything else you currently have:</p>\n\n<pre><code># /config/environments/development.rb\n\n# Gmail configuration\nconfig.action_mailer.raise_delivery_errors = true\nconfig.action_mailer.delivery_method = :smtp\nconfig.action_mailer.smtp_settings = {\n  address:              'smtp.gmail.com',\n  port:                 587,\n  domain:               'example.com',\n  user_name:            ENV['EMAIL_USER'],\n  password:             ENV['EMAIL_PASS'],\n  authentication:       'plain',\n  enable_starttls_auto: true\n}\n</code></pre>\n\n<p>I'm not sure you need to monkey with smtper.net but perhaps see this, even though it's very old, it probably should still work:</p>\n\n<p><a href=\"http://blog.napcs.com/2013/07/21/rails_ssl_simple_wa/\" rel=\"nofollow noreferrer\">http://blog.napcs.com/2013/07/21/rails_ssl_simple_wa/</a></p>\n\n<p>You'll need to set those environment variables as you obviously should never want to commit credentials in your git repo.</p>\n\n<p>But also see these posts as you may need to do some other things for gmail</p>\n\n<p><a href=\"https://stackoverflow.com/questions/1183743/ruby-getting-netsmtp-working-with-gmail\">(Ruby) Getting Net::SMTP working with Gmail...?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/25872389/rails-4-how-to-correctly-configure-smtp-settings-gmail\">Rails 4, how to correctly configure smtp settings (gmail)</a></p>\n"}], "owner": {"reputation": 83, "user_id": 5197870, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/02b1021f20ad57d24620f0210d01a4b4?s=128&d=identicon&r=PG&f=1", "display_name": "Rick Grimes", "link": "https://stackoverflow.com/users/5197870/rick-grimes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 244, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1540997666, "creation_date": 1540907148, "last_edit_date": 1540997666, "question_id": 53065740, "link": "https://stackoverflow.com/questions/53065740/ssl-connect-returned-1-errno-0-state-unknown-state-unknown-protocol", "title": "SSL_connect returned=1 errno=0 state=unknown state: unknown protocol", "body": "<p>After reading through many posts I couldn't find a solution to my problem. I've made a test connection with www.smtper.net which was successful. My error.log only tells me the error:</p>\n\n<pre><code>OpenSSL::SSL::SSLError: SSL_connect returned=1 errno=0 state=unknown state: unknown protocol\n\n\napp/controllers/passwords_controller.rb:11:in `create'\n</code></pre>\n\n<p>Maybe it has something to do with my nginx settings?</p>\n\n<p><strong>Issue</strong></p>\n\n<p>I'm trying to configure my smtp via mailgun (or gmail) but without success.\nMy configuration in <em>developement.rb</em> looks like:</p>\n\n<pre><code>config.action_mailer.default_url_options = { :host =&gt; \"xxxxx:8765\" } \nconfig.action_mailer.delivery_method = :smtp\nconfig.action_mailer.perform_deliveries = true\nconfig.action_mailer.smtp_settings = {\n   :address =&gt; \"smtp.gmail.com\",\n   :port =&gt; 587,\n   :domain =&gt; \"mail.google.com\",\n   :user_name =&gt; \"xxx@gmail.com\",\n   :password =&gt; \"xxxxxx\",\n   :authentication =&gt; :plain,\n   :enable_starttls_auto =&gt; true\n}\n</code></pre>\n\n<p>And the error is thrown at the action create, line 11:</p>\n\n<pre><code>  AccountMailer.password_reset_email(@account).deliver\n</code></pre>\n\n<p>I have installed OpenSSL 1.0.1f on my development server</p>\n\n<p><strong>TRACE</strong></p>\n\n<pre><code>/root/.rbenv/versions/2.5.1/lib/ruby/2.5.0/net/protocol.rb:44:in `connect_nonblock'\n/root/.rbenv/versions/2.5.1/lib/ruby/2.5.0/net/protocol.rb:44:in `ssl_socket_connect'\n/root/.rbenv/versions/2.5.1/lib/ruby/2.5.0/net/smtp.rb:584:in `tlsconnect'\n/root/.rbenv/versions/2.5.1/lib/ruby/2.5.0/net/smtp.rb:552:in `do_start'\n/root/.rbenv/versions/2.5.1/lib/ruby/2.5.0/net/smtp.rb:518:in `start'\nmail (2.7.0) lib/mail/network/delivery_methods/smtp.rb:109:in `start_smtp_session'\nmail (2.7.0) lib/mail/network/delivery_methods/smtp.rb:100:in `deliver!'\nmail (2.7.0) lib/mail/message.rb:2160:in `do_delivery'\nmail (2.7.0) lib/mail/message.rb:260:in `block in deliver'\nactionmailer (4.2.8) lib/action_mailer/base.rb:543:in `block in deliver_mail'\nactivesupport (4.2.8) lib/active_support/notifications.rb:164:in `block in instrument'\nactivesupport (4.2.8) lib/active_support/notifications/instrumenter.rb:20:in `instrument'\nactivesupport (4.2.8) lib/active_support/notifications.rb:164:in `instrument'\nactionmailer (4.2.8) lib/action_mailer/base.rb:541:in `deliver_mail'\nmail (2.7.0) lib/mail/message.rb:260:in `deliver'\nactionmailer (4.2.8) lib/action_mailer/message_delivery.rb:85:in `deliver_now'\nactionmailer (4.2.8) lib/action_mailer/message_delivery.rb:105:in `deliver'\napp/controllers/passwords_controller.rb:11:in `create'\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "json", "ruby", "encoding"], "comments": [{"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 2, "creation_date": 1540904585, "post_id": 53064806, "comment_id": 93028089, "body": "Garbage? U+003E is the <code>&gt;</code> character from <code>&quot;name&quot;=&gt;</code>"}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 2, "creation_date": 1540905552, "post_id": 53064806, "comment_id": 93028611, "body": "<code>\\xE1\\x83</code> are the first two bytes of a 3-byte character sequence, so it&#39;s only a partial character. The fix is to truncate strings at character boundaries, not in-between."}], "answers": [{"tags": [], "owner": {"reputation": 930, "user_id": 3577922, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eURpm.jpg?s=128&g=1", "display_name": "Masa Sakano", "link": "https://stackoverflow.com/users/3577922/masa-sakano"}, "is_accepted": false, "score": 2, "last_activity_date": 1540908240, "creation_date": 1540908240, "answer_id": 53066100, "question_id": 53064806, "link": "https://stackoverflow.com/questions/53064806/ruby-to-json-throws-argumenterror-invalid-byte-sequence-in-utf-8/53066100#53066100", "title": "Ruby &#39;to_json&#39; throws ArgumentError: invalid byte sequence in UTF-8", "body": "<p>That is because your input String contains <em>invalid byte sequence in UTF-8</em>, as the error message precisely tells.\nYou can check it like</p>\n\n<pre><code>hash['name'].valid_encoding?  # =&gt; false\n</code></pre>\n\n<p>Fundamentally, you should fix the input string, removing all the <em>invalid byte sequence</em> characters; in your example, it is <code>\"\\xE1\\x83\"</code></p>\n\n<p>If for some reason you need to preserve the byte sequence and encode it to a standard JSON, I think you must encode the string first, because JSON does not accept a binary data but valid UTF-8 strings only. Note a string with an <em>invalid byte sequence</em> is a binary data, as far as JSON is concerned.</p>\n\n<p>In Rails, you can use Base64 encoding as follows:</p>\n\n<pre><code>hash['name'] = Base64.encode64 hash['name']\nhash.to_json  # =&gt; a valid JSON\n</code></pre>\n\n<p>In decoding, you must specify the encoding, such as,</p>\n\n<pre><code>hj = hash.to_json\nBase64.decode64(JSON.parse(hj)['name']).force_encoding('UTF-8') # =&gt; Decoded string\n</code></pre>\n\n<p>Note the reproduced string is <strong>NOT</strong> a valid UTF-8 in your case anyway.  But it would help to display in Rails console.</p>\n"}, {"comments": [{"owner": {"reputation": 930, "user_id": 3577922, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eURpm.jpg?s=128&g=1", "display_name": "Masa Sakano", "link": "https://stackoverflow.com/users/3577922/masa-sakano"}, "edited": false, "score": 0, "creation_date": 1541003215, "post_id": 53071240, "comment_id": 93073029, "body": "If I was in the OP&#39;s shoes, I would be happy to get rid of <code>&quot;\\xE1\\x83&quot;</code> in the input string, but perhaps would not want to lose any other parts of it\u2026?"}, {"owner": {"reputation": 930, "user_id": 3577922, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eURpm.jpg?s=128&g=1", "display_name": "Masa Sakano", "link": "https://stackoverflow.com/users/3577922/masa-sakano"}, "edited": false, "score": 0, "creation_date": 1541053505, "post_id": 53071240, "comment_id": 93088434, "body": "I found <code>invalid: :replace</code> instead of, or in addition to, <code>undef: :replace</code> would achieve it. @Alexey, please feel free to update your answer, if you want (which might help future visitors)."}], "tags": [], "owner": {"reputation": 426, "user_id": 8287207, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PZ5Cf.jpg?s=128&g=1", "display_name": "Alexey Strizhak", "link": "https://stackoverflow.com/users/8287207/alexey-strizhak"}, "is_accepted": false, "score": 0, "last_activity_date": 1540926242, "creation_date": 1540926242, "answer_id": 53071240, "question_id": 53064806, "link": "https://stackoverflow.com/questions/53064806/ruby-to-json-throws-argumenterror-invalid-byte-sequence-in-utf-8/53071240#53071240", "title": "Ruby &#39;to_json&#39; throws ArgumentError: invalid byte sequence in UTF-8", "body": "<p>If you are not afraid of losing content, may use this solution:</p>\n\n<pre><code>pry(main)&gt; \n{\"name\"=&gt;\"\u10e1\u10e1\u10d8\u10de \u10dd\u10d7\u10d0\u10e0 \u10e9\u10ee\u10d4\u10d8\u10eb\u10d8\u10e1 \u10e1\u10d0\u10ee\u10d4\u10da\u10dd\u10d1\u10d8\u10e1 \u10e1\u10dd\u10e4\u10d4\u10da \u10e7\u10d4\\xE1\\x83\".force_encoding(\"ASCII-8BIT\").encode('UTF-8', undef: :replace, replace: '')}.to_json\n\n=&gt; \"{\\\"name\\\":\\\"     \\\"}\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 426, "user_id": 8287207, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PZ5Cf.jpg?s=128&g=1", "display_name": "Alexey Strizhak", "link": "https://stackoverflow.com/users/8287207/alexey-strizhak"}, "is_accepted": false, "score": 0, "last_activity_date": 1541004913, "creation_date": 1541004913, "answer_id": 53088520, "question_id": 53064806, "link": "https://stackoverflow.com/questions/53064806/ruby-to-json-throws-argumenterror-invalid-byte-sequence-in-utf-8/53088520#53088520", "title": "Ruby &#39;to_json&#39; throws ArgumentError: invalid byte sequence in UTF-8", "body": "<pre><code>require 'json'\n\ndef cleanup(string)\n  text = ''\n  string.each_char { |char| text &lt;&lt; char if char.valid_encoding? }\n  text\nend\n\nhash = { \"name\" =&gt; \"\u10e1\u10e1\u10d8\u10de \u10dd\u10d7\u10d0\u10e0 \u10e9\u10ee\u10d4\u10d8\u10eb\u10d8\u10e1 \u10e1\u10d0\u10ee\u10d4\u10da\u10dd\u10d1\u10d8\u10e1 \u10e1\u10dd\u10e4\u10d4\u10da \u10e7\u10d4\\xE1\\x83\" }\nhash.transform_values! { |value| cleanup(value) }\n\nputs hash.to_json\n\n{\"name\":\"\u10e1\u10e1\u10d8\u10de \u10dd\u10d7\u10d0\u10e0 \u10e9\u10ee\u10d4\u10d8\u10eb\u10d8\u10e1 \u10e1\u10d0\u10ee\u10d4\u10da\u10dd\u10d1\u10d8\u10e1 \u10e1\u10dd\u10e4\u10d4\u10da \u10e7\u10d4\"}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 930, "user_id": 3577922, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eURpm.jpg?s=128&g=1", "display_name": "Masa Sakano", "link": "https://stackoverflow.com/users/3577922/masa-sakano"}, "edited": false, "score": 0, "creation_date": 1541071218, "post_id": 53098057, "comment_id": 93095937, "body": "<code>&quot;\u10e7\u10d4\\xE1\\x83&quot;.encode(&#39;UTF-8&#39;, invalid: :replace, undef: :replace, replace: &#39;&#39;)</code> would be more efficient."}, {"owner": {"reputation": 930, "user_id": 3577922, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eURpm.jpg?s=128&g=1", "display_name": "Masa Sakano", "link": "https://stackoverflow.com/users/3577922/masa-sakano"}, "edited": false, "score": 0, "creation_date": 1541071546, "post_id": 53098057, "comment_id": 93096119, "body": "Besides, your solution does not work if the encoding of the original string is <code>ASCII-8BIT</code>, in which case any byte is regarded as <b>valid</b>."}], "tags": [], "owner": {"reputation": 1152, "user_id": 1337996, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1bee6020df83836847c87ad044c296fa?s=128&d=identicon&r=PG", "display_name": "sagar junnarkar", "link": "https://stackoverflow.com/users/1337996/sagar-junnarkar"}, "is_accepted": false, "score": 0, "last_activity_date": 1541063141, "creation_date": 1541063141, "answer_id": 53098057, "question_id": 53064806, "link": "https://stackoverflow.com/questions/53064806/ruby-to-json-throws-argumenterror-invalid-byte-sequence-in-utf-8/53098057#53098057", "title": "Ruby &#39;to_json&#39; throws ArgumentError: invalid byte sequence in UTF-8", "body": "<p>Thank you Stefan, Masa Sakano and Alexey Strizhak. Your suggestions helped me a lot. \nThis is correct that the string has invalid byte sequence characters.\nWhat I did is just to keep valid encoding characters as below -</p>\n\n<pre><code>\"\u10e1\u10e1\u10d8\u10de \u10dd\u10d7\u10d0\u10e0 \u10e9\u10ee\u10d4\u10d8\u10eb\u10d8\u10e1 \u10e1\u10d0\u10ee\u10d4\u10da\u10dd\u10d1\u10d8\u10e1 \u10e1\u10dd\u10e4\u10d4\u10da \u10e7\u10d4\\xE1\\x83\".chars.select(&amp;:valid_encoding?).join\n=&gt; \"\u10e1\u10e1\u10d8\u10de \u10dd\u10d7\u10d0\u10e0 \u10e9\u10ee\u10d4\u10d8\u10eb\u10d8\u10e1 \u10e1\u10d0\u10ee\u10d4\u10da\u10dd\u10d1\u10d8\u10e1 \u10e1\u10dd\u10e4\u10d4\u10da \u10e7\u10d4\"\n</code></pre>\n\n<p>This will remove the incomplete/invalid characters like \"\\xE1\\x83\".</p>\n\n<p>Again thanks a lot everyone for helping me out to understand the problem and suggesting solutions.</p>\n"}], "owner": {"reputation": 1152, "user_id": 1337996, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1bee6020df83836847c87ad044c296fa?s=128&d=identicon&r=PG", "display_name": "sagar junnarkar", "link": "https://stackoverflow.com/users/1337996/sagar-junnarkar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 317, "favorite_count": 0, "answer_count": 4, "score": 0, "last_activity_date": 1541063141, "creation_date": 1540904169, "last_edit_date": 1540904631, "question_id": 53064806, "link": "https://stackoverflow.com/questions/53064806/ruby-to-json-throws-argumenterror-invalid-byte-sequence-in-utf-8", "title": "Ruby &#39;to_json&#39; throws ArgumentError: invalid byte sequence in UTF-8", "body": "<p>In rails console, I get:</p>\n\n<pre><code>hash = {\"name\"=&gt;\"\u10e1\u10e1\u10d8\u10de \u10dd\u10d7\u10d0\u10e0 \u10e9\u10ee\u10d4\u10d8\u10eb\u10d8\u10e1 \u10e1\u10d0\u10ee\u10d4\u10da\u10dd\u10d1\u10d8\u10e1 \u10e1\u10dd\u10e4\u10d4\u10da \u10e7\u10d4\\xE1\\x83\"}\n#=&gt; {\"name\"=&gt;\"\u10e1\u10e1\u10d8\u10de \u10dd\u10d7\u10d0\u10e0 \u10e9\u10ee\u10d4\u10d8\u10eb\u10d8\u10e1 \u10e1\u10d0\u10ee\u10d4\u10da\u10dd\u10d1\u10d8\u10e1 \u10e1\u10dd\u10e4\u10d4\u10da \u10e7\u10d4\\xE1\\x83\"}\nhash.to_json\n#&gt;&gt; ArgumentError: invalid byte sequence in UTF-8\nfrom /home/edmodo/.rvm/gems/ruby-2.3.0@one-eye/gems/activesupport-json_encoder-1.1.0/lib/active_support/json/encoding/active_support_encoder.rb:79:in `gsub'\n</code></pre>\n\n<p><code>\"\\xE1\\x83\".to_json</code>'s not working may be due to non UTF-8 characters.</p>\n\n<p>Any help is appreciated.</p>\n\n<p>If hash is converted to a string, then it works, but it adds garbage characters like <code>u003E</code> with lots of extra backslashes.</p>\n\n<pre><code>hash.to_s.to_json\n#=&gt; \"\\\"{\\\\\\\"name\\\\\\\"=\\\\u003E\\\\\\\"\u10e1\u10e1\u10d8\u10de \u10dd\u10d7\u10d0\u10e0 \u10e9\u10ee\u10d4\u10d8\u10eb\u10d8\u10e1 \u10e1\u10d0\u10ee\u10d4\u10da\u10dd\u10d1\u10d8\u10e1 \u10e1\u10dd\u10e4\u10d4\u10da \u10e7\u10d4\\\\\\\\xE1\\\\\\\\x83\\\\\\\"}\\\"\"\n</code></pre>\n"}, {"tags": ["ruby", "trailblazer"], "answers": [{"comments": [{"owner": {"reputation": 634, "user_id": 1577696, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ac87a5c94cbd1a6b7b5639879499cd49?s=128&d=identicon&r=PG", "display_name": "Adam Piotrowski", "link": "https://stackoverflow.com/users/1577696/adam-piotrowski"}, "edited": false, "score": 0, "creation_date": 1540905569, "post_id": 53065083, "comment_id": 93028620, "body": "Thank you, man. Silly me - lambda just returns value that will overwrite given property ;]"}], "tags": [], "owner": {"reputation": 11, "user_id": 3953059, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7134b8abee33bea877067692efff6633?s=128&d=identicon&r=PG&f=1", "display_name": "Michal Gilewski", "link": "https://stackoverflow.com/users/3953059/michal-gilewski"}, "is_accepted": false, "score": 1, "last_activity_date": 1540905133, "creation_date": 1540905133, "answer_id": 53065083, "question_id": 53064597, "link": "https://stackoverflow.com/questions/53064597/trailblazer-parsing-data-before-validation-by-populator/53065083#53065083", "title": "Trailblazer parsing data before validation by :populator", "body": "<p>I think You can just assign decimal value to <code>my_field</code> returning that object, for example:</p>\n\n<pre><code>property :my_field, populator: -&gt;(_fragment:, **) do \n  BigDecimal.new(my_field)\nend\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 634, "user_id": 1577696, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ac87a5c94cbd1a6b7b5639879499cd49?s=128&d=identicon&r=PG", "display_name": "Adam Piotrowski", "link": "https://stackoverflow.com/users/1577696/adam-piotrowski"}, "edited": false, "score": 0, "creation_date": 1540910968, "post_id": 53065232, "comment_id": 93032285, "body": "Ha, that is even better! Thx!"}, {"owner": {"reputation": 634, "user_id": 1577696, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ac87a5c94cbd1a6b7b5639879499cd49?s=128&d=identicon&r=PG", "display_name": "Adam Piotrowski", "link": "https://stackoverflow.com/users/1577696/adam-piotrowski"}, "edited": false, "score": 0, "creation_date": 1540975092, "post_id": 53065232, "comment_id": 93055848, "body": "Tbh what i used finally was <a href=\"http://trailblazer.to/gems/reform/options.html#coercion\" rel=\"nofollow noreferrer\">trailblazer.to/gems/reform/options.html#coercion</a> so basically coercion next to property no next to validation."}], "tags": [], "owner": {"reputation": 38, "user_id": 6301802, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c493461940e189cb56b5e3200b9f19c3?s=128&d=identicon&r=PG&f=1", "display_name": "bigelow42", "link": "https://stackoverflow.com/users/6301802/bigelow42"}, "is_accepted": true, "score": 2, "last_activity_date": 1540905604, "creation_date": 1540905604, "answer_id": 53065232, "question_id": 53064597, "link": "https://stackoverflow.com/questions/53064597/trailblazer-parsing-data-before-validation-by-populator/53065232#53065232", "title": "Trailblazer parsing data before validation by :populator", "body": "<p>I would use dry-validation input pre-processing <a href=\"https://dry-rb.org/gems/dry-validation/input-preprocessing/\" rel=\"nofollow noreferrer\">https://dry-rb.org/gems/dry-validation/input-preprocessing/</a></p>\n\n<pre><code>configure do\n  config.type_specs = true\nend\n\nrequired(:my_field, Types::Params::Integer).filled(gt?: 0)\n</code></pre>\n"}], "owner": {"reputation": 634, "user_id": 1577696, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ac87a5c94cbd1a6b7b5639879499cd49?s=128&d=identicon&r=PG", "display_name": "Adam Piotrowski", "link": "https://stackoverflow.com/users/1577696/adam-piotrowski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 53065232, "answer_count": 2, "score": 1, "last_activity_date": 1540905604, "creation_date": 1540903487, "question_id": 53064597, "link": "https://stackoverflow.com/questions/53064597/trailblazer-parsing-data-before-validation-by-populator", "title": "Trailblazer parsing data before validation by :populator", "body": "<p>So I have my reform object, and I want to parse my string data before validation, to be able to use dry-validation \n<code>\nrequired(:my_field).filled(gt?: 0)\n</code></p>\n\n<p>In order to do that I use populator\n<code>\nproperty :membership_fee, populator: MyPopulator\n</code></p>\n\n<p>My question is what is the best way to access and parse data that reform object took.</p>\n\n<p>For now, I used:</p>\n\n<p><code>property :my_field, populator: lambda { |fragment| fragment[:doc]['my_field'] = BigDecimal.new(fragment[:doc]['my_field']) }\n</code></p>\n\n<p>But I am not sure if that is the best way to approach it - I mean accessing it by fragment[:doc] is the prettiest way to do that? I am not sure what exactly fragment[:doc] is used for later in reform.</p>\n"}, {"tags": ["ruby", "chef-infra", "nested-attributes"], "answers": [{"tags": [], "owner": {"reputation": 1365, "user_id": 4894399, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tY1Cz7EDNxc/AAAAAAAAAAI/AAAAAAAABb4/3Qa15VP4_ZY/photo.jpg?sz=128", "display_name": "Szymon Szypulski", "link": "https://stackoverflow.com/users/4894399/szymon-szypulski"}, "is_accepted": true, "score": 0, "last_activity_date": 1540907492, "creation_date": 1540907492, "answer_id": 53065854, "question_id": 53064025, "link": "https://stackoverflow.com/questions/53064025/wildcards-in-chef-attributes/53065854#53065854", "title": "wildcards in chef attributes", "body": "<p>In case of a hash like you have pasted you could use <a href=\"https://ruby-doc.org/core-2.5.3/Enumerable.html#method-i-find\" rel=\"nofollow noreferrer\"><code>find</code></a> method:</p>\n\n<pre><code>node[\"packages\"].find { |key, _| key =~ /Mozilla Firefox/ }\n =&gt; [:\"Mozilla Firefox 62.0.2 (x64 en-US)\", {:version=&gt;\"62.0.2\", :publisher=&gt;\"Mozilla\"}]\n</code></pre>\n\n<p>Just keep in mind it will convert your hash to an array, but it can be easily reverted.</p>\n"}], "owner": {"reputation": 3, "user_id": 10580255, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-3-tLsNFu_3E/AAAAAAAAAAI/AAAAAAAAGYM/J-5edPrqttc/photo.jpg?sz=128", "display_name": "saurav kumar singh", "link": "https://stackoverflow.com/users/10580255/saurav-kumar-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 304, "favorite_count": 0, "accepted_answer_id": 53065854, "answer_count": 1, "score": 0, "last_activity_date": 1540912278, "creation_date": 1540901447, "last_edit_date": 1540912278, "question_id": 53064025, "link": "https://stackoverflow.com/questions/53064025/wildcards-in-chef-attributes", "title": "wildcards in chef attributes", "body": "<p>I am trying to get the version of an installed package Firefox from OHAI for a windows machine</p>\n\n<p>The output of ohai contains packages info like</p>\n\n<pre><code> \"ohai_time\": 1540893742.872569,\n \"packages\": {\n \"Mozilla Firefox 62.0.2 (x64 en-US)\": {\n \"version\": \"62.0.2\",\n \"publisher\": \"Mozilla\"\n },\n \"Mozilla Maintenance Service\": {\n \"version\": \"62.0.2\",\n \"publisher\": \"Mozilla\"\n },\n \"Symantec NetBackup Client\": {\n \"version\": \"7.7.2\",\n \"publisher\": \"Symantec Corporation\",\n \"installdate\": \"20180618\"\n  }, .....\n  ......so on...\n</code></pre>\n\n<p>the problem is that I cannot use the full name that is used here because it contains the version itself</p>\n\n<p>otherwise i could use \nnode['packages']['Mozilla Firefox 62.0.2 (x64 en-US)']['version']</p>\n\n<p>Instead I want to use something like node['packages'][\"Mozilla*\"]['version']</p>\n\n<p>I have tried using loops and .include? But did not work.\nWhat are my options here? Using ruby or loops or anything else</p>\n\n<p>Thanks for you responses in advance.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "rubygems"], "comments": [{"owner": {"reputation": 75558, "user_id": 544825, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/UFdOO.png?s=128&g=1", "display_name": "max", "link": "https://stackoverflow.com/users/544825/max"}, "edited": false, "score": 1, "creation_date": 1540903032, "post_id": 53063395, "comment_id": 93027188, "body": "I don&#39;t get why this question is downvoted and has a close vote as &quot;Unclear what you are asking&quot;  as its a rather straight forward question about mounting an engine in another engine."}, {"owner": {"reputation": 75558, "user_id": 544825, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/UFdOO.png?s=128&g=1", "display_name": "max", "link": "https://stackoverflow.com/users/544825/max"}, "edited": false, "score": 0, "creation_date": 1540903270, "post_id": 53063395, "comment_id": 93027336, "body": "The question could be improved by including the relevant code (gemspec, the engine.rb file)."}], "answers": [{"tags": [], "owner": {"reputation": 75558, "user_id": 544825, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/UFdOO.png?s=128&g=1", "display_name": "max", "link": "https://stackoverflow.com/users/544825/max"}, "is_accepted": false, "score": 0, "last_activity_date": 1540904172, "last_edit_date": 1540904172, "creation_date": 1540902863, "answer_id": 53064417, "question_id": 53063395, "link": "https://stackoverflow.com/questions/53063395/how-to-install-migration-in-rails-engine-from-other-engine/53064417#53064417", "title": "How to install migration in Rails engine from other engine?", "body": "<p>Add the gem dependency to you gemspec:</p>\n\n<pre><code>Gem::Specification.new do |s|\n  # ...\n  s.add_dependency 'acts-as-taggable-on', '~&gt; 6.0'\n  # ...\nend\n</code></pre>\n\n<p>Then require the gem in your engine:</p>\n\n<pre><code># lib/my_engine/engine.rb\nrequire 'acts-as-taggable-on'\n\nmodule MyEngine\n  class Engine &lt; ::Rails::Engine\n    isolate_namespace Chatty\n  end\nend\n</code></pre>\n\n<p><code>ActsAsTaggableOn</code> should be loaded through the main file which requires the engine as well unlike some gems where you require <code>gemname/engine</code> - and the file naming is not <code>snake_case</code> like most gems. </p>\n\n<p>Then run <code>bundle install</code> and <code>rake acts_as_taggable_on_engine:install:migrations</code> in the folder of the dummy application (or the host).</p>\n\n<pre><code>max@MaxBook ~/p/c/t/dummy&gt; rake acts_as_taggable_on_engine:install:migrations\nCopied migration 20181030123059_acts_as_taggable_on_migration.acts_as_taggable_on_engine.rb from acts_as_taggable_on_engine\nCopied migration 20181030123060_add_missing_unique_indices.acts_as_taggable_on_engine.rb from acts_as_taggable_on_engine\nCopied migration 20181030123061_add_taggings_counter_cache_to_tags.acts_as_taggable_on_engine.rb from acts_as_taggable_on_engine\nCopied migration 20181030123062_add_missing_taggable_index.acts_as_taggable_on_engine.rb from acts_as_taggable_on_engine\nCopied migration 20181030123063_change_collation_for_tag_names.acts_as_taggable_on_engine.rb from acts_as_taggable_on_engine\nCopied migration 20181030123064_add_missing_indexes_on_taggings.acts_as_taggable_on_engine.rb from acts_as_taggable_on_engine\n</code></pre>\n\n<p>I don't know why but invoking the command through bundler (<code>bundle exec ...</code>) does not work. This may give problems with RVM if you are using shims. </p>\n\n<p>You can also create a generator for your engine that invokes the task:</p>\n\n<pre><code># lib/generators/my_engine/install/install_generator.rb\nmodule MyEngine\n  class InstallGenerator &lt; Rails::Generators::Base\n    source_root File.expand_path('templates', __dir__)\n\n    desc \"Installs MyEngine\"\n\n    def copy_initializer\n      # template 'my_engine.rb', 'config/initializers/my_engine.rb'\n      rake \"acts_as_taggable_on_engine:install:migrations\"\n    end\n  end\nend\n</code></pre>\n\n<p>Which you can then run with <code>rails g my_engine:install</code>.</p>\n"}], "owner": {"reputation": 5845, "user_id": 532247, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/4rtp3.jpg?s=128&g=1", "display_name": "Meliborn", "link": "https://stackoverflow.com/users/532247/meliborn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 508, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547161936, "creation_date": 1540899163, "last_edit_date": 1540901595, "question_id": 53063395, "link": "https://stackoverflow.com/questions/53063395/how-to-install-migration-in-rails-engine-from-other-engine", "title": "How to install migration in Rails engine from other engine?", "body": "<p>I have an engine, that has gem dependency. This gem has rake task to install migrations:</p>\n\n<pre><code>rake acts_as_taggable_on_engine:install:migrations\n</code></pre>\n\n<p>What is the proper way to install migration? When I run this command from host app or my engine I getting</p>\n\n<blockquote>\n  <p>Don't know how to build task</p>\n</blockquote>\n"}, {"tags": ["ruby", "memory", "hash"], "comments": [{"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 2, "creation_date": 1540896670, "post_id": 53062480, "comment_id": 93023659, "body": "How does your translator work? Do you need all 10 languages at once?"}, {"owner": {"reputation": 4602, "user_id": 1141264, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/4af75d466ec6c84e3a0a9f1de61233ae?s=128&d=identicon&r=PG", "display_name": "DickieBoy", "link": "https://stackoverflow.com/users/1141264/dickieboy"}, "edited": false, "score": 0, "creation_date": 1540896682, "post_id": 53062480, "comment_id": 93023666, "body": "Do you need to load all 10 languages at once?"}, {"owner": {"reputation": 55, "user_id": 3336134, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jfrQK.jpg?s=128&g=1", "display_name": "JoJo", "link": "https://stackoverflow.com/users/3336134/jojo"}, "edited": false, "score": 0, "creation_date": 1540897071, "post_id": 53062480, "comment_id": 93023883, "body": "Yes, i load all 10 languages at once in environment.rb (it takes 20 min.....)"}, {"owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 0, "creation_date": 1540897996, "post_id": 53062480, "comment_id": 93024391, "body": "Did you consider storing the translations into a database instead of a hash in memory?"}, {"owner": {"reputation": 55, "user_id": 3336134, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jfrQK.jpg?s=128&g=1", "display_name": "JoJo", "link": "https://stackoverflow.com/users/3336134/jojo"}, "edited": false, "score": 0, "creation_date": 1540898314, "post_id": 53062480, "comment_id": 93024561, "body": "Storing translations into a external database is not an option because it would be much too slow. Hash read access is much faster that DB access."}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1540898693, "post_id": 53062480, "comment_id": 93024745, "body": "@JoJo so you load all languages upon startup, but do you actually need all of them at any time? Maybe you could load them lazily, i.e. as needed."}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1540898792, "post_id": 53062480, "comment_id": 93024799, "body": "<i>&quot;external database is not an option because it would be much too slow&quot;</i> \u2013 what about an in-memory database like Redis?"}, {"owner": {"reputation": 55, "user_id": 3336134, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jfrQK.jpg?s=128&g=1", "display_name": "JoJo", "link": "https://stackoverflow.com/users/3336134/jojo"}, "edited": false, "score": 0, "creation_date": 1540900029, "post_id": 53062480, "comment_id": 93025539, "body": "@Stephan,  =&gt; yes, all langages loaded at once at start. =&gt; Redis is much slower that direct access in ruby Hash....Not an option"}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1540903393, "post_id": 53062480, "comment_id": 93027413, "body": "You could implement a cache which keeps the most common (or recently used) words in memory (say the top 1%) and fetches less common words from a slower source (database or disk)."}, {"owner": {"reputation": 1777, "user_id": 3353157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6168a2c2f5e3582addf6d9d70ce13749?s=128&d=identicon&r=PG", "display_name": "Peter Camilleri", "link": "https://stackoverflow.com/users/3353157/peter-camilleri"}, "edited": false, "score": 1, "creation_date": 1540912876, "post_id": 53062480, "comment_id": 93033485, "body": "I tend to get skeptical when I hear protests of &quot;that would be too slow!&quot; No where do you say how fast it needs to be. Without performance targets improvement is difficult. Further, I&#39;d wager that at 10 Gigs, your hash implementation is being slowed down a lot by system paging,  I once worked on a project where the original design kept all data in hashes. It was very slow. The version that used a database was actually faster!"}], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 3336134, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jfrQK.jpg?s=128&g=1", "display_name": "JoJo", "link": "https://stackoverflow.com/users/3336134/jojo"}, "edited": false, "score": 0, "creation_date": 1540981302, "post_id": 53064978, "comment_id": 93059252, "body": "Thank you Kimmo. I ll benchmark Redis again and share results. Such a translator is usefull if not to be used by human, and offer great throughput. \u2013 JoJo just now"}, {"owner": {"reputation": 55, "user_id": 3336134, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jfrQK.jpg?s=128&g=1", "display_name": "JoJo", "link": "https://stackoverflow.com/users/3336134/jojo"}, "edited": false, "score": 0, "creation_date": 1540990864, "post_id": 53064978, "comment_id": 93064515, "body": "In Dev env, TRANSLATIONS contains &quot;only&quot; 3 400 000 elements.    <code>Benchmark.measure {TRANSLATIONS.each do |key, value| {redis.get(key)}} 994 sec  Benchmark.measure {TRANSLATIONS.each do |key, value| {TRANSLATIONS[key]}} 1.2 sec</code>"}, {"owner": {"reputation": 55, "user_id": 3336134, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jfrQK.jpg?s=128&g=1", "display_name": "JoJo", "link": "https://stackoverflow.com/users/3336134/jojo"}, "edited": false, "score": 0, "creation_date": 1550654675, "post_id": 53064978, "comment_id": 96344156, "body": "Kimmo, finally, Redis is a good solution, as i can balance load among many threads."}], "tags": [], "owner": {"reputation": 5449, "user_id": 681520, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/701baebf68d1d7faa9f9def6a24fe356?s=128&d=identicon&r=PG", "display_name": "Kimmo Lehto", "link": "https://stackoverflow.com/users/681520/kimmo-lehto"}, "is_accepted": false, "score": 1, "last_activity_date": 1540904743, "creation_date": 1540904743, "answer_id": 53064978, "question_id": 53062480, "link": "https://stackoverflow.com/questions/53062480/ruby-huge-hash-memory-usage/53064978#53064978", "title": "Ruby huge Hash &amp; memory usage", "body": "<p>You should familiarize yourself with how the <code>Hash</code> is stored in the memory. There's a good blog post about that <a href=\"https://anadea.info/blog/how-hash-table-works-ruby-examples\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>If your dictionary contained only words instead of phrases, you should just have about 90mb of data per language (assuming 4 bytes for reference and 5 characters average word length), meaning about 1gb of data in total, the way hashes and strings work will require a great deal more memory than that, each string is an object that holds information such as the memory location, character encoding, length and so on. So ten times the memory consumption of the plain text data is actually a quite good accomplishment from Ruby.</p>\n\n<p>As others have suggested, the best option would be to store this data in a database or key-value store such as Redis, but you have rejected that option because of performance issues (on a regular laptop, Redis can perform well over 500 000 GETs per second).</p>\n\n<p>Another option to reduce the memory consumption would be to reduce the use of hashes and rely on array indexes. Your translator could look like this:</p>\n\n<pre><code>TRANSLATIONS = { \n  \"hello\" =&gt; ['bonjour', 'hola'],\n  \"thanks\" =&gt; ['merci', 'gracias']\n}\n\nLANGUAGES = { french: 0, spanish: 1 }\n\ndef translate(english_word, language)\n  TRANSLATIONS.dig(english_word, LANGUAGES[language])\nend\n\ntranslate('hello', :spanish)\n =&gt; 'hola'\n</code></pre>\n\n<p>Also, I can't resist noting that a translator made in this manner does not produce a result that is useful in any context. You can't translate sufficiently just by replacing each word with a translation of the word from another language. Also you would have to store pairs for each grammatical case, \"sleep, sleeps, sleeping, slept, sleeper, sleepy, asleep, ...\" to even find a matching word.</p>\n\n<p>Also, the Oxford English Dictionary only contains 171 476 words. </p>\n"}, {"tags": [], "owner": {"reputation": 55, "user_id": 3336134, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jfrQK.jpg?s=128&g=1", "display_name": "JoJo", "link": "https://stackoverflow.com/users/3336134/jojo"}, "is_accepted": false, "score": 0, "last_activity_date": 1580805117, "creation_date": 1580805117, "answer_id": 60053368, "question_id": 53062480, "link": "https://stackoverflow.com/questions/53062480/ruby-huge-hash-memory-usage/60053368#60053368", "title": "Ruby huge Hash &amp; memory usage", "body": "<p>After the following changes took places, it took less memory, and was faster:</p>\n\n<p>TRANSLATION_HASH was a Hash of hash ( 10 000 000 of hashes stored in a Hash)\nThe index (ex: \"dog\") was a string </p>\n\n<p>Ex: TRANSLATION_HASH[\"dog\"][\"fr\"] => \"chien\".</p>\n\n<p>Changed:\nTRANSLATION_INDEX[\"dog\"] => 1169    //hash storing a uniq key for each  10 000 000 English expressions.\nTRANSLATION_FR[1169] => \"chien\"\nTRANSLATION_ES[1169] => \"perro\"\n...</p>\n\n<p>So,  I turned 10 000 000 hashes into 11, and work with int index.</p>\n"}], "owner": {"reputation": 55, "user_id": 3336134, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jfrQK.jpg?s=128&g=1", "display_name": "JoJo", "link": "https://stackoverflow.com/users/3336134/jojo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1072, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1580805117, "creation_date": 1540896015, "last_edit_date": 1540896964, "question_id": 53062480, "link": "https://stackoverflow.com/questions/53062480/ruby-huge-hash-memory-usage", "title": "Ruby huge Hash &amp; memory usage", "body": "<p>How to improve memory usage ?</p>\n\n<p>I do a translator, from English to 10 languages.</p>\n\n<p>Ex:  <code>TRANSLATION_HASH[\"dog\"][\"fr\"] =&gt; chien.</code></p>\n\n<p>TRANSLATION_HASH contains 10 000 000 English expressions.</p>\n\n<p>It works great, but takes 10Gb of memory....\nNote: TRANSLATION_HASH is read only (i never  write to it)</p>\n\n<p>All is loaded (10 000 000 english expressions X 10 translations) once at start:</p>\n\n<p><code>TRANSLATION_HASH[\"word 1\"][\"fr\"] = \"french word from word 1\"\n TRANSLATION_HASH[\"word 1\"][\"es\"] = \"Spanish word from word 1\"\n TRANSLATION_HASH[\"word 1\"][\"de\"] = \"German word from word 1</code></p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "answers": [{"comments": [{"owner": {"reputation": 601, "user_id": 9315566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-pnkVEz0JwTw/AAAAAAAAAAI/AAAAAAAAASo/NlxvDhY5hi0/photo.jpg?sz=128", "display_name": "Shun Yamada", "link": "https://stackoverflow.com/users/9315566/shun-yamada"}, "edited": false, "score": 0, "creation_date": 1540903233, "post_id": 53062045, "comment_id": 93027315, "body": "Thanks @mehedi I can make it :)"}, {"owner": {"reputation": 436, "user_id": 2570423, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zVptB.png?s=128&g=1", "display_name": "mehedi", "link": "https://stackoverflow.com/users/2570423/mehedi"}, "reply_to_user": {"reputation": 601, "user_id": 9315566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-pnkVEz0JwTw/AAAAAAAAAAI/AAAAAAAAASo/NlxvDhY5hi0/photo.jpg?sz=128", "display_name": "Shun Yamada", "link": "https://stackoverflow.com/users/9315566/shun-yamada"}, "edited": false, "score": 0, "creation_date": 1540905117, "post_id": 53062045, "comment_id": 93028390, "body": "@ShunYamada If my answer solves your problem, will you please accept it as a solution. Thanks"}], "tags": [], "owner": {"reputation": 436, "user_id": 2570423, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zVptB.png?s=128&g=1", "display_name": "mehedi", "link": "https://stackoverflow.com/users/2570423/mehedi"}, "is_accepted": false, "score": 1, "last_activity_date": 1540895649, "last_edit_date": 1540895649, "creation_date": 1540894682, "answer_id": 53062045, "question_id": 53061087, "link": "https://stackoverflow.com/questions/53061087/rails-how-to-create-new-nested-records/53062045#53062045", "title": "Rails: how to create new nested records", "body": "<p>To allow adding and removing items use <code>link_to_add_association</code> and <code>link_to_remove_association</code> metthods as example below</p>\n\n<pre><code>&lt;%= form_with(model: @title) do |f| %&gt;\n  &lt;%= f.fields_for :candidates do |candidate| %&gt;\n    &lt;div class=\"candidate-item\"&gt;\n      &lt;%= candidate.hidden_field :title_id, value: @title.id %&gt;\n      &lt;div class=\"field\"&gt;\n        &lt;label&gt;Candidate&lt;/label&gt;\n        &lt;%= candidate.text_field :name%&gt;\n      &lt;/div&gt;\n      &lt;div class=\"field file-field\"&gt;\n        &lt;label&gt;Image&lt;/label&gt;\n        &lt;%= candidate.file_field :image, :type =&gt; \"file\" %&gt;\n      &lt;/div&gt;\n      &lt;div class=\"field file-field\"&gt;\n        &lt;%= link_to_remove_association 'remove candidates', candidate %&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n  &lt;% end %&gt;\n  &lt;div class=\"field file-field\"&gt;\n    &lt;%= link_to_add_association 'add candidates', f, :candidates %&gt;\n  &lt;/div&gt;\n&lt;% end %&gt;\n</code></pre>\n"}], "owner": {"reputation": 601, "user_id": 9315566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-pnkVEz0JwTw/AAAAAAAAAAI/AAAAAAAAASo/NlxvDhY5hi0/photo.jpg?sz=128", "display_name": "Shun Yamada", "link": "https://stackoverflow.com/users/9315566/shun-yamada"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1540895649, "creation_date": 1540891707, "last_edit_date": 1540895307, "question_id": 53061087, "link": "https://stackoverflow.com/questions/53061087/rails-how-to-create-new-nested-records", "title": "Rails: how to create new nested records", "body": "<p>I've just tried to create new nested items(candidates) with <code>Cocoon</code> gem. Currently views shows not create form but update form, how can I change form.</p>\n\n<p>I want to try to show just create form.</p>\n\n<pre><code>&lt;%= form_with(model: @title) do |f| %&gt;\n    &lt;%= f.fields_for :candidates do |candidate| %&gt;\n    &lt;div class=\"candidate-item\"&gt;\n        &lt;%= candidate.hidden_field :title_id, value: @title.id %&gt;\n        &lt;div class=\"field\"&gt;\n            &lt;label&gt;Candidate&lt;/label&gt;\n            &lt;%= candidate.text_field :name%&gt;\n        &lt;/div&gt;\n        &lt;div class=\"field file-field\"&gt;\n            &lt;label&gt;Image&lt;/label&gt;\n            &lt;%= candidate.file_field :image, :type =&gt; \"file\" %&gt; \n        &lt;/div&gt;\n    &lt;/div&gt;\n    &lt;% end %&gt;\n</code></pre>\n\n<p>I tried it like this:\n<code>form_with(model: @title, url: new_candidates_path</code> but an undefined error occurs. Candidates nested for titles. Please let me know any ideas which shows not update form, create form.</p>\n"}, {"tags": ["ruby", "ruby-on-rails-3", "bootstrap-4"], "comments": [{"owner": {"reputation": 293115, "user_id": 171456, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/B1qTo.jpg?s=128&g=1", "display_name": "Zim", "link": "https://stackoverflow.com/users/171456/zim"}, "edited": false, "score": 0, "creation_date": 1540896614, "post_id": 53060327, "comment_id": 93023623, "body": "Can you post the HTML please"}], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 9221123, "user_type": "registered", "profile_image": "https://graph.facebook.com/10214337241412532/picture?type=large", "display_name": "Christian Dziwornu", "link": "https://stackoverflow.com/users/9221123/christian-dziwornu"}, "edited": false, "score": 0, "creation_date": 1540939081, "post_id": 53060833, "comment_id": 93046006, "body": "Thanks. Worked for me."}], "tags": [], "owner": {"reputation": 86, "user_id": 9188118, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZLyOS.jpg?s=128&g=1", "display_name": "Moshi", "link": "https://stackoverflow.com/users/9188118/moshi"}, "is_accepted": true, "score": 0, "last_activity_date": 1540890801, "creation_date": 1540890801, "answer_id": 53060833, "question_id": 53060327, "link": "https://stackoverflow.com/questions/53060327/how-to-style-posts-in-bootstrap-card-column/53060833#53060833", "title": "How to style posts in bootstrap card column", "body": "<p>Try</p>\n\n<pre><code>&lt;div class=\"card-columns\" &gt;\n@posts.each do |post|\n     &lt;div class=\"card\" &gt;\n         &lt;div  class=\"card-body\" &gt;\n               access your posts here\n         &lt;/div&gt;\n      &lt;/div&gt;\n &lt;/div&gt;\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 9221123, "user_type": "registered", "profile_image": "https://graph.facebook.com/10214337241412532/picture?type=large", "display_name": "Christian Dziwornu", "link": "https://stackoverflow.com/users/9221123/christian-dziwornu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 53060833, "answer_count": 1, "score": 0, "last_activity_date": 1540890801, "creation_date": 1540888834, "question_id": 53060327, "link": "https://stackoverflow.com/questions/53060327/how-to-style-posts-in-bootstrap-card-column", "title": "How to style posts in bootstrap card column", "body": "<p>I have this code for posts that I want to show in bootstrap card column format.</p>\n\n<pre><code>%h4{:align =&gt; \"center\"} All Posts\n%hr.my-3\n- @posts.each do |post|\n  %h4= link_to post.title, post\n  %p= post.description\n  %p= post.company\n</code></pre>\n\n<p>I want to show the first post in one card and the next in the other consistently across the whole page. Seems with the bootstrap code I need to manually input the individual posts. I would want it to be automated. Thanks</p>\n"}, {"tags": ["ruby", "rake"], "comments": [{"owner": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1540887044, "post_id": 53059775, "comment_id": 93018357, "body": "Can&#39;t you just call <code>caller</code>?"}, {"owner": {"reputation": 845, "user_id": 4077574, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/orn50.png?s=128&g=1", "display_name": "Galaxy", "link": "https://stackoverflow.com/users/4077574/galaxy"}, "reply_to_user": {"reputation": 155803, "user_id": 314166, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zL1re.jpg?s=128&g=1", "display_name": "sawa", "link": "https://stackoverflow.com/users/314166/sawa"}, "edited": false, "score": 0, "creation_date": 1540888530, "post_id": 53059775, "comment_id": 93018975, "body": "@sawa seems like this <code>Kernel#caller</code> the not the outter caller (or bash caller)"}, {"owner": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "edited": false, "score": 0, "creation_date": 1540890515, "post_id": 53059775, "comment_id": 93019994, "body": "@hxpax what do you mean by that? can you show an example of what you want?"}, {"owner": {"reputation": 845, "user_id": 4077574, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/orn50.png?s=128&g=1", "display_name": "Galaxy", "link": "https://stackoverflow.com/users/4077574/galaxy"}, "reply_to_user": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "edited": false, "score": 0, "creation_date": 1540893479, "post_id": 53059775, "comment_id": 93021763, "body": "@maxpleaner updated"}], "answers": [{"comments": [{"owner": {"reputation": 845, "user_id": 4077574, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/orn50.png?s=128&g=1", "display_name": "Galaxy", "link": "https://stackoverflow.com/users/4077574/galaxy"}, "edited": false, "score": 0, "creation_date": 1541347440, "post_id": 53090010, "comment_id": 93176832, "body": "Thanks. So it&#39;s not possible to get the outter caller&#39;s path. We can only get the script path. Did I miss somthing?"}, {"owner": {"reputation": 146, "user_id": 10563676, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Y27jw.png?s=128&g=1", "display_name": "Fe&#241;a Agar", "link": "https://stackoverflow.com/users/10563676/fe%c3%b1a-agar"}, "reply_to_user": {"reputation": 845, "user_id": 4077574, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/orn50.png?s=128&g=1", "display_name": "Galaxy", "link": "https://stackoverflow.com/users/4077574/galaxy"}, "edited": false, "score": 0, "creation_date": 1541413932, "post_id": 53090010, "comment_id": 93195531, "body": "You can know 2 things:  1) The current path (<code>Dir.pwd</code>) 2) Where your program is (<code>__FILE__</code>)  But this is not even the bigger issue, because you&#39;re depending on a variable set by the user at execution time, so there&#39;s no exact way to guess which is the correct route rather than having the user telling you so."}, {"owner": {"reputation": 845, "user_id": 4077574, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/orn50.png?s=128&g=1", "display_name": "Galaxy", "link": "https://stackoverflow.com/users/4077574/galaxy"}, "edited": false, "score": 0, "creation_date": 1541559781, "post_id": 53090010, "comment_id": 93256110, "body": "It turns out, just Rake has such a problem, the Dir.pwd will only give you what you really want in Rakefiles."}, {"owner": {"reputation": 146, "user_id": 10563676, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Y27jw.png?s=128&g=1", "display_name": "Fe&#241;a Agar", "link": "https://stackoverflow.com/users/10563676/fe%c3%b1a-agar"}, "reply_to_user": {"reputation": 845, "user_id": 4077574, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/orn50.png?s=128&g=1", "display_name": "Galaxy", "link": "https://stackoverflow.com/users/4077574/galaxy"}, "edited": false, "score": 0, "creation_date": 1541665810, "post_id": 53090010, "comment_id": 93295937, "body": "What do you mean? <code>Dir.pwd</code> is Ruby and it&#39;s not monkeypatched by rake afaik:  <a href=\"https://ruby-doc.org/core-2.5.3/Dir.html#method-c-pwd\" rel=\"nofollow noreferrer\">ruby-doc.org/core-2.5.3/Dir.html#method-c-pwd</a>"}, {"owner": {"reputation": 845, "user_id": 4077574, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/orn50.png?s=128&g=1", "display_name": "Galaxy", "link": "https://stackoverflow.com/users/4077574/galaxy"}, "edited": false, "score": 0, "creation_date": 1541670787, "post_id": 53090010, "comment_id": 93298589, "body": "most of the time , the Rakefile is not called directly by the user, but the rake executalbe from another place when the user typed <code>rake</code>"}, {"owner": {"reputation": 146, "user_id": 10563676, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Y27jw.png?s=128&g=1", "display_name": "Fe&#241;a Agar", "link": "https://stackoverflow.com/users/10563676/fe%c3%b1a-agar"}, "reply_to_user": {"reputation": 845, "user_id": 4077574, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/orn50.png?s=128&g=1", "display_name": "Galaxy", "link": "https://stackoverflow.com/users/4077574/galaxy"}, "edited": false, "score": 0, "creation_date": 1541670989, "post_id": 53090010, "comment_id": 93298717, "body": "You can only call rake within a folder that contains a <code>Rakefile</code>, I still don&#39;t know what you mean, but meh... if you figured it out it&#39;s fine I guess."}, {"owner": {"reputation": 845, "user_id": 4077574, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/orn50.png?s=128&g=1", "display_name": "Galaxy", "link": "https://stackoverflow.com/users/4077574/galaxy"}, "edited": false, "score": 0, "creation_date": 1541671258, "post_id": 53090010, "comment_id": 93298856, "body": "Yeah, but this does not make the problem gone, still it will apera when you are in a sub folder"}], "tags": [], "owner": {"reputation": 146, "user_id": 10563676, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Y27jw.png?s=128&g=1", "display_name": "Fe&#241;a Agar", "link": "https://stackoverflow.com/users/10563676/fe%c3%b1a-agar"}, "is_accepted": true, "score": 0, "last_activity_date": 1577080931, "last_edit_date": 1577080931, "creation_date": 1541011101, "answer_id": 53090010, "question_id": 53059775, "link": "https://stackoverflow.com/questions/53059775/how-to-get-the-caller-path-from-ruby-rake/53090010#53090010", "title": "How to get the caller path from Ruby/Rake?", "body": "<p>You can tell where the user is right now, like you said, with <code>Dir.pwd</code>, but there's no way to guess which absolute path the user really wants.</p>\n\n<p>This is why most scripts (or apps, etc) either have a <code>ROOT_DIR</code> that allows you to default to that as a prefix for the rest of the directory structure or just assume the file passed is under the current folder (shown by pwd).</p>\n\n<p>Your choice is either set this ROOT_DIR somewhere in your code or just being open to the chance the user gives you a relative path to a file without really knowing what the absolute route to that file is and just assume is under their current dir.</p>\n"}], "owner": {"reputation": 845, "user_id": 4077574, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/orn50.png?s=128&g=1", "display_name": "Galaxy", "link": "https://stackoverflow.com/users/4077574/galaxy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 242, "favorite_count": 0, "accepted_answer_id": 53090010, "answer_count": 1, "score": 0, "last_activity_date": 1577080931, "creation_date": 1540886597, "last_edit_date": 1540897229, "question_id": 53059775, "link": "https://stackoverflow.com/questions/53059775/how-to-get-the-caller-path-from-ruby-rake", "title": "How to get the caller path from Ruby/Rake?", "body": "<p>In Ruby/Rake(a gem for Ruby), current file path can be get through <code>Dir.pwd</code> and <code>__FILE__</code>.</p>\n\n<p>There are times I want to get the caller's path, like to figure out a relative path the caller provided which is relative to their path (but not relative to the path of the Rakefile).</p>\n\n<p><strong>An example</strong></p>\n\n<p>In a Rakefile from directory <code>/home/me/workspace/proj</code>:</p>\n\n<pre><code># ...\n\ntask :foo do\n  file_name = ENV['WHICH_FILE']\n\n  # As I can not get the caller dir, give it the Rakefile dir instead\n  caller_dir = Dir.pwd\n\n  file_name = \"#{call_dir}/#{file_name}\" unless file_name&amp;.match? /^\\//\n  puts File.read file_name\n  # ...\nend\n\n# ...\n</code></pre>\n\n<p>If a caller provides the absolute path of the target file, no problem:</p>\n\n<pre><code>$ WHICH_FILE=/home/me/workspace/proj/suba/subb/subc/file.txt rake foo\n</code></pre>\n\n<p>If a caller in <code>/home/me/workspace/proj</code> provides a relative path, still no problem:</p>\n\n<pre><code>$ WHICH_FILE=suba/subb/subc/file.txt rake foo\n</code></pre>\n\n<p>If a caller in <code>/home/me/workspace/proj/suba</code> provides a relative path, the file_name may point to a wrong place:</p>\n\n<pre><code>$ WHICH_FILE=subb/subc/file.txt rake foo\n</code></pre>\n\n<p>Now <code>file_name</code> would be <code>/home/me/workspace/proj/subb/subc/file.txt</code>, which may not be what the caller want.</p>\n\n<p><strong>Questions</strong></p>\n\n<p>Is it possible to get the caller's path in Ruby/Rake? If it's possible, how?</p>\n"}, {"tags": ["ruby", "heroku"], "comments": [{"owner": {"reputation": 20644, "user_id": 184184, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f6a508697f9eca2680b12ddb85ba1319?s=128&d=identicon&r=PG", "display_name": "Lenin Raj Rajasekaran", "link": "https://stackoverflow.com/users/184184/lenin-raj-rajasekaran"}, "edited": false, "score": 0, "creation_date": 1540962335, "post_id": 53059719, "comment_id": 93050969, "body": "There should be more info the logs"}, {"owner": {"reputation": 586, "user_id": 11580993, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-gIl87t-ixKI/AAAAAAAAAAI/AAAAAAAAAMo/-sf497KrPZM/photo.jpg?sz=128", "display_name": "Franky Doul", "link": "https://stackoverflow.com/users/11580993/franky-doul"}, "reply_to_user": {"reputation": 20644, "user_id": 184184, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f6a508697f9eca2680b12ddb85ba1319?s=128&d=identicon&r=PG", "display_name": "Lenin Raj Rajasekaran", "link": "https://stackoverflow.com/users/184184/lenin-raj-rajasekaran"}, "edited": false, "score": 0, "creation_date": 1540969239, "post_id": 53059719, "comment_id": 93053330, "body": "Hi Emaillenin, yes but it would take a few pages to display, so I took only the red lines. It is not enough ?"}], "owner": {"reputation": 586, "user_id": 11580993, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-gIl87t-ixKI/AAAAAAAAAAI/AAAAAAAAAMo/-sf497KrPZM/photo.jpg?sz=128", "display_name": "Franky Doul", "link": "https://stackoverflow.com/users/11580993/franky-doul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 164, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1540946375, "creation_date": 1540886296, "last_edit_date": 1540946375, "question_id": 53059719, "link": "https://stackoverflow.com/questions/53059719/deployment-of-rails-website-on-heroku-errors", "title": "Deployment of Rails website on Heroku errors", "body": "<p>Trying to finally deploy to Heroku, but I have two messages which seem like red flags, and ultimately the deployment does not work. \nERROR 1,  that I see (after : <code>$ git push heroku master</code>)</p>\n\n<pre><code>remote:        Detecting rails configuration failed\nremote:        set HEROKU_DEBUG_RAILS_RUNNER=1 to debug\n</code></pre>\n\n<p>When i use the <code>heroku logs --tail</code>\nERROR 2:</p>\n\n<pre><code>2018-10-30T07:18:41.859565+00:00 app[web.1]: COMPILATION ERROR: error executing \"gcc -shared  -Wl,--compress-debug-sections=zlib -fPIC -O3 -g -Wall -Wextra -Wno-unused-parameter -Wno-parentheses -Wno-long-long -Wno-missing-field-initializers -Wno-tautological-compare -Wno-parentheses-equality -Wno-constant-logical-operand -Wno-self-assign -Wunused-variable -Wimplicit-int -Wpointer-arith -Wwrite-strings -Wdeclaration-after-statement -Wimplicit-function-declaration -Wdeprecated-declarations -Wmisleading-indentation -Wno-packed-bitfield-compat -Wsuggest-attribute=noreturn -Wsuggest-attribute=format -Wimplicit-fallthrough=0 -Wduplicated-cond -Wrestrict -L. -fstack-protector -rdynamic -Wl,-export-dynamic -I /app/vendor/ruby-2.5.0/include/ruby-2.5.0 -I /app/vendor/ruby-2.5.0/include/ruby-2.5.0/x86_64-linux -I /app/vendor/ruby-2.5.0/include -L/app/vendor/ruby-2.5.0/lib -o \\\"/app/.ruby_inline/ruby-2.5.0/Inline_String_9a6686966a50705d94442f198bc2c408.so\\\" \\\"/app/.ruby_inline/ruby-2.5.0/Inline_String_9a6686966a50705d94442f198bc2c408.c\\\"  \": pid 8 exit 127\n</code></pre>\n\n<p>ERROR 3, much below in the logs:</p>\n\n<pre><code>2018-10-30T07:18:49.967238+00:00 heroku[web.1]: State changed from starting to crashed\n2018-10-30T07:18:51.776458+00:00 heroku[router]: at=error code=H10 desc=\"App crashed\" method=GET path=\"/\" host=XXXXXXXXXXXX dyno= connect= service= status=503 bytes= protocol=https\n2018-10-30T07:19:00.599846+00:00 heroku[router]: at=error code=H10 desc=\"App crashed\" method=GET path=\"/\"  host=XXXXXXXXXXXX dyno= connect= service= status=503 bytes= protocol=https\n2018-10-30T07:19:26.069175+00:00 heroku[router]: at=error code=H10 desc=\"App crashed\" method=GET path=\"/favicon.ico\" host= host=XXXXXXXXXXXX dyno= connect= service= status=503 bytes= protocol=https\n2018-10-30T07:20:18.694993+00:00 heroku[router]: at=error code=H10 desc=\"App crashed\" method=GET path=\"/\" host= host=XXXXXXXXXXXX dyno= connect= service= status=503 bytes= protocol=https\n2018-10-30T07:20:22.175572+00:00 heroku[router]: at=error code=H10 desc=\"App crashed\" method=GET path=\"/favicon.ico\" host= host=XXXXXXXXXXXX dyno= connect= service= status=503 bytes= protocol=https\n</code></pre>\n\n<p>These errors are fairly difficult to relate to as it is the first time for me. Is anyone familiar with them ? </p>\n"}, {"tags": ["ruby-on-rails", "ruby", "api", "pagination", "shopify"], "comments": [{"owner": {"reputation": 61, "user_id": 6841853, "user_type": "registered", "profile_image": "https://graph.facebook.com/797929556976822/picture?type=large", "display_name": "Kuanish Esenbaev", "link": "https://stackoverflow.com/users/6841853/kuanish-esenbaev"}, "edited": false, "score": 1, "creation_date": 1540886228, "post_id": 53058532, "comment_id": 93018031, "body": "You can use  <a href=\"https://github.com/kaminari/kaminari\" rel=\"nofollow noreferrer\">kaminari gem</a>. This gem can convert array into paginatable array"}, {"owner": {"reputation": 21, "user_id": 5714439, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-b8JYQ5vwqcE/AAAAAAAAAAI/AAAAAAAAAAA/qCDaJYigQcE/photo.jpg?sz=128", "display_name": "Bhagwan Rajput", "link": "https://stackoverflow.com/users/5714439/bhagwan-rajput"}, "reply_to_user": {"reputation": 61, "user_id": 6841853, "user_type": "registered", "profile_image": "https://graph.facebook.com/797929556976822/picture?type=large", "display_name": "Kuanish Esenbaev", "link": "https://stackoverflow.com/users/6841853/kuanish-esenbaev"}, "edited": false, "score": 0, "creation_date": 1540969887, "post_id": 53058532, "comment_id": 93053588, "body": "But I think it&#39;s not useful with shopify API because I can&#39;t fetch all products from shopify in one API call. I&#39;ll have to pass params page in shopify API call and it will return 10 products at a time. When I call shopify API I can track total count of products and can fetch products according to page. but I&#39;m unable to manage those products on view."}], "answers": [{"tags": [], "owner": {"reputation": 61, "user_id": 6841853, "user_type": "registered", "profile_image": "https://graph.facebook.com/797929556976822/picture?type=large", "display_name": "Kuanish Esenbaev", "link": "https://stackoverflow.com/users/6841853/kuanish-esenbaev"}, "is_accepted": false, "score": 0, "last_activity_date": 1541669451, "creation_date": 1541669451, "answer_id": 53204872, "question_id": 53058532, "link": "https://stackoverflow.com/questions/53058532/how-can-i-add-pagination-on-shopify-api-products-with-rails-gem/53204872#53204872", "title": "How can I add pagination on shopify API products with rails gem", "body": "<p>You can use <code>Kaminari.paginate_array(*args)</code> with array(array of Shopify products) as first argument and with option as hash, where you have to set value to <code>total_count</code> key.</p>\n\n<p>Full example: </p>\n\n<pre><code>@paginatable_array = Kaminari.paginate_array(@shopify_products, total_count:145).page(1).per(10)\n</code></pre>\n\n<p>use <code>1</code> as argument to <code>.page</code> method, because your array will contain only 10 objects(if limit is 10 and 10 objects in view)\nIn view just use helper method</p>\n\n<pre><code>&lt;%= paginate @paginatable_array %&gt;\n</code></pre>\n\n<p>I hope that it will help!</p>\n"}, {"tags": [], "owner": {"reputation": 29, "user_id": 5865578, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-DZyrbO2aGk4/AAAAAAAAAAI/AAAAAAAAAD8/zxzokABfDrE/photo.jpg?sz=128", "display_name": "Verdier Assoume", "link": "https://stackoverflow.com/users/5865578/verdier-assoume"}, "is_accepted": false, "score": 0, "last_activity_date": 1600878205, "last_edit_date": 1600878205, "creation_date": 1600826294, "answer_id": 64019956, "question_id": 53058532, "link": "https://stackoverflow.com/questions/53058532/how-can-i-add-pagination-on-shopify-api-products-with-rails-gem/64019956#64019956", "title": "How can I add pagination on shopify API products with rails gem", "body": "<p>I think is late for your work. But this how to it:</p>\n<p>Example</p>\n<pre><code>@orders = ShopifyAPI::Order.find(:all, :params =&gt; {:status =&gt; &quot;any&quot;, :limit =&gt; 3, :order =&gt; &quot;created_at DESC&quot; })\n@orders.each do |order|\n\n  id = order.id\n  name = order.name\nend\n\nwhile @orders.next_page?\n  @orders = @orders.fetch_next_page\n  @orders.each do |order|\n\n    id = order.id\n    name = order.name\n  end\nend\n</code></pre>\n<p>So you can create paginable array based on what you receive in each loop. The first call defines the limit for all subsequents call to fetch_next_page. In my case each page contain 3 element, you can go up to 250.</p>\n<p>Another way is to navigate using shopify &quot;next_page_info&quot; parameter, so you only need to fetch the first query and include all filters, then just navigate back/fwd with page infos(previous_page_info or next_page_info).</p>\n<pre><code>Example 2\nfirst_batch_products = ShopifyAPI::Product.find(:all, params: { limit: 50 })\n  second_batch_products = ShopifyAPI::Product.find(:all, params: { limit: 50, page_info: first_batch_products.next_page_info })\n\nnext_page_info = @orders.next_page_info\nprev_page_info = @orders.previous_page_info\n</code></pre>\n<p>More info here: <a href=\"https://github.com/Shopify/shopify_api#pagination\" rel=\"nofollow noreferrer\">https://github.com/Shopify/shopify_api#pagination</a></p>\n<p>Regards.</p>\n"}], "owner": {"reputation": 21, "user_id": 5714439, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-b8JYQ5vwqcE/AAAAAAAAAAI/AAAAAAAAAAA/qCDaJYigQcE/photo.jpg?sz=128", "display_name": "Bhagwan Rajput", "link": "https://stackoverflow.com/users/5714439/bhagwan-rajput"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 444, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1600878205, "creation_date": 1540880869, "last_edit_date": 1540889550, "question_id": 53058532, "link": "https://stackoverflow.com/questions/53058532/how-can-i-add-pagination-on-shopify-api-products-with-rails-gem", "title": "How can I add pagination on shopify API products with rails gem", "body": "<p>I'm using the rails gem <a href=\"https://github.com/Shopify/shopify_api\" rel=\"nofollow noreferrer\">shopify API gem</a> to fetch shopify products. I'm fetching products like this:</p>\n\n<pre><code>ShopifyAPI::Product.find(:all, params: { page: parmas[:page], \n                                          limit: 10, \n                                          title: params[:search]\n                                        })\n</code></pre>\n\n<p>this API returns products searched by title with limit 10.\nSo How can I add pagination on my view or can I use <a href=\"https://github.com/mislav/will_paginate\" rel=\"nofollow noreferrer\">will_paginate</a> gem for it?\nPlease help!, thanks! in advance.</p>\n"}, {"tags": ["arrays", "ruby", "loops"], "comments": [{"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 1, "creation_date": 1540873160, "post_id": 53056955, "comment_id": 93013639, "body": "It&#39;s unclear what you&#39;re trying to do here.  Perhaps give a sample of input data, and what you finally want to do after you &quot;compare&quot; them.  There is probably a better way to do this."}], "answers": [{"comments": [{"owner": {"reputation": 5449, "user_id": 681520, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/701baebf68d1d7faa9f9def6a24fe356?s=128&d=identicon&r=PG", "display_name": "Kimmo Lehto", "link": "https://stackoverflow.com/users/681520/kimmo-lehto"}, "edited": false, "score": 0, "creation_date": 1540901101, "post_id": 53062997, "comment_id": 93026195, "body": "Your solution assumes that the rows are in sync. The original question scans the second file for each <code>file_a</code> row to look for a matching line in <code>file_b</code>."}, {"owner": {"reputation": 436, "user_id": 2570423, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zVptB.png?s=128&g=1", "display_name": "mehedi", "link": "https://stackoverflow.com/users/2570423/mehedi"}, "reply_to_user": {"reputation": 5449, "user_id": 681520, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/701baebf68d1d7faa9f9def6a24fe356?s=128&d=identicon&r=PG", "display_name": "Kimmo Lehto", "link": "https://stackoverflow.com/users/681520/kimmo-lehto"}, "edited": false, "score": 0, "creation_date": 1540904980, "post_id": 53062997, "comment_id": 93028320, "body": "@KimmoLehto The point I tried to make here is to creating data array from those files at first and then play with those data arrays. The cause of the problem <i><b>I cannot go back and extract the next values</b></i> - is because he was using nested loop, which I tried to avoid in my approach. TIA."}, {"owner": {"reputation": 5449, "user_id": 681520, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/701baebf68d1d7faa9f9def6a24fe356?s=128&d=identicon&r=PG", "display_name": "Kimmo Lehto", "link": "https://stackoverflow.com/users/681520/kimmo-lehto"}, "edited": false, "score": 0, "creation_date": 1540905678, "post_id": 53062997, "comment_id": 93028698, "body": "It could scan the in-memory data of set B for each item in set A to find a matching pair."}], "tags": [], "owner": {"reputation": 436, "user_id": 2570423, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zVptB.png?s=128&g=1", "display_name": "mehedi", "link": "https://stackoverflow.com/users/2570423/mehedi"}, "is_accepted": false, "score": -1, "last_activity_date": 1540897719, "creation_date": 1540897719, "answer_id": 53062997, "question_id": 53056955, "link": "https://stackoverflow.com/questions/53056955/run-parallel-loops-in-ruby/53062997#53062997", "title": "Run parallel loops in Ruby", "body": "<p>First, convert those 2 files into two separated data arrays</p>\n\n<pre><code>lines_array_a = File.readlines(file_set_a)\nlines_array_b = File.readlines(file_set_b)\n</code></pre>\n\n<p>I am assuming both of the array size will be same. Now run a loop and get the items from both array to compare them.</p>\n\n<pre><code>for i in 0..(lines_array_a.count - 1) do\n  data_array_a = lines_array_a[i].split(\"\\t\")\n  @file_name_a = data_array_a[0]\n  @file_ext_a = data_array_a[1]\n\n  data_array_b = lines_array_b[i].split(\"\\t\")\n  @file_name_b = data_array_b[0]\n  @file_ext_b = data_array_b[1]\n\n  @file_name_a == @file_name_b\nend\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 4734706, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/sH4At.jpg?s=128&g=1", "display_name": "Zaf", "link": "https://stackoverflow.com/users/4734706/zaf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 133, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1540897719, "creation_date": 1540870081, "last_edit_date": 1540883924, "question_id": 53056955, "link": "https://stackoverflow.com/questions/53056955/run-parallel-loops-in-ruby", "title": "Run parallel loops in Ruby", "body": "<p>I have two sets of arrays stored in a file and I need to extract values one by one and compare them. I am using this code but does look like I am doing correctly. </p>\n\n<pre><code># First Dataset\nFile.foreach(file_set_a) do |data_a|\n\n  data_array_a = data_a.split(\"\\t\")\n  @file_name_a = data_array_a[0]\n  @file_ext_a = data_array_a[1]\n\n  # Second Dataset\n  File.foreach(file_set_b) do |data_b|\n\n    data_array_b = data_b.split(\"\\t\")\n    @file_name_b = data_array_b[0]\n    @file_ext_b = data_array_b[1]\n\n    #Compare\n    @file_name_a == @file_name_b \n  end\nend\n</code></pre>\n\n<p>The problem is, I cannot go back and extract the next values in the set A when I enter the set B. Any suggestions?</p>\n"}, {"tags": ["ruby", "integer", "comparison"], "comments": [{"owner": {"reputation": 985, "user_id": 1218280, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/490d74e521a4803d9363359288cd6f92?s=128&d=identicon&r=PG", "display_name": "Dan Sharp", "link": "https://stackoverflow.com/users/1218280/dan-sharp"}, "edited": false, "score": 0, "creation_date": 1540911419, "post_id": 53056718, "comment_id": 93032580, "body": "Man I love StackOverflow! Thanks everyone! I knew it was simple but for some reason my brain was over-complicating it... I was doing a conditional to figure out which was bigger and thought there must be a simpler way."}], "answers": [{"comments": [{"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1540869924, "post_id": 53056781, "comment_id": 93012978, "body": "benchmark your 2nd version, it&#39;s 10x slower than 1st version,with small ragne and gets exponentially worse with large ragne."}, {"owner": {"reputation": 4866, "user_id": 6603195, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nZGPkfcc0EE/AAAAAAAAAAI/AAAAAAAAAoE/op-TBiFRNzg/photo.jpg?sz=128", "display_name": "Marcin Ko\u0142odziej", "link": "https://stackoverflow.com/users/6603195/marcin-ko%c5%82odziej"}, "reply_to_user": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1540871051, "post_id": 53056781, "comment_id": 93013209, "body": "It&#39;s about 2.5 times slower for me (mostly range initialization) and it does not get exponentially worse, because this is not how ranges are implemented in Ruby."}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1540871850, "post_id": 53056781, "comment_id": 93013363, "body": "you modified your answer since I commented that, but that&#39;s good because it now performs much better"}], "tags": [], "owner": {"reputation": 4866, "user_id": 6603195, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nZGPkfcc0EE/AAAAAAAAAAI/AAAAAAAAAoE/op-TBiFRNzg/photo.jpg?sz=128", "display_name": "Marcin Ko\u0142odziej", "link": "https://stackoverflow.com/users/6603195/marcin-ko%c5%82odziej"}, "is_accepted": false, "score": 2, "last_activity_date": 1540871201, "last_edit_date": 1540871201, "creation_date": 1540868585, "answer_id": 53056781, "question_id": 53056718, "link": "https://stackoverflow.com/questions/53056718/how-do-you-check-if-two-numbers-are-within-a-threshold-of-each-other/53056781#53056781", "title": "How do you check if two numbers are within a threshold of each other?", "body": "<p>Check whether their absolute difference is in the threshold,</p>\n\n<pre><code>(first - second).abs &lt;= threshold\n</code></pre>\n\n<p>Or check whether their distance is between <code>-threshold..threshold</code>, like so:</p>\n\n<pre><code>(-threshold..threshold).cover?(first - second)\n</code></pre>\n\n<p>or so:</p>\n\n<pre><code>(first - second).between?(-threshold, threshold)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": true, "score": 2, "last_activity_date": 1540870013, "last_edit_date": 1540870013, "creation_date": 1540869372, "answer_id": 53056872, "question_id": 53056718, "link": "https://stackoverflow.com/questions/53056718/how-do-you-check-if-two-numbers-are-within-a-threshold-of-each-other/53056872#53056872", "title": "How do you check if two numbers are within a threshold of each other?", "body": "<p>Will this work for you?</p>\n\n<pre><code>def in_range(hi, lo, range)\n  (hi-lo).abs &lt;= range\nend\n\nin_range(5, 10, 3) #=&gt; false\nin_range(7, 10, 3) #=&gt; true\n</code></pre>\n\n<p>And it's pretty fast regardless of range</p>\n\n<pre><code>puts Benchmark.measure{ 10_000.times{in_range(50_000, 1_000_000_000, 53000)} }\n#=&gt;0.000000   0.000000   0.000000 (  0.000936)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1540897627, "post_id": 53058797, "comment_id": 93024208, "body": "Benchmark this.  It can be up to 75% slower than a simple <code>&lt;=</code> comparison depending on the range."}], "tags": [], "owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "is_accepted": false, "score": 0, "last_activity_date": 1540882185, "creation_date": 1540882185, "answer_id": 53058797, "question_id": 53056718, "link": "https://stackoverflow.com/questions/53056718/how-do-you-check-if-two-numbers-are-within-a-threshold-of-each-other/53058797#53058797", "title": "How do you check if two numbers are within a threshold of each other?", "body": "<p>Other option, using <a href=\"https://ruby-doc.org/core-2.5.1/Enumerable.html#method-i-include-3F\" rel=\"nofollow noreferrer\">Enumerable#include</a>:</p>\n\n<pre><code>(x1 - delta..x1 + delta).include? x2\n</code></pre>\n\n<p>Where <code>x1</code> is the first point, <code>x2</code> is the second point and <code>delta</code> is the threshold.</p>\n"}], "owner": {"reputation": 985, "user_id": 1218280, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/490d74e521a4803d9363359288cd6f92?s=128&d=identicon&r=PG", "display_name": "Dan Sharp", "link": "https://stackoverflow.com/users/1218280/dan-sharp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 443, "favorite_count": 0, "accepted_answer_id": 53056872, "answer_count": 3, "score": 2, "last_activity_date": 1540882185, "creation_date": 1540868043, "last_edit_date": 1540880284, "question_id": 53056718, "link": "https://stackoverflow.com/questions/53056718/how-do-you-check-if-two-numbers-are-within-a-threshold-of-each-other", "title": "How do you check if two numbers are within a threshold of each other?", "body": "<p>I need to check if an image's content length has changed. However, there are some images that seem to oscillate within about 15 or 20 bytes. So I want to say: \"these two images are effectively the same if their content length is within 25 bytes\".</p>\n\n<p>Let's say that I have two numbers: <code>first</code> and <code>second</code> that are positive integers and a <code>threshold</code> that is also a positive integer. What is the simplest way to determine if the two numbers are within the threshold of each other?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-3.2", "asset-pipeline", "digital-ocean"], "comments": [{"owner": {"reputation": 845, "user_id": 1438490, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2b5a2a06d400bab9b28da10fde90accf?s=128&d=identicon&r=PG", "display_name": "Scott Jacobsen", "link": "https://stackoverflow.com/users/1438490/scott-jacobsen"}, "edited": false, "score": 0, "creation_date": 1540915674, "post_id": 53056537, "comment_id": 93035251, "body": "* Look at the logs under the <code>Activity</code> tab on Heroku to get an idea of what commands are being run on heroku.  * Are you sure you are running your code in production mode on the droplet? How did you verify this? Doing varies from setup to setup.  * When you run rake assets:precompile do you see the compiled files, with fingerprints, in the public/assets directory?  * Was the heroku system setup to use a CDN?"}, {"owner": {"reputation": 845, "user_id": 1438490, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2b5a2a06d400bab9b28da10fde90accf?s=128&d=identicon&r=PG", "display_name": "Scott Jacobsen", "link": "https://stackoverflow.com/users/1438490/scott-jacobsen"}, "edited": false, "score": 0, "creation_date": 1540916036, "post_id": 53056537, "comment_id": 93035458, "body": "Also be aware that older versions of rails would generate both a fingerprinted and a non-fingerprinted version of the asset. Sometimes people would create links to the non-fingerprinted version by mistake. New versions of rails should only generate the fingerprinted versions, so view your html and be sure all asset links are fingerprinted."}, {"owner": {"reputation": 2139, "user_id": 276664, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/hUUal.jpg?s=128&g=1", "display_name": "cmhobbs", "link": "https://stackoverflow.com/users/276664/cmhobbs"}, "reply_to_user": {"reputation": 845, "user_id": 1438490, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2b5a2a06d400bab9b28da10fde90accf?s=128&d=identicon&r=PG", "display_name": "Scott Jacobsen", "link": "https://stackoverflow.com/users/1438490/scott-jacobsen"}, "edited": false, "score": 0, "creation_date": 1540954666, "post_id": 53056537, "comment_id": 93049345, "body": "I&#39;m running in production mode.  <code>RAILS_ENV</code> is set to production and logging goes to <code>log&#47;production.rb</code>.  I&#39;m running the same commands on Heroku at the moment.  I do not see all of the compiled files in <code>public&#47;assets</code> when i run <code>rake assets:precompile</code>, I only see some of them, which is the issue with my question.  Heroku was not set up to run a CDN.  Of the missing assets, I have neither fingerprinted nor nonfingerprinted copies of them apparently post-compilation."}], "answers": [{"comments": [{"owner": {"reputation": 2139, "user_id": 276664, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/hUUal.jpg?s=128&g=1", "display_name": "cmhobbs", "link": "https://stackoverflow.com/users/276664/cmhobbs"}, "edited": false, "score": 0, "creation_date": 1540954461, "post_id": 53057447, "comment_id": 93049319, "body": "I don&#39;t have <code>rails_12factor</code> in my Gemfile anywhere.  Making the suggested changes to my production.rb file throws a 500 <code>ActionView::Template::Errror</code> for the first CSS asset, stating that it&#39;s not precompiled."}], "tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": false, "score": 0, "last_activity_date": 1540874042, "last_edit_date": 1540874042, "creation_date": 1540873711, "answer_id": 53057447, "question_id": 53056537, "link": "https://stackoverflow.com/questions/53056537/some-assets-not-loading-in-an-old-rails-3-2-stable-app/53057447#53057447", "title": "Some assets not loading in an old Rails 3-2-stable app", "body": "<p>Perhaps try changing these in production.rb but no guarantees, may be worth trying.  </p>\n\n<pre><code>config.serve_static_files = true\nconfig.assets.compile = false\n</code></pre>\n\n<p>Also if you have this in Gemfile, you might wanna try to comment it out and bundle install locally before deploy.</p>\n\n<pre><code>gem 'rails_12factor', group: :production\n</code></pre>\n\n<p>That \ud83d\udca9was required by Heroku but you may not need it on DO.  See <a href=\"https://github.com/heroku/rails_12factor\" rel=\"nofollow noreferrer\">https://github.com/heroku/rails_12factor</a></p>\n\n<p>Also, please if you can post more relevant info about your DO stack and maybe your Capfile</p>\n"}, {"comments": [{"owner": {"reputation": 2139, "user_id": 276664, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/hUUal.jpg?s=128&g=1", "display_name": "cmhobbs", "link": "https://stackoverflow.com/users/276664/cmhobbs"}, "edited": false, "score": 0, "creation_date": 1540959173, "post_id": 53063884, "comment_id": 93050252, "body": "this did not change any behaviour on my end."}], "tags": [], "owner": {"reputation": 436, "user_id": 2570423, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zVptB.png?s=128&g=1", "display_name": "mehedi", "link": "https://stackoverflow.com/users/2570423/mehedi"}, "is_accepted": false, "score": 0, "last_activity_date": 1540912717, "last_edit_date": 1540912717, "creation_date": 1540900936, "answer_id": 53063884, "question_id": 53056537, "link": "https://stackoverflow.com/questions/53056537/some-assets-not-loading-in-an-old-rails-3-2-stable-app/53063884#53063884", "title": "Some assets not loading in an old Rails 3-2-stable app", "body": "<p>Just changing this on your <code>production.rb</code> should work:</p>\n\n<pre><code>config.serve_static_assets = true\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2139, "user_id": 276664, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/hUUal.jpg?s=128&g=1", "display_name": "cmhobbs", "link": "https://stackoverflow.com/users/276664/cmhobbs"}, "edited": false, "score": 0, "creation_date": 1541122835, "post_id": 53097084, "comment_id": 93118310, "body": "This was it!  Thanks so much!  I have to add each file individually but it works.  I can&#39;t give it <code>*.css</code> due to a bug in an ancient version of a bootstrap gem included with the project but I&#39;ll take it.  Thanks again!  I&#39;ll award the bounty as soon as stack overflow unlocks it.  THANKS!"}], "tags": [], "owner": {"reputation": 2518, "user_id": 762606, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/91ec89bebde3176c1e64172d0ee6c1a2?s=128&d=identicon&r=PG", "display_name": "Dipil", "link": "https://stackoverflow.com/users/762606/dipil"}, "is_accepted": true, "score": 2, "last_activity_date": 1541058472, "creation_date": 1541058472, "answer_id": 53097084, "question_id": 53056537, "link": "https://stackoverflow.com/questions/53056537/some-assets-not-loading-in-an-old-rails-3-2-stable-app/53097084#53097084", "title": "Some assets not loading in an old Rails 3-2-stable app", "body": "<p>The asset pipeline concatenates your assets to only generate and serve specified files, 'application.js', 'application.css' and images/fonts by default. </p>\n\n<p>If you are explicitly including other css/js files in your application via the <code>javascript_include_tag</code> or <code>stylesheet_link_tag</code> helpers, you'll need to add those files manually to the pipeline via the <code>config.assets.precompile +=</code> setting in your <code>application.rb</code> or an initializer. </p>\n\n<p>Currently, those files should already be included within your <code>application</code> manifest via the <code>require_tree .</code> directive. So, the styles might be being applied right now too. If that's the case, you can just remove your code that adds the individual stylesheets separately to get rid of the 404s.</p>\n\n<p>Still not sure how the app is working fine on heroku, maybe you have some heroku config that's enabling serving the static assets.</p>\n"}], "owner": {"reputation": 2139, "user_id": 276664, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/hUUal.jpg?s=128&g=1", "display_name": "cmhobbs", "link": "https://stackoverflow.com/users/276664/cmhobbs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 366, "favorite_count": 0, "accepted_answer_id": 53097084, "answer_count": 3, "score": 2, "last_activity_date": 1541058472, "creation_date": 1540866456, "last_edit_date": 1541035650, "question_id": 53056537, "link": "https://stackoverflow.com/questions/53056537/some-assets-not-loading-in-an-old-rails-3-2-stable-app", "title": "Some assets not loading in an old Rails 3-2-stable app", "body": "<p><strong>BIG UPDATES AT THE BOTTOM OF THIS POST</strong></p>\n\n<p>I have a Rails 3-2-stable app that I'm moving to a new server so I can work on upgrading it to Rails 5.  Currently, it's hosted on Heroku and most of the assets show up just fine (the app Just Works (TM)).  I have a few random assets that will not show up after precompilation on a Digital Ocean droplet.  I'm deploying with Capistrano.</p>\n\n<p>The error for the assets that won't show up look something like this:</p>\n\n<pre><code>Loading failed for the &lt;script&gt; with source \u201chttp://stage.fancy-new-droplet.com/assets/application/application.js\u201d.\n</code></pre>\n\n<p>In some cases, there will be a hash associated with the asset like this:</p>\n\n<pre><code>Loading failed for the &lt;script&gt; with source \u201chttp://stage.fancy-new-droplet.com/assets/application/certifications-56046476595984b00d1267a4f02822e5.js\n</code></pre>\n\n<p>In the former case, the asset is actually in <code>public/assets/</code> as opposed to <code>public/assets/application/</code> on the droplet.  Moving or symlinking the missing asset to that location doesn't seem to affect anything.  In the latter case, the assets just don't exist anywhere on the droplet as far as I can tell.</p>\n\n<p>For the case with no hashes in filenames, changing my include tags from this: </p>\n\n<p><code>&lt;%= javascript_include_tag \"application/application\" %&gt;</code></p>\n\n<p>To something like this:</p>\n\n<p><code>&lt;%= javascript_include_tag \"application\" %&gt;</code></p>\n\n<p>Will solve the issue but I feel like that's a red herring given the other assets that don't seem to exist after precompilation.</p>\n\n<p>I did run into an esoteric issue where the droplet was running out of memory and silently failing halfway through asset compilation but I increased the available memory and it doesn't even use half the memory now.  It does max out the CPU 100%, though.  I may try to increase both CPU and memory on the droplet.</p>\n\n<p>Here are the relevant asset compilation lines from <code>config/environments/production.rb</code>:</p>\n\n<pre><code>  config.serve_static_assets = false\n  config.assets.compress = true\n  config.assets.compile = true\n  config.assets.digest = true\n</code></pre>\n\n<p>And the relevant asset compilation lines from <code>application.rb</code>:</p>\n\n<pre><code>config.assets.enabled = true\nconfig.assets.version = '1.0'\n</code></pre>\n\n<p>Locally, everything works 100% just peachy, no errors.  Assets load fine and we're all good.  Here's the asset pipeline bits from my <code>development.rb</code> file:</p>\n\n<pre><code>  config.assets.compile = true\n  config.assets.compress = false\n  config.assets.debug = true\n</code></pre>\n\n<p>I've run various combinations of <code>rake assets:clean</code>, <code>rake assets:precompile</code>, and <code>rake assets:precompile:all</code> on the production server (in the production environment) and I've even nuked the public/assets/ folder to start it all over again.  All to no avail.</p>\n\n<p>What might cause these assets to not be created on our droplet while they do manage to get created on Heroku?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>As requested, my DO stack is simply just a droplet (2vcpu, 2gb ram), I'm using Puma and Nginx.  Here is my Capfile:</p>\n\n<pre><code># Load DSL and Setup Up Stages\nrequire 'capistrano/setup'\nrequire 'capistrano/deploy'\n\nrequire 'capistrano/scm/git'\ninstall_plugin Capistrano::SCM::Git\n\nrequire 'capistrano/rails'\nrequire 'capistrano/bundler'\nrequire 'capistrano/rvm'\nrequire 'capistrano/puma'\n\ninstall_plugin Capistrano::Puma\n\n# Loads custom tasks from `lib/capistrano/tasks' if you have any defined.\nDir.glob('lib/capistrano/tasks/*.rake').each { |r| import r }\n</code></pre>\n\n<p><strong>FURTHER EDIT</strong></p>\n\n<p>I've frobbed <code>config.assets.initialize_on_precompile</code> a couple of times in <code>application.rb</code> and ran various permutations of <code>rake assets:clean, assets:precompile</code>, and <code>assets:precompile:all</code> with <code>RAILS_ENV=production</code> locally to no avail.</p>\n\n<p><strong>YET ANOTHER EDIT</strong></p>\n\n<p>I've noticed at this point that precompiling production assets seems to not be compiling four of the javascript files, and about seven of the css files.  It also doesn't seem to put application.js into <code>public/assets/application/application.js</code> (where the app is looking), rather it lands in <code>public/assets/application.js</code>.  </p>\n\n<p><strong>MORE EDITS</strong></p>\n\n<p>I have resolved the issue of the JavaScript assets not loading by fixing a <code>require_tree</code> statement in <code>application.js</code> and now the only issue seems to be several missing CSS files.</p>\n\n<p>In this application there are two directories with css files:</p>\n\n<ul>\n<li><code>app/assets/stylesheets/</code></li>\n<li><code>app/assets/stylesheets/application</code></li>\n</ul>\n\n<p>There are a total of 21 stylesheets that do not load out of nearly 100 total.  The stylesheets that don't load are being called with a hashed filename (<code>somefile-hash.css</code>) but those hashed files don't exist in <code>public/assets/</code> on the droplet. </p>\n\n<p>Here's the requires from <code>application.css.scss</code>:</p>\n\n<pre><code>/*\n *= require_self\n *= require chosen\n *= require jquery-ui/autocomplete\n *= require jquery-ui/datepicker\n *= require feature-carousel\n *= require_tree .\n */\n</code></pre>\n\n<p>Out of frustration, I added <code>= require_directory ./assets</code> to that list and now I've only got about 15 stylesheets failing to compile/load.  That behaviour doesn't make any sense to me as I assumed the <code>= require_tree .</code> would've covered the wonky subdirectory.</p>\n\n<p>Individually specifying files <code>= require foo</code> or <code>= require foo.css.scss</code> does not seem to affect anything, either.</p>\n\n<p>I also bumped the <code>config.assets.version</code> out of frustration to no avail.</p>\n\n<p>And furthermore, no amount of foul language can persuade these assets to compile.</p>\n"}, {"tags": ["html", "ruby-on-rails", "ruby", "amazon-web-services", "trix"], "answers": [{"tags": [], "owner": {"reputation": 2095, "user_id": 1383990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e58edb37eb72ad8ebd3d584aad0cefe7?s=128&d=identicon&r=PG", "display_name": "Lars Schirrmeister", "link": "https://stackoverflow.com/users/1383990/lars-schirrmeister"}, "is_accepted": true, "score": 2, "last_activity_date": 1540893468, "creation_date": 1540893468, "answer_id": 53061666, "question_id": 53056429, "link": "https://stackoverflow.com/questions/53056429/take-html-and-remove-the-params-from-url/53061666#53061666", "title": "Take html and remove the params from url", "body": "<p>If I understand your question correctly, you want to remove parts of the query params of all URLs within a string of html, right?</p>\n\n<p>I would suggest that you first get rid of the special characters of the HTML. For example by using Nokogiri. Say we have the html in the <code>html_string</code>:</p>\n\n<pre><code>html_unescaped_string = Nokogiri::HTML.fragment(html_string).to_s\n</code></pre>\n\n<p>I am not sure what you want really to remove from the URLs. But let's assume you wanted to remove all query params from an URL, where the right side includes <code>'AWS'</code> (E.g. <code>what_ever=bla_AWS_bla</code>).</p>\n\n<p>You could do that with a function like this:</p>\n\n<pre><code>sanitizer = Proc.new do |uri_string|\n  URI.parse(uri_string).tap do |uri|\n    new_params = CGI.parse(uri.query).transform_values do |values| \n      values.reject { |value| value.include?(\"AWS\") }\n    end\n    new_params.reject! { |_k, v| !v.empty? }\n    uri.query = new_params.empty? ? nil : URI.encode_www_form(new_params)\n  end.to_s\nend\n</code></pre>\n\n<p>For finding URLs in a string you can use the nice <code>URI.regexp</code>. With this you can do:</p>\n\n<pre><code>html_unescaped_string.gsub(URI.regexp, &amp;sanitizer)\n</code></pre>\n\n<p>I hope that helps...</p>\n"}], "owner": {"reputation": 320, "user_id": 6501234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e980b8b7894381f8d85eb060b7b0cbf?s=128&d=identicon&r=PG", "display_name": "Corey Gibson", "link": "https://stackoverflow.com/users/6501234/corey-gibson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 53061666, "answer_count": 1, "score": -2, "last_activity_date": 1540893468, "creation_date": 1540865520, "last_edit_date": 1540880093, "question_id": 53056429, "link": "https://stackoverflow.com/questions/53056429/take-html-and-remove-the-params-from-url", "title": "Take html and remove the params from url", "body": "<p>I am trying to make a helper method to parse a url that is generated by the trix rich text editor, which returns the private url to my aws, but needs to be public.</p>\n\n<p>I have been trying to <code>split</code> and remove the pieces of the html that I don't need, but I just can't get the Ruby code right. <a href=\"https://gist.github.com/cgibsonmm/d47449409b40e5867184e6932c3526be\" rel=\"nofollow noreferrer\">The gist</a> shows the response and the method I have been trying to do.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "facebook", "devise"], "comments": [{"owner": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 2, "creation_date": 1540858595, "post_id": 53055649, "comment_id": 93010683, "body": "Just guessing, but should it be <code>devise_for :user</code>?"}], "owner": {"reputation": 21, "user_id": 8773625, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52a5aa480794f0b7d5ecc2a63a6b762d?s=128&d=identicon&r=PG&f=1", "display_name": "develop12", "link": "https://stackoverflow.com/users/8773625/develop12"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 119, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1540886262, "creation_date": 1540858455, "last_edit_date": 1540886262, "question_id": 53055649, "link": "https://stackoverflow.com/questions/53055649/uninitialized-constant-users-in-login-facebook-rails", "title": "uninitialized constant Users in Login facebook rails", "body": "<p>I am developing an app in Rails that will be integrated with facebook at the beginning of the session, but as I test the code, I get the following error.\n<code>uninitialized constant Users</code>\nI'm using Devise and omniauth-facebook</p>\n\n<p>devise.rb</p>\n\n<pre><code>config.omniauth :facebook, \"App ID\", \"App Secret\", callback_url: \"http://localhost:3000/users/auth/facebook/callback\"\n</code></pre>\n\n<p>model/User.rb</p>\n\n<pre><code>class User &lt; ApplicationRecord\n   # Include default devise modules. Others available are:\n   # :confirmable, :lockable, :timeoutable, :trackable and :omniauthable\n   devise :database_authenticatable, :registerable,\n   :recoverable, :rememberable, :validatable, :omniauthable, \n   omniauth_providers: %i[facebook]\nend\n</code></pre>\n\n<p>routes.rb</p>\n\n<pre><code>devise_for :users, controllers: { omniauth_callbacks: 'users/omniauth_callbacks' }\nroot 'main#home'\n</code></pre>\n\n<p>I am using rails in its latest version (5.2.1) and ruby \u200b\u200b<code>2.5.1</code></p>\n\n<p>with this code you should already establish a connection</p>\n"}, {"tags": ["ruby", "twitter", "tweets"], "comments": [{"owner": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "edited": false, "score": 1, "creation_date": 1540855133, "post_id": 53055196, "comment_id": 93009919, "body": "This is not an answer to your question, but you should <a href=\"https://stackoverflow.com/a/605329/3784008\">place your <code>require</code> calls outside the class definition</a>. Also, if those are your actual keys, tokens, and secrets, then you&#39;re going to have to change them."}, {"owner": {"reputation": 51, "user_id": 10179930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f41f2c4561ce17a6ff417229beeb5540?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastian", "link": "https://stackoverflow.com/users/10179930/sebastian"}, "reply_to_user": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "edited": false, "score": 0, "creation_date": 1540855425, "post_id": 53055196, "comment_id": 93009977, "body": "God damn, was a long day! Thank you so much, i changed it. But, why would you recommed to put the require calls outside of a class? just for code standards?"}, {"owner": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "edited": false, "score": 0, "creation_date": 1540855491, "post_id": 53055196, "comment_id": 93009995, "body": "It&#39;s good that you removed the secrets, but since they&#39;re still visible in the revision history of your question you must make sure they&#39;re invalidated on the Twitter side. As for why <code>require</code> should be moved -- it&#39;s explained and discussed in the linked answer from my previous comment."}, {"owner": {"reputation": 51, "user_id": 10179930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f41f2c4561ce17a6ff417229beeb5540?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastian", "link": "https://stackoverflow.com/users/10179930/sebastian"}, "reply_to_user": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "edited": false, "score": 0, "creation_date": 1540855550, "post_id": 53055196, "comment_id": 93010013, "body": "ah thanks! Yeah i regenerated them ;)"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1540856577, "post_id": 53055196, "comment_id": 93010259, "body": "You want the <code>require</code> outside because it makes it clear what dependencies that file has, plus it forces the thing to require at start-up time and error out if there&#39;s a problem instead of exploding later on when you&#39;re not paying attention."}], "answers": [{"tags": [], "owner": {"reputation": 436, "user_id": 2570423, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zVptB.png?s=128&g=1", "display_name": "mehedi", "link": "https://stackoverflow.com/users/2570423/mehedi"}, "is_accepted": false, "score": 1, "last_activity_date": 1540915029, "creation_date": 1540915029, "answer_id": 53068289, "question_id": 53055196, "link": "https://stackoverflow.com/questions/53055196/getting-all-tweets-from-user-x-since-date-y-with-ruby/53068289#53068289", "title": "Getting all Tweets from user x since date y with ruby?", "body": "<p>You need to use the <a href=\"https://www.rubydoc.info/gems/twitter/Twitter/REST/Search#search-instance_method\" rel=\"nofollow noreferrer\">search</a> method of <code>twitter</code> gem. The <a href=\"https://developer.twitter.com/en/docs/tweets/search/api-reference/get-search-tweets\" rel=\"nofollow noreferrer\">Twitter API</a> might be helpful as well.</p>\n\n<pre><code>client.search(\"from:Tweetaccount since:yyyy-mm-dd until:yyyy-mm-dd\")\n</code></pre>\n\n<p><code>since</code> should be start_date and <code>until</code> should be end_date.</p>\n"}, {"comments": [{"owner": {"reputation": 8279, "user_id": 262478, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1526dcb784188b422544c6344ef223c2?s=128&d=identicon&r=PG", "display_name": "Andy Piper", "link": "https://stackoverflow.com/users/262478/andy-piper"}, "edited": false, "score": 1, "creation_date": 1540930082, "post_id": 53070429, "comment_id": 93042662, "body": "That&#39;s correct. The standard search API is limited to 7 days. If you wanted to do this over a longer period you would need to use the premium 30 day or full archive search APIs (you can use these for free for a limited number of requests per month). I don&#39;t believe the gem you are using currently supports the premium APIs, but there&#39;s an alternative Ruby library <a href=\"https://github.com/twitterdev/search-tweets-ruby\" rel=\"nofollow noreferrer\">here</a> you might find useful"}], "tags": [], "owner": {"reputation": 51, "user_id": 10179930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f41f2c4561ce17a6ff417229beeb5540?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastian", "link": "https://stackoverflow.com/users/10179930/sebastian"}, "is_accepted": false, "score": 2, "last_activity_date": 1540923079, "creation_date": 1540923079, "answer_id": 53070429, "question_id": 53055196, "link": "https://stackoverflow.com/questions/53055196/getting-all-tweets-from-user-x-since-date-y-with-ruby/53070429#53070429", "title": "Getting all Tweets from user x since date y with ruby?", "body": "<p>Okay thank you all so much for your help! I think the solution is slightly different the syntax looks like this: </p>\n\n<pre><code>tweets = client.search(\"whatevertextiwanttomine\", since: \"2018-10-27\", until: \"2018-10-30\")\n</code></pre>\n\n<p>It's a little strange that I couldn't use it to get to my last post, I'm not quite sure why yet. \nIn any case, it doesn't seem possible to search posts older than 7 days with the normal Twitter Developer account. </p>\n"}], "owner": {"reputation": 51, "user_id": 10179930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f41f2c4561ce17a6ff417229beeb5540?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastian", "link": "https://stackoverflow.com/users/10179930/sebastian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1540923079, "creation_date": 1540854572, "last_edit_date": 1540855220, "question_id": 53055196, "link": "https://stackoverflow.com/questions/53055196/getting-all-tweets-from-user-x-since-date-y-with-ruby", "title": "Getting all Tweets from user x since date y with ruby?", "body": "<p>I already have the twitter gem installed, but i cant find anything about how i can specify since when i want to collect the tweets. For example i want to have all tweets from user x in year 2016 - how do i specify that? Is that even possible, cause i cant find anything about it in the doc. \nIn addition to that i read, that this might not be possible, cause twitter allows only the last 7 days? Is that really true ? \nIn addition to that i would be interested in how to access tweets not by user but by hashtag, is that possible with the gem? </p>\n\n<pre><code>class TwitterGetter\n\n  require 'twitter'\n\n  client = Twitter::REST::Client.new do |config|\n    config.consumer_key        = \"xxxxx\"\n    config.consumer_secret     = \"xxxx\"\n    config.access_token        = \"xxxxx\"\n    config.access_token_secret = \"xxxx\"\n  end\n  tweets = client.user_timeline('Tweetaccount', count: 20)\n\n  tweets.each { |tweet| puts tweet.full_text }\nend\n\n#https://www.rubyguides.com/2016/04/twitter-api-from-ruby-tutorial/\n</code></pre>\n"}, {"tags": ["ruby", "syntax"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 4, "creation_date": 1540853800, "post_id": 53055067, "comment_id": 93009563, "body": "It\u2019s optional: <a href=\"https://ruby-doc.org/core-2.5.3/doc/syntax/control_expressions_rdoc.html#label-while+Loop\" rel=\"nofollow noreferrer\">ruby-doc.org/core-2.5.3/doc/syntax/&hellip;</a>"}, {"owner": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "edited": false, "score": 0, "creation_date": 1540853893, "post_id": 53055067, "comment_id": 93009580, "body": "I assume you got your example from <a href=\"https://www.techotopia.com/index.php/Ruby_While_and_Until_Loops\" rel=\"nofollow noreferrer\">this Techtopia page</a> on &quot;Ruby While and Until Loops&quot; because the example code is the exact same. On that page it lays it out for you: &quot;The <code>do</code> in this case is actually optional.&quot; <a href=\"https://stackoverflow.com/a/4029352/3784008\">More detail here</a>."}], "answers": [{"comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 2, "creation_date": 1540856449, "post_id": 53055086, "comment_id": 93010226, "body": "Similar to <code>if ... then</code> vs. <code>if ...</code> where the <code>then</code> is optional."}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 1, "creation_date": 1540903598, "post_id": 53055086, "comment_id": 93027522, "body": "For a one-liner you&#39;d use <code>myMethod() while flag</code>"}], "tags": [], "owner": {"reputation": 3047, "user_id": 10388629, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/My8T3.png?s=128&g=1", "display_name": "Pika the Master of the Whales", "link": "https://stackoverflow.com/users/10388629/pika-the-master-of-the-whales"}, "is_accepted": true, "score": 4, "last_activity_date": 1540853745, "creation_date": 1540853745, "answer_id": 53055086, "question_id": 53055067, "link": "https://stackoverflow.com/questions/53055067/difference-between-while-end-and-while-do-end/53055086#53055086", "title": "Difference between `while ... end` and `while ... do ... end`", "body": "<p>There is no difference when you include the newline between the while loop declaration and the code. So:</p>\n\n<pre><code>while flag\n    #code here\nend\n</code></pre>\n\n<p>is the same as:</p>\n\n<pre><code>while flag do\n    #code here\nend\n</code></pre>\n\n<p>However, when you include <code>do</code>, you can put code on the same line, as in:</p>\n\n<pre><code>while flag do myMethod() end\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 1, "creation_date": 1540903919, "post_id": 53055109, "comment_id": 93027698, "body": "Cite your source when quoting, please."}], "tags": [], "owner": {"reputation": 20644, "user_id": 184184, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f6a508697f9eca2680b12ddb85ba1319?s=128&d=identicon&r=PG", "display_name": "Lenin Raj Rajasekaran", "link": "https://stackoverflow.com/users/184184/lenin-raj-rajasekaran"}, "is_accepted": false, "score": 3, "last_activity_date": 1540954598, "last_edit_date": 1540954598, "creation_date": 1540853898, "answer_id": 53055109, "question_id": 53055067, "link": "https://stackoverflow.com/questions/53055067/difference-between-while-end-and-while-do-end/53055109#53055109", "title": "Difference between `while ... end` and `while ... do ... end`", "body": "<p>It is just used to separate the actual loop code.</p>\n\n<blockquote>\n  <p>A while loop's conditional is separated from code by the reserved word\n  do, a newline, backslash \\, or a semicolon ;.</p>\n</blockquote>\n\n<p><a href=\"https://www.tutorialspoint.com/ruby/ruby_loops.htm\" rel=\"nofollow noreferrer\">https://www.tutorialspoint.com/ruby/ruby_loops.htm</a></p>\n"}], "owner": {"reputation": 47, "user_id": 10218863, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-PunnnVm7ygk/AAAAAAAAAAI/AAAAAAAANsQ/9zJwC0klBJA/photo.jpg?sz=128", "display_name": "Scott", "link": "https://stackoverflow.com/users/10218863/scott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 1, "accepted_answer_id": 53055086, "answer_count": 2, "score": 2, "last_activity_date": 1540954598, "creation_date": 1540853602, "last_edit_date": 1540880697, "question_id": 53055067, "link": "https://stackoverflow.com/questions/53055067/difference-between-while-end-and-while-do-end", "title": "Difference between `while ... end` and `while ... do ... end`", "body": "<p>What's the difference between:</p>\n\n<pre><code>x = 1\nwhile x &lt; 5 do\n  x += 1\n  print x\nend\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>x = 1\nwhile x &lt; 5\n  x += 1\n  print x\nend\n</code></pre>\n\n<p>whereby <code>do</code> is added to the first one? Or, is there difference?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "actiondispatch"], "answers": [{"tags": [], "owner": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "is_accepted": true, "score": 3, "last_activity_date": 1540854651, "last_edit_date": 1592644375, "creation_date": 1540854651, "answer_id": 53055203, "question_id": 53054925, "link": "https://stackoverflow.com/questions/53054925/actiondispatchparamsparser-replacement-after-upgrade-to-rails-5/53055203#53055203", "title": "ActionDispatch::ParamsParser replacement after upgrade to Rails 5", "body": "<p>You have to grab the existing values from <code>parameter_parsers</code>, modify it to suit your needs, then reset the values to your modified values. From the <a href=\"https://api.rubyonrails.org/classes/ActionDispatch/Http/Parameters/ClassMethods.html#method-i-parameter_parsers-3D\" rel=\"nofollow noreferrer\">ActionDispatch::Http::Parameters documentation</a>:</p>\n<blockquote>\n<p><code>parameter_parsers=(parsers)</code></p>\n<p>Configure the parameter parser for a given MIME type.</p>\n<p>It accepts a hash where the key is the symbol of the MIME type and the value is a proc.</p>\n</blockquote>\n<pre><code>original_parsers = ActionDispatch::Request.parameter_parsers\nxml_parser = -&gt; (raw_post) { Hash.from_xml(raw_post) || {} }\nnew_parsers = original_parsers.merge(xml: xml_parser)\nActionDispatch::Request.parameter_parsers = new_parsers\n</code></pre>\n<p>In your specific case, you should look at the parsers in <code>original_parsers</code> to see if there is anything to delete. On a simple Rails 5 app that I have handy to look at, the only values I have are:</p>\n<pre><code>=&gt; {\n    :json =&gt; #&lt;Proc:0x00007fe818fc6fb8@/Users/foo/.rvm/gems/ruby-2.6.0-preview2/gems/actionpack-5.2.1/lib/action_dispatch/http/parameters.rb:11 (lambda)&gt;\n}\n</code></pre>\n<p>Your app's configuration is likely different, but to answer your question about how to delete a value, this simple version should work:</p>\n<pre><code>ActionDispatch::Request.parameter_parsers = ActionDispatch::Request.parameter_parsers.except(:json)\n</code></pre>\n<p>You may find additional useful information <a href=\"https://stackoverflow.com/q/45096629/3784008\">in this answer</a>.</p>\n"}], "owner": {"reputation": 36228, "user_id": 63761, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/b9a099f02437916c0a76f8326966be17?s=128&d=identicon&r=PG", "display_name": "Meltemi", "link": "https://stackoverflow.com/users/63761/meltemi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1924, "favorite_count": 0, "accepted_answer_id": 53055203, "answer_count": 1, "score": 3, "last_activity_date": 1540854651, "creation_date": 1540852747, "question_id": 53054925, "link": "https://stackoverflow.com/questions/53054925/actiondispatchparamsparser-replacement-after-upgrade-to-rails-5", "title": "ActionDispatch::ParamsParser replacement after upgrade to Rails 5", "body": "<p>Migrating an app from Rails 4.2.9 to 5.2.1.</p>\n\n<p>This is latest issue:</p>\n\n<pre><code>$ rails console\n/Users/meltemi/rails/myapp/config/initializers/disable_xml_params.rb:3:in `&lt;top (required)&gt;': uninitialized constant ActionDispatch::ParamsParser (NameError)\n    from /Users/meltemi/.rbenv/versions/2.4.4/lib/ruby/gems/2.4.0/gems/railties-5.2.1/lib/rails/engine.rb:657:in `block in load_config_initializer'\n    from /Users/meltemi/.rbenv/versions/2.4.4/lib/ruby/gems/2.4.0/gems/activesupport-5.2.1/lib/active_support/notifications.rb:170:in `instrument'\n    from /Users/meltemi/.rbenv/versions/2.4.4/lib/ruby/gems/2.4.0/gems/railties-5.2.1/lib/rails/engine.rb:656:in `load_config_initializer'\n</code></pre>\n\n<p>The offending line of code in an initializer:</p>\n\n<pre><code># config/initializers/disable_xml_params.rb\nActionDispatch::ParamsParser::DEFAULT_PARSERS.delete(Mime::XML)\n</code></pre>\n\n<p><a href=\"https://guides.rubyonrails.org/v5.1/5_0_release_notes.html#action-pack-deprecations\" rel=\"nofollow noreferrer\">Rails Guides</a> says: </p>\n\n<blockquote>\n  <p>ActionDispatch::ParamsParser is deprecated and was removed from the middleware stack. To configure the parameter parsers use ActionDispatch::Request.parameter_parsers=. (commit, commit)</p>\n</blockquote>\n\n<p>So I've tried the following: </p>\n\n<pre><code>ActionDispatch::Request.parameter_parsers.delete(Mime::XML)\n</code></pre>\n\n<p>But that begets more errors:</p>\n\n<pre><code>$ rails console\n/Users/meltemi/rails/myapp/config/initializers/disable_xml_params.rb:3:in `&lt;top (required)&gt;': uninitialized constant Mime::XML (NameError)\n    from /Users/meltemi/.rbenv/versions/2.4.4/lib/ruby/gems/2.4.0/gems/railties-5.2.1/lib/rails/engine.rb:657:in `block in load_config_initializer'\n    from /Users/meltemi/.rbenv/versions/2.4.4/lib/ruby/gems/2.4.0/gems/activesupport-5.2.1/lib/active_support/notifications.rb:170:in `instrument'\n    from /Users/meltemi/.rbenv/versions/2.4.4/lib/ruby/gems/2.4.0/gems/railties-5.2.1/lib/rails/engine.rb:656:in `load_config_initializer'\n</code></pre>\n\n<p>Is there a better way to call .delete on that object?</p>\n"}, {"tags": ["ruby", "algorithm", "sorting"], "comments": [{"owner": {"reputation": 1853, "user_id": 6232665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41eeea507e28cddc2bc1efc3b2b73c45?s=128&d=identicon&r=PG&f=1", "display_name": "zenwraight", "link": "https://stackoverflow.com/users/6232665/zenwraight"}, "edited": false, "score": 0, "creation_date": 1540849312, "post_id": 53054135, "comment_id": 93008041, "body": "Each row in your collection consists of only 3 elements or it could be more ?"}, {"owner": {"reputation": 5850, "user_id": 4501354, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/1230cfcc7f68488ad19d0022cf7b1a93?s=128&d=identicon&r=PG&f=1", "display_name": "Donato", "link": "https://stackoverflow.com/users/4501354/donato"}, "reply_to_user": {"reputation": 1853, "user_id": 6232665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41eeea507e28cddc2bc1efc3b2b73c45?s=128&d=identicon&r=PG&f=1", "display_name": "zenwraight", "link": "https://stackoverflow.com/users/6232665/zenwraight"}, "edited": false, "score": 0, "creation_date": 1540849579, "post_id": 53054135, "comment_id": 93008150, "body": "For this question, it will only be 3 as the title states. However, you do make a good point I did not think about when writing the qestion."}, {"owner": {"reputation": 18084, "user_id": 2700898, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/V3RkV.jpg?s=128&g=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/2700898/matt"}, "edited": false, "score": 1, "creation_date": 1540849581, "post_id": 53054135, "comment_id": 93008152, "body": "<code>collection.sort</code> returns what you want. (Note that &quot;New Jersey&quot; comes before &quot;Pennsylvania&quot;.)"}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "reply_to_user": {"reputation": 18084, "user_id": 2700898, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/V3RkV.jpg?s=128&g=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/2700898/matt"}, "edited": false, "score": 1, "creation_date": 1540851627, "post_id": 53054135, "comment_id": 93008878, "body": "@Matt Or <code>collection.sort_by(&amp;:itself)</code> if you&#39;re convinced you need to use <code>sort_by</code>."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1540852899, "post_id": 53054135, "comment_id": 93009288, "body": "Note the third paragraph of <a href=\"http://ruby-doc.org/core-2.5.1/Array.html#method-i-3C-3D-3E\" rel=\"nofollow noreferrer\">Array#&lt;=&gt;</a>."}, {"owner": {"reputation": 5060, "user_id": 10522579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7GQ6a.jpg?s=128&g=1", "display_name": "ray", "link": "https://stackoverflow.com/users/10522579/ray"}, "edited": false, "score": 0, "creation_date": 1540883977, "post_id": 53054135, "comment_id": 93017066, "body": "Could use block like, <code>collection.sort { |a,b| a.join &lt;=&gt; b.join }</code> but can you describe on which parameter you sorting out ?"}], "answers": [{"comments": [{"owner": {"reputation": 5850, "user_id": 4501354, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/1230cfcc7f68488ad19d0022cf7b1a93?s=128&d=identicon&r=PG&f=1", "display_name": "Donato", "link": "https://stackoverflow.com/users/4501354/donato"}, "edited": false, "score": 0, "creation_date": 1540849793, "post_id": 53054266, "comment_id": 93008219, "body": "I am aware I was using Enumerable#sort_by. But why does the sort_by method not work in this case?"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1540850754, "post_id": 53054266, "comment_id": 93008579, "body": "It shouldn&#39;t. <code>sort</code> takes arguments <code>|a,b|</code> while <code>sort_by</code> only takes one, you&#39;re expected to return the data you want to sort each item on."}, {"owner": {"reputation": 14139, "user_id": 1108, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/48OpQ.jpg?s=128&g=1", "display_name": "jerhinesmith", "link": "https://stackoverflow.com/users/1108/jerhinesmith"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1540850923, "post_id": 53054266, "comment_id": 93008640, "body": "@tadman is correct. I was trying to figure out a way you <i>could</i> make <code>sort_by</code> work just to demonstrate, but couldn&#39;t really think of anything foolproof. Something like <code>collection.sort_by{ |ary| ary.map(&amp;:chr).join }</code> gets close, but even that&#39;s only guaranteed to sort by the first character of each item in the nested array."}], "tags": [], "owner": {"reputation": 14139, "user_id": 1108, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/48OpQ.jpg?s=128&g=1", "display_name": "jerhinesmith", "link": "https://stackoverflow.com/users/1108/jerhinesmith"}, "is_accepted": false, "score": 2, "last_activity_date": 1540849365, "creation_date": 1540849365, "answer_id": 53054266, "question_id": 53054135, "link": "https://stackoverflow.com/questions/53054135/sort-by-the-three-items-in-subarrays/53054266#53054266", "title": "Sort by the three items in subarrays", "body": "<p>You're using <code>Enumerable#sort_by</code> when you want to be using <code>Array#sort</code>.</p>\n\n<p><code>Enumerable#sort_by</code></p>\n\n<blockquote>\n  <p>Sorts enum using a set of keys generated by mapping the values in enum through the given block.</p>\n</blockquote>\n\n<p><code>Array#sort</code></p>\n\n<blockquote>\n  <p>The block must implement a comparison between a and b and return an integer less than 0 when b follows a, 0 when a and b are equivalent, or an integer greater than 0 when a follows b.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "is_accepted": true, "score": 2, "last_activity_date": 1540852165, "creation_date": 1540852165, "answer_id": 53054817, "question_id": 53054135, "link": "https://stackoverflow.com/questions/53054135/sort-by-the-three-items-in-subarrays/53054817#53054817", "title": "Sort by the three items in subarrays", "body": "<p>There's two tools here each of which can get the same result, but which have different consequences in terms of performance. <code>sort_by</code> has to transform each item <em>once and once only</em> in order to compare and sort. <code>sort</code> has to run that block for <em>each comparison</em> where there will be typically <em>N x log(N)</em> comparisons performed per sort operation. For large lists that can be significantly more operations than the number of entries in the array.</p>\n\n<p>If you're doing an expensive transformation, <code>sort_by</code> is the winner here. For really dead-simple operations <code>sort</code> is sometimes better, but it's a subjective call.</p>\n\n<p>For example, two approaches to the same result:</p>\n\n<pre><code>array = [ 7, 2, 5, 3, 4, 1, 6 ]\n\narray.sort_by { |a| -a }\n# =&gt; [7, 6, 5, 4, 3, 2, 1]\n\n# Sort by negated values\narray.sort { |a,b| -a &lt;=&gt; -b }\n# =&gt; [7, 6, 5, 4, 3, 2, 1]\n\n# Reverse the comparison, reverse the sort order\narray.sort { |a,b| b &lt;=&gt; a }\n</code></pre>\n\n<p>All of these are valid approaches, but the advantage of the <code>sort_by</code> approach becomes more apparent when you minimize your code like this:</p>\n\n<pre><code># Sort by unary minus (Integer#-@)\narray.sort_by(&amp;:-@)\n</code></pre>\n\n<p>Where in your specific case, say you wanted to sort in a case-insensitive manner:</p>\n\n<pre><code>collection = [\n  [\"NEW JERSEY\", \"Essex\", \"Lawyer\"], \n  [\"Florida\", \"Palm Beach\", \"Doctor\"], \n  [\"New Jersey\", \"ESSEX\", \"Firefighter\"],\n  [\"Pennsylvania\", \"Bucks\", \"Doctor\"], \n  [\"florida\", \"Broward\", \"Doctor\"],\n  [\"Florida\", \"Palm Beach\", \"Scientist\"] \n]\n\ns = collection.sort_by do |e|\n  e.map(&amp;:downcase)\nend\n# =&gt; [[\"florida\", \"Broward\", \"Doctor\"], [\"Florida\", \"Palm Beach\", \"Doctor\"], ... ]\n</code></pre>\n\n<p>Calling <code>downcase</code> on an array is a somewhat expensive operation so you want to that as few times as possible to avoid creating a lot of duplicated objects that need to be garbage collected.</p>\n"}], "owner": {"reputation": 5850, "user_id": 4501354, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/1230cfcc7f68488ad19d0022cf7b1a93?s=128&d=identicon&r=PG&f=1", "display_name": "Donato", "link": "https://stackoverflow.com/users/4501354/donato"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 53054817, "answer_count": 2, "score": 2, "last_activity_date": 1540852165, "creation_date": 1540848727, "question_id": 53054135, "link": "https://stackoverflow.com/questions/53054135/sort-by-the-three-items-in-subarrays", "title": "Sort by the three items in subarrays", "body": "<p>Given the following collection:</p>\n\n<pre><code> collection = [\n  [\"Pennsylvania\", \"Bucks\", \"Doctor\"], \n  [\"New Jersey\", \"Essex\", \"Lawyer\"], \n  [\"New Jersey\", \"Essex\", \"Firefighter\"],\n  [\"Florida\", \"Palm Beach\", \"Doctor\"], \n  [\"Florida\", \"Broward\", \"Doctor\"],\n  [\"Florida\", \"Palm Beach\", \"Scientist\"] \n]\n</code></pre>\n\n<p>I want to sort by first item ascending, second item ascending, and third item ascending. So the result would look like:</p>\n\n<pre><code>[\n  [\"Florida\", \"Broward\", \"Doctor\"],\n  [\"Florida\", \"Palm Beach\", \"Doctor\"], \n  [\"Florida\", \"Palm Beach\", \"Scientist\"],\n  [\"Pennsylvania\", \"Bucks\", \"Doctor\"], \n  [\"New Jersey\", \"Essex\", \"Firefighter\"],\n  [\"New Jersey\", \"Essex\", \"Lawyer\"], \n]\n</code></pre>\n\n<p>I can't seem to figure it out by using the sort_by iterator. I tried this:</p>\n\n<pre><code>collection.sort_by {|a,b| a &lt;=&gt; b }\n =&gt; [[\"Florida\", \"Palm Beach\", \"Doctor\"], [\"Florida\", \"Palm Beach\", \"Doctor\"], [\"New Jersey\", \"Essex\", \"Firefighter\"], [\"New Jersey\", \"Essex\", \"Lawyer\"], [\"Florida\", \"Broward\", \"Scientist\"], [\"Pennsylvania\", \"Bucks\", \"Doctor\"]] \n</code></pre>\n\n<p>Clearly not the results I expected. What am I doing wrong?</p>\n"}, {"tags": ["ruby", "rspec"], "answers": [{"tags": [], "owner": {"reputation": 6462, "user_id": 3784008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55ou4.jpg?s=128&g=1", "display_name": "anothermh", "link": "https://stackoverflow.com/users/3784008/anothermh"}, "is_accepted": true, "score": 6, "last_activity_date": 1540876706, "last_edit_date": 1540876706, "creation_date": 1540856920, "answer_id": 53055475, "question_id": 53053754, "link": "https://stackoverflow.com/questions/53053754/ruby-rspec-expect-error-when-testing-method/53055475#53055475", "title": "Ruby, rspec Expect error when testing method", "body": "<p>When writing a spec that checks for <code>raise_error</code>, you must use the block-syntax <code>{}</code> for <code>expect</code>:</p>\n\n<pre><code>expect { my_method(p1, p2, p3, p4, bad5) }.to raise_error(ArgumentError)\n</code></pre>\n\n<p>There is a much more in-depth explanation in <a href=\"https://stackoverflow.com/q/21567838/3784008\">this question's answers</a>, but you asked for an explanation so I'll give you an abbreviated one:</p>\n\n<p>Most rspec matchers are value matchers. That means that something like this:</p>\n\n<pre><code>expect(some_method).to eq(value)\n</code></pre>\n\n<p>is really saying:</p>\n\n<blockquote>\n  <p>perform <code>some_method</code> and get its return value, then compare its return value to <code>value</code>, and judge the success or failure of this spec on that comparison</p>\n</blockquote>\n\n<p>When you're trying to test some piece of code that has a side effect, like possibly raising an exception, rspec needs to receive a block of code to run. It's a bit more like:</p>\n\n<pre><code>expect { &lt;some block of code&gt; }.to raise_error(ArgumentError)\n</code></pre>\n\n<blockquote>\n  <p>perform <code>&lt;some block of code&gt;</code>, and then compare what happens when that code is executed to what is expected to happen, and judge the success or failure of this spec on that comparison</p>\n</blockquote>\n\n<p><a href=\"https://stackoverflow.com/a/26934874/3784008\">This answer</a> for the above-linked question goes into detail about when you need to use <code>expect {}</code> and when you need to use <code>expect()</code>.</p>\n"}], "owner": {"reputation": 1608, "user_id": 1758023, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/8867b4c763d9995de34ec14bfb9fbdab?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/1758023/mark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 480, "favorite_count": 0, "accepted_answer_id": 53055475, "answer_count": 1, "score": 2, "last_activity_date": 1540876706, "creation_date": 1540846894, "last_edit_date": 1540857258, "question_id": 53053754, "link": "https://stackoverflow.com/questions/53053754/ruby-rspec-expect-error-when-testing-method", "title": "Ruby, rspec Expect error when testing method", "body": "<p>I have a method that looks like <code>build_object(arg1, arg2, arg3, arg4, arg5)</code> I want to test this method when a certain value is passed for arg5.</p>\n\n<p>I am trying something like</p>\n\n<p><code>expect(my_method(p1, p2, p3, p4, bad5)).to raise_error(ArgumentError)</code></p>\n\n<p>I get the following error:</p>\n\n<pre><code>ArgumentError:\n   The expect syntax does not support operator matchers, so you must pass a matcher to `#to`.\n</code></pre>\n\n<p>I am very new to Ruby and rspec testing, so any help is appreciated. Please explain what your answer is doing so that I learn.</p>\n"}, {"tags": ["ruby", "instance-variables"], "comments": [{"owner": {"reputation": 152277, "user_id": 438992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/QouOz.jpg?s=128&g=1", "display_name": "Dave Newton", "link": "https://stackoverflow.com/users/438992/dave-newton"}, "edited": false, "score": 1, "creation_date": 1540844195, "post_id": 53052970, "comment_id": 93005881, "body": "The first <code>@hello</code> is a <i>class</i> instance variable, not an <i>instance</i> variable."}], "answers": [{"tags": [], "owner": {"reputation": 144312, "user_id": 62076, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/62c90b6f399e6b95554b2da31ca8619a?s=128&d=identicon&r=PG", "display_name": "Alex Wayne", "link": "https://stackoverflow.com/users/62076/alex-wayne"}, "is_accepted": false, "score": 1, "last_activity_date": 1540844094, "creation_date": 1540844094, "answer_id": 53053159, "question_id": 53052970, "link": "https://stackoverflow.com/questions/53052970/array-not-accessible-from-method/53053159#53053159", "title": "Array not accessible from method", "body": "<p>You need to initialize instance variable in instance methods, but you are doing this in the scope of the class body, which isn't going to work.</p>\n\n<p>If you set <code>@hello</code> from the <code>initialize</code> method, it should work like you expect.</p>\n\n<pre><code>class Blah\n  def initialize\n    @hello = [\"a\",\"b\",\"c\"]\n  end\n\n  def something()\n    puts @hello[0]\n  end\nend\n\nBlah.new.something #=&gt; 'a'\n</code></pre>\n\n<p>It works this way so that you can pass arguments when instantiating a class, and each instance may have different data stored in its instance variables.</p>\n"}], "owner": {"reputation": 418, "user_id": 336879, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/304a917272a2cf18e14934ad00303f90?s=128&d=identicon&r=PG", "display_name": "Adjam", "link": "https://stackoverflow.com/users/336879/adjam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1540881094, "creation_date": 1540843292, "last_edit_date": 1540881094, "question_id": 53052970, "link": "https://stackoverflow.com/questions/53052970/array-not-accessible-from-method", "title": "Array not accessible from method", "body": "<p>I have code:</p>\n\n<pre><code>class Blah\n  @hello = [\"a\", \"b\", \"c\"]\n  puts @hello[0]\n\n  def something()\n    puts \"abc\"\n    #puts @hello[0]\n  end\nend\n\nz = Blah.new()\nz.something()\n\nputs @hello[0]\n</code></pre>\n\n<p>It results in the output:</p>\n\n<pre><code>a\nabc\n</code></pre>\n\n<p>If I uncomment</p>\n\n<pre><code>#puts @hello[0]\n</code></pre>\n\n<p>and try to output the first result of the array <code>@hello</code>, which is <code>a</code>, I get this error:</p>\n\n<pre><code>array_2.rb:13:in `something': undefined method `[]' for nil:NilClass (NoMethodError)\n</code></pre>\n\n<p>Why can I not get the result:</p>\n\n<pre><code>a\nabc\na\n</code></pre>\n\n<p>Why doesn't my code work? An array such as <code>@example</code> should be accessible not just in the the class, but also in the <code>something</code> method. Why can't I access <code>@hello[0]</code> within methods? Why is <code>@hello[0]</code> only accessible within the class, and not the method? Need someone to fix my code so that I can access <code>@array</code> within the method.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "heroku"], "comments": [{"owner": {"reputation": 221, "user_id": 10542565, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KHCz54uDY7Q/AAAAAAAAAAI/AAAAAAAAAo0/jDTOYj3g8As/photo.jpg?sz=128", "display_name": "Nathan Kontny", "link": "https://stackoverflow.com/users/10542565/nathan-kontny"}, "edited": false, "score": 2, "creation_date": 1540842818, "post_id": 53052772, "comment_id": 93005244, "body": "Have you done what the error says to do? Ran <code>bundle install</code> locally and make sure Gemfile.lock is added to version control?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user1531971"}, "edited": false, "score": 0, "creation_date": 1540842827, "post_id": 53052772, "comment_id": 93005246, "body": "Related: <a href=\"https://stackoverflow.com/q/11513623/1531971\">stackoverflow.com/q/11513623/1531971</a>, <a href=\"https://stackoverflow.com/q/32380828/1531971\">stackoverflow.com/q/32380828/1531971</a>, <a href=\"https://stackoverflow.com/q/40922424/1531971\">stackoverflow.com/q/40922424/1531971</a> (Otherwise you need to show how thesde refs are not related to your very common problem.)"}, {"owner": {"reputation": 91778, "user_id": 354577, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/dI6cA.jpg?s=128&g=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/354577/chris"}, "edited": false, "score": 0, "creation_date": 1540863095, "post_id": 53052772, "comment_id": 93011541, "body": "I&#39;m voting to close this question as off-topic because the quoted error message explains exactly how to fix the problem."}], "answers": [{"tags": [], "owner": {"reputation": 3746, "user_id": 134788, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/e8424594187a3e0eb125f6e0a62a2999?s=128&d=identicon&r=PG", "display_name": "Ayrad", "link": "https://stackoverflow.com/users/134788/ayrad"}, "is_accepted": false, "score": 0, "last_activity_date": 1540867049, "creation_date": 1540867049, "answer_id": 53056608, "question_id": 53052772, "link": "https://stackoverflow.com/questions/53052772/push-rejected-failed-to-compile-ruby-app-installation-of-decdim-on-herouku/53056608#53056608", "title": "&quot;Push rejected, failed to compile Ruby app&quot; installation of decdim on herouku", "body": "<p>Go to the folder where you have your app and try typing the command: <code>bundle install</code> then try pushing to heroku afterwards. </p>\n"}], "owner": {"reputation": 45, "user_id": 10576917, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d945048b9ebfe957b9cc9f88b1ff73fe?s=128&d=identicon&r=PG&f=1", "display_name": "kiwis", "link": "https://stackoverflow.com/users/10576917/kiwis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 77, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1540867049, "creation_date": 1540842499, "question_id": 53052772, "link": "https://stackoverflow.com/questions/53052772/push-rejected-failed-to-compile-ruby-app-installation-of-decdim-on-herouku", "title": "&quot;Push rejected, failed to compile Ruby app&quot; installation of decdim on herouku", "body": "<p>I'm trying to install decidim (decidim.org) on herouku, I get this error when i make the deploy </p>\n\n<pre><code>remote: You are trying to install in deployment mode after changing\nremote: your Gemfile. Run bundle install elsewhere and add the\nremote: updated Gemfile.lock to version control.\nremote:\nremote: The gemspecs for path gems changed\nremote: !\nremote: ! Failed to install gems via Bundler.\nremote: !\nremote: ! Push rejected, failed to compile Ruby app.\nremote:\nremote: ! Push failed\nremote: Verifying deploy...\n</code></pre>\n\n<p>this is the end lines of the deploy.</p>\n\n<p>anyone has an answer for this issue? \nthanks</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-4"], "answers": [{"comments": [{"owner": {"reputation": 1560, "user_id": 5614748, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/10153324566173505/picture?type=large", "display_name": "Afolabi Olaoluwa Akinwumi", "link": "https://stackoverflow.com/users/5614748/afolabi-olaoluwa-akinwumi"}, "edited": false, "score": 0, "creation_date": 1540848625, "post_id": 53052897, "comment_id": 93007800, "body": "Yeah, it works, but saves nothing into the database."}, {"owner": {"reputation": 221, "user_id": 10542565, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KHCz54uDY7Q/AAAAAAAAAAI/AAAAAAAAAo0/jDTOYj3g8As/photo.jpg?sz=128", "display_name": "Nathan Kontny", "link": "https://stackoverflow.com/users/10542565/nathan-kontny"}, "reply_to_user": {"reputation": 1560, "user_id": 5614748, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/10153324566173505/picture?type=large", "display_name": "Afolabi Olaoluwa Akinwumi", "link": "https://stackoverflow.com/users/5614748/afolabi-olaoluwa-akinwumi"}, "edited": false, "score": 0, "creation_date": 1540849215, "post_id": 53052897, "comment_id": 93008016, "body": "Can you post the log file of this destroy action please?"}, {"owner": {"reputation": 221, "user_id": 10542565, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KHCz54uDY7Q/AAAAAAAAAAI/AAAAAAAAAo0/jDTOYj3g8As/photo.jpg?sz=128", "display_name": "Nathan Kontny", "link": "https://stackoverflow.com/users/10542565/nathan-kontny"}, "reply_to_user": {"reputation": 1560, "user_id": 5614748, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/10153324566173505/picture?type=large", "display_name": "Afolabi Olaoluwa Akinwumi", "link": "https://stackoverflow.com/users/5614748/afolabi-olaoluwa-akinwumi"}, "edited": false, "score": 0, "creation_date": 1540864410, "post_id": 53052897, "comment_id": 93011795, "body": "When you say it saves nothing to the database how do you determine that? Are you running a SQL call? Are you using a rails console and fetching a signin_history? Also, I assume the behavior of updating a signin_history by id isn&#39;t actually what you want. Does signinhistory have a member_id column?"}], "tags": [], "owner": {"reputation": 221, "user_id": 10542565, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KHCz54uDY7Q/AAAAAAAAAAI/AAAAAAAAAo0/jDTOYj3g8As/photo.jpg?sz=128", "display_name": "Nathan Kontny", "link": "https://stackoverflow.com/users/10542565/nathan-kontny"}, "is_accepted": true, "score": 1, "last_activity_date": 1540843047, "creation_date": 1540843047, "answer_id": 53052897, "question_id": 53052744, "link": "https://stackoverflow.com/questions/53052744/updating-sign-out-time-into-database-upon-user-sign-out/53052897#53052897", "title": "updating sign_out time into database upon user sign out", "body": "<p>Your function <code>save_signout_time</code> takes a member_id but then you don't use that member_id for the update. </p>\n\n<p>If you want to update a single record the way you have it architected right now, you need to: </p>\n\n<pre><code>SigninHistory.update(member_id, logout_time: Time.now)\n</code></pre>\n"}], "owner": {"reputation": 1560, "user_id": 5614748, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/10153324566173505/picture?type=large", "display_name": "Afolabi Olaoluwa Akinwumi", "link": "https://stackoverflow.com/users/5614748/afolabi-olaoluwa-akinwumi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 28, "favorite_count": 0, "accepted_answer_id": 53052897, "answer_count": 1, "score": 0, "last_activity_date": 1540843047, "creation_date": 1540842395, "question_id": 53052744, "link": "https://stackoverflow.com/questions/53052744/updating-sign-out-time-into-database-upon-user-sign-out", "title": "updating sign_out time into database upon user sign out", "body": "<p>Am trying to update my database with signout time upon user sign out of the application but my solution does not work.</p>\n\n<p><strong>Here is what I have done below:</strong></p>\n\n<p><em>So I defined a method which I call in destroy action to update my database with signout time but it doesnt work, rather it throws argument error.</em></p>\n\n<p><strong>update_method</strong></p>\n\n<pre><code># the `save_signout_time` is what I have done to update logout_time upon sign out.\ndef save_signout_time(member_id)\n  SigninHistory.update(\n    logout_time: Time.now\n  )\nend\n\n\ndef destroy\n  save_signout_time current_user.id\n  clear_all_sessions current_user.id\n  reset_session\n  redirect_to root_path\nend\n</code></pre>\n\n<p>What am I missing? Or how do I go about this?</p>\n"}, {"tags": ["ruby", "multithreading"], "comments": [{"owner": {"reputation": 208794, "user_id": 229044, "user_type": "moderator", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/591426cbbacd4025d920467bad356911?s=128&d=identicon&r=PG&f=1", "display_name": "meagar", "link": "https://stackoverflow.com/users/229044/meagar"}, "edited": false, "score": 2, "creation_date": 1540841660, "post_id": 53052434, "comment_id": 93004686, "body": "You can&#39;t control this. The threads <i>are</i> running like you expect, but each thread is finishing so quickly that you can&#39;t really tell. Try sleeping for a random duration inside your loop."}, {"owner": {"reputation": 8804, "user_id": 649737, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/3ffb1bb7b9f96cd3b1ca567899f9d256?s=128&d=identicon&r=PG", "display_name": "Leron_says_get_back_Monica", "link": "https://stackoverflow.com/users/649737/leron-says-get-back-monica"}, "reply_to_user": {"reputation": 208794, "user_id": 229044, "user_type": "moderator", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/591426cbbacd4025d920467bad356911?s=128&d=identicon&r=PG&f=1", "display_name": "meagar", "link": "https://stackoverflow.com/users/229044/meagar"}, "edited": false, "score": 0, "creation_date": 1540842651, "post_id": 53052434, "comment_id": 93005180, "body": "@meagar I see. You are right. After adding some delay I got the random output I was expecting. Do you think this i a valid way to test for concurrent issues?"}, {"owner": {"reputation": 208794, "user_id": 229044, "user_type": "moderator", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/591426cbbacd4025d920467bad356911?s=128&d=identicon&r=PG&f=1", "display_name": "meagar", "link": "https://stackoverflow.com/users/229044/meagar"}, "edited": false, "score": 0, "creation_date": 1540844032, "post_id": 53052434, "comment_id": 93005803, "body": "No, I personally wouldn&#39;t bother with this approach."}, {"owner": {"reputation": 8804, "user_id": 649737, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/3ffb1bb7b9f96cd3b1ca567899f9d256?s=128&d=identicon&r=PG", "display_name": "Leron_says_get_back_Monica", "link": "https://stackoverflow.com/users/649737/leron-says-get-back-monica"}, "reply_to_user": {"reputation": 208794, "user_id": 229044, "user_type": "moderator", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/591426cbbacd4025d920467bad356911?s=128&d=identicon&r=PG&f=1", "display_name": "meagar", "link": "https://stackoverflow.com/users/229044/meagar"}, "edited": false, "score": 0, "creation_date": 1540844614, "post_id": 53052434, "comment_id": 93006069, "body": "@meagar Could you share your thought on what is a better way to simulate concurrent calls to a method and measure the time. Currently I have 2 different implementations and I want to figure out which one will have better performance."}, {"owner": {"reputation": 310, "user_id": 10445527, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pQjXF.jpg?s=128&g=1", "display_name": "Mihail Panayotov", "link": "https://stackoverflow.com/users/10445527/mihail-panayotov"}, "edited": false, "score": 0, "creation_date": 1540845890, "post_id": 53052434, "comment_id": 93006623, "body": "@Leron would you provide more context to what exactly you are trying to test as a result of your users&#39; interaction?"}, {"owner": {"reputation": 8804, "user_id": 649737, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/3ffb1bb7b9f96cd3b1ca567899f9d256?s=128&d=identicon&r=PG", "display_name": "Leron_says_get_back_Monica", "link": "https://stackoverflow.com/users/649737/leron-says-get-back-monica"}, "reply_to_user": {"reputation": 310, "user_id": 10445527, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pQjXF.jpg?s=128&g=1", "display_name": "Mihail Panayotov", "link": "https://stackoverflow.com/users/10445527/mihail-panayotov"}, "edited": false, "score": 0, "creation_date": 1540847180, "post_id": 53052434, "comment_id": 93007194, "body": "@MihailPanayotov I&#39;ve added a <code>PS.PS</code> :) Could it be we are colleagues? :)"}], "owner": {"reputation": 8804, "user_id": 649737, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/3ffb1bb7b9f96cd3b1ca567899f9d256?s=128&d=identicon&r=PG", "display_name": "Leron_says_get_back_Monica", "link": "https://stackoverflow.com/users/649737/leron-says-get-back-monica"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 86, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1540847088, "creation_date": 1540841051, "last_edit_date": 1540847088, "question_id": 53052434, "link": "https://stackoverflow.com/questions/53052434/simulating-parallel-calls-to-a-method-in-ruby", "title": "Simulating parallel calls to a method in Ruby", "body": "<p>I have a method which is frequently called from different users so I want to simulate this behavior in order to observe it's behavior</p>\n\n<p>I've read about <code>fork</code> and <code>threads</code> and actually think that <code>fork</code> is better suited for this purpose but I couldn't get anywhere with <code>fork</code> so I switch to <code>threads</code> and I got this:</p>\n\n<pre><code>module MethodBenchmark\n  extend self\n\n  def execute_with_threads\n    arr = []\n    3.times do |i|\n      arr[i] = Thread.new {\n      puts \"Thread number #{i}\"\n      call_actual_method(3)\n    }\n    end\n    arr.each {|t| t.join;}\n  end\n\n  def call_actual_method(number_of_requests)\n    number_of_requests.times do |i|\n      puts \"Executing request #{i}\"\n    end\n  end\n\nend\n</code></pre>\n\n<p>the result I got is</p>\n\n<pre><code>Thread number 2\nExecuting request 0\nExecuting request 1\nExecuting request 2\nThread number 0\nExecuting request 0\nExecuting request 1\nExecuting request 2\nThread number 1\nExecuting request 0\nExecuting request 1\nExecuting request 2\n</code></pre>\n\n<p>So what I want is each thread to represent a different user and each request, well to represent a new request from a random user. In other words I would like to have an output something like this:</p>\n\n<pre><code>Thread number 2\nExecuting request 0\nExecuting request 1\nThread number 0\nExecuting request 2\nExecuting request 0\nExecuting request 1\nThread number 1\nExecuting request 2\nExecuting request 0\nExecuting request 1\nExecuting request 2\n</code></pre>\n\n<p>The idea being that once all the threads have spawned I'll get a lot of concurrent requests from different threads and not that sequential output. How can I achieve this behavior?</p>\n\n<p><em>P.S</em> \nI hoped that this could be due to the small amount of threads/requests but I got the same sequential result with 25 threads and 100 requests per thread.</p>\n\n<p><em>PS.PS</em>\nInside the body of this method\n    def call_actual_method(number_of_requests)</p>\n\n<p>I plan to actually call a method which is making request to the database</p>\n\n<p>def call_actual_method(number_of_requests)\n    number_of_requests.times do |i|\n      method_to_call_database()\n    end\n   end</p>\n\n<p>Currently <code>method_to_call_database()</code> has two possible implementations in terms of how the <code>SQL</code> is structured and I want to measure the execution time of both implementations under a given load. The idea is to choose the faster method.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-5"], "comments": [{"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1540838079, "post_id": 53051724, "comment_id": 93003133, "body": "Have you had a look yet at <a href=\"https://github.com/plataformatec/devise\" rel=\"nofollow noreferrer\">github.com/plataformatec/devise</a> ? It may be easier than trying to hand spin authentication if that&#39;s what you&#39;re trying to do."}, {"owner": {"reputation": 69, "user_id": 9803237, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/549ea1590447cf15756fd4835f8403b8?s=128&d=identicon&r=PG&f=1", "display_name": "D1D2D3D4D5", "link": "https://stackoverflow.com/users/9803237/d1d2d3d4d5"}, "reply_to_user": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1540838795, "post_id": 53051724, "comment_id": 93003460, "body": "No thanks, I more so want to understand what&#39;s happening here for future reference. I did come across throw(:abort) but that doesn&#39;t work for me unfortunately."}, {"owner": {"reputation": 930, "user_id": 3577922, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eURpm.jpg?s=128&g=1", "display_name": "Masa Sakano", "link": "https://stackoverflow.com/users/3577922/masa-sakano"}, "edited": false, "score": 3, "creation_date": 1540839046, "post_id": 53051724, "comment_id": 93003568, "body": "In your code, if a user is already validated (and so the session has <i>:uid</i>), then it asks the user to sign in? Why? That doesn&#39;t make sense\u2026  Am I missing something?"}], "answers": [{"comments": [{"owner": {"reputation": 69, "user_id": 9803237, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/549ea1590447cf15756fd4835f8403b8?s=128&d=identicon&r=PG&f=1", "display_name": "D1D2D3D4D5", "link": "https://stackoverflow.com/users/9803237/d1d2d3d4d5"}, "edited": false, "score": 0, "creation_date": 1540839156, "post_id": 53051985, "comment_id": 93003608, "body": "Hey! I&#39;m trying to redirect them back to the sign in path id they attempt to access the dash_path. So I need that controller to have that before_action filter?"}, {"owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "reply_to_user": {"reputation": 69, "user_id": 9803237, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/549ea1590447cf15756fd4835f8403b8?s=128&d=identicon&r=PG&f=1", "display_name": "D1D2D3D4D5", "link": "https://stackoverflow.com/users/9803237/d1d2d3d4d5"}, "edited": false, "score": 1, "creation_date": 1540839495, "post_id": 53051985, "comment_id": 93003739, "body": "I am sorry, I do not understand. What redirects do you have in place in the different controllers? More than the one you already mentioned in your question? You might want to update your question with all redirects that happen in before_actions."}], "tags": [], "owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "is_accepted": false, "score": 1, "last_activity_date": 1540839509, "last_edit_date": 1540839509, "creation_date": 1540838933, "answer_id": 53051985, "question_id": 53051724, "link": "https://stackoverflow.com/questions/53051724/before-action-causing-too-many-redirects/53051985#53051985", "title": "Before_action causing too many redirects", "body": "<p>You can just tell Rails to skip the before filter in the controller that handles the <code>dash_path</code>:</p>\n\n<pre><code># in the controller\nskip_before_action :already_validated\n</code></pre>\n\n<p>Read about <a href=\"https://guides.rubyonrails.org/action_controller_overview.html#filters\" rel=\"nofollow noreferrer\">Filters in the Rails Guides</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 986, "user_id": 8304905, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YpAOE.jpg?s=128&g=1", "display_name": "EmmanuelB", "link": "https://stackoverflow.com/users/8304905/emmanuelb"}, "is_accepted": true, "score": 1, "last_activity_date": 1540848916, "creation_date": 1540848916, "answer_id": 53054178, "question_id": 53051724, "link": "https://stackoverflow.com/questions/53051724/before-action-causing-too-many-redirects/53054178#53054178", "title": "Before_action causing too many redirects", "body": "<p>There has to be an exception on your <code>before_action</code>: you don't want to call it on the <code>dash_path</code>. If a user enters there and is validated, it should stay there (as what the <code>redirect</code> would do) and if it is not validated it should just stay there (as with any other url that fails this validation process). </p>\n\n<p>There is no point on checking if it is validated as the result will always be to stay on the same page.</p>\n\n<p>Then in your controller you have to specify that you want an exception on the <code>before_action</code>:</p>\n\n<pre><code>class SomeController &lt; ApplicationController\n  before_action: :already_validated, except: [:dash_action]\n\n  def is_validated_action # the method that causes the redirect\n  end \n\n  def dash_action # action of dash_path url\n  end\n\n  def already_validated\n    if session[:uid] == user.id\n        redirect_to dash_path\n    end\n  end\nend\n</code></pre>\n\n<p>If you want some validation <code>before</code> the hypothetical <code>dash_action</code> then create a new method for it. Be sure that you don't have circular references or it will be pretty difficult to debug on the long run.</p>\n"}], "owner": {"reputation": 69, "user_id": 9803237, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/549ea1590447cf15756fd4835f8403b8?s=128&d=identicon&r=PG&f=1", "display_name": "D1D2D3D4D5", "link": "https://stackoverflow.com/users/9803237/d1d2d3d4d5"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 562, "favorite_count": 0, "accepted_answer_id": 53054178, "answer_count": 2, "score": -1, "last_activity_date": 1540848916, "creation_date": 1540837834, "last_edit_date": 1540841630, "question_id": 53051724, "link": "https://stackoverflow.com/questions/53051724/before-action-causing-too-many-redirects", "title": "Before_action causing too many redirects", "body": "<p>I'm wondering what would be the best way to handle the following:</p>\n\n<p>I have an authentication method (used as a before_action) as follows that checks if a user_id is in the session when the login page is requested. If the user_id is detected, then it redirects the user to dashboard path. </p>\n\n<pre><code>def already_validated\n    if session[:uid] == user.id\n        redirect_to dash_path\n    end\nend\n</code></pre>\n\n<p>This is leading to a too many redirect errors which I understand. I can see in pry that it's just evaluating that before_action filter every-time the page loads. That's what leads to too many redirects.</p>\n\n<p>My question is what is the best way to handle this type of setup. Is there a way in rails to only evaluate on the first redirect? I thought of using a temp flag to tell if the redirect happened before. That doesn't seem very elegant though. I'm sure there is an easier/better way to manage it.</p>\n\n<p>Thanks for any advice you can provide.</p>\n"}, {"tags": ["ruby", "regex"], "comments": [{"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1540837662, "post_id": 53051084, "comment_id": 93002950, "body": "Just out of curiosity, can you post an example of what <code>output</code> which might be passed to your method looks like?"}, {"owner": {"reputation": 43, "user_id": 8021459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba59e8b15533095935a1b262e04526bb?s=128&d=identicon&r=PG&f=1", "display_name": "David W", "link": "https://stackoverflow.com/users/8021459/david-w"}, "reply_to_user": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1540844037, "post_id": 53051084, "comment_id": 93005804, "body": "The example of what <code>output</code> could be is the first text snippet in my post"}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 8021459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba59e8b15533095935a1b262e04526bb?s=128&d=identicon&r=PG&f=1", "display_name": "David W", "link": "https://stackoverflow.com/users/8021459/david-w"}, "edited": false, "score": 0, "creation_date": 1540836185, "post_id": 53051289, "comment_id": 93002218, "body": "Thanks, this makes sense. Regex doesn&#39;t care that the numbers have some <i>value</i>, it just sees them a &quot;some numeric character&quot;. Appreciate the clarification"}], "tags": [], "owner": {"reputation": 764, "user_id": 7680208, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/km5EG.png?s=128&g=1", "display_name": "virullius", "link": "https://stackoverflow.com/users/7680208/virullius"}, "is_accepted": true, "score": 2, "last_activity_date": 1540835938, "creation_date": 1540835938, "answer_id": 53051289, "question_id": 53051084, "link": "https://stackoverflow.com/questions/53051084/perform-subtraction-within-regular-expression/53051289#53051289", "title": "Perform subtraction within regular expression", "body": "<p>Nope.</p>\n\n<p>By every definition I have ever seen, Regular Expressions are about text processing. It is character based pattern matching. Numbers are a class of textual characters in Regex and do not represent their numerical values. While <a href=\"https://en.wikipedia.org/wiki/Syntactic_sugar\" rel=\"nofollow noreferrer\">syntactic sugar</a> may mask what is actually being done, you still need to convert the text to a numeric value to perform the subtraction.</p>\n\n<p><a href=\"https://en.wikipedia.org/wiki/Regular_expression\" rel=\"nofollow noreferrer\">WikiPedia</a></p>\n\n<p><a href=\"https://ruby-doc.org/core-2.5.0/Regexp.html\" rel=\"nofollow noreferrer\">RubyDoc</a></p>\n"}, {"comments": [{"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1540868280, "post_id": 53051687, "comment_id": 93012606, "body": "This is nice an simple. However, benchmark vs OPs original method, this is actually about 50% less performant.  Sometimes less code is not fastest code."}], "tags": [], "owner": {"reputation": 14139, "user_id": 1108, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/48OpQ.jpg?s=128&g=1", "display_name": "jerhinesmith", "link": "https://stackoverflow.com/users/1108/jerhinesmith"}, "is_accepted": false, "score": 1, "last_activity_date": 1540837688, "creation_date": 1540837688, "answer_id": 53051687, "question_id": 53051084, "link": "https://stackoverflow.com/questions/53051084/perform-subtraction-within-regular-expression/53051687#53051687", "title": "Perform subtraction within regular expression", "body": "<p>If you know the format is going to remain consistent, you could do something like this:</p>\n\n<pre><code>output.scan(/\\d+/).map(&amp;:to_i).inject(:-)\n</code></pre>\n\n<p>It's not doing the subtraction via regex, but it does make it more concise.</p>\n"}], "owner": {"reputation": 43, "user_id": 8021459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba59e8b15533095935a1b262e04526bb?s=128&d=identicon&r=PG&f=1", "display_name": "David W", "link": "https://stackoverflow.com/users/8021459/david-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 711, "favorite_count": 0, "accepted_answer_id": 53051289, "answer_count": 2, "score": 1, "last_activity_date": 1540881895, "creation_date": 1540835129, "last_edit_date": 1540881895, "question_id": 53051084, "link": "https://stackoverflow.com/questions/53051084/perform-subtraction-within-regular-expression", "title": "Perform subtraction within regular expression", "body": "<p>I have the following RSpec output:</p>\n\n<pre><code>30 examples, 15 failures\n</code></pre>\n\n<p>I would like to subtract the second number from the first. I have this code:</p>\n\n<pre><code>def capture_passing_score(output)\n  captures = output.match(/^(?&lt;total&gt;\\d+)\\s*examples,\\s*(?&lt;failed&gt;\\d+)\\s*failures$/)\n  captures[:total].to_i - captures[:failed].to_i\nend\n</code></pre>\n\n<p>I am wondering if there is a way to do the calculation within a regular expression. Ideally, I'd avoid the second step in my code, and subtract the numbers within a regex. Performing mathematical operations may not be possible with Ruby's (or any) regex engine, but I couldn't find an answer either way. Is this possible?</p>\n"}, {"tags": ["ruby", "active-directory", "ldap", "windows-server"], "answers": [{"comments": [{"owner": {"reputation": 920, "user_id": 5450134, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d652a7b14b60443a47636cd4baef06ee?s=128&d=identicon&r=PG&f=1", "display_name": "Ninja Boy", "link": "https://stackoverflow.com/users/5450134/ninja-boy"}, "edited": false, "score": 0, "creation_date": 1540828590, "post_id": 53049084, "comment_id": 92998336, "body": "What&#39;s the general format for the following for an AD?  Username, Password and HOST. I&#39;ve seen multiple posts and there&#39;s no structured format. Is there a particular working schema that works for LDAP-AD?"}, {"owner": {"reputation": 28745, "user_id": 1202807, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e09276b9edb245e928e7163b27b15691?s=128&d=identicon&r=PG", "display_name": "Gabriel Luci", "link": "https://stackoverflow.com/users/1202807/gabriel-luci"}, "reply_to_user": {"reputation": 920, "user_id": 5450134, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d652a7b14b60443a47636cd4baef06ee?s=128&d=identicon&r=PG&f=1", "display_name": "Ninja Boy", "link": "https://stackoverflow.com/users/5450134/ninja-boy"}, "edited": false, "score": 0, "creation_date": 1540830246, "post_id": 53049084, "comment_id": 92999364, "body": "Host is just the server name or IP. Password is your password; nothing special there. And username is what I described in my answer."}, {"owner": {"reputation": 465, "user_id": 10348710, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-8GQQyJs5qHA/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaMpZBT1kD_XlhORSugi0WJu7K5BuA/mo/photo.jpg?sz=128", "display_name": "Jason", "link": "https://stackoverflow.com/users/10348710/jason"}, "edited": false, "score": 0, "creation_date": 1540833806, "post_id": 53049084, "comment_id": 93001065, "body": "Username for AD LDAP connections should be in the following format: sAMAccountName@domain.  For your example it would be windows@example.com and tester@example.com"}], "tags": [], "owner": {"reputation": 28745, "user_id": 1202807, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e09276b9edb245e928e7163b27b15691?s=128&d=identicon&r=PG", "display_name": "Gabriel Luci", "link": "https://stackoverflow.com/users/1202807/gabriel-luci"}, "is_accepted": false, "score": 0, "last_activity_date": 1540827779, "creation_date": 1540827779, "answer_id": 53049084, "question_id": 53048262, "link": "https://stackoverflow.com/questions/53048262/connect-to-active-directory-through-ldap-ruby/53049084#53049084", "title": "Connect to active directory through LDAP-Ruby", "body": "<p>I don't know Ruby, but my guess is that the problem is here:</p>\n\n<pre><code>auth: { method: :simple, email: email, password:password }\n</code></pre>\n\n<p>According to <a href=\"https://www.rubydoc.info/gems/ruby-net-ldap/Net/LDAP\" rel=\"nofollow noreferrer\">the documentation</a>, you should be using the <code>username</code> property, not <code>email</code>. And you need to set it to either the username (<code>sAMAccountName</code>) of the account, or the <code>userPrincipalName</code> (which may be the same as the email address, or the <code>distinguishedName</code>.</p>\n\n<p>Assuming the <code>userPrincipalName</code> is the same as the email address, then this might work:</p>\n\n<pre><code>auth: { method: :simple, username: email, password:password }\n</code></pre>\n"}], "owner": {"reputation": 920, "user_id": 5450134, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d652a7b14b60443a47636cd4baef06ee?s=128&d=identicon&r=PG&f=1", "display_name": "Ninja Boy", "link": "https://stackoverflow.com/users/5450134/ninja-boy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 411, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1540833069, "creation_date": 1540825283, "last_edit_date": 1540833069, "question_id": 53048262, "link": "https://stackoverflow.com/questions/53048262/connect-to-active-directory-through-ldap-ruby", "title": "Connect to active directory through LDAP-Ruby", "body": "<p>I'm trying to connect to an AD instance from my Ruby application. I've chosen LDAP for the job. </p>\n\n<p>Below is my connection settings and script I've written. </p>\n\n<pre><code> def name_for_login( email, password )\n  email = email[/\\A\\w+/].downcase  # Throw out the domain, if it was there\n  email &lt;&lt; \"@example.com\"        # I only check people in my company\n  ldap = Net::LDAP.new(\n    host: '10.0.0.2',\n    port: 1027,\n    auth: { method: :simple, email: email, password:password }\n  )\n  if ldap.bind\n  p 'lol'\n    # Yay, the login credentials were valid!\n    # Get the user's full name and return it\n    ldap.search(\n      base:         \"OU=Users,OU=Accounts,DC=example,DC=com\",\n      filter:       Net::LDAP::Filter.eq( \"mail\", email ),\n      attributes:   %w[ displayName ],\n      return_result:true\n    ).first.displayName.first\n  end\nend\n</code></pre>\n\n<p>and test credentials: </p>\n\n<ol>\n<li>windows : Windows@test</li>\n<li>tester : Pass@123</li>\n</ol>\n\n<p>If I run the script, it throws me the following error : </p>\n\n<pre><code>irb(main):025:0&gt; name_for_login('tester','Pass@123')\nNet::LDAP::BindingInformationInvalidError: Invalid binding information\n    from /Library/Ruby/Gems/2.3.0/gems/net-ldap-0.16.1/lib/net/ldap/auth_adapter/simple.rb:14:in `bind'\n    from /Library/Ruby/Gems/2.3.0/gems/net-ldap-0.16.1/lib/net/ldap/connection.rb:278:in `block in bind'\n    from /Library/Ruby/Gems/2.3.0/gems/net-ldap-0.16.1/lib/net/ldap/instrumentation.rb:19:in `instrument'\n    from /Library/Ruby/Gems/2.3.0/gems/net-ldap-0.16.1/lib/net/ldap/connection.rb:275:in `bind'\n    from /Library/Ruby/Gems/2.3.0/gems/net-ldap-0.16.1/lib/net/ldap.rb:868:in `block in bind'\n    from /Library/Ruby/Gems/2.3.0/gems/net-ldap-0.16.1/lib/net/ldap/instrumentation.rb:19:in `instrument'\n    from /Library/Ruby/Gems/2.3.0/gems/net-ldap-0.16.1/lib/net/ldap.rb:860:in `bind'\n    from (irb):9:in `name_for_login'\n    from (irb):25\n    from /usr/bin/irb:11:in `&lt;main&gt;'\n</code></pre>\n\n<p>I'm unsure from where to troubleshoot to understand the problem. </p>\n\n<p>The AD is on a Windows server hosted on Azure. </p>\n"}, {"tags": ["javascript", "jquery", "ruby", "ajax"], "answers": [{"tags": [], "owner": {"reputation": 364, "user_id": 802848, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ipX9p.jpg?s=128&g=1", "display_name": "Elya Livshitz", "link": "https://stackoverflow.com/users/802848/elya-livshitz"}, "is_accepted": false, "score": 0, "last_activity_date": 1557916127, "creation_date": 1557916127, "answer_id": 56147157, "question_id": 53047353, "link": "https://stackoverflow.com/questions/53047353/execjsruntimeerror-syntaxerror-unexpected-token-punc-from-getexecjs/56147157#56147157", "title": "ExecJS::RuntimeError: SyntaxError: Unexpected token: punc ()) from get@(execjs):3538:630", "body": "<p>The node's version in the target machine is probably lower than your local one and does not support ES5+ js syntax.\nSomewhat related to that: \n<code>SyntaxError: Unexpected token )</code>\n<a href=\"https://stackoverflow.com/questions/35312609/es6-giving-syntaxerror-unexpected-token\">ES6 giving SyntaxError: Unexpected token )</a></p>\n"}], "owner": {"reputation": 1, "user_id": 10534531, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-UO0XZ3A8ecY/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbAfjHKyl-wWy2ZbSUO3ONr6jS1wew/mo/photo.jpg?sz=128", "display_name": "Zihao Wang", "link": "https://stackoverflow.com/users/10534531/zihao-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1557916127, "creation_date": 1540822332, "question_id": 53047353, "link": "https://stackoverflow.com/questions/53047353/execjsruntimeerror-syntaxerror-unexpected-token-punc-from-getexecjs", "title": "ExecJS::RuntimeError: SyntaxError: Unexpected token: punc ()) from get@(execjs):3538:630", "body": "<p>I have an issue when precompiling to Heroku and I checked on Stack overflow to find a debug method which is:</p>\n\n<pre><code>JS_PATH = \"app/assets/javascripts/**/*.js\"; \nDir[JS_PATH].each do |file_name|\nputs \"\\n#{file_name}\"\nputs Uglifier.compile(File.read(file_name))\nend\n</code></pre>\n\n<p>When I run rail console with this command, it gives me an error in application.js which is </p>\n\n<pre><code>app/assets/javascripts/application.js\nExecJS::RuntimeError: SyntaxError: Unexpected token: punc ())\nfrom get@(execjs):3538:630\n</code></pre>\n\n<p>The following is my application.js file which i am trying to load the page when someone make a selection from subject list or enter something in the course field. The program works perfectly when running locally but fails to deploy on Heroku. Could you please tell me where I make the run toke cuz I really cannot find it.</p>\n\n<pre><code>//= require jquery3\n//= require rails-ujs\n//= require turbolinks\n//= require_tree .\n//= require tether\n//= require popper\n//= require bootstrap\n$(document).on('turbolinks:load', () =&gt; {\n  $('#course').on('input', function() {\n    if (this.value.length &gt; 1) Rails.fire($('.search-form')[0], 'submit')\n  })\n  $('#subject').on('change', () =&gt; Rails.fire($('.search-form')[0], 'submit'))\n})\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "dry-rb"], "answers": [{"tags": [], "owner": {"reputation": 803, "user_id": 7654691, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8Gni.jpg?s=128&g=1", "display_name": "R. Sierra", "link": "https://stackoverflow.com/users/7654691/r-sierra"}, "is_accepted": false, "score": -1, "last_activity_date": 1540825951, "creation_date": 1540825951, "answer_id": 53048476, "question_id": 53046874, "link": "https://stackoverflow.com/questions/53046874/missing-module-when-using-dryvalidations-to-validate-query-params/53048476#53048476", "title": "Missing Module when using DryValidations to validate query params", "body": "<p>To define a custom type for validations you should use a Types module. So you should change the module name from <code>CustomTypes</code> to <code>Types</code>.</p>\n\n<pre><code>module Types\n  include Dry::Types.module\n\n  IncludeRelatedObject = Types::String.constructor do |itm|\n    itm.split(',')&amp;.map :chomp\n  end\nend\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "is_accepted": true, "score": 3, "last_activity_date": 1540827395, "creation_date": 1540827395, "answer_id": 53048953, "question_id": 53046874, "link": "https://stackoverflow.com/questions/53046874/missing-module-when-using-dryvalidations-to-validate-query-params/53048953#53048953", "title": "Missing Module when using DryValidations to validate query params", "body": "<p><code>include Dry::Types.module</code> basically inflects constants into the module it\u2019s being included into. You got <code>CustomTypes::String</code> amongst others and this is what should be referenced in your custom type:</p>\n\n<pre><code>module CustomTypes\n  include Dry::Types.module\n\n  # IncludeRelatedObject = Types::String.constructor do |itm|\n  IncludeRelatedObject = CustomTypes::String.constructor do |itm|\n    itm.split(',').map(&amp;:chomp)\n  end\nend\n</code></pre>\n"}], "owner": {"reputation": 1135, "user_id": 1638009, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/cce87e94a76af5a587b5c9fe48461910?s=128&d=identicon&r=PG", "display_name": "Shimu", "link": "https://stackoverflow.com/users/1638009/shimu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 53048953, "answer_count": 2, "score": 0, "last_activity_date": 1540827395, "creation_date": 1540820777, "question_id": 53046874, "link": "https://stackoverflow.com/questions/53046874/missing-module-when-using-dryvalidations-to-validate-query-params", "title": "Missing Module when using DryValidations to validate query params", "body": "<p>I have a jsonapi endpoint where I get the query parameter \"include\" with several objects seperated by a \",\"<br>\nNow, I validate my params with Dry::Validations and would like to preproccess this field so that I get an array of strings. \nTo achive this I made this according to the docu:  </p>\n\n<pre><code>module CustomTypes\n  include Dry::Types.module\n\n  IncludeRelatedObject = Types::String.constructor do |itm|\n    itm.split(',')&amp;.map :chomp\n  end\nend\n</code></pre>\n\n<p>Now, when I run my tests I get this error: </p>\n\n<blockquote>\n  <p>Failure/Error:\n    IncludeRelatedObject = Types::String.constructor do |itm|\n      itm.split(',')&amp;.map :chomp\n    end</p>\n  \n  <p>NameError:\n    uninitialized constant CustomTypes::Types</p>\n</blockquote>\n\n<p>And this is my validation:</p>\n\n<pre><code>Dry::Validation.Params do\n  configure do\n    config.type_specs = true\n  end\n  optional(:include, CustomTypes::IncludeRelatedObject).each { :filled? &amp; :str? }\nend\n</code></pre>\n\n<p>Any ideas what's wrong with my code?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "postgresql"], "comments": [{"owner": {"reputation": 8160, "user_id": 163640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d63f02794544d271573750a83842cf59?s=128&d=identicon&r=PG", "display_name": "eugen", "link": "https://stackoverflow.com/users/163640/eugen"}, "edited": false, "score": 2, "creation_date": 1540823408, "post_id": 53046623, "comment_id": 92994987, "body": "Try reinstalling the <code>pg</code> gem - this should recompile the native code with the current libraries on Mojave."}, {"owner": {"reputation": 83, "user_id": 7708307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97b2b5f02a3057e9f712db89de27fc97?s=128&d=identicon&r=PG&f=1", "display_name": "k.jobbins", "link": "https://stackoverflow.com/users/7708307/k-jobbins"}, "reply_to_user": {"reputation": 8160, "user_id": 163640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d63f02794544d271573750a83842cf59?s=128&d=identicon&r=PG", "display_name": "eugen", "link": "https://stackoverflow.com/users/163640/eugen"}, "edited": false, "score": 0, "creation_date": 1540908872, "post_id": 53046623, "comment_id": 93030902, "body": "Thanks of the help, I have tried that but unfortunately it does not work. After digging around a little I have found that when I remove the puma gem from the app, and the server runs with WEBrick, it loads fine and no segmentation fault."}, {"owner": {"reputation": 8160, "user_id": 163640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d63f02794544d271573750a83842cf59?s=128&d=identicon&r=PG", "display_name": "eugen", "link": "https://stackoverflow.com/users/163640/eugen"}, "edited": false, "score": 0, "creation_date": 1540910836, "post_id": 53046623, "comment_id": 93032205, "body": "puma also has some native extensions - have you tried reinstalling the puma gem as well?"}, {"owner": {"reputation": 83, "user_id": 7708307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97b2b5f02a3057e9f712db89de27fc97?s=128&d=identicon&r=PG&f=1", "display_name": "k.jobbins", "link": "https://stackoverflow.com/users/7708307/k-jobbins"}, "reply_to_user": {"reputation": 8160, "user_id": 163640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d63f02794544d271573750a83842cf59?s=128&d=identicon&r=PG", "display_name": "eugen", "link": "https://stackoverflow.com/users/163640/eugen"}, "edited": false, "score": 0, "creation_date": 1540914505, "post_id": 53046623, "comment_id": 93034566, "body": "Yeah, I have tried reinstalling the puma gem and reinstalling the gem to the latest version."}, {"owner": {"reputation": 83, "user_id": 7708307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97b2b5f02a3057e9f712db89de27fc97?s=128&d=identicon&r=PG&f=1", "display_name": "k.jobbins", "link": "https://stackoverflow.com/users/7708307/k-jobbins"}, "reply_to_user": {"reputation": 8160, "user_id": 163640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d63f02794544d271573750a83842cf59?s=128&d=identicon&r=PG", "display_name": "eugen", "link": "https://stackoverflow.com/users/163640/eugen"}, "edited": false, "score": 1, "creation_date": 1540919476, "post_id": 53046623, "comment_id": 93037452, "body": "I have narrowed it down to the <code>workers ENV.fetch(&quot;WEB_CONCURRENCY&quot;) { 2 }</code> line in my puma.rb file. Do you know why this could be causing a segfault ?"}, {"owner": {"reputation": 1038, "user_id": 795734, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/7aa6d5b255d8a8f8e1c50ef6356c972b?s=128&d=identicon&r=PG&f=1", "display_name": "Steven", "link": "https://stackoverflow.com/users/795734/steven"}, "edited": false, "score": 0, "creation_date": 1545071102, "post_id": 53046623, "comment_id": 94490531, "body": "How did you proceed?"}, {"owner": {"reputation": 83, "user_id": 7708307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97b2b5f02a3057e9f712db89de27fc97?s=128&d=identicon&r=PG&f=1", "display_name": "k.jobbins", "link": "https://stackoverflow.com/users/7708307/k-jobbins"}, "edited": false, "score": 0, "creation_date": 1545223278, "post_id": 53046623, "comment_id": 94550215, "body": "The problem seems to be running puma in multi connection mode. Option 1: updating ruby worked but wasn&#39;t the best option for me at the time, Option 2: Setting the workers to 1, meaning puma was in single user mode in my dev environment.   <code>workers_count = Integer(ENV[&#39;WEB_CONCURRENCY&#39;] || 1) if workers_count &gt; 1   workers workers_count</code>"}, {"owner": {"reputation": 4288, "user_id": 447303, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/a07f0662e96a632d9447a710adadbe05?s=128&d=identicon&r=PG", "display_name": "phil", "link": "https://stackoverflow.com/users/447303/phil"}, "edited": false, "score": 0, "creation_date": 1574928369, "post_id": 53046623, "comment_id": 104404323, "body": "For me the sefault is only happening in rails console, not when running webserver (all in development)"}], "answers": [{"comments": [{"owner": {"reputation": 6102, "user_id": 439592, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/dbdecf60f827e3705d1a0e4cf73f01e0?s=128&d=identicon&r=PG", "display_name": "The Pellmeister", "link": "https://stackoverflow.com/users/439592/the-pellmeister"}, "edited": false, "score": 0, "creation_date": 1574905439, "post_id": 53850375, "comment_id": 104398122, "body": "This fixed it for me. I don&#39;t understand what the actual issue is here, if you do, would you mind putting a link to it so we can track it?"}, {"owner": {"reputation": 2479, "user_id": 1794765, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/477df5426c836272b13cbcbab1c734ef?s=128&d=identicon&r=PG", "display_name": "elplatt", "link": "https://stackoverflow.com/users/1794765/elplatt"}, "edited": false, "score": 0, "creation_date": 1576103763, "post_id": 53850375, "comment_id": 104794682, "body": "This worked for me as well. And to clarify, the fix is in <code>config&#47;puma.rb</code>."}], "tags": [], "owner": {"reputation": 1038, "user_id": 795734, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/7aa6d5b255d8a8f8e1c50ef6356c972b?s=128&d=identicon&r=PG&f=1", "display_name": "Steven", "link": "https://stackoverflow.com/users/795734/steven"}, "is_accepted": true, "score": 7, "last_activity_date": 1545219273, "creation_date": 1545219273, "answer_id": 53850375, "question_id": 53046623, "link": "https://stackoverflow.com/questions/53046623/pg-rb-segmentation-fault-mojave-upgrade/53850375#53850375", "title": "pg.rb segmentation fault [Mojave upgrade]", "body": "<p>As this issue is only occuring in the development environment, I made it conditional. This solution in <code>puma.rb</code> works for me until the bug gets fixed.</p>\n\n<p><code>workers ENV.fetch(\"WEB_CONCURRENCY\") { 2 } unless Rails.env.development?</code></p>\n"}, {"tags": [], "owner": {"reputation": 2738, "user_id": 747114, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/111517710867e6e4ad41e4f7784f9799?s=128&d=identicon&r=PG", "display_name": "rlarcombe", "link": "https://stackoverflow.com/users/747114/rlarcombe"}, "is_accepted": false, "score": 0, "last_activity_date": 1557476817, "creation_date": 1557476817, "answer_id": 56073578, "question_id": 53046623, "link": "https://stackoverflow.com/questions/53046623/pg-rb-segmentation-fault-mojave-upgrade/56073578#56073578", "title": "pg.rb segmentation fault [Mojave upgrade]", "body": "<p>I had a similar issue, in which my test environment was often crashing in Ruby 2.6.3 with Segmnentation Fault lib/pg.rb line 56.</p>\n\n<p>What worked for me was setting pumb.rb to have zero workers in the test environment:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code># config/puma.rb\n(ENV.fetch(\"RAILS_ENV\") == 'test') ? (workers 0) : (workers ENV.fetch(\"WEB_CONCURRENCY\") { 2 })\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6200, "user_id": 637094, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/fd50f61387b63900335c8556f86237be?s=128&d=identicon&r=PG", "display_name": "Leonel Gal&#225;n", "link": "https://stackoverflow.com/users/637094/leonel-gal%c3%a1n"}, "edited": false, "score": 0, "creation_date": 1575388822, "post_id": 59059315, "comment_id": 104546298, "body": "This, of course, if <i>dotenv</i> is being used. But it&#39;s a good idea!"}], "tags": [], "owner": {"reputation": 41, "user_id": 5142488, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-E2iN-vtKhTE/AAAAAAAAAAI/AAAAAAAAAmg/1dK4GeFRhEs/photo.jpg?sz=128", "display_name": "Dimka Pron", "link": "https://stackoverflow.com/users/5142488/dimka-pron"}, "is_accepted": false, "score": 4, "last_activity_date": 1574802333, "creation_date": 1574802333, "answer_id": 59059315, "question_id": 53046623, "link": "https://stackoverflow.com/questions/53046623/pg-rb-segmentation-fault-mojave-upgrade/59059315#59059315", "title": "pg.rb segmentation fault [Mojave upgrade]", "body": "<p>in .env file set \n<code>WEB_CONCURRENCY=0</code>\nand you do not need to add any logic in config/puma.rb</p>\n"}], "owner": {"reputation": 83, "user_id": 7708307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97b2b5f02a3057e9f712db89de27fc97?s=128&d=identicon&r=PG&f=1", "display_name": "k.jobbins", "link": "https://stackoverflow.com/users/7708307/k-jobbins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1172, "favorite_count": 3, "accepted_answer_id": 53850375, "answer_count": 3, "score": 8, "last_activity_date": 1574802333, "creation_date": 1540820035, "question_id": 53046623, "link": "https://stackoverflow.com/questions/53046623/pg-rb-segmentation-fault-mojave-upgrade", "title": "pg.rb segmentation fault [Mojave upgrade]", "body": "<p>Segmentation fault in pg.rb:56</p>\n\n<p>versions:\nrails: 5.2.0,\nruby: 2.4.4,\npg gem: 0.20.0</p>\n\n<p>After upgrading to Mac OS mojave i have encountered problems with my local host server. The server itself, starts fine, however when trying to access it through a web browser, it crashes and I have the segmentation error shown above. </p>\n"}, {"tags": ["ruby-on-rails", "ruby", "loops", "time"], "comments": [{"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1540817865, "post_id": 53045570, "comment_id": 92991390, "body": "What exactly are you trying to do after each 1 minute?"}, {"owner": {"reputation": 145, "user_id": 8371714, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41001419cf5313eb31a80621923535eb?s=128&d=identicon&r=PG&f=1", "display_name": "JimBob", "link": "https://stackoverflow.com/users/8371714/jimbob"}, "reply_to_user": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1540817929, "post_id": 53045570, "comment_id": 92991430, "body": "reset the timestart when 1min is reached, thus resetting the timer"}], "answers": [{"tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": false, "score": 2, "last_activity_date": 1540831863, "last_edit_date": 1540831863, "creation_date": 1540819472, "answer_id": 53046460, "question_id": 53045570, "link": "https://stackoverflow.com/questions/53045570/reset-timer-outside-of-loops/53046460#53046460", "title": "Reset timer outside of loops", "body": "<p>Here's how you can use <code>yield</code> to clean up your main method</p>\n\n<pre><code>@timestart = Time.now\n\ndef one_min_check \n  start_time = Time.now\n  yield\n  end_time = Time.now\n  puts \"Something took #{end_time - start_time} to run\"\n  if end_time - @timestart &gt;= 60.0\n    @timestart = end_time \n    puts \"Took 1 minute or longer. Reset 1 min at #{@timestart}\"\n  end\nend\n\n\nIndividual.all.each do |f|\n   one_min_check do \n     #do stuff with f\n   end\nend\n</code></pre>\n\n<p>But if why not just user benchmark?</p>\n\n<pre><code>require 'benchmark'\n\nIndividual.all.each do |f|\n  puts Benchmark.measure do \n    #do stuff with f\n  end\nend\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 330, "user_id": 7009277, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-k8xOf9u-6cs/AAAAAAAAAAI/AAAAAAAABvk/z92X2OLMDhs/photo.jpg?sz=128", "display_name": "F&#225;bio Ara&#250;jo", "link": "https://stackoverflow.com/users/7009277/f%c3%a1bio-ara%c3%bajo"}, "is_accepted": false, "score": 0, "last_activity_date": 1540820342, "creation_date": 1540820342, "answer_id": 53046738, "question_id": 53045570, "link": "https://stackoverflow.com/questions/53045570/reset-timer-outside-of-loops/53046738#53046738", "title": "Reset timer outside of loops", "body": "<p>You could calculate it.</p>\n\n<pre><code>quantity = Individual.all.count\ntime = Benchmark.measure { Post.all }\n\ntime_per_each = time / quantity.to_f\n</code></pre>\n\n<p>The answer you get is in milisseconds, just convert. </p>\n\n<p>Hope it help yout.</p>\n"}, {"comments": [{"owner": {"reputation": 145, "user_id": 8371714, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41001419cf5313eb31a80621923535eb?s=128&d=identicon&r=PG&f=1", "display_name": "JimBob", "link": "https://stackoverflow.com/users/8371714/jimbob"}, "edited": false, "score": 0, "creation_date": 1540824475, "post_id": 53047252, "comment_id": 92995684, "body": "Thanks; I will try that out.  I&#39;m fetching data from an API that has a limit of 600 requests/ 5 min, so I&#39;m looking to add a timer and then a pause every 5 min; the timer is to calculate how long it needed to pause for before it can continue.  If there is a better way to do this I would love to know!"}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "reply_to_user": {"reputation": 145, "user_id": 8371714, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41001419cf5313eb31a80621923535eb?s=128&d=identicon&r=PG&f=1", "display_name": "JimBob", "link": "https://stackoverflow.com/users/8371714/jimbob"}, "edited": false, "score": 0, "creation_date": 1540832067, "post_id": 53047252, "comment_id": 93000233, "body": "@JimBob I hope you are doing this in a background worker right?"}], "tags": [], "owner": {"reputation": 221, "user_id": 10542565, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KHCz54uDY7Q/AAAAAAAAAAI/AAAAAAAAAo0/jDTOYj3g8As/photo.jpg?sz=128", "display_name": "Nathan Kontny", "link": "https://stackoverflow.com/users/10542565/nathan-kontny"}, "is_accepted": false, "score": 2, "last_activity_date": 1540821931, "creation_date": 1540821931, "answer_id": 53047252, "question_id": 53045570, "link": "https://stackoverflow.com/questions/53045570/reset-timer-outside-of-loops/53047252#53047252", "title": "Reset timer outside of loops", "body": "<p>The answer to your question as is in an easy Rails-like way to reset after a minute could be: </p>\n\n<pre><code>timestart = Time.now\n\nIndividual.all.each do |f|\n\n    endtime = Time.now\n    timer = (endtime - timestart)\n\n    puts timer #places the time it takes for each loop\n\n    if timestart &lt; 1.minute.ago\n        timestart = Time.now\n    end\n\nend\n</code></pre>\n\n<p>But, it's possible we could be more helpful if we understood why you want to benchmark the loop this way. Why do want to reset the timer every minute? </p>\n\n<p>Also you have this comment: <code>places the time it takes for each loop</code>. That's not exactly true in your code here, since you aren't resetting timestart on every loop. Let's say the loop takes 1 second. The first iteration <code>timer</code> will be \"1 second\". The second time <code>timer</code> will be \"2 seconds\" even though the loop iteration took just a second. </p>\n\n<p>But you might have your reasons :) </p>\n"}, {"tags": [], "owner": {"reputation": 145, "user_id": 8371714, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41001419cf5313eb31a80621923535eb?s=128&d=identicon&r=PG&f=1", "display_name": "JimBob", "link": "https://stackoverflow.com/users/8371714/jimbob"}, "is_accepted": false, "score": 0, "last_activity_date": 1540825431, "creation_date": 1540825431, "answer_id": 53048309, "question_id": 53045570, "link": "https://stackoverflow.com/questions/53045570/reset-timer-outside-of-loops/53048309#53048309", "title": "Reset timer outside of loops", "body": "<p>Figured it out myself :)</p>\n\n<p>just placed the</p>\n\n<pre><code>timestart = Time.now\n</code></pre>\n\n<p>in the loop between the condition.  Had to change the code slightly to keep time, but the timer resets at that point for the next loop :-></p>\n\n<p>Pretty easy really</p>\n"}, {"tags": [], "owner": {"reputation": 113, "user_id": 10446986, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-3bajdO_9yIA/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DUMh7PsjPa3YKuhlOLUMPZcwu2BKg/mo/photo.jpg?sz=128", "display_name": "Nicolas HERMET", "link": "https://stackoverflow.com/users/10446986/nicolas-hermet"}, "is_accepted": false, "score": 0, "last_activity_date": 1540831723, "creation_date": 1540831723, "answer_id": 53050221, "question_id": 53045570, "link": "https://stackoverflow.com/questions/53045570/reset-timer-outside-of-loops/53050221#53050221", "title": "Reset timer outside of loops", "body": "<p>If my understanding of what you are trying to do is correct : </p>\n\n<pre><code>timestart = Time.now\n\nIndividual.all.each do |f|\n\n  puts Time.now-timestart #places the time it takes for each loop\n\n  if Time.now-timestart &lt; 60 # or some other condition of your choice\n    timestart = Time.now\n  end\n\nend\n</code></pre>\n\n<p>should nicely do the job...</p>\n\n<p>But indeed, it won't reset <code>timestart</code> on every loop</p>\n"}], "owner": {"reputation": 145, "user_id": 8371714, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41001419cf5313eb31a80621923535eb?s=128&d=identicon&r=PG&f=1", "display_name": "JimBob", "link": "https://stackoverflow.com/users/8371714/jimbob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "answer_count": 5, "score": 0, "last_activity_date": 1540833964, "creation_date": 1540816308, "question_id": 53045570, "link": "https://stackoverflow.com/questions/53045570/reset-timer-outside-of-loops", "title": "Reset timer outside of loops", "body": "<p>I've set up a timer for a function I am timing, but want it to reset after a condition is met</p>\n\n<pre><code>timestart = Time.now\n\nIndividual.all.each do |f|\n\n    endtime = Time.now\n    timer = (endtime - timestart)\n\n    puts timer #places the time it takes for each loop\n\n    if checktime  == 1 then\n        ###Apply new {timestart = Time.now} HERE?###\n    end\n\nend\n</code></pre>\n\n<p>So in the above example, I want my timer to reset after 1min</p>\n"}, {"tags": ["ruby", "carrierwave", "sidekiq"], "answers": [{"tags": [], "owner": {"reputation": 298, "user_id": 956480, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/HXaYY.png?s=128&g=1", "display_name": "Stan666", "link": "https://stackoverflow.com/users/956480/stan666"}, "is_accepted": true, "score": 0, "last_activity_date": 1574007360, "last_edit_date": 1574007360, "creation_date": 1541258336, "answer_id": 53132664, "question_id": 53044025, "link": "https://stackoverflow.com/questions/53044025/is-carrierwave-thread-safe/53132664#53132664", "title": "Is Carrierwave thread-safe?", "body": "<p>Spent a few days to figure out what's going on. It is kinda an interesting case and also too long to explain it here so I decided to write a <a href=\"https://linyaoli.github.io/#/notes/2018-11-02-carrierwave-is-not-thread-safe\" rel=\"nofollow noreferrer\">post</a> for it, so for more details please read it there.</p>\n\n<hr>\n\n<p>Long story short is, carrierwave uses class variable to save processor method and dimensions, and it is not reset after the uploader finishes, thus the next uploader will be affected. </p>\n"}], "owner": {"reputation": 298, "user_id": 956480, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/HXaYY.png?s=128&g=1", "display_name": "Stan666", "link": "https://stackoverflow.com/users/956480/stan666"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 53132664, "answer_count": 1, "score": 1, "last_activity_date": 1574007360, "creation_date": 1540810675, "question_id": 53044025, "link": "https://stackoverflow.com/questions/53044025/is-carrierwave-thread-safe", "title": "Is Carrierwave thread-safe?", "body": "<p>I'm using Sidekiq and Carrierwave to upload images to S3. The background job does the following things:</p>\n\n<ol>\n<li>Downloads image from a remote url;</li>\n<li>Resizes it using minimagick;</li>\n<li>Uploads the resized images to S3.</li>\n</ol>\n\n<p>Here's the code snippet:</p>\n\n<pre><code>  def store_for_mobile(file)\n     self.class.process optimize: [1080, 810]\n     %w(android ios).each do |device|\n        @directory = File.join('banners/mobile', device)\n        store!(file)\n     end\n  end\n\n  def store_for_web(file)\n     self.class.process optimize: [750, 562]\n     @directory = 'stores/750x562/'\n     store!(file)\n  end\n\n  def store_header(file)\n    self.class.process resize_to_limit: [640, 640]\n    @directory = 'headers/images/consumer_app_brand_logos/'\n    store!(file)\n  end\n\n  def store_header_mailer(file)\n    self.class.process resize_to_limit: [360, 120]\n    @directory = 'headers/images/360x120/'\n    store!(file)\n  end\n</code></pre>\n\n<p>The above methods are executed in different jobs respectively, which means sometimes they are running concurrently.</p>\n\n<p>Soon I noticed that some images resized by <code>store_header_mailer</code> were uploaded to the directory which should be owned by <code>store_for_mobile</code>, <code>store_for_web</code> and <code>store_header</code>. (e.g. <code>'headers/images/consumer_app_brand_logos/'</code> got 120x120 images)</p>\n\n<p>This issue didn't exist while I was using Resque.</p>\n\n<p>I looked into carrierwave's source code, and noticed that</p>\n\n<p><a href=\"https://github.com/carrierwaveuploader/carrierwave/blob/master/lib/carrierwave/uploader/processing.rb#L54\" rel=\"nofollow noreferrer\">https://github.com/carrierwaveuploader/carrierwave/blob/master/lib/carrierwave/uploader/processing.rb#L54</a></p>\n\n<p>it is using class variables <code>self.processors</code> and class methods <code>self.process</code> while invoking image_magick command lines.</p>\n\n<p>Is this part of code thread-safe? Thanks in advance.</p>\n"}, {"tags": ["ruby", "openssl", "smime"], "answers": [{"tags": [], "owner": {"reputation": 53, "user_id": 1768090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/91690457c9cf1318f9a2b3b1dd225a51?s=128&d=identicon&r=PG", "display_name": "d3bit", "link": "https://stackoverflow.com/users/1768090/d3bit"}, "is_accepted": false, "score": 0, "last_activity_date": 1541425752, "creation_date": 1541425752, "answer_id": 53155707, "question_id": 53044007, "link": "https://stackoverflow.com/questions/53044007/how-to-use-sha1-digest-during-signing-with-opensslpkcs7-sign-when-creating-smi/53155707#53155707", "title": "How to use SHA1 digest during signing with OpenSSL::PKCS7.sign when creating SMIME message", "body": "<p>I do not know if it is possible to specify the digest algorithm using the Ruby bindings, but the equivalent OpenSSL command is:</p>\n\n<pre><code>openssl smime -sign -in body.txt -out out.txt -signer cert.pem -inkey key.pem -md sha1\n</code></pre>\n\n<p>You can verify the digest signature with:</p>\n\n<pre><code>openssl smime -verify -in out.txt -noverify\n</code></pre>\n"}], "owner": {"reputation": 2330, "user_id": 1043167, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/1998812477433665de07bdc97af50d28?s=128&d=identicon&r=PG", "display_name": "Laurens", "link": "https://stackoverflow.com/users/1043167/laurens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 608, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1541425752, "creation_date": 1540810613, "last_edit_date": 1540921623, "question_id": 53044007, "link": "https://stackoverflow.com/questions/53044007/how-to-use-sha1-digest-during-signing-with-opensslpkcs7-sign-when-creating-smi", "title": "How to use SHA1 digest during signing with OpenSSL::PKCS7.sign when creating SMIME message", "body": "<p>The following code</p>\n\n<pre><code>body = \"This is the message body\"\npkcs7 = OpenSSL::PKCS7.sign @certificate, @pkey, body\npkcs7.detached = true\nsmime_signed = OpenSSL::PKCS7.write_smime pkcs7, body\n</code></pre>\n\n<p>will generate</p>\n\n<pre><code>MIME-Version: 1.0\nContent-Type: multipart/signed; protocol=\"application/x-pkcs7-signature\"; micalg=\"sha-256\"; boundary=\"----F1B5E0635C071F76431AEFB127A7DF88\"\n\nThis is an S/MIME signed message\n\n------F1B5E0635C071F76431AEFB127A7DF88\nThis is the message body\n------F1B5E0635C071F76431AEFB127A7DF88\nContent-Type: application/x-pkcs7-signature; name=\"smime.p7s\"\nContent-Transfer-Encoding: base64\nContent-Disposition: attachment; filename=\"smime.p7s\"\n\nMIIHSgYJKoZIhvcNAQcCoIIHOzCCBzcCAQExDzANBglghkgBZQMEAgEFADALBgkq\nhkiG9w0BBwGgggRqMIIEZjCCA06gAwIBAgIQQNnrBxVw4uQUu6QaUH9huTANBgkq\n[omitted]\n</code></pre>\n\n<p>Is it possible to set a custom digest, like <code>OpenSSL::Digest::SHA1.new</code> for the micalg? And if so, how?</p>\n\n<p>I've tried the following:</p>\n\n<pre><code>pkcs7 = OpenSSL::PKCS7.new\npkcs7.type = :signed\nsigner = OpenSSL::PKCS7::Signer.new(@certificate, @pkey, OpenSSL::Digest::SHA1.new)\npkcs7.add_data body\npkcs7.add_certificate(@certificate)\npkcs7.add_signer signer\npkcs7.detached = true\nsmime_signed = OpenSSL::PKCS7.write_smime pkcs7, body\n</code></pre>\n\n<p>this will generate </p>\n\n<pre><code>MIME-Version: 1.0\nContent-Type: multipart/signed; protocol=\"application/x-pkcs7-signature\"; micalg=\"sha1\"; boundary=\"----0986A4FB87D37510B8051AB492BBF7A2\"\n\nThis is an S/MIME signed message\n\n------0986A4FB87D37510B8051AB492BBF7A2\nThis is the message body\n------0986A4FB87D37510B8051AB492BBF7A2\nContent-Type: application/x-pkcs7-signature; name=\"smime.p7s\"\nContent-Transfer-Encoding: base64\nContent-Disposition: attachment; filename=\"smime.p7s\"\n\nMIIFcwYJKoZIhvcNAQcCoIIFZDCCBWACAQExCzAJBgUrDgMCGgUAMAsGCSqGSIb3\nDQEHAaCCBGowggRmMIIDTqADAgECAhBA2esHFXDi5BS7pBpQf2G5MA0GCSqGSIb3\n[omitted]\n</code></pre>\n\n<p>This seems to work and change the <code>micalg</code>, but the difference is <code>pkcs7#data now returns #&lt;OpenSSL::PKCS7:0x007fbe866d9420 @data=nil&gt;</code></p>\n\n<p>So, is it possible to use a different digest with <code>OpenSSL::PKCS7.sign</code>?\nAnd if not, what is the equivalent of </p>\n\n<pre><code>body = \"This is the message body\"\npkcs7 = OpenSSL::PKCS7.sign @certificate, @pkey, body\npkcs7.detached = true\nsmime_signed = OpenSSL::PKCS7.write_smime pkcs7, body\n</code></pre>\n\n<p>in openssl?</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "answers": [{"comments": [{"owner": {"reputation": 437, "user_id": 4520527, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/0jYao.png?s=128&g=1", "display_name": "dealwap", "link": "https://stackoverflow.com/users/4520527/dealwap"}, "edited": false, "score": 0, "creation_date": 1540812850, "post_id": 53044554, "comment_id": 92988489, "body": "Thank you, So what I am trying to do is fetch all cart items that belong to a particular user then include the details of each Items from the Items table since I am only adding <code>user_id</code> and <code>items_id</code> in the carts table."}, {"owner": {"reputation": 165, "user_id": 5072324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52beaa2468b3057ca981b58cbf189acd?s=128&d=identicon&r=PG", "display_name": "Jegan", "link": "https://stackoverflow.com/users/5072324/jegan"}, "reply_to_user": {"reputation": 437, "user_id": 4520527, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/0jYao.png?s=128&g=1", "display_name": "dealwap", "link": "https://stackoverflow.com/users/4520527/dealwap"}, "edited": false, "score": 1, "creation_date": 1540814028, "post_id": 53044554, "comment_id": 92989140, "body": "@dealwap,whatever the code you have written  is correct ( Cart.includes(:items).where(user_id: current_user.id)), but,you have done the wrong association.See the  max&#39;s answer.In this answer also, the cod will  work only if you  place the foreign key on items table  not on carts table"}], "tags": [], "owner": {"reputation": 784, "user_id": 7970365, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30ea30f5ef13a4593ad0eafd20304601?s=128&d=identicon&r=PG", "display_name": "D1ceWard", "link": "https://stackoverflow.com/users/7970365/d1ceward"}, "is_accepted": false, "score": 0, "last_activity_date": 1540812488, "creation_date": 1540812488, "answer_id": 53044554, "question_id": 53043796, "link": "https://stackoverflow.com/questions/53043796/issues-with-rails-models-associations/53044554#53044554", "title": "Issues with Rails models associations", "body": "<p>If i understand correctly you want items by user and cart, so your code is wrong and i thing you misunderstood ActiveRecord <code>.includes</code>.</p>\n\n<p>You querying <code>Cart</code> by <code>user_id</code> in :</p>\n\n<pre><code>@items = Cart.includes(:items).where(user_id: current_user.id)\n</code></pre>\n\n<p>The <code>.includes</code> here only allows you to access the items of the <code>Cart</code> model without firing an additional query</p>\n\n<p>To get items you should :</p>\n\n<pre><code> # With know cart id\n @items = Item.where(cart_id: cart_id)\n\n # With only user id (for example)\n # Querying all items where cart have current user id\n @items = Item.join(:cart).where(carts: { user_id: current_user.id })\n</code></pre>\n\n<p><a href=\"https://apidock.com/rails/ActiveRecord/QueryMethods/includes\" rel=\"nofollow noreferrer\">Active Record .includes Documentation</a></p>\n\n<p><a href=\"https://apidock.com/rails/ActiveRecord/QueryMethods/joins\" rel=\"nofollow noreferrer\">Active Record .joins Documentation</a></p>\n"}, {"comments": [{"owner": {"reputation": 75558, "user_id": 544825, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/UFdOO.png?s=128&g=1", "display_name": "max", "link": "https://stackoverflow.com/users/544825/max"}, "edited": false, "score": 0, "creation_date": 1540813357, "post_id": 53044673, "comment_id": 92988761, "body": "There are plenty of other problems with the code in the question. <code>@items = Cart.includes(:items).where(user_id: current_user.id)</code> will return carts - not items."}], "tags": [], "owner": {"reputation": 75558, "user_id": 544825, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/UFdOO.png?s=128&g=1", "display_name": "max", "link": "https://stackoverflow.com/users/544825/max"}, "is_accepted": true, "score": 3, "last_activity_date": 1540813285, "last_edit_date": 1540813285, "creation_date": 1540812863, "answer_id": 53044673, "question_id": 53043796, "link": "https://stackoverflow.com/questions/53043796/issues-with-rails-models-associations/53044673#53044673", "title": "Issues with Rails models associations", "body": "<p>You have the assocations backwards. To setup a one-to-many association between carts and items you need to place the foreign key on items table - not carts as that would only allow a 1-1 assocation. <code>references</code> just creates a integer column that can hold a single id.</p>\n\n<p><a href=\"https://i.stack.imgur.com/csfRd.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/csfRd.png\" alt=\"Db design sketch\"></a></p>\n\n<p>You can create the correct migrations with <code>rails g model cart user:references</code> and <code>rails g model item cart:references</code>. If simply rolling back and doing it over is not an option then you need to write migrations to add <code>cart_id</code> to the <code>items</code> table and to remove <code>items_id</code> from the <code>carts</code> table.</p>\n\n<pre><code>class Cart &lt; ApplicationRecord\n  belongs_to :user\n  has_many :items # references items.cart_id\nend\n\nclass Item &lt; ApplicationRecord\n  belongs_to :cart # items.cart_id\nend\n\nclass User\n  has_many :carts\n  has_many :items, through: :carts\nend\n</code></pre>\n\n<p>Although to create a typical web shop you want three tables:</p>\n\n<p><a href=\"https://i.stack.imgur.com/XeuQI.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/XeuQI.png\" alt=\"Typical web shop db schema\"></a></p>\n\n<pre><code>class Cart &lt; ApplicationController\n  has_many :line_items\n  has_many :products, though: :line_items\nend\n\nclass LineItem &lt; ApplicationController\n  belongs_to :cart\n  belongs_to :product\nend\n\nclass Product &lt; ApplicationController\n  has_many :line_items\n  has_many :carts, though: :line_items\nend\n</code></pre>\n"}], "owner": {"reputation": 437, "user_id": 4520527, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/0jYao.png?s=128&g=1", "display_name": "dealwap", "link": "https://stackoverflow.com/users/4520527/dealwap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 53044673, "answer_count": 2, "score": 0, "last_activity_date": 1540813285, "creation_date": 1540809849, "question_id": 53043796, "link": "https://stackoverflow.com/questions/53043796/issues-with-rails-models-associations", "title": "Issues with Rails models associations", "body": "<p>I have a cart and items table associated to themselves but when I query the cart table and includes the Items table. It is querying the items table with the cart id instead of the items_id.</p>\n\n<p>Below is my code:</p>\n\n<p>Migration:</p>\n\n<pre><code>class Carts &lt; ActiveRecord::Migration[5.1]\n  def change\n    create_table :carts do |t|\n      t.references :user, foreign_key: true\n   t.references :items, foreign_key: true,\n     t.timestamps\n   end\n  end\nend\n</code></pre>\n\n<p>Model:</p>\n\n<pre><code>class Cart &lt; ApplicationRecord\n  belongs_to :user\n has_many :items, :foreign_key =&gt; \"id\"\nend\n</code></pre>\n\n<p>controller:</p>\n\n<pre><code>def index\n        @items = Cart.includes(:items).where(user_id: current_user.id)\nend\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby"], "answers": [{"comments": [{"owner": {"reputation": 601, "user_id": 9315566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-pnkVEz0JwTw/AAAAAAAAAAI/AAAAAAAAASo/NlxvDhY5hi0/photo.jpg?sz=128", "display_name": "Shun Yamada", "link": "https://stackoverflow.com/users/9315566/shun-yamada"}, "edited": false, "score": 0, "creation_date": 1540806862, "post_id": 53042598, "comment_id": 92985031, "body": "Thanks so much, I have realized that"}, {"owner": {"reputation": 6207, "user_id": 5117953, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/Ca0RW.jpg?s=128&g=1", "display_name": "Vishal", "link": "https://stackoverflow.com/users/5117953/vishal"}, "reply_to_user": {"reputation": 601, "user_id": 9315566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-pnkVEz0JwTw/AAAAAAAAAAI/AAAAAAAAASo/NlxvDhY5hi0/photo.jpg?sz=128", "display_name": "Shun Yamada", "link": "https://stackoverflow.com/users/9315566/shun-yamada"}, "edited": false, "score": 1, "creation_date": 1540806932, "post_id": 53042598, "comment_id": 92985081, "body": "The best way to say thank you is upvote and accept the answer :)"}, {"owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "edited": false, "score": 1, "creation_date": 1540807636, "post_id": 53042598, "comment_id": 92985514, "body": "There is still one issue in the answer. You shouldn&#39;t order by <code>&#39;COUNT(items.id) DESC&#39;</code> since the lowest count is always going to be 1, instead order by <code>&#39;COUNT(votes.id) DESC&#39;</code>. If an item doesn&#39;t have any votes this value will be 0 whereas the first variant would result in value 1."}, {"owner": {"reputation": 13442, "user_id": 3982562, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a3c7aae1d762372cda697833c602ec8?s=128&d=identicon&r=PG", "display_name": "3limin4t0r", "link": "https://stackoverflow.com/users/3982562/3limin4t0r"}, "edited": false, "score": 0, "creation_date": 1540807740, "post_id": 53042598, "comment_id": 92985573, "body": "Further more I don&#39;t like having SQL in my code so I would convert the statement to <code>@article.items.left_joins(:votes).group(:id).order(Vote.arel&zwnj;&#8203;_table[:id].count.de&zwnj;&#8203;sc)</code>"}], "tags": [], "owner": {"reputation": 6207, "user_id": 5117953, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/Ca0RW.jpg?s=128&g=1", "display_name": "Vishal", "link": "https://stackoverflow.com/users/5117953/vishal"}, "is_accepted": false, "score": 2, "last_activity_date": 1540806648, "last_edit_date": 1540806648, "creation_date": 1540805965, "answer_id": 53042598, "question_id": 53042544, "link": "https://stackoverflow.com/questions/53042544/rails-how-to-count-model-with-0/53042598#53042598", "title": "Rails: How to count model with 0", "body": "<p>You need to do a LEFT OUTER JOIN instead of an INNER JOIN, </p>\n\n<p>In rails 5 and greater than 5 version</p>\n\n<pre><code>def show\n    @item = @article.items.left_outer_joins(:votes).group('items.id').order('COUNT(items.id) DESC')\nend\n</code></pre>\n\n<p>In rails 4</p>\n\n<pre><code>def show\n    @item = @article.items.joins(\"LEFT OUTER JOIN votes ON items.id = votes.item_id\").group('items.id').order('COUNT(items.id) DESC')\nend\n</code></pre>\n"}], "owner": {"reputation": 601, "user_id": 9315566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-pnkVEz0JwTw/AAAAAAAAAAI/AAAAAAAAASo/NlxvDhY5hi0/photo.jpg?sz=128", "display_name": "Shun Yamada", "link": "https://stackoverflow.com/users/9315566/shun-yamada"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1540806648, "creation_date": 1540805792, "question_id": 53042544, "link": "https://stackoverflow.com/questions/53042544/rails-how-to-count-model-with-0", "title": "Rails: How to count model with 0", "body": "<p>I want to get data which has 0 votes. However when using this code, that shows only items which has more than 1 votes. Let me know how to get result which includes items has 0 votes.</p>\n\n<pre><code>def show\n    @item = @article.items.joins(:votes).group('items.id').order('COUNT(items.id) DESC')\nend\n</code></pre>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1540805938, "post_id": 53042094, "comment_id": 92984490, "body": "I don&#39;t understand your question. First you ask &quot;How to override the <code>[]=</code> method?&quot;, but you already know the answer - you&#39;ve done it in the code sample. Then to talk about instantiating a new class instance... What does this mean, exactly? Can you provide an example of where you are creating a new instance, and explain what behaviour you&#39;d like/expect? And then you talk about &quot;replacing the value of <code>self</code>&quot;... For a start, that&#39;s not possible (an object cannot change which object it is!) - but again, I don&#39;t really know what you mean since there&#39;s no code sample or explanation."}, {"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 3, "creation_date": 1540806031, "post_id": 53042094, "comment_id": 92984554, "body": "Perhaps it would be more helpful if you were to explain what it is you&#39;re <i>trying to achieve</i>, not <i>how you&#39;re trying to do it</i>. This question seems like a probable <a href=\"https://meta.stackexchange.com/q/66377/369864\">XY problem</a> to me - it seems you&#39;re stuck with an unusual implementation, which could possibly be solved in a much simpler way."}], "answers": [{"comments": [{"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 1, "creation_date": 1540812200, "post_id": 53043453, "comment_id": 92988142, "body": "...Or perhaps it would be more practical to use ruby&#39;s standard library <a href=\"https://ruby-doc.org/stdlib/libdoc/matrix/rdoc/Matrix.html\" rel=\"nofollow noreferrer\"><code>Matrix</code></a> implementation? It all depends what was trying to be achieved in the first place."}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "reply_to_user": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1540831692, "post_id": 53043453, "comment_id": 93000075, "body": "@TomLord although <code>Matrix</code> is tailored towards mathematical matrices, not two-dimensional arrays (or arrays of arrays) in general."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "reply_to_user": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 1, "creation_date": 1540835375, "post_id": 53043453, "comment_id": 93001824, "body": "Excellent answer! @Tom, the fact that matrix objects are immutable may be another limitation."}], "tags": [], "owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "is_accepted": false, "score": 3, "last_activity_date": 1540808775, "creation_date": 1540808775, "answer_id": 53043453, "question_id": 53042094, "link": "https://stackoverflow.com/questions/53042094/override-method-in-ruby-array/53043453#53043453", "title": "Override `[]=` method in ruby array", "body": "<p>You don't need an <code>@array</code> instance variable when subclassing <code>Array</code>  \u2013 each instance already <em>is</em> an array.</p>\n\n<p>Assuming that you are trying to implement a two-dimensional array on top of the build-in (one-dimensional) <code>Array</code>, something like this should work:</p>\n\n<pre><code>class CustomArray &lt; Array\n  def initialize(rows, cols)\n    @rows = rows\n    @cols = cols\n    super(rows * cols)\n  end\n\n  def []=(row, col, value)\n    super(row * @rows + col, value)\n  end\n\n  def [](row, col)\n    super(row * @rows + col)\n  end\nend\n</code></pre>\n\n<p>However, Ruby's core classes are heavily optimized and subclassing them can be quite tricky (see <a href=\"https://words.steveklabnik.com/beware-subclassing-ruby-core-classes\" rel=\"nofollow noreferrer\">https://words.steveklabnik.com/beware-subclassing-ruby-core-classes</a>).</p>\n\n<p>Therefore, it's usually easier to use composition instead of inheritance, i.e. do use an <code>@array</code> instance variable, but don't inherit from <code>Array</code>, e.g.:</p>\n\n<pre><code>class CustomArray\n  def initialize(rows, cols)\n    @rows = rows\n    @cols = cols\n    @array = Array.new(rows * cols)\n  end\n\n  def []=(row, col, value)\n    @array[row * @rows + col] = value\n  end\n\n  def [](row, col)\n    @array[row * @rows + col]\n  end\nend\n</code></pre>\n"}], "owner": {"reputation": 1922, "user_id": 4934984, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/8c959e6ff4a1b49733025dfa53bafcb6?s=128&d=identicon&r=PG", "display_name": "Tushortz", "link": "https://stackoverflow.com/users/4934984/tushortz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1540881581, "creation_date": 1540804210, "last_edit_date": 1540881581, "question_id": 53042094, "link": "https://stackoverflow.com/questions/53042094/override-method-in-ruby-array", "title": "Override `[]=` method in ruby array", "body": "<p>I have a class <code>CustomArray</code>:</p>\n\n<pre><code>class CustomArray &lt; Array\n  def initialize(row, col)\n    @row = row\n    @col = col\n    @array ||= Array.new(size=row * col)\n  end\nend\n</code></pre>\n\n<p>How can I override the <code>[]=</code> method of <code>CustomArray</code>? I did:</p>\n\n<pre><code>class CustomArray &lt; Array\n  def []=(length, row, col)\n    puts @array[0], col, row\n  end\nend\n</code></pre>\n\n<p>Regardless of a change I make to <code>@array</code>, the new instantiated array length remains zero.</p>\n\n<p>I tried replacing the value of <code>self</code>, but it looks like <code>self</code> is read only.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "rubygems", "bundle", "bundler"], "comments": [{"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1540806327, "post_id": 53042045, "comment_id": 92984716, "body": "What is the output of <code>which bundler</code>? Is is possible you have another version of the gem being used - e.g. if your <code>$PATH</code> includes a local binstub, or you also have gems installed through <code>rvm</code>, or something like this?"}, {"owner": {"reputation": 1012, "user_id": 10347572, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iottG.jpg?s=128&g=1", "display_name": "escanxr", "link": "https://stackoverflow.com/users/10347572/escanxr"}, "reply_to_user": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1540806881, "post_id": 53042045, "comment_id": 92985050, "body": "Hi @TomLord, <code>which bundler</code> returns <code>&#47;usr&#47;local&#47;bin&#47;bundler</code>. I don&#39;t have <code>rvm</code> or another ruby version manager than <code>chruby</code>, and I didn&#39;t change the <code>$PATH</code>"}, {"owner": {"reputation": 1012, "user_id": 10347572, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iottG.jpg?s=128&g=1", "display_name": "escanxr", "link": "https://stackoverflow.com/users/10347572/escanxr"}, "reply_to_user": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 1, "creation_date": 1540812407, "post_id": 53042045, "comment_id": 92988261, "body": "Well, i removed all ruby versions and chruby and I installed rvm instead. Now it works perfectly. :)"}], "owner": {"reputation": 1012, "user_id": 10347572, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iottG.jpg?s=128&g=1", "display_name": "escanxr", "link": "https://stackoverflow.com/users/10347572/escanxr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2086, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1540804028, "creation_date": 1540804028, "question_id": 53042045, "link": "https://stackoverflow.com/questions/53042045/gem-install-the-wrong-version-of-bundler", "title": "Gem install the wrong version of bundler", "body": "<p>I had a problem with Bundler (<a href=\"https://stackoverflow.com/questions/53012107/bundle-cannot-load-such-file-bundler-1-17-1-exe-bundle\">bundle cannot load such file bundler-1.17.1/exe/bundle</a>), so I removed Bundler then manually removed all bundler directory:</p>\n\n<p><code>gem uninstall bundler -x</code></p>\n\n<p><code>gem cleanup bundler</code></p>\n\n<p>Then removed with <code>rm -rf</code> from:</p>\n\n<p><code>~/.gem/ruby/2.5.1/gems/bundler-1.17.1</code></p>\n\n<p><code>~/.rubies/ruby-2.5.1/lib/ruby/gems/2.5.0/gems/bundler-1.17.1</code></p>\n\n<p>and <code>~/.bundle</code></p>\n\n<p>Now, I would like to reinstall bundler with the default version, 1.17.1.\nSo I tried <code>gem install bundler</code></p>\n\n<pre><code>gem install bundler\nFetching: bundler-1.17.1.gem (100%)\nSuccessfully installed bundler-1.17.1\nParsing documentation for bundler-1.17.1\nInstalling ri documentation for bundler-1.17.1\nDone installing documentation for bundler after 3 seconds\n1 gem installed\n</code></pre>\n\n<p>If I try to execute a bundle command, I get this error:</p>\n\n<pre><code>bundle\nTraceback (most recent call last):\n    1: from /Users/robin/.gem/ruby/2.5.1/bin/bundle:23:in `&lt;main&gt;'\n/Users/robin/.gem/ruby/2.5.1/bin/bundle:23:in `load': cannot load such file -- /Users/robin/.rubies/ruby-2.5.1/lib/ruby/gems/2.5.0/gems/bundler-1.17.1/exe/bundle (LoadError)\n</code></pre>\n\n<p>I can see bundler-1.17.1 in <code>~/.gem/ruby/2.5.1/gems/bundler-1.17.1</code> but not in <code>.rubies/ruby-2.5.1/lib/ruby/gems/2.5.0/gems/bundler-1.17.1</code>. So I have to manually copy the folder:</p>\n\n<p><code>cp -R  ~/.gem/ruby/2.5.1/gems/bundler-1.17.1 ~/.rubies/ruby-2.5.1/lib/ruby/gems/2.5.0/gems/bundler-1.17.1</code></p>\n\n<p>But now, if I try a bundle command, it works but I have this message in first line:</p>\n\n<p><code>Warning: the running version of Bundler (1.16.2) is older than the version that created the lockfile (1.16.6). We suggest you upgrade to the latest version of Bundler by running 'gem install bundler'.</code></p>\n\n<p>I tried to install bundler by <code>gem install bundler -v 1.17.1</code> but I still have the problem.</p>\n\n<p>gem list output:</p>\n\n<pre><code>gem list bundler\n\n*** LOCAL GEMS ***\nbundler (default: 1.17.1)\ncapistrano-bundler (1.4.0, 1.3.0)\n</code></pre>\n\n<p>my config:</p>\n\n<pre><code>macOS 10.13.6\n\nruby -v\nruby 2.5.1p57 (2018-03-29 revision 63029) [x86_64-darwin17]\n\nchruby\n   ruby-2.5.0\n * ruby-2.5.1\n\nrails -v\nRails 5.2.1\n\ngem -v\n2.7.7\n</code></pre>\n\n<p><strong>EDIT:</strong></p>\n\n<p>I forgot to specify than <code>gem pristine bundler</code> doesn't work with bundler:</p>\n\n<pre><code>gem pristine bundler\nRestoring gems to pristine condition...\nSkipped bundler-1.17.1, it is a default gem\n</code></pre>\n\n<p>And if I try to uninstall bundler twice, I get this message:</p>\n\n<pre><code>gem uninstall bundler -x\nERROR:  While executing gem ... (Gem::InstallError)\n    gem \"bundler\" cannot be uninstalled because it is a default gem\n</code></pre>\n\n<p>So i don't know if bundler is really uninstalled the first time.</p>\n"}, {"tags": ["ruby", "ruby-on-rails-4", "rails-administrate", "administrate"], "comments": [{"owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 0, "creation_date": 1540801334, "post_id": 53040173, "comment_id": 92981944, "body": "How are <code>valid_action?</code> and <code>show_action?</code> defined? What is <code>page.resource</code>? Is there a user currently logged in?"}, {"owner": {"reputation": 43, "user_id": 6171605, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/51mKs.jpg?s=128&g=1", "display_name": "rake-write-code", "link": "https://stackoverflow.com/users/6171605/rake-write-code"}, "reply_to_user": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "edited": false, "score": 1, "creation_date": 1540890849, "post_id": 53040173, "comment_id": 93020164, "body": "I found the solution, I had to define a route for my action as suggested <a href=\"https://github.com/thoughtbot/administrate/issues/222\" rel=\"nofollow noreferrer\">here</a>"}], "owner": {"reputation": 43, "user_id": 6171605, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/51mKs.jpg?s=128&g=1", "display_name": "rake-write-code", "link": "https://stackoverflow.com/users/6171605/rake-write-code"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 406, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1540795855, "creation_date": 1540795855, "question_id": 53040173, "link": "https://stackoverflow.com/questions/53040173/administrate-custom-action-on-show-page", "title": "administrate custom action on show page", "body": "<p>I would like to add a reinvite user button on my users show page.</p>\n\n<p>My reinvite button looks like this:</p>\n\n<pre><code>    def reinvite\n        User.reinvite!\n    end\n</code></pre>\n\n<p>And the button looks like this:</p>\n\n<pre><code>    &lt;%= link_to(\n  \"Reinvite User\",\n  [namespace, page.resource],\n  class: \"button\",\n  ) if valid_action?(:reinvite) &amp;&amp; show_action?(:reinvite, \n  page.resource) %&gt;\n</code></pre>\n\n<p>But the button don't render on the show page.</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 143, "user_id": 10573008, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-80rib0nzR_0/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbCz_HIZ5IR0D3555DPEClLqna8tnw/mo/photo.jpg?sz=128", "display_name": "radtemporary", "link": "https://stackoverflow.com/users/10573008/radtemporary"}, "edited": false, "score": 1, "creation_date": 1540791824, "post_id": 53039321, "comment_id": 92978154, "body": "If you&#39;re downvoting a question, at least give a reason for the downvote and suggest improvements."}], "answers": [{"tags": [], "owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "is_accepted": true, "score": 1, "last_activity_date": 1540792420, "creation_date": 1540792420, "answer_id": 53039509, "question_id": 53039321, "link": "https://stackoverflow.com/questions/53039321/passing-rails-requests-through-a-series-of-controllers/53039509#53039509", "title": "Passing rails requests through a series of controllers?", "body": "<p>This sounds like a perfect example in which one or multiple <code>before_action</code> can be used. You can place a <code>before_action</code> in your <code>ApplicationController</code>:</p>\n\n<pre><code># in app/controllers/application_controller.rb\nprivate\ndef authorize_admin\n  render status: 401 unless current_user? &amp;&amp; current_user.admin?\nend\n</code></pre>\n\n<p>Then you can declare in any controller in which you want to run this method before running any action.</p>\n\n<pre><code># in any controller - even the ApplicationController\nbefore_action :authenticate\n</code></pre>\n\n<p>You can configure <code>before_action</code> to only run on certain conditions or with certain actions. Just a have a look at the how to use <a href=\"https://guides.rubyonrails.org/action_controller_overview.html#filters\" rel=\"nofollow noreferrer\">Filters in the Rails Guides</a>.</p>\n"}], "owner": {"reputation": 143, "user_id": 10573008, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-80rib0nzR_0/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbCz_HIZ5IR0D3555DPEClLqna8tnw/mo/photo.jpg?sz=128", "display_name": "radtemporary", "link": "https://stackoverflow.com/users/10573008/radtemporary"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 25, "favorite_count": 0, "accepted_answer_id": 53039509, "answer_count": 1, "score": -1, "last_activity_date": 1540792420, "creation_date": 1540791403, "question_id": 53039321, "link": "https://stackoverflow.com/questions/53039321/passing-rails-requests-through-a-series-of-controllers", "title": "Passing rails requests through a series of controllers?", "body": "<p>The question is generalized but I want to ask about a specific case which I want to solve.</p>\n\n<p>I'm working with a really really smelly code base of e-commerce app and I want to refactor it. I thought I should start with the User authentication.</p>\n\n<h3>Problem</h3>\n\n<p>Before every action in any controller, we check if the user is of a particular type: <code>Guest</code>, <code>Signed-In</code> or <code>Admin</code> and also, if the user is allowed to access this action based on the type. If all the conditions are met, then the action is executed. And this happens in majority of the actions in majority of the controllers.</p>\n\n<h3>My thinking</h3>\n\n<p>I know this code is smelly because checking if the user is of a particular type and (s)he has access to an action is not the action's responsibility.</p>\n\n<h3>My solution which may or may not be possible</h3>\n\n<p>We can make a <code>SessionsController</code> (or some other name) and let it handle the authentication and authorization part. But I want the <code>SessionsController</code> to do its job automatically before every request. <em>i.e.</em> Every request should go through the <code>SessionsController</code> and then this controller will decide whether or not to forward the request to the appropriate controller.</p>\n\n<p>I search Google for this but didn't find anything. So my logical conclusion is that passing a request through a series of controllers might not be possible. But I'm not sure. So if it is possible, guide me how to do it. And if it is not possible, then suggest any other way to do it.</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 2, "creation_date": 1540789190, "post_id": 53038959, "comment_id": 92977494, "body": "No, the shortcut only works for nullary methods (i.e. methods with no arguments). <code>:[]</code> can be called (because <code>e[4]</code> is equivalent to <code>e.[](4)</code>) but there is no way to pass the required parameter using the shortcut."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 1, "creation_date": 1540789569, "post_id": 53038959, "comment_id": 92977571, "body": "This question has been asked many times. I expect someone will find a previous version of it in short order."}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "reply_to_user": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1540791549, "post_id": 53038959, "comment_id": 92978059, "body": "@CarySwoveland <a href=\"https://stackoverflow.com/q/20179636/479863\"><b>ruby using the \u201c&amp;:methodname\u201d shortcut from array.map(&amp;:methodname) for hash key strings rather than methodname</b></a> is sort of partially a duplicate."}], "answers": [{"comments": [{"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 0, "creation_date": 1540791441, "post_id": 53039149, "comment_id": 92978030, "body": "You could replace <code>Index</code> with <code>index = -&gt;(n) { -&gt;(a) { a[n] } }</code> and say <code>array_of_arrays.map(&amp;index[3])</code>."}, {"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "reply_to_user": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 1, "creation_date": 1540791592, "post_id": 53039149, "comment_id": 92978075, "body": "@muistooshort It is too short! :D Great, though it would not work for subsequences (while my <code>&amp;Index[1, 3]</code> works)."}], "tags": [], "owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "is_accepted": false, "score": 4, "last_activity_date": 1540791984, "last_edit_date": 1540791984, "creation_date": 1540790318, "answer_id": 53039149, "question_id": 53038959, "link": "https://stackoverflow.com/questions/53038959/can-you-use-rubys-block-shorthand-to-call-a-method-like-the-array-accessor/53039149#53039149", "title": "Can you use Ruby&#39;s block shorthand to call a method like the array accessor?", "body": "<p>Then again, you can build it. It's not as elegant, but...</p>\n\n<pre><code>class Call\n  def self.[](name, *args)\n    self.new(name, *args)\n  end\n\n  def initialize(name, *args)\n    @proc = Proc.new do |obj|\n      obj.send(name, *args)\n    end\n  end\n\n  def to_proc\n    @proc\n  end\nend\n\nfourth = Call.new(:[], 3)\n[[1,2,3,4,5],[6,7,8,9,10]].map(&amp;fourth)           # =&gt; [4, 9]\n# or equivalently\n[[1,2,3,4,5],[6,7,8,9,10]].map(&amp;Call.new(:[], 3)) # =&gt; [4, 9]\n[[1,2,3,4,5],[6,7,8,9,10]].map(&amp;Call[:[], 3])     # =&gt; [4, 9]\n</code></pre>\n\n<p>If you want to specialise it for indexes, you could even simplify to this:</p>\n\n<pre><code>class Index\n  def self.[](*args)\n    self.new(*args)\n  end\n\n  def initialize(*args)\n    @proc = Proc.new do |obj|\n      obj[*args]\n    end\n  end\n\n  def to_proc\n    @proc\n  end\nend\n\n[[1,2,3,4,5],[6,7,8,9,10]].map(&amp;Index[3])     # =&gt; [4, 9]\n</code></pre>\n\n<p>Or, much shorter, as @muistooshort demonstrated in comments, if you don't want to have a full class dedicated to it:</p>\n\n<pre><code>index = -&gt;(*ns) { -&gt;(a) { a[*ns] } }\n[[1,2,3,4,5],[6,7,8,9,10]].map(&amp;index[3])     # =&gt; [4, 9]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1976, "user_id": 1177200, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/99ddd63eb79f04e76156db21c172c7f1?s=128&d=identicon&r=PG", "display_name": "taylorthurlow", "link": "https://stackoverflow.com/users/1177200/taylorthurlow"}, "edited": false, "score": 0, "creation_date": 1541279075, "post_id": 53039357, "comment_id": 93164173, "body": "I think the spirit of the question was to find a way to do this that is more convenient than <code>.map { |e| e[4] }</code>, but I think this is as close as we&#39;ll get."}], "tags": [], "owner": {"reputation": 9602, "user_id": 3607136, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/NRFso.jpg?s=128&g=1", "display_name": "Gagan Gami", "link": "https://stackoverflow.com/users/3607136/gagan-gami"}, "is_accepted": true, "score": 5, "last_activity_date": 1540874804, "last_edit_date": 1540874804, "creation_date": 1540791548, "answer_id": 53039357, "question_id": 53038959, "link": "https://stackoverflow.com/questions/53038959/can-you-use-rubys-block-shorthand-to-call-a-method-like-the-array-accessor/53039357#53039357", "title": "Can you use Ruby&#39;s block shorthand to call a method like the array accessor?", "body": "<p>you can use <strong><a href=\"https://ruby-doc.org/core-2.2.0/Proc.html\" rel=\"nofollow noreferrer\">Proc</a></strong>:</p>\n\n<pre><code>&gt; a = [[1, 2, 3, 4], [5, 6, 7, 8], [9, 10, 11, 12], [13, 14]]\n&gt; third_elem = Proc.new {|x| x[2]}\n&gt; a.map(&amp;third_elem)\n#&gt; [3, 7, 11, nil] \n</code></pre>\n\n<p><strong>OR</strong></p>\n\n<pre><code>&gt; a.map &amp;-&gt;(s) {s[2]}\n#=&gt; [3, 7, 11, nil] \n</code></pre>\n"}], "owner": {"reputation": 1976, "user_id": 1177200, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/99ddd63eb79f04e76156db21c172c7f1?s=128&d=identicon&r=PG", "display_name": "taylorthurlow", "link": "https://stackoverflow.com/users/1177200/taylorthurlow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 53039357, "answer_count": 2, "score": 0, "last_activity_date": 1540874804, "creation_date": 1540789012, "question_id": 53038959, "link": "https://stackoverflow.com/questions/53038959/can-you-use-rubys-block-shorthand-to-call-a-method-like-the-array-accessor", "title": "Can you use Ruby&#39;s block shorthand to call a method like the array accessor?", "body": "<p>I'm used to being able to shorten</p>\n\n<pre><code>some_array.map { |e| e.to_s }\n</code></pre>\n\n<p>to</p>\n\n<pre><code>some_array.map(&amp;:to_s)\n</code></pre>\n\n<p>Is there a way to shorten</p>\n\n<pre><code>some_array_of_arrays.map { |e| e[4] }\n</code></pre>\n\n<p>similar to</p>\n\n<pre><code>some_array_of_arrays.map(&amp;:[4])\n</code></pre>\n\n<p>Obviously I've tried that last example but it doesn't work. Ideally the solution would be generalized to other 'weirdly formatted' method calls like <code>[]</code>.</p>\n\n<p>I am <strong>not</strong> interested in any Rails/ActiveSupport solution. Plain Ruby only, assuming there is some sort of solution.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-4", "devise", "ruby-on-rails-5"], "answers": [{"comments": [{"owner": {"reputation": 335, "user_id": 7397660, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/41bca4edee3203ddfa4ed21b501e1bbe?s=128&d=identicon&r=PG&f=1", "display_name": "Code father", "link": "https://stackoverflow.com/users/7397660/code-father"}, "edited": false, "score": 0, "creation_date": 1541384941, "post_id": 53039433, "comment_id": 93186175, "body": "Does this work if the domain is .com.au and .com.uk?"}], "tags": [], "owner": {"reputation": 106, "user_id": 6037583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b584584fd12f81a98eb924a1df66bfed?s=128&d=identicon&r=PG&f=1", "display_name": "eurodo061", "link": "https://stackoverflow.com/users/6037583/eurodo061"}, "is_accepted": false, "score": 0, "last_activity_date": 1540791979, "creation_date": 1540791979, "answer_id": 53039433, "question_id": 53038710, "link": "https://stackoverflow.com/questions/53038710/is-there-a-way-to-allow-user-login-through-respective-url-host/53039433#53039433", "title": "Is there a way to allow user login through respective url (host)?", "body": "<p>I think your solution <code>request.protocol + respective_host + member_dashboard</code> should address this problem provided session is set for both of the domains.</p>\n\n<p>Following should do the trick i.e setting session for both domains.</p>\n\n<p>You have to change you session store config in <code>config/initializers/session_store.rb</code> to following</p>\n\n<p><code>\nRails.application.config.session_store :cookie_store, key: '_my_app_session', domain: :all, tld_length: 2\n</code></p>\n\n<p>You can check more options here <a href=\"https://github.com/plataformatec/devise/wiki/How-To:-Use-subdomains\" rel=\"nofollow noreferrer\">https://github.com/plataformatec/devise/wiki/How-To:-Use-subdomains</a>.</p>\n\n<p>Hope it helps!</p>\n"}], "owner": {"reputation": 335, "user_id": 7397660, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/41bca4edee3203ddfa4ed21b501e1bbe?s=128&d=identicon&r=PG&f=1", "display_name": "Code father", "link": "https://stackoverflow.com/users/7397660/code-father"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 38, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1540791979, "creation_date": 1540786953, "question_id": 53038710, "link": "https://stackoverflow.com/questions/53038710/is-there-a-way-to-allow-user-login-through-respective-url-host", "title": "Is there a way to allow user login through respective url (host)?", "body": "<p>I have a situation here. The rails app uses two different url: <a href=\"http://test.com.au\" rel=\"nofollow noreferrer\">http://test.com.au</a> and <a href=\"http://test.co.uk\" rel=\"nofollow noreferrer\">http://test.co.uk</a>. Each user is logged in through respective url. However the controller and form for login is the same.</p>\n\n<p>What's the best way to force user login through respective url? Say if User A is from Australia then when he login through <a href=\"http://test.co.uk\" rel=\"nofollow noreferrer\">http://test.co.uk</a>, then redirect him through <a href=\"http://test.com.au\" rel=\"nofollow noreferrer\">http://test.com.au</a>.</p>\n\n<p>Tried to change redirect path for user after login to</p>\n\n<pre><code>request.protocol + respective_host + member_dashboard\n</code></pre>\n\n<p>However, when Australian user logins through UK site, they are prompt to login through UK site again. Is there a way we could allow Australian user to login through uk site, and then land him to <em><a href=\"http://test.com.au/dashboard\" rel=\"nofollow noreferrer\">http://test.com.au/dashboard</a></em>, without prompting him to login again through au site?</p>\n\n<p>Also, devise is used for authentication.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-3", "heroku", "rubygems"], "comments": [{"owner": {"reputation": 2715, "user_id": 1723857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a484360304f8cd53cdffc60746038d98?s=128&d=identicon&r=PG", "display_name": "kenlukas", "link": "https://stackoverflow.com/users/1723857/kenlukas"}, "edited": false, "score": 0, "creation_date": 1540778669, "post_id": 53037748, "comment_id": 92975649, "body": "We don&#39;t require your entire log file.  Please provide the pertinent section.  Questions seeking debugging help (&quot;why isn&#39;t this code working?&quot;) must include the desired behavior, a specific problem or error and the shortest code necessary to reproduce it in the question itself. Questions without a clear problem statement are not useful to other readers. See: How to create a <a href=\"https://stackoverflow.com/help/mcve\">Minimal, Complete, and Verifiable</a> example"}, {"owner": {"reputation": 1, "user_id": 8755571, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CZtSv.png?s=128&g=1", "display_name": "Ronald Fulton", "link": "https://stackoverflow.com/users/8755571/ronald-fulton"}, "reply_to_user": {"reputation": 2715, "user_id": 1723857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a484360304f8cd53cdffc60746038d98?s=128&d=identicon&r=PG", "display_name": "kenlukas", "link": "https://stackoverflow.com/users/1723857/kenlukas"}, "edited": false, "score": 0, "creation_date": 1540779011, "post_id": 53037748, "comment_id": 92975707, "body": "Well see I don&#39;t know what I should be looking for. I might remove a section of the log that might be causing the issue."}, {"owner": {"reputation": 1, "user_id": 8755571, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CZtSv.png?s=128&g=1", "display_name": "Ronald Fulton", "link": "https://stackoverflow.com/users/8755571/ronald-fulton"}, "reply_to_user": {"reputation": 2715, "user_id": 1723857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a484360304f8cd53cdffc60746038d98?s=128&d=identicon&r=PG", "display_name": "kenlukas", "link": "https://stackoverflow.com/users/1723857/kenlukas"}, "edited": false, "score": 0, "creation_date": 1540779353, "post_id": 53037748, "comment_id": 92975767, "body": "Will the Heroku deployment build logs help any?"}, {"owner": {"reputation": 1479, "user_id": 7265539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31eec411bb48a64b76830217b2d23a89?s=128&d=identicon&r=PG&f=1", "display_name": "mochi", "link": "https://stackoverflow.com/users/7265539/mochi"}, "edited": false, "score": 0, "creation_date": 1540785550, "post_id": 53037748, "comment_id": 92976832, "body": "The logs says <code>Try: gem pristine bootsnap --version 1.3.2</code>"}, {"owner": {"reputation": 1479, "user_id": 7265539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31eec411bb48a64b76830217b2d23a89?s=128&d=identicon&r=PG&f=1", "display_name": "mochi", "link": "https://stackoverflow.com/users/7265539/mochi"}, "edited": false, "score": 0, "creation_date": 1540785591, "post_id": 53037748, "comment_id": 92976843, "body": "Try running that on your local machine and update your Gemfile.lock. Push the updates and deploy."}, {"owner": {"reputation": 384, "user_id": 5818901, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EBd1k.jpg?s=128&g=1", "display_name": "EUPHORAY", "link": "https://stackoverflow.com/users/5818901/euphoray"}, "edited": false, "score": 0, "creation_date": 1540810476, "post_id": 53037748, "comment_id": 92987163, "body": "the cause might be you did not include <code>nokogiri</code> in your Gemfile, please check this and try <code>gem install nokogiri -v 1.8.5</code> in your local machine."}], "answers": [{"tags": [], "owner": {"reputation": 3746, "user_id": 134788, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/e8424594187a3e0eb125f6e0a62a2999?s=128&d=identicon&r=PG", "display_name": "Ayrad", "link": "https://stackoverflow.com/users/134788/ayrad"}, "is_accepted": false, "score": 0, "last_activity_date": 1540867354, "creation_date": 1540867354, "answer_id": 53056641, "question_id": 53037748, "link": "https://stackoverflow.com/questions/53037748/ruby-on-rails-heroku-deployment-issue/53056641#53056641", "title": "Ruby on rails Heroku deployment issue", "body": "<p>go to the folder where your app exists then do the following:</p>\n\n<pre><code>gem pristine bootsnap --version 1.3.2\nbundle install \n</code></pre>\n\n<p>then try pushing to heroku again</p>\n"}], "owner": {"reputation": 1, "user_id": 8755571, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CZtSv.png?s=128&g=1", "display_name": "Ronald Fulton", "link": "https://stackoverflow.com/users/8755571/ronald-fulton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 105, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1540867354, "creation_date": 1540777872, "last_edit_date": 1540792171, "question_id": 53037748, "link": "https://stackoverflow.com/questions/53037748/ruby-on-rails-heroku-deployment-issue", "title": "Ruby on rails Heroku deployment issue", "body": "<p>I am completely new to ruby on rails and heroku. I deployed my first ruby on rails app to heroku and when I go to the website it says Application error.</p>\n\n<p><strong>Heroku Logs:</strong></p>\n\n<pre><code>2018-10-29T00:40:38.462970+00:00 heroku[web.1]: State changed from crashed to starting\n2018-10-29T00:40:43.768770+00:00 heroku[web.1]: Starting process with command `bin/rails server -p 43245 -e production`\n2018-10-29T00:40:47.367294+00:00 app[web.1]: Ignoring bootsnap-1.3.2 because its extensions are not built. Try: gem pristine bootsnap --version 1.3.2\n2018-10-29T00:40:47.927710+00:00 app[web.1]: /app/vendor/bundle/ruby/2.5.0/gems/bundler-1.15.2/lib/bundler/spec_set.rb:87:in `block in materialize': Could not find nokogiri-1.8.5 in any of the sources (Bundler::GemNotFound)\n2018-10-29T00:40:47.927736+00:00 app[web.1]: from /app/vendor/bundle/ruby/2.5.0/gems/bundler-1.15.2/lib/bundler/spec_set.rb:81:in `map!'\n2018-10-29T00:40:47.927740+00:00 app[web.1]: from /app/vendor/bundle/ruby/2.5.0/gems/bundler-1.15.2/lib/bundler/spec_set.rb:81:in `materialize'\n2018-10-29T00:40:47.927742+00:00 app[web.1]: from /app/vendor/bundle/ruby/2.5.0/gems/bundler-1.15.2/lib/bundler/definition.rb:159:in `specs'\n2018-10-29T00:40:47.927744+00:00 app[web.1]: from /app/vendor/bundle/ruby/2.5.0/gems/bundler-1.15.2/lib/bundler/definition.rb:218:in `specs_for'\n2018-10-29T00:40:47.927745+00:00 app[web.1]: from /app/vendor/bundle/ruby/2.5.0/gems/bundler-1.15.2/lib/bundler/definition.rb:207:in `requested_specs'\n2018-10-29T00:40:47.927748+00:00 app[web.1]: from /app/vendor/bundle/ruby/2.5.0/gems/bundler-1.15.2/lib/bundler/runtime.rb:109:in `block in definition_method'\n2018-10-29T00:40:47.927750+00:00 app[web.1]: from /app/vendor/bundle/ruby/2.5.0/gems/bundler-1.15.2/lib/bundler/runtime.rb:21:in `setup'\n2018-10-29T00:40:47.927752+00:00 app[web.1]: from /app/vendor/bundle/ruby/2.5.0/gems/bundler-1.15.2/lib/bundler.rb:101:in `setup'\n2018-10-29T00:40:47.927753+00:00 app[web.1]: from /app/vendor/bundle/ruby/2.5.0/gems/bundler-1.15.2/lib/bundler/setup.rb:19:in `&lt;top (required)&gt;'\n2018-10-29T00:40:47.927756+00:00 app[web.1]: from /usr/lib/ruby/2.5.0/rubygems/core_ext/kernel_require.rb:135:in `require'\n2018-10-29T00:40:47.927758+00:00 app[web.1]: from /usr/lib/ruby/2.5.0/rubygems/core_ext/kernel_require.rb:135:in `rescue in require'\n2018-10-29T00:40:47.927759+00:00 app[web.1]: from /usr/lib/ruby/2.5.0/rubygems/core_ext/kernel_require.rb:39:in `require'\n2018-10-29T00:40:47.927762+00:00 app[web.1]: from /app/config/boot.rb:3:in `&lt;top (required)&gt;'\n2018-10-29T00:40:47.927764+00:00 app[web.1]: from bin/rails:3:in `require_relative'\n2018-10-29T00:40:47.927767+00:00 app[web.1]: from bin/rails:3:in `&lt;main&gt;'\n2018-10-29T00:40:48.028594+00:00 heroku[web.1]: State changed from starting to crashed\n2018-10-29T00:40:48.011732+00:00 heroku[web.1]: Process exited with status 1\n</code></pre>\n"}]