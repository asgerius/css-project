[{"tags": ["ruby"], "comments": [{"owner": {"reputation": 73209, "user_id": 290394, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d7908f05c89e965f6bc5308ad6f41256?s=128&d=identicon&r=PG", "display_name": "steenslag", "link": "https://stackoverflow.com/users/290394/steenslag"}, "edited": false, "score": 0, "creation_date": 1557360837, "post_id": 56050425, "comment_id": 98742344, "body": "Hashes are fast and efficient in looking up keys and delivering their values. The other way around: not so much."}], "answers": [{"comments": [{"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1557383886, "post_id": 56050462, "comment_id": 98747827, "body": "I suggest you only give the &quot;You can improve this...&quot; solution because obviously the given distance is not necessarily equal to one of the breakpoints. It could be <code>158</code> or possibly <code>158.72</code>, for example. In your hash <code>laser_types</code> I suggest you 1) use three dots for the ranges; 2) make one of the pairs <code>blaster: 200..Float::INFINITY</code>; and 3) add laser/range pairs to cover <code>0..Float::INFINITY</code>. There are now gaps between <code>170</code> and <code>190</code> and between <code>50</code> and <code>70</code>. You also need to tack <code>.first</code> onto the end of <code>laser_types.select {...}</code>."}, {"owner": {"reputation": 67463, "user_id": 203130, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/1RE8c.jpg?s=128&g=1", "display_name": "coreyward", "link": "https://stackoverflow.com/users/203130/coreyward"}, "reply_to_user": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1557419945, "post_id": 56050462, "comment_id": 98767931, "body": "@CarySwoveland I only provided the example values in the ranges as an example. I have no knowledge of the domain space and couldn&#39;t possibly suggest that any particular \u201claser type\u201d is suitable for infinite-distance, and I don&#39;t see any reason to complicate matters with it."}], "tags": [], "owner": {"reputation": 67463, "user_id": 203130, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/1RE8c.jpg?s=128&g=1", "display_name": "coreyward", "link": "https://stackoverflow.com/users/203130/coreyward"}, "is_accepted": true, "score": 1, "last_activity_date": 1557360320, "last_edit_date": 1557360320, "creation_date": 1557359990, "answer_id": 56050462, "question_id": 56050425, "link": "https://stackoverflow.com/questions/56050425/how-to-create-a-each-loop-to-grab-a-key-and-value-from-a-hash-based-on-user-inp/56050462#56050462", "title": "How to create a .each loop to grab a key and value from a hash based on user input?", "body": "<p>You can use <code>find</code>:</p>\n\n<pre><code>answer = 120\nlaser = laserType.find { |type, distance| distance == answer }\n# =&gt; [:xenon_ion, 120]\n\nputs \"Try using a #{laser.first.to_s.tr(\"_\", \" \")} laser.\"\n</code></pre>\n\n<p>If you want to match multiple lasers, instead of <code>find</code> you would use <code>select</code>, which will return an array of all of the matching values:</p>\n\n<pre><code>matches = laserType.select { |_, distance| distance == answer }\nputs \"Try using one of these: \" + matches.map { |type, _| type.to_s.tr(\"_\", \" \") }.join(\", \")\n</code></pre>\n\n<p>You can improve this by using a range (<code>10..15</code>) to allow for a range of distances:</p>\n\n<pre><code>laser_types = {\n  blaster: 190..210,\n  helium_neon: 170..190,\n  free_electron: 70..150,\n  nitrogen: 0..50,\n}\n\nlaser_types.select { |_, range| range.cover?(answer) }\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 67463, "user_id": 203130, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/1RE8c.jpg?s=128&g=1", "display_name": "coreyward", "link": "https://stackoverflow.com/users/203130/coreyward"}, "edited": false, "score": 1, "creation_date": 1557373099, "post_id": 56050827, "comment_id": 98744659, "body": "You&#39;re working really hard to justify the array here (e.g. non-guaranteed insertion order in a 12-year-old version of Ruby) when the <code>MIN_DISTANCE_BY_LASER</code> could be a hash in the format provided by the original question and the method you defined would still work the same because hashes are enumerable too."}], "tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": false, "score": -1, "last_activity_date": 1557383059, "last_edit_date": 1557383059, "creation_date": 1557363705, "answer_id": 56050827, "question_id": 56050425, "link": "https://stackoverflow.com/questions/56050425/how-to-create-a-each-loop-to-grab-a-key-and-value-from-a-hash-based-on-user-inp/56050827#56050827", "title": "How to create a .each loop to grab a key and value from a hash based on user input?", "body": "<p>I presume the mapping of distances to lasers is data, as opposed to a hash computed in the programme. If so, it makes sense to make it a constant:</p>\n\n<pre><code>MIN_DISTANCE_BY_LASER = {\n  blaster:         200,\n  helium_neon:     180,\n  nuclear_pumped:  175,\n  krypton:         170,\n  co2:             160,\n  coil:            150,\n  strontium_vapor: 140,\n  ruby:            130,\n  xenon_ion:       120,\n  free_electron:   110,\n  gas_dynamic:      95,\n  nitrogen:          0\n} \n</code></pre>\n\n<p>We can write a method to return the desired laser as follows:</p>\n\n<pre><code>def laser_by_distance(distance)\n  MIN_DISTANCE_BY_LASER.find { |_,d| distance &gt; d }.first\nend\n</code></pre>\n\n<h1><p></p></h1>\n\n<pre><code>laser_by_distance(43)  #=&gt; :nitrogen \nlaser_by_distance(95)  #=&gt; :nitrogen \nlaser_by_distance(126) #=&gt; :xenon_ion \nlaser_by_distance(154) #=&gt; :coil \nlaser_by_distance(170) #=&gt; :co2 \nlaser_by_distance(200) #=&gt; :helium_neon \nlaser_by_distance(230) #=&gt; :blaster \n</code></pre>\n\n<p>Interestingly, this same approach can be used for generating random variates from a discrete probability distribution function.</p>\n\n<p>If speed is of the essence (not so much in this problem but for problems where the number of elements [pairs] in the array is relative large), one can exploit the fact that all distances in <code>MIN_DISTANCE_BY_LASER</code> are multiples of <code>5</code>. The idea is avoid a linear search through the hash to find the desired laser for a given distance, but instead to obtain the laser by computing, from the distance, an offset into an array of lasers.</p>\n\n<pre><code>arr = MIN_DISTANCE_BY_LASER.to_a.reverse\n  #=&gt; [[:nitrogen, 0],[:gas_dynamic, 95], [:free_electron, 110],\n  #    [:xenon_ion, 120], [:ruby, 130], [:strontium_vapor, 140],\n  #    [:coil, 150], [:co2, 160], [:krypton, 170],\n  #    [:nuclear_pumped, 175], [:helium_neon, 180], [:blaster, 200]]\nLASER_BY_INTERVAL = (1..arr.size-2).    \n  flat_map { |i| [arr[i][0]] * ((arr[i+1][1] - arr[i][1])/5) }\n  #=&gt; [:gas_dynamic, :gas_dynamic, :gas_dynamic,\n  #    :free_electron, :free_electron,\n  #    :xenon_ion, :xenon_ion,\n  #    :ruby, :ruby,\n  #    :strontium_vapor, :strontium_vapor,\n  #    :coil, :coil,\n  #    :co2, :co2,\n  #    :krypton,\n  #    :nuclear_pumped,\n  #    :helium_neon, :helium_neon, :helium_neon, :helium_neon]       \nMIN_DST = arr[1][1] #=&gt; 95\nMIN_LSR = arr[0][0] #=&gt; :nitrogen\nMAX_LSR, MAX_DST = arr[-1]\n  #=&gt; [:blaster, 200]\n</code></pre>\n\n<p>We may now write the method.</p>\n\n<pre><code>def laser_by_distance(dst)\n  case\n  when dst &lt;= MIN_DST\n    MIN_LSR\n  when dst &gt; MAX_DST\n    MAX_LSR\n  else\n    LASER_BY_INTERVAL[(dst-MIN_DST).fdiv(5).ceil - 1]\n  end\nend\n</code></pre>\n\n<h1><p></p></h1>\n\n<pre><code>laser_by_distance(43)  #=&gt; :nitrogen \nlaser_by_distance(95)  #=&gt; :nitrogen \nlaser_by_distance(126) #=&gt; :xenon_ion \nlaser_by_distance(154) #=&gt; :coil \nlaser_by_distance(170) #=&gt; :co2 \nlaser_by_distance(200) #=&gt; :helium_neon \nlaser_by_distance(230) #=&gt; :blaster \n</code></pre>\n\n<p><sup>1. In the OP's hash, <code>:nuclear_pumped</code> and <code>:krypton</code> both had values of <code>170</code>. That's problematic. If, for example, the distance were <code>169</code> it's not clear which of the two lasers should be used. It make sense that every laser has a unique value. I've therefore changed <code>:nuclear_pumped</code> to <code>175</code>.</sup></p>\n"}, {"tags": [], "owner": {"reputation": 7994, "user_id": 1625339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b8ba46f911517c8b2ccc39e0be9050c0?s=128&d=identicon&r=PG", "display_name": "Aetherus", "link": "https://stackoverflow.com/users/1625339/aetherus"}, "is_accepted": false, "score": 0, "last_activity_date": 1557388625, "creation_date": 1557388625, "answer_id": 56054734, "question_id": 56050425, "link": "https://stackoverflow.com/questions/56050425/how-to-create-a-each-loop-to-grab-a-key-and-value-from-a-hash-based-on-user-inp/56054734#56054734", "title": "How to create a .each loop to grab a key and value from a hash based on user input?", "body": "<p>If you want to find a laser whose maximum range is closest to the user input but not less than that, then</p>\n\n<pre><code>laser_name = laser_types.each.lazy\n  .select{|name, range| range &gt;= answer}\n  .min_by{|name, range| range}[0]\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 10704123, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-70vqOM2kQwE/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-iWeqCc1cD7b87_ELCuJchC1rbZGQ/mo/photo.jpg?sz=128", "display_name": "DCorp", "link": "https://stackoverflow.com/users/10704123/dcorp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 56050462, "answer_count": 3, "score": 0, "last_activity_date": 1557388625, "creation_date": 1557359643, "question_id": 56050425, "link": "https://stackoverflow.com/questions/56050425/how-to-create-a-each-loop-to-grab-a-key-and-value-from-a-hash-based-on-user-inp", "title": "How to create a .each loop to grab a key and value from a hash based on user input?", "body": "<p>I created a hash of different types of lasers to use based on the distance of an object. I am looking to ask the user how far from the desired object they are and then give them the laser that they should use based on the user input.</p>\n\n<p>I'm trying to implement a .each method so that I can iterate through the hash and find out where in the hash the user input should lie but I am struggling on implementing that concept into code. Bonus if you could teach me to implement my answer using .gsub(\"_\", \" \")</p>\n\n<pre><code>laserType = {\n  blaster: 200,\n  helium_neon: 180,\n  nuclear_pumped: 170,\n  krypton: 170,\n  co2: 160,\n  coil: 150,\n  strontium_vapor: 140,\n  ruby: 130,\n  xenon_ion: 120,\n  free_electron: 110,\n  gas_dynamic: 95,\n  nitrogen: 0\n}\n\nsortedLasers = laserType.sort_by { |name, range| range }\n\n\nputs \"How far away from the object are you?\"\nanswer = gets.chomp\n\nsortedLasers.each {|name, range| puts \"#{key} is #{value}\"};\n</code></pre>\n\n<p>EX: </p>\n\n<p>\"How far from the object are you?\"</p>\n\n<p>\"165\"</p>\n\n<p>\"You should use the co2 laser!\"</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 24560, "user_id": 4880924, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d40e83be235d4f70428da0d42e12d427?s=128&d=identicon&r=PG&f=1", "display_name": "BKSpurgeon", "link": "https://stackoverflow.com/users/4880924/bkspurgeon"}, "edited": false, "score": 0, "creation_date": 1557360636, "post_id": 56050345, "comment_id": 98742305, "body": "try using <code>@post.user_id = current_user.id</code> - get rid of the <code>@</code> symbol. likely current_user is a helper method and you have likely not initialised the <code>@current_user</code>instance variable."}], "answers": [{"comments": [{"owner": {"reputation": 607, "user_id": 2130145, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fe1fb914161cc2f0edd40eee905b65a8?s=128&d=identicon&r=PG", "display_name": "John Wooten", "link": "https://stackoverflow.com/users/2130145/john-wooten"}, "edited": false, "score": 0, "creation_date": 1557412274, "post_id": 56050529, "comment_id": 98763603, "body": "Apparently Post does not have a field &#39;user_id&#39;.  I added has_many :user to Post and belongs_to :user to User after adding the User through the  devise package.  Do I need to explicitly add a user_id to Post through a migration?"}, {"owner": {"reputation": 24560, "user_id": 4880924, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d40e83be235d4f70428da0d42e12d427?s=128&d=identicon&r=PG&f=1", "display_name": "BKSpurgeon", "link": "https://stackoverflow.com/users/4880924/bkspurgeon"}, "reply_to_user": {"reputation": 607, "user_id": 2130145, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fe1fb914161cc2f0edd40eee905b65a8?s=128&d=identicon&r=PG", "display_name": "John Wooten", "link": "https://stackoverflow.com/users/2130145/john-wooten"}, "edited": false, "score": 0, "creation_date": 1557421239, "post_id": 56050529, "comment_id": 98768509, "body": "@JohnWooten - you will need to do it explicitly: a post must belong to a user. and there must be a user_id column added to the posts table. This can be done with a migration. please paste your model.rb files above and your migration files if you are having further problems with this (but that is a different problem entirely to the original post made - the mods may not like it so you might have to ask a different question.)"}], "tags": [], "owner": {"reputation": 24560, "user_id": 4880924, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d40e83be235d4f70428da0d42e12d427?s=128&d=identicon&r=PG&f=1", "display_name": "BKSpurgeon", "link": "https://stackoverflow.com/users/4880924/bkspurgeon"}, "is_accepted": true, "score": 1, "last_activity_date": 1557360678, "creation_date": 1557360678, "answer_id": 56050529, "question_id": 56050345, "link": "https://stackoverflow.com/questions/56050345/if-the-header-html-erb-shows-the-value-for-current-user-name-why-does-post-co/56050529#56050529", "title": "If the _header.html.erb shows the value for @current_user.name, why does post_controller.rb show it as nil?", "body": "<p>try using <code>@post.user_id = current_user.id</code> - get rid of the @ symbol. likely <code>current_user</code> is a helper method and you have likely not initialised the <code>@current_user</code> instance variable.</p>\n"}], "owner": {"reputation": 607, "user_id": 2130145, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fe1fb914161cc2f0edd40eee905b65a8?s=128&d=identicon&r=PG", "display_name": "John Wooten", "link": "https://stackoverflow.com/users/2130145/john-wooten"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 17, "favorite_count": 0, "accepted_answer_id": 56050529, "answer_count": 1, "score": 1, "last_activity_date": 1557360678, "creation_date": 1557358672, "question_id": 56050345, "link": "https://stackoverflow.com/questions/56050345/if-the-header-html-erb-shows-the-value-for-current-user-name-why-does-post-co", "title": "If the _header.html.erb shows the value for @current_user.name, why does post_controller.rb show it as nil?", "body": "<p>I changed my User class to have_many posts, and posts to belong to :user.\nAfter doing a rails db:reset, and then in posts_controller.rb new method, tried to set</p>\n\n<pre><code>   def new\n    @post = Post.new\n    @post.user_id = @current_user.id\n  end\n</code></pre>\n\n<p>Now, the _header.html.erb fills in the @current_user.name, but in the above new method of the posts_controller.rb, it gives an error that @current_user is nil and the field id is unknown.  How, do I set the user_id for the post?</p>\n"}, {"tags": ["ruby", "bash"], "answers": [{"comments": [{"owner": {"reputation": 15501, "user_id": 664833, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/814bed2c4c2d0e69ec65a28a166c01b7?s=128&d=identicon&r=PG", "display_name": "user664833", "link": "https://stackoverflow.com/users/664833/user664833"}, "edited": false, "score": 1, "creation_date": 1557357751, "post_id": 56050234, "comment_id": 98741781, "body": "you frick&#39;n genius! I hoped, thought, and believed there should be a way!"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 1, "creation_date": 1557435867, "post_id": 56050234, "comment_id": 98774811, "body": "If the results are needed from within a Ruby program: <code>arr = `cat file_a file_b | grep -vFf file_x`.split(&quot;\\n&quot;) #=&gt; [&quot;aaa&quot;, &quot;fff&quot;]</code>. Note that I had to escape the backticks for them to show in this comment."}], "tags": [], "owner": {"reputation": 96909, "user_id": 3030305, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/En2fP.png?s=128&g=1", "display_name": "John1024", "link": "https://stackoverflow.com/users/3030305/john1024"}, "is_accepted": true, "score": 3, "last_activity_date": 1557357759, "last_edit_date": 1557357759, "creation_date": 1557357543, "answer_id": 56050234, "question_id": 56050000, "link": "https://stackoverflow.com/questions/56050000/remove-lines-in-file-from-stream/56050234#56050234", "title": "remove lines in file from stream", "body": "<p>Try:</p>\n\n<pre><code>$ cat file_a file_b | grep -vFf file_x\naaa\nfff\n</code></pre>\n\n<p><code>-v</code> means remove matching lines.</p>\n\n<p><code>-F</code> tells grep to treat the match patterns as fixed strings, not regular expressions.</p>\n\n<p><code>-f file_x</code> tells grep to get the match patterns from the lines of <code>file_x</code>.</p>\n\n<p>Other options that you may want to consider are:</p>\n\n<p><code>-w</code> tells grep to match only complete words.</p>\n\n<p><code>-x</code> tells grep to match only complete lines.</p>\n"}, {"comments": [{"owner": {"reputation": 15501, "user_id": 664833, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/814bed2c4c2d0e69ec65a28a166c01b7?s=128&d=identicon&r=PG", "display_name": "user664833", "link": "https://stackoverflow.com/users/664833/user664833"}, "edited": false, "score": 0, "creation_date": 1557778427, "post_id": 56067048, "comment_id": 98871688, "body": "That is an incredibly fast (highly performant) solution. I am processing relatively large files... tens of thousands of lines each. This Ruby solution (<code>IO.readlines +&#47;-</code>) took less than a second (0.2s), whereas the pipeline-equivalent (<code>| grep -vFf</code>) took more than 5 minutes on the same data. Thank you!"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "reply_to_user": {"reputation": 15501, "user_id": 664833, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/814bed2c4c2d0e69ec65a28a166c01b7?s=128&d=identicon&r=PG", "display_name": "user664833", "link": "https://stackoverflow.com/users/664833/user664833"}, "edited": false, "score": 0, "creation_date": 1557779007, "post_id": 56067048, "comment_id": 98871890, "body": "I am both surprised by your findings and pleased to have  helped."}], "tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": false, "score": 1, "last_activity_date": 1557433539, "creation_date": 1557433539, "answer_id": 56067048, "question_id": 56050000, "link": "https://stackoverflow.com/questions/56050000/remove-lines-in-file-from-stream/56067048#56067048", "title": "remove lines in file from stream", "body": "<pre><code>IO.write('file_a', %w| aaa bbb ccc |.join(\"\\n\"))     #=&gt; 11\nIO.write('file_b', %w| ddd eee fff |.join(\"\\n\"))     #=&gt; 11\nIO.write('file_x', %w| bbb ccc ddd eee |.join(\"\\n\")) #=&gt; 15\n</code></pre>\n\n<p>From Ruby:</p>\n\n<pre><code>IO.readlines('file_a', chomp: true) + IO.readlines('file_b', chomp: true) -\n  IO.readlines('file_x', chomp: true)\n  #=&gt; [\"aaa\", \"fff\"]  \n</code></pre>\n"}], "owner": {"reputation": 15501, "user_id": 664833, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/814bed2c4c2d0e69ec65a28a166c01b7?s=128&d=identicon&r=PG", "display_name": "user664833", "link": "https://stackoverflow.com/users/664833/user664833"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 56050234, "answer_count": 2, "score": 2, "last_activity_date": 1557433539, "creation_date": 1557355522, "question_id": 56050000, "link": "https://stackoverflow.com/questions/56050000/remove-lines-in-file-from-stream", "title": "remove lines in file from stream", "body": "<pre><code>cat file_a\naaa\nbbb\nccc\n\ncat file_b\nddd\neee\nfff\n\ncat file_x\nbbb\nccc\nddd\neee\n</code></pre>\n\n<p>I want to <code>cat file_a file_b | remove_from_stream_what_is_in(file_x)</code></p>\n\n<p>Result:</p>\n\n<pre><code>aaa\nfff\n</code></pre>\n\n<p>If there is no basic filter to do this with, then I wonder if there is a way with <code>ruby -ne '...'</code>.</p>\n"}, {"tags": ["ruby", "sinatra"], "answers": [{"tags": [], "owner": {"reputation": 812, "user_id": 2034213, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a09835300056e6e3f54e25c35e9e89a3?s=128&d=identicon&r=PG", "display_name": "igneus", "link": "https://stackoverflow.com/users/2034213/igneus"}, "is_accepted": true, "score": 1, "last_activity_date": 1557363267, "creation_date": 1557363267, "answer_id": 56050775, "question_id": 56049941, "link": "https://stackoverflow.com/questions/56049941/is-there-a-way-to-use-different-mime-type-in-my-sinatra-app/56050775#56050775", "title": "Is there a way to use different mime type in my sinatra app", "body": "<p>Sinatra doesn't have a built-in concept of a \"request format\", so you have to manually specify a format-aware route pattern which Rails provide you automatically.</p>\n\n<p>Here I use route pattern specified as a Regexp with a named capture:</p>\n\n<pre><code>require 'sinatra'\n\nget /\\/places(\\.(?&lt;format&gt;meta|list))?/ do # named capture 'format'\n  case params['format'] # params populated with named captures from the route pattern\n  when 'list'\n    result = Place.single_list(parameters)\n  when 'meta'\n    result = @parameters.to_meta\n  else\n    result = Place.get_all(parameters)\n  end\n\n  result.to_json # replace with your favourite way of building a Sinatra response\nend\n</code></pre>\n"}], "owner": {"reputation": 119, "user_id": 5691095, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WPcfU.png?s=128&g=1", "display_name": "mariovzc", "link": "https://stackoverflow.com/users/5691095/mariovzc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 56050775, "answer_count": 1, "score": 0, "last_activity_date": 1557363267, "creation_date": 1557355095, "question_id": 56049941, "link": "https://stackoverflow.com/questions/56049941/is-there-a-way-to-use-different-mime-type-in-my-sinatra-app", "title": "Is there a way to use different mime type in my sinatra app", "body": "<p>I am creating my Api in Sinatra but i want for example use this routes:</p>\n\n<p><code>/places</code>\n<code>/places.meta</code>\n<code>/places.list</code>\n<code>/users/id/places.list</code></p>\n\n<p>i have this working in rails but fails in sinatra</p>\n\n<pre><code>  def index\n    case request.format.to_sym.to_s\n    when 'list'\n      result = Place.single_list(parameters)\n    when 'meta'\n      result = @parameters.to_meta\n    else\n      result = Place.get_all(parameters)\n    end\n    render json: result, status: 200\n  end\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "xml", "soap", "savon"], "answers": [{"tags": [], "owner": {"reputation": 88945, "user_id": 290085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/306077a2fb7af6587f470214a1b337ff?s=128&d=identicon&r=PG", "display_name": "kjhughes", "link": "https://stackoverflow.com/users/290085/kjhughes"}, "is_accepted": true, "score": 1, "last_activity_date": 1557355672, "creation_date": 1557355672, "answer_id": 56050016, "question_id": 56049821, "link": "https://stackoverflow.com/questions/56049821/xml-fails-on-x1e-character/56050016#56050016", "title": "XML fails on &amp;#x1E; character", "body": "<p><code>&amp;#x1E;</code> (aka <em>INFORMATION SEPARATOR TWO</em>) is <strong><em>not an <a href=\"https://www.w3.org/TR/xml/#charsets\" rel=\"nofollow noreferrer\">allowed character in XML</a></em></strong> :</p>\n\n<blockquote>\n<pre><code>[2] Char ::= #x9 | #xA | #xD | [#x20-#xD7FF] | [#xE000-#xFFFD] | [#x10000-#x10FFFF]\n</code></pre>\n</blockquote>\n\n<p>Therefore your data is not XML, and any conformant XML processor must report an error such as the one you received.</p>\n\n<p>You must repair the data by removing any illegal characters by treating it as <strong><em>text, not XML,</em></strong> manually or automatically before using it with any XML libraries.</p>\n\n<p>See also <a href=\"https://stackoverflow.com/q/44765194/290085\">How to parse invalid (bad / not well-formed) XML?</a></p>\n"}, {"tags": [], "owner": {"reputation": 1121, "user_id": 808398, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/0101ac76536d2454bb176d70f4e9680c?s=128&d=identicon&r=PG", "display_name": "David Mauricio", "link": "https://stackoverflow.com/users/808398/david-mauricio"}, "is_accepted": false, "score": 0, "last_activity_date": 1557434724, "creation_date": 1557434724, "answer_id": 56067324, "question_id": 56049821, "link": "https://stackoverflow.com/questions/56049821/xml-fails-on-x1e-character/56067324#56067324", "title": "XML fails on &amp;#x1E; character", "body": "<p>My original question was around <a href=\"https://github.com/savonrb/savon\" rel=\"nofollow noreferrer\">Savon ruby gem</a>. I sorted this out by changing the default response parser to <a href=\"http://savonrb.com/version2/locals.html\" rel=\"nofollow noreferrer\">:rexml</a>. It now parses the invalid character and does not raises an exception. </p>\n\n<p><a href=\"https://i.stack.imgur.com/Xsqhd.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Xsqhd.jpg\" alt=\":itssomething:\"></a></p>\n\n<p>But right answer would be to parse the malformed XML or ask the provider to fix it. Thanks @kjhughes </p>\n"}], "owner": {"reputation": 1121, "user_id": 808398, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/0101ac76536d2454bb176d70f4e9680c?s=128&d=identicon&r=PG", "display_name": "David Mauricio", "link": "https://stackoverflow.com/users/808398/david-mauricio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 313, "favorite_count": 0, "accepted_answer_id": 56050016, "answer_count": 2, "score": 1, "last_activity_date": 1557434724, "creation_date": 1557354286, "last_edit_date": 1557357215, "question_id": 56049821, "link": "https://stackoverflow.com/questions/56049821/xml-fails-on-x1e-character", "title": "XML fails on &amp;#x1E; character", "body": "<p>When requesting data from my remote server it responds with a value inside a node with the following token <code>&amp;#x1E;</code>, making the parsing process to fail. I manually removed the guilty string and it started working.</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"\n               xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n               xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"&gt;\n&lt;soap:Body&gt;\n...\n    &lt;sFName&gt;Bradley&lt;/sFName&gt;\n    &lt;sLName&gt;L&amp;#x1E;ibbra&lt;/sLName&gt;\n...\n</code></pre>\n\n<p>Token: <code>&amp;#x1E;</code></p>\n\n<p>The error raised by Savon is: </p>\n\n<blockquote>\n  <p><code>Savon::InvalidResponseError:</code> Unable to parse response body:</p>\n</blockquote>\n"}, {"tags": ["json", "ruby"], "answers": [{"tags": [], "owner": {"reputation": 3902, "user_id": 10608621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d59df09a85d05117c63706f66811b70c?s=128&d=identicon&r=PG", "display_name": "mechnicov", "link": "https://stackoverflow.com/users/10608621/mechnicov"}, "is_accepted": true, "score": 1, "last_activity_date": 1557354811, "creation_date": 1557354811, "answer_id": 56049902, "question_id": 56049644, "link": "https://stackoverflow.com/questions/56049644/ruby-parsing-json-statements-that-use-xab-cd/56049902#56049902", "title": "Ruby: Parsing Json statements that use x[{a:b, c:d}]", "body": "<p>It's array that contains one hash, so you can get it as</p>\n\n<pre><code>data[\"tick\"][\"data\"].first[\"amount\"] # =&gt; 0.2251\n</code></pre>\n"}], "owner": {"reputation": 1927, "user_id": 953419, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/0f79e690bef0b6c98676b5751056e0a1?s=128&d=identicon&r=PG", "display_name": "seamus", "link": "https://stackoverflow.com/users/953419/seamus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 27, "favorite_count": 0, "accepted_answer_id": 56049902, "answer_count": 1, "score": 0, "last_activity_date": 1557354811, "creation_date": 1557353139, "last_edit_date": 1557354722, "question_id": 56049644, "link": "https://stackoverflow.com/questions/56049644/ruby-parsing-json-statements-that-use-xab-cd", "title": "Ruby: Parsing Json statements that use x[{a:b, c:d}]", "body": "<p>I'm parsing a JSON document like</p>\n\n<pre><code>{\n  \"status\": \"ok\",\n  \"tick\": {\n    \"id\": 101006380508,\n    \"data\": [\n      {\n        \"id\": \"10100638050832281590023\",\n        \"amount\": 0.2251,\n      }\n    ]\n  }\n}\n</code></pre>\n\n<p>I am currently doing:</p>\n\n<pre><code>data = JSON.parse(response.read_body)\ndata[\"tick\"][\"data\"][\"amount\"]\n</code></pre>\n\n<p>and getting an error</p>\n\n<blockquote>\n  <p>Error: []': no implicit conversion of String into Integer (TypeError)</p>\n</blockquote>\n\n<p>My objective is the get the <strong>amount</strong></p>\n"}, {"tags": ["ruby-on-rails", "json", "ruby", "net-http"], "owner": {"reputation": 549, "user_id": 766747, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/72c8fba45ca5feb40940a65ed90d2934?s=128&d=identicon&r=PG", "display_name": "bnassler", "link": "https://stackoverflow.com/users/766747/bnassler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 55, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1557352898, "creation_date": 1557352898, "question_id": 56049609, "link": "https://stackoverflow.com/questions/56049609/rails-nethttp-json-encoding-issue", "title": "Rails Net:Http json encoding issue", "body": "<p>I am using an external API I send JSON to. </p>\n\n<p>When I copy the same JSON to Paw (a Postman like tool) it works.</p>\n\n<p>With rails I get a <code>400 bad request</code> error.</p>\n\n<p>I think it is an encoding issue because when I want to parse the 400 response body I need to do</p>\n\n<pre><code>response.body.encode('UTF-8', invalid: :replace, undef: :replace, replace: '?')\n</code></pre>\n\n<p>Then the request and response are:</p>\n\n<p><strong>Request</strong></p>\n\n<pre><code>{\"searchable\":{\"default\":true},\"c_body\":{\"ja-JP\":{\"_type\":\"markup_text\",\"source\":\"&lt;div class=\\\"cms-content-wrapper\\\"&gt;&lt;div class=\\\"cms-page-module\\\" data-template-id=\\\"552100319\\\" data-template-name=\\\"PEP_Features_Carousel\\\" data-page-module-id=\\\"408407719\\\" rank=\\\"cptiuz\\\"&gt;&lt;section class=\\\"sk-component sk-component--pep-feature-slider\\\" data-slider-id=\\\"\\\" id=\\\"\\\"&gt;\\r\\n  &lt;div class=\\\"sk-carousel sk-carousel__emotional sk-carousel-load\\\" data-sk-carousel-limit=\\\"{'large':1, 'medium':1, 'small':1}\\\" data-loop=\\\"true\\\"&gt;\\r\\n\\t&lt;div class=\\\"sk-carousel-inner\\\"&gt;\\r\\n\\t\\t&lt;ul class=\\\"sk-carousel-wrapper\\\" style=\\\"left: -100%; transform:none;\\\"&gt;\\r\\n  \\r\\n          \\r\\n          \\r\\n            &lt;li&gt;\\r\\n              &lt;div class=\\\"sk-carousel__item\\\" data-gallery-item=\\\"\\\"&gt;\\r\\n                &lt;div class=\\\"sk-copy--text-wrapper\\\"&gt;\\r\\n                  &lt;div class=\\\"sk-copy--text\\\"&gt;\\r\\n                  &lt;div class=\\\"sk-pre-header\\\"&gt;&lt;p&gt;\u30b9\u30c8\u30c3\u30b1 \u30a8\u30af\u30b9\u30d7\u30ed\u30fc\u30ea\u30fc\u306e\u4e3b\u306a\u7279\u5fb4&lt;/p&gt;\\n&lt;/div&gt;\\r\\n                  &lt;h3&gt;\u3088\u308a\u8fd1\u304f\u3067\u7d46\u3092\u611f\u3058\u308b&lt;/h3&gt;\\r\\n            \\r\\n                  &lt;div class=\\\"sk-copy--large\\\"&gt;\u516c\u5712\u304b\u3089\u30b3\u30fc\u30d2\u30fc\u30b7\u30e7\u30c3\u30d7\u307e\u3067\u3001\u30a8\u30af\u30b9\u30d7\u30ed\u30fc\u30ea\u30fc\u306f\u304a\u5b50\u3055\u307e\u3068\u89aa\u5fa1\u3055\u307e\u306e\u7d46\u3092\u611f\u3058\u3089\u308c\u308b\u3001\u6700\u9069\u306a\u9ad8\u3055\u306b\u304a\u5b50\u3055\u307e\u306e\u4f4d\u7f6e\u3092\u8abf\u7bc0\u3057\u307e\u3059\u3002&lt;/div&gt;\\r\\n                    \\r\\n                      &lt;div   .........\n</code></pre>\n\n<p><strong>Response Body</strong></p>\n\n<pre><code>{\"_v\":\"19.5\",\"fault\":{\"arguments\":{\"body\":\"{\\\"searchable\\\":{\\\"default\\\":true},\\\"c_body\\\":{\\\"ja-JP\\\":{\\\"_type\\\":\\\"markup_text\\\",\\\"source\\\":\\\"&lt;div class=\\\\\\\"cms-content-wrapper\\\\\\\"&gt;&lt;div class=\\\\\\\"cms-page-module\\\\\\\" data-template-id=\\\\\\\"552100319\\\\\\\" data-template-name=\\\\\\\"PEP_Features_Carousel\\\\\\\" data-page-module-id=\\\\\\\"408407719\\\\\\\" rank=\\\\\\\"cptiuz\\\\\\\"&gt;&lt;section class=\\\\\\\"sk-component sk-component--pep-feature-slider\\\\\\\" data-slider-id=\\\\\\\"\\\\\\\" id=\\\\\\\"\\\\\\\"&gt;\\\\r\\\\n  &lt;div class=\\\\\\\"sk-carousel sk-carousel__emotional sk-carousel-load\\\\\\\" data-sk-carousel-limit=\\\\\\\"{'large':1, 'medium':1, 'small':1}\\\\\\\" data-loop=\\\\\\\"true\\\\\\\"&gt;\\\\r\\\\n\\\\t&lt;div class=\\\\\\\"sk-carousel-inner\\\\\\\"&gt;\\\\r\\\\n\\\\t\\\\t&lt;ul class=\\\\\\\"sk-carousel-wrapper\\\\\\\" style=\\\\\\\"left: -100%; transform:none;\\\\\\\"&gt;\\\\r\\\\n  \\\\r\\\\n          \\\\r\\\\n          \\\\r\\\\n            &lt;li&gt;\\\\r\\\\n              &lt;div class=\\\\\\\"sk-carousel__item\\\\\\\" data-gallery-item=\\\\\\\"\\\\\\\"&gt;\\\\r\\\\n                &lt;div class=\\\\\\\"sk-copy--text-wrapper\\\\\\\"&gt;\\\\r\\\\n                  &lt;div class=\\\\\\\"sk-copy--text\\\\\\\"&gt;\\\\r\\\\n                  &lt;div class=\\\\\\\"sk-pre-header\\\\\\\"&gt;&lt;p&gt;???????????? ???????????????????????????????????????&lt;/p&gt;\\\\n&lt;/div&gt;\\\\r\\\\n                  &lt;h3&gt;?????????????????????\n</code></pre>\n\n<p>When scrolling all the way to the right in the response there are a lot of ??? where Japanese text was. Thats why I assume its an encoding issue. But I cant seem to fix it.</p>\n\n<p>Here is my code:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>def patch_content(content_asset_document, content_asset_id, instance_url)\n  puts :patch_content\n  token = get_token\n  header = {\n    \"Authorization\" =&gt; \"Bearer #{token.access_token}\",\n    \"Content-Type\" =&gt; \"application/json; charset=UTF-8\"\n  }\n  url = \"#{instance_url}/libraries/lib/content/#{content_asset_id}\"\n  uri = URI.parse(url)\n  request = Net::HTTP::Patch.new(uri.request_uri, header)\n  http = Net::HTTP.new(uri.host, uri.port)\n\n  http.use_ssl = true\n  http.ssl_version = :TLSv1_2\n  request.body = content_asset_document.to_json.to_s\n  response = http.request(request)\n  File.open(\"request.txt\", \"w\") { |file| file.puts request.body }\n  yield response.code.to_i, response\nend\n</code></pre>\n"}, {"tags": ["ruby", "ruby-on-rails-3.2", "comparator", "ruby-1.9", "date-comparison"], "comments": [{"owner": {"reputation": 3902, "user_id": 10608621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d59df09a85d05117c63706f66811b70c?s=128&d=identicon&r=PG", "display_name": "mechnicov", "link": "https://stackoverflow.com/users/10608621/mechnicov"}, "edited": false, "score": 0, "creation_date": 1557351347, "post_id": 56049309, "comment_id": 98740154, "body": "How do you compare them? Why is the date required to be older? Please add more details"}, {"owner": {"reputation": 2372, "user_id": 8031815, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-IlIxbbzooGw/AAAAAAAAAAI/AAAAAAAAAE0/9JNBRJDFRnE/photo.jpg?sz=128", "display_name": "Garrett Motzner", "link": "https://stackoverflow.com/users/8031815/garrett-motzner"}, "reply_to_user": {"reputation": 3902, "user_id": 10608621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d59df09a85d05117c63706f66811b70c?s=128&d=identicon&r=PG", "display_name": "mechnicov", "link": "https://stackoverflow.com/users/10608621/mechnicov"}, "edited": false, "score": 0, "creation_date": 1557351558, "post_id": 56049309, "comment_id": 98740218, "body": "Does it matter why the date is required to be older? that&#39;s just what I want to do. :)"}], "answers": [{"comments": [{"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "reply_to_user": {"reputation": 2372, "user_id": 8031815, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-IlIxbbzooGw/AAAAAAAAAAI/AAAAAAAAAE0/9JNBRJDFRnE/photo.jpg?sz=128", "display_name": "Garrett Motzner", "link": "https://stackoverflow.com/users/8031815/garrett-motzner"}, "edited": false, "score": 1, "creation_date": 1557351696, "post_id": 56049408, "comment_id": 98740258, "body": "Long term support for ruby 1.9 ended in February 23, 2015; I wasn&#39;t expecting that as a requirement... If you&#39;re using an ancient ruby version, please include that information upfront."}, {"owner": {"reputation": 2372, "user_id": 8031815, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-IlIxbbzooGw/AAAAAAAAAAI/AAAAAAAAAE0/9JNBRJDFRnE/photo.jpg?sz=128", "display_name": "Garrett Motzner", "link": "https://stackoverflow.com/users/8031815/garrett-motzner"}, "edited": false, "score": 0, "creation_date": 1557351784, "post_id": 56049408, "comment_id": 98740298, "body": "Yeah, noticed that :). Had I been on another project I would have had to sat 1.87... so...."}, {"owner": {"reputation": 2372, "user_id": 8031815, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-IlIxbbzooGw/AAAAAAAAAAI/AAAAAAAAAE0/9JNBRJDFRnE/photo.jpg?sz=128", "display_name": "Garrett Motzner", "link": "https://stackoverflow.com/users/8031815/garrett-motzner"}, "edited": false, "score": 0, "creation_date": 1557351934, "post_id": 56049408, "comment_id": 98740342, "body": "Cool, works with the spaceship operator too. so pretty much perfect if you have a new enough version."}, {"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "reply_to_user": {"reputation": 2372, "user_id": 8031815, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-IlIxbbzooGw/AAAAAAAAAAI/AAAAAAAAAE0/9JNBRJDFRnE/photo.jpg?sz=128", "display_name": "Garrett Motzner", "link": "https://stackoverflow.com/users/8031815/garrett-motzner"}, "edited": false, "score": 0, "creation_date": 1557351990, "post_id": 56049408, "comment_id": 98740364, "body": "When you say &quot;doesn&#39;t work&quot;, what behaviour/error do you get? I don&#39;t have that version installed, so it&#39;s troublesome for me to see what&#39;s wrong."}, {"owner": {"reputation": 2372, "user_id": 8031815, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-IlIxbbzooGw/AAAAAAAAAAI/AAAAAAAAAE0/9JNBRJDFRnE/photo.jpg?sz=128", "display_name": "Garrett Motzner", "link": "https://stackoverflow.com/users/8031815/garrett-motzner"}, "edited": false, "score": 0, "creation_date": 1557352300, "post_id": 56049408, "comment_id": 98740451, "body": "It works with a straight date, but with active_support 3.2.9 you get &quot;DateTime.now &lt; Float::INFINITY #=&gt; NoMethodError: undefined method `to_datetime&#39; for Infinity:Float&quot;"}, {"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "reply_to_user": {"reputation": 2372, "user_id": 8031815, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-IlIxbbzooGw/AAAAAAAAAAI/AAAAAAAAAE0/9JNBRJDFRnE/photo.jpg?sz=128", "display_name": "Garrett Motzner", "link": "https://stackoverflow.com/users/8031815/garrett-motzner"}, "edited": false, "score": 0, "creation_date": 1557352439, "post_id": 56049408, "comment_id": 98740491, "body": "Oh... Jeez... And you <i>also</i> forgot to mention that this is a Rails 3.2 project (with ActiveSupport monkeypatches)? Please try to include <b>all</b> critical information upfront."}, {"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "reply_to_user": {"reputation": 2372, "user_id": 8031815, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-IlIxbbzooGw/AAAAAAAAAAI/AAAAAAAAAE0/9JNBRJDFRnE/photo.jpg?sz=128", "display_name": "Garrett Motzner", "link": "https://stackoverflow.com/users/8031815/garrett-motzner"}, "edited": false, "score": 1, "creation_date": 1557352615, "post_id": 56049408, "comment_id": 98740547, "body": "It&#39;s quite possible, then, that there&#39;s a better solution entirely: If the data is coming from a database, then you can <code>order(&#39;timestamp DESC NULLS LAST&#39;)</code> (or <code>NULLS FIRST</code>)."}, {"owner": {"reputation": 2372, "user_id": 8031815, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-IlIxbbzooGw/AAAAAAAAAAI/AAAAAAAAAE0/9JNBRJDFRnE/photo.jpg?sz=128", "display_name": "Garrett Motzner", "link": "https://stackoverflow.com/users/8031815/garrett-motzner"}, "edited": false, "score": 0, "creation_date": 1557352699, "post_id": 56049408, "comment_id": 98740569, "body": "Ooh, I was not aware of that SQL syntax. Nice. Sadly, not helpful here."}, {"owner": {"reputation": 2372, "user_id": 8031815, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-IlIxbbzooGw/AAAAAAAAAAI/AAAAAAAAAE0/9JNBRJDFRnE/photo.jpg?sz=128", "display_name": "Garrett Motzner", "link": "https://stackoverflow.com/users/8031815/garrett-motzner"}, "edited": false, "score": 0, "creation_date": 1557353176, "post_id": 56049408, "comment_id": 98740689, "body": "Yeah, so I verified it is actually the ActiveSupport monkey patches that break it. Didn&#39;t know that was relevant until I found it was broken."}, {"owner": {"reputation": 2372, "user_id": 8031815, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-IlIxbbzooGw/AAAAAAAAAAI/AAAAAAAAAE0/9JNBRJDFRnE/photo.jpg?sz=128", "display_name": "Garrett Motzner", "link": "https://stackoverflow.com/users/8031815/garrett-motzner"}, "edited": false, "score": 0, "creation_date": 1557353657, "post_id": 56049408, "comment_id": 98740835, "body": "<code>Date::Infinity</code> ftw :). That is what I needed."}, {"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "reply_to_user": {"reputation": 2372, "user_id": 8031815, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-IlIxbbzooGw/AAAAAAAAAAI/AAAAAAAAAE0/9JNBRJDFRnE/photo.jpg?sz=128", "display_name": "Garrett Motzner", "link": "https://stackoverflow.com/users/8031815/garrett-motzner"}, "edited": false, "score": 0, "creation_date": 1557354974, "post_id": 56049408, "comment_id": 98741149, "body": "I guess it&#39;s also worth mentioning that this ActiveSupport method changed several times over the years... You can see the latest, more reliable version (last edited in April 2016) <a href=\"https://github.com/rails/rails/blob/dd868aa0c82ab45d1ca21febf179bb5cd1c21766/activesupport/lib/active_support/core_ext/date_time/calculations.rb#L204-L210\" rel=\"nofollow noreferrer\">here</a>."}], "tags": [], "owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "is_accepted": true, "score": 2, "last_activity_date": 1557354176, "last_edit_date": 1557354176, "creation_date": 1557351561, "answer_id": 56049408, "question_id": 56049309, "link": "https://stackoverflow.com/questions/56049309/ruby-benign-vale-for-nil-datetime/56049408#56049408", "title": "Ruby Benign vale for nil DateTime", "body": "<p>From <a href=\"https://ruby-doc.org/stdlib/libdoc/date/rdoc/Date.html#method-i-3C-3D-3E\" rel=\"nofollow noreferrer\">the docs</a>, the requirement is <em>not</em> that \"all objects are the same type\". It says:</p>\n\n<blockquote>\n  <p>The other should be a date object or a numeric value as an astronomical Julian day number.</p>\n</blockquote>\n\n<p>So for a benign value that is guaranteed to be before/after <em>any</em> date, you could use <code>-Float::INFINITY</code> and <code>Float::INFINITY</code> accordingly.</p>\n\n<pre><code>DateTime.now &gt; Float::INFINITY  #=&gt; false\nDateTime.now &gt; -Float::INFINITY #=&gt; true\n</code></pre>\n\n<hr>\n\n<p>EDIT:</p>\n\n<p>So we need a solution that works in Ruby 1.9 and Rails 3.2.9, huh...</p>\n\n<p>Well the reason the above won't work is because of <a href=\"https://www.rubydoc.info/gems/activesupport/3.2.9/DateTime#%3C=%3E-instance_method\" rel=\"nofollow noreferrer\">this monkeypatch in ActiveSupport</a>:</p>\n\n<pre><code>class DateTime\n  def &lt;=&gt;(other)\n    super other.to_datetime\n  end\nend\n</code></pre>\n\n<p>This is particularly problematic. Unfortunately, you may need to just use a \"<a href=\"https://stackoverflow.com/a/56049528/1954610\">very big/small number</a>\" instead...</p>\n\n<p><strong>However</strong>, if you're able to upgrade a little bit to <strong>Rails 3.2.13</strong> (or apply this <a href=\"https://github.com/rails/rails/commit/688d52933a2e611175f3d41c016cf0ba71450b17\" rel=\"nofollow noreferrer\">updated monkeypatch</a> manually), where <a href=\"https://www.rubydoc.info/gems/activesupport/3.2.13/DateTime#%3C=%3E-instance_method\" rel=\"nofollow noreferrer\">the method signature was changed</a> to:</p>\n\n<pre><code>class DateTime\n  def &lt;=&gt;(other)\n    super other.kind_of?(Infinity) ? other : other.to_datetime\n  end\nend\n</code></pre>\n\n<p>...Then you can use <a href=\"https://www.rubydoc.info/stdlib/date/Date/Infinity\" rel=\"nofollow noreferrer\"><code>Date::Infinity</code></a> (TIL that's a thing) instead of <code>Float::Infinity</code>, and this \"fixed\" version of the method now handles it correctly:</p>\n\n<pre><code>DateTime.now &gt; Date::Infinity.new  #=&gt; false\nDateTime.now &gt; -Date::Infinity.new #=&gt; true\n</code></pre>\n"}], "owner": {"reputation": 2372, "user_id": 8031815, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-IlIxbbzooGw/AAAAAAAAAAI/AAAAAAAAAE0/9JNBRJDFRnE/photo.jpg?sz=128", "display_name": "Garrett Motzner", "link": "https://stackoverflow.com/users/8031815/garrett-motzner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 427, "favorite_count": 0, "accepted_answer_id": 56049408, "answer_count": 1, "score": 0, "last_activity_date": 1557354176, "creation_date": 1557350978, "last_edit_date": 1557353949, "question_id": 56049309, "link": "https://stackoverflow.com/questions/56049309/ruby-benign-vale-for-nil-datetime", "title": "Ruby Benign vale for nil DateTime", "body": "<p>When comparing <code>DateTimes</code>, all objects being compared must be the same type. However, I have a data set that has <code>nil</code> dates. I want to treat these dates as older (or perhaps newer) than any other date. Is there a way to construct a benign value that will compare as older (or alternatively, newer) than any other date?</p>\n\n<p>example:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>data = [\n  { name: :foo, timestamp: make_benign(some_valid_timestamp) },\n  { name: :bar, timestamp: make_benign(nil)}\n]\n\ndata.sort_by{|datum| datum[:timestamp]} #=&gt; [&lt;bar&gt;, &lt;foo&gt;]\ndata.max_by {|datum| datum[:timestamp]} #=&gt; &lt;foo&gt;\ndata.min_by {|datum| datum[:timestamp]} #=&gt; &lt;bar&gt;\n</code></pre>\n\n<p><em>EDIT:</em> I happen to be stuck on ruby 1.9 for this problem, so solutions for older versions of ruby would be nice. (But newer solutions also are nice for future reference)</p>\n"}, {"tags": ["html", "ruby", "encoding"], "answers": [{"comments": [{"owner": {"reputation": 5707, "user_id": 587406, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/1p6qq.jpg?s=128&g=1", "display_name": "Luiz E.", "link": "https://stackoverflow.com/users/587406/luiz-e"}, "edited": false, "score": 0, "creation_date": 1557437819, "post_id": 56048622, "comment_id": 98775549, "body": "the code <b>kinda</b> worked, the generated HTML was invalid somehow but it was a great start, thanks a lot!"}], "tags": [], "owner": {"reputation": 3902, "user_id": 10608621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d59df09a85d05117c63706f66811b70c?s=128&d=identicon&r=PG", "display_name": "mechnicov", "link": "https://stackoverflow.com/users/10608621/mechnicov"}, "is_accepted": false, "score": 1, "last_activity_date": 1557347505, "creation_date": 1557347505, "answer_id": 56048622, "question_id": 56048104, "link": "https://stackoverflow.com/questions/56048104/how-to-decode-utf-8-to-html-tags/56048622#56048622", "title": "how to decode UTF-8 to HTML tags", "body": "<p>Using <code>Array#pack</code>:</p>\n\n<pre><code>string = \"\\\\u003cp style=\\\\\\\"text-align: center; opacity: 1;\\\\\\\"\\\\u003e\\\\u003cstrong\\\\u003e\\\\u003cspan style=\\\\\\\"font-size: 18pt;\\\\\"\n\nstring.gsub(/\\\\u(....)/) { [$1.hex].pack(\"U\") }\n# =&gt; \"&lt;p style=\\\\\\\"text-align: center; opacity: 1;\\\\\\\"&gt;&lt;strong&gt;&lt;span style=\\\\\\\"font-size: 18pt;\\\\\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5707, "user_id": 587406, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/1p6qq.jpg?s=128&g=1", "display_name": "Luiz E.", "link": "https://stackoverflow.com/users/587406/luiz-e"}, "edited": false, "score": 0, "creation_date": 1557437770, "post_id": 56048630, "comment_id": 98775530, "body": "I&#39;d love to solve this in the root but it is totally outside my scope/time, unfortunately. also, thanks very much for the explanation on the whole hexadecimal conversion, it helped me a lot!"}], "tags": [], "owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "is_accepted": true, "score": 1, "last_activity_date": 1557347933, "last_edit_date": 1557347933, "creation_date": 1557347560, "answer_id": 56048630, "question_id": 56048104, "link": "https://stackoverflow.com/questions/56048104/how-to-decode-utf-8-to-html-tags/56048630#56048630", "title": "how to decode UTF-8 to HTML tags", "body": "<p>Here's a quick workaround for you:</p>\n\n<pre><code>input_string.gsub(/\\\\u(\\h{4})/) { [$1.to_i(16)].pack('U') }\n</code></pre>\n\n<p>With the example input you gave above, this results in:</p>\n\n<pre><code>\"&lt;p style=\\\\\\\"text-align: center; opacity: 1;\\\\\\\"&gt;&lt;strong&gt;&lt;span style=\\\\\\\"font-size: 18pt;\\\\\"\n</code></pre>\n\n<hr>\n\n<p>Explanation:</p>\n\n<p><code>\\u003c == &lt;</code>. The left hand side is an escaped unicode character; this is not the same thing as <code>\\\\u003c</code>, which is a literal backslash followed by <code>u003c</code>.</p>\n\n<p>The regular expression <code>\\\\u(\\h{4})</code> will match any occurrences of this (<code>\\h</code> stands for \"hexadecimal\" and is equivalent to <code>[0-9a-fA-F]</code>), and <a href=\"http://ruby-doc.org/core/Array.html#method-i-pack\" rel=\"nofollow noreferrer\"><code>Array#pack</code></a> converts the binary sequence into (in this case) a UTF-8 character.</p>\n\n<hr>\n\n<p>Ideally of course, you'd solve the problem at its root rather than retro-fit a workaround like this. But if that's outside of your control, then a workaround will have to suffice.</p>\n"}], "owner": {"reputation": 5707, "user_id": 587406, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/1p6qq.jpg?s=128&g=1", "display_name": "Luiz E.", "link": "https://stackoverflow.com/users/587406/luiz-e"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 56048630, "answer_count": 2, "score": 0, "last_activity_date": 1557347933, "creation_date": 1557345140, "question_id": 56048104, "link": "https://stackoverflow.com/questions/56048104/how-to-decode-utf-8-to-html-tags", "title": "how to decode UTF-8 to HTML tags", "body": "<p>I have an HTML document saved in my database as follow:</p>\n\n<pre class=\"lang-html prettyprint-override\"><code>\\\\u003cp style=\\\\\\\"text-align: center; opacity: 1;\\\\\\\"\\\\u003e\\\\u003cstrong\\\\u003e\\\\u003cspan style=\\\\\\\"font-size: 18pt;\\\\\\\n</code></pre>\n\n<p>I know, it is ugly and I know, it is not the desired way but this is a legacy system.</p>\n\n<p>My task is to get all these HTMLs and convert them to a document in Google Docs. Actually, Google Docs can parse HTML to their internal format pretty good but the HTML needs to be a valid HTML, with <code>&lt;p&gt;</code> instead of <code>\\\\u003cp</code>.</p>\n\n<p>I'm trying to convert/decode/parse/whatever this string to a valid HTML but so far, without any luck.</p>\n\n<h3>Things I already tried</h3>\n\n<p>htmlentities gem, CGI decode, <code>Nokogiri::HTML.parse</code>, <code>JSON.parse</code> and none of them did the job.  </p>\n\n<p>I also tried <code>string.encode(xxxx)</code> but also without luck. I was really hoping that <code>.encode</code> method would do it but I couldn't make it work, maybe I'm using the wrong encoding? (I tried use all of <code>ISO-xxx</code> encodings)</p>\n"}, {"tags": ["ruby", "postgresql", "heroku"], "comments": [{"owner": {"reputation": 3597, "user_id": 2112512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9689bb4f705b8bede56deddf66c87ef?s=128&d=identicon&r=PG", "display_name": "Jake Worth", "link": "https://stackoverflow.com/users/2112512/jake-worth"}, "edited": false, "score": 0, "creation_date": 1557339463, "post_id": 56046745, "comment_id": 98735266, "body": "Could you share the migration that&#39;s failing? The one that creates the <code>monetize</code> type?"}, {"owner": {"reputation": 434877, "user_id": 330315, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4b152262d9ba55197f609625358ff7e0?s=128&d=identicon&r=PG", "display_name": "a_horse_with_no_name", "link": "https://stackoverflow.com/users/330315/a-horse-with-no-name"}, "edited": false, "score": 0, "creation_date": 1557339681, "post_id": 56046745, "comment_id": 98735372, "body": "There is <a href=\"https://www.postgresql.org/docs/current/datatype.html\" rel=\"nofollow noreferrer\">no type</a> &quot;monetize&quot; in Postgres. Did you mean <code>money</code>? <a href=\"https://wiki.postgresql.org/wiki/Don%27t_Do_This#Don.27t_use_money\" rel=\"nofollow noreferrer\">You shouldn&#39;t use that</a> - use <code>numeric</code> instead"}, {"owner": {"reputation": 79, "user_id": 9263579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95bf23558d87471d2b74100c19ef8664?s=128&d=identicon&r=PG&f=1", "display_name": "Mike N.", "link": "https://stackoverflow.com/users/9263579/mike-n"}, "edited": false, "score": 0, "creation_date": 1557346884, "post_id": 56046745, "comment_id": 98738434, "body": "i&#39;m not certain if there is an installation task, or if i need to run bundle install on Heroku? I thought just deploying to heroku via git automatically runs bundle install."}], "owner": {"reputation": 79, "user_id": 9263579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95bf23558d87471d2b74100c19ef8664?s=128&d=identicon&r=PG&f=1", "display_name": "Mike N.", "link": "https://stackoverflow.com/users/9263579/mike-n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 89, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1557347057, "creation_date": 1557339013, "last_edit_date": 1557347057, "question_id": 56046745, "link": "https://stackoverflow.com/questions/56046745/migration-error-on-heroku-with-postgres-and-monetize", "title": "Migration Error on Heroku with Postgres and Monetize", "body": "<p>I have a RoR 5.1 app that I am trying to deploy to Heroku. </p>\n\n<p>In my gem file I specify the gem \u2018pg\u2019 for production. I also include the gem \u2018money-rails\u2019. In my database/migration files I have a few lines to create a field of the \u201cmonetize\u201d type, which I understand should be handled by including the \u2018money-rails\u2019 gem. </p>\n\n<p>When I deploy the app I don\u2019t get any issues raised, but then when I go to migrate the db to create the tables I get the following error:</p>\n\n<blockquote>\n<pre><code>StandardError: An error has occurred, this and all later migrations canceled:\n\nPG::UndefinedObject: ERROR:  type \"monetize\" does not exist\n: ALTER TABLE \"plans\" ALTER COLUMN \"price\" TYPE monetize\n(followed by additional error lines)\n</code></pre>\n</blockquote>\n\n<p>Any idea on how to resolve this? Is there a gem I need to add? Is there something that needs to be updated/installed on Heroku? I\u2019m not sure if there is a way to ignore having these specific migrations executed as they are not necessary for the codebase. </p>\n\n<p>I could write a migration to drop the table, but that would only occur after it tries to create it, so not sure what the work around is.</p>\n\n<p>Per the comments, here is the migration that created one of the tables in question: Plans</p>\n\n<pre><code>class CreatePlans &lt; ActiveRecord::Migration[5.1]\n  def change\n    create_table :plans do |t|\n      t.string :payment_gateway_plan_identifier\n      t.string :name\n      t.float :price\n      t.integer :interval\n      t.integer :interval_count\n      t.integer :status\n      t.text :description\n\n      t.timestamps\n    end\n  end\nend\n</code></pre>\n\n<p>And then here is the Change that I made to implement \"monetize\":</p>\n\n<pre><code>class ChangePriceToMonetizeInPlans &lt; ActiveRecord::Migration[5.1]\n  def change\n    change_column :plans, :price, :monetize\n  end\nend\n</code></pre>\n\n<p>Also per the comments, monetize isn't a supported PG type, apparently. But since I've already created the migration (I use SQL lite 3 for my development), I'm not sure how to walk this back and remove it, since I assume that the migrations go in order. Sorry but this migration stuff (and rails in general) is still new to me. </p>\n"}, {"tags": ["ruby", "windows", "shoes"], "comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557341413, "post_id": 56046472, "comment_id": 98736147, "body": "You want a ruby application to run without a ruby interpreter? You know that if you bundle this application the first thing that will have to be copied into that bundle is ruby and all the dependencies. You could look at <a href=\"https://github.com/larsch/ocra\" rel=\"nofollow noreferrer\">ocra</a> for windows deployment never tried it with shoes but has worked for fxruby in the past. But there is no way you can write an application in ruby/shoes and not include ruby and shoes as part of the deployment You are essentially asking for a peanut butter and jelly sandwich without peanut butter and jelly"}, {"owner": {"reputation": 1, "user_id": 9855674, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/edUMq.jpg?s=128&g=1", "display_name": "Ciarambola", "link": "https://stackoverflow.com/users/9855674/ciarambola"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557430817, "post_id": 56046472, "comment_id": 98772843, "body": "It&#39;s supposed to contain ruby \u200b\u200band shoes, but the person who will install it does not bother about it, that&#39;s what I meant. I apologize for misleading."}], "owner": {"reputation": 1, "user_id": 9855674, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/edUMq.jpg?s=128&g=1", "display_name": "Ciarambola", "link": "https://stackoverflow.com/users/9855674/ciarambola"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 37, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1557430915, "creation_date": 1557337845, "last_edit_date": 1557430915, "question_id": 56046472, "link": "https://stackoverflow.com/questions/56046472/how-to-deploy-the-shoes-3-3-7-application-in-windows-64bit-and-ubuntu-18-04", "title": "How to deploy the Shoes 3.3.7 application in Windows 64bit and Ubuntu 18.04", "body": "<p>I have a ready application Shoes 3.3.7, which I wrote in the Ubuntu 18.04 system.</p>\n\n<p>This application consists of the rb file and two folders, one contains the images used when the application is switched on, the second contains graphs of simulations carried out in the application.</p>\n\n<p>I want to create an executable file / installer / anything that will allow me to use the application in Windows 64bit and Ubuntu, without any shoes, ruby, etc., it has to be a truly ready application. I mean, the person who will install it is not to worry about ruby and shoes</p>\n\n<p>Is there a right way to do it? Should I rewrite the application for something else that will enable it? For what?</p>\n\n<p>I tried to pack the application in GUI Shoes without success. The resulting files did not work on the same computer on which the application was created or on fresh Windows.</p>\n\n<p>The app works correctly in Ubuntu, in Shoes, the charts are saved and displayed. In contrast, in Windows, only the application starts working, and the creation and display of subsequent charts do not.</p>\n\n<p><a href=\"https://github.com/KamilSuchanek95/small_lotka_volterra_shoesapp\" rel=\"nofollow noreferrer\">https://github.com/KamilSuchanek95/small_lotka_volterra_shoesapp</a></p>\n\n<p>This is my application. The rb file and folders: image_charts, image_start, are part of the project. The MyLotka-Volterra folder is just a rough draft.\nThe application requires a gem numo-gnuplot.</p>\n\n<p>The application is used to visualize the Lotka-Volterra model. To work properly, press the three buttons from left to right to load the parameters, solve the model and draw. The initial parameters correspond to the initial graphs.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "rspec", "trestle-admin"], "comments": [{"owner": {"reputation": 75558, "user_id": 544825, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/UFdOO.png?s=128&g=1", "display_name": "max", "link": "https://stackoverflow.com/users/544825/max"}, "edited": false, "score": 0, "creation_date": 1557338065, "post_id": 56046294, "comment_id": 98734588, "body": "Use a <a href=\"https://relishapp.com/rspec/rspec-rails/docs/request-specs/request-spec\" rel=\"nofollow noreferrer\">request spec</a> instead of a controller spec. Request specs drive the whole stack and are more future proof."}, {"owner": {"reputation": 426, "user_id": 4276614, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eh0Za.jpg?s=128&g=1", "display_name": "HalleyRios", "link": "https://stackoverflow.com/users/4276614/halleyrios"}, "reply_to_user": {"reputation": 75558, "user_id": 544825, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/UFdOO.png?s=128&g=1", "display_name": "max", "link": "https://stackoverflow.com/users/544825/max"}, "edited": false, "score": 0, "creation_date": 1557351891, "post_id": 56046294, "comment_id": 98740328, "body": "Thanks for response, So how i implement login test in request with trestle?. Do you have a example?"}], "owner": {"reputation": 426, "user_id": 4276614, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eh0Za.jpg?s=128&g=1", "display_name": "HalleyRios", "link": "https://stackoverflow.com/users/4276614/halleyrios"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1557346040, "creation_date": 1557337113, "last_edit_date": 1557346040, "question_id": 56046294, "link": "https://stackoverflow.com/questions/56046294/how-i-implement-test-rspec-for-controller-admin-trestle", "title": "How i implement test rspec for controller admin trestle", "body": "<p>I create the controller copy syllabus in trestle in:</p>\n\n<pre><code>app/admin/copy_syllabus.rb\n</code></pre>\n\n<p>This is my content</p>\n\n<pre><code>Trestle.admin(:copy_syllabus) do\n   menu do\n     item :copy_syllabus, icon: \"fa fa-tachometer\"\n   end\n\n   controller do\n     def index\n\n     end\n\n     def create\n     end\n  end\n</code></pre>\n\n<p>So I need to add rspec test for this controller</p>\n\n<p>I tried with this structure of files</p>\n\n<pre><code>rspec/admin/copy_syllabus_controller.rb\n</code></pre>\n\n<p>But when I run:</p>\n\n<pre><code>rspec spec \n</code></pre>\n\n<p>show me the error</p>\n\n<pre><code>NameError:\n  uninitialized constant Admin::CopySyllabusController\n</code></pre>\n"}, {"tags": ["ruby", "iterator", "retry-logic"], "comments": [{"owner": {"reputation": 443227, "user_id": 341994, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/fbb4d027695dfdf76bf448b15d7e306a?s=128&d=identicon&r=PG", "display_name": "matt", "link": "https://stackoverflow.com/users/341994/matt"}, "edited": false, "score": 0, "creation_date": 1557333026, "post_id": 56045153, "comment_id": 98732106, "body": "&quot;is there any form to recover that kind of use&quot; Sorry, it&#39;s unclear: what was it that you wanted <code>retry</code> to accomplish?"}, {"owner": {"reputation": 63, "user_id": 10284159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adcf2c144d9a87505141e48033d521b4?s=128&d=identicon&r=PG", "display_name": "Inot", "link": "https://stackoverflow.com/users/10284159/inot"}, "reply_to_user": {"reputation": 443227, "user_id": 341994, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/fbb4d027695dfdf76bf448b15d7e306a?s=128&d=identicon&r=PG", "display_name": "matt", "link": "https://stackoverflow.com/users/341994/matt"}, "edited": false, "score": 0, "creation_date": 1557333310, "post_id": 56045153, "comment_id": 98732233, "body": "Sorry, I just wonder if it could be used to get the same result that it had in the first example, before being forced to be inside a &quot;begin / rescue&quot; block. Which seems to be, for me, being able to recall the method with an updated parameter."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1557333371, "post_id": 56045153, "comment_id": 98732266, "body": "The first example does not work in Ruby 2.6. You get an error on line 4: Invalid retry (SyntaxError)"}, {"owner": {"reputation": 63, "user_id": 10284159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adcf2c144d9a87505141e48033d521b4?s=128&d=identicon&r=PG", "display_name": "Inot", "link": "https://stackoverflow.com/users/10284159/inot"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1557333745, "post_id": 56045153, "comment_id": 98732443, "body": "@tadman I know, I found that it was forced to be inside of a rescue block in Ruby 2.3.1 (before that, it worked)"}], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 10284159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adcf2c144d9a87505141e48033d521b4?s=128&d=identicon&r=PG", "display_name": "Inot", "link": "https://stackoverflow.com/users/10284159/inot"}, "edited": false, "score": 0, "creation_date": 1557494621, "post_id": 56045380, "comment_id": 98795154, "body": "Thanks! It was really explanatory. So I could do something like this:  <code>def WHILE(cond)     begin         return if not cond.call         yield         raise     rescue         retry     end end  i=0; WHILE(-&gt; {i&lt;3}) {print i; i+=1}</code>  I know that this is pretty ugly and it&#39;s better to use a regular loop, but now I&#39;m sure that my thoughs were for the right path."}, {"owner": {"reputation": 63, "user_id": 10284159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adcf2c144d9a87505141e48033d521b4?s=128&d=identicon&r=PG", "display_name": "Inot", "link": "https://stackoverflow.com/users/10284159/inot"}, "edited": false, "score": 0, "creation_date": 1557495291, "post_id": 56045380, "comment_id": 98795513, "body": "So the method&#39;s parameter just needed to be &quot;updated&quot; (or reevaluated) for its evaluation at the return statement. And the retry keyword seemed to do that before 2.3.1."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "reply_to_user": {"reputation": 63, "user_id": 10284159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adcf2c144d9a87505141e48033d521b4?s=128&d=identicon&r=PG", "display_name": "Inot", "link": "https://stackoverflow.com/users/10284159/inot"}, "edited": false, "score": 0, "creation_date": 1557506065, "post_id": 56045380, "comment_id": 98801313, "body": "You need what&#39;s loosely called a &quot;dynamic&quot; value, one that can be repeatedly evaluated to test against changing conditions. A lambda (Proc) closure does this job nicely, hence the first argument. They did change how <code>retry</code> worked in Ruby rather dramatically I think to avoid it doing two different and somewhat contradictory things depending on context."}], "tags": [], "owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "is_accepted": true, "score": 4, "last_activity_date": 1557333675, "creation_date": 1557333675, "answer_id": 56045380, "question_id": 56045153, "link": "https://stackoverflow.com/questions/56045153/how-does-the-retry-statement-work-in-ruby/56045380#56045380", "title": "How does the retry statement work in Ruby?", "body": "<p>Your <code>WHILE</code> does not behave like a regular <code>while</code> since in your case <code>i&lt;3</code> is evaluated at call time <em>once</em>. The <code>while</code> statement evaluates it each time.</p>\n\n<p>If you want to write a <code>while</code> equivalent it's important that your condition be something that <em>can be</em> evaluated, not something that is <em>already</em> evaluated.</p>\n\n<p>You can fix that by accepting a Proc as a condition:</p>\n\n<pre><code>def so_long_as(cond)\n  loop do\n    return unless cond.call\n\n    yield\n  end\nend\n</code></pre>\n\n<p>Then you call it like this:</p>\n\n<pre><code>i = 0\nso_long_as(-&gt; { i &lt; 3 }) do\n  print i\n  i += 1\nend\n</code></pre>\n\n<p>Where that now prints <code>012</code> and terminates properly.</p>\n\n<p>What's important to note is that <code>retry</code> only works within a <code>begin</code>/<code>end</code> context, not a regular method, that now you have to use <code>redo</code> instead:</p>\n\n<pre><code>i = 0\nredone = false\nso_long_as(-&gt; { i &lt; 3 }) do\n  print i\n  unless (redone)\n    redone = true\n    redo\n  end\n  i += 1\nend\n</code></pre>\n\n<p>Where that prints <code>0012</code> now.</p>\n\n<p>There's been <a href=\"https://blog.appsignal.com/2018/06/05/redo-retry-next.html\" rel=\"nofollow noreferrer\">some significant changes to how <code>redo</code> and <code>retry</code> work</a> that are worth reading up on.</p>\n"}], "owner": {"reputation": 63, "user_id": 10284159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adcf2c144d9a87505141e48033d521b4?s=128&d=identicon&r=PG", "display_name": "Inot", "link": "https://stackoverflow.com/users/10284159/inot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1291, "favorite_count": 0, "accepted_answer_id": 56045380, "answer_count": 1, "score": 2, "last_activity_date": 1557334379, "creation_date": 1557332738, "last_edit_date": 1557334379, "question_id": 56045153, "link": "https://stackoverflow.com/questions/56045153/how-does-the-retry-statement-work-in-ruby", "title": "How does the retry statement work in Ruby?", "body": "<p>I'm just getting started in Ruby, but the manual I'm following seems to be outdated. I've been doing some research but I've been unable to find a clear answer.</p>\n\n<p>The manual used the 'retry' keyword inside of a method that should act as a loop, but it is used without a begin/rescue block, and the behavior seems pretty different when you force the 'retry' keyword to be inside of a begin/rescue block.</p>\n\n<p>I've tried many things:\n-The first one was using the \"begin\" keyword at the start of the method and a 'raise' at the retry point, followed by the respective 'rescue; retry; end;'.\n-The last one was using the 'begin/rescue' block outside, wrapping the call of the method.</p>\n\n<p>Following the logic in the manual, only the last one worked as it should.</p>\n\n<p>There some examples:</p>\n\n<p>The code in the manual is as follows:</p>\n\n<pre><code>def WHILE(cond)\n  return if not cond\n  yield\n  retry\nend\ni=0; WHILE(i&lt;3) {print i; i+=1}\n</code></pre>\n\n<p>result:\n012</p>\n\n<p>I've tried the following:</p>\n\n<pre><code>def WHILE(cond)\n  begin\n    return if not cond\n    yield\n    raise\n  rescue\n    retry\n  end\nend\ni=0; WHILE(i&lt;3) {print i; i+=1}\n</code></pre>\n\n<p>result:\n<i>infinite numbers</i></p>\n\n<pre><code>def WHILE(cond)\n  return if not cond\n  yield\nend\ni=0; begin; WHILE(i&lt;3) {print i; i+=1}; raise; rescue; retry; end\n</code></pre>\n\n<p>result:\n012 <i>(plus an obvious infinite loop printing nothing)</i></p>\n\n<p>I expect you from taking me out of this existential doubt, but here's MY conclusion.</p>\n\n<p>Before the obligatory use of the begin/rescue block for the 'retry' keyword, it could be used in a way that it can't anymore, <b>repeating the call</b> of a method in spite of <b>being inside of that method</b>.</p>\n\n<p>Now, it just jumps to the 'begin' statement.</p>\n\n<p>But i'm unsure of this, and I need confirmation. And if so, <b>is there any form to recover that kind of use?</b></p>\n\n<p>Thanks.</p>\n"}, {"tags": ["ruby", "graphql", "graphql-ruby"], "answers": [{"tags": [], "owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "is_accepted": false, "score": 1, "last_activity_date": 1557326523, "last_edit_date": 1557326523, "creation_date": 1557326209, "answer_id": 56043236, "question_id": 56042830, "link": "https://stackoverflow.com/questions/56042830/proper-way-to-dry-up-multiple-lambdas-in-a-graphql-mutation/56043236#56043236", "title": "Proper way to DRY up multiple lambdas in a GraphQL mutation", "body": "<p>You could try defining <code>no_whitespace</code> as a module method e.g. </p>\n\n<pre><code>class Testing\n  # since the example shows 2 arguments you need to be able \n  # to accept both even if you only use 1\n  def self.no_whitespace(value,*_)\n    value.strip!\n  end\nend \n</code></pre>\n\n<p>then use </p>\n\n<pre><code>class MyMutation &lt; BaseMutation\n  argument :name, String, required: true, prepare: Testing.method(:no_whitespace)\nend\n</code></pre>\n\n<p><code>Testing.method(:no_whitespace)</code> will return a <code>Method</code> which in most cases will act very much like a lambda.</p>\n\n<p>However if </p>\n\n<pre><code>module Mutations\n  class MyMutation &lt; BaseMutation\n    argument :name, String, required: true, prepare: :no_whitespace\n\n    def no_whitespace(value)\n      value.strip!\n    end\n  end\nend\n</code></pre>\n\n<p>Is return a <code>NoMethodError: undefined method no_whitespace' for MyMutation:Class</code> then try defining that as a class instance method and see what happens: </p>\n\n<pre><code>def self.no_whitespace(value)\n  value.strip!\nend \n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11470643, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-bxplpAV_0Is/AAAAAAAAAAI/AAAAAAAAAAc/4SaPOZw9V2k/photo.jpg?sz=128", "display_name": "Patrick Walters", "link": "https://stackoverflow.com/users/11470643/patrick-walters"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1557326523, "creation_date": 1557324836, "question_id": 56042830, "link": "https://stackoverflow.com/questions/56042830/proper-way-to-dry-up-multiple-lambdas-in-a-graphql-mutation", "title": "Proper way to DRY up multiple lambdas in a GraphQL mutation", "body": "<p>I'm trying to take a bunch of lambdas that do the same thing and DRY them up by breaking it out in to a method.  The code in question is in a module / class and I've forgotten the correct way to do this :/</p>\n\n<p>The docs show an example like this using a lambda - </p>\n\n<pre><code>module Mutations\n  class MyMutation &lt; BaseMutation\n    argument :name, String, required: true, prepare: -&gt; (value, ctx) { value.strip! }\n  end\nend\n</code></pre>\n\n<p>I've tried -</p>\n\n<pre><code>module Mutations\n  class MyMutation &lt; BaseMutation\n    argument :name, String, required: true, prepare: :no_whitespace\n\n    def no_whitespace(value)\n      value.strip!\n    end\n  end\nend\n</code></pre>\n\n<p>But get a method not found on class error.</p>\n\n<p>I also tried moving it to it's own module or class -</p>\n\n<pre><code>module Mutations\n  class MyMutation &lt; BaseMutation\n    argument :name, String, required: true, prepare: Testing::no_whitespace\n  end\n\n  class Testing\n    def no_whitespace(value)\n      value.strip!\n    end\n  end \nend\n</code></pre>\n\n<p>I know it's something silly but I can't find the right combinations to get this working and my brain has forgotten too much Ruby to remember what to google.</p>\n"}, {"tags": ["mysql", "ruby-on-rails", "ruby", "enums", "rails-migrations"], "answers": [{"tags": [], "owner": {"reputation": 1432, "user_id": 1184912, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc5f9407e5093fbd916ea4d80c7a499f?s=128&d=identicon&r=PG", "display_name": "eyevan", "link": "https://stackoverflow.com/users/1184912/eyevan"}, "is_accepted": true, "score": 0, "last_activity_date": 1557324516, "creation_date": 1557324516, "answer_id": 56042737, "question_id": 56042635, "link": "https://stackoverflow.com/questions/56042635/problem-when-adding-a-mysql-enum-column-via-ruby-rails-migration/56042737#56042737", "title": "Problem when adding a MySQL enum column via ruby Rails migration", "body": "<p><code>SQLite3::SQLException</code> -- you are executing this query on a SQLite database, not MySQL. Are you using the correct environment?</p>\n"}], "owner": {"reputation": 9908, "user_id": 257948, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/63fc52037c03c7d22c8baf001f55f2f7?s=128&d=identicon&r=PG&f=1", "display_name": "noloman", "link": "https://stackoverflow.com/users/257948/noloman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 299, "favorite_count": 0, "accepted_answer_id": 56042737, "answer_count": 1, "score": 0, "last_activity_date": 1557324516, "creation_date": 1557324215, "question_id": 56042635, "link": "https://stackoverflow.com/questions/56042635/problem-when-adding-a-mysql-enum-column-via-ruby-rails-migration", "title": "Problem when adding a MySQL enum column via ruby Rails migration", "body": "<p>I'm trying to add a MySQL enum column by doing:</p>\n\n<pre><code># frozen_string_literal: true\nclass AddStatusToTasks &lt; ActiveRecord::Migration[6.0]\n  def up\n    execute &lt;&lt;-SQL\n        ALTER TABLE tasks ADD status enum('to_do', 'doing', 'done');\n    SQL\n  end\n  def down\n    remove_column :tasks, :status\n  end\nend\n</code></pre>\n\n<p>But I get the error:</p>\n\n<pre><code>AddStatusToTasks: migrating =================================\n-- execute(\"        ALTER TABLE tasks ADD status enum('to_do', 'doing', 'done');\\n\")\nrails aborted!\nStandardError: An error has occurred, this and all later migrations canceled:\n\nSQLite3::SQLException: near \"'to_do'\": syntax error\n</code></pre>\n\n<p>My model likes looks like:</p>\n\n<pre><code>class Task &lt; ApplicationRecord\n  belongs_to :user\n  enum status: { to_do: 'to_do', doing: 'doing', done: 'done' }\nend\n</code></pre>\n\n<p>I'm actually following the guide <a href=\"https://sipsandbits.com/2018/04/30/using-database-native-enums-with-rails/\" rel=\"nofollow noreferrer\">here</a>, but I can't find the problem.</p>\n\n<p>Thanks everybody in advance for the help!</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "amazon-web-services", "ruby-on-rails-5", "dokku"], "comments": [{"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1557329863, "post_id": 56042421, "comment_id": 98730675, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/24244519/cannot-define-multiple-included-blocks-for-a-concern-activesupportconcern\">Cannot define multiple &#39;included&#39; blocks for a Concern (ActiveSupport::Concern::MultipleIncludedBlocks) with cache_classes = true</a>"}, {"owner": {"reputation": 764, "user_id": 552941, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/HYsSP.jpg?s=128&g=1", "display_name": "Fernando Aureliano", "link": "https://stackoverflow.com/users/552941/fernando-aureliano"}, "reply_to_user": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1557344527, "post_id": 56042421, "comment_id": 98737486, "body": "I tried that but did not solve my problem."}], "owner": {"reputation": 764, "user_id": 552941, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/HYsSP.jpg?s=128&g=1", "display_name": "Fernando Aureliano", "link": "https://stackoverflow.com/users/552941/fernando-aureliano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 455, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1557343989, "creation_date": 1557323614, "last_edit_date": 1557343989, "question_id": 56042421, "link": "https://stackoverflow.com/questions/56042421/rails5-cannot-define-multiple-included-blocks-for-a-concern", "title": "Rails5: Cannot define multiple &#39;included&#39; blocks for a Concern", "body": "<p>I'm trying to do a deploy to Amazon Lightsail server using Dokku. The configuration for deploy its working, but when I try to do the deploy I get the error:</p>\n\n<pre><code>/app/vendor/bundle/ruby/2.5.0/gems/activesupport-5.0.7.2/lib/active_support/concern.rb:126:in `included': Cannot define multiple 'included' blocks for a Concern (ActiveSupport::Concern::MultipleIncludedBlocks)\n        from /app/app/models/models/concerns/productable.rb:5:in `&lt;module:Productable&gt;'\n        from /app/app/models/models/concerns/productable.rb:1:in `&lt;top (required)&gt;'\n</code></pre>\n\n<p>I try <a href=\"https://stackoverflow.com/questions/24244519/cannot-define-multiple-included-blocks-for-a-concern-activesupportconcern\">this</a>, but did not solve my problem.</p>\n\n<p>in the file mentioned I have this code:</p>\n\n<pre><code>module Productable\n\n    extend ActiveSupport::Concern\n\n    included do\n\n        extend FriendlyId\n        include PgSearch\n\n        before_validation :update_slug, on: :update, prepend: true\n\n        acts_as_paranoid\n\n        has_one :highlight, as: :highlightable, dependent: :destroy\n\n        scope :published, -&gt; { joins(:teacher).where(status: PublishStatus::PUBLIC) }\n        scope :draft, -&gt; { where(status: PublishStatus::DRAFT) }\n        scope :from_category_group, -&gt; category_group { joins(category: :category_group).where(\"category_groups.slug = ?\", category_group) }\n        scope :from_category, -&gt; category { joins(:category).where(\"categories.slug = ?\", category) }\n        scope :from_teacher, -&gt; teacher_id { where(teacher_id: teacher_id) }        \n        scope :highlighted, -&gt; { joins(:highlight) } \n\n        pg_search_scope :search, \n            associated_against: {\n                category_group: :name,\n                category: :name,\n                teacher: :name\n            }, \n            against: [:title, :description, :keywords],\n            ignoring: :accents,\n            using: {\n                tsearch: { prefix: true }\n            }\n\n    end\n\n    def update_slug\n        #force update slug only if title changed\n        self.slug = nil if self.title_changed?          \n    end\n\nend\n</code></pre>\n\n<p>I do not have this problem when I deploy the application to Heroku.</p>\n\n<p>Someone got this before?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "activerecord", "activemodel", "kaminari"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1557337923, "post_id": 56042384, "comment_id": 98734505, "body": "Note: Ruby doesn&#39;t really use <code>for</code>. Instead: <code>category.categories.each do |cat|</code> Likewise a <code>return</code> at the end of a method is implied. Just do <code>@all_products</code> instead of <code>return @all_products</code> unless you&#39;re explicitly returning from a method early. Your <code>if !(@category.nil?)</code> should also be either <code>if !@category.nil?</code> or <code>if (!@category.nil?)</code> or perhaps <code>unless @category.nil?</code> but more honestly it can probably be <code>if @category</code> unless there&#39;s a chance <code>@category</code> can be literal <code>false</code>, which I doubt."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1557338105, "post_id": 56042384, "comment_id": 98734614, "body": "This looks like a class N+1 query situation. Normally you tackle this by having <code>through:</code> relationships, or using a <code>JOIN</code> in your query to deep fetch everything in one shot."}, {"owner": {"reputation": 339, "user_id": 7065800, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-tHw9R8dCTT4/AAAAAAAAAAI/AAAAAAAAACQ/MLOZ4Oszb8M/photo.jpg?sz=128", "display_name": "\u041d\u0438\u043a\u043e\u043b\u0430\u0439 \u0410\u0433\u0435\u0435\u0432", "link": "https://stackoverflow.com/users/7065800/%d0%9d%d0%b8%d0%ba%d0%be%d0%bb%d0%b0%d0%b9-%d0%90%d0%b3%d0%b5%d0%b5%d0%b2"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1557344531, "post_id": 56042384, "comment_id": 98737489, "body": "I made something like this. I gathered only ids of subcategories and then SELECT products which category_id IN ( @subcategories_ids ).   It is more faster, but I think that there exists more efficient way"}], "owner": {"reputation": 339, "user_id": 7065800, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-tHw9R8dCTT4/AAAAAAAAAAI/AAAAAAAAACQ/MLOZ4Oszb8M/photo.jpg?sz=128", "display_name": "\u041d\u0438\u043a\u043e\u043b\u0430\u0439 \u0410\u0433\u0435\u0435\u0432", "link": "https://stackoverflow.com/users/7065800/%d0%9d%d0%b8%d0%ba%d0%be%d0%bb%d0%b0%d0%b9-%d0%90%d0%b3%d0%b5%d0%b5%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1557323495, "creation_date": 1557323495, "question_id": 56042384, "link": "https://stackoverflow.com/questions/56042384/rails-kaminari-from-array-optimization", "title": "Rails Kaminari from array optimization", "body": "<p><strong>Problem:</strong> I have categories and products in categories. Code/queries are very slow. </p>\n\n<p>Each category has subcategories as the same model. Subcategories also have products and maybe subcategories.\nSo I need to get all products of all subcategories when call parent category.</p>\n\n<p><strong>category model</strong></p>\n\n<pre><code>  class Category &lt; ApplicationRecord\n      belongs_to :parent, polymorphic: true\n      has_many :categories, as: :parent, :dependent =&gt; :destroy\n      has_many :products, :dependent =&gt; :destroy\n\n      def all_products\n        @all_products = []\n        all_products_find(self)\n        return @all_products\n      end\n\n      def all_products_find(category)\n        @all_products += category.products\n        for cat in category.categories\n          all_products_find(cat)\n        end\n      end\n    ...\n    end\n</code></pre>\n\n<p>I use Kaminari to paginate array, but before use it, category puts all products to array, so it is very long. How can I paginate_array without gathering all products before?</p>\n\n<p><strong>my controller's action</strong></p>\n\n<pre><code>    @category = Category.find(params[:id])\n    if !(@category.nil?)\n      @products = @category.all_products #still gathering all products -&gt; slow\n      @products_part = Kaminari.paginate_array(@products).page(params[:page]).per(12)\n    end\n</code></pre>\n\n<p>How can I optimize it?</p>\n"}, {"tags": ["arrays", "ruby", "while-loop"], "comments": [{"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1557322114, "post_id": 56041354, "comment_id": 98725797, "body": "does each group always contain just 2 names?"}, {"owner": {"reputation": 11, "user_id": 11470114, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xPXMK.png?s=128&g=1", "display_name": "Oliver Todd", "link": "https://stackoverflow.com/users/11470114/oliver-todd"}, "reply_to_user": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1557322424, "post_id": 56041354, "comment_id": 98725999, "body": "No, there can be as many groups and names as specified by the user. The final piece of code just needs to request which group number the user would like to see. Everything else has already been achieved in the original code."}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1557322644, "post_id": 56041354, "comment_id": 98726133, "body": "so how do you know when a group is done entering names?"}, {"owner": {"reputation": 11, "user_id": 11470114, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xPXMK.png?s=128&g=1", "display_name": "Oliver Todd", "link": "https://stackoverflow.com/users/11470114/oliver-todd"}, "reply_to_user": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1557322744, "post_id": 56041354, "comment_id": 98726209, "body": "I have the solution now, but thanks for looking."}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1557322872, "post_id": 56041354, "comment_id": 98726298, "body": "See my answer anyway, it might help. Also it&#39;s a good idea on Stackoverflow to allow time for other possible answers before marking the very first answer as &quot;accepted&quot; as there are many ways to solve the same problem."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 11470114, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xPXMK.png?s=128&g=1", "display_name": "Oliver Todd", "link": "https://stackoverflow.com/users/11470114/oliver-todd"}, "edited": false, "score": 0, "creation_date": 1557321552, "post_id": 56041444, "comment_id": 98725425, "body": "What I need is for the input to be requested from the user. So for example: puts &quot;Enter your group number&quot; and then this will return the new group of names. I know it should be pretty simple with &quot;gets&quot;..."}, {"owner": {"reputation": 27144, "user_id": 3857758, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/58c4295826435f049b7fc32b98c240f9?s=128&d=identicon&r=PG&f=1", "display_name": "Ursus", "link": "https://stackoverflow.com/users/3857758/ursus"}, "reply_to_user": {"reputation": 11, "user_id": 11470114, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xPXMK.png?s=128&g=1", "display_name": "Oliver Todd", "link": "https://stackoverflow.com/users/11470114/oliver-todd"}, "edited": false, "score": 0, "creation_date": 1557321733, "post_id": 56041444, "comment_id": 98725539, "body": "I updated my answer. It seems to me you already know how to ask for an input and gets it. Anyway, I think you just need to paste my code at the end of your and remove my first line"}], "tags": [], "owner": {"reputation": 27144, "user_id": 3857758, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/58c4295826435f049b7fc32b98c240f9?s=128&d=identicon&r=PG&f=1", "display_name": "Ursus", "link": "https://stackoverflow.com/users/3857758/ursus"}, "is_accepted": true, "score": 1, "last_activity_date": 1557321673, "last_edit_date": 1557321673, "creation_date": 1557320506, "answer_id": 56041444, "question_id": 56041354, "link": "https://stackoverflow.com/questions/56041354/how-do-i-return-an-array-of-arrays-with-user-input/56041444#56041444", "title": "How do I return an array of arrays with user input?", "body": "<p>Given the array and the index wanted is very simple</p>\n\n<pre><code>array = [[\"John\", \"Steve\"], [\"Judy\", \"Pete\"]]\nputs \"tell me which group you want with a number\"\nnumber = gets.to_i\nif (1..array.length).include?(number)\n  puts \"people: #{array[number - 1].join(\", \")}\"\nelse\n  puts \"Number element not present\"\nend\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": false, "score": 0, "last_activity_date": 1557322603, "creation_date": 1557322603, "answer_id": 56042115, "question_id": 56041354, "link": "https://stackoverflow.com/questions/56041354/how-do-i-return-an-array-of-arrays-with-user-input/56042115#56042115", "title": "How do I return an array of arrays with user input?", "body": "<p>I think this is what you want you program to do?  Try to run it:</p>\n\n<pre><code>array = []\nputs \"How many groups would you like?\"\ngroup_num = gets.chomp.to_i\n\ngroup_num.times do\n  puts \"\\nEnter one name at a time\"\n  a = []\n  loop do\n    puts \"Give me a name or 'stop' to stop adding names\"\n    input_name = gets.chomp\n    break if input_name == \"stop\"\n    a &lt;&lt; input_name\n  end\n  array &lt;&lt; a\nend\n\narray.each_with_index{|a, i| puts \"#{i+1}. #{a}\" }\nputs \"select number which group you want\"\ngroup = gets.chomp.to_i - 1\nputs \"you selected group: #{array[group].to_s}\"\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 11470114, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xPXMK.png?s=128&g=1", "display_name": "Oliver Todd", "link": "https://stackoverflow.com/users/11470114/oliver-todd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 56041444, "answer_count": 2, "score": 0, "last_activity_date": 1557323715, "creation_date": 1557320219, "last_edit_date": 1557323715, "question_id": 56041354, "link": "https://stackoverflow.com/questions/56041354/how-do-i-return-an-array-of-arrays-with-user-input", "title": "How do I return an array of arrays with user input?", "body": "<p>the code below will put names into groups (e.g. first person goes into first group, second person goes into second group etc). </p>\n\n<p>I'd like to enter the final piece of code and request user to input the number of the group. This should then print the people in that group, each separated by a comma and a space.  Group numbers are \"1-indexed\".  This means that, if the user enters <code>1</code>, the first group should be printed, not the second group. Keep on asking the user for (final) group numbers until the user enters <code>stop</code>. </p>\n\n<pre><code>puts \"How many groups would you like?\"\ngroup_num = gets.chomp.to_i\n\narray = Array.new(group_num) { [] }\n\nputs \"Enter one name at a time\"\ncount = 0\n while input_name = gets.chomp\n  if input_name == \"stop\"\n    break\n  else puts \"Give me a name\"\n   array[count] &lt;&lt; input_name\n   count += 1\n   count = 0 if count == group_num\n  end\n end\n\narray.inspect\n</code></pre>\n\n<p>So if <code>array = [[\"John\", \"Steve\"], [\"Judy\", Pete\"]]</code> and the group number requested is <code>2</code>, the output should print: <code>\"Judy, Pete\"</code> (on the same line).</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "elasticsearch"], "comments": [{"owner": {"reputation": 4291, "user_id": 304215, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/cVby7.jpg?s=128&g=1", "display_name": "Suresh", "link": "https://stackoverflow.com/users/304215/suresh"}, "edited": false, "score": 1, "creation_date": 1557319847, "post_id": 56041001, "comment_id": 98724321, "body": "in your index mapping what datatype you are using for your field <code>contexts.key</code> &amp; <code>contexts.tag.name</code>? For using <code>term</code> query you need to use <code>keyword</code> datatype. Ref - <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/keyword.html\" rel=\"nofollow noreferrer\">elastic.co/guide/en/elasticsearch/reference/current/&hellip;</a>"}, {"owner": {"reputation": 455, "user_id": 4685465, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mKUsg.jpg?s=128&g=1", "display_name": "aHochstein", "link": "https://stackoverflow.com/users/4685465/ahochstein"}, "edited": false, "score": 0, "creation_date": 1557329031, "post_id": 56041001, "comment_id": 98730201, "body": "Please provide your index mapping, this is most likely some text analysis issue."}, {"owner": {"reputation": 11, "user_id": 10190554, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Xq5Qx.png?s=128&g=1", "display_name": "Arcadia Cheese", "link": "https://stackoverflow.com/users/10190554/arcadia-cheese"}, "edited": false, "score": 0, "creation_date": 1557329394, "post_id": 56041001, "comment_id": 98730407, "body": "thanks guys, yeah looks like it should have &quot;keyword&quot; type."}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 10190554, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Xq5Qx.png?s=128&g=1", "display_name": "Arcadia Cheese", "link": "https://stackoverflow.com/users/10190554/arcadia-cheese"}, "is_accepted": false, "score": 0, "last_activity_date": 1557329330, "creation_date": 1557329330, "answer_id": 56044194, "question_id": 56041001, "link": "https://stackoverflow.com/questions/56041001/how-to-escape-special-symbols-in-term-query/56044194#56044194", "title": "How to escape special symbols in &quot;term&quot; query", "body": "<p>the problem was resolved with adding \"keyword\" to field's name, like</p>\n\n<pre><code>term: { \"contexts.tag.name.keyword\": 'bla-bla-bla' }\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 10190554, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Xq5Qx.png?s=128&g=1", "display_name": "Arcadia Cheese", "link": "https://stackoverflow.com/users/10190554/arcadia-cheese"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1557329330, "creation_date": 1557319068, "question_id": 56041001, "link": "https://stackoverflow.com/questions/56041001/how-to-escape-special-symbols-in-term-query", "title": "How to escape special symbols in &quot;term&quot; query", "body": "<p>I try to find records in elastic using \"term\". Like this:</p>\n\n<pre><code>bool: {\n            must: [\n              {term: {\"contexts.key\": \"resource\"}},\n              {term: {\"contexts.tag.name\": 'billing/partner_accounts'}}\n            ]\n          }\n</code></pre>\n\n<p>But search request returns nothing. Looks like it's waiting to escape slash symbol inside my term sentence. So... I tried next variants: 'billing/partner_account', 'billing/partner_account', 'billing\\/partner_account'. It didn't give success result. If replace \"term\" with \"match\" it will return results for \"contexts.tag.name\" that include \"billing\" or \"partner_accounts\" substrings. But I need to exact matching. Can you please explain what should I to do. Thanks</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "apache", "passenger", "phusion"], "comments": [{"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1557318027, "post_id": 56040578, "comment_id": 98723197, "body": "<a href=\"https://github.com/phusion/passenger/issues/1424\" rel=\"nofollow noreferrer\">github.com/phusion/passenger/issues/1424</a>"}], "answers": [{"comments": [{"owner": {"reputation": 3119, "user_id": 3106816, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/LDdbB.jpg?s=128&g=1", "display_name": "Jigar Bhatt", "link": "https://stackoverflow.com/users/3106816/jigar-bhatt"}, "edited": false, "score": 0, "creation_date": 1557561997, "post_id": 56044710, "comment_id": 98813834, "body": "Please tell me file name where i should put this kine."}, {"owner": {"reputation": 412, "user_id": 8579055, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qhYNi.jpg?s=128&g=1", "display_name": "Guillaume Bihet", "link": "https://stackoverflow.com/users/8579055/guillaume-bihet"}, "reply_to_user": {"reputation": 3119, "user_id": 3106816, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/LDdbB.jpg?s=128&g=1", "display_name": "Jigar Bhatt", "link": "https://stackoverflow.com/users/3106816/jigar-bhatt"}, "edited": false, "score": 1, "creation_date": 1557582544, "post_id": 56044710, "comment_id": 98818288, "body": "I&#39;m not familiar with Apache but should be in your passenger configuration: <a href=\"https://www.phusionpassenger.com/library/config/apache/\" rel=\"nofollow noreferrer\">phusionpassenger.com/library/config/apache</a>, probably in your Passengerfile.json (<a href=\"https://www.phusionpassenger.com/library/config/standalone/intro.html\" rel=\"nofollow noreferrer\">phusionpassenger.com/library/config/standalone/intro.html</a>), as per the Apache/Passenger intro doc: <a href=\"https://www.phusionpassenger.com/library/config/apache/intro.html\" rel=\"nofollow noreferrer\">phusionpassenger.com/library/config/apache/intro.html</a> . Hope this helps!"}], "tags": [], "owner": {"reputation": 412, "user_id": 8579055, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qhYNi.jpg?s=128&g=1", "display_name": "Guillaume Bihet", "link": "https://stackoverflow.com/users/8579055/guillaume-bihet"}, "is_accepted": false, "score": 2, "last_activity_date": 1557331090, "creation_date": 1557331090, "answer_id": 56044710, "question_id": 56040578, "link": "https://stackoverflow.com/questions/56040578/http-503-due-to-request-queue-full-configured-max-size-100-apache-passang/56044710#56044710", "title": "HTTP 503 due to: Request queue full (configured max. size: 100) apache + passanger", "body": "<p>Increase the max request queue size:</p>\n\n<pre><code>passenger_max_request_queue_size 200;\n</code></pre>\n\n<p><a href=\"https://www.phusionpassenger.com/library/config/nginx/reference/#passenger_max_request_queue_size\" rel=\"nofollow noreferrer\">https://www.phusionpassenger.com/library/config/nginx/reference/#passenger_max_request_queue_size</a></p>\n"}], "owner": {"reputation": 3119, "user_id": 3106816, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/LDdbB.jpg?s=128&g=1", "display_name": "Jigar Bhatt", "link": "https://stackoverflow.com/users/3106816/jigar-bhatt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3755, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1557331090, "creation_date": 1557317670, "last_edit_date": 1557317958, "question_id": 56040578, "link": "https://stackoverflow.com/questions/56040578/http-503-due-to-request-queue-full-configured-max-size-100-apache-passang", "title": "HTTP 503 due to: Request queue full (configured max. size: 100) apache + passanger", "body": "<p>I am using ruby on rails with phusion passenger with apache and I am\ngetting below error. Sometime my server is hangged and ssh login\nnot working. I have to reboot instance then it will work.</p>\n\n<pre><code>[Client 2-10588] Returning HTTP 503 due to: Request queue full (configured max. size: 100)\n</code></pre>\n"}, {"tags": ["c", "ruby", "ruby-c-extension"], "answers": [{"tags": [], "owner": {"reputation": 4052, "user_id": 476979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e55df1cc7d5fdb4ae9bc2afcb9afe7e4?s=128&d=identicon&r=PG", "display_name": "matthewd", "link": "https://stackoverflow.com/users/476979/matthewd"}, "is_accepted": true, "score": 3, "last_activity_date": 1557330791, "creation_date": 1557330791, "answer_id": 56044615, "question_id": 56040163, "link": "https://stackoverflow.com/questions/56040163/is-memory-freed-after-using-stringvaluecstr/56044615#56044615", "title": "Is memory freed after using StringValueCStr?", "body": "<p><code>StringValueCStr</code> returns the same pointer that <code>StringValuePtr</code> does -- which is the internal string buffer of the object.</p>\n\n<p>That buffer could change or be invalidated by any subsequent mutation of the String instance (or, of course, a garbage collection), so yes you should copy it if you need to keep it around.</p>\n"}], "owner": {"reputation": 1490, "user_id": 450651, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/9c17b51b0d1e779c2e9b0d41a9d0e888?s=128&d=identicon&r=PG", "display_name": "bigoldbrute", "link": "https://stackoverflow.com/users/450651/bigoldbrute"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 56044615, "answer_count": 1, "score": 1, "last_activity_date": 1557330791, "creation_date": 1557316251, "question_id": 56040163, "link": "https://stackoverflow.com/questions/56040163/is-memory-freed-after-using-stringvaluecstr", "title": "Is memory freed after using StringValueCStr?", "body": "<p>I use StringValueCStr to convert ruby String to char*. Do i need to free memory when this new C string is no longer needed?</p>\n\n<p>If this new C string is freed automatically, does this mean i should copy it if i plan on saving it in my C structures for later use?</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "answers": [{"comments": [{"owner": {"reputation": 1061, "user_id": 1651458, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/DQZz9.jpg?s=128&g=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/1651458/sam"}, "edited": false, "score": 0, "creation_date": 1557322383, "post_id": 56040166, "comment_id": 98725978, "body": "While I&#39;m not sure this answers the question of &#39;why/how did this happen?&#39;, replacing the schema with a checkout from master worked perfectly. Thanks!"}], "tags": [], "owner": {"reputation": 5312, "user_id": 6535997, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/10156345016155058/picture?type=large", "display_name": "Mark", "link": "https://stackoverflow.com/users/6535997/mark"}, "is_accepted": true, "score": 1, "last_activity_date": 1557316257, "creation_date": 1557316257, "answer_id": 56040166, "question_id": 56039843, "link": "https://stackoverflow.com/questions/56039843/rails-migrations-changed-unrelated-columns/56040166#56040166", "title": "rails migrations changed unrelated columns", "body": "<p>Useful info on rolling back migrations:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/3647685/how-to-rollback-a-specific-migration\">How to rollback a specific migration?</a></p>\n\n<p>Long story short, yes you can reset the structure of your database and schema.rb file. You may lose any data from columns you deleted, however if your intention is getting your schema.rb file to look right so it passes any pre-deployment hooks then rolling back and reseting your schema.rb file is the way to go:</p>\n\n<pre><code>rake db:rollback\n</code></pre>\n\n<p>Will revert your latest migration. If this migration isn't your problem one, then try:</p>\n\n<pre><code>rake db:migrate:down VERSION=20100905201547\n</code></pre>\n\n<p>With the correct version timestamp that's present in the filename of the migration. Once you've done that, you'll have fixed the database you have locally, but your schema file will still be out of sync. To fix this run</p>\n\n<pre><code>rake db:schema:dump\n</code></pre>\n\n<p>Finally if you're still having headaches, and as a last option fix, you can just</p>\n\n<pre><code>git checkout db/schema.rb\n</code></pre>\n\n<p>And you'll get the latest version of db/schema.rb that was pushed up to the branch that you're working on. Or alternatively:</p>\n\n<pre><code>git checkout origin/master db/schema.rb\n</code></pre>\n\n<p>To reset your schema.rb file to master. As long as you don't push up any broken migrations, and your schema.rb file is in order, then you won't break anything for anyone else</p>\n"}], "owner": {"reputation": 1061, "user_id": 1651458, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/DQZz9.jpg?s=128&g=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/1651458/sam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 56040166, "answer_count": 1, "score": 0, "last_activity_date": 1557316257, "creation_date": 1557315211, "question_id": 56039843, "link": "https://stackoverflow.com/questions/56039843/rails-migrations-changed-unrelated-columns", "title": "rails migrations changed unrelated columns", "body": "<p>I ran migrations which did not touch a given table in any way. After running it, 3 foreign keys which reference that table were removed and their corresponding columns changed from bigints to integers. </p>\n\n<p>This has resulted in a situation where </p>\n\n<ul>\n<li>I have an application running in production with Columns A,B,C as bigints with foreign keys, </li>\n<li>I have migrations which set them up as bigints and foreign keys, </li>\n<li>I have no migration which removes those foreign keys and </li>\n<li>I have no migration which reverts them from bigints to integers and </li>\n<li>My schema.rb defines them as integers in my commit (committed before I realized the error)</li>\n</ul>\n\n<p>an example:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code># the most recent migration related to the column\n# but an old one (not only executed on dev branch)\ndef up\n  # ...\n  change_column :abc, :table_a_id, :bigint\n  # ...\n</code></pre>\n\n<pre class=\"lang-rb prettyprint-override\"><code># development db/schema.rb\n# ...\ncreate_table \"abc\", options: \"ENGINE=InnoDB DEFAULT CHARSET=utf8\", force: :cascade do |t|\n  t.integer \"table_a_id\"\n# ...\n</code></pre>\n\n<pre class=\"lang-rb prettyprint-override\"><code># production db/schema.rb\n# ...\ncreate_table \"abc\", options: \"ENGINE=InnoDB DEFAULT CHARSET=utf8\", force: :cascade do |t|\n  t.bigint \"table_a_id\"\n# ...\nadd_foreign_key \"abc\", \"table_a\"\n# ...\n</code></pre>\n\n<p>I have run <code>rails db:reset</code>, and nothing changed.</p>\n\n<p>AFAIK, I cannot create migrations to correct these changes, since such migrations would fail in production. Is this correct? If so, what can I do to rescue the commit and prevent this from happening again? Can I manually revert my schema.rb? And why/how did this happen? </p>\n"}, {"tags": ["arrays", "ruby", "multidimensional-array"], "answers": [{"comments": [{"owner": {"reputation": 3902, "user_id": 10608621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d59df09a85d05117c63706f66811b70c?s=128&d=identicon&r=PG", "display_name": "mechnicov", "link": "https://stackoverflow.com/users/10608621/mechnicov"}, "edited": false, "score": 0, "creation_date": 1557320378, "post_id": 56041300, "comment_id": 98724635, "body": "I tried youe code with <code>loop</code> and it doesn&#39;t work correctly"}, {"owner": {"reputation": 3902, "user_id": 10608621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d59df09a85d05117c63706f66811b70c?s=128&d=identicon&r=PG", "display_name": "mechnicov", "link": "https://stackoverflow.com/users/10608621/mechnicov"}, "edited": false, "score": 0, "creation_date": 1557329494, "post_id": 56041300, "comment_id": 98730469, "body": "You fixed it. Now OK."}, {"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "reply_to_user": {"reputation": 3902, "user_id": 10608621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d59df09a85d05117c63706f66811b70c?s=128&d=identicon&r=PG", "display_name": "mechnicov", "link": "https://stackoverflow.com/users/10608621/mechnicov"}, "edited": false, "score": 0, "creation_date": 1557329844, "post_id": 56041300, "comment_id": 98730664, "body": "@mechnicov I had the upper bound hard-coded, i.e. <code>2</code> instead of <code>count - 1</code>. Was a follow-up typo from the example before. Thanks for the heads up!"}], "tags": [], "owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "is_accepted": false, "score": 2, "last_activity_date": 1557329124, "last_edit_date": 1557329124, "creation_date": 1557320047, "answer_id": 56041300, "question_id": 56039688, "link": "https://stackoverflow.com/questions/56039688/creating-and-inputting-data-into-nested-arrays-ruby/56041300#56041300", "title": "Creating and inputting data into nested arrays - Ruby", "body": "<p>First of all, you have to create the nested array based on the given number:</p>\n\n<pre><code>puts 'Enter number of groups'\ncount = gets.to_i\ngroups = Array.new(count) { [] }\n</code></pre>\n\n<p>If the user enters <kbd>3</kbd>, you'd have an array containing 3 other arrays:</p>\n\n<pre><code>groups = Array.new(3) { [] }\n#=&gt; [[], [], []]\n</code></pre>\n\n<p>It's important to use the <em>block form</em> for <a href=\"http://ruby-doc.org/core-2.6.3/Array.html#method-c-new\" rel=\"nofollow noreferrer\"><code>Array.new</code></a> so each inner array is a separate instance. (see \"Common gotchas\" in the docs)</p>\n\n<p>With the nested structure in place, we can append the names to the inner arrays. Either by using a \"counter\" variable <code>i</code> and pushing to <code>group[i]</code>:</p>\n\n<pre><code>puts 'Enter names or \"stop\" when done'\n\ni = 0                  # start at 0\nloop do\n  user_input = gets.chomp\n  break if user_input == 'stop'\n  groups[i].push(user_input)\n\n  if i &lt; count - 1\n    i += 1             # increment\n  else\n    i = 0              # start over\n  end\nend\n</code></pre>\n\n<p>Or \u2013 much more elegant \u2013 via <a href=\"http://ruby-doc.org/core-2.6.3/Array.html#method-i-cycle\" rel=\"nofollow noreferrer\"><code>cycle</code></a>:</p>\n\n<pre><code>puts 'Enter names or \"stop\" when done'\n\ngroups.cycle do |group|\n  user_input = gets.chomp\n  break if user_input == 'stop'\n  group.push(user_input)\nend\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3, "user_id": 3115449, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a0Y65.jpg?s=128&g=1", "display_name": "Joe-t", "link": "https://stackoverflow.com/users/3115449/joe-t"}, "edited": false, "score": 0, "creation_date": 1557388073, "post_id": 56051489, "comment_id": 98749841, "body": "Thanks so much for your help! I&#39;m having trouble using the first example you gave - it works perfectly but I can&#39;t figure out how to then access the array, what is it called? If I wanted to say access the second array what would I do?  the <code>0.step do |i|</code> you gave makes the most sense in my head but it wont run for me."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "reply_to_user": {"reputation": 3, "user_id": 3115449, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a0Y65.jpg?s=128&g=1", "display_name": "Joe-t", "link": "https://stackoverflow.com/users/3115449/joe-t"}, "edited": false, "score": 0, "creation_date": 1557388839, "post_id": 56051489, "comment_id": 98750268, "body": "I&#39;ll get back to you tomorrow, but in the meantime, please be more specific about <code>o.step do |i|</code> &quot;won&#39;t run for me&quot;. Is an exception raised? If so what is the error message and on what line does the error occur? What version of Ruby are you using?"}, {"owner": {"reputation": 3, "user_id": 3115449, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a0Y65.jpg?s=128&g=1", "display_name": "Joe-t", "link": "https://stackoverflow.com/users/3115449/joe-t"}, "edited": false, "score": 0, "creation_date": 1557389835, "post_id": 56051489, "comment_id": 98750833, "body": "ah sorry! Im using repl.it - 2.5.0  <code>undefined method </code>&lt;&lt;&#39; for nil:NilClass (repl):9:in <code>block in &lt;main&gt;&#39; (repl):5:in </code>step&#39; (repl):5:in <code>&lt;main&gt;&#39;</code>"}], "tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": false, "score": 0, "last_activity_date": 1557369795, "creation_date": 1557369795, "answer_id": 56051489, "question_id": 56039688, "link": "https://stackoverflow.com/questions/56039688/creating-and-inputting-data-into-nested-arrays-ruby/56051489#56051489", "title": "Creating and inputting data into nested arrays - Ruby", "body": "<p>After having obtained the number of groups, say</p>\n\n<pre><code>ngroups = 3\n</code></pre>\n\n<p>the code will prompt the user to enter a series of names, followed by <code>\"stop\"</code> when the user has no more names to enter. Suppose the user enters the following strings, in the order indicated: </p>\n\n<pre><code>\"Lucy\\n\", \"Hank\\n\", \"Billy-Bob\\n\", \"Trixie\\n\", \"Veronica\\n\", \"Roxy\\n\",\n\"Norm\\n\", \"Herb\\n\", \"stop\\n\" \n</code></pre>\n\n<p>We could create the desired array with the following code:</p>\n\n<pre><code>0.step.with_object(Array.new(ngroups) { [] }) do |i,a|\n  print 'Please enter a name or \"stop\" if finished: '\n  reply = gets.chomp\n  break a if reply == \"stop\"\n  a[i % ngroups] &lt;&lt; reply     \nend\n  #=&gt; [[\"Lucy\", \"Trixie\", \"Norm\"], [\"Hank\", \"Veronica\", \"Herb\"],\n  #    [\"Billy-Bob\", \"Roxy\"]]\n</code></pre>\n\n<p>Note that I did not ask the user to enter a group for each name. That's because you said names were to be assigned to groups in group-order, resuming with the first group after each assignment of a name to the last group.</p>\n\n<p>For anyone new to Ruby this code must look fairly complicated. It is, however, very Ruby-like, and any Rubiest will understand it immediately after having gained some experience with the language. Let me break down the steps. With patience you should be able to understand what's going on.</p>\n\n<p><strong><a href=\"http://ruby-doc.org/core-2.5.1/Numeric.html#method-i-step\" rel=\"nofollow noreferrer\">Numeric#step</a>, an enumerator</strong></p>\n\n<pre><code>enum0 = 0.step #=&gt; (0.step)\n</code></pre>\n\n<p>If you examine the doc for this method you will see that <code>0.step</code> without a block returns an enumerator, which is an instance of the class <a href=\"http://ruby-doc.org/core-2.5.1/Enumerator.html\" rel=\"nofollow noreferrer\">Enumerator</a>. Enumerators are very important in Ruby. They generate values which may be passed to other methods or to block. Here, <code>enum0</code> generates the following sequence:</p>\n\n<pre><code>enum0.next #=&gt; 0\nenum0.next #=&gt; 1\nenum0.next #=&gt; 2\n</code></pre>\n\n<p>...<em>ad infinitum</em>. See <a href=\"http://ruby-doc.org/core-2.5.1/Enumerator.html#method-i-next\" rel=\"nofollow noreferrer\">Enumerator#next</a>.</p>\n\n<p>Similarly,</p>\n\n<pre><code>e = 21.step(by: -3) #=&gt; (21.step(by: -3)) \ne.next #=&gt; 21 \ne.next #=&gt; 18 \n\ne = 2.34.step #=&gt; (2.34.step) \ne.next #=&gt; 2.34 \ne.next #=&gt; 3.34 \n</code></pre>\n\n<p><strong><a href=\"http://ruby-doc.org/core-2.5.1/Enumerator.html#method-i-with_object\" rel=\"nofollow noreferrer\">Enumerator#with_object</a></strong></p>\n\n<p>We don't actually need to use this method. We could instead write the following, which gives the same result:</p>\n\n<pre><code>a = []\n0.step do |i|\n  print 'Please enter a name or \"stop\" if finished: '\n  reply = gets.chomp\n  break a if reply == \"stop\"\n  a[i % ngroups] &lt;&lt; reply     \nend\na\n</code></pre>\n\n<p>As you see, the use of <code>each_object</code> merely saves two lines of code: <code>a = []</code> and <code>a</code> at the end.<sup>1</sup>. This method--and its cousin, <a href=\"http://ruby-doc.org/core-2.5.1/Enumerable.html\" rel=\"nofollow noreferrer\">Enumerable#each_with_object</a>, which are widely-used by Ruby coders, are actually quite simple.</p>\n\n<p><strong>Another enumerator</strong></p>\n\n<p>Next we have:</p>\n\n<pre><code>enum1 = enum0.with_object(Array.new(ngroups) { [] })\n  #=&gt; #&lt;Enumerator: (0.step):with_object([[], [], []])&gt;\n</code></pre>\n\n<p>As you see from the return value for <code>enum1</code>, <code>enum1</code> can be thought of as a <em>compound enumerator</em>, though Ruby has no such formal concept. Let's see what values this enumerator generates:</p>\n\n<pre><code>enum1.next #=&gt; [0, [[], [], []]] \nenum1.next #=&gt; [1, [[], [], []]] \nenum1.next #=&gt; [2, [[], [], []]] \n</code></pre>\n\n<p>You see that each value generated is an array of two elements, the first a counter starting at zero, the second an array of three groups. The groups are now empty but they will be filled out as calculations proceed.</p>\n\n<p>If we wished we could now write the original code as follows<sup>1</sup></p>\n\n<pre><code>enum1.each do |i,a|\n  print 'Please enter a name or \"stop\" if finished: '\n  reply = gets.chomp\n  break a if reply == \"stop\"\n  a[i % ngroups] &lt;&lt; reply     \nend\n</code></pre>\n\n<p>See <a href=\"http://ruby-doc.org/core-2.5.1/Enumerator.html#method-i-each\" rel=\"nofollow noreferrer\">Enumerator#each</a>.</p>\n\n<p><strong>Passing elements generated by <code>enum1</code> to the block</strong></p>\n\n<p>When the first element is generated and passed to the block, the block variables <code>i</code> and <code>a</code> are assigned values as follows:</p>\n\n<pre><code>i, a = enum1.next #=&gt; [0, [[], [], []]] \ni #=&gt; 0 \na #=&gt; [[], [], []]   \n</code></pre>\n\n<p>The process of breaking the array returned by <code>enum1.next</code> into its components is called <a href=\"https://docs.ruby-lang.org/en/2.6.0/syntax/assignment_rdoc.html#label-Array+Decomposition\" rel=\"nofollow noreferrer\">array decomposition</a>. It is a powerful and valuable tool.</p>\n\n<p>We can now perform the block operations.</p>\n\n<pre><code>print 'Please enter a name or \"stop\" if finished: '\nreply = \"Lucy\" # = gets.chomp\nbreak a if reply == \"stop\" # do not break\na[i % ngroups] &lt;&lt; reply     \n  #=&gt; a[0 % 3] &lt;&lt; \"Lucy\"\n  #=&gt; a[0] &lt;&lt; \"Lucy\"\n  #=&gt; [\"Lucy\"]\n</code></pre>\n\n<p>Next <code>enum1</code> generates it's second value and passes it to the block, values are assigned to the block variables and the block operations are performed.</p>\n\n<pre><code>i, a = enum1.next #=&gt; [1, [[\"Lucy\"], [], []]] \ni #=&gt; 1 \na #=&gt; [[\"Lucy\"], [], []]   \n</code></pre>\n\n<p>Notice that <code>a</code> has been update to reflect <code>\"Lucy\"</code> having been appended to <code>a[0]</code>. Continuing,</p>\n\n<pre><code>print 'Please enter a name or \"stop\" if finished: '\nreply = \"Hank\" # = gets.chomp\nbreak a if reply == \"stop\" # do not break\na[i % ngroups] &lt;&lt; reply\n  #=&gt; a[1 % 3] &lt;&lt; \"Hank\"\n  #=&gt; a[1] &lt;&lt; \"Hank\"\n  #=&gt; [\"Hank\"]\n</code></pre>\n\n<p>Now,</p>\n\n<pre><code>a #=&gt; =&gt; [[\"Lucy\"], [\"Hank\"], []]\n</code></pre>\n\n<p>The remaining calculations are similar.</p>\n\n<p><sup>1. Before running the following I need to execute <code>enum1.rewind</code> to re-initialise the enumerator. See <a href=\"http://ruby-doc.org/core-2.5.1/Enumerator.html#method-i-rewind\" rel=\"nofollow noreferrer\">Enumerator#rewind</a>.</sup></p>\n"}], "owner": {"reputation": 3, "user_id": 3115449, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a0Y65.jpg?s=128&g=1", "display_name": "Joe-t", "link": "https://stackoverflow.com/users/3115449/joe-t"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1557369795, "creation_date": 1557314737, "last_edit_date": 1557317963, "question_id": 56039688, "link": "https://stackoverflow.com/questions/56039688/creating-and-inputting-data-into-nested-arrays-ruby", "title": "Creating and inputting data into nested arrays - Ruby", "body": "<p>I am trying to make a programme that takes names and adds them into arrays. The trick is I need to store them in nested arrays, so I ask the user for a number - this defines the number of groups. Then the user is asked for names - these need to then be sorted as such...</p>\n\n<ul>\n<li>As an example, imagine there are three groups.\n\n<ul>\n<li>First person goes in the first group.</li>\n<li>Second person goes in the second group.</li>\n<li>Third person goes in the third group.</li>\n<li>Fourth person goes in the first group.</li>\n<li>Fifth person goes in the second group.</li>\n<li>etc.</li>\n</ul></li>\n</ul>\n\n<p>I'm working on the conditions, and they are pretty much OK I think.\nBut the rest of it I'm pretty stumped on...I dont really understand how I'm meant to send them to nested arrays.</p>\n\n<pre><code>groups = []\n\n#enter the number of groups\nputs \"give me a number\"\ncount = gets.to_i\n\nwhile true do\n\nputs 'Give me a name'\nuser_input = gets.chomp\ngroups.push(user_input)\ngroups.delete(\"stop\")\n\nif user_input == \"stop\"\n\nputs \"Give me a group number\"\nputs groups[gets.to_i]\n\n#puts'es the names from that group\n\nbreak\n\nend\nend\n</code></pre>\n\n<p>This doesn't seem a million miles off, but I'm not really sure where I'm going with it.</p>\n\n<pre><code>count = 3\nuser_input = [\"joe\",\"sally\",\"frank\"]\n\ngroups = Array.new(count) {Array.new(user_input)}\n</code></pre>\n\n<p>Any help would be SO appreciated, very very new to this</p>\n"}, {"tags": ["arrays", "ruby", "hash"], "comments": [{"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1557331771, "post_id": 56039496, "comment_id": 98731592, "body": "1. Can the &quot;expected result&quot; contain a value (hash) for which <code>Rate = nil</code>? 2. Can <code>array_of_hashes</code> contain two elements having the same values for <code>&quot;ID&quot;</code> and <code>&quot;Date&quot;</code> and neither has a <code>nil</code> value for <code>&quot;Rate&quot;</code>? If &quot;yes&quot;, which should be selected?"}], "answers": [{"comments": [{"owner": {"reputation": 670, "user_id": 386991, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2dba4ca7b639638aaf4039f98dee69f5?s=128&d=identicon&r=PG", "display_name": "Machisuji", "link": "https://stackoverflow.com/users/386991/machisuji"}, "reply_to_user": {"reputation": 3959, "user_id": 1381266, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/7ac54c032c1dd24a5e6c737d06b83a03?s=128&d=identicon&r=PG", "display_name": "Galet", "link": "https://stackoverflow.com/users/1381266/galet"}, "edited": false, "score": 0, "creation_date": 1557314867, "post_id": 56039624, "comment_id": 98721483, "body": "You don&#39;t want the rows where rate is nil I assume?"}, {"owner": {"reputation": 3959, "user_id": 1381266, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/7ac54c032c1dd24a5e6c737d06b83a03?s=128&d=identicon&r=PG", "display_name": "Galet", "link": "https://stackoverflow.com/users/1381266/galet"}, "edited": false, "score": 0, "creation_date": 1557315130, "post_id": 56039624, "comment_id": 98721632, "body": "Yes. I want the rows where rate is not nil and input records are in shuffled every-time"}, {"owner": {"reputation": 3959, "user_id": 1381266, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/7ac54c032c1dd24a5e6c737d06b83a03?s=128&d=identicon&r=PG", "display_name": "Galet", "link": "https://stackoverflow.com/users/1381266/galet"}, "edited": false, "score": 0, "creation_date": 1557316862, "post_id": 56039624, "comment_id": 98722555, "body": "Why .last is needed here?"}, {"owner": {"reputation": 670, "user_id": 386991, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2dba4ca7b639638aaf4039f98dee69f5?s=128&d=identicon&r=PG", "display_name": "Machisuji", "link": "https://stackoverflow.com/users/386991/machisuji"}, "reply_to_user": {"reputation": 3959, "user_id": 1381266, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/7ac54c032c1dd24a5e6c737d06b83a03?s=128&d=identicon&r=PG", "display_name": "Galet", "link": "https://stackoverflow.com/users/1381266/galet"}, "edited": false, "score": 1, "creation_date": 1557316948, "post_id": 56039624, "comment_id": 98722614, "body": "It is if we want the result you specified where only one row is returned. If you want potentially several rows per ID-Date tuple you can just simply drop the .last."}], "tags": [], "owner": {"reputation": 670, "user_id": 386991, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2dba4ca7b639638aaf4039f98dee69f5?s=128&d=identicon&r=PG", "display_name": "Machisuji", "link": "https://stackoverflow.com/users/386991/machisuji"}, "is_accepted": false, "score": 1, "last_activity_date": 1557315364, "last_edit_date": 1557315364, "creation_date": 1557314525, "answer_id": 56039624, "question_id": 56039496, "link": "https://stackoverflow.com/questions/56039496/how-to-remove-duplicate-row-in-array-of-hashes-on-ruby-on-rails/56039624#56039624", "title": "How to remove duplicate row in array of hashes on Ruby on rails", "body": "<p>Use group_by and filter nil rates from the values.</p>\n\n<pre><code>array_of_hashes\n  .group_by { |h| [h[\"ID\"], h[\"Date\"]] }\n  .map { |key, values| [key, values.reject { |row| row[\"Rate\"].nil? }.last] }\n  .to_h\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1557332441, "post_id": 56044929, "comment_id": 98731882, "body": "...or <code>!r[&quot;Rate&quot;].nil?</code> to read better (?) and not worry about the value of <code>&quot;Rate&quot;</code> being <code>false</code> (however unlikely that may be)."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "reply_to_user": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1557333006, "post_id": 56044929, "comment_id": 98732097, "body": "@CarySwoveland Really you think that reads better? I would prefer <code>v.lazy.reject {|r| r[&quot;Rate&quot;].nil? }.first</code> over that and to the same effect as <code>find</code> first non <code>nil</code> rate hash returned without regard for other hashes in the group."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1557333361, "post_id": 56044929, "comment_id": 98732259, "body": "&quot;Reads better&quot; because when I see <code>{|r| r[&quot;Rate&quot;]}</code> the question, &quot;what about <code>false</code>?&quot; immediately comes to mind and requires processing. My <code>&quot;(?)&quot;</code> reflects the need for <code>!</code>. What I&#39;d really like is <code>{|r| r[&quot;Rate&quot;].non_nil? }</code>."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "reply_to_user": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1557334752, "post_id": 56044929, "comment_id": 98732919, "body": "@CarySwoveland you could go with something super ugly like <code>r unless r[&#39;Rate&#39;].nil?</code>"}], "tags": [], "owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "is_accepted": true, "score": 3, "last_activity_date": 1557331900, "creation_date": 1557331900, "answer_id": 56044929, "question_id": 56039496, "link": "https://stackoverflow.com/questions/56039496/how-to-remove-duplicate-row-in-array-of-hashes-on-ruby-on-rails/56044929#56044929", "title": "How to remove duplicate row in array of hashes on Ruby on rails", "body": "<p>Here is another group by option </p>\n\n<pre><code>array_of_hashes.group_by {|h| h.values_at(\"ID\",\"Date\")}.transform_values do |v|   \n  v.find {|r| r[\"Rate\"]}\nend\n\n#=&gt; {[100, \"2019-05-6\"]=&gt;{\"Date\"=&gt;\"2019-05-6\", \"ID\"=&gt;100, \"Rate\"=&gt;10, \"Count\"=&gt;1}, \n#    [101, \"2019-05-6\"]=&gt;{\"Date\"=&gt;\"2019-05-6\", \"ID\"=&gt;101, \"Rate\"=&gt;25, \"Count\"=&gt;3}, \n#    [102, \"2019-05-6\"]=&gt;{\"Date\"=&gt;\"2019-05-6\", \"ID\"=&gt;102, \"Rate\"=&gt;35, \"Count\"=&gt;0}, \n#    [103, \"2019-05-6\"]=&gt;{\"Date\"=&gt;\"2019-05-6\", \"ID\"=&gt;103, \"Rate\"=&gt;20, \"Count\"=&gt;6}}\n</code></pre>\n\n<p>group by id and date then transform the <code>Hash</code> values to the first <code>Hash</code> where \"Rate\" is not <code>nil</code>. </p>\n\n<p>If multiple values are acceptable then <code>find_all</code> or <code>select</code> could be substituted for <code>find</code>.</p>\n\n<p>If you want the original structure maintained just add <code>values</code> to the end.</p>\n"}, {"comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557347158, "post_id": 56045804, "comment_id": 98738556, "body": "for the first solution you could go with <code>if h.dig(k,&#39;Rate&#39;).nil?</code> it is fail fast so the result would be the same."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557348394, "post_id": 56045804, "comment_id": 98739091, "body": "@engineersmnky, I&#39;ve not seen that before. Clever!"}], "tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": false, "score": 2, "last_activity_date": 1557335229, "creation_date": 1557335229, "answer_id": 56045804, "question_id": 56039496, "link": "https://stackoverflow.com/questions/56039496/how-to-remove-duplicate-row-in-array-of-hashes-on-ruby-on-rails/56045804#56045804", "title": "How to remove duplicate row in array of hashes on Ruby on rails", "body": "<p>We can construct the desired hash by making a single pass through <code>array_of_hashes</code>.</p>\n\n<pre><code>array_of_hashes.each_with_object({}) do |g,h|\n  k = [g['ID'], g['Date']]\n  h.update(k=&gt;g) unless h.key?(k) &amp;&amp; h[k]['Rate'] != nil\nend\n  #=&gt; {[100, \"2019-05-6\"]=&gt;{\"Date\"=&gt;\"2019-05-6\", \"ID\"=&gt;100, \"Rate\"=&gt;10, \"Count\"=&gt;1},\n  #    [101, \"2019-05-6\"]=&gt;{\"Date\"=&gt;\"2019-05-6\", \"ID\"=&gt;101, \"Rate\"=&gt;25, \"Count\"=&gt;3},\n  #    [102, \"2019-05-6\"]=&gt;{\"Date\"=&gt;\"2019-05-6\", \"ID\"=&gt;102, \"Rate\"=&gt;35, \"Count\"=&gt;0},\n  #    [103, \"2019-05-6\"]=&gt;{\"Date\"=&gt;\"2019-05-6\", \"ID\"=&gt;103, \"Rate\"=&gt;20, \"Count\"=&gt;6}}\n</code></pre>\n\n<p>This assumes that if two elements of <code>array_of_hashes</code> match on the values of <code>'ID'</code> and <code>'Date'</code>, and neither has a value of <code>nil</code> for <code>'Rate'</code>, the first of the two hashes is retained. If the latter of the two should be retained change the second line of the method to:</p>\n\n<pre><code>h.update(k=&gt;g) unless h.key?(k) &amp;&amp; g['Rate'].nil?\n</code></pre>\n"}], "owner": {"reputation": 3959, "user_id": 1381266, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/7ac54c032c1dd24a5e6c737d06b83a03?s=128&d=identicon&r=PG", "display_name": "Galet", "link": "https://stackoverflow.com/users/1381266/galet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 56044929, "answer_count": 3, "score": 1, "last_activity_date": 1557335229, "creation_date": 1557314150, "last_edit_date": 1557316134, "question_id": 56039496, "link": "https://stackoverflow.com/questions/56039496/how-to-remove-duplicate-row-in-array-of-hashes-on-ruby-on-rails", "title": "How to remove duplicate row in array of hashes on Ruby on rails", "body": "<p>I am using Ruby 2.6 in my application.</p>\n\n<p>I want to remove the duplicate element in array of hashes. Here is my input</p>\n\n<pre><code>array_of_hashes = [\n{\"Date\"=&gt; \"2019-05-6\", \"ID\" =&gt; 100, \"Rate\" =&gt; 10, \"Count\" =&gt; 1},\n{\"Date\"=&gt; \"2019-05-6\", \"ID\" =&gt; 100, \"Rate\" =&gt; nil, \"Count\" =&gt; 0},\n{\"Date\"=&gt; \"2019-05-6\", \"ID\" =&gt; 101, \"Rate\" =&gt; 25, \"Count\" =&gt; 3},\n{\"Date\"=&gt; \"2019-05-6\", \"ID\" =&gt; 102, \"Rate\" =&gt; nil, \"Count\" =&gt; 0},\n{\"Date\"=&gt; \"2019-05-6\", \"ID\" =&gt; 102, \"Rate\" =&gt; 35, \"Count\" =&gt; 0},\n{\"Date\"=&gt; \"2019-05-6\", \"ID\" =&gt; 103, \"Rate\" =&gt; 20, \"Count\" =&gt; 6}\n]\n</code></pre>\n\n<p>I am creating key, value pair from the hash for the need of my application.</p>\n\n<pre><code>result = array_of_hashes.map { |row| [[row['ID'], row['Date'], row] }.to_h\n</code></pre>\n\n<p>If there are two records with same \"ID\" and \"Date\" values in a hash, I want to rows the row where \"Rate\" != 0 where input records order might shuffle. Here is my Actual and Expected result.</p>\n\n<p>Actual Result:</p>\n\n<pre><code> {[100, \"2019-05-6\"]=&gt;{\"Date\"=&gt;\"2019-05-6\", \"ID\"=&gt;100, \"Rate\"=&gt;nil, \"Count\"=&gt;0},\n [101, \"2019-05-6\"]=&gt;{\"Date\"=&gt;\"2019-05-6\", \"ID\"=&gt;101, \"Rate\"=&gt;25, \"Count\"=&gt;3},\n [102, \"2019-05-6\"]=&gt;{\"Date\"=&gt;\"2019-05-6\", \"ID\"=&gt;102, \"Rate\"=&gt;35, \"Count\"=&gt;0},\n [103, \"2019-05-6\"]=&gt;{\"Date\"=&gt;\"2019-05-6\", \"ID\"=&gt;103, \"Rate\"=&gt;20, \"Count\"=&gt;6}}\n</code></pre>\n\n<p>Expected result:  </p>\n\n<pre><code> {[100, \"2019-05-6\"]=&gt;{\"Date\"=&gt;\"2019-05-6\", \"ID\"=&gt;100, \"Rate\"=&gt;10, \"Count\"=&gt;1}, \n [101, \"2019-05-6\"]=&gt;{\"Date\"=&gt;\"2019-05-6\", \"ID\"=&gt;101, \"Rate\"=&gt;25, \"Count\"=&gt;3},\n [102, \"2019-05-6\"]=&gt;{\"Date\"=&gt;\"2019-05-6\", \"ID\"=&gt;102, \"Rate\"=&gt;35, \"Count\"=&gt;0},\n [103, \"2019-05-6\"]=&gt;{\"Date\"=&gt;\"2019-05-6\", \"ID\"=&gt;103, \"Rate\"=&gt;20, \"Count\"=&gt;6}}\n</code></pre>\n\n<p>How can I get the above expected result?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "discourse", "logster"], "comments": [{"owner": {"reputation": 426, "user_id": 10779129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d35424620414bc0b202be3669ebe8c2?s=128&d=identicon&r=PG&f=1", "display_name": "kcsujeet", "link": "https://stackoverflow.com/users/10779129/kcsujeet"}, "edited": false, "score": 2, "creation_date": 1557313541, "post_id": 56038165, "comment_id": 98720762, "body": "So, after hours of going through the code and looking up in google for a possible solution, i figured out that I hadn&#39;t set environment for Logster. I  had to add &quot;local&quot; also to the list of environments in application.rb for Logster."}], "owner": {"reputation": 426, "user_id": 10779129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d35424620414bc0b202be3669ebe8c2?s=128&d=identicon&r=PG&f=1", "display_name": "kcsujeet", "link": "https://stackoverflow.com/users/10779129/kcsujeet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 52, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1557310401, "creation_date": 1557309850, "last_edit_date": 1557310401, "question_id": 56038165, "link": "https://stackoverflow.com/questions/56038165/logster-displaying-empty-log-messages", "title": "Logster displaying empty log messages", "body": "<p>I'm using <code>logster gem</code> to display logs. Everything is working fine except that no log messages are being displayed. \nCan anyone help me with this problem?</p>\n\n<p>In the network tab in my browser console, I can see that the GET request at </p>\n\n<p><code>\"/logs/messages.json?filter=0_1_2_3_4_5\"</code> </p>\n\n<p>is returning empty messages as</p>\n\n<p><code>{messages: [], total: 0, search: \"\", filter: [0, 1, 2, 3, 4, 5]}</code></p>\n\n<p>My Redis server is up and running. And I've set up the Logster store in <code>application.rb</code> as </p>\n\n<p><code>Logster.store = Logster::RedisStore.new</code></p>\n\n<p>In my <code>routes.rb</code> I've set up the routes as</p>\n\n<p><code>mount Logster::Web =&gt; \"/logs\"</code>.</p>\n\n<p>As shown <a href=\"http://logster.info/logs/\" rel=\"nofollow noreferrer\">here</a> a list of log messages should be shown but mine is just plain white background as there are no log messages.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ckeditor4.x"], "answers": [{"comments": [{"owner": {"reputation": 99, "user_id": 1961804, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d418968f8f4f12bdfd0155427f7ac4?s=128&d=identicon&r=PG", "display_name": "Mendy", "link": "https://stackoverflow.com/users/1961804/mendy"}, "edited": false, "score": 0, "creation_date": 1557309386, "post_id": 56037400, "comment_id": 98718338, "body": "Thanks for quick response. The proposed code works fine. However is there any libraries or gems available that can do the same thing? For example to convert wiki or .md files there is something like GitHub::Markup.render or Redcarpet::Markdown etc. Similar to that do we have any existing text2html libs to use instead ?"}, {"owner": {"reputation": 3902, "user_id": 10608621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d59df09a85d05117c63706f66811b70c?s=128&d=identicon&r=PG", "display_name": "mechnicov", "link": "https://stackoverflow.com/users/10608621/mechnicov"}, "reply_to_user": {"reputation": 99, "user_id": 1961804, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d418968f8f4f12bdfd0155427f7ac4?s=128&d=identicon&r=PG", "display_name": "Mendy", "link": "https://stackoverflow.com/users/1961804/mendy"}, "edited": false, "score": 0, "creation_date": 1557316018, "post_id": 56037400, "comment_id": 98722092, "body": "@Mendy, I don&#39;t remember gems that convert such strings. Redcarpet convert markdown strings."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557322123, "post_id": 56037400, "comment_id": 98725802, "body": "You could also use <code>&amp;emsp;</code> in place of the tab character which is more representational of a tab in my opinion as it essentially represents <code>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;</code>"}, {"owner": {"reputation": 3902, "user_id": 10608621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d59df09a85d05117c63706f66811b70c?s=128&d=identicon&r=PG", "display_name": "mechnicov", "link": "https://stackoverflow.com/users/10608621/mechnicov"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 1, "creation_date": 1557322546, "post_id": 56037400, "comment_id": 98726081, "body": "@engineersmnky, good idea, I think so. But the OP wanted two whitespaces."}], "tags": [], "owner": {"reputation": 3902, "user_id": 10608621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d59df09a85d05117c63706f66811b70c?s=128&d=identicon&r=PG", "display_name": "mechnicov", "link": "https://stackoverflow.com/users/10608621/mechnicov"}, "is_accepted": false, "score": 2, "last_activity_date": 1557307219, "creation_date": 1557307219, "answer_id": 56037400, "question_id": 56036621, "link": "https://stackoverflow.com/questions/56036621/convert-simple-text-into-html-honoring-newlines-whitespaces-and-tabs/56037400#56037400", "title": "Convert simple text into html honoring newlines whitespaces and tabs", "body": "<p>You can just use <code>String.gsub</code> for this:</p>\n\n<pre><code>text_content = \"firstline\\nsecond   line \\n\\n\\nthird line\\t\\taftertab\"\n\ntext_content.gsub(/\\s/, \"\\n\" =&gt; \"&lt;br/&gt;\", \"\\t\" =&gt; \"&amp;nbsp;&amp;nbsp;\", \" \" =&gt; \"&amp;nbsp;\")\n# =&gt; \"firstline&lt;br/&gt;second&amp;nbsp;&amp;nbsp;&amp;nbsp;line&amp;nbsp;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;third&amp;nbsp;line&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;aftertab\"\n</code></pre>\n"}], "owner": {"reputation": 99, "user_id": 1961804, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d418968f8f4f12bdfd0155427f7ac4?s=128&d=identicon&r=PG", "display_name": "Mendy", "link": "https://stackoverflow.com/users/1961804/mendy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1557307219, "creation_date": 1557304397, "question_id": 56036621, "link": "https://stackoverflow.com/questions/56036621/convert-simple-text-into-html-honoring-newlines-whitespaces-and-tabs", "title": "Convert simple text into html honoring newlines whitespaces and tabs", "body": "<p>Writing a method to convert simple text file into html so that it can be integrated inside ckeditor. However we are unable to convert whitespaces, tabs and new lines with any RoR gems </p>\n\n<p>I have tried with </p>\n\n<pre><code>output_html = ActionController::Base.helpers.simple_format(contents)\noutput_html = output_html.gsub(/ (?= )/, '&amp;nbsp;')\n</code></pre>\n\n<pre><code>text_content = \"firstline\\nsecond   line \\n\\n\\nthird line\\t\\taftertab\"\n\noutput_html = \"firstline&lt;br/&gt;second&amp;nbsp;&amp;nbsp;line&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;third&lt;br/&gt;line&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;aftertab\"\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "json", "ruby"], "comments": [{"owner": {"reputation": 1173, "user_id": 9418609, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o0aMF.jpg?s=128&g=1", "display_name": "uday", "link": "https://stackoverflow.com/users/9418609/uday"}, "edited": false, "score": 0, "creation_date": 1557301403, "post_id": 56035634, "comment_id": 98714161, "body": "firstly you need to properly format data into proper json format"}, {"owner": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "edited": false, "score": 1, "creation_date": 1557301518, "post_id": 56035634, "comment_id": 98714215, "body": "^ yes, even just one of these lines on its own is not valid JSON, you need to wrap keys in quotes"}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 1, "creation_date": 1557302046, "post_id": 56035634, "comment_id": 98714473, "body": "Would not <code>File.readlines.map(&amp;method(:eval))</code> suffice?"}], "answers": [{"comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557322685, "post_id": 56036382, "comment_id": 98726163, "body": "This falls apart if there are any multi line object like say an <code>Array</code> or <code>Hash</code> that is arranged vertically."}], "tags": [], "owner": {"reputation": 2386, "user_id": 2933305, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/223ba397b1fef4a7bec7bfc59ca74f11?s=128&d=identicon&r=PG", "display_name": "maicher", "link": "https://stackoverflow.com/users/2933305/maicher"}, "is_accepted": false, "score": 0, "last_activity_date": 1557303883, "last_edit_date": 1557303883, "creation_date": 1557303553, "answer_id": 56036382, "question_id": 56035634, "link": "https://stackoverflow.com/questions/56035634/how-to-parse-large-json-files-with-formating-error/56036382#56036382", "title": "How to Parse LARGE JSON files with formating error", "body": "<p>Don't use <code>JSON.parse</code>, beacuse the file's content is not a JSON. Each line from this file looks like a Ruby hash, so different parsing method could be used.</p>\n\n<p>You should be able to parse each line by using: <code>YAML.load(line)</code>.</p>\n\n<p>Also, beacuse the file is big, don't load the whole file into memory. Use <a href=\"https://ruby-doc.org/core-2.3.1/IO.html#method-c-foreach\" rel=\"nofollow noreferrer\"><code>File.foreach</code></a> to load line by line.</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>require 'yaml'\n\nlines = []\nFile.foreach('testfile.json') do |line|\n  lines &lt;&lt; YAML.load(line)      \nend\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "is_accepted": false, "score": 3, "last_activity_date": 1557305536, "last_edit_date": 1557305536, "creation_date": 1557304742, "answer_id": 56036711, "question_id": 56035634, "link": "https://stackoverflow.com/questions/56035634/how-to-parse-large-json-files-with-formating-error/56036711#56036711", "title": "How to Parse LARGE JSON files with formating error", "body": "<p>The error message you got (<em>\"Found multiple JSON objects in the stream \u2026\"</em>) implies that your input contains multiple but <em>valid</em> JSON objects, so I assume your actual file looks more like this:</p>\n\n<pre><code>{\"title\":\"Don Quixote\",\"author\":\"Miguel de Cervantes\",\"printyear\":2010}\n{\"title\":\"Great Gatsby\",\"author\":\"F. Scott Fitzgerald\",\"printyear\":2014}\n{\"title\":\"Ulysses\",\"author\":\"James Joyce\",\"printyear\":2010}\n</code></pre>\n\n<p>One of YAJL's feature is to:</p>\n\n<blockquote>\n  <p>Parse and encode <em>multiple</em> JSON objects to and from streams or strings continuously.</p>\n</blockquote>\n\n<p>So given above input (as a file or string), you can pass a <em>block</em> to <code>parse</code> which will be called for each parsed object:</p>\n\n<pre><code>require 'yajl'\n\nio = File.open('testfile.json')\n\nYajl::Parser.parse(io) do |book|\n  puts \"\u201c#{book['title']}\u201d by #{book['author']} (#{book['printyear']})\"\nend\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>\u201cDon Quixote\u201d by Miguel de Cervantes (2010)\n\u201cGreat Gatsby\u201d by F. Scott Fitzgerald (2014)\n\u201cUlysses\u201d by James Joyce (2010)\n</code></pre>\n"}], "owner": {"reputation": 1216, "user_id": 154522, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8d88a2dfba196c0f83804b73a9aba905?s=128&d=identicon&r=PG", "display_name": "Tolga", "link": "https://stackoverflow.com/users/154522/tolga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1557305536, "creation_date": 1557300551, "last_edit_date": 1557300678, "question_id": 56035634, "link": "https://stackoverflow.com/questions/56035634/how-to-parse-large-json-files-with-formating-error", "title": "How to Parse LARGE JSON files with formating error", "body": "<p>I have a bunch of large JSON files (> 500MB) which I would like to parse with the ruby script (I am trying. to parse it with YAJL gem).</p>\n\n<p>I have noticed that JSON files have formatting errors such that all the files composed of \"multiple\" JSON objects without a proper tree-like structure or array. Below you can find how the JSON file looks like:</p>\n\n<p>testfile.json:</p>\n\n<pre><code>{title: \"Don Quixote\", author: \"Miguel de Cervantes\", printyear: 2010}\n{title: \"Great Gatsby\", author: \"F. Scott Fitzgerald\", printyear: 2014}\n{title: \"Ulysses\", author: \"James Joyce\", printyear: 2010}\n</code></pre>\n\n<p>This is the script to parse file:</p>\n\n<pre><code>require 'yajl'\njson = File.new('testfile.json', 'r')\nhash = Yajl::Parser.parse(json)\n</code></pre>\n\n<p>Here is the error message I get:</p>\n\n<pre><code>Yajl::ParseError: Found multiple JSON objects in the stream but no block or the on_parse_complete callback was assigned to handle them.\n</code></pre>\n\n<p>I will appreciate if you can guide me on how to solve this issue.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "reactjs", "isomorphic", "hyperstack"], "answers": [{"comments": [{"owner": {"reputation": 127, "user_id": 4438296, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a0462f1ee59ed387dfcb8f0d9734f9d?s=128&d=identicon&r=PG", "display_name": "Michail", "link": "https://stackoverflow.com/users/4438296/michail"}, "edited": false, "score": 0, "creation_date": 1557980954, "post_id": 56160657, "comment_id": 98949545, "body": "That is the way to check if you are in opal context. I ask for a way to distinguish between console execution and in-server execution. The problem is that Rails::Server constant definition depends on how you start you web server process (in case of puma for example), so that you can decide if you need to broadcast messages to your connected channels..."}], "tags": [], "owner": {"reputation": 375, "user_id": 5308751, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/6019ff43b0bbd60b0cd6f7b1e9a37017?s=128&d=identicon&r=PG&f=1", "display_name": "BarrieH", "link": "https://stackoverflow.com/users/5308751/barrieh"}, "is_accepted": false, "score": 0, "last_activity_date": 1557979372, "creation_date": 1557979372, "answer_id": 56160657, "question_id": 56034960, "link": "https://stackoverflow.com/questions/56034960/what-is-the-most-accurate-way-to-check-if-you-are-in-rails-server-process-for-th/56160657#56160657", "title": "What is the most accurate way to check if you are in rails server process for the needs of Hyperstack", "body": "<p>You can use the RUBY_ENGINE guard to see if the code is running in Opal or not.</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>if RUBY_ENGINE == 'opal'\n    # I am on the client\nend\n</code></pre>\n\n<p>This is very useful in your Isomorphic models to exclude parts of the model's methods from existing on the client. Also very useful for using added Gem methods which make no sense in the client code.</p>\n"}], "owner": {"reputation": 127, "user_id": 4438296, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a0462f1ee59ed387dfcb8f0d9734f9d?s=128&d=identicon&r=PG", "display_name": "Michail", "link": "https://stackoverflow.com/users/4438296/michail"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 95, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1557979372, "creation_date": 1557297853, "question_id": 56034960, "link": "https://stackoverflow.com/questions/56034960/what-is-the-most-accurate-way-to-check-if-you-are-in-rails-server-process-for-th", "title": "What is the most accurate way to check if you are in rails server process for the needs of Hyperstack", "body": "<p><a href=\"https://hyperstack.org\" rel=\"nofollow noreferrer\">Hyperstack</a> is an isomorphic framework where same code can run server or client side. So there are specific cases where depending on where some piece of code gets executed (server or client side) different things should be accomplished (client synchronization etc.).</p>\n\n<p>The problem is that relying on the default check if  </p>\n\n<pre><code>defined?(Rails::Server) \n</code></pre>\n\n<p>depends on the webserver you are running and the enclosing environment.</p>\n\n<p>For example i run on puma (in docker for development and in Ubuntu server for production) and even in that case defined?(Rails::Server) works fine in development but not in production. This reveals that server execution detection depends not only on the actual server you are running on, but also on the method used to start it (e.x. rails s VS puma start)</p>\n\n<p>Additional information can be found here:</p>\n\n<ol>\n<li><p><a href=\"https://stackoverflow.com/questions/12088025/detect-if-application-was-started-as-http-server-or-not-rake-task-rconsole-etc/12246652#12246652\">Detect if application was started as HTTP server or not (rake task, rconsole etc)</a></p></li>\n<li><p><a href=\"https://gitter.im/ruby-hyperloop/chat?at=59d60f2201110b72317cd61c\" rel=\"nofollow noreferrer\">https://gitter.im/ruby-hyperloop/chat?at=59d60f2201110b72317cd61c</a></p></li>\n<li><p><a href=\"https://hyperstack-org.slack.com/archives/CHRQ5U8HL/p1557262851049900\" rel=\"nofollow noreferrer\">https://hyperstack-org.slack.com/archives/CHRQ5U8HL/p1557262851049900</a></p></li>\n</ol>\n\n<p>Is there a standard way to check whether something in Rails is executing on the server process/thread (not in browser, some sort of client, console, migration, rake task etc.) without relying on some hack to identify or declare what server we deploy on (puma, thin, nginx etc.)?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "amazon-s3", "paperclip", "aws-sdk"], "answers": [{"comments": [{"owner": {"reputation": 620, "user_id": 7974603, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5f4a562a0f406264652b195171ad0059?s=128&d=identicon&r=PG", "display_name": "Amer Bearat", "link": "https://stackoverflow.com/users/7974603/amer-bearat"}, "edited": false, "score": 0, "creation_date": 1557359683, "post_id": 56040690, "comment_id": 98742140, "body": "I updated my resource to &quot;Resource&quot;: [ &quot;arn:aws:s3:::borroup&quot;, &quot;arn:aws:s3:::borroup/*&quot; ] but still not working"}], "tags": [], "owner": {"reputation": 2863, "user_id": 11097368, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--1X0N-bF1wE/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQOhgeQfUYdlIL7iiOmZ15h6e3k02Q/mo/photo.jpg?sz=128", "display_name": "James Dean", "link": "https://stackoverflow.com/users/11097368/james-dean"}, "is_accepted": false, "score": 0, "last_activity_date": 1557318068, "creation_date": 1557318068, "answer_id": 56040690, "question_id": 56034840, "link": "https://stackoverflow.com/questions/56034840/awss3errorsaccessdenied-rollback-500-internal-server-error/56040690#56040690", "title": "Aws::S3::Errors::AccessDenied ROLLBACK 500 Internal Server Error", "body": "<p>Are the bucket and IAM user in different account ?\nIf so, the bucket policy is incorrect, the correct bucket policy </p>\n\n<p>{\n\"Version\": \"2012-10-17\",\n\"Id\": \"Policy1557294263403\",\n\"Statement\": [\n    {\n        \"Sid\": \"Stmt1557294241958\",\n        \"Effect\": \"Allow\",\n        \"Principal\": {\n            \"AWS\": \"arn:aws:iam::726051891502:user/borroup-admin\"\n        },\n        \"Action\": \"s3:<em>\",\n        \"Resource\": [\"arn:aws:s3:::borroup\",\"arn:aws:s3:::borroup/</em>\"]\n      }\n    ]\n }</p>\n\n<p>// --> borroup/asterisk --> for some reason, asterisk symbol removed here or maybe I don't know how to use stackoverflow correctly.</p>\n\n<p>If the User and bucket in the same account, the policy doesn't matter because IAM user has full permission.</p>\n"}], "owner": {"reputation": 620, "user_id": 7974603, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5f4a562a0f406264652b195171ad0059?s=128&d=identicon&r=PG", "display_name": "Amer Bearat", "link": "https://stackoverflow.com/users/7974603/amer-bearat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 141, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1557326176, "creation_date": 1557297304, "last_edit_date": 1557326176, "question_id": 56034840, "link": "https://stackoverflow.com/questions/56034840/awss3errorsaccessdenied-rollback-500-internal-server-error", "title": "Aws::S3::Errors::AccessDenied ROLLBACK 500 Internal Server Error", "body": "<p>Im trying to upload an image on s3 bucket using ruby on rails and paperclip, but its not working I have tried almost everything on the web.</p>\n\n<p><b>I know there is many questions about this but I have tried most of them, and nothing worked please review the question cause i listed what i tried in the question</b></p>\n\n<p>I did set IAM User and User has AmazonS3FullAccess policy </p>\n\n<pre><code>{\n\"Version\": \"2012-10-17\",\n\"Statement\": [\n    {\n        \"Effect\": \"Allow\",\n        \"Action\": \"s3:*\",\n        \"Resource\": \"*\"\n    }\n  ]\n }\n</code></pre>\n\n<p>I did set policy on the bucket </p>\n\n<pre><code>{\n\"Version\": \"2012-10-17\",\n\"Id\": \"Policy1557294263403\",\n\"Statement\": [\n    {\n        \"Sid\": \"Stmt1557294241958\",\n        \"Effect\": \"Allow\",\n        \"Principal\": {\n            \"AWS\": \"arn:aws:iam::726051891502:user/borroup-admin\"\n        },\n        \"Action\": \"s3:*\",\n        \"Resource\": [\n            \"arn:aws:s3:::borroup\",\n            \"arn:aws:s3:::borroup/*\"\n        ]\n      }\n    ]\n }\n</code></pre>\n\n<p>I did set CORS configuration editor on the bucket </p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;CORSConfiguration xmlns=\"http://s3.amazonaws.com/doc/2006-03-01/\"&gt;\n&lt;CORSRule&gt;\n&lt;AllowedOrigin&gt;*&lt;/AllowedOrigin&gt;\n&lt;AllowedMethod&gt;GET&lt;/AllowedMethod&gt;\n&lt;AllowedMethod&gt;POST&lt;/AllowedMethod&gt;\n&lt;AllowedMethod&gt;PUT&lt;/AllowedMethod&gt;\n&lt;MaxAgeSeconds&gt;3000&lt;/MaxAgeSeconds&gt;\n&lt;AllowedHeader&gt;Authorization&lt;/AllowedHeader&gt;\n&lt;/CORSRule&gt;\n&lt;/CORSConfiguration&gt;\n</code></pre>\n\n<p>I made sure all the Public access settings for this bucket set to false</p>\n\n<p><a href=\"https://i.stack.imgur.com/p0GPS.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/p0GPS.png\" alt=\"enter image description here\"></a></p>\n\n<p>This is ruby on rails config</p>\n\n<p>Note: im using the user access_key_id and secret_access_key for this </p>\n\n<pre><code>config.paperclip_defaults = {\n    storage: :s3,\n    path: ':class/:attachment/:id/:style/:filename',\n    s3_host_name: 's3.us-east-2.amazonaws.com',\n    s3_credentials:{\n      bucket:'borroup',\n      access_key_id: '************',\n      secret_access_key:'***************************',\n      s3_region:'us-east-2'\n  }\n}\n</code></pre>\n\n<p>I do get this error when I try to upload the image\n<a href=\"https://i.stack.imgur.com/YQU5z.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/YQU5z.png\" alt=\"enter image description here\"></a></p>\n\n<pre><code>Aws::S3::Errors::AccessDenied in PhotosController#create\n</code></pre>\n\n<p>When I check the bucket log I get this \n<a href=\"https://i.stack.imgur.com/6GrCB.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/6GrCB.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 1, "creation_date": 1557295997, "post_id": 56034509, "comment_id": 98711713, "body": "Either <code>@project</code> or <code>@interface</code> is <code>nil</code>."}, {"owner": {"reputation": 25, "user_id": 6676903, "user_type": "registered", "profile_image": "https://graph.facebook.com/889946557781820/picture?type=large", "display_name": "Hao Wen", "link": "https://stackoverflow.com/users/6676903/hao-wen"}, "reply_to_user": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1557296247, "post_id": 56034509, "comment_id": 98711796, "body": "I also tried  new_project_interface_get_field_path(@project,@interface)\uff0cbu&zwnj;&#8203;t it still not correct."}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1557296399, "post_id": 56034509, "comment_id": 98711851, "body": "Of course, it\u2019s incorrect. It requires <code>id</code>s. The issue is <b>as I already said</b> one (or both) instance variables are <code>nil</code> (not initialized in the controller.)"}, {"owner": {"reputation": 48413, "user_id": 1279683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1veuT.jpg?s=128&g=1", "display_name": "Marek Lipka", "link": "https://stackoverflow.com/users/1279683/marek-lipka"}, "edited": false, "score": 1, "creation_date": 1557296401, "post_id": 56034509, "comment_id": 98711852, "body": "Still, either <code>@project</code> or <code>@interface</code> is <code>nil</code>."}, {"owner": {"reputation": 25, "user_id": 6676903, "user_type": "registered", "profile_image": "https://graph.facebook.com/889946557781820/picture?type=large", "display_name": "Hao Wen", "link": "https://stackoverflow.com/users/6676903/hao-wen"}, "reply_to_user": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "edited": false, "score": 0, "creation_date": 1557296567, "post_id": 56034509, "comment_id": 98711918, "body": "@AlekseiMatiushkin I will go to check. thx you"}, {"owner": {"reputation": 25, "user_id": 6676903, "user_type": "registered", "profile_image": "https://graph.facebook.com/889946557781820/picture?type=large", "display_name": "Hao Wen", "link": "https://stackoverflow.com/users/6676903/hao-wen"}, "reply_to_user": {"reputation": 48413, "user_id": 1279683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1veuT.jpg?s=128&g=1", "display_name": "Marek Lipka", "link": "https://stackoverflow.com/users/1279683/marek-lipka"}, "edited": false, "score": 0, "creation_date": 1557298443, "post_id": 56034509, "comment_id": 98712702, "body": "@MarekLipka I have found problems. I have not find id inside the def index. it should be                                                                                                                    def index     project = Project.find(params[:project_id])     interface = Interface.find(params[:interface_id])   end"}], "answers": [{"tags": [], "owner": {"reputation": 36, "user_id": 11432964, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cYUTx.jpg?s=128&g=1", "display_name": "wingthor", "link": "https://stackoverflow.com/users/11432964/wingthor"}, "is_accepted": true, "score": 0, "last_activity_date": 1558120152, "last_edit_date": 1558120152, "creation_date": 1557455688, "answer_id": 56069946, "question_id": 56034509, "link": "https://stackoverflow.com/questions/56034509/railsnomethoderror-in-getfieldsindex/56069946#56069946", "title": "Rails:NoMethodError in GetFields#index", "body": "<p>It sounds like the variables you are passing in are nil. </p>\n\n<p>Have you tried checking what's actually being passed into your parameters for the params[:project_id] and params[:interface_id]? If those return an ID, maybe there are no actual Projects/Interface records in your database that match, in which case you'll need to revisit wherever you're passing in your params (or the database you're testing with).</p>\n"}], "owner": {"reputation": 25, "user_id": 6676903, "user_type": "registered", "profile_image": "https://graph.facebook.com/889946557781820/picture?type=large", "display_name": "Hao Wen", "link": "https://stackoverflow.com/users/6676903/hao-wen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 56069946, "answer_count": 1, "score": -3, "last_activity_date": 1558120152, "creation_date": 1557295727, "last_edit_date": 1557295962, "question_id": 56034509, "link": "https://stackoverflow.com/questions/56034509/railsnomethoderror-in-getfieldsindex", "title": "Rails:NoMethodError in GetFields#index", "body": "<p>I try to create something by using new route path:</p>\n\n<pre><code> new_project_interface_get_field GET /projects/:project_id/interfaces/:interface_id/get_fields/new(.:format)      get_fields#new\n</code></pre>\n\n<p>I have tried many ways but it does not seem correct and it shows</p>\n\n<blockquote>\n  <p>undefined method `id' for <code>nil:NilClass</code></p>\n</blockquote>\n\n<pre><code>&lt;%=link_to  new_project_interface_get_field_path(@project.id,@interface.id) do %&gt;\n  &lt;button type=\"button\" class=\"btn btn-dark\"&gt;&lt;/button&gt;\n&lt;% end %&gt;\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "ajax"], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 11467874, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zouoo.png?s=128&g=1", "display_name": "Portabello", "link": "https://stackoverflow.com/users/11467874/portabello"}, "edited": false, "score": 0, "creation_date": 1557289622, "post_id": 56033358, "comment_id": 98709899, "body": "Thank you so much for the fast response. This worked! Adding :decrement_quantity to the :set_cart before_action made the functionality work as intended. I guess since rails is stateless even though i already created the cart before it wasnt saved into the memory?"}], "tags": [], "owner": {"reputation": 208794, "user_id": 229044, "user_type": "moderator", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/591426cbbacd4025d920467bad356911?s=128&d=identicon&r=PG&f=1", "display_name": "meagar", "link": "https://stackoverflow.com/users/229044/meagar"}, "is_accepted": true, "score": 0, "last_activity_date": 1557288162, "creation_date": 1557288162, "answer_id": 56033358, "question_id": 56033286, "link": "https://stackoverflow.com/questions/56033286/ruby-on-rails-rendering-object-with-ajax/56033358#56033358", "title": "Ruby on Rails rendering object with ajax", "body": "<p>You haven't set <code>@cart</code>, which means your view is executing <code>\"&lt;%= j render(nil) %&gt;\"</code>.</p>\n\n<p>Your controller only sets <code>@cart</code> via a before-action, which only runs before the <code>create</code> action:</p>\n\n<pre><code>  before_action :set_cart, only: [:create]\n</code></pre>\n\n<p>If you want the <code>decrement_quantity</code> to push an <code>@cart</code> variable to the view, you need to either expand the <code>only:</code> option to include <code>[:create, :decrement_quantity]</code> (which may or may not work, you haven't included the contents of that method in your question) or explicitly set <code>@cart</code> inside the <code>decrement_quantity</code> action.</p>\n"}], "owner": {"reputation": 45, "user_id": 11467874, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zouoo.png?s=128&g=1", "display_name": "Portabello", "link": "https://stackoverflow.com/users/11467874/portabello"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 56033358, "answer_count": 1, "score": 0, "last_activity_date": 1557288162, "creation_date": 1557287613, "question_id": 56033286, "link": "https://stackoverflow.com/questions/56033286/ruby-on-rails-rendering-object-with-ajax", "title": "Ruby on Rails rendering object with ajax", "body": "<p>I am following the book Agile Web Development with Rails 5.1 and am in Chapter 11 where I am trying to create a button that decrements the quantity of an item within my cart. I am trying to use ajax to solve this and calling the render method on the cart. I am getting the following error...</p>\n\n<p>ActionView::Template::Error ('nil' is not an ActiveModel-compatible object. It must implement :to_partial_path.):\n    1: cart = document.getElementById(\"cart\")\n    2: cart.innerHTML = \"&lt;%= j render(@cart) %>\"</p>\n\n<p>the button that this ajax calls originates from is a partial if that changes anything. I am new to rails and am stuck.</p>\n\n<p>decrement_quantity.js.coffee</p>\n\n<pre><code>cart = document.getElementById(\"cart\")\ncart.innerHTML = \"&lt;%= j render(@cart) %&gt;\"\n</code></pre>\n\n<p>_line_item.html.erb</p>\n\n<pre><code>&lt;% if line_item== @current_item %&gt;\n&lt;tr class=\"line-item-highlight\"&gt;\n&lt;% else %&gt;\n&lt;tr&gt;\n&lt;% end %&gt;\n  &lt;td id=\"quantity\"&gt;&lt;%= line_item.quantity %&gt;&lt;/td&gt;\n  &lt;td&gt;&lt;%= line_item.product.title %&gt;&lt;/td&gt;\n  &lt;td id=\"price\" class=\"price\"&gt;&lt;%= number_to_currency(line_item.total_price) %&gt;&lt;/td&gt;\n  &lt;td&gt;&lt;%= button_to 'X', line_item, method: :delete, data: {confirm: 'Are you sure?' } %&gt;&lt;/td&gt;\n  &lt;td id=\"decrement_quantity\"&gt;&lt;%= button_to '-1', line_items_decrement_quantity_path(id: line_item.id), remote: true%&gt;&lt;/td&gt;\n&lt;/tr&gt;\n</code></pre>\n\n<p>line_items_controller.rb</p>\n\n<pre><code>class LineItemsController &lt; ApplicationController\n  include CurrentCart\n  before_action :set_cart, only: [:create]\n  before_action :set_line_item, only: [:show, :edit, :update, :destroy, :decrement_quantity]\n.\n.\n.\n  def decrement_quantity\n    if @line_item.quantity &gt; 1\n      @line_item.quantity -= 1\n      @line_item.save\n    else\n      @line_item.destroy\n    end\n    respond_to do |format|\n      format.html { redirect_to store_index_url, notice: 'Line item was successfully decremented.' }\n      format.js {}\n      format.json { head :no_content }\n    end\n  end\n.\n.\n.\n\n</code></pre>\n\n<p>routes.db</p>\n\n<pre><code>Rails.application.routes.draw do\n  resources :line_items\n  resources :carts\n  #get 'store/index'\n  root 'store#index', as: 'store_index'\n\n  post 'line_items/decrement_quantity'\n\n  resources :products\n  # For details on the DSL available within this file, see http://guides.rubyonrails.org/routing.html\nend\n</code></pre>\n\n<p>Im not sure if im missing something but the same ajax command from from a different button in a different view is working fine. Anyone to help guide me is much appreciated :)</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-5"], "comments": [{"owner": {"reputation": 1966, "user_id": 3367343, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HHfSU.jpg?s=128&g=1", "display_name": "Travis Hohl", "link": "https://stackoverflow.com/users/3367343/travis-hohl"}, "edited": false, "score": 1, "creation_date": 1557284303, "post_id": 56032585, "comment_id": 98708835, "body": "What does it return now? Are you seeing an error? What if the <code>Mile</code> model was named <code>Hike</code> instead, would that be more or less clear?"}, {"owner": {"reputation": 1539, "user_id": 3394654, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/4fRHp.jpg?s=128&g=1", "display_name": "J. Jackson", "link": "https://stackoverflow.com/users/3394654/j-jackson"}, "reply_to_user": {"reputation": 1966, "user_id": 3367343, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HHfSU.jpg?s=128&g=1", "display_name": "Travis Hohl", "link": "https://stackoverflow.com/users/3367343/travis-hohl"}, "edited": false, "score": 0, "creation_date": 1557284606, "post_id": 56032585, "comment_id": 98708879, "body": "It more or less returns &quot;correctly&quot;, in that it&#39;s grouping by month and giving me a total by month. There are no errors. I&#39;ll update my original post with an example of what it&#39;s returning. With regards to constraining it to the current year, I&#39;ve added a scope to the Mile model that appears to be working called <code>from_this_year</code>, so I&#39;ll update the method in the original post as well to include that scope."}, {"owner": {"reputation": 1539, "user_id": 3394654, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/4fRHp.jpg?s=128&g=1", "display_name": "J. Jackson", "link": "https://stackoverflow.com/users/3394654/j-jackson"}, "reply_to_user": {"reputation": 1966, "user_id": 3367343, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HHfSU.jpg?s=128&g=1", "display_name": "Travis Hohl", "link": "https://stackoverflow.com/users/3367343/travis-hohl"}, "edited": false, "score": 0, "creation_date": 1557284787, "post_id": 56032585, "comment_id": 98708915, "body": "Now all that remains is my need to return a :total of 0 if there was no data entered for that month. For example, this month a user has not entered any miles, so it should return { :indicator =&gt; &quot;May&quot;, :total =&gt; 0 } in addition to the other data"}, {"owner": {"reputation": 1966, "user_id": 3367343, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HHfSU.jpg?s=128&g=1", "display_name": "Travis Hohl", "link": "https://stackoverflow.com/users/3367343/travis-hohl"}, "edited": false, "score": 1, "creation_date": 1557285016, "post_id": 56032585, "comment_id": 98708955, "body": "What does it return when no data has been entered for May?"}, {"owner": {"reputation": 1539, "user_id": 3394654, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/4fRHp.jpg?s=128&g=1", "display_name": "J. Jackson", "link": "https://stackoverflow.com/users/3394654/j-jackson"}, "reply_to_user": {"reputation": 1966, "user_id": 3367343, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HHfSU.jpg?s=128&g=1", "display_name": "Travis Hohl", "link": "https://stackoverflow.com/users/3367343/travis-hohl"}, "edited": false, "score": 0, "creation_date": 1557285079, "post_id": 56032585, "comment_id": 98708964, "body": "Nothing, because it doesn&#39;t exist. I&#39;ll need to essentially force May (or whatever month doesn&#39;t have any data) to return 0 within the method."}, {"owner": {"reputation": 1966, "user_id": 3367343, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HHfSU.jpg?s=128&g=1", "display_name": "Travis Hohl", "link": "https://stackoverflow.com/users/3367343/travis-hohl"}, "edited": false, "score": 1, "creation_date": 1557285353, "post_id": 56032585, "comment_id": 98709023, "body": "When should it stop? Should it only take into account which month today is in? Or should it list zeroes for every month until the end of the calendar year? Or farther?"}, {"owner": {"reputation": 1539, "user_id": 3394654, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/4fRHp.jpg?s=128&g=1", "display_name": "J. Jackson", "link": "https://stackoverflow.com/users/3394654/j-jackson"}, "reply_to_user": {"reputation": 1966, "user_id": 3367343, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HHfSU.jpg?s=128&g=1", "display_name": "Travis Hohl", "link": "https://stackoverflow.com/users/3367343/travis-hohl"}, "edited": false, "score": 0, "creation_date": 1557285430, "post_id": 56032585, "comment_id": 98709043, "body": "I should&#39;ve clarified that. It should go all the way up to the current month. So if I haven&#39;t entered data for January and May, it should return a 0 for both of those months and the total miles for February, March and April."}], "answers": [{"comments": [{"owner": {"reputation": 1539, "user_id": 3394654, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/4fRHp.jpg?s=128&g=1", "display_name": "J. Jackson", "link": "https://stackoverflow.com/users/3394654/j-jackson"}, "edited": false, "score": 0, "creation_date": 1557324632, "post_id": 56033924, "comment_id": 98727479, "body": "I&#39;m not exactly sure how to get this to work with my existing code. Setting <code>MONTHS</code> to that Date object makes sense (didn&#39;t even know ABBR_MONTHNAMES was a thing!), but after that it gets fuzzy. In your code above, what does <code>results</code> refer to?"}, {"owner": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "reply_to_user": {"reputation": 1539, "user_id": 3394654, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/4fRHp.jpg?s=128&g=1", "display_name": "J. Jackson", "link": "https://stackoverflow.com/users/3394654/j-jackson"}, "edited": false, "score": 0, "creation_date": 1557340817, "post_id": 56033924, "comment_id": 98735860, "body": "@J.Jackson You said &quot;And here is an example of what it returns:&quot; I am assuming we refer to that with a &quot;results&quot; variable, e.g. an array of hashes"}, {"owner": {"reputation": 1539, "user_id": 3394654, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/4fRHp.jpg?s=128&g=1", "display_name": "J. Jackson", "link": "https://stackoverflow.com/users/3394654/j-jackson"}, "edited": false, "score": 0, "creation_date": 1557341021, "post_id": 56033924, "comment_id": 98735969, "body": "Ah so I would essentially run my existing method, then run it through the method you&#39;ve posted above (with results being equal to my example return above)?"}, {"owner": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "reply_to_user": {"reputation": 1539, "user_id": 3394654, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/4fRHp.jpg?s=128&g=1", "display_name": "J. Jackson", "link": "https://stackoverflow.com/users/3394654/j-jackson"}, "edited": false, "score": 0, "creation_date": 1557341088, "post_id": 56033924, "comment_id": 98736009, "body": "@J.Jackson yeah"}, {"owner": {"reputation": 1539, "user_id": 3394654, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/4fRHp.jpg?s=128&g=1", "display_name": "J. Jackson", "link": "https://stackoverflow.com/users/3394654/j-jackson"}, "edited": false, "score": 0, "creation_date": 1557355548, "post_id": 56033924, "comment_id": 98741276, "body": "I was able to combine the two methods into one, if you&#39;ll check the Update in the original post. The only remaining thing to do is to somehow constrain the months variable to months from the beginning of the year to the current month."}, {"owner": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "reply_to_user": {"reputation": 1539, "user_id": 3394654, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/4fRHp.jpg?s=128&g=1", "display_name": "J. Jackson", "link": "https://stackoverflow.com/users/3394654/j-jackson"}, "edited": false, "score": 0, "creation_date": 1557358257, "post_id": 56033924, "comment_id": 98741871, "body": "@J.Jackson in the <code>months.each do |month|</code>, you can do <code>break if month == Date.today.strftime &quot;%b&quot;</code>"}], "tags": [], "owner": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "is_accepted": false, "score": 2, "last_activity_date": 1557310838, "last_edit_date": 1557310838, "creation_date": 1557292360, "answer_id": 56033924, "question_id": 56032585, "link": "https://stackoverflow.com/questions/56032585/ruby-group-by-month-for-current-year-including-months-with-no-data/56033924#56033924", "title": "Ruby - group_by month for current year, including months with no data", "body": "<p>You can do this by looping over each of the months and setting a default value, for example:</p>\n\n<pre><code>MONTHS = Date::ABBR_MONTHNAMES[1..12]\n\n# put this somewhere\nMONTHS.each do |month|\n  unless results.any? { |r| r[:indicator] == month }\n    results.push(indicator: month, total: 0)\n  end\nend\n\n# you can sort them chronologically if needed\nresults.sort_by! { |r| MONTHS.index(r[:indicator]) }\n</code></pre>\n\n<p>Note this is not <em>the most</em> efficient code - it has some O(N^2) stuff which can be optimized to O(N) - but it should hopefully give you a starting point</p>\n"}, {"tags": [], "owner": {"reputation": 1539, "user_id": 3394654, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/4fRHp.jpg?s=128&g=1", "display_name": "J. Jackson", "link": "https://stackoverflow.com/users/3394654/j-jackson"}, "is_accepted": true, "score": 0, "last_activity_date": 1557355954, "creation_date": 1557355954, "answer_id": 56050042, "question_id": 56032585, "link": "https://stackoverflow.com/questions/56032585/ruby-group-by-month-for-current-year-including-months-with-no-data/56050042#56050042", "title": "Ruby - group_by month for current year, including months with no data", "body": "<p>Based on Max Pleaner's answer, I was able to come up with the following method to correctly return what I needed:</p>\n\n<pre><code>def miles_by_month\n    cur_month = Time.now.month\n    months = Date::ABBR_MONTHNAMES[1..cur_month]\n    miles = self.miles.from_this_year.group_by { |t| t.start_date.strftime('%b') }\n\n    total_miles = miles.map do |m|\n        { 'indicator': m[0], 'total': m[1].sum(&amp;:length) }\n    end\n\n    months.each do |month|\n      unless total_miles.any? { |r| r[:indicator] == month }\n        total_miles.push(indicator: month, total: 0)\n      end\n    end\n\n    total_miles\n  end\n</code></pre>\n\n<p>This returns a data structure like the following:</p>\n\n<pre><code>[\n    [0] {\n        :indicator =&gt; \"Jan\",\n            :total =&gt; 15\n    },\n    [1] {\n        :indicator =&gt; \"Feb\",\n            :total =&gt; 10\n    },\n    [2] {\n        :indicator =&gt; \"Mar\",\n            :total =&gt; 10\n    },\n    [3] {\n        :indicator =&gt; \"Apr\",\n            :total =&gt; 100\n    },\n    [4] {\n        :indicator =&gt; \"May\",\n            :total =&gt; 0\n    }\n]\n</code></pre>\n\n<p>It's certainly not the most efficient method and I'd be very curious to see if anyone has more efficient ways of handling this. </p>\n"}], "owner": {"reputation": 1539, "user_id": 3394654, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/4fRHp.jpg?s=128&g=1", "display_name": "J. Jackson", "link": "https://stackoverflow.com/users/3394654/j-jackson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 56050042, "answer_count": 2, "score": 0, "last_activity_date": 1557355954, "creation_date": 1557281197, "last_edit_date": 1557355500, "question_id": 56032585, "link": "https://stackoverflow.com/questions/56032585/ruby-group-by-month-for-current-year-including-months-with-no-data", "title": "Ruby - group_by month for current year, including months with no data", "body": "<p>I'm trying to write a method to return a very specific data structure for a chart that I am populating.</p>\n\n<p>A user can enter dates for miles that they've hiked, so on the Mile model I have start_date and end_date attributes. </p>\n\n<p>The method I have currently is <em>close</em>, however it should return a 0 for the current month because the user hasn't entered any miles hiked for the month of May. I also need to constrain it to the current year, which it currently is not. </p>\n\n<p>Here is what my current method looks like:</p>\n\n<pre><code>def miles_by_month\n    miles = self.miles.from_this_year.group_by { |t| t.start_date.strftime('%b') }\n    total_miles = miles.map do |m|\n        { 'indicator': m[0], 'total': m[1].sum(&amp;:length) }\n    end\n    total_miles\nend\n</code></pre>\n\n<p>And the 'from_this_year' scope on the Mile model if it's helpful:</p>\n\n<pre><code>scope :from_this_year, lambda { where(\"start_date &gt; ? AND start_date &lt; ?\", Time.now.beginning_of_year, Time.now.end_of_year) }\n</code></pre>\n\n<p>And here is an example of what it returns:</p>\n\n<pre><code>[\n    [0] {\n        :indicator =&gt; \"Jan\",\n            :total =&gt; 15\n    },\n    [1] {\n        :indicator =&gt; \"Feb\",\n            :total =&gt; 10\n    },\n    [2] {\n        :indicator =&gt; \"Mar\",\n            :total =&gt; 10\n    },\n    [3] {\n        :indicator =&gt; \"Apr\",\n            :total =&gt; 100\n    },\n    [4] {\n        :indicator =&gt; \"May\",    # I need [4] to show up with \n        :total =&gt; 0             # a total of 0. [4] currently\n    }                           # does not show up at all.\n]\n</code></pre>\n\n<p>\"Indicator\" refers to the name of the month, and \"total\" refers to a sum of the number of miles that user has hiked for that specific month.</p>\n\n<p>Any suggestions?</p>\n\n<p><strong>UPDATE 1</strong></p>\n\n<p>I have modified my <code>miles_by_month</code> method somewhat based on an answer here to the following:</p>\n\n<pre><code>def miles_by_month\n    months = Date::ABBR_MONTHNAMES[1..12]\n    miles = self.miles.from_this_year.group_by { |t| t.start_date.strftime('%b') }\n\n    total_miles = miles.map do |m|\n        { 'indicator': m[0], 'total': m[1].sum(&amp;:length) }\n    end\n\n    months.each do |month|\n      unless total_miles.any? { |r| r[:indicator] == month }\n        total_miles.push(indicator: month, total: 0)\n      end\n    end\n\n    total_miles\n  end\n</code></pre>\n\n<p>The only remaining thing I need to do is figure out how to constrain the months variable from the start of the year to the current month.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "if-statement", "activerecord"], "comments": [{"owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 0, "creation_date": 1557279145, "post_id": 56032331, "comment_id": 98707896, "body": "What database are you using?"}, {"owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 0, "creation_date": 1557279856, "post_id": 56032331, "comment_id": 98707996, "body": "<code>[self.id + 1, self.id - 1]</code>, ids might not always follow an incremental order."}, {"owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 0, "creation_date": 1557279906, "post_id": 56032331, "comment_id": 98708006, "body": "What do you mean with &quot;if the active column value is <i>unique</i> to the user&quot;?"}, {"owner": {"reputation": 690, "user_id": 2390233, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f8cd867dfd775e56b1944f6f9af465bc?s=128&d=identicon&r=PG", "display_name": "ecki", "link": "https://stackoverflow.com/users/2390233/ecki"}, "reply_to_user": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 0, "creation_date": 1557280059, "post_id": 56032331, "comment_id": 98708031, "body": "@SebastianPalma postgreSQL in prod. SQLite3 in Dev. And &quot;unique&quot; was a typo, should be &quot;different&quot; to the user before and after."}, {"owner": {"reputation": 690, "user_id": 2390233, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f8cd867dfd775e56b1944f6f9af465bc?s=128&d=identicon&r=PG", "display_name": "ecki", "link": "https://stackoverflow.com/users/2390233/ecki"}, "reply_to_user": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 0, "creation_date": 1557280301, "post_id": 56032331, "comment_id": 98708079, "body": "@SebastianPalma instead of [self.id + 1, self.id - 1] is there a function like self.created_at.next and self.created_at.previous ?"}, {"owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 0, "creation_date": 1557281242, "post_id": 56032331, "comment_id": 98708251, "body": "It should return &quot;a&quot; (one) user matching the criteria? or &quot;the&quot; user (self)?"}, {"owner": {"reputation": 690, "user_id": 2390233, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f8cd867dfd775e56b1944f6f9af465bc?s=128&d=identicon&r=PG", "display_name": "ecki", "link": "https://stackoverflow.com/users/2390233/ecki"}, "reply_to_user": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 0, "creation_date": 1557281408, "post_id": 56032331, "comment_id": 98708276, "body": "@SebastianPalma in this case, self"}], "answers": [{"comments": [{"owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 0, "creation_date": 1557613389, "post_id": 56032592, "comment_id": 98825362, "body": "Doing three queries when you can do just one, is, amazing."}, {"owner": {"reputation": 893, "user_id": 3394889, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a3c58b23ce03f0e71522820d13404d5a?s=128&d=identicon&r=PG&f=1", "display_name": "The Wizard", "link": "https://stackoverflow.com/users/3394889/the-wizard"}, "reply_to_user": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 0, "creation_date": 1557696395, "post_id": 56032592, "comment_id": 98841634, "body": "Thanks, so is writing database specific queries as you did in your deleted answer."}, {"owner": {"reputation": 893, "user_id": 3394889, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a3c58b23ce03f0e71522820d13404d5a?s=128&d=identicon&r=PG&f=1", "display_name": "The Wizard", "link": "https://stackoverflow.com/users/3394889/the-wizard"}, "reply_to_user": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 0, "creation_date": 1557696463, "post_id": 56032592, "comment_id": 98841650, "body": "If you can think of a better solution feel free to post or help me improve my answer. Your sarcasm isn&#39;t helping anyone here."}, {"owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "edited": false, "score": 0, "creation_date": 1562079614, "post_id": 56032592, "comment_id": 100260629, "body": "<code>User.exists?([     &#39;(id = IFNULL((SELECT MIN(id) FROM users WHERE id &gt; :id), 0) OR       id = IFNULL((SELECT MAX(id) FROM users WHERE id &lt; :id), 0)) AND active = :active&#39;,     id: id,     active: active   ])</code>, that&#39;s all."}], "tags": [], "owner": {"reputation": 893, "user_id": 3394889, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a3c58b23ce03f0e71522820d13404d5a?s=128&d=identicon&r=PG&f=1", "display_name": "The Wizard", "link": "https://stackoverflow.com/users/3394889/the-wizard"}, "is_accepted": true, "score": 0, "last_activity_date": 1557281949, "last_edit_date": 1557281949, "creation_date": 1557281254, "answer_id": 56032592, "question_id": 56032331, "link": "https://stackoverflow.com/questions/56032331/how-to-find-activerecord-object-that-has-a-unique-column-values-compared-to-othe/56032592#56032592", "title": "How to find ActiveRecord object that has a unique column values compared to other closeby objects", "body": "<p>Incrementing/Decrementing self.id may not be correct since that user may no longer exist. It would be better to find the next/previous ids. You can find the <strong>previous record</strong> by <strong>selecting the maximum id smaller than self.id</strong>. Similarly, you can find the <strong>next record</strong> by selecting the <strong>minimum id larger than self.id</strong>.</p>\n\n<pre><code>def has_unique_active_value\n  user_ids_to_check = [User.where(\"id &lt; ?\", self.id).maximum(:id), User.where(\"id &gt; ?\", self.id).minimum(:id)]\n  User.where(id: user_ids_to_check, active: self.active).present? ? nil : self\nend\n\ncurrent_user = User.all.first.has_unique_active_value\n</code></pre>\n"}], "owner": {"reputation": 690, "user_id": 2390233, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f8cd867dfd775e56b1944f6f9af465bc?s=128&d=identicon&r=PG", "display_name": "ecki", "link": "https://stackoverflow.com/users/2390233/ecki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 56032592, "answer_count": 1, "score": -2, "last_activity_date": 1557282966, "creation_date": 1557278767, "last_edit_date": 1557279981, "question_id": 56032331, "link": "https://stackoverflow.com/questions/56032331/how-to-find-activerecord-object-that-has-a-unique-column-values-compared-to-othe", "title": "How to find ActiveRecord object that has a unique column values compared to other closeby objects", "body": "<p>I have a boolean column called <code>active</code> in a table called <code>user</code>.</p>\n\n<p>I'm trying to find <code>users</code> where the <code>user</code> before and after the <code>current_user</code> do not have the same value in column <code>active</code>.</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>def has_unique_active_value\n  user_ids_to_check = [self.id + 1, self.id - 1] # user.id before and after current_user\n  if User.where(id: user_ids_to_check, active: self.active).present?\n    return nil\n  else\n    return self\n  end\nend\n\ncurrent_user = User.all.first.has_unique_active_value\n</code></pre>\n\n<p>The above should return a <code>user</code> if the <code>active</code> column value is different to the <code>user</code> before and after. if not, it should return <code>nil</code></p>\n\n<p>Would there be an easier or better practice to use in order to get the outcome I'm after?</p>\n"}, {"tags": ["arrays", "ruby", "uniq"], "comments": [{"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1557277402, "post_id": 56032164, "comment_id": 98707627, "body": "What are the common elements in <code>[1,1,2]</code> and <code>[1,3,1]</code>? One <code>1</code> or two? if <code>1</code> it&#39;s just <code>arr1 &amp; arr2</code>."}], "answers": [{"tags": [], "owner": {"reputation": 2151, "user_id": 10068463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3df811097b7fb8fef67238aad1151ca?s=128&d=identicon&r=PG&f=1", "display_name": "Nate", "link": "https://stackoverflow.com/users/10068463/nate"}, "is_accepted": false, "score": 8, "last_activity_date": 1557296127, "last_edit_date": 1557296127, "creation_date": 1557277443, "answer_id": 56032203, "question_id": 56032164, "link": "https://stackoverflow.com/questions/56032164/ruby-how-to-find-to-similarity-in-two-arrays/56032203#56032203", "title": "Ruby: How to find to similarity in two arrays", "body": "<p>If your goal is simply to determine which elements are the same between two arrays, you can use the intersection operator <a href=\"https://ruby-doc.org/core-2.6.3/Array.html#method-i-26\" rel=\"noreferrer\"><code>Array#&amp;</code></a>.</p>\n\n<pre><code>a = exchange_one.get_symbols\nb = exchange_two.get_symbols\n\nintersection = a &amp; b\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": false, "score": 1, "last_activity_date": 1557300891, "last_edit_date": 1557300891, "creation_date": 1557278898, "answer_id": 56032341, "question_id": 56032164, "link": "https://stackoverflow.com/questions/56032164/ruby-how-to-find-to-similarity-in-two-arrays/56032341#56032341", "title": "Ruby: How to find to similarity in two arrays", "body": "<p>Suppose:</p>\n\n<pre><code>arr1 = 15.times.map { rand 6 }\n  #=&gt; [1, 0, 4, 0, 2, 3, 1, 0, 2, 4, 4, 1, 3, 1, 1] \narr2 = 15.times.map { rand 6 }\n  #=&gt; [5, 5, 4, 1, 5, 1, 5, 0, 4, 0, 2, 0, 4, 5, 0] \n</code></pre>\n\n<p><code>arr1</code> contains <code>5</code> <code>1</code>s and <code>arr2</code> contains <code>2</code> <code>1</code>s. If, by \"common elements\" you wish to report that both arrays contain <code>[5, 2].min #=&gt; 2</code> <code>1</code>s, and similar counts for the other elements that appear in either array, you can do the following:</p>\n\n<pre><code>h1 = count(arr1)\n  #=&gt; {1=&gt;5, 0=&gt;3, 4=&gt;3, 2=&gt;2, 3=&gt;2} \nh2 = count(arr2)\n  #=&gt; {5=&gt;5, 4=&gt;3, 1=&gt;2, 0=&gt;4, 2=&gt;1} \n(h1.keys | h2.keys).each_with_object({}) { |k,h| h[k] = [h1[k], h2[k]].min }\n  #=&gt; {1=&gt;2, 0=&gt;3, 4=&gt;3, 2=&gt;1, 3=&gt;0, 5=&gt;0}\n\ndef count(arr)\n  arr.each_with_object(Hash.new(0)) { |n,h| h[n] += 1 }\nend\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2151, "user_id": 10068463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3df811097b7fb8fef67238aad1151ca?s=128&d=identicon&r=PG&f=1", "display_name": "Nate", "link": "https://stackoverflow.com/users/10068463/nate"}, "edited": false, "score": 0, "creation_date": 1557320327, "post_id": 56039327, "comment_id": 98724603, "body": "Note that adding the two arrays together and calling <code>uniq</code> is much less efficient than the intersection operator. But +1 for the breakdown of why OPs code didn\u2019t work."}], "tags": [], "owner": {"reputation": 301, "user_id": 5138485, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K4fTJWCrpp4/AAAAAAAAAAI/AAAAAAAAB0o/KSBsbEj0Xz4/photo.jpg?sz=128", "display_name": "Kishor Vyavahare", "link": "https://stackoverflow.com/users/5138485/kishor-vyavahare"}, "is_accepted": true, "score": 3, "last_activity_date": 1557386091, "last_edit_date": 1557386091, "creation_date": 1557313544, "answer_id": 56039327, "question_id": 56032164, "link": "https://stackoverflow.com/questions/56032164/ruby-how-to-find-to-similarity-in-two-arrays/56039327#56039327", "title": "Ruby: How to find to similarity in two arrays", "body": "<p>First understand what are you doing and what you want.</p>\n\n<p>For eg.</p>\n\n<pre><code>a = 15.times.map { rand 6 }\n  #=&gt; [1, 0, 5, 3, 1, 3, 4, 1, 3, 2, 1, 2, 4, 2, 3]\nb = 15.times.map { rand 6 }\n  #=&gt; [3, 3, 3, 1, 3, 1, 3, 1, 5, 1, 4, 2, 0, 0, 4]\n</code></pre>\n\n<p>Now what are you doing </p>\n\n<pre><code>c = a + b \n  #=&gt; [1, 0, 5, 3, 1, 3, 4, 1, 3, 2, 1, 2, 4, 2, 3, 3, 3, 3, 1, 3, 1, 3, 1, 5, 1, 4, 2, 0, 0, 4]\n</code></pre>\n\n<p>c - only combine arrays irrespective of content hence get all values.</p>\n\n<p>Now</p>\n\n<pre><code>pairs = Array.new\nc.uniq{|pair| pairs &lt;&lt; pair}\n</code></pre>\n\n<p>Here <strong>uniq</strong> is just act as a iterator means if you check 'pair' then it iterate all the values of 'c' and insert those values in 'pairs' array.</p>\n\n<p>check this</p>\n\n<pre><code>c.uniq{|pair| puts pair}\n</code></pre>\n\n<p>Thats why you are getting all values within 'pairs' array.</p>\n\n<p>The best way to find similarity in arrays is <code>(a&amp;b)</code>, but you can make changes in your code as follow to achieve it.</p>\n\n<pre><code> pairs = (arr1+arr2).uniq\n\nOR\n\n pairs = arr1 &amp; arr2 #best and efficient way.\n\n</code></pre>\n"}], "owner": {"reputation": 1927, "user_id": 953419, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/0f79e690bef0b6c98676b5751056e0a1?s=128&d=identicon&r=PG", "display_name": "seamus", "link": "https://stackoverflow.com/users/953419/seamus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 270, "favorite_count": 0, "accepted_answer_id": 56039327, "answer_count": 3, "score": 1, "last_activity_date": 1557386091, "creation_date": 1557276925, "question_id": 56032164, "link": "https://stackoverflow.com/questions/56032164/ruby-how-to-find-to-similarity-in-two-arrays", "title": "Ruby: How to find to similarity in two arrays", "body": "<p>I am trying to find the common elements in two arrays.</p>\n\n<pre><code>pairs = Array.new\na = exchange_one.get_symbols\nb = exchange_two.get_symbols\nc = a+b\nc.uniq{|pair| pairs &lt;&lt; pair}\n</code></pre>\n\n<p>I am combining the two arrays using <strong>+</strong></p>\n\n<p>Then I am calling <strong>uniq</strong> to remove the duplicate, but passing it to a block so the found duplicates can be added to an array before they are deleted.</p>\n\n<p>For some reason the array pairs is just the entire <strong>c</strong> array. </p>\n\n<p>What is the correct way to find array similarities.</p>\n"}, {"tags": ["ruby"], "answers": [{"comments": [{"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 2, "creation_date": 1557258902, "post_id": 56029607, "comment_id": 98702766, "body": "This is not really an answer but is an elaboration of your question. I suggest you edit your question to include this and delete this answer."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1557260741, "post_id": 56029607, "comment_id": 98703565, "body": "&quot;I really wish to understand why&quot; - this basically boils down to difference between class variables (<code>@@type</code>) and instance variables (<code>@type</code>). The latter, even if it&#39;s defined on a class object, has smaller area of effect."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 2, "creation_date": 1557261799, "post_id": 56029607, "comment_id": 98704010, "body": "<code>class &lt;&lt; self</code> is modifying the eigen class (singleton) for the class <code>Parent</code> and defining methods in that scope. <code>Parent</code> now has these methods as class instance methods through inheritance."}], "tags": [], "owner": {"reputation": 115, "user_id": 1505638, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7d98742c9ff78aa70d819857aca98380?s=128&d=identicon&r=PG", "display_name": "Renato Alves", "link": "https://stackoverflow.com/users/1505638/renato-alves"}, "is_accepted": false, "score": -1, "last_activity_date": 1557258766, "creation_date": 1557258766, "answer_id": 56029607, "question_id": 56029489, "link": "https://stackoverflow.com/questions/56029489/how-to-create-class-variable-that-not-share-state-between-children/56029607#56029607", "title": "How to create class variable that not share state between Children", "body": "<p>Ok, i have no idea why it worked, but it worked this way:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>class Parent\n  class &lt;&lt; self\n    attr_accessor :_type\n\n    def type(value)\n      self._type = value\n    end\n  end\n\n  def render\n    puts self.class._type\n  end\nend\n</code></pre>\n\n<p>I really wish to understand why, but \"self.class\", and \"class &lt;&lt; self\" seems a lot of dark to me.</p>\n\n<p>Light?</p>\n"}, {"comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1557261282, "post_id": 56030056, "comment_id": 98703805, "body": "Even though I don&#39;t like the name (<i>class</i> instance variable is just an instance variable), it&#39;s good to be able to tell them apart. I don&#39;t think there&#39;s a better term for it..."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1557261657, "post_id": 56030056, "comment_id": 98703959, "body": "@SergioTulentsev but that is exactly what it is an instance_variable for that class because every class is an instance of the the class <code>Class</code>. What could be so confusing about that :) and @Cary <code>self.type</code> (<i>hint,hint</i>)"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1557262974, "post_id": 56030056, "comment_id": 98704420, "body": "&quot;That is very kludgy&quot; - matter of taste, I guess. I find it clean and intuitive (when used where appropriate, like this case). &quot;and only works if you don&#39;t want to set @type to nil&quot; - ah, but you can have an arbitrary empty value. <code>def self.type(val = :no_one_will_ever_intentionally_use_this_symbol)</code>"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1557264429, "post_id": 56030056, "comment_id": 98704912, "body": "@Sergio, no I haven&#39;t run the code in my SO answers for years. I used to do that religiously, but it always ran fine so I figured it was a waste of time. Just to satisfy you I ran my code here and it was fine. Second topic: isn&#39;t that just when someone will use  <code>:no_one_will_ever_intentionally_use_this_symbol</code>? Man, was that whooped with an ugly stick or what?"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557265479, "post_id": 56030056, "comment_id": 98705232, "body": "@engineersmnky, I&#39;ve edited to use the expression &quot;class-level instance variable&quot;, which I&#39;ve noticed is favoured by some."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 1, "creation_date": 1557267315, "post_id": 56030056, "comment_id": 98705703, "body": "@CarySwoveland the first code does not work without <code>self.type=&quot;name&quot;</code> with just <code>type=&quot;name&quot;</code> the render method shows <code>nil</code> which I think was Sergio&#39;s point"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557269900, "post_id": 56030056, "comment_id": 98706335, "body": "Thanks, @engineersmnky. Oh, well. I knew I&#39;d eventually make a mistake."}], "tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": false, "score": 1, "last_activity_date": 1557269853, "last_edit_date": 1557269853, "creation_date": 1557260946, "answer_id": 56030056, "question_id": 56029489, "link": "https://stackoverflow.com/questions/56029489/how-to-create-class-variable-that-not-share-state-between-children/56030056#56030056", "title": "How to create class variable that not share state between Children", "body": "<p>Class variables are one of a triumvirate of Ruby tools that most experienced Rubiests rarely, if ever, use.<sup>1</sup>. Instead you want to use a <em>class-level instance variable</em>, <code>Parent</code> being an instance of the class <code>Class</code>.</p>\n\n<pre><code>class Parent\n  def self.type=(value)\n    @type = value\n  end\n\n  def self.type\n    @type\n  end\n\n  def render\n    puts self.class.type\n  end\nend\n</code></pre>\n\n<h1><p></p></h1>\n\n<pre><code>class Children &lt; Parent\n  self.type = \"name\"\nend\n\nChildren.new.render\n  #=&gt; \"name\"\n\nclass Children2 &lt; Parent\n  self.type = \"title\"\nend\n</code></pre>\n\n<h1><p></p></h1>\n\n<pre><code>Children2.new.render\n  #=&gt; \"title\"\nChildren.new.render\n  #=&gt; \"name\"\n</code></pre>\n\n<p>Firstly, the class method <code>type=</code> is called a \"setter\" and the class method \"type\" is called a \"getter\". You had a setter <code>type</code>, taking an argument. If you do that, how will you just get its value? To use it as a getter as well you'd have to do something like the following:</p>\n\n<pre><code>  def self.type=(value=nil)\n    if value.nil?\n      @type\n    else\n      @type = value\n    end\n  end\n</code></pre>\n\n<p>Here it would make more sense to just define a getter</p>\n\n<pre><code>  def self.type\n    @type\n  end\n</code></pre>\n\n<p>and having no setter, just writing, for example, <code>@type = \"name\"</code>. </p>\n\n<p>That is kludgy and only works if you don's want to set <code>@type</code> to <code>nil</code>. You could also leave your method as a setter and use <code>self.class.instance_variable_get(:@type)</code> to get its value, but that's equally awful. It's best to have a setter and a getter.</p>\n\n<p>When using the setter we need to preface <code>type</code> with <code>self.</code> to tell Ruby we wish to invoked the getter and not set a local variable <code>type</code> to a given value. Of course we could instead just write, for example, `@type = \"title\".</p>\n\n<p>The conventional way to create a setter and a getter is to write <code>attr_accessor :type</code> (invoking the class method <a href=\"http://ruby-doc.org/core-2.5.1/Module.html#method-i-attr_accessor\" rel=\"nofollow noreferrer\">Module#attr_accessor</a>). As class methods are stored in a class' singleton class, that could be done as follows<sup>2</sup>:</p>\n\n<pre><code>class Parent\n  class &lt;&lt; self\n    attr_accessor :type\n  end\n  def render\n    puts self.class.type\n  end\nend\n</code></pre>\n\n<h1><p></p></h1>\n\n<pre><code>class Children &lt; Parent\n  self.type = \"name\"\nend\n\nChildren.new.render\n  #=&gt; \"name\"\n\nclass Children2 &lt; Parent\n  self.type = \"title\"\nend\n</code></pre>\n\n<p>Now consider the instance method <code>Parent#render</code>. Being an instance method its receiver is an instance of the class (or a subclass), say <code>parent = Parent.new</code>. That means that when <code>render</code> is invoked within the method <code>self</code> equals <code>parent</code>. We want to invoke the class method <code>type</code>, however. We must therefore convert <code>parent</code> to <code>Parent</code>, which we do with <code>self.class</code>.</p>\n\n<p><sup>1. The other two (in my opinion, of course) are global variables and <code>for</code> loops. Their popularity among Ruby newbies is probably due to the fact that they tend to make their debut in Chapter 1 of many learning-Ruby books.</sup></p>\n\n<p><sup>2. There are many ways to define <code>attr_accessor</code> in <code>Parent</code>'s singleton class. Two others are <code>singleton_class.instance_eval do { attr_accessor :type }</code> and <code>singleton_class.send(:attr_accessor, :type)</code></sup>.</p>\n"}], "owner": {"reputation": 115, "user_id": 1505638, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7d98742c9ff78aa70d819857aca98380?s=128&d=identicon&r=PG", "display_name": "Renato Alves", "link": "https://stackoverflow.com/users/1505638/renato-alves"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1557269853, "creation_date": 1557258256, "last_edit_date": 1557263765, "question_id": 56029489, "link": "https://stackoverflow.com/questions/56029489/how-to-create-class-variable-that-not-share-state-between-children", "title": "How to create class variable that not share state between Children", "body": "<p>I wish to create a way to make Children classes express some business definitions on Class Level.</p>\n\n<p>I tried to use Class Variables for that, but i found that they share state between all Classes, so once i define the Second Class, the \"@@attribute\" class var changes its value for all adjacent Class instances.</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>class Parent\n  def self.type(value)\n    @@_type = value\n  end\n\n  def render\n    puts @@_type\n  end\nend\n\nclass Children &lt; Parent\n  type \"name\"\nend\n\nChildren.new.render # Result: name. Expected: name\n\nclass Children2 &lt; Parent\n  type \"title\"\nend\n\nChildren2.new.render # Result: title. Expected: title\nChildren.new.render # Result: title. Expected: name\n</code></pre>\n\n<p>How can i create this DSLs in the most simple and direct way?\nThis is a common pattern for several Ruby Gems, like HTTParty, Virtus, and etc.</p>\n\n<p>I even tried to look at their source code to understand how its done, but it seems too much complex for what i want.</p>\n\n<p>Thanks for your help!</p>\n"}, {"tags": ["ruby", "httparty"], "comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 2, "creation_date": 1557252382, "post_id": 56028213, "comment_id": 98700003, "body": "the parsed response will be a <code>Hash</code> so you can access the values in that fashion so in your case <code>HTTParty.get(&quot;https:&#47;&#47;api.somewhere.org&#47;export_id&#47;#{response&zwnj;&#8203;.parse_response[&#39;exp&zwnj;&#8203;ort_files&#39;][&#39;export_&zwnj;&#8203;id&#39;]}&quot;)</code> should work. obviously this is simplified to fit in a comment without any form of error handling"}, {"owner": {"reputation": 11, "user_id": 11429550, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9sO3x.jpg?s=128&g=1", "display_name": "Jen D.", "link": "https://stackoverflow.com/users/11429550/jen-d"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557264919, "post_id": 56028213, "comment_id": 98705060, "body": "Thanks! That worked well!"}], "answers": [{"tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": false, "score": 1, "last_activity_date": 1557265171, "creation_date": 1557265171, "answer_id": 56030809, "question_id": 56028213, "link": "https://stackoverflow.com/questions/56028213/using-parsed-response-in-separate-get-call/56030809#56030809", "title": "Using parsed response in separate GET call", "body": "<p>As described in the comments but a bit more verbose and skeleton for error:</p>\n\n<pre><code>require 'httparty'\nrequire 'json'\n\nurl = 'https://api.somewhere.org'\nresponse = HTTParty.post(url)\n\nif hash = JSON.parse(response.body)\n  if export_id = hash[:export_files][:export_id]\n    post = HTTParty.post(\"https://api.somewhere.org/export_id/#{export_id}\")\n  end\nelse\n  # handle error \nend\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 11429550, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9sO3x.jpg?s=128&g=1", "display_name": "Jen D.", "link": "https://stackoverflow.com/users/11429550/jen-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1557265171, "creation_date": 1557252172, "last_edit_date": 1557252478, "question_id": 56028213, "link": "https://stackoverflow.com/questions/56028213/using-parsed-response-in-separate-get-call", "title": "Using parsed response in separate GET call", "body": "<p>I'm new to Ruby and API, so my apologies if this is super simple...\nI need to have script that will first POST to initiate the creation of an export file, and then have a GET call to retrieve the file.  The GET call needs to use part of the POST json response.</p>\n\n<p>I'm using the httparty gem.</p>\n\n<p>I think I need to create a variable that equals the parsed json, and then make that variable part of the GET call, but I'm not clear on how to do that.\nHelp is appreciated. </p>\n\n<pre><code>require 'httparty'\nurl = 'https://api.somewhere.org'\nresponse = HTTParty.post(url)\nputs response.parse_response\n</code></pre>\n\n<p>json response:</p>\n\n<pre><code> export_files\"=&gt;\n   {\"id\"=&gt; #####,   \n   \"export_id\"=&gt; #####, \n   \"status\"=&gt;\"Queued\"}}\n</code></pre>\n\n<p>In my GET call I need to use the export_id number in the url.</p>\n\n<pre><code>HTTParty.get('https://api.somewhere.org/export_id/####')\n</code></pre>\n"}, {"tags": ["html", "ruby", "xpath", "nokogiri"], "comments": [{"owner": {"reputation": 1831, "user_id": 11102282, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a4ukS.jpg?s=128&g=1", "display_name": "Alejandro", "link": "https://stackoverflow.com/users/11102282/alejandro"}, "edited": false, "score": 0, "creation_date": 1557330101, "post_id": 56028178, "comment_id": 98730804, "body": "This is a perfect use case for XSLT..."}], "answers": [{"comments": [{"owner": {"reputation": 150540, "user_id": 128421, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/71770d043c0f7e3c7bc5f74190015c26?s=128&d=identicon&r=PG", "display_name": "the Tin Man", "link": "https://stackoverflow.com/users/128421/the-tin-man"}, "edited": false, "score": 0, "creation_date": 1563663023, "post_id": 56031437, "comment_id": 100774725, "body": "See &quot;<a href=\"https://meta.stackexchange.com/questions/109773/what-happens-if-you-answered-a-question-questioner-says-thanks-but-didnt-acce\">What happens if you answered a question, questioner says thanks, but didn&#39;t accept your answer as correct?</a>&quot; and &quot;<a href=\"https://meta.stackexchange.com/questions/14994/do-you-feel-dirty-if-you-nudge-new-users-to-accept-your-answer-when-they-indicat\">Do you feel dirty if you nudge new users to accept your answer when they indicate you&#39;ve answered their question?</a>&quot;"}], "tags": [], "owner": {"reputation": 1432, "user_id": 1184912, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc5f9407e5093fbd916ea4d80c7a499f?s=128&d=identicon&r=PG", "display_name": "eyevan", "link": "https://stackoverflow.com/users/1184912/eyevan"}, "is_accepted": true, "score": 0, "last_activity_date": 1563662983, "last_edit_date": 1563662983, "creation_date": 1557269623, "answer_id": 56031437, "question_id": 56028178, "link": "https://stackoverflow.com/questions/56028178/how-to-generate-a-different-html-format-from-a-nokogiri-collection-in-ruby/56031437#56031437", "title": "How to generate a different HTML format from a Nokogiri collection in Ruby", "body": "<p>The code you posted doesn't produce the output you posted. The code actually produces this:</p>\n\n<pre><code>&lt;a href=\"somelink1.html\"&gt;Link 1&lt;/a&gt;\n&lt;a href=\"#\"&gt;Link 2&lt;/a&gt;\n&lt;details&gt;\n  &lt;a href=\"somelink1.html\"&gt;Link 1&lt;/a&gt;\n  &lt;a href=\"#\"&gt;Link 2&lt;/a&gt;\n  &lt;a href=\"sublink1.html\"&gt;Sublink 1&lt;/a&gt;\n  &lt;a href=\"sublink2.html\"&gt;Sublink 2&lt;/a&gt;\n&lt;/details&gt;\n</code></pre>\n\n<p>I guess you don't want <code>Link 1</code> and <code>Link 2</code> in the <code>&lt;details&gt;</code> section.</p>\n\n<p>There's a problem with how you are using XPath selectors:</p>\n\n<pre><code>child.xpath(\"//li/ul\")\n</code></pre>\n\n<p>searches starting at the root of the document, not at the <code>child</code> element. Instead you need to use:</p>\n\n<pre><code>child.xpath(\".//li/ul\")\n</code></pre>\n\n<p>if you want to search starting at the <code>child</code> element.</p>\n\n<p>Here's the cleaned up code that should produce the output you need:</p>\n\n<pre><code>require 'nokogiri'\nsource_file = Nokogiri.XML(File.read(\"navigation.inc\").encode('UTF-8', 'binary', invalid: :replace, undef: :replace, replace: ''))\n\nnavigation = \"\"\n\nif source_file.xpath(\"//ul[@id = 'nav']\").length &gt; 0\n  navcontain = source_file.xpath(\"//ul[@id = 'nav']/li\")\n\n  navcontain.each do |child|\n    if child.xpath(\".//li and count(*) = 2\")\n      navigation += \"&lt;details&gt;\"\n\n      child.xpath(\".//ul/li/a\").each do |grandchild|\n        navigation += grandchild.to_s\n      end\n\n      navigation = navigation + \"&lt;/details&gt;\"\n    else\n      # not sure how that's supposed to work based on your input file example\n       navigation = navigation + source_file.xpath(\"//ul[@id = 'nav']/li/a\").to_s\n    end\n  end\nend\n\nputs navigation\n</code></pre>\n"}], "owner": {"reputation": 5, "user_id": 7851413, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6363433a418f6ed663243bfa75a300f7?s=128&d=identicon&r=PG&f=1", "display_name": "orionsf", "link": "https://stackoverflow.com/users/7851413/orionsf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 56031437, "answer_count": 1, "score": 0, "last_activity_date": 1563662983, "creation_date": 1557251993, "last_edit_date": 1563662820, "question_id": 56028178, "link": "https://stackoverflow.com/questions/56028178/how-to-generate-a-different-html-format-from-a-nokogiri-collection-in-ruby", "title": "How to generate a different HTML format from a Nokogiri collection in Ruby", "body": "<p>I'm working on a script that migrates a current HTML page and transforms it into a different HTML layout. I can get the information from the document using Nokogiri and XPath.</p>\n\n<p>The problem is how to traverse the nodes retrieved with a loop in a similar fashion to how an array and a hash are traversed to generate the layout that I need.</p>\n\n<p>This is a sample of the original layout that I am trying to convert:</p>\n\n<pre><code>&lt;ul id=\"nav\"&gt;\n    &lt;li&gt;&lt;a href=\"somelink1.html\"&gt;Link 1&lt;/a&gt; &lt;/li&gt;\n    &lt;li&gt;\n        &lt;a href=\"#\"&gt;Link 2&lt;/a&gt;\n        &lt;ul&gt;\n            &lt;li&gt;&lt;a href=\"sublink1.html\"&gt;Sublink 1&lt;/a&gt;&lt;/li&gt;\n            &lt;li&gt;&lt;a href=\"sublink2.html\"&gt;Sublink 2&lt;/a&gt;&lt;/li&gt;\n        &lt;/ul&gt;\n    &lt;/li&gt;\n&lt;/ul&gt;\n</code></pre>\n\n<p>This code is what I have tried so far. The problem is when it loops through the collection set it outputs all of the nodes in the new HTML tag each time a pass is made through the collection, rather than only outputting information at the current index.</p>\n\n<pre><code>require 'nokogiri'\nsource_file = Nokogiri.XML(open(\"navigation.inc\"))\nsource_file = Nokogiri.XML(source_file.to_s.encode('UTF-8', 'binary', invalid: :replace, undef: :replace, replace: ''))\n\nnavigation = \"\"\n\nif source_file.xpath(\"//ul[@id = 'nav']\").length &gt; 0\n\n   navcontain = source_file.xpath(\"//ul[@id = 'nav']/li\")\n\n   navcontain.each do | child |\n\n   if child.xpath(\"//li and count(*) = 2\")\n        navigation = navigation + \"&lt;details&gt;\"\n        child.xpath(\"//li/ul\").each do | children |\n                 navigation = navigation + child.xpath(\"//li/a\").to_s\n\n         end #end child loop\n        navigation = navigation + \"&lt;/details&gt;\"\n     else\n        navigation = navigation + source_file.xpath(\"//ul[@id = 'nav']/li/a\").to_s\n\n     end #end conditional check\n   end #end initial loop\nend #end length check\n\nputs navigation\n\n</code></pre>\n\n<p>This is an example of what the code above is currently doing:</p>\n\n<pre><code>&lt;div id=\"nav\"&gt;\n    &lt;details&gt;\n        &lt;a href=\"somelink1.html\"&gt;Link 1&lt;/a&gt;\n        &lt;a href=\"#\"&gt;Link 2&lt;/a&gt;\n        &lt;a href=\"sublink1.html\"&gt;Sublink 1&lt;/a&gt;\n        &lt;a href=\"sublink2.html\"&gt;Sublink 2&lt;/a&gt;\n    &lt;/details&gt;\n    &lt;details&gt;\n        &lt;a href=\"somelink1.html\"&gt;Link 1&lt;/a&gt;\n        &lt;a href=\"#\"&gt;Link 2&lt;/a&gt;\n        &lt;a href=\"sublink1.html\"&gt;Sublink 1&lt;/a&gt;\n        &lt;a href=\"sublink2.html\"&gt;Sublink 2&lt;/a&gt;\n    &lt;/details&gt;\n\n&lt;/div&gt;\n\n</code></pre>\n\n<p>The format that I want after the transformation is:</p>\n\n<pre><code>&lt;div id=\"nav\"&gt;\n    &lt;a href=\"somelink1.html\"&gt;Link 1&lt;/a&gt;\n\n    &lt;details&gt;\n        &lt;summary&gt;\n            Link 2\n        &lt;/summary&gt;\n\n        &lt;a href=\"sublink1.html\"&gt;Sublink 1&lt;/a&gt;\n        &lt;a href=\"sublink2.html\"&gt;Sublink 2&lt;/a&gt;\n\n    &lt;/details&gt;\n\n&lt;/div&gt;\n\n</code></pre>\n\n<p>I believe part of the code works correctly as I can identify the total number of single and second-level link structures. I haven't figured out how to translate the data to the final version I need. </p>\n"}, {"tags": ["ruby-on-rails", "ruby", "postgresql", "activerecord"], "comments": [{"owner": {"reputation": 51013, "user_id": 976775, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/30bd66ad1795804aebe249d8bcb14409?s=128&d=identicon&r=PG", "display_name": "MrYoshiji", "link": "https://stackoverflow.com/users/976775/mryoshiji"}, "edited": false, "score": 3, "creation_date": 1557252146, "post_id": 56028071, "comment_id": 98699892, "body": "since a user may have many cars, which value of <code>issued_at</code> should be used for the ordering? This question is the implication of the error message you get: you did not tell PostgreSQL which value of all the possible <code>issued_at</code> it should use to order. You could use <code>max(cars.issued_at)</code> to order by <i>latest</i>, for example, but this depends on your needs."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "reply_to_user": {"reputation": 51013, "user_id": 976775, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/30bd66ad1795804aebe249d8bcb14409?s=128&d=identicon&r=PG", "display_name": "MrYoshiji", "link": "https://stackoverflow.com/users/976775/mryoshiji"}, "edited": false, "score": 1, "creation_date": 1557252614, "post_id": 56028071, "comment_id": 98700129, "body": "What @MrYoshiji said. However if you are interested in all the <code>User</code>s being ordered by all the <code>issue_at</code> dates then just remove the <code>group</code> portion. User objects may be displayed more than once as they appear in this ordering"}], "answers": [{"tags": [], "owner": {"reputation": 22303, "user_id": 2456433, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NiN8K.jpg?s=128&g=1", "display_name": "infused", "link": "https://stackoverflow.com/users/2456433/infused"}, "is_accepted": true, "score": 1, "last_activity_date": 1557261065, "creation_date": 1557261065, "answer_id": 56030081, "question_id": 56028071, "link": "https://stackoverflow.com/questions/56028071/rails-ordering-parents-by-grand-childrens-attribute/56030081#56030081", "title": "Rails: Ordering parents by grand children&#39;s attribute", "body": "<p>Use <code>distinct</code> instead of <code>group</code> to get rid of the duplicates:</p>\n\n<pre><code>@q = User.active.joins(:cars).order('cars.issued_at').distinct\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 301, "user_id": 5138485, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K4fTJWCrpp4/AAAAAAAAAAI/AAAAAAAAB0o/KSBsbEj0Xz4/photo.jpg?sz=128", "display_name": "Kishor Vyavahare", "link": "https://stackoverflow.com/users/5138485/kishor-vyavahare"}, "edited": false, "score": 0, "creation_date": 1557314526, "post_id": 56030095, "comment_id": 98721297, "body": "Yes right I&#39;m also not able to reproduce it as I removed &#39;active&#39; scope. It&#39;s working fine. <code>User.joins(:cars).order(&#39;cars.issued_at&#39;).group(&#39;users.id&#39;)</code>"}], "tags": [], "owner": {"reputation": 1211, "user_id": 10993539, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NKkKh.png?s=128&g=1", "display_name": "localhostdotdev", "link": "https://stackoverflow.com/users/10993539/localhostdotdev"}, "is_accepted": false, "score": 1, "last_activity_date": 1557261116, "creation_date": 1557261116, "answer_id": 56030095, "question_id": 56028071, "link": "https://stackoverflow.com/questions/56028071/rails-ordering-parents-by-grand-childrens-attribute/56030095#56030095", "title": "Rails: Ordering parents by grand children&#39;s attribute", "body": "<p>here is a reproduction repo: <a href=\"https://github.com/localhostdotdev/bug/tree/ordering-parents-by-grand-children\" rel=\"nofollow noreferrer\">https://github.com/localhostdotdev/bug/tree/ordering-parents-by-grand-children</a></p>\n\n<p>when making the same query I don't see any error, the issue must be in your <code>active</code> scope.</p>\n\n<p>here is the full query with a <code>scope :active, -&gt; { where(active: true) }</code>:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>SELECT \"users\".*\nFROM \"users\"\nINNER JOIN \"calendars\" ON \"calendars\".\"user_id\" = \"users\".\"id\"\nINNER JOIN \"cars\" ON \"cars\".\"calendar_id\" = \"calendars\".\"id\"\nWHERE \"users\".\"active\" = ?\nGROUP BY users.id\nORDER BY cars.issued_at\nLIMIT ?\n</code></pre>\n\n<p>I'm unable to reproduce your issue.</p>\n"}], "owner": {"reputation": 119, "user_id": 11347906, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-qoAGArQpAPQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reVLjRNnqCXF01NVMsS2UXMwZJKCg/mo/photo.jpg?sz=128", "display_name": "Y.Z", "link": "https://stackoverflow.com/users/11347906/y-z"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 1, "accepted_answer_id": 56030081, "answer_count": 2, "score": 4, "last_activity_date": 1557261116, "creation_date": 1557251569, "question_id": 56028071, "link": "https://stackoverflow.com/questions/56028071/rails-ordering-parents-by-grand-childrens-attribute", "title": "Rails: Ordering parents by grand children&#39;s attribute", "body": "<pre><code>class User\n  has_many :calendars\n  has_many :cars, through: :calendars\nend\n\nclass Calendar\n  has_many :cars\nend\n\nclass Car\n  # attribute `issued_at`\nend\n</code></pre>\n\n<p>I need to order users by <code>issued_at</code> of his cars. So ordering the parent by the grand children's attribute <code>issued_at</code>.</p>\n\n<p>Here is so far:</p>\n\n<pre><code>@q = User.active.joins(:cars).order('cars.issued_at').group('users.id')\n</code></pre>\n\n<p>But I'm getting</p>\n\n<pre><code>column \"cars.issued_at\" must appear in the GROUP BY clause or be used in an aggregate function\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "activerecord"], "comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557249716, "post_id": 56027547, "comment_id": 98698782, "body": "Every record across all tables? Any reason a) you would need to do this? b) you would like to falsify when the records were actually created? <code>ActiveRecord::Base.connection.execute(&quot;UPDATE table_name SET created_at = DateAdd(d,4,created_at)&quot;)</code> will do it for a single table if you really must"}, {"owner": {"reputation": 11, "user_id": 10942244, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae2fed1db8265bd02317e67217c13729?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/10942244/adrian"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557250265, "post_id": 56027547, "comment_id": 98699001, "body": "Thanks. Essentially yes I just want to see if it was indeed possible to change when records were created. I tried running what you said but no luck. I&#39;m using PostgreSQl btw."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 1, "creation_date": 1557250615, "post_id": 56027547, "comment_id": 98699155, "body": "Okay try <code>ActiveRecord::Base.connection.execute(&quot;UPDATE table_name SET created_at = created_at + interval &#39;4 days&#39;&quot;)</code> in Postgres"}, {"owner": {"reputation": 11, "user_id": 10942244, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae2fed1db8265bd02317e67217c13729?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/10942244/adrian"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557250765, "post_id": 56027547, "comment_id": 98699241, "body": "Awesome it worked! Thank you!"}, {"owner": {"reputation": 1275, "user_id": 2903313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce1623b00b100930ac65e69a8069cd28?s=128&d=identicon&r=PG", "display_name": "Roc Khalil", "link": "https://stackoverflow.com/users/2903313/roc-khalil"}, "edited": false, "score": 0, "creation_date": 1557405212, "post_id": 56027547, "comment_id": 98759426, "body": "The <code>rails</code> way is: <code>Model.find_each { |m| m.update(created_at: m.created_at + 4.days) }</code>"}], "answers": [{"comments": [{"owner": {"reputation": 6486, "user_id": 1116230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55a894894150db28d6641f0c57e48bac?s=128&d=identicon&r=PG", "display_name": "Nico Haase", "link": "https://stackoverflow.com/users/1116230/nico-haase"}, "edited": false, "score": 0, "creation_date": 1563545649, "post_id": 57089420, "comment_id": 100747284, "body": "Please add some explanation to your answer such that others can learn from it - why should one try to execute that line?"}], "tags": [], "owner": {"reputation": 56, "user_id": 9069168, "user_type": "registered", "profile_image": "https://graph.facebook.com/1573157946093303/picture?type=large", "display_name": "Abhishek Kushwaha", "link": "https://stackoverflow.com/users/9069168/abhishek-kushwaha"}, "is_accepted": false, "score": 0, "last_activity_date": 1563435636, "creation_date": 1563435636, "answer_id": 57089420, "question_id": 56027547, "link": "https://stackoverflow.com/questions/56027547/i-want-to-add-4-days-to-the-created-at-column-for-all-records-in-a-database-is/57089420#57089420", "title": "I want to add 4 days to the created_at column for all records in a database. Is there a way to do this in the rails console?", "body": "<p>Try executing following line of code:</p>\n\n<pre><code>ActiveRecord::Base.connection.execute(\"UPDATE TABLE_NAME(NOT MODEL NAME) SET updated_at = updated_at + interval '4 days'\")\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 10942244, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae2fed1db8265bd02317e67217c13729?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/10942244/adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1563435636, "creation_date": 1557249255, "last_edit_date": 1557250222, "question_id": 56027547, "link": "https://stackoverflow.com/questions/56027547/i-want-to-add-4-days-to-the-created-at-column-for-all-records-in-a-database-is", "title": "I want to add 4 days to the created_at column for all records in a database. Is there a way to do this in the rails console?", "body": "<p>I have a bunch of records in a database where i want to update the \"created_at\" column. Is there a way in the rails console that I can access every record in the database and add, let's say 4 days, to the created_at column? </p>\n\n<p>I've tried looking up other answers but none have really helped especially when trying to add days or  months to all records for the created_at column.</p>\n\n<p>I'm using PostgreSql</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "db2", "multiprocessing"], "comments": [{"owner": {"reputation": 308, "user_id": 2218094, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PnUld.jpg?s=128&g=1", "display_name": "SgtPepper", "link": "https://stackoverflow.com/users/2218094/sgtpepper"}, "edited": false, "score": 0, "creation_date": 1557257864, "post_id": 56026529, "comment_id": 98702339, "body": "Can you please upload the stack trace to a gist and share the link? You said it crashes from time to time, does that happen when you have too much data? If so you could try using batches <a href=\"https://api.rubyonrails.org/classes/ActiveRecord/Batches.html#method-i-in_batches\" rel=\"nofollow noreferrer\">api.rubyonrails.org/classes/ActiveRecord/&hellip;</a>"}, {"owner": {"reputation": 16538, "user_id": 1227152, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4hr5l.jpg?s=128&g=1", "display_name": "mustaccio", "link": "https://stackoverflow.com/users/1227152/mustaccio"}, "edited": false, "score": 0, "creation_date": 1557272215, "post_id": 56026529, "comment_id": 98706790, "body": "It&#39;s hard to say without seeing more of your code, but if you share <code>self.conn</code> between different threads you might want to stop doing so."}, {"owner": {"reputation": 189, "user_id": 3978752, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e66d75a76c4af053305b0e2021788e7?s=128&d=identicon&r=PG&f=1", "display_name": "Rares R", "link": "https://stackoverflow.com/users/3978752/rares-r"}, "reply_to_user": {"reputation": 308, "user_id": 2218094, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PnUld.jpg?s=128&g=1", "display_name": "SgtPepper", "link": "https://stackoverflow.com/users/2218094/sgtpepper"}, "edited": false, "score": 0, "creation_date": 1557294618, "post_id": 56026529, "comment_id": 98711295, "body": "@SgtPepper I uploaded the crash report on gist. Actually, I build a query that returns data from DB2 in batches, around 50_000 / or 10_000. And the user Active Record Import, to import the data."}, {"owner": {"reputation": 189, "user_id": 3978752, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e66d75a76c4af053305b0e2021788e7?s=128&d=identicon&r=PG&f=1", "display_name": "Rares R", "link": "https://stackoverflow.com/users/3978752/rares-r"}, "reply_to_user": {"reputation": 16538, "user_id": 1227152, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4hr5l.jpg?s=128&g=1", "display_name": "mustaccio", "link": "https://stackoverflow.com/users/1227152/mustaccio"}, "edited": false, "score": 0, "creation_date": 1557294697, "post_id": 56026529, "comment_id": 98711321, "body": "@mustaccio I am a bit confused because if I use multiple processes of Sidekiq with concurrency 1, aren&#39;t they actually different threads? They should do independently create a new connection..."}, {"owner": {"reputation": 308, "user_id": 2218094, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PnUld.jpg?s=128&g=1", "display_name": "SgtPepper", "link": "https://stackoverflow.com/users/2218094/sgtpepper"}, "edited": false, "score": 0, "creation_date": 1557334530, "post_id": 56026529, "comment_id": 98732807, "body": "Doing a bit of research with the backtrace you provided, I found this could be a Redis issue, one guy mentioned <code>I noticed the Redis class makes no attempt to automatically disconnect&#47;quit its client connection when the Redis object is garbage collected and instead appears to force the application to manage that. </code> Other guy mentioned <code>I have also manually added a bunch of redis.disconnect! calls around our application to mitigate this.</code> take a look at this as a reference <a href=\"https://github.com/redis/redis-rb/issues/524\" rel=\"nofollow noreferrer\">github.com/redis/redis-rb/issues/524</a>"}, {"owner": {"reputation": 189, "user_id": 3978752, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e66d75a76c4af053305b0e2021788e7?s=128&d=identicon&r=PG&f=1", "display_name": "Rares R", "link": "https://stackoverflow.com/users/3978752/rares-r"}, "reply_to_user": {"reputation": 308, "user_id": 2218094, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PnUld.jpg?s=128&g=1", "display_name": "SgtPepper", "link": "https://stackoverflow.com/users/2218094/sgtpepper"}, "edited": false, "score": 0, "creation_date": 1557341079, "post_id": 56026529, "comment_id": 98736006, "body": "@SgtPepper Thank you for the feedback! I actually made it work. I downgraded to Rails 5.1 from 5.2 (required for IBM_DB gem) and changed the job processor to Resque. And removed the GEM bootsnap. Using Resque, with 10 processes each with a concurrency of 1, all works as expected."}, {"owner": {"reputation": 189, "user_id": 3978752, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e66d75a76c4af053305b0e2021788e7?s=128&d=identicon&r=PG&f=1", "display_name": "Rares R", "link": "https://stackoverflow.com/users/3978752/rares-r"}, "edited": false, "score": 0, "creation_date": 1557341149, "post_id": 56026529, "comment_id": 98736034, "body": "Digging into the logs, I found out a trace from bootsnap, that actually seemed suspicious."}], "owner": {"reputation": 189, "user_id": 3978752, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e66d75a76c4af053305b0e2021788e7?s=128&d=identicon&r=PG&f=1", "display_name": "Rares R", "link": "https://stackoverflow.com/users/3978752/rares-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1557296890, "creation_date": 1557245068, "last_edit_date": 1557296890, "question_id": 56026529, "link": "https://stackoverflow.com/questions/56026529/ruby-on-rails-with-ibm-db2-gem", "title": "Ruby on Rails with IBM_DB2 Gem", "body": "<p>Currently, I'm trying to migrate a large data set from an IBM DB2 database. I found a quick way of doing queries using imb_db2 gem (version 4.0.0).</p>\n\n<p>The main goal is to have a script that runs in parallel and imports independent data. </p>\n\n<p>My import script works fine sequential, but when trying to execute the script into multiple background processes, it crashes the process. </p>\n\n<p>I tried Sidekiq with multiple processes, each process with its own queue.</p>\n\n<p>For example, I try the following approach</p>\n\n<pre><code>DemoWorker.set(queue: :que_1).perform_async(1, 10)\n</code></pre>\n\n<p>Then I do </p>\n\n<pre><code>DemoWorker.set(queue: :que_2).perform_async(11, 20)\n</code></pre>\n\n<p>Each queue has its independent Sidekiq process, with concurrency 1. E.g.</p>\n\n<pre><code>bundle exec sidekiq -e development -C config/sidekiq.yml -q que_1\n</code></pre>\n\n<p>And I execute the following code with a query as a parameter</p>\n\n<pre><code>  def get_by_sql(sql)\n    data = []\n    stmt = IBM_DB.exec(self.conn, sql.squish)\n\n    while row = IBM_DB.fetch_assoc(stmt)\n      data &lt;&lt; row\n    end\n\n    data\n  end\n</code></pre>\n\n<p>And from time to time I get the following crash error.</p>\n\n<p><strong>[BUG] object allocation during garbage collection phase</strong></p>\n\n<p>I have no idea why it fails, could you advise? Thank you very much!</p>\n\n<p>And here is the crash report: <a href=\"https://ufile.io/fqmfh0y8\" rel=\"nofollow noreferrer\">https://ufile.io/fqmfh0y8</a></p>\n\n<p>EDIT:\nCrash Report uploaded to GIST: <a href=\"https://gist.github.com/RaresSalcudean/db8467bc4cd3ea2164bcaab5da86780e\" rel=\"nofollow noreferrer\">https://gist.github.com/RaresSalcudean/db8467bc4cd3ea2164bcaab5da86780e</a></p>\n\n<p>Crash 2 Report: <a href=\"https://gist.github.com/RaresSalcudean/6f7bb7f74e34a537b687c776d806bf04\" rel=\"nofollow noreferrer\">https://gist.github.com/RaresSalcudean/6f7bb7f74e34a537b687c776d806bf04</a></p>\n"}, {"tags": ["javascript", "css", "ruby", "bootstrap-modal", "haml"], "answers": [{"tags": [], "owner": {"reputation": 3705, "user_id": 8551976, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oxgdN.jpg?s=128&g=1", "display_name": "asimhashmi", "link": "https://stackoverflow.com/users/8551976/asimhashmi"}, "is_accepted": false, "score": 0, "last_activity_date": 1557240564, "creation_date": 1557240564, "answer_id": 56025265, "question_id": 56024977, "link": "https://stackoverflow.com/questions/56024977/modal-dialog-doesnt-work-with-bootstrap-4/56025265#56025265", "title": "Modal dialog doesn&#39;t work with bootstrap 4", "body": "<p>Try to change your code like this:</p>\n\n<p>You need to add data-target property to you button and give the id of your model as value </p>\n\n<pre><code>form-group %label.control-label{ :for =&gt; \"overview\" } \n%a.btn.btn-info{ :href=&gt; \"#modaloverview\", \"data-toggle\" =&gt; \"modal\", \"data-target\" =&gt; \"#myModal\" } INFO \n#myModal.modal.modal.hide.fade#modaloverview{ :tabindex =&gt; \"-1\", :role =&gt; \"dialog\", \"aria-labelledby\" =&gt; \"modal-label\", \"aria-hidden\" =&gt; \"true\"} .modal-header %button.close{ :type =&gt; \"button\", \"data-dismiss\" =&gt; \"modal\", \"aria-hidden\" =&gt; \"true\" } X \n  %h3\n    #modal-label titletextetxtetxtext \n .modal-body\n   %p texttextetxtetxtettxtte .controls                 \n    %textarea.form-control.input-xxlarge.allowMarkupShortcut\n\n  #overview{ :rows =&gt; \"10\", :name =&gt; \"overview\" } - if @finding - if @finding.overview #{meta_markup(@findin\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 7550190, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b02bce8dba09613748c8b5bfb2f06d6?s=128&d=identicon&r=PG&f=1", "display_name": "sinc00", "link": "https://stackoverflow.com/users/7550190/sinc00"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 38, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1557240564, "creation_date": 1557239622, "question_id": 56024977, "link": "https://stackoverflow.com/questions/56024977/modal-dialog-doesnt-work-with-bootstrap-4", "title": "Modal dialog doesn&#39;t work with bootstrap 4", "body": "<p>My code doesn't work with bootstrap 4. When I click on button overview, the page is darkening but a dialog doesn't show. It's work with old bootstrap. Can you help me?</p>\n\n<pre><code>        .form-group\n          %label.control-label{ :for =&gt; \"overview\" }\n            %a.btn.btn-info{ :href=&gt; \"#modaloverview\", \"data-toggle\" =&gt; \"modal\"}\n              INFO\n          .modal.modal.hide.fade#modaloverview{ :tabindex =&gt; \"-1\", :role =&gt; \"dialog\", \"aria-labelledby\" =&gt; \"modal-label\", \"aria-hidden\" =&gt; \"true\"}\n            .modal-header\n              %button.close{ :type =&gt; \"button\", \"data-dismiss\" =&gt; \"modal\", \"aria-hidden\" =&gt; \"true\" }\n                X\n              %h3#modal-label\n                titletextetxtetxtext\n            .modal-body\n              %p\n                texttextetxtetxtettxtte\n          .controls\n            %textarea.form-control.input-xxlarge.allowMarkupShortcut#overview{ :rows =&gt; \"10\", :name =&gt; \"overview\" }\n              - if @finding\n                - if @finding.overview\n                  #{meta_markup(@finding.overview)}\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "rubygems"], "answers": [{"comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557252766, "post_id": 56025457, "comment_id": 98700185, "body": "Do you believe the deprecation warning is actually the issue here? I can&#39;t imagine that this warning would cause a stack recursion issue but I cannot confirm or deny it outright."}, {"owner": {"reputation": 11, "user_id": 11465232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb8e642395e5ebad69df12d9c8cd6035?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/11465232/sam"}, "edited": false, "score": 0, "creation_date": 1557262279, "post_id": 56025457, "comment_id": 98704185, "body": "I installed Ruby 2.4.5 with Rails 4.2.7.1 but still get the same error. Now instead of getting &quot;Process finished with exit code 1&quot; I get &quot;Process finished with exit code -1073741819 (0xC0000005)&quot;"}], "tags": [], "owner": {"reputation": 80852, "user_id": 2483313, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rIBTG.jpg?s=128&g=1", "display_name": "spickermann", "link": "https://stackoverflow.com/users/2483313/spickermann"}, "is_accepted": false, "score": 3, "last_activity_date": 1557247539, "last_edit_date": 1557247539, "creation_date": 1557241240, "answer_id": 56025457, "question_id": 56024735, "link": "https://stackoverflow.com/questions/56024735/how-to-fix-warning-constant-fixnum-is-deprecated-error/56025457#56025457", "title": "How to fix &#39;warning: constant ::Fixnum is deprecated&#39; error", "body": "<p>You are using an old version of Rails with a newer version of Ruby and Rails wants to use something (<code>Fixnum</code>) that doesn't exist anymore in the new version of Ruby.</p>\n\n<p>You have two options:</p>\n\n<ol>\n<li>Use a version of Ruby that is supported by your old version of Rails. According to <a href=\"https://stackoverflow.com/questions/9087116/which-ruby-on-rails-is-compatible-with-which-ruby-version\">this list</a> Ruby 2.4 should work for you.</li>\n<li>Update your Rails application to a newer version of Rails that supports Ruby 2.5. Rails 5.1 seems to be the first version of Rails which officially supports Ruby 2.5</li>\n</ol>\n\n<p>The first option is probably much easier. But I still suggest updating your Rails version because your Rails version is unmaintained and will not get any updates or security anymore.</p>\n"}], "owner": {"reputation": 11, "user_id": 11465232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb8e642395e5ebad69df12d9c8cd6035?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/11465232/sam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4718, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1557247539, "creation_date": 1557238870, "question_id": 56024735, "link": "https://stackoverflow.com/questions/56024735/how-to-fix-warning-constant-fixnum-is-deprecated-error", "title": "How to fix &#39;warning: constant ::Fixnum is deprecated&#39; error", "body": "<p>When I'm trying to run my rails server from RubyMine IDE, I get the error:</p>\n\n<pre><code>C:/Ruby25-x64/lib/ruby/gems/2.5.0/gems/activesupport-4.2.7.1/lib/active_support/core_ext/numeric/conversions.rb:121: warning: constant ::Fixnum is deprecated\nC:/Ruby25-x64/lib/ruby/gems/2.5.0/gems/activesupport-4.2.7.1/lib/active_support/core_ext/numeric/conversions.rb:121: warning: constant ::Bignum is deprecated\nExitingTraceback\n</code></pre>\n\n<p>I'm currently running Ruby 2.5.5p157 with Rails 4.2.7.1. What should I do in order to run the web app? Thank you very much for your help!</p>\n\n<hr>\n\n<p>Full log when attempting to run the website:</p>\n\n<pre><code>C:\\Ruby25-x64\\bin\\ruby.exe \"C:/Users/Sam/Desktop/Takai/Website/bin/rails\" server -b 127.0.0.1 -p 3000 -e development -b 0.0.0.0\n=&gt; Booting WEBrick\n=&gt; Rails 4.2.7.1 application starting in development on http://0.0.0.0:3000\n=&gt; Run `rails server -h` for more startup options\n=&gt; Ctrl-C to shutdown server\nC:/Ruby25-x64/lib/ruby/gems/2.5.0/gems/activesupport-4.2.7.1/lib/active_support/core_ext/numeric/conversions.rb:121: warning: constant ::Fixnum is deprecated\nC:/Ruby25-x64/lib/ruby/gems/2.5.0/gems/activesupport-4.2.7.1/lib/active_support/core_ext/numeric/conversions.rb:121: warning: constant ::Bignum is deprecated\nExitingTraceback\n (most recent call last):\nC:/Users/Sam/Desktop/Takai/Website/bin/rails: stack level too deep (SystemStackError)\n\nProcess finished with exit code 1\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-5"], "comments": [{"owner": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1557234630, "post_id": 56023316, "comment_id": 98690442, "body": "<code>ModelName.real</code> is not something built into core rails. This is something that you, or a team member, have defined in the code. It may be defined as a <code>scope</code>."}, {"owner": {"reputation": 595, "user_id": 3632472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e431a79c8cf18fc5c29ebb94a721dda?s=128&d=identicon&r=PG&f=1", "display_name": "Rakesh", "link": "https://stackoverflow.com/users/3632472/rakesh"}, "reply_to_user": {"reputation": 22436, "user_id": 1954610, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/27d84db27dd0528916e8cd6954bdd328?s=128&d=identicon&r=PG", "display_name": "Tom Lord", "link": "https://stackoverflow.com/users/1954610/tom-lord"}, "edited": false, "score": 0, "creation_date": 1557237403, "post_id": 56023316, "comment_id": 98692196, "body": "Yes Tom, &quot;real&quot; is a scope name. I forgot to mention it. :)"}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557253006, "post_id": 56023316, "comment_id": 98700283, "body": "Sidenote <code>ModelName.to_s</code> does not make a lot of sense here as <code>ModelName</code> or <code>&#39;ModelName&#39;</code> would suffice. The reason one usually goes with the String version is due to load order since the <code>String</code> version will not require a constant to already be defined or cause rails to go and find such a constant and load it. in this case you are already causing rails to check if it is loaded and if not go load it then convert it to a <code>String</code> and then back to a constant when the method is called."}, {"owner": {"reputation": 595, "user_id": 3632472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e431a79c8cf18fc5c29ebb94a721dda?s=128&d=identicon&r=PG&f=1", "display_name": "Rakesh", "link": "https://stackoverflow.com/users/3632472/rakesh"}, "edited": false, "score": 0, "creation_date": 1557298078, "post_id": 56023316, "comment_id": 98712542, "body": "thank you  engineersmnky for explanation"}], "answers": [{"tags": [], "owner": {"reputation": 3922, "user_id": 3399504, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rRGvW.png?s=128&g=1", "display_name": "ErvalhouS", "link": "https://stackoverflow.com/users/3399504/ervalhous"}, "is_accepted": false, "score": 1, "last_activity_date": 1557234627, "creation_date": 1557234627, "answer_id": 56023390, "question_id": 56023316, "link": "https://stackoverflow.com/questions/56023316/modelname-real-in-models-of-rails-application/56023390#56023390", "title": "ModelName.real in models of Rails application", "body": "<p>You probably have a method or a scope called <code>real</code> on <code>ModelName</code> <a href=\"https://apidock.com/rails/ActiveRecord/SpawnMethods/merge\" rel=\"nofollow noreferrer\">which gets merged</a> on the relation query.</p>\n\n<p><a href=\"https://api.rubyonrails.org/classes/ActiveRecord/Associations/ClassMethods.html#method-i-has_many-label-Scopes\" rel=\"nofollow noreferrer\">Calling a lambda in a relation applies a kind of default scope</a> when calling it, so what happens when you call <code>MyModel.association_name</code> is:</p>\n\n<pre><code>MyModel.association_name.merge(ModelName.real)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1012, "user_id": 10347572, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iottG.jpg?s=128&g=1", "display_name": "escanxr", "link": "https://stackoverflow.com/users/10347572/escanxr"}, "is_accepted": false, "score": 0, "last_activity_date": 1557235758, "last_edit_date": 1557235758, "creation_date": 1557234836, "answer_id": 56023463, "question_id": 56023316, "link": "https://stackoverflow.com/questions/56023316/modelname-real-in-models-of-rails-application/56023463#56023463", "title": "ModelName.real in models of Rails application", "body": "<p>Associations may have an optional scope. You should have a method or a scope called <code>real</code> within ModelName.</p>\n\n<p>For the class_name option:</p>\n\n<blockquote>\n  <p>Specify the class name of the association. Use it only if that name\n  can\u2019t be inferred from the association name. So has_many :products\n  will by default be linked to the Product class, but if the real class\n  name is SpecialProduct, you\u2019ll have to specify it with this option.</p>\n</blockquote>\n"}], "owner": {"reputation": 595, "user_id": 3632472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e431a79c8cf18fc5c29ebb94a721dda?s=128&d=identicon&r=PG&f=1", "display_name": "Rakesh", "link": "https://stackoverflow.com/users/3632472/rakesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1557235758, "creation_date": 1557234351, "last_edit_date": 1557234418, "question_id": 56023316, "link": "https://stackoverflow.com/questions/56023316/modelname-real-in-models-of-rails-application", "title": "ModelName.real in models of Rails application", "body": "<p>I have checked one code where in the model its was written an association .</p>\n\n<pre><code>has_many :association_name, -&gt; { merge(ModelName.real) }, class_name: ModelName.to_s\n</code></pre>\n\n<p>I would be great if some one explain it.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "rubygems", "google-sheets-api"], "comments": [{"owner": {"reputation": 4690, "user_id": 1937435, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YyN37.jpg?s=128&g=1", "display_name": "Josh Brody", "link": "https://stackoverflow.com/users/1937435/josh-brody"}, "edited": false, "score": 0, "creation_date": 1557242822, "post_id": 56023031, "comment_id": 98695486, "body": "Forward isn&#39;t what you&#39;re looking for - it merely exposes localhost"}, {"owner": {"reputation": 31, "user_id": 5079762, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff7dc4d8a240d80f0510a73e64e5f99e?s=128&d=identicon&r=PG&f=1", "display_name": "kzkd8", "link": "https://stackoverflow.com/users/5079762/kzkd8"}, "reply_to_user": {"reputation": 4690, "user_id": 1937435, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YyN37.jpg?s=128&g=1", "display_name": "Josh Brody", "link": "https://stackoverflow.com/users/1937435/josh-brody"}, "edited": false, "score": 0, "creation_date": 1558143036, "post_id": 56023031, "comment_id": 99014720, "body": "Oh I was thinking it too difficult. Thank you!"}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 5079762, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff7dc4d8a240d80f0510a73e64e5f99e?s=128&d=identicon&r=PG&f=1", "display_name": "kzkd8", "link": "https://stackoverflow.com/users/5079762/kzkd8"}, "edited": false, "score": 0, "creation_date": 1558143020, "post_id": 56031764, "comment_id": 99014719, "body": "Oh I was thinking it too difficult. Thank you!"}], "tags": [], "owner": {"reputation": 3502, "user_id": 2558108, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DUiG3.jpg?s=128&g=1", "display_name": "Qwertie", "link": "https://stackoverflow.com/users/2558108/qwertie"}, "is_accepted": false, "score": 0, "last_activity_date": 1557272586, "creation_date": 1557272586, "answer_id": 56031764, "question_id": 56023031, "link": "https://stackoverflow.com/questions/56023031/to-add-shareable-link-on-apps-without-login-func/56031764#56031764", "title": "To add shareable link on apps without login func", "body": "<p>Rails views require no login by default. To get a link that doesn't require users to log in you simply do not add a feature that requires login. You can then in the view check if there is a user signed in and add extra buttons for admin features.</p>\n"}], "owner": {"reputation": 31, "user_id": 5079762, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff7dc4d8a240d80f0510a73e64e5f99e?s=128&d=identicon&r=PG&f=1", "display_name": "kzkd8", "link": "https://stackoverflow.com/users/5079762/kzkd8"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1557272586, "creation_date": 1557233432, "question_id": 56023031, "link": "https://stackoverflow.com/questions/56023031/to-add-shareable-link-on-apps-without-login-func", "title": "To add shareable link on apps without login func", "body": "<p>I have a project to make English learning apps.</p>\n\n<p>There is four layer of users; headquarters, admins, classes and students. For better UX, I want to add shareable links to students my page. So no need for login func. to students. Students can use app without login.</p>\n\n<p>Gem called forward is similar to this func. Is there another way to implement this func.?</p>\n\n<p>Gem called forward is the best solution...?\n<a href=\"https://rubygems.org/gems/forward\" rel=\"nofollow noreferrer\">https://rubygems.org/gems/forward</a></p>\n"}, {"tags": ["ruby-on-rails", "ruby", "bundle"], "answers": [{"tags": [], "owner": {"reputation": 379, "user_id": 818033, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/sW1NC.jpg?s=128&g=1", "display_name": "msdundar", "link": "https://stackoverflow.com/users/818033/msdundar"}, "is_accepted": false, "score": 1, "last_activity_date": 1557233599, "creation_date": 1557233599, "answer_id": 56023082, "question_id": 56022934, "link": "https://stackoverflow.com/questions/56022934/how-to-fix-bundle-version-incompatibility/56023082#56023082", "title": "How to fix bundle version incompatibility?", "body": "<p>You got Bundler <code>2.0.1</code> installed on your computer, but apparently your Gemfile requires <code>bundler (&lt; 2.0, &gt;= 1.3.0)</code>.</p>\n\n<p>You can install the required bundler version like this:</p>\n\n<p><code>gem install bundler --version=1.x.y</code></p>\n"}], "owner": {"reputation": 11, "user_id": 6778936, "user_type": "registered", "profile_image": "https://graph.facebook.com/671061673042329/picture?type=large", "display_name": "Muhammet Faik Alada", "link": "https://stackoverflow.com/users/6778936/muhammet-faik-alada"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 375, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1557233599, "creation_date": 1557233051, "last_edit_date": 1557233225, "question_id": 56022934, "link": "https://stackoverflow.com/questions/56022934/how-to-fix-bundle-version-incompatibility", "title": "How to fix bundle version incompatibility?", "body": "<p><a href=\"https://github.com/jhu-ep-coursera/fullstack-course3-module3-movies\" rel=\"nofollow noreferrer\">https://github.com/jhu-ep-coursera/fullstack-course3-module3-movies</a>\nI use this repo , I  run <code>rake db:seed</code> Project want sqlite update and I add <code>gem 'sqlite3', '~&gt; 1.3.13'</code> in <code>Gemfile</code> .\nProject gives an error</p>\n\n<pre><code>(base) \u279c  fullstack-course3-module3-movies git:(master) \u2717 bundle\nThe dependency tzinfo-data (&gt;= 0) will be unused by any of the platforms Bundler is installing for. Bundler is installing for ruby but the dependency is only for x86-mingw32, x86-mswin32, x64-mingw32, java. To add those platforms to the bundle, run `bundle lock --add-platform x86-mingw32 x86-mswin32 x64-mingw32 java`.\nFetching gem metadata from https://rubygems.org/...........\nFetching gem metadata from https://rubygems.org/.\nResolving dependencies...\nBundler could not find compatible versions for gem \"bundler\":\n In Gemfile:\n   rails (= 4.2.4) was resolved to 4.2.4, which depends on\n     bundler (&lt; 2.0, &gt;= 1.3.0)\n\n Current Bundler version:\n   bundler (2.0.1)\nThis Gemfile requires a different version of Bundler.\nPerhaps you need to update Bundler by running `gem install bundler`?\n\nCould not find gem 'bundler (&lt; 2.0, &gt;= 1.3.0)', which is required by gem 'rails (= 4.2.4)', in any of the sources.\n</code></pre>\n"}, {"tags": ["ruby", "jwt", "ruby-on-rails-5"], "answers": [{"comments": [{"owner": {"reputation": 2615, "user_id": 112313, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f568382a054dd260029ee0267f3d3700?s=128&d=identicon&r=PG&f=1", "display_name": "bcsantos", "link": "https://stackoverflow.com/users/112313/bcsantos"}, "edited": false, "score": 0, "creation_date": 1557233336, "post_id": 56022880, "comment_id": 98689671, "body": "Thanks for replying. I thought that would be the problem, <code>current user</code> is defined in ApplicationController and requires <code>AuthorizeApiRequest</code>. What I don&#39;t know is how to code around that while otherwise preserving the integrity of the authentication mechanism for the write actions. Any suggestions?"}, {"owner": {"reputation": 5312, "user_id": 6535997, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/10156345016155058/picture?type=large", "display_name": "Mark", "link": "https://stackoverflow.com/users/6535997/mark"}, "reply_to_user": {"reputation": 2615, "user_id": 112313, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f568382a054dd260029ee0267f3d3700?s=128&d=identicon&r=PG&f=1", "display_name": "bcsantos", "link": "https://stackoverflow.com/users/112313/bcsantos"}, "edited": false, "score": 0, "creation_date": 1557243913, "post_id": 56022880, "comment_id": 98696130, "body": "Maybe an application wide helper that returns the current_user?"}, {"owner": {"reputation": 2615, "user_id": 112313, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f568382a054dd260029ee0267f3d3700?s=128&d=identicon&r=PG&f=1", "display_name": "bcsantos", "link": "https://stackoverflow.com/users/112313/bcsantos"}, "edited": false, "score": 0, "creation_date": 1557247331, "post_id": 56022880, "comment_id": 98697797, "body": "That&#39;s already in place, the problem is that right now all calls to current_user at authenticated. One possible solution would be to conditionally authenticate the user depending on what http verbs are used, i.e. skip authentication for GET, and authenticate for everything else. The problem is solved for now, by loading all works inside the index method, and fetching by id inside the show method. Will leave question for now in case someone proposes a cleaner way of doing things, or I learn one myself. Thanks for the input."}], "tags": [], "owner": {"reputation": 5312, "user_id": 6535997, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/10156345016155058/picture?type=large", "display_name": "Mark", "link": "https://stackoverflow.com/users/6535997/mark"}, "is_accepted": false, "score": 1, "last_activity_date": 1557232891, "creation_date": 1557232891, "answer_id": 56022880, "question_id": 56022432, "link": "https://stackoverflow.com/questions/56022432/rails-5-api-custom-authentication-skip-before-action-on-get-routes/56022880#56022880", "title": "Rails 5 API custom authentication: &#39;skip_before_action&#39; on GET routes", "body": "<p>The error message states:</p>\n\n<pre><code>NoMethodError (undefined method `works' for nil:NilClass):\napp/controllers/works_controller.rb:10:in `index'\n</code></pre>\n\n<p>Or to translate that, on line 10 of the works_controller.rb file, we're calling a method called <code>works</code> on <code>nil</code>, which is throwing an error.</p>\n\n<p>Assuming line 10 of the works_controller is</p>\n\n<pre><code>@works = current_user.works\n</code></pre>\n\n<p>Then the error message is telling us that we're calling <code>works</code> on nil, i.e. we have no <code>current_user</code>.</p>\n\n<p>Either where you assign this code is not working properly, or you're accessing this part of the code without signing in and haven't coded around that. Either way, the <code>current_user</code> variable is returning nil and shouldn't be.</p>\n"}], "owner": {"reputation": 2615, "user_id": 112313, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f568382a054dd260029ee0267f3d3700?s=128&d=identicon&r=PG&f=1", "display_name": "bcsantos", "link": "https://stackoverflow.com/users/112313/bcsantos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 723, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1557232891, "creation_date": 1557231277, "last_edit_date": 1557232198, "question_id": 56022432, "link": "https://stackoverflow.com/questions/56022432/rails-5-api-custom-authentication-skip-before-action-on-get-routes", "title": "Rails 5 API custom authentication: &#39;skip_before_action&#39; on GET routes", "body": "<p>I've used <a href=\"https://scotch.io/tutorials/build-a-restful-json-api-with-rails-5-part-two\" rel=\"nofollow noreferrer\">this</a> series as a starting point for a Rails backend for a work portfolio website. Adapting it has been mostly straightforward, and it's doing what I want it to. The one big problem is that the 'index' and 'show' (read actions) should be available without authentication, while 'create', 'update', and 'delete' (write actions) should require a valid JWT.</p>\n\n<p>Following the approach used to exclude the signup and login routes from authentication, I've tried </p>\n\n<pre><code>skip_before_action :authorize_request, only: [:index, :show]\n</code></pre>\n\n<p>in the appropriate controller. This will however crash the application, with</p>\n\n<pre><code>NoMethodError (undefined method `works' for nil:NilClass):\napp/controllers/works_controller.rb:10:in `index'\n</code></pre>\n\n<p>While the problem seems apparent - if skipping the authentication action the class doesn't get instantiated - the fix isn't, to me at least. Could anyone please help?</p>\n\n<p>The code for the project is <a href=\"https://git.brnrds.com/brnrds/brnrds-server\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p><strong>Application controller</strong></p>\n\n<pre><code>class ApplicationController &lt; ActionController::API\n  include Response\n  include ExceptionHandler\n\n  # called before every action on controllers\n  before_action :authorize_request\n  attr_reader :current_user\n\n  private\n\n  # Check for valid request token and return user\n  def authorize_request\n    @current_user = (AuthorizeApiRequest.new(request.headers).call)[:user]\n  end\nend\n</code></pre>\n\n<p><strong>'Works' controller</strong></p>\n\n<pre><code>class WorksController &lt; ApplicationController\n\n  #skip_before_action :authorize_request, only: [:index, :show]\n\n  before_action :set_work, only: [:show, :update, :destroy]\n\n  # GET /works\n  def index\n    @works = current_user.works\n    json_response(@works)\n  end\n\n  # POST /works\n  def create\n    @work = current_user.works.create!(work_params)\n    json_response(@work, :created)\n  end\n\n  # GET /works/:id\n  def show\n    json_response(@work)\n  end\n\n  # PUT /works/:id\n  def update\n    @work.update(work_params)\n    head :no_content\n  end\n\n  # DELETE /works/:id\n  def destroy\n    @work.destroy\n    head :no_content\n  end\n\n  private\n\n  def work_params\n    # whitelist params\n    params.permit(:title, :nature, :role, :client, :timeframe, :description, :images, :url, :blog_post)\n  end\n\n  def set_work\n    @work = Work.find(params[:id])\n  end\nend\n</code></pre>\n\n<p><strong>'Users' controller</strong></p>\n\n<pre><code>class UsersController &lt; ApplicationController\n\n  skip_before_action :authorize_request, only: :create\n\n  def create\n    user = User.create!(user_params)\n    auth_token = AuthenticateUser.new(user.username, user.password).call\n    response = { message: Message.account_created, access_token: auth_token }\n    json_response(response, :created)\n  end\n\n  def show\n    json_response(username: current_user.username)\n  end\n\n  private\n\n  def user_params\n    params.permit(\n      :username,\n      :password,\n      :password_confirmation\n    )\n  end\nend\n</code></pre>\n\n<p><strong>'Authentication' controller</strong></p>\n\n<pre><code>class AuthenticationController &lt; ApplicationController\n\n  skip_before_action :authorize_request, only: :authenticate\n\n  # return auth token once user is authenticated\n  def authenticate\n    auth_token =\n      AuthenticateUser.new(auth_params[:username], auth_params[:password]).call\n    json_response(access_token: auth_token)\n  end\n\n  private\n\n  def auth_params\n    params.permit(:username, :password)\n  end\nend\n</code></pre>\n\n<p><strong>'AuthenticateUser' helper</strong></p>\n\n<pre><code>class AuthenticateUser\n  def initialize(username, password)\n    @username = username\n    @password = password\n  end\n\n  # Service entry point\n  def call\n    JsonWebToken.encode(user_id: user.id) if user\n  end\n\n  private\n\n  attr_reader :username, :password\n\n  # verify user credentials\n  def user\n    user = User.find_by(username: username)\n    return user if user &amp;&amp; user.authenticate(password)\n    # raise Authentication error if credentials are invalid\n    raise(ExceptionHandler::AuthenticationError, Message.invalid_credentials)\n  end\nend\n</code></pre>\n\n<p><strong>'AuthorizeApiRequest' helper</strong></p>\n\n<pre><code>class AuthorizeApiRequest\n  def initialize(headers = {})\n    @headers = headers\n  end\n\n  # Service entry point - return valid user object\n  def call\n    {\n      user: user\n    }\n  end\n\n  private\n\n  attr_reader :headers\n\n  def user\n    # check if user is in the database\n    # memoize user object\n    @user ||= User.find(decoded_auth_token[:user_id]) if decoded_auth_token\n    # handle user not found\n  rescue ActiveRecord::RecordNotFound =&gt; e\n    # raise custom error\n    raise(\n      ExceptionHandler::InvalidToken,\n      (\"#{Message.invalid_token} #{e.message}\")\n    )\n  end\n\n  # decode authentication token\n  def decoded_auth_token\n    @decoded_auth_token ||= JsonWebToken.decode(http_auth_header)\n  end\n\n  # check for token in `Authorization` header\n  def http_auth_header\n    if headers['Authorization'].present?\n      return headers['Authorization'].split(' ').last\n    end\n      raise(ExceptionHandler::MissingToken, Message.missing_token)\n  end\nend\n</code></pre>\n\n<p><strong>'ExceptionHandler' helper</strong></p>\n\n<pre><code>module ExceptionHandler\n  extend ActiveSupport::Concern\n\n  # Define custom error subclasses - rescue catches `StandardErrors`\n  class AuthenticationError &lt; StandardError; end\n  class MissingToken &lt; StandardError; end\n  class InvalidToken &lt; StandardError; end\n\n  included do\n    # Define custom handlers\n    rescue_from ActiveRecord::RecordInvalid, with: :four_twenty_two\n    rescue_from ExceptionHandler::AuthenticationError, with: :unauthorized_request\n    rescue_from ExceptionHandler::MissingToken, with: :four_twenty_two\n    rescue_from ExceptionHandler::InvalidToken, with: :four_twenty_two\n\n    rescue_from ActiveRecord::RecordNotFound do |e|\n      json_response({ message: e.message }, :not_found)\n    end\n  end\n\n  private\n\n  # JSON response with message; Status code 422 - unprocessable entity\n  def four_twenty_two(e)\n    json_response({ message: e.message }, :unprocessable_entity)\n  end\n\n  # JSON response with message; Status code 401 - Unauthorized\n  def unauthorized_request(e)\n    json_response({ message: e.message }, :unauthorized)\n  end\nend\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "forms", "simple-form"], "comments": [{"owner": {"reputation": 6039, "user_id": 2137458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cfca832ee746f3e3d9971148f52dc64?s=128&d=identicon&r=PG", "display_name": "NM Pennypacker", "link": "https://stackoverflow.com/users/2137458/nm-pennypacker"}, "edited": false, "score": 0, "creation_date": 1557232667, "post_id": 56022335, "comment_id": 98689279, "body": "Are you declaring a <code>root</code> route in <code>config&#47;routes.rb</code>&gt; If so, did you make sure to put it at the bottom of the list? The order matters."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557247721, "post_id": 56022335, "comment_id": 98697959, "body": "<code>@parent = @snag</code> no idea what that is but I have a feeling that <code>skip_authorization_check</code> is not working appropriately since I see a &quot;residents&quot; query then redirection it appears that the <code>:redirect_residents</code> part of your authorization/authentication chain is the one redirecting. Maybe post that code as well since it appears very pertinent to the issue"}, {"owner": {"reputation": 75558, "user_id": 544825, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/UFdOO.png?s=128&g=1", "display_name": "max", "link": "https://stackoverflow.com/users/544825/max"}, "edited": false, "score": 0, "creation_date": 1557330968, "post_id": 56022335, "comment_id": 98731234, "body": "You should use the association on your parent model and the id param from the URL. Do: <code>@parent.comments.new(...)</code> and <code>@snag_comments = @snag.comments</code>. Don&#39;t do <code>SnagComment.new(..., parent_id: 1)</code> or <code>SnagComment.where(snag_id: @snag.id)</code>. This is unrelated to your redirect problem."}], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 10749227, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4cfd24ed84691ff5357a5dc5a38626ef?s=128&d=identicon&r=PG&f=1", "display_name": "DevCF", "link": "https://stackoverflow.com/users/10749227/devcf"}, "edited": false, "score": 0, "creation_date": 1557388073, "post_id": 56044952, "comment_id": 98749842, "body": "Thank you :) . It turns out it was a routing / controller problem. I have the homeowner/admin sides and was trying to create a comment controller that they could both use, but it was redirecting as the homeowner didn&#39;t have the correct permissions. I had to nest the comment controllers separately, one under homeowner and one under admin - I&#39;ve taking over a job that&#39;s been several years in the making so figuring out how to all works stumps me sometimes. A few hours staring at this issue turned out to be a ten minute fix."}], "tags": [], "owner": {"reputation": 75558, "user_id": 544825, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/UFdOO.png?s=128&g=1", "display_name": "max", "link": "https://stackoverflow.com/users/544825/max"}, "is_accepted": false, "score": 0, "last_activity_date": 1557332006, "creation_date": 1557332006, "answer_id": 56044952, "question_id": 56022335, "link": "https://stackoverflow.com/questions/56022335/form-data-not-saving-to-database-on-form-loaded-from-different-controller-view/56044952#56044952", "title": "Form data not saving to database on form loaded from different controller / view", "body": "<p>You seem to have missed the most basic fundamental on how to setup a nested resource - nesting the route:</p>\n\n<pre><code>resources :snags do\n  resources :snag_comments\nend\n</code></pre>\n\n<p>This will make the \"parent-child\" relation part of the RESTful route and make it very clear what is going on VS implicitly passing that information in the form body.</p>\n\n<pre><code>class SnagCommentsController &lt; ApplicationController\n  # ...\n  before_action :set_snag\n\n  # POST /snags/:snag_id/snag_comments\n  def create\n    @snag_comment = @snag.comments.new(snag_comment_params)\n    if @snag_comment.save\n      redirect_to @snag, notice: 'Comment created'\n    else\n      render :new\n    end\n  end\n\n  private\n\n  def set_snag\n    @snag = Snag.find(params[:snag_id])\n  end\n\n  def snag_comment_params\n    params.require(:snag_comment)\n          .permit(:content, :image,:commenter, :first_name, :last_name)\n  end\nend\n</code></pre>\n\n<p>To create a form that posts to the nested route use an array:</p>\n\n<pre><code>def show\n  @snag_attachments = @snag.snag_attachments\n  @snag_comment = @snag.comments.new\n  @snag_comments = @snag.comments\nend\n</code></pre>\n\n<hr>\n\n<pre><code>&lt;%= simple_form_for([@snag, @snag_comment]) do |f| %&gt;\n  # ...\n&lt;% end %&gt;\n</code></pre>\n\n<p>Make sure you remove the input for the parent ID. It is explicitly passed as segment in the URL.</p>\n"}], "owner": {"reputation": 57, "user_id": 10749227, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4cfd24ed84691ff5357a5dc5a38626ef?s=128&d=identicon&r=PG&f=1", "display_name": "DevCF", "link": "https://stackoverflow.com/users/10749227/devcf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 33, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1557332006, "creation_date": 1557230975, "question_id": 56022335, "link": "https://stackoverflow.com/questions/56022335/form-data-not-saving-to-database-on-form-loaded-from-different-controller-view", "title": "Form data not saving to database on form loaded from different controller / view", "body": "<p>Sorry for the vague title. </p>\n\n<p>I want to enable comments on a post / comments type system (in my case snags and snag comments). </p>\n\n<p>I have a snags table, a snag_comments table and a has many / belongs to relationship between snag and snag comments.</p>\n\n<p>On the show page for each snag I have a form rendering for snag comments. When I submit the form, it redirects to the root url and doesn't save anything to the snag_comments table. </p>\n\n<p>This is all the information I get:\n    <pre>Started POST &quot;/snag_comments&quot; for ::1 at 2019-05-07 12:53:16 +0100\nProcessing by SnagCommentsController#create as HTML\n  Parameters: {&quot;utf8&quot;=&gt;&quot;\u2713&quot;, &quot;authenticity_token&quot;=&gt;&quot;yBefFfnI289UXqQYzF37DBRGQSk2Uqu41/OQO/mnET9aj2S3OqjLmSGtgyyZkTDz0aSdKzSPofQNeSzx/UH3ng==&quot;, &quot;snag_comment&quot;=&gt;{&quot;snag_id&quot;=&gt;&quot;183&quot;, &quot;content&quot;=&gt;&quot;sdfgfsdgsdfgds&quot;}, &quot;commit&quot;=&gt;&quot;Send&quot;}\n  <b>Resident Load (0.3ms)</b>  <b>SELECT  &quot;residents&quot;.* FROM &quot;residents&quot; WHERE &quot;residents&quot;.&quot;id&quot; = $1 ORDER BY &quot;residents&quot;.&quot;id&quot; ASC LIMIT $2</b>  [[&quot;id&quot;, 2], [&quot;LIMIT&quot;, 1]]\nRedirected to <a href=\"http://localhost:3000/\" rel=\"nofollow noreferrer\">http://localhost:3000/</a>\nFilter chain halted as :redirect_residents rendered or redirected\n</pre></p>\n\n<p>So my params are going through. I don't know why it's not saving to the database.</p>\n\n<p>In my snags controller I have: </p>\n\n<pre><code>def show\n  @snag_attachments = @snag.snag_attachments.all\n  @snag_comment = SnagComment.new\n  @snag_comments = SnagComment.where(snag_id: @snag.id)\nend\n</code></pre>\n\n<p>And my snag comments controller (which is currently incomplete while I figure out this broken part):</p>\n\n<pre><code>class SnagCommentsController &lt; ApplicationController\n  skip_authorization_check\n  before_action :set_parent\n\n  def create\n    @snag_comment = SnagComment.new(snag_comment_params)\n    if @snag_comment.save\n      redirect_to snags_path\n    end\n  end\n\n  private\n\n  def set_parent\n    @parent = @snag\n  end\n\n  def snag_comment_params\n    params.require(:snag_comment).permit(:content, :image, :snag_id,\n                                         :commenter, :first_name, :last_name)\n  end\nend\n</code></pre>\n\n<p>The form which is rendered (views/snag_comments/_form):</p>\n\n<pre><code>&lt;div class=\"snag-comment-form\"&gt;\n  &lt;%= simple_form_for snag_comment, url: snag_comments_path do |f| %&gt;\n    &lt;% if snag_comment.errors.any? %&gt;\n      &lt;div class=\"submission-errors\"&gt;\n        &lt;ul&gt;\n          &lt;% snag_comment.errors.full_messages.each do |error_msg| %&gt;\n            &lt;li&gt;\n              &lt;%= fa_icon \"exclamation-circle\" %&gt;\n              &lt;%= error_msg %&gt;\n            &lt;/li&gt;\n          &lt;% end %&gt;\n        &lt;/ul&gt;\n      &lt;/div&gt;\n    &lt;% end %&gt;\n\n    &lt;%= f.hidden_field :snag_id, value: @snag.id %&gt;\n    &lt;%= f.input :content, label: false, as: :text, placeholder: t(\".content\"), maxlength: 1000, required: true, class: \"snag-comment-content\" %&gt;\n\n    &lt;div class=\"snag-comment-submit\"&gt;\n      &lt;%= f.submit t(\".send\"), class: \"btn branded-btn send\" %&gt;\n    &lt;/div&gt;\n  &lt;% end %&gt;\n&lt;/div&gt;\n</code></pre>\n\n<p>And where the form is called from (views/homeowners/snags/show):</p>\n\n<pre><code>&lt;%= render 'snag_comments/form', snag_comment: @snag_comment %&gt;\n</code></pre>\n\n<p>I need the snag comments to be outside of the homeowner module because it also needs to be accessible to the admin module (admin and homeowner can comment on the same snags). </p>\n\n<p>I can't figure out why the form is redirecting and not saving. I have tried removing any redirect and just specifying that the form should be saved but it still redirects to root url and doesn't save, so something must be going wrote between passing the params and actually saving.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "yaml", "rake", "exchange-server"], "comments": [{"owner": {"reputation": 19261, "user_id": 4758119, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/F4dJY.jpg?s=128&g=1", "display_name": "Deepak Mahakale", "link": "https://stackoverflow.com/users/4758119/deepak-mahakale"}, "edited": false, "score": 1, "creation_date": 1557225072, "post_id": 56020189, "comment_id": 98684991, "body": "The file is not valid. You have incorrect indentation for <code>frontend</code> block"}, {"owner": {"reputation": 11, "user_id": 8884293, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-gxnHI1gqymA/AAAAAAAAAAI/AAAAAAAAA-E/RMbPIa5aozY/photo.jpg?sz=128", "display_name": "RAJEEV RANJAN SINGH", "link": "https://stackoverflow.com/users/8884293/rajeev-ranjan-singh"}, "reply_to_user": {"reputation": 19261, "user_id": 4758119, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/F4dJY.jpg?s=128&g=1", "display_name": "Deepak Mahakale", "link": "https://stackoverflow.com/users/4758119/deepak-mahakale"}, "edited": false, "score": 0, "creation_date": 1557229487, "post_id": 56020189, "comment_id": 98687396, "body": "Now i make it in valid format but still find same error @DeepakMahakale"}], "answers": [{"comments": [{"owner": {"reputation": 50175, "user_id": 1307905, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a38a4f5f180194ac457cdc057f1be6e3?s=128&d=identicon&r=PG", "display_name": "Anthon", "link": "https://stackoverflow.com/users/1307905/anthon"}, "edited": false, "score": 0, "creation_date": 1557226306, "post_id": 56020644, "comment_id": 98685637, "body": "yamllint.com will tell you that it is invalid, but and that something went wrong while parsing the mapping on line 1, which is essentially useless <i>and the reason why although the OP used this site the error could not be located</i>. Way more useful is using <a href=\"http://yaml-online-parser.appspot.com/\" rel=\"nofollow noreferrer\">yaml-online-parser.appspot.com</a> as it will point to line 11 with a cursor under <code>tower</code>."}, {"owner": {"reputation": 11, "user_id": 8884293, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-gxnHI1gqymA/AAAAAAAAAAI/AAAAAAAAA-E/RMbPIa5aozY/photo.jpg?sz=128", "display_name": "RAJEEV RANJAN SINGH", "link": "https://stackoverflow.com/users/8884293/rajeev-ranjan-singh"}, "edited": false, "score": 0, "creation_date": 1557229292, "post_id": 56020644, "comment_id": 98687296, "body": "I make the format valid now but still find same error @Deepak"}], "tags": [], "owner": {"reputation": 19261, "user_id": 4758119, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/F4dJY.jpg?s=128&g=1", "display_name": "Deepak Mahakale", "link": "https://stackoverflow.com/users/4758119/deepak-mahakale"}, "is_accepted": false, "score": 1, "last_activity_date": 1557225191, "creation_date": 1557225191, "answer_id": 56020644, "question_id": 56020189, "link": "https://stackoverflow.com/questions/56020189/yaml-parser-parsererror-expected-document-start-but-found-block-mapping/56020644#56020644", "title": "yaml.parser.ParserError: expected &#39;&lt;document start&gt;&#39;, but found &#39;&lt;block mapping start&gt;&#39;", "body": "<p>The content in your file is not valid. The reason is you have indented the <code>frontent</code> block by 2 more spaces.</p>\n\n<p>You can always check if the yaml is valid or not here - <a href=\"http://www.yamllint.com/\" rel=\"nofollow noreferrer\">http://www.yamllint.com/</a></p>\n\n<pre><code>services:\n  frontend:\n    image: \"rubykube/mikroapp:0.1.5\"\n    volumes: \n      - ../config/frontend/env.js:/usr/share/nginx/html/public/env.js\n  labels:\n    traefik.enable: true\n    traefik.frontend.rule: \"PathPrefix:/;Host:www.dexfinpro.com\"\n    traefik.port: 3000\n\n  tower:\n    image: \"rubykube/tower:0.1.8\"\n    volumes:\n      - ../config/frontend/tower.js:/home/app/env.js\n    labels:\n      traefik.enable: true\n      traefik.frontend.rule: \"PathPrefix:/tower;Host:www.dexfinpro.com\"\n      traefik.port: 8080\n</code></pre>\n\n<p><strong>Note:</strong> I am not sure  if you wan't the block with <code>tower</code> key at top level or inside <code>services</code> so make change accordingly</p>\n"}], "owner": {"reputation": 11, "user_id": 8884293, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-gxnHI1gqymA/AAAAAAAAAAI/AAAAAAAAA-E/RMbPIa5aozY/photo.jpg?sz=128", "display_name": "RAJEEV RANJAN SINGH", "link": "https://stackoverflow.com/users/8884293/rajeev-ranjan-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4540, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1581352360, "creation_date": 1557223569, "last_edit_date": 1557291880, "question_id": 56020189, "link": "https://stackoverflow.com/questions/56020189/yaml-parser-parsererror-expected-document-start-but-found-block-mapping", "title": "yaml.parser.ParserError: expected &#39;&lt;document start&gt;&#39;, but found &#39;&lt;block mapping start&gt;&#39;", "body": "<p>I am using the command <code>rake service:all</code> for the UI installation. But I find this error and struck for hours.</p>\n\n<p>I have already checked the yaml format from yamllint.com but I could not able to find my error.</p>\n\n<p>frontend.yaml:</p>\n\n<pre><code>../config/frontend/env.js:/usr/share/nginx/html/public/env.jsversion: \"3.6\"\n\nservices:\n    frontend:\n      image: \"rubykube/mikroapp:0.1.5\"\n      volumes: \n        - ../config/frontend/env.js:/usr/share/nginx/html/public/env.js\n    labels:\n      traefik.enable: true\n      traefik.frontend.rule: \"PathPrefix:/;Host:www.dexfinpro.com\"\n      traefik.port: 3000\n\n  tower:\n    image: \"rubykube/tower:0.1.8\"\n    volumes:\n      - ../config/frontend/tower.js:/home/app/env.js\n    labels:\n      traefik.enable: true\n      traefik.frontend.rule: \"PathPrefix:/tower;Host:www.dexfinpro.com\"\n      traefik.port: 8080\n</code></pre>\n\n<p>ERROR:</p>\n\n<blockquote>\n  <p>yaml.parser.ParserError: expected '&lt;document start>', but found '&lt;block mapping start>'\n    in \"./compose/frontend.yaml\", line 3, column 1\n  rake aborted!\n  Command failed with status (1): [docker-compose up -d proxy...]</p>\n</blockquote>\n\n<p>I found this error.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "api", "webhooks", "rails-api"], "comments": [{"owner": {"reputation": 181, "user_id": 9853412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a80bcc603c21ab8e1474266124b58a51?s=128&d=identicon&r=PG&f=1", "display_name": "neversleep", "link": "https://stackoverflow.com/users/9853412/neversleep"}, "edited": false, "score": 1, "creation_date": 1557222745, "post_id": 56019681, "comment_id": 98683662, "body": "Why did you bind two hooks to single method? I&#39;d use separate methods in controller for each hook. Probably when you receive POST request it sends you JSON, but GET requests asks you for something and it sends empty body you&#39;re trying to parse."}, {"owner": {"reputation": 119, "user_id": 8319323, "user_type": "registered", "profile_image": "https://graph.facebook.com/1344036448998167/picture?type=large", "display_name": "Anatolii Stupin", "link": "https://stackoverflow.com/users/8319323/anatolii-stupin"}, "reply_to_user": {"reputation": 181, "user_id": 9853412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a80bcc603c21ab8e1474266124b58a51?s=128&d=identicon&r=PG&f=1", "display_name": "neversleep", "link": "https://stackoverflow.com/users/9853412/neversleep"}, "edited": false, "score": 0, "creation_date": 1557223829, "post_id": 56019681, "comment_id": 98684275, "body": "Question was about only GET requests. Now I have edited my code (also edit question). When I have GET request to webhooks#complete, I see this error: <code>Started HEAD &quot;&#47;webhooks&quot; for 107.23.149.70 at 2019-05-07 13:05:03 +0300 E, [2019-05-07T13:05:13.885650 #15661] ERROR -- : [400 POST https:&#47;&#47;api.trello.com&#47;1&#47;webhooks]: {&quot;message&quot;:&quot;URL (https:&#47;&#47;*******.ngrok.io&#47;webhooks) not reachable. Error: ESOCKETTIMEDOUT&quot;,&quot;error&quot;:&quot;ERROR&quot;}</code>"}, {"owner": {"reputation": 181, "user_id": 9853412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a80bcc603c21ab8e1474266124b58a51?s=128&d=identicon&r=PG&f=1", "display_name": "neversleep", "link": "https://stackoverflow.com/users/9853412/neversleep"}, "edited": false, "score": 0, "creation_date": 1557224466, "post_id": 56019681, "comment_id": 98684636, "body": "It looks like Trello cannot connect to the endpoint you have specified <code>https:&#47;&#47;*******.ngrok.io&#47;webhooks</code>."}, {"owner": {"reputation": 119, "user_id": 8319323, "user_type": "registered", "profile_image": "https://graph.facebook.com/1344036448998167/picture?type=large", "display_name": "Anatolii Stupin", "link": "https://stackoverflow.com/users/8319323/anatolii-stupin"}, "reply_to_user": {"reputation": 181, "user_id": 9853412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a80bcc603c21ab8e1474266124b58a51?s=128&d=identicon&r=PG&f=1", "display_name": "neversleep", "link": "https://stackoverflow.com/users/9853412/neversleep"}, "edited": false, "score": 0, "creation_date": 1557227613, "post_id": 56019681, "comment_id": 98686372, "body": "@neversleep I am not so stupid. I intentionally hid a really used ip for question, not for app)"}, {"owner": {"reputation": 181, "user_id": 9853412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a80bcc603c21ab8e1474266124b58a51?s=128&d=identicon&r=PG&f=1", "display_name": "neversleep", "link": "https://stackoverflow.com/users/9853412/neversleep"}, "edited": false, "score": 0, "creation_date": 1557232284, "post_id": 56019681, "comment_id": 98689061, "body": "I&#39;m talking about the error <b>URL (...) not reachable</b>, <b>ESOCKETTIMEDOUT</b>. Whatever endpoint you&#39;ve specified Trello cannot connect to it."}], "answers": [{"tags": [], "owner": {"reputation": 910, "user_id": 5351624, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Nqncn.jpg?s=128&g=1", "display_name": "Matheus", "link": "https://stackoverflow.com/users/5351624/matheus"}, "is_accepted": true, "score": 1, "last_activity_date": 1557230816, "last_edit_date": 1557230816, "creation_date": 1557230404, "answer_id": 56022146, "question_id": 56019681, "link": "https://stackoverflow.com/questions/56019681/how-to-handle-trello-webhooks-ror-api/56022146#56022146", "title": "How to handle Trello webhooks? RoR API", "body": "<p>You can log what is coming from webhook request's JSON using <code>logger.info</code>.</p>\n\n<p>For example:</p>\n\n<pre><code>def receive\n  logger.info \"Trello webhook request's JSON: #{params}\"\n  # rest of your code...\nend\n</code></pre>\n\n<p>Then you have to check your logs. Probably it will be in <code>log/production.log</code>.</p>\n\n<p>If you are able to make Trello hit your local server, you can debug your action to see what is in the webhook request's JSON putting a <code>debugger</code> statement in the action.</p>\n\n<p>For example:</p>\n\n<pre><code>def receive\n  debugger\n  JSON.parse(request.body.read)\n  render :json =&gt; @@data\nend\n</code></pre>\n\n<p>Also, <code>request.body.read</code> is not the best way to get your params. You can just call <code>params</code> and it will return a <code>Hash</code> with your params. Actually, <code>request.body.read</code> does not return an object in a valid format to be parsed to JSON, I think that is the cause of the exception.</p>\n"}], "owner": {"reputation": 119, "user_id": 8319323, "user_type": "registered", "profile_image": "https://graph.facebook.com/1344036448998167/picture?type=large", "display_name": "Anatolii Stupin", "link": "https://stackoverflow.com/users/8319323/anatolii-stupin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 275, "favorite_count": 0, "accepted_answer_id": 56022146, "answer_count": 1, "score": 0, "last_activity_date": 1557230816, "creation_date": 1557221797, "last_edit_date": 1557223603, "question_id": 56019681, "link": "https://stackoverflow.com/questions/56019681/how-to-handle-trello-webhooks-ror-api", "title": "How to handle Trello webhooks? RoR API", "body": "<p>I am new at backend developing (RoR). Sorry for my English. </p>\n\n<p>Now I am working with Trello API and trying to receive (handle) webhooks.\nI'm using ruby-trello gem. Also I'm using ngrok.</p>\n\n<p>I successfully created webhooks (in Trello).\nNow when I edit Trello object (marked by webhook), I have the request from Trello to my app to WebhooksController#receive.</p>\n\n<p>routes.rb:</p>\n\n<pre><code>  post '/webhooks' =&gt; 'webhooks#receive', :defaults =&gt; { :format =&gt; 'json' }\n  get '/webhooks' =&gt; 'webhooks#complete', :defaults =&gt; { :format =&gt; 'json' }\n</code></pre>\n\n<p>webhooks_controller.rb</p>\n\n<pre><code>class WebhooksController &lt; ApplicationController\n\n  skip_before_action :verify_authenticity_token\n\n  @@data = File.read('public/data.json')\n\n  def complete\n    render status: 200\n  end\n\n  def receive\n    JSON.parse(request.body.read)\n    render :json =&gt; @@data\n  end\n\nend\n</code></pre>\n\n<p>But all the time I see <code>JSON::ParserError (765: unexpected token at ''):</code></p>\n\n<p>Now <strong>I just want to see webhooks request's json</strong> for understanding and code next steps.</p>\n\n<p>Can anyone help please?\nThank you in advance. :)</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1557218556, "post_id": 56016940, "comment_id": 98681242, "body": "Are you only interested in integer ranges?"}, {"owner": {"reputation": 61, "user_id": 10936499, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-rV_dop1Rdxg/AAAAAAAAAAI/AAAAAAAAAAc/zq1ClW9FGu4/photo.jpg?sz=128", "display_name": "Vimal Choudhary", "link": "https://stackoverflow.com/users/10936499/vimal-choudhary"}, "reply_to_user": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1557298620, "post_id": 56016940, "comment_id": 98712789, "body": "Yes @Stefan I only wanted it for integer range."}], "answers": [{"comments": [{"owner": {"reputation": 61, "user_id": 10936499, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-rV_dop1Rdxg/AAAAAAAAAAI/AAAAAAAAAAc/zq1ClW9FGu4/photo.jpg?sz=128", "display_name": "Vimal Choudhary", "link": "https://stackoverflow.com/users/10936499/vimal-choudhary"}, "edited": false, "score": 0, "creation_date": 1557212209, "post_id": 56017058, "comment_id": 98677951, "body": "I don&#39;t need reverse array, I just want to Identify or catch that reverse range is given."}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1557212218, "post_id": 56017058, "comment_id": 98677956, "body": "He is asking how to identify whether range is given in an order or descending order."}, {"owner": {"reputation": 181, "user_id": 9853412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a80bcc603c21ab8e1474266124b58a51?s=128&d=identicon&r=PG&f=1", "display_name": "neversleep", "link": "https://stackoverflow.com/users/9853412/neversleep"}, "edited": false, "score": 0, "creation_date": 1557212636, "post_id": 56017058, "comment_id": 98678184, "body": "Oh, ok, looks like I misunderstood you, I&#39;ve updated my answer."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1557247762, "post_id": 56017058, "comment_id": 98697979, "body": "...or <code>r.begin &gt; r.end</code>. Consider remove prompts (e.g., &quot;2.6.3 :023 &gt; &quot;) for a cleaner look. At first glance, <code>&gt; r.first &gt; r.last</code> looks a bit odd."}], "tags": [], "owner": {"reputation": 181, "user_id": 9853412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a80bcc603c21ab8e1474266124b58a51?s=128&d=identicon&r=PG&f=1", "display_name": "neversleep", "link": "https://stackoverflow.com/users/9853412/neversleep"}, "is_accepted": false, "score": 4, "last_activity_date": 1557250659, "last_edit_date": 1557250659, "creation_date": 1557211932, "answer_id": 56017058, "question_id": 56016940, "link": "https://stackoverflow.com/questions/56016940/identifying-ascending-and-descending-order-or-range/56017058#56017058", "title": "Identifying ascending and descending order or Range", "body": "<p>Range has <a href=\"https://ruby-doc.org/core-2.2.0/Range.html#method-i-first\" rel=\"nofollow noreferrer\">Range#first</a> and <a href=\"https://ruby-doc.org/core-2.2.0/Range.html#method-i-last\" rel=\"nofollow noreferrer\">Range#last</a> methods.</p>\n\n<pre><code>r = (5..1)\nr.first &gt; r.last # =&gt; true\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557254468, "post_id": 56017877, "comment_id": 98700905, "body": "OR <code>Enumerable#none?</code> if I had my druthers"}, {"owner": {"reputation": 91121, "user_id": 179125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5594142dcc49a24b1902ec8059181f8d?s=128&d=identicon&r=PG&f=1", "display_name": "Jordan Running", "link": "https://stackoverflow.com/users/179125/jordan-running"}, "edited": false, "score": 0, "creation_date": 1557292294, "post_id": 56017877, "comment_id": 98710553, "body": "This will give a false positive for an exclusive range with the same <code>begin</code> and <code>end</code>: <code>(1...1).size # =&gt; 0</code>"}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "reply_to_user": {"reputation": 91121, "user_id": 179125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5594142dcc49a24b1902ec8059181f8d?s=128&d=identicon&r=PG&f=1", "display_name": "Jordan Running", "link": "https://stackoverflow.com/users/179125/jordan-running"}, "edited": false, "score": 1, "creation_date": 1557292390, "post_id": 56017877, "comment_id": 98710578, "body": "@JordanRunning depends on what do we call \u201cfalse positive.\u201d Is <code>1...1</code> actually not reversed?"}, {"owner": {"reputation": 91121, "user_id": 179125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5594142dcc49a24b1902ec8059181f8d?s=128&d=identicon&r=PG&f=1", "display_name": "Jordan Running", "link": "https://stackoverflow.com/users/179125/jordan-running"}, "edited": false, "score": 0, "creation_date": 1557341725, "post_id": 56017877, "comment_id": 98736284, "body": "Yes, <code>1...1</code> is actually not reversed."}], "tags": [], "owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "is_accepted": false, "score": 4, "last_activity_date": 1557215335, "creation_date": 1557215335, "answer_id": 56017877, "question_id": 56016940, "link": "https://stackoverflow.com/questions/56016940/identifying-ascending-and-descending-order-or-range/56017877#56017877", "title": "Identifying ascending and descending order or Range", "body": "<p>Use <a href=\"https://ruby-doc.org/Range.html#method-i-size\" rel=\"nofollow noreferrer\"><code>Range#size</code></a>:</p>\n\n<pre><code>(5..1).size.zero?\n#\u21d2 true\n\n(1..5).size.zero?\n#\u21d2 false\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "is_accepted": false, "score": 0, "last_activity_date": 1557220127, "last_edit_date": 1557220127, "creation_date": 1557219673, "answer_id": 56019034, "question_id": 56016940, "link": "https://stackoverflow.com/questions/56016940/identifying-ascending-and-descending-order-or-range/56019034#56019034", "title": "Identifying ascending and descending order or Range", "body": "<p>If you want just to check for a reverse range:</p>\n\n<pre><code>(5..1).to_a.empty? #=&gt; true\n(1..5).to_a.empty? #=&gt; false\n</code></pre>\n\n<p><hr>\nIf you want to have an array as output, you could do</p>\n\n<pre><code>r.to_a.then { |ary| ary.empty? ? (r.end..r.begin).to_a.reverse : ary }\n</code></pre>\n\n<p>The output for the two cases are:</p>\n\n<pre><code>r = (5..1) #=&gt; [5, 4, 3, 2, 1]\nr = (1..5) #=&gt; [1, 2, 3, 4, 5]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 145, "user_id": 8229753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22660980995e03dfd59812c9acf93db8?s=128&d=identicon&r=PG&f=1", "display_name": "Ketan Mangukiya", "link": "https://stackoverflow.com/users/8229753/ketan-mangukiya"}, "is_accepted": false, "score": 0, "last_activity_date": 1557314241, "creation_date": 1557314241, "answer_id": 56039529, "question_id": 56016940, "link": "https://stackoverflow.com/questions/56016940/identifying-ascending-and-descending-order-or-range/56039529#56039529", "title": "Identifying ascending and descending order or Range", "body": "<pre><code>(1..5).to_a.present? ? \"Ascending\" : \"Descending\"\n</code></pre>\n\n<p>if value present in array means it <strong>Ascending</strong> or <strong>Descending</strong> cause if you give <strong>(5..1)</strong> range it create blank Array.</p>\n"}], "owner": {"reputation": 61, "user_id": 10936499, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-rV_dop1Rdxg/AAAAAAAAAAI/AAAAAAAAAAc/zq1ClW9FGu4/photo.jpg?sz=128", "display_name": "Vimal Choudhary", "link": "https://stackoverflow.com/users/10936499/vimal-choudhary"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "answer_count": 4, "score": 0, "last_activity_date": 1557314241, "creation_date": 1557211509, "last_edit_date": 1557226457, "question_id": 56016940, "link": "https://stackoverflow.com/questions/56016940/identifying-ascending-and-descending-order-or-range", "title": "Identifying ascending and descending order or Range", "body": "<p>I want to know how we can identify that descending order <code>Range</code> is given.</p>\n\n<p>I have a test case where range is given in <code>(1..-1)</code> and <code>to_a</code> method gives empty array for same.</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>(1..5).to_a\n=&gt; [1, 2, 3, 4, 5]\n(5..1).to_a\n=&gt; []\n</code></pre>\n\n<p>Help me write a condition which can confirm descending order <code>Range</code> is given.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "oauth-2.0", "doorkeeper"], "answers": [{"tags": [], "owner": {"reputation": 450, "user_id": 312864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15faec27916ef9e0caae26eaaf25a8fb?s=128&d=identicon&r=PG", "display_name": "fotos", "link": "https://stackoverflow.com/users/312864/fotos"}, "is_accepted": true, "score": 2, "last_activity_date": 1579046342, "creation_date": 1579046342, "answer_id": 59743469, "question_id": 56015242, "link": "https://stackoverflow.com/questions/56015242/what-technology-or-algorithm-doorkeeper-use-to-generate-its-refresh-tokens-and/59743469#59743469", "title": "What technology or algorithm Doorkeeper use to generate it&#39;s refresh tokens and access tokens and why is it secured", "body": "<p>Here is an explanation of the main parts, along with pointers to code, for Doorkeeper version <code>v5.2.3</code>.</p>\n\n<p>By default, Doorkeeper provides a way to <a href=\"https://github.com/doorkeeper-gem/doorkeeper/blob/v5.2.3/lib/doorkeeper/config.rb#L316-L323\" rel=\"nofollow noreferrer\">specify the <code>TokenGenerator</code></a>.</p>\n\n<p>If the <code>TokenGenerator</code> is not specified the <a href=\"https://github.com/doorkeeper-gem/doorkeeper/blob/v5.2.3/lib/doorkeeper/oauth/helpers/unique_token.rb#L6\" rel=\"nofollow noreferrer\">default one is <code>Doorkeeper::OAuth::Helpers::UniqueToken</code></a>.</p>\n\n<p>The <code>UniqueToken</code> generator  is using <a href=\"https://ruby-doc.org/stdlib-2.7.0/libdoc/securerandom/rdoc/SecureRandom.html\" rel=\"nofollow noreferrer\"><code>SecureRandom</code></a> (provided by the Ruby standard library) to <a href=\"https://github.com/doorkeeper-gem/doorkeeper/blob/v5.2.3/lib/doorkeeper/oauth/helpers/unique_token.rb#L16\" rel=\"nofollow noreferrer\">generate</a> a token using the <a href=\"https://github.com/doorkeeper-gem/doorkeeper/blob/v5.2.3/lib/doorkeeper/config.rb#L325-L331\" rel=\"nofollow noreferrer\"><code>.urlsafe_base64</code></a> method as specified in <a href=\"https://tools.ietf.org/html/rfc6750#section-2.1\" rel=\"nofollow noreferrer\">RFC6750</a>. Practically, you can consider <a href=\"https://ruby-doc.org/stdlib-2.7.0/libdoc/securerandom/rdoc/Random/Formatter.html#method-i-urlsafe_base64\" rel=\"nofollow noreferrer\"><code>SecureRandomn.urlsafe_base64</code></a> secure enough for all intents and purposes.</p>\n\n<p>Doorkeeper stores the access tokens in the database and is <a href=\"https://github.com/doorkeeper-gem/doorkeeper/blob/v5.2.3/lib/doorkeeper/orm/active_record/access_token.rb#L3-L4\" rel=\"nofollow noreferrer\">using ActiveRecord</a> (from Rails) as an ORM. <a href=\"https://github.com/doorkeeper-gem/doorkeeper/blob/v5.2.3/lib/doorkeeper/orm/active_record/access_token.rb#L19\" rel=\"nofollow noreferrer\">Before creating</a> a <code>Doorkeeper::AccessToken</code> entry in the database it calls the <code>#generate_token</code> method. The <a href=\"https://github.com/doorkeeper-gem/doorkeeper/blob/v5.2.3/lib/doorkeeper/models/access_token_mixin.rb#L314-L337\" rel=\"nofollow noreferrer\"><code>#generate_token</code></a> method is provided by the <a href=\"https://github.com/doorkeeper-gem/doorkeeper/blob/v5.2.3/lib/doorkeeper/models/access_token_mixin.rb\" rel=\"nofollow noreferrer\"><code>AccessTokenMixin</code></a> mix-in which is  <a href=\"https://github.com/doorkeeper-gem/doorkeeper/blob/v5.2.3/lib/doorkeeper/orm/active_record/access_token.rb#L7\" rel=\"nofollow noreferrer\">included in <code>Doorkeeper::AccessToken</code> model</a>.</p>\n\n<p>The sequence  is:</p>\n\n<ol>\n<li>After <a href=\"https://github.com/doorkeeper-gem/doorkeeper/blob/v5.2.3/lib/doorkeeper/oauth/authorization_code_request.rb#L35-L38\" rel=\"nofollow noreferrer\">successfully authenticating but before responding</a> a new <code>Doorkeeper::AccessToken</code> will be created</li>\n<li>The <a href=\"https://github.com/doorkeeper-gem/doorkeeper/blob/v5.2.3/lib/doorkeeper/models/access_token_mixin.rb#L314-L337\" rel=\"nofollow noreferrer\"><code>AccessTokenMixin#generate_token</code></a> method is called (<code>before</code> callback)</li>\n<li>The <a href=\"https://github.com/doorkeeper-gem/doorkeeper/blob/v5.2.3/lib/doorkeeper/models/access_token_mixin.rb#L339-L348\" rel=\"nofollow noreferrer\"><code>#token_generator</code></a> method is called</li>\n<li>The default <code>UniqueToken</code> token generator is <a href=\"https://github.com/doorkeeper-gem/doorkeeper/blob/v5.2.3/lib/doorkeeper/models/access_token_mixin.rb#L340-L343\" rel=\"nofollow noreferrer\">returned</a></li>\n<li>Back in <code>#generate_token</code> the <a href=\"https://github.com/doorkeeper-gem/doorkeeper/blob/v5.2.3/lib/doorkeeper/models/access_token_mixin.rb#L327-L333\" rel=\"nofollow noreferrer\"><code>token_generator#generate</code></a> method is called</li>\n<li>The token is generated using <a href=\"https://github.com/doorkeeper-gem/doorkeeper/blob/v5.2.3/lib/doorkeeper/oauth/helpers/unique_token.rb#L7-L17\" rel=\"nofollow noreferrer\"><code>SecureRandom</code></a></li>\n<li>Back in <code>#generate_token</code> the secret can be encrypted using <code>bcrypt</code> or hashed with <code>SHA256</code> <a href=\"https://github.com/doorkeeper-gem/doorkeeper/blob/v5.2.3/lib/doorkeeper/models/access_token_mixin.rb#L335\" rel=\"nofollow noreferrer\">before stored</a> (default: plain)</li>\n<li>The token is saved in the database and returned to the caller</li>\n</ol>\n\n<p>For refresh tokens, again, the <a href=\"https://github.com/doorkeeper-gem/doorkeeper/blob/v5.2.3/lib/doorkeeper/models/access_token_mixin.rb#L305-L312\" rel=\"nofollow noreferrer\"><code>Doorkeeper::OAuth::Helpers::UniqueToken</code> generator is used</a>.</p>\n\n<p>The ability to set the access token generator using <code>Doorkeeper.configuration.access_token_generator</code>, makes it possible to plug in different token generators such as <a href=\"https://github.com/doorkeeper-gem/doorkeeper-jwt\" rel=\"nofollow noreferrer\">JWT</a>.</p>\n\n<p>Token recipients (e.g. an API) should verify the received tokens  using the <a href=\"https://github.com/doorkeeper-gem/doorkeeper/blob/v5.2.3/lib/doorkeeper/oauth/token_introspection.rb\" rel=\"nofollow noreferrer\">Token Introspection endpoint</a> (<a href=\"https://github.com/doorkeeper-gem/doorkeeper/wiki/API-endpoint-descriptions-and-examples#post---oauthintrospect\" rel=\"nofollow noreferrer\">documentation</a>) as defined in <a href=\"https://tools.ietf.org/html/rfc7662\" rel=\"nofollow noreferrer\">RFC7662</a>. Tokens can be revoked using the <a href=\"https://github.com/doorkeeper-gem/doorkeeper/blob/v5.2.3/app/controllers/doorkeeper/tokens_controller.rb#L13-L28\" rel=\"nofollow noreferrer\">Token \n Revocation endpoint</a> (<a href=\"https://github.com/doorkeeper-gem/doorkeeper/wiki/API-endpoint-descriptions-and-examples#post---oauthrevoke\" rel=\"nofollow noreferrer\">documentation</a>) as defined in <a href=\"http://tools.ietf.org/html/rfc7009\" rel=\"nofollow noreferrer\">RFC7009</a></p>\n\n<p>My recommendation is to avoid writing your own security related code and use existing open-source solutions such as  Doorkeeper, which are peer-reviewed and already trusted by many companies / projects (aka. <a href=\"https://security.stackexchange.com/q/18197\">\"Do not roll your own crypto\"</a>). It's very easy to make security-related mistakes and jeopardize the security and/or privacy of your customers.</p>\n"}], "owner": {"reputation": 123, "user_id": 3773008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c0876753282def1481a8b1277e647ba?s=128&d=identicon&r=PG&f=1", "display_name": "3pns", "link": "https://stackoverflow.com/users/3773008/3pns"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 385, "favorite_count": 1, "accepted_answer_id": 59743469, "answer_count": 1, "score": 1, "last_activity_date": 1579046342, "creation_date": 1557200632, "last_edit_date": 1557213104, "question_id": 56015242, "link": "https://stackoverflow.com/questions/56015242/what-technology-or-algorithm-doorkeeper-use-to-generate-its-refresh-tokens-and", "title": "What technology or algorithm Doorkeeper use to generate it&#39;s refresh tokens and access tokens and why is it secured", "body": "<p>I have been going through Doorkeeper documentation and had a look in the source code. However, I have yet to understand how Doorkeeper is generating it's tokens. The documentation is focused on how to use Doorkeeper but they don't explain how they generate the tokens and don't explain why they are using a safe token generation, verification and revocation strategy. Oauth2 is a protocol that says nothing about how to generate secured refresh tokens and access token, being Oauth2 compliant in itself says nothing about the technology used for handling token generation and verification.</p>\n\n<p>May somebody explains how doorkeeper generate it's access token and refresh token, and why is it safe. How does Doorkeeper handle token revocation?</p>\n\n<p>Compared to doorkeeper default token system, if all i want is to handle refresh and access token for native mobile application and I don't need the rest of Oauth2 features, would it be safer to roll my own \"refresh token\" strategy by using for example RSA with 1 private key per user identified externally with a uuid and storing the public key on the server and use ssh style encryption challenge over an API, or use JWT with RS512 and use the public key to verify the signature of the token to authenticate the user. The revocation in both cases would be handled by whitelisting the public keys.</p>\n\n<p>My question is not about the OAuth2 protocol that I understand or a statement about the security of doorkeeper but state my ignorance of how doorkeeper handle its tokens, I know it is not a good idea to reinvent the wheel, at the same time I don't want to use something I don't understand, and I don't understand how doorkeeper handle tokens.</p>\n"}, {"tags": ["ruby-on-rails", "arrays", "ruby"], "comments": [{"owner": {"reputation": 4933, "user_id": 2987253, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/aa772cdc439443e5243e9d7aa41a9c6a?s=128&d=identicon&r=PG", "display_name": "Loocid", "link": "https://stackoverflow.com/users/2987253/loocid"}, "edited": false, "score": 0, "creation_date": 1557198810, "post_id": 56015010, "comment_id": 98674162, "body": "Have you attempted anything yourself?"}, {"owner": {"reputation": 690, "user_id": 2390233, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f8cd867dfd775e56b1944f6f9af465bc?s=128&d=identicon&r=PG", "display_name": "ecki", "link": "https://stackoverflow.com/users/2390233/ecki"}, "reply_to_user": {"reputation": 4933, "user_id": 2987253, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/aa772cdc439443e5243e9d7aa41a9c6a?s=128&d=identicon&r=PG", "display_name": "Loocid", "link": "https://stackoverflow.com/users/2987253/loocid"}, "edited": false, "score": 0, "creation_date": 1557199268, "post_id": 56015010, "comment_id": 98674249, "body": "@Loocid Yes, thanks for asking, I&#39;ve added it to the question"}], "answers": [{"comments": [{"owner": {"reputation": 181, "user_id": 9853412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a80bcc603c21ab8e1474266124b58a51?s=128&d=identicon&r=PG&f=1", "display_name": "neversleep", "link": "https://stackoverflow.com/users/9853412/neversleep"}, "reply_to_user": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1557208860, "post_id": 56015477, "comment_id": 98676594, "body": "As I said, this is the most obvious way. It&#39;s not about <i>style</i>, it&#39;s about problem solving and performance (2.5x - 3.5x faster compared to other answers atm)."}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1557210507, "post_id": 56015477, "comment_id": 98677239, "body": "When you see how good people are in C they are measured by how good they are using their logic in their program, when you see how good people are in Ruby, It is to see how good they are at using predefined functions. Ruby has been designed that way."}, {"owner": {"reputation": 181, "user_id": 9853412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a80bcc603c21ab8e1474266124b58a51?s=128&d=identicon&r=PG&f=1", "display_name": "neversleep", "link": "https://stackoverflow.com/users/9853412/neversleep"}, "reply_to_user": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1557211699, "post_id": 56015477, "comment_id": 98677689, "body": "It all depends on your needs, if you don&#39;t care about performance, then of course, go with that pretty one line code, otherwise, what would you do? Ruby doesn&#39;t force you to use predefined methods."}], "tags": [], "owner": {"reputation": 181, "user_id": 9853412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a80bcc603c21ab8e1474266124b58a51?s=128&d=identicon&r=PG&f=1", "display_name": "neversleep", "link": "https://stackoverflow.com/users/9853412/neversleep"}, "is_accepted": false, "score": 0, "last_activity_date": 1557202515, "creation_date": 1557202515, "answer_id": 56015477, "question_id": 56015010, "link": "https://stackoverflow.com/questions/56015010/how-to-count-consecutive-numbers-in-an-array/56015477#56015477", "title": "How to count consecutive numbers in an array?", "body": "<p>Well, the most obvious (and probably the fastest) way is iterate over an array and count everything manually:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>array = [1,2,2,2,2,5,5,1,1,1,3,3,3,3,2,2,2,2,2,2,2]\narray_length_pred = array.length.pred\n\nconsecutive_numbers = []\n\nstarting_index = 0\nvalue = array.first\nlength = 1\n\narray.each_with_index do |v, i|\n  if v != value || i == array_length_pred\n    length += 1 if i == array_length_pred &amp;&amp; value == v\n\n    if length &gt;= 3\n      consecutive_numbers &lt;&lt; {\n        starting_index: starting_index,\n        value: value,\n        length: length\n      }\n    end\n\n    starting_index = i\n    value = v\n    length = 1\n    next\n  end\n\n  length += 1\nend\n\np consecutive_numbers\n\n# [{:starting_index=&gt;1, :value=&gt;2, :length=&gt;4},\n# {:starting_index=&gt;7, :value=&gt;1, :length=&gt;3},\n# {:starting_index=&gt;10, :value=&gt;3, :length=&gt;4},\n# {:starting_index=&gt;14, :value=&gt;2, :length=&gt;7}]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557254810, "post_id": 56015485, "comment_id": 98701066, "body": "starting index is wrong as it should be based on the index in the original array per the OP."}, {"owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557257343, "post_id": 56015485, "comment_id": 98702144, "body": "Fixed, thanks @engineersmnky, I hadn&#39;t realized that."}], "tags": [], "owner": {"reputation": 28612, "user_id": 5025116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7WdYi.jpg?s=128&g=1", "display_name": "Sebastian Palma", "link": "https://stackoverflow.com/users/5025116/sebastian-palma"}, "is_accepted": false, "score": 2, "last_activity_date": 1557257317, "last_edit_date": 1557257317, "creation_date": 1557202561, "answer_id": 56015485, "question_id": 56015010, "link": "https://stackoverflow.com/questions/56015010/how-to-count-consecutive-numbers-in-an-array/56015485#56015485", "title": "How to count consecutive numbers in an array?", "body": "<p>You can <code>chunk_while</code> each pair of elements are equal:</p>\n\n<pre><code>p array.chunk_while { |a, b| a == b }.to_a\n#\u00a0[[1], [2, 2, 2, 2], [5, 5], [1, 1, 1], [3, 3, 3, 3], [2, 2, 2, 2, 2, 2, 2]]\n</code></pre>\n\n<p>You select the arrays with 3 or more elements.</p>\n\n<p>After that, with <code>then</code>, you can <em>yield self</em>, so you have access to the array of arrays, which you can use to get the <code>starting_index</code>:</p>\n\n<pre><code>[1,2,2,2,2,5,5,1,1,1,3,3,3,3,2,2,2,2,2,2,2].chunk_while(&amp;:==).then do |this|\n  this.each_with_object([]).with_index do |(e, memo), index|\n    memo &lt;&lt; { starting_index: this.to_a[0...index].flatten.size, value: e.first, length: e.size }\n  end\nend.select { |e| e[:length] &gt; 3 }\n\n# [{:starting_index=&gt;1, :value=&gt;2, :length=&gt;4},\n#  {:starting_index=&gt;10, :value=&gt;3, :length=&gt;4},\n#  {:starting_index=&gt;14, :value=&gt;2, :length=&gt;7}]\n</code></pre>\n\n<p>For the starting_index, you get the elements to the current index (non inclusive), flatten them, and get the total of elements.</p>\n\n<p>The value, as each array in the array has the same elements, can be anything, the length, is the length of the current array in the \"main\" array.</p>\n"}, {"comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557255462, "post_id": 56016038, "comment_id": 98701346, "body": "<code>.each_with_object([])</code> in this case is just <code>map</code>"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557258479, "post_id": 56016038, "comment_id": 98702576, "body": "@engineersmnky, thank you for informing me of my blind spot."}], "tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": true, "score": 4, "last_activity_date": 1557258443, "last_edit_date": 1557258443, "creation_date": 1557206813, "answer_id": 56016038, "question_id": 56015010, "link": "https://stackoverflow.com/questions/56015010/how-to-count-consecutive-numbers-in-an-array/56016038#56016038", "title": "How to count consecutive numbers in an array?", "body": "<pre><code>array.each_with_index.\n      chunk(&amp;:first).\n      select { |_,a| a.size &gt; 3 }.\n      map { |n,a| { starting_index: a.first.last, value: n, length: a.size } }\n  #=&gt; [{:starting_index=&gt; 1, :value=&gt;2, :length=&gt;4},\n  #    {:starting_index=&gt;10, :value=&gt;3, :length=&gt;4},\n  #    {:starting_index=&gt;14, :value=&gt;2, :length=&gt;7}] \n</code></pre>\n\n<p>The steps are as follows.</p>\n\n<pre><code>e = array.each_with_index.chunk(&amp;:first)\n  #=&gt; #&lt;Enumerator: #&lt;Enumerator::Generator:0x00005b1944253c18&gt;:each&gt; \n</code></pre>\n\n<p>We can convert this enumerator to an array to view the elements it will generate and pass to its block.</p>\n\n<pre><code>e.to_a\n  #=&gt; [[1, [[1, 0]]],\n  #    [2, [[2, 1], [2, 2], [2, 3], [2, 4]]],\n  #    [5, [[5, 5], [5, 6]]],\n  #    [1, [[1, 7], [1, 8], [1, 9]]],\n  #    [3, [[3, 10], [3, 11], [3, 12], [3, 13]]],\n  #    [2, [[2, 14], [2, 15], [2, 16], [2, 17], [2, 18], [2, 19], [2, 20]]]] \n</code></pre>\n\n<p>Continuing,</p>\n\n<pre><code>c = e.select { |_,a| a.size &gt; 3 }\n  #=&gt; [[2, [[2, 1], [2, 2], [2, 3], [2, 4]]],\n  #    [3, [[3, 10], [3, 11], [3, 12], [3, 13]]],\n  #    [2, [[2, 14], [2, 15], [2, 16], [2, 17], [2, 18], [2, 19], [2, 20]]]] \nc.map { |n,a| { starting_index: a.first.last, value: n, length: a.size } }\n  #=&gt; [{:starting_index=&gt; 1, :value=&gt;2, :length=&gt;4},\n  #    {:starting_index=&gt;10, :value=&gt;3, :length=&gt;4},\n  #    {:starting_index=&gt;14, :value=&gt;2, :length=&gt;7}] \n</code></pre>\n\n<p>This is another way.</p>\n\n<pre><code>array.each_with_index.with_object([]) do |(n,i),arr|\n  if arr.any? &amp;&amp; arr.last[:value] == n\n    arr.last[:length] += 1\n  else\n    arr &lt;&lt; { starting_index: i, value: n, length: 1 }\n  end\nend.select { |h| h[:length] &gt; 3 }\n  #=&gt; [{:starting_index=&gt; 1, :value=&gt;2, :length=&gt;4},\n  #    {:starting_index=&gt;10, :value=&gt;3, :length=&gt;4},\n  #    {:starting_index=&gt;14, :value=&gt;2, :length=&gt;7}]     \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557255932, "post_id": 56016085, "comment_id": 98701546, "body": "Since I have noticed your shining to 2.6 methods (specifically <code>then</code>), this <code>array.zip((0...array.size))</code> can just be <code>array.zip(0...)</code> thanks to <a href=\"https://ruby-doc.org/core-2.6.1/Range.html#class-Range-label-Endless+Ranges\" rel=\"nofollow noreferrer\">Endless Ranges</a>"}, {"owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 1, "creation_date": 1557262185, "post_id": 56016085, "comment_id": 98704149, "body": "@engineersmnky :) Picked up!"}], "tags": [], "owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "is_accepted": false, "score": 2, "last_activity_date": 1557262051, "last_edit_date": 1557262051, "creation_date": 1557207084, "answer_id": 56016085, "question_id": 56015010, "link": "https://stackoverflow.com/questions/56015010/how-to-count-consecutive-numbers-in-an-array/56016085#56016085", "title": "How to count consecutive numbers in an array?", "body": "<p>This is another option..</p>\n\n<ul>\n<li>Zipping the array (<a href=\"https://ruby-doc.org/core-2.6.2/Enumerable.html#method-i-zip\" rel=\"nofollow noreferrer\">Enumerable#zip</a>) with its indexes by <a href=\"https://ruby-doc.org/core-2.6.2/Range.html#class-Range-label-Endless+Ranges\" rel=\"nofollow noreferrer\">Endles Ranges</a></li>\n<li>Calling <a href=\"https://ruby-doc.org/core-2.6.2/Enumerable.html#method-i-slice_when\" rel=\"nofollow noreferrer\">Enumerable#slice_when</a> (another flavour of <code>chunk_while</code>)</li>\n<li>Mapping (<a href=\"https://ruby-doc.org/core-2.6.2/Enumerable.html#method-i-map\" rel=\"nofollow noreferrer\">Enumerable#map</a>) to the required Hash</li>\n<li>Finally rejecting (<a href=\"https://ruby-doc.org/core-2.6.2/Enumerable.html#method-i-reject\" rel=\"nofollow noreferrer\">Enumerable#reject</a>) hashes if <code>length</code> is greater than <code>3</code></li>\n</ul>\n\n<hr>\n\n<pre><code>array\n     .zip(0..)\n     .slice_when { |a, b| a.first != b.first }\n     .map { |a| { starting_index: a.first.last, value: a.first.first, length: a.size } }\n     .reject { |h| h[:length] &lt; 3 }\n\n#=&gt; [{:starting_index=&gt;1, :value=&gt;2, :length=&gt;4}, {:starting_index=&gt;7, :value=&gt;1, :length=&gt;3}, {:starting_index=&gt;10, :value=&gt;3, :length=&gt;4}, {:starting_index=&gt;14, :value=&gt;2, :length=&gt;7}]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 690, "user_id": 2390233, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f8cd867dfd775e56b1944f6f9af465bc?s=128&d=identicon&r=PG", "display_name": "ecki", "link": "https://stackoverflow.com/users/2390233/ecki"}, "edited": false, "score": 2, "creation_date": 1557233898, "post_id": 56022075, "comment_id": 98689980, "body": "There might be problems with this approach if there is a number greater than 9, or a float, wouldn&#39;t there?"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "reply_to_user": {"reputation": 690, "user_id": 2390233, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f8cd867dfd775e56b1944f6f9af465bc?s=128&d=identicon&r=PG", "display_name": "ecki", "link": "https://stackoverflow.com/users/2390233/ecki"}, "edited": false, "score": 1, "creation_date": 1557242821, "post_id": 56022075, "comment_id": 98695485, "body": "@ecki, you are a master of understatement. You forgot to mention negative numbers, btw."}], "tags": [], "owner": {"reputation": 1880, "user_id": 3574603, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/71a7b92124991652bf4dd64a9c50a9ca?s=128&d=identicon&r=PG&f=1", "display_name": "user3574603", "link": "https://stackoverflow.com/users/3574603/user3574603"}, "is_accepted": false, "score": 0, "last_activity_date": 1557230980, "last_edit_date": 1557230980, "creation_date": 1557230203, "answer_id": 56022075, "question_id": 56015010, "link": "https://stackoverflow.com/questions/56015010/how-to-count-consecutive-numbers-in-an-array/56022075#56022075", "title": "How to count consecutive numbers in an array?", "body": "<p>You could work with strings instead.</p>\n\n<p>Here, I coerce the array into a string:</p>\n\n<pre><code>input_sequence = [1,2,2,2,2,5,5,1,1,1,3,3,3,3,2,2,2,2,2,2,2].join\n</code></pre>\n\n<p>I use a regex to group consecutive characters:</p>\n\n<pre><code>groups = input_sequence.gsub(/(.)\\1*/).to_a\n#=&gt; [\"1\", \"2222\", \"55\", \"111\", \"3333\", \"2222222\"]\n</code></pre>\n\n<p>Now I can search for the groups as substrings within the input string:</p>\n\n<pre><code>groups.map do |group|\n  {\n    starting_index: input_sequence.index(group), \n    value: group[0].to_i,\n    length: group.length\n  }\nend.reject { |group| group[:length] &lt;= 3 }\n\n#=&gt; [{:starting_index=&gt;1, :value=&gt;2, :length=&gt;4},\n     {:starting_index=&gt;7, :value=&gt;1, :length=&gt;3},\n     {:starting_index=&gt;10, :value=&gt;3, :length=&gt;4},\n     {:starting_index=&gt;14, :value=&gt;2, :length=&gt;7}]\n</code></pre>\n\n<p>There's room for improvement here -- I'm creating lots of intermediate objects for one -- but I thought I would offer a different approach.</p>\n"}], "owner": {"reputation": 690, "user_id": 2390233, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f8cd867dfd775e56b1944f6f9af465bc?s=128&d=identicon&r=PG", "display_name": "ecki", "link": "https://stackoverflow.com/users/2390233/ecki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 763, "favorite_count": 0, "accepted_answer_id": 56016038, "answer_count": 5, "score": 3, "last_activity_date": 1557262051, "creation_date": 1557198638, "last_edit_date": 1557219314, "question_id": 56015010, "link": "https://stackoverflow.com/questions/56015010/how-to-count-consecutive-numbers-in-an-array", "title": "How to count consecutive numbers in an array?", "body": "<p>If I have an array:</p>\n\n<pre><code>array = [1,2,2,2,2,5,5,1,1,1,3,3,3,3,2,2,2,2,2,2,2]\n</code></pre>\n\n<p>I want to be able to identify consecutive matching numbers that have a length of greater than 3. And map the starting index of the consecutive numbers. An example output for the above array would be:</p>\n\n<pre><code>consecutive_numbers = [\n  {starting_index: 1, value: 2, length: 4},\n  {starting_index: 10, value: 3, length: 4},\n  {starting_index: 14, value: 2, length: 7}\n]\n</code></pre>\n\n<p>The values can be the same, but the consecutive series' must be mutually exclusive. See that there are 2 hashes with a value of 2, but their starting indexes are different.</p>\n\n<p>My attempt so far... looks like this:</p>\n\n<pre><code>array.each_cons(3).with_index.select{|(a,b,c), i| \n  [a,b,c].uniq.length == 1\n}\n</code></pre>\n\n<p>but that will returns:</p>\n\n<pre><code>[[[2, 2, 2], 1], [[2, 2, 2], 2], [[1, 1, 1], 7], [[3, 3, 3], 10], [[3, 3, 3], 11], [[2, 2, 2], 14], [[2, 2, 2], 15], [[2, 2, 2], 16], [[2, 2, 2], 17], [[2, 2, 2], 18]]\n</code></pre>\n\n<p>But that returns overlapping results.</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "answers": [{"tags": [], "owner": {"reputation": 3320, "user_id": 4950680, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C8cEh.jpg?s=128&g=1", "display_name": "Martin Zinovsky", "link": "https://stackoverflow.com/users/4950680/martin-zinovsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1557216268, "last_edit_date": 1557216268, "creation_date": 1557215962, "answer_id": 56018021, "question_id": 56014972, "link": "https://stackoverflow.com/questions/56014972/deprecation-error-for-rails-stopping-me-from-launching-rails-server/56018021#56018021", "title": "Deprecation error for rails stopping me from launching rails server", "body": "<p>Check first line in error backtrace. You dont have /config/database.yml in your project</p>\n\n<blockquote>\n  <p>No such file or directory @ rb_sysopen -\n  /Users/bena/Documents/repos/ben-repos/mapknitter/config/database.yml\n  (Errno::ENOENT)</p>\n</blockquote>\n\n<p>Make sure you install everything from <a href=\"https://github.com/publiclab/mapknitter#prerequisites\" rel=\"nofollow noreferrer\">Prerequisites</a> and simply follow <a href=\"https://github.com/publiclab/mapknitter#installation\" rel=\"nofollow noreferrer\">Installation</a> guide</p>\n"}], "owner": {"reputation": 27, "user_id": 8409227, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5e94da2ea4809e35899a95aac61a1b7?s=128&d=identicon&r=PG&f=1", "display_name": "Ben Anderson", "link": "https://stackoverflow.com/users/8409227/ben-anderson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1557216268, "creation_date": 1557198360, "question_id": 56014972, "link": "https://stackoverflow.com/questions/56014972/deprecation-error-for-rails-stopping-me-from-launching-rails-server", "title": "Deprecation error for rails stopping me from launching rails server", "body": "<p>I am doing some open source stuff for the rails app <a href=\"https://github.com/publiclab/mapknitter\" rel=\"nofollow noreferrer\">https://github.com/publiclab/mapknitter</a>  but when I try to launch the rails server using <code>rails s</code> I get the following error message:</p>\n\n<pre><code>DEPRECATION WARNING: Support for Rails versions before 4.2 is deprecated and will be removed from skylight 2.0. (called from require at /Users/bena/.rvm/rubies/ruby-2.4.6/lib/ruby/site_ruby/2.4.0/bundler/runtime.rb:81)\n=&gt; Booting WEBrick\n=&gt; Rails 3.2.22.5 application starting in development on http://0.0.0.0:3000\n=&gt; Call with -d to detach\n=&gt; Ctrl-C to shutdown server\n[SKYLIGHT] [1.7.2] Running Skylight in development mode. No data will be reported until you deploy your app.\n(To disable this message for all local apps, run `skylight disable_dev_warning`.)\nExiting\n/Users/bena/.rvm/gems/ruby-2.4.6/gems/railties-3.2.22.5/lib/rails/application/configuration.rb:115:in `read': No such file or directory @ rb_sysopen - /Users/bena/Documents/repos/ben-repos/mapknitter/config/database.yml (Errno::ENOENT)\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/railties-3.2.22.5/lib/rails/application/configuration.rb:115:in `database_configuration'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/activerecord-3.2.22.5/lib/active_record/railtie.rb:84:in `block (2 levels) in &lt;class:Railtie&gt;'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/activesupport-3.2.22.5/lib/active_support/lazy_load_hooks.rb:36:in `instance_eval'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/activesupport-3.2.22.5/lib/active_support/lazy_load_hooks.rb:36:in `execute_hook'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/activesupport-3.2.22.5/lib/active_support/lazy_load_hooks.rb:43:in `block in run_load_hooks'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/activesupport-3.2.22.5/lib/active_support/lazy_load_hooks.rb:42:in `each'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/activesupport-3.2.22.5/lib/active_support/lazy_load_hooks.rb:42:in `run_load_hooks'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/activerecord-3.2.22.5/lib/active_record/base.rb:720:in `&lt;top (required)&gt;'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/skylight-1.7.2/lib/skylight/probes.rb:119:in `require'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/skylight-1.7.2/lib/skylight/probes.rb:119:in `require'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/activesupport-3.2.22.5/lib/active_support/dependencies.rb:251:in `block in require'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/activesupport-3.2.22.5/lib/active_support/dependencies.rb:236:in `load_dependency'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/activesupport-3.2.22.5/lib/active_support/dependencies.rb:251:in `require'\n    from /Users/bena/Documents/repos/ben-repos/mapknitter/config/initializers/column_definition.rb:19:in `&lt;class:ColumnDefinition&gt;'\n    from /Users/bena/Documents/repos/ben-repos/mapknitter/config/initializers/column_definition.rb:17:in `&lt;top (required)&gt;'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/activesupport-3.2.22.5/lib/active_support/dependencies.rb:245:in `load'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/activesupport-3.2.22.5/lib/active_support/dependencies.rb:245:in `block in load'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/activesupport-3.2.22.5/lib/active_support/dependencies.rb:236:in `load_dependency'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/activesupport-3.2.22.5/lib/active_support/dependencies.rb:245:in `load'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/railties-3.2.22.5/lib/rails/engine.rb:593:in `block (2 levels) in &lt;class:Engine&gt;'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/railties-3.2.22.5/lib/rails/engine.rb:592:in `each'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/railties-3.2.22.5/lib/rails/engine.rb:592:in `block in &lt;class:Engine&gt;'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/railties-3.2.22.5/lib/rails/initializable.rb:30:in `instance_exec'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/railties-3.2.22.5/lib/rails/initializable.rb:30:in `run'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/railties-3.2.22.5/lib/rails/initializable.rb:55:in `block in run_initializers'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/railties-3.2.22.5/lib/rails/initializable.rb:54:in `each'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/railties-3.2.22.5/lib/rails/initializable.rb:54:in `run_initializers'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/railties-3.2.22.5/lib/rails/application.rb:136:in `initialize!'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/railties-3.2.22.5/lib/rails/railtie/configurable.rb:30:in `method_missing'\n    from /Users/bena/Documents/repos/ben-repos/mapknitter/config/environment.rb:5:in `&lt;top (required)&gt;'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/skylight-1.7.2/lib/skylight/probes.rb:119:in `require'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/skylight-1.7.2/lib/skylight/probes.rb:119:in `require'\n    from /Users/bena/Documents/repos/ben-repos/mapknitter/config.ru:3:in `block in &lt;main&gt;'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/rack-1.4.7/lib/rack/builder.rb:51:in `instance_eval'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/rack-1.4.7/lib/rack/builder.rb:51:in `initialize'\n    from /Users/bena/Documents/repos/ben-repos/mapknitter/config.ru:in `new'\n    from /Users/bena/Documents/repos/ben-repos/mapknitter/config.ru:in `&lt;main&gt;'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/rack-1.4.7/lib/rack/builder.rb:40:in `eval'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/rack-1.4.7/lib/rack/builder.rb:40:in `parse_file'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/rack-1.4.7/lib/rack/server.rb:200:in `app'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/railties-3.2.22.5/lib/rails/commands/server.rb:46:in `app'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/rack-1.4.7/lib/rack/server.rb:304:in `wrapped_app'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/rack-1.4.7/lib/rack/server.rb:254:in `start'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/railties-3.2.22.5/lib/rails/commands/server.rb:70:in `start'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/railties-3.2.22.5/lib/rails/commands.rb:55:in `block in &lt;top (required)&gt;'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/railties-3.2.22.5/lib/rails/commands.rb:50:in `tap'\n    from /Users/bena/.rvm/gems/ruby-2.4.6/gems/railties-3.2.22.5/lib/rails/commands.rb:50:in `&lt;top (required)&gt;'\n    from script/rails:6:in `require'\n    from script/rails:6:in `&lt;main&gt;'\n</code></pre>\n\n<p>Is the problem caused by the the version of rails I am using or the version of skylight or something else entirely?</p>\n\n<p>I am using <code>ruby 2.4.6p354</code> and <code>rails 3.2.22.5</code></p>\n\n<p>I have installed and tried to switch to <code>rails 4.2.0</code> but that doesn't seem to be working, I think because in the gemfile there is a pessimistic version constraint of <code>gem \"rails\" ,\"~&gt;3.2\"</code> but I could be completely wrong. I have been told not to change the gemfile.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "heroku", "dns"], "comments": [{"owner": {"reputation": 4690, "user_id": 1937435, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YyN37.jpg?s=128&g=1", "display_name": "Josh Brody", "link": "https://stackoverflow.com/users/1937435/josh-brody"}, "edited": false, "score": 0, "creation_date": 1557200489, "post_id": 56014826, "comment_id": 98674500, "body": "Your filter is good. Why not just try to match request.host to the correct host and if it doesn&#39;t match redirect?"}], "owner": {"reputation": 93, "user_id": 1509089, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/7149dfb87c431b32c449adaf0f4da892?s=128&d=identicon&r=PG", "display_name": "Patrick A.", "link": "https://stackoverflow.com/users/1509089/patrick-a"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 33, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1557197081, "creation_date": 1557197081, "question_id": 56014826, "link": "https://stackoverflow.com/questions/56014826/redirect-all-incoming-domain-variations-to-an-absolute-domain-heroku-rails", "title": "Redirect all incoming domain variations to an absolute domain Heroku Rails", "body": "<p>My setup is:\n- Heroku\n- Rails 3\n- GoDaddy DNS</p>\n\n<p>I'm trying to redirect all incoming routes of a domain variation to an absolute path. Including HTTPS.</p>\n\n<p>For example:</p>\n\n<pre><code>algrim.co\nwww.algrim.co\nhttp://www.algrim.co\nhttp://algrim.co\n</code></pre>\n\n<p>Should all redirect to:</p>\n\n<pre><code>https://www.algrim.co\n</code></pre>\n\n<p>Heroku wants the application to do this. All I've tried within the application controller is this\n  before_filter :correct_domain!</p>\n\n<pre><code>def correct_domain!\nif request.host == \"https://algrim.co\"\n  redirect_to \"https://www.algrim.co#{request.fullpath}\", :status =&gt; 301\nend\n</code></pre>\n\n<p>end</p>\n\n<p>But it doesn't cover all of the cases. Can someone help me here. How do I ensure all links pointing to my site are going to the correct places.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "rest", "shopify", "shopify-app"], "answers": [{"tags": [], "owner": {"reputation": 8203, "user_id": 210841, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5adbe9e20522d6a177e76b223b6750ed?s=128&d=identicon&r=PG", "display_name": "David Lazar", "link": "https://stackoverflow.com/users/210841/david-lazar"}, "is_accepted": false, "score": 0, "last_activity_date": 1557240580, "creation_date": 1557240580, "answer_id": 56025269, "question_id": 56014577, "link": "https://stackoverflow.com/questions/56014577/post-to-api-with-form-rails/56025269#56025269", "title": "POST to API with Form rails?", "body": "<p>You have to define \"front-end\". What does that mean? In your App all your routes are relative to the App itself, which is hopefully embedded in the shop itself. When you have a form for Add Product in your App, you POST to whatever endpoint you setup in your controller scheme for that. So your front-end is just a view in your App. </p>\n\n<p>If instead by \"front-end\" you mean the customer facing Shopify store itself, then that is never going to work securely except in the case of using the App Proxy pattern, for obvious reasons.</p>\n"}, {"tags": [], "owner": {"reputation": 691, "user_id": 4385342, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-ywHOrlzk5g4/AAAAAAAAAAI/AAAAAAAAB9Y/mO2q6r1jr60/photo.jpg?sz=128", "display_name": "a3y3", "link": "https://stackoverflow.com/users/4385342/a3y3"}, "is_accepted": false, "score": 0, "last_activity_date": 1557241624, "creation_date": 1557241624, "answer_id": 56025571, "question_id": 56014577, "link": "https://stackoverflow.com/questions/56014577/post-to-api-with-form-rails/56025571#56025571", "title": "POST to API with Form rails?", "body": "<p>When you write <code>@new_product</code> in your controller, there is likely to be no value returned, so when you access it in your form action, it defaults to \"/\". </p>\n\n<p>I would suggest creating a route for your controller and action in your <code>routes.rb</code> file. For example, if your controller is <code>ProductsController</code> and the action (or method) is <code>def create</code>, the route would look like <code>POST /products =&gt; products#create</code>.</p>\n\n<p>Then, in your form, you can use <code>/products</code> in your form action, like: <code>&lt;form method=\"POST\" action=\"/products\" data-shopify-app-submit=\"\"&gt;</code></p>\n"}], "owner": {"reputation": 1263, "user_id": 10221813, "user_type": "registered", "profile_image": "https://graph.facebook.com/10160530708235447/picture?type=large", "display_name": "uno", "link": "https://stackoverflow.com/users/10221813/uno"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 538, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1557241624, "creation_date": 1557194831, "question_id": 56014577, "link": "https://stackoverflow.com/questions/56014577/post-to-api-with-form-rails", "title": "POST to API with Form rails?", "body": "<p>I am triyng to create a new Product to the shopify API.</p>\n\n<p>when i put this in my controller:</p>\n\n<pre><code>new_product = ShopifyAPI::Product.new\nnew_product.title = \"Burton Custom Freestlye 151\"\nnew_product.product_type = \"Snowboard\"\nnew_product.vendor = \"Burton\"\nnew_product.save\n</code></pre>\n\n<p>It will create a new product on each page reload</p>\n\n<p>I want to create a product with a form to fill out on the front end.</p>\n\n<p>I have tried this:\n<strong>controller:</strong></p>\n\n<pre><code>@new_product = ShopifyAPI::Product.new(\n      :title =&gt; :title,\n      :vendor =&gt; :vendor,\n      :product_type =&gt; :product_type,\n    )\n</code></pre>\n\n<p><strong>View:</strong></p>\n\n<pre><code>&lt;form method=\"POST\" action=&lt;%= @new_product  %&gt; data-shopify-app-submit=\"\"&gt;\n  &lt;input name=\"authenticity_token\" value=\"&lt;%= form_authenticity_token %&gt;\" type=\"hidden\"&gt;\n  &lt;p&gt;\n    &lt;label&gt;Name:&lt;/label&gt;\n    &lt;input type=\"text\" name=\"title\"/&gt;\n  &lt;/p&gt;\n  &lt;p&gt;\n    &lt;label&gt;Body&lt;/label&gt;\n    &lt;input type=\"text\" name=\"body_html\"/&gt;\n  &lt;/p&gt;\n  &lt;p&gt;\n    &lt;label&gt;Vendor:&lt;/label&gt;\n    &lt;input type=\"text\" name=\"vendor\"/&gt;\n  &lt;/p&gt;\n  &lt;p&gt;\n    &lt;label&gt;Product Type:&lt;/label&gt;\n    &lt;input type=\"text\" name=\"product_type\"/&gt;\n  &lt;/p&gt;\n  &lt;p&gt;\n    &lt;label&gt;Tags:&lt;/label&gt;\n    &lt;input type=\"text\" name=\"tags\"/&gt;\n  &lt;/p&gt;\n  &lt;input type=\"submit\"&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p><strong>Error:</strong></p>\n\n<pre><code>ActionController::RoutingError (No route matches [POST] \"/\"):\n</code></pre>\n\n<p>I then tried adding <code>post '/'</code> to my routes but it wouldn't commit.</p>\n\n<p>I added <code>post 'admin/api/products'</code> as well to my routes, but no help.</p>\n\n<p>The API route to POST to is <code>https://#{@shop_session.url}/admin/api/products.json</code> so i tried using this form:</p>\n\n<pre><code>&lt;form method=\"POST\" action=\"&lt;%= \"https://#{@shop_session.url}/admin/api/products.json\" %&gt;\" data-shopify-app-submit=\"\"&gt;\n  &lt;input name=\"authenticity_token\" value=\"&lt;%= form_authenticity_token %&gt;\" type=\"hidden\"&gt;\n....\n.....\n  &lt;input type=\"submit\"&gt;\n\n&lt;/form&gt;\n</code></pre>\n\n<p>With this, nothing happens.  Not even an update within heroku logs.  But in firefox i get a \"Blocked by Content Security Policy\".</p>\n\n<p>How can I convert the working code in the controller that works for reloads into a form I can use on the front end?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "exe"], "comments": [{"owner": {"reputation": 4690, "user_id": 1937435, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YyN37.jpg?s=128&g=1", "display_name": "Josh Brody", "link": "https://stackoverflow.com/users/1937435/josh-brody"}, "edited": false, "score": 0, "creation_date": 1557200370, "post_id": 56014488, "comment_id": 98674471, "body": "Like all things, it&#39;s certainly possible but not without a massive number of hoops to jump through. It sounds like you might be using the wrong tool for the wrong job."}, {"owner": {"reputation": 735, "user_id": 4540883, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/10152660906162393/picture?type=large", "display_name": "Diego Velez", "link": "https://stackoverflow.com/users/4540883/diego-velez"}, "edited": false, "score": 0, "creation_date": 1557202982, "post_id": 56014488, "comment_id": 98674978, "body": "Can you please explain why you want to do that? maybe for local development or something similar?"}], "owner": {"reputation": 39, "user_id": 11299870, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-JfDvBs1iq-c/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdWhs_ZtkXDdNGjpcDMVoubqWEsMQ/mo/photo.jpg?sz=128", "display_name": "Megan Foreman", "link": "https://stackoverflow.com/users/11299870/megan-foreman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 33, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1557194050, "creation_date": 1557194050, "question_id": 56014488, "link": "https://stackoverflow.com/questions/56014488/how-can-i-run-my-ruby-on-rails-project-through-an-executable", "title": "How can I run my ruby on rails project through an executable?", "body": "<p>I need to be able to run my ruby project through a build script (sort of like what ANT xml files do for Java). I am new to Ruby on Rails and am not sure if this is even possible for this particular language.</p>\n\n<p>I hope that it will be able to, when given a zip file of my project, run the executable and have the project work on their PC. Is this possible to do for ruby? If so, which commands should I include in the file? (ex. db:migrate, bundle install, etc)</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "rails-activerecord"], "answers": [{"tags": [], "owner": {"reputation": 3502, "user_id": 2558108, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DUiG3.jpg?s=128&g=1", "display_name": "Qwertie", "link": "https://stackoverflow.com/users/2558108/qwertie"}, "is_accepted": true, "score": 0, "last_activity_date": 1557194186, "creation_date": 1557194186, "answer_id": 56014506, "question_id": 56014196, "link": "https://stackoverflow.com/questions/56014196/activerecord-cache-key-does-not-change-for-included-tables/56014506#56014506", "title": "ActiveRecord cache_key does not change for included tables", "body": "<p>After reading the api docs and reading the source for cache_key it seems that table joins in the query are not supported and the cache key only checks for updates on the first model. There does not seem to be a simple fix other than implementing a custom version of cache key that does a similar thing but for multiple tables.</p>\n"}], "owner": {"reputation": 3502, "user_id": 2558108, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DUiG3.jpg?s=128&g=1", "display_name": "Qwertie", "link": "https://stackoverflow.com/users/2558108/qwertie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 56014506, "answer_count": 1, "score": 0, "last_activity_date": 1557194186, "creation_date": 1557191082, "question_id": 56014196, "link": "https://stackoverflow.com/questions/56014196/activerecord-cache-key-does-not-change-for-included-tables", "title": "ActiveRecord cache_key does not change for included tables", "body": "<p>I have the query</p>\n\n<pre><code>  query = A.all.includes(:bs)\n\n  Rails.cache.fetch(query.cache_key) do\n    .....\n  end\n</code></pre>\n\n<p>When the content of a record included from the B model changes the cache key is not expired and the old data is fetched. Is there any way to have cache_key check for changes on tables in <code>includes</code>?</p>\n"}, {"tags": ["ruby", "api", "signature", "binance"], "comments": [{"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1557188031, "post_id": 56013421, "comment_id": 98672371, "body": "Perhaps you need to pass <code>rcvdWindow</code> query param?  <a href=\"https://github.com/binance-exchange/binance-official-api-docs/blob/master/rest-api.md#timing-security\" rel=\"nofollow noreferrer\">github.com/binance-exchange/binance-official-api-docs/blob/&hellip;</a>"}, {"owner": {"reputation": 1927, "user_id": 953419, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/0f79e690bef0b6c98676b5751056e0a1?s=128&d=identicon&r=PG", "display_name": "seamus", "link": "https://stackoverflow.com/users/953419/seamus"}, "reply_to_user": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1557191479, "post_id": 56013421, "comment_id": 98672936, "body": "rcvdwindow: Optional Parameter, but i tried to include it as well. Same result."}], "answers": [{"tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": true, "score": 2, "last_activity_date": 1557195466, "last_edit_date": 1557195466, "creation_date": 1557195095, "answer_id": 56014611, "question_id": 56013421, "link": "https://stackoverflow.com/questions/56013421/ruby-binance-api-signature-is-not-signing-correctly/56014611#56014611", "title": "Ruby - Binance API: Signature is not signing correctly", "body": "<p>Seems like you're calling <code>get_time</code> twice so that may be your problem as the <a href=\"https://github.com/binance-exchange/binance-official-api-docs/blob/master/rest-api.md#signed-trade-and-user_data-endpoint-security\" rel=\"nofollow noreferrer\">signed request documentation</a> indicates signature should contain all of your query params and request body concatenated.  When you call <code>get_time</code> the 2nd time, the timestamp has changed AFTER you created the signature with the 1st timestamp.</p>\n\n<p>Try this instead</p>\n\n<pre><code>  def get_amount\n    timestamp = get_time\n    query = URI.encode_www_form(\"timestamp\"=&gt; timestamp)\n    signature = sig(query)\n    query = URI.encode_www_form(\"timestamp\"=&gt; timestamp, \"signature\" =&gt; signature)\n    endpoint = \"/api/v3/account\"\n    uri = @url + endpoint + '?' + query\n\n    uri = URI(uri)\n    req = Net::HTTP::Get.new(uri)\n    req['X-MBX-APIKEY'] = @api_key\n\n    res = Net::HTTP.start(uri.hostname, uri.port, :use_ssl =&gt; uri.scheme == 'https') do |http|\n      http.request(req)\n    end\n\n    puts \"Sig: #{signature}\"\n    puts \"www: #{uri}\" \n    res.body\n  end\n</code></pre>\n\n<p>On a side note, your <code>get_time</code> method could be 1 line:</p>\n\n<pre><code>def get_time\n  (Time.now.to_f * 1000).to_i.to_s\nend\n</code></pre>\n"}], "owner": {"reputation": 1927, "user_id": 953419, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/0f79e690bef0b6c98676b5751056e0a1?s=128&d=identicon&r=PG", "display_name": "seamus", "link": "https://stackoverflow.com/users/953419/seamus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 723, "favorite_count": 0, "accepted_answer_id": 56014611, "answer_count": 1, "score": 2, "last_activity_date": 1557195466, "creation_date": 1557183933, "question_id": 56013421, "link": "https://stackoverflow.com/questions/56013421/ruby-binance-api-signature-is-not-signing-correctly", "title": "Ruby - Binance API: Signature is not signing correctly", "body": "<p>I am attempting to connect to the Binance API.</p>\n\n<p><a href=\"https://github.com/binance-exchange/binance-official-api-docs/blob/master/rest-api.md\" rel=\"nofollow noreferrer\">https://github.com/binance-exchange/binance-official-api-docs/blob/master/rest-api.md</a></p>\n\n<p>I am getting denied access. I suspect the issue might not be the <strong>'signature'</strong></p>\n\n<p>If any one has experience with signing rest requests to Binance, a point in the right direction of where I am going wrong would be appreciated.</p>\n\n<blockquote>\n  <p>error {\"code\":-1022,\"msg\":\"Signature for this request is not valid.\"}</p>\n</blockquote>\n\n<pre><code>  def get_time\n    endpoint = \"/api/v1/time\"\n    uri = @url + endpoint\n    uri = URI(uri)\n    response = Net::HTTP.get(uri)\n    data = JSON.parse(response)\n    data[\"serverTime\"]\n  end\n\n  def get_amount\n    query = URI.encode_www_form(\"timestamp\"=&gt; get_time)\n    signature = sig(query)\n    query = URI.encode_www_form(\"timestamp\"=&gt; get_time, \"signature\" =&gt; signature)\n    endpoint = \"/api/v3/account\"\n    uri = @url + endpoint + '?' + query\n\n    uri = URI(uri)\n    req = Net::HTTP::Get.new(uri)\n    req['X-MBX-APIKEY'] = @api_key\n\n    res = Net::HTTP.start(uri.hostname, uri.port, :use_ssl =&gt; uri.scheme == 'https') do |http|\n      http.request(req)\n    end\n\n    puts \"Sig: #{signature}\"\n    puts \"www: #{uri}\" \n    res.body\n  end\n\n  def sig(query)\n    digest = OpenSSL::Digest::SHA256.new\n    OpenSSL::HMAC.hexdigest(digest, @api_secret, query)\n  end\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "url", "search"], "comments": [{"owner": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "edited": false, "score": 0, "creation_date": 1557189258, "post_id": 56013276, "comment_id": 98672556, "body": "I suppose you could use a LIKE query and gsub the <code>*</code> to <code>%</code>? Not sure this is best way though"}, {"owner": {"reputation": 6208, "user_id": 117554, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e42c998f86e664209d13833cd7228718?s=128&d=identicon&r=PG", "display_name": "goddamnyouryan", "link": "https://stackoverflow.com/users/117554/goddamnyouryan"}, "reply_to_user": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "edited": false, "score": 0, "creation_date": 1557253515, "post_id": 56013276, "comment_id": 98700495, "body": "@maxpleaner I like that, but I think it would only work in reverse, since <code>https:&#47;&#47;example.com&#47;pages&#47;*&#47;edit</code> will be what&#39;s stored in the db, and <code>https:&#47;&#47;example.com&#47;pages&#47;my-page&#47;edit</code> will be what I am searching with."}, {"owner": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "edited": false, "score": 0, "creation_date": 1557257229, "post_id": 56013276, "comment_id": 98702099, "body": "Oh I see, well in that case you can take a similar approach but rather than turning it into a LIKE query you can turn it into a regex."}, {"owner": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "edited": false, "score": 0, "creation_date": 1557257403, "post_id": 56013276, "comment_id": 98702165, "body": "Something like this <code>&quot;http:&#47;&#47;foo.com&quot;.match Regexp.new(Regexp.quote(&quot;http:&#47;&#47;*.com&quot;).gsub(&quot;\\\\*&quot;, &quot;.+&quot;))</code> If this works for you I can make an answer, however feel free to make your own answer upon solving if you like a well."}, {"owner": {"reputation": 6208, "user_id": 117554, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e42c998f86e664209d13833cd7228718?s=128&d=identicon&r=PG", "display_name": "goddamnyouryan", "link": "https://stackoverflow.com/users/117554/goddamnyouryan"}, "reply_to_user": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "edited": false, "score": 0, "creation_date": 1557265715, "post_id": 56013276, "comment_id": 98705301, "body": "@maxpleaner hmm, I&#39;d rather do it in a query as this will be pretty high volume! I&#39;ve added an answer with what I&#39;ve gone with thus far."}, {"owner": {"reputation": 6208, "user_id": 117554, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e42c998f86e664209d13833cd7228718?s=128&d=identicon&r=PG", "display_name": "goddamnyouryan", "link": "https://stackoverflow.com/users/117554/goddamnyouryan"}, "reply_to_user": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "edited": false, "score": 0, "creation_date": 1557265776, "post_id": 56013276, "comment_id": 98705323, "body": "@maxpleaner hmm, I&#39;d rather do it in a query as this will be pretty high volume! I&#39;ve added an answer with what I&#39;ve gone with thus far."}], "answers": [{"comments": [{"owner": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "edited": false, "score": 2, "creation_date": 1557269174, "post_id": 56030894, "comment_id": 98706175, "body": "awesome! You should probably be using parameterized interpolation instead. See <a href=\"https://stackoverflow.com/a/21886874/2981429\">stackoverflow.com/a/21886874/2981429</a>"}, {"owner": {"reputation": 6208, "user_id": 117554, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e42c998f86e664209d13833cd7228718?s=128&d=identicon&r=PG", "display_name": "goddamnyouryan", "link": "https://stackoverflow.com/users/117554/goddamnyouryan"}, "reply_to_user": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "edited": false, "score": 0, "creation_date": 1557430947, "post_id": 56030894, "comment_id": 98772906, "body": "@maxpleaner good call. I edited the question to include my version with parameterized interpolation. It has to be formatted a bit weirdly due to <code>find_by_sql</code> but I got it from here: <a href=\"https://devdocs.io/rails~4.2/activerecord/querying#method-i-find_by_sql\" rel=\"nofollow noreferrer\">devdocs.io/rails~4.2/activerecord/querying#method-i-find_by_&zwnj;&#8203;sql</a>"}, {"owner": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "edited": false, "score": 1, "creation_date": 1557432311, "post_id": 56030894, "comment_id": 98773469, "body": "There&#39;s also a lesser known way to pass parameters to <code>find_by_sql</code>. Instead of <code>?</code> use <code>:url</code> and instead of <code>url</code> as the second argument use a hash <code>{url: url}</code>. I prefer this approach because you don&#39;t have to keep track of the order of the arguments, since they are all <i>named</i>"}], "tags": [], "owner": {"reputation": 6208, "user_id": 117554, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e42c998f86e664209d13833cd7228718?s=128&d=identicon&r=PG", "display_name": "goddamnyouryan", "link": "https://stackoverflow.com/users/117554/goddamnyouryan"}, "is_accepted": true, "score": 1, "last_activity_date": 1557430987, "last_edit_date": 1557430987, "creation_date": 1557265677, "answer_id": 56030894, "question_id": 56013276, "link": "https://stackoverflow.com/questions/56013276/search-by-url-pattern/56030894#56030894", "title": "Search by URL pattern", "body": "<p>Ended up finding this answer: <a href=\"https://stackoverflow.com/a/3410431/117554\">https://stackoverflow.com/a/3410431/117554</a> which I adapted to rails like so:</p>\n\n<pre><code>Url.find_by_sql([\"\n  select * from urls\n  where ?\n  like replace(value, '*', '%')\n\", url]).first\n</code></pre>\n\n<p>Using the <code>replace</code> function from Postgres. Seems to be working thus far!</p>\n"}], "owner": {"reputation": 6208, "user_id": 117554, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e42c998f86e664209d13833cd7228718?s=128&d=identicon&r=PG", "display_name": "goddamnyouryan", "link": "https://stackoverflow.com/users/117554/goddamnyouryan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 56030894, "answer_count": 1, "score": 0, "last_activity_date": 1557430987, "creation_date": 1557182627, "question_id": 56013276, "link": "https://stackoverflow.com/questions/56013276/search-by-url-pattern", "title": "Search by URL pattern", "body": "<p>I am building a service where users installs a plugin across all of their pages on their site (such as by adding it to their template) but I only want to run the plugin code on a specific URL or pattern of URLs provided by the site owner.</p>\n\n<p>I would like to allow the site owner to be able to set a simple sort of URL pattern (for example, similar to how Cloudflare does it):</p>\n\n<p><a href=\"https://i.stack.imgur.com/71TrB.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/71TrB.png\" alt=\"enter image description here\"></a></p>\n\n<p>For example, The site owner could set a URL pattern as: <code>https://example.com/pages/*/edit</code></p>\n\n<p>And save this pattern in the db, like so:</p>\n\n<p><code>@url = Url.create string: 'https://example.com/pages/*/edit'</code></p>\n\n<p>Say then a user visits the url <code>https://example.com/pages/my-page/edit</code> I want to pass this back to my app and somehow find the previously created <code>@url</code> with that specific URL.</p>\n\n<p><code>Url.find_by_url 'https://example.com/pages/my-page/edit'</code></p>\n\n<p>Should then return the previously created <code>Url</code> record.</p>\n\n<p>How would you go about doing this?</p>\n"}, {"tags": ["ruby", "rbenv"], "answers": [{"comments": [{"owner": {"reputation": 4171, "user_id": 5066625, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/UdAmJ.jpg?s=128&g=1", "display_name": "Miroslav Glamuzina", "link": "https://stackoverflow.com/users/5066625/miroslav-glamuzina"}, "edited": false, "score": 0, "creation_date": 1557235387, "post_id": 56022092, "comment_id": 98690932, "body": "Welcome to Stack Overflow! Please read <a href=\"https://stackoverflow.com/about\">what this site is about</a> and &quot;<a href=\"https://stackoverflow.com/help/how-to-answer\">How to answer</a>&quot; before answering a question."}], "tags": [], "owner": {"reputation": 759, "user_id": 5266581, "user_type": "registered", "accept_rate": 87, "profile_image": "https://lh3.googleusercontent.com/-4WBTC_1yMB8/AAAAAAAAAAI/AAAAAAAAACI/pCGef6nYJik/photo.jpg?sz=128", "display_name": "Engr.Tanbir Hasan", "link": "https://stackoverflow.com/users/5266581/engr-tanbir-hasan"}, "is_accepted": false, "score": 0, "last_activity_date": 1557230248, "creation_date": 1557230248, "answer_id": 56022092, "question_id": 56012752, "link": "https://stackoverflow.com/questions/56012752/installing-ruby-using-rbenv-on-deepin-15-10/56022092#56022092", "title": "Installing Ruby using rbenv on Deepin 15.10", "body": "<p>Try this:</p>\n\n<pre><code>$ TMPDIR=~/tmp/ rbenv install 2.6.3\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7852, "user_id": 1097123, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/93d48a626680f755c5464741d9897e78?s=128&d=identicon&r=PG", "display_name": "kimbaudi", "link": "https://stackoverflow.com/users/1097123/kimbaudi"}, "edited": false, "score": 2, "creation_date": 1589511776, "post_id": 56027192, "comment_id": 109330407, "body": "I was also getting a similar <code>recipe for target &#39;do-install-all&#39; failed</code> error message when installing ruby 2.7.1 with rbenv. But after installing <code>libssl-dev</code>, I was successfully able to install ruby 2.7.1. thank you!"}], "tags": [], "owner": {"reputation": 51, "user_id": 11249849, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-euuQNT6BbZQ/AAAAAAAAAAI/AAAAAAAAofs/fL4-p6oo53Q/photo.jpg?sz=128", "display_name": "Gassan Abu Hirra", "link": "https://stackoverflow.com/users/11249849/gassan-abu-hirra"}, "is_accepted": true, "score": 5, "last_activity_date": 1557247822, "creation_date": 1557247822, "answer_id": 56027192, "question_id": 56012752, "link": "https://stackoverflow.com/questions/56012752/installing-ruby-using-rbenv-on-deepin-15-10/56027192#56027192", "title": "Installing Ruby using rbenv on Deepin 15.10", "body": "<p>FINALLY FIXED IT !!\nI had to use <code>brew unlink openssl</code>\nthen <code>sudo apt-get install -y libssl-dev zlib1g-dev</code>\nthen i tried <code>rbenv install 2.6.3</code> and IT WORKED !</p>\n"}], "owner": {"reputation": 51, "user_id": 11249849, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-euuQNT6BbZQ/AAAAAAAAAAI/AAAAAAAAofs/fL4-p6oo53Q/photo.jpg?sz=128", "display_name": "Gassan Abu Hirra", "link": "https://stackoverflow.com/users/11249849/gassan-abu-hirra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 533, "favorite_count": 0, "accepted_answer_id": 56027192, "answer_count": 2, "score": 0, "last_activity_date": 1557247822, "creation_date": 1557178691, "last_edit_date": 1557183865, "question_id": 56012752, "link": "https://stackoverflow.com/questions/56012752/installing-ruby-using-rbenv-on-deepin-15-10", "title": "Installing Ruby using rbenv on Deepin 15.10", "body": "<p>Trying to install Ruby using rbenv (or any other installer I tried RVM and ruby-install) fails and gives this error </p>\n\n<pre><code>$ rbenv install 2.6.3\n\n&gt; Downloading ruby-2.6.3.tar.bz2...\n-&gt; https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.3.tar.bz2\nInstalling ruby-2.6.3...\nruby-build: use readline from homebrew\n\nBUILD FAILED (Deepin 15.10 using ruby-build 20190423)\n\nInspect or clean up the working tree at /tmp/ruby-build.20190507002901.29361\nResults logged to /tmp/ruby-build.20190507002901.29361.log\n\nLast 10 log lines:\n    from /tmp/ruby-build.20190507002901.29361/ruby-2.6.3/lib/rubygems/package.rb:44:in `&lt;top (required)&gt;'\n    from /tmp/ruby-build.20190507002901.29361/ruby-2.6.3/lib/rubygems/core_ext/kernel_require.rb:54:in `require'\n    from /tmp/ruby-build.20190507002901.29361/ruby-2.6.3/lib/rubygems/core_ext/kernel_require.rb:54:in `require'\n    from /tmp/ruby-build.20190507002901.29361/ruby-2.6.3/lib/rubygems/installer.rb:11:in `&lt;top (required)&gt;'\n    from /tmp/ruby-build.20190507002901.29361/ruby-2.6.3/lib/rubygems/core_ext/kernel_require.rb:54:in `require'\n    from /tmp/ruby-build.20190507002901.29361/ruby-2.6.3/lib/rubygems/core_ext/kernel_require.rb:54:in `require'\n    from ./tool/rbinstall.rb:703:in `&lt;module:RbInstall&gt;'\n    from ./tool/rbinstall.rb:639:in `&lt;main&gt;'\nuncommon.mk:364: recipe for target 'do-install-all' failed\nmake: *** [do-install-all] Error 1\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-5", "cocoon-gem"], "comments": [{"owner": {"reputation": 1266, "user_id": 7619578, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c4b8b0d6308975901d498601dc6ffc7f?s=128&d=identicon&r=PG&f=1", "display_name": "Int&#39;l Man Of Coding Mystery", "link": "https://stackoverflow.com/users/7619578/intl-man-of-coding-mystery"}, "edited": false, "score": 0, "creation_date": 1557214905, "post_id": 56012153, "comment_id": 98679403, "body": "I know it&#39;s not helpful, but sometimes I find the nested attributes doesn&#39;t work. But only <i>sometimes</i>. So I create helper methods to loop through and create the associated records the long way. I keep with <code>fields_for</code> and all but sometimes, it just doesn&#39;t work for me :("}, {"owner": {"reputation": 11, "user_id": 10858240, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-sHXqjsGS5dc/AAAAAAAAAAI/AAAAAAAAldo/sOZvtdb4n0k/photo.jpg?sz=128", "display_name": "Jonas Lucena", "link": "https://stackoverflow.com/users/10858240/jonas-lucena"}, "reply_to_user": {"reputation": 1266, "user_id": 7619578, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c4b8b0d6308975901d498601dc6ffc7f?s=128&d=identicon&r=PG&f=1", "display_name": "Int&#39;l Man Of Coding Mystery", "link": "https://stackoverflow.com/users/7619578/intl-man-of-coding-mystery"}, "edited": false, "score": 1, "creation_date": 1557241799, "post_id": 56012153, "comment_id": 98694922, "body": "Many thanks @MikeHeft I&#39;m still hopeful for a solution, I think it may exist. ;)"}, {"owner": {"reputation": 48004, "user_id": 216513, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/30a45c64b2ef288f7ec098c5fb353a22?s=128&d=identicon&r=PG", "display_name": "nathanvda", "link": "https://stackoverflow.com/users/216513/nathanvda"}, "edited": false, "score": 0, "creation_date": 1557348180, "post_id": 56012153, "comment_id": 98738998, "body": "Please explain: if you say &quot;add a register&quot;, do you mean saving a record? Could you show the logfile, the form redirections should not be caused by the &quot;build&quot; (it just pre-creates data), and the logfile hopefully show us some more information why the records would not be saved? I am curious how the params are posted, the strong params definition has to be matching correctly."}, {"owner": {"reputation": 11, "user_id": 10858240, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-sHXqjsGS5dc/AAAAAAAAAAI/AAAAAAAAldo/sOZvtdb4n0k/photo.jpg?sz=128", "display_name": "Jonas Lucena", "link": "https://stackoverflow.com/users/10858240/jonas-lucena"}, "reply_to_user": {"reputation": 48004, "user_id": 216513, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/30a45c64b2ef288f7ec098c5fb353a22?s=128&d=identicon&r=PG", "display_name": "nathanvda", "link": "https://stackoverflow.com/users/216513/nathanvda"}, "edited": false, "score": 0, "creation_date": 1557455483, "post_id": 56012153, "comment_id": 98779055, "body": "Hi, @nathanvda thanks a lot for help me.  Firstly I\u2019d like to say that I\u2019m a beginner on web development, I think is perceptible :)  So, I did a gist if you could check out, this is the link   <a href=\"https://gist.github.com/jonaslucena/b7f44bd17d5b3f35705aa94633a1ef31\" rel=\"nofollow noreferrer\">gist.github.com/jonaslucena/b7f44bd17d5b3f35705aa94633a1ef31</a>  About your questions, sorry for my poor English, I\u2019ll try answer better.  Yes I\u2019m trying to say \u201csave a new record\u201d. About the log file I just can send tomorrow, ok?  I appreciate your support, thanks a lot! Best regards"}, {"owner": {"reputation": 48004, "user_id": 216513, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/30a45c64b2ef288f7ec098c5fb353a22?s=128&d=identicon&r=PG", "display_name": "nathanvda", "link": "https://stackoverflow.com/users/216513/nathanvda"}, "edited": false, "score": 0, "creation_date": 1557477695, "post_id": 56012153, "comment_id": 98786210, "body": "The code all looks fine to me (but it is a lot, so I could of course overlook errors). The only things I can think of: failing validations or strong parameters blocking parameters. I am looking forward to seeing the logfile. Otherwise if you have a github-repo that would reproduce this problem, I will take a look."}, {"owner": {"reputation": 11, "user_id": 10858240, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-sHXqjsGS5dc/AAAAAAAAAAI/AAAAAAAAldo/sOZvtdb4n0k/photo.jpg?sz=128", "display_name": "Jonas Lucena", "link": "https://stackoverflow.com/users/10858240/jonas-lucena"}, "reply_to_user": {"reputation": 48004, "user_id": 216513, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/30a45c64b2ef288f7ec098c5fb353a22?s=128&d=identicon&r=PG", "display_name": "nathanvda", "link": "https://stackoverflow.com/users/216513/nathanvda"}, "edited": false, "score": 0, "creation_date": 1557493217, "post_id": 56012153, "comment_id": 98794423, "body": "Hi @nathanvda, I shared a github-repo with you, thanks again!"}, {"owner": {"reputation": 48004, "user_id": 216513, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/30a45c64b2ef288f7ec098c5fb353a22?s=128&d=identicon&r=PG", "display_name": "nathanvda", "link": "https://stackoverflow.com/users/216513/nathanvda"}, "edited": false, "score": 0, "creation_date": 1557577880, "post_id": 56012153, "comment_id": 98817276, "body": "You should check the your HTML: if a surrounding div of a form is closed, the form is also closed. You are using ERB, so this allows you to write incorrect HTML, but the browser will not always work equally wel. So move your form tag to the highest, containing surrounding level."}, {"owner": {"reputation": 48004, "user_id": 216513, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/30a45c64b2ef288f7ec098c5fb353a22?s=128&d=identicon&r=PG", "display_name": "nathanvda", "link": "https://stackoverflow.com/users/216513/nathanvda"}, "edited": false, "score": 0, "creation_date": 1557763584, "post_id": 56012153, "comment_id": 98865667, "body": "Was this clear for you?"}, {"owner": {"reputation": 11, "user_id": 10858240, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-sHXqjsGS5dc/AAAAAAAAAAI/AAAAAAAAldo/sOZvtdb4n0k/photo.jpg?sz=128", "display_name": "Jonas Lucena", "link": "https://stackoverflow.com/users/10858240/jonas-lucena"}, "edited": false, "score": 0, "creation_date": 1557854236, "post_id": 56012153, "comment_id": 98902039, "body": "Yes, thank so much for helping me, I understood that you said. I&#39;ll start to learn about slim, try to improve my code and try to minimize the mistakes that I did. Once again, thank very much!"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 10858240, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-sHXqjsGS5dc/AAAAAAAAAAI/AAAAAAAAldo/sOZvtdb4n0k/photo.jpg?sz=128", "display_name": "Jonas Lucena", "link": "https://stackoverflow.com/users/10858240/jonas-lucena"}, "edited": false, "score": 0, "creation_date": 1557768479, "post_id": 56091799, "comment_id": 98867660, "body": "Many thanks for your help, I&#39;ll start to learn about slim and haml, thanks for advice too.  Best regards o/"}], "tags": [], "owner": {"reputation": 48004, "user_id": 216513, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/30a45c64b2ef288f7ec098c5fb353a22?s=128&d=identicon&r=PG", "display_name": "nathanvda", "link": "https://stackoverflow.com/users/216513/nathanvda"}, "is_accepted": false, "score": 0, "last_activity_date": 1557588983, "creation_date": 1557588983, "answer_id": 56091799, "question_id": 56012153, "link": "https://stackoverflow.com/questions/56012153/how-to-use-nested-forms-with-different-relations-using-the-cocoon-gem/56091799#56091799", "title": "How to use nested forms with different relations using the cocoon gem?", "body": "<p>Ok, so there were two main errors I encountered: </p>\n\n<ul>\n<li>your form tag was inside a div, but your form content spanned multiple divs. It will look correct but will not post the correct info in all cases</li>\n<li>secondly: you did have validations blocking the save, in my case, and then two things happened:\n\n<ul>\n<li>you did not set <code>@credit_packages</code> in your <code>create</code> action, giving an error when rerendering the form</li>\n<li>you did not show any validation-error (so no feedback as to why the save failed)</li>\n</ul></li>\n</ul>\n\n<p>So I did two things. In your <code>dealerships_controller</code> I edited the following line </p>\n\n<pre><code>before_action :get_credit_packages, only: [:edit, :update, :new, :create] \n</code></pre>\n\n<p>(also set credit packages on create) </p>\n\n<p>And your <code>_form.html.erb</code> I moved the <code>form_with</code> directly under the <code>row</code> div, and added some rudimentary display of the validation errors. The <code>row</code> div was never closed. Your full form: </p>\n\n<pre><code>&lt;!-- Page Heading --&gt;\n&lt;h1 class=\"h3 mb-4 text-gray-800\"&gt;&lt;%= action_message %&gt;&lt;/h1&gt;\n&lt;div class=\"row\"&gt;\n  &lt;%= form_with(model: [ :users_backend, @dealership], local: true) do |form| %&gt;\n\n    &lt;p&gt;\n      &lt;%= @dealership.errors.messages.inspect %&gt;\n    &lt;/p&gt;\n\n\n    &lt;div class=\"col-lg-6\"&gt; &lt;!-- card Dealerships Information--&gt;\n      &lt;div class=\"card border-left-danger shadow mb-4\"&gt;\n        &lt;a href=\"#collapseCardDealershipInformation\" class=\"d-block card-header py-3\" data-toggle=\"collapse\" role=\"button\" aria-expanded=\"true\" aria-controls=\"collapseCardDealershipInformation\"&gt;&lt;h6 class=\"m-0 font-weight-bold text-primary\"&gt;&lt;%= t('labels.dealership_information') %&gt;&lt;/h6&gt;&lt;/a&gt;\n        &lt;div class=\"collapse show\" id=\"collapseCardDealershipInformation\"&gt; &lt;!-- card Content - Collapse --&gt;\n          &lt;div class=\"card-body\"&gt;\n            &lt;div class=\"form-group\"&gt;\n              &lt;strong&gt;&lt;%= form.label :fantasy_name %&gt;&lt;/strong&gt;\n              &lt;%= form.text_field :fantasy_name, autofocus: true, class:\"text-uppercase form-control\", placeholder:t('place_holders.fantasy_name') %&gt;\n            &lt;/div&gt;\n\n            &lt;div class=\"form-group\"&gt;\n              &lt;strong&gt;&lt;%= form.label :social_name %&gt;&lt;/strong&gt;\n              &lt;%= form.text_field :social_name, class:\"text-uppercase form-control\", placeholder:t('place_holders.social_name') %&gt;\n            &lt;/div&gt;\n\n            &lt;div class=\"form-group row\"&gt;\n              &lt;div class=\"col-md-6\"&gt;\n                &lt;strong&gt;&lt;%= form.label :phone %&gt;&lt;/strong&gt;\n                &lt;%= form.text_field :phone, class:\"form-control\", placeholder:t('place_holders.phone') %&gt;\n              &lt;/div&gt;\n              &lt;div class=\"col-md-6\"&gt;\n                &lt;strong&gt;&lt;%= form.label :manager_email %&gt;&lt;/strong&gt;\n                &lt;%= form.text_field :manager_email, class:\"text-downcase form-control\", placeholder:t('place_holders.manager_email') %&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n\n            &lt;div class=\"form-group row\"&gt;\n              &lt;div class=\"col-md-6\"&gt;\n                &lt;strong&gt;&lt;%= form.label :cpf %&gt;&lt;/strong&gt;\n                &lt;%= form.text_field :cpf, class:\"form-control\", placeholder:t('place_holders.cpf') %&gt;\n              &lt;/div&gt;\n              &lt;div class=\"col-md-6\"&gt;\n                &lt;strong&gt;&lt;%= form.label :cnpj %&gt;&lt;/strong&gt;\n                &lt;%= form.text_field :cnpj, class:\"form-control\", placeholder:t('place_holders.cnpj') %&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n\n            &lt;div class=\"form-group row\"&gt;\n              &lt;div class=\"col-md-6\"&gt;\n                &lt;strong&gt;&lt;%= form.label :municipal_registration %&gt;&lt;/strong&gt;\n                &lt;%= form.text_field :municipal_registration, class:\"form-control form-control-user\", placeholder:t('place_holders.municipal_registration') %&gt;\n              &lt;/div&gt;\n              &lt;div class=\"col-md-6\"&gt;\n                &lt;strong&gt;&lt;%= form.label :state_registration %&gt;&lt;/strong&gt;\n                &lt;%= form.text_field :state_registration, class:\"form-control form-control-user\", placeholder:t('place_holders.state_registration') %&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n\n            &lt;div class=\"form-group\"&gt;\n              &lt;strong&gt;&lt;%= form.label :credits_package %&gt;&lt;/strong&gt;\n              &lt;%= form.collection_select(:credits_package_id, @credit_packages, :id, :name, {:prompt =&gt; t('prompt.credits_package')}, { class:\"form-control\" }) %&gt;\n            &lt;/div&gt;\n\n            &lt;div class=\"form-group custom-control custom-checkbox small \"&gt;\n              &lt;%= form.check_box :is_available, class:\"custom-control-input\" %&gt;\n              &lt;%= form.label :is_available, class:\"custom-control-label\" %&gt;\n            &lt;/div&gt;\n\n          &lt;/div&gt; &lt;!-- .card-body--&gt;\n        &lt;/div&gt;&lt;!-- . card Content - Collapse --&gt;\n      &lt;/div&gt; &lt;!-- .mb4--&gt;\n    &lt;/div&gt; &lt;!-- .Dealerships Information (lg-6) --&gt;\n\n    &lt;div class=\"col-lg-6\"&gt; &lt;!-- card Financial Settings --&gt;\n      &lt;div class=\"card border-left-danger shadow mb-4\"&gt;\n        &lt;a href=\"#collapseCardDealershipFinancialSettings\" class=\"d-block card-header py-3\" data-toggle=\"collapse\" role=\"button\" aria-expanded=\"true\" aria-controls=\"collapseCardDealershipFinancialSettings\"&gt;&lt;h6 class=\"m-0 font-weight-bold text-primary\"&gt;&lt;%= t('labels.financial_settings') %&gt;&lt;/h6&gt;&lt;/a&gt;\n          &lt;div class=\"collapse show\" id=\"collapseCardDealershipFinancialSettings\"&gt;\n            &lt;div class=\"card-body\"&gt;\n              &lt;%= form.fields_for :dealerships_setting, @dealership.dealerships_setting do |dealerships_setting| %&gt;\n                &lt;%= render partial: 'dealerships_setting_fields', locals: { f: dealerships_setting } %&gt;\n              &lt;% end %&gt;\n            &lt;/div&gt; &lt;!--card-body --&gt;\n          &lt;/div&gt; &lt;!--collapse card dealership Financial settings --&gt;\n      &lt;/div&gt;&lt;!--mb-4 --&gt;\n    &lt;/div&gt; &lt;!-- .Financial Settings (lg-6) --&gt;\n\n    &lt;div class=\"col-lg-12\"&gt; &lt;!-- card Addresses --&gt;\n      &lt;div class=\"card border-left-danger shadow mb-4\"&gt;\n        &lt;a href=\"#collapseCardAddressess\" class=\"d-block card-header py-3\" data-toggle=\"collapse\" role=\"button\" aria-expanded=\"true\" aria-controls=\"collapseCardAddressess\"&gt;&lt;h6 class=\"m-0 font-weight-bold text-primary\"&gt;&lt;%= t('labels.addresses') %&gt;&lt;/h6&gt;&lt;/a&gt;\n          &lt;div class=\"collapse show\" id=\"collapseCardAddressess\"&gt;\n            &lt;div class=\"card-body\"&gt;\n              &lt;div id=\"addresses\"&gt;\n                &lt;%= form.fields_for :addresses do |address| %&gt;\n                  &lt;%= render partial: 'address_fields', locals: { f: address } %&gt;\n                &lt;% end %&gt;\n                &lt;%= link_to_add_association('Adicionar endere\u00e7o', form, :addresses) %&gt;\n              &lt;/div&gt; &lt;!--  addresses --&gt;\n            &lt;/div&gt; &lt;!--card-body --&gt;\n          &lt;/div&gt; &lt;!--collapse card dealership Addressess --&gt;\n      &lt;/div&gt; &lt;!-- mb-4 --&gt;\n    &lt;/div&gt;  &lt;!--col-lg-12 --&gt;\n\n    &lt;div class=\"col-lg-12\"&gt; &lt;!-- card Machines--&gt;\n      &lt;div class=\"card border-left-warning shadow mb-4\"&gt;\n        &lt;a href=\"#collapseCardDealershipMachines\" class=\"d-block card-header py-3\" data-toggle=\"collapse\" role=\"button\" aria-expanded=\"true\" aria-controls=\"collapseCardDealershipMachines\"&gt;&lt;h6 class=\"m-0 font-weight-bold text-primary\"&gt;&lt;%= t('labels.machines') %&gt;&lt;/h6&gt;&lt;/a&gt;\n          &lt;div class=\"collapse show\" id=\"collapseCardDealershipMachines\"&gt;\n            &lt;div class=\"card-body\"&gt;\n              &lt;div id=\"machines\"&gt;\n                &lt;%= form.fields_for :machines do |machine| %&gt;\n                  &lt;%= render partial: 'machine_fields', locals: { f: machine } %&gt;\n                &lt;% end %&gt;\n                &lt;%= link_to_add_association('Adicionar equipamento', form, :machines) %&gt;\n              &lt;/div&gt; &lt;!-- machines --&gt;\n            &lt;/div&gt; &lt;!--card-body --&gt;\n          &lt;/div&gt; &lt;!--collapse card machines --&gt;\n      &lt;/div&gt;&lt;!--mb-4 --&gt;\n    &lt;/div&gt;  &lt;!--col-lg-12 --&gt;\n\n    &lt;div class=\"col-lg-6\"&gt; &lt;!-- card Operators--&gt;\n      &lt;div class=\"card border-left-warning shadow mb-4\"&gt;\n        &lt;a href=\"#collapseCardDealershipOperators\" class=\"d-block card-header py-3\" data-toggle=\"collapse\" role=\"button\" aria-expanded=\"true\" aria-controls=\"collapseCardDealershipOperators\"&gt;&lt;h6 class=\"m-0 font-weight-bold text-primary\"&gt;&lt;%= t('labels.operators') %&gt;&lt;/h6&gt;&lt;/a&gt;\n          &lt;div class=\"collapse show\" id=\"collapseCardDealershipOperators\"&gt;\n            &lt;div class=\"card-body\"&gt;\n              &lt;div id=\"operators\"&gt;\n                &lt;%= form.fields_for :operators do |operator| %&gt;\n                  &lt;%= render partial: 'operator_fields', locals: { f: operator } %&gt;\n                &lt;% end %&gt;\n                &lt;%= link_to_add_association('Adicionar operador', form, :operators) %&gt;\n              &lt;/div&gt; &lt;!-- operators --&gt;\n            &lt;/div&gt; &lt;!--card-body --&gt;\n          &lt;/div&gt; &lt;!--collapse card dealership settings information --&gt;\n      &lt;/div&gt;&lt;!--mb-4 --&gt;\n    &lt;/div&gt;  &lt;!--.Operators (lg-6) --&gt;\n\n    &lt;div class=\"col-lg-6\"&gt; &lt;!-- Card Cards =) --&gt;\n      &lt;div class=\"card border-left-warning shadow mb-4\"&gt;\n        &lt;a href=\"#collapseCardDealershipCards\" class=\"d-block card-header py-3\" data-toggle=\"collapse\" role=\"button\" aria-expanded=\"true\" aria-controls=\"collapseCardDealershipCards\"&gt;&lt;h6 class=\"m-0 font-weight-bold text-primary\"&gt;&lt;%= t('labels.cards') %&gt;&lt;/h6&gt;&lt;/a&gt;\n        &lt;div class=\"collapse show\" id=\"collapseCardDealershipCards\"&gt;\n          &lt;div class=\"card-body\"&gt;\n            &lt;div id=\"cards\"&gt;\n              &lt;%= form.fields_for :cards do |c| %&gt;\n                &lt;%= render partial: 'card_fields', locals: { f: c } %&gt;\n              &lt;% end %&gt;\n              &lt;%= link_to_add_association('Adicionar cart\u00e3o', form, :cards) %&gt;\n            &lt;/div&gt; &lt;!-- cards --&gt;\n          &lt;/div&gt; &lt;!--card-body --&gt;\n        &lt;/div&gt; &lt;!--collapse card dealership cards --&gt;\n      &lt;/div&gt;&lt;!--mb-4 --&gt;\n    &lt;/div&gt;  &lt;!--.Cards --&gt;\n\n    &lt;div class=\"actions\"&gt;\n      &lt;div class=\"col-sm-4 mb-3 mb-sm-0 \"&gt;\n        &lt;%= form.submit t('buttons.save'), class:\"btn btn-success btn-user\"%&gt;\n      &lt;/div&gt;\n    &lt;/div&gt; &lt;!-- actions --&gt;\n\n  &lt;% end %&gt;\n&lt;/div&gt;\n</code></pre>\n\n<p>And then I was able to save a dealership. The layout is now broken for some reason I do not understand, but I will let you fix that (the css class does not behave how I expect it?). </p>\n\n<p>Note: this is one of the reasons I prefer (or advice) to use a library like haml, slim, .. because your view-code will be easier to read/maintain and will be correct.  </p>\n"}], "owner": {"reputation": 11, "user_id": 10858240, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-sHXqjsGS5dc/AAAAAAAAAAI/AAAAAAAAldo/sOZvtdb4n0k/photo.jpg?sz=128", "display_name": "Jonas Lucena", "link": "https://stackoverflow.com/users/10858240/jonas-lucena"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 549, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1557588983, "creation_date": 1557175348, "last_edit_date": 1557273813, "question_id": 56012153, "link": "https://stackoverflow.com/questions/56012153/how-to-use-nested-forms-with-different-relations-using-the-cocoon-gem", "title": "How to use nested forms with different relations using the cocoon gem?", "body": "<p>My dilemma has been around for a week now, I am trying to solve it but so far I have not been able to, so I am asking for help.</p>\n\n<p>I have a Model Dealership and others nested (DealershipsSetting, Address, Machines, Operators, Cards) where the has_one relation only applies to DealershipsSetting, so the others are has_many.\nI can only write some information in the database tables, when I call the build method for each model of the nested forms, for example:</p>\n\n<pre><code>  def new\n\u00a0\u00a0\u00a0\u00a0@dealership = Dealership.new\n\u00a0\u00a0\u00a0\u00a0@ dealership.build_dealerships_setting if @ dealership.dealerships_setting.blank?\n\u00a0\u00a0\u00a0\u00a0@ dealership.addresses.build if @ dealership.addresses.blank?\n...\n\u00a0\u00a0end\n\n\u00a0\u00a0def edit\n\u00a0\u00a0\u00a0\u00a0@ dealership.build_dealerships_setting if @ dealership.dealerships_setting.blank?\n\u00a0\u00a0\u00a0\u00a0@ dealership.addresses.build if @ dealership.addresses.blank?\n...\n\u00a0\u00a0end\n</code></pre>\n\n<p>I realize:</p>\n\n<p>a) The first thing I notice in the log is that the forms are redirected several times. It makes sense since I'm forcing them to build through the builds call (at least that's what I understand about it). But this is not the default behavior when using the gem, I tested in another application just to know how to use the gem by following the documentation <a href=\"https://github.com/nathanvda/cocoon\" rel=\"nofollow noreferrer\">https://github.com/nathanvda/cocoon</a></p>\n\n<p>b) Due to the call of the build method, the forms come open (ready to receive the data), I do not know if it is the default behavior.</p>\n\n<p>c) When I call Action New or Edit, I can not record more than one record (type, 2 addresses, 3 cards or N operators)</p>\n\n<p>d) In the documentation I did not notice any call to the build method, I found in the searches to try to solve my problem, for example, <a href=\"https://share.atelie.software/rails-nested-attributes-com-has-many-42ecf6179871\" rel=\"nofollow noreferrer\">https://share.atelie.software/rails-nested-attributes-com-has-many-42ecf6179871</a></p>\n\n<p>e) If I remove the calls from the builds, following the examples available in the documentation, the fields appear hidden until you call through the link_to_add_association, but no data, from the nested forms, is saved.</p>\n\n<p>When I set my dealerships_controller like this, I can't add any register in the database:</p>\n\n<pre><code>def new    \n   @dealership = Dealership.new        \nend\n...\ndef create\n   @dealership = Dealership.new(dealership_params)\n\n   respond_to do |format|\n     if @dealership.save\n        format.html { redirect_to users_backend_dealerships_path, notice: 'Dealership was successfully created.' }\n        format.json { render :show, status: :created, location: @dealership }\n     else\n        format.html { render :new }\n        format.json { render json: @dealership.errors, status: :unprocessable_entity }\n     end\n   end\n end\n....\n\ndef dealership_params\n  params.require(:dealership).permit(\n:fantasy_name, :social_name, :cpf, :cnpj, :municipal_registration, :state_registration, :credit, :phone, :manager_email, :is_available, :credits_package_id, dealerships_setting_attributes: [:id, :credit_alert, :contract_validity, :franchise_for_rent, :due_date, :credit_value, :is_available, :_destroy],addresses_attributes: [:id, :place, :neighborhood, :cep, :state, :city, :is_available, :_destroy], machines_attributes: [:id, :name, :model, :serial_number, :mac_address, :calibration_counter, :is_available, :_destroy], operators_attributes: [:id, :name, :cpf, :card, :is_available, :_destroy ], cards_attributes: [:id, :serial, :category, :credit_package, :client, :machine, :operator, :is_available, :_destroy ])\nend\n</code></pre>\n\n<p>Like this, I can add one register by model in the database.</p>\n\n<p>dealerships_controller</p>\n\n<pre><code>class UsersBackend :: DealershipsController &lt;UsersBackendController\n\u00a0\u00a0before_action: set_dealership, only: [: show,: edit,: update,: destroy]\n\u00a0\u00a0before_action: get_credit_packages, only: [: edit,: update,: new]\n\u00a0\n def index\n    @dealerships = Dealership.includes(:dealerships_setting, :addresses, :machines, :operators, :cards)\n  end\n\n  def show\n  end\n\n  def add_credits\n  end\n\n  def new\n    @dealership = Dealership.new        \n    @dealership.build_dealerships_setting if @dealership.dealerships_setting.blank?\n    @dealership.addresses.build if @dealership.addresses.blank?\n    @dealership.machines.build if @dealership.machines.blank?\n    @dealership.operators.build if @dealership.operators.blank?\n    @dealership.cards.build if @dealership.cards.blank?\n  end\n\n  def edit\n    @dealership.build_dealerships_setting if @dealership.dealerships_setting.blank?\n    @dealership.addresses.build if @dealership.addresses.blank?\n    @dealership.machines.build if @dealership.machines.blank?\n    @dealership.operators.build if @dealership.operators.blank?\n    @dealership.cards.build if @dealership.cards.blank?\n  end\n\n  def create\n    @dealership = Dealership.new(dealership_params)\n\n    respond_to do |format|\n      if @dealership.save\n        format.html { redirect_to users_backend_dealerships_path, notice: 'Dealership was successfully created.' }\n        format.json { render :show, status: :created, location: @dealership }\n      else\n        format.html { render :new }\n        format.json { render json: @dealership.errors, status: :unprocessable_entity }\n      end\n    end\n  end\n\n  def update\n    respond_to do |format|\n      if @dealership.update(dealership_params)\n        format.html { redirect_to users_backend_dealerships_path, notice: 'Dealership was successfully updated.' }\n        format.json { render :show, status: :ok, location: @dealership }\n      else\n        format.html { render :edit }\n        format.json { render json: @dealership.errors, status: :unprocessable_entity }\n      end\n    end\n  end\n\ndef destroy\n    @dealership.destroy\n    respond_to do |format|\n      format.html { redirect_to users_backend_dealerships_path, notice: 'Dealership was successfully destroyed.' }\n      format.json { head :no_content }\n    end\n  end\n\n  private\n\n    def set_dealership\n      @dealership = Dealership.find(params[:id])\n    end\n\n    def dealership_params\n      params.require(:dealership).permit(:fantasy_name, :social_name, :cpf, :cnpj, :municipal_registration, :state_registration, :credit, :phone, :manager_email, :is_available, :credits_package_id,\n        dealerships_setting_attributes: [:id, :credit_alert, :contract_validity, :franchise_for_rent, :due_date, :credit_value, :is_available, :_destroy],\n        addresses_attributes: [:id, :place, :neighborhood, :cep, :state, :city, :is_available, :_destroy],\n        machines_attributes: [:id, :name, :model, :serial_number, :mac_address, :calibration_counter, :is_available, :_destroy], \n        operators_attributes: [:id, :name, :cpf, :card, :is_available, :_destroy ],\n        cards_attributes: [:id, :serial, :category, :credit_package, :client, :machine, :operator, :is_available, :_destroy ]\n        )\n    end\n\n    def get_credit_packages\n      @credit_packages = CreditsPackage.where(media_owner: 0)\n    end\nend\n</code></pre>\n\n<p>model  dealership.rb</p>\n\n<pre><code>class Dealership &lt; ApplicationRecord\n\n  has_many :credits_packages\n\n  has_one :dealerships_setting, dependent: :destroy, inverse_of: :dealership\n\n  has_many :addresses, dependent: :destroy, inverse_of: :dealership\n  has_many :machines, dependent: :destroy, inverse_of: :dealership\n  has_many :operators, dependent: :destroy, inverse_of: :dealership\n  has_many :cards, dependent: :destroy, inverse_of: :dealership\n\n\n  accepts_nested_attributes_for :dealerships_setting, reject_if: :all_blank, allow_destroy: true\n\n  accepts_nested_attributes_for :addresses, reject_if: :all_blank, allow_destroy: true\n  accepts_nested_attributes_for :machines, reject_if: :all_blank, allow_destroy: true\n  accepts_nested_attributes_for :operators, reject_if: :all_blank, allow_destroy: true\n  accepts_nested_attributes_for :cards, reject_if: :all_blank, allow_destroy: true\n\n  accepts_nested_attributes_for :users, reject_if: :all_blank, allow_destroy: true\nend\n</code></pre>\n\n<p>model dealerships_setting</p>\n\n<pre><code>class DealershipsSetting &lt; ApplicationRecord\n  belongs_to :dealership, inverse_of: :dealerships_setting\nend\n</code></pre>\n\n<p>model address.rb</p>\n\n<pre><code>class Address &lt; ApplicationRecord\n  belongs_to :dealership\nend\n</code></pre>\n\n<p>form.html.erb (dealership)</p>\n\n<pre><code>&lt;%= form_with(model: [ :users_backend, @dealership], local: true) do |form| %&gt;\n     &lt;div class=\"form-group\"&gt;\n          &lt;strong&gt;&lt;%= form.label :fantasy_name %&gt;&lt;/strong&gt;\n               &lt;%= form.text_field :fantasy_name, autofocus: true, class:\"text-uppercase form-control\", placeholder:t('place_holders.fantasy_name') %&gt;\n     &lt;/div&gt;\n...\n\n&lt;%= form.fields_for :dealerships_setting, @dealership.dealerships_setting do |dealerships_setting| %&gt;\n     &lt;%= render partial: 'dealerships_setting_fields', locals: { f: dealerships_setting } %&gt;\n  &lt;% end %&gt;\n\n&lt;div id=\"addresses\"&gt; \n    &lt;%= form.fields_for :addresses do |address| %&gt; \n&lt;%= render partial: 'address_fields', locals: { f: address } %&gt;\n    &lt;% end %&gt;\n    &lt;%= link_to_add_association('Add address', form, :addresses) %&gt;\n &lt;/div&gt; \n....others nested forms...\n</code></pre>\n\n<p>_dealerships_setting_fields.html.erb</p>\n\n<pre><code>&lt;div class=\"nested-fields\"&gt;\n  &lt;div class=\"form-group\"&gt;\n    &lt;strong&gt;&lt;%= f.label :contract_validity %&gt;&lt;/strong&gt;\n    &lt;%= f.text_field :contract_validity, class:\"form-control \", placeholder:t('place_holders.contract_validity') %&gt;\n  &lt;/div&gt; ...another fields...\n</code></pre>\n\n<p>_address_fields.html.erb</p>\n\n<pre><code>&lt;div class='nested-fields'&gt;\n  &lt;div class='form-group'&gt;\n    &lt;strong&gt;&lt;%= f.label :place %&gt;&lt;/strong&gt;\n    &lt;%= f.text_field :place, class:\"text-uppercase form-control\", placeholder:t('place_holders.place') %&gt;\n  &lt;/div&gt; ...another fields...\n</code></pre>\n\n<p>What do I need?\nA - Manage dealerships, where they must have one configuration and one or more addresses, machines, operators and cards.</p>\n\n<p>I will be very grateful to anyone who can help me.</p>\n"}, {"tags": ["ruby-on-rails", "ruby"], "answers": [{"tags": [], "owner": {"reputation": 4600, "user_id": 5961578, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/df7cbfdd2a92a7926af3bbb8648318aa?s=128&d=identicon&r=PG", "display_name": "moveson", "link": "https://stackoverflow.com/users/5961578/moveson"}, "is_accepted": false, "score": 0, "last_activity_date": 1557173841, "last_edit_date": 1557173841, "creation_date": 1557173463, "answer_id": 56011775, "question_id": 56011692, "link": "https://stackoverflow.com/questions/56011692/how-can-i-store-a-regex-expression-string-in-a-helper-method-to-use-to-validate/56011775#56011775", "title": "How can I store a regex expression string in a helper method to use to validate several different fields?", "body": "<p>One way to do this is to create a concern that will be included in each model that has a phone number. In <code>models/concerns</code>, create a new file called something like <code>phonable.rb</code>.</p>\n\n<pre><code># models/concerns/phonable.rb\n\nmodule Phonable\n  extend ActiveSupport::Concern\n\n  VALID_PHONE_REGEX = /\\A\\+?\\d+\\z/ # Use your regex here\n\nend\n</code></pre>\n\n<p>Now include the concern like this:</p>\n\n<pre><code># models/my_model.rb\n\nclass MyModel &lt; ApplicationRecord\n  include Phonable\n\n  validates :phone, format: {with: VALID_PHONE_REGEX}\n  ...\n\nend\n</code></pre>\n\n<p>Now that you have a <code>Phonable</code> concern, you can put any other phone-number-related logic here as well, such as parsing and the like. The advantage of this approach is that all your logic related to phone numbers will be available for use in the models that need it, and none of that logic will be available in models that don't need it. </p>\n"}, {"comments": [{"owner": {"reputation": 137, "user_id": 4339194, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh3.googleusercontent.com/-nFaWBLxZTfM/AAAAAAAAAAI/AAAAAAAAAR4/6B_T5aOc3Tc/photo.jpg?sz=128", "display_name": "Brian Tatum", "link": "https://stackoverflow.com/users/4339194/brian-tatum"}, "edited": false, "score": 0, "creation_date": 1557247654, "post_id": 56011862, "comment_id": 98697933, "body": "While there are several good solutions here, I used this one because I use this same regex string to reformat my phone numbers using the capture method before the record saves. This solution allow me to use the same constant in the format validation and the reformate function. If you are using a regex string just to validate format then I would recommend the custom validator from engineersmnky."}], "tags": [], "owner": {"reputation": 23016, "user_id": 2981429, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZcCXx.jpg?s=128&g=1", "display_name": "max pleaner", "link": "https://stackoverflow.com/users/2981429/max-pleaner"}, "is_accepted": true, "score": 1, "last_activity_date": 1557173842, "creation_date": 1557173842, "answer_id": 56011862, "question_id": 56011692, "link": "https://stackoverflow.com/questions/56011692/how-can-i-store-a-regex-expression-string-in-a-helper-method-to-use-to-validate/56011862#56011862", "title": "How can I store a regex expression string in a helper method to use to validate several different fields?", "body": "<p>You can require any file from application.rb:</p>\n\n<pre><code># application.rb\nrequire Rails.root.join \"lib\", \"regexes.rb\"\n\n# lib/regexes.rb\nPHONE_NUMBER_REGEX = /your regex/\n</code></pre>\n\n<p>Then you simply use the constant wherever needed</p>\n\n<p>You can alternatively make use of the built in autoload functionality of Rails, for example with the concern approach the other commenter laid out - the concern file is autoloaded by default, as are models, controllers, etc</p>\n\n<p>Loading custom files instead of using the Rails' defaults might not seem idiomatic or the \"rails way\". However, I do think it's important to understand that you can load any files you want. Some people autoload the entire <code>lib/</code> folder and subfolders (see <a href=\"https://stackoverflow.com/questions/19098663/auto-loading-lib-files-in-rails-4\">Auto-loading lib files in Rails 4</a>)</p>\n\n<p>Another alternative is to place your code somewhere in the <code>config/initializers</code> folder, these files are automatically loaded at startup and you can define shared classes/modules/constants there</p>\n"}, {"tags": [], "owner": {"reputation": 15583, "user_id": 177489, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/sv6zK.jpg?s=128&g=1", "display_name": "Mark Swardstrom", "link": "https://stackoverflow.com/users/177489/mark-swardstrom"}, "is_accepted": false, "score": 0, "last_activity_date": 1557175948, "creation_date": 1557175948, "answer_id": 56012286, "question_id": 56011692, "link": "https://stackoverflow.com/questions/56011692/how-can-i-store-a-regex-expression-string-in-a-helper-method-to-use-to-validate/56012286#56012286", "title": "How can I store a regex expression string in a helper method to use to validate several different fields?", "body": "<p>You can put it in ApplicationRecord (application_record.rb)</p>\n\n<pre><code>class ApplicationRecord &lt; ActiveRecord::Base\n  self.abstract_class = true\n\n  VALID_PHONE_NUMBER_REGEX = /\\d{10}/ # your regex here\nend\n</code></pre>\n\n<p>And then you can use it in any model that inherits fro ApplicationRecord</p>\n"}, {"comments": [{"owner": {"reputation": 137, "user_id": 4339194, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh3.googleusercontent.com/-nFaWBLxZTfM/AAAAAAAAAAI/AAAAAAAAAR4/6B_T5aOc3Tc/photo.jpg?sz=128", "display_name": "Brian Tatum", "link": "https://stackoverflow.com/users/4339194/brian-tatum"}, "edited": false, "score": 0, "creation_date": 1557247835, "post_id": 56012359, "comment_id": 98698007, "body": "This is also a good answer, but the answer I marked fit my use case a little better. See comment on answer for more info. I have also upvoted this answer."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "reply_to_user": {"reputation": 137, "user_id": 4339194, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh3.googleusercontent.com/-nFaWBLxZTfM/AAAAAAAAAAI/AAAAAAAAAR4/6B_T5aOc3Tc/photo.jpg?sz=128", "display_name": "Brian Tatum", "link": "https://stackoverflow.com/users/4339194/brian-tatum"}, "edited": false, "score": 0, "creation_date": 1557249289, "post_id": 56012359, "comment_id": 98698608, "body": "@BrianTatum nothing prohibits you from using both options you can just use your constant in the <code>PhoneValidator</code>. In my opinion <code>phone: true</code> beats typing <code>format: {with: PHONE_NUMBER_REGEX}</code> multiple times"}, {"owner": {"reputation": 137, "user_id": 4339194, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh3.googleusercontent.com/-nFaWBLxZTfM/AAAAAAAAAAI/AAAAAAAAAR4/6B_T5aOc3Tc/photo.jpg?sz=128", "display_name": "Brian Tatum", "link": "https://stackoverflow.com/users/4339194/brian-tatum"}, "edited": false, "score": 0, "creation_date": 1557350455, "post_id": 56012359, "comment_id": 98739829, "body": "very good point it would clean thing up a lot and be less to type."}], "tags": [], "owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "is_accepted": false, "score": 2, "last_activity_date": 1557176295, "creation_date": 1557176295, "answer_id": 56012359, "question_id": 56011692, "link": "https://stackoverflow.com/questions/56011692/how-can-i-store-a-regex-expression-string-in-a-helper-method-to-use-to-validate/56012359#56012359", "title": "How can I store a regex expression string in a helper method to use to validate several different fields?", "body": "<p>Add a custom validator app/validators/phone_validator.rb</p>\n\n<pre><code>class PhoneValidator &lt; ActiveModel::EachValidator\n  def validate_each(record, attribute, value)\n    unless value.to_s =~ /YOUR_REGEX_HERE/\n      record.errors.add attribute, 'must be a valid phone number'\n    end\n  end\nend\n</code></pre>\n\n<p>Then in your models </p>\n\n<pre><code>class MyModel &lt; ApplicationRecord\n  #phone: true tells it to use the PhoneValidator defined above\n  validates :phone_number, presence: true, phone: true \nend\n</code></pre>\n"}], "owner": {"reputation": 137, "user_id": 4339194, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh3.googleusercontent.com/-nFaWBLxZTfM/AAAAAAAAAAI/AAAAAAAAAR4/6B_T5aOc3Tc/photo.jpg?sz=128", "display_name": "Brian Tatum", "link": "https://stackoverflow.com/users/4339194/brian-tatum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 56011862, "answer_count": 4, "score": 0, "last_activity_date": 1557176295, "creation_date": 1557173022, "question_id": 56011692, "link": "https://stackoverflow.com/questions/56011692/how-can-i-store-a-regex-expression-string-in-a-helper-method-to-use-to-validate", "title": "How can I store a regex expression string in a helper method to use to validate several different fields?", "body": "<p>I have several different fields that store different phone numbers in my rails app as a string. I can use the built-in rails format validator with a regex expression. Is there a way to place this expression in a helper method for all my phone number validations instead of having to open each model file and paste the expression string.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "docker", "heroku"], "comments": [{"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557169551, "post_id": 56010811, "comment_id": 98667155, "body": "<a href=\"https://devcenter.heroku.com/articles/error-codes#r10-boot-timeout\" rel=\"nofollow noreferrer\">devcenter.heroku.com/articles/error-codes#r10-boot-timeout</a>"}, {"owner": {"reputation": 13, "user_id": 11448691, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yz9cZm8qUiw/AAAAAAAAAAI/AAAAAAAAAA8/EYSyPeGND8Y/photo.jpg?sz=128", "display_name": "Michael Perju", "link": "https://stackoverflow.com/users/11448691/michael-perju"}, "reply_to_user": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557170173, "post_id": 56010811, "comment_id": 98667386, "body": "It makes sense. I think this must be the issue. Thank you very much!"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 11448691, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yz9cZm8qUiw/AAAAAAAAAAI/AAAAAAAAAA8/EYSyPeGND8Y/photo.jpg?sz=128", "display_name": "Michael Perju", "link": "https://stackoverflow.com/users/11448691/michael-perju"}, "edited": false, "score": 0, "creation_date": 1557332361, "post_id": 56011105, "comment_id": 98731846, "body": "Thank you, that&#39;s a good point. However, my issue is because of the time the app takes to build dependencies and boot. It exceeds the time Heroku allows for port binding (60 seconds) so I had to contact the team to request more boot time for the app - devcenter.heroku.com/articles/error-codes#r10-boot-timeout"}, {"owner": {"reputation": 91778, "user_id": 354577, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/dI6cA.jpg?s=128&g=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/354577/chris"}, "reply_to_user": {"reputation": 13, "user_id": 11448691, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yz9cZm8qUiw/AAAAAAAAAAI/AAAAAAAAAA8/EYSyPeGND8Y/photo.jpg?sz=128", "display_name": "Michael Perju", "link": "https://stackoverflow.com/users/11448691/michael-perju"}, "edited": false, "score": 0, "creation_date": 1557333187, "post_id": 56011105, "comment_id": 98732177, "body": "Why is your application building dependencies during boot? Normally that would be done at build time. Anyway, glad you found a solution. And I&#39;m glad my answer helped."}], "tags": [], "owner": {"reputation": 91778, "user_id": 354577, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/dI6cA.jpg?s=128&g=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/354577/chris"}, "is_accepted": true, "score": 1, "last_activity_date": 1557170187, "creation_date": 1557170187, "answer_id": 56011105, "question_id": 56010811, "link": "https://stackoverflow.com/questions/56010811/failed-binding-port-to-ruby-application-on-heroku/56011105#56011105", "title": "Failed binding port to Ruby application on Heroku", "body": "<blockquote>\n  <p>I tried configuring <code>$PORT</code> variable on Heroku to 3000</p>\n</blockquote>\n\n<p>That's not how the <code>PORT</code> environment variable works. You don't get to set it to the value you want to use; <em>Heroku</em> sets it and <em>you</em> must bind to the port it gives you.</p>\n\n<p>For example, if you're using Puma you might <a href=\"https://devcenter.heroku.com/articles/getting-started-with-rails5#create-a-procfile\" rel=\"nofollow noreferrer\">include the <code>-p</code> option in your <code>Procfile</code></a>:</p>\n\n<pre><code>web: bundle exec puma -p ${PORT:-3000}\n</code></pre>\n\n<p>Here we use the value given by <code>$PORT</code>, falling back to <code>3000</code> in case it isn't set (e.g. on your development machine).</p>\n"}, {"tags": [], "owner": {"reputation": 13, "user_id": 11448691, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yz9cZm8qUiw/AAAAAAAAAAI/AAAAAAAAAA8/EYSyPeGND8Y/photo.jpg?sz=128", "display_name": "Michael Perju", "link": "https://stackoverflow.com/users/11448691/michael-perju"}, "is_accepted": false, "score": 1, "last_activity_date": 1557397134, "creation_date": 1557397134, "answer_id": 56057235, "question_id": 56010811, "link": "https://stackoverflow.com/questions/56010811/failed-binding-port-to-ruby-application-on-heroku/56057235#56057235", "title": "Failed binding port to Ruby application on Heroku", "body": "<p>In my case, I had to use a different startup script.\nI used <code>CMD [\"bundle\", \"exec\", \"puma\" ,\"-C\" ,\"config/puma.rb\"]\n</code> instead of <code>rails server -b 0.0.0.0</code></p>\n"}], "owner": {"reputation": 13, "user_id": 11448691, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yz9cZm8qUiw/AAAAAAAAAAI/AAAAAAAAAA8/EYSyPeGND8Y/photo.jpg?sz=128", "display_name": "Michael Perju", "link": "https://stackoverflow.com/users/11448691/michael-perju"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 630, "favorite_count": 0, "accepted_answer_id": 56011105, "answer_count": 2, "score": 0, "last_activity_date": 1557397134, "creation_date": 1557168640, "last_edit_date": 1557170238, "question_id": 56010811, "link": "https://stackoverflow.com/questions/56010811/failed-binding-port-to-ruby-application-on-heroku", "title": "Failed binding port to Ruby application on Heroku", "body": "<p>I want to host a Ruby on Rails app as a Docker container on Heroku. But it seems to have an issue with port binding when deployed. </p>\n\n<p>I successfully hosted a simple Ruby app via Docker locally and on Heroku then I moved to the actual app. The app works fine on localhost but it gets the  port binding issue:</p>\n\n<blockquote>\n  <p>Error R10 (Boot timeout) -> Web process failed to bind to $PORT within 60 seconds of launch</p>\n</blockquote>\n\n<pre><code>2019-05-06T18:23:13.608790+00:00 app[web.1]: Digest::Digest is deprecated; use Digest\n2019-05-06T18:23:15.826137+00:00 app[web.1]: Puma 2.7.1 starting...\n2019-05-06T18:23:15.826185+00:00 app[web.1]: * Min threads: 0, max threads: 16\n2019-05-06T18:23:15.826188+00:00 app[web.1]: * Environment: production\n2019-05-06T18:23:15.826189+00:00 app[web.1]: * Listening on tcp://0.0.0.0:3000\n2019-05-06T18:24:03.338792+00:00 heroku[web.1]: Error R10 (Boot timeout) -&gt; Web process failed to bind to $PORT within 60 seconds of launch\n2019-05-06T18:24:03.338920+00:00 heroku[web.1]: Stopping process with SIGKILL\n2019-05-06T18:24:03.468261+00:00 heroku[web.1]: State changed from starting to crashed\n2019-05-06T18:24:03.451392+00:00 heroku[web.1]: Process exited with status 137\n2019-05-06T18:24:05.407120+00:00 heroku[router]: at=error code=H10 desc=\"App crashed\" method=GET path=\"/\" host=floating-spire-20546.herokuapp.com request_id=9362ea3c-bcb6-476a-a5d4-76c82cd443a3 fwd=\"5.151.93.202\" dyno= connect= service= status=503 bytes= protocol=https\n</code></pre>\n\n<p>I tried configuring <code>$PORT</code> variable on Heroku to 3000. I also tried running the app with <code>rails server -b 0.0.0.0</code>. I tried without any port too. </p>\n\n<p>I am thinking it may be due to the size of the app and multiple gems to be loaded which may exceed 60 seconds. </p>\n\n<p>I expect the app to bind to the port to be accessed. However, it crashed.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "openssl"], "comments": [{"owner": {"reputation": 1012, "user_id": 10347572, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iottG.jpg?s=128&g=1", "display_name": "escanxr", "link": "https://stackoverflow.com/users/10347572/escanxr"}, "edited": false, "score": 0, "creation_date": 1557156958, "post_id": 56008075, "comment_id": 98662037, "body": "Have you tried this <a href=\"https://github.com/bundler/bundler/pull/5388\" rel=\"nofollow noreferrer\">github.com/bundler/bundler/pull/5388</a> ?"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 4, "creation_date": 1557157039, "post_id": 56008075, "comment_id": 98662066, "body": "Installing a gem version of a core dependency can be a huge problem. You may want to remove the gem."}, {"owner": {"reputation": 646, "user_id": 8919469, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f51a8277c113b7415c6b2bbd82be9615?s=128&d=identicon&r=PG&f=1", "display_name": "johan", "link": "https://stackoverflow.com/users/8919469/johan"}, "edited": false, "score": 1, "creation_date": 1557157135, "post_id": 56008075, "comment_id": 98662109, "body": "Oh... removing the gem  solved the problem ! thanks a lot !"}, {"owner": {"reputation": 646, "user_id": 8919469, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f51a8277c113b7415c6b2bbd82be9615?s=128&d=identicon&r=PG&f=1", "display_name": "johan", "link": "https://stackoverflow.com/users/8919469/johan"}, "edited": false, "score": 0, "creation_date": 1557157175, "post_id": 56008075, "comment_id": 98662130, "body": "Is it a gem that was in the old version of ruby ?"}], "owner": {"reputation": 646, "user_id": 8919469, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f51a8277c113b7415c6b2bbd82be9615?s=128&d=identicon&r=PG&f=1", "display_name": "johan", "link": "https://stackoverflow.com/users/8919469/johan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 153, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1557156769, "creation_date": 1557155924, "last_edit_date": 1557156769, "question_id": 56008075, "link": "https://stackoverflow.com/questions/56008075/rspec-error-superclass-mismatch-for-class-cipher", "title": "Rspec | error superclass mismatch for class Cipher", "body": "<p>Since I've updated my ruby version from <code>2.4.1</code> to <code>2.4.4</code>, I face this error when I run <strong>Rspec</strong>.  I am really stuck now.</p>\n\n<p>I am using rails <code>Rails 5.2.3</code> and Rbenv</p>\n\n<p>I've tried the following with out any success... </p>\n\n<pre><code>gem uninstall openssl\n\ngem install openssl\n</code></pre>\n\n<pre><code>#I cut some line it was too big\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::X509::V_ERR_ERROR_IN_CERT_NOT_BEFORE_FIELD\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::X509::V_ERR_ERROR_IN_CERT_NOT_AFTER_FIELD\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::X509::V_ERR_ERROR_IN_CRL_LAST_UPDATE_FIELD\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::X509::V_ERR_ERROR_IN_CRL_NEXT_UPDATE_FIELD\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::X509::V_ERR_OUT_OF_MEM\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::X509::V_ERR_DEPTH_ZERO_SELF_SIGNED_CERT\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::X509::V_ERR_SELF_SIGNED_CERT_IN_CHAIN\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::X509::V_ERR_CERT_UNTRUSTED\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::X509::V_ERR_CERT_REJECTED\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::X509::V_ERR_SUBJECT_ISSUER_MISMATCH\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::X509::V_ERR_AKID_SKID_MISMATCH\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::X509::V_ERR_AKID_ISSUER_SERIAL_MISMATCH\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::X509::V_ERR_KEYUSAGE_NO_CERTSIGN\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::X509::V_ERR_APPLICATION_VERIFICATION\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::X509::V_FLAG_CRL_CHECK\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::X509::V_FLAG_CRL_CHECK_ALL\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::X509::V_FLAG_IGNORE_CRITICAL\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::X509::V_FLAG_X509_STRICT\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::X509::V_FLAG_ALLOW_PROXY_CERTS\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::OCSP::NOEXPLICIT\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::OCSP::NOCASIGN\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::OCSP::NODELEGATED\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::OCSP::NOCHECKS\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::OCSP::TRUSTOTHER\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::OCSP::RESPID_KEY\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::OCSP::NOTIME\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::OCSP::V_CERTSTATUS_GOOD\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::OCSP::V_CERTSTATUS_REVOKED\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::OCSP::V_CERTSTATUS_UNKNOWN\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::OCSP::V_RESPID_NAME\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::OCSP::V_RESPID_KEY\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::Engine::METHOD_RSA\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::Engine::METHOD_DSA\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::Engine::METHOD_DH\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::Engine::METHOD_RAND\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::Engine::METHOD_CIPHERS\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::Engine::METHOD_DIGESTS\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::Engine::METHOD_ALL\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::Engine::METHOD_NONE\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::ASN1::UNIVERSAL_TAG_NAME\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::ASN1::EOC\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::ASN1::BOOLEAN\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::ASN1::INTEGER\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/x86_64-darwin18/openssl.bundle: warning: already initialized constant OpenSSL::ASN1::BIT_STRING\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/openssl/cipher.rb:18: warning: constant OpenSSL::Cipher::Cipher is deprecated\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/openssl/cipher.rb:24: warning: already initialized constant OpenSSL::Cipher::AES\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/gems/2.4.0/gems/openssl-2.1.1/lib/openssl/cipher.rb:24: warning: previous definition of AES was here\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/openssl/cipher.rb:18: warning: constant OpenSSL::Cipher::Cipher is deprecated\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/openssl/cipher.rb:24: warning: already initialized constant OpenSSL::Cipher::CAST5\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/gems/2.4.0/gems/openssl-2.1.1/lib/openssl/cipher.rb:24: warning: previous definition of CAST5 was here\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/openssl/cipher.rb:18: warning: constant OpenSSL::Cipher::Cipher is deprecated\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/openssl/cipher.rb:24: warning: already initialized constant OpenSSL::Cipher::BF\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/gems/2.4.0/gems/openssl-2.1.1/lib/openssl/cipher.rb:24: warning: previous definition of BF was here\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/openssl/cipher.rb:18: warning: constant OpenSSL::Cipher::Cipher is deprecated\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/openssl/cipher.rb:24: warning: already initialized constant OpenSSL::Cipher::DES\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/gems/2.4.0/gems/openssl-2.1.1/lib/openssl/cipher.rb:24: warning: previous definition of DES was here\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/openssl/cipher.rb:18: warning: constant OpenSSL::Cipher::Cipher is deprecated\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/openssl/cipher.rb:24: warning: already initialized constant OpenSSL::Cipher::IDEA\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/gems/2.4.0/gems/openssl-2.1.1/lib/openssl/cipher.rb:24: warning: previous definition of IDEA was here\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/openssl/cipher.rb:18: warning: constant OpenSSL::Cipher::Cipher is deprecated\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/openssl/cipher.rb:24: warning: already initialized constant OpenSSL::Cipher::RC2\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/gems/2.4.0/gems/openssl-2.1.1/lib/openssl/cipher.rb:24: warning: previous definition of RC2 was here\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/openssl/cipher.rb:18: warning: constant OpenSSL::Cipher::Cipher is deprecated\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/openssl/cipher.rb:24: warning: already initialized constant OpenSSL::Cipher::RC4\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/gems/2.4.0/gems/openssl-2.1.1/lib/openssl/cipher.rb:24: warning: previous definition of RC4 was here\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/openssl/cipher.rb:18: warning: constant OpenSSL::Cipher::Cipher is deprecated\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/openssl/cipher.rb:24: warning: already initialized constant OpenSSL::Cipher::RC5\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/gems/2.4.0/gems/openssl-2.1.1/lib/openssl/cipher.rb:24: warning: previous definition of RC5 was here\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/openssl/cipher.rb:28: warning: constant OpenSSL::Cipher::Cipher is deprecated\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/openssl/cipher.rb:33: warning: already initialized constant OpenSSL::Cipher::AES128\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/gems/2.4.0/gems/openssl-2.1.1/lib/openssl/cipher.rb:33: warning: previous definition of AES128 was here\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/openssl/cipher.rb:28: warning: constant OpenSSL::Cipher::Cipher is deprecated\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/openssl/cipher.rb:33: warning: already initialized constant OpenSSL::Cipher::AES192\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/gems/2.4.0/gems/openssl-2.1.1/lib/openssl/cipher.rb:33: warning: previous definition of AES192 was here\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/openssl/cipher.rb:28: warning: constant OpenSSL::Cipher::Cipher is deprecated\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/openssl/cipher.rb:33: warning: already initialized constant OpenSSL::Cipher::AES256\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/gems/2.4.0/gems/openssl-2.1.1/lib/openssl/cipher.rb:33: warning: previous definition of AES256 was here\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/openssl/cipher.rb:64: warning: constant OpenSSL::Cipher::Cipher is deprecated\n/Users/johan/.rbenv/versions/2.4.4/lib/ruby/2.4.0/openssl/cipher.rb:64: warning: constant OpenSSL::Cipher::Cipher is deprecated\n\nAn error occurred while loading ./spec/controllers/admin/orders_controller_spec.rb.\nFailure/Error: require File.expand_path('../../config/environment', __FILE__)\n\nTypeError:\n  superclass mismatch for class Cipher\n# ./config/application.rb:3:in `&lt;top (required)&gt;'\n# ./config/environment.rb:2:in `require_relative'\n# ./config/environment.rb:2:in `&lt;top (required)&gt;'\n# ./spec/rails_helper.rb:3:in `&lt;top (required)&gt;'\n# ./spec/controllers/admin/orders_controller_spec.rb:1:in `&lt;top (required)&gt;'\n\nRandomized with seed 55176\n\nFinished in 0.00052 seconds (files took 8.07 seconds to load)\n0 examples, 0 failures, 1 error occurred outside of examples\n\nRandomized with seed 55176\n\nCoverage report generated for RSpec to /Users/johan/code/personnal_projects/kamelot/coverage. 288 / 1880 LOC (15.32%) covered.\n</code></pre>\n"}, {"tags": ["ruby", "azure", "oauth-2.0"], "comments": [{"owner": {"reputation": 98670, "user_id": 188096, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/2hqrh.png?s=128&g=1", "display_name": "Gaurav Mantri", "link": "https://stackoverflow.com/users/188096/gaurav-mantri"}, "edited": false, "score": 0, "creation_date": 1557155903, "post_id": 56007863, "comment_id": 98661481, "body": "Where did you register the app? I&#39;m guessing the app is a v1 app. Please see this guide for more details: <a href=\"https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app\" rel=\"nofollow noreferrer\">docs.microsoft.com/en-us/azure/active-directory/develop/&hellip;</a>."}, {"owner": {"reputation": 1667, "user_id": 6860421, "user_type": "registered", "profile_image": "https://graph.facebook.com/953309974791428/picture?type=large", "display_name": "Roman Alekseiev", "link": "https://stackoverflow.com/users/6860421/roman-alekseiev"}, "reply_to_user": {"reputation": 98670, "user_id": 188096, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/2hqrh.png?s=128&g=1", "display_name": "Gaurav Mantri", "link": "https://stackoverflow.com/users/188096/gaurav-mantri"}, "edited": false, "score": 0, "creation_date": 1557166454, "post_id": 56007863, "comment_id": 98666047, "body": "I have read this article twice, but I do not see reference v1 or v2 app. I just see single tenant and multi tenant application."}, {"owner": {"reputation": 40761, "user_id": 1658906, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4e4748ed2fb97e8a8d4dd6d439625135?s=128&d=identicon&r=PG", "display_name": "juunas", "link": "https://stackoverflow.com/users/1658906/juunas"}, "edited": false, "score": 0, "creation_date": 1557170235, "post_id": 56007863, "comment_id": 98667408, "body": "That&#39;s odd.. You registered it in Azure portal? There&#39;s no such thing as v1 and v2 app by the way. All support both."}, {"owner": {"reputation": 1667, "user_id": 6860421, "user_type": "registered", "profile_image": "https://graph.facebook.com/953309974791428/picture?type=large", "display_name": "Roman Alekseiev", "link": "https://stackoverflow.com/users/6860421/roman-alekseiev"}, "reply_to_user": {"reputation": 40761, "user_id": 1658906, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4e4748ed2fb97e8a8d4dd6d439625135?s=128&d=identicon&r=PG", "display_name": "juunas", "link": "https://stackoverflow.com/users/1658906/juunas"}, "edited": false, "score": 0, "creation_date": 1557171619, "post_id": 56007863, "comment_id": 98667906, "body": "@juunas yes, I registered my app accordingly to guide. To be honest I have read a lot of different manuals about registering app. I successfully made authorization for single-tenant but I would like to any of users to connect with my app."}], "answers": [{"comments": [{"owner": {"reputation": 1667, "user_id": 6860421, "user_type": "registered", "profile_image": "https://graph.facebook.com/953309974791428/picture?type=large", "display_name": "Roman Alekseiev", "link": "https://stackoverflow.com/users/6860421/roman-alekseiev"}, "edited": false, "score": 0, "creation_date": 1557329099, "post_id": 56014354, "comment_id": 98730242, "body": "can you help me please with one more question? I am making successful authentication, receiving access_token and refresh_token but it seems that access_token is not correct as I do request and it responds with 401 error Unauthorized. My access_token looks like &quot;access_token&quot;:&quot;EwBYA8l6BAAURSN/FHlDW5xN74t6GzbtsBBeBUYAAegF&zwnj;&#8203;pPNhedMjbytXuX32bDod&zwnj;&#8203;4dOgeX14oj0nTat1dFio&zwnj;&#8203;BzA1Uz48HBfj9UPlpH5o&zwnj;&#8203;+wEW....&quot;. Isn&#39;t is should start with &#39;eyJ....&#39; and so on? Or I am wrong with something else?"}, {"owner": {"reputation": 6891, "user_id": 5961091, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/770ef56a37f9335da77014c7326ea2e1?s=128&d=identicon&r=PG", "display_name": "Serge Semenov", "link": "https://stackoverflow.com/users/5961091/serge-semenov"}, "edited": false, "score": 1, "creation_date": 1567737810, "post_id": 56014354, "comment_id": 102061270, "body": "It does not allow me to change this value in the manifest - had to re-register a new app."}], "tags": [], "owner": {"reputation": 6530, "user_id": 9663070, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0iRQt.png?s=128&g=1", "display_name": "Md Farid Uddin Kiron", "link": "https://stackoverflow.com/users/9663070/md-farid-uddin-kiron"}, "is_accepted": true, "score": 1, "last_activity_date": 1557194387, "last_edit_date": 1557194387, "creation_date": 1557192614, "answer_id": 56014354, "question_id": 56007863, "link": "https://stackoverflow.com/questions/56007863/access-with-personal-account-to-multi-tenant-application-aad/56014354#56014354", "title": "Access with personal account to multi-tenant application AAD", "body": "<p>Could you please have a check you enabled personal Microsoft accounts to login your multi-tenant app ? </p>\n\n<p>You can check the config here : Please take a look below</p>\n\n<p><a href=\"https://i.stack.imgur.com/vRGcm.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/vRGcm.png\" alt=\"enter image description here\"></a></p>\n\n<p>If you enabled multi-tenant users to login only , you should enable personal Microsoft accounts manually .For now, we should modify it in Azure AD App manifest,modify the value of <code>signInAudience</code> to <code>AzureADandPersonalMicrosoftAccount</code> will make this happen: See the screen shot below</p>\n\n<p><a href=\"https://i.stack.imgur.com/nxVu3.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/nxVu3.png\" alt=\"enter image description here\"></a></p>\n\n<p>This change will take few minutes to work. Hope it helps . </p>\n"}], "owner": {"reputation": 1667, "user_id": 6860421, "user_type": "registered", "profile_image": "https://graph.facebook.com/953309974791428/picture?type=large", "display_name": "Roman Alekseiev", "link": "https://stackoverflow.com/users/6860421/roman-alekseiev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 609, "favorite_count": 0, "accepted_answer_id": 56014354, "answer_count": 1, "score": 1, "last_activity_date": 1557194387, "creation_date": 1557155220, "question_id": 56007863, "link": "https://stackoverflow.com/questions/56007863/access-with-personal-account-to-multi-tenant-application-aad", "title": "Access with personal account to multi-tenant application AAD", "body": "<p>I have multi-tenant application and I would like all users of all types could access my application. </p>\n\n<p>I have read that AAD API version 2.0 have possibility to access all types of account, i.e. work, school, guest, personal (<a href=\"https://docs.microsoft.com/en-US/azure/active-directory/develop/azure-ad-endpoint-comparison\" rel=\"nofollow noreferrer\">https://docs.microsoft.com/en-US/azure/active-directory/develop/azure-ad-endpoint-comparison</a>). \nSo I am making request on v2.0 endpoint with ruby lang. Here is my url:\n<code>https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=some_id&amp;redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Fauthorize&amp;response_type=code&amp;scope=openid+profile+email+offline_access</code></p>\n\n<p>When I try to login with my personal creds it says \n'This doesn't look like a work or school email. You can't sign in here with a personal account. Use your work or school account instead.'</p>\n\n<p>I have no idea what I am doing wrong. Any help will be appreciated</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "api"], "comments": [{"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1557154353, "post_id": 56007496, "comment_id": 98660685, "body": "How are you currently getting <code>107.23.149.70</code> ?"}, {"owner": {"reputation": 119, "user_id": 8319323, "user_type": "registered", "profile_image": "https://graph.facebook.com/1344036448998167/picture?type=large", "display_name": "Anatolii Stupin", "link": "https://stackoverflow.com/users/8319323/anatolii-stupin"}, "reply_to_user": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1557154620, "post_id": 56007496, "comment_id": 98660829, "body": "@lacostenycoder as I said, each time Trello IP is different. If I add this IP to webconsole.whitelisted_ips, then try to create webhook, I see the same issue, but with different IP."}], "answers": [{"tags": [], "owner": {"reputation": 1342, "user_id": 1143549, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45da1bf4376d6f184e41de57e03789b9?s=128&d=identicon&r=PG", "display_name": "Derek Wright", "link": "https://stackoverflow.com/users/1143549/derek-wright"}, "is_accepted": false, "score": 2, "last_activity_date": 1557156809, "creation_date": 1557156809, "answer_id": 56008326, "question_id": 56007496, "link": "https://stackoverflow.com/questions/56007496/how-to-allow-render-to-web-console-from-trello-api-ips/56008326#56008326", "title": "How to allow render to web console from Trello API ips?", "body": "<p>This is because Trello is acting like a HTTP client when it executes a webhook back to your service. Since your app is in developer-mode, it has the ability to render the rails console in the browser for you. You don't want this exposed externally, remove your whitelist IP and ignore.</p>\n"}, {"tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": false, "score": 1, "last_activity_date": 1557165075, "creation_date": 1557165075, "answer_id": 56010101, "question_id": 56007496, "link": "https://stackoverflow.com/questions/56007496/how-to-allow-render-to-web-console-from-trello-api-ips/56010101#56010101", "title": "How to allow render to web console from Trello API ips?", "body": "<p>The previous answer seems correct.  However if you want to silence the console messages you can do that with, <a href=\"https://github.com/rails/web-console#configweb_consolewhiny_requests\" rel=\"nofollow noreferrer\">see documentation</a></p>\n\n<pre><code>Rails.application.configure do\n  config.web_console.whiny_requests = false\nend\n</code></pre>\n"}], "owner": {"reputation": 119, "user_id": 8319323, "user_type": "registered", "profile_image": "https://graph.facebook.com/1344036448998167/picture?type=large", "display_name": "Anatolii Stupin", "link": "https://stackoverflow.com/users/8319323/anatolii-stupin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1557165075, "creation_date": 1557153872, "question_id": 56007496, "link": "https://stackoverflow.com/questions/56007496/how-to-allow-render-to-web-console-from-trello-api-ips", "title": "How to allow render to web console from Trello API ips?", "body": "<p>Sorry for my English. I am backend junior (Ruby on Rails).</p>\n\n<p>I am working with Trello API. Now I am creating webhooks.\nWhen webhook was created, I see this line in console:</p>\n\n<pre><code>Cannot render console from 107.23.149.70! Allowed networks: 127.0.0.1, ::1, 127.0.0.0/127.255.255.255\n</code></pre>\n\n<p>I know that I can add line like this to config/environments/development.rb:</p>\n\n<pre><code>config.web_console.whitelisted_ips = '10.0.2.2'\n</code></pre>\n\n<p>But trouble is that Trello API IP and IP mask is different each time when I am doing requests.</p>\n\n<p>How I can solve this?\nThank you in advance.</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1557157134, "post_id": 56006874, "comment_id": 98662107, "body": "You can install with <a href=\"https://bundler.io\" rel=\"nofollow noreferrer\">Bundler</a>: <code>bundle install --path=.bundle</code> and then ship that whole thing if you want."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557157148, "post_id": 56006874, "comment_id": 98662116, "body": "Where metasploit gets it from &quot;/usr/share/metasploit-framework/vendor/bundle/ruby/2.3.0/ge&zwnj;&#8203;ms/net-ssh-4.2.0/lib&zwnj;&#8203;/net/ssh.rb&quot;.  Where you are trying to get it from &quot; /usr/lib/ruby/2.3.0/gems/2.3.0&quot; metasploit is maintaining its own bundle (probably to ensure version control) if you would like to use this library in irb under the standard installation you should install the gem"}, {"owner": {"reputation": 53, "user_id": 11107862, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LfwFB.jpg?s=128&g=1", "display_name": "\u674e\u96e8\u6cfd", "link": "https://stackoverflow.com/users/11107862/%e6%9d%8e%e9%9b%a8%e6%b3%bd"}, "edited": false, "score": 0, "creation_date": 1557193102, "post_id": 56006874, "comment_id": 98673214, "body": "The main problem is that for some reason I want to use local gems without using the network."}], "answers": [{"comments": [{"owner": {"reputation": 1432, "user_id": 1184912, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc5f9407e5093fbd916ea4d80c7a499f?s=128&d=identicon&r=PG", "display_name": "eyevan", "link": "https://stackoverflow.com/users/1184912/eyevan"}, "reply_to_user": {"reputation": 53, "user_id": 11107862, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LfwFB.jpg?s=128&g=1", "display_name": "\u674e\u96e8\u6cfd", "link": "https://stackoverflow.com/users/11107862/%e6%9d%8e%e9%9b%a8%e6%b3%bd"}, "edited": false, "score": 0, "creation_date": 1557224142, "post_id": 56012103, "comment_id": 98684449, "body": "Oh yeah, sorry. <code>$LOAD_PATH</code> actually doesn&#39;t work with gems. You&#39;d need to use <code>GEM_HOME</code>/<code>GEM_PATH</code> instead -- please see the updated answer."}, {"owner": {"reputation": 53, "user_id": 11107862, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LfwFB.jpg?s=128&g=1", "display_name": "\u674e\u96e8\u6cfd", "link": "https://stackoverflow.com/users/11107862/%e6%9d%8e%e9%9b%a8%e6%b3%bd"}, "edited": false, "score": 0, "creation_date": 1557229906, "post_id": 56012103, "comment_id": 98687646, "body": "it works !!!!!!!  I am so grateful to you.!!! you don know how I really want to give you a big hug now \ud83d\ude18"}, {"owner": {"reputation": 1432, "user_id": 1184912, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc5f9407e5093fbd916ea4d80c7a499f?s=128&d=identicon&r=PG", "display_name": "eyevan", "link": "https://stackoverflow.com/users/1184912/eyevan"}, "reply_to_user": {"reputation": 53, "user_id": 11107862, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LfwFB.jpg?s=128&g=1", "display_name": "\u674e\u96e8\u6cfd", "link": "https://stackoverflow.com/users/11107862/%e6%9d%8e%e9%9b%a8%e6%b3%bd"}, "edited": false, "score": 0, "creation_date": 1557230602, "post_id": 56012103, "comment_id": 98688074, "body": "Haha, no problem. :-)"}], "tags": [], "owner": {"reputation": 1432, "user_id": 1184912, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc5f9407e5093fbd916ea4d80c7a499f?s=128&d=identicon&r=PG", "display_name": "eyevan", "link": "https://stackoverflow.com/users/1184912/eyevan"}, "is_accepted": true, "score": 1, "last_activity_date": 1557224092, "last_edit_date": 1557224092, "creation_date": 1557175049, "answer_id": 56012103, "question_id": 56006874, "link": "https://stackoverflow.com/questions/56006874/how-do-i-import-gems-that-have-been-downloaded-when-installing-some-software/56012103#56012103", "title": "How do I import gems that have been downloaded when installing some software?", "body": "<p>You can either set <code>GEM_PATH</code> environment variable (with <code>ruby</code> or <code>irb</code>):</p>\n\n<pre><code>GEM_PATH=/usr/share/metasploit-framework/vendor/bundle/ruby/2.3.0/ ruby -e 'require \"net/ssh\"'\n</code></pre>\n\n<p>Or you can set it in the code of your script:</p>\n\n<pre><code>#!/usr/env/ruby\n\nGem.paths = { 'GEM_HOME' =&gt; \"/usr/share/metasploit-framework/vendor/bundle/ruby/2.3.0/\" }\n\nrequire 'net/ssh'\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 11107862, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LfwFB.jpg?s=128&g=1", "display_name": "\u674e\u96e8\u6cfd", "link": "https://stackoverflow.com/users/11107862/%e6%9d%8e%e9%9b%a8%e6%b3%bd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 301, "favorite_count": 0, "accepted_answer_id": 56012103, "answer_count": 1, "score": 2, "last_activity_date": 1557224092, "creation_date": 1557151696, "question_id": 56006874, "link": "https://stackoverflow.com/questions/56006874/how-do-i-import-gems-that-have-been-downloaded-when-installing-some-software", "title": "How do I import gems that have been downloaded when installing some software?", "body": "<p>I am using Kali Linux, it has pre-installed a lot of software written in ruby (such as metasploit, beef), today I want to import a ssh gem when writing my own script, but I failed because it is fundamental It was not installed, but I saw that the software written in ruby also imported it. and it run well, How do they work?</p>\n\n<p>Found in my system\uff1a</p>\n\n<pre><code>root@kali:/home# find / -type f -iname *ssh*.rb \n/usr/share/metasploit-framework/modules/post/linux/manage/sshkey_persistence.rb\n/usr/share/metasploit-framework/modules/post/multi/gather/ssh_creds.rb\n/usr/share/metasploit-framework/modules/auxiliary/dos/windows/ssh/sysax_sshd_kexchange.rb\n/usr/share/metasploit-framework/modules/auxiliary/scanner/ssh/ssh_login_pubkey.rb\n/usr/share/metasploit-framework/modules/auxiliary/scanner/ssh/ssh_identify_pubkeys.rb\n/usr/share/metasploit-framework/modules/auxiliary/scanner/ssh/ssh_enumusers.rb\n/usr/share/metasploit-framework/modules/auxiliary/scanner/ssh/ssh_version.rb\n/usr/share/metasploit-framework/modules/auxiliary/scanner/ssh/ssh_login.rb\n/usr/share/metasploit-framework/modules/auxiliary/fuzzers/ssh/ssh_version_2.rb\n/usr/share/metasploit-framework/modules/auxiliary/fuzzers/ssh/ssh_version_15.rb\n/usr/share/metasploit-framework/modules/auxiliary/fuzzers/ssh/ssh_version_corrupt.rb\n/usr/share/metasploit-framework/modules/auxiliary/fuzzers/ssh/ssh_kexinit_corrupt.rb\n/usr/share/metasploit-framework/modules/exploits/linux/ssh/symantec_smg_ssh.rb\n/usr/share/metasploit-framework/modules/exploits/linux/ssh/mercurial_ssh_exec.rb\n/usr/share/metasploit-framework/modules/exploits/windows/ssh/freesshd_key_exchange.rb\n/usr/share/metasploit-framework/modules/exploits/windows/ssh/freesshd_authbypass.rb\n/usr/share/metasploit-framework/modules/exploits/windows/ssh/sysax_ssh_username.rb\n/usr/share/metasploit-framework/modules/exploits/windows/ssh/securecrt_ssh1.rb\n/usr/share/metasploit-framework/modules/exploits/apple_ios/ssh/cydia_default_ssh.rb\n/usr/share/metasploit-framework/modules/exploits/multi/ssh/sshexec.rb\n/usr/share/metasploit-framework/vendor/bundle/ruby/2.3.0/gems/dnsruby-1.60.2/test/tc_sshfp.rb\n/usr/share/metasploit-framework/vendor/bundle/ruby/2.3.0/gems/dnsruby-1.60.2/lib/dnsruby/resource/SSHFP.rb\n/usr/share/metasploit-framework/vendor/bundle/ruby/2.3.0/gems/rex-socket-0.1.10/lib/rex/socket/ssh_factory.rb\n/usr/share/metasploit-framework/vendor/bundle/ruby/2.3.0/gems/net-ssh-4.2.0/lib/net/ssh.rb\n/usr/share/metasploit-framework/vendor/bundle/ruby/2.3.0/gems/net-ssh-4.2.0/support/ssh_tunnel_bug.rb\n/usr/share/metasploit-framework/vendor/bundle/ruby/2.3.0/gems/metasploit-credential-2.0.12/spec/models/metasploit/credential/ssh_key_spec.rb\n/usr/share/metasploit-framework/vendor/bundle/ruby/2.3.0/gems/metasploit-credential-2.0.12/spec/factories/metasploit/credential/ssh_keys.rb\n/usr/share/metasploit-framework/vendor/bundle/ruby/2.3.0/gems/metasploit-credential-2.0.12/app/models/metasploit/credential/ssh_key.rb\n/usr/share/metasploit-framework/vendor/bundle/ruby/2.3.0/gems/metasploit-credential-2.0.12/db/migrate/20161107203710_create_index_on_private_data_and_type_for_ssh_key.rb\n/usr/share/metasploit-framework/vendor/bundle/ruby/2.3.0/gems/sshkey-1.9.0/test/sshkey_test.rb\n/usr/share/metasploit-framework/vendor/bundle/ruby/2.3.0/gems/sshkey-1.9.0/lib/sshkey.rb\n/usr/share/metasploit-framework/lib/msf/core/exploit/ssh.rb\n/usr/share/metasploit-framework/lib/metasploit/framework/login_scanner/ssh.rb\n/usr/share/metasploit-framework/scripts/meterpreter/win32-sshclient.rb\n/usr/share/metasploit-framework/scripts/meterpreter/win32-sshserver.rb\n</code></pre>\n\n<p>I also saw that they have a module that imports Net:SSH\uff1a</p>\n\n<pre><code>root@kali:/home# cat /usr/share/metasploit-framework/modules/auxiliary/scanner/ssh/ssh_login.rb\n##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nrequire 'net/ssh'\nrequire 'net/ssh/command_stream'\nrequire 'metasploit/framework/login_scanner/ssh'\nrequire 'metasploit/framework/credential_collection'\n\n...\n...\n...\n</code></pre>\n\n<p>but when i use it:</p>\n\n<pre><code>root@kali:/home# irb\nirb(main):001:0&gt; require 'net/ssh'\nLoadError: cannot load such file -- net/ssh\n    from /usr/lib/ruby/2.3.0/rubygems/core_ext/kernel_require.rb:55:in `require'\n    from /usr/lib/ruby/2.3.0/rubygems/core_ext/kernel_require.rb:55:in `require'\n    from (irb):1\n    from /usr/bin/irb:11:in `&lt;main&gt;'\nirb(main):002:0&gt; \n</code></pre>\n\n<p>Can I use it in my script without using gem install?</p>\n\n<p>Anyway, thank those who gave me advice, I hope you have a happy day~</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 4948, "user_id": 1025520, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/f9f78456abe7adce324b230d947696e4?s=128&d=identicon&r=PG", "display_name": "NeverBe", "link": "https://stackoverflow.com/users/1025520/neverbe"}, "edited": false, "score": 1, "creation_date": 1557148777, "post_id": 56006010, "comment_id": 98657673, "body": "if the method could return nil instead of &quot;&quot; you can do: var = some_really_long_method || &quot;1&quot;"}, {"owner": {"reputation": 61, "user_id": 9794081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65d20607ef5e19f4fea4388fbaa398e0?s=128&d=identicon&r=PG&f=1", "display_name": "Databaas7894", "link": "https://stackoverflow.com/users/9794081/databaas7894"}, "reply_to_user": {"reputation": 4948, "user_id": 1025520, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/f9f78456abe7adce324b230d947696e4?s=128&d=identicon&r=PG", "display_name": "NeverBe", "link": "https://stackoverflow.com/users/1025520/neverbe"}, "edited": false, "score": 0, "creation_date": 1557149738, "post_id": 56006010, "comment_id": 98658190, "body": "I was looking for something like that. But I understand there is unfortunately not a way to do the same with a empty string? Would you please confirm?"}, {"owner": {"reputation": 4948, "user_id": 1025520, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/f9f78456abe7adce324b230d947696e4?s=128&d=identicon&r=PG", "display_name": "NeverBe", "link": "https://stackoverflow.com/users/1025520/neverbe"}, "edited": false, "score": 0, "creation_date": 1557151011, "post_id": 56006010, "comment_id": 98658935, "body": "nope, have no idea"}], "answers": [{"tags": [], "owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "is_accepted": false, "score": 1, "last_activity_date": 1557148861, "creation_date": 1557148861, "answer_id": 56006128, "question_id": 56006010, "link": "https://stackoverflow.com/questions/56006010/how-to-change-result-of-a-method-in-one-line/56006128#56006128", "title": "How to change result of a method in one line?", "body": "<p>Newlines are optional in Ruby, they can always be replaced with either an expression separator (<code>;</code>), a keyword (e.g. <code>then</code>, <code>do</code>), or sometimes just whitespace.</p>\n\n<p>Therefore, every program, no matter how complex, can always be written in one line, just by removing the linebreaks:</p>\n\n<pre><code>var = some_really_long_method(foo); var = \"1\" if var == \"\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 73209, "user_id": 290394, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d7908f05c89e965f6bc5308ad6f41256?s=128&d=identicon&r=PG", "display_name": "steenslag", "link": "https://stackoverflow.com/users/290394/steenslag"}, "is_accepted": false, "score": 0, "last_activity_date": 1557149780, "creation_date": 1557149780, "answer_id": 56006381, "question_id": 56006010, "link": "https://stackoverflow.com/questions/56006010/how-to-change-result-of-a-method-in-one-line/56006381#56006381", "title": "How to change result of a method in one line?", "body": "<pre><code>var = \"1\" if (var = some_really_long_method(foo)) == \"\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 73209, "user_id": 290394, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d7908f05c89e965f6bc5308ad6f41256?s=128&d=identicon&r=PG", "display_name": "steenslag", "link": "https://stackoverflow.com/users/290394/steenslag"}, "edited": false, "score": 0, "creation_date": 1557157931, "post_id": 56008205, "comment_id": 98662482, "body": "oh..always nice, a new method."}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557159903, "post_id": 56008205, "comment_id": 98663371, "body": "alternatively but not dissimilar enough for a new answer <code>var = some_really_long_method(foo).tap {|s| s.replace(&quot;1&quot;) if s.empty?}</code>"}], "tags": [], "owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "is_accepted": true, "score": 2, "last_activity_date": 1557156394, "creation_date": 1557156394, "answer_id": 56008205, "question_id": 56006010, "link": "https://stackoverflow.com/questions/56006010/how-to-change-result-of-a-method-in-one-line/56008205#56008205", "title": "How to change result of a method in one line?", "body": "<p>You could use <a href=\"https://ruby-doc.org/core-2.6.2/Object.html#method-i-then\" rel=\"nofollow noreferrer\">Object#then</a>:</p>\n\n<pre><code>def some_really_long_method\n  p 'called'\n  p res = [\"\", \"10\"].sample\n  res\nend\n\nvar = some_really_long_method.then { |m| m == \"\" ? '1' : m }\n</code></pre>\n\n<p>You can check for yourself that the method is called once.</p>\n"}], "owner": {"reputation": 61, "user_id": 9794081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65d20607ef5e19f4fea4388fbaa398e0?s=128&d=identicon&r=PG&f=1", "display_name": "Databaas7894", "link": "https://stackoverflow.com/users/9794081/databaas7894"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 56008205, "answer_count": 3, "score": 1, "last_activity_date": 1557156394, "creation_date": 1557148418, "question_id": 56006010, "link": "https://stackoverflow.com/questions/56006010/how-to-change-result-of-a-method-in-one-line", "title": "How to change result of a method in one line?", "body": "<p>I need to change the output of a method a bit: Execute the function, and if it's a empty string, then convert it to a \"1\". How can i write this short on just one line? </p>\n\n<pre><code>var = some_really_long_method(foo)\nvar = \"1\" if var == \"\"\n</code></pre>\n\n<p>I tried below, but that does call the method twice, right?</p>\n\n<pre><code>var = some_really_long_method(foo) == \"\" ? \"1\" : some_really_long_method(foo)\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 158, "user_id": 8547999, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-AmMMSRSrg04/AAAAAAAAAAI/AAAAAAAAABA/SlvGsCIVJms/photo.jpg?sz=128", "display_name": "Jose Manuel", "link": "https://stackoverflow.com/users/8547999/jose-manuel"}, "edited": false, "score": 0, "creation_date": 1557149815, "post_id": 56005947, "comment_id": 98658235, "body": "Are you using any permissions management? Or it may be that your users controller have something wrong on the show method. Or maybe the user_path route is not well defined."}, {"owner": {"reputation": 2060, "user_id": 3944700, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4df64cd1de5941fb49263a19d80f1482?s=128&d=identicon&r=PG&f=1", "display_name": "hashrocket", "link": "https://stackoverflow.com/users/3944700/hashrocket"}, "edited": false, "score": 0, "creation_date": 1557149910, "post_id": 56005947, "comment_id": 98658301, "body": "What do your routes look like?"}, {"owner": {"reputation": 27, "user_id": 9232115, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/213557746e39a9f9240bd7d9bc624e42?s=128&d=identicon&r=PG&f=1", "display_name": "bottles", "link": "https://stackoverflow.com/users/9232115/bottles"}, "reply_to_user": {"reputation": 2060, "user_id": 3944700, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4df64cd1de5941fb49263a19d80f1482?s=128&d=identicon&r=PG&f=1", "display_name": "hashrocket", "link": "https://stackoverflow.com/users/3944700/hashrocket"}, "edited": false, "score": 0, "creation_date": 1557150635, "post_id": 56005947, "comment_id": 98658713, "body": "@hashrocket Please i have updated my question"}, {"owner": {"reputation": 27, "user_id": 9232115, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/213557746e39a9f9240bd7d9bc624e42?s=128&d=identicon&r=PG&f=1", "display_name": "bottles", "link": "https://stackoverflow.com/users/9232115/bottles"}, "reply_to_user": {"reputation": 158, "user_id": 8547999, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-AmMMSRSrg04/AAAAAAAAAAI/AAAAAAAAABA/SlvGsCIVJms/photo.jpg?sz=128", "display_name": "Jose Manuel", "link": "https://stackoverflow.com/users/8547999/jose-manuel"}, "edited": false, "score": 0, "creation_date": 1557150704, "post_id": 56005947, "comment_id": 98658748, "body": "@JoseManuel please check my updated question"}, {"owner": {"reputation": 2060, "user_id": 3944700, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4df64cd1de5941fb49263a19d80f1482?s=128&d=identicon&r=PG&f=1", "display_name": "hashrocket", "link": "https://stackoverflow.com/users/3944700/hashrocket"}, "edited": false, "score": 0, "creation_date": 1557150858, "post_id": 56005947, "comment_id": 98658839, "body": "What do your models look like?"}], "answers": [{"tags": [], "owner": {"reputation": 158, "user_id": 8547999, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-AmMMSRSrg04/AAAAAAAAAAI/AAAAAAAAABA/SlvGsCIVJms/photo.jpg?sz=128", "display_name": "Jose Manuel", "link": "https://stackoverflow.com/users/8547999/jose-manuel"}, "is_accepted": true, "score": 1, "last_activity_date": 1557150958, "creation_date": 1557150958, "answer_id": 56006690, "question_id": 56005947, "link": "https://stackoverflow.com/questions/56005947/clicking-on-a-username-of-another-user-links-to-my-profile-instead-of-the-users/56006690#56006690", "title": "Clicking on a Username of another user links to my profile instead of the user&#39;s profile", "body": "<p>I guess the problem is that on the <code>show</code> method from <code>users_controller</code>, you are getting the posts from current_user instead of the user, it should be <code>@posts = @user.posts.order(created_at: :desc)</code></p>\n"}], "owner": {"reputation": 27, "user_id": 9232115, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/213557746e39a9f9240bd7d9bc624e42?s=128&d=identicon&r=PG&f=1", "display_name": "bottles", "link": "https://stackoverflow.com/users/9232115/bottles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39, "favorite_count": 1, "accepted_answer_id": 56006690, "answer_count": 1, "score": 0, "last_activity_date": 1557150958, "creation_date": 1557148177, "last_edit_date": 1592644375, "question_id": 56005947, "link": "https://stackoverflow.com/questions/56005947/clicking-on-a-username-of-another-user-links-to-my-profile-instead-of-the-users", "title": "Clicking on a Username of another user links to my profile instead of the user&#39;s profile", "body": "<p>I need help with this my code,that displays list of posts of users along with their username.What i want is, when i click on a username of a particular post, it should send me to that user's profile. instead, it send's to my own profile or the current user's profile whiles i want it to link me to the username i have clicked profile. (e.g like when you click on a username on Instagram, it links you to the user's profile so you can follow or unfollow and see their post)\nPlease i need help. what i'm i not doing right in my code.\ni'm on rails 5.2.3 &amp; ruby 2.3.3</p>\n<h2>Home</h2>\n<pre><code>\n&lt;div class=&quot;posts&quot;&gt;\n  &lt;% @posts.each do |post| %&gt;\n    &lt;section class=&quot;post&quot;&gt;\n      &lt;div class=&quot;user&quot;&gt;\n        &lt;div class=&quot;avatar&quot;&gt;\n      \n          &lt;img src=&quot;assets/avater.jpg&quot;&gt;\n          \n        &lt;/div&gt;\n          &lt;%= link_to post.user.username, user_path(post.user), class: 'username' %&gt;\n      &lt;/div&gt;\n      &lt;%= image_tag post.image, class: 'main-image' %&gt;\n      &lt;div class=&quot;description&quot;&gt;\n        &lt;% post.description.to_s.split(' ').each do |word| %&gt;\n              &lt;% if word.start_with?('#') %&gt;\n              &lt;%= link_to word, search_index_path(query: word) %&gt;\n              &lt;% else %&gt;\n                &lt;%= word %&gt;\n                &lt;% end %&gt;\n                &lt;% end %&gt;\n      &lt;/div&gt;\n    &lt;/section&gt;\n  &lt;% end %&gt;\n  &lt;%= paginate @posts %&gt;\n&lt;/div&gt;\n\n</code></pre>\n<h2>routes</h2>\n<pre><code>Rails.application.routes.draw do\n  get 'search/index'\n  devise_for :users\n  get 'home/index'\n    resources :posts\n  root 'home#index'\n  resources :users, only: [:show, :edit, :update]\n  resources :posts, only: [:new, :create, :show, :destroy]\nend\n</code></pre>\n<h2>users controller</h2>\n<pre><code>class UsersController &lt; ApplicationController\n    before_action :find_user\n    \n\n    def show\n     @user  = User.find(params[:id])\n     @posts = current_user.posts.order(created_at: :desc)\n    end\n\n    def edit\n        \n    end\n\n    def update\n      current_user.update(user_params)\n      redirect_to current_user\n    end\n\n    private\n\n    def find_user\n      @user = User.find(params[:id])\n        \n    end\n\n    def user_params\n      params.require(:user).permit(:username, :name, :website,:bio, :email, :phone, :gender, :avatar)\n    end\nend\n</code></pre>\n<h2>post controller</h2>\n<pre><code>class PostsController &lt; ApplicationController\n\ndef new\n  @post = current_user.posts.build\nend\n\n  def create\n     @post = Post.create(post_params)\n      redirect_to root_path\n    end\n\n    def show\n      @post = Post.find(params[:id])\n    end\n\n    def destroy\n      @post = current_user.posts.find(params[:id])\n      @post.destroy\n\n      redirect_to user_path(current_user)\n    end\n\n    private\n\n    def post_params\n      params.require(:post).permit(:description, :image, :user_id)\n    end\nend\n</code></pre>\n<h2>home controller</h2>\n<pre><code>class HomeController &lt; ApplicationController\nbefore_action :authenticate_user!\n\n  def index\n    @posts = Post.order(created_at: :desc).page(params[:page]).per(5)\n  end\nend\n</code></pre>\n"}, {"tags": ["ruby", "amazon-web-services", "amazon-s3", "permissions", "acl"], "answers": [{"tags": [], "owner": {"reputation": 162605, "user_id": 174777, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6PnNW.jpg?s=128&g=1", "display_name": "John Rotenstein", "link": "https://stackoverflow.com/users/174777/john-rotenstein"}, "is_accepted": false, "score": 1, "last_activity_date": 1557185534, "creation_date": 1557185534, "answer_id": 56013604, "question_id": 56005760, "link": "https://stackoverflow.com/questions/56005760/how-to-fetch-acl-permission-for-a-aws-s3-folder-to-check-whether-it-has-permissi/56013604#56013604", "title": "How to fetch ACL permission for a AWS S3 folder to check whether it has permission to write a new file", "body": "<p>Folders do not actually exist in Amazon S3. For example, you could use this <a href=\"http://aws.amazon.com/cli/\" rel=\"nofollow noreferrer\">AWS Command-Line Interface (CLI)</a> command to create an object in a folder that does not exist:</p>\n\n<pre><code>aws s3 cp foo.txt s3://my-bucket/unicorn/soup/foo.txt\n</code></pre>\n\n<p>This will cause the <code>unicorn</code> and <code>soup</code> directories to magically appear, because they do not actually exist. If that object were deleted, those directories would also disappear (because they do not exist!).</p>\n\n<p>Amazon S3 is a flat object storage system. The path of an object is actually stored in the <code>Key</code> (filename) of the object. Some API calls help maintain the fiction that directories exist, but they actually do not exist.</p>\n\n<p>Sometimes there is a desire to \"create\" a directory, such as through the management console. This is done by creating a <strong>zero-length object with the name of the directory</strong>. This does not \"create\" a directory, it simply causes it to appear as a <strong>common prefix</strong> in certain API calls.</p>\n\n<p>Also, since directories do not exist, <strong>it is not possible to set ACLs on directories</strong>. You cannot control whether somebody can create an object in a directory by setting permissions on a directory (because, yes!, directories do not exist).</p>\n\n<p>If you are wanting to grant <em>anyone</em> permission to write to a folder, you can use a <strong>Bucket Policy</strong> that grants access using a specific <strong>prefix</strong>. If you are wishing to grant access to specific IAM Users, then you can attach a policy to the IAM User.</p>\n"}], "owner": {"reputation": 5286, "user_id": 253986, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/083d94b9d308bca999a491fe8bc5368f?s=128&d=identicon&r=PG", "display_name": "Achaius", "link": "https://stackoverflow.com/users/253986/achaius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 299, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1557185552, "creation_date": 1557147529, "last_edit_date": 1557185552, "question_id": 56005760, "link": "https://stackoverflow.com/questions/56005760/how-to-fetch-acl-permission-for-a-aws-s3-folder-to-check-whether-it-has-permissi", "title": "How to fetch ACL permission for a AWS S3 folder to check whether it has permission to write a new file", "body": "<p>I want to check whether a new file can be written into a S3 folder using <a href=\"https://docs.aws.amazon.com/sdkforruby/api/Aws/S3/ObjectAcl.html\" rel=\"nofollow noreferrer\">S3::ObjectACL</a></p>\n\n<pre><code>vs3 = AWS::S3.new\nobj = s3.buckets[\"my_bucket\"].object[\"folder1/sub-folder/\"]\nputs obj.acl.grants\n</code></pre>\n\n<p>But the above code returns </p>\n\n<pre><code>Aws::S3::Errors::NoSuchKey (The specified key does not exist.)\n</code></pre>\n\n<p>But the above code works fine for a specific file but not for a folder. How to get it work for a S3 prefix?</p>\n"}, {"tags": ["ruby", "stack"], "answers": [{"tags": [], "owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "is_accepted": true, "score": 3, "last_activity_date": 1557157221, "creation_date": 1557157221, "answer_id": 56008418, "question_id": 56005575, "link": "https://stackoverflow.com/questions/56005575/how-can-i-get-current-depth-of-the-ruby-interpreter-stack/56008418#56008418", "title": "How can I get current depth of the Ruby interpreter stack?", "body": "<p>Probably like this using <a href=\"https://ruby-doc.org/core-2.6.3/Kernel.html#method-i-caller\" rel=\"nofollow noreferrer\"><code>caller</code></a>:</p>\n\n<pre><code>caller.length\n</code></pre>\n\n<p>Keep in mind that starts at a certain depth when your program spins up, so you may want to subtract that from your count.</p>\n"}], "owner": {"reputation": 142, "user_id": 7657215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0cpRG.png?s=128&g=1", "display_name": "LegenDUST", "link": "https://stackoverflow.com/users/7657215/legendust"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 56008418, "answer_count": 1, "score": 0, "last_activity_date": 1557157221, "creation_date": 1557146786, "question_id": 56005575, "link": "https://stackoverflow.com/questions/56005575/how-can-i-get-current-depth-of-the-ruby-interpreter-stack", "title": "How can I get current depth of the Ruby interpreter stack?", "body": "<p>I want to get stack depth, to know how deep it go in recursive function.</p>\n\n<p>I found <a href=\"https://stackoverflow.com/questions/34115298/how-do-i-get-the-current-depth-of-the-python-interpreter-stack\">How do I get the current depth of the Python interpreter stack?</a> this, and this is what exactly I want, but it's python, and I couldn't find anything like this when I googled 'Ruby get stack depth'.</p>\n\n<p>What I want to do is something like this:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>def recursive_func(n)\n   if n == 1\n      return get_current_depth()\n   end\n   recursive_func(n - 1)\nend\n</code></pre>\n\n<p>What can I use?</p>\n"}, {"tags": ["ruby", "ruby-hash"], "answers": [{"tags": [], "owner": {"reputation": 1173, "user_id": 9418609, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o0aMF.jpg?s=128&g=1", "display_name": "uday", "link": "https://stackoverflow.com/users/9418609/uday"}, "is_accepted": false, "score": 2, "last_activity_date": 1557203660, "last_edit_date": 1557203660, "creation_date": 1557137558, "answer_id": 56003079, "question_id": 56003021, "link": "https://stackoverflow.com/questions/56003021/sort-array-of-hashes-keys/56003079#56003079", "title": "Sort Array of Hashes Keys", "body": "<p>you can use ruby <code>Hash#sort_by</code> to sort the elements of a Hash:</p>\n\n<pre><code>arr.map { |inner_hash| inner_hash.sort_by(&amp;:first).to_h }\n&gt;&gt; [{\"id\"=&gt;647628, \"name\"=&gt;\"Product Management\"}, {\"id\"=&gt;647630, \"name\"=&gt;\"Sales\"}]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3902, "user_id": 10608621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d59df09a85d05117c63706f66811b70c?s=128&d=identicon&r=PG", "display_name": "mechnicov", "link": "https://stackoverflow.com/users/10608621/mechnicov"}, "is_accepted": true, "score": 2, "last_activity_date": 1557137876, "creation_date": 1557137876, "answer_id": 56003154, "question_id": 56003021, "link": "https://stackoverflow.com/questions/56003021/sort-array-of-hashes-keys/56003154#56003154", "title": "Sort Array of Hashes Keys", "body": "<p>Basically you don't need to sort hashes, but you can</p>\n\n<pre><code>arr.map { |h| h.sort.to_h }\n\n# =&gt; [{\"id\"=&gt;647628, \"name\"=&gt;\"Product Management\"}, {\"id\"=&gt;647630, \"name\"=&gt;\"Sales\"}]\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 5898204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a37f95b66ca8b147a2222d8ddb9b553b?s=128&d=identicon&r=PG&f=1", "display_name": "Munish Prabhu", "link": "https://stackoverflow.com/users/5898204/munish-prabhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 56003154, "answer_count": 2, "score": 0, "last_activity_date": 1557203660, "creation_date": 1557137322, "last_edit_date": 1557137455, "question_id": 56003021, "link": "https://stackoverflow.com/questions/56003021/sort-array-of-hashes-keys", "title": "Sort Array of Hashes Keys", "body": "<p>I am looking for a solution to sort the Hash keys in an Array.</p>\n\n<pre><code>arr = [{\"name\"=&gt;\"Product Management\", \"id\"=&gt;647628}, {\"name\"=&gt;\"Sales\", \"id\"=&gt;647630}]\n\narr.each {|inner_hash| inner_hash.sort}\n</code></pre>\n\n<p>Expected Result:</p>\n\n<pre><code>[{\"id\"=&gt;647628, \"name\"=&gt;\"Product Management\"}, {\"id\"=&gt;647630, \"name\"=&gt;\"Sales\"}]\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "ruby-on-rails-3", "ruby-on-rails-4", "ruby-on-rails-5"], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 11441800, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-HoX6ojngBPc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc5CnU_ViHex3nF6_4ffYBSn4nNjw/mo/photo.jpg?sz=128", "display_name": "maksim korshikov", "link": "https://stackoverflow.com/users/11441800/maksim-korshikov"}, "edited": false, "score": 0, "creation_date": 1557137986, "post_id": 56003122, "comment_id": 98652208, "body": "Fix my code as you said, and now it&#39;s working. Thank you very much. Have a nice day"}, {"owner": {"reputation": 1076, "user_id": 5362761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mVJG5.jpg?s=128&g=1", "display_name": "Anuj Khandelwal", "link": "https://stackoverflow.com/users/5362761/anuj-khandelwal"}, "reply_to_user": {"reputation": 33, "user_id": 11441800, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-HoX6ojngBPc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc5CnU_ViHex3nF6_4ffYBSn4nNjw/mo/photo.jpg?sz=128", "display_name": "maksim korshikov", "link": "https://stackoverflow.com/users/11441800/maksim-korshikov"}, "edited": false, "score": 0, "creation_date": 1557138529, "post_id": 56003122, "comment_id": 98652463, "body": "@maksimkorshikov If it seems to work, could you please mark it as the accepted answer if it solves the problem?"}], "tags": [], "owner": {"reputation": 1076, "user_id": 5362761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mVJG5.jpg?s=128&g=1", "display_name": "Anuj Khandelwal", "link": "https://stackoverflow.com/users/5362761/anuj-khandelwal"}, "is_accepted": true, "score": 2, "last_activity_date": 1557138001, "last_edit_date": 1557138001, "creation_date": 1557137717, "answer_id": 56003122, "question_id": 56002974, "link": "https://stackoverflow.com/questions/56002974/how-to-use-correctly-def-with-if-else-statements-in-ruby/56003122#56003122", "title": "How to use correctly def with if..else statements in ruby?", "body": "<p>The error here is that the <code>Maths</code> class is initiated with a <code>String</code> instead of an <code>Integer</code> in the line <code>classob5 = Maths.new(\"1\")</code>.</p>\n\n<p>So, what happens is, when <code>numberdata()</code> is invoked, it compares <code>@number</code> whose value is \"1\"(<code>String</code>) with <code>1</code>, which is an <code>Integer</code>. Thus, the <code>if</code> condition fails, since they are not equal, and you get the result from the <code>else</code> condition.</p>\n\n<p>The usage of <code>if..else</code> is absolutely correct. The class object just needs to be instantiated as <code>classob5 = Maths.new(1)</code>.</p>\n"}], "owner": {"reputation": 33, "user_id": 11441800, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-HoX6ojngBPc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc5CnU_ViHex3nF6_4ffYBSn4nNjw/mo/photo.jpg?sz=128", "display_name": "maksim korshikov", "link": "https://stackoverflow.com/users/11441800/maksim-korshikov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "accepted_answer_id": 56003122, "answer_count": 1, "score": 0, "last_activity_date": 1557139108, "creation_date": 1557137122, "last_edit_date": 1557139108, "question_id": 56002974, "link": "https://stackoverflow.com/questions/56002974/how-to-use-correctly-def-with-if-else-statements-in-ruby", "title": "How to use correctly def with if..else statements in ruby?", "body": "<p>I started learning ruby, for this moment I understand how to create class objects, and how to write very simple IF..ELSE statement. But how to write correctly def with IF..ELSE statement?\nHelp please with advice how to write it correctly?</p>\n\n<pre><code>   #I can write simple statement like this \n\nnumber = 1\nif number == 1\n    number += 1\n    puts \"the number is #{number}\"\nelse \n    puts \"number is more then 2\"\nend\n\n#But then i want to write something like this \n\nclass Maths\n  def initialize(number_id)\n    @number = number_id \n  end \n\n  def numberdata()\n    if @number == 1 \n      @number +=1\n      puts \"the number is #@number\"\n    else \n      puts \"number is greater than 3\"\n    end\n  end\nend\n\nclassob5 = Maths.new(\"1\")\nclassob5.numberdata()\n</code></pre>\n\n<p>I expected the output from the second part to be \"the number is 2\", but the actual output turned out to be \"number is greater than 3\"\nPlease help with advice about how to write it correctly.</p>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 1, "creation_date": 1557137391, "post_id": 56002963, "comment_id": 98651950, "body": "Your code looks like the one in <a href=\"https://stackoverflow.com/q/56000459/477037\">stackoverflow.com/q/56000459/477037</a> \u2013 is this a duplicate or a follow-up question? Are you both trying to solve the same assignment or something?"}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "reply_to_user": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1557147814, "post_id": 56002963, "comment_id": 98657076, "body": "@Stefan: This is actually at least the tenth almost identical question with almost identical code having almost identical errors. I cannot tell if this is the same person asking the same question over and over again and refusing to learn from the answers, or different persons asking the same question over and over again, refusing to use search engines. They always have useless titles, they always have made no attempt to reduce the code to a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>, and they mostly don&#39;t respond to questions for clarification."}], "answers": [{"tags": [], "owner": {"reputation": 807, "user_id": 1688322, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/cZ6Ai.jpg?s=128&g=1", "display_name": "Robin van Dijk", "link": "https://stackoverflow.com/users/1688322/robin-van-dijk"}, "is_accepted": true, "score": 0, "last_activity_date": 1557138029, "creation_date": 1557138029, "answer_id": 56003203, "question_id": 56002963, "link": "https://stackoverflow.com/questions/56002963/searching-if-values-exist/56003203#56003203", "title": "Searching if values exist", "body": "<p><code>map</code> is undefined because you call it on a single object, instead of a collection of objects. You need to fill an array with <code>Album</code> objects, before you can <code>map</code> over it.</p>\n"}], "owner": {"reputation": 3, "user_id": 11458784, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7e9a88ac44a2e5bb9972b6d231da0a1?s=128&d=identicon&r=PG&f=1", "display_name": "KoolAid32", "link": "https://stackoverflow.com/users/11458784/koolaid32"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39, "favorite_count": 0, "accepted_answer_id": 56003203, "answer_count": 1, "score": 0, "last_activity_date": 1557138029, "creation_date": 1557137063, "question_id": 56002963, "link": "https://stackoverflow.com/questions/56002963/searching-if-values-exist", "title": "Searching if values exist", "body": "<p>My application needs to read data from a file and then the user can search for that data to see if it exists. The file reads the ID of an album, then the user must enter that ID in order to access it</p>\n\n<p>The text file</p>\n\n<pre><code>Marcus Hospin\nRaw\n3 - Genre Value\n1 - ID \nSag My Pants\nsounds/01-Sag-My-Pants.wav\nThe Purge\nsounds/06-The-Purge.wav\nIll Mind 8\nsounds/20-Ill-Mind-8.wav\n</code></pre>\n\n<p>The ruby code</p>\n\n<pre><code>class Album\n  attr_accessor :title, :artist, :genre, :id, :tracks\n\n  def initialize (title, artist, genre, id)\n    @title = title\n    @artist = artist\n    @genre = genre\n    @id = id\n\n  end\nend\n\ndef read_album(music_file)\n  album_artist = music_file.gets\n  album_title = music_file.gets\n  album_genre = music_file.gets\n  album_id = music_file.gets\n  album = Album.new(album_title, album_artist, album_genre, album_id)\n  album\nend\n\ndef main\nalbum = read_album(music_file)\nputs 'Enter the ID of the album you wish to play'\n      search_string = gets.to_s\n      album.map(&amp;:id).include?(search_string) || -1\n      if index != -1\n        puts \"Found, playing album \" + album[index].id + \" at \" + index.to_s\n      else\n        puts \"Entry not Found\"\n      end\nend\n\nmain\n\n</code></pre>\n\n<p>The expected result is for the program to return, \"Found, playing album 1(ID) at 1(index). But the actual ouput is <code>undefined method `map' for #&lt;Album:0x0000000003357ca0&gt; (NoMethodError)</code></p>\n"}, {"tags": ["ruby-on-rails", "ruby", "websocket", "passenger", "actioncable"], "comments": [{"owner": {"reputation": 150, "user_id": 10689191, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Qj2VmQMIjhA/AAAAAAAAAAI/AAAAAAAAFvQ/LEMXRwLLwPM/photo.jpg?sz=128", "display_name": "Shashank Tripathi", "link": "https://stackoverflow.com/users/10689191/shashank-tripathi"}, "edited": false, "score": 0, "creation_date": 1589924077, "post_id": 56002397, "comment_id": 109485541, "body": "I&#39;m unable to connect action cable, it&#39;s not calling I, [2019-05-06T11:00:57.688540 #4986]  INFO -- : Finished &quot;/cable/&quot; [WebSocket] for 144.85.191.180 at 2019-05-06 11:00:57 +0200 I, [2019-05-06T11:01:09.799045 #4986]  INFO -- : Started GET &quot;/cable/&quot;, while setup is same for production.rb and all. can you tell me why it&#39;s not calling /cable with server load."}, {"owner": {"reputation": 4288, "user_id": 447303, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/a07f0662e96a632d9447a710adadbe05?s=128&d=identicon&r=PG", "display_name": "phil", "link": "https://stackoverflow.com/users/447303/phil"}, "edited": false, "score": 0, "creation_date": 1600174750, "post_id": 56002397, "comment_id": 112999723, "body": "I am having this same issue with Rails 6 - I&#39;m going to open a new question."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 13212468, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/79fd17c1342f65421db1d2965f7e6f75?s=128&d=identicon&r=PG", "display_name": "Trvr", "link": "https://stackoverflow.com/users/13212468/trvr"}, "is_accepted": false, "score": 0, "last_activity_date": 1585925253, "creation_date": 1585925253, "answer_id": 61014482, "question_id": 56002397, "link": "https://stackoverflow.com/questions/56002397/rails-actioncable-passenger-aws-elasticache-redis-how-to-fix-websocke/61014482#61014482", "title": "Rails + ActionCable + Passenger + AWS Elasticache (Redis) : how to fix &#39;WebSocket is closed before the connection is established.&#39; on production?", "body": "<p>You might need to change 'wss://...' to 'ws://...' in your config/environments/production.rb file</p>\n"}], "owner": {"reputation": 73, "user_id": 8900569, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e93772c258905a34f99453bbe882d206?s=128&d=identicon&r=PG&f=1", "display_name": "Curdix", "link": "https://stackoverflow.com/users/8900569/curdix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 486, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1585925253, "creation_date": 1557134958, "question_id": 56002397, "link": "https://stackoverflow.com/questions/56002397/rails-actioncable-passenger-aws-elasticache-redis-how-to-fix-websocke", "title": "Rails + ActionCable + Passenger + AWS Elasticache (Redis) : how to fix &#39;WebSocket is closed before the connection is established.&#39; on production?", "body": "<p>I have some troubles working my action cable in production environment. <strong>Development env is working fine.</strong></p>\n\n<p><strong>Error to solve :</strong>\nWebSocket connection to 'wss://myapp.com/cable' failed: WebSocket is closed before the connection is established. </p>\n\n<p>I'm getting this error multiple times on Chrome's console.</p>\n\n<p><strong>Stack</strong></p>\n\n<ul>\n<li>Ruby 2.3.0 </li>\n<li>Rails 5.0.7.2</li>\n<li>Nginx 1.10.1</li>\n<li>Passenger 5.0.30</li>\n<li>Redis 5.0.3 (on AWS Elasticache)</li>\n</ul>\n\n<p><strong>nginx.conf</strong></p>\n\n<pre><code>server {\n  listen 443 ssl;\n  server_name myapp.com *myapp.com;\n  root /home/ubuntu/myapp/current/public;\n  ssl_certificate ...;\n  ssl_certificate_key ...;\n  passenger_enabled on;\n  passenger_min_instances 1;\n  ...\n\n  location /cable {\n    passenger_app_group_name my_app_action_cable;\n    passenger_force_max_concurrent_requests_per_process 0;\n  }\n}\n</code></pre>\n\n<p><strong>cable.yml</strong></p>\n\n<pre><code>production:\n  adapter: redis\n  url: redis://myapp.grzdsm.0001.euw1.cache.amazonaws.com:6379\n</code></pre>\n\n<p><strong>production.rb</strong></p>\n\n<pre><code>config.action_cable.url = \"wss://myapp.com/cable\"\nconfig.action_cable.allowed_request_origins = [\"https://myapp.com\", \"myapp.com\"]\n</code></pre>\n\n<p><strong>routes.rb</strong></p>\n\n<pre><code>mount ActionCable.server =&gt; '/cable'\n</code></pre>\n\n<p><strong>notification_channel.rb</strong></p>\n\n<pre><code>class NotificationChannel &lt; ApplicationCable::Channel\n\n  def subscribed\n    stream_from \"notification\"\n  end\n\n  def unsubscribed\n  end\n\nend\n</code></pre>\n\n<p><strong>connection.rb</strong></p>\n\n<pre><code>module ApplicationCable\n  class Connection &lt; ActionCable::Connection::Base\n  end\nend\n</code></pre>\n\n<p><strong>channel.rb</strong></p>\n\n<pre><code>module ApplicationCable\n  class Channel &lt; ActionCable::Channel::Base\n  end\nend\n</code></pre>\n\n<p><strong>cable.js</strong></p>\n\n<pre><code>//= require action_cable\n//= require_self\n//= require_tree ./channels\n\n(function() {\n  this.App || (this.App = {});\n\n  App.cable = ActionCable.createConsumer();\n\n}).call(this);\n</code></pre>\n\n<p><strong>notification.coffee</strong></p>\n\n<pre><code>App.notification = App.cable.subscriptions.create \"NotificationChannel\",\n  connected: -&gt;\n    console.log(\"connected\");\n\n  disconnected: -&gt;\n    console.log(\"disconnected\");\n\n  received: (data) -&gt;\n    console.log(\"received\");\n</code></pre>\n\n<p>My logs shows successfully websocket connection</p>\n\n<pre><code>I, [2019-05-06T11:00:57.688540 #4986]  INFO -- : Finished \"/cable/\" [WebSocket] for 144.85.191.180 at 2019-05-06 11:00:57 +0200\nI, [2019-05-06T11:01:09.799045 #4986]  INFO -- : Started GET \"/cable/\" [WebSocket] for 144.85.191.180 at 2019-05-06 11:01:09 +0200\nI, [2019-05-06T11:01:09.799154 #4986]  INFO -- : Successfully upgraded to WebSocket (REQUEST_METHOD: GET, HTTP_CONNECTION: upgrade, HTTP_UPGRADE: websocket)\nI, [2019-05-06T11:01:09.803010 #4986]  INFO -- : Registered connection (Z2lkOi8veXBqL1VzZXIvMjkx)\nI, [2019-05-06T11:01:20.541988 #4986]  INFO -- : Finished \"/cable/\" [WebSocket] for 144.85.191.180 at 2019-05-06 11:01:20 +0200\nI, [2019-05-06T11:01:21.784567 #4986]  INFO -- : Started GET \"/cable/\" [WebSocket] for 144.85.191.180 at 2019-05-06 11:01:21 +0200\nI, [2019-05-06T11:01:21.784672 #4986]  INFO -- : Successfully upgraded to WebSocket (REQUEST_METHOD: GET, HTTP_CONNECTION: upgrade, HTTP_UPGRADE: websocket)\nI, [2019-05-06T11:01:21.788734 #4986]  INFO -- : Registered connection (Z2lkOi8veXBqL1VzZXIvMjkx)\nI, [2019-05-06T11:01:43.768741 #4986]  INFO -- : Finished \"/cable/\" [WebSocket] for 144.85.191.180 at 2019-05-06 11:01:43 +0200\nI, [2019-05-06T11:01:44.784226 #4986]  INFO -- : Started GET \"/cable/\" [WebSocket] for 144.85.191.180 at 2019-05-06 11:01:44 +0200\nI, [2019-05-06T11:01:44.784333 #4986]  INFO -- : Successfully upgraded to WebSocket (REQUEST_METHOD: GET, HTTP_CONNECTION: upgrade, HTTP_UPGRADE: websocket)\nI, [2019-05-06T11:01:44.788154 #4986]  INFO -- : Registered connection (Z2lkOi8veXBqL1VzZXIvMjkx)\n</code></pre>\n\n<p>Redis monitor is showing subscribe and unsubscribe</p>\n\n<pre><code>1557133304.788584 [0 172.30.1.177:59731] \"subscribe\" \"action_cable/Z2lkOi8veXBqL1VzZXIvMjkx\"\n1557133326.654308 [0 172.30.1.177:59731] \"unsubscribe\" \"action_cable/Z2lkOi8veXBqL1VzZXIvMjkx\"\n1557133327.910010 [0 172.30.1.177:59731] \"subscribe\" \"action_cable/Z2lkOi8veXBqL1VzZXIvMjkx\"\n1557133349.255254 [0 172.30.1.177:59731] \"unsubscribe\" \"action_cable/Z2lkOi8veXBqL1VzZXIvMjkx\"\n1557133351.183697 [0 172.30.1.177:59731] \"subscribe\" \"action_cable/Z2lkOi8veXBqL1VzZXIvMjkx\"\n1557133356.974099 [0 172.30.1.177:59731] \"unsubscribe\" \"action_cable/Z2lkOi8veXBqL1VzZXIvMjkx\"\n1557133357.707420 [0 172.30.1.177:59731] \"subscribe\" \"action_cable/Z2lkOi8veXBqL1VzZXIvMjkx\"\n1557133371.886670 [0 172.30.1.177:59731] \"unsubscribe\" \"action_cable/Z2lkOi8veXBqL1VzZXIvMjkx\"\n</code></pre>\n\n<p>But I'm still getting this error : WebSocket connection to 'wss://myapp.com/cable' failed: WebSocket is closed before the connection is established. </p>\n\n<p>Any clue would be really appreciated, thanks !</p>\n"}, {"tags": ["javascript", "ruby-on-rails", "ruby", "authentication", "jwt"], "answers": [{"comments": [{"owner": {"reputation": 243, "user_id": 10449299, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-zTZYN2C6Fy0/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DW0HgF5KUQWBf44PYbBYHC5b5PSUg/mo/photo.jpg?sz=128", "display_name": "Zum Dummi", "link": "https://stackoverflow.com/users/10449299/zum-dummi"}, "edited": false, "score": 0, "creation_date": 1557140743, "post_id": 56003847, "comment_id": 98653464, "body": "i see about knock, but i dont know about device-jwt, which u use right now??"}, {"owner": {"reputation": 16587, "user_id": 177053, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f6c516626d381a1ea383cedd1799486?s=128&d=identicon&r=PG", "display_name": "Vasfed", "link": "https://stackoverflow.com/users/177053/vasfed"}, "reply_to_user": {"reputation": 243, "user_id": 10449299, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-zTZYN2C6Fy0/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DW0HgF5KUQWBf44PYbBYHC5b5PSUg/mo/photo.jpg?sz=128", "display_name": "Zum Dummi", "link": "https://stackoverflow.com/users/10449299/zum-dummi"}, "edited": false, "score": 0, "creation_date": 1557141111, "post_id": 56003847, "comment_id": 98653632, "body": "For api-only I&#39;d go with <code>knock</code>"}], "tags": [], "owner": {"reputation": 16587, "user_id": 177053, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f6c516626d381a1ea383cedd1799486?s=128&d=identicon&r=PG", "display_name": "Vasfed", "link": "https://stackoverflow.com/users/177053/vasfed"}, "is_accepted": false, "score": 0, "last_activity_date": 1557140494, "creation_date": 1557140494, "answer_id": 56003847, "question_id": 56001943, "link": "https://stackoverflow.com/questions/56001943/how-to-use-middleware-in-rails-to-get-current-user-id-by-jwt/56003847#56003847", "title": "how to use middleware in rails to get current_user_id by JWT?", "body": "<p>Provided rails excerpt is only token (de-)coder, actual middleware looks very similar, it should be a callable object (either a proc/lambda, or more commonly an instance with <code>call</code> method):</p>\n\n<pre><code>class SomeMiddleware\n  def initialize(app, params)\n    @app = app\n  end\n\n  def call(env)\n    @app.call(env)\n  end\nend\n</code></pre>\n\n<pre><code># application.rb\nconfig.middleware.use SomeMiddleware, some_optional: \"params\"\n</code></pre>\n\n<p>But for authentication you do not have to make that a middleware, for most cases a <code>before_action</code> in your <code>ApplicationController</code> can be sufficient.</p>\n\n<p>Also you can look into using some gems like <a href=\"https://github.com/nsarno/knock\" rel=\"nofollow noreferrer\">knock</a> or <a href=\"https://github.com/waiting-for-dev/devise-jwt\" rel=\"nofollow noreferrer\">devise-jwt</a></p>\n"}], "owner": {"reputation": 243, "user_id": 10449299, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-zTZYN2C6Fy0/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DW0HgF5KUQWBf44PYbBYHC5b5PSUg/mo/photo.jpg?sz=128", "display_name": "Zum Dummi", "link": "https://stackoverflow.com/users/10449299/zum-dummi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 723, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1557140649, "creation_date": 1557133408, "last_edit_date": 1557140649, "question_id": 56001943, "link": "https://stackoverflow.com/questions/56001943/how-to-use-middleware-in-rails-to-get-current-user-id-by-jwt", "title": "how to use middleware in rails to get current_user_id by JWT?", "body": "<p>I am new in Rails, I usually on Express using middleware to get user.id by decoded JWT,\nit something like this</p>\n\n<p><strong>/middleware/jwt.js</strong> </p>\n\n<pre><code>const authentic = async (req, res, next) =&gt; {\n  const token = req.header(\"token\");\n  if (!token) {\n    res.status(400).json({ error: \"no token \" });\n  } else {\n    try {\n      const decoded = verifyJwt(token);\n      const isAuth = await Person.findOne({ _id: decoded._id });\n      if (!isAuth) {\n        res.status(400).json({ error: `you are not authentic` });\n      } else {\n        // keys : _id, role, username\n        req.user = decoded;\n        next();\n      }\n    } catch (e) {\n      next(e);\n    }\n  }\n};\n\nexport default authentic;\n</code></pre>\n\n<p>then I use it on routes, <code>app.use(authentic)</code>\nso I can get <code>req.user.id</code> on each query I associated or populate</p>\n\n<p>in rails, how to use middleware and required that authentic middle to get current_user_id ?? so I could associate it with other models, \nI am using the rails for API only, I would love to get some implementation for this without any gems like <code>devise</code> or others, just using JWT </p>\n\n<p>here is on rails for JWT:</p>\n\n<p><strong>/lib/json_web_token.rb</strong> </p>\n\n<pre><code>class JsonWebToken\n class &lt;&lt; self\n   def encode(payload, exp = 24.hours.from_now)\n     payload[:exp] = exp.to_i\n     JWT.encode(payload, Rails.application.secrets.secret_key_base)\n   end\n\n   def decode(token)\n     body = JWT.decode(token, Rails.application.secrets.secret_key_base)[0]\n     HashWithIndifferentAccess.new body\n   rescue\n     nil\n   end\n end\nend\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "rspec", "callback", "ruby-on-rails-5"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 8438100, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kao1M.jpg?s=128&g=1", "display_name": "wish", "link": "https://stackoverflow.com/users/8438100/wish"}, "edited": false, "score": 0, "creation_date": 1557135855, "post_id": 56002526, "comment_id": 98651245, "body": "Thanks but you posted the same code as I written. You just mentioned below line <code>RSpec.describe YourModel, type: :model do</code>  which is default syntax of rspec model spec."}, {"owner": {"reputation": 3902, "user_id": 10608621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d59df09a85d05117c63706f66811b70c?s=128&d=identicon&r=PG", "display_name": "mechnicov", "link": "https://stackoverflow.com/users/10608621/mechnicov"}, "reply_to_user": {"reputation": 43, "user_id": 8438100, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kao1M.jpg?s=128&g=1", "display_name": "wish", "link": "https://stackoverflow.com/users/8438100/wish"}, "edited": false, "score": 0, "creation_date": 1557136736, "post_id": 56002526, "comment_id": 98651652, "body": "@wish, please clarify your question"}, {"owner": {"reputation": 43, "user_id": 8438100, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kao1M.jpg?s=128&g=1", "display_name": "wish", "link": "https://stackoverflow.com/users/8438100/wish"}, "edited": false, "score": 0, "creation_date": 1557144509, "post_id": 56002526, "comment_id": 98655272, "body": "I found the solution and I posted the answer as well. Thank for showing interest."}], "tags": [], "owner": {"reputation": 3902, "user_id": 10608621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d59df09a85d05117c63706f66811b70c?s=128&d=identicon&r=PG", "display_name": "mechnicov", "link": "https://stackoverflow.com/users/10608621/mechnicov"}, "is_accepted": false, "score": 0, "last_activity_date": 1557135461, "creation_date": 1557135461, "answer_id": 56002526, "question_id": 55999756, "link": "https://stackoverflow.com/questions/55999756/test-after-create-commit-callback-using-shoulda-callback-matchers-gem-rails/56002526#56002526", "title": "Test after_create_commit callback using `shoulda-callback-matchers` gem + rails 5 + rspec", "body": "<p>Something like this:</p>\n\n<pre><code>RSpec.describe YourModel, type: :model do\n  context 'callbacks check' do\n    it { is_expected.to callback(:admission_created_notification).after(:create) }\n    it { is_expected.to callback(:admission_status_change_notification).after(:update) }\n  end\nend\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 43, "user_id": 8438100, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kao1M.jpg?s=128&g=1", "display_name": "wish", "link": "https://stackoverflow.com/users/8438100/wish"}, "is_accepted": true, "score": 0, "last_activity_date": 1557136254, "creation_date": 1557136254, "answer_id": 56002735, "question_id": 55999756, "link": "https://stackoverflow.com/questions/55999756/test-after-create-commit-callback-using-shoulda-callback-matchers-gem-rails/56002735#56002735", "title": "Test after_create_commit callback using `shoulda-callback-matchers` gem + rails 5 + rspec", "body": "<p>I Didn't use the above mentioned gem. I use the default way of Rspec to write rspec for these callback.\n<strong>Model callback code</strong></p>\n\n<pre><code>class Admission &lt; ApplicationRecord\n  after_create_commit :admission_created_notification\n  after_update_commit :admission_status_change_notification\nend\n</code></pre>\n\n<p><strong>Model Spec Code</strong></p>\n\n<pre><code>context 'create and update' do\n    let(:student_detail) { FactoryBot.create(:student_detail) }\n    let(:institute_program) { FactoryBot.create(:institute_program) }\n    let(:admission) { FactoryBot.create(:admission, student_detail: student_detail, institute_program: institute_program) }\n    it 'When create' do\n      admission.student_detail.notifications.count(1)\n      admission.institute_program.institute_detail.notifications.count(1)\n    end\n    it 'When applied' do\n      admission.update(status: 'applied')\n      admission.student_detail.notifications.count(2)\n      admission.institute_program.institute_detail.notifications.count(2)\n    end\n    it 'When accepted' do\n      admission.update(status: 'accepted')\n      admission.student_detail.notifications.count(3)\n      admission.institute_program.institute_detail.notifications.count(3)\n    end\n    it 'When rejected' do\n      admission.update(status: 'rejected')\n      admission.student_detail.notifications.count(3)\n    end\n    it 'When approved' do\n      admission.update(status: 'approved')\n      admission.student_detail.notifications.count(4)\n      admission.institute_program.institute_detail.notifications.count(4)\n      admission.notifications.count(9)\n    end\n  end\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 8438100, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kao1M.jpg?s=128&g=1", "display_name": "wish", "link": "https://stackoverflow.com/users/8438100/wish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 562, "favorite_count": 0, "accepted_answer_id": 56002735, "answer_count": 2, "score": 0, "last_activity_date": 1557136254, "creation_date": 1557123721, "last_edit_date": 1557131123, "question_id": 55999756, "link": "https://stackoverflow.com/questions/55999756/test-after-create-commit-callback-using-shoulda-callback-matchers-gem-rails", "title": "Test after_create_commit callback using `shoulda-callback-matchers` gem + rails 5 + rspec", "body": "<p>I'm using <code>shoulda-callback-matchers</code> gem to test the callback. Rails version is 5.2.2 and RSpec version is 3.8.0.</p>\n\n<p>Anyone know how to test <code>after_create_commit</code> callback using <code>shoulda-callback-matchers</code> gem?</p>\n\n<p>It is working for <code>after_create</code> and <code>after_update</code>.</p>\n\n<p><strong>model code</strong></p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>after_create :admission_created_notification\nafter_update :admission_status_change_notification\n</code></pre>\n\n<p><strong>sample example</strong></p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>context \"callbacks\" do\n let(:admission) { create(:admission) }\n   it { expect(admission).to callback(:admission_created_notification).after(:create) }\n   it { expect(admission).to callback(:admission_status_change_notification).after(:update) }\nend\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "activerecord"], "answers": [{"comments": [{"owner": {"reputation": 357, "user_id": 5895099, "user_type": "registered", "accept_rate": 70, "profile_image": "https://lh5.googleusercontent.com/-hQxPXyUIfrs/AAAAAAAAAAI/AAAAAAAAHcA/uQo7eHJ-Dpk/photo.jpg?sz=128", "display_name": "ilrock", "link": "https://stackoverflow.com/users/5895099/ilrock"}, "edited": false, "score": 0, "creation_date": 1557139081, "post_id": 56001816, "comment_id": 98652716, "body": "Doesn&#39;t quite work that way either. Getting other errors -&gt; uninitialized constant Employee::EmailActivity"}, {"owner": {"reputation": 3902, "user_id": 10608621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d59df09a85d05117c63706f66811b70c?s=128&d=identicon&r=PG", "display_name": "mechnicov", "link": "https://stackoverflow.com/users/10608621/mechnicov"}, "reply_to_user": {"reputation": 357, "user_id": 5895099, "user_type": "registered", "accept_rate": 70, "profile_image": "https://lh5.googleusercontent.com/-hQxPXyUIfrs/AAAAAAAAAAI/AAAAAAAAHcA/uQo7eHJ-Dpk/photo.jpg?sz=128", "display_name": "ilrock", "link": "https://stackoverflow.com/users/5895099/ilrock"}, "edited": false, "score": 0, "creation_date": 1557139696, "post_id": 56001816, "comment_id": 98652979, "body": "@ilrock do you have migrations with polymorphic associations?"}], "tags": [], "owner": {"reputation": 3902, "user_id": 10608621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d59df09a85d05117c63706f66811b70c?s=128&d=identicon&r=PG", "display_name": "mechnicov", "link": "https://stackoverflow.com/users/10608621/mechnicov"}, "is_accepted": false, "score": 0, "last_activity_date": 1557132892, "creation_date": 1557132892, "answer_id": 56001816, "question_id": 55999021, "link": "https://stackoverflow.com/questions/55999021/how-can-i-create-a-double-polymorphic-association/56001816#56001816", "title": "How can I create a double polymorphic association", "body": "<p><code>has_many</code> hasn't <code>:polymorphic</code> key, so try this:</p>\n\n<pre><code># employee.rb, customer.rb, suppliee.rb\nhas_many :email_activities, as: :profile, dependent: :destroy\n\n\n# email_open.rb, email_bounce.rb, email_click.rb, etc.\nbelongs_to :profile, polymorphic: true, as: :email_activity\n</code></pre>\n"}], "owner": {"reputation": 357, "user_id": 5895099, "user_type": "registered", "accept_rate": 70, "profile_image": "https://lh5.googleusercontent.com/-hQxPXyUIfrs/AAAAAAAAAAI/AAAAAAAAHcA/uQo7eHJ-Dpk/photo.jpg?sz=128", "display_name": "ilrock", "link": "https://stackoverflow.com/users/5895099/ilrock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1557132892, "creation_date": 1557118929, "question_id": 55999021, "link": "https://stackoverflow.com/questions/55999021/how-can-i-create-a-double-polymorphic-association", "title": "How can I create a double polymorphic association", "body": "<p>I have three profile types in my Application:</p>\n\n<ul>\n<li>Employee</li>\n<li>Customer</li>\n<li>Suppliee (supplier's employee)</li>\n</ul>\n\n<p>And I have many different email trackings:</p>\n\n<ul>\n<li>EmailOpen</li>\n<li>EmailBounce</li>\n<li>EmailClick</li>\n<li>etc.</li>\n</ul>\n\n<p>There is a table for each of them and I would like to make a double polymorphic association such as that a profile can have many different email_activities and, an email_activity belongs_to a profile.</p>\n\n<p>Initially, there was just one single email tracking and thus the polymorphic association looked like this:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code># employee.rb, customer.rb, suppliee.rb\n\nhas_many :email_activities, as: :profile\n</code></pre>\n\n<pre class=\"lang-rb prettyprint-override\"><code># email_activity.rb\nbelongs_to :profile, polymorphic: true, optional: true\n</code></pre>\n\n<p>Now, however, there are many I would still like each profile to access them using email_activities through a polymorphic association.</p>\n\n<p>The code I have at the moment looks like this:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code># employee.rb, customer.rb, suppliee.rb\n\nhas_many :email_activities, polymorphic: true, as: :profile, dependent: :destroy\n</code></pre>\n\n<pre class=\"lang-rb prettyprint-override\"><code># email_open.rb, email_bounce.rb, email_click.rb, etc.\n\nbelongs_to :profile, polymorphic: true, as: :email_activity, optional: true\n</code></pre>\n\n<p>Whenever I try to access the email_activities for a profile, however, I get this error:</p>\n\n<pre><code>Unknown key: :polymorphic\n</code></pre>\n\n<p>I would imagine that the syntax I'm using doesn't quite work in this case. How can I get it to work?</p>\n"}, {"tags": ["sql", "ruby-on-rails", "ruby", "ruby-on-rails-5"], "answers": [{"tags": [], "owner": {"reputation": 741, "user_id": 6894749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gbstY.jpg?s=128&g=1", "display_name": "Thang", "link": "https://stackoverflow.com/users/6894749/thang"}, "is_accepted": false, "score": 2, "last_activity_date": 1557122551, "creation_date": 1557122551, "answer_id": 55999558, "question_id": 55998625, "link": "https://stackoverflow.com/questions/55998625/rails-has-many-through-query-with-two-references-aka-using-through-table-attrib/55999558#55999558", "title": "Rails has_many through query, with two references aka using through table attribute", "body": "<pre><code>User.includes(:members).where(members: { id: nil }).or(User.includes(:members).where.not(members: { squad_id: squad.id }))\n</code></pre>\n\n<p><strong>Explanation:</strong></p>\n\n<pre><code>User.includes(:members).where(members: { id: nil })\n</code></pre>\n\n<p>To query users that have no member record (belong to no squad)</p>\n\n<pre><code>User.includes(:members).where.not(members: { squad_id: squad.id })\n</code></pre>\n\n<p>To query users that do have member record but not member of the target squad.</p>\n"}, {"tags": [], "owner": {"reputation": 1580, "user_id": 4041883, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CE0SX.jpg?s=128&g=1", "display_name": "CAmador", "link": "https://stackoverflow.com/users/4041883/camador"}, "is_accepted": true, "score": 2, "last_activity_date": 1557122617, "creation_date": 1557122617, "answer_id": 55999564, "question_id": 55998625, "link": "https://stackoverflow.com/questions/55998625/rails-has-many-through-query-with-two-references-aka-using-through-table-attrib/55999564#55999564", "title": "Rails has_many through query, with two references aka using through table attribute", "body": "<p>Do you want to show the button if the logged user is not a member of each squad? If so...</p>\n\n<p><code>has_many</code> association provides the method <code>other_ids</code> which returns an array of the associated objects' ids (in your case <code>squad.user_ids</code>). So you can check if the current user's id is in that array:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>&lt;% @squads.each do |squad| %&gt;\n  &lt;td&gt;&lt;%= squad.name %&gt;&lt;/td&gt;\n  &lt;% unless squad.user_ids.include?(current_user.id) %&gt;\n  &lt;td&gt;&lt;%= link_to 'Join', join_squad_path(id: squad) %&gt;&lt;/td&gt;\n  &lt;% end %&gt;\n&lt;% end %&gt;\n</code></pre>\n"}], "owner": {"reputation": 137, "user_id": 3558514, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DKYS4.png?s=128&g=1", "display_name": "weteamsteve", "link": "https://stackoverflow.com/users/3558514/weteamsteve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 55999564, "answer_count": 2, "score": 1, "last_activity_date": 1557132034, "creation_date": 1557115295, "last_edit_date": 1557132034, "question_id": 55998625, "link": "https://stackoverflow.com/questions/55998625/rails-has-many-through-query-with-two-references-aka-using-through-table-attrib", "title": "Rails has_many through query, with two references aka using through table attribute", "body": "<p>I am looking for a way to query a model based on children in a has_many through association.</p>\n\n<p>I have these models</p>\n\n<pre><code>class User &lt; ApplicationRecord\n  has_many :members\n  has_many :squads, through: :members\nend\n\nclass Squad &lt; ApplicationRecord\n  has_many :members\n  has_many :users, through: :members\nend\n\nclass Member &lt; ApplicationRecord\n  belongs_to :user\n  belongs_to :squad\nend\n\n</code></pre>\n\n<p>I'm basically using the Member class to provide a relationship between User and Squad, so it can hold membership information such as role, position, number, .etc</p>\n\n<p>The goal is to have the <code>Member</code> model store <code>User</code> membership info as it relates to any <code>Squad</code>. A User can be an owner of one squad, be a member of another, and not be a member of yet another squad.</p>\n\n<p>I am trying to display a Join link in my index.html.erb for all User's that do not have any member connection to a squad.</p>\n\n<p>Currently, working with</p>\n\n<pre><code>&lt;% @squads.each do |squad| %&gt;\n  &lt;td&gt;&lt;%= squad.name %&gt;&lt;/td&gt;\n  &lt;% if Squad.includes(:members).where( 'members.user_id' =&gt; params[:users]).exists? %&gt;\n  &lt;td&gt;&lt;%= link_to 'Join', join_squad_path(:id =&gt; squad) %&gt;&lt;/td&gt;\n  &lt;% end %&gt;\n&lt;% end %&gt;\n</code></pre>\n\n<p>with the primary line being</p>\n\n<p><code>&lt;% if Squad.includes(:members).where( 'members.user_id' =&gt; params[:users]).exists? %&gt;</code></p>\n\n<p>also tried stuff such as</p>\n\n<ul>\n<li><p><code>User.includes(:squads, :members).where('squads.id = ? AND members.users = ?', squad, current_user)</code></p></li>\n<li><p><code>u = squad.users.includes(:member).where('member.user = ?', current_user)</code></p></li>\n<li><p><code>Member.where.not(\"squad = #{squad.id}\").find(user: current_user.id)</code></p></li>\n</ul>\n\n<p>I have an instance variable for each |squad| and have current_user.id available for the logged in user (using <a href=\"https://github.com/plataformatec/devise\" rel=\"nofollow noreferrer\">Devise</a>)</p>\n\n<p>Referencing <a href=\"https://guides.rubyonrails.org/v5.2/association_basics.html#the-has-many-through-association\" rel=\"nofollow noreferrer\">Ruby on Rails Guide: Association Basics - the has many through association</a></p>\n"}, {"tags": ["html", "ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1557112947, "post_id": 55997770, "comment_id": 98643603, "body": "On a side note, I would suggest the recommend <code>do end</code> syntax for your multi-line ERB so instead of ` &lt;% tags.each{|tag| %&gt;&lt;% } %&gt;`  you would do ` &lt;% tags.each do|tag| %&gt; your multi lines then &lt;% end %&gt;"}, {"owner": {"reputation": 19244, "user_id": 1978251, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73f7dd539ad8ec8372af0d06e4f76939?s=128&d=identicon&r=PG", "display_name": "engineersmnky", "link": "https://stackoverflow.com/users/1978251/engineersmnky"}, "edited": false, "score": 0, "creation_date": 1557158777, "post_id": 55997770, "comment_id": 98662910, "body": "The reason this does not work is because your arguments do not match the method signature <code>check_box_tag(name, value = &quot;1&quot;, checked = false, options = {})</code> I think you may have accidentally looked at <code>check_box</code> which is a form helper <code>check_box(object_name, method, options = {}, checked_value = &quot;1&quot;, unchecked_value = &quot;0&quot;)</code> in this case if called on the form object e.g. <code>f.checkbox</code> then your signature was correct"}], "answers": [{"tags": [], "owner": {"reputation": 39, "user_id": 11299870, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-JfDvBs1iq-c/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdWhs_ZtkXDdNGjpcDMVoubqWEsMQ/mo/photo.jpg?sz=128", "display_name": "Megan Foreman", "link": "https://stackoverflow.com/users/11299870/megan-foreman"}, "is_accepted": true, "score": 1, "last_activity_date": 1557106895, "creation_date": 1557106895, "answer_id": 55997877, "question_id": 55997770, "link": "https://stackoverflow.com/questions/55997770/how-can-i-fix-multiple-true-causing-undefined-method-stringify-keys-for-ni/55997877#55997877", "title": "How can I fix {:multiple =&gt; true} causing undefined method stringify_keys for nil:NilClass?", "body": "<p>I fixed the error, I ended up doing the following:</p>\n\n<pre><code>&lt;%= check_box_tag \"tag_ids[]\", tag.id, false, :id =&gt; \"tag_ids_#{tag.id}\" %&gt;\n</code></pre>\n\n<p>instead of doing the multiple => true this works instead.</p>\n"}], "owner": {"reputation": 39, "user_id": 11299870, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-JfDvBs1iq-c/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdWhs_ZtkXDdNGjpcDMVoubqWEsMQ/mo/photo.jpg?sz=128", "display_name": "Megan Foreman", "link": "https://stackoverflow.com/users/11299870/megan-foreman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 55997877, "answer_count": 1, "score": 0, "last_activity_date": 1557106895, "creation_date": 1557105525, "question_id": 55997770, "link": "https://stackoverflow.com/questions/55997770/how-can-i-fix-multiple-true-causing-undefined-method-stringify-keys-for-ni", "title": "How can I fix {:multiple =&gt; true} causing undefined method stringify_keys for nil:NilClass?", "body": "<p>I am attempting to create check boxes that will return an array of tag_ids so that I can search by them. In order to do this I think that I need to include {:multiple => true} to the check box but I am not certain as I am pretty new to Ruby on Rails. I am not sure why this causing this error to occur, but when I remove this chunk of code the error goes away. What do I need to include to make this work, or do I need to think of a different solution? Let me know if I need to include more code if what I have included isn't enough.</p>\n\n<p>(note: this code is not functional yet, just trying to fix this error)</p>\n\n<p>applist.erb:</p>\n\n<pre><code>   &lt;h2 class=\"ml-5\"&gt;Categories&lt;/h2&gt;\n      &lt;% tags = Tag.all %&gt;\n      &lt;%= form_tag(\"../welcome/tagsearch\", :method =&gt; \"get\") do%&gt;\n        &lt;% tags.each{|tag| %&gt;\n          &lt;div class=\"form-check ml-2\"&gt;\n            &lt;%= check_box_tag :tag_ids, {:multiple =&gt; true}, tag.id, nil%&gt;\n            &lt;label class=\"form-check-label\"&gt; &lt;%= tag.name %&gt;&lt;/label&gt;\n          &lt;/div&gt;\n        &lt;% } %&gt;\n        &lt;div class=\"input-group\"&gt;\n          &lt;div class=\"input-group-btn ml-1\"&gt;\n            &lt;div class=\"input-group-btn\"&gt;\n              &lt;%= button_tag(:class =&gt; 'btn btn-dark',:name =&gt; nil) do%&gt;\n                Submit\n              &lt;% end %&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;% end %&gt;\n    &lt;/div&gt;\n    &lt;div class=\"col-8\"&gt;\n</code></pre>\n\n<p>Error:\nundefined method `stringify_keys' for nil:NilClass</p>\n"}, {"tags": ["ruby", "rspec", "circleci"], "answers": [{"tags": [], "owner": {"reputation": 3192, "user_id": 1195276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/497dec1748b2912be9b7272c4a6ea496?s=128&d=identicon&r=PG", "display_name": "FelicianoTech", "link": "https://stackoverflow.com/users/1195276/felicianotech"}, "is_accepted": false, "score": 0, "last_activity_date": 1557170139, "creation_date": 1557170139, "answer_id": 56011092, "question_id": 55997392, "link": "https://stackoverflow.com/questions/55997392/why-do-circleci-variants-not-appear-to-work-when-combined-cannot-get-firefox-ge/56011092#56011092", "title": "Why do CircleCI variants not appear to work when combined? Cannot get Firefox Geckodriver to work", "body": "<p>Older patch releases don't get published on Docker Hub after a certain point. If you want the latest software available in variant images such as <code>-browser</code>, you need to use a later version of Ruby 2.4 such as 2.4.6. For example, this image <code>circleci/ruby:2.4.6-browsers</code>.</p>\n\n<p>If for whatever reason you can't do that, take the CircleCI Ruby 2.4.1 image, the standard version not the variant, and then build your own Docker image for that that has the software you need in it.</p>\n"}], "owner": {"reputation": 84135, "user_id": 631619, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/b6f3159af5195eddff62a2dd4f9ad969?s=128&d=identicon&r=PG", "display_name": "Michael Durrant", "link": "https://stackoverflow.com/users/631619/michael-durrant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 55, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1557401396, "creation_date": 1557100614, "last_edit_date": 1557401396, "question_id": 55997392, "link": "https://stackoverflow.com/questions/55997392/why-do-circleci-variants-not-appear-to-work-when-combined-cannot-get-firefox-ge", "title": "Why do CircleCI variants not appear to work when combined? Cannot get Firefox Geckodriver to work", "body": "<p>Using Ruby <code>2.4.0</code> and <code>2.4.1</code>, I cannot get CircleCI to recognize the Language image variants, other than <code>-browsers</code>, e.g. the stated variants of <code>-browsers-legacy</code> etc say manifest ... not found.</p>\n\n<p><a href=\"https://circleci.com/docs/2.0/circleci-images/#ruby\" rel=\"nofollow noreferrer\">https://circleci.com/docs/2.0/circleci-images/#ruby</a></p>\n\n<p>Because of this I cannot seem to get past an issue with Firefox tests not starting Firefox in CircleCI.  It works if I base my Circle config image <code>ruby-2.6.2-browsers</code> but locally I've been unable to install Ruby version <code>2.6.2</code> as my rbenv says definition not found for <code>2.6.2</code></p>\n\n<p>However when using <code>2.4.1</code> in CircleCI I get <code>Net::ReadTimeout</code> as Firefox doesn't respond (but Chrome does).</p>\n\n<p>When I switch CircleCI to be based on an image of <code>2.6.2-browsers</code> both Firefox and Chrome work ok.</p>\n\n<p>So currently I have to have my local Ruby be <code>2.4.0</code> (in my Gemnfile) as when I try <code>rbenv install 2.6.2</code> (for the version that works in CircleCI) it says image definition not found</p>\n\n<p>Is there a way to get my local environment and CircleCI environment using the same version of Ruby ?</p>\n\n<p>For now I am having to have </p>\n\n<ul>\n<li>local be <code>2.4.1</code> (in <code>.ruby-version</code> file)</li>\n<li><code>.circleci/config</code> file having <code>image: circleci/ruby:2.6.2-browsers</code></li>\n</ul>\n\n<p>While trying to get this right I've also encountered</p>\n\n<ul>\n<li>new webdrivers gem had issues and I had to go back to older gems for now</li>\n<li>Firefox unable to start</li>\n<li>other issues</li>\n<li>unable to have Ruby version specified inside my Gemfile as different environments have different versions (I'm avoiding any kind of variable for now)</li>\n</ul>\n\n<p>I'm not listing these in details here to resolve but to indicate these environments are a bit fragile right now with multiple issuers affecting what works where depending on</p>\n\n<ul>\n<li>OS version</li>\n<li>Ruby version</li>\n<li>image versions</li>\n<li>Firefox versions</li>\n</ul>\n"}, {"tags": ["ruby", "vagrant", "google-compute-engine"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 4833901, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7f045a6abea62934c3f6abb079b1fb0?s=128&d=identicon&r=PG&f=1", "display_name": "Hopentu", "link": "https://stackoverflow.com/users/4833901/hopentu"}, "edited": false, "score": 0, "creation_date": 1557103609, "post_id": 55997467, "comment_id": 98642149, "body": "Yes, I did try. I think it doesn&#39;t work with GCP. It gives me:   <code>==&gt; default: Warning! The Google provider doesn&#39;t support any of the Vagrant ==&gt; default: high-level network configurations (</code>config.vm.network<code>). They ==&gt; default: will be silently ignored.</code>"}], "tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": false, "score": 0, "last_activity_date": 1557101781, "creation_date": 1557101781, "answer_id": 55997467, "question_id": 55997376, "link": "https://stackoverflow.com/questions/55997376/how-to-allow-http-traffic-and-port-27017-on-gce-instance-with-vagrant/55997467#55997467", "title": "How to allow HTTP traffic and port 27017 on GCE instance with vagrant?", "body": "<p>Did you check the vagrant <a href=\"https://www.vagrantup.com/docs/networking/forwarded_ports.html#defining-a-forwarded-port\" rel=\"nofollow noreferrer\">documentation on forwarded ports</a>?</p>\n\n<p>Should be something like:</p>\n\n<pre><code>Vagrant.configure(\"2\") do |config|\n  config.vm.box = \"google/gce\"\n  config.vm.network \"forwarded_port\", guest: 80, host: 27017\n  #... rest of your config\nend\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 4833901, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7f045a6abea62934c3f6abb079b1fb0?s=128&d=identicon&r=PG&f=1", "display_name": "Hopentu", "link": "https://stackoverflow.com/users/4833901/hopentu"}, "is_accepted": false, "score": 0, "last_activity_date": 1557126477, "creation_date": 1557126477, "answer_id": 56000306, "question_id": 55997376, "link": "https://stackoverflow.com/questions/55997376/how-to-allow-http-traffic-and-port-27017-on-gce-instance-with-vagrant/56000306#56000306", "title": "How to allow HTTP traffic and port 27017 on GCE instance with vagrant?", "body": "<p>Adding network tags does the job.</p>\n\n<p><code>google.tags = ['http-server']</code></p>\n"}, {"tags": [], "owner": {"reputation": 186, "user_id": 11460405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c43a090dfcd309cd60440629c8b26d8?s=128&d=identicon&r=PG&f=1", "display_name": "Ariel Palacios", "link": "https://stackoverflow.com/users/11460405/ariel-palacios"}, "is_accepted": false, "score": 1, "last_activity_date": 1557540622, "creation_date": 1557540622, "answer_id": 56086636, "question_id": 55997376, "link": "https://stackoverflow.com/questions/55997376/how-to-allow-http-traffic-and-port-27017-on-gce-instance-with-vagrant/56086636#56086636", "title": "How to allow HTTP traffic and port 27017 on GCE instance with vagrant?", "body": "<p>you will have to add a firewall rule and add a \"target tag\" on it e.g. test-1, then on your vagrant file you will have to  use this line google.tags = ['test-1'] </p>\n\n<p>Vagrant.configure(\"2\") do |config|\n    config.vm.box = \"google/gce\"</p>\n\n<pre><code>config.ssh.forward_agent = true\n\nconfig.vm.provider :google do |google, override|\n  google.google_project_id = \"projectxx\"\n  google.google_client_email = \"xx-compute@developer.gserviceaccount.com\"\n  google.google_json_key_location = \"~/gcp_service_keys/xx.json\"\n  google.name = \"namex\"\n  google.zone = \"us-central1-c\"      \n  google.image_family = 'ubuntu-1804-lts'\n  google.tags = ['test-1'] &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;\n\n  override.ssh.username = \"me\"\n  override.ssh.private_key_path = \"~/.ssh/gce\"      \nend\n\nconfig.vm.provision :shell, path: \"install.sh\"\n</code></pre>\n\n<p>end</p>\n"}], "owner": {"reputation": 11, "user_id": 4833901, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7f045a6abea62934c3f6abb079b1fb0?s=128&d=identicon&r=PG&f=1", "display_name": "Hopentu", "link": "https://stackoverflow.com/users/4833901/hopentu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1557540622, "creation_date": 1557100382, "question_id": 55997376, "link": "https://stackoverflow.com/questions/55997376/how-to-allow-http-traffic-and-port-27017-on-gce-instance-with-vagrant", "title": "How to allow HTTP traffic and port 27017 on GCE instance with vagrant?", "body": "<p>I created a MongoDB GCE instance using Vagrantfile. Then enabled 'Allow HTTP traffic' and added protocol:port tcp:27017 using the console. Everything works fine, but I want to avoid using the console.\nCan anyone help me enable 'Allow HTTP traffic' and add 'port tcp:27017' with Vagrantfile?</p>\n\n<p>Here is part of my Vagrantfile:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>Vagrant.configure(\"2\") do |config|\n    config.vm.box = \"google/gce\"\n\n    config.ssh.forward_agent = true\n\n    config.vm.provider :google do |google, override|\n      google.google_project_id = \"projectxx\"\n      google.google_client_email = \"xx-compute@developer.gserviceaccount.com\"\n      google.google_json_key_location = \"~/gcp_service_keys/xx.json\"\n      google.name = \"namex\"\n      google.zone = \"us-central1-c\"      \n      google.image_family = 'ubuntu-1804-lts'\n\n      override.ssh.username = \"me\"\n      override.ssh.private_key_path = \"~/.ssh/gce\"      \n    end\n\n    config.vm.provision :shell, path: \"install.sh\"\nend\n</code></pre>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1557097771, "post_id": 55997171, "comment_id": 98641272, "body": "Indentation, please. That code is slammed left and it&#39;s barely readable as-is."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1557097863, "post_id": 55997171, "comment_id": 98641287, "body": "I think you&#39;re walking off the end of the array here. You&#39;re testing <code>array[yi][xi]</code> and then go ahead and presume <code>array[yi+1]</code> exists, which it may not."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1557098068, "post_id": 55997171, "comment_id": 98641318, "body": "Note: Ruby is a case-sensitive language and capital letters have specific meaning in terms of syntax. Variables and method names should be lower-case letters. Capitals indicate constants of the form  <code>ClassName</code> or <code>CONSTANT_NAME</code>."}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1557103117, "post_id": 55997171, "comment_id": 98642078, "body": "To format code within a paragraph surround it with backticks (<code>`</code>). To format a block of code, indent 4 spaces or select all the code and click on the icon <code>{}</code>."}], "answers": [{"tags": [], "owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "is_accepted": false, "score": 1, "last_activity_date": 1557098104, "creation_date": 1557098104, "answer_id": 55997209, "question_id": 55997171, "link": "https://stackoverflow.com/questions/55997171/error-when-searching-through-2d-array-ruby/55997209#55997209", "title": "error when searching through 2d array ruby", "body": "<p>You can solve a lot of problems here by simplifying this code using <a href=\"https://ruby-doc.org/core-2.5.0/Array.html#method-i-dig\" rel=\"nofollow noreferrer\"><code>dig</code></a>:</p>\n\n<pre><code>def search_array(array)\n  array.each_with_index do |y, yi|\n    y.each_with_index do |x, xi|\n      stack = (0..2).map { |o| array.dig(yi + o, xi) }\n\n      if (stack == [ 1, 1, 1 ])\n        return [ yi - 1, xi ]\n      end\n    end\n  end\nend\n</code></pre>\n\n<p>Where <code>dig</code> can poke around and not cause exceptions if it misses the end of the array. Here <code>map</code> is used to quickly pull out an <em>N</em> high stack. You can do <code>1..2</code> or <code>0..4</code> or whatever is necessary.</p>\n"}, {"comments": [{"owner": {"reputation": 3, "user_id": 11453624, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4jLlXTG_SNM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdeBLjpsLy-1rxCm3KuMJP9JmA-mg/mo/photo.jpg?sz=128", "display_name": "SerenityNow13", "link": "https://stackoverflow.com/users/11453624/serenitynow13"}, "edited": false, "score": 0, "creation_date": 1557195704, "post_id": 55999233, "comment_id": 98673644, "body": "Hi, great explanation. Really liking the first explanation. How would you make this work horizontally?(to get the next column that needs to be placed horizontally) I&#39;m a beginner and this is helping me alot! thank you"}, {"owner": {"reputation": 3, "user_id": 11453624, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4jLlXTG_SNM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdeBLjpsLy-1rxCm3KuMJP9JmA-mg/mo/photo.jpg?sz=128", "display_name": "SerenityNow13", "link": "https://stackoverflow.com/users/11453624/serenitynow13"}, "edited": false, "score": 0, "creation_date": 1557196810, "post_id": 55999233, "comment_id": 98673801, "body": "return [i,j] if array[i][j].nil? &amp;&amp; [1,2,3].all? { |k| array[i][j-k] == 1 } this is working for me"}, {"owner": {"reputation": 3, "user_id": 11453624, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4jLlXTG_SNM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdeBLjpsLy-1rxCm3KuMJP9JmA-mg/mo/photo.jpg?sz=128", "display_name": "SerenityNow13", "link": "https://stackoverflow.com/users/11453624/serenitynow13"}, "edited": false, "score": 0, "creation_date": 1557197422, "post_id": 55999233, "comment_id": 98673913, "body": "my problem is when using a bigger grid and checking 3 in a row horizontal to the right it works but when I wanna check them to the left its not working like so"}, {"owner": {"reputation": 3, "user_id": 11453624, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4jLlXTG_SNM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdeBLjpsLy-1rxCm3KuMJP9JmA-mg/mo/photo.jpg?sz=128", "display_name": "SerenityNow13", "link": "https://stackoverflow.com/users/11453624/serenitynow13"}, "edited": false, "score": 0, "creation_date": 1557197461, "post_id": 55999233, "comment_id": 98673921, "body": "<code>grid4 = [   [nil,nil,nil,nil,1,1,1],   [nil,nil,nil,nil,nil,nil,nil],   [nil,nil,nil,nil,nil,nil,nil],   [nil,nil,nil,nil,nil,nil,nil],   [nil,nil,nil,nil,nil,nil,nil],   [nil,nil,nil,nil,nil,nil,nil] ]</code>"}, {"owner": {"reputation": 3, "user_id": 11453624, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4jLlXTG_SNM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdeBLjpsLy-1rxCm3KuMJP9JmA-mg/mo/photo.jpg?sz=128", "display_name": "SerenityNow13", "link": "https://stackoverflow.com/users/11453624/serenitynow13"}, "edited": false, "score": 0, "creation_date": 1557197534, "post_id": 55999233, "comment_id": 98673940, "body": "in this case I would need to use return [i,j] if array[i][j].nil? &amp;&amp; [1,2,3].all? { |k| array[i][j+k] == 1 } on the last line to catch this way how can i combine this with this return [i,j] if array[i][j].nil? &amp;&amp; [1,2,3].all? { |k| array[i][j-k] == 1 } to check for both ways?"}, {"owner": {"reputation": 3, "user_id": 11453624, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4jLlXTG_SNM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdeBLjpsLy-1rxCm3KuMJP9JmA-mg/mo/photo.jpg?sz=128", "display_name": "SerenityNow13", "link": "https://stackoverflow.com/users/11453624/serenitynow13"}, "edited": false, "score": 0, "creation_date": 1557197840, "post_id": 55999233, "comment_id": 98673998, "body": "def search_array_horiz(array)   (0..array.size-4).each do |i|     (0..array.first.size-1).each do |j|       if array[i][j].nil? &amp;&amp; [1,2,3].all? { |k| array[i][j-k] == 1 }       return [i,j]       elsif array[i][j].nil? &amp;&amp; [1,2,3].all? { |k| array[i][j+k] == 1 }       return [i,j]       end     end   end   nil end"}, {"owner": {"reputation": 3, "user_id": 11453624, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4jLlXTG_SNM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdeBLjpsLy-1rxCm3KuMJP9JmA-mg/mo/photo.jpg?sz=128", "display_name": "SerenityNow13", "link": "https://stackoverflow.com/users/11453624/serenitynow13"}, "edited": false, "score": 0, "creation_date": 1557198428, "post_id": 55999233, "comment_id": 98674103, "body": "wow that works the <code>search_array(array.transpose).reverse</code> not sure what transformation? also with this I get an undefined method reverse error when the grid is filled with only nils. thank you"}, {"owner": {"reputation": 3, "user_id": 11453624, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4jLlXTG_SNM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdeBLjpsLy-1rxCm3KuMJP9JmA-mg/mo/photo.jpg?sz=128", "display_name": "SerenityNow13", "link": "https://stackoverflow.com/users/11453624/serenitynow13"}, "edited": false, "score": 0, "creation_date": 1557199220, "post_id": 55999233, "comment_id": 98674239, "body": "<code>search_array(array.transpose.reverse)&amp;.reverse</code> this seems to work"}, {"owner": {"reputation": 3, "user_id": 11453624, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4jLlXTG_SNM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdeBLjpsLy-1rxCm3KuMJP9JmA-mg/mo/photo.jpg?sz=128", "display_name": "SerenityNow13", "link": "https://stackoverflow.com/users/11453624/serenitynow13"}, "edited": false, "score": 0, "creation_date": 1557200202, "post_id": 55999233, "comment_id": 98674425, "body": "it&#39;s ok, still trying to work at it. Thank you so much"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "reply_to_user": {"reputation": 3, "user_id": 11453624, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4jLlXTG_SNM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdeBLjpsLy-1rxCm3KuMJP9JmA-mg/mo/photo.jpg?sz=128", "display_name": "SerenityNow13", "link": "https://stackoverflow.com/users/11453624/serenitynow13"}, "edited": false, "score": 0, "creation_date": 1557239898, "post_id": 55999233, "comment_id": 98693804, "body": "See my updated answer. I&#39;ve deleted all my comments (and will delete this one after you&#39;ve seen it) because they dealt with a flawed suggestion for checking values horizontally. You may want to the same."}], "tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": true, "score": 0, "last_activity_date": 1557204847, "last_edit_date": 1557204847, "creation_date": 1557120252, "answer_id": 55999233, "question_id": 55997171, "link": "https://stackoverflow.com/questions/55997171/error-when-searching-through-2d-array-ruby/55999233#55999233", "title": "error when searching through 2d array ruby", "body": "<p>Let's take a look at your code, simplified slightly<sup>1</sup>:</p>\n\n<pre><code>def search_array(array)\n  array.each_with_index do |y, yi|\n    y.each_with_index do |x, xi|\n      return [yi-1, xi] if x != nil &amp;&amp; x == array[yi+1][xi] &amp;&amp; x == array[yi+2][xi]\n    end\n  end\nend\n</code></pre>\n\n<p>You go one row at a time, then for each element in that row, check if that element is not <code>nil</code> and if so, determine whether the two elements below it have the same non-nil value. If you reach the penultimate (next-to-last) row, <code>yi = array.size - 2</code>, you will compare <code>x</code> with <code>array[yi+2][xi]</code>, which equals <code>array[array.size][xi]</code>, which in turn equals <code>nil[xi]</code>. However, <code>nil</code> has no method <code>[]</code> so an <em>undefined method</em> exception is raised. Pay close attention to those error messages; often, as here, they guide you to the error.</p>\n\n<p>Another problem is that if you found <code>1</code>'s in the first three rows of a column <code>j</code> you would return the index <code>[-1, j]</code>, <code>-1</code> being <code>0-1</code>. You don't want that either.</p>\n\n<p>I understand that you also wish to determine if dropping a coin in a column results in four-in-a-row horizontally. You could check both vertically and horizontally as follows.</p>\n\n<pre><code>def search_array(arr)\n  arr.first.each_index do |j|\n    r = arr.each_index.find { |i| arr[i][j] == 1 }\n    next if r == 0\n    r = r.nil? ? arr.size-1 : r-1\n    return [r,j] if below?(arr,r,j) || left?(arr,r,j) || right?(arr,r,j)\n  end\n  nil\nend\n\ndef below?(arr,r,j)\n  r &lt; arr.size-3 &amp;&amp; (1..3).all? { |i| arr[r+i][j] == 1 }\nend\n\ndef right?(arr,r,j)\n  j &lt; arr.first.size-3 &amp;&amp; (1..3).all? { |i| arr[r][j+i] == 1 }\nend\n\ndef left?(arr,r,j)\n  j &gt;= 3 &amp;&amp; (1..3).all? { |i| arr[r][j-i] == 1 }\nend\n</code></pre>\n\n<h1><p></p></h1>\n\n<pre><code>grid4 = [\n  [nil, nil, nil, nil, nil],\n  [nil, nil, nil, nil, nil],\n  [nil, nil,   1, nil, nil],\n  [nil, nil,   1,   1,   1],\n  [  1,   1,   1, nil,   1]\n]\n\ngrid5 = [\n  [nil, nil, nil, nil, nil],\n  [nil, nil, nil, nil, nil],\n  [nil, nil,   1, nil, nil],\n  [nil,   1,   1, nil, nil],\n  [nil,   1,   1, nil,   1]\n]\n</code></pre>\n\n<h1><p></p></h1>\n\n<pre><code>search_array grid1 #=&gt; [0, 0] (vertical)\nsearch_array grid2 #=&gt; [0, 2] (vertical)\nsearch_array grid3 #=&gt; nil\nsearch_array grid4 #=&gt; [3, 1] (horizontal)\nsearch_array grid5 #=&gt; [1, 2] (vertical)\n</code></pre>\n\n<p>Note that if you wish to also check for four-in-a-row diagonnal you could change:</p>\n\n<pre><code>return [r,j] if below?(arr,r,j) || left?(arr,r,j) || right?(arr,r,j)\n</code></pre>\n\n<p>to</p>\n\n<pre><code>return [r,j] if below?(arr,r,j) || left?(arr,r,j) || right?(arr,r,j) ||\n  top_left_to_bottom_right?(arr,r,j) || bottom_left_to_top_right?(arr,r,j)\n</code></pre>\n\n<p>and add the additional methods <code>top_left_to_bottom_right?</code> and <code>bottom_left_to_top_right?</code>.</p>\n\n<p><sup>1. I changed the name of your method to <code>search_array</code> because Ruby has a convention to use <a href=\"https://en.wikipedia.org/wiki/Snake_case\" rel=\"nofollow noreferrer\">snake case</a> for the naming of variables and methods. You don't have to adopt that convention but 99%+ of Rubiests do.</sup></p>\n"}, {"tags": [], "owner": {"reputation": 9663, "user_id": 5239030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/76JEw.png?s=128&g=1", "display_name": "iGian", "link": "https://stackoverflow.com/users/5239030/igian"}, "is_accepted": false, "score": 0, "last_activity_date": 1557121188, "creation_date": 1557121188, "answer_id": 55999365, "question_id": 55997171, "link": "https://stackoverflow.com/questions/55997171/error-when-searching-through-2d-array-ruby/55999365#55999365", "title": "error when searching through 2d array ruby", "body": "<p>I could suggest a slight different approach, this is not a complete solution, just a start. It should also help to catch the four.</p>\n\n<p>First map the not <code>nil</code> indexes of the grid, let's consider <code>grid3</code>:</p>\n\n<pre><code>mapping = grid3.flat_map.with_index{ |y, yi| y.map.with_index { |x, xi| [xi, yi] if x }.compact }\n#=&gt; [[0, 3], [1, 3], [2, 3]]\n</code></pre>\n\n<p>Then group by first and second element to get the columns and rows:</p>\n\n<pre><code>cols = mapping.group_by(&amp;:first) #=&gt; {0=&gt;[[0, 3]], 1=&gt;[[1, 3]], 2=&gt;[[2, 3]]}\nrows = mapping.group_by(&amp;:last) #=&gt; {3=&gt;[[0, 3], [1, 3], [2, 3]]}\n</code></pre>\n\n<p>Now, if you want to look for three elements in a row or in a column:</p>\n\n<pre><code>cols.keep_if { |_,v| v.size == 3 } #=&gt; {}\nrows.keep_if { |_,v| v.size == 3 } #=&gt; {3=&gt;[[0, 3], [1, 3], [2, 3]]}\n</code></pre>\n\n<p>The first line says there are no columns with three element aligned.\nThe second line says that row with index 3 has three elements aligned and indexes are <code>[[0, 3], [1, 3], [2, 3]]</code>.</p>\n\n<p><hr>\nNext step it to check that there are no gaps amongst elements. For example in a 4x4 grid you could get also <code>[[0, 3], [1, 3], [3, 3]]</code> which are three elements, but there is a gap in <code>[2, 3]</code>,</p>\n"}], "owner": {"reputation": 3, "user_id": 11453624, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4jLlXTG_SNM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdeBLjpsLy-1rxCm3KuMJP9JmA-mg/mo/photo.jpg?sz=128", "display_name": "SerenityNow13", "link": "https://stackoverflow.com/users/11453624/serenitynow13"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 55999233, "answer_count": 3, "score": 0, "last_activity_date": 1557204847, "creation_date": 1557097552, "last_edit_date": 1557098100, "question_id": 55997171, "link": "https://stackoverflow.com/questions/55997171/error-when-searching-through-2d-array-ruby", "title": "error when searching through 2d array ruby", "body": "<p>I have the following grids (connect four)</p>\n\n<pre><code>grid1 = [\n  [nil, nil, nil],\n  [1, nil, nil],\n  [1, nil, nil],\n  [1, nil, nil]\n]\ngrid2 = [\n  [nil, nil, nil],\n  [nil, nil, 1],\n  [nil, nil, 1],\n  [nil, nil, 1]\n]\n\ngrid3 = [\n  [nil, nil, nil],\n  [nil, nil, nil],\n  [nil, nil, nil],\n  [1, 1, 1]\n]\n</code></pre>\n\n<p>and this is the method I created to find three 1's in a vertical row and return the next available slot above</p>\n\n<pre><code>def searchArray(array)\n  array.each_with_index do |y, yi|\n    y.each_with_index do |x, xi|\n      if array[yi][xi] != nil &amp;&amp; array[yi][xi] == array[yi+1][xi] &amp;&amp; array[yi][xi] == array[yi+2][xi]\n        return v = [yi-1, xi]\n      end\n    end\n  end\nend\n\n\nsearchArray(grid2)\n</code></pre>\n\n<p>When I call the method on grid1, and grid 2 it works great but when I call it on Grid 3 the grid where the 1's are placed on the bottom row I get this error </p>\n\n<pre><code>undefined method `[]' for nil:NilClass\n(repl):28:in `block (2 levels) in searchArray'\n(repl):27:in `each'\n(repl):27:in `each_with_index'\n(repl):27:in `block in searchArray'\n(repl):26:in `each'\n(repl):26:in `each_with_index'\n(repl):26:in `searchArray'\n(repl):36:in `&lt;main&gt;'\n</code></pre>\n\n<p>Not sure what's going on\nThanks</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "searchkick"], "comments": [{"owner": {"reputation": 893, "user_id": 3394889, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a3c58b23ce03f0e71522820d13404d5a?s=128&d=identicon&r=PG&f=1", "display_name": "The Wizard", "link": "https://stackoverflow.com/users/3394889/the-wizard"}, "edited": false, "score": 0, "creation_date": 1557097990, "post_id": 55997089, "comment_id": 98641307, "body": "Can you please provide a backtrace"}, {"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1557103733, "post_id": 55997089, "comment_id": 98642163, "body": "do you have a large amount of data to renidex? Do you expect it to run quickly or take a long time?"}, {"owner": {"reputation": 2489, "user_id": 8122487, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5782932caf3a7e16ff702705ff8c0a1d?s=128&d=identicon&r=PG&f=1", "display_name": "RaphaMex", "link": "https://stackoverflow.com/users/8122487/raphamex"}, "reply_to_user": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "edited": false, "score": 0, "creation_date": 1557103806, "post_id": 55997089, "comment_id": 98642174, "body": "@lacostenycoder: yes it&#39;s quite large, it can take 8 hours"}], "answers": [{"comments": [{"owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "reply_to_user": {"reputation": 2489, "user_id": 8122487, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5782932caf3a7e16ff702705ff8c0a1d?s=128&d=identicon&r=PG&f=1", "display_name": "RaphaMex", "link": "https://stackoverflow.com/users/8122487/raphamex"}, "edited": false, "score": 0, "creation_date": 1557153244, "post_id": 55997889, "comment_id": 98660058, "body": "@RaphaMex when working on any kind of data modification, it&#39;s always a good idea to approach the problem in a way which supports zero downtime and requires the least amount of manual process if any at all.  When something is going to take a long time, workers are your friends. Let me know if this works for you."}], "tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": false, "score": 2, "last_activity_date": 1557147450, "last_edit_date": 1557147450, "creation_date": 1557107031, "answer_id": 55997889, "question_id": 55997089, "link": "https://stackoverflow.com/questions/55997089/create-index-with-new-searchkick-options-in-rails-console/55997889#55997889", "title": "Create index with new searchkick options in rails console", "body": "<p>I would suggest doing this in a worker and you can use perhaps a Config model variable or Redis cahce to set up your model to be ready to use the new index once it's promoted.</p>\n\n<pre><code>class UpdateProductIndexWorker\n  include Sidekiq::Worker\n  sidekiq_options retry: 0\n\n  def peform\n    #patch your product model for this job\n    class Product\n      searchkick text_middle: [:name, :item_volume]\n    end\n    # track status of reindex\n    Searchkick.redis = Redis.new \n    new_index = Product.reindex(async: true)\n    index_name = new_index['index_name']  \n    loop do\n      break if Searchkick.reindex_status(index_name)[:completed]\n      sleep 60 # or however long you want to interval check\n    end\n    # You'll need to tell your app somehow to use new index\n    # You could use perhaps a Config model which could be something\n    # you could store in the database for exmaple:\n    # Config.create(name: 'use_new_products_index', state: true)\n    # or use redis assuming it's your Rails cache\n    Rails.cache.write('use_new_product_index', true, expires_in: 1.year)  \n    # now you can just use the new index\n    Product.searchkick_index.promote(index_name)\n  end\nend\n</code></pre>\n\n<h3>Update your model to use new index when it's ready.</h3>\n\n<pre><code>class Product &lt; ApplicationRecord\n\n  def self.use_new_index?\n    # Config.find_by(name: 'use_new_products_index').try(:state)\n    # or use Rails/redis cachea\n    Rails.cache.read('use_new_product_index')\n  end\n  # use the config data to make the model backward compatable until\n  # the new index is ready.  Later you'll remove this in a cleanup deploy.\n  if Product.use_new_index?\n    searchkick text_middle: [:name, :item_volume]\n  else\n    searchkick\n  end\nend\n</code></pre>\n"}], "owner": {"reputation": 2489, "user_id": 8122487, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5782932caf3a7e16ff702705ff8c0a1d?s=128&d=identicon&r=PG&f=1", "display_name": "RaphaMex", "link": "https://stackoverflow.com/users/8122487/raphamex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 898, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1557147450, "creation_date": 1557096579, "last_edit_date": 1557098286, "question_id": 55997089, "link": "https://stackoverflow.com/questions/55997089/create-index-with-new-searchkick-options-in-rails-console", "title": "Create index with new searchkick options in rails console", "body": "<p>I am looking for a way to seamlessly update my Elasticsearch index.</p>\n\n<p>I am moving from:</p>\n\n<pre><code>class Product &lt; ApplicationRecord\n  searchkick\nend\n</code></pre>\n\n<p>To:</p>\n\n<pre><code>class Product &lt; ApplicationRecord\n  searchkick text_middle: [:name, :item_volume]\nend\n</code></pre>\n\n<p>My current idea is to</p>\n\n<ol>\n<li>open a rails console on target environment</li>\n<li>update searchkick options of my Product class as above</li>\n<li>create new index with <code>Product.reindex(async: true)</code></li>\n<li>promote the new index once my app is deployed with <code>Product.search_index.promote(index_name)</code>.</li>\n</ol>\n\n<p>Unfortunately, when doing that, searchkick won't let me change the options and raises:</p>\n\n<blockquote>\n  <p>RuntimeError (Only call searchkick once per model)</p>\n</blockquote>\n\n<p>Any idea?</p>\n\n<hr>\n\n<pre><code>Traceback (most recent call last):\n       10: from bin/rails:9:in `&lt;main&gt;'\n        9: from bin/rails:9:in `require'\n        8: from /app/vendor/bundle/ruby/2.5.0/gems/railties-4.2.11/lib/rails/commands.rb:17:in `&lt;top (required)&gt;'\n        7: from /app/vendor/bundle/ruby/2.5.0/gems/railties-4.2.11/lib/rails/commands/commands_tasks.rb:39:in `run_command!'\n        6: from /app/vendor/bundle/ruby/2.5.0/gems/railties-4.2.11/lib/rails/commands/commands_tasks.rb:68:in `console'\n        5: from /app/vendor/bundle/ruby/2.5.0/gems/railties-4.2.11/lib/rails/commands/console.rb:9:in `start'\n        4: from /app/vendor/bundle/ruby/2.5.0/gems/railties-4.2.11/lib/rails/commands/console.rb:110:in `start'\n        3: from (irb):1\n        2: from (irb):8:in `&lt;class:Product&gt;'\n        1: from /app/vendor/bundle/ruby/2.5.0/gems/searchkick-2.5.0/lib/searchkick/model.rb:11:in `searchkick'\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "postgresql", "activerecord", "ruby-on-rails-5"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1557096555, "post_id": 55996877, "comment_id": 98641068, "body": "You need to do <code>SELECT account, SUM(...) WHERE account IN (&#39;asset&#39;, &#39;liability&#39;, ...) GROUP BY account</code> as this could be a one-shot statement. Rails supports this by using an array in a  <code>where(account: [ &#39;asset&#39;, ... ])</code> type scope."}, {"owner": {"reputation": 11394, "user_id": 794481, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/344337b6819f2f513fa80bb227be3c2d?s=128&d=identicon&r=PG", "display_name": "Tallboy", "link": "https://stackoverflow.com/users/794481/tallboy"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1557096958, "post_id": 55996877, "comment_id": 98641135, "body": "I just realized this literally a minute ago \ud83e\udd26\ud83c\udffb\u200d\u2642\ufe0fits because a valid transaction is getting added as its doing the selects individually. If you mark it as an answer ill put it, perhaps you could put the actual syntax. Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 11394, "user_id": 794481, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/344337b6819f2f513fa80bb227be3c2d?s=128&d=identicon&r=PG", "display_name": "Tallboy", "link": "https://stackoverflow.com/users/794481/tallboy"}, "edited": false, "score": 0, "creation_date": 1557097487, "post_id": 55997149, "comment_id": 98641215, "body": "I have seen errors that pluck(&#39;custom SQL&#39;) will be deprecated, do you know another way to do it? I originally was going to do something similar"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "reply_to_user": {"reputation": 11394, "user_id": 794481, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/344337b6819f2f513fa80bb227be3c2d?s=128&d=identicon&r=PG", "display_name": "Tallboy", "link": "https://stackoverflow.com/users/794481/tallboy"}, "edited": false, "score": 1, "creation_date": 1557097647, "post_id": 55997149, "comment_id": 98641243, "body": "Yeah, they&#39;ve been discouraging that practice, but I&#39;m not sure off the top of the best way to do that in newer Rails. Worth asking as a new question or finding an example around here."}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 1, "creation_date": 1557108792, "post_id": 55997149, "comment_id": 98642909, "body": "Possibly <code>pluck(Arel.sql(&#39;custom SQL&#39;))</code>, same as the work around for <code>order(&#39;custom SQL&#39;)</code>."}], "tags": [], "owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "is_accepted": true, "score": 1, "last_activity_date": 1557097275, "creation_date": 1557097275, "answer_id": 55997149, "question_id": 55996877, "link": "https://stackoverflow.com/questions/55996877/rails-transaction-isnt-acting-atomic/55997149#55997149", "title": "Rails transaction isn&#39;t acting atomic?", "body": "<p>If you want to avoid repeated statements, collapse it into one, something of this form:</p>\n\n<pre><code>SELECT account, SUM(...) AS amount FROM ...\n   WHERE account IN ('asset', 'liability', ...)\n   GROUP BY account\n</code></pre>\n\n<p>You can fetch these like this:</p>\n\n<pre><code>where(account: ACCOUNT_TYPES).group(:account).pluck('account, SUM(...)')\n</code></pre>\n\n<p>Where <code>ACCOUNT_TYPES</code> is an array of the account types you need to fetch.</p>\n\n<p>You can always take this <code>pluck</code> form and convert to a quick look-up hash with <code>.to_h</code> then use it like this:</p>\n\n<pre><code>balance_category = ...where(...)...pluck(...).to_h\n\nbalance_category[:asset]\n</code></pre>\n\n<p>If you need a default value, consider:</p>\n\n<pre><code>balance_category = Hash.new(0).merge(...where(...)...pluck(...).to_h)\n</code></pre>\n\n<p>Where that default can be integer (<code>0</code>) or a float (<code>0.0</code>) or anything at all.</p>\n"}], "owner": {"reputation": 11394, "user_id": 794481, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/344337b6819f2f513fa80bb227be3c2d?s=128&d=identicon&r=PG", "display_name": "Tallboy", "link": "https://stackoverflow.com/users/794481/tallboy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 55997149, "answer_count": 1, "score": 1, "last_activity_date": 1557097275, "creation_date": 1557094456, "last_edit_date": 1557095233, "question_id": 55996877, "link": "https://stackoverflow.com/questions/55996877/rails-transaction-isnt-acting-atomic", "title": "Rails transaction isn&#39;t acting atomic?", "body": "<p>I have an accounting system I wrote which follows standard dual-entry accounting practices.</p>\n\n<p>There is a feature of dual entry accounting called 'trial balance' where you can verify the entire system is correct because when you run it, it will always equal <code>0.00</code></p>\n\n<p>I have written tests and always run my trial balance when the system is 'stopped', but under write-heavy database load during seeding lots of records, I noticed my trial balance is WRONG about 1 out of 10 tries.</p>\n\n<p>When it's at rest (no inserts), its always correct at <code>0.00</code> however.</p>\n\n<p>When I insert transactions they're always in a transaction, like this:</p>\n\n<pre><code>2000.times do |i|\n  ActiveRecord::Base.transaction do\n    puts \"#{i} ===================================================================\"\n\n    entry = JournalEntry.create!(description: 'Purchase mower on credit', user: user)\n    entry.line_items.create!(amount: Money.from_amount(1551.75).cents, account: property.accounts.find_by(name: 'Equipment'), side: :debit)\n    entry.line_items.create!(amount: Money.from_amount(1551.75).cents, account: property.accounts.find_by(name: 'Accounts Payable'), side: :credit)\n  end\nend\n</code></pre>\n\n<p>The fact it breaks under load makes me think I'm not understanding something vital about how Rails transactions work......</p>\n\n<p>What could be causing this?</p>\n\n<p>FWIW my trial balance function (<code>GeneralLedger.new(property).trial_balance</code>) executes the following pseodo-SQL (<strong>NOT</strong> in a transaction):</p>\n\n<pre><code>SELECT sum(...) WHERE account = 'asset'\nSELECT sum(...) WHERE account = 'liability'\nSELECT sum(...) WHERE account = 'equity'\nSELECT sum(...) WHERE account = 'income'\nSELECT sum(...) WHERE account = 'expense'\n</code></pre>\n\n<p>I then add them together according to the Accounting Formula to arrive at 0.00:</p>\n\n<pre><code>  def trial_balance\n    balance_category(:asset) - (balance_category(:liability) + balance_category(:equity) + balance_category(:income) - balance_category(:expense))\n  end\n</code></pre>\n\n<p>The <code>balance_category</code> function is what triggers each SELECT for a total of 5 times, once for each category.</p>\n\n<p>Because its returning 0 it means it's somehow selecting when it's halfway inserted........... I have no idea how this is happening?</p>\n\n<p>I could understand if the creation of the journal entry/line item was not in a transaction and it was SELECTing halfway inserted rows, but it should only select from the entire group as a whole after the transaction ends?</p>\n"}, {"tags": ["ruby", "rubygems"], "answers": [{"tags": [], "owner": {"reputation": 84135, "user_id": 631619, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/b6f3159af5195eddff62a2dd4f9ad969?s=128&d=identicon&r=PG", "display_name": "Michael Durrant", "link": "https://stackoverflow.com/users/631619/michael-durrant"}, "is_accepted": false, "score": 0, "last_activity_date": 1557094232, "creation_date": 1557094232, "answer_id": 55996855, "question_id": 55996854, "link": "https://stackoverflow.com/questions/55996854/ruby-rspec-how-to-include-specs-in-root-of-project/55996855#55996855", "title": "Ruby - rspec how to include specs in root of project?", "body": "<p>One approach:</p>\n\n<pre><code># File: spec_helper.rb  Add the following at the top:\n\nDir.glob(File.expand_path(\"../../*_spec.rb\", __FILE__)).each do |file|\n  require file\nend\n</code></pre>\n\n<p>This will include files at the root to the ones already being included in <code>spec/</code></p>\n"}, {"tags": [], "owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "is_accepted": false, "score": 1, "last_activity_date": 1557106185, "creation_date": 1557106185, "answer_id": 55997809, "question_id": 55996854, "link": "https://stackoverflow.com/questions/55996854/ruby-rspec-how-to-include-specs-in-root-of-project/55997809#55997809", "title": "Ruby - rspec how to include specs in root of project?", "body": "<p>Spec supports a <a href=\"https://relishapp.com/rspec/rspec-core/v/3-8/docs/configuration/setting-the-default-spec-path\" rel=\"nofollow noreferrer\">--default-path</a> option, and <a href=\"https://relishapp.com/rspec/rspec-core/v/3-8/docs/configuration/read-command-line-configuration-options-from-files\" rel=\"nofollow noreferrer\">you can put a default set of command-line options into an .rspec file</a>.  That is, you can create a <code>.rspec</code> file in your project root directory containing</p>\n\n<pre><code>--default-path .\n</code></pre>\n\n<p>My experience has generally been that rspec tests are almost always in a <code>spec</code> directory; I would be a little surprised to see them in a top-level directory.  This in particular mirrors the <a href=\"https://guides.rubygems.org/what-is-a-gem/\" rel=\"nofollow noreferrer\">standard gem filesystem layout</a> which puts all library code into a <code>lib</code> directory and tests in a parallel <code>spec</code> directory.</p>\n"}], "owner": {"reputation": 84135, "user_id": 631619, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/b6f3159af5195eddff62a2dd4f9ad969?s=128&d=identicon&r=PG", "display_name": "Michael Durrant", "link": "https://stackoverflow.com/users/631619/michael-durrant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1557106185, "creation_date": 1557094232, "question_id": 55996854, "link": "https://stackoverflow.com/questions/55996854/ruby-rspec-how-to-include-specs-in-root-of-project", "title": "Ruby - rspec how to include specs in root of project?", "body": "<p>rspec always finds files in the <code>spec/</code> directory tree.</p>\n\n<p>How can I have it also find files that are in the root of the project (the one that contains the <code>spec/</code> folder iself.</p>\n\n<p>For example if I have a small project with only two tests, any folders may essentially be unneeded overhead given a minimalist approach.  Or if you only have one type of test and would only create one folder it may not (or may) be worth creating that one folder or just omitting it altogether.  The value it adds of course is immediate description of what type of tests exist, even if only one type exist.</p>\n"}, {"tags": ["node.js", "ruby", "encoding", "hmac"], "answers": [{"tags": [], "owner": {"reputation": 1934, "user_id": 2942295, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/fRBy8.png?s=128&g=1", "display_name": "ZAR", "link": "https://stackoverflow.com/users/2942295/zar"}, "is_accepted": false, "score": 0, "last_activity_date": 1557096215, "last_edit_date": 1557096215, "creation_date": 1557095998, "answer_id": 55997021, "question_id": 55996683, "link": "https://stackoverflow.com/questions/55996683/hmac-binary-digest-node-vs-ruby/55997021#55997021", "title": "HMAC Binary Digest Node vs Ruby", "body": "<p>By not inputting any specific encoding to Node's digest method, the raw unicode buffer is output - matching Ruby's.</p>\n\n<p>This is the end result:</p>\n\n<pre><code>crypto = require('crypto');\n\ntext = 'example';\nkey  = '123';\n\nh = crypto.createHmac('sha256', key).update(text).digest();\nBuffer.from(h).toString('base64');\n</code></pre>\n\n<p>Who would've thought - you could just pass nothing into the method... </p>\n"}, {"tags": [], "owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "is_accepted": false, "score": 0, "last_activity_date": 1557096365, "creation_date": 1557096365, "answer_id": 55997065, "question_id": 55996683, "link": "https://stackoverflow.com/questions/55996683/hmac-binary-digest-node-vs-ruby/55997065#55997065", "title": "HMAC Binary Digest Node vs Ruby", "body": "<p>To get Ruby to output Base64:</p>\n\n<pre><code>require 'openssl'\nrequire 'base64'\n\ntext = 'example'\nkey  = '123'\n\nBase64.encode64(OpenSSL::HMAC.digest(OpenSSL::Digest.new('sha256'), key, text))\n# \"aY1U8ElFKKdZ8ZyOh6n5nnWliBuSZ+45Jrz2LJkthLo=\\n\"\n</code></pre>\n\n<p>You can delete the <code>\\n</code> newlines and trailing padding if you want.</p>\n"}], "owner": {"reputation": 1934, "user_id": 2942295, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/fRBy8.png?s=128&g=1", "display_name": "ZAR", "link": "https://stackoverflow.com/users/2942295/zar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 129, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1557096365, "creation_date": 1557092705, "question_id": 55996683, "link": "https://stackoverflow.com/questions/55996683/hmac-binary-digest-node-vs-ruby", "title": "HMAC Binary Digest Node vs Ruby", "body": "<p>I am trying to implement a Node API using Ruby documentation (ugh). The issue specifically is around verifying a secret, which is put through an HMAC digest and then base64 encoded.</p>\n\n<p>I can't seem to get the two to equate. Here are the same snippets in Node &amp; Ruby:</p>\n\n<p><em>Note</em>: The below can also be viewed online via repl.it:</p>\n\n<ul>\n<li>Ruby (<a href=\"https://repl.it/repls/SarcasticSpottedSymbol\" rel=\"nofollow noreferrer\">https://repl.it/repls/SarcasticSpottedSymbol</a>)</li>\n<li>Node (<a href=\"https://repl.it/repls/AncientQuarrelsomeWearable\" rel=\"nofollow noreferrer\">https://repl.it/repls/AncientQuarrelsomeWearable</a>)</li>\n</ul>\n\n<h2>Node</h2>\n\n<pre><code>const crypto = require('crypto');\n\nlet text = 'example';\nlet key  = '123';\n\nlet h = crypto.createHmac('sha256', key).update(text).digest('binary');\nBuffer.from(h).toString('base64');\n# =&gt; 'acKNVMOwSUUowqdZw7HCnMKOwofCqcO5wp51wqXCiBvCkmfDrjkmwrzDtizCmS3ChMK6'\n</code></pre>\n\n<h2>Ruby</h2>\n\n<pre><code>require 'openssl'\nrequire 'base64'\n\ntext = 'example'\nkey  = '123'\n\nh = OpenSSL::HMAC.digest(OpenSSL::Digest.new('sha256'), key, text)\nBase64.strict_encode64(h)\n# =&gt; 'aY1U8ElFKKdZ8ZyOh6n5nnWliBuSZ+45Jrz2LJkthLo='\n</code></pre>\n\n<p>Switching both over to hex works, e.g.</p>\n\n<p><em>Node</em></p>\n\n<pre><code>crypto.createHmac('sha256', key).update(text).digest('hex')\n</code></pre>\n\n<p><em>Ruby</em></p>\n\n<pre><code>OpenSSL::HMAC.hexdigest(OpenSSL::Digest.new('sha256'), key, text)\n</code></pre>\n\n<p>Unfortunately it isn't up to me to switch to hex - the web service uses the ruby code to sign.</p>\n\n<p>Looking up the ruby docs for <a href=\"https://ruby-doc.org/stdlib-2.4.0/libdoc/openssl/rdoc/OpenSSL/HMAC.html\" rel=\"nofollow noreferrer\"><code>OpenSSL::HMAC.digest</code></a> states:</p>\n\n<blockquote>\n  <p>Returns the authentication code as a <em>binary string</em>.</p>\n</blockquote>\n\n<p>Just outputting the result from the HMAC, I can't tell whether this is a difference or just a rendering issue:</p>\n\n<p><em>Node</em></p>\n\n<pre><code>crypto.createHmac('sha256', key).update(text).digest('binary');\n# =&gt; 'iT\u00f0IE(\u00a7Y\u00f1\u00a9\u00f9u\u00a5\\u001bg\u00ee9&amp;\u00bc\u00f6,-\u00ba'\n</code></pre>\n\n<p><em>Ruby</em></p>\n\n<pre><code>OpenSSL::HMAC.digest(OpenSSL::Digest.new('sha256'), key, text)\n# =&gt; \"i\\x8DT\\xF0IE(\\xA7Y\\xF1\\x9C\\x8E\\x87\\xA9\\xF9\\x9Eu\\xA5\\x88\\e\\x92g\\xEE9&amp;\\xBC\\xF6,\\x99-\\x84\\xBA\"\n</code></pre>\n\n<p>How can I get these two to equate?</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["ruby", "rust"], "answers": [{"tags": [], "owner": {"reputation": 269529, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 2, "last_activity_date": 1557092151, "creation_date": 1557092151, "answer_id": 55996624, "question_id": 55996597, "link": "https://stackoverflow.com/questions/55996597/is-passing-a-string-back-to-the-calling-code-necessary-in-ffi-modules-to-prevent/55996624#55996624", "title": "Is passing a string back to the calling code necessary in FFI modules to prevent memory leaks?", "body": "<blockquote>\n  <p>Do I have to pass the string back to Rust to be freed?</p>\n</blockquote>\n\n<p>Yes.</p>\n\n<blockquote>\n  <p>Won't garbage collection pick this <code>some_string</code> up and free it?</p>\n</blockquote>\n\n<p>Yes, but that's not the memory leak to worry about. The garbage collector <em>will</em> free the memory allocated by Ruby that contains the transformed Ruby string.</p>\n\n<p>However, the garbage collector has no knowledge of the <em>allocation</em> that Rust made. Specifically, the Rust code might <em>not</em> even have made an allocation. In that case, if the calling code freed the string, that would cause memory unsafety, so the FFI library cannot assume that this <code>char *</code> was an allocation.</p>\n\n<p>Even if it did, it wouldn't know which allocator to use to deallocate with. Remember that there are frequently multiple allocators in play in a moderately complex application.</p>\n\n<p>Disclaimer: I'm the author of the <em>Omnibus</em>.</p>\n"}], "owner": {"reputation": 1054, "user_id": 3478959, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/b52236406c4b6e4fa0bb619db556cf14?s=128&d=identicon&r=PG&f=1", "display_name": "Lev", "link": "https://stackoverflow.com/users/3478959/lev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 55996624, "answer_count": 1, "score": 1, "last_activity_date": 1557092151, "creation_date": 1557091871, "last_edit_date": 1557091995, "question_id": 55996597, "link": "https://stackoverflow.com/questions/55996597/is-passing-a-string-back-to-the-calling-code-necessary-in-ffi-modules-to-prevent", "title": "Is passing a string back to the calling code necessary in FFI modules to prevent memory leaks?", "body": "<p>I have</p>\n\n<p><em>lib.rs</em></p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[no_mangle]\npub extern \"C\" fn test() -&gt; *const c_char {\n    CString::from(\"Hello\").unwrap().into_raw()\n}\n</code></pre>\n\n<p>In Ruby, I call it as</p>\n\n<p><em>main.rb</em></p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>require 'ffi'\n\nmodule Rust\n   extend FFI::Library\n\n   # [redacted loading the library]\n\n   attach_function :test, [], :string\nend\n\nsome_string = Rust::test()\n</code></pre>\n\n<p>Do I have to pass the string back to Rust to be freed? Won't garbage collection pick this <code>some_string</code> up and free it?</p>\n\n<p>I'm using <a href=\"http://jakegoulding.com/rust-ffi-omnibus/string_return/\" rel=\"nofollow noreferrer\"><em>The Rust FFI Omnibus</em></a> as a reference. I ran <code>valgrind ruby main.rb</code> and it didn't seem to find any leaks.</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "rubygems", "ruby-on-rails-5", "spree"], "comments": [{"owner": {"reputation": 4690, "user_id": 1937435, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YyN37.jpg?s=128&g=1", "display_name": "Josh Brody", "link": "https://stackoverflow.com/users/1937435/josh-brody"}, "edited": false, "score": 0, "creation_date": 1557089208, "post_id": 55996197, "comment_id": 98639596, "body": "Somewhere in your scss you don&#39;t have that variable defined."}, {"owner": {"reputation": 51, "user_id": 2606741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f699d85db0585fbdb8b097c681b63d52?s=128&d=identicon&r=PG", "display_name": "user2606741", "link": "https://stackoverflow.com/users/2606741/user2606741"}, "reply_to_user": {"reputation": 4690, "user_id": 1937435, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YyN37.jpg?s=128&g=1", "display_name": "Josh Brody", "link": "https://stackoverflow.com/users/1937435/josh-brody"}, "edited": false, "score": 0, "creation_date": 1558290828, "post_id": 55996197, "comment_id": 99042887, "body": "@JoshBrody Thanks for the reply, but I am not using scss files or such variables in my application."}], "owner": {"reputation": 51, "user_id": 2606741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f699d85db0585fbdb8b097c681b63d52?s=128&d=identicon&r=PG", "display_name": "user2606741", "link": "https://stackoverflow.com/users/2606741/user2606741"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 30, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1557155279, "creation_date": 1557088604, "last_edit_date": 1557155279, "question_id": 55996197, "link": "https://stackoverflow.com/questions/55996197/spree-products-for-a-particular-store-in-single-application-integration-using-sp", "title": "Spree Products for a particular store in single application integration using spree-multi-domain", "body": "<p>I have an existing rails application with Gemfile having gems like below.</p>\n\n<pre><code>source 'https://rubygems.org'\nruby '2.4.1'\n\ngem 'rails', '~&gt; 5.2.2'\ngem 'pg', '~&gt; 0.18'\ngem 'puma', '~&gt; 3.7'\ngem 'sass-rails', '~&gt; 5.0'\ngem 'uglifier', '&gt;= 1.3.0'\ngem 'coffee-rails', '~&gt; 4.2'\ngem 'turbolinks', '~&gt; 5'\ngem 'jbuilder', '~&gt; 2.5'\ngem 'jquery-rails'\ngem 'jquery-ui-rails'\ngem 'jquery-validation-rails'\ngem 'devise'\ngem 'toastr-rails'\ngem 'rails_admin'\n\ngem 'spree', '~&gt; 3.7.0'\ngem 'spree_multi_domain', github: 'spree-contrib/spree-multi-domain', branch: 'tracker-fix-3-5'\n</code></pre>\n\n<p>But after adding spree gems into my rails application, and running spree installation commands, I have started receiving errors like this:</p>\n\n<p><code>Undefined variable: \"$navbar-height\".</code></p>\n\n<p>Below is my css file sample already being used in the application.</p>\n\n<pre><code>/*\n *= require jquery-ui\n *= require_self\n *= require toastr\n *= require bootstrap\n *= require font-awesome\n *= require style\n *= require _all-skins\n *= require slideshow\n *= require custom\n */\n</code></pre>\n\n<p>I even tried to remove bootstrap from my css file and added lines like below:</p>\n\n<pre><code> *= require spree/frontend/all\n *= require spree/backend/all\n</code></pre>\n\n<p>But nothing worked.</p>\n\n<p>Is there any example code where I can get reference of setting up spree in such a way to have multiple stores using their own domains but in a single application to get their data stored?</p>\n"}, {"tags": ["ruby", "character-encoding", "ruby-csv"], "comments": [{"owner": {"reputation": 1325, "user_id": 1291712, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/744c118fcc4190717bdcbac2826bc40f?s=128&d=identicon&r=PG", "display_name": "Rahul", "link": "https://stackoverflow.com/users/1291712/rahul"}, "edited": false, "score": 2, "creation_date": 1557440463, "post_id": 55996172, "comment_id": 98776312, "body": "Can you share the file or part of the file? Also the version of ruby you&#39;re using."}, {"owner": {"reputation": 2487, "user_id": 8098012, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cbdb5ca9b079de1c9700271166feead?s=128&d=identicon&r=PG", "display_name": "Pavel Mikhailyuk", "link": "https://stackoverflow.com/users/8098012/pavel-mikhailyuk"}, "edited": false, "score": 0, "creation_date": 1557482740, "post_id": 55996172, "comment_id": 98788968, "body": "Could you provide you code also?"}, {"owner": {"reputation": 2487, "user_id": 8098012, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cbdb5ca9b079de1c9700271166feead?s=128&d=identicon&r=PG", "display_name": "Pavel Mikhailyuk", "link": "https://stackoverflow.com/users/8098012/pavel-mikhailyuk"}, "edited": false, "score": 0, "creation_date": 1557482805, "post_id": 55996172, "comment_id": 98788999, "body": "<code>col_sep:&quot;\\\\t&quot; row_sep:&quot;\\n&quot;</code> looks strange. Do you really have &#39;\\t&#39; separator, not <i>tabulation</i> one?"}, {"owner": {"reputation": 2085, "user_id": 562910, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/254f7a65e1cf2ce0c7446c49178fab80?s=128&d=identicon&r=PG", "display_name": "rigyt", "link": "https://stackoverflow.com/users/562910/rigyt"}, "edited": false, "score": 0, "creation_date": 1557594091, "post_id": 55996172, "comment_id": 98821100, "body": "I have added a link to an uploaded file now. I am not sure what the column separator is, \\t is a guess. (vim doesn&#39;t show a character code)"}], "answers": [{"comments": [{"owner": {"reputation": 2085, "user_id": 562910, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/254f7a65e1cf2ce0c7446c49178fab80?s=128&d=identicon&r=PG", "display_name": "rigyt", "link": "https://stackoverflow.com/users/562910/rigyt"}, "edited": false, "score": 1, "creation_date": 1557758012, "post_id": 56093120, "comment_id": 98862596, "body": "Yes that works, I realise now the problem arises when the file is saved as a Paperclip attachment. Setting the encoding when reading the Paperclip attachment doesn&#39;t seem to work, so I am investigating how to set the encoding at the time of saving as an attachment"}], "tags": [], "owner": {"reputation": 1603, "user_id": 565487, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vDTFH.jpg?s=128&g=1", "display_name": "Julien", "link": "https://stackoverflow.com/users/565487/julien"}, "is_accepted": false, "score": 1, "last_activity_date": 1557598903, "creation_date": 1557598903, "answer_id": 56093120, "question_id": 55996172, "link": "https://stackoverflow.com/questions/55996172/cant-read-file-charset-utf-16le-except-puts-in-ruby/56093120#56093120", "title": "Can&#39;t read file charset utf-16le except puts in ruby", "body": "<p>This is working fine for me:</p>\n\n<pre><code>require 'csv'\n\nCSV.foreach(\"file.xls\", encoding: \"UTF-16LE:UTF-8\", col_sep: \"\\t\") do |row|\n  puts row.inspect\nend\n</code></pre>\n\n<p>this will produce the following output:</p>\n\n<pre><code>[\"\ufeffCandidate number\", \"First name\", \"Last name\", \"Date of birth\", \"Preparation centre\", \"Result\", \"Score\", \"Reading and Writing\", \"Listening\", \"Speaking\", \"Result enquiry\", \"Raised on\", \"Raised by\", \"Enquiry status\", \"Withdrawn on\", \"Withdrawn by\", nil]\n[\"0001\", \"EDOARDO\", \"AGNEW\", \"20/01/2001\", \"Fondazione Istituto Massimo\", \"RY5-G8-Y2\", \"-\", nil, nil, nil, \"-\", \"00000000\", nil, nil, \"00000000\", nil, nil]\n</code></pre>\n\n<p>As you can see each row is an array of strings of each column in the document.</p>\n"}, {"tags": [], "owner": {"reputation": 2085, "user_id": 562910, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/254f7a65e1cf2ce0c7446c49178fab80?s=128&d=identicon&r=PG", "display_name": "rigyt", "link": "https://stackoverflow.com/users/562910/rigyt"}, "is_accepted": true, "score": 0, "last_activity_date": 1557763384, "creation_date": 1557763384, "answer_id": 56116041, "question_id": 55996172, "link": "https://stackoverflow.com/questions/55996172/cant-read-file-charset-utf-16le-except-puts-in-ruby/56116041#56116041", "title": "Can&#39;t read file charset utf-16le except puts in ruby", "body": "<p>The issue was that I was reading from a Paperclip attachment, which needed to have the encoding set (overridden) before saving.</p>\n\n<p>Adding s3_headers in the model worked:</p>\n\n<pre><code> has_attached_file :attachment, s3_headers: lambda { |attachment|\n                                  { \n                                    'content-Type' =&gt; 'text/csv; charset=utf-16le'\n                                  }\n                                }\n\n</code></pre>\n\n<p>Thanks to Julien for tipping me off that the issue was related to the paperclip attachment (that solution works to read the file directly)</p>\n"}], "owner": {"reputation": 2085, "user_id": 562910, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/254f7a65e1cf2ce0c7446c49178fab80?s=128&d=identicon&r=PG", "display_name": "rigyt", "link": "https://stackoverflow.com/users/562910/rigyt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 56116041, "answer_count": 2, "score": 0, "last_activity_date": 1557763384, "creation_date": 1557088441, "last_edit_date": 1557593991, "question_id": 55996172, "link": "https://stackoverflow.com/questions/55996172/cant-read-file-charset-utf-16le-except-puts-in-ruby", "title": "Can&#39;t read file charset utf-16le except puts in ruby", "body": "<p>I need to read an external file in ruby.\nRunning <code>file -i</code> locally shows\n<code>text/plain; charset=utf-16le</code></p>\n\n<p>I open it in ruby CSV with separater '\\t' and a row shows as:\n<code>&lt;CSV::Row \"\\xFF\\xFEC\\x00a\\x00n\\x00d\\x00i\\x00d\\x00a\\x00t\\x00e\\x00 \\x00n\\x00u\\</code>...</p>\n\n<p>row.to_s produces <code>\\x000\\x000\\x000\\x001\\x00\\t\\x00E\\x00D\\x00O</code></p>\n\n<p>Running <code>puts row</code> shows the data correctly:\n<code>0001    EDOARDO A</code>...\n(the values also show legibly in vim and LibreOffice Calc)</p>\n\n<p>Any suggestions how to get the data in ruby? I've tried various combinations of opening the CSV with <code>external_encoding: 'utf-16le', internal_encoding: \"utf-8\"</code> etc., but <code>puts</code> is the only thing that gives legible values</p>\n\n<p>It also said ASCII-8BIT in ruby CSV.\n<code>&lt;#CSV io_type:StringIO encoding:ASCII-8BIT lineno:0 col_sep:\"\\\\t\" row_sep:\"\\n\" quote_char:\"\\\"\" headers:true&gt;</code></p>\n\n<p>The file itself was produced as an XLS file. I have uploaded an edited version <a href=\"http://www.mediafire.com/file/eacecc6yvd0p3dc/part_of_file.xls/file\" rel=\"nofollow noreferrer\">here</a> (edited i gvim)</p>\n"}, {"tags": ["ruby"], "answers": [{"tags": [], "owner": {"reputation": 73209, "user_id": 290394, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d7908f05c89e965f6bc5308ad6f41256?s=128&d=identicon&r=PG", "display_name": "steenslag", "link": "https://stackoverflow.com/users/290394/steenslag"}, "is_accepted": true, "score": 3, "last_activity_date": 1557087989, "creation_date": 1557087989, "answer_id": 55996110, "question_id": 55996071, "link": "https://stackoverflow.com/questions/55996071/ruby-default-value-for-def/55996110#55996110", "title": "Ruby default value for def", "body": "<p>You're very close:</p>\n\n<pre><code>def get(name1: \"john\", age: 31)\n    puts \"#{name1} + #{age}\"\nend\n\nget(:age =&gt; 3) # =&gt; john + 3\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "is_accepted": false, "score": 4, "last_activity_date": 1557116298, "last_edit_date": 1557116298, "creation_date": 1557095144, "answer_id": 55996937, "question_id": 55996071, "link": "https://stackoverflow.com/questions/55996071/ruby-default-value-for-def/55996937#55996937", "title": "Ruby default value for def", "body": "<p>When Ruby encounters</p>\n\n<pre><code>def m(a=1, b=2, c=3)\n  puts \"a=#{a}, b=#{b}, c=#{3}\"\nend\n</code></pre>\n\n<p>This is what happens:</p>\n\n<pre><code>m(4,5)\n  # a=4, b=5, c=3\n</code></pre>\n\n<p>Ruby has no way of knowing which variable you want assigned to its default so she employs a simple rule: assign arguments to variables left to right until they are used up, then any remaining arguments are assigned to their default values.</p>\n\n<p>If you want a different priority you could change the order of the arguments, say,</p>\n\n<pre><code>def m(b=2, c=3, a=1)\n  puts \"a=#{a}, b=#{b}, c=#{3}\"\nend\n\nm(4,5)\n  # a=1, b=4, c=3\n</code></pre>\n\n<p>This may suffice in some situations but a more flexible solution, which also reads better, is to use <em>named arguments</em> (aka <em>named paramters</em>), as @steenstag has done in his solution. Here that might be as follows.</p>\n\n<pre><code>def m(a: 1, b: 2, c: 3)\n  d = a + c\n  puts \"a=#{a}, b=#{b}, c=#{c}, d=#{d}\"\nend\n\nm(:b=&gt;4, :c=&gt;5)\n  # a=1, b=4, c=5, d=6\nm(c: 4)\n  # a=1, b=2, c=4, d=5\n</code></pre>\n\n<p>Notice that I've written <code>c=&gt;5</code> in the first instance and <code>c: 4</code> in the second. Either form can be used. We cannot, however, write <code>def m(:a=&gt;1, :b=&gt;2, :c=&gt;3)</code>.</p>\n\n<p>Since Ruby v2.1 we can also have <em>required</em> named arguments:</p>\n\n<pre><code>def m(a:, b: 2, c: 3)\n  puts \"a=#{a}, b=#{b}, c=#{c}\"\nend\n\nm(c:5, a: 4)\n  # a=4, b=2, c=5\nm(c: 5)\n  # ArgumentError (missing keyword: a)\n</code></pre>\n\n<p>We can also have some named and some unnamed arguments, provided the named arguments are at the end, but its less confusing to simply name all arguments if any are named.</p>\n\n<pre><code>def m(d, a:, b: 2, c: 3)\n  puts \"d=#{d}, a=#{a}, b=#{b}, c=#{c}\"\nend\n\nm(6, c:5, a: 4)\n  # d=6, a=4, b=2, c=5\n\ndef m(a:, b: 2, c: 3, d)\nend\n  #=&gt; SyntaxError ((irb):165: syntax error, unexpected tIDENTIFIER)\n  #   ... def m(a:, b: 2, c: 3, d)\n  #                             ^\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 10358805, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3gnreRZBAS8/AAAAAAAAAAI/AAAAAAAAARw/a8UiIpMnVcU/photo.jpg?sz=128", "display_name": "\u0422\u0430\u0440\u0430\u0441 \u041c\u0430\u0442\u0456\u0457\u0432", "link": "https://stackoverflow.com/users/10358805/%d0%a2%d0%b0%d1%80%d0%b0%d1%81-%d0%9c%d0%b0%d1%82%d1%96%d1%97%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 55996110, "answer_count": 2, "score": 0, "last_activity_date": 1557116298, "creation_date": 1557087613, "question_id": 55996071, "link": "https://stackoverflow.com/questions/55996071/ruby-default-value-for-def", "title": "Ruby default value for def", "body": "<p>i have ruby method</p>\n\n<pre><code>def get(name1=\"john\", age=31)\n    puts \"#{name1} + #{age}\"\nend\n</code></pre>\n\n<p>how to allocate only a variable \"age\"\nFor example: </p>\n\n<pre><code>    get(:age =&gt; 3)\n    =&gt; john + 3\n</code></pre>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 1, "creation_date": 1557086705, "post_id": 55995933, "comment_id": 98638955, "body": "Can you use <a href=\"https://github.com/ruby/curses\" rel=\"nofollow noreferrer\"><code>curses</code></a> or something like it? Combine that witn an <a href=\"https://en.wikipedia.org/wiki/Event_loop\" rel=\"nofollow noreferrer\">event loop</a> and you&#39;ve got yourself a really basic <a href=\"https://www.gameenginebook.com\" rel=\"nofollow noreferrer\">game engine</a>."}, {"owner": {"reputation": 129, "user_id": 9422370, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8dc0cbca85c313f2bba8a7519e41cb6?s=128&d=identicon&r=PG&f=1", "display_name": "Arii", "link": "https://stackoverflow.com/users/9422370/arii"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1557086883, "post_id": 55995933, "comment_id": 98639011, "body": "Oh I&#39;m sure it would, but I&#39;ve been explicitly trying to avoid using curses. That&#39;s part of the challenge. Also, it&#39;s an extremely simple game and using curses sort of feels like overkill."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1557086997, "post_id": 55995933, "comment_id": 98639053, "body": "If you avoid curses you&#39;re going to have to write your own curses, so that&#39;ll be fun. Curses does a lot of things to flip the terminal input into a really raw mode, so you can capture keypresses that don&#39;t result in characters, like depressing the shift key without typing a letter. These functions can be very OS dependent, so you&#39;ll need to check what Ruby can do with your OS. Packages like <code>curses</code> often depend on a lot of C extensions to make that happen, Ruby itself may be unable to."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1557087114, "post_id": 55995933, "comment_id": 98639086, "body": "While I&#39;m a big fan of Ruby in general, it&#39;s worth noting that JavaScript does this natively and in a cross-platform way with <a href=\"https://electronjs.org\" rel=\"nofollow noreferrer\">Electron</a>. Ruby has <a href=\"http://shoesrb.com\" rel=\"nofollow noreferrer\">shoes</a> but it&#39;s not really at the same level. There&#39;s also <a href=\"https://www.pygame.org/news\" rel=\"nofollow noreferrer\">PyGame</a> which is fantastic as well. I wish there was something better Ruby could offer as an equivalent here."}, {"owner": {"reputation": 129, "user_id": 9422370, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8dc0cbca85c313f2bba8a7519e41cb6?s=128&d=identicon&r=PG&f=1", "display_name": "Arii", "link": "https://stackoverflow.com/users/9422370/arii"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1557087379, "post_id": 55995933, "comment_id": 98639162, "body": "I mean, it doesn&#39;t have to be an exact mimic of Vim, I&#39;m really just looking for a way to read the buffer automatically without having to hit enter."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1557087461, "post_id": 55995933, "comment_id": 98639186, "body": "If your goal is to learn about low-level terminal stuff, you may want to try C, it&#39;s got unfettered, direct access to the necessary APIs. I&#39;m not sure how you&#39;d do this in Ruby without C extensions like <code>curses</code>, or by writing your own C extension. Both of those approaches involve a lot of learning, <code>curses</code> is not exactly easy to use because it has an incredible number of features and must support a wide variety of terminals."}, {"owner": {"reputation": 129, "user_id": 9422370, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8dc0cbca85c313f2bba8a7519e41cb6?s=128&d=identicon&r=PG&f=1", "display_name": "Arii", "link": "https://stackoverflow.com/users/9422370/arii"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 1, "creation_date": 1557087715, "post_id": 55995933, "comment_id": 98639260, "body": "I&#39;m restricted to using Ruby for this. Believe me I wish I could throw this together in C but alas."}], "answers": [{"comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1557095428, "post_id": 55996774, "comment_id": 98640880, "body": "Great work! One minor thing to note is that it&#39;s preferred to use <code>$stdin</code> now instead of <code>STDIN</code>. This better reflects the idea that the handle is not &quot;constant&quot; but can in fact be reassigned, like <code>$stdin = StringIO.new(&quot;...&quot;)</code>."}], "tags": [], "owner": {"reputation": 129, "user_id": 9422370, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8dc0cbca85c313f2bba8a7519e41cb6?s=128&d=identicon&r=PG&f=1", "display_name": "Arii", "link": "https://stackoverflow.com/users/9422370/arii"}, "is_accepted": false, "score": 1, "last_activity_date": 1557093497, "creation_date": 1557093497, "answer_id": 55996774, "question_id": 55995933, "link": "https://stackoverflow.com/questions/55995933/read-input-buffer-automatically-after-small-delay/55996774#55996774", "title": "Read input buffer automatically after small delay", "body": "<p>Ok, this is what I've come up with (Adapted largely from: <a href=\"https://gist.github.com/acook/4190379\" rel=\"nofollow noreferrer\">this</a>)</p>\n\n<pre class=\"lang-ruby prettyprint-override\"><code>$beat = 20\ndef read_char\n  STDIN.echo = false\n  STDIN.raw!\n\n  input = STDIN.getc\n  value = \"\"\n  t = 0\n  while t &lt; $beat do\n    started = Time.now\n    if input != nil then\n      # if input.chr == \"\\e\" then\n      #   input &lt;&lt; STDIN.read_nonblock(3) rescue nil\n      #   input &lt;&lt; STDIN.read_nonblock(2) rescue nil\n      # end\n      value &lt;&lt; input.chr\n      t = 0\n    else\n      ended = Time.now\n      t += (ended - started)*1000\n    end\n    input = STDIN.read_nonblock(1) rescue nil\n  end\nensure\n  STDIN.echo = true\n  STDIN.cooked!\n  return value\nend\n</code></pre>\n\n<p>It seems to be working from the very basic tests I've run on it...</p>\n"}], "owner": {"reputation": 129, "user_id": 9422370, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8dc0cbca85c313f2bba8a7519e41cb6?s=128&d=identicon&r=PG&f=1", "display_name": "Arii", "link": "https://stackoverflow.com/users/9422370/arii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1557093497, "creation_date": 1557086641, "question_id": 55995933, "link": "https://stackoverflow.com/questions/55995933/read-input-buffer-automatically-after-small-delay", "title": "Read input buffer automatically after small delay", "body": "<p>So I'm making a silly little terminal game as an excercise, and I'd like to have the user be able to type multi-char commands \u00e0 la Vim, where (I assume) the user types a keystroke, then there's around a half second or so beat after the last keypress before the buffer actually gets read, so I could type d or dd and not have to hit enter.</p>\n\n<p>The question is, how? I'm assuming read_nonblock is the way to go here, but how would I utilise it? My initial thought was to put it in a while loop with an incremental timer and just reset it whenever the buffer reads something new, but read_nonblock throws it's exception when the buffer is empty, so that hasn't been working...</p>\n\n<p>Thoughts?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "docker", "http"], "answers": [{"comments": [{"owner": {"reputation": 801, "user_id": 5306142, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5It5b.jpg?s=128&g=1", "display_name": "Michael Kr&#248;yserth-Sims&#248;", "link": "https://stackoverflow.com/users/5306142/michael-kr%c3%b8yserth-sims%c3%b8"}, "edited": false, "score": 0, "creation_date": 1557089401, "post_id": 55995870, "comment_id": 98639647, "body": "(I might have downvoted this by accident, so it&#39;s nice if you could edit so I can change that)  Did <code>rake assets:precompile</code> in prod. Got the following error <code>Uglifier::Error: Unexpected character &#39;#&#39;</code>  Removed some leftover comments from a coffeescript-file  That solved it.  Did you know this by experience, or is it somehting I shoul have figured out? And does this mean that my application will fail with no js?"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "reply_to_user": {"reputation": 801, "user_id": 5306142, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5It5b.jpg?s=128&g=1", "display_name": "Michael Kr&#248;yserth-Sims&#248;", "link": "https://stackoverflow.com/users/5306142/michael-kr%c3%b8yserth-sims%c3%b8"}, "edited": false, "score": 0, "creation_date": 1557095898, "post_id": 55995870, "comment_id": 98640962, "body": "This is something you need to do to properly &quot;deploy&quot; your application and tools like <a href=\"https://capistranorb.com\" rel=\"nofollow noreferrer\">Capistrano</a> do it for you automatically so many people don&#39;t know about it. Most deployment procedures discuss this step, but you need to go looking for them specifically: There&#39;s dozens of how-to guides that go over the details. Each environment has its own challenges, Docker especially."}], "tags": [], "owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "is_accepted": true, "score": 2, "last_activity_date": 1557086220, "creation_date": 1557086220, "answer_id": 55995870, "question_id": 55995747, "link": "https://stackoverflow.com/questions/55995747/rails-post-patch-in-development-becomes-get-in-production/55995870#55995870", "title": "Rails POST (patch) in development becomes GET in production", "body": "<p>This usually happens because the Rails UJS JavaScript library failed to load and the data attributes it injects are ignored.</p>\n\n<p>Check that the UJS library loaded. If you're using Sprockets, ensure that the <code>rails-ujs</code> \"comment\" line in <code>application.js</code> is present.</p>\n\n<p>If you're running in <code>production</code> mode you need to ensure that your assets are properly compiled. This can be done with <code>rake assets:precompile</code> in the prouction deployment location for Rails 3 through 5.2.</p>\n"}], "owner": {"reputation": 801, "user_id": 5306142, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5It5b.jpg?s=128&g=1", "display_name": "Michael Kr&#248;yserth-Sims&#248;", "link": "https://stackoverflow.com/users/5306142/michael-kr%c3%b8yserth-sims%c3%b8"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 55995870, "answer_count": 1, "score": 2, "last_activity_date": 1557090050, "creation_date": 1557085431, "last_edit_date": 1557090050, "question_id": 55995747, "link": "https://stackoverflow.com/questions/55995747/rails-post-patch-in-development-becomes-get-in-production", "title": "Rails POST (patch) in development becomes GET in production", "body": "<p><em>The same situation as in <a href=\"https://stackoverflow.com/questions/42050608/rails-link-which-posts-in-development-gets-in-production\">Rails link which POSTs in development GETs in production</a> but there is no conclusion in that question, so I am trying as well:</em></p>\n\n<ul>\n<li>Rails 5.2.3 </li>\n<li>Ruby 2.6</li>\n<li>Running in Docker container</li>\n<li>Live app is on Ubuntu 16.04.6</li>\n</ul>\n\n<p>I have the following in my view:</p>\n\n<pre><code>&lt;%= link_to '&amp;#10003;'.html_safe, item_path(item), method: :patch, :class=&gt;\"item__buy-btn\" %&gt;\n</code></pre>\n\n<p>It generates the following HTML:</p>\n\n<pre><code>&lt;a class=\"item__buy-btn\" rel=\"nofollow\" data-method=\"patch\" href=\"/items/32\"&gt;\u2713&lt;/a&gt;\n</code></pre>\n\n<p>This is in my item controller (I do not have a item#show):</p>\n\n<pre><code>def update\n  item = Item.find(params[:id])\n  item.update(bought: true)\n  list = List.find(item.grocery_item_id)\n  receipt = Receipt.find(list.receipts.last.id)\n  receipt.close\n  item.update(grocery_item_id: receipt.id, grocery_item_type: receipt.class.name)\n  item.save\n  redirect_to request.referrer || root_url\nend\n</code></pre>\n\n<p>And this is my items related routes:</p>\n\n<pre><code>                items GET    /items(.:format)                                                                         items#index\n                      POST   /items(.:format)                                                                         items#create\n             new_item GET    /items/new(.:format)                                                                     items#new\n            edit_item GET    /items/:id/edit(.:format)                                                                items#edit\n                 item GET    /items/:id(.:format)                                                                     items#show\n                      PATCH  /items/:id(.:format)                                                                     items#update\n                      PUT    /items/:id(.:format)                                                                     items#update\n                      DELETE /items/:id(.:format)                                                                     items#destroy\n</code></pre>\n\n<p>Clearly a POST:\n<a href=\"https://i.stack.imgur.com/y7B5p.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/y7B5p.png\" alt=\"response in development\"></a></p>\n\n<p>Log says PATCH:</p>\n\n<pre><code>web_1              | Started PATCH \"/items/33\" for 172.21.0.1 at 2019- 05-05 19:29:31 +0000\nweb_1              | Cannot render console from 172.21.0.1! Allowed networks: 127.0.0.1, ::1, 127.0.0.0/127.255.255.255\nweb_1              | Processing by ItemsController#update as HTML\nweb_1              |   Parameters: {\"authenticity_token\"=&gt;\"KmPf0fEDEs6Y2gUmC6Su9fdeVOg51AwCUUWyQBq14Gz0Fs6IRJ5cmmQdUETMbE+IMRTTGcfQPQ86x0rNzDSRHg==\", \"id\"=&gt;\"33\"}\n</code></pre>\n\n<p>And then in PRODUCTION:</p>\n\n<pre><code>I, [2019-05-05T18:27:22.439552 #1]  INFO -- : [93c90971-1378-4e39-b6fb-8329dd46922e] Started GET \"/\" for 10.255.0.2 at 2019-05-05 18:27:22 +0000\nI, [2019-05-05T18:27:22.440379 #1]  INFO -- : [93c90971-1378-4e39-b6fb-8329dd46922e] Processing by HomeController#index as HTML\nI, [2019-05-05T18:27:22.441694 #1]  INFO -- : [93c90971-1378-4e39-b6fb-8329dd46922e]   Rendering home/index.html.erb within layouts/application\nI, [2019-05-05T18:27:22.443279 #1]  INFO -- : [93c90971-1378-4e39-b6fb-8329dd46922e]   Rendered home/index.html.erb within layouts/application (1.4ms)\nI, [2019-05-05T18:27:22.444679 #1]  INFO -- : [93c90971-1378-4e39-b6fb-8329dd46922e] Completed 200 OK in 4ms (Views: 3.0ms)\nI, [2019-05-05T18:49:37.971732 #1]  INFO -- : [5f452d24-80c5-44dc-bd8a-cb2be0aa5f14] Started GET \"/items/7\" for 10.255.0.2 at 2019-05-05 18:49:37 +0000\nF, [2019-05-05T18:49:37.973154 #1] FATAL -- : [5f452d24-80c5-44dc-bd8a-cb2be0aa5f14]\nF, [2019-05-05T18:49:37.973209 #1] FATAL -- : [5f452d24-80c5-44dc-bd8a-cb2be0aa5f14] AbstractController::ActionNotFound (The action 'show' could not be found for ItemsController):\nF, [2019-05-05T18:49:37.973237 #1] FATAL -- : [5f452d24-80c5-44dc-bd8a-cb2be0aa5f14]\nF, [2019-05-05T18:49:37.973274 #1] FATAL -- : [5f452d24-80c5-44dc-bd8a-cb2be0aa5f14] actionpack (5.2.3) lib/abstract_controller/base.rb:129:in `process'\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/zRa97.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/zRa97.png\" alt=\"response in production\"></a></p>\n\n<p>What could cause this behavior?\nIs there any relevant information I am missing in this post?</p>\n\n<p>EDIT:</p>\n\n<p><strong>As per ser tadmans answer, it was apparently about the javascript.\nIt failed on precompile due to a '#' comment in one of the files.</strong></p>\n"}, {"tags": ["arrays", "ruby", "loops", "gets"], "comments": [{"owner": {"reputation": 445, "user_id": 5362658, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jLMFF.jpg?s=128&g=1", "display_name": "QNester", "link": "https://stackoverflow.com/users/5362658/qnester"}, "edited": false, "score": 1, "creation_date": 1557084107, "post_id": 55995479, "comment_id": 98638343, "body": "Why do u need input before loop? You can just set <code>answer = nil</code> before loop and all must be fine"}, {"owner": {"reputation": 25637, "user_id": 6243352, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/715f60f9edc65642a6805752cfeebb27?s=128&d=identicon&r=PG&f=1", "display_name": "ggorlen", "link": "https://stackoverflow.com/users/6243352/ggorlen"}, "edited": false, "score": 0, "creation_date": 1557084225, "post_id": 55995479, "comment_id": 98638378, "body": "Welcome to SO! You&#39;re extremely close--I recommend trying to work it out the rest of the way!"}, {"owner": {"reputation": 16237, "user_id": 2166798, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/417356917295f5176d2a3e7c21d8f9e8?s=128&d=identicon&r=PG", "display_name": "pjs", "link": "https://stackoverflow.com/users/2166798/pjs"}, "edited": false, "score": 0, "creation_date": 1557095854, "post_id": 55995479, "comment_id": 98640955, "body": "Why are you using an array?  Since the goal is to output the sum of the numbers, just start with <code>sum = 0</code> and keep incrementing it by the input as long as the input is numeric.  There&#39;s no need to store all the inputs."}], "answers": [{"tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": true, "score": 2, "last_activity_date": 1557084982, "creation_date": 1557084982, "answer_id": 55995684, "question_id": 55995479, "link": "https://stackoverflow.com/questions/55995479/trying-to-create-an-array-from-input-whilst-in-a-loop-ruby/55995684#55995684", "title": "Trying to create an array from input whilst in a loop - Ruby", "body": "<p>You have a situation like this.</p>\n\n<pre><code>do something\ndetermine if we should stop\ndo something else\nrepeat\n</code></pre>\n\n<p>For this sort of fine control use a <a href=\"http://ruby-doc.org/core/Kernel.html#method-i-loop\" rel=\"nofollow noreferrer\"><code>loop</code></a> to repeat until you <a href=\"http://ruby-doc.org/core/doc/syntax/control_expressions_rdoc.html#label-break+Statement\" rel=\"nofollow noreferrer\"><code>break</code></a>.</p>\n\n<pre><code># Initialize your list of numbers.\nnumbers = []\n\n# Start a loop.\nloop do\n  # Get the answer.\n  puts 'Give me a number'\n  answer = gets.chomp\n\n  # Stop if the user wants to stop.\n  break if answer == 'stop'\n\n  # Store the number after checking that it is a number.\n  numbers.push(answer)\nend\n\np numbers\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 3115449, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a0Y65.jpg?s=128&g=1", "display_name": "Joe-t", "link": "https://stackoverflow.com/users/3115449/joe-t"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 55995684, "answer_count": 1, "score": 0, "last_activity_date": 1557084982, "creation_date": 1557083581, "question_id": 55995479, "link": "https://stackoverflow.com/questions/55995479/trying-to-create-an-array-from-input-whilst-in-a-loop-ruby", "title": "Trying to create an array from input whilst in a loop - Ruby", "body": "<p>I am trying to create a programme that asks the user for a number, the programme keeps asking the user for a number until \"stop\" is entered at which point the sum of the numbers is returned.</p>\n\n<p>The code sort of works but I realise that the first puts/gets.chomp is outside of the loop and is not being added to the array. I dont know how to implement this, any help thoughts would be greatly appreciated!</p>\n\n<pre><code>array = []\n\nputs 'Give me a number'\n\nanswer = gets.chomp\n\nuntil answer == \"stop\"\n  puts 'Give me a number'\nanswer = gets.chomp\n  array.push(answer)\nend\n\narray.pop\n\narray\n</code></pre>\n"}, {"tags": ["ruby", "macos", "terminal"], "answers": [{"tags": [], "owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "is_accepted": false, "score": 0, "last_activity_date": 1557086532, "creation_date": 1557086532, "answer_id": 55995916, "question_id": 55995156, "link": "https://stackoverflow.com/questions/55995156/running-a-set-of-ruby-scripts-in-terminal/55995916#55995916", "title": "Running a set of Ruby scripts in Terminal", "body": "<p>There's a few patterns you can use here, but to employ these techniques the key is to define a simple entry point method that you can call as necessary instead of having all that stuff just strewn about in the <code>main</code> namespace.</p>\n\n<p>Pull filenames from the <code>ARGV</code> arguments list:</p>\n\n<pre><code>ARGV.each do |file|\n  process(file)\nend\n</code></pre>\n\n<p>You can use <code>File.basename(file, '.yml')</code> to strip off extensions and switch that to <code>.csv</code> if you prefer. Keep your method as generic as possible.</p>\n\n<p>Secondly, you can use <code>xargs</code> externally:</p>\n\n<pre><code>find . -name '*.yml' | xargs ruby program.rb\n</code></pre>\n\n<p>Where that will append all the files matching that pattern as arguments to your program. You can even tweak the options to run in parallel:</p>\n\n<pre><code>find . -name '*.yml' | xargs -n 2 -p 8 ruby program.rb\n</code></pre>\n\n<p>Where that runs 8 parallel processes (<code>-p 8</code>), each processing up to two files (<code>-n 2</code>). </p>\n\n<p>You can also do this yourself with:</p>\n\n<pre><code>Dir.glob('source_dir/**/*.yml') do |file|\n  process(file)\nend\n</code></pre>\n\n<p>Where <code>Dir.glob</code> is great at finding a lot of things. To parallelize that you can either use threads or forking. <code>xargs</code> is a quick way to get that all for \"free\".</p>\n"}], "owner": {"reputation": 1, "user_id": 11456281, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Udxp5LLj62U/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdUsgl0MJgsgIX-HbdpfzNd6kNnIQ/mo/photo.jpg?sz=128", "display_name": "SCB", "link": "https://stackoverflow.com/users/11456281/scb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1557086532, "creation_date": 1557081354, "last_edit_date": 1557084802, "question_id": 55995156, "link": "https://stackoverflow.com/questions/55995156/running-a-set-of-ruby-scripts-in-terminal", "title": "Running a set of Ruby scripts in Terminal", "body": "<p>I want to repetitively run a Ruby script in the Mac Terminal window that does a text search on a text file.  The script works well on each text file at a time in Terminal, but I want to do this multiple times on a sequence of files.</p>\n\n<p>I've tried creating a script in automator but no luck.  As an FYI the Ruby script is attached, but that is not the issue</p>\n\n<p>Thank you</p>\n\n<pre><code>#!/usr/bin/env ruby\nrequire 'yaml'\nrequire 'csv'\nabort \"You must specify one or more files to search.\" if ARGV.size == 0\n\nsearch_terms = \"---\n:stage1:\n  JTSJ3:\n  - text term 1\n:stage2n:\n  JTSJ3:\n  - nothing\n:stage2p:\n  JTSJ3:\n  - text term 2\n:stage3:\n  JTSJ3:\n  - nothing\"\n\n...\nFile.open(File.join(result_dir, 'results_stage3.yml'), 'w') do |f|\n  f.write stage3_results.to_yaml\nend\nFile.open(File.join(result_dir, 'results_stage3.csv'), 'w') do |f|\n  f.write csv_header.to_csv\n  stage3_results.each do |r|\n    f.write [ r[:category], r[:term], r[:line], r[:text], r[:file] ].to_csv\n  end\nend\n</code></pre>\n"}, {"tags": ["ruby"], "comments": [{"owner": {"reputation": 12464, "user_id": 1376448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f16da5431a99911ebc32093a28bc591?s=128&d=identicon&r=PG", "display_name": "kiddorails", "link": "https://stackoverflow.com/users/1376448/kiddorails"}, "edited": false, "score": 2, "creation_date": 1557079249, "post_id": 55994726, "comment_id": 98637072, "body": "It executed for me correctly for Ruby 1.9+. Which version are you using and what is the exact error message?"}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "reply_to_user": {"reputation": 12464, "user_id": 1376448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f16da5431a99911ebc32093a28bc591?s=128&d=identicon&r=PG", "display_name": "kiddorails", "link": "https://stackoverflow.com/users/1376448/kiddorails"}, "edited": false, "score": 0, "creation_date": 1557079670, "post_id": 55994726, "comment_id": 98637170, "body": "I am executing on 2.6"}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "reply_to_user": {"reputation": 12464, "user_id": 1376448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f16da5431a99911ebc32093a28bc591?s=128&d=identicon&r=PG", "display_name": "kiddorails", "link": "https://stackoverflow.com/users/1376448/kiddorails"}, "edited": false, "score": 0, "creation_date": 1557079699, "post_id": 55994726, "comment_id": 98637177, "body": "How did you paste the program on command prompt? Copy paste?"}, {"owner": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1557079864, "post_id": 55994726, "comment_id": 98637210, "body": "Works fine with 2.6.1. Raj, could you be halucinating?"}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "reply_to_user": {"reputation": 93653, "user_id": 256970, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/87b71ecb90417c88f7873a2f0f9492e9?s=128&d=identicon&r=PG", "display_name": "Cary Swoveland", "link": "https://stackoverflow.com/users/256970/cary-swoveland"}, "edited": false, "score": 0, "creation_date": 1557080030, "post_id": 55994726, "comment_id": 98637242, "body": "@CarySwoveland I have attached the image now. Can you please see now?"}, {"owner": {"reputation": 12464, "user_id": 1376448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f16da5431a99911ebc32093a28bc591?s=128&d=identicon&r=PG", "display_name": "kiddorails", "link": "https://stackoverflow.com/users/1376448/kiddorails"}, "edited": false, "score": 1, "creation_date": 1557080560, "post_id": 55994726, "comment_id": 98637378, "body": "You are running it in Windows cmd shell. Newline is likely being treated as end of stream which ruby is considering as the end of instruction within first line. Try <a href=\"https://superuser.com/a/1222011\">superuser.com/a/1222011</a>"}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "reply_to_user": {"reputation": 12464, "user_id": 1376448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f16da5431a99911ebc32093a28bc591?s=128&d=identicon&r=PG", "display_name": "kiddorails", "link": "https://stackoverflow.com/users/1376448/kiddorails"}, "edited": false, "score": 0, "creation_date": 1557081298, "post_id": 55994726, "comment_id": 98637590, "body": "@kiddorails Now I have tried your solution and it&#39;s not working too, I have pasted the image there. Can you see it?"}, {"owner": {"reputation": 12464, "user_id": 1376448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f16da5431a99911ebc32093a28bc591?s=128&d=identicon&r=PG", "display_name": "kiddorails", "link": "https://stackoverflow.com/users/1376448/kiddorails"}, "edited": false, "score": 0, "creation_date": 1557082426, "post_id": 55994726, "comment_id": 98637914, "body": "Dont miss the quotes. Before a= and after &#39;end&#39;"}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "reply_to_user": {"reputation": 12464, "user_id": 1376448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f16da5431a99911ebc32093a28bc591?s=128&d=identicon&r=PG", "display_name": "kiddorails", "link": "https://stackoverflow.com/users/1376448/kiddorails"}, "edited": false, "score": 0, "creation_date": 1557083784, "post_id": 55994726, "comment_id": 98638254, "body": "@kiddorails Can you please see the third pic, that is still creating the problem, it says i is not recognized now."}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "reply_to_user": {"reputation": 12464, "user_id": 1376448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f16da5431a99911ebc32093a28bc591?s=128&d=identicon&r=PG", "display_name": "kiddorails", "link": "https://stackoverflow.com/users/1376448/kiddorails"}, "edited": false, "score": 0, "creation_date": 1557083907, "post_id": 55994726, "comment_id": 98638287, "body": "@kiddorails I have removed all the pic and attached the latest one, can you please have a look at that one?"}, {"owner": {"reputation": 12464, "user_id": 1376448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f16da5431a99911ebc32093a28bc591?s=128&d=identicon&r=PG", "display_name": "kiddorails", "link": "https://stackoverflow.com/users/1376448/kiddorails"}, "edited": false, "score": 0, "creation_date": 1557116301, "post_id": 55994726, "comment_id": 98644182, "body": "Try removing the last caret sign after &quot;end&quot;"}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "reply_to_user": {"reputation": 12464, "user_id": 1376448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f16da5431a99911ebc32093a28bc591?s=128&d=identicon&r=PG", "display_name": "kiddorails", "link": "https://stackoverflow.com/users/1376448/kiddorails"}, "edited": false, "score": 0, "creation_date": 1557118293, "post_id": 55994726, "comment_id": 98644611, "body": "@kiddorails did you try? Its working for you?"}], "answers": [{"comments": [{"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1557079846, "post_id": 55994924, "comment_id": 98637204, "body": "you missed out your <code>-e</code>, Is that deliberate?"}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1557080454, "post_id": 55994924, "comment_id": 98637354, "body": "Hi I have attached the image now, can you tell me where I go wrong? Should I need to paste it differently?"}, {"owner": {"reputation": 449, "user_id": 10739704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XmWze.jpg?s=128&g=1", "display_name": "nileshkumar", "link": "https://stackoverflow.com/users/10739704/nileshkumar"}, "reply_to_user": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1557080567, "post_id": 55994924, "comment_id": 98637382, "body": "@Rajagopalan:  <code>-e</code>  is not needed..  pls go with my solution, it will work..  :)"}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1557080825, "post_id": 55994924, "comment_id": 98637449, "body": "Hi, my problem is I can&#39;t paste this program into the window cmd. Can you please look at the image which I updated in my question?"}, {"owner": {"reputation": 449, "user_id": 10739704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XmWze.jpg?s=128&g=1", "display_name": "nileshkumar", "link": "https://stackoverflow.com/users/10739704/nileshkumar"}, "reply_to_user": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1557081342, "post_id": 55994924, "comment_id": 98637603, "body": "@Rajagopalan: if your are using Windows then i have no idea..  try using IRB for your code.."}], "tags": [], "owner": {"reputation": 449, "user_id": 10739704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XmWze.jpg?s=128&g=1", "display_name": "nileshkumar", "link": "https://stackoverflow.com/users/10739704/nileshkumar"}, "is_accepted": false, "score": 1, "last_activity_date": 1557079790, "creation_date": 1557079790, "answer_id": 55994924, "question_id": 55994726, "link": "https://stackoverflow.com/questions/55994726/how-to-use-ruby-e-to-execute-multiline-program/55994924#55994924", "title": "How to use &#39;ruby -e&#39; to execute multiline program?", "body": "<p>you can try <code>here document</code> in your shell command:</p>\n\n<pre><code>ruby &lt;&lt;END\n a=[1,2,3,4,5]\n a.each do |i|\n   puts i\n end\nEND\n</code></pre>\n\n<p>Hope this helps....</p>\n"}, {"comments": [{"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1557080978, "post_id": 55995039, "comment_id": 98637498, "body": "I can&#39;t paste larger program this way."}, {"owner": {"reputation": 1777, "user_id": 3353157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6168a2c2f5e3582addf6d9d70ce13749?s=128&d=identicon&r=PG", "display_name": "Peter Camilleri", "link": "https://stackoverflow.com/users/3353157/peter-camilleri"}, "reply_to_user": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1557081043, "post_id": 55995039, "comment_id": 98637525, "body": "I just type it."}, {"owner": {"reputation": 1777, "user_id": 3353157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6168a2c2f5e3582addf6d9d70ce13749?s=128&d=identicon&r=PG", "display_name": "Peter Camilleri", "link": "https://stackoverflow.com/users/3353157/peter-camilleri"}, "reply_to_user": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1557081082, "post_id": 55995039, "comment_id": 98637536, "body": "And the Windows command line has a right button menu with paste."}, {"owner": {"reputation": 1777, "user_id": 3353157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6168a2c2f5e3582addf6d9d70ce13749?s=128&d=identicon&r=PG", "display_name": "Peter Camilleri", "link": "https://stackoverflow.com/users/3353157/peter-camilleri"}, "reply_to_user": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1557084606, "post_id": 55995039, "comment_id": 98638469, "body": "Are you serious??? It means the right mouse button menu. If you don&#39;t know what a mouse or a mouse button is, I cannot help you."}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1557085100, "post_id": 55995039, "comment_id": 98638595, "body": "I know but I tried and it&#39;s not working so I was asking whether you meant something else or what. Here is the program I pasted <code>C:\\Users\\rajagopalan.m&gt;ruby -e &quot;a=[1,2,3,4,6]&quot;   ^ More? More? &quot;a.each do |i|&quot;  ^ More?   &quot;p i&quot;  ^ More? &quot;end&quot;  ^</code>"}, {"owner": {"reputation": 1777, "user_id": 3353157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6168a2c2f5e3582addf6d9d70ce13749?s=128&d=identicon&r=PG", "display_name": "Peter Camilleri", "link": "https://stackoverflow.com/users/3353157/peter-camilleri"}, "reply_to_user": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1557085299, "post_id": 55995039, "comment_id": 98638644, "body": "Well, that crap ain&#39;t gonna work. All I know is I typed in the line in my response (except for the &gt; prompt) and it worked."}], "tags": [], "owner": {"reputation": 1777, "user_id": 3353157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6168a2c2f5e3582addf6d9d70ce13749?s=128&d=identicon&r=PG", "display_name": "Peter Camilleri", "link": "https://stackoverflow.com/users/3353157/peter-camilleri"}, "is_accepted": false, "score": 0, "last_activity_date": 1557080549, "creation_date": 1557080549, "answer_id": 55995039, "question_id": 55994726, "link": "https://stackoverflow.com/questions/55994726/how-to-use-ruby-e-to-execute-multiline-program/55995039#55995039", "title": "How to use &#39;ruby -e&#39; to execute multiline program?", "body": "<p>Try this:</p>\n\n<pre><code>&gt;ruby -e \"a=[1,2,3,4,5]; a.each do |i| puts i; end\"\n</code></pre>\n\n<p>Basic idea, use a semi-colon wherever a new-line would be needed.</p>\n"}, {"comments": [{"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1557081342, "post_id": 55995147, "comment_id": 98637604, "body": "I am doing it on windows, so the question is how to do it?"}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1557081508, "post_id": 55995147, "comment_id": 98637660, "body": "I understand so how do I inform my command prompt that it&#39;s not yet finished?"}, {"owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1557081678, "post_id": 55995147, "comment_id": 98637709, "body": "Hi I found that this character <code>^</code>, but please see my second pic, that too is throwing some other error."}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "reply_to_user": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "edited": false, "score": 0, "creation_date": 1557081781, "post_id": 55995147, "comment_id": 98637736, "body": "Strings in <code>CMD.EXE</code> need to be surrounded by quotation marks."}], "tags": [], "owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "is_accepted": false, "score": 0, "last_activity_date": 1557081462, "last_edit_date": 1557081462, "creation_date": 1557081312, "answer_id": 55995147, "question_id": 55994726, "link": "https://stackoverflow.com/questions/55994726/how-to-use-ruby-e-to-execute-multiline-program/55995147#55995147", "title": "How to use &#39;ruby -e&#39; to execute multiline program?", "body": "<p>This has nothing to do with Ruby. You need to read the manual of your terminal emulator and your shell and figure out how to escape newlines.</p>\n\n<p>As can be seen in the error you posted, you get a shell prompt after the first line, so the shell clearly seems to think the command is finished. Ergo, the shell tries to interpret the Ruby commands as shell commands, which leads to the error.</p>\n"}], "owner": {"reputation": 3523, "user_id": 9043475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FNxvn.jpg?s=128&g=1", "display_name": "Rajagopalan", "link": "https://stackoverflow.com/users/9043475/rajagopalan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 0, "answer_count": 3, "score": -2, "last_activity_date": 1557085195, "creation_date": 1557078333, "last_edit_date": 1557085195, "question_id": 55994726, "link": "https://stackoverflow.com/questions/55994726/how-to-use-ruby-e-to-execute-multiline-program", "title": "How to use &#39;ruby -e&#39; to execute multiline program?", "body": "<p>I want to execute program by 'ruby -e' but it executes program if it's in single line but it's not executing if it's multiple line and throws the error. For an example, </p>\n\n<pre><code>&gt;ruby -e \"puts 'rajagopalan'\"\n=&gt;rajagopalan\n</code></pre>\n\n<p>but</p>\n\n<pre><code>&gt;ruby -e \"a=[1,2,3,4,5]\na.each do |i|\n   puts i\nend\n\"\n</code></pre>\n\n<p>it throws the error that \"a.each do |i|\nThe syntax of the command is incorrect.\n\"</p>\n\n<p>Can someone guide me how to execute the mulitiline via <code>ruby -e</code></p>\n\n<p>I have attached image here\n<a href=\"https://i.stack.imgur.com/0mhRQ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/0mhRQ.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["ruby", "security", "password-protection", "privacy"], "answers": [{"comments": [{"owner": {"reputation": 29, "user_id": 11452044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65b91b3ba4bdc3a7c5ab14cee1c473b3?s=128&d=identicon&r=PG&f=1", "display_name": "johhnry", "link": "https://stackoverflow.com/users/11452044/johhnry"}, "edited": false, "score": 0, "creation_date": 1557076673, "post_id": 55994367, "comment_id": 98636405, "body": "Thanks it was really helpful!"}, {"owner": {"reputation": 2000, "user_id": 8402369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u5v3r.png?s=128&g=1", "display_name": "marsnebulasoup", "link": "https://stackoverflow.com/users/8402369/marsnebulasoup"}, "reply_to_user": {"reputation": 29, "user_id": 11452044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65b91b3ba4bdc3a7c5ab14cee1c473b3?s=128&d=identicon&r=PG&f=1", "display_name": "johhnry", "link": "https://stackoverflow.com/users/11452044/johhnry"}, "edited": false, "score": 0, "creation_date": 1557076696, "post_id": 55994367, "comment_id": 98636412, "body": "No problem :) :)"}, {"owner": {"reputation": 24970, "user_id": 73673, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/H81Fx.jpg?s=128&g=1", "display_name": "berkes", "link": "https://stackoverflow.com/users/73673/berkes"}, "edited": false, "score": 2, "creation_date": 1557076992, "post_id": 55994367, "comment_id": 98636498, "body": "For passwords, generally, Bcrypt is considered safer. &quot;Generally&quot; because with cryptography and security everything depends on the use-case and details. And &quot;Safer&quot; because Bcrypt is better protected against rainbow-tables."}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 1, "creation_date": 1557081728, "post_id": 55994367, "comment_id": 98637720, "body": "Please, do not recommend SHA-512 for password hashing. It is a general-purpose cryptographic has function, not a password hash function. In modern code, you should generally prefer Argon2 or a similar algorithm."}], "tags": [], "owner": {"reputation": 2000, "user_id": 8402369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u5v3r.png?s=128&g=1", "display_name": "marsnebulasoup", "link": "https://stackoverflow.com/users/8402369/marsnebulasoup"}, "is_accepted": true, "score": 2, "last_activity_date": 1557083522, "last_edit_date": 1557083522, "creation_date": 1557075765, "answer_id": 55994367, "question_id": 55994317, "link": "https://stackoverflow.com/questions/55994317/create-a-program-that-asks-for-a-password-without-showing-it-in-the-code/55994367#55994367", "title": "Create a program that asks for a password without showing it in the code", "body": "<p>Hash the password and store the hash as a string.</p>\n\n<p>When the user types the password, hash it and compare it to the hashed string. If it matches, it's correct otherwise it's not.</p>\n\n<p>This is secure since you can't get the original password from the hashed string.</p>\n\n<p>This example uses SHA-512, which is secure, since it can't be brute forced (yet).</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>def is_valid?(password)\n    hash = Digest::SHA512.hexdigest(password) \n    mypassword == #the hash of your password\n    if hash == mypassword\n        return true\n    else\n        return false\nend\n\n</code></pre>\n\n<p>Edit:</p>\n\n<p>As @J\u00f6rg W Mittag suggested, using Argon2 is a better option in terms of security, since it is actually for password hashing.</p>\n\n<p>More info on Argon2:</p>\n\n<p><a href=\"https://github.com/technion/ruby-argon2\" rel=\"nofollow noreferrer\">https://github.com/technion/ruby-argon2</a></p>\n\n<p>--</p>\n\n<p>What is hashing?</p>\n\n<p><a href=\"https://en.wikipedia.org/wiki/Hash_function\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Hash_function</a></p>\n\n<p>--</p>\n\n<p>Hashing in ruby:</p>\n\n<p><a href=\"http://www.informit.com/articles/article.aspx?p=2314083&amp;seqNum=35\" rel=\"nofollow noreferrer\">http://www.informit.com/articles/article.aspx?p=2314083&amp;seqNum=35</a></p>\n\n<p><a href=\"https://richonrails.com/articles/hashing-data-in-ruby\" rel=\"nofollow noreferrer\">https://richonrails.com/articles/hashing-data-in-ruby</a></p>\n"}, {"tags": [], "owner": {"reputation": 1580, "user_id": 4041883, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CE0SX.jpg?s=128&g=1", "display_name": "CAmador", "link": "https://stackoverflow.com/users/4041883/camador"}, "is_accepted": false, "score": 1, "last_activity_date": 1557076352, "creation_date": 1557076352, "answer_id": 55994437, "question_id": 55994317, "link": "https://stackoverflow.com/questions/55994317/create-a-program-that-asks-for-a-password-without-showing-it-in-the-code/55994437#55994437", "title": "Create a program that asks for a password without showing it in the code", "body": "<p>You can use the <a href=\"https://github.com/codahale/bcrypt-ruby\" rel=\"nofollow noreferrer\">bcrypt</a> gem.</p>\n\n<p>Extracted from their docs:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>require 'bcrypt'\n\nmy_password = BCrypt::Password.create(\"my password\")\n#=&gt; \"$2a$12$K0ByB.6YI2/OYrB4fQOYLe6Tv0datUVf6VZ/2Jzwm879BW5K1cHey\"\n\nmy_password == \"my password\"     #=&gt; true\nmy_password == \"not my password\" #=&gt; false\n\nmy_password = BCrypt::Password.new(\"$2a$12$K0ByB.6YI2/OYrB4fQOYLe6Tv0datUVf6VZ/2Jzwm879BW5K1cHey\")\nmy_password == \"my password\"     #=&gt; true\nmy_password == \"not my password\" #=&gt; false\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 11452044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65b91b3ba4bdc3a7c5ab14cee1c473b3?s=128&d=identicon&r=PG&f=1", "display_name": "johhnry", "link": "https://stackoverflow.com/users/11452044/johhnry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 55994367, "answer_count": 2, "score": 0, "last_activity_date": 1557083522, "creation_date": 1557075444, "question_id": 55994317, "link": "https://stackoverflow.com/questions/55994317/create-a-program-that-asks-for-a-password-without-showing-it-in-the-code", "title": "Create a program that asks for a password without showing it in the code", "body": "<p>I want to write a program in Ruby that can ask for a password and verify if the password entered correspond to a valid password.</p>\n\n<p>The thing is, I could write a function in ruby that could check if the password entered is the good one like : </p>\n\n<pre><code>def is_valid?(password)\n  password == \"my_password\"\nend\n</code></pre>\n\n<p>But then if someone is looking at the file, the password is going to be revealed. </p>\n\n<p>So how do I do this?</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "activerecord"], "answers": [{"tags": [], "owner": {"reputation": 13, "user_id": 7023504, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QMMz9.png?s=128&g=1", "display_name": "Pablo Ciruzzi", "link": "https://stackoverflow.com/users/7023504/pablo-ciruzzi"}, "is_accepted": false, "score": 0, "last_activity_date": 1557069691, "creation_date": 1557069691, "answer_id": 55993514, "question_id": 55993302, "link": "https://stackoverflow.com/questions/55993302/destroy-has-many-relation-when-updating-associated-record-get-empty/55993514#55993514", "title": "Destroy has_many relation when updating associated record get empty", "body": "<p>I've been working a bit more on it, and as I'm using Rails 5.1 (thanks to <a href=\"https://stackoverflow.com/a/20657833/7023504\">https://stackoverflow.com/a/20657833/7023504</a>), I got to this working code for the callback:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>def destroy_empty_super_course\n  id = saved_changes[:super_course_id]&amp;.first\n  return unless id\n  super_course = SuperCourse.find(id)\n  super_course.destroy if super_course.courses.empty?\nend\n</code></pre>\n\n<p>And after changing the <code>let</code> for <code>let!</code>, the test started passing! Anyway, I'd still like to know if this is the best solution for this case, but at least I have something working :)</p>\n"}, {"tags": [], "owner": {"reputation": 183, "user_id": 6176394, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/945261141733c25671268e2aa465249d?s=128&d=identicon&r=PG&f=1", "display_name": "Artur Martsinkovskyi", "link": "https://stackoverflow.com/users/6176394/artur-martsinkovskyi"}, "is_accepted": true, "score": 0, "last_activity_date": 1557072126, "creation_date": 1557072126, "answer_id": 55993858, "question_id": 55993302, "link": "https://stackoverflow.com/questions/55993302/destroy-has-many-relation-when-updating-associated-record-get-empty/55993858#55993858", "title": "Destroy has_many relation when updating associated record get empty", "body": "<p>Callback is the only viable solution for this one, although, to be more elegant and consistent with Rails style it is common to use <a href=\"https://cheeyeo.uk/rails/ruby/activerecord/2015/12/13/around-callbacks-in-activerecord/\" rel=\"nofollow noreferrer\">around</a> callback for that purposes.\n The reason why your version failed was because after_update callback takes place after the update was committed, so <code>*_changed?</code> and <code>*_was</code> methods are not aware of the dirty changes that were on the record before the save. To get the data in the period before the save is done around callback can be used - it allows to perform save yielding the block, making dirty changes available before the <code>yield</code> statement <em>practically being after save</em> and after update logic in the statements after <code>yield</code>.</p>\n\n<pre><code>def destroy_empty_super_course\n  return unless super_course_id_changed?\n\n  id = super_course_id_was\n\n  yield\n\n  super_course = SuperCourse.find(id)\n  super_course.destroy if super_course.courses.empty?\nend\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 7023504, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QMMz9.png?s=128&g=1", "display_name": "Pablo Ciruzzi", "link": "https://stackoverflow.com/users/7023504/pablo-ciruzzi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 55993858, "answer_count": 2, "score": 0, "last_activity_date": 1557072126, "creation_date": 1557068286, "question_id": 55993302, "link": "https://stackoverflow.com/questions/55993302/destroy-has-many-relation-when-updating-associated-record-get-empty", "title": "Destroy has_many relation when updating associated record get empty", "body": "<p>I have the following models:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>class Course &lt; ApplicationRecord\n  belongs_to :super_course, inverse_of: :courses\n  ...\nend\n\nclass SuperCourse &lt; ApplicationRecord\n  has_many :courses, dependent: :nullify, inverse_of: :super_course\n  ...\nend\n</code></pre>\n\n<p>This two models relate each other as the following: a <code>SuperCourse</code> groups plenty of <code>Course</code>s that have some particular conditions. The thing is that, in a backoffice I can change the <code>SuperCourse</code> of a <code>Course</code>, and I don't want to have empty <code>SuperCourse</code>s (i.e. that don't have any <code>Course</code> associated).</p>\n\n<p>What I've been trying to do is adding an <code>after_update</code> callback to the <code>Course</code> model, so that it checks if the previous <code>SuperCourse</code> now doesn't have any <code>Course</code> associated, but I don't know if this is the best solution (AFAIK, callbacks are not quite recommended). Following the response in <a href=\"https://stackoverflow.com/questions/1545820/removing-the-has-many-when-the-belongs-to-is-updated-destroyed-if-the-has-man\">this very old thread</a>, this is what I get right now:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>class Course &lt; ApplicationRecord\n  belongs_to :super_course, inverse_of: :courses\n\n  after_update :destroy_empty_super_course\n\n  ...\n\n  private\n\n  def destroy_empty_super_course\n    id = super_course_id_changed? ? super_course_id_was : super_course_id\n    super_course = SuperCourse.find(id)\n    super_course.destroy if super_course.courses.empty?\n  end\nend\n</code></pre>\n\n<p>But when I test this, I don't even get what I want. This is the <code>rspec</code> snippet that fails:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>context \"when super_course is updated\" do\n  let(:super_course) { create(:super_course, courses: []) }\n  let(:course) { create(:course, super_course: super_course) }\n  let(:new_super_course) { create(:super_course, courses: []) }\n  let(:new_course) { create(:course, semester: course.semester, subject: course.subject, super_course: new_super_course) }\n\n  subject { course.update!(super_course: new_super_course) }\n\n  it \"should remove old super_course\" do\n    expect { subject }.to change(SuperCourse, :count).by(-1)\n  end\nend\n</code></pre>\n\n<p>Is this my best choice? If so, how can I make it work? If no, what is the best option?</p>\n\n<p>Thank you all in advance!</p>\n"}, {"tags": ["javascript", "html", "ruby-on-rails", "ruby"], "comments": [{"owner": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 1, "creation_date": 1557067368, "post_id": 55993004, "comment_id": 98633941, "body": "What does your current button code look like? What have you considered trying? Have have you actually tried?"}, {"owner": {"reputation": 61, "user_id": 10907919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88155f054f72de69ebe5aaf855a660de?s=128&d=identicon&r=PG&f=1", "display_name": "M.DeBaecke", "link": "https://stackoverflow.com/users/10907919/m-debaecke"}, "reply_to_user": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 0, "creation_date": 1557069966, "post_id": 55993004, "comment_id": 98634681, "body": "I thought using 2 radio buttons."}, {"owner": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 0, "creation_date": 1557070327, "post_id": 55993004, "comment_id": 98634794, "body": "Sounds promising. Give it a go and let us know how it turns out."}, {"owner": {"reputation": 61, "user_id": 10907919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88155f054f72de69ebe5aaf855a660de?s=128&d=identicon&r=PG&f=1", "display_name": "M.DeBaecke", "link": "https://stackoverflow.com/users/10907919/m-debaecke"}, "reply_to_user": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 0, "creation_date": 1557070754, "post_id": 55993004, "comment_id": 98634902, "body": "&lt;div class=&quot;btn-group btn-group-toggle&quot; data-toggle=&quot;buttons&quot;&gt;       &lt;label class=&quot;btn btn-primary active&quot;&gt;         &lt;input type=&quot;radio&quot; name=&quot;options&quot; id=&quot;option1&quot; autocomplete=&quot;off&quot; checked&gt; Europe       &lt;/label&gt;       &lt;label class=&quot;btn btn-primary&quot;&gt;         &lt;input type=&quot;radio&quot; name=&quot;options&quot; id=&quot;option2&quot; autocomplete=&quot;off&quot;&gt; USA       &lt;/label&gt;     &lt;/div&gt; This is the button group I would like to use"}, {"owner": {"reputation": 18856, "user_id": 1359650, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dffc4318ac93e728a26c8e8b51b4eb37?s=128&d=identicon&r=PG", "display_name": "jvillian", "link": "https://stackoverflow.com/users/1359650/jvillian"}, "edited": false, "score": 1, "creation_date": 1557071351, "post_id": 55993004, "comment_id": 98635081, "body": "It is almost always a bad idea to put code in comments. Edit your question to include code."}], "answers": [{"tags": [], "owner": {"reputation": 8733, "user_id": 3625433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/N7qK6.png?s=128&g=1", "display_name": "lacostenycoder", "link": "https://stackoverflow.com/users/3625433/lacostenycoder"}, "is_accepted": false, "score": 0, "last_activity_date": 1557073927, "creation_date": 1557073927, "answer_id": 55994102, "question_id": 55993004, "link": "https://stackoverflow.com/questions/55993004/how-to-change-method-in-controller-when-a-button-is-clicked/55994102#55994102", "title": "How to change method in controller when a button is clicked?", "body": "<p>You'll probably want to pass the food model scope as a query param so something like this in your controller:</p>\n\n<pre><code>def index\n  if params[:food_type].present?\n    @foods = Food.send(params[:food_type].to_sym)\n  else\n    @foods = Food.all # fallback to something or all?\n  end\nend\n</code></pre>\n\n<p>Without seeing the rest of your font end code, there are a number of ways to handle it.  Most likely you will load the view without data and then send an ajax request with the <code>food_type</code> as a param when the button is clicked.</p>\n"}, {"comments": [{"owner": {"reputation": 61, "user_id": 10907919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88155f054f72de69ebe5aaf855a660de?s=128&d=identicon&r=PG&f=1", "display_name": "M.DeBaecke", "link": "https://stackoverflow.com/users/10907919/m-debaecke"}, "edited": false, "score": 0, "creation_date": 1557079255, "post_id": 55994331, "comment_id": 98637076, "body": "So how do i define food_type in in my button group?"}, {"owner": {"reputation": 61, "user_id": 10907919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88155f054f72de69ebe5aaf855a660de?s=128&d=identicon&r=PG&f=1", "display_name": "M.DeBaecke", "link": "https://stackoverflow.com/users/10907919/m-debaecke"}, "edited": false, "score": 0, "creation_date": 1557080512, "post_id": 55994331, "comment_id": 98637369, "body": "My html code is in the index page itself from food. This doesn&#39;t work."}, {"owner": {"reputation": 3705, "user_id": 8551976, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oxgdN.jpg?s=128&g=1", "display_name": "asimhashmi", "link": "https://stackoverflow.com/users/8551976/asimhashmi"}, "reply_to_user": {"reputation": 61, "user_id": 10907919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88155f054f72de69ebe5aaf855a660de?s=128&d=identicon&r=PG&f=1", "display_name": "M.DeBaecke", "link": "https://stackoverflow.com/users/10907919/m-debaecke"}, "edited": false, "score": 0, "creation_date": 1557080833, "post_id": 55994331, "comment_id": 98637450, "body": "So how are you showing cards on button click? Have you implemented this?"}, {"owner": {"reputation": 61, "user_id": 10907919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88155f054f72de69ebe5aaf855a660de?s=128&d=identicon&r=PG&f=1", "display_name": "M.DeBaecke", "link": "https://stackoverflow.com/users/10907919/m-debaecke"}, "edited": false, "score": 0, "creation_date": 1557080890, "post_id": 55994331, "comment_id": 98637467, "body": "No that&#39;s the major problem."}, {"owner": {"reputation": 61, "user_id": 10907919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88155f054f72de69ebe5aaf855a660de?s=128&d=identicon&r=PG&f=1", "display_name": "M.DeBaecke", "link": "https://stackoverflow.com/users/10907919/m-debaecke"}, "edited": false, "score": 0, "creation_date": 1557081311, "post_id": 55994331, "comment_id": 98637596, "body": "This is my github if you need more code <a href=\"https://github.com/Maartensdb/lvlytoulouse\" rel=\"nofollow noreferrer\">github.com/Maartensdb/lvlytoulouse</a> ."}, {"owner": {"reputation": 61, "user_id": 10907919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88155f054f72de69ebe5aaf855a660de?s=128&d=identicon&r=PG&f=1", "display_name": "M.DeBaecke", "link": "https://stackoverflow.com/users/10907919/m-debaecke"}, "edited": false, "score": 0, "creation_date": 1557081639, "post_id": 55994331, "comment_id": 98637698, "body": "I have the error undefined local variable or method `food_type&#39; for #. Where do I need to define food_type?"}, {"owner": {"reputation": 3705, "user_id": 8551976, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oxgdN.jpg?s=128&g=1", "display_name": "asimhashmi", "link": "https://stackoverflow.com/users/8551976/asimhashmi"}, "reply_to_user": {"reputation": 61, "user_id": 10907919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88155f054f72de69ebe5aaf855a660de?s=128&d=identicon&r=PG&f=1", "display_name": "M.DeBaecke", "link": "https://stackoverflow.com/users/10907919/m-debaecke"}, "edited": false, "score": 0, "creation_date": 1557081755, "post_id": 55994331, "comment_id": 98637728, "body": "Have you added the both methods in controller?"}, {"owner": {"reputation": 61, "user_id": 10907919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88155f054f72de69ebe5aaf855a660de?s=128&d=identicon&r=PG&f=1", "display_name": "M.DeBaecke", "link": "https://stackoverflow.com/users/10907919/m-debaecke"}, "edited": false, "score": 0, "creation_date": 1557081870, "post_id": 55994331, "comment_id": 98637757, "body": "If I add the food_type method I get this error: uninitialized constant FoodsController::SUPPORTED_FOOD_TYPES ."}, {"owner": {"reputation": 3705, "user_id": 8551976, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oxgdN.jpg?s=128&g=1", "display_name": "asimhashmi", "link": "https://stackoverflow.com/users/8551976/asimhashmi"}, "reply_to_user": {"reputation": 61, "user_id": 10907919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88155f054f72de69ebe5aaf855a660de?s=128&d=identicon&r=PG&f=1", "display_name": "M.DeBaecke", "link": "https://stackoverflow.com/users/10907919/m-debaecke"}, "edited": false, "score": 0, "creation_date": 1557081950, "post_id": 55994331, "comment_id": 98637769, "body": "You also need to define the <code>SUPPORTED_FOOD_TYPES</code> constant on your controller. I&#39;ve mentioned it in my answer"}, {"owner": {"reputation": 61, "user_id": 10907919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88155f054f72de69ebe5aaf855a660de?s=128&d=identicon&r=PG&f=1", "display_name": "M.DeBaecke", "link": "https://stackoverflow.com/users/10907919/m-debaecke"}, "edited": false, "score": 0, "creation_date": 1557082131, "post_id": 55994331, "comment_id": 98637814, "body": "Now I get this: undefined method `to_sym&#39; for false:FalseClass Did you mean? to_s"}, {"owner": {"reputation": 3705, "user_id": 8551976, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oxgdN.jpg?s=128&g=1", "display_name": "asimhashmi", "link": "https://stackoverflow.com/users/8551976/asimhashmi"}, "reply_to_user": {"reputation": 61, "user_id": 10907919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88155f054f72de69ebe5aaf855a660de?s=128&d=identicon&r=PG&f=1", "display_name": "M.DeBaecke", "link": "https://stackoverflow.com/users/10907919/m-debaecke"}, "edited": false, "score": 0, "creation_date": 1557082439, "post_id": 55994331, "comment_id": 98637919, "body": "Updated the <code>food_type</code> method, use the newer version"}, {"owner": {"reputation": 61, "user_id": 10907919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88155f054f72de69ebe5aaf855a660de?s=128&d=identicon&r=PG&f=1", "display_name": "M.DeBaecke", "link": "https://stackoverflow.com/users/10907919/m-debaecke"}, "edited": false, "score": 0, "creation_date": 1557082453, "post_id": 55994331, "comment_id": 98637923, "body": "No errors now but my button group doesn&#39;t show up anymore."}], "tags": [], "owner": {"reputation": 3705, "user_id": 8551976, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oxgdN.jpg?s=128&g=1", "display_name": "asimhashmi", "link": "https://stackoverflow.com/users/8551976/asimhashmi"}, "is_accepted": true, "score": 2, "last_activity_date": 1557089482, "last_edit_date": 1557089482, "creation_date": 1557075514, "answer_id": 55994331, "question_id": 55993004, "link": "https://stackoverflow.com/questions/55993004/how-to-change-method-in-controller-when-a-button-is-clicked/55994331#55994331", "title": "How to change method in controller when a button is clicked?", "body": "<p>You can send a param to your controller with the value of your radio button which will be <code>usa</code> or <code>europe</code></p>\n\n<p>Then you can use <code>send</code> method to dynamically call <code>usa</code> or <code>europe</code> on your <code>Food</code> model.</p>\n\n<p>For instance, you sent a parameter <code>food_name</code> from frontend to your controller.</p>\n\n<p>Your code will look something like this</p>\n\n<pre><code>def index\n  @foods = Food.send(params[:food_type].to_sym)\nend\n</code></pre>\n\n<p>But be careful when directly using params coming from user as it may break your application.</p>\n\n<p>A <strong>safe approach</strong> will be to create a array of possible food types in your controller. </p>\n\n<p>Something like this:</p>\n\n<pre><code>SUPPORTED_FOOD_TYPES = [\"usa\", \"europe\"].freeze\n</code></pre>\n\n<p>Then in your controller you'd do it like this</p>\n\n<pre><code>def index\n  @foods = Food.send(food_type.to_sym)\nend\n\n\ndef food_type\n  if SUPPORTED_FOOD_TYPES.include? params[:food_type]\n    params[:food_type]\n  else\n    'all'\n  end\nend\n</code></pre>\n\n<p>Your html code will look like this:</p>\n\n<pre><code>&lt;%= form_tag(foods_path, method: \"get\") do %&gt;\n  &lt;div class=\"btn-group btn-group-toggle\" data-toggle=\"buttons\"&gt;\n    &lt;label class=\"btn btn-primary active\"&gt;\n      &lt;input type=\"radio\" name=\"food_type\" value=\"europe\" id=\"europe\" autocomplete=\"off\" checked&gt; Europe\n    &lt;/label&gt;\n    &lt;label class=\"btn btn-primary\"&gt;\n      &lt;input type=\"radio\" name=\"food_type\" value=\"usa\" id=\"usa\" autocomplete=\"off\"&gt; USA\n    &lt;/label&gt;\n  &lt;/div&gt;\n  &lt;input type=\"submit\" value=\"Apply\"&gt;\n&lt;% end %&gt;\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 10907919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88155f054f72de69ebe5aaf855a660de?s=128&d=identicon&r=PG&f=1", "display_name": "M.DeBaecke", "link": "https://stackoverflow.com/users/10907919/m-debaecke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 55994331, "answer_count": 2, "score": -2, "last_activity_date": 1557089482, "creation_date": 1557066525, "last_edit_date": 1557071956, "question_id": 55993004, "link": "https://stackoverflow.com/questions/55993004/how-to-change-method-in-controller-when-a-button-is-clicked", "title": "How to change method in controller when a button is clicked?", "body": "<p>On my site I have cards, cards that need to pop up when a button \"usa\" is clicked and cards that need to appear when a button \"europe\" is clicked. I coded everything except the last part. If I enter this in my index method of the controller only usa card come up:</p>\n\n<pre><code>def index\n  @foods = Food.usa\nend\n</code></pre>\n\n<p>And if I enter this:</p>\n\n<pre><code>def index\n  @foods = Food.europe\nend\n</code></pre>\n\n<p>only europe cards pop up. I want to be able to do that with a simple button click on my site. how do I do that? </p>\n\n<p>The code of my buttons</p>\n\n<pre><code>&lt;div class=\"btn-group btn-group-toggle\" data-toggle=\"buttons\"&gt;\n  &lt;label class=\"btn btn-primary active\"&gt;\n    &lt;input type=\"radio\" name=\"options\" id=\"europe\" autocomplete=\"off\" checked&gt; Europe\n  &lt;/label&gt;\n  &lt;label class=\"btn btn-primary\"&gt;\n    &lt;input type=\"radio\" name=\"options\" id=\"usa\" autocomplete=\"off\"&gt; USA\n  &lt;/label&gt;\n&lt;/div&gt;\n</code></pre>\n\n<p>The name of my controller is foods_controller.rb </p>\n\n<p>Thank you for helping me.</p>\n"}, {"tags": ["regex", "ruby"], "answers": [{"tags": [], "owner": {"reputation": 8462, "user_id": 405865, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e29f04f339715955060858e0e65e1311?s=128&d=identicon&r=PG", "display_name": "fphilipe", "link": "https://stackoverflow.com/users/405865/fphilipe"}, "is_accepted": true, "score": 5, "last_activity_date": 1557065019, "creation_date": 1557065019, "answer_id": 55992762, "question_id": 55992715, "link": "https://stackoverflow.com/questions/55992715/how-to-split-ruby-string-with-regex/55992762#55992762", "title": "how to split ruby string with Regex?", "body": "<p>Basically you want to split at whitespace after a period, followed by an uppercase letter:</p>\n\n<pre><code>text.split(/(?&lt;=\\.)\\s+(?=[[:upper:]])/)\n</code></pre>\n\n<p>The regular expression will only match the whitespace <code>\\s+</code>, but ensure that it was preceded by a period using a positive lookbehind <code>(?&lt;=\\.)</code> and followed by an uppercase letter using a positive lookahead <code>(?=[[:upper:]])</code>.</p>\n"}], "owner": {"reputation": 943, "user_id": 3861062, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100003054720441/picture?type=large", "display_name": "Sungpah Lee", "link": "https://stackoverflow.com/users/3861062/sungpah-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 55992762, "answer_count": 1, "score": 1, "last_activity_date": 1557071717, "creation_date": 1557064648, "last_edit_date": 1557071717, "question_id": 55992715, "link": "https://stackoverflow.com/questions/55992715/how-to-split-ruby-string-with-regex", "title": "how to split ruby string with Regex?", "body": "<p>Hi I want to split this string into the following.</p>\n\n<pre><code>text = \"In the last summer, I visited the U.S. with my friend. It was great experience. I loved an ice cream in the U.S. Welcome to U.S.A. pal!\"\n</code></pre>\n\n<pre><code>In the last summer, I visited the U.S. with my friend.\nIt was great experience.\nI loved an ice cream in the U.S.\nWelcome to U.S.A. pal!\n</code></pre>\n\n<p>Obviously, I can't apply <code>text.split(\".\")</code> nor <code>text.split(\". \")</code>. So the thing is first rule is that the string will be split by <code>\".\"</code> with the exception of words that are abbreviated. However, I have no idea how I can do this in Ruby. </p>\n\n<p>It seems that using Regex might work but I have not understood how to do this. Would you please share your idea?</p>\n"}]